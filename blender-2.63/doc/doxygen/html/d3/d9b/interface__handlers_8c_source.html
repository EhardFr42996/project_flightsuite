<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: interface_handlers.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">interface_handlers.c</div>  </div>
</div>
<div class="contents">
<a href="../../d3/d9b/interface__handlers_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version. </span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2008 Blender Foundation.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> * </span>
<a name="l00021"></a>00021 <span class="comment"> * Contributor(s): Blender Foundation</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00024"></a>00024 <span class="comment"> */</span>
<a name="l00025"></a>00025 
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;float.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;limits.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html">DNA_sensor_types.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d3e/DNA__controller__types_8h.html">DNA_controller_types.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html">DNA_actuator_types.h</a>&quot;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html">BLI_string_cursor_utf8.h</a>&quot;</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d2e/PIL__time_8h.html">PIL_time.h</a>&quot;</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/dca/BKE__colortools_8h.html">BKE_colortools.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d95/BKE__idprop_8h.html">BKE_idprop.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d40/BKE__report_8h.html">BKE_report.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d66/BKE__texture_8h.html">BKE_texture.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d72/BKE__tracking_8h.html">BKE_tracking.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d47/BKE__unit_8h.html">BKE_unit.h</a>&quot;</span>
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d12/ED__screen_8h.html">ED_screen.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/df1/ED__util_8h.html">ED_util.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../da/df9/ED__keyframing_8h.html">ED_keyframing.h</a>&quot;</span>
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d1e/UI__interface_8h.html">UI_interface.h</a>&quot;</span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d5d/BLF__api_8h.html">BLF_api.h</a>&quot;</span>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d2f/interface__intern_8h.html">interface_intern.h</a>&quot;</span>
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="comment">/* proto */</span>
<a name="l00079"></a>00079 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a053dc4e6a2757c436a69ab3fb56ea2d7">ui_add_smart_controller</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *from, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *to);
<a name="l00080"></a>00080 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#abbf8f9cfbf1e35968e63b72cd2004109">ui_add_link</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *from, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *to);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 <span class="comment">/***************** structs and defines ****************/</span>
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1bebf830e1e5c490420ab8aa7f741910">00084</a> <span class="preprocessor">#define BUTTON_TOOLTIP_DELAY        0.500</span>
<a name="l00085"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a0a8051787d6550c31c4657b29d33f3aa">00085</a> <span class="preprocessor"></span><span class="preprocessor">#define BUTTON_FLASH_DELAY          0.020</span>
<a name="l00086"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a92cacfa34d1c9928890b246f8bc9dafb">00086</a> <span class="preprocessor"></span><span class="preprocessor">#define MENU_SCROLL_INTERVAL        0.1</span>
<a name="l00087"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#af426bddb9718a37f58081f2b27a01b50">00087</a> <span class="preprocessor"></span><span class="preprocessor">#define BUTTON_AUTO_OPEN_THRESH     0.3</span>
<a name="l00088"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a216cc8119d55ad21cd94017a9415203a">00088</a> <span class="preprocessor"></span><span class="preprocessor">#define BUTTON_MOUSE_TOWARDS_THRESH 1.0</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span>
<a name="l00090"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0b">00090</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0b">uiButtonActivateType</a> {
<a name="l00091"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0ba0ed75c6ab37a0b50ebaffdb3a4ad3f60">00091</a>     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0ba0ed75c6ab37a0b50ebaffdb3a4ad3f60">BUTTON_ACTIVATE_OVER</a>,
<a name="l00092"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0bab111808df840be3c6692f0dc072933c7">00092</a>     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0bab111808df840be3c6692f0dc072933c7">BUTTON_ACTIVATE</a>,
<a name="l00093"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0ba83e55158cfac680f1af68501dc6219c6">00093</a>     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0ba83e55158cfac680f1af68501dc6219c6">BUTTON_ACTIVATE_APPLY</a>,
<a name="l00094"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0bae112effebc0dedcb8bcf27f261510424">00094</a>     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0bae112effebc0dedcb8bcf27f261510424">BUTTON_ACTIVATE_TEXT_EDITING</a>,
<a name="l00095"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0ba96a20f1754faaa0c4d3f914a2906d44d">00095</a>     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0ba96a20f1754faaa0c4d3f914a2906d44d">BUTTON_ACTIVATE_OPEN</a>
<a name="l00096"></a>00096 } <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0b">uiButtonActivateType</a>;
<a name="l00097"></a>00097 
<a name="l00098"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5">00098</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5">uiHandleButtonState</a> {
<a name="l00099"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a3739fe8f243e759c235eb531bbdc31af">00099</a>     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a3739fe8f243e759c235eb531bbdc31af">BUTTON_STATE_INIT</a>,
<a name="l00100"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">00100</a>     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>,
<a name="l00101"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a3bf879676619cb413082552088d9360e">00101</a>     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a3bf879676619cb413082552088d9360e">BUTTON_STATE_WAIT_FLASH</a>,
<a name="l00102"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a9fa352d4981373c052341e4a7dfd7c3d">00102</a>     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a9fa352d4981373c052341e4a7dfd7c3d">BUTTON_STATE_WAIT_RELEASE</a>,
<a name="l00103"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a827cee8974dbe7169ecaed8f9137d7c3">00103</a>     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a827cee8974dbe7169ecaed8f9137d7c3">BUTTON_STATE_WAIT_KEY_EVENT</a>,
<a name="l00104"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">00104</a>     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>,
<a name="l00105"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">00105</a>     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">BUTTON_STATE_TEXT_EDITING</a>,
<a name="l00106"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a76040e4ffb28474e09a53e1e847423d7">00106</a>     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a76040e4ffb28474e09a53e1e847423d7">BUTTON_STATE_TEXT_SELECTING</a>,
<a name="l00107"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ae1228af3749113bd521ffaaa4f5060e8">00107</a>     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ae1228af3749113bd521ffaaa4f5060e8">BUTTON_STATE_MENU_OPEN</a>,
<a name="l00108"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a930ea9a11f71ca40393f0d62d9d3afcb">00108</a>     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a930ea9a11f71ca40393f0d62d9d3afcb">BUTTON_STATE_WAIT_DRAG</a>,
<a name="l00109"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">00109</a>     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>
<a name="l00110"></a>00110 } <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5">uiHandleButtonState</a>;
<a name="l00111"></a>00111 
<a name="l00112"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html">00112</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> {
<a name="l00113"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0fef82cdcd9b3ec4bf3520230c1d67dd">00113</a>     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0fef82cdcd9b3ec4bf3520230c1d67dd">wm</a>;
<a name="l00114"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7d256e7143c620fbd5619e88e21e80b0">00114</a>     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7d256e7143c620fbd5619e88e21e80b0">window</a>;
<a name="l00115"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">00115</a>     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>;
<a name="l00116"></a>00116 
<a name="l00117"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ae0ab7227e9e4ef09a14fa9a47f76f6fc">00117</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ae0ab7227e9e4ef09a14fa9a47f76f6fc">interactive</a>;
<a name="l00118"></a>00118 
<a name="l00119"></a>00119     <span class="comment">/* overall state */</span>
<a name="l00120"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">00120</a>     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5">uiHandleButtonState</a> <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a>;
<a name="l00121"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">00121</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a>, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab781c61b8b3d2757829f9aa919e5f136">escapecancel</a>, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a>;
<a name="l00122"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a46f30df9e212b50fa19cc2f34e50fb82">00122</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a>, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a46f30df9e212b50fa19cc2f34e50fb82">appliedinteractive</a>;
<a name="l00123"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aaaffd30db8d103c08aac277fb90247f9">00123</a>     <a class="code" href="../../d9/d33/structwmTimer.html">wmTimer</a> *<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aaaffd30db8d103c08aac277fb90247f9">flashtimer</a>;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125     <span class="comment">/* edited value */</span>
<a name="l00126"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">00126</a>     <span class="keywordtype">char</span> *<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>, *<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af007846eca2f6739b5f5d6305db6d2ca">origstr</a>;
<a name="l00127"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">00127</a>     <span class="keywordtype">double</span> <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a>, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a6e4b95019c68fe9e30440340115fe5ec">origvalue</a>, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0ef0fa5774082c955d46603ce60df9bb">startvalue</a>;
<a name="l00128"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">00128</a>     <span class="keywordtype">float</span> <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>[3], <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5ae96cbb3abbb1fcabf95027b029464c">origvec</a>[3];
<a name="l00129"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a2761cf68e1f2fc34712ba06e4c64b555">00129</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5ad3e69623bec2807b82452914f8bb6d">togdual</a>, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a2761cf68e1f2fc34712ba06e4c64b555">togonly</a>;
<a name="l00130"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a12b850e20f8fcc35285b276e31ce2af5">00130</a>     <a class="code" href="../../d0/dc8/structColorBand.html">ColorBand</a> *<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a12b850e20f8fcc35285b276e31ce2af5">coba</a>;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132     <span class="comment">/* tooltip */</span>
<a name="l00133"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a2bb369cd5eab731c2b934d37c3486be5">00133</a>     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a2bb369cd5eab731c2b934d37c3486be5">tooltip</a>;
<a name="l00134"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a86b3e2994b78f9ccd7a3587c18276d24">00134</a>     <a class="code" href="../../d9/d33/structwmTimer.html">wmTimer</a> *<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a86b3e2994b78f9ccd7a3587c18276d24">tooltiptimer</a>;
<a name="l00135"></a>00135     
<a name="l00136"></a>00136     <span class="comment">/* auto open */</span>
<a name="l00137"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4f34bfddee9d298d226604baa1bf4e2">00137</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4f34bfddee9d298d226604baa1bf4e2">used_mouse</a>;
<a name="l00138"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a37d213afa1ce75a5c1aa90d64dac3ada">00138</a>     <a class="code" href="../../d9/d33/structwmTimer.html">wmTimer</a> *<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a37d213afa1ce75a5c1aa90d64dac3ada">autoopentimer</a>;
<a name="l00139"></a>00139 
<a name="l00140"></a>00140     <span class="comment">/* text selection/editing */</span>
<a name="l00141"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a89683ee6a9ca8bf2c7e03174ce2c6cb9">00141</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a56e112f7647dbb1fa6743ff86b71cdc5">maxlen</a>, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a885461fd30cd55099ea2f1023551c3f8">selextend</a>, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a89683ee6a9ca8bf2c7e03174ce2c6cb9">selstartx</a>;
<a name="l00142"></a>00142 
<a name="l00143"></a>00143     <span class="comment">/* number editing / dragging */</span>
<a name="l00144"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">00144</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a>, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a>;
<a name="l00145"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">00145</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a>, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a>;
<a name="l00146"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4625a175437558a84bbd1f780fb22569">00146</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab4df4530c50ab91a8cf958000e3c5a29">dragchange</a>, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ac5d8c722c791292345906a2336f92549">draglock</a>, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4625a175437558a84bbd1f780fb22569">dragsel</a>;
<a name="l00147"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a6b16641cad6da7ba6a135c70add30318">00147</a>     <span class="keywordtype">float</span> <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0294a9536f14b44114f578e7a9cf304d">dragf</a>, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a6b16641cad6da7ba6a135c70add30318">dragfstart</a>;
<a name="l00148"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ae3f3ece330f105e0bb31533e28ef16cd">00148</a>     <a class="code" href="../../d6/de7/structCBData.html">CBData</a> *<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ae3f3ece330f105e0bb31533e28ef16cd">dragcbd</a>;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150     <span class="comment">/* menu open (watch uiFreeActiveButtons) */</span>
<a name="l00151"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">00151</a>     <a class="code" href="../../dc/d28/structuiPopupBlockHandle.html">uiPopupBlockHandle</a> *<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a>;
<a name="l00152"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aba880e67f71962eb45fdd1a671a92e47">00152</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aba880e67f71962eb45fdd1a671a92e47">menuretval</a>;
<a name="l00153"></a>00153     
<a name="l00154"></a>00154     <span class="comment">/* search box (watch uiFreeActiveButtons) */</span>
<a name="l00155"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">00155</a>     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>;
<a name="l00156"></a>00156 
<a name="l00157"></a>00157     <span class="comment">/* post activate */</span>
<a name="l00158"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#acfd4bf78a3b0c42ca0309227cf0fe11d">00158</a>     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0b">uiButtonActivateType</a> <a class="code" href="../../d1/d8b/structuiHandleButtonData.html#acfd4bf78a3b0c42ca0309227cf0fe11d">posttype</a>;
<a name="l00159"></a><a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ace9a44756d7460fca8dd9f3eb9f807db">00159</a>     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ace9a44756d7460fca8dd9f3eb9f807db">postbut</a>;
<a name="l00160"></a>00160 } <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6635a9508903205c61c1e945db4c796a">uiHandleButtonData</a>;
<a name="l00161"></a>00161 
<a name="l00162"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html">00162</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../da/dfb/structuiAfterFunc.html">uiAfterFunc</a> {
<a name="l00163"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#aed62632d7221ff734a90ae0e808b8be3">00163</a>     <span class="keyword">struct </span><a class="code" href="../../da/dfb/structuiAfterFunc.html">uiAfterFunc</a> *<a class="code" href="../../da/dfb/structuiAfterFunc.html#a7a9f9b775b689df9395e0279d2e997c5">next</a>, *<a class="code" href="../../da/dfb/structuiAfterFunc.html#aed62632d7221ff734a90ae0e808b8be3">prev</a>;
<a name="l00164"></a>00164 
<a name="l00165"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#a2b5142f94288c43434f6d3ace9f6dd21">00165</a>     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a361e8ee04fd78e14b929fa46740eff5a">uiButHandleFunc</a> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a2b5142f94288c43434f6d3ace9f6dd21">func</a>;
<a name="l00166"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#a5a5ac16d43f56d447ff05c1195024020">00166</a>     <span class="keywordtype">void</span> *<a class="code" href="../../da/dfb/structuiAfterFunc.html#a5a5ac16d43f56d447ff05c1195024020">func_arg1</a>;
<a name="l00167"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#a4ae4d1e47513186df33a1a66ca61646f">00167</a>     <span class="keywordtype">void</span> *<a class="code" href="../../da/dfb/structuiAfterFunc.html#a4ae4d1e47513186df33a1a66ca61646f">func_arg2</a>;
<a name="l00168"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#a86fadfd219961df4a69054246e04a05d">00168</a>     <span class="keywordtype">void</span> *<a class="code" href="../../da/dfb/structuiAfterFunc.html#a86fadfd219961df4a69054246e04a05d">func_arg3</a>;
<a name="l00169"></a>00169     
<a name="l00170"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#a55a3c3fcac356817ce1c53cbf07fec70">00170</a>     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a0a9442136baab908fa7aef9897f88fb5">uiButHandleNFunc</a> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a55a3c3fcac356817ce1c53cbf07fec70">funcN</a>;
<a name="l00171"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#a03408a9e4cf5693ba0c03a43d6d582a5">00171</a>     <span class="keywordtype">void</span> *<a class="code" href="../../da/dfb/structuiAfterFunc.html#a03408a9e4cf5693ba0c03a43d6d582a5">func_argN</a>;
<a name="l00172"></a>00172 
<a name="l00173"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#aee9cea769c0a0cd8b56e1650613b8f42">00173</a>     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a548998945b1d0ef8115bc741a4a99944">uiButHandleRenameFunc</a> <a class="code" href="../../da/dfb/structuiAfterFunc.html#aee9cea769c0a0cd8b56e1650613b8f42">rename_func</a>;
<a name="l00174"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#a9451f7b3801f8c6ae20d11b7f8737385">00174</a>     <span class="keywordtype">void</span> *<a class="code" href="../../da/dfb/structuiAfterFunc.html#a9451f7b3801f8c6ae20d11b7f8737385">rename_arg1</a>;
<a name="l00175"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#a681cad580fd962a1632eba2de3d5fb43">00175</a>     <span class="keywordtype">void</span> *<a class="code" href="../../da/dfb/structuiAfterFunc.html#a681cad580fd962a1632eba2de3d5fb43">rename_orig</a>;
<a name="l00176"></a>00176     
<a name="l00177"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#ab325239d1f2dbb5f7fe3aae64a994dc5">00177</a>     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a99e677d78393821b508bd9596db7ee49">uiBlockHandleFunc</a> <a class="code" href="../../da/dfb/structuiAfterFunc.html#ab325239d1f2dbb5f7fe3aae64a994dc5">handle_func</a>;
<a name="l00178"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#afc1fb41de2f098cd3a5edd758d0750ba">00178</a>     <span class="keywordtype">void</span> *<a class="code" href="../../da/dfb/structuiAfterFunc.html#afc1fb41de2f098cd3a5edd758d0750ba">handle_func_arg</a>;
<a name="l00179"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">00179</a>     <span class="keywordtype">int</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a>;
<a name="l00180"></a>00180 
<a name="l00181"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#ab51569d856b517b461f2b3059990aa4d">00181</a>     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a7cc6386fd24dcc2bf7a0baa5f4837f58">uiMenuHandleFunc</a> <a class="code" href="../../da/dfb/structuiAfterFunc.html#ab51569d856b517b461f2b3059990aa4d">butm_func</a>;
<a name="l00182"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#a1d9eedbbecd73e6d6c77d2591c754c4d">00182</a>     <span class="keywordtype">void</span> *<a class="code" href="../../da/dfb/structuiAfterFunc.html#a1d9eedbbecd73e6d6c77d2591c754c4d">butm_func_arg</a>;
<a name="l00183"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#a7d45bcdad99e947a1b35230eedb3797f">00183</a>     <span class="keywordtype">int</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a7d45bcdad99e947a1b35230eedb3797f">a2</a>;
<a name="l00184"></a>00184 
<a name="l00185"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#a6b2bd762e253d4b5538527fdc7036415">00185</a>     <a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *<a class="code" href="../../da/dfb/structuiAfterFunc.html#a6b2bd762e253d4b5538527fdc7036415">optype</a>;
<a name="l00186"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#a3eefc43b144c814231d1f6c36a2a8f34">00186</a>     <span class="keywordtype">int</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a3eefc43b144c814231d1f6c36a2a8f34">opcontext</a>;
<a name="l00187"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#af1c98ba94e08984f73faecce2450bbff">00187</a>     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> *<a class="code" href="../../da/dfb/structuiAfterFunc.html#af1c98ba94e08984f73faecce2450bbff">opptr</a>;
<a name="l00188"></a>00188 
<a name="l00189"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#a4689b6038e1744926576ca855cdacf80">00189</a>     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a4689b6038e1744926576ca855cdacf80">rnapoin</a>;
<a name="l00190"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#a159d0f86cf01c1c7aee7a57f034c73ff">00190</a>     <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *<a class="code" href="../../da/dfb/structuiAfterFunc.html#a159d0f86cf01c1c7aee7a57f034c73ff">rnaprop</a>;
<a name="l00191"></a>00191 
<a name="l00192"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#a335ad3c82311e5f3cd05d86264bcd6cb">00192</a>     <a class="code" href="../../da/d48/structbContextStore.html">bContextStore</a> *<a class="code" href="../../da/dfb/structuiAfterFunc.html#a335ad3c82311e5f3cd05d86264bcd6cb">context</a>;
<a name="l00193"></a>00193 
<a name="l00194"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#a61adf7fa70bcd23673dd84b553a9d129">00194</a>     <span class="keywordtype">char</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a61adf7fa70bcd23673dd84b553a9d129">undostr</a>[512];
<a name="l00195"></a>00195 
<a name="l00196"></a><a class="code" href="../../da/dfb/structuiAfterFunc.html#af4521568a50eed453a09edfe7cbbef65">00196</a>     <span class="keywordtype">int</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#af4521568a50eed453a09edfe7cbbef65">autokey</a>;
<a name="l00197"></a>00197 } <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ac7400c19ee76374d4f9837dd77669b5d">uiAfterFunc</a>;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a014cc2a109a3773c53c72ce9be68c1ba">ui_but_contains_pt</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <span class="keywordtype">int</span> mx, <span class="keywordtype">int</span> my);
<a name="l00200"></a>00200 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a96d54676d1014fb5361f50b5adf8f322">ui_mouse_inside_button</a>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y);
<a name="l00201"></a>00201 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5">uiHandleButtonState</a> <a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>);
<a name="l00202"></a>00202 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6af6aa616eab184a12bf533bd9ebea55">ui_handler_region_menu</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <span class="keywordtype">void</span> *userdata);
<a name="l00203"></a>00203 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab4089d3f2a01002abbea3eadec7a650b">ui_handle_button_activate</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0b">uiButtonActivateType</a> type);
<a name="l00204"></a>00204 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a08501934715996a73502df4fa5a652f8">button_timers_tooltip_remove</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but);
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 <span class="comment">/* ******************** menu navigation helpers ************** */</span>
<a name="l00207"></a>00207 
<a name="l00208"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad80cc02e7cd94d2ad6f6d265eedda10b">00208</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad80cc02e7cd94d2ad6f6d265eedda10b">ui_but_editable</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but)
<a name="l00209"></a>00209 {
<a name="l00210"></a>00210     <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a94fe4335845faafd0b969e89a13d8c76">ELEM5</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#a0b7df70d4a086a227bc482b07e2bbbca">LABEL</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad19009702facf6995a6aa5dbdf1c871a">SEPR</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a20f5ee572977e66f70f3350e350a5ad9">ROUNDBOX</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#afc775e59075662398538111f1cbd3cba">LISTBOX</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a2e8b374db15e64ac6199e8ca5c1bc0b2">PROGRESSBAR</a>);
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 
<a name="l00213"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a02dd6ae76735b285fb6405403acc30eb">00213</a> <span class="keyword">static</span> <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a02dd6ae76735b285fb6405403acc30eb">ui_but_prev</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but)
<a name="l00214"></a>00214 {
<a name="l00215"></a>00215     <span class="keywordflow">while</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a081d5bf07bacf5c1887d48811a094ce6">prev</a>) {
<a name="l00216"></a>00216         but = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a081d5bf07bacf5c1887d48811a094ce6">prev</a>;
<a name="l00217"></a>00217         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad80cc02e7cd94d2ad6f6d265eedda10b">ui_but_editable</a>(but)) <span class="keywordflow">return</span> but;
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00220"></a>00220 }
<a name="l00221"></a>00221 
<a name="l00222"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae3d5df2bbc40362976c46ebdfacd6d86">00222</a> <span class="keyword">static</span> <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *<a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae3d5df2bbc40362976c46ebdfacd6d86">ui_but_next</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but)
<a name="l00223"></a>00223 {
<a name="l00224"></a>00224     <span class="keywordflow">while</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>) {
<a name="l00225"></a>00225         but = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>;
<a name="l00226"></a>00226         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad80cc02e7cd94d2ad6f6d265eedda10b">ui_but_editable</a>(but)) <span class="keywordflow">return</span> but;
<a name="l00227"></a>00227     }
<a name="l00228"></a>00228     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00229"></a>00229 }
<a name="l00230"></a>00230 
<a name="l00231"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa6fe202ff1581edf19c97eabbc7d4dc6">00231</a> <span class="keyword">static</span> <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *<a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa6fe202ff1581edf19c97eabbc7d4dc6">ui_but_first</a>(<a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block)
<a name="l00232"></a>00232 {
<a name="l00233"></a>00233     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l00234"></a>00234     
<a name="l00235"></a>00235     but = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a844299999568743bc189fcb02847e9e6">buttons</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00236"></a>00236     <span class="keywordflow">while</span> (but) {
<a name="l00237"></a>00237         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad80cc02e7cd94d2ad6f6d265eedda10b">ui_but_editable</a>(but)) <span class="keywordflow">return</span> but;
<a name="l00238"></a>00238         but = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>;
<a name="l00239"></a>00239     }
<a name="l00240"></a>00240     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00241"></a>00241 }
<a name="l00242"></a>00242 
<a name="l00243"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a969c3f614ac1c0816076b8a84c8d5347">00243</a> <span class="keyword">static</span> <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a969c3f614ac1c0816076b8a84c8d5347">ui_but_last</a>(<a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block)
<a name="l00244"></a>00244 {
<a name="l00245"></a>00245     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l00246"></a>00246     
<a name="l00247"></a>00247     but = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a844299999568743bc189fcb02847e9e6">buttons</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>;
<a name="l00248"></a>00248     <span class="keywordflow">while</span> (but) {
<a name="l00249"></a>00249         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad80cc02e7cd94d2ad6f6d265eedda10b">ui_but_editable</a>(but)) <span class="keywordflow">return</span> but;
<a name="l00250"></a>00250         but = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a081d5bf07bacf5c1887d48811a094ce6">prev</a>;
<a name="l00251"></a>00251     }
<a name="l00252"></a>00252     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00253"></a>00253 }
<a name="l00254"></a>00254 
<a name="l00255"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aab7bfed4f48e9625734a5b862a44c5f6">00255</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aab7bfed4f48e9625734a5b862a44c5f6">ui_is_a_warp_but</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but)
<a name="l00256"></a>00256 {
<a name="l00257"></a>00257     <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.uiflag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a6dcdc3e6aeed2189048e53e258a1e567">USER_CONTINUOUS_MOUSE</a>)
<a name="l00258"></a>00258         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0388eda1f65113c4a15720e037c11cb4">ELEM4</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#aaf0952059602752258dccaa015d7b54a">NUM</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a53ab9b2f5a030a06d3a609f2aad1fde3">NUMABS</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#af5b7a7238e8eaabdbec6a107c41f426a">HSVCIRCLE</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad1c71f878b30e83247db31d5afe965ff">TRACKPREVIEW</a>))
<a name="l00259"></a>00259             <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00262"></a>00262 }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264 <span class="comment">/* file selectors are exempt from utf-8 checks */</span>
<a name="l00265"></a><a class="code" href="../../d1/d2f/interface__intern_8h.html#a1969f7180fb294c121308618f60a0aab">00265</a> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1969f7180fb294c121308618f60a0aab">ui_is_but_utf8</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but)
<a name="l00266"></a>00266 {
<a name="l00267"></a>00267     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>) {
<a name="l00268"></a>00268         <span class="keyword">const</span> <span class="keywordtype">int</span> subtype = <a class="code" href="../../d3/d10/rna__access_8c.html#ac2188d2835e07f6dd15491f6764cae78">RNA_property_subtype</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>);
<a name="l00269"></a>00269         <span class="keywordflow">return</span> !(<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0388eda1f65113c4a15720e037c11cb4">ELEM4</a>(subtype, <a class="code" href="../../de/d7e/RNA__types_8h.html#afc8d3af46d7ce49bb3e75305354fd9bcac72d63744a87a62fcb2e65d289bc0e06">PROP_FILEPATH</a>, <a class="code" href="../../de/d7e/RNA__types_8h.html#afc8d3af46d7ce49bb3e75305354fd9bca8a0da51c5a63585b3bdc82aded02f113">PROP_DIRPATH</a>, <a class="code" href="../../de/d7e/RNA__types_8h.html#afc8d3af46d7ce49bb3e75305354fd9bca3b73b4ff1a1029f1649a06a954cb2272">PROP_FILENAME</a>, <a class="code" href="../../de/d7e/RNA__types_8h.html#afc8d3af46d7ce49bb3e75305354fd9bca1fdd5bc375b3df54bc08e097ef28c411">PROP_BYTESTRING</a>));
<a name="l00270"></a>00270     }
<a name="l00271"></a>00271     <span class="keywordflow">else</span> {
<a name="l00272"></a>00272         <span class="keywordflow">return</span> !(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a821ea224e0f61723386b8d1c7eb6c1af">UI_BUT_NO_UTF8</a>);
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274 }
<a name="l00275"></a>00275 
<a name="l00276"></a>00276 <span class="comment">/* ********************** button apply/revert ************************/</span>
<a name="l00277"></a>00277 
<a name="l00278"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a685a9c98d538b0a9dfda439d40a31434">00278</a> <span class="keyword">static</span> <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a685a9c98d538b0a9dfda439d40a31434">UIAfterFuncs</a> = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00279"></a>00279 
<a name="l00280"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">00280</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">ui_apply_but_func</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but)
<a name="l00281"></a>00281 {
<a name="l00282"></a>00282     <a class="code" href="../../da/dfb/structuiAfterFunc.html">uiAfterFunc</a> *after;
<a name="l00283"></a>00283     <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>;
<a name="l00284"></a>00284 
<a name="l00285"></a>00285     <span class="comment">/* these functions are postponed and only executed after all other</span>
<a name="l00286"></a>00286 <span class="comment">     * handling is done, i.e. menus are closed, in order to avoid conflicts</span>
<a name="l00287"></a>00287 <span class="comment">     * with these functions removing the buttons we are working with */</span>
<a name="l00288"></a>00288 
<a name="l00289"></a>00289     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a4ecd2405284ba5574a99ebd04a91ec8d">func</a> || but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a143be9c8afe99a2bdb636e6d4420be47">funcN</a> || block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a6b69a2c68c67bfc81d90b00cc32cd267">handle_func</a> || but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abe828e1485748fdee105cffe209025ce">rename_func</a> || (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a7489385fb8eddb0eabd9fc4c3954e653">BUTM</a> &amp;&amp; block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#aa8d5e6e724819b9399d2c869e7f1b448">butm_func</a>) || but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a> || but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>) {
<a name="l00290"></a>00290         after = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/dfb/structuiAfterFunc.html">uiAfterFunc</a>), <span class="stringliteral">&quot;uiAfterFunc&quot;</span>);
<a name="l00291"></a>00291 
<a name="l00292"></a>00292         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a4ecd2405284ba5574a99ebd04a91ec8d">func</a> &amp;&amp; <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(but, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a927eedeea2fdf9d8eddb2a91ad14ad6f">func_arg1</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a162cc7440a9a1dcc12a6b5e710f45c13">func_arg2</a>)) {
<a name="l00293"></a>00293             <span class="comment">/* exception, this will crash due to removed button otherwise */</span>
<a name="l00294"></a>00294             but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a4ecd2405284ba5574a99ebd04a91ec8d">func</a>(C, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a927eedeea2fdf9d8eddb2a91ad14ad6f">func_arg1</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a162cc7440a9a1dcc12a6b5e710f45c13">func_arg2</a>);
<a name="l00295"></a>00295         }
<a name="l00296"></a>00296         <span class="keywordflow">else</span>
<a name="l00297"></a>00297             after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#a2b5142f94288c43434f6d3ace9f6dd21">func</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a4ecd2405284ba5574a99ebd04a91ec8d">func</a>;
<a name="l00298"></a>00298 
<a name="l00299"></a>00299         after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#a5a5ac16d43f56d447ff05c1195024020">func_arg1</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a927eedeea2fdf9d8eddb2a91ad14ad6f">func_arg1</a>;
<a name="l00300"></a>00300         after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#a4ae4d1e47513186df33a1a66ca61646f">func_arg2</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a162cc7440a9a1dcc12a6b5e710f45c13">func_arg2</a>;
<a name="l00301"></a>00301         after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#a86fadfd219961df4a69054246e04a05d">func_arg3</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a65b658708133a36859fde864eaa0a35c">func_arg3</a>;
<a name="l00302"></a>00302 
<a name="l00303"></a>00303         after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#a55a3c3fcac356817ce1c53cbf07fec70">funcN</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a143be9c8afe99a2bdb636e6d4420be47">funcN</a>;
<a name="l00304"></a>00304         after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#a03408a9e4cf5693ba0c03a43d6d582a5">func_argN</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#af44dd4115db2000459a0ffc72a9bc092">func_argN</a>);
<a name="l00305"></a>00305 
<a name="l00306"></a>00306         after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#aee9cea769c0a0cd8b56e1650613b8f42">rename_func</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abe828e1485748fdee105cffe209025ce">rename_func</a>;
<a name="l00307"></a>00307         after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#a9451f7b3801f8c6ae20d11b7f8737385">rename_arg1</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ae10e61517e58ead45873d336a6d02830">rename_arg1</a>;
<a name="l00308"></a>00308         after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#a681cad580fd962a1632eba2de3d5fb43">rename_orig</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1eefed002de71abeb0358656e8eb68e7">rename_orig</a>; <span class="comment">/* needs free! */</span>
<a name="l00309"></a>00309 
<a name="l00310"></a>00310         after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#ab325239d1f2dbb5f7fe3aae64a994dc5">handle_func</a> = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a6b69a2c68c67bfc81d90b00cc32cd267">handle_func</a>;
<a name="l00311"></a>00311         after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#afc1fb41de2f098cd3a5edd758d0750ba">handle_func_arg</a> = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#ac8f71dc493486138abed1c1ed5a73490">handle_func_arg</a>;
<a name="l00312"></a>00312         after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab5f3a2117af0d9856576ec5833302c5a">retval</a>;
<a name="l00313"></a>00313 
<a name="l00314"></a>00314         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a7489385fb8eddb0eabd9fc4c3954e653">BUTM</a>) {
<a name="l00315"></a>00315             after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#ab51569d856b517b461f2b3059990aa4d">butm_func</a> = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#aa8d5e6e724819b9399d2c869e7f1b448">butm_func</a>;
<a name="l00316"></a>00316             after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#a1d9eedbbecd73e6d6c77d2591c754c4d">butm_func_arg</a> = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a97edf6069c9ac491f94ca782abdd3edb">butm_func_arg</a>;
<a name="l00317"></a>00317             after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#a7d45bcdad99e947a1b35230eedb3797f">a2</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#adabf3be1173f6353f40cde0c6519312c">a2</a>;
<a name="l00318"></a>00318         }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320         after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#a6b2bd762e253d4b5538527fdc7036415">optype</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a>;
<a name="l00321"></a>00321         after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#a3eefc43b144c814231d1f6c36a2a8f34">opcontext</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#acfc4beefe5eea8396a20281850dbf00c">opcontext</a>;
<a name="l00322"></a>00322         after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#af1c98ba94e08984f73faecce2450bbff">opptr</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abc3962ff38f89bafee42df467dd0cf87">opptr</a>;
<a name="l00323"></a>00323 
<a name="l00324"></a>00324         after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#a4689b6038e1744926576ca855cdacf80">rnapoin</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>;
<a name="l00325"></a>00325         after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#a159d0f86cf01c1c7aee7a57f034c73ff">rnaprop</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>;
<a name="l00326"></a>00326 
<a name="l00327"></a>00327         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04d9d7641be70431014a77d333e69f93">context</a>)
<a name="l00328"></a>00328             after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#a335ad3c82311e5f3cd05d86264bcd6cb">context</a> = <a class="code" href="../../df/d01/BKE__context_8h.html#a6d35555121ca32f195683333941d77d6">CTX_store_copy</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04d9d7641be70431014a77d333e69f93">context</a>);
<a name="l00329"></a>00329 
<a name="l00330"></a>00330         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00331"></a>00331         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#acfc4beefe5eea8396a20281850dbf00c">opcontext</a> = 0;
<a name="l00332"></a>00332         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abc3962ff38f89bafee42df467dd0cf87">opptr</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00333"></a>00333 
<a name="l00334"></a>00334         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;UIAfterFuncs, after);
<a name="l00335"></a>00335     }
<a name="l00336"></a>00336 }
<a name="l00337"></a>00337 
<a name="l00338"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a202b225af133e66df3e52ba04355a0ec">00338</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a202b225af133e66df3e52ba04355a0ec">ui_apply_autokey_undo</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but)
<a name="l00339"></a>00339 {
<a name="l00340"></a>00340     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00341"></a>00341     <a class="code" href="../../da/dfb/structuiAfterFunc.html">uiAfterFunc</a> *after;
<a name="l00342"></a>00342 
<a name="l00343"></a>00343     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a43152cd15e4d019a8ee2aeeeeafb0c98">UI_BUT_UNDO</a>) {
<a name="l00344"></a>00344         <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00345"></a>00345 
<a name="l00346"></a>00346         <span class="comment">/* define which string to use for undo */</span>
<a name="l00347"></a>00347         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a32298be536f02aa8bbde57c0c970124e">LINK</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a26966d6f3a8af2b1ef515852d322b2b0">INLINK</a>)) str = <span class="stringliteral">&quot;Add button link&quot;</span>;
<a name="l00348"></a>00348         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad0d059e6a83d21bea4f4db1c9fbd240b">MENU</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5975b2d368ff03c7359503587664fba5">ICONTEXTROW</a>)) str = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ad10198140dc5e52877630009f81879f7">drawstr</a>;
<a name="l00349"></a>00349         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ad10198140dc5e52877630009f81879f7">drawstr</a>[0]) str = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ad10198140dc5e52877630009f81879f7">drawstr</a>;
<a name="l00350"></a>00350         <span class="keywordflow">else</span> str = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a028f518f7ecb25727477e2f5386464fa">tip</a>;
<a name="l00351"></a>00351 
<a name="l00352"></a>00352         <span class="comment">/* fallback, else we don&#39;t get an undo! */</span>
<a name="l00353"></a>00353         <span class="keywordflow">if</span> (str == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || str[0] == <span class="charliteral">&#39;\0&#39;</span>) {
<a name="l00354"></a>00354             str = <span class="stringliteral">&quot;Unknown Action&quot;</span>;
<a name="l00355"></a>00355         }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357         <span class="comment">/* delayed, after all other funcs run, popups are closed, etc */</span>
<a name="l00358"></a>00358         after = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/dfb/structuiAfterFunc.html">uiAfterFunc</a>), <span class="stringliteral">&quot;uiAfterFunc&quot;</span>);
<a name="l00359"></a>00359         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#a61adf7fa70bcd23673dd84b553a9d129">undostr</a>, str, <span class="keyword">sizeof</span>(after-&gt;<a class="code" href="../../da/dfb/structuiAfterFunc.html#a61adf7fa70bcd23673dd84b553a9d129">undostr</a>));
<a name="l00360"></a>00360         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;UIAfterFuncs, after);
<a name="l00361"></a>00361     }
<a name="l00362"></a>00362 
<a name="l00363"></a>00363     <span class="comment">/* try autokey */</span>
<a name="l00364"></a>00364     <a class="code" href="../../d6/dc2/interface__anim_8c.html#a82873b67243eac2a462a8053eb622593">ui_but_anim_autokey</a>(C, but, scene, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a>);
<a name="l00365"></a>00365 }
<a name="l00366"></a>00366 
<a name="l00367"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad67fd5103bd96676d77781bb042857c9">00367</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad67fd5103bd96676d77781bb042857c9">ui_apply_but_funcs_after</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l00368"></a>00368 {
<a name="l00369"></a>00369     <a class="code" href="../../da/dfb/structuiAfterFunc.html">uiAfterFunc</a> *afterf, after;
<a name="l00370"></a>00370     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> <a class="code" href="../../da/dfb/structuiAfterFunc.html#af1c98ba94e08984f73faecce2450bbff">opptr</a>;
<a name="l00371"></a>00371     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> funcs;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373     <span class="comment">/* copy to avoid recursive calls */</span>
<a name="l00374"></a>00374     funcs = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a685a9c98d538b0a9dfda439d40a31434">UIAfterFuncs</a>;
<a name="l00375"></a>00375     UIAfterFuncs.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> = UIAfterFuncs.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00376"></a>00376 
<a name="l00377"></a>00377     <span class="keywordflow">for</span> (afterf = funcs.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; afterf; afterf = after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a7a9f9b775b689df9395e0279d2e997c5">next</a>) {
<a name="l00378"></a>00378         after = *afterf; <span class="comment">/* copy to avoid memleak on exit() */</span>
<a name="l00379"></a>00379         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a2bb7ce226f8b42d21eb35100f0bb4580">BLI_freelinkN</a>(&amp;funcs, afterf);
<a name="l00380"></a>00380 
<a name="l00381"></a>00381         <span class="keywordflow">if</span> (after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a335ad3c82311e5f3cd05d86264bcd6cb">context</a>)
<a name="l00382"></a>00382             <a class="code" href="../../df/d01/BKE__context_8h.html#a147434f7fbb902ea158ce15cc7461244">CTX_store_set</a>(C, after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a335ad3c82311e5f3cd05d86264bcd6cb">context</a>);
<a name="l00383"></a>00383 
<a name="l00384"></a>00384         <span class="keywordflow">if</span> (after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#af1c98ba94e08984f73faecce2450bbff">opptr</a>) {
<a name="l00385"></a>00385             <span class="comment">/* free in advance to avoid leak on exit */</span>
<a name="l00386"></a>00386             opptr = *after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#af1c98ba94e08984f73faecce2450bbff">opptr</a>,
<a name="l00387"></a>00387             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#af1c98ba94e08984f73faecce2450bbff">opptr</a>);
<a name="l00388"></a>00388         }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390         <span class="keywordflow">if</span> (after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a6b2bd762e253d4b5538527fdc7036415">optype</a>)
<a name="l00391"></a>00391             <a class="code" href="../../df/db0/wm__event__system_8c.html#a0208cd65e2ce6a150f2653214cfc57dd">WM_operator_name_call</a>(C, after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a6b2bd762e253d4b5538527fdc7036415">optype</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>, after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a3eefc43b144c814231d1f6c36a2a8f34">opcontext</a>, (after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#af1c98ba94e08984f73faecce2450bbff">opptr</a>) ? &amp;opptr : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00392"></a>00392 
<a name="l00393"></a>00393         <span class="keywordflow">if</span> (after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#af1c98ba94e08984f73faecce2450bbff">opptr</a>)
<a name="l00394"></a>00394             <a class="code" href="../../d6/dae/wm__operators_8c.html#ae26f29609662ec248827ff991fe8c5cb">WM_operator_properties_free</a>(&amp;opptr);
<a name="l00395"></a>00395 
<a name="l00396"></a>00396         <span class="keywordflow">if</span> (after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a4689b6038e1744926576ca855cdacf80">rnapoin</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>)
<a name="l00397"></a>00397             <a class="code" href="../../d3/d10/rna__access_8c.html#a5fa7d69c3a73312275e1e6d20baf3bc6">RNA_property_update</a>(C, &amp;after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a4689b6038e1744926576ca855cdacf80">rnapoin</a>, after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a159d0f86cf01c1c7aee7a57f034c73ff">rnaprop</a>);
<a name="l00398"></a>00398 
<a name="l00399"></a>00399         <span class="keywordflow">if</span> (after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a335ad3c82311e5f3cd05d86264bcd6cb">context</a>) {
<a name="l00400"></a>00400             <a class="code" href="../../df/d01/BKE__context_8h.html#a147434f7fbb902ea158ce15cc7461244">CTX_store_set</a>(C, NULL);
<a name="l00401"></a>00401             <a class="code" href="../../df/d01/BKE__context_8h.html#a6d78ece86a15ec1048b44aba5e81076b">CTX_store_free</a>(after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a335ad3c82311e5f3cd05d86264bcd6cb">context</a>);
<a name="l00402"></a>00402         }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404         <span class="keywordflow">if</span> (after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a2b5142f94288c43434f6d3ace9f6dd21">func</a>)
<a name="l00405"></a>00405             after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a2b5142f94288c43434f6d3ace9f6dd21">func</a>(C, after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a5a5ac16d43f56d447ff05c1195024020">func_arg1</a>, after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a4ae4d1e47513186df33a1a66ca61646f">func_arg2</a>);
<a name="l00406"></a>00406         <span class="keywordflow">if</span> (after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a55a3c3fcac356817ce1c53cbf07fec70">funcN</a>)
<a name="l00407"></a>00407             after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a55a3c3fcac356817ce1c53cbf07fec70">funcN</a>(C, after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a03408a9e4cf5693ba0c03a43d6d582a5">func_argN</a>, after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a4ae4d1e47513186df33a1a66ca61646f">func_arg2</a>);
<a name="l00408"></a>00408         <span class="keywordflow">if</span> (after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a03408a9e4cf5693ba0c03a43d6d582a5">func_argN</a>)
<a name="l00409"></a>00409             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a03408a9e4cf5693ba0c03a43d6d582a5">func_argN</a>);
<a name="l00410"></a>00410         
<a name="l00411"></a>00411         <span class="keywordflow">if</span> (after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#ab325239d1f2dbb5f7fe3aae64a994dc5">handle_func</a>)
<a name="l00412"></a>00412             after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#ab325239d1f2dbb5f7fe3aae64a994dc5">handle_func</a>(C, after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#afc1fb41de2f098cd3a5edd758d0750ba">handle_func_arg</a>, after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a>);
<a name="l00413"></a>00413         <span class="keywordflow">if</span> (after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#ab51569d856b517b461f2b3059990aa4d">butm_func</a>)
<a name="l00414"></a>00414             after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#ab51569d856b517b461f2b3059990aa4d">butm_func</a>(C, after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a1d9eedbbecd73e6d6c77d2591c754c4d">butm_func_arg</a>, after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a7d45bcdad99e947a1b35230eedb3797f">a2</a>);
<a name="l00415"></a>00415         
<a name="l00416"></a>00416         <span class="keywordflow">if</span> (after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#aee9cea769c0a0cd8b56e1650613b8f42">rename_func</a>)
<a name="l00417"></a>00417             after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#aee9cea769c0a0cd8b56e1650613b8f42">rename_func</a>(C, after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a9451f7b3801f8c6ae20d11b7f8737385">rename_arg1</a>, after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a681cad580fd962a1632eba2de3d5fb43">rename_orig</a>);
<a name="l00418"></a>00418         <span class="keywordflow">if</span> (after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a681cad580fd962a1632eba2de3d5fb43">rename_orig</a>)
<a name="l00419"></a>00419             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a681cad580fd962a1632eba2de3d5fb43">rename_orig</a>);
<a name="l00420"></a>00420         
<a name="l00421"></a>00421         <span class="keywordflow">if</span> (after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a61adf7fa70bcd23673dd84b553a9d129">undostr</a>[0])
<a name="l00422"></a>00422             <a class="code" href="../../d6/df1/ED__util_8h.html#aa768644f80c2e60cce352dcc11970d1f">ED_undo_push</a>(C, after.<a class="code" href="../../da/dfb/structuiAfterFunc.html#a61adf7fa70bcd23673dd84b553a9d129">undostr</a>);
<a name="l00423"></a>00423     }
<a name="l00424"></a>00424 }
<a name="l00425"></a>00425 
<a name="l00426"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9323062f4708a7ee83e47b8e2ac9d0bb">00426</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9323062f4708a7ee83e47b8e2ac9d0bb">ui_apply_but_BUT</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l00427"></a>00427 {
<a name="l00428"></a>00428     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">ui_apply_but_func</a>(C, but);
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab5f3a2117af0d9856576ec5833302c5a">retval</a>;
<a name="l00431"></a>00431     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a> = 1;
<a name="l00432"></a>00432 }
<a name="l00433"></a>00433 
<a name="l00434"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8cef0cbdcdf55845e8edeb48b2fc2085">00434</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8cef0cbdcdf55845e8edeb48b2fc2085">ui_apply_but_BUTM</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l00435"></a>00435 {
<a name="l00436"></a>00436     <a class="code" href="../../dd/dda/interface_8c.html#a02d9f599cc619a5ca1e7f59366710cc6">ui_set_but_val</a>(but, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9ecd1237ea2c0f8553919952c0e06578">hardmin</a>);
<a name="l00437"></a>00437     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">ui_apply_but_func</a>(C, but);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab5f3a2117af0d9856576ec5833302c5a">retval</a>;
<a name="l00440"></a>00440     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a> = 1;
<a name="l00441"></a>00441 }
<a name="l00442"></a>00442 
<a name="l00443"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6e65daad8f478cca9c17ea25d7e72657">00443</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6e65daad8f478cca9c17ea25d7e72657">ui_apply_but_BLOCK</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l00444"></a>00444 {
<a name="l00445"></a>00445     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad0d059e6a83d21bea4f4db1c9fbd240b">MENU</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#af6ad4ca5cd637c3ab6dad8114b8d3e75">ICONROW</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5975b2d368ff03c7359503587664fba5">ICONTEXTROW</a>))
<a name="l00446"></a>00446         <a class="code" href="../../dd/dda/interface_8c.html#a02d9f599cc619a5ca1e7f59366710cc6">ui_set_but_val</a>(but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a>);
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(but);
<a name="l00449"></a>00449     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">ui_apply_but_func</a>(C, but);
<a name="l00450"></a>00450     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab5f3a2117af0d9856576ec5833302c5a">retval</a>;
<a name="l00451"></a>00451     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a> = 1;
<a name="l00452"></a>00452 }
<a name="l00453"></a>00453 
<a name="l00454"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#acca76c865cefe93e3eaea20ddab04543">00454</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#acca76c865cefe93e3eaea20ddab04543">ui_apply_but_TOG</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l00455"></a>00455 {
<a name="l00456"></a>00456     <span class="keywordtype">double</span> value;
<a name="l00457"></a>00457     <span class="keywordtype">int</span> w, lvalue, push;
<a name="l00458"></a>00458     
<a name="l00459"></a>00459     <span class="comment">/* local hack... */</span>
<a name="l00460"></a>00460     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa21a5ba3b14585362d65acd0ae14f7bc">BUT_TOGDUAL</a> &amp;&amp; data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5ad3e69623bec2807b82452914f8bb6d">togdual</a>) {
<a name="l00461"></a>00461         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e995a6658324bda3058970ce4df74b6">pointype</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#ae9a425bb2981a9c2b17dec3f161dbbf7">SHO</a>)
<a name="l00462"></a>00462             but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> += 2;
<a name="l00463"></a>00463         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e995a6658324bda3058970ce4df74b6">pointype</a> == <a class="code" href="../../d3/d22/seqeffects_8c.html#afeeffe52c8fd59db7c61cf8b02042dbf">INT</a>)
<a name="l00464"></a>00464             but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> += 4;
<a name="l00465"></a>00465     }
<a name="l00466"></a>00466     
<a name="l00467"></a>00467     value = <a class="code" href="../../dd/dda/interface_8c.html#acbe9b206aab37f6c325e7107c33c0cb6">ui_get_but_val</a>(but);
<a name="l00468"></a>00468     lvalue = (int)value;
<a name="l00469"></a>00469     
<a name="l00470"></a>00470     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1eea72fd2f28561b4a79ef1c47bcc186">bit</a>) {
<a name="l00471"></a>00471         w = <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a2e1b711f5a6c410be2735960a4037472">BTST</a>(lvalue, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7a4f7157b860db64cc0c798f2dc7e670">bitnr</a>);
<a name="l00472"></a>00472         <span class="keywordflow">if</span> (w) lvalue = <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a8ff39b905184e3fcfb664a866d48bb6a">BCLR</a>(lvalue, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7a4f7157b860db64cc0c798f2dc7e670">bitnr</a>);
<a name="l00473"></a>00473         <span class="keywordflow">else</span> lvalue = <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a7126793c8bd5020f45ed9fe2ec323a23">BSET</a>(lvalue, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7a4f7157b860db64cc0c798f2dc7e670">bitnr</a>);
<a name="l00474"></a>00474         
<a name="l00475"></a>00475         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a59cc7c2157b515ed2c780bb6f7b44e27">TOGR</a>) {
<a name="l00476"></a>00476             <span class="keywordflow">if</span> (!data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a2761cf68e1f2fc34712ba06e4c64b555">togonly</a>) {
<a name="l00477"></a>00477                 lvalue = 1 &lt;&lt; (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7a4f7157b860db64cc0c798f2dc7e670">bitnr</a>);
<a name="l00478"></a>00478     
<a name="l00479"></a>00479                 <a class="code" href="../../dd/dda/interface_8c.html#a02d9f599cc619a5ca1e7f59366710cc6">ui_set_but_val</a>(but, (<span class="keywordtype">double</span>)lvalue);
<a name="l00480"></a>00480             }
<a name="l00481"></a>00481             <span class="keywordflow">else</span> {
<a name="l00482"></a>00482                 <span class="keywordflow">if</span> (lvalue == 0) lvalue = 1 &lt;&lt; (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7a4f7157b860db64cc0c798f2dc7e670">bitnr</a>);
<a name="l00483"></a>00483             }
<a name="l00484"></a>00484         }
<a name="l00485"></a>00485         
<a name="l00486"></a>00486         <a class="code" href="../../dd/dda/interface_8c.html#a02d9f599cc619a5ca1e7f59366710cc6">ui_set_but_val</a>(but, (<span class="keywordtype">double</span>)lvalue);
<a name="l00487"></a>00487         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a07a8e4d9b0c2f42662cde3b0afd8dc07">ICONTOG</a> || but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#afe3554f948715ad756e7bfe418a0e92e">ICONTOGN</a>) <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(but);
<a name="l00488"></a>00488     }
<a name="l00489"></a>00489     <span class="keywordflow">else</span> {
<a name="l00490"></a>00490         
<a name="l00491"></a>00491         <span class="keywordflow">if</span> (value == 0.0) push = 1;
<a name="l00492"></a>00492         <span class="keywordflow">else</span> push = 0;
<a name="l00493"></a>00493         
<a name="l00494"></a>00494         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a6b185cf808adc8c34bd90b87b6b45ff7">TOGN</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#afe3554f948715ad756e7bfe418a0e92e">ICONTOGN</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#ac6cd5ac67760662bb5dd35aaf7000117">OPTIONN</a>)) push = !push;
<a name="l00495"></a>00495         <a class="code" href="../../dd/dda/interface_8c.html#a02d9f599cc619a5ca1e7f59366710cc6">ui_set_but_val</a>(but, (<span class="keywordtype">double</span>)push);
<a name="l00496"></a>00496         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a07a8e4d9b0c2f42662cde3b0afd8dc07">ICONTOG</a> || but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#afe3554f948715ad756e7bfe418a0e92e">ICONTOGN</a>) <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(but);
<a name="l00497"></a>00497     }
<a name="l00498"></a>00498     
<a name="l00499"></a>00499     <span class="comment">/* end local hack... */</span>
<a name="l00500"></a>00500     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa21a5ba3b14585362d65acd0ae14f7bc">BUT_TOGDUAL</a> &amp;&amp; data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5ad3e69623bec2807b82452914f8bb6d">togdual</a>) {
<a name="l00501"></a>00501         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e995a6658324bda3058970ce4df74b6">pointype</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#ae9a425bb2981a9c2b17dec3f161dbbf7">SHO</a>)
<a name="l00502"></a>00502             but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> -= 2;
<a name="l00503"></a>00503         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e995a6658324bda3058970ce4df74b6">pointype</a> == <a class="code" href="../../d3/d22/seqeffects_8c.html#afeeffe52c8fd59db7c61cf8b02042dbf">INT</a>)
<a name="l00504"></a>00504             but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> -= 4;
<a name="l00505"></a>00505     }
<a name="l00506"></a>00506     
<a name="l00507"></a>00507     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">ui_apply_but_func</a>(C, but);
<a name="l00508"></a>00508 
<a name="l00509"></a>00509     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab5f3a2117af0d9856576ec5833302c5a">retval</a>;
<a name="l00510"></a>00510     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a> = 1;
<a name="l00511"></a>00511 }
<a name="l00512"></a>00512 
<a name="l00513"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a23cba85044dfb1e46551a6818db17823">00513</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a23cba85044dfb1e46551a6818db17823">ui_apply_but_ROW</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l00514"></a>00514 {
<a name="l00515"></a>00515     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *bt;
<a name="l00516"></a>00516     
<a name="l00517"></a>00517     <a class="code" href="../../dd/dda/interface_8c.html#a02d9f599cc619a5ca1e7f59366710cc6">ui_set_but_val</a>(but, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a486ce10c3e1b4e1dee682ab18debc89d">hardmax</a>);
<a name="l00518"></a>00518     
<a name="l00519"></a>00519     <span class="comment">/* states of other row buttons */</span>
<a name="l00520"></a>00520     <span class="keywordflow">for</span> (bt = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a844299999568743bc189fcb02847e9e6">buttons</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; bt; bt = bt-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>)
<a name="l00521"></a>00521         <span class="keywordflow">if</span> (bt != but &amp;&amp; bt-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> == but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> &amp;&amp; <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(bt-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../dd/d8b/intern_2opennl_2superlu_2util_8h.html#a4d92d07523ba751afadecd63d3479e30abf470e461303b909bf0dc58084ebafa0">ROW</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a863e81437d873ffd4c9f4b31f624fbae">LISTROW</a>))
<a name="l00522"></a>00522             <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(bt);
<a name="l00523"></a>00523     
<a name="l00524"></a>00524     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">ui_apply_but_func</a>(C, but);
<a name="l00525"></a>00525 
<a name="l00526"></a>00526     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab5f3a2117af0d9856576ec5833302c5a">retval</a>;
<a name="l00527"></a>00527     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a> = 1;
<a name="l00528"></a>00528 }
<a name="l00529"></a>00529 
<a name="l00530"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad3cb830c545c8de5a851d820a6780427">00530</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad3cb830c545c8de5a851d820a6780427">ui_apply_but_TEX</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l00531"></a>00531 {
<a name="l00532"></a>00532     <span class="keywordflow">if</span> (!data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>)
<a name="l00533"></a>00533         <span class="keywordflow">return</span>;
<a name="l00534"></a>00534 
<a name="l00535"></a>00535     <a class="code" href="../../dd/dda/interface_8c.html#a2ff369f54c9aa7f40d55c17751c57cde">ui_set_but_string</a>(C, but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>);
<a name="l00536"></a>00536     <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(but);
<a name="l00537"></a>00537 
<a name="l00538"></a>00538     <span class="comment">/* give butfunc the original text too */</span>
<a name="l00539"></a>00539     <span class="comment">/* feature used for bone renaming, channels, etc */</span>
<a name="l00540"></a>00540     <span class="comment">/* afterfunc frees origstr */</span>
<a name="l00541"></a>00541     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1eefed002de71abeb0358656e8eb68e7">rename_orig</a> = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af007846eca2f6739b5f5d6305db6d2ca">origstr</a>;
<a name="l00542"></a>00542     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af007846eca2f6739b5f5d6305db6d2ca">origstr</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00543"></a>00543     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">ui_apply_but_func</a>(C, but);
<a name="l00544"></a>00544 
<a name="l00545"></a>00545     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab5f3a2117af0d9856576ec5833302c5a">retval</a>;
<a name="l00546"></a>00546     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a> = 1;
<a name="l00547"></a>00547 }
<a name="l00548"></a>00548 
<a name="l00549"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a73639aa3d0f2adf1e365866c55d659d7">00549</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a73639aa3d0f2adf1e365866c55d659d7">ui_apply_but_NUM</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l00550"></a>00550 {
<a name="l00551"></a>00551     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>) {
<a name="l00552"></a>00552         <span class="keywordflow">if</span> (<a class="code" href="../../dd/dda/interface_8c.html#a2ff369f54c9aa7f40d55c17751c57cde">ui_set_but_string</a>(C, but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>)) {
<a name="l00553"></a>00553             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = <a class="code" href="../../dd/dda/interface_8c.html#acbe9b206aab37f6c325e7107c33c0cb6">ui_get_but_val</a>(but);
<a name="l00554"></a>00554         }
<a name="l00555"></a>00555         <span class="keywordflow">else</span> {
<a name="l00556"></a>00556             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l00557"></a>00557             <span class="keywordflow">return</span>;
<a name="l00558"></a>00558         }
<a name="l00559"></a>00559     }
<a name="l00560"></a>00560     <span class="keywordflow">else</span>
<a name="l00561"></a>00561         <a class="code" href="../../dd/dda/interface_8c.html#a02d9f599cc619a5ca1e7f59366710cc6">ui_set_but_val</a>(but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a>);
<a name="l00562"></a>00562 
<a name="l00563"></a>00563     <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(but);
<a name="l00564"></a>00564     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">ui_apply_but_func</a>(C, but);
<a name="l00565"></a>00565 
<a name="l00566"></a>00566     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab5f3a2117af0d9856576ec5833302c5a">retval</a>;
<a name="l00567"></a>00567     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a> = 1;
<a name="l00568"></a>00568 }
<a name="l00569"></a>00569 
<a name="l00570"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a20a568f6ede356a1fe96cdb92efc7b97">00570</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a20a568f6ede356a1fe96cdb92efc7b97">ui_apply_but_TOG3</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l00571"></a>00571 { 
<a name="l00572"></a>00572     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e995a6658324bda3058970ce4df74b6">pointype</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#ae9a425bb2981a9c2b17dec3f161dbbf7">SHO</a>) {
<a name="l00573"></a>00573         <span class="keywordtype">short</span> *sp = (<span class="keywordtype">short</span> *)but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>;
<a name="l00574"></a>00574         
<a name="l00575"></a>00575         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a2e1b711f5a6c410be2735960a4037472">BTST</a>(sp[1], but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7a4f7157b860db64cc0c798f2dc7e670">bitnr</a>)) {
<a name="l00576"></a>00576             sp[1] = <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a8ff39b905184e3fcfb664a866d48bb6a">BCLR</a>(sp[1], but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7a4f7157b860db64cc0c798f2dc7e670">bitnr</a>);
<a name="l00577"></a>00577             sp[0] = <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a8ff39b905184e3fcfb664a866d48bb6a">BCLR</a>(sp[0], but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7a4f7157b860db64cc0c798f2dc7e670">bitnr</a>);
<a name="l00578"></a>00578         }
<a name="l00579"></a>00579         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a2e1b711f5a6c410be2735960a4037472">BTST</a>(sp[0], but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7a4f7157b860db64cc0c798f2dc7e670">bitnr</a>)) {
<a name="l00580"></a>00580             sp[1] = <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a7126793c8bd5020f45ed9fe2ec323a23">BSET</a>(sp[1], but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7a4f7157b860db64cc0c798f2dc7e670">bitnr</a>);
<a name="l00581"></a>00581         }
<a name="l00582"></a>00582         <span class="keywordflow">else</span> {
<a name="l00583"></a>00583             sp[0] = <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a7126793c8bd5020f45ed9fe2ec323a23">BSET</a>(sp[0], but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7a4f7157b860db64cc0c798f2dc7e670">bitnr</a>);
<a name="l00584"></a>00584         }
<a name="l00585"></a>00585     }
<a name="l00586"></a>00586     <span class="keywordflow">else</span> {
<a name="l00587"></a>00587         <span class="keywordflow">if</span> (<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a2e1b711f5a6c410be2735960a4037472">BTST</a>(*(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> + 2), but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7a4f7157b860db64cc0c798f2dc7e670">bitnr</a>)) {
<a name="l00588"></a>00588             *(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> + 2) = <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a8ff39b905184e3fcfb664a866d48bb6a">BCLR</a>(*(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> + 2), but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7a4f7157b860db64cc0c798f2dc7e670">bitnr</a>);
<a name="l00589"></a>00589             *(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>) = <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a8ff39b905184e3fcfb664a866d48bb6a">BCLR</a>(*(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>), but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7a4f7157b860db64cc0c798f2dc7e670">bitnr</a>);
<a name="l00590"></a>00590         }
<a name="l00591"></a>00591         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a2e1b711f5a6c410be2735960a4037472">BTST</a>(*(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>), but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7a4f7157b860db64cc0c798f2dc7e670">bitnr</a>)) {
<a name="l00592"></a>00592             *(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> + 2) = <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a7126793c8bd5020f45ed9fe2ec323a23">BSET</a>(*(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> + 2), but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7a4f7157b860db64cc0c798f2dc7e670">bitnr</a>);
<a name="l00593"></a>00593         }
<a name="l00594"></a>00594         <span class="keywordflow">else</span> {
<a name="l00595"></a>00595             *(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>) = <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a7126793c8bd5020f45ed9fe2ec323a23">BSET</a>(*(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>), but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7a4f7157b860db64cc0c798f2dc7e670">bitnr</a>);
<a name="l00596"></a>00596         }
<a name="l00597"></a>00597     }
<a name="l00598"></a>00598     
<a name="l00599"></a>00599     <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(but);
<a name="l00600"></a>00600     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">ui_apply_but_func</a>(C, but);
<a name="l00601"></a>00601     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab5f3a2117af0d9856576ec5833302c5a">retval</a>;
<a name="l00602"></a>00602     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a> = 1;
<a name="l00603"></a>00603 }
<a name="l00604"></a>00604 
<a name="l00605"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8ac66392af128e80f78ce36c80d36d19">00605</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8ac66392af128e80f78ce36c80d36d19">ui_apply_but_VEC</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l00606"></a>00606 {
<a name="l00607"></a>00607     <a class="code" href="../../dd/dda/interface_8c.html#a305c3c1bfb22a3e27b3461ff5655b214">ui_set_but_vectorf</a>(but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>);
<a name="l00608"></a>00608     <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(but);
<a name="l00609"></a>00609     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">ui_apply_but_func</a>(C, but);
<a name="l00610"></a>00610 
<a name="l00611"></a>00611     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab5f3a2117af0d9856576ec5833302c5a">retval</a>;
<a name="l00612"></a>00612     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a> = 1;
<a name="l00613"></a>00613 }
<a name="l00614"></a>00614 
<a name="l00615"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a87b2192bf6328cc033758450a98cc218">00615</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a87b2192bf6328cc033758450a98cc218">ui_apply_but_COLORBAND</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l00616"></a>00616 {
<a name="l00617"></a>00617     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">ui_apply_but_func</a>(C, but);
<a name="l00618"></a>00618     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab5f3a2117af0d9856576ec5833302c5a">retval</a>;
<a name="l00619"></a>00619     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a> = 1;
<a name="l00620"></a>00620 }
<a name="l00621"></a>00621 
<a name="l00622"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6094131e50edb166dbc39b73ad2b2106">00622</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6094131e50edb166dbc39b73ad2b2106">ui_apply_but_CURVE</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l00623"></a>00623 {
<a name="l00624"></a>00624     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">ui_apply_but_func</a>(C, but);
<a name="l00625"></a>00625     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab5f3a2117af0d9856576ec5833302c5a">retval</a>;
<a name="l00626"></a>00626     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a> = 1;
<a name="l00627"></a>00627 }
<a name="l00628"></a>00628 
<a name="l00629"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a47b5db7938a9d47599a737f1633ac89b">00629</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a47b5db7938a9d47599a737f1633ac89b">ui_apply_but_IDPOIN</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l00630"></a>00630 {
<a name="l00631"></a>00631     <a class="code" href="../../dd/dda/interface_8c.html#a2ff369f54c9aa7f40d55c17751c57cde">ui_set_but_string</a>(C, but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>);
<a name="l00632"></a>00632     <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(but);
<a name="l00633"></a>00633     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">ui_apply_but_func</a>(C, but);
<a name="l00634"></a>00634     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab5f3a2117af0d9856576ec5833302c5a">retval</a>;
<a name="l00635"></a>00635     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a> = 1;
<a name="l00636"></a>00636 }
<a name="l00637"></a>00637 
<a name="l00638"></a>00638 <span class="preprocessor">#ifdef WITH_INTERNATIONAL</span>
<a name="l00639"></a>00639 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span> ui_apply_but_CHARTAB(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l00640"></a>00640 {
<a name="l00641"></a>00641     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">ui_apply_but_func</a>(C, but);
<a name="l00642"></a>00642     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab5f3a2117af0d9856576ec5833302c5a">retval</a>;
<a name="l00643"></a>00643     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a> = 1;
<a name="l00644"></a>00644 }
<a name="l00645"></a>00645 <span class="preprocessor">#endif</span>
<a name="l00646"></a>00646 <span class="preprocessor"></span>
<a name="l00647"></a>00647 <span class="comment">/* ****************** drag drop code *********************** */</span>
<a name="l00648"></a>00648 
<a name="l00649"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a43d46273c2380ba298d59377b5f8b46f">00649</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a43d46273c2380ba298d59377b5f8b46f">ui_but_mouse_inside_icon</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l00650"></a>00650 {
<a name="l00651"></a>00651     <a class="code" href="../../d0/d28/structrcti.html">rcti</a> rect;
<a name="l00652"></a>00652     <span class="keywordtype">int</span> x = <span class="keyword">event</span>-&gt;x, y = <span class="keyword">event</span>-&gt;y;
<a name="l00653"></a>00653     
<a name="l00654"></a>00654     <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(ar, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>, &amp;x, &amp;y);
<a name="l00655"></a>00655     
<a name="l00656"></a>00656     rect.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>; rect.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a>;
<a name="l00657"></a>00657     rect.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>; rect.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abbb172bca1cfaa5d7538af548f1a1666">y2</a>;
<a name="l00658"></a>00658     
<a name="l00659"></a>00659     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab7c0b6d8a692385d1c2618eaa4da9572">imb</a>) ;  <span class="comment">/* use button size itself */</span>
<a name="l00660"></a>00660     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#ae7e246c45ab949219c4497c2ba1b6763">UI_ICON_LEFT</a>) {
<a name="l00661"></a>00661         rect.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> = rect.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> + (rect.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> - rect.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>);
<a name="l00662"></a>00662     }
<a name="l00663"></a>00663     <span class="keywordflow">else</span> {
<a name="l00664"></a>00664         <span class="keywordtype">int</span> delta = (rect.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> - rect.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>) - (rect.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> - rect.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>);
<a name="l00665"></a>00665         rect.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> += delta / 2;
<a name="l00666"></a>00666         rect.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> -= delta / 2;
<a name="l00667"></a>00667     }
<a name="l00668"></a>00668     
<a name="l00669"></a>00669     <span class="keywordflow">return</span> <a class="code" href="../../d5/d44/BLI__rect_8h.html#a1242dd13fb888a0146765107474fffb4">BLI_in_rcti</a>(&amp;rect, x, y);
<a name="l00670"></a>00670 }
<a name="l00671"></a>00671 
<a name="l00672"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aaadc9c0d1e734e39a2dae25bfb4866ee">00672</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aaadc9c0d1e734e39a2dae25bfb4866ee">ui_but_start_drag</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l00673"></a>00673 {
<a name="l00674"></a>00674     <span class="comment">/* prevent other WM gestures to start while we try to drag */</span>
<a name="l00675"></a>00675     <a class="code" href="../../da/d03/wm__gesture_8c.html#ada811555959c1d3e782dc079af55ecbe">WM_gestures_remove</a>(C);
<a name="l00676"></a>00676 
<a name="l00677"></a>00677     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> - event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>) + <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a> - event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>) &gt; <a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.dragthreshold) {
<a name="l00678"></a>00678         <a class="code" href="../../d2/d7a/structwmDrag.html">wmDrag</a> *drag;
<a name="l00679"></a>00679         
<a name="l00680"></a>00680         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l00681"></a>00681         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l00682"></a>00682         
<a name="l00683"></a>00683         drag = <a class="code" href="../../db/df3/wm__dragdrop_8c.html#ad6ca693156e46102f73b678943a76a94">WM_event_start_drag</a>(C, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abb0eba9aee4e0fc4169591b35fabddf8">icon</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ad06fdeb11a0cc6f6fc30a2fc6318bf23">dragtype</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23e894de3d96a5264d22687ff985e272">dragpoin</a>, <a class="code" href="../../dd/dda/interface_8c.html#acbe9b206aab37f6c325e7107c33c0cb6">ui_get_but_val</a>(but));
<a name="l00684"></a>00684         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab7c0b6d8a692385d1c2618eaa4da9572">imb</a>)
<a name="l00685"></a>00685             <a class="code" href="../../db/df3/wm__dragdrop_8c.html#af8cc8b34814de24771412890511151a6">WM_event_drag_image</a>(drag, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab7c0b6d8a692385d1c2618eaa4da9572">imb</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#af2405080057e4b15ce4466d6e23c2384">imb_scale</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abbb172bca1cfaa5d7538af548f1a1666">y2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>);
<a name="l00686"></a>00686         <span class="keywordflow">return</span> 1;
<a name="l00687"></a>00687     }
<a name="l00688"></a>00688     
<a name="l00689"></a>00689     <span class="keywordflow">return</span> 0;
<a name="l00690"></a>00690 }
<a name="l00691"></a>00691 
<a name="l00692"></a>00692 <span class="comment">/* ********************** linklines *********************** */</span>
<a name="l00693"></a>00693 
<a name="l00694"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad9339dc7fa366b2b11795d5fba6b75ad">00694</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad9339dc7fa366b2b11795d5fba6b75ad">ui_delete_active_linkline</a>(<a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block)
<a name="l00695"></a>00695 {
<a name="l00696"></a>00696     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l00697"></a>00697     <a class="code" href="../../d0/d14/structuiLink.html">uiLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l00698"></a>00698     <a class="code" href="../../d5/d5f/structuiLinkLine.html">uiLinkLine</a> *line, *nline;
<a name="l00699"></a>00699     <span class="keywordtype">int</span> a, b;
<a name="l00700"></a>00700     
<a name="l00701"></a>00701     but = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a844299999568743bc189fcb02847e9e6">buttons</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00702"></a>00702     <span class="keywordflow">while</span> (but) {
<a name="l00703"></a>00703         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a32298be536f02aa8bbde57c0c970124e">LINK</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6cd87ee46397974b005c6c22ae5d5712">link</a>) {
<a name="l00704"></a>00704             line = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6cd87ee46397974b005c6c22ae5d5712">link</a>-&gt;<a class="code" href="../../d0/d14/structuiLink.html#abdf23cf13517b878cf4bd2d8df589c40">lines</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00705"></a>00705             <span class="keywordflow">while</span> (line) {
<a name="l00706"></a>00706                 
<a name="l00707"></a>00707                 nline = line-&gt;<a class="code" href="../../d5/d5f/structuiLinkLine.html#af85a49093e65b25474bd13170bb3614d">next</a>;
<a name="l00708"></a>00708                 
<a name="l00709"></a>00709                 <span class="keywordflow">if</span> (line-&gt;<a class="code" href="../../d5/d5f/structuiLinkLine.html#a51a7ffe1bfb7ec219705462754812cec">flag</a> &amp; <a class="code" href="../../d1/d2f/interface__intern_8h.html#ada5088cd71649979ef58a9b21e0420cb">UI_SELECT</a>) {
<a name="l00710"></a>00710                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6cd87ee46397974b005c6c22ae5d5712">link</a>-&gt;<a class="code" href="../../d0/d14/structuiLink.html#abdf23cf13517b878cf4bd2d8df589c40">lines</a>, line);
<a name="l00711"></a>00711                     
<a name="l00712"></a>00712                     link = line-&gt;<a class="code" href="../../d5/d5f/structuiLinkLine.html#a13813c400b7daf8ef05f20800f6460cc">from</a>-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6cd87ee46397974b005c6c22ae5d5712">link</a>;
<a name="l00713"></a>00713                     
<a name="l00714"></a>00714                     <span class="comment">/* are there more pointers allowed? */</span>
<a name="l00715"></a>00715                     <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#a67bac0d698026aed25068e60d3ff4838">ppoin</a>) {
<a name="l00716"></a>00716                         
<a name="l00717"></a>00717                         <span class="keywordflow">if</span> (*(link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#aa774755d5f3c4026a0673e75195b6e56">totlink</a>) == 1) {
<a name="l00718"></a>00718                             *(link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#aa774755d5f3c4026a0673e75195b6e56">totlink</a>) = 0;
<a name="l00719"></a>00719                             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(*(link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#a67bac0d698026aed25068e60d3ff4838">ppoin</a>));
<a name="l00720"></a>00720                             *(link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#a67bac0d698026aed25068e60d3ff4838">ppoin</a>) = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00721"></a>00721                         }
<a name="l00722"></a>00722                         <span class="keywordflow">else</span> {
<a name="l00723"></a>00723                             b = 0;
<a name="l00724"></a>00724                             <span class="keywordflow">for</span> (a = 0; a &lt; (*(link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#aa774755d5f3c4026a0673e75195b6e56">totlink</a>)); a++) {
<a name="l00725"></a>00725                                 
<a name="l00726"></a>00726                                 <span class="keywordflow">if</span> ( (*(link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#a67bac0d698026aed25068e60d3ff4838">ppoin</a>))[a] != line-&gt;<a class="code" href="../../d5/d5f/structuiLinkLine.html#ae7763942b26dc1f18755e5a1182b5e56">to</a>-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>) {
<a name="l00727"></a>00727                                     (*(link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#a67bac0d698026aed25068e60d3ff4838">ppoin</a>))[b] = (*(link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#a67bac0d698026aed25068e60d3ff4838">ppoin</a>))[a];
<a name="l00728"></a>00728                                     b++;
<a name="l00729"></a>00729                                 }
<a name="l00730"></a>00730                             }   
<a name="l00731"></a>00731                             (*(link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#aa774755d5f3c4026a0673e75195b6e56">totlink</a>))--;
<a name="l00732"></a>00732                         }
<a name="l00733"></a>00733                     }
<a name="l00734"></a>00734                     <span class="keywordflow">else</span> {
<a name="l00735"></a>00735                         *(link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#a63563dd34522a935f6b2d412bf1b7228">poin</a>) = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00736"></a>00736                     }
<a name="l00737"></a>00737                     
<a name="l00738"></a>00738                     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(line);
<a name="l00739"></a>00739                 }
<a name="l00740"></a>00740                 line = nline;
<a name="l00741"></a>00741             }
<a name="l00742"></a>00742         }
<a name="l00743"></a>00743         but = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>;
<a name="l00744"></a>00744     }
<a name="l00745"></a>00745 }
<a name="l00746"></a>00746 
<a name="l00747"></a>00747 
<a name="l00748"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3426f16d7cd9b16469c418921170c205">00748</a> <span class="keyword">static</span> <a class="code" href="../../d5/d5f/structuiLinkLine.html">uiLinkLine</a> *<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3426f16d7cd9b16469c418921170c205">ui_is_a_link</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *from, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *to)
<a name="l00749"></a>00749 {
<a name="l00750"></a>00750     <a class="code" href="../../d5/d5f/structuiLinkLine.html">uiLinkLine</a> *line;
<a name="l00751"></a>00751     <a class="code" href="../../d0/d14/structuiLink.html">uiLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l00752"></a>00752     
<a name="l00753"></a>00753     link = from-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6cd87ee46397974b005c6c22ae5d5712">link</a>;
<a name="l00754"></a>00754     <span class="keywordflow">if</span> (link) {
<a name="l00755"></a>00755         line = link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#abdf23cf13517b878cf4bd2d8df589c40">lines</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00756"></a>00756         <span class="keywordflow">while</span> (line) {
<a name="l00757"></a>00757             <span class="keywordflow">if</span> (line-&gt;<a class="code" href="../../d5/d5f/structuiLinkLine.html#a13813c400b7daf8ef05f20800f6460cc">from</a> == from &amp;&amp; line-&gt;<a class="code" href="../../d5/d5f/structuiLinkLine.html#ae7763942b26dc1f18755e5a1182b5e56">to</a> == to) <span class="keywordflow">return</span> line;
<a name="l00758"></a>00758             line = line-&gt;<a class="code" href="../../d5/d5f/structuiLinkLine.html#af85a49093e65b25474bd13170bb3614d">next</a>;
<a name="l00759"></a>00759         }
<a name="l00760"></a>00760     }
<a name="l00761"></a>00761     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00762"></a>00762 }
<a name="l00763"></a>00763 
<a name="l00764"></a>00764 <span class="comment">/* XXX BAD BAD HACK, fixme later **************** */</span>
<a name="l00765"></a>00765 <span class="comment">/* Try to add an AND Controller between the sensor and the actuator logic bricks and to connect them all */</span>
<a name="l00766"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a053dc4e6a2757c436a69ab3fb56ea2d7">00766</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a053dc4e6a2757c436a69ab3fb56ea2d7">ui_add_smart_controller</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *from, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *to)
<a name="l00767"></a>00767 {
<a name="l00768"></a>00768     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00769"></a>00769     <a class="code" href="../../db/d09/structbSensor.html">bSensor</a> *sens_iter;
<a name="l00770"></a>00770     <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *act_to, *act_iter;
<a name="l00771"></a>00771     <a class="code" href="../../dd/d82/structbController.html">bController</a> *cont;
<a name="l00772"></a>00772     <a class="code" href="../../dd/d82/structbController.html">bController</a> ***sens_from_links;
<a name="l00773"></a>00773     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *tmp_but;
<a name="l00774"></a>00774 
<a name="l00775"></a>00775     <a class="code" href="../../d0/d14/structuiLink.html">uiLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a> = from-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6cd87ee46397974b005c6c22ae5d5712">link</a>;
<a name="l00776"></a>00776 
<a name="l00777"></a>00777     <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#a67bac0d698026aed25068e60d3ff4838">ppoin</a>)
<a name="l00778"></a>00778         sens_from_links = (<a class="code" href="../../dd/d82/structbController.html">bController</a> ***)(link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#a67bac0d698026aed25068e60d3ff4838">ppoin</a>);
<a name="l00779"></a>00779     <span class="keywordflow">else</span> <span class="keywordflow">return</span>;
<a name="l00780"></a>00780 
<a name="l00781"></a>00781     act_to = (<a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *)(to-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>);
<a name="l00782"></a>00782 
<a name="l00783"></a>00783     <span class="comment">/* (1) get the object */</span>
<a name="l00784"></a>00784     <a class="code" href="../../df/d01/BKE__context_8h.html#a63ffcaf5af72270fb66c773139bdedb2">CTX_DATA_BEGIN</a>(C, <a class="code" href="../../de/de7/structObject.html">Object</a> *, ob_iter, selected_editable_objects) {
<a name="l00785"></a>00785         <span class="keywordflow">for</span> (sens_iter = ob_iter-&gt;sensors.first; sens_iter; sens_iter = sens_iter-&gt;<a class="code" href="../../db/d09/structbSensor.html#a844da30cb7517bfebab4ec4e960e4ef1">next</a>)
<a name="l00786"></a>00786         {
<a name="l00787"></a>00787             <span class="keywordflow">if</span> (&amp;(sens_iter-&gt;<a class="code" href="../../db/d09/structbSensor.html#a2ddf48bee4a768a2232ed032f5c2226a">links</a>) == sens_from_links) {
<a name="l00788"></a>00788                 ob = ob_iter;
<a name="l00789"></a>00789                 <span class="keywordflow">break</span>;
<a name="l00790"></a>00790             }
<a name="l00791"></a>00791         }
<a name="l00792"></a>00792         <span class="keywordflow">if</span> (ob) <span class="keywordflow">break</span>;
<a name="l00793"></a>00793     } <a class="code" href="../../df/d01/BKE__context_8h.html#af19e54c354c69aacc4c6f2e2fcafde0f">CTX_DATA_END</a>;
<a name="l00794"></a>00794 
<a name="l00795"></a>00795     <span class="keywordflow">if</span> (!ob) <span class="keywordflow">return</span>;
<a name="l00796"></a>00796 
<a name="l00797"></a>00797     <span class="comment">/* (2) check if the sensor and the actuator are from the same object */</span>
<a name="l00798"></a>00798     <span class="keywordflow">for</span> (act_iter = ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; act_iter; act_iter = (<a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *)act_iter-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#ae77790d6a497010e1a250dcbc94e92c5">next</a>) {
<a name="l00799"></a>00799         <span class="keywordflow">if</span> (act_iter == act_to)
<a name="l00800"></a>00800             <span class="keywordflow">break</span>;
<a name="l00801"></a>00801     }
<a name="l00802"></a>00802 
<a name="l00803"></a>00803     <span class="comment">// only works if the sensor and the actuator are from the same object</span>
<a name="l00804"></a>00804     <span class="keywordflow">if</span> (!act_iter) <span class="keywordflow">return</span>;
<a name="l00805"></a>00805 
<a name="l00806"></a>00806     <span class="comment">/* (3) add a new controller */</span>
<a name="l00807"></a>00807     <span class="keywordflow">if</span> (<a class="code" href="../../df/db0/wm__event__system_8c.html#a0208cd65e2ce6a150f2653214cfc57dd">WM_operator_name_call</a>(C, <span class="stringliteral">&quot;LOGIC_OT_controller_add&quot;</span>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39ad2fa38d3cd3b0844e4a1b33bbf5f918c">WM_OP_EXEC_DEFAULT</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp; <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>) {
<a name="l00808"></a>00808         cont = (<a class="code" href="../../dd/d82/structbController.html">bController</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#ae2499a91d26d9dc8829a0505f6008066">controllers</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>;
<a name="l00809"></a>00809 
<a name="l00810"></a>00810         <span class="comment">/* (4) link the sensor-&gt;controller-&gt;actuator */</span>
<a name="l00811"></a>00811         tmp_but = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a>), <span class="stringliteral">&quot;uiBut&quot;</span>);
<a name="l00812"></a>00812         <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa2ae64a8c4f54c2018ecb6497ea5ccb9">uiSetButLink</a>(tmp_but, (<span class="keywordtype">void</span> **)&amp;cont, (<span class="keywordtype">void</span> ***)&amp;(cont-&gt;links), &amp;(cont-&gt;totlinks), from-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6cd87ee46397974b005c6c22ae5d5712">link</a>-&gt;<a class="code" href="../../d0/d14/structuiLink.html#a48af38520beac3506d5057c9b7468ea2">tocode</a>, (<span class="keywordtype">int</span>)to-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9ecd1237ea2c0f8553919952c0e06578">hardmin</a>);
<a name="l00813"></a>00813         tmp_but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9ecd1237ea2c0f8553919952c0e06578">hardmin</a> = from-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6cd87ee46397974b005c6c22ae5d5712">link</a>-&gt;<a class="code" href="../../d0/d14/structuiLink.html#a48af38520beac3506d5057c9b7468ea2">tocode</a>;
<a name="l00814"></a>00814         tmp_but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> = (<span class="keywordtype">char</span> *)cont;
<a name="l00815"></a>00815 
<a name="l00816"></a>00816         tmp_but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a26966d6f3a8af2b1ef515852d322b2b0">INLINK</a>;
<a name="l00817"></a>00817         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#abbf8f9cfbf1e35968e63b72cd2004109">ui_add_link</a>(C, from, tmp_but);
<a name="l00818"></a>00818 
<a name="l00819"></a>00819         tmp_but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a32298be536f02aa8bbde57c0c970124e">LINK</a>;
<a name="l00820"></a>00820         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#abbf8f9cfbf1e35968e63b72cd2004109">ui_add_link</a>(C, tmp_but, to);
<a name="l00821"></a>00821 
<a name="l00822"></a>00822         <span class="comment">/* (5) garbage collection */</span>
<a name="l00823"></a>00823         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(tmp_but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6cd87ee46397974b005c6c22ae5d5712">link</a>);
<a name="l00824"></a>00824         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(tmp_but);
<a name="l00825"></a>00825     }
<a name="l00826"></a>00826 }
<a name="l00827"></a>00827 
<a name="l00828"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#abbf8f9cfbf1e35968e63b72cd2004109">00828</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#abbf8f9cfbf1e35968e63b72cd2004109">ui_add_link</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *from, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *to)
<a name="l00829"></a>00829 {
<a name="l00830"></a>00830     <span class="comment">/* in &#39;from&#39; we have to add a link to &#39;to&#39; */</span>
<a name="l00831"></a>00831     <a class="code" href="../../d0/d14/structuiLink.html">uiLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l00832"></a>00832     <a class="code" href="../../d5/d5f/structuiLinkLine.html">uiLinkLine</a> *line;
<a name="l00833"></a>00833     <span class="keywordtype">void</span> **oldppoin;
<a name="l00834"></a>00834     <span class="keywordtype">int</span> a;
<a name="l00835"></a>00835     
<a name="l00836"></a>00836     <span class="keywordflow">if</span> ( (line = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3426f16d7cd9b16469c418921170c205">ui_is_a_link</a>(from, to)) ) {
<a name="l00837"></a>00837         line-&gt;<a class="code" href="../../d5/d5f/structuiLinkLine.html#a51a7ffe1bfb7ec219705462754812cec">flag</a> |= <a class="code" href="../../d1/d2f/interface__intern_8h.html#ada5088cd71649979ef58a9b21e0420cb">UI_SELECT</a>;
<a name="l00838"></a>00838         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad9339dc7fa366b2b11795d5fba6b75ad">ui_delete_active_linkline</a>(from-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>);
<a name="l00839"></a>00839         <span class="keywordflow">return</span>;
<a name="l00840"></a>00840     }
<a name="l00841"></a>00841 
<a name="l00842"></a>00842     <span class="keywordflow">if</span> (from-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a26966d6f3a8af2b1ef515852d322b2b0">INLINK</a> &amp;&amp; to-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a26966d6f3a8af2b1ef515852d322b2b0">INLINK</a>) {
<a name="l00843"></a>00843         <span class="keywordflow">return</span>;
<a name="l00844"></a>00844     }
<a name="l00845"></a>00845     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (from-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a32298be536f02aa8bbde57c0c970124e">LINK</a> &amp;&amp; to-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a26966d6f3a8af2b1ef515852d322b2b0">INLINK</a>) {
<a name="l00846"></a>00846         <span class="keywordflow">if</span> (from-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6cd87ee46397974b005c6c22ae5d5712">link</a>-&gt;<a class="code" href="../../d0/d14/structuiLink.html#a48af38520beac3506d5057c9b7468ea2">tocode</a> != (<span class="keywordtype">int</span>)to-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9ecd1237ea2c0f8553919952c0e06578">hardmin</a>) {
<a name="l00847"></a>00847             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a053dc4e6a2757c436a69ab3fb56ea2d7">ui_add_smart_controller</a>(C, from, to);
<a name="l00848"></a>00848             <span class="keywordflow">return</span>;
<a name="l00849"></a>00849         }
<a name="l00850"></a>00850     }
<a name="l00851"></a>00851     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (from-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a26966d6f3a8af2b1ef515852d322b2b0">INLINK</a> &amp;&amp; to-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a32298be536f02aa8bbde57c0c970124e">LINK</a>) {
<a name="l00852"></a>00852         <span class="keywordflow">if</span> (to-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6cd87ee46397974b005c6c22ae5d5712">link</a>-&gt;<a class="code" href="../../d0/d14/structuiLink.html#a48af38520beac3506d5057c9b7468ea2">tocode</a> == (<span class="keywordtype">int</span>)from-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9ecd1237ea2c0f8553919952c0e06578">hardmin</a>) {
<a name="l00853"></a>00853             <span class="keywordflow">return</span>;
<a name="l00854"></a>00854         }
<a name="l00855"></a>00855     }
<a name="l00856"></a>00856     
<a name="l00857"></a>00857     link = from-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6cd87ee46397974b005c6c22ae5d5712">link</a>;
<a name="l00858"></a>00858     
<a name="l00859"></a>00859     <span class="comment">/* are there more pointers allowed? */</span>
<a name="l00860"></a>00860     <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#a67bac0d698026aed25068e60d3ff4838">ppoin</a>) {
<a name="l00861"></a>00861         oldppoin = *(link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#a67bac0d698026aed25068e60d3ff4838">ppoin</a>);
<a name="l00862"></a>00862         
<a name="l00863"></a>00863         (*(link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#aa774755d5f3c4026a0673e75195b6e56">totlink</a>))++;
<a name="l00864"></a>00864         *(link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#a67bac0d698026aed25068e60d3ff4838">ppoin</a>) = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(*(link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#aa774755d5f3c4026a0673e75195b6e56">totlink</a>) * <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *), <span class="stringliteral">&quot;new link&quot;</span>);
<a name="l00865"></a>00865         
<a name="l00866"></a>00866         <span class="keywordflow">for</span> (a = 0; a &lt; (*(link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#aa774755d5f3c4026a0673e75195b6e56">totlink</a>)) - 1; a++) {
<a name="l00867"></a>00867             (*(link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#a67bac0d698026aed25068e60d3ff4838">ppoin</a>))[a] = oldppoin[a];
<a name="l00868"></a>00868         }
<a name="l00869"></a>00869         (*(link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#a67bac0d698026aed25068e60d3ff4838">ppoin</a>))[a] = to-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>;
<a name="l00870"></a>00870         
<a name="l00871"></a>00871         <span class="keywordflow">if</span> (oldppoin) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(oldppoin);
<a name="l00872"></a>00872     }
<a name="l00873"></a>00873     <span class="keywordflow">else</span> {
<a name="l00874"></a>00874         *(link-&gt;<a class="code" href="../../d0/d14/structuiLink.html#a63563dd34522a935f6b2d412bf1b7228">poin</a>) = to-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>;
<a name="l00875"></a>00875     }
<a name="l00876"></a>00876     
<a name="l00877"></a>00877 }
<a name="l00878"></a>00878 
<a name="l00879"></a>00879 
<a name="l00880"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae966bbab2caf7275e750b760d44794f2">00880</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae966bbab2caf7275e750b760d44794f2">ui_apply_but_LINK</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l00881"></a>00881 {
<a name="l00882"></a>00882     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00883"></a>00883     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *bt;
<a name="l00884"></a>00884     
<a name="l00885"></a>00885     <span class="keywordflow">for</span> (bt = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a844299999568743bc189fcb02847e9e6">buttons</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; bt; bt = bt-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>) {
<a name="l00886"></a>00886         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a96d54676d1014fb5361f50b5adf8f322">ui_mouse_inside_button</a>(ar, bt, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa48225c4b95073ff22a02b16ee2ded87">linkto</a>[0] + ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa48225c4b95073ff22a02b16ee2ded87">linkto</a>[1] + ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>) )
<a name="l00887"></a>00887             <span class="keywordflow">break</span>;
<a name="l00888"></a>00888     }
<a name="l00889"></a>00889     <span class="keywordflow">if</span> (bt &amp;&amp; bt != but) {
<a name="l00890"></a>00890         <span class="keywordflow">if</span> (!<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(bt-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a32298be536f02aa8bbde57c0c970124e">LINK</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a26966d6f3a8af2b1ef515852d322b2b0">INLINK</a>) || !<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a32298be536f02aa8bbde57c0c970124e">LINK</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a26966d6f3a8af2b1ef515852d322b2b0">INLINK</a>))
<a name="l00891"></a>00891             <span class="keywordflow">return</span>;
<a name="l00892"></a>00892         
<a name="l00893"></a>00893         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a32298be536f02aa8bbde57c0c970124e">LINK</a>) <a class="code" href="../../d3/d9b/interface__handlers_8c.html#abbf8f9cfbf1e35968e63b72cd2004109">ui_add_link</a>(C, but, bt);
<a name="l00894"></a>00894         <span class="keywordflow">else</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#abbf8f9cfbf1e35968e63b72cd2004109">ui_add_link</a>(C, bt, but);
<a name="l00895"></a>00895 
<a name="l00896"></a>00896         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">ui_apply_but_func</a>(C, but);
<a name="l00897"></a>00897         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab5f3a2117af0d9856576ec5833302c5a">retval</a>;
<a name="l00898"></a>00898     }
<a name="l00899"></a>00899     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a> = 1;
<a name="l00900"></a>00900 }
<a name="l00901"></a>00901 
<a name="l00902"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a64c27a7f84d4659ab348f366bd0eb61d">00902</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a64c27a7f84d4659ab348f366bd0eb61d">ui_apply_but_IMAGE</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l00903"></a>00903 {
<a name="l00904"></a>00904     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">ui_apply_but_func</a>(C, but);
<a name="l00905"></a>00905     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab5f3a2117af0d9856576ec5833302c5a">retval</a>;
<a name="l00906"></a>00906     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a> = 1;
<a name="l00907"></a>00907 }
<a name="l00908"></a>00908 
<a name="l00909"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad00f8b222199c12cafbafdd55067407e">00909</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad00f8b222199c12cafbafdd55067407e">ui_apply_but_HISTOGRAM</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l00910"></a>00910 {
<a name="l00911"></a>00911     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">ui_apply_but_func</a>(C, but);
<a name="l00912"></a>00912     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab5f3a2117af0d9856576ec5833302c5a">retval</a>;
<a name="l00913"></a>00913     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a> = 1;
<a name="l00914"></a>00914 }
<a name="l00915"></a>00915 
<a name="l00916"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a4ec32f854996f274336934c286f90da8">00916</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a4ec32f854996f274336934c286f90da8">ui_apply_but_WAVEFORM</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l00917"></a>00917 {
<a name="l00918"></a>00918     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">ui_apply_but_func</a>(C, but);
<a name="l00919"></a>00919     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab5f3a2117af0d9856576ec5833302c5a">retval</a>;
<a name="l00920"></a>00920     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a> = 1;
<a name="l00921"></a>00921 }
<a name="l00922"></a>00922 
<a name="l00923"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a446943311ef0959b1ea1ccd46b9863d5">00923</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a446943311ef0959b1ea1ccd46b9863d5">ui_apply_but_TRACKPREVIEW</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l00924"></a>00924 {
<a name="l00925"></a>00925     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8169cd1b4fe2b452dc3e47e022b13c87">ui_apply_but_func</a>(C, but);
<a name="l00926"></a>00926     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab5f3a2117af0d9856576ec5833302c5a">retval</a>;
<a name="l00927"></a>00927     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a> = 1;
<a name="l00928"></a>00928 }
<a name="l00929"></a>00929 
<a name="l00930"></a>00930 
<a name="l00931"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a87504e0357211849ab7661ff46be2fef">00931</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a87504e0357211849ab7661ff46be2fef">ui_apply_button</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">int</span> interactive)
<a name="l00932"></a>00932 {
<a name="l00933"></a>00933     <span class="keywordtype">char</span> *editstr;
<a name="l00934"></a>00934     <span class="keywordtype">double</span> *editval;
<a name="l00935"></a>00935     <span class="keywordtype">float</span> *editvec;
<a name="l00936"></a>00936     <a class="code" href="../../d0/dc8/structColorBand.html">ColorBand</a> *editcoba;
<a name="l00937"></a>00937     <a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *editcumap;
<a name="l00938"></a>00938 
<a name="l00939"></a>00939     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a> = 0;
<a name="l00940"></a>00940 
<a name="l00941"></a>00941     <span class="comment">/* if we cancel and have not applied yet, there is nothing to do,</span>
<a name="l00942"></a>00942 <span class="comment">     * otherwise we have to restore the original value again */</span>
<a name="l00943"></a>00943     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a>) {
<a name="l00944"></a>00944         <span class="keywordflow">if</span> (!data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4b1adc47d7f2775dc16e94c8a4689699">applied</a>)
<a name="l00945"></a>00945             <span class="keywordflow">return</span>;
<a name="l00946"></a>00946 
<a name="l00947"></a>00947         <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>);
<a name="l00948"></a>00948         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a> = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af007846eca2f6739b5f5d6305db6d2ca">origstr</a>;
<a name="l00949"></a>00949         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af007846eca2f6739b5f5d6305db6d2ca">origstr</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00950"></a>00950         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a6e4b95019c68fe9e30440340115fe5ec">origvalue</a>;
<a name="l00951"></a>00951         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a6e4b95019c68fe9e30440340115fe5ec">origvalue</a> = 0.0;
<a name="l00952"></a>00952         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5ae96cbb3abbb1fcabf95027b029464c">origvec</a>);
<a name="l00953"></a>00953         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5ae96cbb3abbb1fcabf95027b029464c">origvec</a>[0] = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5ae96cbb3abbb1fcabf95027b029464c">origvec</a>[1] = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5ae96cbb3abbb1fcabf95027b029464c">origvec</a>[2] = 0.0f;
<a name="l00954"></a>00954     }
<a name="l00955"></a>00955     <span class="keywordflow">else</span> {
<a name="l00956"></a>00956         <span class="comment">/* we avoid applying interactive edits a second time</span>
<a name="l00957"></a>00957 <span class="comment">         * at the end with the appliedinteractive flag */</span>
<a name="l00958"></a>00958         <span class="keywordflow">if</span> (interactive)
<a name="l00959"></a>00959             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a46f30df9e212b50fa19cc2f34e50fb82">appliedinteractive</a> = 1;
<a name="l00960"></a>00960         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a46f30df9e212b50fa19cc2f34e50fb82">appliedinteractive</a>)
<a name="l00961"></a>00961             <span class="keywordflow">return</span>;
<a name="l00962"></a>00962     }
<a name="l00963"></a>00963 
<a name="l00964"></a>00964     <span class="comment">/* ensures we are writing actual values */</span>
<a name="l00965"></a>00965     editstr = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a2dc67a12dd52365c48fdc2460e8e7857">editstr</a>;
<a name="l00966"></a>00966     editval = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a3ecb7699098b8764b7587a680dd85e1a">editval</a>;
<a name="l00967"></a>00967     editvec = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a2273f07ffed872fc272ee74d2bc046e6">editvec</a>;
<a name="l00968"></a>00968     editcoba = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa10ebb6a93a76dd67b2ebf1722cfa8bc">editcoba</a>;
<a name="l00969"></a>00969     editcumap = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ad49fa037c1b45e3c5ae4675dbc57a66a">editcumap</a>;
<a name="l00970"></a>00970     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a2dc67a12dd52365c48fdc2460e8e7857">editstr</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00971"></a>00971     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a3ecb7699098b8764b7587a680dd85e1a">editval</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00972"></a>00972     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a2273f07ffed872fc272ee74d2bc046e6">editvec</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00973"></a>00973     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa10ebb6a93a76dd67b2ebf1722cfa8bc">editcoba</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00974"></a>00974     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ad49fa037c1b45e3c5ae4675dbc57a66a">editcumap</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00975"></a>00975 
<a name="l00976"></a>00976     <span class="comment">/* handle different types */</span>
<a name="l00977"></a>00977     <span class="keywordflow">switch</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>) {
<a name="l00978"></a>00978         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a02c336ab5ee16270de92af2f3f2cb5eb">BUT</a>:
<a name="l00979"></a>00979             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9323062f4708a7ee83e47b8e2ac9d0bb">ui_apply_but_BUT</a>(C, but, data);
<a name="l00980"></a>00980             <span class="keywordflow">break</span>;
<a name="l00981"></a>00981         <span class="keywordflow">case</span> <a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba24e799bd38fe08efb4756c63d8f78df9">TEX</a>:
<a name="l00982"></a>00982         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3a2c1c38a5465f6d46a2296e3ad09bbe">SEARCH_MENU</a>:
<a name="l00983"></a>00983             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad3cb830c545c8de5a851d820a6780427">ui_apply_but_TEX</a>(C, but, data);
<a name="l00984"></a>00984             <span class="keywordflow">break</span>;
<a name="l00985"></a>00985         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a4ea9f3034b08c53c14d9032798b60901">TOGBUT</a>: 
<a name="l00986"></a>00986         <span class="keywordflow">case</span> <a class="code" href="../../d9/dc4/plugin_8h.html#a2532bfdf10e1ca1685038b02ce0f3386">TOG</a>: 
<a name="l00987"></a>00987         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a59cc7c2157b515ed2c780bb6f7b44e27">TOGR</a>: 
<a name="l00988"></a>00988         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a07a8e4d9b0c2f42662cde3b0afd8dc07">ICONTOG</a>:
<a name="l00989"></a>00989         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#afe3554f948715ad756e7bfe418a0e92e">ICONTOGN</a>:
<a name="l00990"></a>00990         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a6b185cf808adc8c34bd90b87b6b45ff7">TOGN</a>:
<a name="l00991"></a>00991         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa21a5ba3b14585362d65acd0ae14f7bc">BUT_TOGDUAL</a>:
<a name="l00992"></a>00992         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a39d0de5f53bbf5622cd6af16d647fbe5">OPTION</a>:
<a name="l00993"></a>00993         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#ac6cd5ac67760662bb5dd35aaf7000117">OPTIONN</a>:
<a name="l00994"></a>00994             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#acca76c865cefe93e3eaea20ddab04543">ui_apply_but_TOG</a>(C, but, data);
<a name="l00995"></a>00995             <span class="keywordflow">break</span>;
<a name="l00996"></a>00996         <span class="keywordflow">case</span> <a class="code" href="../../dd/d8b/intern_2opennl_2superlu_2util_8h.html#a4d92d07523ba751afadecd63d3479e30abf470e461303b909bf0dc58084ebafa0">ROW</a>:
<a name="l00997"></a>00997         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a863e81437d873ffd4c9f4b31f624fbae">LISTROW</a>:
<a name="l00998"></a>00998             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a23cba85044dfb1e46551a6818db17823">ui_apply_but_ROW</a>(C, block, but, data);
<a name="l00999"></a>00999             <span class="keywordflow">break</span>;
<a name="l01000"></a>01000         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa8fa67309d5b49cdd294644ff290591e">SCROLL</a>:
<a name="l01001"></a>01001         <span class="keywordflow">case</span> <a class="code" href="../../d9/dc4/plugin_8h.html#aaf0952059602752258dccaa015d7b54a">NUM</a>:
<a name="l01002"></a>01002         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a53ab9b2f5a030a06d3a609f2aad1fde3">NUMABS</a>:
<a name="l01003"></a>01003         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a19d649cadf80f7b487a72cbf596b79bd">SLI</a>:
<a name="l01004"></a>01004         <span class="keywordflow">case</span> <a class="code" href="../../d9/dc4/plugin_8h.html#a14a9dde4adb789e686787aeff498bb10">NUMSLI</a>:
<a name="l01005"></a>01005             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a73639aa3d0f2adf1e365866c55d659d7">ui_apply_but_NUM</a>(C, but, data);
<a name="l01006"></a>01006             <span class="keywordflow">break</span>;
<a name="l01007"></a>01007         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a6cb451ada67e3dcb1d058adcd025b14c">HSVSLI</a>:
<a name="l01008"></a>01008             <span class="keywordflow">break</span>;
<a name="l01009"></a>01009         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3b2680140eea3e2f54cd0e3deae040b3">TOG3</a>:  
<a name="l01010"></a>01010             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a20a568f6ede356a1fe96cdb92efc7b97">ui_apply_but_TOG3</a>(C, but, data);
<a name="l01011"></a>01011             <span class="keywordflow">break</span>;
<a name="l01012"></a>01012         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad0d059e6a83d21bea4f4db1c9fbd240b">MENU</a>:
<a name="l01013"></a>01013         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#af6ad4ca5cd637c3ab6dad8114b8d3e75">ICONROW</a>:
<a name="l01014"></a>01014         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5975b2d368ff03c7359503587664fba5">ICONTEXTROW</a>:
<a name="l01015"></a>01015         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a52220397ecea855b3a99746e451426e1">BLOCK</a>:
<a name="l01016"></a>01016         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a917e2674b6708b555abe909f360b12e1">PULLDOWN</a>:
<a name="l01017"></a>01017             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6e65daad8f478cca9c17ea25d7e72657">ui_apply_but_BLOCK</a>(C, but, data);
<a name="l01018"></a>01018             <span class="keywordflow">break</span>;
<a name="l01019"></a>01019         <span class="keywordflow">case</span> <a class="code" href="../../dd/d8b/intern_2opennl_2superlu_2util_8h.html#a4d92d07523ba751afadecd63d3479e30a3e66f07732b51f2cb52e13d598f8abda">COL</a>:
<a name="l01020"></a>01020             <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a>)
<a name="l01021"></a>01021                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8ac66392af128e80f78ce36c80d36d19">ui_apply_but_VEC</a>(C, but, data);
<a name="l01022"></a>01022             <span class="keywordflow">else</span>
<a name="l01023"></a>01023                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6e65daad8f478cca9c17ea25d7e72657">ui_apply_but_BLOCK</a>(C, but, data);
<a name="l01024"></a>01024             <span class="keywordflow">break</span>;
<a name="l01025"></a>01025         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a7489385fb8eddb0eabd9fc4c3954e653">BUTM</a>:
<a name="l01026"></a>01026             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8cef0cbdcdf55845e8edeb48b2fc2085">ui_apply_but_BUTM</a>(C, but, data);
<a name="l01027"></a>01027             <span class="keywordflow">break</span>;
<a name="l01028"></a>01028         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8823a24e6af14c65bb48fed8e6d8e4ad">BUT_NORMAL</a>:
<a name="l01029"></a>01029         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#aaaed62f927be1bd36851e7a3008a35c2">HSVCUBE</a>:
<a name="l01030"></a>01030         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#af5b7a7238e8eaabdbec6a107c41f426a">HSVCIRCLE</a>:
<a name="l01031"></a>01031             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8ac66392af128e80f78ce36c80d36d19">ui_apply_but_VEC</a>(C, but, data);
<a name="l01032"></a>01032             <span class="keywordflow">break</span>;
<a name="l01033"></a>01033         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a84c5d75a8e1a067bb3def3f69049b22a">BUT_COLORBAND</a>:
<a name="l01034"></a>01034             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a87b2192bf6328cc033758450a98cc218">ui_apply_but_COLORBAND</a>(C, but, data);
<a name="l01035"></a>01035             <span class="keywordflow">break</span>;
<a name="l01036"></a>01036         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a55737ebfa3a2ec487e87544adbf7e457">BUT_CURVE</a>:
<a name="l01037"></a>01037             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6094131e50edb166dbc39b73ad2b2106">ui_apply_but_CURVE</a>(C, but, data);
<a name="l01038"></a>01038             <span class="keywordflow">break</span>;
<a name="l01039"></a>01039         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a69f2c191e2c4babdd9dc28b8fb4d8a68">IDPOIN</a>:
<a name="l01040"></a>01040             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a47b5db7938a9d47599a737f1633ac89b">ui_apply_but_IDPOIN</a>(C, but, data);
<a name="l01041"></a>01041             <span class="keywordflow">break</span>;
<a name="l01042"></a>01042 <span class="preprocessor">#ifdef WITH_INTERNATIONAL</span>
<a name="l01043"></a>01043 <span class="preprocessor"></span>        <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a7d7e8bdc1e410df600429cb3cf65817c">CHARTAB</a>:
<a name="l01044"></a>01044             ui_apply_but_CHARTAB(C, but, data);
<a name="l01045"></a>01045             <span class="keywordflow">break</span>;
<a name="l01046"></a>01046 <span class="preprocessor">#endif</span>
<a name="l01047"></a>01047 <span class="preprocessor"></span>        <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a43cd93236835951a99e53f9ec1716370">KEYEVT</a>:
<a name="l01048"></a>01048         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#ab7e4edf2ce3fe6174495825cf24fd8a7">HOTKEYEVT</a>:
<a name="l01049"></a>01049             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9323062f4708a7ee83e47b8e2ac9d0bb">ui_apply_but_BUT</a>(C, but, data);
<a name="l01050"></a>01050             <span class="keywordflow">break</span>;
<a name="l01051"></a>01051         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a32298be536f02aa8bbde57c0c970124e">LINK</a>:
<a name="l01052"></a>01052         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a26966d6f3a8af2b1ef515852d322b2b0">INLINK</a>:
<a name="l01053"></a>01053             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae966bbab2caf7275e750b760d44794f2">ui_apply_but_LINK</a>(C, but, data);
<a name="l01054"></a>01054             <span class="keywordflow">break</span>;
<a name="l01055"></a>01055         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa68a240a71e1a2a02b5d6a7a065e7b9e">BUT_IMAGE</a>: 
<a name="l01056"></a>01056             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a64c27a7f84d4659ab348f366bd0eb61d">ui_apply_but_IMAGE</a>(C, but, data);
<a name="l01057"></a>01057             <span class="keywordflow">break</span>;
<a name="l01058"></a>01058         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a602a54df54894f53ce53e1011a1c5515">HISTOGRAM</a>: 
<a name="l01059"></a>01059             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad00f8b222199c12cafbafdd55067407e">ui_apply_but_HISTOGRAM</a>(C, but, data);
<a name="l01060"></a>01060             <span class="keywordflow">break</span>;
<a name="l01061"></a>01061         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a0ebe5c598964d30fef9d41540637fc03">WAVEFORM</a>:
<a name="l01062"></a>01062             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a4ec32f854996f274336934c286f90da8">ui_apply_but_WAVEFORM</a>(C, but, data);
<a name="l01063"></a>01063             <span class="keywordflow">break</span>;
<a name="l01064"></a>01064         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad1c71f878b30e83247db31d5afe965ff">TRACKPREVIEW</a>:
<a name="l01065"></a>01065             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a446943311ef0959b1ea1ccd46b9863d5">ui_apply_but_TRACKPREVIEW</a>(C, but, data);
<a name="l01066"></a>01066             <span class="keywordflow">break</span>;
<a name="l01067"></a>01067         <span class="keywordflow">default</span>:
<a name="l01068"></a>01068             <span class="keywordflow">break</span>;
<a name="l01069"></a>01069     }
<a name="l01070"></a>01070 
<a name="l01071"></a>01071     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a2dc67a12dd52365c48fdc2460e8e7857">editstr</a> = editstr;
<a name="l01072"></a>01072     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a3ecb7699098b8764b7587a680dd85e1a">editval</a> = editval;
<a name="l01073"></a>01073     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a2273f07ffed872fc272ee74d2bc046e6">editvec</a> = editvec;
<a name="l01074"></a>01074     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa10ebb6a93a76dd67b2ebf1722cfa8bc">editcoba</a> = editcoba;
<a name="l01075"></a>01075     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ad49fa037c1b45e3c5ae4675dbc57a66a">editcumap</a> = editcumap;
<a name="l01076"></a>01076 }
<a name="l01077"></a>01077 
<a name="l01078"></a>01078 <span class="comment">/* ******************* drop event ********************  */</span>
<a name="l01079"></a>01079 
<a name="l01080"></a>01080 <span class="comment">/* only call if event type is EVT_DROP */</span>
<a name="l01081"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a4b01562b3a1c469c721c6f33a45e1b61">01081</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a4b01562b3a1c469c721c6f33a45e1b61">ui_but_drop</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l01082"></a>01082 {
<a name="l01083"></a>01083     <a class="code" href="../../d2/d7a/structwmDrag.html">wmDrag</a> *wmd;
<a name="l01084"></a>01084     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *drags = <span class="keyword">event</span>-&gt;customdata; <span class="comment">/* drop event type has listbase customdata by default */</span>
<a name="l01085"></a>01085     
<a name="l01086"></a>01086     <span class="keywordflow">for</span> (wmd = drags-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; wmd; wmd = wmd-&gt;<a class="code" href="../../d2/d7a/structwmDrag.html#aec954c8316604bf9e7f60df631fd93a1">next</a>) {
<a name="l01087"></a>01087         <span class="keywordflow">if</span> (wmd-&gt;<a class="code" href="../../d2/d7a/structwmDrag.html#aefc7fd61eecff37c03bab3cd263d2ba6">type</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#ad0eae6683bc53af417ed22031e5585fc">WM_DRAG_ID</a>) {
<a name="l01088"></a>01088             <span class="comment">/* align these types with UI_but_active_drop_name */</span>
<a name="l01089"></a>01089             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba24e799bd38fe08efb4756c63d8f78df9">TEX</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a69f2c191e2c4babdd9dc28b8fb4d8a68">IDPOIN</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3a2c1c38a5465f6d46a2296e3ad09bbe">SEARCH_MENU</a>)) {
<a name="l01090"></a>01090                 <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span> = (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)wmd-&gt;<a class="code" href="../../d2/d7a/structwmDrag.html#a48492d6af92a0461bbf5d5f2307e0e9d">poin</a>;
<a name="l01091"></a>01091                 
<a name="l01092"></a>01092                 <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {}
<a name="l01093"></a>01093                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">BUTTON_STATE_TEXT_EDITING</a>);
<a name="l01094"></a>01094                 <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>, id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a> + 2, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a56e112f7647dbb1fa6743ff86b71cdc5">maxlen</a>);
<a name="l01095"></a>01095                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l01096"></a>01096             }
<a name="l01097"></a>01097         }
<a name="l01098"></a>01098     }
<a name="l01099"></a>01099     
<a name="l01100"></a>01100 }
<a name="l01101"></a>01101 
<a name="l01102"></a>01102 <span class="comment">/* ******************* copy and paste ********************  */</span>
<a name="l01103"></a>01103 
<a name="l01104"></a>01104 <span class="comment">/* c = copy, v = paste */</span>
<a name="l01105"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a717fc8c3811b8db306f7f3fb80ad513e">01105</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a717fc8c3811b8db306f7f3fb80ad513e">ui_but_copy_paste</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">char</span> mode)
<a name="l01106"></a>01106 {
<a name="l01107"></a>01107     <span class="keyword">static</span> <a class="code" href="../../d0/dc8/structColorBand.html">ColorBand</a> but_copypaste_coba = {0};
<a name="l01108"></a>01108     <span class="keywordtype">char</span> buf[<a class="code" href="../../d8/d1e/UI__interface_8h.html#a827a90802798250dee1083bb41ab03c5">UI_MAX_DRAW_STR</a> + 1] = {0};
<a name="l01109"></a>01109 
<a name="l01110"></a>01110     <span class="keywordflow">if</span> (mode == <span class="charliteral">&#39;v&#39;</span> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a76d610ffa185d1b2ea9ba55077ec9bc0">lock</a>)
<a name="l01111"></a>01111         <span class="keywordflow">return</span>;
<a name="l01112"></a>01112 
<a name="l01113"></a>01113     <span class="keywordflow">if</span> (mode == <span class="charliteral">&#39;v&#39;</span>) {
<a name="l01114"></a>01114         <span class="comment">/* extract first line from clipboard in case of multi-line copies */</span>
<a name="l01115"></a>01115         <span class="keywordtype">char</span> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>, *pbuf = <a class="code" href="../../d7/d6e/wm__window_8c.html#ad2a3ffd172f243ff5201bf82cf79c532">WM_clipboard_text_get</a>(0);
<a name="l01116"></a>01116         p = pbuf;
<a name="l01117"></a>01117         <span class="keywordflow">if</span> (p) {
<a name="l01118"></a>01118             <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;
<a name="l01119"></a>01119             <span class="keywordflow">while</span> (*p &amp;&amp; *p != <span class="charliteral">&#39;\r&#39;</span> &amp;&amp; *p != <span class="charliteral">&#39;\n&#39;</span> &amp;&amp; i &lt; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a827a90802798250dee1083bb41ab03c5">UI_MAX_DRAW_STR</a>) {
<a name="l01120"></a>01120                 buf[i++] = *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l01121"></a>01121                 p++;
<a name="l01122"></a>01122             }
<a name="l01123"></a>01123             buf[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0;
<a name="l01124"></a>01124             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(pbuf);
<a name="l01125"></a>01125         }
<a name="l01126"></a>01126     }
<a name="l01127"></a>01127     
<a name="l01128"></a>01128     <span class="comment">/* numeric value */</span>
<a name="l01129"></a>01129     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0388eda1f65113c4a15720e037c11cb4">ELEM4</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#aaf0952059602752258dccaa015d7b54a">NUM</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a53ab9b2f5a030a06d3a609f2aad1fde3">NUMABS</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#a14a9dde4adb789e686787aeff498bb10">NUMSLI</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a6cb451ada67e3dcb1d058adcd025b14c">HSVSLI</a>)) {
<a name="l01130"></a>01130         
<a name="l01131"></a>01131         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ;
<a name="l01132"></a>01132         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == <span class="charliteral">&#39;c&#39;</span>) {
<a name="l01133"></a>01133             <a class="code" href="../../dd/dda/interface_8c.html#a1ac0c520e4d0b4c7e09e624abd4a3d74">ui_get_but_string</a>(but, buf, <span class="keyword">sizeof</span>(buf));
<a name="l01134"></a>01134             <a class="code" href="../../d7/d6e/wm__window_8c.html#ad79c37fb28818628077bdb8cbfd1bc53">WM_clipboard_text_set</a>(buf, 0);
<a name="l01135"></a>01135         }
<a name="l01136"></a>01136         <span class="keywordflow">else</span> {
<a name="l01137"></a>01137             <span class="keywordtype">double</span> val;
<a name="l01138"></a>01138 
<a name="l01139"></a>01139             <span class="keywordflow">if</span> (<a class="code" href="../../dd/dda/interface_8c.html#ac93d692b1653971551e9ca6122fc16e3">ui_set_but_string_eval_num</a>(C, but, buf, &amp;val)) {
<a name="l01140"></a>01140                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l01141"></a>01141                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = val;
<a name="l01142"></a>01142                 <a class="code" href="../../dd/dda/interface_8c.html#a2ff369f54c9aa7f40d55c17751c57cde">ui_set_but_string</a>(C, but, buf);
<a name="l01143"></a>01143                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l01144"></a>01144             }
<a name="l01145"></a>01145         }
<a name="l01146"></a>01146     }
<a name="l01147"></a>01147 
<a name="l01148"></a>01148     <span class="comment">/* RGB triple */</span>
<a name="l01149"></a>01149     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../dd/d8b/intern_2opennl_2superlu_2util_8h.html#a4d92d07523ba751afadecd63d3479e30a3e66f07732b51f2cb52e13d598f8abda">COL</a>) {
<a name="l01150"></a>01150         <span class="keywordtype">float</span> rgb[3];
<a name="l01151"></a>01151         
<a name="l01152"></a>01152         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ;
<a name="l01153"></a>01153         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == <span class="charliteral">&#39;c&#39;</span>) {
<a name="l01154"></a>01154 
<a name="l01155"></a>01155             <a class="code" href="../../dd/dda/interface_8c.html#a12cb3aabf09cc9d093a80b0bc9ed98aa">ui_get_but_vectorf</a>(but, rgb);
<a name="l01156"></a>01156             <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;[%f, %f, %f]&quot;</span>, rgb[0], rgb[1], rgb[2]);
<a name="l01157"></a>01157             <a class="code" href="../../d7/d6e/wm__window_8c.html#ad79c37fb28818628077bdb8cbfd1bc53">WM_clipboard_text_set</a>(buf, 0);
<a name="l01158"></a>01158             
<a name="l01159"></a>01159         }
<a name="l01160"></a>01160         <span class="keywordflow">else</span> {
<a name="l01161"></a>01161             <span class="keywordflow">if</span> (sscanf(buf, <span class="stringliteral">&quot;[%f, %f, %f]&quot;</span>, &amp;rgb[0], &amp;rgb[1], &amp;rgb[2]) == 3) {
<a name="l01162"></a>01162                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l01163"></a>01163                 <a class="code" href="../../dd/dda/interface_8c.html#a305c3c1bfb22a3e27b3461ff5655b214">ui_set_but_vectorf</a>(but, rgb);
<a name="l01164"></a>01164                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l01165"></a>01165             }
<a name="l01166"></a>01166         }
<a name="l01167"></a>01167     }
<a name="l01168"></a>01168 
<a name="l01169"></a>01169     <span class="comment">/* text/string and ID data */</span>
<a name="l01170"></a>01170     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba24e799bd38fe08efb4756c63d8f78df9">TEX</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a69f2c191e2c4babdd9dc28b8fb4d8a68">IDPOIN</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3a2c1c38a5465f6d46a2296e3ad09bbe">SEARCH_MENU</a>)) {
<a name="l01171"></a>01171         <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *active_data = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>;
<a name="l01172"></a>01172 
<a name="l01173"></a>01173         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ;
<a name="l01174"></a>01174         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == <span class="charliteral">&#39;c&#39;</span>) {
<a name="l01175"></a>01175             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">BUTTON_STATE_TEXT_EDITING</a>);
<a name="l01176"></a>01176             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(buf, active_data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a827a90802798250dee1083bb41ab03c5">UI_MAX_DRAW_STR</a>);
<a name="l01177"></a>01177             <a class="code" href="../../d7/d6e/wm__window_8c.html#ad79c37fb28818628077bdb8cbfd1bc53">WM_clipboard_text_set</a>(active_data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>, 0);
<a name="l01178"></a>01178             active_data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l01179"></a>01179             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l01180"></a>01180         }
<a name="l01181"></a>01181         <span class="keywordflow">else</span> {
<a name="l01182"></a>01182             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">BUTTON_STATE_TEXT_EDITING</a>);
<a name="l01183"></a>01183 
<a name="l01184"></a>01184             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1969f7180fb294c121308618f60a0aab">ui_is_but_utf8</a>(but)) <a class="code" href="../../dd/d83/BLI__string__utf8_8h.html#a5b5eeb786962366cdcc443a70dc35dae">BLI_strncpy_utf8</a>(active_data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>, buf, active_data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a56e112f7647dbb1fa6743ff86b71cdc5">maxlen</a>);
<a name="l01185"></a>01185             <span class="keywordflow">else</span> <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(active_data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>, buf, active_data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a56e112f7647dbb1fa6743ff86b71cdc5">maxlen</a>);
<a name="l01186"></a>01186 
<a name="l01187"></a>01187             <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3a2c1c38a5465f6d46a2296e3ad09bbe">SEARCH_MENU</a>) {
<a name="l01188"></a>01188                 <span class="comment">/* else uiSearchboxData.active member is not updated [#26856] */</span>
<a name="l01189"></a>01189                 <a class="code" href="../../d1/d2f/interface__intern_8h.html#aae288b30925758ae31e39088e4185cb3">ui_searchbox_update</a>(C, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>, but, 1);
<a name="l01190"></a>01190             }
<a name="l01191"></a>01191             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l01192"></a>01192         }
<a name="l01193"></a>01193     }
<a name="l01194"></a>01194     <span class="comment">/* colorband (not supported by system clipboard) */</span>
<a name="l01195"></a>01195     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a84c5d75a8e1a067bb3def3f69049b22a">BUT_COLORBAND</a>) {
<a name="l01196"></a>01196         <span class="keywordflow">if</span> (mode == <span class="charliteral">&#39;c&#39;</span>) {
<a name="l01197"></a>01197             <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01198"></a>01198                 <span class="keywordflow">return</span>;
<a name="l01199"></a>01199 
<a name="l01200"></a>01200             memcpy(&amp;but_copypaste_coba, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../d0/dc8/structColorBand.html">ColorBand</a>));
<a name="l01201"></a>01201         }
<a name="l01202"></a>01202         <span class="keywordflow">else</span> {
<a name="l01203"></a>01203             <span class="keywordflow">if</span> (but_copypaste_coba.<a class="code" href="../../d0/dc8/structColorBand.html#a9a5aeaf310abd70ad22e33ecc7040c3c">tot</a> == 0)
<a name="l01204"></a>01204                 <span class="keywordflow">return</span>;
<a name="l01205"></a>01205 
<a name="l01206"></a>01206             <span class="keywordflow">if</span> (!but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>)
<a name="l01207"></a>01207                 but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/dc8/structColorBand.html">ColorBand</a>), <span class="stringliteral">&quot;colorband&quot;</span>);
<a name="l01208"></a>01208 
<a name="l01209"></a>01209             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l01210"></a>01210             memcpy(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a12b850e20f8fcc35285b276e31ce2af5">coba</a>, &amp;but_copypaste_coba, <span class="keyword">sizeof</span>(<a class="code" href="../../d0/dc8/structColorBand.html">ColorBand</a>) );
<a name="l01211"></a>01211             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l01212"></a>01212         }
<a name="l01213"></a>01213     }
<a name="l01214"></a>01214     <span class="comment">/* operator button (any type) */</span>
<a name="l01215"></a>01215     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a>) {
<a name="l01216"></a>01216         <span class="keywordflow">if</span> (mode == <span class="charliteral">&#39;c&#39;</span>) {
<a name="l01217"></a>01217             <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> *<a class="code" href="../../da/dfb/structuiAfterFunc.html#af1c98ba94e08984f73faecce2450bbff">opptr</a>;
<a name="l01218"></a>01218             <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>;
<a name="l01219"></a>01219             opptr = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a67370a522c42b8e64a8b42be8f379c7f">uiButGetOperatorPtrRNA</a>(but); <span class="comment">/* allocated when needed, the button owns it */</span>
<a name="l01220"></a>01220 
<a name="l01221"></a>01221             str = <a class="code" href="../../d6/dae/wm__operators_8c.html#adba96297a2bbfe848074b1bcef44b7e3">WM_operator_pystring</a>(C, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a>, opptr, 0);
<a name="l01222"></a>01222 
<a name="l01223"></a>01223             <a class="code" href="../../d7/d6e/wm__window_8c.html#ad79c37fb28818628077bdb8cbfd1bc53">WM_clipboard_text_set</a>(str, 0);
<a name="l01224"></a>01224 
<a name="l01225"></a>01225             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(str);
<a name="l01226"></a>01226         }
<a name="l01227"></a>01227     }
<a name="l01228"></a>01228 }
<a name="l01229"></a>01229 
<a name="l01230"></a>01230 <span class="comment">/* ************* in-button text selection/editing ************* */</span>
<a name="l01231"></a>01231 
<a name="l01232"></a>01232 
<a name="l01233"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a144cf547b792732df038fa479749c079">01233</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a144cf547b792732df038fa479749c079">ui_textedit_delete_selection</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l01234"></a>01234 {
<a name="l01235"></a>01235     <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a> = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>;
<a name="l01236"></a>01236     <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a> = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(str);
<a name="l01237"></a>01237     <span class="keywordtype">int</span> change = 0;
<a name="l01238"></a>01238     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a> != but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> &amp;&amp; len) {
<a name="l01239"></a>01239         memmove(str + but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a>, str + but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a>, (len - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a>) + 1);
<a name="l01240"></a>01240         change = 1;
<a name="l01241"></a>01241     }
<a name="l01242"></a>01242     
<a name="l01243"></a>01243     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a>;
<a name="l01244"></a>01244     <span class="keywordflow">return</span> change;
<a name="l01245"></a>01245 }
<a name="l01246"></a>01246 
<a name="l01247"></a>01247 <span class="comment">/* note, but-&gt;block-&gt;aspect is used here, when drawing button style is getting scaled too */</span>
<a name="l01248"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a924dae0cac304627a3e4ea0351990e7d">01248</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a924dae0cac304627a3e4ea0351990e7d">ui_textedit_set_cursor_pos</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">short</span> x)
<a name="l01249"></a>01249 {
<a name="l01250"></a>01250     <a class="code" href="../../d3/d28/structuiStyle.html">uiStyle</a> *style = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a16828a47eb4af34d08dce0ead86693b3">UI_GetStyle</a>();  <span class="comment">// XXX pass on as arg</span>
<a name="l01251"></a>01251     <a class="code" href="../../df/d6e/structuiFontStyle.html">uiFontStyle</a> *fstyle = &amp;style-&gt;<a class="code" href="../../d3/d28/structuiStyle.html#ac9c53013a87786238c8f707bc39d81a6">widget</a>;
<a name="l01252"></a>01252     <span class="keywordtype">int</span> startx = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>;
<a name="l01253"></a>01253     <span class="keywordtype">char</span> *origstr;
<a name="l01254"></a>01254 
<a name="l01255"></a>01255     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a86b5ca0ad4264d7a0ea56dd5d5cd4a66">uiStyleFontSet</a>(fstyle);
<a name="l01256"></a>01256 
<a name="l01257"></a>01257     <span class="keywordflow">if</span> (fstyle-&gt;<a class="code" href="../../df/d6e/structuiFontStyle.html#a777cd0dae5b5ffb23569182f022521f0">kerning</a> == 1) <span class="comment">/* for BLF_width */</span>
<a name="l01258"></a>01258         <a class="code" href="../../df/d5d/BLF__api_8h.html#ac2a33086efb8412dd5be008d7fede054">BLF_enable</a>(fstyle-&gt;<a class="code" href="../../df/d6e/structuiFontStyle.html#a9a1dd426613c712d2306f01553539ce7">uifont_id</a>, <a class="code" href="../../df/d5d/BLF__api_8h.html#a376d8a708e2ed691afe4ffbbc96ec2a4">BLF_KERNING_DEFAULT</a>);
<a name="l01259"></a>01259     
<a name="l01260"></a>01260     origstr = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>) * data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a56e112f7647dbb1fa6743ff86b71cdc5">maxlen</a>, <span class="stringliteral">&quot;ui_textedit origstr&quot;</span>);
<a name="l01261"></a>01261     
<a name="l01262"></a>01262     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(origstr, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ad10198140dc5e52877630009f81879f7">drawstr</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a56e112f7647dbb1fa6743ff86b71cdc5">maxlen</a>);
<a name="l01263"></a>01263     
<a name="l01264"></a>01264     <span class="comment">/* XXX solve generic */</span>
<a name="l01265"></a>01265     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d9/dc4/plugin_8h.html#aaf0952059602752258dccaa015d7b54a">NUM</a> || but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d9/dc4/plugin_8h.html#a14a9dde4adb789e686787aeff498bb10">NUMSLI</a>)
<a name="l01266"></a>01266         startx += (int)(0.5f * (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abbb172bca1cfaa5d7538af548f1a1666">y2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>));
<a name="l01267"></a>01267     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba24e799bd38fe08efb4756c63d8f78df9">TEX</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3a2c1c38a5465f6d46a2296e3ad09bbe">SEARCH_MENU</a>)) {
<a name="l01268"></a>01268         startx += 5;
<a name="l01269"></a>01269         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d1/d2f/interface__intern_8h.html#a08b9b7257aea77e3235d4c3df26f66e7">UI_HAS_ICON</a>)
<a name="l01270"></a>01270             startx += <a class="code" href="../../d8/d1e/UI__interface_8h.html#a85a40035166a1099043933c20dc31f9e">UI_DPI_ICON_SIZE</a>;
<a name="l01271"></a>01271     }
<a name="l01272"></a>01272     
<a name="l01273"></a>01273     <span class="comment">/* mouse dragged outside the widget to the left */</span>
<a name="l01274"></a>01274     <span class="keywordflow">if</span> (x &lt; startx &amp;&amp; but-&gt;ofs &gt; 0) {   
<a name="l01275"></a>01275         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0d221acf895ea951d16753d968572d6e">ofs</a>;
<a name="l01276"></a>01276 
<a name="l01277"></a>01277         origstr[but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0d221acf895ea951d16753d968572d6e">ofs</a>] = 0;
<a name="l01278"></a>01278         
<a name="l01279"></a>01279         <span class="keywordflow">while</span> (i &gt; 0) {
<a name="l01280"></a>01280             <span class="keywordflow">if</span> (<a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#ad3828dd3d383d1ddaececc824cecf5ea">BLI_str_cursor_step_prev_utf8</a>(origstr, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0d221acf895ea951d16753d968572d6e">ofs</a>, &amp;i)) {
<a name="l01281"></a>01281                 <span class="keywordflow">if</span> (<a class="code" href="../../df/d5d/BLF__api_8h.html#a3b01ca673c67a730433f5156daf6ca29">BLF_width</a>(fstyle-&gt;<a class="code" href="../../df/d6e/structuiFontStyle.html#a9a1dd426613c712d2306f01553539ce7">uifont_id</a>, origstr + i) &gt; (startx - x) * 0.25f) <span class="keywordflow">break</span>;  <span class="comment">// 0.25 == scale factor for less sensitivity</span>
<a name="l01282"></a>01282             }
<a name="l01283"></a>01283             <span class="keywordflow">else</span> {
<a name="l01284"></a>01284                 <span class="keywordflow">break</span>; <span class="comment">/* unlikely but possible */</span>
<a name="l01285"></a>01285             }
<a name="l01286"></a>01286         }
<a name="l01287"></a>01287         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0d221acf895ea951d16753d968572d6e">ofs</a> = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01288"></a>01288         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0d221acf895ea951d16753d968572d6e">ofs</a>;
<a name="l01289"></a>01289     }
<a name="l01290"></a>01290     <span class="comment">/* mouse inside the widget */</span>
<a name="l01291"></a>01291     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x &gt;= startx) {
<a name="l01292"></a>01292         <span class="keywordtype">int</span> pos_i;
<a name="l01293"></a>01293 
<a name="l01294"></a>01294         <span class="comment">/* keep track of previous distance from the cursor to the char */</span>
<a name="l01295"></a>01295         <span class="keywordtype">float</span> cdist, cdist_prev = 0.0f;
<a name="l01296"></a>01296         <span class="keywordtype">short</span> pos_prev;
<a name="l01297"></a>01297 
<a name="l01298"></a>01298         <span class="keyword">const</span> <span class="keywordtype">float</span> aspect_sqrt = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a33f9e82220f9ff9453a6557bd04bd8c5">sqrtf</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a132e358eff6765b16c4734290d30e556">aspect</a>);
<a name="l01299"></a>01299         
<a name="l01300"></a>01300         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> = pos_prev = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(origstr) - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0d221acf895ea951d16753d968572d6e">ofs</a>;
<a name="l01301"></a>01301 
<a name="l01302"></a>01302         <span class="keywordflow">while</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) {
<a name="l01303"></a>01303             <span class="comment">/* XXX does not take zoom level into account */</span>
<a name="l01304"></a>01304             cdist = startx + aspect_sqrt *<a class="code" href="../../df/d5d/BLF__api_8h.html#a3b01ca673c67a730433f5156daf6ca29">BLF_width</a>(fstyle-&gt;<a class="code" href="../../df/d6e/structuiFontStyle.html#a9a1dd426613c712d2306f01553539ce7">uifont_id</a>, origstr + but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0d221acf895ea951d16753d968572d6e">ofs</a>);
<a name="l01305"></a>01305 
<a name="l01306"></a>01306             <span class="comment">/* check if position is found */</span>
<a name="l01307"></a>01307             <span class="keywordflow">if</span> (cdist &lt; x) {
<a name="l01308"></a>01308                 <span class="comment">/* check is previous location was infact closer */</span>
<a name="l01309"></a>01309                 <span class="keywordflow">if</span> (((<span class="keywordtype">float</span>)x - cdist) &gt; (cdist_prev - (<span class="keywordtype">float</span>)x)) {
<a name="l01310"></a>01310                     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> = pos_prev;
<a name="l01311"></a>01311                 }
<a name="l01312"></a>01312                 <span class="keywordflow">break</span>;
<a name="l01313"></a>01313             }
<a name="l01314"></a>01314             cdist_prev = cdist;
<a name="l01315"></a>01315             pos_prev   = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>;
<a name="l01316"></a>01316             <span class="comment">/* done with tricky distance checks */</span>
<a name="l01317"></a>01317 
<a name="l01318"></a>01318             pos_i = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>;
<a name="l01319"></a>01319             <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> &lt;= 0) <span class="keywordflow">break</span>;
<a name="l01320"></a>01320             <span class="keywordflow">if</span> (<a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#ad3828dd3d383d1ddaececc824cecf5ea">BLI_str_cursor_step_prev_utf8</a>(origstr, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0d221acf895ea951d16753d968572d6e">ofs</a>, &amp;pos_i)) {
<a name="l01321"></a>01321                 but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> = pos_i;
<a name="l01322"></a>01322                 origstr[but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> + but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0d221acf895ea951d16753d968572d6e">ofs</a>] = 0;
<a name="l01323"></a>01323             }
<a name="l01324"></a>01324             <span class="keywordflow">else</span> {
<a name="l01325"></a>01325                 <span class="keywordflow">break</span>; <span class="comment">/* unlikely but possible */</span>
<a name="l01326"></a>01326             }
<a name="l01327"></a>01327         }
<a name="l01328"></a>01328         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> += but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0d221acf895ea951d16753d968572d6e">ofs</a>;
<a name="l01329"></a>01329         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> &lt; 0) but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> = 0;
<a name="l01330"></a>01330     }
<a name="l01331"></a>01331     
<a name="l01332"></a>01332     <span class="keywordflow">if</span> (fstyle-&gt;<a class="code" href="../../df/d6e/structuiFontStyle.html#a777cd0dae5b5ffb23569182f022521f0">kerning</a> == 1)
<a name="l01333"></a>01333         <a class="code" href="../../df/d5d/BLF__api_8h.html#a83185519c436c725a5afc5a6d40d7cc2">BLF_disable</a>(fstyle-&gt;<a class="code" href="../../df/d6e/structuiFontStyle.html#a9a1dd426613c712d2306f01553539ce7">uifont_id</a>, <a class="code" href="../../df/d5d/BLF__api_8h.html#a376d8a708e2ed691afe4ffbbc96ec2a4">BLF_KERNING_DEFAULT</a>);
<a name="l01334"></a>01334     
<a name="l01335"></a>01335     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(origstr);
<a name="l01336"></a>01336 }
<a name="l01337"></a>01337 
<a name="l01338"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3c2634fc63c1ca63c4b82af0c1fe7a4a">01338</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3c2634fc63c1ca63c4b82af0c1fe7a4a">ui_textedit_set_cursor_select</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">short</span> x)
<a name="l01339"></a>01339 {
<a name="l01340"></a>01340     <span class="keywordflow">if</span> (x &gt; data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a89683ee6a9ca8bf2c7e03174ce2c6cb9">selstartx</a>) data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a885461fd30cd55099ea2f1023551c3f8">selextend</a> = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a5fc7767e34fb2861276d4e3f32cdb311">EXTEND_RIGHT</a>;
<a name="l01341"></a>01341     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x &lt; data-&gt;selstartx) data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a885461fd30cd55099ea2f1023551c3f8">selextend</a> = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a94b1e2d017e049f05fc07a1681ddaaea">EXTEND_LEFT</a>;
<a name="l01342"></a>01342 
<a name="l01343"></a>01343     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a924dae0cac304627a3e4ea0351990e7d">ui_textedit_set_cursor_pos</a>(but, data, x);
<a name="l01344"></a>01344                         
<a name="l01345"></a>01345     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a885461fd30cd55099ea2f1023551c3f8">selextend</a> == <a class="code" href="../../d1/d2f/interface__intern_8h.html#a5fc7767e34fb2861276d4e3f32cdb311">EXTEND_RIGHT</a>) but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>;
<a name="l01346"></a>01346     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a885461fd30cd55099ea2f1023551c3f8">selextend</a> == <a class="code" href="../../d1/d2f/interface__intern_8h.html#a94b1e2d017e049f05fc07a1681ddaaea">EXTEND_LEFT</a>) but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>;
<a name="l01347"></a>01347 
<a name="l01348"></a>01348     <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(but);
<a name="l01349"></a>01349 }
<a name="l01350"></a>01350 
<a name="l01351"></a>01351 <span class="comment">/* this is used for both utf8 and ascii, its meant to be used for single keys,</span>
<a name="l01352"></a>01352 <span class="comment"> * notice the buffer is either copied or not, so its not suitable for pasting in</span>
<a name="l01353"></a>01353 <span class="comment"> * - campbell */</span>
<a name="l01354"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a4c86c8a66824d216d1ff27c3c1d6e637">01354</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a4c86c8a66824d216d1ff27c3c1d6e637">ui_textedit_type_buf</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>,
<a name="l01355"></a>01355                                 <span class="keyword">const</span> <span class="keywordtype">char</span> *utf8_buf, <span class="keywordtype">int</span> utf8_buf_len)
<a name="l01356"></a>01356 {
<a name="l01357"></a>01357     <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>;
<a name="l01358"></a>01358     <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>, changed = 0;
<a name="l01359"></a>01359 
<a name="l01360"></a>01360     str = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>;
<a name="l01361"></a>01361     len = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(str);
<a name="l01362"></a>01362 
<a name="l01363"></a>01363     <span class="keywordflow">if</span> (len - (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a>) + 1 &lt;= data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a56e112f7647dbb1fa6743ff86b71cdc5">maxlen</a>) {
<a name="l01364"></a>01364         <span class="keywordtype">int</span> <a class="code" href="../../d1/d22/stdosl_8h.html#a8bd9f841cf6ee6c256028a8a544fec3b">step</a> = utf8_buf_len;
<a name="l01365"></a>01365 
<a name="l01366"></a>01366         <span class="comment">/* type over the current selection */</span>
<a name="l01367"></a>01367         <span class="keywordflow">if</span> ((but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a>) &gt; 0) {
<a name="l01368"></a>01368             changed = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a144cf547b792732df038fa479749c079">ui_textedit_delete_selection</a>(but, data);
<a name="l01369"></a>01369             len = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(str);
<a name="l01370"></a>01370         }
<a name="l01371"></a>01371 
<a name="l01372"></a>01372         <span class="keywordflow">if</span> (len + step &lt; data-&gt;maxlen) {
<a name="l01373"></a>01373             memmove(&amp;str[but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> + step], &amp;str[but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>], (len + 1) - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>);
<a name="l01374"></a>01374             memcpy(&amp;str[but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>], utf8_buf, step * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
<a name="l01375"></a>01375             but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> += <a class="code" href="../../d1/d22/stdosl_8h.html#a8bd9f841cf6ee6c256028a8a544fec3b">step</a>;
<a name="l01376"></a>01376             changed = 1;
<a name="l01377"></a>01377         }
<a name="l01378"></a>01378     }
<a name="l01379"></a>01379 
<a name="l01380"></a>01380     <span class="keywordflow">return</span> changed;
<a name="l01381"></a>01381 }
<a name="l01382"></a>01382 
<a name="l01383"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa5c3e0495a83639c6f090650c2beb9d8">01383</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa5c3e0495a83639c6f090650c2beb9d8">ui_textedit_type_ascii</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">char</span> ascii)
<a name="l01384"></a>01384 {
<a name="l01385"></a>01385     <span class="keywordtype">char</span> buf[2] = {ascii, <span class="charliteral">&#39;\0&#39;</span>};
<a name="l01386"></a>01386 
<a name="l01387"></a>01387     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1969f7180fb294c121308618f60a0aab">ui_is_but_utf8</a>(but) &amp;&amp; (<a class="code" href="../../dd/d83/BLI__string__utf8_8h.html#ac28dea96012eef5bd4cd541b9f447bef">BLI_str_utf8_size</a>(buf) == -1)) {
<a name="l01388"></a>01388         printf(<span class="stringliteral">&quot;%s: entering invalid ascii char into an ascii key (%d)\n&quot;</span>,
<a name="l01389"></a>01389                __func__, (<span class="keywordtype">int</span>)(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)ascii);
<a name="l01390"></a>01390 
<a name="l01391"></a>01391         <span class="keywordflow">return</span> 0;
<a name="l01392"></a>01392     }
<a name="l01393"></a>01393 
<a name="l01394"></a>01394     <span class="comment">/* in some cases we want to allow invalid utf8 chars */</span>
<a name="l01395"></a>01395     <span class="keywordflow">return</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a4c86c8a66824d216d1ff27c3c1d6e637">ui_textedit_type_buf</a>(but, data, buf, 1);
<a name="l01396"></a>01396 }
<a name="l01397"></a>01397 
<a name="l01398"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a0b44892804f17fd345f26c35bd61686c">01398</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a0b44892804f17fd345f26c35bd61686c">ui_textedit_move</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#a9bc309474f01fc4baa5e209ede950a70">strCursorJumpDirection</a> direction, <span class="keywordtype">int</span> select, <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#ac2ec6cad011c2ef80b971425f9aba2ba">strCursorJumpType</a> jump)
<a name="l01399"></a>01399 {
<a name="l01400"></a>01400     <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a> = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>;
<a name="l01401"></a>01401     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a> = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(str);
<a name="l01402"></a>01402     <span class="keyword">const</span> <span class="keywordtype">int</span> pos_prev = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>;
<a name="l01403"></a>01403     <span class="keyword">const</span> <span class="keywordtype">int</span> has_sel = (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a>) &gt; 0;
<a name="l01404"></a>01404 
<a name="l01405"></a>01405     <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(but);
<a name="l01406"></a>01406 
<a name="l01407"></a>01407     <span class="comment">/* special case, quit selection and set cursor */</span>
<a name="l01408"></a>01408     <span class="keywordflow">if</span> (has_sel &amp;&amp; !select) {
<a name="l01409"></a>01409         <span class="keywordflow">if</span> (jump == <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#ac2ec6cad011c2ef80b971425f9aba2baa24bdb1244779d5e5d1e0b1622acf985b">STRCUR_JUMP_ALL</a>) {
<a name="l01410"></a>01410             but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> = direction ? len : 0;
<a name="l01411"></a>01411         }
<a name="l01412"></a>01412         <span class="keywordflow">else</span> {
<a name="l01413"></a>01413             <span class="keywordflow">if</span> (direction) {
<a name="l01414"></a>01414                 but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a>;
<a name="l01415"></a>01415             }
<a name="l01416"></a>01416             <span class="keywordflow">else</span> {
<a name="l01417"></a>01417                 but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a>;
<a name="l01418"></a>01418             }
<a name="l01419"></a>01419         }
<a name="l01420"></a>01420         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a885461fd30cd55099ea2f1023551c3f8">selextend</a> = 0;
<a name="l01421"></a>01421     }
<a name="l01422"></a>01422     <span class="keywordflow">else</span> {
<a name="l01423"></a>01423         <span class="keywordtype">int</span> pos_i = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>;
<a name="l01424"></a>01424         <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#a16933b89ca346880710021edb10ef7b3">BLI_str_cursor_step_utf8</a>(str, len, &amp;pos_i, direction, jump);
<a name="l01425"></a>01425         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> = pos_i;
<a name="l01426"></a>01426 
<a name="l01427"></a>01427         <span class="keywordflow">if</span> (select) {
<a name="l01428"></a>01428             <span class="comment">/* existing selection */</span>
<a name="l01429"></a>01429             <span class="keywordflow">if</span> (has_sel) {
<a name="l01430"></a>01430 
<a name="l01431"></a>01431                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a885461fd30cd55099ea2f1023551c3f8">selextend</a> == 0) {
<a name="l01432"></a>01432                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a885461fd30cd55099ea2f1023551c3f8">selextend</a> = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a5fc7767e34fb2861276d4e3f32cdb311">EXTEND_RIGHT</a>;
<a name="l01433"></a>01433                 }
<a name="l01434"></a>01434 
<a name="l01435"></a>01435                 <span class="keywordflow">if</span> (direction) {
<a name="l01436"></a>01436                     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a885461fd30cd55099ea2f1023551c3f8">selextend</a> == <a class="code" href="../../d1/d2f/interface__intern_8h.html#a5fc7767e34fb2861276d4e3f32cdb311">EXTEND_RIGHT</a>) {
<a name="l01437"></a>01437                         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>;
<a name="l01438"></a>01438                     }
<a name="l01439"></a>01439                     <span class="keywordflow">else</span> {
<a name="l01440"></a>01440                         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>;
<a name="l01441"></a>01441                     }
<a name="l01442"></a>01442                 }
<a name="l01443"></a>01443                 <span class="keywordflow">else</span> {
<a name="l01444"></a>01444                     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a885461fd30cd55099ea2f1023551c3f8">selextend</a> == <a class="code" href="../../d1/d2f/interface__intern_8h.html#a94b1e2d017e049f05fc07a1681ddaaea">EXTEND_LEFT</a>) {
<a name="l01445"></a>01445                         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>;
<a name="l01446"></a>01446                     }
<a name="l01447"></a>01447                     <span class="keywordflow">else</span> {
<a name="l01448"></a>01448                         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>;
<a name="l01449"></a>01449                     }
<a name="l01450"></a>01450                 }
<a name="l01451"></a>01451 
<a name="l01452"></a>01452                 <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> &lt; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a>) {
<a name="l01453"></a>01453                     <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<span class="keywordtype">short</span>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a>);
<a name="l01454"></a>01454                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a885461fd30cd55099ea2f1023551c3f8">selextend</a> = (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a885461fd30cd55099ea2f1023551c3f8">selextend</a> == <a class="code" href="../../d1/d2f/interface__intern_8h.html#a5fc7767e34fb2861276d4e3f32cdb311">EXTEND_RIGHT</a>) ? <a class="code" href="../../d1/d2f/interface__intern_8h.html#a94b1e2d017e049f05fc07a1681ddaaea">EXTEND_LEFT</a> : <a class="code" href="../../d1/d2f/interface__intern_8h.html#a5fc7767e34fb2861276d4e3f32cdb311">EXTEND_RIGHT</a>;
<a name="l01455"></a>01455                 }
<a name="l01456"></a>01456 
<a name="l01457"></a>01457             } <span class="comment">/* new selection */</span>
<a name="l01458"></a>01458             <span class="keywordflow">else</span> {
<a name="l01459"></a>01459                 <span class="keywordflow">if</span> (direction) {
<a name="l01460"></a>01460                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a885461fd30cd55099ea2f1023551c3f8">selextend</a> = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a5fc7767e34fb2861276d4e3f32cdb311">EXTEND_RIGHT</a>;
<a name="l01461"></a>01461                     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>;
<a name="l01462"></a>01462                     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a> = pos_prev;
<a name="l01463"></a>01463                 }
<a name="l01464"></a>01464                 <span class="keywordflow">else</span> {
<a name="l01465"></a>01465                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a885461fd30cd55099ea2f1023551c3f8">selextend</a> = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a94b1e2d017e049f05fc07a1681ddaaea">EXTEND_LEFT</a>;
<a name="l01466"></a>01466                     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> = pos_prev;
<a name="l01467"></a>01467                     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>;
<a name="l01468"></a>01468                 }
<a name="l01469"></a>01469             }
<a name="l01470"></a>01470         }
<a name="l01471"></a>01471     }
<a name="l01472"></a>01472 }
<a name="l01473"></a>01473 
<a name="l01474"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ac70e61029f9858d66d54bcd6b26b46d4">01474</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ac70e61029f9858d66d54bcd6b26b46d4">ui_textedit_delete</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">int</span> direction, <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#ac2ec6cad011c2ef80b971425f9aba2ba">strCursorJumpType</a> jump)
<a name="l01475"></a>01475 {
<a name="l01476"></a>01476     <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a> = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>;
<a name="l01477"></a>01477     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a> = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(str);
<a name="l01478"></a>01478 
<a name="l01479"></a>01479     <span class="keywordtype">int</span> changed = 0;
<a name="l01480"></a>01480 
<a name="l01481"></a>01481     <span class="keywordflow">if</span> (jump == <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#ac2ec6cad011c2ef80b971425f9aba2baa24bdb1244779d5e5d1e0b1622acf985b">STRCUR_JUMP_ALL</a>) {
<a name="l01482"></a>01482         <span class="keywordflow">if</span> (len) changed = 1;
<a name="l01483"></a>01483         str[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01484"></a>01484         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> = 0;
<a name="l01485"></a>01485     }
<a name="l01486"></a>01486     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (direction) { <span class="comment">/* delete */</span>
<a name="l01487"></a>01487         <span class="keywordflow">if</span> ((but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a>) &gt; 0) {
<a name="l01488"></a>01488             changed = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a144cf547b792732df038fa479749c079">ui_textedit_delete_selection</a>(but, data);
<a name="l01489"></a>01489         }
<a name="l01490"></a>01490         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> &gt;= 0 &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> &lt; len) {
<a name="l01491"></a>01491             <span class="keywordtype">int</span> pos = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>;
<a name="l01492"></a>01492             <span class="keywordtype">int</span> <a class="code" href="../../d1/d22/stdosl_8h.html#a8bd9f841cf6ee6c256028a8a544fec3b">step</a>;
<a name="l01493"></a>01493             <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#a16933b89ca346880710021edb10ef7b3">BLI_str_cursor_step_utf8</a>(str, len, &amp;pos, direction, jump);
<a name="l01494"></a>01494             step = pos - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>;
<a name="l01495"></a>01495             memmove(&amp;str[but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>], &amp;str[but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> + step], (len + 1) - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>);
<a name="l01496"></a>01496             changed = 1;
<a name="l01497"></a>01497         }
<a name="l01498"></a>01498     }
<a name="l01499"></a>01499     <span class="keywordflow">else</span> { <span class="comment">/* backspace */</span>
<a name="l01500"></a>01500         <span class="keywordflow">if</span> (len != 0) {
<a name="l01501"></a>01501             <span class="keywordflow">if</span> ((but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a>) &gt; 0) {
<a name="l01502"></a>01502                 changed = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a144cf547b792732df038fa479749c079">ui_textedit_delete_selection</a>(but, data);
<a name="l01503"></a>01503             }
<a name="l01504"></a>01504             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> &gt; 0) {
<a name="l01505"></a>01505                 <span class="keywordtype">int</span> pos = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>;
<a name="l01506"></a>01506                 <span class="keywordtype">int</span> <a class="code" href="../../d1/d22/stdosl_8h.html#a8bd9f841cf6ee6c256028a8a544fec3b">step</a>;
<a name="l01507"></a>01507 
<a name="l01508"></a>01508                 <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#a16933b89ca346880710021edb10ef7b3">BLI_str_cursor_step_utf8</a>(str, len, &amp;pos, direction, jump);
<a name="l01509"></a>01509                 step = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> - pos;
<a name="l01510"></a>01510                 memmove(&amp;str[but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> - step], &amp;str[but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>], (len + 1) - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>);
<a name="l01511"></a>01511                 but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> -= <a class="code" href="../../d1/d22/stdosl_8h.html#a8bd9f841cf6ee6c256028a8a544fec3b">step</a>;
<a name="l01512"></a>01512                 changed = 1;
<a name="l01513"></a>01513             }
<a name="l01514"></a>01514         } 
<a name="l01515"></a>01515     }
<a name="l01516"></a>01516 
<a name="l01517"></a>01517     <span class="keywordflow">return</span> changed;
<a name="l01518"></a>01518 }
<a name="l01519"></a>01519 
<a name="l01520"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aeacdf67a54130969eaf5b87b5c204b73">01520</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aeacdf67a54130969eaf5b87b5c204b73">ui_textedit_autocomplete</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l01521"></a>01521 {
<a name="l01522"></a>01522     <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>;
<a name="l01523"></a>01523     <span class="keywordtype">int</span> changed = 1;
<a name="l01524"></a>01524 
<a name="l01525"></a>01525     str = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>;
<a name="l01526"></a>01526 
<a name="l01527"></a>01527     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>)
<a name="l01528"></a>01528         <a class="code" href="../../d1/d2f/interface__intern_8h.html#a5cd444bc72c6530ca4535784a01fb8f4">ui_searchbox_autocomplete</a>(C, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>, but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>);
<a name="l01529"></a>01529     <span class="keywordflow">else</span>
<a name="l01530"></a>01530         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a047f5bac82edb60cf1ddb511ae0b997b">autocomplete_func</a>(C, str, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ad4807ecde5d132d2d04218ed6cc86aaf">autofunc_arg</a>);
<a name="l01531"></a>01531 
<a name="l01532"></a>01532     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(str);
<a name="l01533"></a>01533     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>;
<a name="l01534"></a>01534 
<a name="l01535"></a>01535     <span class="keywordflow">return</span> changed;
<a name="l01536"></a>01536 }
<a name="l01537"></a>01537 
<a name="l01538"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6465fa98860518ed130c5a4dcac429b1">01538</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6465fa98860518ed130c5a4dcac429b1">ui_textedit_copypaste</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">int</span> paste, <span class="keywordtype">int</span> <a class="code" href="../../d5/dac/node__texture__output_8c.html#a37ee3e5f14f5cd161b271d670f2611b0">copy</a>, <span class="keywordtype">int</span> cut)
<a name="l01539"></a>01539 {
<a name="l01540"></a>01540     <span class="keywordtype">char</span> buf[<a class="code" href="../../d8/d1e/UI__interface_8h.html#a827a90802798250dee1083bb41ab03c5">UI_MAX_DRAW_STR</a>] = {0};
<a name="l01541"></a>01541     <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>, *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>, *pbuf;
<a name="l01542"></a>01542     <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>, x, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, changed = 0;
<a name="l01543"></a>01543 
<a name="l01544"></a>01544     str = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>;
<a name="l01545"></a>01545     len = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(str);
<a name="l01546"></a>01546     
<a name="l01547"></a>01547     <span class="comment">/* paste */</span>
<a name="l01548"></a>01548     <span class="keywordflow">if</span> (paste) {
<a name="l01549"></a>01549         <span class="comment">/* extract the first line from the clipboard */</span>
<a name="l01550"></a>01550         p = pbuf = <a class="code" href="../../d7/d6e/wm__window_8c.html#ad2a3ffd172f243ff5201bf82cf79c532">WM_clipboard_text_get</a>(0);
<a name="l01551"></a>01551 
<a name="l01552"></a>01552         <span class="keywordflow">if</span> (p &amp;&amp; p[0]) {
<a name="l01553"></a>01553             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y;
<a name="l01554"></a>01554             i = 0;
<a name="l01555"></a>01555             <span class="keywordflow">while</span> (*p &amp;&amp; *p != <span class="charliteral">&#39;\r&#39;</span> &amp;&amp; *p != <span class="charliteral">&#39;\n&#39;</span> &amp;&amp; i &lt; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a827a90802798250dee1083bb41ab03c5">UI_MAX_DRAW_STR</a> - 1) {
<a name="l01556"></a>01556                 buf[i++] = *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l01557"></a>01557                 p++;
<a name="l01558"></a>01558             }
<a name="l01559"></a>01559             buf[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0;
<a name="l01560"></a>01560 
<a name="l01561"></a>01561             <span class="comment">/* paste over the current selection */</span>
<a name="l01562"></a>01562             <span class="keywordflow">if</span> ((but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a>) &gt; 0) {
<a name="l01563"></a>01563                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a144cf547b792732df038fa479749c079">ui_textedit_delete_selection</a>(but, data);
<a name="l01564"></a>01564                 len = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(str);
<a name="l01565"></a>01565             }
<a name="l01566"></a>01566             
<a name="l01567"></a>01567             <span class="keywordflow">for</span> (y = 0; y &lt; <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(buf); y++)
<a name="l01568"></a>01568             {
<a name="l01569"></a>01569                 <span class="comment">/* add contents of buffer */</span>
<a name="l01570"></a>01570                 <span class="keywordflow">if</span> (len + 1 &lt; data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a56e112f7647dbb1fa6743ff86b71cdc5">maxlen</a>) {
<a name="l01571"></a>01571                     <span class="keywordflow">for</span> (x = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a56e112f7647dbb1fa6743ff86b71cdc5">maxlen</a>; x &gt; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>; x--)
<a name="l01572"></a>01572                         str[x] = str[x - 1];
<a name="l01573"></a>01573                     str[but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>] = buf[y];
<a name="l01574"></a>01574                     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>++; 
<a name="l01575"></a>01575                     len++;
<a name="l01576"></a>01576                     str[<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01577"></a>01577                 }
<a name="l01578"></a>01578             }
<a name="l01579"></a>01579 
<a name="l01580"></a>01580             changed = 1;
<a name="l01581"></a>01581         }
<a name="l01582"></a>01582 
<a name="l01583"></a>01583         <span class="keywordflow">if</span> (pbuf) {
<a name="l01584"></a>01584             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(pbuf);
<a name="l01585"></a>01585         }
<a name="l01586"></a>01586     }
<a name="l01587"></a>01587     <span class="comment">/* cut &amp; copy */</span>
<a name="l01588"></a>01588     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (copy || cut) {
<a name="l01589"></a>01589         <span class="comment">/* copy the contents to the copypaste buffer */</span>
<a name="l01590"></a>01590         <span class="keywordflow">for</span> (x = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a>; x &lt;= but-&gt;selend; x++) {
<a name="l01591"></a>01591             <span class="keywordflow">if</span> (x == but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a>)
<a name="l01592"></a>01592                 buf[x] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01593"></a>01593             <span class="keywordflow">else</span>
<a name="l01594"></a>01594                 buf[(x - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a>)] = str[x];
<a name="l01595"></a>01595         }
<a name="l01596"></a>01596 
<a name="l01597"></a>01597         <a class="code" href="../../d7/d6e/wm__window_8c.html#ad79c37fb28818628077bdb8cbfd1bc53">WM_clipboard_text_set</a>(buf, 0);
<a name="l01598"></a>01598         
<a name="l01599"></a>01599         <span class="comment">/* for cut only, delete the selection afterwards */</span>
<a name="l01600"></a>01600         <span class="keywordflow">if</span> (cut)
<a name="l01601"></a>01601             <span class="keywordflow">if</span> ((but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a>) &gt; 0)
<a name="l01602"></a>01602                 changed = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a144cf547b792732df038fa479749c079">ui_textedit_delete_selection</a>(but, data);
<a name="l01603"></a>01603     } 
<a name="l01604"></a>01604 
<a name="l01605"></a>01605     <span class="keywordflow">return</span> changed;
<a name="l01606"></a>01606 }
<a name="l01607"></a>01607 
<a name="l01608"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3fbaa9e67c2665507579180572c070f6">01608</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3fbaa9e67c2665507579180572c070f6">ui_textedit_begin</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l01609"></a>01609 {
<a name="l01610"></a>01610     <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l01611"></a>01611 
<a name="l01612"></a>01612     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>) {
<a name="l01613"></a>01613         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>);
<a name="l01614"></a>01614         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01615"></a>01615     }
<a name="l01616"></a>01616 
<a name="l01617"></a>01617     <span class="comment">/* retrieve string */</span>
<a name="l01618"></a>01618     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a56e112f7647dbb1fa6743ff86b71cdc5">maxlen</a> = <a class="code" href="../../dd/dda/interface_8c.html#a36b4080856268c6c7897e72689274e6c">ui_get_but_string_max_length</a>(but);
<a name="l01619"></a>01619     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>) * data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a56e112f7647dbb1fa6743ff86b71cdc5">maxlen</a> + 1, <span class="stringliteral">&quot;textedit str&quot;</span>);
<a name="l01620"></a>01620     <a class="code" href="../../dd/dda/interface_8c.html#a1ac0c520e4d0b4c7e09e624abd4a3d74">ui_get_but_string</a>(but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a56e112f7647dbb1fa6743ff86b71cdc5">maxlen</a>);
<a name="l01621"></a>01621 
<a name="l01622"></a>01622     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#aaf0952059602752258dccaa015d7b54a">NUM</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a53ab9b2f5a030a06d3a609f2aad1fde3">NUMABS</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#a14a9dde4adb789e686787aeff498bb10">NUMSLI</a>)) {
<a name="l01623"></a>01623         <a class="code" href="../../dd/dda/interface_8c.html#a8d497a38406ef58b7953cb4d9b6554a3">ui_convert_to_unit_alt_name</a>(but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a56e112f7647dbb1fa6743ff86b71cdc5">maxlen</a>);
<a name="l01624"></a>01624     }
<a name="l01625"></a>01625 
<a name="l01626"></a>01626     <span class="comment">/* won&#39;t change from now on */</span>
<a name="l01627"></a>01627     len = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>);
<a name="l01628"></a>01628 
<a name="l01629"></a>01629     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af007846eca2f6739b5f5d6305db6d2ca">origstr</a> = <a class="code" href="../../d3/db3/BLI__string_8h.html#a76968e0a4c961ec556481b473eddf2c5">BLI_strdupn</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>, len);
<a name="l01630"></a>01630     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a885461fd30cd55099ea2f1023551c3f8">selextend</a> = 0;
<a name="l01631"></a>01631     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a89683ee6a9ca8bf2c7e03174ce2c6cb9">selstartx</a> = 0;
<a name="l01632"></a>01632 
<a name="l01633"></a>01633     <span class="comment">/* set cursor pos to the end of the text */</span>
<a name="l01634"></a>01634     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a2dc67a12dd52365c48fdc2460e8e7857">editstr</a> = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>;
<a name="l01635"></a>01635     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> = <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l01636"></a>01636     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a> = 0;
<a name="l01637"></a>01637     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> = <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l01638"></a>01638 
<a name="l01639"></a>01639     <span class="comment">/* optional searchbox */</span>
<a name="l01640"></a>01640     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3a2c1c38a5465f6d46a2296e3ad09bbe">SEARCH_MENU</a>) {
<a name="l01641"></a>01641         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a> = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a12df38e8f1791454e1f4e3795a940a57">ui_searchbox_create</a>(C, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, but);
<a name="l01642"></a>01642         <a class="code" href="../../d1/d2f/interface__intern_8h.html#aae288b30925758ae31e39088e4185cb3">ui_searchbox_update</a>(C, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>, but, 1); <span class="comment">/* 1= reset */</span>
<a name="l01643"></a>01643     }
<a name="l01644"></a>01644     
<a name="l01645"></a>01645     <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(but);
<a name="l01646"></a>01646     
<a name="l01647"></a>01647     <a class="code" href="../../de/d3c/wm__cursors_8c.html#a04d16b0d6c38bc563f9d78f47f1ba7ed">WM_cursor_modal</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C), <a class="code" href="../../db/da6/wm__cursors_8h.html#a737c1bdca78a4eec48fa026fcca3dd9ba641498b042aba42e9f07a8d9f3b63766">BC_TEXTEDITCURSOR</a>);
<a name="l01648"></a>01648 }
<a name="l01649"></a>01649 
<a name="l01650"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aaec14e5e07c2bd6ee0cacd30fcedc0f1">01650</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aaec14e5e07c2bd6ee0cacd30fcedc0f1">ui_textedit_end</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l01651"></a>01651 {
<a name="l01652"></a>01652     <span class="keywordflow">if</span> (but) {
<a name="l01653"></a>01653         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1969f7180fb294c121308618f60a0aab">ui_is_but_utf8</a>(but)) {
<a name="l01654"></a>01654             <span class="keywordtype">int</span> strip = <a class="code" href="../../dd/d83/BLI__string__utf8_8h.html#a4a7507da90a84565361fcfcfb2b130f8">BLI_utf8_invalid_strip</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a2dc67a12dd52365c48fdc2460e8e7857">editstr</a>, <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a2dc67a12dd52365c48fdc2460e8e7857">editstr</a>));
<a name="l01655"></a>01655             <span class="comment">/* not a file?, strip non utf-8 chars */</span>
<a name="l01656"></a>01656             <span class="keywordflow">if</span> (strip) {
<a name="l01657"></a>01657                 <span class="comment">/* wont happen often so isn&#39;t that annoying to keep it here for a while */</span>
<a name="l01658"></a>01658                 printf(<span class="stringliteral">&quot;%s: invalid utf8 - stripped chars %d\n&quot;</span>, __func__, strip);
<a name="l01659"></a>01659             }
<a name="l01660"></a>01660         }
<a name="l01661"></a>01661         
<a name="l01662"></a>01662         <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>) {
<a name="l01663"></a>01663             <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> == 0)
<a name="l01664"></a>01664                 <a class="code" href="../../d1/d2f/interface__intern_8h.html#a835686af4003361c1a4fba2ecc05b43b">ui_searchbox_apply</a>(but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>);
<a name="l01665"></a>01665 
<a name="l01666"></a>01666             <a class="code" href="../../d1/d2f/interface__intern_8h.html#a53953afe2fe10956ea1af13a9ae0a4f3">ui_searchbox_free</a>(C, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>);
<a name="l01667"></a>01667             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01668"></a>01668         }
<a name="l01669"></a>01669         
<a name="l01670"></a>01670         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a2dc67a12dd52365c48fdc2460e8e7857">editstr</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01671"></a>01671         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a> = -1;
<a name="l01672"></a>01672     }
<a name="l01673"></a>01673     
<a name="l01674"></a>01674     <a class="code" href="../../de/d3c/wm__cursors_8c.html#ab8500ccfbffb6b57f4e0645e0f9a4759">WM_cursor_restore</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C));
<a name="l01675"></a>01675 }
<a name="l01676"></a>01676 
<a name="l01677"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ac05f134ba54998d022ad276c62195657">01677</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ac05f134ba54998d022ad276c62195657">ui_textedit_next_but</a>(<a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *actbut, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l01678"></a>01678 {
<a name="l01679"></a>01679     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l01680"></a>01680 
<a name="l01681"></a>01681     <span class="comment">/* label and roundbox can overlap real buttons (backdrops...) */</span>
<a name="l01682"></a>01682     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0388eda1f65113c4a15720e037c11cb4">ELEM4</a>(actbut-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#a0b7df70d4a086a227bc482b07e2bbbca">LABEL</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad19009702facf6995a6aa5dbdf1c871a">SEPR</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a20f5ee572977e66f70f3350e350a5ad9">ROUNDBOX</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#afc775e59075662398538111f1cbd3cba">LISTBOX</a>))
<a name="l01683"></a>01683         <span class="keywordflow">return</span>;
<a name="l01684"></a>01684 
<a name="l01685"></a>01685     <span class="keywordflow">for</span> (but = actbut-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>; but; but = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>) {
<a name="l01686"></a>01686         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa4fcf246fa95904d4151b46983f97f4e">ELEM7</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba24e799bd38fe08efb4756c63d8f78df9">TEX</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#aaf0952059602752258dccaa015d7b54a">NUM</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a53ab9b2f5a030a06d3a609f2aad1fde3">NUMABS</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#a14a9dde4adb789e686787aeff498bb10">NUMSLI</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a6cb451ada67e3dcb1d058adcd025b14c">HSVSLI</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a69f2c191e2c4babdd9dc28b8fb4d8a68">IDPOIN</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3a2c1c38a5465f6d46a2296e3ad09bbe">SEARCH_MENU</a>)) {
<a name="l01687"></a>01687             <span class="keywordflow">if</span> (!(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#aebc550f9a03ce3bd40d3c7a024c0f5a8">UI_BUT_DISABLED</a>)) {
<a name="l01688"></a>01688                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ace9a44756d7460fca8dd9f3eb9f807db">postbut</a> = but;
<a name="l01689"></a>01689                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#acfd4bf78a3b0c42ca0309227cf0fe11d">posttype</a> = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0bae112effebc0dedcb8bcf27f261510424">BUTTON_ACTIVATE_TEXT_EDITING</a>;
<a name="l01690"></a>01690                 <span class="keywordflow">return</span>;
<a name="l01691"></a>01691             }
<a name="l01692"></a>01692         }
<a name="l01693"></a>01693     }
<a name="l01694"></a>01694     <span class="keywordflow">for</span> (but = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a844299999568743bc189fcb02847e9e6">buttons</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; but != actbut; but = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>) {
<a name="l01695"></a>01695         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa4fcf246fa95904d4151b46983f97f4e">ELEM7</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba24e799bd38fe08efb4756c63d8f78df9">TEX</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#aaf0952059602752258dccaa015d7b54a">NUM</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a53ab9b2f5a030a06d3a609f2aad1fde3">NUMABS</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#a14a9dde4adb789e686787aeff498bb10">NUMSLI</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a6cb451ada67e3dcb1d058adcd025b14c">HSVSLI</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a69f2c191e2c4babdd9dc28b8fb4d8a68">IDPOIN</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3a2c1c38a5465f6d46a2296e3ad09bbe">SEARCH_MENU</a>)) {
<a name="l01696"></a>01696             <span class="keywordflow">if</span> (!(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#aebc550f9a03ce3bd40d3c7a024c0f5a8">UI_BUT_DISABLED</a>)) {
<a name="l01697"></a>01697                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ace9a44756d7460fca8dd9f3eb9f807db">postbut</a> = but;
<a name="l01698"></a>01698                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#acfd4bf78a3b0c42ca0309227cf0fe11d">posttype</a> = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0bae112effebc0dedcb8bcf27f261510424">BUTTON_ACTIVATE_TEXT_EDITING</a>;
<a name="l01699"></a>01699                 <span class="keywordflow">return</span>;
<a name="l01700"></a>01700             }
<a name="l01701"></a>01701         }
<a name="l01702"></a>01702     }
<a name="l01703"></a>01703 }
<a name="l01704"></a>01704 
<a name="l01705"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6ec2b232cb1316c2feed1067e3962c61">01705</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6ec2b232cb1316c2feed1067e3962c61">ui_textedit_prev_but</a>(<a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *actbut, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l01706"></a>01706 {
<a name="l01707"></a>01707     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l01708"></a>01708 
<a name="l01709"></a>01709     <span class="comment">/* label and roundbox can overlap real buttons (backdrops...) */</span>
<a name="l01710"></a>01710     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0388eda1f65113c4a15720e037c11cb4">ELEM4</a>(actbut-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#a0b7df70d4a086a227bc482b07e2bbbca">LABEL</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad19009702facf6995a6aa5dbdf1c871a">SEPR</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a20f5ee572977e66f70f3350e350a5ad9">ROUNDBOX</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#afc775e59075662398538111f1cbd3cba">LISTBOX</a>))
<a name="l01711"></a>01711         <span class="keywordflow">return</span>;
<a name="l01712"></a>01712 
<a name="l01713"></a>01713     <span class="keywordflow">for</span> (but = actbut-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a081d5bf07bacf5c1887d48811a094ce6">prev</a>; but; but = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a081d5bf07bacf5c1887d48811a094ce6">prev</a>) {
<a name="l01714"></a>01714         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa4fcf246fa95904d4151b46983f97f4e">ELEM7</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba24e799bd38fe08efb4756c63d8f78df9">TEX</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#aaf0952059602752258dccaa015d7b54a">NUM</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a53ab9b2f5a030a06d3a609f2aad1fde3">NUMABS</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#a14a9dde4adb789e686787aeff498bb10">NUMSLI</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a6cb451ada67e3dcb1d058adcd025b14c">HSVSLI</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a69f2c191e2c4babdd9dc28b8fb4d8a68">IDPOIN</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3a2c1c38a5465f6d46a2296e3ad09bbe">SEARCH_MENU</a>)) {
<a name="l01715"></a>01715             <span class="keywordflow">if</span> (!(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#aebc550f9a03ce3bd40d3c7a024c0f5a8">UI_BUT_DISABLED</a>)) {
<a name="l01716"></a>01716                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ace9a44756d7460fca8dd9f3eb9f807db">postbut</a> = but;
<a name="l01717"></a>01717                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#acfd4bf78a3b0c42ca0309227cf0fe11d">posttype</a> = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0bae112effebc0dedcb8bcf27f261510424">BUTTON_ACTIVATE_TEXT_EDITING</a>;
<a name="l01718"></a>01718                 <span class="keywordflow">return</span>;
<a name="l01719"></a>01719             }
<a name="l01720"></a>01720         }
<a name="l01721"></a>01721     }
<a name="l01722"></a>01722     <span class="keywordflow">for</span> (but = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a844299999568743bc189fcb02847e9e6">buttons</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>; but != actbut; but = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a081d5bf07bacf5c1887d48811a094ce6">prev</a>) {
<a name="l01723"></a>01723         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa4fcf246fa95904d4151b46983f97f4e">ELEM7</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba24e799bd38fe08efb4756c63d8f78df9">TEX</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#aaf0952059602752258dccaa015d7b54a">NUM</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a53ab9b2f5a030a06d3a609f2aad1fde3">NUMABS</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#a14a9dde4adb789e686787aeff498bb10">NUMSLI</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a6cb451ada67e3dcb1d058adcd025b14c">HSVSLI</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a69f2c191e2c4babdd9dc28b8fb4d8a68">IDPOIN</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3a2c1c38a5465f6d46a2296e3ad09bbe">SEARCH_MENU</a>)) {
<a name="l01724"></a>01724             <span class="keywordflow">if</span> (!(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#aebc550f9a03ce3bd40d3c7a024c0f5a8">UI_BUT_DISABLED</a>)) {
<a name="l01725"></a>01725                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ace9a44756d7460fca8dd9f3eb9f807db">postbut</a> = but;
<a name="l01726"></a>01726                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#acfd4bf78a3b0c42ca0309227cf0fe11d">posttype</a> = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0bae112effebc0dedcb8bcf27f261510424">BUTTON_ACTIVATE_TEXT_EDITING</a>;
<a name="l01727"></a>01727                 <span class="keywordflow">return</span>;
<a name="l01728"></a>01728             }
<a name="l01729"></a>01729         }
<a name="l01730"></a>01730     }
<a name="l01731"></a>01731 }
<a name="l01732"></a>01732 
<a name="l01733"></a>01733 
<a name="l01734"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aaaad6111fb18ec8117426c01e1b94654">01734</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aaaad6111fb18ec8117426c01e1b94654">ui_do_but_textedit</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01735"></a>01735 {
<a name="l01736"></a>01736     <span class="keywordtype">int</span> mx, my, changed = 0, inbox = 0, <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a8568effaf95c1efd2e0482ed79dfac4f">update</a> = 0, <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l01737"></a>01737 
<a name="l01738"></a>01738     <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l01739"></a>01739         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>:
<a name="l01740"></a>01740         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>:
<a name="l01741"></a>01741         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>:
<a name="l01742"></a>01742             <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>)
<a name="l01743"></a>01743                 <a class="code" href="../../d1/d2f/interface__intern_8h.html#a3b93b2adb6e032180c1f651bc69833e3">ui_searchbox_event</a>(C, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>, but, event);
<a name="l01744"></a>01744             
<a name="l01745"></a>01745             <span class="keywordflow">break</span>;
<a name="l01746"></a>01746         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#adc87b609a6285a24e23172a90734044c">RIGHTMOUSE</a>:
<a name="l01747"></a>01747         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>:
<a name="l01748"></a>01748             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l01749"></a>01749             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab781c61b8b3d2757829f9aa919e5f136">escapecancel</a> = 1;
<a name="l01750"></a>01750             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l01751"></a>01751             <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l01752"></a>01752             <span class="keywordflow">break</span>;
<a name="l01753"></a>01753         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>: {
<a name="l01754"></a>01754             
<a name="l01755"></a>01755             <span class="comment">/* exit on LMB only on RELEASE for searchbox, to mimic other popups, and allow multiple menu levels */</span>
<a name="l01756"></a>01756             <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>)
<a name="l01757"></a>01757                 inbox = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a8e6ef02fabdc9b6f8e9a3db49f533c47">ui_searchbox_inside</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>);
<a name="l01758"></a>01758 
<a name="l01759"></a>01759             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l01760"></a>01760                 mx = <span class="keyword">event</span>-&gt;x;
<a name="l01761"></a>01761                 my = <span class="keyword">event</span>-&gt;y;
<a name="l01762"></a>01762                 <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, block, &amp;mx, &amp;my);
<a name="l01763"></a>01763 
<a name="l01764"></a>01764                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a014cc2a109a3773c53c72ce9be68c1ba">ui_but_contains_pt</a>(but, mx, my)) {
<a name="l01765"></a>01765                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a924dae0cac304627a3e4ea0351990e7d">ui_textedit_set_cursor_pos</a>(but, data, mx);
<a name="l01766"></a>01766                     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a9e1c5eba82e63c614b0e8c15d4e58960">selsta</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a0053185238f0dbfebe5cdb6ecd8d3f6a">selend</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a04b51a804e09aa0ca8c7781a98083f40">pos</a>;
<a name="l01767"></a>01767                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a89683ee6a9ca8bf2c7e03174ce2c6cb9">selstartx</a> = mx;
<a name="l01768"></a>01768 
<a name="l01769"></a>01769                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a76040e4ffb28474e09a53e1e847423d7">BUTTON_STATE_TEXT_SELECTING</a>);
<a name="l01770"></a>01770                     <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l01771"></a>01771                 }
<a name="l01772"></a>01772                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inbox == 0) {
<a name="l01773"></a>01773                     <span class="comment">/* if searchbox, click outside will cancel */</span>
<a name="l01774"></a>01774                     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>)
<a name="l01775"></a>01775                         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab781c61b8b3d2757829f9aa919e5f136">escapecancel</a> = 1;
<a name="l01776"></a>01776                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l01777"></a>01777                     <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l01778"></a>01778                 }
<a name="l01779"></a>01779             }
<a name="l01780"></a>01780             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inbox) {
<a name="l01781"></a>01781                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l01782"></a>01782                 <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l01783"></a>01783             }
<a name="l01784"></a>01784             <span class="keywordflow">break</span>;
<a name="l01785"></a>01785         }
<a name="l01786"></a>01786     }
<a name="l01787"></a>01787 
<a name="l01788"></a>01788     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l01789"></a>01789         <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l01790"></a>01790             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a8691f4871880a2b71eef19973c0664e1">VKEY</a>:
<a name="l01791"></a>01791             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a16a045703cd7faafcbab3abe5953c4a2">XKEY</a>:
<a name="l01792"></a>01792             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a39f146afd78004fead59358c29028292">CKEY</a>:
<a name="l01793"></a>01793                 <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a> || event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7dc2b3fa9f4563111cb1a461a1117192">oskey</a>) {
<a name="l01794"></a>01794                     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a8691f4871880a2b71eef19973c0664e1">VKEY</a>)
<a name="l01795"></a>01795                         changed = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6465fa98860518ed130c5a4dcac429b1">ui_textedit_copypaste</a>(but, data, 1, 0, 0);
<a name="l01796"></a>01796                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a39f146afd78004fead59358c29028292">CKEY</a>)
<a name="l01797"></a>01797                         changed = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6465fa98860518ed130c5a4dcac429b1">ui_textedit_copypaste</a>(but, data, 0, 1, 0);
<a name="l01798"></a>01798                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a16a045703cd7faafcbab3abe5953c4a2">XKEY</a>)
<a name="l01799"></a>01799                         changed = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6465fa98860518ed130c5a4dcac429b1">ui_textedit_copypaste</a>(but, data, 0, 0, 1);
<a name="l01800"></a>01800 
<a name="l01801"></a>01801                     <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l01802"></a>01802                 }
<a name="l01803"></a>01803                 <span class="keywordflow">break</span>;
<a name="l01804"></a>01804             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a00226d1726c5da69413ce5e368332f0f">RIGHTARROWKEY</a>:
<a name="l01805"></a>01805                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a0b44892804f17fd345f26c35bd61686c">ui_textedit_move</a>(but, data, <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#a9bc309474f01fc4baa5e209ede950a70a11160a7af3b82fd0bac3a9cdc82d85a3">STRCUR_DIR_NEXT</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a> ? <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#ac2ec6cad011c2ef80b971425f9aba2baaef9a793f0d7ed50a55e7df63089b0a80">STRCUR_JUMP_DELIM</a> : <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#ac2ec6cad011c2ef80b971425f9aba2baab9fe3aa6f0405ad0c5179b20b609a8df">STRCUR_JUMP_NONE</a>);
<a name="l01806"></a>01806                 <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l01807"></a>01807                 <span class="keywordflow">break</span>;
<a name="l01808"></a>01808             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a10c4c00065059a135492a87a229162af">LEFTARROWKEY</a>:
<a name="l01809"></a>01809                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a0b44892804f17fd345f26c35bd61686c">ui_textedit_move</a>(but, data, <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#a9bc309474f01fc4baa5e209ede950a70ab1c3ab648baa8077d594d2bf4ca51311">STRCUR_DIR_PREV</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a> ? <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#ac2ec6cad011c2ef80b971425f9aba2baaef9a793f0d7ed50a55e7df63089b0a80">STRCUR_JUMP_DELIM</a> : STRCUR_JUMP_NONE);
<a name="l01810"></a>01810                 <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l01811"></a>01811                 <span class="keywordflow">break</span>;
<a name="l01812"></a>01812             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab85e7d9e3424f69f61d277f3aa68bff8">DOWNARROWKEY</a>:
<a name="l01813"></a>01813                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>) {
<a name="l01814"></a>01814                     <a class="code" href="../../d1/d2f/interface__intern_8h.html#a3b93b2adb6e032180c1f651bc69833e3">ui_searchbox_event</a>(C, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>, but, event);
<a name="l01815"></a>01815                     <span class="keywordflow">break</span>;
<a name="l01816"></a>01816                 }
<a name="l01817"></a>01817             <span class="comment">/* pass on purposedly */</span>
<a name="l01818"></a>01818             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a5ef1f3d0ca3b2e83d0ddefcacceaa4d7">ENDKEY</a>:
<a name="l01819"></a>01819                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a0b44892804f17fd345f26c35bd61686c">ui_textedit_move</a>(but, data, <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#a9bc309474f01fc4baa5e209ede950a70a11160a7af3b82fd0bac3a9cdc82d85a3">STRCUR_DIR_NEXT</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>, <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#ac2ec6cad011c2ef80b971425f9aba2baa24bdb1244779d5e5d1e0b1622acf985b">STRCUR_JUMP_ALL</a>);
<a name="l01820"></a>01820                 <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l01821"></a>01821                 <span class="keywordflow">break</span>;
<a name="l01822"></a>01822             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#afc161d5211a7975b71b2d478f936ad85">UPARROWKEY</a>:
<a name="l01823"></a>01823                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>) {
<a name="l01824"></a>01824                     <a class="code" href="../../d1/d2f/interface__intern_8h.html#a3b93b2adb6e032180c1f651bc69833e3">ui_searchbox_event</a>(C, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>, but, event);
<a name="l01825"></a>01825                     <span class="keywordflow">break</span>;
<a name="l01826"></a>01826                 }
<a name="l01827"></a>01827             <span class="comment">/* pass on purposedly */</span>
<a name="l01828"></a>01828             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a9ab826a2e86a9ccd0095979fc4726119">HOMEKEY</a>:
<a name="l01829"></a>01829                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a0b44892804f17fd345f26c35bd61686c">ui_textedit_move</a>(but, data, <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#a9bc309474f01fc4baa5e209ede950a70ab1c3ab648baa8077d594d2bf4ca51311">STRCUR_DIR_PREV</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>, <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#ac2ec6cad011c2ef80b971425f9aba2baa24bdb1244779d5e5d1e0b1622acf985b">STRCUR_JUMP_ALL</a>);
<a name="l01830"></a>01830                 <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l01831"></a>01831                 <span class="keywordflow">break</span>;
<a name="l01832"></a>01832             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aafdc675e684c8485e8e27c7f2bafcbef">PADENTER</a>:
<a name="l01833"></a>01833             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c861c5ebabe8fe076ed84a2aaa7a1a0">RETKEY</a>:
<a name="l01834"></a>01834                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l01835"></a>01835                 <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l01836"></a>01836                 <span class="keywordflow">break</span>;
<a name="l01837"></a>01837             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#adb5ce1680b5ec047cfc1f0de10f4e3f0">DELKEY</a>:
<a name="l01838"></a>01838                 changed = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ac70e61029f9858d66d54bcd6b26b46d4">ui_textedit_delete</a>(but, data, 1, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a> ? <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#ac2ec6cad011c2ef80b971425f9aba2baaef9a793f0d7ed50a55e7df63089b0a80">STRCUR_JUMP_DELIM</a> : STRCUR_JUMP_NONE);
<a name="l01839"></a>01839                 <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l01840"></a>01840                 <span class="keywordflow">break</span>;
<a name="l01841"></a>01841 
<a name="l01842"></a>01842             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aac0bf168bc790ab56adc890c4e8580bb">BACKSPACEKEY</a>:
<a name="l01843"></a>01843                 changed = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ac70e61029f9858d66d54bcd6b26b46d4">ui_textedit_delete</a>(but, data, 0, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a> ? <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#ac2ec6cad011c2ef80b971425f9aba2baa24bdb1244779d5e5d1e0b1622acf985b">STRCUR_JUMP_ALL</a> :  (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a> ? <a class="code" href="../../db/dc0/BLI__string__cursor__utf8_8h.html#ac2ec6cad011c2ef80b971425f9aba2baaef9a793f0d7ed50a55e7df63089b0a80">STRCUR_JUMP_DELIM</a> : STRCUR_JUMP_NONE));
<a name="l01844"></a>01844                 <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l01845"></a>01845                 <span class="keywordflow">break</span>;
<a name="l01846"></a>01846                 
<a name="l01847"></a>01847             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a67d5864c4d46748f0c7ee7a4fc30561d">TABKEY</a>:
<a name="l01848"></a>01848                 <span class="comment">/* there is a key conflict here, we can&#39;t tab with autocomplete */</span>
<a name="l01849"></a>01849                 <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a047f5bac82edb60cf1ddb511ae0b997b">autocomplete_func</a> || data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>) {
<a name="l01850"></a>01850                     changed = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aeacdf67a54130969eaf5b87b5c204b73">ui_textedit_autocomplete</a>(C, but, data);
<a name="l01851"></a>01851                     <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a8568effaf95c1efd2e0482ed79dfac4f">update</a> = 1; <span class="comment">/* do live update for tab key */</span>
<a name="l01852"></a>01852                 }
<a name="l01853"></a>01853                 <span class="comment">/* the hotkey here is not well defined, was G.qual so we check all */</span>
<a name="l01854"></a>01854                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a> || event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a> || event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a> || event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7dc2b3fa9f4563111cb1a461a1117192">oskey</a>) {
<a name="l01855"></a>01855                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6ec2b232cb1316c2feed1067e3962c61">ui_textedit_prev_but</a>(block, but, data);
<a name="l01856"></a>01856                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l01857"></a>01857                 }
<a name="l01858"></a>01858                 <span class="keywordflow">else</span> {
<a name="l01859"></a>01859                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ac05f134ba54998d022ad276c62195657">ui_textedit_next_but</a>(block, but, data);
<a name="l01860"></a>01860                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l01861"></a>01861                 }
<a name="l01862"></a>01862                 <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l01863"></a>01863                 <span class="keywordflow">break</span>;
<a name="l01864"></a>01864         }
<a name="l01865"></a>01865 
<a name="l01866"></a>01866         <span class="keywordflow">if</span> ((event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#af3606467f06540b8776a50419af70a71">ascii</a> || event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7e92e407c04b50dd9fddc03f7044c2b4">utf8_buf</a>[0]) &amp;&amp; (<a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>)) {
<a name="l01867"></a>01867             <span class="keywordtype">char</span> ascii = <span class="keyword">event</span>-&gt;ascii;
<a name="l01868"></a>01868             <span class="keyword">const</span> <span class="keywordtype">char</span> *utf8_buf = <span class="keyword">event</span>-&gt;utf8_buf;
<a name="l01869"></a>01869 
<a name="l01870"></a>01870             <span class="comment">/* exception that&#39;s useful for number buttons, some keyboard</span>
<a name="l01871"></a>01871 <span class="comment">             * numpads have a comma instead of a period */</span>
<a name="l01872"></a>01872             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#aaf0952059602752258dccaa015d7b54a">NUM</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a53ab9b2f5a030a06d3a609f2aad1fde3">NUMABS</a>, <a class="code" href="../../d9/dc4/plugin_8h.html#a14a9dde4adb789e686787aeff498bb10">NUMSLI</a>)) { <span class="comment">/* could use data-&gt;min*/</span>
<a name="l01873"></a>01873                 <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab45280c6bf516a0393fb11baf0047244">PADPERIOD</a> &amp;&amp; ascii == <span class="charliteral">&#39;,&#39;</span>) {
<a name="l01874"></a>01874                     ascii = <span class="charliteral">&#39;.&#39;</span>;
<a name="l01875"></a>01875                     utf8_buf = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">/* force ascii fallback */</span>
<a name="l01876"></a>01876                 }
<a name="l01877"></a>01877             }
<a name="l01878"></a>01878 
<a name="l01879"></a>01879             <span class="keywordflow">if</span> (utf8_buf &amp;&amp; utf8_buf[0]) {
<a name="l01880"></a>01880                 <span class="keywordtype">int</span> utf8_buf_len = <a class="code" href="../../dd/d83/BLI__string__utf8_8h.html#ac28dea96012eef5bd4cd541b9f447bef">BLI_str_utf8_size</a>(utf8_buf);
<a name="l01881"></a>01881                 <span class="comment">/* keep this printf until utf8 is well tested */</span>
<a name="l01882"></a>01882                 <span class="keywordflow">if</span> (utf8_buf_len != 1) {
<a name="l01883"></a>01883                     printf(<span class="stringliteral">&quot;%s: utf8 char &#39;%.*s&#39;\n&quot;</span>, __func__, utf8_buf_len, utf8_buf);
<a name="l01884"></a>01884                 }
<a name="l01885"></a>01885 
<a name="l01886"></a>01886                 <span class="comment">// strcpy(utf8_buf, &quot;12345&quot;);</span>
<a name="l01887"></a>01887                 changed = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a4c86c8a66824d216d1ff27c3c1d6e637">ui_textedit_type_buf</a>(but, data, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7e92e407c04b50dd9fddc03f7044c2b4">utf8_buf</a>, utf8_buf_len);
<a name="l01888"></a>01888             }
<a name="l01889"></a>01889             <span class="keywordflow">else</span> {
<a name="l01890"></a>01890                 changed = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa5c3e0495a83639c6f090650c2beb9d8">ui_textedit_type_ascii</a>(but, data, ascii);
<a name="l01891"></a>01891             }
<a name="l01892"></a>01892 
<a name="l01893"></a>01893             <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l01894"></a>01894             
<a name="l01895"></a>01895         }
<a name="l01896"></a>01896         <span class="comment">/* textbutton with magnifier icon: do live update for search button */</span>
<a name="l01897"></a>01897         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abb0eba9aee4e0fc4169591b35fabddf8">icon</a> == ICON_VIEWZOOM)
<a name="l01898"></a>01898             <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a8568effaf95c1efd2e0482ed79dfac4f">update</a> = 1;
<a name="l01899"></a>01899     }
<a name="l01900"></a>01900 
<a name="l01901"></a>01901     <span class="keywordflow">if</span> (changed) {
<a name="l01902"></a>01902         <span class="comment">/* only update when typing for TAB key */</span>
<a name="l01903"></a>01903         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d49/node__composite__tree_8c.html#a8568effaf95c1efd2e0482ed79dfac4f">update</a> &amp;&amp; data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ae0ab7227e9e4ef09a14fa9a47f76f6fc">interactive</a>) <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a87504e0357211849ab7661ff46be2fef">ui_apply_button</a>(C, block, but, data, 1);
<a name="l01904"></a>01904         <span class="keywordflow">else</span> <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(but);
<a name="l01905"></a>01905         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a79a07b15461a1d0240664d9accf9a0f9">changed</a> = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01906"></a>01906         
<a name="l01907"></a>01907         <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>)
<a name="l01908"></a>01908             <a class="code" href="../../d1/d2f/interface__intern_8h.html#aae288b30925758ae31e39088e4185cb3">ui_searchbox_update</a>(C, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a>, but, 1);  <span class="comment">/* 1 = reset */</span>
<a name="l01909"></a>01909     }
<a name="l01910"></a>01910 
<a name="l01911"></a>01911     <span class="keywordflow">if</span> (changed || (<a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>))
<a name="l01912"></a>01912         <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>);
<a name="l01913"></a>01913 }
<a name="l01914"></a>01914 
<a name="l01915"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa768b4d0647c55e2552f1a08fbfd6af2">01915</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa768b4d0647c55e2552f1a08fbfd6af2">ui_do_but_textedit_select</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01916"></a>01916 {
<a name="l01917"></a>01917     <span class="keywordtype">int</span> mx, my, <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l01918"></a>01918 
<a name="l01919"></a>01919     <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l01920"></a>01920         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>: {
<a name="l01921"></a>01921             mx = <span class="keyword">event</span>-&gt;x;
<a name="l01922"></a>01922             my = <span class="keyword">event</span>-&gt;y;
<a name="l01923"></a>01923             <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, block, &amp;mx, &amp;my);
<a name="l01924"></a>01924 
<a name="l01925"></a>01925             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3c2634fc63c1ca63c4b82af0c1fe7a4a">ui_textedit_set_cursor_select</a>(but, data, mx);
<a name="l01926"></a>01926             retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l01927"></a>01927             <span class="keywordflow">break</span>;
<a name="l01928"></a>01928         }
<a name="l01929"></a>01929         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>:
<a name="l01930"></a>01930             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>)
<a name="l01931"></a>01931                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">BUTTON_STATE_TEXT_EDITING</a>);
<a name="l01932"></a>01932             retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l01933"></a>01933             <span class="keywordflow">break</span>;
<a name="l01934"></a>01934     }
<a name="l01935"></a>01935 
<a name="l01936"></a>01936     <span class="keywordflow">if</span> (retval == <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>) {
<a name="l01937"></a>01937         <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(but);
<a name="l01938"></a>01938         <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>);
<a name="l01939"></a>01939     }
<a name="l01940"></a>01940 }
<a name="l01941"></a>01941 
<a name="l01942"></a>01942 <span class="comment">/* ************* number editing for various types ************* */</span>
<a name="l01943"></a>01943 
<a name="l01944"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aafafed7a295715ebcb05cffedfeaf95e">01944</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aafafed7a295715ebcb05cffedfeaf95e">ui_numedit_begin</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l01945"></a>01945 {
<a name="l01946"></a>01946     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a55737ebfa3a2ec487e87544adbf7e457">BUT_CURVE</a>) {
<a name="l01947"></a>01947         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ad49fa037c1b45e3c5ae4675dbc57a66a">editcumap</a> = (<a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *)but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>;
<a name="l01948"></a>01948     }
<a name="l01949"></a>01949     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a84c5d75a8e1a067bb3def3f69049b22a">BUT_COLORBAND</a>) {
<a name="l01950"></a>01950         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a12b850e20f8fcc35285b276e31ce2af5">coba</a> = (<a class="code" href="../../d0/dc8/structColorBand.html">ColorBand</a> *)but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>;
<a name="l01951"></a>01951         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa10ebb6a93a76dd67b2ebf1722cfa8bc">editcoba</a> = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a12b850e20f8fcc35285b276e31ce2af5">coba</a>;
<a name="l01952"></a>01952     }
<a name="l01953"></a>01953     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8823a24e6af14c65bb48fed8e6d8e4ad">BUT_NORMAL</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#aaaed62f927be1bd36851e7a3008a35c2">HSVCUBE</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#af5b7a7238e8eaabdbec6a107c41f426a">HSVCIRCLE</a>)) {
<a name="l01954"></a>01954         <a class="code" href="../../dd/dda/interface_8c.html#a12cb3aabf09cc9d093a80b0bc9ed98aa">ui_get_but_vectorf</a>(but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5ae96cbb3abbb1fcabf95027b029464c">origvec</a>);
<a name="l01955"></a>01955         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5ae96cbb3abbb1fcabf95027b029464c">origvec</a>);
<a name="l01956"></a>01956         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a2273f07ffed872fc272ee74d2bc046e6">editvec</a> = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>;
<a name="l01957"></a>01957     }
<a name="l01958"></a>01958     <span class="keywordflow">else</span> {
<a name="l01959"></a>01959         <span class="keywordtype">float</span> softrange, softmin, softmax;
<a name="l01960"></a>01960 
<a name="l01961"></a>01961         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0ef0fa5774082c955d46603ce60df9bb">startvalue</a> = <a class="code" href="../../dd/dda/interface_8c.html#acbe9b206aab37f6c325e7107c33c0cb6">ui_get_but_val</a>(but);
<a name="l01962"></a>01962         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a6e4b95019c68fe9e30440340115fe5ec">origvalue</a> = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0ef0fa5774082c955d46603ce60df9bb">startvalue</a>;
<a name="l01963"></a>01963         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a6e4b95019c68fe9e30440340115fe5ec">origvalue</a>;
<a name="l01964"></a>01964         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a3ecb7699098b8764b7587a680dd85e1a">editval</a> = &amp;data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a>;
<a name="l01965"></a>01965 
<a name="l01966"></a>01966         softmin = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a3e77370ad783c9c9679b9afb3d0f49a9">softmin</a>;
<a name="l01967"></a>01967         softmax = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ac8f6bc84beed56ee707d4da30047be37">softmax</a>;
<a name="l01968"></a>01968         softrange = softmax - softmin;
<a name="l01969"></a>01969 
<a name="l01970"></a>01970         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a6b16641cad6da7ba6a135c70add30318">dragfstart</a> = (softrange == 0.0f) ? 0.0f : ((<span class="keywordtype">float</span>)data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> - softmin) / softrange;
<a name="l01971"></a>01971         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0294a9536f14b44114f578e7a9cf304d">dragf</a> = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a6b16641cad6da7ba6a135c70add30318">dragfstart</a>;
<a name="l01972"></a>01972     }
<a name="l01973"></a>01973 
<a name="l01974"></a>01974     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab4df4530c50ab91a8cf958000e3c5a29">dragchange</a> = 0;
<a name="l01975"></a>01975     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ac5d8c722c791292345906a2336f92549">draglock</a> = 1;
<a name="l01976"></a>01976 }
<a name="l01977"></a>01977 
<a name="l01978"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a75d18f02c6196701af0d7bac92b33fc0">01978</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a75d18f02c6196701af0d7bac92b33fc0">ui_numedit_end</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l01979"></a>01979 {
<a name="l01980"></a>01980     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a3ecb7699098b8764b7587a680dd85e1a">editval</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01981"></a>01981     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a2273f07ffed872fc272ee74d2bc046e6">editvec</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01982"></a>01982     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa10ebb6a93a76dd67b2ebf1722cfa8bc">editcoba</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01983"></a>01983     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ad49fa037c1b45e3c5ae4675dbc57a66a">editcumap</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01984"></a>01984 
<a name="l01985"></a>01985     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> = 0;
<a name="l01986"></a>01986     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = 0;
<a name="l01987"></a>01987     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab4df4530c50ab91a8cf958000e3c5a29">dragchange</a> = 0;
<a name="l01988"></a>01988     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ae3f3ece330f105e0bb31533e28ef16cd">dragcbd</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01989"></a>01989     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4625a175437558a84bbd1f780fb22569">dragsel</a> = 0;
<a name="l01990"></a>01990 }
<a name="l01991"></a>01991 
<a name="l01992"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">01992</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l01993"></a>01993 {
<a name="l01994"></a>01994     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ae0ab7227e9e4ef09a14fa9a47f76f6fc">interactive</a>) <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a87504e0357211849ab7661ff46be2fef">ui_apply_button</a>(C, block, but, data, 1);
<a name="l01995"></a>01995     <span class="keywordflow">else</span> <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(but);
<a name="l01996"></a>01996 
<a name="l01997"></a>01997     <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>);
<a name="l01998"></a>01998 }
<a name="l01999"></a>01999 
<a name="l02000"></a>02000 <span class="comment">/* ****************** menu opening for various types **************** */</span>
<a name="l02001"></a>02001 
<a name="l02002"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9987db2d7a7751bb495144f869862103">02002</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9987db2d7a7751bb495144f869862103">ui_blockopen_begin</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l02003"></a>02003 {
<a name="l02004"></a>02004     <a class="code" href="../../d8/d1e/UI__interface_8h.html#ab8f819facebe02e99f4c615cd0dcc823">uiBlockCreateFunc</a> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a2b5142f94288c43434f6d3ace9f6dd21">func</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02005"></a>02005     <a class="code" href="../../d1/d2f/interface__intern_8h.html#a29bfb5d45601afa04c311fc3486af762">uiBlockHandleCreateFunc</a> handlefunc = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02006"></a>02006     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a476acffbfc566ea090b1de663c630d8d">uiMenuCreateFunc</a> menufunc = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02007"></a>02007     <span class="keywordtype">char</span> *menustr = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02008"></a>02008     <span class="keywordtype">void</span> *arg = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02009"></a>02009 
<a name="l02010"></a>02010     <span class="keywordflow">switch</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>) {
<a name="l02011"></a>02011         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a52220397ecea855b3a99746e451426e1">BLOCK</a>:
<a name="l02012"></a>02012         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a917e2674b6708b555abe909f360b12e1">PULLDOWN</a>:
<a name="l02013"></a>02013             <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7cc945eb027800c65eac0d9457a7f548">menu_create_func</a>) {
<a name="l02014"></a>02014                 menufunc = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7cc945eb027800c65eac0d9457a7f548">menu_create_func</a>;
<a name="l02015"></a>02015                 arg = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>;
<a name="l02016"></a>02016             }
<a name="l02017"></a>02017             <span class="keywordflow">else</span> {
<a name="l02018"></a>02018                 func = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ac03525e646e45bc007a2a6d84c886325">block_create_func</a>;
<a name="l02019"></a>02019                 arg = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> ? but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> : but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#af44dd4115db2000459a0ffc72a9bc092">func_argN</a>;
<a name="l02020"></a>02020             }
<a name="l02021"></a>02021             <span class="keywordflow">break</span>;
<a name="l02022"></a>02022         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad0d059e6a83d21bea4f4db1c9fbd240b">MENU</a>:
<a name="l02023"></a>02023             <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7cc945eb027800c65eac0d9457a7f548">menu_create_func</a>) {
<a name="l02024"></a>02024                 menufunc = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7cc945eb027800c65eac0d9457a7f548">menu_create_func</a>;
<a name="l02025"></a>02025                 arg = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>;
<a name="l02026"></a>02026             }
<a name="l02027"></a>02027             <span class="keywordflow">else</span> {
<a name="l02028"></a>02028                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a6e4b95019c68fe9e30440340115fe5ec">origvalue</a> = <a class="code" href="../../dd/dda/interface_8c.html#acbe9b206aab37f6c325e7107c33c0cb6">ui_get_but_val</a>(but);
<a name="l02029"></a>02029                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a6e4b95019c68fe9e30440340115fe5ec">origvalue</a>;
<a name="l02030"></a>02030                 but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a3ecb7699098b8764b7587a680dd85e1a">editval</a> = &amp;data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a>;
<a name="l02031"></a>02031 
<a name="l02032"></a>02032                 menustr = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#af58de45f45814332509809d691cc70f9">str</a>;
<a name="l02033"></a>02033             }
<a name="l02034"></a>02034             <span class="keywordflow">break</span>;
<a name="l02035"></a>02035         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#af6ad4ca5cd637c3ab6dad8114b8d3e75">ICONROW</a>:
<a name="l02036"></a>02036             menufunc = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a56f8f17b1d1b6f7f6da571180f0866ba">ui_block_func_ICONROW</a>;
<a name="l02037"></a>02037             arg = but;
<a name="l02038"></a>02038             <span class="keywordflow">break</span>;
<a name="l02039"></a>02039         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5975b2d368ff03c7359503587664fba5">ICONTEXTROW</a>:
<a name="l02040"></a>02040             menufunc = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a7bc87b139f9cd3dd6fba732ef3c14351">ui_block_func_ICONTEXTROW</a>;
<a name="l02041"></a>02041             arg = but;
<a name="l02042"></a>02042             <span class="keywordflow">break</span>;
<a name="l02043"></a>02043         <span class="keywordflow">case</span> <a class="code" href="../../dd/d8b/intern_2opennl_2superlu_2util_8h.html#a4d92d07523ba751afadecd63d3479e30a3e66f07732b51f2cb52e13d598f8abda">COL</a>:
<a name="l02044"></a>02044             <a class="code" href="../../dd/dda/interface_8c.html#a12cb3aabf09cc9d093a80b0bc9ed98aa">ui_get_but_vectorf</a>(but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5ae96cbb3abbb1fcabf95027b029464c">origvec</a>);
<a name="l02045"></a>02045             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5ae96cbb3abbb1fcabf95027b029464c">origvec</a>);
<a name="l02046"></a>02046             but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a2273f07ffed872fc272ee74d2bc046e6">editvec</a> = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>;
<a name="l02047"></a>02047 
<a name="l02048"></a>02048             handlefunc = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a4135e979952d33a68d4d337f6fc68781">ui_block_func_COL</a>;
<a name="l02049"></a>02049             arg = but;
<a name="l02050"></a>02050             <span class="keywordflow">break</span>;
<a name="l02051"></a>02051     }
<a name="l02052"></a>02052 
<a name="l02053"></a>02053     <span class="keywordflow">if</span> (func || handlefunc) {
<a name="l02054"></a>02054         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a> = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a1d045829ff121445f2a42e365633a476">ui_popup_block_create</a>(C, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, but, func, handlefunc, arg);
<a name="l02055"></a>02055         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a5c195fe9502deed2ddbcdb3edadae776">handle</a>)
<a name="l02056"></a>02056             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a>-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#ac355a67eb10be3b2f0aa792d10aa58f8">popup</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a5c195fe9502deed2ddbcdb3edadae776">handle</a>-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#ac355a67eb10be3b2f0aa792d10aa58f8">popup</a>;
<a name="l02057"></a>02057     }
<a name="l02058"></a>02058     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (menufunc || menustr) {
<a name="l02059"></a>02059         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a> = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a78afff7d9fbbf0c238192d2a345121b3">ui_popup_menu_create</a>(C, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, but, menufunc, arg, menustr);
<a name="l02060"></a>02060         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a5c195fe9502deed2ddbcdb3edadae776">handle</a>)
<a name="l02061"></a>02061             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a>-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#ac355a67eb10be3b2f0aa792d10aa58f8">popup</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a5c195fe9502deed2ddbcdb3edadae776">handle</a>-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#ac355a67eb10be3b2f0aa792d10aa58f8">popup</a>;
<a name="l02062"></a>02062     }
<a name="l02063"></a>02063 
<a name="l02064"></a>02064     <span class="comment">/* this makes adjacent blocks auto open from now on */</span>
<a name="l02065"></a>02065     <span class="comment">//if (but-&gt;block-&gt;auto_open==0) but-&gt;block-&gt;auto_open= 1;</span>
<a name="l02066"></a>02066 }
<a name="l02067"></a>02067 
<a name="l02068"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a87be4a69d67815ee8354f3b0e893e04c">02068</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a87be4a69d67815ee8354f3b0e893e04c">ui_blockopen_end</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l02069"></a>02069 {
<a name="l02070"></a>02070     <span class="keywordflow">if</span> (but) {
<a name="l02071"></a>02071         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a3ecb7699098b8764b7587a680dd85e1a">editval</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02072"></a>02072         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a2273f07ffed872fc272ee74d2bc046e6">editvec</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02073"></a>02073 
<a name="l02074"></a>02074         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a6ed542cf1a8c299bbf626e619dce1cad">auto_open_last</a> = <a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>();
<a name="l02075"></a>02075     }
<a name="l02076"></a>02076 
<a name="l02077"></a>02077     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a>) {
<a name="l02078"></a>02078         <a class="code" href="../../d1/d2f/interface__intern_8h.html#a701a60081b1f2beff057c0aa8df9d2bd">ui_popup_block_free</a>(C, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a>);
<a name="l02079"></a>02079         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02080"></a>02080     }
<a name="l02081"></a>02081 }
<a name="l02082"></a>02082 
<a name="l02083"></a>02083 <span class="comment">/* ***************** events for different button types *************** */</span>
<a name="l02084"></a>02084 
<a name="l02085"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9accbab2570622640f6eb24ae1cc59de">02085</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9accbab2570622640f6eb24ae1cc59de">ui_do_but_BUT</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02086"></a>02086 {
<a name="l02087"></a>02087     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l02088"></a>02088         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02089"></a>02089             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a9fa352d4981373c052341e4a7dfd7c3d">BUTTON_STATE_WAIT_RELEASE</a>);
<a name="l02090"></a>02090             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02091"></a>02091         }
<a name="l02092"></a>02092         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a5c195fe9502deed2ddbcdb3edadae776">handle</a>) {
<a name="l02093"></a>02093             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02094"></a>02094             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02095"></a>02095         }
<a name="l02096"></a>02096         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aafdc675e684c8485e8e27c7f2bafcbef">PADENTER</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c861c5ebabe8fe076ed84a2aaa7a1a0">RETKEY</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02097"></a>02097             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a3bf879676619cb413082552088d9360e">BUTTON_STATE_WAIT_FLASH</a>);
<a name="l02098"></a>02098             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02099"></a>02099         }
<a name="l02100"></a>02100     }
<a name="l02101"></a>02101     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a9fa352d4981373c052341e4a7dfd7c3d">BUTTON_STATE_WAIT_RELEASE</a>) {
<a name="l02102"></a>02102         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02103"></a>02103             <span class="keywordflow">if</span> (!(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d1/d2f/interface__intern_8h.html#ada5088cd71649979ef58a9b21e0420cb">UI_SELECT</a>))
<a name="l02104"></a>02104                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l02105"></a>02105             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02106"></a>02106             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02107"></a>02107         }
<a name="l02108"></a>02108     }
<a name="l02109"></a>02109 
<a name="l02110"></a>02110     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l02111"></a>02111 }
<a name="l02112"></a>02112 
<a name="l02113"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1eaed974c7d40d310bc5eea76ab2521a">02113</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1eaed974c7d40d310bc5eea76ab2521a">ui_do_but_HOTKEYEVT</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02114"></a>02114 {
<a name="l02115"></a>02115     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l02116"></a>02116         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aafdc675e684c8485e8e27c7f2bafcbef">PADENTER</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c861c5ebabe8fe076ed84a2aaa7a1a0">RETKEY</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02117"></a>02117             but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ad10198140dc5e52877630009f81879f7">drawstr</a>[0] = 0;
<a name="l02118"></a>02118             but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a129f4aaa041736074f1f6bd2965cc822">modifier_key</a> = 0;
<a name="l02119"></a>02119             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a827cee8974dbe7169ecaed8f9137d7c3">BUTTON_STATE_WAIT_KEY_EVENT</a>);
<a name="l02120"></a>02120             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02121"></a>02121         }
<a name="l02122"></a>02122     }
<a name="l02123"></a>02123     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a827cee8974dbe7169ecaed8f9137d7c3">BUTTON_STATE_WAIT_KEY_EVENT</a>) {
<a name="l02124"></a>02124         
<a name="l02125"></a>02125         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>)
<a name="l02126"></a>02126             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l02127"></a>02127         
<a name="l02128"></a>02128         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02129"></a>02129             <span class="comment">/* only cancel if click outside the button */</span>
<a name="l02130"></a>02130             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a96d54676d1014fb5361f50b5adf8f322">ui_mouse_inside_button</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, but, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>) == 0) {
<a name="l02131"></a>02131                 <span class="comment">/* data-&gt;cancel doesnt work, this button opens immediate */</span>
<a name="l02132"></a>02132                 <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a45aed21d420717e9b0a1babb03ba5a78">UI_BUT_IMMEDIATE</a>)
<a name="l02133"></a>02133                     <a class="code" href="../../dd/dda/interface_8c.html#a02d9f599cc619a5ca1e7f59366710cc6">ui_set_but_val</a>(but, 0);
<a name="l02134"></a>02134                 <span class="keywordflow">else</span>
<a name="l02135"></a>02135                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l02136"></a>02136                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02137"></a>02137                 <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02138"></a>02138             }
<a name="l02139"></a>02139         }
<a name="l02140"></a>02140         
<a name="l02141"></a>02141         <span class="comment">/* always set */</span>
<a name="l02142"></a>02142         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a129f4aaa041736074f1f6bd2965cc822">modifier_key</a> = 0;
<a name="l02143"></a>02143         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>) but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a129f4aaa041736074f1f6bd2965cc822">modifier_key</a> |= <a class="code" href="../../d4/ddc/WM__types_8h.html#a32a2f28ef75077bda99b29dfed8c991e">KM_SHIFT</a>;
<a name="l02144"></a>02144         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a>) but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a129f4aaa041736074f1f6bd2965cc822">modifier_key</a> |= <a class="code" href="../../d4/ddc/WM__types_8h.html#afa066cdfa1a8af7a98e45c83860b4abe">KM_ALT</a>;
<a name="l02145"></a>02145         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a>) but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a129f4aaa041736074f1f6bd2965cc822">modifier_key</a> |= <a class="code" href="../../d4/ddc/WM__types_8h.html#ab1edce62abb6c90ee2059ba76da20b50">KM_CTRL</a>;
<a name="l02146"></a>02146         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7dc2b3fa9f4563111cb1a461a1117192">oskey</a>) but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a129f4aaa041736074f1f6bd2965cc822">modifier_key</a> |= <a class="code" href="../../d4/ddc/WM__types_8h.html#afabd9010bd0eeba9b334c5f4d190d4de">KM_OSKEY</a>;
<a name="l02147"></a>02147 
<a name="l02148"></a>02148         <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(but);
<a name="l02149"></a>02149         <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>);
<a name="l02150"></a>02150             
<a name="l02151"></a>02151         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02152"></a>02152             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d40/wm__event__types_8h.html#a3a39f5bb1ebf60eb1004a054abb05dce">ISHOTKEY</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>)) { 
<a name="l02153"></a>02153                 
<a name="l02154"></a>02154                 <span class="keywordflow">if</span> (<a class="code" href="../../d7/d78/wm__keymap_8c.html#a61e8e3f9cf78fd460081f9a28bb98a24">WM_key_event_string</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>)[0])
<a name="l02155"></a>02155                     <a class="code" href="../../dd/dda/interface_8c.html#a02d9f599cc619a5ca1e7f59366710cc6">ui_set_but_val</a>(but, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>);
<a name="l02156"></a>02156                 <span class="keywordflow">else</span>
<a name="l02157"></a>02157                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l02158"></a>02158                 
<a name="l02159"></a>02159                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02160"></a>02160                 <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02161"></a>02161             }
<a name="l02162"></a>02162             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>) {
<a name="l02163"></a>02163                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l02164"></a>02164                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab781c61b8b3d2757829f9aa919e5f136">escapecancel</a> = 1;
<a name="l02165"></a>02165                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02166"></a>02166             }
<a name="l02167"></a>02167             
<a name="l02168"></a>02168         }
<a name="l02169"></a>02169     }
<a name="l02170"></a>02170     
<a name="l02171"></a>02171     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l02172"></a>02172 }
<a name="l02173"></a>02173 
<a name="l02174"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a77015cd96a8346e120a813902ec7bca6">02174</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a77015cd96a8346e120a813902ec7bca6">ui_do_but_KEYEVT</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02175"></a>02175 {
<a name="l02176"></a>02176     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l02177"></a>02177         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aafdc675e684c8485e8e27c7f2bafcbef">PADENTER</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c861c5ebabe8fe076ed84a2aaa7a1a0">RETKEY</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02178"></a>02178             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a827cee8974dbe7169ecaed8f9137d7c3">BUTTON_STATE_WAIT_KEY_EVENT</a>);
<a name="l02179"></a>02179             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02180"></a>02180         }
<a name="l02181"></a>02181     }
<a name="l02182"></a>02182     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a827cee8974dbe7169ecaed8f9137d7c3">BUTTON_STATE_WAIT_KEY_EVENT</a>) {
<a name="l02183"></a>02183         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>)
<a name="l02184"></a>02184             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l02185"></a>02185 
<a name="l02186"></a>02186         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02187"></a>02187             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d78/wm__keymap_8c.html#a61e8e3f9cf78fd460081f9a28bb98a24">WM_key_event_string</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>)[0])
<a name="l02188"></a>02188                 <a class="code" href="../../dd/dda/interface_8c.html#a02d9f599cc619a5ca1e7f59366710cc6">ui_set_but_val</a>(but, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>);
<a name="l02189"></a>02189             <span class="keywordflow">else</span>
<a name="l02190"></a>02190                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l02191"></a>02191 
<a name="l02192"></a>02192             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02193"></a>02193         }
<a name="l02194"></a>02194     }
<a name="l02195"></a>02195 
<a name="l02196"></a>02196     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l02197"></a>02197 }
<a name="l02198"></a>02198 
<a name="l02199"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aff43191a22fd081747edfb752ff3ac1f">02199</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aff43191a22fd081747edfb752ff3ac1f">ui_do_but_TEX</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02200"></a>02200 {
<a name="l02201"></a>02201     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l02202"></a>02202         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a7e76795d5874bd49d91359d64a6f3ef3">EVT_BUT_OPEN</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02203"></a>02203             <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a486f282b2878bbf7f64fca93798db45e">dt</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a54c054495b4966d6e51e0c5ccb5d72f4">UI_EMBOSSN</a> &amp;&amp; !event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a>) ;
<a name="l02204"></a>02204             <span class="keywordflow">else</span> {
<a name="l02205"></a>02205                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">BUTTON_STATE_TEXT_EDITING</a>);
<a name="l02206"></a>02206                 <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02207"></a>02207             }
<a name="l02208"></a>02208         }
<a name="l02209"></a>02209     }
<a name="l02210"></a>02210     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">BUTTON_STATE_TEXT_EDITING</a>) {
<a name="l02211"></a>02211         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aaaad6111fb18ec8117426c01e1b94654">ui_do_but_textedit</a>(C, block, but, data, event);
<a name="l02212"></a>02212         <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02213"></a>02213     }
<a name="l02214"></a>02214     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a76040e4ffb28474e09a53e1e847423d7">BUTTON_STATE_TEXT_SELECTING</a>) {
<a name="l02215"></a>02215         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa768b4d0647c55e2552f1a08fbfd6af2">ui_do_but_textedit_select</a>(C, block, but, data, event);
<a name="l02216"></a>02216         <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02217"></a>02217     }
<a name="l02218"></a>02218 
<a name="l02219"></a>02219     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l02220"></a>02220 }
<a name="l02221"></a>02221 
<a name="l02222"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#acecc421b8b8ccc19fd08f237f1ec6695">02222</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#acecc421b8b8ccc19fd08f237f1ec6695">ui_do_but_TOG</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02223"></a>02223 {
<a name="l02224"></a>02224     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l02225"></a>02225         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aafdc675e684c8485e8e27c7f2bafcbef">PADENTER</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c861c5ebabe8fe076ed84a2aaa7a1a0">RETKEY</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02226"></a>02226             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5ad3e69623bec2807b82452914f8bb6d">togdual</a> = <span class="keyword">event</span>-&gt;ctrl;
<a name="l02227"></a>02227             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a2761cf68e1f2fc34712ba06e4c64b555">togonly</a> = !<span class="keyword">event</span>-&gt;shift;
<a name="l02228"></a>02228             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02229"></a>02229             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02230"></a>02230         }
<a name="l02231"></a>02231     }
<a name="l02232"></a>02232     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l02233"></a>02233 }
<a name="l02234"></a>02234 
<a name="l02235"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3dd685d5247757f152ae4b9e57324e5c">02235</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3dd685d5247757f152ae4b9e57324e5c">ui_do_but_EXIT</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02236"></a>02236 {
<a name="l02237"></a>02237     
<a name="l02238"></a>02238     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l02239"></a>02239 
<a name="l02240"></a>02240         <span class="comment">/* first handle click on icondrag type button */</span>
<a name="l02241"></a>02241         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23e894de3d96a5264d22687ff985e272">dragpoin</a>) {
<a name="l02242"></a>02242             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a43d46273c2380ba298d59377b5f8b46f">ui_but_mouse_inside_icon</a>(but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, event)) {
<a name="l02243"></a>02243                 
<a name="l02244"></a>02244                 <span class="comment">/* tell the button to wait and keep checking further events to</span>
<a name="l02245"></a>02245 <span class="comment">                 * see if it should start dragging */</span>
<a name="l02246"></a>02246                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a930ea9a11f71ca40393f0d62d9d3afcb">BUTTON_STATE_WAIT_DRAG</a>);
<a name="l02247"></a>02247                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> = <span class="keyword">event</span>-&gt;x;
<a name="l02248"></a>02248                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a> = <span class="keyword">event</span>-&gt;y;
<a name="l02249"></a>02249                 <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l02250"></a>02250             }
<a name="l02251"></a>02251         }
<a name="l02252"></a>02252         
<a name="l02253"></a>02253         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aafdc675e684c8485e8e27c7f2bafcbef">PADENTER</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c861c5ebabe8fe076ed84a2aaa7a1a0">RETKEY</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02254"></a>02254             <span class="keywordtype">int</span> ret = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02255"></a>02255             <span class="comment">/* XXX (a bit ugly) Special case handling for filebrowser drag button */</span>
<a name="l02256"></a>02256             <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23e894de3d96a5264d22687ff985e272">dragpoin</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ab7c0b6d8a692385d1c2618eaa4da9572">imb</a> &amp;&amp; <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a43d46273c2380ba298d59377b5f8b46f">ui_but_mouse_inside_icon</a>(but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, event)) {
<a name="l02257"></a>02257                 ret = <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l02258"></a>02258             }
<a name="l02259"></a>02259             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02260"></a>02260             <span class="keywordflow">return</span> ret;
<a name="l02261"></a>02261         }
<a name="l02262"></a>02262     }
<a name="l02263"></a>02263     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a930ea9a11f71ca40393f0d62d9d3afcb">BUTTON_STATE_WAIT_DRAG</a>) {
<a name="l02264"></a>02264         
<a name="l02265"></a>02265         <span class="comment">/* this function also ends state */</span>
<a name="l02266"></a>02266         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#aaadc9c0d1e734e39a2dae25bfb4866ee">ui_but_start_drag</a>(C, but, data, event)) {
<a name="l02267"></a>02267             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02268"></a>02268         }
<a name="l02269"></a>02269         
<a name="l02270"></a>02270         <span class="comment">/* If the mouse has been pressed and released, getting to </span>
<a name="l02271"></a>02271 <span class="comment">         * this point without triggering a drag, then clear the </span>
<a name="l02272"></a>02272 <span class="comment">         * drag state for this button and continue to pass on the event */</span>
<a name="l02273"></a>02273         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>) {
<a name="l02274"></a>02274             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02275"></a>02275             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l02276"></a>02276         }
<a name="l02277"></a>02277         
<a name="l02278"></a>02278         <span class="comment">/* while waiting for a drag to be triggered, always block </span>
<a name="l02279"></a>02279 <span class="comment">         * other events from getting handled */</span>
<a name="l02280"></a>02280         <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02281"></a>02281     }
<a name="l02282"></a>02282     
<a name="l02283"></a>02283     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l02284"></a>02284 }
<a name="l02285"></a>02285 
<a name="l02286"></a>02286 <span class="comment">/* var names match ui_numedit_but_NUM */</span>
<a name="l02287"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad537e694d6d3839d237fc047d9c51090">02287</a> <span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad537e694d6d3839d237fc047d9c51090">ui_numedit_apply_snapf</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <span class="keywordtype">float</span> tempf, <span class="keywordtype">float</span> softmin, <span class="keywordtype">float</span> softmax, <span class="keywordtype">float</span> softrange, <span class="keywordtype">int</span> snap)
<a name="l02288"></a>02288 {
<a name="l02289"></a>02289     <span class="keywordflow">if</span> (tempf == softmin || tempf == softmax || snap == 0) {
<a name="l02290"></a>02290         <span class="comment">/* pass */</span>
<a name="l02291"></a>02291     }
<a name="l02292"></a>02292     <span class="keywordflow">else</span> {
<a name="l02293"></a>02293         <span class="keywordtype">float</span> fac = 1.0f;
<a name="l02294"></a>02294         
<a name="l02295"></a>02295         <span class="keywordflow">if</span> (<a class="code" href="../../dd/dda/interface_8c.html#a28edab48b5dcc80685e58151521066f4">ui_is_but_unit</a>(but)) {
<a name="l02296"></a>02296             <a class="code" href="../../d8/da3/structUnitSettings.html">UnitSettings</a> *unit = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a38cf9ef6951c1df209e1a028dd917253">unit</a>;
<a name="l02297"></a>02297             <span class="keywordtype">int</span> unit_type = <a class="code" href="../../de/d7e/RNA__types_8h.html#a626dbf9fd2713ba4e78821b484e2a2b1">RNA_SUBTYPE_UNIT_VALUE</a>(<a class="code" href="../../d8/d1e/UI__interface_8h.html#a37e94be5a75d95e89521d61e3405d458">uiButGetUnitType</a>(but));
<a name="l02298"></a>02298 
<a name="l02299"></a>02299             <span class="keywordflow">if</span> (<a class="code" href="../../dd/d47/BKE__unit_8h.html#a4806446b79ed8fcd75d8a87cc204d789">bUnit_IsValid</a>(unit-&gt;<a class="code" href="../../d8/da3/structUnitSettings.html#a3ac319ff602239809e75b3939a014846">system</a>, unit_type)) {
<a name="l02300"></a>02300                 fac = (float)<a class="code" href="../../dd/d47/BKE__unit_8h.html#a05fafd6a1d78f61f631c09b13a6e129d">bUnit_BaseScalar</a>(unit-&gt;<a class="code" href="../../d8/da3/structUnitSettings.html#a3ac319ff602239809e75b3939a014846">system</a>, unit_type);
<a name="l02301"></a>02301                 <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(unit_type, <a class="code" href="../../dd/d47/BKE__unit_8h.html#a4779c1dd27e30d714b820dfc6adfb66b">B_UNIT_LENGTH</a>, <a class="code" href="../../dd/d47/BKE__unit_8h.html#ac4f5f9e9424dd6efd2d3c6c3b7f0f8a8">B_UNIT_AREA</a>, <a class="code" href="../../dd/d47/BKE__unit_8h.html#ab9092b54fb664f2c0f3781342835939e">B_UNIT_VOLUME</a>)) {
<a name="l02302"></a>02302                     fac /= unit-&gt;<a class="code" href="../../d8/da3/structUnitSettings.html#a0c970043cd1006145890fee0041a5161">scale_length</a>;
<a name="l02303"></a>02303                 }
<a name="l02304"></a>02304             }
<a name="l02305"></a>02305         }
<a name="l02306"></a>02306 
<a name="l02307"></a>02307         <span class="keywordflow">if</span> (fac != 1.0f) {
<a name="l02308"></a>02308             <span class="comment">/* snap in unit-space */</span>
<a name="l02309"></a>02309             tempf /= fac;
<a name="l02310"></a>02310             <span class="comment">/* softmin /= fac; */</span> <span class="comment">/* UNUSED */</span>
<a name="l02311"></a>02311             <span class="comment">/* softmax /= fac; */</span> <span class="comment">/* UNUSED */</span>
<a name="l02312"></a>02312             softrange /= fac;
<a name="l02313"></a>02313         }
<a name="l02314"></a>02314 
<a name="l02315"></a>02315         <span class="keywordflow">if</span> (snap == 1) {
<a name="l02316"></a>02316             <span class="keywordflow">if</span> (softrange &lt; 2.10f) tempf = 0.1f * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(10.0f * tempf);
<a name="l02317"></a>02317             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (softrange &lt; 21.0f) tempf = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(tempf);
<a name="l02318"></a>02318             <span class="keywordflow">else</span> tempf = 10.0f * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(tempf / 10.0f);
<a name="l02319"></a>02319         }
<a name="l02320"></a>02320         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (snap == 2) {
<a name="l02321"></a>02321             <span class="keywordflow">if</span> (softrange &lt; 2.10f) tempf = 0.01f * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(100.0f * tempf);
<a name="l02322"></a>02322             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (softrange &lt; 21.0f) tempf = 0.1f * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(10.0f * tempf);
<a name="l02323"></a>02323             <span class="keywordflow">else</span> tempf = floor(tempf);
<a name="l02324"></a>02324         }
<a name="l02325"></a>02325         
<a name="l02326"></a>02326         <span class="keywordflow">if</span> (fac != 1.0f)
<a name="l02327"></a>02327             tempf *= fac;
<a name="l02328"></a>02328     }
<a name="l02329"></a>02329 
<a name="l02330"></a>02330     <span class="keywordflow">return</span> tempf;
<a name="l02331"></a>02331 }
<a name="l02332"></a>02332 
<a name="l02333"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a2fd42239c2f963b2f839127e42591278">02333</a> <span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a2fd42239c2f963b2f839127e42591278">ui_numedit_apply_snap</a>(<span class="keywordtype">int</span> temp, <span class="keywordtype">float</span> softmin, <span class="keywordtype">float</span> softmax, <span class="keywordtype">int</span> snap)
<a name="l02334"></a>02334 {
<a name="l02335"></a>02335     <span class="keywordflow">if</span> (temp == softmin || temp == softmax)
<a name="l02336"></a>02336         <span class="keywordflow">return</span> temp;
<a name="l02337"></a>02337 
<a name="l02338"></a>02338     <span class="keywordflow">switch</span> (snap) {
<a name="l02339"></a>02339         <span class="keywordflow">case</span> 0:
<a name="l02340"></a>02340             <span class="keywordflow">break</span>;
<a name="l02341"></a>02341         <span class="keywordflow">case</span> 1:
<a name="l02342"></a>02342             temp = 10 * (temp / 10);
<a name="l02343"></a>02343             <span class="keywordflow">break</span>;
<a name="l02344"></a>02344         <span class="keywordflow">case</span> 2:
<a name="l02345"></a>02345             temp = 100 * (temp / 100);
<a name="l02346"></a>02346             <span class="keywordflow">break</span>;
<a name="l02347"></a>02347     }
<a name="l02348"></a>02348 
<a name="l02349"></a>02349     <span class="keywordflow">return</span> temp;
<a name="l02350"></a>02350 }
<a name="l02351"></a>02351 
<a name="l02352"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa4d95b571a176cd630c005dfd0d12cbe">02352</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa4d95b571a176cd630c005dfd0d12cbe">ui_numedit_but_NUM</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">float</span> fac, <span class="keywordtype">int</span> snap, <span class="keywordtype">int</span> mx)
<a name="l02353"></a>02353 {
<a name="l02354"></a>02354     <span class="keywordtype">float</span> deler, tempf, softmin, softmax, softrange;
<a name="l02355"></a>02355     <span class="keywordtype">int</span> lvalue, temp, changed = 0;
<a name="l02356"></a>02356     
<a name="l02357"></a>02357     <span class="keywordflow">if</span> (mx == data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a>)
<a name="l02358"></a>02358         <span class="keywordflow">return</span> changed;
<a name="l02359"></a>02359     
<a name="l02360"></a>02360     <span class="comment">/* drag-lock - prevent unwanted scroll adjustments */</span>
<a name="l02361"></a>02361     <span class="comment">/* change value (now 3) to adjust threshold in pixels */</span>
<a name="l02362"></a>02362     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ac5d8c722c791292345906a2336f92549">draglock</a>) {
<a name="l02363"></a>02363         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>(mx - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a>) &lt;= 3)
<a name="l02364"></a>02364             <span class="keywordflow">return</span> changed;
<a name="l02365"></a>02365 
<a name="l02366"></a>02366         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ac5d8c722c791292345906a2336f92549">draglock</a> = 0;
<a name="l02367"></a>02367         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> = mx;  <span class="comment">/* ignore mouse movement within drag-lock */</span>
<a name="l02368"></a>02368     }
<a name="l02369"></a>02369 
<a name="l02370"></a>02370     softmin = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a3e77370ad783c9c9679b9afb3d0f49a9">softmin</a>;
<a name="l02371"></a>02371     softmax = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ac8f6bc84beed56ee707d4da30047be37">softmax</a>;
<a name="l02372"></a>02372     softrange = softmax - softmin;
<a name="l02373"></a>02373 
<a name="l02374"></a>02374     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#aab7bfed4f48e9625734a5b862a44c5f6">ui_is_a_warp_but</a>(but)) {
<a name="l02375"></a>02375         <span class="comment">/* Mouse location isn&#39;t screen clamped to the screen so use a linear mapping</span>
<a name="l02376"></a>02376 <span class="comment">         * 2px == 1-int, or 1px == 1-ClickStep */</span>
<a name="l02377"></a>02377         <span class="keywordflow">if</span> (<a class="code" href="../../dd/dda/interface_8c.html#a6fa62dc0ab30ae1c60be551a55bb10fa">ui_is_but_float</a>(but)) {
<a name="l02378"></a>02378             fac *= 0.01f * but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a57586f98222f543b349453c1a83b4ce9">a1</a>;
<a name="l02379"></a>02379             tempf = (float)data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0ef0fa5774082c955d46603ce60df9bb">startvalue</a> + ((<span class="keywordtype">float</span>)(mx - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a>) * fac);
<a name="l02380"></a>02380             tempf = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad537e694d6d3839d237fc047d9c51090">ui_numedit_apply_snapf</a>(but, tempf, softmin, softmax, softrange, snap);
<a name="l02381"></a>02381 
<a name="l02382"></a>02382 <span class="preprocessor">#if 1       </span><span class="comment">/* fake moving the click start, nicer for dragging back after passing the limit */</span>
<a name="l02383"></a>02383             <span class="keywordflow">if</span> (tempf &lt; softmin) {
<a name="l02384"></a>02384                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> -= (softmin - tempf) / fac;
<a name="l02385"></a>02385                 tempf = softmin;
<a name="l02386"></a>02386             }
<a name="l02387"></a>02387             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tempf &gt; softmax) {
<a name="l02388"></a>02388                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> += (tempf - softmax) / fac;
<a name="l02389"></a>02389                 tempf = softmax;
<a name="l02390"></a>02390             }
<a name="l02391"></a>02391 <span class="preprocessor">#else</span>
<a name="l02392"></a>02392 <span class="preprocessor"></span>            <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(tempf, softmin, softmax);
<a name="l02393"></a>02393 <span class="preprocessor">#endif</span>
<a name="l02394"></a>02394 <span class="preprocessor"></span>
<a name="l02395"></a>02395             <span class="keywordflow">if</span> (tempf != (<span class="keywordtype">float</span>)data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a>) {
<a name="l02396"></a>02396                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab4df4530c50ab91a8cf958000e3c5a29">dragchange</a> = 1;
<a name="l02397"></a>02397                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = tempf;
<a name="l02398"></a>02398                 changed = 1;
<a name="l02399"></a>02399             }
<a name="l02400"></a>02400         }
<a name="l02401"></a>02401         <span class="keywordflow">else</span> {
<a name="l02402"></a>02402             <span class="keywordflow">if</span> (softrange &gt; 256) fac = 1.0;             <span class="comment">/* 1px == 1 */</span>
<a name="l02403"></a>02403             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (softrange &gt; 32) fac = 1.0 / 2.0;   <span class="comment">/* 2px == 1 */</span>
<a name="l02404"></a>02404             <span class="keywordflow">else</span> fac = 1.0 / 16.0;                  <span class="comment">/* 16px == 1? */</span>
<a name="l02405"></a>02405 
<a name="l02406"></a>02406             temp = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0ef0fa5774082c955d46603ce60df9bb">startvalue</a> + (((double)mx - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a>) * (double)fac);
<a name="l02407"></a>02407             temp = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a2fd42239c2f963b2f839127e42591278">ui_numedit_apply_snap</a>(temp, softmin, softmax, snap);
<a name="l02408"></a>02408 
<a name="l02409"></a>02409 <span class="preprocessor">#if 1       </span><span class="comment">/* fake moving the click start, nicer for dragging back after passing the limit */</span>
<a name="l02410"></a>02410             <span class="keywordflow">if</span> (temp &lt; softmin) {
<a name="l02411"></a>02411                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> -= (softmin - temp) / fac;
<a name="l02412"></a>02412                 temp = softmin;
<a name="l02413"></a>02413             }
<a name="l02414"></a>02414             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp &gt; softmax) {
<a name="l02415"></a>02415                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> += (temp - softmax) / fac;
<a name="l02416"></a>02416                 temp = softmax;
<a name="l02417"></a>02417             }
<a name="l02418"></a>02418 <span class="preprocessor">#else</span>
<a name="l02419"></a>02419 <span class="preprocessor"></span>            <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(temp, softmin, softmax);
<a name="l02420"></a>02420 <span class="preprocessor">#endif</span>
<a name="l02421"></a>02421 <span class="preprocessor"></span>
<a name="l02422"></a>02422             <span class="keywordflow">if</span> (temp != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a>) {
<a name="l02423"></a>02423                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab4df4530c50ab91a8cf958000e3c5a29">dragchange</a> = 1;
<a name="l02424"></a>02424                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = temp;
<a name="l02425"></a>02425                 changed = 1;
<a name="l02426"></a>02426             }
<a name="l02427"></a>02427         }
<a name="l02428"></a>02428 
<a name="l02429"></a>02429         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l02430"></a>02430     }
<a name="l02431"></a>02431     <span class="keywordflow">else</span> {
<a name="l02432"></a>02432         <span class="comment">/* Use a non-linear mapping of the mouse drag especially for large floats (normal behavior) */</span>
<a name="l02433"></a>02433         deler = 500;
<a name="l02434"></a>02434         <span class="keywordflow">if</span> (!<a class="code" href="../../dd/dda/interface_8c.html#a6fa62dc0ab30ae1c60be551a55bb10fa">ui_is_but_float</a>(but)) {
<a name="l02435"></a>02435             <span class="comment">/* prevent large ranges from getting too out of control */</span>
<a name="l02436"></a>02436             <span class="keywordflow">if</span> (softrange &gt; 600) deler = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#acc9eed6743d69a0f62071dc0c7dd6ae8">powf</a>(softrange, 0.75);
<a name="l02437"></a>02437             
<a name="l02438"></a>02438             <span class="keywordflow">if</span> (softrange &lt; 100) deler = 200.0;
<a name="l02439"></a>02439             <span class="keywordflow">if</span> (softrange &lt; 25) deler = 50.0;
<a name="l02440"></a>02440         }
<a name="l02441"></a>02441         deler /= fac;
<a name="l02442"></a>02442 
<a name="l02443"></a>02443         <span class="keywordflow">if</span> (softrange &gt; 11) {
<a name="l02444"></a>02444             <span class="comment">/* non linear change in mouse input- good for high precicsion */</span>
<a name="l02445"></a>02445             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0294a9536f14b44114f578e7a9cf304d">dragf</a> += (((float)(mx - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a>)) / deler) * (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> - mx) * 0.002f);
<a name="l02446"></a>02446         }
<a name="l02447"></a>02447         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (softrange &gt; 129) { <span class="comment">/* only scale large int buttons */</span>
<a name="l02448"></a>02448             <span class="comment">/* non linear change in mouse input- good for high precicsionm ints need less fine tuning */</span>
<a name="l02449"></a>02449             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0294a9536f14b44114f578e7a9cf304d">dragf</a> += (((float)(mx - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a>)) / deler) * (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> - mx) * 0.004f);
<a name="l02450"></a>02450         }
<a name="l02451"></a>02451         <span class="keywordflow">else</span> {
<a name="l02452"></a>02452             <span class="comment">/*no scaling */</span>
<a name="l02453"></a>02453             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0294a9536f14b44114f578e7a9cf304d">dragf</a> += ((float)(mx - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a>)) / deler;
<a name="l02454"></a>02454         }
<a name="l02455"></a>02455     
<a name="l02456"></a>02456         <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0294a9536f14b44114f578e7a9cf304d">dragf</a>, 0.0f, 1.0f);
<a name="l02457"></a>02457         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l02458"></a>02458         tempf = (softmin + data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0294a9536f14b44114f578e7a9cf304d">dragf</a> * softrange);
<a name="l02459"></a>02459 
<a name="l02460"></a>02460 
<a name="l02461"></a>02461         <span class="keywordflow">if</span> (!<a class="code" href="../../dd/dda/interface_8c.html#a6fa62dc0ab30ae1c60be551a55bb10fa">ui_is_but_float</a>(but)) {
<a name="l02462"></a>02462             temp = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(tempf + 0.5f);
<a name="l02463"></a>02463 
<a name="l02464"></a>02464             temp = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a2fd42239c2f963b2f839127e42591278">ui_numedit_apply_snap</a>(temp, softmin, softmax, snap);
<a name="l02465"></a>02465 
<a name="l02466"></a>02466             <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(temp, softmin, softmax);
<a name="l02467"></a>02467             lvalue = (int)data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a>;
<a name="l02468"></a>02468             
<a name="l02469"></a>02469             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (temp != lvalue) {
<a name="l02470"></a>02470                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab4df4530c50ab91a8cf958000e3c5a29">dragchange</a> = 1;
<a name="l02471"></a>02471                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = (double)temp;
<a name="l02472"></a>02472                 changed = 1;
<a name="l02473"></a>02473             }
<a name="l02474"></a>02474         }
<a name="l02475"></a>02475         <span class="keywordflow">else</span> {
<a name="l02476"></a>02476             temp = 0;
<a name="l02477"></a>02477             tempf = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad537e694d6d3839d237fc047d9c51090">ui_numedit_apply_snapf</a>(but, tempf, softmin, softmax, softrange, snap);
<a name="l02478"></a>02478 
<a name="l02479"></a>02479             <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(tempf, softmin, softmax);
<a name="l02480"></a>02480 
<a name="l02481"></a>02481             <span class="keywordflow">if</span> (tempf != (<span class="keywordtype">float</span>)data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a>) {
<a name="l02482"></a>02482                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab4df4530c50ab91a8cf958000e3c5a29">dragchange</a> = 1;
<a name="l02483"></a>02483                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = tempf;
<a name="l02484"></a>02484                 changed = 1;
<a name="l02485"></a>02485             }
<a name="l02486"></a>02486         }
<a name="l02487"></a>02487     }
<a name="l02488"></a>02488 
<a name="l02489"></a>02489 
<a name="l02490"></a>02490     <span class="keywordflow">return</span> changed;
<a name="l02491"></a>02491 }
<a name="l02492"></a>02492 
<a name="l02493"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a588a1ae80eac9186e2d1e9d19357a4eb">02493</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a588a1ae80eac9186e2d1e9d19357a4eb">ui_do_but_NUM</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02494"></a>02494 {
<a name="l02495"></a>02495     <span class="keywordtype">int</span> mx, my; <span class="comment">/* mouse location scaled to fit the UI */</span>
<a name="l02496"></a>02496     <span class="keywordtype">int</span> screen_mx, screen_my; <span class="comment">/* mouse location kept at screen pixel coords */</span>
<a name="l02497"></a>02497     <span class="keywordtype">int</span> click = 0;
<a name="l02498"></a>02498     <span class="keywordtype">int</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l02499"></a>02499     
<a name="l02500"></a>02500     mx = screen_mx = <span class="keyword">event</span>-&gt;x;
<a name="l02501"></a>02501     my = screen_my = <span class="keyword">event</span>-&gt;y;
<a name="l02502"></a>02502 
<a name="l02503"></a>02503     <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, block, &amp;mx, &amp;my);
<a name="l02504"></a>02504 
<a name="l02505"></a>02505     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l02506"></a>02506         <span class="comment">/* XXX hardcoded keymap check.... */</span>
<a name="l02507"></a>02507         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a>) {
<a name="l02508"></a>02508             mx = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>;
<a name="l02509"></a>02509             click = 1;
<a name="l02510"></a>02510         }
<a name="l02511"></a>02511         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a>) {
<a name="l02512"></a>02512             mx = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a>;
<a name="l02513"></a>02513             click = 1;
<a name="l02514"></a>02514         }
<a name="l02515"></a>02515         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02516"></a>02516             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aafdc675e684c8485e8e27c7f2bafcbef">PADENTER</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c861c5ebabe8fe076ed84a2aaa7a1a0">RETKEY</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a>) {
<a name="l02517"></a>02517                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">BUTTON_STATE_TEXT_EDITING</a>);
<a name="l02518"></a>02518                 retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02519"></a>02519             }
<a name="l02520"></a>02520             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>) {
<a name="l02521"></a>02521                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aab7bfed4f48e9625734a5b862a44c5f6">ui_is_a_warp_but</a>(but) ? screen_mx : mx;
<a name="l02522"></a>02522                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l02523"></a>02523                 retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02524"></a>02524             }
<a name="l02525"></a>02525             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aafdc675e684c8485e8e27c7f2bafcbef">PADENTER</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c861c5ebabe8fe076ed84a2aaa7a1a0">RETKEY</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>)
<a name="l02526"></a>02526                 click = 1;
<a name="l02527"></a>02527             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a32aa9ced052bfd4e51f37e3f872adfb8">MINUSKEY</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02528"></a>02528                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l02529"></a>02529                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = -data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a>;
<a name="l02530"></a>02530                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02531"></a>02531                 retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02532"></a>02532             }
<a name="l02533"></a>02533         }
<a name="l02534"></a>02534         
<a name="l02535"></a>02535     }
<a name="l02536"></a>02536     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>) {
<a name="l02537"></a>02537         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>) {
<a name="l02538"></a>02538             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l02539"></a>02539             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab781c61b8b3d2757829f9aa919e5f136">escapecancel</a> = 1;
<a name="l02540"></a>02540             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02541"></a>02541         }
<a name="l02542"></a>02542         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02543"></a>02543             <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab4df4530c50ab91a8cf958000e3c5a29">dragchange</a>)
<a name="l02544"></a>02544                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02545"></a>02545             <span class="keywordflow">else</span>
<a name="l02546"></a>02546                 click = 1;
<a name="l02547"></a>02547         }
<a name="l02548"></a>02548         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>) {
<a name="l02549"></a>02549             <span class="keywordtype">float</span> fac;
<a name="l02550"></a>02550             <span class="keywordtype">int</span> snap;
<a name="l02551"></a>02551 
<a name="l02552"></a>02552             fac = 1.0f;
<a name="l02553"></a>02553             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>) fac /= 10.0f;
<a name="l02554"></a>02554             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a>) fac /= 20.0f;
<a name="l02555"></a>02555             
<a name="l02556"></a>02556             snap = (<span class="keyword">event</span>-&gt;ctrl) ? (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>) ? 2 : 1 : 0;
<a name="l02557"></a>02557 
<a name="l02558"></a>02558             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa4d95b571a176cd630c005dfd0d12cbe">ui_numedit_but_NUM</a>(but, data, fac, snap, (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#aab7bfed4f48e9625734a5b862a44c5f6">ui_is_a_warp_but</a>(but) ? screen_mx : mx)))
<a name="l02559"></a>02559                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l02560"></a>02560         }
<a name="l02561"></a>02561         retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02562"></a>02562     }
<a name="l02563"></a>02563     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">BUTTON_STATE_TEXT_EDITING</a>) {
<a name="l02564"></a>02564         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aaaad6111fb18ec8117426c01e1b94654">ui_do_but_textedit</a>(C, block, but, data, event);
<a name="l02565"></a>02565         retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02566"></a>02566     }
<a name="l02567"></a>02567     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a76040e4ffb28474e09a53e1e847423d7">BUTTON_STATE_TEXT_SELECTING</a>) {
<a name="l02568"></a>02568         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa768b4d0647c55e2552f1a08fbfd6af2">ui_do_but_textedit_select</a>(C, block, but, data, event);
<a name="l02569"></a>02569         retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02570"></a>02570     }
<a name="l02571"></a>02571     
<a name="l02572"></a>02572     <span class="keywordflow">if</span> (click) {
<a name="l02573"></a>02573         <span class="comment">/* we can click on the side arrows to increment/decrement,</span>
<a name="l02574"></a>02574 <span class="comment">         * or click inside to edit the value directly */</span>
<a name="l02575"></a>02575         <span class="keywordtype">float</span> tempf, softmin, softmax;
<a name="l02576"></a>02576         <span class="keywordtype">int</span> temp;
<a name="l02577"></a>02577 
<a name="l02578"></a>02578         softmin = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a3e77370ad783c9c9679b9afb3d0f49a9">softmin</a>;
<a name="l02579"></a>02579         softmax = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ac8f6bc84beed56ee707d4da30047be37">softmax</a>;
<a name="l02580"></a>02580 
<a name="l02581"></a>02581         <span class="keywordflow">if</span> (!<a class="code" href="../../dd/dda/interface_8c.html#a6fa62dc0ab30ae1c60be551a55bb10fa">ui_is_but_float</a>(but)) {
<a name="l02582"></a>02582             <span class="keywordflow">if</span> (mx &lt; (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a> + (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>) / 3 - 3)) {
<a name="l02583"></a>02583                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l02584"></a>02584 
<a name="l02585"></a>02585                 temp = (int)data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> - 1;
<a name="l02586"></a>02586                 <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (temp &gt;= softmin &amp;&amp; temp &lt;= softmax)
<a name="l02587"></a>02587                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = (double)temp;
<a name="l02588"></a>02588                 <span class="keywordflow">else</span>
<a name="l02589"></a>02589                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l02590"></a>02590 
<a name="l02591"></a>02591                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02592"></a>02592             }
<a name="l02593"></a>02593             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mx &gt; (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a> + (2 * (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>) / 3) + 3)) {
<a name="l02594"></a>02594                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l02595"></a>02595 
<a name="l02596"></a>02596                 temp = (int)data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> + 1;
<a name="l02597"></a>02597                 <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (temp &gt;= softmin &amp;&amp; temp &lt;= softmax)
<a name="l02598"></a>02598                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = (double)temp;
<a name="l02599"></a>02599                 <span class="keywordflow">else</span>
<a name="l02600"></a>02600                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l02601"></a>02601 
<a name="l02602"></a>02602                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02603"></a>02603             }
<a name="l02604"></a>02604             <span class="keywordflow">else</span>
<a name="l02605"></a>02605                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">BUTTON_STATE_TEXT_EDITING</a>);
<a name="l02606"></a>02606         }
<a name="l02607"></a>02607         <span class="keywordflow">else</span> {
<a name="l02608"></a>02608             <span class="keywordflow">if</span> (mx &lt; (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a> + (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>) / 3 - 3)) {
<a name="l02609"></a>02609                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l02610"></a>02610 
<a name="l02611"></a>02611                 tempf = (float)data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> - 0.01f * but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a57586f98222f543b349453c1a83b4ce9">a1</a>;
<a name="l02612"></a>02612                 <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (tempf &lt; softmin) tempf = softmin;
<a name="l02613"></a>02613                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = tempf;
<a name="l02614"></a>02614 
<a name="l02615"></a>02615                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02616"></a>02616             }
<a name="l02617"></a>02617             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mx &gt; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a> + (2 * ((but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>) / 3) + 3)) {
<a name="l02618"></a>02618                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l02619"></a>02619 
<a name="l02620"></a>02620                 tempf = (float)data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> + 0.01f * but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a57586f98222f543b349453c1a83b4ce9">a1</a>;
<a name="l02621"></a>02621                 <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (tempf &gt; softmax) tempf = softmax;
<a name="l02622"></a>02622                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = tempf;
<a name="l02623"></a>02623 
<a name="l02624"></a>02624                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02625"></a>02625             }
<a name="l02626"></a>02626             <span class="keywordflow">else</span>
<a name="l02627"></a>02627                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">BUTTON_STATE_TEXT_EDITING</a>);
<a name="l02628"></a>02628         }
<a name="l02629"></a>02629 
<a name="l02630"></a>02630         retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02631"></a>02631     }
<a name="l02632"></a>02632     
<a name="l02633"></a>02633     <span class="keywordflow">return</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a>;
<a name="l02634"></a>02634 }
<a name="l02635"></a>02635 
<a name="l02636"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad9a15dcc2f58950d922e88960dce87d9">02636</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad9a15dcc2f58950d922e88960dce87d9">ui_numedit_but_SLI</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">int</span> shift, <span class="keywordtype">int</span> ctrl, <span class="keywordtype">int</span> mx)
<a name="l02637"></a>02637 {
<a name="l02638"></a>02638     <span class="keywordtype">float</span> deler, f, tempf, softmin, softmax, softrange;
<a name="l02639"></a>02639     <span class="keywordtype">int</span> temp, lvalue, changed = 0;
<a name="l02640"></a>02640 
<a name="l02641"></a>02641     softmin = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a3e77370ad783c9c9679b9afb3d0f49a9">softmin</a>;
<a name="l02642"></a>02642     softmax = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ac8f6bc84beed56ee707d4da30047be37">softmax</a>;
<a name="l02643"></a>02643     softrange = softmax - softmin;
<a name="l02644"></a>02644 
<a name="l02645"></a>02645     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d9/dc4/plugin_8h.html#a14a9dde4adb789e686787aeff498bb10">NUMSLI</a>) deler = ((but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>) - 5.0f * but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a50eeaa8bd347134ebf9d7fe43a33acb4">aspect</a>);
<a name="l02646"></a>02646     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a6cb451ada67e3dcb1d058adcd025b14c">HSVSLI</a>) deler = ((but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>) / 2.0f - 5.0f * but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a50eeaa8bd347134ebf9d7fe43a33acb4">aspect</a>);
<a name="l02647"></a>02647     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa8fa67309d5b49cdd294644ff290591e">SCROLL</a>) {
<a name="l02648"></a>02648         <span class="keywordtype">int</span> horizontal = (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a> &gt; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abbb172bca1cfaa5d7538af548f1a1666">y2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>);
<a name="l02649"></a>02649         <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a> = (horizontal) ? (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>) : -(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abbb172bca1cfaa5d7538af548f1a1666">y2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>);
<a name="l02650"></a>02650         deler = size * (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ac8f6bc84beed56ee707d4da30047be37">softmax</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a3e77370ad783c9c9679b9afb3d0f49a9">softmin</a>) / (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ac8f6bc84beed56ee707d4da30047be37">softmax</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a3e77370ad783c9c9679b9afb3d0f49a9">softmin</a> + but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a57586f98222f543b349453c1a83b4ce9">a1</a>);
<a name="l02651"></a>02651     }
<a name="l02652"></a>02652     <span class="keywordflow">else</span> deler = (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a> - 5.0f * but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a50eeaa8bd347134ebf9d7fe43a33acb4">aspect</a>);
<a name="l02653"></a>02653 
<a name="l02654"></a>02654     f = (float)(mx - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a>) / deler + data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a6b16641cad6da7ba6a135c70add30318">dragfstart</a>;
<a name="l02655"></a>02655     
<a name="l02656"></a>02656     <span class="keywordflow">if</span> (shift)
<a name="l02657"></a>02657         f = (f - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a6b16641cad6da7ba6a135c70add30318">dragfstart</a>) / 10.0f + data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a6b16641cad6da7ba6a135c70add30318">dragfstart</a>;
<a name="l02658"></a>02658 
<a name="l02659"></a>02659     <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(f, 0.0f, 1.0f);
<a name="l02660"></a>02660     tempf = softmin + f * softrange;
<a name="l02661"></a>02661     temp = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(tempf + 0.5f);
<a name="l02662"></a>02662 
<a name="l02663"></a>02663     <span class="keywordflow">if</span> (ctrl) {
<a name="l02664"></a>02664         <span class="keywordflow">if</span> (tempf == softmin || tempf == softmax) ;
<a name="l02665"></a>02665         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../dd/dda/interface_8c.html#a6fa62dc0ab30ae1c60be551a55bb10fa">ui_is_but_float</a>(but)) {
<a name="l02666"></a>02666 
<a name="l02667"></a>02667             <span class="keywordflow">if</span> (shift) {
<a name="l02668"></a>02668                 <span class="keywordflow">if</span> (tempf == softmin || tempf == softmax) ;
<a name="l02669"></a>02669                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (softmax - softmin &lt; 2.10f) tempf = 0.01f * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(100.0f * tempf);
<a name="l02670"></a>02670                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (softmax - softmin &lt; 21.0f) tempf = 0.1f * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(10.0f * tempf);
<a name="l02671"></a>02671                 <span class="keywordflow">else</span> tempf = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(tempf);
<a name="l02672"></a>02672             }
<a name="l02673"></a>02673             <span class="keywordflow">else</span> {
<a name="l02674"></a>02674                 <span class="keywordflow">if</span> (softmax - softmin &lt; 2.10f) tempf = 0.1f * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(10.0f * tempf);
<a name="l02675"></a>02675                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (softmax - softmin &lt; 21.0f) tempf = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(tempf);
<a name="l02676"></a>02676                 <span class="keywordflow">else</span> tempf = 10.0f * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(tempf / 10.0f);
<a name="l02677"></a>02677             }
<a name="l02678"></a>02678         }
<a name="l02679"></a>02679         <span class="keywordflow">else</span> {
<a name="l02680"></a>02680             temp = 10 * (temp / 10);
<a name="l02681"></a>02681             tempf = temp;
<a name="l02682"></a>02682         }
<a name="l02683"></a>02683     }
<a name="l02684"></a>02684 
<a name="l02685"></a>02685     <span class="keywordflow">if</span> (!<a class="code" href="../../dd/dda/interface_8c.html#a6fa62dc0ab30ae1c60be551a55bb10fa">ui_is_but_float</a>(but)) {
<a name="l02686"></a>02686         lvalue = floor(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> + 0.5);
<a name="l02687"></a>02687 
<a name="l02688"></a>02688         <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(temp, softmin, softmax);
<a name="l02689"></a>02689 
<a name="l02690"></a>02690         <span class="keywordflow">if</span> (temp != lvalue) {
<a name="l02691"></a>02691             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = temp;
<a name="l02692"></a>02692             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab4df4530c50ab91a8cf958000e3c5a29">dragchange</a> = 1;
<a name="l02693"></a>02693             changed = 1;
<a name="l02694"></a>02694         }
<a name="l02695"></a>02695     }
<a name="l02696"></a>02696     <span class="keywordflow">else</span> {
<a name="l02697"></a>02697         <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(tempf, softmin, softmax);
<a name="l02698"></a>02698 
<a name="l02699"></a>02699         <span class="keywordflow">if</span> (tempf != (<span class="keywordtype">float</span>)data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a>) {
<a name="l02700"></a>02700             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = tempf;
<a name="l02701"></a>02701             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab4df4530c50ab91a8cf958000e3c5a29">dragchange</a> = 1;
<a name="l02702"></a>02702             changed = 1;
<a name="l02703"></a>02703         }
<a name="l02704"></a>02704     }
<a name="l02705"></a>02705 
<a name="l02706"></a>02706     <span class="keywordflow">return</span> changed;
<a name="l02707"></a>02707 }
<a name="l02708"></a>02708 
<a name="l02709"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a43e15b74cd5dde9e7d130ee6fa4c4256">02709</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a43e15b74cd5dde9e7d130ee6fa4c4256">ui_do_but_SLI</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02710"></a>02710 {
<a name="l02711"></a>02711     <span class="keywordtype">int</span> mx, my, click = 0;
<a name="l02712"></a>02712     <span class="keywordtype">int</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l02713"></a>02713 
<a name="l02714"></a>02714     mx = <span class="keyword">event</span>-&gt;x;
<a name="l02715"></a>02715     my = <span class="keyword">event</span>-&gt;y;
<a name="l02716"></a>02716     <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, block, &amp;mx, &amp;my);
<a name="l02717"></a>02717 
<a name="l02718"></a>02718     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l02719"></a>02719         <span class="comment">/* XXX hardcoded keymap check.... */</span>
<a name="l02720"></a>02720         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a>) {
<a name="l02721"></a>02721             mx = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>;
<a name="l02722"></a>02722             click = 2;
<a name="l02723"></a>02723         }
<a name="l02724"></a>02724         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a>) {
<a name="l02725"></a>02725             mx = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a>;
<a name="l02726"></a>02726             click = 2;
<a name="l02727"></a>02727         }
<a name="l02728"></a>02728         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02729"></a>02729             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aafdc675e684c8485e8e27c7f2bafcbef">PADENTER</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c861c5ebabe8fe076ed84a2aaa7a1a0">RETKEY</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a>) {
<a name="l02730"></a>02730                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">BUTTON_STATE_TEXT_EDITING</a>);
<a name="l02731"></a>02731                 retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02732"></a>02732             }
<a name="l02733"></a>02733             <span class="comment">/* alt-click on sides to get &quot;arrows&quot; like in NUM buttons, and match wheel usage above */</span>
<a name="l02734"></a>02734             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a>) {
<a name="l02735"></a>02735                 <span class="keywordtype">int</span> halfpos = (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a> + but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a>) / 2;
<a name="l02736"></a>02736                 click = 2;
<a name="l02737"></a>02737                 <span class="keywordflow">if</span> (mx &lt; halfpos)
<a name="l02738"></a>02738                     mx = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>;
<a name="l02739"></a>02739                 <span class="keywordflow">else</span>
<a name="l02740"></a>02740                     mx = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a>;
<a name="l02741"></a>02741             }
<a name="l02742"></a>02742             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>) {
<a name="l02743"></a>02743                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> = mx;
<a name="l02744"></a>02744                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l02745"></a>02745                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l02746"></a>02746                 retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02747"></a>02747             }
<a name="l02748"></a>02748             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aafdc675e684c8485e8e27c7f2bafcbef">PADENTER</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c861c5ebabe8fe076ed84a2aaa7a1a0">RETKEY</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>)
<a name="l02749"></a>02749                 click = 1;
<a name="l02750"></a>02750             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a32aa9ced052bfd4e51f37e3f872adfb8">MINUSKEY</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02751"></a>02751                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l02752"></a>02752                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = -data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a>;
<a name="l02753"></a>02753                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02754"></a>02754                 retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02755"></a>02755             }
<a name="l02756"></a>02756         }
<a name="l02757"></a>02757     }
<a name="l02758"></a>02758     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>) {
<a name="l02759"></a>02759         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>) {
<a name="l02760"></a>02760             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l02761"></a>02761             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab781c61b8b3d2757829f9aa919e5f136">escapecancel</a> = 1;
<a name="l02762"></a>02762             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02763"></a>02763         }
<a name="l02764"></a>02764         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02765"></a>02765             <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab4df4530c50ab91a8cf958000e3c5a29">dragchange</a>)
<a name="l02766"></a>02766                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02767"></a>02767             <span class="keywordflow">else</span>
<a name="l02768"></a>02768                 click = 1;
<a name="l02769"></a>02769         }
<a name="l02770"></a>02770         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>) {
<a name="l02771"></a>02771             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad9a15dcc2f58950d922e88960dce87d9">ui_numedit_but_SLI</a>(but, data, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a>, mx))
<a name="l02772"></a>02772                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l02773"></a>02773         }
<a name="l02774"></a>02774         retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02775"></a>02775     }
<a name="l02776"></a>02776     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">BUTTON_STATE_TEXT_EDITING</a>) {
<a name="l02777"></a>02777         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aaaad6111fb18ec8117426c01e1b94654">ui_do_but_textedit</a>(C, block, but, data, event);
<a name="l02778"></a>02778         retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02779"></a>02779     }
<a name="l02780"></a>02780     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a76040e4ffb28474e09a53e1e847423d7">BUTTON_STATE_TEXT_SELECTING</a>) {
<a name="l02781"></a>02781         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa768b4d0647c55e2552f1a08fbfd6af2">ui_do_but_textedit_select</a>(C, block, but, data, event);
<a name="l02782"></a>02782         retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02783"></a>02783     }
<a name="l02784"></a>02784 
<a name="l02785"></a>02785     <span class="keywordflow">if</span> (click) {
<a name="l02786"></a>02786         <span class="keywordflow">if</span> (click == 2) {
<a name="l02787"></a>02787             <span class="comment">/* nudge slider to the left or right */</span>
<a name="l02788"></a>02788             <span class="keywordtype">float</span> f, tempf, softmin, softmax, softrange;
<a name="l02789"></a>02789             <span class="keywordtype">int</span> temp;
<a name="l02790"></a>02790             
<a name="l02791"></a>02791             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l02792"></a>02792             
<a name="l02793"></a>02793             softmin = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a3e77370ad783c9c9679b9afb3d0f49a9">softmin</a>;
<a name="l02794"></a>02794             softmax = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ac8f6bc84beed56ee707d4da30047be37">softmax</a>;
<a name="l02795"></a>02795             softrange = softmax - softmin;
<a name="l02796"></a>02796             
<a name="l02797"></a>02797             tempf = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a>;
<a name="l02798"></a>02798             temp = (int)data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a>;
<a name="l02799"></a>02799 
<a name="l02800"></a>02800 #<span class="keywordflow">if</span> 0
<a name="l02801"></a>02801             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a19d649cadf80f7b487a72cbf596b79bd">SLI</a>) {
<a name="l02802"></a>02802                 f = (float)(mx - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>) / (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>); <span class="comment">/* same as below */</span>
<a name="l02803"></a>02803             }
<a name="l02804"></a>02804             <span class="keywordflow">else</span>
<a name="l02805"></a>02805 <span class="preprocessor">#endif</span>
<a name="l02806"></a>02806 <span class="preprocessor"></span>            {
<a name="l02807"></a>02807                 f = (float)(mx - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>) / (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>);
<a name="l02808"></a>02808             }
<a name="l02809"></a>02809             
<a name="l02810"></a>02810             f = softmin + f * softrange;
<a name="l02811"></a>02811             
<a name="l02812"></a>02812             <span class="keywordflow">if</span> (!<a class="code" href="../../dd/dda/interface_8c.html#a6fa62dc0ab30ae1c60be551a55bb10fa">ui_is_but_float</a>(but)) {
<a name="l02813"></a>02813                 <span class="keywordflow">if</span> (f &lt; temp) temp--;
<a name="l02814"></a>02814                 <span class="keywordflow">else</span> temp++;
<a name="l02815"></a>02815                 
<a name="l02816"></a>02816                 <span class="keywordflow">if</span> (temp &gt;= softmin &amp;&amp; temp &lt;= softmax)
<a name="l02817"></a>02817                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = temp;
<a name="l02818"></a>02818                 <span class="keywordflow">else</span>
<a name="l02819"></a>02819                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l02820"></a>02820             } 
<a name="l02821"></a>02821             <span class="keywordflow">else</span> {
<a name="l02822"></a>02822                 <span class="keywordflow">if</span> (f &lt; tempf) tempf -= 0.01f;
<a name="l02823"></a>02823                 <span class="keywordflow">else</span> tempf += 0.01f;
<a name="l02824"></a>02824                 
<a name="l02825"></a>02825                 <span class="keywordflow">if</span> (tempf &gt;= softmin &amp;&amp; tempf &lt;= softmax)
<a name="l02826"></a>02826                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = tempf;
<a name="l02827"></a>02827                 <span class="keywordflow">else</span>
<a name="l02828"></a>02828                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l02829"></a>02829             }
<a name="l02830"></a>02830             
<a name="l02831"></a>02831             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02832"></a>02832             retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02833"></a>02833         }
<a name="l02834"></a>02834         <span class="keywordflow">else</span> {
<a name="l02835"></a>02835             <span class="comment">/* edit the value directly */</span>
<a name="l02836"></a>02836             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">BUTTON_STATE_TEXT_EDITING</a>);
<a name="l02837"></a>02837             retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02838"></a>02838         }
<a name="l02839"></a>02839     }
<a name="l02840"></a>02840     
<a name="l02841"></a>02841     <span class="keywordflow">return</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a>;
<a name="l02842"></a>02842 }
<a name="l02843"></a>02843 
<a name="l02844"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a755d20cec2cabb9e10deb382a04a4ff2">02844</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a755d20cec2cabb9e10deb382a04a4ff2">ui_do_but_SCROLL</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02845"></a>02845 {
<a name="l02846"></a>02846     <span class="keywordtype">int</span> mx, my <span class="comment">/*, click= 0 */</span>;
<a name="l02847"></a>02847     <span class="keywordtype">int</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l02848"></a>02848     <span class="keywordtype">int</span> horizontal = (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a> &gt; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abbb172bca1cfaa5d7538af548f1a1666">y2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>);
<a name="l02849"></a>02849     
<a name="l02850"></a>02850     mx = <span class="keyword">event</span>-&gt;x;
<a name="l02851"></a>02851     my = <span class="keyword">event</span>-&gt;y;
<a name="l02852"></a>02852     <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, block, &amp;mx, &amp;my);
<a name="l02853"></a>02853 
<a name="l02854"></a>02854     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l02855"></a>02855         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02856"></a>02856             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>) {
<a name="l02857"></a>02857                 <span class="keywordflow">if</span> (horizontal) {
<a name="l02858"></a>02858                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> = mx;
<a name="l02859"></a>02859                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l02860"></a>02860                 }
<a name="l02861"></a>02861                 <span class="keywordflow">else</span> {
<a name="l02862"></a>02862                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> = my;
<a name="l02863"></a>02863                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = my;
<a name="l02864"></a>02864                 }
<a name="l02865"></a>02865                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l02866"></a>02866                 retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02867"></a>02867             }
<a name="l02868"></a>02868             <span class="comment">/* UNUSED - otherwise code is ok, add back if needed */</span>
<a name="l02869"></a>02869 <span class="preprocessor">#if 0</span>
<a name="l02870"></a>02870 <span class="preprocessor"></span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aafdc675e684c8485e8e27c7f2bafcbef">PADENTER</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c861c5ebabe8fe076ed84a2aaa7a1a0">RETKEY</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>)
<a name="l02871"></a>02871                 click = 1;
<a name="l02872"></a>02872 <span class="preprocessor">#endif</span>
<a name="l02873"></a>02873 <span class="preprocessor"></span>        }
<a name="l02874"></a>02874     }
<a name="l02875"></a>02875     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>) {
<a name="l02876"></a>02876         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>) {
<a name="l02877"></a>02877             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l02878"></a>02878             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab781c61b8b3d2757829f9aa919e5f136">escapecancel</a> = 1;
<a name="l02879"></a>02879             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02880"></a>02880         }
<a name="l02881"></a>02881         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02882"></a>02882             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02883"></a>02883         }
<a name="l02884"></a>02884         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>) {
<a name="l02885"></a>02885             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad9a15dcc2f58950d922e88960dce87d9">ui_numedit_but_SLI</a>(but, data, 0, 0, (horizontal) ? mx : my))
<a name="l02886"></a>02886                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l02887"></a>02887         }
<a name="l02888"></a>02888 
<a name="l02889"></a>02889         retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02890"></a>02890     }
<a name="l02891"></a>02891     
<a name="l02892"></a>02892     <span class="keywordflow">return</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a>;
<a name="l02893"></a>02893 }
<a name="l02894"></a>02894 
<a name="l02895"></a>02895 
<a name="l02896"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#af08883cc26d9371b56b7092a4aefb406">02896</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#af08883cc26d9371b56b7092a4aefb406">ui_do_but_BLOCK</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02897"></a>02897 {
<a name="l02898"></a>02898     
<a name="l02899"></a>02899     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l02900"></a>02900         
<a name="l02901"></a>02901         <span class="comment">/* first handle click on icondrag type button */</span>
<a name="l02902"></a>02902         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23e894de3d96a5264d22687ff985e272">dragpoin</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02903"></a>02903             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a43d46273c2380ba298d59377b5f8b46f">ui_but_mouse_inside_icon</a>(but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, event)) {
<a name="l02904"></a>02904                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a930ea9a11f71ca40393f0d62d9d3afcb">BUTTON_STATE_WAIT_DRAG</a>);
<a name="l02905"></a>02905                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> = <span class="keyword">event</span>-&gt;x;
<a name="l02906"></a>02906                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a> = <span class="keyword">event</span>-&gt;y;
<a name="l02907"></a>02907                 <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02908"></a>02908             }
<a name="l02909"></a>02909         }
<a name="l02910"></a>02910         
<a name="l02911"></a>02911         <span class="comment">/* regular open menu */</span>
<a name="l02912"></a>02912         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aafdc675e684c8485e8e27c7f2bafcbef">PADENTER</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c861c5ebabe8fe076ed84a2aaa7a1a0">RETKEY</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l02913"></a>02913             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ae1228af3749113bd521ffaaa4f5060e8">BUTTON_STATE_MENU_OPEN</a>);
<a name="l02914"></a>02914             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02915"></a>02915         }
<a name="l02916"></a>02916         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad0d059e6a83d21bea4f4db1c9fbd240b">MENU</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#af6ad4ca5cd637c3ab6dad8114b8d3e75">ICONROW</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5975b2d368ff03c7359503587664fba5">ICONTEXTROW</a>)) {
<a name="l02917"></a>02917             
<a name="l02918"></a>02918             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a>) {
<a name="l02919"></a>02919                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a37380d6a36f2fb3d769d16f11daa9721">ui_step_name_menu</a>(but, -1);
<a name="l02920"></a>02920                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02921"></a>02921                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a87504e0357211849ab7661ff46be2fef">ui_apply_button</a>(C, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>, but, data, 1);
<a name="l02922"></a>02922 
<a name="l02923"></a>02923                 <span class="comment">/* button&#39;s state need to be changed to EXIT so moving mouse away from this mouse wouldn&#39;t lead</span>
<a name="l02924"></a>02924 <span class="comment">                 * to cancel changes made to this button, but changing state to EXIT also makes no button active for</span>
<a name="l02925"></a>02925 <span class="comment">                 * a while which leads to triggering operator when doing fast scrolling mouse wheel.</span>
<a name="l02926"></a>02926 <span class="comment">                 * using post activate stuff from button allows to make button be active again after checking for all</span>
<a name="l02927"></a>02927 <span class="comment">                 * all that mouse leave and cancel stuff, so quick scroll wouldn&#39;t be an issue anymore.</span>
<a name="l02928"></a>02928 <span class="comment">                 * same goes for scrolling wheel in another direction below (sergey)</span>
<a name="l02929"></a>02929 <span class="comment">                 */</span>
<a name="l02930"></a>02930                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ace9a44756d7460fca8dd9f3eb9f807db">postbut</a> = but;
<a name="l02931"></a>02931                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#acfd4bf78a3b0c42ca0309227cf0fe11d">posttype</a> = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0ba0ed75c6ab37a0b50ebaffdb3a4ad3f60">BUTTON_ACTIVATE_OVER</a>;
<a name="l02932"></a>02932 
<a name="l02933"></a>02933                 <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02934"></a>02934             }
<a name="l02935"></a>02935             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a>) {
<a name="l02936"></a>02936                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a37380d6a36f2fb3d769d16f11daa9721">ui_step_name_menu</a>(but, 1);
<a name="l02937"></a>02937                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02938"></a>02938                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a87504e0357211849ab7661ff46be2fef">ui_apply_button</a>(C, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>, but, data, 1);
<a name="l02939"></a>02939 
<a name="l02940"></a>02940                 <span class="comment">/* why this is needed described above */</span>
<a name="l02941"></a>02941                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ace9a44756d7460fca8dd9f3eb9f807db">postbut</a> = but;
<a name="l02942"></a>02942                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#acfd4bf78a3b0c42ca0309227cf0fe11d">posttype</a> = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0ba0ed75c6ab37a0b50ebaffdb3a4ad3f60">BUTTON_ACTIVATE_OVER</a>;
<a name="l02943"></a>02943 
<a name="l02944"></a>02944                 <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02945"></a>02945             }
<a name="l02946"></a>02946         }
<a name="l02947"></a>02947         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../dd/d8b/intern_2opennl_2superlu_2util_8h.html#a4d92d07523ba751afadecd63d3479e30a3e66f07732b51f2cb52e13d598f8abda">COL</a>) {
<a name="l02948"></a>02948             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a>) {
<a name="l02949"></a>02949                 <span class="keywordtype">float</span> *hsv = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a3f2601ef52731bc24c2f821fbe4ddadc">ui_block_hsv_get</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>);
<a name="l02950"></a>02950                 <span class="keywordtype">float</span> col[3];
<a name="l02951"></a>02951                 
<a name="l02952"></a>02952                 <a class="code" href="../../dd/dda/interface_8c.html#a12cb3aabf09cc9d093a80b0bc9ed98aa">ui_get_but_vectorf</a>(but, col);
<a name="l02953"></a>02953                 <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a7202f41c8cc83fc12e23115c35e9591b">rgb_to_hsv_compat</a>(col[0], col[1], col[2], hsv, hsv + 1, hsv + 2);
<a name="l02954"></a>02954 
<a name="l02955"></a>02955                 <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>)
<a name="l02956"></a>02956                     hsv[2] = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a49a86f7d81f477961529de3add6d68ab">CLAMPIS</a>(hsv[2] - 0.05f, 0.0f, 1.0f);
<a name="l02957"></a>02957                 <span class="keywordflow">else</span>
<a name="l02958"></a>02958                     hsv[2] = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a49a86f7d81f477961529de3add6d68ab">CLAMPIS</a>(hsv[2] + 0.05f, 0.0f, 1.0f);
<a name="l02959"></a>02959                 
<a name="l02960"></a>02960                 <a class="code" href="../../d8/de1/BLI__math__color_8h.html#acc6b7768c3233f64e0fbf2b66865a976">hsv_to_rgb</a>(hsv[0], hsv[1], hsv[2], data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a> + 1, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a> + 2);
<a name="l02961"></a>02961                 <a class="code" href="../../dd/dda/interface_8c.html#a305c3c1bfb22a3e27b3461ff5655b214">ui_set_but_vectorf</a>(but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>);
<a name="l02962"></a>02962                 
<a name="l02963"></a>02963                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02964"></a>02964                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a87504e0357211849ab7661ff46be2fef">ui_apply_button</a>(C, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>, but, data, 1);
<a name="l02965"></a>02965                 <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02966"></a>02966             }
<a name="l02967"></a>02967         }
<a name="l02968"></a>02968     }
<a name="l02969"></a>02969     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a930ea9a11f71ca40393f0d62d9d3afcb">BUTTON_STATE_WAIT_DRAG</a>) {
<a name="l02970"></a>02970         
<a name="l02971"></a>02971         <span class="comment">/* this function also ends state */</span>
<a name="l02972"></a>02972         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#aaadc9c0d1e734e39a2dae25bfb4866ee">ui_but_start_drag</a>(C, but, data, event)) {
<a name="l02973"></a>02973             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02974"></a>02974         }
<a name="l02975"></a>02975         
<a name="l02976"></a>02976         <span class="comment">/* outside icon quit, not needed if drag activated */</span>
<a name="l02977"></a>02977         <span class="keywordflow">if</span> (0 == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a43d46273c2380ba298d59377b5f8b46f">ui_but_mouse_inside_icon</a>(but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, event)) {
<a name="l02978"></a>02978             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l02979"></a>02979             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l02980"></a>02980             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02981"></a>02981         }
<a name="l02982"></a>02982         
<a name="l02983"></a>02983         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>) {
<a name="l02984"></a>02984             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ae1228af3749113bd521ffaaa4f5060e8">BUTTON_STATE_MENU_OPEN</a>);
<a name="l02985"></a>02985             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l02986"></a>02986         }
<a name="l02987"></a>02987 
<a name="l02988"></a>02988     }
<a name="l02989"></a>02989 
<a name="l02990"></a>02990     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l02991"></a>02991 }
<a name="l02992"></a>02992 
<a name="l02993"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a006eaab89df7b1554ebf1e4fe1eb8457">02993</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a006eaab89df7b1554ebf1e4fe1eb8457">ui_numedit_but_NORMAL</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">int</span> mx, <span class="keywordtype">int</span> my)
<a name="l02994"></a>02994 {
<a name="l02995"></a>02995     <span class="keywordtype">float</span> dx, dy, rad, radsq, mrad, *fp;
<a name="l02996"></a>02996     <span class="keywordtype">int</span> mdx, mdy, changed = 1;
<a name="l02997"></a>02997     
<a name="l02998"></a>02998     <span class="comment">/* button is presumed square */</span>
<a name="l02999"></a>02999     <span class="comment">/* if mouse moves outside of sphere, it does negative normal */</span>
<a name="l03000"></a>03000 
<a name="l03001"></a>03001     <span class="comment">/* note that both data-&gt;vec and data-&gt;origvec should be normalized</span>
<a name="l03002"></a>03002 <span class="comment">     * else we&#39;ll get a harmless but annoying jump when first clicking */</span>
<a name="l03003"></a>03003 
<a name="l03004"></a>03004     fp = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5ae96cbb3abbb1fcabf95027b029464c">origvec</a>;
<a name="l03005"></a>03005     rad = (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>);
<a name="l03006"></a>03006     radsq = rad * rad;
<a name="l03007"></a>03007     
<a name="l03008"></a>03008     <span class="keywordflow">if</span> (fp[2] &gt; 0.0f) {
<a name="l03009"></a>03009         mdx = (rad * fp[0]);
<a name="l03010"></a>03010         mdy = (rad * fp[1]);
<a name="l03011"></a>03011     }
<a name="l03012"></a>03012     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fp[2] &gt; -1.0f) {
<a name="l03013"></a>03013         mrad = rad / <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a33f9e82220f9ff9453a6557bd04bd8c5">sqrtf</a>(fp[0] * fp[0] + fp[1] * fp[1]);
<a name="l03014"></a>03014         
<a name="l03015"></a>03015         mdx = 2.0f * mrad * fp[0] - (rad * fp[0]);
<a name="l03016"></a>03016         mdy = 2.0f * mrad * fp[1] - (rad * fp[1]);
<a name="l03017"></a>03017     }
<a name="l03018"></a>03018     <span class="keywordflow">else</span> mdx = mdy = 0;
<a name="l03019"></a>03019     
<a name="l03020"></a>03020     dx = (float)(mx + mdx - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a>);
<a name="l03021"></a>03021     dy = (float)(my + mdy - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a>);
<a name="l03022"></a>03022 
<a name="l03023"></a>03023     fp = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>;
<a name="l03024"></a>03024     mrad = dx * dx + dy * dy;
<a name="l03025"></a>03025     <span class="keywordflow">if</span> (mrad &lt; radsq) { <span class="comment">/* inner circle */</span>
<a name="l03026"></a>03026         fp[0] = dx;
<a name="l03027"></a>03027         fp[1] = dy;
<a name="l03028"></a>03028         fp[2] = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(radsq - dx * dx - dy * dy);
<a name="l03029"></a>03029     }
<a name="l03030"></a>03030     <span class="keywordflow">else</span> {  <span class="comment">/* outer circle */</span>
<a name="l03031"></a>03031         
<a name="l03032"></a>03032         mrad = rad / <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a33f9e82220f9ff9453a6557bd04bd8c5">sqrtf</a>(mrad);  <span class="comment">// veclen</span>
<a name="l03033"></a>03033         
<a name="l03034"></a>03034         dx *= (2.0f * mrad - 1.0f);
<a name="l03035"></a>03035         dy *= (2.0f * mrad - 1.0f);
<a name="l03036"></a>03036         
<a name="l03037"></a>03037         mrad = dx * dx + dy * dy;
<a name="l03038"></a>03038         <span class="keywordflow">if</span> (mrad &lt; radsq) {
<a name="l03039"></a>03039             fp[0] = dx;
<a name="l03040"></a>03040             fp[1] = dy;
<a name="l03041"></a>03041             fp[2] = -<a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(radsq - dx * dx - dy * dy);
<a name="l03042"></a>03042         }
<a name="l03043"></a>03043     }
<a name="l03044"></a>03044     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(fp);
<a name="l03045"></a>03045 
<a name="l03046"></a>03046     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l03047"></a>03047     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a> = my;
<a name="l03048"></a>03048 
<a name="l03049"></a>03049     <span class="keywordflow">return</span> changed;
<a name="l03050"></a>03050 }
<a name="l03051"></a>03051 
<a name="l03052"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3c079ff20d110beef711c70fc71d98e5">03052</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3c079ff20d110beef711c70fc71d98e5">ui_do_but_NORMAL</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l03053"></a>03053 {
<a name="l03054"></a>03054     <span class="keywordtype">int</span> mx, my;
<a name="l03055"></a>03055 
<a name="l03056"></a>03056     mx = <span class="keyword">event</span>-&gt;x;
<a name="l03057"></a>03057     my = <span class="keyword">event</span>-&gt;y;
<a name="l03058"></a>03058     <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, block, &amp;mx, &amp;my);
<a name="l03059"></a>03059 
<a name="l03060"></a>03060     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l03061"></a>03061         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l03062"></a>03062             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> = mx;
<a name="l03063"></a>03063             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a> = my;
<a name="l03064"></a>03064             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l03065"></a>03065             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a> = my;
<a name="l03066"></a>03066             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l03067"></a>03067 
<a name="l03068"></a>03068             <span class="comment">/* also do drag the first time */</span>
<a name="l03069"></a>03069             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a006eaab89df7b1554ebf1e4fe1eb8457">ui_numedit_but_NORMAL</a>(but, data, mx, my))
<a name="l03070"></a>03070                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l03071"></a>03071             
<a name="l03072"></a>03072             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03073"></a>03073         }
<a name="l03074"></a>03074     }
<a name="l03075"></a>03075     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>) {
<a name="l03076"></a>03076         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>) {
<a name="l03077"></a>03077             <span class="keywordflow">if</span> (mx != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> || my != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a>) {
<a name="l03078"></a>03078                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a006eaab89df7b1554ebf1e4fe1eb8457">ui_numedit_but_NORMAL</a>(but, data, mx, my))
<a name="l03079"></a>03079                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l03080"></a>03080             }
<a name="l03081"></a>03081         }
<a name="l03082"></a>03082         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>)
<a name="l03083"></a>03083             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l03084"></a>03084 
<a name="l03085"></a>03085         <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03086"></a>03086     }
<a name="l03087"></a>03087     
<a name="l03088"></a>03088     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l03089"></a>03089 }
<a name="l03090"></a>03090 
<a name="l03091"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a7a6063ad1c35d83b91217d6f3fba399f">03091</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a7a6063ad1c35d83b91217d6f3fba399f">ui_numedit_but_HSVCUBE</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">int</span> mx, <span class="keywordtype">int</span> my)
<a name="l03092"></a>03092 {
<a name="l03093"></a>03093     <span class="keywordtype">float</span> rgb[3];
<a name="l03094"></a>03094     <span class="keywordtype">float</span> *hsv = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a3f2601ef52731bc24c2f821fbe4ddadc">ui_block_hsv_get</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>);
<a name="l03095"></a>03095     <span class="keywordtype">float</span> x, y;
<a name="l03096"></a>03096     <span class="keywordtype">int</span> changed = 1;
<a name="l03097"></a>03097     <span class="keywordtype">int</span> color_profile = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a131bd2bf1c25288b79727cc397ac0ce8">color_profile</a>;
<a name="l03098"></a>03098     
<a name="l03099"></a>03099     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>) {
<a name="l03100"></a>03100         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#ac2188d2835e07f6dd15491f6764cae78">RNA_property_subtype</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>) == <a class="code" href="../../de/d7e/RNA__types_8h.html#afc8d3af46d7ce49bb3e75305354fd9bcaab1f54146da7110e2098e8f4f47712ae">PROP_COLOR_GAMMA</a>)
<a name="l03101"></a>03101             color_profile = <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a74dfa2b5b58eec9cee1a1bf35c15a026">BLI_PR_NONE</a>;
<a name="l03102"></a>03102     }
<a name="l03103"></a>03103 
<a name="l03104"></a>03104     <a class="code" href="../../dd/dda/interface_8c.html#a12cb3aabf09cc9d093a80b0bc9ed98aa">ui_get_but_vectorf</a>(but, rgb);
<a name="l03105"></a>03105 
<a name="l03106"></a>03106     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a7202f41c8cc83fc12e23115c35e9591b">rgb_to_hsv_compat</a>(rgb[0], rgb[1], rgb[2], hsv, hsv + 1, hsv + 2);
<a name="l03107"></a>03107 
<a name="l03108"></a>03108     <span class="comment">/* relative position within box */</span>
<a name="l03109"></a>03109     x = ((float)mx - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>) / (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>);
<a name="l03110"></a>03110     y = ((float)my - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>) / (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abbb172bca1cfaa5d7538af548f1a1666">y2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>);
<a name="l03111"></a>03111     <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(x, 0.0f, 1.0f);
<a name="l03112"></a>03112     <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(y, 0.0f, 1.0f);
<a name="l03113"></a>03113 
<a name="l03114"></a>03114     <span class="keywordflow">switch</span> ((<span class="keywordtype">int</span>)but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a57586f98222f543b349453c1a83b4ce9">a1</a>) {
<a name="l03115"></a>03115         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a211b9bd52452d0777d1cfcf6d2f05669">UI_GRAD_SV</a>:
<a name="l03116"></a>03116             hsv[2] = x;
<a name="l03117"></a>03117             hsv[1] = y;
<a name="l03118"></a>03118             <span class="keywordflow">break</span>;
<a name="l03119"></a>03119         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#ab50d952ce83dffbf9f7755d26775065a">UI_GRAD_HV</a>:
<a name="l03120"></a>03120             hsv[0] = x;
<a name="l03121"></a>03121             hsv[2] = y;
<a name="l03122"></a>03122             <span class="keywordflow">break</span>;
<a name="l03123"></a>03123         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a7518ec3b42af4ed410672de6d78454f6">UI_GRAD_HS</a>:
<a name="l03124"></a>03124             hsv[0] = x;
<a name="l03125"></a>03125             hsv[1] = y;
<a name="l03126"></a>03126             <span class="keywordflow">break</span>;
<a name="l03127"></a>03127         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#acf9f25115e50fa96e2aea41929d3c42c">UI_GRAD_H</a>:
<a name="l03128"></a>03128             hsv[0] = x;
<a name="l03129"></a>03129             <span class="keywordflow">break</span>;
<a name="l03130"></a>03130         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a77a2da95f8ac9039fc6d182fbb0db074">UI_GRAD_S</a>:
<a name="l03131"></a>03131             hsv[1] = x;
<a name="l03132"></a>03132             <span class="keywordflow">break</span>;
<a name="l03133"></a>03133         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#add52c14a93f2a0bf5df3b0ed72937c06">UI_GRAD_V</a>:
<a name="l03134"></a>03134             hsv[2] = x;
<a name="l03135"></a>03135             <span class="keywordflow">break</span>;
<a name="l03136"></a>03136         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa15a85263ddb1caa2c928032de812a8e">UI_GRAD_V_ALT</a>:
<a name="l03137"></a>03137             <span class="comment">/* vertical &#39;value&#39; strip */</span>
<a name="l03138"></a>03138 
<a name="l03139"></a>03139             <span class="comment">/* exception only for value strip - use the range set in but-&gt;min/max */</span>
<a name="l03140"></a>03140             hsv[2] = y * (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ac8f6bc84beed56ee707d4da30047be37">softmax</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a3e77370ad783c9c9679b9afb3d0f49a9">softmin</a>) + but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a3e77370ad783c9c9679b9afb3d0f49a9">softmin</a>;
<a name="l03141"></a>03141 
<a name="l03142"></a>03142             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (color_profile)
<a name="l03143"></a>03143                 hsv[2] = <a class="code" href="../../d8/de1/BLI__math__color_8h.html#aac07ee66b3a4d8997cb7854e811ab314">srgb_to_linearrgb</a>(hsv[2]);
<a name="l03144"></a>03144 
<a name="l03145"></a>03145             <span class="keywordflow">if</span> (hsv[2] &gt; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ac8f6bc84beed56ee707d4da30047be37">softmax</a>)
<a name="l03146"></a>03146                 hsv[2] = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ac8f6bc84beed56ee707d4da30047be37">softmax</a>;
<a name="l03147"></a>03147             <span class="keywordflow">break</span>;
<a name="l03148"></a>03148         <span class="keywordflow">default</span>:
<a name="l03149"></a>03149             <a class="code" href="../../d5/d8e/Value_8h.html#a6f56363b38edbe2c8f3f447f891ee2c0">assert</a>(!<span class="stringliteral">&quot;invalid hsv type&quot;</span>);
<a name="l03150"></a>03150     }
<a name="l03151"></a>03151 
<a name="l03152"></a>03152     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#acc6b7768c3233f64e0fbf2b66865a976">hsv_to_rgb</a>(hsv[0], hsv[1], hsv[2], rgb, rgb + 1, rgb + 2);
<a name="l03153"></a>03153     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>, rgb);
<a name="l03154"></a>03154 
<a name="l03155"></a>03155     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l03156"></a>03156     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a> = my;
<a name="l03157"></a>03157 
<a name="l03158"></a>03158     <span class="keywordflow">return</span> changed;
<a name="l03159"></a>03159 }
<a name="l03160"></a>03160 
<a name="l03161"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#af9c191cf23df4c7c20b8537666b657f7">03161</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#af9c191cf23df4c7c20b8537666b657f7">ui_ndofedit_but_HSVCUBE</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d8/d66/structwmNDOFMotionData.html">wmNDOFMotionData</a> *ndof, <span class="keywordtype">int</span> shift)
<a name="l03162"></a>03162 {
<a name="l03163"></a>03163     <span class="keywordtype">float</span> *hsv = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a3f2601ef52731bc24c2f821fbe4ddadc">ui_block_hsv_get</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>);
<a name="l03164"></a>03164     <span class="keywordtype">float</span> rgb[3];
<a name="l03165"></a>03165     <span class="keywordtype">float</span> sensitivity = (shift ? 0.15f : 0.3f) * ndof-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#aa8200706e79acb437464a7df7d8a6511">dt</a>;
<a name="l03166"></a>03166     
<a name="l03167"></a>03167     <span class="keywordtype">int</span> color_profile = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a131bd2bf1c25288b79727cc397ac0ce8">color_profile</a>;
<a name="l03168"></a>03168     
<a name="l03169"></a>03169     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>) {
<a name="l03170"></a>03170         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#ac2188d2835e07f6dd15491f6764cae78">RNA_property_subtype</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>) == <a class="code" href="../../de/d7e/RNA__types_8h.html#afc8d3af46d7ce49bb3e75305354fd9bcaab1f54146da7110e2098e8f4f47712ae">PROP_COLOR_GAMMA</a>)
<a name="l03171"></a>03171             color_profile = <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a74dfa2b5b58eec9cee1a1bf35c15a026">BLI_PR_NONE</a>;
<a name="l03172"></a>03172     }
<a name="l03173"></a>03173 
<a name="l03174"></a>03174     <a class="code" href="../../dd/dda/interface_8c.html#a12cb3aabf09cc9d093a80b0bc9ed98aa">ui_get_but_vectorf</a>(but, rgb);
<a name="l03175"></a>03175     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a7202f41c8cc83fc12e23115c35e9591b">rgb_to_hsv_compat</a>(rgb[0], rgb[1], rgb[2], hsv, hsv + 1, hsv + 2);
<a name="l03176"></a>03176     
<a name="l03177"></a>03177     <span class="keywordflow">switch</span> ((<span class="keywordtype">int</span>)but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a57586f98222f543b349453c1a83b4ce9">a1</a>) {
<a name="l03178"></a>03178         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a211b9bd52452d0777d1cfcf6d2f05669">UI_GRAD_SV</a>:
<a name="l03179"></a>03179             hsv[2] += ndof-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#aa4023cb462a3402b7fd42d66338cefc9">ry</a> * sensitivity;
<a name="l03180"></a>03180             hsv[1] += ndof-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#adbb24381ea1b0b0405358e226cb17821">rx</a> * sensitivity;
<a name="l03181"></a>03181             <span class="keywordflow">break</span>;
<a name="l03182"></a>03182         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#ab50d952ce83dffbf9f7755d26775065a">UI_GRAD_HV</a>:
<a name="l03183"></a>03183             hsv[0] += ndof-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#aa4023cb462a3402b7fd42d66338cefc9">ry</a> * sensitivity;
<a name="l03184"></a>03184             hsv[2] += ndof-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#adbb24381ea1b0b0405358e226cb17821">rx</a> * sensitivity;
<a name="l03185"></a>03185             <span class="keywordflow">break</span>;
<a name="l03186"></a>03186         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a7518ec3b42af4ed410672de6d78454f6">UI_GRAD_HS</a>:
<a name="l03187"></a>03187             hsv[0] += ndof-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#aa4023cb462a3402b7fd42d66338cefc9">ry</a> * sensitivity;
<a name="l03188"></a>03188             hsv[1] += ndof-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#adbb24381ea1b0b0405358e226cb17821">rx</a> * sensitivity;
<a name="l03189"></a>03189             <span class="keywordflow">break</span>;
<a name="l03190"></a>03190         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#acf9f25115e50fa96e2aea41929d3c42c">UI_GRAD_H</a>:
<a name="l03191"></a>03191             hsv[0] += ndof-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#aa4023cb462a3402b7fd42d66338cefc9">ry</a> * sensitivity;
<a name="l03192"></a>03192             <span class="keywordflow">break</span>;
<a name="l03193"></a>03193         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a77a2da95f8ac9039fc6d182fbb0db074">UI_GRAD_S</a>:
<a name="l03194"></a>03194             hsv[1] += ndof-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#aa4023cb462a3402b7fd42d66338cefc9">ry</a> * sensitivity;
<a name="l03195"></a>03195             <span class="keywordflow">break</span>;
<a name="l03196"></a>03196         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#add52c14a93f2a0bf5df3b0ed72937c06">UI_GRAD_V</a>:
<a name="l03197"></a>03197             hsv[2] += ndof-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#aa4023cb462a3402b7fd42d66338cefc9">ry</a> * sensitivity;
<a name="l03198"></a>03198             <span class="keywordflow">break</span>;
<a name="l03199"></a>03199         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa15a85263ddb1caa2c928032de812a8e">UI_GRAD_V_ALT</a>: 
<a name="l03200"></a>03200             <span class="comment">/* vertical &#39;value&#39; strip */</span>
<a name="l03201"></a>03201             
<a name="l03202"></a>03202             <span class="comment">/* exception only for value strip - use the range set in but-&gt;min/max */</span>
<a name="l03203"></a>03203             hsv[2] += ndof-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#adbb24381ea1b0b0405358e226cb17821">rx</a> * sensitivity;
<a name="l03204"></a>03204             
<a name="l03205"></a>03205             <span class="keywordflow">if</span> (color_profile)
<a name="l03206"></a>03206                 hsv[2] = <a class="code" href="../../d8/de1/BLI__math__color_8h.html#aac07ee66b3a4d8997cb7854e811ab314">srgb_to_linearrgb</a>(hsv[2]);
<a name="l03207"></a>03207             
<a name="l03208"></a>03208             <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(hsv[2], but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a3e77370ad783c9c9679b9afb3d0f49a9">softmin</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ac8f6bc84beed56ee707d4da30047be37">softmax</a>);
<a name="l03209"></a>03209         <span class="keywordflow">default</span>:
<a name="l03210"></a>03210             <a class="code" href="../../d5/d8e/Value_8h.html#a6f56363b38edbe2c8f3f447f891ee2c0">assert</a>(!<span class="stringliteral">&quot;invalid hsv type&quot;</span>);
<a name="l03211"></a>03211     }
<a name="l03212"></a>03212     
<a name="l03213"></a>03213     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#acc6b7768c3233f64e0fbf2b66865a976">hsv_to_rgb</a>(hsv[0], hsv[1], hsv[2], rgb, rgb + 1, rgb + 2);
<a name="l03214"></a>03214     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>, rgb);
<a name="l03215"></a>03215     <a class="code" href="../../dd/dda/interface_8c.html#a305c3c1bfb22a3e27b3461ff5655b214">ui_set_but_vectorf</a>(but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>);
<a name="l03216"></a>03216 }
<a name="l03217"></a>03217 
<a name="l03218"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6340e7ace64ed0d5e9d67922e025c3cd">03218</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6340e7ace64ed0d5e9d67922e025c3cd">ui_do_but_HSVCUBE</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l03219"></a>03219 {
<a name="l03220"></a>03220     <span class="keywordtype">int</span> mx, my;
<a name="l03221"></a>03221 
<a name="l03222"></a>03222     mx = <span class="keyword">event</span>-&gt;x;
<a name="l03223"></a>03223     my = <span class="keyword">event</span>-&gt;y;
<a name="l03224"></a>03224     <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, block, &amp;mx, &amp;my);
<a name="l03225"></a>03225 
<a name="l03226"></a>03226     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l03227"></a>03227         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l03228"></a>03228             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> = mx;
<a name="l03229"></a>03229             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a> = my;
<a name="l03230"></a>03230             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l03231"></a>03231             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a> = my;
<a name="l03232"></a>03232             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l03233"></a>03233 
<a name="l03234"></a>03234             <span class="comment">/* also do drag the first time */</span>
<a name="l03235"></a>03235             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a7a6063ad1c35d83b91217d6f3fba399f">ui_numedit_but_HSVCUBE</a>(but, data, mx, my))
<a name="l03236"></a>03236                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l03237"></a>03237             
<a name="l03238"></a>03238             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03239"></a>03239         }
<a name="l03240"></a>03240         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a923a119e6e59562806b30dd6a899d19f">NDOF_MOTION</a>) {
<a name="l03241"></a>03241             <a class="code" href="../../d8/d66/structwmNDOFMotionData.html">wmNDOFMotionData</a> *ndof = (<a class="code" href="../../d8/d66/structwmNDOFMotionData.html">wmNDOFMotionData</a> *) event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a>;
<a name="l03242"></a>03242             
<a name="l03243"></a>03243             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#af9c191cf23df4c7c20b8537666b657f7">ui_ndofedit_but_HSVCUBE</a>(but, data, ndof, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>);
<a name="l03244"></a>03244             
<a name="l03245"></a>03245             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l03246"></a>03246             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a87504e0357211849ab7661ff46be2fef">ui_apply_button</a>(C, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>, but, data, 1);
<a name="l03247"></a>03247             
<a name="l03248"></a>03248             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03249"></a>03249         }
<a name="l03250"></a>03250         <span class="comment">/* XXX hardcoded keymap check.... */</span>
<a name="l03251"></a>03251         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aac0bf168bc790ab56adc890c4e8580bb">BACKSPACEKEY</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l03252"></a>03252             <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a57586f98222f543b349453c1a83b4ce9">a1</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa15a85263ddb1caa2c928032de812a8e">UI_GRAD_V_ALT</a>) {
<a name="l03253"></a>03253                 <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l03254"></a>03254                 
<a name="l03255"></a>03255                 <span class="comment">/* reset only value */</span>
<a name="l03256"></a>03256                 
<a name="l03257"></a>03257                 len = <a class="code" href="../../d3/d10/rna__access_8c.html#aad51db9a31d245dba4ee1f50608f331c">RNA_property_array_length</a>(&amp;but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>);
<a name="l03258"></a>03258                 <span class="keywordflow">if</span> (len &gt;= 3) {
<a name="l03259"></a>03259                     <span class="keywordtype">float</span> rgb[3], def_hsv[3];
<a name="l03260"></a>03260                     <span class="keywordtype">float</span> *def;
<a name="l03261"></a>03261                     <span class="keywordtype">float</span> *hsv = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a3f2601ef52731bc24c2f821fbe4ddadc">ui_block_hsv_get</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>);
<a name="l03262"></a>03262                     def = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * len, <span class="stringliteral">&quot;reset_defaults - float&quot;</span>);
<a name="l03263"></a>03263                     
<a name="l03264"></a>03264                     <a class="code" href="../../d3/d10/rna__access_8c.html#a67d6760f4f70f4e5831f21f5338f58aa">RNA_property_float_get_default_array</a>(&amp;but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>, def);
<a name="l03265"></a>03265                     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#af81d693396e981f14732f24004110550">rgb_to_hsv</a>(def[0], def[1], def[2], def_hsv, def_hsv + 1, def_hsv + 2);
<a name="l03266"></a>03266                     
<a name="l03267"></a>03267                     <a class="code" href="../../dd/dda/interface_8c.html#a12cb3aabf09cc9d093a80b0bc9ed98aa">ui_get_but_vectorf</a>(but, rgb);
<a name="l03268"></a>03268                     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a7202f41c8cc83fc12e23115c35e9591b">rgb_to_hsv_compat</a>(rgb[0], rgb[1], rgb[2], hsv, hsv + 1, hsv + 2);
<a name="l03269"></a>03269                     
<a name="l03270"></a>03270                     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#acc6b7768c3233f64e0fbf2b66865a976">hsv_to_rgb</a>(hsv[0], hsv[1], def_hsv[2], rgb, rgb + 1, rgb + 2);
<a name="l03271"></a>03271                     <a class="code" href="../../dd/dda/interface_8c.html#a305c3c1bfb22a3e27b3461ff5655b214">ui_set_but_vectorf</a>(but, rgb);
<a name="l03272"></a>03272                     
<a name="l03273"></a>03273                     <a class="code" href="../../d3/d10/rna__access_8c.html#a5fa7d69c3a73312275e1e6d20baf3bc6">RNA_property_update</a>(C, &amp;but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>);
<a name="l03274"></a>03274                     
<a name="l03275"></a>03275                     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(def);
<a name="l03276"></a>03276                 }
<a name="l03277"></a>03277                 <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03278"></a>03278             }
<a name="l03279"></a>03279         }
<a name="l03280"></a>03280     }
<a name="l03281"></a>03281     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>) {
<a name="l03282"></a>03282         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>) {
<a name="l03283"></a>03283             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l03284"></a>03284             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab781c61b8b3d2757829f9aa919e5f136">escapecancel</a> = 1;
<a name="l03285"></a>03285             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l03286"></a>03286         }
<a name="l03287"></a>03287         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>) {
<a name="l03288"></a>03288             <span class="keywordflow">if</span> (mx != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> || my != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a>) {
<a name="l03289"></a>03289                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a7a6063ad1c35d83b91217d6f3fba399f">ui_numedit_but_HSVCUBE</a>(but, data, mx, my))
<a name="l03290"></a>03290                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l03291"></a>03291             }
<a name="l03292"></a>03292         }
<a name="l03293"></a>03293         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>)
<a name="l03294"></a>03294             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l03295"></a>03295         
<a name="l03296"></a>03296         <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03297"></a>03297     }
<a name="l03298"></a>03298 
<a name="l03299"></a>03299     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l03300"></a>03300 }
<a name="l03301"></a>03301 
<a name="l03302"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab06a4563de2e4b477dfdf2a9a39dc9c8">03302</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab06a4563de2e4b477dfdf2a9a39dc9c8">ui_numedit_but_HSVCIRCLE</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">int</span> mx, <span class="keywordtype">int</span> my, <span class="keywordtype">int</span> shift)
<a name="l03303"></a>03303 {
<a name="l03304"></a>03304     <a class="code" href="../../d0/d28/structrcti.html">rcti</a> rect;
<a name="l03305"></a>03305     <span class="keywordtype">int</span> changed = 1;
<a name="l03306"></a>03306     <span class="keywordtype">float</span> rgb[3];
<a name="l03307"></a>03307     <span class="keywordtype">float</span> hsv[3];
<a name="l03308"></a>03308     
<a name="l03309"></a>03309     rect.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>; rect.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a>;
<a name="l03310"></a>03310     rect.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>; rect.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abbb172bca1cfaa5d7538af548f1a1666">y2</a>;
<a name="l03311"></a>03311     
<a name="l03312"></a>03312     <a class="code" href="../../dd/dda/interface_8c.html#a12cb3aabf09cc9d093a80b0bc9ed98aa">ui_get_but_vectorf</a>(but, rgb);
<a name="l03313"></a>03313     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(hsv, <a class="code" href="../../d1/d2f/interface__intern_8h.html#a3f2601ef52731bc24c2f821fbe4ddadc">ui_block_hsv_get</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>));
<a name="l03314"></a>03314     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a7202f41c8cc83fc12e23115c35e9591b">rgb_to_hsv_compat</a>(rgb[0], rgb[1], rgb[2], hsv, hsv + 1, hsv + 2);
<a name="l03315"></a>03315     
<a name="l03316"></a>03316     <span class="comment">/* exception, when using color wheel in &#39;locked&#39; value state:</span>
<a name="l03317"></a>03317 <span class="comment">     * allow choosing a hue for black values, by giving a tiny increment */</span>
<a name="l03318"></a>03318     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa0865984d0d3142903ad29a4d571967d">UI_BUT_COLOR_LOCK</a>) { <span class="comment">// lock</span>
<a name="l03319"></a>03319         <span class="keywordflow">if</span> (hsv[2] == 0.f) hsv[2] = 0.0001f;
<a name="l03320"></a>03320     }
<a name="l03321"></a>03321 
<a name="l03322"></a>03322     <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.uiflag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a6dcdc3e6aeed2189048e53e258a1e567">USER_CONTINUOUS_MOUSE</a>) {
<a name="l03323"></a>03323         <span class="keywordtype">float</span> fac = shift ? 0.05f : 1.0f;
<a name="l03324"></a>03324         <span class="comment">/* slow down the mouse, this is fairly picky */</span>
<a name="l03325"></a>03325         mx = (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> * (1.0f - fac) + mx * fac);
<a name="l03326"></a>03326         my = (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a> * (1.0f - fac) + my * fac);
<a name="l03327"></a>03327     }
<a name="l03328"></a>03328 
<a name="l03329"></a>03329     <a class="code" href="../../d1/d2f/interface__intern_8h.html#ab71a30f407a66adfa00b3c19a24e8ce9">ui_hsvcircle_vals_from_pos</a>(hsv, hsv + 1, &amp;rect, (<span class="keywordtype">float</span>)mx, (<span class="keywordtype">float</span>)my);
<a name="l03330"></a>03330 
<a name="l03331"></a>03331     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a10c42d8b0adb470a8abb4bd16c670d1f">UI_BUT_COLOR_CUBIC</a>)
<a name="l03332"></a>03332         hsv[1] = 1.0f - <a class="code" href="../../dd/d06/BLI__math__base_8h.html#af860afba9594e7ded009f494cd6b04aa">sqrt3f</a>(1.0f - hsv[1]);
<a name="l03333"></a>03333 
<a name="l03334"></a>03334     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#acc6b7768c3233f64e0fbf2b66865a976">hsv_to_rgb</a>(hsv[0], hsv[1], hsv[2], rgb, rgb + 1, rgb + 2);
<a name="l03335"></a>03335 
<a name="l03336"></a>03336     <span class="keywordflow">if</span> ((but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a47aba7a3a2fe2496b3cb1ba9a15efa1a">UI_BUT_VEC_SIZE_LOCK</a>) &amp;&amp; (rgb[0] || rgb[1] || rgb[2])) {
<a name="l03337"></a>03337         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(rgb);
<a name="l03338"></a>03338         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(rgb, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#adabf3be1173f6353f40cde0c6519312c">a2</a>);
<a name="l03339"></a>03339     }
<a name="l03340"></a>03340 
<a name="l03341"></a>03341     <a class="code" href="../../dd/dda/interface_8c.html#a305c3c1bfb22a3e27b3461ff5655b214">ui_set_but_vectorf</a>(but, rgb);
<a name="l03342"></a>03342     
<a name="l03343"></a>03343     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l03344"></a>03344     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a> = my;
<a name="l03345"></a>03345     
<a name="l03346"></a>03346     <span class="keywordflow">return</span> changed;
<a name="l03347"></a>03347 }
<a name="l03348"></a>03348 
<a name="l03349"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a4467aa4081f9e0f81331ae0a991e128f">03349</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a4467aa4081f9e0f81331ae0a991e128f">ui_ndofedit_but_HSVCIRCLE</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d8/d66/structwmNDOFMotionData.html">wmNDOFMotionData</a> *ndof, <span class="keywordtype">int</span> shift)
<a name="l03350"></a>03350 {
<a name="l03351"></a>03351     <span class="keywordtype">float</span> *hsv = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a3f2601ef52731bc24c2f821fbe4ddadc">ui_block_hsv_get</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>);
<a name="l03352"></a>03352     <span class="keywordtype">float</span> rgb[3];
<a name="l03353"></a>03353     <span class="keywordtype">float</span> phi, r <span class="comment">/*, sqr */</span> <span class="comment">/* UNUSED */</span>, v[2];
<a name="l03354"></a>03354     <span class="keywordtype">float</span> sensitivity = (shift ? 0.15f : 0.3f) * ndof-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#aa8200706e79acb437464a7df7d8a6511">dt</a>;
<a name="l03355"></a>03355     
<a name="l03356"></a>03356     <a class="code" href="../../dd/dda/interface_8c.html#a12cb3aabf09cc9d093a80b0bc9ed98aa">ui_get_but_vectorf</a>(but, rgb);
<a name="l03357"></a>03357     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a7202f41c8cc83fc12e23115c35e9591b">rgb_to_hsv_compat</a>(rgb[0], rgb[1], rgb[2], hsv, hsv + 1, hsv + 2);
<a name="l03358"></a>03358     
<a name="l03359"></a>03359     <span class="comment">/* Convert current colour on hue/sat disc to circular coordinates phi, r */</span>
<a name="l03360"></a>03360     phi = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a99d00034f7a5444b7f593b530f61c972">fmodf</a>(hsv[0] + 0.25f, 1.0f) * -2.0f * (float)<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>;
<a name="l03361"></a>03361     r = hsv[1];
<a name="l03362"></a>03362     <span class="comment">/* sqr= r&gt;0.f?sqrtf(r):1; */</span> <span class="comment">/* UNUSED */</span>
<a name="l03363"></a>03363     
<a name="l03364"></a>03364     <span class="comment">/* Convert to 2d vectors */</span>
<a name="l03365"></a>03365     v[0] = r * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a2503b77b52ff481a3507a596ae1f3938">cosf</a>(phi);
<a name="l03366"></a>03366     v[1] = r * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a1a55e3226c270625a4bff1befa977638">sinf</a>(phi);
<a name="l03367"></a>03367     
<a name="l03368"></a>03368     <span class="comment">/* Use ndof device y and x rotation to move the vector in 2d space */</span>
<a name="l03369"></a>03369     v[0] += ndof-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#aa4023cb462a3402b7fd42d66338cefc9">ry</a> * sensitivity;
<a name="l03370"></a>03370     v[1] += ndof-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#adbb24381ea1b0b0405358e226cb17821">rx</a> * sensitivity;
<a name="l03371"></a>03371 
<a name="l03372"></a>03372     <span class="comment">/* convert back to polar coords on circle */</span>
<a name="l03373"></a>03373     phi = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#ab616618cf09fc0ef5c0ec0d9e5825f58">atan2f</a>(v[0], v[1]) / (2.0f * (float)<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>) + 0.5f;
<a name="l03374"></a>03374     
<a name="l03375"></a>03375     <span class="comment">/* use ndof z rotation to additionally rotate hue */</span>
<a name="l03376"></a>03376     phi -= ndof-&gt;<a class="code" href="../../d8/d66/structwmNDOFMotionData.html#aa9da03746244002310e657db239f37c3">rz</a> * sensitivity * 0.5f;
<a name="l03377"></a>03377     
<a name="l03378"></a>03378     r = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a524206121dfa19c9c14423f3a96fcb2b">len_v2</a>(v);
<a name="l03379"></a>03379     <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(r, 0.0f, 1.0f);
<a name="l03380"></a>03380     
<a name="l03381"></a>03381     <span class="comment">/* convert back to hsv values, in range [0,1] */</span>
<a name="l03382"></a>03382     hsv[0] = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a99d00034f7a5444b7f593b530f61c972">fmodf</a>(phi, 1.0f);
<a name="l03383"></a>03383     hsv[1] = r;
<a name="l03384"></a>03384 
<a name="l03385"></a>03385     <span class="comment">/* exception, when using color wheel in &#39;locked&#39; value state:</span>
<a name="l03386"></a>03386 <span class="comment">     * allow choosing a hue for black values, by giving a tiny increment */</span>
<a name="l03387"></a>03387     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa0865984d0d3142903ad29a4d571967d">UI_BUT_COLOR_LOCK</a>) { <span class="comment">// lock</span>
<a name="l03388"></a>03388         <span class="keywordflow">if</span> (hsv[2] == 0.0f) hsv[2] = 0.0001f;
<a name="l03389"></a>03389     }
<a name="l03390"></a>03390     
<a name="l03391"></a>03391     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#acc6b7768c3233f64e0fbf2b66865a976">hsv_to_rgb</a>(hsv[0], hsv[1], hsv[2], data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a> + 1, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a> + 2);
<a name="l03392"></a>03392     
<a name="l03393"></a>03393     <span class="keywordflow">if</span> ((but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a47aba7a3a2fe2496b3cb1ba9a15efa1a">UI_BUT_VEC_SIZE_LOCK</a>) &amp;&amp; (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>[0] || data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>[1] || data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>[2])) {
<a name="l03394"></a>03394         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>);
<a name="l03395"></a>03395         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#adabf3be1173f6353f40cde0c6519312c">a2</a>);
<a name="l03396"></a>03396     }
<a name="l03397"></a>03397     
<a name="l03398"></a>03398     <a class="code" href="../../dd/dda/interface_8c.html#a305c3c1bfb22a3e27b3461ff5655b214">ui_set_but_vectorf</a>(but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>);
<a name="l03399"></a>03399 }
<a name="l03400"></a>03400 
<a name="l03401"></a>03401 
<a name="l03402"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9183b87f0a441235cb4bcaa2f35d9077">03402</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9183b87f0a441235cb4bcaa2f35d9077">ui_do_but_HSVCIRCLE</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l03403"></a>03403 {
<a name="l03404"></a>03404     <span class="keywordtype">int</span> mx, my;
<a name="l03405"></a>03405     mx = <span class="keyword">event</span>-&gt;x;
<a name="l03406"></a>03406     my = <span class="keyword">event</span>-&gt;y;
<a name="l03407"></a>03407     <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, block, &amp;mx, &amp;my);
<a name="l03408"></a>03408     
<a name="l03409"></a>03409     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l03410"></a>03410         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l03411"></a>03411             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> = mx;
<a name="l03412"></a>03412             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a> = my;
<a name="l03413"></a>03413             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l03414"></a>03414             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a> = my;
<a name="l03415"></a>03415             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l03416"></a>03416             
<a name="l03417"></a>03417             <span class="comment">/* also do drag the first time */</span>
<a name="l03418"></a>03418             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab06a4563de2e4b477dfdf2a9a39dc9c8">ui_numedit_but_HSVCIRCLE</a>(but, data, mx, my, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>))
<a name="l03419"></a>03419                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l03420"></a>03420             
<a name="l03421"></a>03421             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03422"></a>03422         }
<a name="l03423"></a>03423         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a923a119e6e59562806b30dd6a899d19f">NDOF_MOTION</a>) {
<a name="l03424"></a>03424             <a class="code" href="../../d8/d66/structwmNDOFMotionData.html">wmNDOFMotionData</a> *ndof = (<a class="code" href="../../d8/d66/structwmNDOFMotionData.html">wmNDOFMotionData</a> *) event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a>;
<a name="l03425"></a>03425             
<a name="l03426"></a>03426             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a4467aa4081f9e0f81331ae0a991e128f">ui_ndofedit_but_HSVCIRCLE</a>(but, data, ndof, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>);
<a name="l03427"></a>03427 
<a name="l03428"></a>03428             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l03429"></a>03429             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a87504e0357211849ab7661ff46be2fef">ui_apply_button</a>(C, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>, but, data, 1);
<a name="l03430"></a>03430             
<a name="l03431"></a>03431             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03432"></a>03432         }
<a name="l03433"></a>03433         <span class="comment">/* XXX hardcoded keymap check.... */</span>
<a name="l03434"></a>03434         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aac0bf168bc790ab56adc890c4e8580bb">BACKSPACEKEY</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l03435"></a>03435             <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l03436"></a>03436             
<a name="l03437"></a>03437             <span class="comment">/* reset only saturation */</span>
<a name="l03438"></a>03438             
<a name="l03439"></a>03439             len = <a class="code" href="../../d3/d10/rna__access_8c.html#aad51db9a31d245dba4ee1f50608f331c">RNA_property_array_length</a>(&amp;but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>);
<a name="l03440"></a>03440             <span class="keywordflow">if</span> (len &gt;= 3) {
<a name="l03441"></a>03441                 <span class="keywordtype">float</span> rgb[3], def_hsv[3];
<a name="l03442"></a>03442                 <span class="keywordtype">float</span> *def;
<a name="l03443"></a>03443                 <span class="keywordtype">float</span> *hsv = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a3f2601ef52731bc24c2f821fbe4ddadc">ui_block_hsv_get</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>);
<a name="l03444"></a>03444                 def = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * len, <span class="stringliteral">&quot;reset_defaults - float&quot;</span>);
<a name="l03445"></a>03445                 
<a name="l03446"></a>03446                 <a class="code" href="../../d3/d10/rna__access_8c.html#a67d6760f4f70f4e5831f21f5338f58aa">RNA_property_float_get_default_array</a>(&amp;but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>, def);
<a name="l03447"></a>03447                 <a class="code" href="../../d8/de1/BLI__math__color_8h.html#af81d693396e981f14732f24004110550">rgb_to_hsv</a>(def[0], def[1], def[2], def_hsv, def_hsv + 1, def_hsv + 2);
<a name="l03448"></a>03448                 
<a name="l03449"></a>03449                 <a class="code" href="../../dd/dda/interface_8c.html#a12cb3aabf09cc9d093a80b0bc9ed98aa">ui_get_but_vectorf</a>(but, rgb);
<a name="l03450"></a>03450                 <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a7202f41c8cc83fc12e23115c35e9591b">rgb_to_hsv_compat</a>(rgb[0], rgb[1], rgb[2], hsv, hsv + 1, hsv + 2);
<a name="l03451"></a>03451                 
<a name="l03452"></a>03452                 <a class="code" href="../../d8/de1/BLI__math__color_8h.html#acc6b7768c3233f64e0fbf2b66865a976">hsv_to_rgb</a>(hsv[0], def_hsv[1], hsv[2], rgb, rgb + 1, rgb + 2);
<a name="l03453"></a>03453                 <a class="code" href="../../dd/dda/interface_8c.html#a305c3c1bfb22a3e27b3461ff5655b214">ui_set_but_vectorf</a>(but, rgb);
<a name="l03454"></a>03454                 
<a name="l03455"></a>03455                 <a class="code" href="../../d3/d10/rna__access_8c.html#a5fa7d69c3a73312275e1e6d20baf3bc6">RNA_property_update</a>(C, &amp;but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>);
<a name="l03456"></a>03456                 
<a name="l03457"></a>03457                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(def);
<a name="l03458"></a>03458             }
<a name="l03459"></a>03459             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03460"></a>03460         }
<a name="l03461"></a>03461     }
<a name="l03462"></a>03462     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>) {
<a name="l03463"></a>03463         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>) {
<a name="l03464"></a>03464             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l03465"></a>03465             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab781c61b8b3d2757829f9aa919e5f136">escapecancel</a> = 1;
<a name="l03466"></a>03466             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l03467"></a>03467         }
<a name="l03468"></a>03468         <span class="comment">/* XXX hardcoded keymap check.... */</span>
<a name="l03469"></a>03469         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>) {
<a name="l03470"></a>03470             <span class="keywordtype">float</span> *hsv = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a3f2601ef52731bc24c2f821fbe4ddadc">ui_block_hsv_get</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>);
<a name="l03471"></a>03471             hsv[2] = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a49a86f7d81f477961529de3add6d68ab">CLAMPIS</a>(hsv[2] - 0.05f, 0.0f, 1.0f);
<a name="l03472"></a>03472             <a class="code" href="../../d1/d2f/interface__intern_8h.html#a38b0d9b4eb0a855811a42363874ee50d">ui_set_but_hsv</a>(but);    <span class="comment">// converts to rgb</span>
<a name="l03473"></a>03473             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l03474"></a>03474         }
<a name="l03475"></a>03475         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>) {
<a name="l03476"></a>03476             <span class="keywordtype">float</span> *hsv = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a3f2601ef52731bc24c2f821fbe4ddadc">ui_block_hsv_get</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>);
<a name="l03477"></a>03477             hsv[2] = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a49a86f7d81f477961529de3add6d68ab">CLAMPIS</a>(hsv[2] + 0.05f, 0.0f, 1.0f);
<a name="l03478"></a>03478             <a class="code" href="../../d1/d2f/interface__intern_8h.html#a38b0d9b4eb0a855811a42363874ee50d">ui_set_but_hsv</a>(but);    <span class="comment">// converts to rgb</span>
<a name="l03479"></a>03479             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l03480"></a>03480         }
<a name="l03481"></a>03481         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>) {
<a name="l03482"></a>03482             <span class="keywordflow">if</span> (mx != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> || my != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a>) {
<a name="l03483"></a>03483                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab06a4563de2e4b477dfdf2a9a39dc9c8">ui_numedit_but_HSVCIRCLE</a>(but, data, mx, my, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>))
<a name="l03484"></a>03484                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l03485"></a>03485             }
<a name="l03486"></a>03486         }
<a name="l03487"></a>03487         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l03488"></a>03488             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l03489"></a>03489         }
<a name="l03490"></a>03490         <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03491"></a>03491     }
<a name="l03492"></a>03492     
<a name="l03493"></a>03493     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l03494"></a>03494 }
<a name="l03495"></a>03495 
<a name="l03496"></a>03496 
<a name="l03497"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad61dfcadcd9afbf022639746733d68a9">03497</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad61dfcadcd9afbf022639746733d68a9">ui_numedit_but_COLORBAND</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">int</span> mx)
<a name="l03498"></a>03498 {
<a name="l03499"></a>03499     <span class="keywordtype">float</span> dx;
<a name="l03500"></a>03500     <span class="keywordtype">int</span> changed = 0;
<a name="l03501"></a>03501 
<a name="l03502"></a>03502     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> == mx)
<a name="l03503"></a>03503         <span class="keywordflow">return</span> changed;
<a name="l03504"></a>03504 
<a name="l03505"></a>03505     dx = ((float)(mx - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a>)) / (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>);
<a name="l03506"></a>03506     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ae3f3ece330f105e0bb31533e28ef16cd">dragcbd</a>-&gt;<a class="code" href="../../d6/de7/structCBData.html#a2c107365b262fd93815a67a2f41c7c6d">pos</a> += dx;
<a name="l03507"></a>03507     <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ae3f3ece330f105e0bb31533e28ef16cd">dragcbd</a>-&gt;<a class="code" href="../../d6/de7/structCBData.html#a2c107365b262fd93815a67a2f41c7c6d">pos</a>, 0.0f, 1.0f);
<a name="l03508"></a>03508     
<a name="l03509"></a>03509     <a class="code" href="../../d2/d66/BKE__texture_8h.html#a278487bc8c1708175fe9b2c3c4bad214">colorband_update_sort</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a12b850e20f8fcc35285b276e31ce2af5">coba</a>);
<a name="l03510"></a>03510     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ae3f3ece330f105e0bb31533e28ef16cd">dragcbd</a> = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a12b850e20f8fcc35285b276e31ce2af5">coba</a>-&gt;<a class="code" href="../../d0/dc8/structColorBand.html#a7d2f29fb0327fd1db93ad7f6e4760a28">data</a> + data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a12b850e20f8fcc35285b276e31ce2af5">coba</a>-&gt;<a class="code" href="../../d0/dc8/structColorBand.html#a68e7154ccfffe7036ebb28b37963637b">cur</a>;  <span class="comment">/* because qsort */</span>
<a name="l03511"></a>03511     
<a name="l03512"></a>03512     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l03513"></a>03513     changed = 1;
<a name="l03514"></a>03514 
<a name="l03515"></a>03515     <span class="keywordflow">return</span> changed;
<a name="l03516"></a>03516 }
<a name="l03517"></a>03517 
<a name="l03518"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ac894211d0c5541fa092583600849ff9e">03518</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ac894211d0c5541fa092583600849ff9e">ui_do_but_COLORBAND</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l03519"></a>03519 {
<a name="l03520"></a>03520     <a class="code" href="../../d0/dc8/structColorBand.html">ColorBand</a> *coba;
<a name="l03521"></a>03521     <a class="code" href="../../d6/de7/structCBData.html">CBData</a> *cbd;
<a name="l03522"></a>03522     <span class="keywordtype">int</span> mx, my, a, xco, mindist = 12;
<a name="l03523"></a>03523 
<a name="l03524"></a>03524     mx = <span class="keyword">event</span>-&gt;x;
<a name="l03525"></a>03525     my = <span class="keyword">event</span>-&gt;y;
<a name="l03526"></a>03526     <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, block, &amp;mx, &amp;my);
<a name="l03527"></a>03527 
<a name="l03528"></a>03528     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l03529"></a>03529         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l03530"></a>03530             coba = (<a class="code" href="../../d0/dc8/structColorBand.html">ColorBand</a> *)but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>;
<a name="l03531"></a>03531 
<a name="l03532"></a>03532             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a>) {
<a name="l03533"></a>03533                 <span class="comment">/* insert new key on mouse location */</span>
<a name="l03534"></a>03534                 <span class="keywordtype">float</span> pos = ((float)(mx - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>)) / (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>);
<a name="l03535"></a>03535                 <a class="code" href="../../d2/d66/BKE__texture_8h.html#a98fef2663e591ea08a0eef1832968713">colorband_element_add</a>(coba, pos);
<a name="l03536"></a>03536                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l03537"></a>03537             }
<a name="l03538"></a>03538             <span class="keywordflow">else</span> {
<a name="l03539"></a>03539                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> = mx;
<a name="l03540"></a>03540                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a> = my;
<a name="l03541"></a>03541                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l03542"></a>03542                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a> = my;
<a name="l03543"></a>03543 
<a name="l03544"></a>03544                 <span class="comment">/* activate new key when mouse is close */</span>
<a name="l03545"></a>03545                 <span class="keywordflow">for</span> (a = 0, cbd = coba-&gt;<a class="code" href="../../d0/dc8/structColorBand.html#a7d2f29fb0327fd1db93ad7f6e4760a28">data</a>; a &lt; coba-&gt;tot; a++, cbd++) {
<a name="l03546"></a>03546                     xco = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a> + (cbd-&gt;<a class="code" href="../../d6/de7/structCBData.html#a2c107365b262fd93815a67a2f41c7c6d">pos</a> * (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>));
<a name="l03547"></a>03547                     xco = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(xco - mx);
<a name="l03548"></a>03548                     <span class="keywordflow">if</span> (a == coba-&gt;<a class="code" href="../../d0/dc8/structColorBand.html#a68e7154ccfffe7036ebb28b37963637b">cur</a>) xco += 5;  <span class="comment">// selected one disadvantage</span>
<a name="l03549"></a>03549                     <span class="keywordflow">if</span> (xco &lt; mindist) {
<a name="l03550"></a>03550                         coba-&gt;<a class="code" href="../../d0/dc8/structColorBand.html#a68e7154ccfffe7036ebb28b37963637b">cur</a> = a;
<a name="l03551"></a>03551                         mindist = xco;
<a name="l03552"></a>03552                     }
<a name="l03553"></a>03553                 }
<a name="l03554"></a>03554         
<a name="l03555"></a>03555                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ae3f3ece330f105e0bb31533e28ef16cd">dragcbd</a> = coba-&gt;<a class="code" href="../../d0/dc8/structColorBand.html#a7d2f29fb0327fd1db93ad7f6e4760a28">data</a> + coba-&gt;<a class="code" href="../../d0/dc8/structColorBand.html#a68e7154ccfffe7036ebb28b37963637b">cur</a>;
<a name="l03556"></a>03556                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l03557"></a>03557             }
<a name="l03558"></a>03558 
<a name="l03559"></a>03559             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03560"></a>03560         }
<a name="l03561"></a>03561     }
<a name="l03562"></a>03562     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>) {
<a name="l03563"></a>03563         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>) {
<a name="l03564"></a>03564             <span class="keywordflow">if</span> (mx != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> || my != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a>) {
<a name="l03565"></a>03565                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad61dfcadcd9afbf022639746733d68a9">ui_numedit_but_COLORBAND</a>(but, data, mx))
<a name="l03566"></a>03566                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l03567"></a>03567             }
<a name="l03568"></a>03568         }
<a name="l03569"></a>03569         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>)
<a name="l03570"></a>03570             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l03571"></a>03571         
<a name="l03572"></a>03572         <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03573"></a>03573     }
<a name="l03574"></a>03574 
<a name="l03575"></a>03575     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l03576"></a>03576 }
<a name="l03577"></a>03577 
<a name="l03578"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad02ba0239da3dffd18f00f6aecca9ac3">03578</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad02ba0239da3dffd18f00f6aecca9ac3">ui_numedit_but_CURVE</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">int</span> snap, <span class="keywordtype">int</span> mx, <span class="keywordtype">int</span> my)
<a name="l03579"></a>03579 {
<a name="l03580"></a>03580     <a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumap = (<a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *)but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>;
<a name="l03581"></a>03581     <a class="code" href="../../df/d78/structCurveMap.html">CurveMap</a> *cuma = cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a> + cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a42253f3512ecfa1a9d852cbab168d744">cur</a>;
<a name="l03582"></a>03582     <a class="code" href="../../df/dff/structCurveMapPoint.html">CurveMapPoint</a> *cmp = cuma-&gt;curve;
<a name="l03583"></a>03583     <span class="keywordtype">float</span> fx, fy, zoomx, zoomy <span class="comment">/*, offsx, offsy */</span> <span class="comment">/* UNUSED */</span>;
<a name="l03584"></a>03584     <span class="keywordtype">int</span> a, changed = 0;
<a name="l03585"></a>03585 
<a name="l03586"></a>03586     zoomx = (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>) / (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>);
<a name="l03587"></a>03587     zoomy = (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abbb172bca1cfaa5d7538af548f1a1666">y2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>) / (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> - cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>);
<a name="l03588"></a>03588     <span class="comment">/* offsx= cumap-&gt;curr.xmin; */</span>
<a name="l03589"></a>03589     <span class="comment">/* offsy= cumap-&gt;curr.ymin; */</span>
<a name="l03590"></a>03590 
<a name="l03591"></a>03591     <span class="keywordflow">if</span> (snap) {
<a name="l03592"></a>03592         <span class="keywordtype">float</span> d[2];
<a name="l03593"></a>03593 
<a name="l03594"></a>03594         d[0] = mx - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a>;
<a name="l03595"></a>03595         d[1] = my - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a>;
<a name="l03596"></a>03596 
<a name="l03597"></a>03597         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a524206121dfa19c9c14423f3a96fcb2b">len_v2</a>(d) &lt; 3.0f)
<a name="l03598"></a>03598             snap = 0;
<a name="l03599"></a>03599     }
<a name="l03600"></a>03600 
<a name="l03601"></a>03601     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4625a175437558a84bbd1f780fb22569">dragsel</a> != -1) {
<a name="l03602"></a>03602         <span class="keywordtype">int</span> moved_point = 0;     <span class="comment">/* for ctrl grid, can&#39;t use orig coords because of sorting */</span>
<a name="l03603"></a>03603         
<a name="l03604"></a>03604         fx = (mx - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a>) / zoomx;
<a name="l03605"></a>03605         fy = (my - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a>) / zoomy;
<a name="l03606"></a>03606         <span class="keywordflow">for</span> (a = 0; a &lt; cuma-&gt;totpoint; a++) {
<a name="l03607"></a>03607             <span class="keywordflow">if</span> (cmp[a].flag &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l03608"></a>03608                 <span class="keywordtype">float</span> origx = cmp[a].x, origy = cmp[a].y;
<a name="l03609"></a>03609                 cmp[a].x += fx;
<a name="l03610"></a>03610                 cmp[a].y += fy;
<a name="l03611"></a>03611                 <span class="keywordflow">if</span> (snap) {
<a name="l03612"></a>03612                     cmp[a].x = 0.125f * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(0.5f + 8.0f * cmp[a].x);
<a name="l03613"></a>03613                     cmp[a].y = 0.125f * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(0.5f + 8.0f * cmp[a].y);
<a name="l03614"></a>03614                 }
<a name="l03615"></a>03615                 <span class="keywordflow">if</span> (cmp[a].x != origx || cmp[a].y != origy)
<a name="l03616"></a>03616                     moved_point = 1;
<a name="l03617"></a>03617             }
<a name="l03618"></a>03618         }
<a name="l03619"></a>03619 
<a name="l03620"></a>03620         <a class="code" href="../../d4/dca/BKE__colortools_8h.html#af77727c97a9f13c114da3e7dc320f41e">curvemapping_changed</a>(cumap, 0); <span class="comment">/* no remove doubles */</span>
<a name="l03621"></a>03621         
<a name="l03622"></a>03622         <span class="keywordflow">if</span> (moved_point) {
<a name="l03623"></a>03623             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l03624"></a>03624             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a> = my;
<a name="l03625"></a>03625             changed = 1;
<a name="l03626"></a>03626         }
<a name="l03627"></a>03627 
<a name="l03628"></a>03628         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab4df4530c50ab91a8cf958000e3c5a29">dragchange</a> = 1; <span class="comment">/* mark for selection */</span>
<a name="l03629"></a>03629     }
<a name="l03630"></a>03630     <span class="keywordflow">else</span> {
<a name="l03631"></a>03631         fx = (mx - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a>) / zoomx;
<a name="l03632"></a>03632         fy = (my - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a>) / zoomy;
<a name="l03633"></a>03633         
<a name="l03634"></a>03634         <span class="comment">/* clamp for clip */</span>
<a name="l03635"></a>03635         <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a130f6998b7ff2069fa85e60d83b0a1f2">flag</a> &amp; <a class="code" href="../../da/ddd/DNA__color__types_8h.html#a8649d5f9bc9f67e68cf78ffaa5b8695b">CUMA_DO_CLIP</a>) {
<a name="l03636"></a>03636             <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> - fx &lt; cumap-&gt;clipr.xmin)
<a name="l03637"></a>03637                 fx = cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> - cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a8a22e59a40d9fdd4cd46ebed31f078d4">clipr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>;
<a name="l03638"></a>03638             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - fx &gt; cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a8a22e59a40d9fdd4cd46ebed31f078d4">clipr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>)
<a name="l03639"></a>03639                 fx = cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a8a22e59a40d9fdd4cd46ebed31f078d4">clipr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>;
<a name="l03640"></a>03640             <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> - fy &lt; cumap-&gt;clipr.ymin)
<a name="l03641"></a>03641                 fy = cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> - cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a8a22e59a40d9fdd4cd46ebed31f078d4">clipr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>;
<a name="l03642"></a>03642             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> - fy &gt; cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a8a22e59a40d9fdd4cd46ebed31f078d4">clipr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>)
<a name="l03643"></a>03643                 fy = cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> - cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a8a22e59a40d9fdd4cd46ebed31f078d4">clipr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>;
<a name="l03644"></a>03644         }
<a name="l03645"></a>03645 
<a name="l03646"></a>03646         cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> -= fx;
<a name="l03647"></a>03647         cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> -= fy;
<a name="l03648"></a>03648         cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> -= fx;
<a name="l03649"></a>03649         cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> -= fy;
<a name="l03650"></a>03650         
<a name="l03651"></a>03651         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l03652"></a>03652         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a> = my;
<a name="l03653"></a>03653 
<a name="l03654"></a>03654         changed = 1;
<a name="l03655"></a>03655     }
<a name="l03656"></a>03656 
<a name="l03657"></a>03657     <span class="keywordflow">return</span> changed;
<a name="l03658"></a>03658 }
<a name="l03659"></a>03659 
<a name="l03660"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#afe0a4d7b2a340909b646c9e8961e7cd4">03660</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#afe0a4d7b2a340909b646c9e8961e7cd4">ui_do_but_CURVE</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l03661"></a>03661 {
<a name="l03662"></a>03662     <span class="keywordtype">int</span> mx, my, a, changed = 0;
<a name="l03663"></a>03663 
<a name="l03664"></a>03664     mx = <span class="keyword">event</span>-&gt;x;
<a name="l03665"></a>03665     my = <span class="keyword">event</span>-&gt;y;
<a name="l03666"></a>03666     <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, block, &amp;mx, &amp;my);
<a name="l03667"></a>03667 
<a name="l03668"></a>03668     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l03669"></a>03669         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l03670"></a>03670             <a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumap = (<a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *)but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>;
<a name="l03671"></a>03671             <a class="code" href="../../df/d78/structCurveMap.html">CurveMap</a> *cuma = cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a> + cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a42253f3512ecfa1a9d852cbab168d744">cur</a>;
<a name="l03672"></a>03672             <a class="code" href="../../df/dff/structCurveMapPoint.html">CurveMapPoint</a> *cmp;
<a name="l03673"></a>03673             <span class="keywordtype">float</span> fx, fy, zoomx, zoomy, offsx, offsy;
<a name="l03674"></a>03674             <span class="keywordtype">float</span> dist, mindist = 200.0f; <span class="comment">// 14 pixels radius</span>
<a name="l03675"></a>03675             <span class="keywordtype">int</span> sel = -1;
<a name="l03676"></a>03676 
<a name="l03677"></a>03677             zoomx = (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>) / (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>);
<a name="l03678"></a>03678             zoomy = (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abbb172bca1cfaa5d7538af548f1a1666">y2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>) / (cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> - cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>);
<a name="l03679"></a>03679             offsx = cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>;
<a name="l03680"></a>03680             offsy = cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a88909968cf780b4ddaaa900f739eaf26">curr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>;
<a name="l03681"></a>03681 
<a name="l03682"></a>03682             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a>) {
<a name="l03683"></a>03683                 fx = ((float)my - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>) / zoomx + offsx;
<a name="l03684"></a>03684                 fy = ((float)my - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>) / zoomy + offsy;
<a name="l03685"></a>03685                 
<a name="l03686"></a>03686                 <a class="code" href="../../d4/dca/BKE__colortools_8h.html#ae48b9a497fcc469e409457538eb9bdec">curvemap_insert</a>(cuma, fx, fy);
<a name="l03687"></a>03687                 <a class="code" href="../../d4/dca/BKE__colortools_8h.html#af77727c97a9f13c114da3e7dc320f41e">curvemapping_changed</a>(cumap, 0);
<a name="l03688"></a>03688                 changed = 1;
<a name="l03689"></a>03689             }
<a name="l03690"></a>03690 
<a name="l03691"></a>03691             <span class="comment">/* check for selecting of a point */</span>
<a name="l03692"></a>03692             cmp = cuma-&gt;curve;   <span class="comment">/* ctrl adds point, new malloc */</span>
<a name="l03693"></a>03693             <span class="keywordflow">for</span> (a = 0; a &lt; cuma-&gt;totpoint; a++) {
<a name="l03694"></a>03694                 fx = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a> + zoomx * (cmp[a].x - offsx);
<a name="l03695"></a>03695                 fy = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a> + zoomy * (cmp[a].y - offsy);
<a name="l03696"></a>03696                 dist = (fx - mx) * (fx - mx) + (fy - my) * (fy - my);
<a name="l03697"></a>03697                 <span class="keywordflow">if</span> (dist &lt; mindist) {
<a name="l03698"></a>03698                     sel = a;
<a name="l03699"></a>03699                     mindist = dist;
<a name="l03700"></a>03700                 }
<a name="l03701"></a>03701             }
<a name="l03702"></a>03702 
<a name="l03703"></a>03703             <span class="keywordflow">if</span> (sel == -1) {
<a name="l03704"></a>03704                 <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03705"></a>03705 
<a name="l03706"></a>03706                 <span class="comment">/* if the click didn&#39;t select anything, check if it&#39;s clicked on the </span>
<a name="l03707"></a>03707 <span class="comment">                 * curve itself, and if so, add a point */</span>
<a name="l03708"></a>03708                 fx = ((float)mx - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>) / zoomx + offsx;
<a name="l03709"></a>03709                 fy = ((float)my - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>) / zoomy + offsy;
<a name="l03710"></a>03710                 
<a name="l03711"></a>03711                 cmp = cuma-&gt;table;
<a name="l03712"></a>03712 
<a name="l03713"></a>03713                 <span class="comment">/* loop through the curve segment table and find what&#39;s near the mouse.</span>
<a name="l03714"></a>03714 <span class="comment">                 * 0.05 is kinda arbitrary, but seems to be what works nicely. */</span>
<a name="l03715"></a>03715                 <span class="keywordflow">for</span> (i = 0; i &lt;= <a class="code" href="../../da/ddd/DNA__color__types_8h.html#ad104910b48f7f1f351bb3363878be80b">CM_TABLE</a>; i++) {
<a name="l03716"></a>03716                     <span class="keywordflow">if</span> ( (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(fx - cmp[i].x) &lt; 0.05f) &amp;&amp;
<a name="l03717"></a>03717                          (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(fy - cmp[i].y) &lt; 0.05f))
<a name="l03718"></a>03718                     {
<a name="l03719"></a>03719                     
<a name="l03720"></a>03720                         <a class="code" href="../../d4/dca/BKE__colortools_8h.html#ae48b9a497fcc469e409457538eb9bdec">curvemap_insert</a>(cuma, fx, fy);
<a name="l03721"></a>03721                         <a class="code" href="../../d4/dca/BKE__colortools_8h.html#af77727c97a9f13c114da3e7dc320f41e">curvemapping_changed</a>(cumap, 0);
<a name="l03722"></a>03722 
<a name="l03723"></a>03723                         changed = 1;
<a name="l03724"></a>03724                         
<a name="l03725"></a>03725                         <span class="comment">/* reset cmp back to the curve points again, rather than drawing segments */</span>        
<a name="l03726"></a>03726                         cmp = cuma-&gt;curve;
<a name="l03727"></a>03727                         
<a name="l03728"></a>03728                         <span class="comment">/* find newly added point and make it &#39;sel&#39; */</span>
<a name="l03729"></a>03729                         <span class="keywordflow">for</span> (a = 0; a &lt; cuma-&gt;totpoint; a++)
<a name="l03730"></a>03730                             <span class="keywordflow">if</span> (cmp[a].x == fx)
<a name="l03731"></a>03731                                 sel = a;
<a name="l03732"></a>03732                             
<a name="l03733"></a>03733                         <span class="keywordflow">break</span>;
<a name="l03734"></a>03734                     }
<a name="l03735"></a>03735                 }
<a name="l03736"></a>03736             }
<a name="l03737"></a>03737 
<a name="l03738"></a>03738             <span class="keywordflow">if</span> (sel != -1) {
<a name="l03739"></a>03739                 <span class="comment">/* ok, we move a point */</span>
<a name="l03740"></a>03740                 <span class="comment">/* deselect all if this one is deselect. except if we hold shift */</span>
<a name="l03741"></a>03741                 <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a> == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) {
<a name="l03742"></a>03742                     <span class="keywordflow">for</span> (a = 0; a &lt; cuma-&gt;totpoint; a++)
<a name="l03743"></a>03743                         cmp[a].flag &amp;= ~<a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l03744"></a>03744                     cmp[sel].flag |= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l03745"></a>03745                 }
<a name="l03746"></a>03746                 <span class="keywordflow">else</span>
<a name="l03747"></a>03747                     cmp[sel].flag ^= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l03748"></a>03748             }
<a name="l03749"></a>03749             <span class="keywordflow">else</span> {
<a name="l03750"></a>03750                 <span class="comment">/* move the view */</span>
<a name="l03751"></a>03751                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l03752"></a>03752             }
<a name="l03753"></a>03753 
<a name="l03754"></a>03754             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4625a175437558a84bbd1f780fb22569">dragsel</a> = sel;
<a name="l03755"></a>03755 
<a name="l03756"></a>03756             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> = mx;
<a name="l03757"></a>03757             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a> = my;
<a name="l03758"></a>03758             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l03759"></a>03759             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a> = my;
<a name="l03760"></a>03760 
<a name="l03761"></a>03761             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l03762"></a>03762             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03763"></a>03763         }
<a name="l03764"></a>03764     }
<a name="l03765"></a>03765     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>) {
<a name="l03766"></a>03766         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>) {
<a name="l03767"></a>03767             <span class="keywordflow">if</span> (mx != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> || my != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a>) {
<a name="l03768"></a>03768                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad02ba0239da3dffd18f00f6aecca9ac3">ui_numedit_but_CURVE</a>(but, data, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a>, mx, my))
<a name="l03769"></a>03769                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l03770"></a>03770             }
<a name="l03771"></a>03771         }
<a name="l03772"></a>03772         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l03773"></a>03773             <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4625a175437558a84bbd1f780fb22569">dragsel</a> != -1) {
<a name="l03774"></a>03774                 <a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumap = (<a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *)but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>;
<a name="l03775"></a>03775                 <a class="code" href="../../df/d78/structCurveMap.html">CurveMap</a> *cuma = cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a> + cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#a42253f3512ecfa1a9d852cbab168d744">cur</a>;
<a name="l03776"></a>03776                 <a class="code" href="../../df/dff/structCurveMapPoint.html">CurveMapPoint</a> *cmp = cuma-&gt;curve;
<a name="l03777"></a>03777 
<a name="l03778"></a>03778                 <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (!data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab4df4530c50ab91a8cf958000e3c5a29">dragchange</a>) {
<a name="l03779"></a>03779                     <span class="comment">/* deselect all, select one */</span>
<a name="l03780"></a>03780                     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a> == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) {
<a name="l03781"></a>03781                         <span class="keywordflow">for</span> (a = 0; a &lt; cuma-&gt;totpoint; a++)
<a name="l03782"></a>03782                             cmp[a].flag &amp;= ~<a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l03783"></a>03783                         cmp[data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4625a175437558a84bbd1f780fb22569">dragsel</a>].flag |= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l03784"></a>03784                     }
<a name="l03785"></a>03785                 }
<a name="l03786"></a>03786                 <span class="keywordflow">else</span>
<a name="l03787"></a>03787                     <a class="code" href="../../d4/dca/BKE__colortools_8h.html#af77727c97a9f13c114da3e7dc320f41e">curvemapping_changed</a>(cumap, 1);  <span class="comment">/* remove doubles */</span>
<a name="l03788"></a>03788             }
<a name="l03789"></a>03789 
<a name="l03790"></a>03790             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l03791"></a>03791         }
<a name="l03792"></a>03792 
<a name="l03793"></a>03793         <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03794"></a>03794     }
<a name="l03795"></a>03795 
<a name="l03796"></a>03796     <span class="comment">/* UNUSED but keep for now */</span>
<a name="l03797"></a>03797     (void)changed;
<a name="l03798"></a>03798 
<a name="l03799"></a>03799     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l03800"></a>03800 }
<a name="l03801"></a>03801 
<a name="l03802"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#acf8918d7226402f3fa442e7409317b86">03802</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#acf8918d7226402f3fa442e7409317b86">in_scope_resize_zone</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(x), <span class="keywordtype">int</span> y)
<a name="l03803"></a>03803 {
<a name="l03804"></a>03804     <span class="comment">// bottom corner return (x &gt; but-&gt;x2 - SCOPE_RESIZE_PAD) &amp;&amp; (y &lt; but-&gt;y1 + SCOPE_RESIZE_PAD);</span>
<a name="l03805"></a>03805     <span class="keywordflow">return</span> (y &lt; but-&gt;y1 + <a class="code" href="../../d1/d2f/interface__intern_8h.html#a52b052f783f39b4ca186fc07c9a5ae28">SCOPE_RESIZE_PAD</a>);
<a name="l03806"></a>03806 }
<a name="l03807"></a>03807 
<a name="l03808"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae3e740a5f91a4d9594762ca9548311a5">03808</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae3e740a5f91a4d9594762ca9548311a5">ui_numedit_but_HISTOGRAM</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">int</span> mx, <span class="keywordtype">int</span> my)
<a name="l03809"></a>03809 {
<a name="l03810"></a>03810     <a class="code" href="../../d4/d8b/structHistogram.html">Histogram</a> *hist = (<a class="code" href="../../d4/d8b/structHistogram.html">Histogram</a> *)but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>;
<a name="l03811"></a>03811     <span class="comment">/* rcti rect; */</span>
<a name="l03812"></a>03812     <span class="keywordtype">int</span> changed = 1;
<a name="l03813"></a>03813     <span class="keywordtype">float</span> <span class="comment">/* dx, */</span> dy, yfac = 1.f; <span class="comment">/* UNUSED */</span>
<a name="l03814"></a>03814     
<a name="l03815"></a>03815     <span class="comment">/* rect.xmin = but-&gt;x1; rect.xmax = but-&gt;x2; */</span>
<a name="l03816"></a>03816     <span class="comment">/* rect.ymin = but-&gt;y1; rect.ymax = but-&gt;y2; */</span>
<a name="l03817"></a>03817     
<a name="l03818"></a>03818     <span class="comment">/* dx = mx - data-&gt;draglastx; */</span> <span class="comment">/* UNUSED */</span>
<a name="l03819"></a>03819     dy = my - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a>;
<a name="l03820"></a>03820     
<a name="l03821"></a>03821     
<a name="l03822"></a>03822     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#acf8918d7226402f3fa442e7409317b86">in_scope_resize_zone</a>(but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a>)) {
<a name="l03823"></a>03823         <span class="comment">/* resize histogram widget itself */</span>
<a name="l03824"></a>03824         hist-&gt;<a class="code" href="../../d4/d8b/structHistogram.html#aa745e9495c4fb8768c0f1bfb65415030">height</a> = (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abbb172bca1cfaa5d7538af548f1a1666">y2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>) + (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a> - my);
<a name="l03825"></a>03825     }
<a name="l03826"></a>03826     <span class="keywordflow">else</span> {
<a name="l03827"></a>03827         <span class="comment">/* scale histogram values */</span>
<a name="l03828"></a>03828         yfac = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(<a class="code" href="../../dd/d06/BLI__math__base_8h.html#acc9eed6743d69a0f62071dc0c7dd6ae8">powf</a>(hist-&gt;<a class="code" href="../../d4/d8b/structHistogram.html#aa36a62911184433ef4d0395a1e04bfff">ymax</a>, 2.f), 1.f) * 0.5f;
<a name="l03829"></a>03829         hist-&gt;<a class="code" href="../../d4/d8b/structHistogram.html#aa36a62911184433ef4d0395a1e04bfff">ymax</a> += dy * yfac;
<a name="l03830"></a>03830     
<a name="l03831"></a>03831         <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(hist-&gt;<a class="code" href="../../d4/d8b/structHistogram.html#aa36a62911184433ef4d0395a1e04bfff">ymax</a>, 1.f, 100.f);
<a name="l03832"></a>03832     }
<a name="l03833"></a>03833     
<a name="l03834"></a>03834     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l03835"></a>03835     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a> = my;
<a name="l03836"></a>03836     
<a name="l03837"></a>03837     <span class="keywordflow">return</span> changed;
<a name="l03838"></a>03838 }
<a name="l03839"></a>03839 
<a name="l03840"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3d39f8e06a4c45b4f1541b94c9b3c0ee">03840</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3d39f8e06a4c45b4f1541b94c9b3c0ee">ui_do_but_HISTOGRAM</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l03841"></a>03841 {
<a name="l03842"></a>03842     <span class="keywordtype">int</span> mx, my;
<a name="l03843"></a>03843     
<a name="l03844"></a>03844     mx = <span class="keyword">event</span>-&gt;x;
<a name="l03845"></a>03845     my = <span class="keyword">event</span>-&gt;y;
<a name="l03846"></a>03846     <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, block, &amp;mx, &amp;my);
<a name="l03847"></a>03847     
<a name="l03848"></a>03848     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l03849"></a>03849         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l03850"></a>03850             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> = mx;
<a name="l03851"></a>03851             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a> = my;
<a name="l03852"></a>03852             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l03853"></a>03853             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a> = my;
<a name="l03854"></a>03854             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l03855"></a>03855             
<a name="l03856"></a>03856             <span class="comment">/* also do drag the first time */</span>
<a name="l03857"></a>03857             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae3e740a5f91a4d9594762ca9548311a5">ui_numedit_but_HISTOGRAM</a>(but, data, mx, my))
<a name="l03858"></a>03858                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l03859"></a>03859             
<a name="l03860"></a>03860             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03861"></a>03861         }
<a name="l03862"></a>03862         <span class="comment">/* XXX hardcoded keymap check.... */</span>
<a name="l03863"></a>03863         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aac0bf168bc790ab56adc890c4e8580bb">BACKSPACEKEY</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l03864"></a>03864             <a class="code" href="../../d4/d8b/structHistogram.html">Histogram</a> *hist = (<a class="code" href="../../d4/d8b/structHistogram.html">Histogram</a> *)but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>;
<a name="l03865"></a>03865             hist-&gt;<a class="code" href="../../d4/d8b/structHistogram.html#aa36a62911184433ef4d0395a1e04bfff">ymax</a> = 1.f;
<a name="l03866"></a>03866             
<a name="l03867"></a>03867             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l03868"></a>03868             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03869"></a>03869         }
<a name="l03870"></a>03870     }
<a name="l03871"></a>03871     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>) {
<a name="l03872"></a>03872         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>) {
<a name="l03873"></a>03873             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l03874"></a>03874             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab781c61b8b3d2757829f9aa919e5f136">escapecancel</a> = 1;
<a name="l03875"></a>03875             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l03876"></a>03876         }
<a name="l03877"></a>03877         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>) {
<a name="l03878"></a>03878             <span class="keywordflow">if</span> (mx != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> || my != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a>) {
<a name="l03879"></a>03879                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae3e740a5f91a4d9594762ca9548311a5">ui_numedit_but_HISTOGRAM</a>(but, data, mx, my))
<a name="l03880"></a>03880                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l03881"></a>03881             }
<a name="l03882"></a>03882         }
<a name="l03883"></a>03883         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l03884"></a>03884             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l03885"></a>03885         }
<a name="l03886"></a>03886         <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03887"></a>03887     }
<a name="l03888"></a>03888     
<a name="l03889"></a>03889     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l03890"></a>03890 }
<a name="l03891"></a>03891 
<a name="l03892"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1f003f2ebd2f6b08bb050b3b224161fc">03892</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1f003f2ebd2f6b08bb050b3b224161fc">ui_numedit_but_WAVEFORM</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">int</span> mx, <span class="keywordtype">int</span> my)
<a name="l03893"></a>03893 {
<a name="l03894"></a>03894     <a class="code" href="../../dc/db8/structScopes.html">Scopes</a> *scopes = (<a class="code" href="../../dc/db8/structScopes.html">Scopes</a> *)but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>;
<a name="l03895"></a>03895     <span class="comment">/* rcti rect; */</span>
<a name="l03896"></a>03896     <span class="keywordtype">int</span> changed = 1;
<a name="l03897"></a>03897     <span class="keywordtype">float</span> <span class="comment">/* dx, */</span> dy <span class="comment">/* , yfac=1.f */</span>; <span class="comment">/* UNUSED */</span>
<a name="l03898"></a>03898 
<a name="l03899"></a>03899     <span class="comment">/* rect.xmin = but-&gt;x1; rect.xmax = but-&gt;x2; */</span>
<a name="l03900"></a>03900     <span class="comment">/* rect.ymin = but-&gt;y1; rect.ymax = but-&gt;y2; */</span>
<a name="l03901"></a>03901 
<a name="l03902"></a>03902     <span class="comment">/* dx = mx - data-&gt;draglastx; */</span> <span class="comment">/* UNUSED */</span>
<a name="l03903"></a>03903     dy = my - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a>;
<a name="l03904"></a>03904 
<a name="l03905"></a>03905 
<a name="l03906"></a>03906     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#acf8918d7226402f3fa442e7409317b86">in_scope_resize_zone</a>(but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a>)) {
<a name="l03907"></a>03907         <span class="comment">/* resize waveform widget itself */</span>
<a name="l03908"></a>03908         scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a0bb974670482bc2c2cdf8babc571ab7f">wavefrm_height</a> = (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abbb172bca1cfaa5d7538af548f1a1666">y2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>) + (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a> - my);
<a name="l03909"></a>03909     }
<a name="l03910"></a>03910     <span class="keywordflow">else</span> {
<a name="l03911"></a>03911         <span class="comment">/* scale waveform values */</span>
<a name="l03912"></a>03912         <span class="comment">/* yfac = scopes-&gt;wavefrm_yfac; */</span> <span class="comment">/* UNUSED */</span>
<a name="l03913"></a>03913         scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a2ca227725c7991b974bb817d1b36150d">wavefrm_yfac</a> += dy / 200.0f;
<a name="l03914"></a>03914 
<a name="l03915"></a>03915         <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a2ca227725c7991b974bb817d1b36150d">wavefrm_yfac</a>, 0.5f, 2.f);
<a name="l03916"></a>03916     }
<a name="l03917"></a>03917 
<a name="l03918"></a>03918     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l03919"></a>03919     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a> = my;
<a name="l03920"></a>03920 
<a name="l03921"></a>03921     <span class="keywordflow">return</span> changed;
<a name="l03922"></a>03922 }
<a name="l03923"></a>03923 
<a name="l03924"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad1cbadb44ae98e14fc73d3ee575b8b41">03924</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad1cbadb44ae98e14fc73d3ee575b8b41">ui_do_but_WAVEFORM</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l03925"></a>03925 {
<a name="l03926"></a>03926     <span class="keywordtype">int</span> mx, my;
<a name="l03927"></a>03927 
<a name="l03928"></a>03928     mx = <span class="keyword">event</span>-&gt;x;
<a name="l03929"></a>03929     my = <span class="keyword">event</span>-&gt;y;
<a name="l03930"></a>03930     <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, block, &amp;mx, &amp;my);
<a name="l03931"></a>03931 
<a name="l03932"></a>03932     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l03933"></a>03933         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l03934"></a>03934             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> = mx;
<a name="l03935"></a>03935             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a> = my;
<a name="l03936"></a>03936             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l03937"></a>03937             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a> = my;
<a name="l03938"></a>03938             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l03939"></a>03939 
<a name="l03940"></a>03940             <span class="comment">/* also do drag the first time */</span>
<a name="l03941"></a>03941             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1f003f2ebd2f6b08bb050b3b224161fc">ui_numedit_but_WAVEFORM</a>(but, data, mx, my))
<a name="l03942"></a>03942                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l03943"></a>03943 
<a name="l03944"></a>03944             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03945"></a>03945         }
<a name="l03946"></a>03946         <span class="comment">/* XXX hardcoded keymap check.... */</span>
<a name="l03947"></a>03947         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aac0bf168bc790ab56adc890c4e8580bb">BACKSPACEKEY</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l03948"></a>03948             <a class="code" href="../../dc/db8/structScopes.html">Scopes</a> *scopes = (<a class="code" href="../../dc/db8/structScopes.html">Scopes</a> *)but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>;
<a name="l03949"></a>03949             scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a2ca227725c7991b974bb817d1b36150d">wavefrm_yfac</a> = 1.f;
<a name="l03950"></a>03950 
<a name="l03951"></a>03951             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l03952"></a>03952             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03953"></a>03953         }
<a name="l03954"></a>03954     }
<a name="l03955"></a>03955     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>) {
<a name="l03956"></a>03956         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>) {
<a name="l03957"></a>03957             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l03958"></a>03958             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab781c61b8b3d2757829f9aa919e5f136">escapecancel</a> = 1;
<a name="l03959"></a>03959             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l03960"></a>03960         }
<a name="l03961"></a>03961         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>) {
<a name="l03962"></a>03962             <span class="keywordflow">if</span> (mx != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> || my != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a>) {
<a name="l03963"></a>03963                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1f003f2ebd2f6b08bb050b3b224161fc">ui_numedit_but_WAVEFORM</a>(but, data, mx, my))
<a name="l03964"></a>03964                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l03965"></a>03965             }
<a name="l03966"></a>03966         }
<a name="l03967"></a>03967         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l03968"></a>03968             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l03969"></a>03969         }
<a name="l03970"></a>03970         <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l03971"></a>03971     }
<a name="l03972"></a>03972 
<a name="l03973"></a>03973     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l03974"></a>03974 }
<a name="l03975"></a>03975 
<a name="l03976"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#af14f38d299dd478af8c3108768485ef2">03976</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#af14f38d299dd478af8c3108768485ef2">ui_numedit_but_VECTORSCOPE</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">int</span> mx, <span class="keywordtype">int</span> my)
<a name="l03977"></a>03977 {
<a name="l03978"></a>03978     <a class="code" href="../../dc/db8/structScopes.html">Scopes</a> *scopes = (<a class="code" href="../../dc/db8/structScopes.html">Scopes</a> *)but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>;
<a name="l03979"></a>03979     <span class="comment">/* rcti rect; */</span>
<a name="l03980"></a>03980     <span class="keywordtype">int</span> changed = 1;
<a name="l03981"></a>03981     <span class="comment">/* float dx, dy; */</span>
<a name="l03982"></a>03982 
<a name="l03983"></a>03983     <span class="comment">/* rect.xmin = but-&gt;x1; rect.xmax = but-&gt;x2; */</span>
<a name="l03984"></a>03984     <span class="comment">/* rect.ymin = but-&gt;y1; rect.ymax = but-&gt;y2; */</span>
<a name="l03985"></a>03985 
<a name="l03986"></a>03986     <span class="comment">/* dx = mx - data-&gt;draglastx; */</span>
<a name="l03987"></a>03987     <span class="comment">/* dy = my - data-&gt;draglasty; */</span>
<a name="l03988"></a>03988 
<a name="l03989"></a>03989     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#acf8918d7226402f3fa442e7409317b86">in_scope_resize_zone</a>(but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a>)) {
<a name="l03990"></a>03990         <span class="comment">/* resize vectorscope widget itself */</span>
<a name="l03991"></a>03991         scopes-&gt;<a class="code" href="../../dc/db8/structScopes.html#a60c7ca02c8e7129c0498d956c4657d27">vecscope_height</a> = (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abbb172bca1cfaa5d7538af548f1a1666">y2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>) + (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a> - my);
<a name="l03992"></a>03992     }
<a name="l03993"></a>03993 
<a name="l03994"></a>03994     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l03995"></a>03995     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a> = my;
<a name="l03996"></a>03996 
<a name="l03997"></a>03997     <span class="keywordflow">return</span> changed;
<a name="l03998"></a>03998 }
<a name="l03999"></a>03999 
<a name="l04000"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a967263f3403fda6e10cab598003709dd">04000</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a967263f3403fda6e10cab598003709dd">ui_do_but_VECTORSCOPE</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l04001"></a>04001 {
<a name="l04002"></a>04002     <span class="keywordtype">int</span> mx, my;
<a name="l04003"></a>04003 
<a name="l04004"></a>04004     mx = <span class="keyword">event</span>-&gt;x;
<a name="l04005"></a>04005     my = <span class="keyword">event</span>-&gt;y;
<a name="l04006"></a>04006     <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, block, &amp;mx, &amp;my);
<a name="l04007"></a>04007 
<a name="l04008"></a>04008     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l04009"></a>04009         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l04010"></a>04010             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> = mx;
<a name="l04011"></a>04011             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a> = my;
<a name="l04012"></a>04012             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l04013"></a>04013             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a> = my;
<a name="l04014"></a>04014             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l04015"></a>04015 
<a name="l04016"></a>04016             <span class="comment">/* also do drag the first time */</span>
<a name="l04017"></a>04017             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#af14f38d299dd478af8c3108768485ef2">ui_numedit_but_VECTORSCOPE</a>(but, data, mx, my))
<a name="l04018"></a>04018                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l04019"></a>04019 
<a name="l04020"></a>04020             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l04021"></a>04021         }
<a name="l04022"></a>04022     }
<a name="l04023"></a>04023     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>) {
<a name="l04024"></a>04024         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>) {
<a name="l04025"></a>04025             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l04026"></a>04026             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab781c61b8b3d2757829f9aa919e5f136">escapecancel</a> = 1;
<a name="l04027"></a>04027             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l04028"></a>04028         }
<a name="l04029"></a>04029         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>) {
<a name="l04030"></a>04030             <span class="keywordflow">if</span> (mx != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> || my != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a>) {
<a name="l04031"></a>04031                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#af14f38d299dd478af8c3108768485ef2">ui_numedit_but_VECTORSCOPE</a>(but, data, mx, my))
<a name="l04032"></a>04032                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l04033"></a>04033             }
<a name="l04034"></a>04034         }
<a name="l04035"></a>04035         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l04036"></a>04036             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l04037"></a>04037         }
<a name="l04038"></a>04038         <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l04039"></a>04039     }
<a name="l04040"></a>04040 
<a name="l04041"></a>04041     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l04042"></a>04042 }
<a name="l04043"></a>04043 
<a name="l04044"></a>04044 <span class="preprocessor">#ifdef WITH_INTERNATIONAL</span>
<a name="l04045"></a>04045 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span> ui_do_but_CHARTAB(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>), <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(block), <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(but), <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>), <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l04046"></a>04046 {
<a name="l04047"></a>04047     <span class="comment">/* XXX 2.50 bad global and state access */</span>
<a name="l04048"></a>04048 <span class="preprocessor">#if 0</span>
<a name="l04049"></a>04049 <span class="preprocessor"></span>    <span class="keywordtype">float</span> sx, sy, ex, ey;
<a name="l04050"></a>04050     <span class="keywordtype">float</span> width, height;
<a name="l04051"></a>04051     <span class="keywordtype">float</span> butw, buth;
<a name="l04052"></a>04052     <span class="keywordtype">int</span> mx, my, x, y, cs, che;
<a name="l04053"></a>04053 
<a name="l04054"></a>04054     mx = <span class="keyword">event</span>-&gt;x;
<a name="l04055"></a>04055     my = <span class="keyword">event</span>-&gt;y;
<a name="l04056"></a>04056     <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>-&gt;region, block, &amp;mx, &amp;my);
<a name="l04057"></a>04057 
<a name="l04058"></a>04058     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>-&gt;state == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l04059"></a>04059         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(event-&gt;type, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aafdc675e684c8485e8e27c7f2bafcbef">PADENTER</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c861c5ebabe8fe076ed84a2aaa7a1a0">RETKEY</a>) &amp;&amp; event-&gt;val == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l04060"></a>04060             <span class="comment">/* Calculate the size of the button */</span>
<a name="l04061"></a>04061             width = <a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>);
<a name="l04062"></a>04062             height = <a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abbb172bca1cfaa5d7538af548f1a1666">y2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>);
<a name="l04063"></a>04063 
<a name="l04064"></a>04064             butw = floor(width / 12);
<a name="l04065"></a>04065             buth = floor(height / 6);
<a name="l04066"></a>04066 
<a name="l04067"></a>04067             <span class="comment">/* Initialize variables */</span>
<a name="l04068"></a>04068             sx = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a>;
<a name="l04069"></a>04069             ex = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a> + butw;
<a name="l04070"></a>04070             sy = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a> + height - buth;
<a name="l04071"></a>04071             ey = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a> + height;
<a name="l04072"></a>04072 
<a name="l04073"></a>04073             cs = <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.charstart;
<a name="l04074"></a>04074 
<a name="l04075"></a>04075             <span class="comment">/* And the character is */</span>
<a name="l04076"></a>04076             x = (int) ((mx / butw) - 0.5);
<a name="l04077"></a>04077             y = (int) (6 - ((my / buth) - 0.5));
<a name="l04078"></a>04078 
<a name="l04079"></a>04079             che = cs + (y * 12) + x;
<a name="l04080"></a>04080 
<a name="l04081"></a>04081             <span class="keywordflow">if</span> (che &gt; <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.charmax)
<a name="l04082"></a>04082                 che = 0;
<a name="l04083"></a>04083 
<a name="l04084"></a>04084             <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.obedit) {
<a name="l04085"></a>04085                 do_textedit(0, 0, che);
<a name="l04086"></a>04086             }
<a name="l04087"></a>04087 
<a name="l04088"></a>04088             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l04089"></a>04089             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l04090"></a>04090         }
<a name="l04091"></a>04091         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;type, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2da9bb01ecf11a9818c9f8eb06743237">PAGEUPKEY</a>)) {
<a name="l04092"></a>04092             <span class="keywordflow">for</span> (but = block-&gt;buttons.first; but; but = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>) {
<a name="l04093"></a>04093                 <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a7d7e8bdc1e410df600429cb3cf65817c">CHARTAB</a>) {
<a name="l04094"></a>04094                     <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.charstart = <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.charstart - (12 * 6);
<a name="l04095"></a>04095                     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.charstart &lt; 0)
<a name="l04096"></a>04096                         <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.charstart = 0;
<a name="l04097"></a>04097                     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.charstart &lt; <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.charmin)
<a name="l04098"></a>04098                         <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.charstart = <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.charmin;
<a name="l04099"></a>04099                     <a class="code" href="../../d1/d2f/interface__intern_8h.html#a2a5c2a8c44d33007bb291c0a97559a26">ui_draw_but</a>(but);
<a name="l04100"></a>04100 
<a name="l04101"></a>04101                     <span class="comment">//Really nasty... to update the num button from the same butblock</span>
<a name="l04102"></a>04102                     <span class="keywordflow">for</span> (bt = block-&gt;buttons.first; bt; bt = bt-&gt;next)
<a name="l04103"></a>04103                     {
<a name="l04104"></a>04104                         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(bt-&gt;type, <a class="code" href="../../d9/dc4/plugin_8h.html#aaf0952059602752258dccaa015d7b54a">NUM</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a53ab9b2f5a030a06d3a609f2aad1fde3">NUMABS</a>)) {
<a name="l04105"></a>04105                             <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(bt);
<a name="l04106"></a>04106                             <a class="code" href="../../d1/d2f/interface__intern_8h.html#a2a5c2a8c44d33007bb291c0a97559a26">ui_draw_but</a>(bt);
<a name="l04107"></a>04107                         }
<a name="l04108"></a>04108                     }
<a name="l04109"></a>04109                     <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = UI_CONT;
<a name="l04110"></a>04110                     <span class="keywordflow">break</span>;
<a name="l04111"></a>04111                 }
<a name="l04112"></a>04112             }
<a name="l04113"></a>04113 
<a name="l04114"></a>04114             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l04115"></a>04115         }
<a name="l04116"></a>04116         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;type, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a3864b9574c939049ca9a2cb6523035e8">PAGEDOWNKEY</a>)) {
<a name="l04117"></a>04117             <span class="keywordflow">for</span> (but = block-&gt;buttons.first; but; but = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>) {
<a name="l04118"></a>04118                 <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a7d7e8bdc1e410df600429cb3cf65817c">CHARTAB</a>) {
<a name="l04119"></a>04119                     <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.charstart = <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.charstart + (12 * 6);
<a name="l04120"></a>04120                     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.charstart &gt; (0xffff - 12 * 6))
<a name="l04121"></a>04121                         <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.charstart = 0xffff - (12 * 6);
<a name="l04122"></a>04122                     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.charstart &gt; <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.charmax - 12 * 6)
<a name="l04123"></a>04123                         <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.charstart = <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.charmax - 12 * 6;
<a name="l04124"></a>04124                     <a class="code" href="../../d1/d2f/interface__intern_8h.html#a2a5c2a8c44d33007bb291c0a97559a26">ui_draw_but</a>(but);
<a name="l04125"></a>04125 
<a name="l04126"></a>04126                     <span class="keywordflow">for</span> (bt = block-&gt;buttons.first; bt; bt = bt-&gt;next)
<a name="l04127"></a>04127                     {
<a name="l04128"></a>04128                         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(bt-&gt;type, <a class="code" href="../../d9/dc4/plugin_8h.html#aaf0952059602752258dccaa015d7b54a">NUM</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a53ab9b2f5a030a06d3a609f2aad1fde3">NUMABS</a>)) {
<a name="l04129"></a>04129                             <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(bt);
<a name="l04130"></a>04130                             <a class="code" href="../../d1/d2f/interface__intern_8h.html#a2a5c2a8c44d33007bb291c0a97559a26">ui_draw_but</a>(bt);
<a name="l04131"></a>04131                         }
<a name="l04132"></a>04132                     }
<a name="l04133"></a>04133                     
<a name="l04134"></a>04134                     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> |= <a class="code" href="../../d1/d2f/interface__intern_8h.html#a79b3f8d716499489d309feda1a3eaa43">UI_ACTIVE</a>;
<a name="l04135"></a>04135                     <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a0958fdecb4298063870bc8a9b642724a">UI_RETURN_OK</a>;
<a name="l04136"></a>04136                     <span class="keywordflow">break</span>;
<a name="l04137"></a>04137                 }
<a name="l04138"></a>04138             }
<a name="l04139"></a>04139 
<a name="l04140"></a>04140             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l04141"></a>04141         }
<a name="l04142"></a>04142     }
<a name="l04143"></a>04143 <span class="preprocessor">#endif</span>
<a name="l04144"></a>04144 <span class="preprocessor"></span>
<a name="l04145"></a>04145     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l04146"></a>04146 }
<a name="l04147"></a>04147 <span class="preprocessor">#endif</span>
<a name="l04148"></a>04148 <span class="preprocessor"></span>
<a name="l04149"></a>04149 
<a name="l04150"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a83de0750704c68523acb0f12c9510b75">04150</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a83de0750704c68523acb0f12c9510b75">ui_do_but_LINK</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l04151"></a>04151 {   
<a name="l04152"></a>04152     <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a6f9e3205a25a942a5c33cb609c31db65">VECCOPY2D</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa48225c4b95073ff22a02b16ee2ded87">linkto</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>);
<a name="l04153"></a>04153 
<a name="l04154"></a>04154     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l04155"></a>04155         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l04156"></a>04156             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a9fa352d4981373c052341e4a7dfd7c3d">BUTTON_STATE_WAIT_RELEASE</a>);
<a name="l04157"></a>04157             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l04158"></a>04158         }
<a name="l04159"></a>04159         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a5c195fe9502deed2ddbcdb3edadae776">handle</a>) {
<a name="l04160"></a>04160             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l04161"></a>04161             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l04162"></a>04162         }
<a name="l04163"></a>04163     }
<a name="l04164"></a>04164     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a9fa352d4981373c052341e4a7dfd7c3d">BUTTON_STATE_WAIT_RELEASE</a>) {
<a name="l04165"></a>04165         
<a name="l04166"></a>04166         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l04167"></a>04167             <span class="keywordflow">if</span> (!(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d1/d2f/interface__intern_8h.html#ada5088cd71649979ef58a9b21e0420cb">UI_SELECT</a>))
<a name="l04168"></a>04168                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l04169"></a>04169             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l04170"></a>04170             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l04171"></a>04171         }
<a name="l04172"></a>04172     }
<a name="l04173"></a>04173     
<a name="l04174"></a>04174     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l04175"></a>04175 }
<a name="l04176"></a>04176 
<a name="l04177"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#abc2f09007887b0dc824fac6eea64fbb5">04177</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#abc2f09007887b0dc824fac6eea64fbb5">ui_numedit_but_TRACKPREVIEW</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">int</span> mx, <span class="keywordtype">int</span> my, <span class="keywordtype">int</span> shift)
<a name="l04178"></a>04178 {
<a name="l04179"></a>04179     <a class="code" href="../../d5/d2c/structMovieClipScopes.html">MovieClipScopes</a> *scopes = (<a class="code" href="../../d5/d2c/structMovieClipScopes.html">MovieClipScopes</a> *)but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a>;
<a name="l04180"></a>04180     <span class="keywordtype">int</span> changed = 1;
<a name="l04181"></a>04181     <span class="keywordtype">float</span> dx, dy;
<a name="l04182"></a>04182 
<a name="l04183"></a>04183     dx = mx - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a>;
<a name="l04184"></a>04184     dy = my - data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a>;
<a name="l04185"></a>04185 
<a name="l04186"></a>04186     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (shift) {
<a name="l04187"></a>04187         dx /= 5.0f;
<a name="l04188"></a>04188         dy /= 5.0f;
<a name="l04189"></a>04189     }
<a name="l04190"></a>04190 
<a name="l04191"></a>04191     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#acf8918d7226402f3fa442e7409317b86">in_scope_resize_zone</a>(but, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a>)) {
<a name="l04192"></a>04192         <span class="comment">/* resize preview widget itself */</span>
<a name="l04193"></a>04193         scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#a2befc9d0050388ebdd9809a893568711">track_preview_height</a> = (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abbb172bca1cfaa5d7538af548f1a1666">y2</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>) + (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a> - my);
<a name="l04194"></a>04194     }
<a name="l04195"></a>04195     <span class="keywordflow">else</span> {
<a name="l04196"></a>04196         <span class="keywordflow">if</span> (scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#ac94cc74981a319792a92d46f627f0fbb">marker</a>) {
<a name="l04197"></a>04197             <span class="keywordflow">if</span> (scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#ac94cc74981a319792a92d46f627f0fbb">marker</a>-&gt;<a class="code" href="../../d2/d75/structMovieTrackingMarker.html#add7ffc50ffb44d63da012f43977e38ad">framenr</a> != scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#a9babf14cf4d0967c4f5bfda678cd8750">framenr</a>)
<a name="l04198"></a>04198                 scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#ac94cc74981a319792a92d46f627f0fbb">marker</a> = <a class="code" href="../../da/d72/BKE__tracking_8h.html#adf9aae43031b0cc4bcf7e7416cecdc9e">BKE_tracking_ensure_marker</a>(scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#af476e7cd59b61e8ad7417e407480b6af">track</a>, scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#a9babf14cf4d0967c4f5bfda678cd8750">framenr</a>);
<a name="l04199"></a>04199 
<a name="l04200"></a>04200             scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#ac94cc74981a319792a92d46f627f0fbb">marker</a>-&gt;<a class="code" href="../../d2/d75/structMovieTrackingMarker.html#a6bf7281cddce79f77edb8e48d58a5973">flag</a> &amp;= ~(<a class="code" href="../../d3/dd4/DNA__tracking__types_8h.html#a90fb842f2f7efe62795eff3853df39ba">MARKER_DISABLED</a> | <a class="code" href="../../d3/dd4/DNA__tracking__types_8h.html#ae82a1c87be95f416b45c5a0c25270a83">MARKER_TRACKED</a>);
<a name="l04201"></a>04201             scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#ac94cc74981a319792a92d46f627f0fbb">marker</a>-&gt;<a class="code" href="../../d2/d75/structMovieTrackingMarker.html#a77909423cde0f8a5b52779c8897bb654">pos</a>[0] += -dx * scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#a2bd828a80e1eb7449c10117087d5e1a6">slide_scale</a>[0] / (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a55ab0ddb306b70d5e5479aef2b8c3a2e">maxx</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#aff4f04b1fe47fbc5e8c99baaa7714454">minx</a>);
<a name="l04202"></a>04202             scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#ac94cc74981a319792a92d46f627f0fbb">marker</a>-&gt;<a class="code" href="../../d2/d75/structMovieTrackingMarker.html#a77909423cde0f8a5b52779c8897bb654">pos</a>[1] += -dy * scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#a2bd828a80e1eb7449c10117087d5e1a6">slide_scale</a>[1] / (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#ae7c47f5582dff9e5cdcb94b59f42dba6">maxy</a> - but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a8c1f31a6c10605079edbf9efbd3920f3">miny</a>);
<a name="l04203"></a>04203 
<a name="l04204"></a>04204             <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a50b8b6ff8b8949b158250fdc6f315408">NC_MOVIECLIP</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l04205"></a>04205         }
<a name="l04206"></a>04206 
<a name="l04207"></a>04207         scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#af834ede6aa0952be7e023c2a36cf8b0d">ok</a> = 0;
<a name="l04208"></a>04208     }
<a name="l04209"></a>04209 
<a name="l04210"></a>04210     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l04211"></a>04211     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a> = my;
<a name="l04212"></a>04212 
<a name="l04213"></a>04213     <span class="keywordflow">return</span> changed;
<a name="l04214"></a>04214 }
<a name="l04215"></a>04215 
<a name="l04216"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8a05c3b75c6bfc7f703765a789e89193">04216</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8a05c3b75c6bfc7f703765a789e89193">ui_do_but_TRACKPREVIEW</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l04217"></a>04217 {
<a name="l04218"></a>04218     <span class="keywordtype">int</span> mx, my;
<a name="l04219"></a>04219 
<a name="l04220"></a>04220     mx = <span class="keyword">event</span>-&gt;x;
<a name="l04221"></a>04221     my = <span class="keyword">event</span>-&gt;y;
<a name="l04222"></a>04222     <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, block, &amp;mx, &amp;my);
<a name="l04223"></a>04223 
<a name="l04224"></a>04224     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l04225"></a>04225         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l04226"></a>04226             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a4483e683277016e78fb1719bc603b4a7">dragstartx</a> = mx;
<a name="l04227"></a>04227             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab99ec6966873228faa07feef8a4fe644">dragstarty</a> = my;
<a name="l04228"></a>04228             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> = mx;
<a name="l04229"></a>04229             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a> = my;
<a name="l04230"></a>04230             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>);
<a name="l04231"></a>04231 
<a name="l04232"></a>04232             <span class="comment">/* also do drag the first time */</span>
<a name="l04233"></a>04233             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#abc2f09007887b0dc824fac6eea64fbb5">ui_numedit_but_TRACKPREVIEW</a>(C, but, data, mx, my, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>))
<a name="l04234"></a>04234                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l04235"></a>04235 
<a name="l04236"></a>04236             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l04237"></a>04237         }
<a name="l04238"></a>04238     }
<a name="l04239"></a>04239     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>) {
<a name="l04240"></a>04240         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>) {
<a name="l04241"></a>04241             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l04242"></a>04242             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab781c61b8b3d2757829f9aa919e5f136">escapecancel</a> = 1;
<a name="l04243"></a>04243             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l04244"></a>04244         }
<a name="l04245"></a>04245         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>) {
<a name="l04246"></a>04246             <span class="keywordflow">if</span> (mx != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aea59958a886bc1a8bc16479ab4a2948e">draglastx</a> || my != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a5776f0c5ff00e11315bb814eaec77bc2">draglasty</a>) {
<a name="l04247"></a>04247                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#abc2f09007887b0dc824fac6eea64fbb5">ui_numedit_but_TRACKPREVIEW</a>(C, but, data, mx, my, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>))
<a name="l04248"></a>04248                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a18df5f88fff77e13ca26f4d3854c5a8b">ui_numedit_apply</a>(C, block, but, data);
<a name="l04249"></a>04249             }
<a name="l04250"></a>04250         }
<a name="l04251"></a>04251         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l04252"></a>04252             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l04253"></a>04253         }
<a name="l04254"></a>04254         <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l04255"></a>04255     }
<a name="l04256"></a>04256 
<a name="l04257"></a>04257     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l04258"></a>04258 }
<a name="l04259"></a>04259 
<a name="l04260"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a266a0489f2eadfb8e218513590e3e0b6">04260</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a266a0489f2eadfb8e218513590e3e0b6">but_shortcut_name_func</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <span class="keywordtype">void</span> *arg1, <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l04261"></a>04261 {
<a name="l04262"></a>04262     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but = (<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *)arg1;
<a name="l04263"></a>04263 
<a name="l04264"></a>04264     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a>) {
<a name="l04265"></a>04265         <span class="keywordtype">char</span> shortcut_str[128];
<a name="l04266"></a>04266 
<a name="l04267"></a>04267         <a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop = (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abc3962ff38f89bafee42df467dd0cf87">opptr</a>) ? but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abc3962ff38f89bafee42df467dd0cf87">opptr</a>-&gt;<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04268"></a>04268         
<a name="l04269"></a>04269         <span class="comment">/* complex code to change name of button */</span>
<a name="l04270"></a>04270         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (<a class="code" href="../../d7/d78/wm__keymap_8c.html#afd663ed7665f3ba481cd77b05c9214a5">WM_key_event_operator_string</a>(C, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#acfc4beefe5eea8396a20281850dbf00c">opcontext</a>, prop, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>,
<a name="l04271"></a>04271                                          shortcut_str, <span class="keyword">sizeof</span>(shortcut_str)))
<a name="l04272"></a>04272         {
<a name="l04273"></a>04273             <a class="code" href="../../dd/dda/interface_8c.html#ad705f41cb1b04ca4b4612a2d38ca35c6">ui_but_add_shortcut</a>(but, shortcut_str, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l04274"></a>04274         }
<a name="l04275"></a>04275         <span class="keywordflow">else</span> {
<a name="l04276"></a>04276             <span class="comment">/* simply strip the shortcut */</span>
<a name="l04277"></a>04277             <a class="code" href="../../dd/dda/interface_8c.html#ad705f41cb1b04ca4b4612a2d38ca35c6">ui_but_add_shortcut</a>(but, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l04278"></a>04278         }
<a name="l04279"></a>04279     }
<a name="l04280"></a>04280 }
<a name="l04281"></a>04281 
<a name="l04282"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3ed0c54078fd57bb56c9017c165487e0">04282</a> <span class="keyword">static</span> <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3ed0c54078fd57bb56c9017c165487e0">menu_change_shortcut</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <span class="keywordtype">void</span> *arg)
<a name="l04283"></a>04283 {
<a name="l04284"></a>04284     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l04285"></a>04285     <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block;
<a name="l04286"></a>04286     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but = (<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *)arg;
<a name="l04287"></a>04287     <a class="code" href="../../d3/d90/structwmKeyMap.html">wmKeyMap</a> *km;
<a name="l04288"></a>04288     <a class="code" href="../../d1/d5e/structwmKeyMapItem.html">wmKeyMapItem</a> *kmi;
<a name="l04289"></a>04289     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> ptr;
<a name="l04290"></a>04290     <a class="code" href="../../d4/d94/structuiLayout.html">uiLayout</a> *layout;
<a name="l04291"></a>04291     <a class="code" href="../../d3/d28/structuiStyle.html">uiStyle</a> *style = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a16828a47eb4af34d08dce0ead86693b3">UI_GetStyle</a>();
<a name="l04292"></a>04292     <a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop = (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abc3962ff38f89bafee42df467dd0cf87">opptr</a>) ? but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abc3962ff38f89bafee42df467dd0cf87">opptr</a>-&gt;<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04293"></a>04293     <span class="keywordtype">int</span> kmi_id = <a class="code" href="../../d7/d78/wm__keymap_8c.html#a8964cdf1b6f85f0f0cd525d429784bb4">WM_key_event_operator_id</a>(C, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#acfc4beefe5eea8396a20281850dbf00c">opcontext</a>, prop, 1, &amp;km);
<a name="l04294"></a>04294 
<a name="l04295"></a>04295     kmi = <a class="code" href="../../d7/d78/wm__keymap_8c.html#a256b4895c0f2ee6726035a22c180e23c">WM_keymap_item_find_id</a>(km, kmi_id);
<a name="l04296"></a>04296     
<a name="l04297"></a>04297     <a class="code" href="../../d3/d10/rna__access_8c.html#a1f8fb80da9a6450a51ab2e9b97264f01">RNA_pointer_create</a>(&amp;wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a12a2dca17b6339529f24d0a850b35f41">id</a>, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#af05f3903daf4b7de2cced1fceb64b09a">RNA_KeyMapItem</a>, kmi, &amp;ptr);
<a name="l04298"></a>04298     
<a name="l04299"></a>04299     block = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8bb41a5814e5120ba3c694cb35667128">uiBeginBlock</a>(C, ar, <span class="stringliteral">&quot;_popup&quot;</span>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a505992b59501cd825ea7f6d7ad3358a6">UI_EMBOSS</a>);
<a name="l04300"></a>04300     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a678b88dc2247856d2d804986daf134cb">uiBlockSetHandleFunc</a>(block, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a266a0489f2eadfb8e218513590e3e0b6">but_shortcut_name_func</a>, but);
<a name="l04301"></a>04301     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a619156a060c8092bf92b629660cbcc8e">uiBlockSetFlag</a>(block, <a class="code" href="../../d8/d1e/UI__interface_8h.html#af62c6c69e8be99c028da09fa3a7ccda4">UI_BLOCK_MOVEMOUSE_QUIT</a>);
<a name="l04302"></a>04302     <a class="code" href="../../d8/d1e/UI__interface_8h.html#af0d71fa48a234ba4cb707b670455c913">uiBlockSetDirection</a>(block, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3e9eeab3b1f90681b2e63c06a2b6d4ee">UI_CENTER</a>);
<a name="l04303"></a>04303     
<a name="l04304"></a>04304     layout = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a1bb4b00a42cf4a43ed16c8b81ecc5916">uiBlockLayout</a>(block, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a429a9756ef7e1d855f402d4812d9f734">UI_LAYOUT_VERTICAL</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#ab4e9f04bf2cbd97598f540aa2aac805f">UI_LAYOUT_PANEL</a>, 0, 0, 200, 20, style);
<a name="l04305"></a>04305     
<a name="l04306"></a>04306     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a979d9b6768e6d5a505ea6947f2465bc1">uiItemR</a>(layout, &amp;ptr, <span class="stringliteral">&quot;type&quot;</span>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a238252ff220b1d488005a9f78a0ffcf4">UI_ITEM_R_FULL_EVENT</a> | <a class="code" href="../../d8/d1e/UI__interface_8h.html#a06790f560c2d1a97cc832b9ed2203ff0">UI_ITEM_R_IMMEDIATE</a>, <span class="stringliteral">&quot;&quot;</span>, ICON_NONE);
<a name="l04307"></a>04307     
<a name="l04308"></a>04308     <a class="code" href="../../d8/d1e/UI__interface_8h.html#af6d61c8ce27a936c9ef57becb8ede605">uiPopupBoundsBlock</a>(block, 6, -50, 26);
<a name="l04309"></a>04309     <a class="code" href="../../d8/d1e/UI__interface_8h.html#ac166273cd2c217e8b1da1bdac55a8ef8">uiEndBlock</a>(C, block);
<a name="l04310"></a>04310     
<a name="l04311"></a>04311     <span class="keywordflow">return</span> block;
<a name="l04312"></a>04312 }
<a name="l04313"></a>04313 
<a name="l04314"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a5a9224d0775947c8ab5ddb0dd2e1c27a">04314</a> <span class="keyword">static</span> <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a5a9224d0775947c8ab5ddb0dd2e1c27a">menu_add_shortcut</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <span class="keywordtype">void</span> *arg)
<a name="l04315"></a>04315 {
<a name="l04316"></a>04316     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l04317"></a>04317     <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block;
<a name="l04318"></a>04318     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but = (<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *)arg;
<a name="l04319"></a>04319     <a class="code" href="../../d3/d90/structwmKeyMap.html">wmKeyMap</a> *km;
<a name="l04320"></a>04320     <a class="code" href="../../d1/d5e/structwmKeyMapItem.html">wmKeyMapItem</a> *kmi;
<a name="l04321"></a>04321     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> ptr;
<a name="l04322"></a>04322     <a class="code" href="../../d4/d94/structuiLayout.html">uiLayout</a> *layout;
<a name="l04323"></a>04323     <a class="code" href="../../d3/d28/structuiStyle.html">uiStyle</a> *style = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a16828a47eb4af34d08dce0ead86693b3">UI_GetStyle</a>();
<a name="l04324"></a>04324     <a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop = (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abc3962ff38f89bafee42df467dd0cf87">opptr</a>) ? but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abc3962ff38f89bafee42df467dd0cf87">opptr</a>-&gt;<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04325"></a>04325     <span class="keywordtype">int</span> kmi_id;
<a name="l04326"></a>04326     
<a name="l04327"></a>04327     <span class="comment">/* XXX this guess_opname can potentially return a different keymap than being found on adding later... */</span>
<a name="l04328"></a>04328     km = <a class="code" href="../../d7/d78/wm__keymap_8c.html#aaa4139e57c2cb678ae1e678fae96d3c1">WM_keymap_guess_opname</a>(C, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>);        
<a name="l04329"></a>04329     kmi = <a class="code" href="../../d7/d78/wm__keymap_8c.html#a610ba5bdb1d1ba39b5e5cb469b9fba09">WM_keymap_add_item</a>(km, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a746a67a50a93dd2cac52c218ef94a218">AKEY</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>, 0, 0);
<a name="l04330"></a>04330     kmi_id = kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a679a5b8c5addc3ed0713d9714201a285">id</a>;
<a name="l04331"></a>04331 
<a name="l04332"></a>04332     <span class="comment">/* copy properties, prop can be NULL for reset */</span>   
<a name="l04333"></a>04333     <span class="keywordflow">if</span> (prop)
<a name="l04334"></a>04334         prop = <a class="code" href="../../d5/d95/BKE__idprop_8h.html#ae80f703da3b22ff05299c00760d1d8cc">IDP_CopyProperty</a>(prop);
<a name="l04335"></a>04335     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a86ed3e5cddf5480aea2a16a869337711">WM_keymap_properties_reset</a>(kmi, prop);
<a name="l04336"></a>04336 
<a name="l04337"></a>04337     <span class="comment">/* update and get pointers again */</span>
<a name="l04338"></a>04338     <a class="code" href="../../d7/d78/wm__keymap_8c.html#a41524afb7dc28a4bc2ad37bf24cd7e53">WM_keyconfig_update</a>(wm);
<a name="l04339"></a>04339 
<a name="l04340"></a>04340     km = <a class="code" href="../../d7/d78/wm__keymap_8c.html#aaa4139e57c2cb678ae1e678fae96d3c1">WM_keymap_guess_opname</a>(C, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>);        
<a name="l04341"></a>04341     kmi = <a class="code" href="../../d7/d78/wm__keymap_8c.html#a256b4895c0f2ee6726035a22c180e23c">WM_keymap_item_find_id</a>(km, kmi_id);
<a name="l04342"></a>04342 
<a name="l04343"></a>04343     <a class="code" href="../../d3/d10/rna__access_8c.html#a1f8fb80da9a6450a51ab2e9b97264f01">RNA_pointer_create</a>(&amp;wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a12a2dca17b6339529f24d0a850b35f41">id</a>, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#af05f3903daf4b7de2cced1fceb64b09a">RNA_KeyMapItem</a>, kmi, &amp;ptr);
<a name="l04344"></a>04344 
<a name="l04345"></a>04345     block = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8bb41a5814e5120ba3c694cb35667128">uiBeginBlock</a>(C, ar, <span class="stringliteral">&quot;_popup&quot;</span>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a505992b59501cd825ea7f6d7ad3358a6">UI_EMBOSS</a>);
<a name="l04346"></a>04346     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a678b88dc2247856d2d804986daf134cb">uiBlockSetHandleFunc</a>(block, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a266a0489f2eadfb8e218513590e3e0b6">but_shortcut_name_func</a>, but);
<a name="l04347"></a>04347     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a619156a060c8092bf92b629660cbcc8e">uiBlockSetFlag</a>(block, <a class="code" href="../../d8/d1e/UI__interface_8h.html#ab829d5fb0e0e927effd6a779dafee967">UI_BLOCK_RET_1</a>);
<a name="l04348"></a>04348     <a class="code" href="../../d8/d1e/UI__interface_8h.html#af0d71fa48a234ba4cb707b670455c913">uiBlockSetDirection</a>(block, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3e9eeab3b1f90681b2e63c06a2b6d4ee">UI_CENTER</a>);
<a name="l04349"></a>04349 
<a name="l04350"></a>04350     layout = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a1bb4b00a42cf4a43ed16c8b81ecc5916">uiBlockLayout</a>(block, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a429a9756ef7e1d855f402d4812d9f734">UI_LAYOUT_VERTICAL</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#ab4e9f04bf2cbd97598f540aa2aac805f">UI_LAYOUT_PANEL</a>, 0, 0, 200, 20, style);
<a name="l04351"></a>04351 
<a name="l04352"></a>04352     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a979d9b6768e6d5a505ea6947f2465bc1">uiItemR</a>(layout, &amp;ptr, <span class="stringliteral">&quot;type&quot;</span>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a238252ff220b1d488005a9f78a0ffcf4">UI_ITEM_R_FULL_EVENT</a> | <a class="code" href="../../d8/d1e/UI__interface_8h.html#a06790f560c2d1a97cc832b9ed2203ff0">UI_ITEM_R_IMMEDIATE</a>, <span class="stringliteral">&quot;&quot;</span>, ICON_NONE);
<a name="l04353"></a>04353     
<a name="l04354"></a>04354     <a class="code" href="../../d8/d1e/UI__interface_8h.html#af6d61c8ce27a936c9ef57becb8ede605">uiPopupBoundsBlock</a>(block, 6, -50, 26);
<a name="l04355"></a>04355     <a class="code" href="../../d8/d1e/UI__interface_8h.html#ac166273cd2c217e8b1da1bdac55a8ef8">uiEndBlock</a>(C, block);
<a name="l04356"></a>04356     
<a name="l04357"></a>04357     <span class="keywordflow">return</span> block;
<a name="l04358"></a>04358 }
<a name="l04359"></a>04359 
<a name="l04360"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aef96b4ab58fb4943ef0ce1a55b476d8d">04360</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aef96b4ab58fb4943ef0ce1a55b476d8d">popup_change_shortcut_func</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keywordtype">void</span> *arg1, <span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(arg2))
<a name="l04361"></a>04361 {
<a name="l04362"></a>04362     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but = (<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *)arg1;
<a name="l04363"></a>04363     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a08501934715996a73502df4fa5a652f8">button_timers_tooltip_remove</a>(C, but);
<a name="l04364"></a>04364     <a class="code" href="../../d8/d1e/UI__interface_8h.html#ae7baee6ff4fbce4272abc7773679fd8b">uiPupBlock</a>(C, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3ed0c54078fd57bb56c9017c165487e0">menu_change_shortcut</a>, but);
<a name="l04365"></a>04365 }
<a name="l04366"></a>04366 
<a name="l04367"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a97cc0f8381140f48560d29cacc626c44">04367</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a97cc0f8381140f48560d29cacc626c44">remove_shortcut_func</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keywordtype">void</span> *arg1, <span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(arg2))
<a name="l04368"></a>04368 {
<a name="l04369"></a>04369     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but = (<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *)arg1;
<a name="l04370"></a>04370     <a class="code" href="../../d3/d90/structwmKeyMap.html">wmKeyMap</a> *km;
<a name="l04371"></a>04371     <a class="code" href="../../d1/d5e/structwmKeyMapItem.html">wmKeyMapItem</a> *kmi;
<a name="l04372"></a>04372     <a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop = (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abc3962ff38f89bafee42df467dd0cf87">opptr</a>) ? but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abc3962ff38f89bafee42df467dd0cf87">opptr</a>-&gt;<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04373"></a>04373     <span class="keywordtype">int</span> kmi_id = <a class="code" href="../../d7/d78/wm__keymap_8c.html#a8964cdf1b6f85f0f0cd525d429784bb4">WM_key_event_operator_id</a>(C, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#acfc4beefe5eea8396a20281850dbf00c">opcontext</a>, prop, 1, &amp;km);
<a name="l04374"></a>04374     
<a name="l04375"></a>04375     kmi = <a class="code" href="../../d7/d78/wm__keymap_8c.html#a256b4895c0f2ee6726035a22c180e23c">WM_keymap_item_find_id</a>(km, kmi_id);
<a name="l04376"></a>04376     <a class="code" href="../../d7/d78/wm__keymap_8c.html#ae3d2e487dcb69a0f79ee6acecf97e8b7">WM_keymap_remove_item</a>(km, kmi);
<a name="l04377"></a>04377     
<a name="l04378"></a>04378     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a266a0489f2eadfb8e218513590e3e0b6">but_shortcut_name_func</a>(C, but, 0);
<a name="l04379"></a>04379 }
<a name="l04380"></a>04380 
<a name="l04381"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a90fd928b04769d8363072b4ceb663fb5">04381</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a90fd928b04769d8363072b4ceb663fb5">popup_add_shortcut_func</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keywordtype">void</span> *arg1, <span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(arg2))
<a name="l04382"></a>04382 {
<a name="l04383"></a>04383     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but = (<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *)arg1;
<a name="l04384"></a>04384     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a08501934715996a73502df4fa5a652f8">button_timers_tooltip_remove</a>(C, but);
<a name="l04385"></a>04385     <a class="code" href="../../d8/d1e/UI__interface_8h.html#ae7baee6ff4fbce4272abc7773679fd8b">uiPupBlock</a>(C, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a5a9224d0775947c8ab5ddb0dd2e1c27a">menu_add_shortcut</a>, but);
<a name="l04386"></a>04386 }
<a name="l04387"></a>04387 
<a name="l04388"></a>04388 
<a name="l04389"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#afad894448e2e6def3358a960cebc242d">04389</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#afad894448e2e6def3358a960cebc242d">ui_but_menu</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but)
<a name="l04390"></a>04390 {
<a name="l04391"></a>04391     <a class="code" href="../../d9/d4b/structuiPopupMenu.html">uiPopupMenu</a> *pup;
<a name="l04392"></a>04392     <a class="code" href="../../d4/d94/structuiLayout.html">uiLayout</a> *layout;
<a name="l04393"></a>04393     <span class="keywordtype">int</span> <a class="code" href="../../d1/d22/stdosl_8h.html#a939ad05d43eeb38dcadd8218e52d9648">length</a>;
<a name="l04394"></a>04394     <span class="keyword">const</span> <span class="keywordtype">char</span> *name;
<a name="l04395"></a>04395 
<a name="l04396"></a>04396     <span class="keywordflow">if</span> ((but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>) == 0 &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l04397"></a>04397         <span class="keywordflow">return</span> 0;
<a name="l04398"></a>04398     
<a name="l04399"></a>04399     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a08501934715996a73502df4fa5a652f8">button_timers_tooltip_remove</a>(C, but);
<a name="l04400"></a>04400 
<a name="l04401"></a>04401     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>)
<a name="l04402"></a>04402         name = <a class="code" href="../../d3/d10/rna__access_8c.html#abf941f0964c5e2f66e923e88fe845e7e">RNA_property_ui_name</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>);
<a name="l04403"></a>04403     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a>)
<a name="l04404"></a>04404         name = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a>;
<a name="l04405"></a>04405     <span class="keywordflow">else</span>
<a name="l04406"></a>04406         name = <span class="stringliteral">&quot;&lt;needs_name&gt;&quot;</span>;  <span class="comment">// XXX - should never happen.</span>
<a name="l04407"></a>04407 
<a name="l04408"></a>04408     pup = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a402c012d9cde0ff0f0808c25c4213d43">uiPupMenuBegin</a>(C, name, ICON_NONE);
<a name="l04409"></a>04409     layout = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8c1b07b81987cdc2168a7417f9104cca">uiPupMenuLayout</a>(pup);
<a name="l04410"></a>04410     
<a name="l04411"></a>04411     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a1a73a847be1bae1a560408d0b44c212f">uiLayoutSetOperatorContext</a>(layout, <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39ab5a7f40e5e55a912d974ab5224a0fa15">WM_OP_INVOKE_DEFAULT</a>);
<a name="l04412"></a>04412 
<a name="l04413"></a>04413     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>) {
<a name="l04414"></a>04414         <span class="keywordtype">short</span> is_anim = <a class="code" href="../../d3/d10/rna__access_8c.html#a63b99969d7f69abd7809858a2687ae1c">RNA_property_animateable</a>(&amp;but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>);
<a name="l04415"></a>04415 
<a name="l04416"></a>04416         <span class="comment">/* second slower test, saved people finding keyframe items in menus when its not possible */</span>
<a name="l04417"></a>04417         <span class="keywordflow">if</span> (is_anim)
<a name="l04418"></a>04418             is_anim = <a class="code" href="../../d3/d10/rna__access_8c.html#af7b34b763693b327317571bd4737baa5">RNA_property_path_from_ID_check</a>(&amp;but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>);
<a name="l04419"></a>04419 
<a name="l04420"></a>04420         length = <a class="code" href="../../d3/d10/rna__access_8c.html#aad51db9a31d245dba4ee1f50608f331c">RNA_property_array_length</a>(&amp;but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>);
<a name="l04421"></a>04421         
<a name="l04422"></a>04422         <span class="comment">/* Keyframes */</span>
<a name="l04423"></a>04423         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a6d68884b8a36add8b27e64e4c1a09f98">UI_BUT_ANIMATED_KEY</a>) {
<a name="l04424"></a>04424             <span class="comment">/* replace/delete keyfraemes */</span>
<a name="l04425"></a>04425             <span class="keywordflow">if</span> (length) {
<a name="l04426"></a>04426                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Replace Keyframes&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_keyframe_insert_button&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 1);
<a name="l04427"></a>04427                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Replace Single Keyframe&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_keyframe_insert_button&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 0);
<a name="l04428"></a>04428                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Delete Keyframes&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_keyframe_delete_button&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 1);
<a name="l04429"></a>04429                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Delete Single Keyframe&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_keyframe_delete_button&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 0);
<a name="l04430"></a>04430             }
<a name="l04431"></a>04431             <span class="keywordflow">else</span> {
<a name="l04432"></a>04432                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Replace Keyframe&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_keyframe_insert_button&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 0);
<a name="l04433"></a>04433                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Delete Keyframe&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_keyframe_delete_button&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 0);
<a name="l04434"></a>04434             }
<a name="l04435"></a>04435             
<a name="l04436"></a>04436             <span class="comment">/* keyframe settings */</span>
<a name="l04437"></a>04437             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5e3bb0f5147561627b0f3f92789476bd">uiItemS</a>(layout);
<a name="l04438"></a>04438             
<a name="l04439"></a>04439             
<a name="l04440"></a>04440         }
<a name="l04441"></a>04441         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3e7c76963279635fbadaaf32c3a62324">UI_BUT_DRIVEN</a>) ;
<a name="l04442"></a>04442         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_anim) {
<a name="l04443"></a>04443             <span class="keywordflow">if</span> (length) {
<a name="l04444"></a>04444                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Insert Keyframes&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_keyframe_insert_button&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 1);
<a name="l04445"></a>04445                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Insert Single Keyframe&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_keyframe_insert_button&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 0);
<a name="l04446"></a>04446             }
<a name="l04447"></a>04447             <span class="keywordflow">else</span>
<a name="l04448"></a>04448                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Insert Keyframe&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_keyframe_insert_button&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 0);
<a name="l04449"></a>04449         }
<a name="l04450"></a>04450         
<a name="l04451"></a>04451         <span class="comment">/* Drivers */</span>
<a name="l04452"></a>04452         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3e7c76963279635fbadaaf32c3a62324">UI_BUT_DRIVEN</a>) {
<a name="l04453"></a>04453             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5e3bb0f5147561627b0f3f92789476bd">uiItemS</a>(layout);
<a name="l04454"></a>04454 
<a name="l04455"></a>04455             <span class="keywordflow">if</span> (length) {
<a name="l04456"></a>04456                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Delete Drivers&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_driver_button_remove&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 1);
<a name="l04457"></a>04457                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Delete Single Driver&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_driver_button_remove&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 0);
<a name="l04458"></a>04458             }
<a name="l04459"></a>04459             <span class="keywordflow">else</span>
<a name="l04460"></a>04460                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Delete Driver&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_driver_button_remove&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 0);
<a name="l04461"></a>04461 
<a name="l04462"></a>04462             <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa730a1dee89b370a0e66e9e79503f15d">uiItemO</a>(layout, <span class="stringliteral">&quot;Copy Driver&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_copy_driver_button&quot;</span>);
<a name="l04463"></a>04463             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d93/drivers_8c.html#a94487fb5f2a7f35b567d8c9b72ce3f2d">ANIM_driver_can_paste</a>())
<a name="l04464"></a>04464                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa730a1dee89b370a0e66e9e79503f15d">uiItemO</a>(layout, <span class="stringliteral">&quot;Paste Driver&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_paste_driver_button&quot;</span>);
<a name="l04465"></a>04465         }
<a name="l04466"></a>04466         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; (<a class="code" href="../../d8/d1e/UI__interface_8h.html#a6d68884b8a36add8b27e64e4c1a09f98">UI_BUT_ANIMATED_KEY</a> | <a class="code" href="../../d8/d1e/UI__interface_8h.html#abebdbf66e6f071c28e9626c0c60cbf8a">UI_BUT_ANIMATED</a>)) ;
<a name="l04467"></a>04467         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_anim) {
<a name="l04468"></a>04468             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5e3bb0f5147561627b0f3f92789476bd">uiItemS</a>(layout);
<a name="l04469"></a>04469 
<a name="l04470"></a>04470             <span class="keywordflow">if</span> (length) {
<a name="l04471"></a>04471                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Add Drivers&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_driver_button_add&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 1);
<a name="l04472"></a>04472                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Add Single Driver&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_driver_button_add&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 0);
<a name="l04473"></a>04473             }
<a name="l04474"></a>04474             <span class="keywordflow">else</span>
<a name="l04475"></a>04475                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Add Driver&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_driver_button_add&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 0);
<a name="l04476"></a>04476 
<a name="l04477"></a>04477             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d93/drivers_8c.html#a94487fb5f2a7f35b567d8c9b72ce3f2d">ANIM_driver_can_paste</a>())
<a name="l04478"></a>04478                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa730a1dee89b370a0e66e9e79503f15d">uiItemO</a>(layout, <span class="stringliteral">&quot;Paste Driver&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_paste_driver_button&quot;</span>);
<a name="l04479"></a>04479         }
<a name="l04480"></a>04480         
<a name="l04481"></a>04481         <span class="comment">/* Keying Sets */</span>
<a name="l04482"></a>04482         <span class="comment">// TODO: check on modifyability of Keying Set when doing this</span>
<a name="l04483"></a>04483         <span class="keywordflow">if</span> (is_anim) {
<a name="l04484"></a>04484             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5e3bb0f5147561627b0f3f92789476bd">uiItemS</a>(layout);
<a name="l04485"></a>04485 
<a name="l04486"></a>04486             <span class="keywordflow">if</span> (length) {
<a name="l04487"></a>04487                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Add All to Keying Set&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_keyingset_button_add&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 1);
<a name="l04488"></a>04488                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Add Single to Keying Set&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_keyingset_button_add&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 0);
<a name="l04489"></a>04489                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa730a1dee89b370a0e66e9e79503f15d">uiItemO</a>(layout, <span class="stringliteral">&quot;Remove from Keying Set&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_keyingset_button_remove&quot;</span>);
<a name="l04490"></a>04490             }
<a name="l04491"></a>04491             <span class="keywordflow">else</span> {
<a name="l04492"></a>04492                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Add to Keying Set&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_keyingset_button_add&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 0);
<a name="l04493"></a>04493                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa730a1dee89b370a0e66e9e79503f15d">uiItemO</a>(layout, <span class="stringliteral">&quot;Remove from Keying Set&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;ANIM_OT_keyingset_button_remove&quot;</span>);
<a name="l04494"></a>04494             }
<a name="l04495"></a>04495         }
<a name="l04496"></a>04496         
<a name="l04497"></a>04497         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5e3bb0f5147561627b0f3f92789476bd">uiItemS</a>(layout);
<a name="l04498"></a>04498         
<a name="l04499"></a>04499         <span class="comment">/* Property Operators */</span>
<a name="l04500"></a>04500         
<a name="l04501"></a>04501         <span class="comment">//Copy Property Value</span>
<a name="l04502"></a>04502         <span class="comment">//Paste Property Value</span>
<a name="l04503"></a>04503         
<a name="l04504"></a>04504         <span class="keywordflow">if</span> (length) {
<a name="l04505"></a>04505             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Reset All to Default Values&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;UI_OT_reset_default_button&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 1);
<a name="l04506"></a>04506             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Reset Single to Default Value&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;UI_OT_reset_default_button&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, 0);
<a name="l04507"></a>04507         }
<a name="l04508"></a>04508         <span class="keywordflow">else</span>
<a name="l04509"></a>04509             <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa730a1dee89b370a0e66e9e79503f15d">uiItemO</a>(layout, <span class="stringliteral">&quot;Reset to Default Value&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;UI_OT_reset_default_button&quot;</span>);
<a name="l04510"></a>04510         
<a name="l04511"></a>04511         <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa730a1dee89b370a0e66e9e79503f15d">uiItemO</a>(layout, <span class="stringliteral">&quot;Copy Data Path&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;UI_OT_copy_data_path_button&quot;</span>);
<a name="l04512"></a>04512         <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa730a1dee89b370a0e66e9e79503f15d">uiItemO</a>(layout, <span class="stringliteral">&quot;Copy To Selected&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;UI_OT_copy_to_selected_button&quot;</span>);
<a name="l04513"></a>04513 
<a name="l04514"></a>04514         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5e3bb0f5147561627b0f3f92789476bd">uiItemS</a>(layout);
<a name="l04515"></a>04515     }
<a name="l04516"></a>04516 
<a name="l04517"></a>04517     <span class="comment">/* Operator buttons */</span>
<a name="l04518"></a>04518     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a>) {
<a name="l04519"></a>04519         <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a103df17c27f04aa1a4d649c3d1ea349c">uiLayoutGetBlock</a>(layout);
<a name="l04520"></a>04520         <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but2;
<a name="l04521"></a>04521         <a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop = (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abc3962ff38f89bafee42df467dd0cf87">opptr</a>) ? but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abc3962ff38f89bafee42df467dd0cf87">opptr</a>-&gt;<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04522"></a>04522         <span class="keywordtype">int</span> w = <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa6198e7355c354fe28b233c97c323aa2">uiLayoutGetWidth</a>(layout);
<a name="l04523"></a>04523         <a class="code" href="../../d3/d90/structwmKeyMap.html">wmKeyMap</a> *km;
<a name="l04524"></a>04524         <a class="code" href="../../d1/d5e/structwmKeyMapItem.html">wmKeyMapItem</a> *kmi = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04525"></a>04525         <span class="keywordtype">int</span> kmi_id = <a class="code" href="../../d7/d78/wm__keymap_8c.html#a8964cdf1b6f85f0f0cd525d429784bb4">WM_key_event_operator_id</a>(C, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#acfc4beefe5eea8396a20281850dbf00c">opcontext</a>, prop, 1, &amp;km);
<a name="l04526"></a>04526 
<a name="l04527"></a>04527         <span class="keywordflow">if</span> (kmi_id)
<a name="l04528"></a>04528             kmi = <a class="code" href="../../d7/d78/wm__keymap_8c.html#a256b4895c0f2ee6726035a22c180e23c">WM_keymap_item_find_id</a>(km, kmi_id);
<a name="l04529"></a>04529 
<a name="l04530"></a>04530         <span class="comment">/* keyboard shortcuts */</span>
<a name="l04531"></a>04531         <span class="keywordflow">if</span> ((kmi) &amp;&amp; <a class="code" href="../../d1/d40/wm__event__types_8h.html#a618e1d69514f3de00cba0f0f9a538194">ISKEYBOARD</a>(kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a31720630b9559f2b073bf01fc0038271">type</a>)) {
<a name="l04532"></a>04532 
<a name="l04533"></a>04533             <span class="comment">// would rather use a block but, but gets weirdly positioned...</span>
<a name="l04534"></a>04534             <span class="comment">//uiDefBlockBut(block, menu_change_shortcut, but, &quot;Change Shortcut&quot;, 0, 0, uiLayoutGetWidth(layout), UI_UNIT_Y, &quot;&quot;);</span>
<a name="l04535"></a>04535             
<a name="l04536"></a>04536             but2 = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a4d5e60fb7b1232c922c87756f90161ff">uiDefIconTextBut</a>(block, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a02c336ab5ee16270de92af2f3f2cb5eb">BUT</a>, 0, 0, <span class="stringliteral">&quot;Change Shortcut&quot;</span>, 0, 0, w, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a07a4d52f535e8a85b1550584847132d8">UI_UNIT_Y</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0, 0, 0, <span class="stringliteral">&quot;&quot;</span>);
<a name="l04537"></a>04537             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3577b54257b3f858be44d8808e6c5cc6">uiButSetFunc</a>(but2, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aef96b4ab58fb4943ef0ce1a55b476d8d">popup_change_shortcut_func</a>, but, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l04538"></a>04538 
<a name="l04539"></a>04539             but2 = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a4d5e60fb7b1232c922c87756f90161ff">uiDefIconTextBut</a>(block, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a02c336ab5ee16270de92af2f3f2cb5eb">BUT</a>, 0, 0, <span class="stringliteral">&quot;Remove Shortcut&quot;</span>, 0, 0, w, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a07a4d52f535e8a85b1550584847132d8">UI_UNIT_Y</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0, 0, 0, <span class="stringliteral">&quot;&quot;</span>);
<a name="l04540"></a>04540             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3577b54257b3f858be44d8808e6c5cc6">uiButSetFunc</a>(but2, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a97cc0f8381140f48560d29cacc626c44">remove_shortcut_func</a>, but, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l04541"></a>04541         }
<a name="l04542"></a>04542         <span class="comment">/* only show &#39;add&#39; if there&#39;s a suitable key map for it to go in */</span>
<a name="l04543"></a>04543         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d7/d78/wm__keymap_8c.html#aaa4139e57c2cb678ae1e678fae96d3c1">WM_keymap_guess_opname</a>(C, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>)) {
<a name="l04544"></a>04544             but2 = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a4d5e60fb7b1232c922c87756f90161ff">uiDefIconTextBut</a>(block, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a02c336ab5ee16270de92af2f3f2cb5eb">BUT</a>, 0, 0, <span class="stringliteral">&quot;Add Shortcut&quot;</span>, 0, 0, w, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a07a4d52f535e8a85b1550584847132d8">UI_UNIT_Y</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0, 0, 0, <span class="stringliteral">&quot;&quot;</span>);
<a name="l04545"></a>04545             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3577b54257b3f858be44d8808e6c5cc6">uiButSetFunc</a>(but2, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a90fd928b04769d8363072b4ceb663fb5">popup_add_shortcut_func</a>, but, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l04546"></a>04546         }
<a name="l04547"></a>04547         
<a name="l04548"></a>04548         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5e3bb0f5147561627b0f3f92789476bd">uiItemS</a>(layout);
<a name="l04549"></a>04549     }
<a name="l04550"></a>04550 
<a name="l04551"></a>04551     
<a name="l04552"></a>04552     {   <span class="comment">/* Docs */</span>
<a name="l04553"></a>04553         <span class="keywordtype">char</span> buf[512];
<a name="l04554"></a>04554         <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> ptr_props;
<a name="l04555"></a>04555 
<a name="l04556"></a>04556         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>) {
<a name="l04557"></a>04557             <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%s.%s&quot;</span>, <a class="code" href="../../d3/d10/rna__access_8c.html#abe9be1dcaf1b1767038a753cd0edb9ab">RNA_struct_identifier</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a41f868aea62068fbbfa36c1a5dbe30f9">type</a>), <a class="code" href="../../d3/d10/rna__access_8c.html#ad6f3c9684a8786587872fc6baf17dfc9">RNA_property_identifier</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>));
<a name="l04558"></a>04558 
<a name="l04559"></a>04559             <a class="code" href="../../d6/dae/wm__operators_8c.html#ad61b3bbf58d8c110a878750c1b4731a6">WM_operator_properties_create</a>(&amp;ptr_props, <span class="stringliteral">&quot;WM_OT_doc_view&quot;</span>);
<a name="l04560"></a>04560             <a class="code" href="../../d3/d10/rna__access_8c.html#a229b9421e0a1d2e5fd079ec933a2d6f5">RNA_string_set</a>(&amp;ptr_props, <span class="stringliteral">&quot;doc_id&quot;</span>, buf);
<a name="l04561"></a>04561             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5d68133c9ae9e90048616177881a9e57">uiItemFullO</a>(layout, <span class="stringliteral">&quot;WM_OT_doc_view&quot;</span>, <span class="stringliteral">&quot;View Docs&quot;</span>, ICON_NONE, ptr_props.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39ad2fa38d3cd3b0844e4a1b33bbf5f918c">WM_OP_EXEC_DEFAULT</a>, 0);
<a name="l04562"></a>04562 
<a name="l04563"></a>04563             <span class="comment">/* XXX inactive option, not for public! */</span>
<a name="l04564"></a>04564 <span class="preprocessor">#if 0</span>
<a name="l04565"></a>04565 <span class="preprocessor"></span>            <a class="code" href="../../d6/dae/wm__operators_8c.html#ad61b3bbf58d8c110a878750c1b4731a6">WM_operator_properties_create</a>(&amp;ptr_props, <span class="stringliteral">&quot;WM_OT_doc_edit&quot;</span>);
<a name="l04566"></a>04566             <a class="code" href="../../d3/d10/rna__access_8c.html#a229b9421e0a1d2e5fd079ec933a2d6f5">RNA_string_set</a>(&amp;ptr_props, <span class="stringliteral">&quot;doc_id&quot;</span>, buf);
<a name="l04567"></a>04567             <a class="code" href="../../d3/d10/rna__access_8c.html#a229b9421e0a1d2e5fd079ec933a2d6f5">RNA_string_set</a>(&amp;ptr_props, <span class="stringliteral">&quot;doc_new&quot;</span>, <a class="code" href="../../d3/d10/rna__access_8c.html#a0e6c09655bc8037930dc3c281215403c">RNA_property_description</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>));
<a name="l04568"></a>04568 
<a name="l04569"></a>04569             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5d68133c9ae9e90048616177881a9e57">uiItemFullO</a>(layout, <span class="stringliteral">&quot;WM_OT_doc_edit&quot;</span>, <span class="stringliteral">&quot;Submit Description&quot;</span>, ICON_NONE, ptr_props.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39ab5a7f40e5e55a912d974ab5224a0fa15">WM_OP_INVOKE_DEFAULT</a>, 0);
<a name="l04570"></a>04570 <span class="preprocessor"> #endif</span>
<a name="l04571"></a>04571 <span class="preprocessor"></span>        }
<a name="l04572"></a>04572         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a>) {
<a name="l04573"></a>04573             <a class="code" href="../../d6/dae/wm__operators_8c.html#ad441ab98ccd0d26c3d9a2ccdb2f91b09">WM_operator_py_idname</a>(buf, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>);
<a name="l04574"></a>04574 
<a name="l04575"></a>04575             <a class="code" href="../../d6/dae/wm__operators_8c.html#ad61b3bbf58d8c110a878750c1b4731a6">WM_operator_properties_create</a>(&amp;ptr_props, <span class="stringliteral">&quot;WM_OT_doc_view&quot;</span>);
<a name="l04576"></a>04576             <a class="code" href="../../d3/d10/rna__access_8c.html#a229b9421e0a1d2e5fd079ec933a2d6f5">RNA_string_set</a>(&amp;ptr_props, <span class="stringliteral">&quot;doc_id&quot;</span>, buf);
<a name="l04577"></a>04577             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5d68133c9ae9e90048616177881a9e57">uiItemFullO</a>(layout, <span class="stringliteral">&quot;WM_OT_doc_view&quot;</span>, <span class="stringliteral">&quot;View Docs&quot;</span>, ICON_NONE, ptr_props.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39ad2fa38d3cd3b0844e4a1b33bbf5f918c">WM_OP_EXEC_DEFAULT</a>, 0);
<a name="l04578"></a>04578 
<a name="l04579"></a>04579 
<a name="l04580"></a>04580             <a class="code" href="../../d6/dae/wm__operators_8c.html#ad61b3bbf58d8c110a878750c1b4731a6">WM_operator_properties_create</a>(&amp;ptr_props, <span class="stringliteral">&quot;WM_OT_doc_edit&quot;</span>);
<a name="l04581"></a>04581             <a class="code" href="../../d3/d10/rna__access_8c.html#a229b9421e0a1d2e5fd079ec933a2d6f5">RNA_string_set</a>(&amp;ptr_props, <span class="stringliteral">&quot;doc_id&quot;</span>, buf);
<a name="l04582"></a>04582             <a class="code" href="../../d3/d10/rna__access_8c.html#a229b9421e0a1d2e5fd079ec933a2d6f5">RNA_string_set</a>(&amp;ptr_props, <span class="stringliteral">&quot;doc_new&quot;</span>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abcea35ce8d7c8b6a6723f8ca320fd7b6">optype</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a>);
<a name="l04583"></a>04583 
<a name="l04584"></a>04584             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5d68133c9ae9e90048616177881a9e57">uiItemFullO</a>(layout, <span class="stringliteral">&quot;WM_OT_doc_edit&quot;</span>, <span class="stringliteral">&quot;Submit Description&quot;</span>, ICON_NONE, ptr_props.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39ab5a7f40e5e55a912d974ab5224a0fa15">WM_OP_INVOKE_DEFAULT</a>, 0);
<a name="l04585"></a>04585         }
<a name="l04586"></a>04586     }
<a name="l04587"></a>04587 
<a name="l04588"></a>04588     <span class="comment">/* perhaps we should move this into (G.debug &amp; G_DEBUG) - campbell */</span>
<a name="l04589"></a>04589     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5d68133c9ae9e90048616177881a9e57">uiItemFullO</a>(layout, <span class="stringliteral">&quot;UI_OT_editsource&quot;</span>, <span class="stringliteral">&quot;Edit Source&quot;</span>, ICON_NONE, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39ab5a7f40e5e55a912d974ab5224a0fa15">WM_OP_INVOKE_DEFAULT</a>, 0);
<a name="l04590"></a>04590 
<a name="l04591"></a>04591     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3ab0b4d9de253d473a16d4f329d8b50f">uiPupMenuEnd</a>(C, pup);
<a name="l04592"></a>04592 
<a name="l04593"></a>04593     <span class="keywordflow">return</span> 1;
<a name="l04594"></a>04594 }
<a name="l04595"></a>04595 
<a name="l04596"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1787cc5b45354b4b5f045934dc82469a">04596</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1787cc5b45354b4b5f045934dc82469a">ui_do_button</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l04597"></a>04597 {
<a name="l04598"></a>04598 <span class="comment">//  Scene *scene= CTX_data_scene(C);</span>
<a name="l04599"></a>04599     <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l04600"></a>04600     <span class="keywordtype">int</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a>;
<a name="l04601"></a>04601 
<a name="l04602"></a>04602     data = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>;
<a name="l04603"></a>04603     retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l04604"></a>04604 
<a name="l04605"></a>04605     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#aebc550f9a03ce3bd40d3c7a024c0f5a8">UI_BUT_DISABLED</a>)
<a name="l04606"></a>04606         <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l04607"></a>04607 
<a name="l04608"></a>04608     <span class="keywordflow">if</span> ((data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) &amp;&amp;
<a name="l04609"></a>04609         <span class="comment">/* check prevval because of modal operators [#24016],</span>
<a name="l04610"></a>04610 <span class="comment">         * modifier check is to allow Ctrl+C for copy.</span>
<a name="l04611"></a>04611 <span class="comment">         * if this causes other problems, remove this check and suffer the bug :) - campbell */</span>
<a name="l04612"></a>04612         ((event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abd9d62c7e1c80240d2e48d696ec7fbee">prevval</a> != <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) || (<a class="code" href="../../d1/d40/wm__event__types_8h.html#a3bb441ade8a1809219bd6b5d15e9ba52">ISKEYMODIFIER</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa04341fdd4096c2769931d25ab98f747">prevtype</a>)) || (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a36a2a96ac408860328476aeefa4f81c4">EVT_DROP</a>)))
<a name="l04613"></a>04613     {
<a name="l04614"></a>04614         <span class="comment">/* handle copy-paste */</span>
<a name="l04615"></a>04615         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a39f146afd78004fead59358c29028292">CKEY</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a8691f4871880a2b71eef19973c0664e1">VKEY</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a> &amp;&amp; (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a> || event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7dc2b3fa9f4563111cb1a461a1117192">oskey</a>)) {
<a name="l04616"></a>04616             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a717fc8c3811b8db306f7f3fb80ad513e">ui_but_copy_paste</a>(C, but, data, (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a39f146afd78004fead59358c29028292">CKEY</a>) ? <span class="charliteral">&#39;c&#39;</span> : <span class="charliteral">&#39;v&#39;</span>);
<a name="l04617"></a>04617             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l04618"></a>04618         }
<a name="l04619"></a>04619         <span class="comment">/* handle drop */</span>
<a name="l04620"></a>04620         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a36a2a96ac408860328476aeefa4f81c4">EVT_DROP</a>) {
<a name="l04621"></a>04621             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a4b01562b3a1c469c721c6f33a45e1b61">ui_but_drop</a>(C, event, but, data);
<a name="l04622"></a>04622         }
<a name="l04623"></a>04623         <span class="comment">/* handle keyframing */</span>
<a name="l04624"></a>04624         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a8266bf9b4373825723254f4a186d3de6">IKEY</a> &amp;&amp; !<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(<a class="code" href="../../d4/ddc/WM__types_8h.html#aaa9bd9dda466bb6f38bf838725283a5b">KM_MOD_FIRST</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7dc2b3fa9f4563111cb1a461a1117192">oskey</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l04625"></a>04625             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a>)
<a name="l04626"></a>04626                 <a class="code" href="../../d6/dc2/interface__anim_8c.html#a03e48447eb524b28083a3c981721a6b1">ui_but_anim_delete_keyframe</a>(C);
<a name="l04627"></a>04627             <span class="keywordflow">else</span>
<a name="l04628"></a>04628                 <a class="code" href="../../d6/dc2/interface__anim_8c.html#aec9ae07d430ccccd830af3985c403da1">ui_but_anim_insert_keyframe</a>(C);
<a name="l04629"></a>04629             
<a name="l04630"></a>04630             <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C));
<a name="l04631"></a>04631             
<a name="l04632"></a>04632             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l04633"></a>04633         }
<a name="l04634"></a>04634         <span class="comment">/* handle drivers */</span>
<a name="l04635"></a>04635         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae108a0974a5073bf40514974c1e98028">DKEY</a> &amp;&amp; !<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(<a class="code" href="../../d4/ddc/WM__types_8h.html#aaa9bd9dda466bb6f38bf838725283a5b">KM_MOD_FIRST</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7dc2b3fa9f4563111cb1a461a1117192">oskey</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l04636"></a>04636             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a>)
<a name="l04637"></a>04637                 <a class="code" href="../../d6/dc2/interface__anim_8c.html#ae3de7ccef7a21a25ab87850de35a92d8">ui_but_anim_remove_driver</a>(C);
<a name="l04638"></a>04638             <span class="keywordflow">else</span>
<a name="l04639"></a>04639                 <a class="code" href="../../d6/dc2/interface__anim_8c.html#a7679d4e7e00687c2242351d060efdd66">ui_but_anim_add_driver</a>(C);
<a name="l04640"></a>04640                 
<a name="l04641"></a>04641             <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C));
<a name="l04642"></a>04642             
<a name="l04643"></a>04643             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l04644"></a>04644         }
<a name="l04645"></a>04645         <span class="comment">/* handle keyingsets */</span>
<a name="l04646"></a>04646         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a08bc6a3adcfad743bcba777bfc5cb5ce">KKEY</a> &amp;&amp; !<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(<a class="code" href="../../d4/ddc/WM__types_8h.html#aaa9bd9dda466bb6f38bf838725283a5b">KM_MOD_FIRST</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7dc2b3fa9f4563111cb1a461a1117192">oskey</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l04647"></a>04647             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a>)
<a name="l04648"></a>04648                 <a class="code" href="../../d6/dc2/interface__anim_8c.html#a06f6a21c89c8ff4084e3a82b12daf980">ui_but_anim_remove_keyingset</a>(C);
<a name="l04649"></a>04649             <span class="keywordflow">else</span>
<a name="l04650"></a>04650                 <a class="code" href="../../d6/dc2/interface__anim_8c.html#a27155db2d7146fcfc628a0b0ab46b33b">ui_but_anim_add_keyingset</a>(C);
<a name="l04651"></a>04651                 
<a name="l04652"></a>04652             <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C));
<a name="l04653"></a>04653             
<a name="l04654"></a>04654             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l04655"></a>04655         }
<a name="l04656"></a>04656         <span class="comment">/* reset to default */</span>
<a name="l04657"></a>04657         <span class="comment">/* XXX hardcoded keymap check.... */</span>
<a name="l04658"></a>04658         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aac0bf168bc790ab56adc890c4e8580bb">BACKSPACEKEY</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l04659"></a>04659             <span class="comment">/* ctrl+backspace = reset active button; backspace = reset a whole array*/</span>
<a name="l04660"></a>04660             <span class="keywordflow">if</span> (!(<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#af5b7a7238e8eaabdbec6a107c41f426a">HSVCIRCLE</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#aaaed62f927be1bd36851e7a3008a35c2">HSVCUBE</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a602a54df54894f53ce53e1011a1c5515">HISTOGRAM</a>)))
<a name="l04661"></a>04661                 <a class="code" href="../../dd/dda/interface_8c.html#aa58b431b15a25320229921b2dc2beb90">ui_set_but_default</a>(C, !event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a>);
<a name="l04662"></a>04662         }
<a name="l04663"></a>04663         <span class="comment">/* handle menu */</span>
<a name="l04664"></a>04664         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#adc87b609a6285a24e23172a90734044c">RIGHTMOUSE</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l04665"></a>04665             <span class="comment">/* RMB has two options now */</span>
<a name="l04666"></a>04666             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#afad894448e2e6def3358a960cebc242d">ui_but_menu</a>(C, but)) {
<a name="l04667"></a>04667                 <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l04668"></a>04668             }
<a name="l04669"></a>04669         }
<a name="l04670"></a>04670     }
<a name="l04671"></a>04671 
<a name="l04672"></a>04672     <span class="comment">/* verify if we can edit this button */</span>
<a name="l04673"></a>04673     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c861c5ebabe8fe076ed84a2aaa7a1a0">RETKEY</a>)) {
<a name="l04674"></a>04674         <span class="comment">/* this should become disabled button .. */</span>
<a name="l04675"></a>04675         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a76d610ffa185d1b2ea9ba55077ec9bc0">lock</a>) {
<a name="l04676"></a>04676             <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ae45ba8a478c6a7f1ca66134486088321">lockstr</a>) {
<a name="l04677"></a>04677                 <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68aa7428e90bb3916896145e5eb14a7dd7b">RPT_WARNING</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ae45ba8a478c6a7f1ca66134486088321">lockstr</a>);
<a name="l04678"></a>04678                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l04679"></a>04679                 <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l04680"></a>04680             }
<a name="l04681"></a>04681         } 
<a name="l04682"></a>04682         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e995a6658324bda3058970ce4df74b6">pointype</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a8376dbee35a2eef4197223c5ecc18963">poin</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l04683"></a>04683             <span class="comment">/* there&#39;s a pointer needed */</span>
<a name="l04684"></a>04684             <a class="code" href="../../d2/d40/BKE__report_8h.html#af25c247b3b620d13cef87ec2bed1698e">BKE_reportf</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68aa7428e90bb3916896145e5eb14a7dd7b">RPT_WARNING</a>, <span class="stringliteral">&quot;DoButton pointer error: %s&quot;</span>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#af58de45f45814332509809d691cc70f9">str</a>);
<a name="l04685"></a>04685             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l04686"></a>04686             <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l04687"></a>04687         }
<a name="l04688"></a>04688     }
<a name="l04689"></a>04689 
<a name="l04690"></a>04690     <span class="keywordflow">switch</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>) {
<a name="l04691"></a>04691         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a02c336ab5ee16270de92af2f3f2cb5eb">BUT</a>:
<a name="l04692"></a>04692             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9accbab2570622640f6eb24ae1cc59de">ui_do_but_BUT</a>(C, but, data, event);
<a name="l04693"></a>04693             <span class="keywordflow">break</span>;
<a name="l04694"></a>04694         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a43cd93236835951a99e53f9ec1716370">KEYEVT</a>:
<a name="l04695"></a>04695             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a77015cd96a8346e120a813902ec7bca6">ui_do_but_KEYEVT</a>(C, but, data, event);
<a name="l04696"></a>04696             <span class="keywordflow">break</span>;
<a name="l04697"></a>04697         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#ab7e4edf2ce3fe6174495825cf24fd8a7">HOTKEYEVT</a>:
<a name="l04698"></a>04698             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1eaed974c7d40d310bc5eea76ab2521a">ui_do_but_HOTKEYEVT</a>(C, but, data, event);
<a name="l04699"></a>04699             <span class="keywordflow">break</span>;
<a name="l04700"></a>04700         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a4ea9f3034b08c53c14d9032798b60901">TOGBUT</a>:
<a name="l04701"></a>04701         <span class="keywordflow">case</span> <a class="code" href="../../d9/dc4/plugin_8h.html#a2532bfdf10e1ca1685038b02ce0f3386">TOG</a>:
<a name="l04702"></a>04702         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a59cc7c2157b515ed2c780bb6f7b44e27">TOGR</a>:
<a name="l04703"></a>04703         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a07a8e4d9b0c2f42662cde3b0afd8dc07">ICONTOG</a>:
<a name="l04704"></a>04704         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#afe3554f948715ad756e7bfe418a0e92e">ICONTOGN</a>:
<a name="l04705"></a>04705         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a6b185cf808adc8c34bd90b87b6b45ff7">TOGN</a>:
<a name="l04706"></a>04706         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa21a5ba3b14585362d65acd0ae14f7bc">BUT_TOGDUAL</a>:
<a name="l04707"></a>04707         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a39d0de5f53bbf5622cd6af16d647fbe5">OPTION</a>:
<a name="l04708"></a>04708         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#ac6cd5ac67760662bb5dd35aaf7000117">OPTIONN</a>:
<a name="l04709"></a>04709             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#acecc421b8b8ccc19fd08f237f1ec6695">ui_do_but_TOG</a>(C, but, data, event);
<a name="l04710"></a>04710             <span class="keywordflow">break</span>;
<a name="l04711"></a>04711         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa8fa67309d5b49cdd294644ff290591e">SCROLL</a>:
<a name="l04712"></a>04712             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a755d20cec2cabb9e10deb382a04a4ff2">ui_do_but_SCROLL</a>(C, block, but, data, event);
<a name="l04713"></a>04713             <span class="keywordflow">break</span>;
<a name="l04714"></a>04714         <span class="keywordflow">case</span> <a class="code" href="../../d9/dc4/plugin_8h.html#aaf0952059602752258dccaa015d7b54a">NUM</a>:
<a name="l04715"></a>04715         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a53ab9b2f5a030a06d3a609f2aad1fde3">NUMABS</a>:
<a name="l04716"></a>04716             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a588a1ae80eac9186e2d1e9d19357a4eb">ui_do_but_NUM</a>(C, block, but, data, event);
<a name="l04717"></a>04717             <span class="keywordflow">break</span>;
<a name="l04718"></a>04718         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a19d649cadf80f7b487a72cbf596b79bd">SLI</a>:
<a name="l04719"></a>04719         <span class="keywordflow">case</span> <a class="code" href="../../d9/dc4/plugin_8h.html#a14a9dde4adb789e686787aeff498bb10">NUMSLI</a>:
<a name="l04720"></a>04720         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a6cb451ada67e3dcb1d058adcd025b14c">HSVSLI</a>:
<a name="l04721"></a>04721             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a43e15b74cd5dde9e7d130ee6fa4c4256">ui_do_but_SLI</a>(C, block, but, data, event);
<a name="l04722"></a>04722             <span class="keywordflow">break</span>;
<a name="l04723"></a>04723         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a20f5ee572977e66f70f3350e350a5ad9">ROUNDBOX</a>:
<a name="l04724"></a>04724         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#afc775e59075662398538111f1cbd3cba">LISTBOX</a>:
<a name="l04725"></a>04725         <span class="keywordflow">case</span> <a class="code" href="../../d9/dc4/plugin_8h.html#a0b7df70d4a086a227bc482b07e2bbbca">LABEL</a>:
<a name="l04726"></a>04726         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3b2680140eea3e2f54cd0e3deae040b3">TOG3</a>:
<a name="l04727"></a>04727         <span class="keywordflow">case</span> <a class="code" href="../../dd/d8b/intern_2opennl_2superlu_2util_8h.html#a4d92d07523ba751afadecd63d3479e30abf470e461303b909bf0dc58084ebafa0">ROW</a>:
<a name="l04728"></a>04728         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a863e81437d873ffd4c9f4b31f624fbae">LISTROW</a>:
<a name="l04729"></a>04729         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa68a240a71e1a2a02b5d6a7a065e7b9e">BUT_IMAGE</a>:
<a name="l04730"></a>04730         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a2e8b374db15e64ac6199e8ca5c1bc0b2">PROGRESSBAR</a>:
<a name="l04731"></a>04731             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3dd685d5247757f152ae4b9e57324e5c">ui_do_but_EXIT</a>(C, but, data, event);
<a name="l04732"></a>04732             <span class="keywordflow">break</span>;
<a name="l04733"></a>04733         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a602a54df54894f53ce53e1011a1c5515">HISTOGRAM</a>:
<a name="l04734"></a>04734             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3d39f8e06a4c45b4f1541b94c9b3c0ee">ui_do_but_HISTOGRAM</a>(C, block, but, data, event);
<a name="l04735"></a>04735             <span class="keywordflow">break</span>;
<a name="l04736"></a>04736         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a0ebe5c598964d30fef9d41540637fc03">WAVEFORM</a>:
<a name="l04737"></a>04737             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad1cbadb44ae98e14fc73d3ee575b8b41">ui_do_but_WAVEFORM</a>(C, block, but, data, event);
<a name="l04738"></a>04738             <span class="keywordflow">break</span>;
<a name="l04739"></a>04739         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#abeded13271071435e5d7d14a65f4c1be">VECTORSCOPE</a>:
<a name="l04740"></a>04740             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a967263f3403fda6e10cab598003709dd">ui_do_but_VECTORSCOPE</a>(C, block, but, data, event);
<a name="l04741"></a>04741             <span class="keywordflow">break</span>;
<a name="l04742"></a>04742         <span class="keywordflow">case</span> <a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba24e799bd38fe08efb4756c63d8f78df9">TEX</a>:
<a name="l04743"></a>04743         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a69f2c191e2c4babdd9dc28b8fb4d8a68">IDPOIN</a>:
<a name="l04744"></a>04744         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3a2c1c38a5465f6d46a2296e3ad09bbe">SEARCH_MENU</a>:
<a name="l04745"></a>04745             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aff43191a22fd081747edfb752ff3ac1f">ui_do_but_TEX</a>(C, block, but, data, event);
<a name="l04746"></a>04746             <span class="keywordflow">break</span>;
<a name="l04747"></a>04747         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad0d059e6a83d21bea4f4db1c9fbd240b">MENU</a>:
<a name="l04748"></a>04748         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#af6ad4ca5cd637c3ab6dad8114b8d3e75">ICONROW</a>:
<a name="l04749"></a>04749         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5975b2d368ff03c7359503587664fba5">ICONTEXTROW</a>:
<a name="l04750"></a>04750         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a52220397ecea855b3a99746e451426e1">BLOCK</a>:
<a name="l04751"></a>04751         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a917e2674b6708b555abe909f360b12e1">PULLDOWN</a>:
<a name="l04752"></a>04752             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#af08883cc26d9371b56b7092a4aefb406">ui_do_but_BLOCK</a>(C, but, data, event);
<a name="l04753"></a>04753             <span class="keywordflow">break</span>;
<a name="l04754"></a>04754         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a7489385fb8eddb0eabd9fc4c3954e653">BUTM</a>:
<a name="l04755"></a>04755             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9accbab2570622640f6eb24ae1cc59de">ui_do_but_BUT</a>(C, but, data, event);
<a name="l04756"></a>04756             <span class="keywordflow">break</span>;
<a name="l04757"></a>04757         <span class="keywordflow">case</span> <a class="code" href="../../dd/d8b/intern_2opennl_2superlu_2util_8h.html#a4d92d07523ba751afadecd63d3479e30a3e66f07732b51f2cb52e13d598f8abda">COL</a>:
<a name="l04758"></a>04758             <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a57586f98222f543b349453c1a83b4ce9">a1</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa15a85263ddb1caa2c928032de812a8e">UI_GRAD_V_ALT</a>) <span class="comment">// signal to prevent calling up color picker</span>
<a name="l04759"></a>04759                 retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3dd685d5247757f152ae4b9e57324e5c">ui_do_but_EXIT</a>(C, but, data, event);
<a name="l04760"></a>04760             <span class="keywordflow">else</span>
<a name="l04761"></a>04761                 retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#af08883cc26d9371b56b7092a4aefb406">ui_do_but_BLOCK</a>(C, but, data, event);
<a name="l04762"></a>04762             <span class="keywordflow">break</span>;
<a name="l04763"></a>04763         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8823a24e6af14c65bb48fed8e6d8e4ad">BUT_NORMAL</a>:
<a name="l04764"></a>04764             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3c079ff20d110beef711c70fc71d98e5">ui_do_but_NORMAL</a>(C, block, but, data, event);
<a name="l04765"></a>04765             <span class="keywordflow">break</span>;
<a name="l04766"></a>04766         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a84c5d75a8e1a067bb3def3f69049b22a">BUT_COLORBAND</a>:
<a name="l04767"></a>04767             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ac894211d0c5541fa092583600849ff9e">ui_do_but_COLORBAND</a>(C, block, but, data, event);
<a name="l04768"></a>04768             <span class="keywordflow">break</span>;
<a name="l04769"></a>04769         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a55737ebfa3a2ec487e87544adbf7e457">BUT_CURVE</a>:
<a name="l04770"></a>04770             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#afe0a4d7b2a340909b646c9e8961e7cd4">ui_do_but_CURVE</a>(C, block, but, data, event);
<a name="l04771"></a>04771             <span class="keywordflow">break</span>;
<a name="l04772"></a>04772         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#aaaed62f927be1bd36851e7a3008a35c2">HSVCUBE</a>:
<a name="l04773"></a>04773             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6340e7ace64ed0d5e9d67922e025c3cd">ui_do_but_HSVCUBE</a>(C, block, but, data, event);
<a name="l04774"></a>04774             <span class="keywordflow">break</span>;
<a name="l04775"></a>04775         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#af5b7a7238e8eaabdbec6a107c41f426a">HSVCIRCLE</a>:
<a name="l04776"></a>04776             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9183b87f0a441235cb4bcaa2f35d9077">ui_do_but_HSVCIRCLE</a>(C, block, but, data, event);
<a name="l04777"></a>04777             <span class="keywordflow">break</span>;
<a name="l04778"></a>04778 <span class="preprocessor">#ifdef WITH_INTERNATIONAL</span>
<a name="l04779"></a>04779 <span class="preprocessor"></span>        <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a7d7e8bdc1e410df600429cb3cf65817c">CHARTAB</a>:
<a name="l04780"></a>04780             retval = ui_do_but_CHARTAB(C, block, but, data, event);
<a name="l04781"></a>04781             <span class="keywordflow">break</span>;
<a name="l04782"></a>04782 <span class="preprocessor">#endif</span>
<a name="l04783"></a>04783 <span class="preprocessor"></span>
<a name="l04784"></a>04784         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a32298be536f02aa8bbde57c0c970124e">LINK</a>:
<a name="l04785"></a>04785         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a26966d6f3a8af2b1ef515852d322b2b0">INLINK</a>:
<a name="l04786"></a>04786             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a83de0750704c68523acb0f12c9510b75">ui_do_but_LINK</a>(C, but, data, event);
<a name="l04787"></a>04787             <span class="keywordflow">break</span>;
<a name="l04788"></a>04788         <span class="keywordflow">case</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad1c71f878b30e83247db31d5afe965ff">TRACKPREVIEW</a>:
<a name="l04789"></a>04789             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8a05c3b75c6bfc7f703765a789e89193">ui_do_but_TRACKPREVIEW</a>(C, block, but, data, event);
<a name="l04790"></a>04790             <span class="keywordflow">break</span>;
<a name="l04791"></a>04791     }
<a name="l04792"></a>04792     
<a name="l04793"></a>04793     <span class="keywordflow">return</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a>;
<a name="l04794"></a>04794 }
<a name="l04795"></a>04795 
<a name="l04796"></a>04796 <span class="comment">/* ************************ button utilities *********************** */</span>
<a name="l04797"></a>04797 
<a name="l04798"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a014cc2a109a3773c53c72ce9be68c1ba">04798</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a014cc2a109a3773c53c72ce9be68c1ba">ui_but_contains_pt</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <span class="keywordtype">int</span> mx, <span class="keywordtype">int</span> my)
<a name="l04799"></a>04799 {
<a name="l04800"></a>04800     <span class="keywordflow">return</span> ((but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a5e452fa951e320c4a7c7f444f331fad6">x1</a> &lt; mx &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a13532506462a54d0aac1e71eb286a78a">x2</a> &gt;= mx) &amp;&amp; (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a> &lt; my &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abbb172bca1cfaa5d7538af548f1a1666">y2</a> &gt;= my));
<a name="l04801"></a>04801 }
<a name="l04802"></a>04802 
<a name="l04803"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9e4f3ee0f30a82b8d2c4865d80b11a75">04803</a> <span class="keyword">static</span> <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9e4f3ee0f30a82b8d2c4865d80b11a75">ui_but_find_activated</a>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar)
<a name="l04804"></a>04804 {
<a name="l04805"></a>04805     <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block;
<a name="l04806"></a>04806     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l04807"></a>04807 
<a name="l04808"></a>04808     <span class="keywordflow">for</span> (block = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#afbd94c7a138066b4e773e9d3401b0d87">uiblocks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; block; block = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a22b70a2cbc7345c42bf46c8e6dab6eb9">next</a>)
<a name="l04809"></a>04809         <span class="keywordflow">for</span> (but = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a844299999568743bc189fcb02847e9e6">buttons</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; but; but = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>)
<a name="l04810"></a>04810             <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>)
<a name="l04811"></a>04811                 <span class="keywordflow">return</span> but;
<a name="l04812"></a>04812 
<a name="l04813"></a>04813     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04814"></a>04814 }
<a name="l04815"></a>04815 
<a name="l04816"></a><a class="code" href="../../d1/d2f/interface__intern_8h.html#a050207aabeaf8aa14b457134e734b594">04816</a> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae763b0d9f13668c8d9b22a6d0f4bfcca">ui_button_is_active</a>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar)
<a name="l04817"></a>04817 {
<a name="l04818"></a>04818     <span class="keywordflow">return</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9e4f3ee0f30a82b8d2c4865d80b11a75">ui_but_find_activated</a>(ar) != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l04819"></a>04819 }
<a name="l04820"></a>04820 
<a name="l04821"></a>04821 <span class="comment">/* is called by notifier */</span>
<a name="l04822"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a2169ed55b978af392e0f2df9dee8e511">04822</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#aeb04e15cd78a6998bb092156ca127837">uiFreeActiveButtons</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen)
<a name="l04823"></a>04823 {
<a name="l04824"></a>04824     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa = screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l04825"></a>04825     
<a name="l04826"></a>04826     <span class="keywordflow">for</span> (; sa; sa = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l04827"></a>04827         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l04828"></a>04828         <span class="keywordflow">for</span> (; ar; ar = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l04829"></a>04829             <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9e4f3ee0f30a82b8d2c4865d80b11a75">ui_but_find_activated</a>(ar);
<a name="l04830"></a>04830             <span class="keywordflow">if</span> (but) {
<a name="l04831"></a>04831                 <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>;
<a name="l04832"></a>04832                 
<a name="l04833"></a>04833                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4075e0dec8d1662dc321002e402e4a4">searchbox</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l04834"></a>04834                     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>)
<a name="l04835"></a>04835                         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#abcd2b982d9dce4d0897d5202e99fd4a0">ui_button_active_free</a>(C, but);
<a name="l04836"></a>04836             }
<a name="l04837"></a>04837         }
<a name="l04838"></a>04838     }
<a name="l04839"></a>04839 }
<a name="l04840"></a>04840 
<a name="l04841"></a>04841 
<a name="l04842"></a>04842 
<a name="l04843"></a>04843 <span class="comment">/* returns TRUE if highlighted button allows drop of names */</span>
<a name="l04844"></a>04844 <span class="comment">/* called in region context */</span>
<a name="l04845"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a7dd408a1328915fb62679a091858df98">04845</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a9073d070e06f43de36b80e527655fba6">UI_but_active_drop_name</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l04846"></a>04846 {
<a name="l04847"></a>04847     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l04848"></a>04848     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9e4f3ee0f30a82b8d2c4865d80b11a75">ui_but_find_activated</a>(ar);
<a name="l04849"></a>04849 
<a name="l04850"></a>04850     <span class="keywordflow">if</span> (but) {
<a name="l04851"></a>04851         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d1/d4a/BL__Material_8h.html#a229571f072de0056c443b44191c99f9ba24e799bd38fe08efb4756c63d8f78df9">TEX</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a69f2c191e2c4babdd9dc28b8fb4d8a68">IDPOIN</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3a2c1c38a5465f6d46a2296e3ad09bbe">SEARCH_MENU</a>))
<a name="l04852"></a>04852             <span class="keywordflow">return</span> 1;
<a name="l04853"></a>04853     }
<a name="l04854"></a>04854     
<a name="l04855"></a>04855     <span class="keywordflow">return</span> 0;
<a name="l04856"></a>04856 }
<a name="l04857"></a>04857 
<a name="l04858"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aef524b33ce6d1f1d0d0ebdf5d2622c85">04858</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aef524b33ce6d1f1d0d0ebdf5d2622c85">ui_blocks_set_tooltips</a>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <span class="keywordtype">int</span> enable)
<a name="l04859"></a>04859 {
<a name="l04860"></a>04860     <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block;
<a name="l04861"></a>04861 
<a name="l04862"></a>04862     <span class="keywordflow">if</span> (!ar)
<a name="l04863"></a>04863         <span class="keywordflow">return</span>;
<a name="l04864"></a>04864 
<a name="l04865"></a>04865     <span class="comment">/* we disabled buttons when when they were already shown, and</span>
<a name="l04866"></a>04866 <span class="comment">     * re-enable them on mouse move */</span>
<a name="l04867"></a>04867     <span class="keywordflow">for</span> (block = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#afbd94c7a138066b4e773e9d3401b0d87">uiblocks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; block; block = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a22b70a2cbc7345c42bf46c8e6dab6eb9">next</a>)
<a name="l04868"></a>04868         block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a3cbdcec224596738152a91670cdc274c">tooltipdisabled</a> = !enable;
<a name="l04869"></a>04869 }
<a name="l04870"></a>04870 
<a name="l04871"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa4eb2147a5c293f4d13c2dd99a384218">04871</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa4eb2147a5c293f4d13c2dd99a384218">ui_mouse_inside_region</a>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)
<a name="l04872"></a>04872 {
<a name="l04873"></a>04873     <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block;
<a name="l04874"></a>04874     
<a name="l04875"></a>04875     <span class="comment">/* check if the mouse is in the region */</span>
<a name="l04876"></a>04876     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d44/BLI__rect_8h.html#a1242dd13fb888a0146765107474fffb4">BLI_in_rcti</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>, x, y)) {
<a name="l04877"></a>04877         <span class="keywordflow">for</span> (block = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#afbd94c7a138066b4e773e9d3401b0d87">uiblocks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; block; block = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a22b70a2cbc7345c42bf46c8e6dab6eb9">next</a>)
<a name="l04878"></a>04878             block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#aa75d72c544728d02dcce90c98153049b">auto_open</a> = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l04879"></a>04879         
<a name="l04880"></a>04880         <span class="keywordflow">return</span> 0;
<a name="l04881"></a>04881     }
<a name="l04882"></a>04882 
<a name="l04883"></a>04883     <span class="comment">/* also, check that with view2d, that the mouse is not over the scrollbars </span>
<a name="l04884"></a>04884 <span class="comment">     * NOTE: care is needed here, since the mask rect may include the scrollbars</span>
<a name="l04885"></a>04885 <span class="comment">     * even when they are not visible, so we need to make a copy of the mask to</span>
<a name="l04886"></a>04886 <span class="comment">     * use to check</span>
<a name="l04887"></a>04887 <span class="comment">     */</span>
<a name="l04888"></a>04888     <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> != ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>.<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a>) {
<a name="l04889"></a>04889         <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d = &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l04890"></a>04890         <a class="code" href="../../d0/d28/structrcti.html">rcti</a> mask_rct;
<a name="l04891"></a>04891         <span class="keywordtype">int</span> mx, my;
<a name="l04892"></a>04892         
<a name="l04893"></a>04893         <span class="comment">/* convert window coordinates to region coordinates */</span>
<a name="l04894"></a>04894         mx = x;
<a name="l04895"></a>04895         my = y;
<a name="l04896"></a>04896         <a class="code" href="../../dd/dda/interface_8c.html#ae328a7e7d511d87f25402f1b3b7e2179">ui_window_to_region</a>(ar, &amp;mx, &amp;my);
<a name="l04897"></a>04897         
<a name="l04898"></a>04898         <span class="comment">/* make a copy of the mask rect, and tweak accordingly for hidden scrollbars */</span>
<a name="l04899"></a>04899         mask_rct.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> = v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>;
<a name="l04900"></a>04900         mask_rct.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> = v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a>;
<a name="l04901"></a>04901         mask_rct.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> = v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>;
<a name="l04902"></a>04902         mask_rct.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> = v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a>;
<a name="l04903"></a>04903         
<a name="l04904"></a>04904         <span class="keywordflow">if</span> (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> &amp; (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a0792ec92f99fe3abf23f0cc8787cbef6">V2D_SCROLL_VERTICAL_HIDE</a> | <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a20450ed868d3f08927be0251482b5a28">V2D_SCROLL_VERTICAL_FULLR</a>)) {
<a name="l04905"></a>04905             <span class="keywordflow">if</span> (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ad1bc8ccf189da1c9de7471ee64102862">V2D_SCROLL_LEFT</a>)
<a name="l04906"></a>04906                 mask_rct.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> = v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a53e0cbdcced638078253737881e1603d">vert</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>;
<a name="l04907"></a>04907             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ace4b9f8761f06a8b3bd70a71bc80e34e">V2D_SCROLL_RIGHT</a>)
<a name="l04908"></a>04908                 mask_rct.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> = v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a53e0cbdcced638078253737881e1603d">vert</a>.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a>;
<a name="l04909"></a>04909         }
<a name="l04910"></a>04910         <span class="keywordflow">if</span> (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> &amp; (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a638a7692b2855648cbcb103f24c37438">V2D_SCROLL_HORIZONTAL_HIDE</a> | <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a5d65f65de4a34a681d97b0163cbab60f">V2D_SCROLL_HORIZONTAL_FULLR</a>)) {
<a name="l04911"></a>04911             <span class="keywordflow">if</span> (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> &amp; (<a class="code" href="../../df/d05/DNA__view2d__types_8h.html#ae283bf8af6563e4eb94871f580626c29">V2D_SCROLL_BOTTOM</a> | <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a28c89a58660b4bd5a5b78223315fd6d6">V2D_SCROLL_BOTTOM_O</a>))
<a name="l04912"></a>04912                 mask_rct.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> = v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#aca03edb292ceb17b769a2179bc5949af">hor</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>;
<a name="l04913"></a>04913             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#ab5e36562f4760c86bb131de724c33bf2">scroll</a> &amp; <a class="code" href="../../df/d05/DNA__view2d__types_8h.html#a894eb963a7e7313464998dc7a7c678bd">V2D_SCROLL_TOP</a>)
<a name="l04914"></a>04914                 mask_rct.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> = v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#aca03edb292ceb17b769a2179bc5949af">hor</a>.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a>;
<a name="l04915"></a>04915         }
<a name="l04916"></a>04916         
<a name="l04917"></a>04917         <span class="comment">/* check if in the rect */</span>
<a name="l04918"></a>04918         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d44/BLI__rect_8h.html#a1242dd13fb888a0146765107474fffb4">BLI_in_rcti</a>(&amp;mask_rct, mx, my)) 
<a name="l04919"></a>04919             <span class="keywordflow">return</span> 0;
<a name="l04920"></a>04920     }
<a name="l04921"></a>04921     
<a name="l04922"></a>04922     <span class="keywordflow">return</span> 1;
<a name="l04923"></a>04923 }
<a name="l04924"></a>04924 
<a name="l04925"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a96d54676d1014fb5361f50b5adf8f322">04925</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a96d54676d1014fb5361f50b5adf8f322">ui_mouse_inside_button</a>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)
<a name="l04926"></a>04926 {
<a name="l04927"></a>04927     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa4eb2147a5c293f4d13c2dd99a384218">ui_mouse_inside_region</a>(ar, x, y))
<a name="l04928"></a>04928         <span class="keywordflow">return</span> 0;
<a name="l04929"></a>04929 
<a name="l04930"></a>04930     <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(ar, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>, &amp;x, &amp;y);
<a name="l04931"></a>04931 
<a name="l04932"></a>04932     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a014cc2a109a3773c53c72ce9be68c1ba">ui_but_contains_pt</a>(but, x, y))
<a name="l04933"></a>04933         <span class="keywordflow">return</span> 0;
<a name="l04934"></a>04934     
<a name="l04935"></a>04935     <span class="keywordflow">return</span> 1;
<a name="l04936"></a>04936 }
<a name="l04937"></a>04937 
<a name="l04938"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a2220821bcaa95133c18da192c1f24278">04938</a> <span class="keyword">static</span> <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a2220821bcaa95133c18da192c1f24278">ui_but_find_mouse_over</a>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)
<a name="l04939"></a>04939 {
<a name="l04940"></a>04940     <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block;
<a name="l04941"></a>04941     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, *butover = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04942"></a>04942     <span class="keywordtype">int</span> mx, my;
<a name="l04943"></a>04943 
<a name="l04944"></a>04944 <span class="comment">//  if (!win-&gt;active)</span>
<a name="l04945"></a>04945 <span class="comment">//      return NULL;</span>
<a name="l04946"></a>04946     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa4eb2147a5c293f4d13c2dd99a384218">ui_mouse_inside_region</a>(ar, x, y))
<a name="l04947"></a>04947         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04948"></a>04948 
<a name="l04949"></a>04949     <span class="keywordflow">for</span> (block = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#afbd94c7a138066b4e773e9d3401b0d87">uiblocks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; block; block = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a22b70a2cbc7345c42bf46c8e6dab6eb9">next</a>) {
<a name="l04950"></a>04950         mx = x;
<a name="l04951"></a>04951         my = y;
<a name="l04952"></a>04952         <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(ar, block, &amp;mx, &amp;my);
<a name="l04953"></a>04953 
<a name="l04954"></a>04954         <span class="keywordflow">for</span> (but = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a844299999568743bc189fcb02847e9e6">buttons</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; but; but = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>) {
<a name="l04955"></a>04955             <span class="comment">/* note, LABEL is included for hilights, this allows drags */</span>
<a name="l04956"></a>04956             <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d9/dc4/plugin_8h.html#a0b7df70d4a086a227bc482b07e2bbbca">LABEL</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23e894de3d96a5264d22687ff985e272">dragpoin</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l04957"></a>04957                 <span class="keywordflow">continue</span>;
<a name="l04958"></a>04958             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a20f5ee572977e66f70f3350e350a5ad9">ROUNDBOX</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad19009702facf6995a6aa5dbdf1c871a">SEPR</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#afc775e59075662398538111f1cbd3cba">LISTBOX</a>))
<a name="l04959"></a>04959                 <span class="keywordflow">continue</span>;
<a name="l04960"></a>04960             <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d1/d2f/interface__intern_8h.html#a3ca3998ff68af97f92a7083ddaf3b56a">UI_HIDDEN</a>)
<a name="l04961"></a>04961                 <span class="keywordflow">continue</span>;
<a name="l04962"></a>04962             <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d1/d2f/interface__intern_8h.html#ad9ecb519941dbb5eee2a1bfb444e041d">UI_SCROLLED</a>)
<a name="l04963"></a>04963                 <span class="keywordflow">continue</span>;
<a name="l04964"></a>04964             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a014cc2a109a3773c53c72ce9be68c1ba">ui_but_contains_pt</a>(but, mx, my))
<a name="l04965"></a>04965                 butover = but;
<a name="l04966"></a>04966         }
<a name="l04967"></a>04967 
<a name="l04968"></a>04968         <span class="comment">/* CLIP_EVENTS prevents the event from reaching other blocks */</span>
<a name="l04969"></a>04969         <span class="keywordflow">if</span> (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a98c4c059c6ae512763c370fcedb1b744">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#aac45ce4b5924bfa448f32a1b2f57be28">UI_BLOCK_CLIP_EVENTS</a>) {
<a name="l04970"></a>04970             <span class="comment">/* check if mouse is inside block */</span>
<a name="l04971"></a>04971             <span class="keywordflow">if</span> (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#aff4f04b1fe47fbc5e8c99baaa7714454">minx</a> &lt;= mx &amp;&amp; block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a55ab0ddb306b70d5e5479aef2b8c3a2e">maxx</a> &gt;= mx &amp;&amp;
<a name="l04972"></a>04972                 block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a8c1f31a6c10605079edbf9efbd3920f3">miny</a> &lt;= my &amp;&amp; block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#ae7c47f5582dff9e5cdcb94b59f42dba6">maxy</a> &gt;= my)
<a name="l04973"></a>04973             {
<a name="l04974"></a>04974                 <span class="keywordflow">break</span>;
<a name="l04975"></a>04975             }
<a name="l04976"></a>04976         }
<a name="l04977"></a>04977     }
<a name="l04978"></a>04978 
<a name="l04979"></a>04979     <span class="keywordflow">return</span> butover;
<a name="l04980"></a>04980 }
<a name="l04981"></a>04981 
<a name="l04982"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a677bbc76410975309b5d594db370304d">04982</a> <span class="keyword">static</span> <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a677bbc76410975309b5d594db370304d">ui_list_find_mouse_over</a>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)
<a name="l04983"></a>04983 {
<a name="l04984"></a>04984     <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block;
<a name="l04985"></a>04985     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l04986"></a>04986     <span class="keywordtype">int</span> mx, my;
<a name="l04987"></a>04987 
<a name="l04988"></a>04988 <span class="comment">//  if (!win-&gt;active)</span>
<a name="l04989"></a>04989 <span class="comment">//      return NULL;</span>
<a name="l04990"></a>04990     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa4eb2147a5c293f4d13c2dd99a384218">ui_mouse_inside_region</a>(ar, x, y))
<a name="l04991"></a>04991         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04992"></a>04992 
<a name="l04993"></a>04993     <span class="keywordflow">for</span> (block = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#afbd94c7a138066b4e773e9d3401b0d87">uiblocks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; block; block = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a22b70a2cbc7345c42bf46c8e6dab6eb9">next</a>) {
<a name="l04994"></a>04994         mx = x;
<a name="l04995"></a>04995         my = y;
<a name="l04996"></a>04996         <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(ar, block, &amp;mx, &amp;my);
<a name="l04997"></a>04997 
<a name="l04998"></a>04998         <span class="keywordflow">for</span> (but = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a844299999568743bc189fcb02847e9e6">buttons</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>; but; but = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a081d5bf07bacf5c1887d48811a094ce6">prev</a>)
<a name="l04999"></a>04999             <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#afc775e59075662398538111f1cbd3cba">LISTBOX</a> &amp;&amp; <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a014cc2a109a3773c53c72ce9be68c1ba">ui_but_contains_pt</a>(but, mx, my))
<a name="l05000"></a>05000                 <span class="keywordflow">return</span> but;
<a name="l05001"></a>05001     }
<a name="l05002"></a>05002 
<a name="l05003"></a>05003     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05004"></a>05004 }
<a name="l05005"></a>05005 
<a name="l05006"></a>05006 <span class="comment">/* ****************** button state handling **************************/</span>
<a name="l05007"></a>05007 
<a name="l05008"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a7fa3d84e94a2cfc8f26df61b2eccce90">05008</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a7fa3d84e94a2cfc8f26df61b2eccce90">button_modal_state</a>(<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5">uiHandleButtonState</a> <a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>)
<a name="l05009"></a>05009 {
<a name="l05010"></a>05010     <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af6e74e8b44bfc993fdfb379311137874">ELEM6</a>(state, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a9fa352d4981373c052341e4a7dfd7c3d">BUTTON_STATE_WAIT_RELEASE</a>, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a827cee8974dbe7169ecaed8f9137d7c3">BUTTON_STATE_WAIT_KEY_EVENT</a>,
<a name="l05011"></a>05011                  <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">BUTTON_STATE_TEXT_EDITING</a>,
<a name="l05012"></a>05012                  <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a76040e4ffb28474e09a53e1e847423d7">BUTTON_STATE_TEXT_SELECTING</a>, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ae1228af3749113bd521ffaaa4f5060e8">BUTTON_STATE_MENU_OPEN</a>);
<a name="l05013"></a>05013 }
<a name="l05014"></a>05014 
<a name="l05015"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a08501934715996a73502df4fa5a652f8">05015</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a08501934715996a73502df4fa5a652f8">button_timers_tooltip_remove</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but)
<a name="l05016"></a>05016 {
<a name="l05017"></a>05017     <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l05018"></a>05018 
<a name="l05019"></a>05019     data = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>;
<a name="l05020"></a>05020     <span class="keywordflow">if</span> (data) {
<a name="l05021"></a>05021 
<a name="l05022"></a>05022         <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a86b3e2994b78f9ccd7a3587c18276d24">tooltiptimer</a>) {
<a name="l05023"></a>05023             <a class="code" href="../../d7/d6e/wm__window_8c.html#a1a9f31ba88dd1dd3982b3d8f02de2e75">WM_event_remove_timer</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0fef82cdcd9b3ec4bf3520230c1d67dd">wm</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7d256e7143c620fbd5619e88e21e80b0">window</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a86b3e2994b78f9ccd7a3587c18276d24">tooltiptimer</a>);
<a name="l05024"></a>05024             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a86b3e2994b78f9ccd7a3587c18276d24">tooltiptimer</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05025"></a>05025         }
<a name="l05026"></a>05026         <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a2bb369cd5eab731c2b934d37c3486be5">tooltip</a>) {
<a name="l05027"></a>05027             <a class="code" href="../../d1/d2f/interface__intern_8h.html#acd709107df242b75babd4a2f8ebdd475">ui_tooltip_free</a>(C, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a2bb369cd5eab731c2b934d37c3486be5">tooltip</a>);
<a name="l05028"></a>05028             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a2bb369cd5eab731c2b934d37c3486be5">tooltip</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05029"></a>05029         }
<a name="l05030"></a>05030 
<a name="l05031"></a>05031         <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a37d213afa1ce75a5c1aa90d64dac3ada">autoopentimer</a>) {
<a name="l05032"></a>05032             <a class="code" href="../../d7/d6e/wm__window_8c.html#a1a9f31ba88dd1dd3982b3d8f02de2e75">WM_event_remove_timer</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0fef82cdcd9b3ec4bf3520230c1d67dd">wm</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7d256e7143c620fbd5619e88e21e80b0">window</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a37d213afa1ce75a5c1aa90d64dac3ada">autoopentimer</a>);
<a name="l05033"></a>05033             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a37d213afa1ce75a5c1aa90d64dac3ada">autoopentimer</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05034"></a>05034         }
<a name="l05035"></a>05035     }
<a name="l05036"></a>05036 }
<a name="l05037"></a>05037 
<a name="l05038"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aee14e9d8d8e21e6cf39bbf72d28179c0">05038</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aee14e9d8d8e21e6cf39bbf72d28179c0">button_tooltip_timer_reset</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but)
<a name="l05039"></a>05039 {
<a name="l05040"></a>05040     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l05041"></a>05041     <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l05042"></a>05042 
<a name="l05043"></a>05043     data = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>;
<a name="l05044"></a>05044 
<a name="l05045"></a>05045     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a86b3e2994b78f9ccd7a3587c18276d24">tooltiptimer</a>) {
<a name="l05046"></a>05046         <a class="code" href="../../d7/d6e/wm__window_8c.html#a1a9f31ba88dd1dd3982b3d8f02de2e75">WM_event_remove_timer</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0fef82cdcd9b3ec4bf3520230c1d67dd">wm</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7d256e7143c620fbd5619e88e21e80b0">window</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a86b3e2994b78f9ccd7a3587c18276d24">tooltiptimer</a>);
<a name="l05047"></a>05047         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a86b3e2994b78f9ccd7a3587c18276d24">tooltiptimer</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05048"></a>05048     }
<a name="l05049"></a>05049 
<a name="l05050"></a>05050     <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.flag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a26fe5041f0f9c5e723fe77549d9fce95">USER_TOOLTIPS</a>)
<a name="l05051"></a>05051         <span class="keywordflow">if</span> (!but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a3cbdcec224596738152a91670cdc274c">tooltipdisabled</a>)
<a name="l05052"></a>05052             <span class="keywordflow">if</span> (!wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a79b9d69dc9bdb8b0b49095c11d05e4f5">drags</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)
<a name="l05053"></a>05053                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a86b3e2994b78f9ccd7a3587c18276d24">tooltiptimer</a> = <a class="code" href="../../d7/d6e/wm__window_8c.html#af5bdd7109c7ea81c77a89d9f41585f3a">WM_event_add_timer</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0fef82cdcd9b3ec4bf3520230c1d67dd">wm</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7d256e7143c620fbd5619e88e21e80b0">window</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a599217205dc3092c26567a2bd868ef3a">TIMER</a>, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1bebf830e1e5c490420ab8aa7f741910">BUTTON_TOOLTIP_DELAY</a>);
<a name="l05054"></a>05054 }
<a name="l05055"></a>05055 
<a name="l05056"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">05056</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5">uiHandleButtonState</a> <a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>)
<a name="l05057"></a>05057 {
<a name="l05058"></a>05058     <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l05059"></a>05059 
<a name="l05060"></a>05060     data = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>;
<a name="l05061"></a>05061     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == state)
<a name="l05062"></a>05062         <span class="keywordflow">return</span>;
<a name="l05063"></a>05063 
<a name="l05064"></a>05064     <span class="comment">/* highlight has timers for tooltips and auto open */</span>
<a name="l05065"></a>05065     <span class="keywordflow">if</span> (state == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l05066"></a>05066         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp;= ~<a class="code" href="../../d1/d2f/interface__intern_8h.html#ada5088cd71649979ef58a9b21e0420cb">UI_SELECT</a>;
<a name="l05067"></a>05067 
<a name="l05068"></a>05068         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aee14e9d8d8e21e6cf39bbf72d28179c0">button_tooltip_timer_reset</a>(C, but);
<a name="l05069"></a>05069 
<a name="l05070"></a>05070         <span class="comment">/* automatic open pulldown block timer */</span>
<a name="l05071"></a>05071         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a52220397ecea855b3a99746e451426e1">BLOCK</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a917e2674b6708b555abe909f360b12e1">PULLDOWN</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5975b2d368ff03c7359503587664fba5">ICONTEXTROW</a>)) {
<a name="l05072"></a>05072             <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4f34bfddee9d298d226604baa1bf4e2">used_mouse</a> &amp;&amp; !data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a37d213afa1ce75a5c1aa90d64dac3ada">autoopentimer</a>) {
<a name="l05073"></a>05073                 <span class="keywordtype">int</span> time;
<a name="l05074"></a>05074 
<a name="l05075"></a>05075                 <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#aa75d72c544728d02dcce90c98153049b">auto_open</a> == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) time = 1;  <span class="comment">// test for toolbox</span>
<a name="l05076"></a>05076                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a98c4c059c6ae512763c370fcedb1b744">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a85cfd29a5959ab2b2fcc578bcbe6ef3c">UI_BLOCK_LOOP</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> != <a class="code" href="../../d8/d1e/UI__interface_8h.html#a52220397ecea855b3a99746e451426e1">BLOCK</a>) || but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#aa75d72c544728d02dcce90c98153049b">auto_open</a> == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) time = 5 * <a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.menuthreshold2;
<a name="l05077"></a>05077                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.uiflag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a286085f88f0ad239d5c66033309ccb84">USER_MENUOPENAUTO</a>) time = 5 * <a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.menuthreshold1;
<a name="l05078"></a>05078                 <span class="keywordflow">else</span> time = -1;
<a name="l05079"></a>05079 
<a name="l05080"></a>05080                 <span class="keywordflow">if</span> (time &gt;= 0)
<a name="l05081"></a>05081                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a37d213afa1ce75a5c1aa90d64dac3ada">autoopentimer</a> = <a class="code" href="../../d7/d6e/wm__window_8c.html#af5bdd7109c7ea81c77a89d9f41585f3a">WM_event_add_timer</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0fef82cdcd9b3ec4bf3520230c1d67dd">wm</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7d256e7143c620fbd5619e88e21e80b0">window</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a599217205dc3092c26567a2bd868ef3a">TIMER</a>, 0.02 * (<span class="keywordtype">double</span>)time);
<a name="l05082"></a>05082             }
<a name="l05083"></a>05083         }
<a name="l05084"></a>05084     }
<a name="l05085"></a>05085     <span class="keywordflow">else</span> {
<a name="l05086"></a>05086         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> |= <a class="code" href="../../d1/d2f/interface__intern_8h.html#ada5088cd71649979ef58a9b21e0420cb">UI_SELECT</a>;
<a name="l05087"></a>05087         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a08501934715996a73502df4fa5a652f8">button_timers_tooltip_remove</a>(C, but);
<a name="l05088"></a>05088     }
<a name="l05089"></a>05089     
<a name="l05090"></a>05090     <span class="comment">/* text editing */</span>
<a name="l05091"></a>05091     <span class="keywordflow">if</span> (state == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">BUTTON_STATE_TEXT_EDITING</a> &amp;&amp; data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> != <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a76040e4ffb28474e09a53e1e847423d7">BUTTON_STATE_TEXT_SELECTING</a>)
<a name="l05092"></a>05092         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3fbaa9e67c2665507579180572c070f6">ui_textedit_begin</a>(C, but, data);
<a name="l05093"></a>05093     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">BUTTON_STATE_TEXT_EDITING</a> &amp;&amp; state != <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a76040e4ffb28474e09a53e1e847423d7">BUTTON_STATE_TEXT_SELECTING</a>)
<a name="l05094"></a>05094         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aaec14e5e07c2bd6ee0cacd30fcedc0f1">ui_textedit_end</a>(C, but, data);
<a name="l05095"></a>05095     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a76040e4ffb28474e09a53e1e847423d7">BUTTON_STATE_TEXT_SELECTING</a> &amp;&amp; state != <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">BUTTON_STATE_TEXT_EDITING</a>)
<a name="l05096"></a>05096         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aaec14e5e07c2bd6ee0cacd30fcedc0f1">ui_textedit_end</a>(C, but, data);
<a name="l05097"></a>05097     
<a name="l05098"></a>05098     <span class="comment">/* number editing */</span>
<a name="l05099"></a>05099     <span class="keywordflow">if</span> (state == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>) {
<a name="l05100"></a>05100         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#aab7bfed4f48e9625734a5b862a44c5f6">ui_is_a_warp_but</a>(but))
<a name="l05101"></a>05101             <a class="code" href="../../de/d3c/wm__cursors_8c.html#aba6c2bcfe61d68f45da87fbb6c82765c">WM_cursor_grab</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C), <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l05102"></a>05102         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aafafed7a295715ebcb05cffedfeaf95e">ui_numedit_begin</a>(but, data);
<a name="l05103"></a>05103     }
<a name="l05104"></a>05104     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a51101dfd1cc6da9cf59d49efbf1bf82b">BUTTON_STATE_NUM_EDITING</a>) {
<a name="l05105"></a>05105         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a75d18f02c6196701af0d7bac92b33fc0">ui_numedit_end</a>(but, data);
<a name="l05106"></a>05106         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#aab7bfed4f48e9625734a5b862a44c5f6">ui_is_a_warp_but</a>(but))
<a name="l05107"></a>05107             <a class="code" href="../../de/d3c/wm__cursors_8c.html#a2867b8dc5deb9d551abadd74d402fb14">WM_cursor_ungrab</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C));
<a name="l05108"></a>05108     }
<a name="l05109"></a>05109     <span class="comment">/* menu open */</span>
<a name="l05110"></a>05110     <span class="keywordflow">if</span> (state == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ae1228af3749113bd521ffaaa4f5060e8">BUTTON_STATE_MENU_OPEN</a>)
<a name="l05111"></a>05111         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9987db2d7a7751bb495144f869862103">ui_blockopen_begin</a>(C, but, data);
<a name="l05112"></a>05112     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ae1228af3749113bd521ffaaa4f5060e8">BUTTON_STATE_MENU_OPEN</a>)
<a name="l05113"></a>05113         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a87be4a69d67815ee8354f3b0e893e04c">ui_blockopen_end</a>(C, but, data);
<a name="l05114"></a>05114 
<a name="l05115"></a>05115     <span class="comment">/* add a short delay before exiting, to ensure there is some feedback */</span>
<a name="l05116"></a>05116     <span class="keywordflow">if</span> (state == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a3bf879676619cb413082552088d9360e">BUTTON_STATE_WAIT_FLASH</a>) {
<a name="l05117"></a>05117         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aaaffd30db8d103c08aac277fb90247f9">flashtimer</a> = <a class="code" href="../../d7/d6e/wm__window_8c.html#af5bdd7109c7ea81c77a89d9f41585f3a">WM_event_add_timer</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0fef82cdcd9b3ec4bf3520230c1d67dd">wm</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7d256e7143c620fbd5619e88e21e80b0">window</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a599217205dc3092c26567a2bd868ef3a">TIMER</a>, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a0a8051787d6550c31c4657b29d33f3aa">BUTTON_FLASH_DELAY</a>);
<a name="l05118"></a>05118     }
<a name="l05119"></a>05119     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aaaffd30db8d103c08aac277fb90247f9">flashtimer</a>) {
<a name="l05120"></a>05120         <a class="code" href="../../d7/d6e/wm__window_8c.html#a1a9f31ba88dd1dd3982b3d8f02de2e75">WM_event_remove_timer</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0fef82cdcd9b3ec4bf3520230c1d67dd">wm</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7d256e7143c620fbd5619e88e21e80b0">window</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aaaffd30db8d103c08aac277fb90247f9">flashtimer</a>);
<a name="l05121"></a>05121         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aaaffd30db8d103c08aac277fb90247f9">flashtimer</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05122"></a>05122     }
<a name="l05123"></a>05123 
<a name="l05124"></a>05124     <span class="comment">/* add a blocking ui handler at the window handler for blocking, modal states</span>
<a name="l05125"></a>05125 <span class="comment">     * but not for popups, because we already have a window level handler*/</span>
<a name="l05126"></a>05126     <span class="keywordflow">if</span> (!(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a5c195fe9502deed2ddbcdb3edadae776">handle</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a5c195fe9502deed2ddbcdb3edadae776">handle</a>-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#ac355a67eb10be3b2f0aa792d10aa58f8">popup</a>)) {
<a name="l05127"></a>05127         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a7fa3d84e94a2cfc8f26df61b2eccce90">button_modal_state</a>(state)) {
<a name="l05128"></a>05128             <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a7fa3d84e94a2cfc8f26df61b2eccce90">button_modal_state</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a>))
<a name="l05129"></a>05129                 <a class="code" href="../../df/db0/wm__event__system_8c.html#aee879a05c38567d71054117111d1269c">WM_event_add_ui_handler</a>(C, &amp;data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7d256e7143c620fbd5619e88e21e80b0">window</a>-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1ea8c9176e46638bd4cd9648c7f9fae2">modalhandlers</a>, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6af6aa616eab184a12bf533bd9ebea55">ui_handler_region_menu</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, data);
<a name="l05130"></a>05130         }
<a name="l05131"></a>05131         <span class="keywordflow">else</span> {
<a name="l05132"></a>05132             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a7fa3d84e94a2cfc8f26df61b2eccce90">button_modal_state</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a>))
<a name="l05133"></a>05133                 <a class="code" href="../../df/db0/wm__event__system_8c.html#aa4559ef4b4b539b84f096c57577ff9a6">WM_event_remove_ui_handler</a>(&amp;data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7d256e7143c620fbd5619e88e21e80b0">window</a>-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1ea8c9176e46638bd4cd9648c7f9fae2">modalhandlers</a>, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6af6aa616eab184a12bf533bd9ebea55">ui_handler_region_menu</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, data, 1);  <span class="comment">/* 1 = postpone free */</span>
<a name="l05134"></a>05134         }
<a name="l05135"></a>05135     }
<a name="l05136"></a>05136     
<a name="l05137"></a>05137     <span class="comment">/* wait for mousemove to enable drag */</span>
<a name="l05138"></a>05138     <span class="keywordflow">if</span> (state == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a930ea9a11f71ca40393f0d62d9d3afcb">BUTTON_STATE_WAIT_DRAG</a>) {
<a name="l05139"></a>05139         but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp;= ~<a class="code" href="../../d1/d2f/interface__intern_8h.html#ada5088cd71649979ef58a9b21e0420cb">UI_SELECT</a>;
<a name="l05140"></a>05140     }
<a name="l05141"></a>05141 
<a name="l05142"></a>05142     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> = <a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>;
<a name="l05143"></a>05143 
<a name="l05144"></a>05144     <span class="keywordflow">if</span> (state != <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>) {
<a name="l05145"></a>05145         <span class="comment">/* When objects for eg. are removed, running ui_check_but() can access</span>
<a name="l05146"></a>05146 <span class="comment">         * the removed data - so disable update on exit. Also in case of</span>
<a name="l05147"></a>05147 <span class="comment">         * highlight when not in a popup menu, we remove because data used in</span>
<a name="l05148"></a>05148 <span class="comment">         * button below popup might have been removed by action of popup. Needs</span>
<a name="l05149"></a>05149 <span class="comment">         * a more reliable solution... */</span>
<a name="l05150"></a>05150         <span class="keywordflow">if</span> (state != <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a> || (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a98c4c059c6ae512763c370fcedb1b744">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a85cfd29a5959ab2b2fcc578bcbe6ef3c">UI_BLOCK_LOOP</a>))
<a name="l05151"></a>05151             <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(but);
<a name="l05152"></a>05152     }
<a name="l05153"></a>05153 
<a name="l05154"></a>05154     <span class="comment">/* redraw */</span>
<a name="l05155"></a>05155     <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>);
<a name="l05156"></a>05156 }
<a name="l05157"></a>05157 
<a name="l05158"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a2329af5d5be838a498a81be0dbfc6e09">05158</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a2329af5d5be838a498a81be0dbfc6e09">button_activate_init</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0b">uiButtonActivateType</a> type)
<a name="l05159"></a>05159 {
<a name="l05160"></a>05160     <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l05161"></a>05161 
<a name="l05162"></a>05162     <span class="comment">/* setup struct */</span>
<a name="l05163"></a>05163     data = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a>), <span class="stringliteral">&quot;uiHandleButtonData&quot;</span>);
<a name="l05164"></a>05164     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0fef82cdcd9b3ec4bf3520230c1d67dd">wm</a> = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l05165"></a>05165     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7d256e7143c620fbd5619e88e21e80b0">window</a> = <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l05166"></a>05166     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a> = ar;
<a name="l05167"></a>05167     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a55737ebfa3a2ec487e87544adbf7e457">BUT_CURVE</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3a2c1c38a5465f6d46a2296e3ad09bbe">SEARCH_MENU</a>) ) ;  <span class="comment">// XXX curve is temp</span>
<a name="l05168"></a>05168     <span class="keywordflow">else</span> data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ae0ab7227e9e4ef09a14fa9a47f76f6fc">interactive</a> = 1;
<a name="l05169"></a>05169     
<a name="l05170"></a>05170     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a3739fe8f243e759c235eb531bbdc31af">BUTTON_STATE_INIT</a>;
<a name="l05171"></a>05171 
<a name="l05172"></a>05172     <span class="comment">/* activate button */</span>
<a name="l05173"></a>05173     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> |= <a class="code" href="../../d1/d2f/interface__intern_8h.html#a79b3f8d716499489d309feda1a3eaa43">UI_ACTIVE</a>;
<a name="l05174"></a>05174     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a> = <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l05175"></a>05175 
<a name="l05176"></a>05176     <span class="comment">/* we disable auto_open in the block after a threshold, because we still</span>
<a name="l05177"></a>05177 <span class="comment">     * want to allow auto opening adjacent menus even if no button is activated</span>
<a name="l05178"></a>05178 <span class="comment">     * in between going over to the other button, but only for a short while */</span>
<a name="l05179"></a>05179     <span class="keywordflow">if</span> (type == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0ba0ed75c6ab37a0b50ebaffdb3a4ad3f60">BUTTON_ACTIVATE_OVER</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#aa75d72c544728d02dcce90c98153049b">auto_open</a> == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)
<a name="l05180"></a>05180         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a6ed542cf1a8c299bbf626e619dce1cad">auto_open_last</a> + <a class="code" href="../../d3/d9b/interface__handlers_8c.html#af426bddb9718a37f58081f2b27a01b50">BUTTON_AUTO_OPEN_THRESH</a> &lt; <a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>())
<a name="l05181"></a>05181             but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#aa75d72c544728d02dcce90c98153049b">auto_open</a> = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l05182"></a>05182 
<a name="l05183"></a>05183     <span class="keywordflow">if</span> (type == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0ba0ed75c6ab37a0b50ebaffdb3a4ad3f60">BUTTON_ACTIVATE_OVER</a>) {
<a name="l05184"></a>05184         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4f34bfddee9d298d226604baa1bf4e2">used_mouse</a> = 1;
<a name="l05185"></a>05185     }
<a name="l05186"></a>05186     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>);
<a name="l05187"></a>05187     
<a name="l05188"></a>05188     <span class="comment">/* activate right away */</span>
<a name="l05189"></a>05189     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a45aed21d420717e9b0a1babb03ba5a78">UI_BUT_IMMEDIATE</a>) {
<a name="l05190"></a>05190         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#ab7e4edf2ce3fe6174495825cf24fd8a7">HOTKEYEVT</a>)
<a name="l05191"></a>05191             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a827cee8974dbe7169ecaed8f9137d7c3">BUTTON_STATE_WAIT_KEY_EVENT</a>);
<a name="l05192"></a>05192         <span class="comment">/* .. more to be added here */</span>
<a name="l05193"></a>05193     }
<a name="l05194"></a>05194     
<a name="l05195"></a>05195     <span class="keywordflow">if</span> (type == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0ba96a20f1754faaa0c4d3f914a2906d44d">BUTTON_ACTIVATE_OPEN</a>) {
<a name="l05196"></a>05196         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ae1228af3749113bd521ffaaa4f5060e8">BUTTON_STATE_MENU_OPEN</a>);
<a name="l05197"></a>05197 
<a name="l05198"></a>05198         <span class="comment">/* activate first button in submenu */</span>
<a name="l05199"></a>05199         <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a> &amp;&amp; data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a>-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a1ff0c66125f1330b1f99b461093bc10c">region</a>) {
<a name="l05200"></a>05200             <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *subar = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a>-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a1ff0c66125f1330b1f99b461093bc10c">region</a>;
<a name="l05201"></a>05201             <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *subblock = subar-&gt;<a class="code" href="../../da/d23/structARegion.html#afbd94c7a138066b4e773e9d3401b0d87">uiblocks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05202"></a>05202             <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *subbut;
<a name="l05203"></a>05203             
<a name="l05204"></a>05204             <span class="keywordflow">if</span> (subblock) {
<a name="l05205"></a>05205                 subbut = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa6fe202ff1581edf19c97eabbc7d4dc6">ui_but_first</a>(subblock);
<a name="l05206"></a>05206 
<a name="l05207"></a>05207                 <span class="keywordflow">if</span> (subbut)
<a name="l05208"></a>05208                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab4089d3f2a01002abbea3eadec7a650b">ui_handle_button_activate</a>(C, subar, subbut, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0bab111808df840be3c6692f0dc072933c7">BUTTON_ACTIVATE</a>);
<a name="l05209"></a>05209             }
<a name="l05210"></a>05210         }
<a name="l05211"></a>05211     }
<a name="l05212"></a>05212     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0bae112effebc0dedcb8bcf27f261510424">BUTTON_ACTIVATE_TEXT_EDITING</a>)
<a name="l05213"></a>05213         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a5c13489eedf7015f9e1d682233cb5cf3">BUTTON_STATE_TEXT_EDITING</a>);
<a name="l05214"></a>05214     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0ba83e55158cfac680f1af68501dc6219c6">BUTTON_ACTIVATE_APPLY</a>)
<a name="l05215"></a>05215         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a3bf879676619cb413082552088d9360e">BUTTON_STATE_WAIT_FLASH</a>);
<a name="l05216"></a>05216 }
<a name="l05217"></a>05217 
<a name="l05218"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8c09fd77c9a750908dd5fe99a69609bd">05218</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8c09fd77c9a750908dd5fe99a69609bd">button_activate_exit</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <span class="keywordtype">int</span> mousemove, <span class="keywordtype">int</span> onfree)
<a name="l05219"></a>05219 {
<a name="l05220"></a>05220     <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>;
<a name="l05221"></a>05221     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *bt;
<a name="l05222"></a>05222 
<a name="l05223"></a>05223     <span class="comment">/* ensure we are in the exit state */</span>
<a name="l05224"></a>05224     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> != <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>)
<a name="l05225"></a>05225         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l05226"></a>05226 
<a name="l05227"></a>05227     <span class="comment">/* apply the button action or value */</span>
<a name="l05228"></a>05228     <span class="keywordflow">if</span> (!onfree)
<a name="l05229"></a>05229         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a87504e0357211849ab7661ff46be2fef">ui_apply_button</a>(C, block, but, data, 0);
<a name="l05230"></a>05230 
<a name="l05231"></a>05231     <span class="comment">/* if this button is in a menu, this will set the button return</span>
<a name="l05232"></a>05232 <span class="comment">     * value to the button value and the menu return value to ok, the</span>
<a name="l05233"></a>05233 <span class="comment">     * menu return value will be picked up and the menu will close */</span>
<a name="l05234"></a>05234     <span class="keywordflow">if</span> (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a5c195fe9502deed2ddbcdb3edadae776">handle</a> &amp;&amp; !(block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a98c4c059c6ae512763c370fcedb1b744">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a1e54286a0adf9f1390927708c76e9a3c">UI_BLOCK_KEEP_OPEN</a>)) {
<a name="l05235"></a>05235         <span class="keywordflow">if</span> (!data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> || data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ab781c61b8b3d2757829f9aa919e5f136">escapecancel</a>) {
<a name="l05236"></a>05236             <a class="code" href="../../dc/d28/structuiPopupBlockHandle.html">uiPopupBlockHandle</a> *menu;
<a name="l05237"></a>05237 
<a name="l05238"></a>05238             menu = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a5c195fe9502deed2ddbcdb3edadae776">handle</a>;
<a name="l05239"></a>05239             menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a923c558b70bc91e610eeb7f44f31b028">butretval</a> = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a>;
<a name="l05240"></a>05240             menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> = (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a>) ? <a class="code" href="../../d8/d1e/UI__interface_8h.html#ace0267a120fea587350d10329515e70d">UI_RETURN_CANCEL</a> : <a class="code" href="../../d8/d1e/UI__interface_8h.html#a0958fdecb4298063870bc8a9b642724a">UI_RETURN_OK</a>;
<a name="l05241"></a>05241         }
<a name="l05242"></a>05242     }
<a name="l05243"></a>05243 
<a name="l05244"></a>05244     <span class="keywordflow">if</span> (!onfree &amp;&amp; !data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a>) {
<a name="l05245"></a>05245         <span class="comment">/* autokey &amp; undo push */</span>
<a name="l05246"></a>05246         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a202b225af133e66df3e52ba04355a0ec">ui_apply_autokey_undo</a>(C, but);
<a name="l05247"></a>05247 
<a name="l05248"></a>05248         <span class="comment">/* popup menu memory */</span>
<a name="l05249"></a>05249         <span class="keywordflow">if</span> (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a98c4c059c6ae512763c370fcedb1b744">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8b743fb1b7c69896bebdd25c99ce19ea">UI_BLOCK_POPUP_MEMORY</a>)
<a name="l05250"></a>05250             <a class="code" href="../../d1/d2f/interface__intern_8h.html#afd63947e0abf898fd6d4b77506322956">ui_popup_menu_memory</a>(block, but);
<a name="l05251"></a>05251     }
<a name="l05252"></a>05252 
<a name="l05253"></a>05253     <span class="comment">/* disable tooltips until mousemove + last active flag */</span>
<a name="l05254"></a>05254     <span class="keywordflow">for</span> (block = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#afbd94c7a138066b4e773e9d3401b0d87">uiblocks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; block; block = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a22b70a2cbc7345c42bf46c8e6dab6eb9">next</a>) {
<a name="l05255"></a>05255         <span class="keywordflow">for</span> (bt = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a844299999568743bc189fcb02847e9e6">buttons</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; bt; bt = bt-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>)
<a name="l05256"></a>05256             bt-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp;= ~<a class="code" href="../../d8/d1e/UI__interface_8h.html#aef8670638990f3f60d1c71ee4b120468">UI_BUT_LAST_ACTIVE</a>;
<a name="l05257"></a>05257 
<a name="l05258"></a>05258         block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a3cbdcec224596738152a91670cdc274c">tooltipdisabled</a> = 1;
<a name="l05259"></a>05259     }
<a name="l05260"></a>05260 
<a name="l05261"></a>05261     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aef524b33ce6d1f1d0d0ebdf5d2622c85">ui_blocks_set_tooltips</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, 0);
<a name="l05262"></a>05262 
<a name="l05263"></a>05263     <span class="comment">/* clean up */</span>
<a name="l05264"></a>05264     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>)
<a name="l05265"></a>05265         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af7f673bb84cd2ceb14d2a69e4bb89d74">str</a>);
<a name="l05266"></a>05266     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af007846eca2f6739b5f5d6305db6d2ca">origstr</a>)
<a name="l05267"></a>05267         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af007846eca2f6739b5f5d6305db6d2ca">origstr</a>);
<a name="l05268"></a>05268 
<a name="l05269"></a>05269     <span class="comment">/* redraw (data is but-&gt;active!) */</span>
<a name="l05270"></a>05270     <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>);
<a name="l05271"></a>05271     
<a name="l05272"></a>05272     <span class="comment">/* clean up button */</span>
<a name="l05273"></a>05273     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>);
<a name="l05274"></a>05274     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05275"></a>05275     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp;= ~(<a class="code" href="../../d1/d2f/interface__intern_8h.html#a79b3f8d716499489d309feda1a3eaa43">UI_ACTIVE</a> | <a class="code" href="../../d1/d2f/interface__intern_8h.html#ada5088cd71649979ef58a9b21e0420cb">UI_SELECT</a>);
<a name="l05276"></a>05276     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> |= <a class="code" href="../../d8/d1e/UI__interface_8h.html#aef8670638990f3f60d1c71ee4b120468">UI_BUT_LAST_ACTIVE</a>;
<a name="l05277"></a>05277     <span class="keywordflow">if</span> (!onfree)
<a name="l05278"></a>05278         <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(but);
<a name="l05279"></a>05279 
<a name="l05280"></a>05280     <span class="comment">/* adds empty mousemove in queue for re-init handler, in case mouse is</span>
<a name="l05281"></a>05281 <span class="comment">     * still over a button. we cannot just check for this ourselfs because</span>
<a name="l05282"></a>05282 <span class="comment">     * at this point the mouse may be over a button in another region */</span>
<a name="l05283"></a>05283     <span class="keywordflow">if</span> (mousemove)
<a name="l05284"></a>05284         <a class="code" href="../../df/db0/wm__event__system_8c.html#a1d397b4836b1aa453112a4cc59550686">WM_event_add_mousemove</a>(C);
<a name="l05285"></a>05285 }
<a name="l05286"></a>05286 
<a name="l05287"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#abcd2b982d9dce4d0897d5202e99fd4a0">05287</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#abcd2b982d9dce4d0897d5202e99fd4a0">ui_button_active_free</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but)
<a name="l05288"></a>05288 {
<a name="l05289"></a>05289     <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l05290"></a>05290 
<a name="l05291"></a>05291     <span class="comment">/* this gets called when the button somehow disappears while it is still</span>
<a name="l05292"></a>05292 <span class="comment">     * active, this is bad for user interaction, but we need to handle this</span>
<a name="l05293"></a>05293 <span class="comment">     * case cleanly anyway in case it happens */</span>
<a name="l05294"></a>05294     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>) {
<a name="l05295"></a>05295         data = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>;
<a name="l05296"></a>05296         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l05297"></a>05297         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8c09fd77c9a750908dd5fe99a69609bd">button_activate_exit</a>((<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *)C, data, but, 0, 1);
<a name="l05298"></a>05298     }
<a name="l05299"></a>05299 }
<a name="l05300"></a>05300 
<a name="l05301"></a>05301 <span class="comment">/* returns the active button with an optional checking function */</span>
<a name="l05302"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9c51e81d65589651b8a8e085eab7dc8f">05302</a> <span class="keyword">static</span> <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9c51e81d65589651b8a8e085eab7dc8f">ui_context_button_active</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keywordtype">int</span> (*but_check_cb)(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *))
<a name="l05303"></a>05303 {
<a name="l05304"></a>05304     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but_found = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05305"></a>05305 
<a name="l05306"></a>05306     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l05307"></a>05307 
<a name="l05308"></a>05308     <span class="keywordflow">while</span> (ar) {
<a name="l05309"></a>05309         <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block;
<a name="l05310"></a>05310         <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, *activebut = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05311"></a>05311 
<a name="l05312"></a>05312         <span class="comment">/* find active button */</span>
<a name="l05313"></a>05313         <span class="keywordflow">for</span> (block = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#afbd94c7a138066b4e773e9d3401b0d87">uiblocks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; block; block = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a22b70a2cbc7345c42bf46c8e6dab6eb9">next</a>) {
<a name="l05314"></a>05314             <span class="keywordflow">for</span> (but = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a844299999568743bc189fcb02847e9e6">buttons</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; but; but = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>) {
<a name="l05315"></a>05315                 <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>)
<a name="l05316"></a>05316                     activebut = but;
<a name="l05317"></a>05317                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!activebut &amp;&amp; (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#aef8670638990f3f60d1c71ee4b120468">UI_BUT_LAST_ACTIVE</a>))
<a name="l05318"></a>05318                     activebut = but;
<a name="l05319"></a>05319             }
<a name="l05320"></a>05320         }
<a name="l05321"></a>05321 
<a name="l05322"></a>05322         <span class="keywordflow">if</span> (activebut &amp;&amp; (but_check_cb == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || but_check_cb(activebut))) {
<a name="l05323"></a>05323             <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = activebut-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>;
<a name="l05324"></a>05324 
<a name="l05325"></a>05325             but_found = activebut;
<a name="l05326"></a>05326 
<a name="l05327"></a>05327             <span class="comment">/* recurse into opened menu, like colorpicker case */</span>
<a name="l05328"></a>05328             <span class="keywordflow">if</span> (data &amp;&amp; data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a> &amp;&amp; (ar != data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a>-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a1ff0c66125f1330b1f99b461093bc10c">region</a>)) {
<a name="l05329"></a>05329                 ar = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a>-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a1ff0c66125f1330b1f99b461093bc10c">region</a>;
<a name="l05330"></a>05330             }
<a name="l05331"></a>05331             <span class="keywordflow">else</span> {
<a name="l05332"></a>05332                 <span class="keywordflow">return</span> but_found;
<a name="l05333"></a>05333             }
<a name="l05334"></a>05334         }
<a name="l05335"></a>05335         <span class="keywordflow">else</span> {
<a name="l05336"></a>05336             <span class="comment">/* no active button */</span>
<a name="l05337"></a>05337             <span class="keywordflow">return</span> but_found;
<a name="l05338"></a>05338         }
<a name="l05339"></a>05339     }
<a name="l05340"></a>05340 
<a name="l05341"></a>05341     <span class="keywordflow">return</span> but_found;
<a name="l05342"></a>05342 }
<a name="l05343"></a>05343 
<a name="l05344"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ac454ebad76a22672d34a180c12a4d49a">05344</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ac454ebad76a22672d34a180c12a4d49a">ui_context_rna_button_active_test</a>(<a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but)
<a name="l05345"></a>05345 {
<a name="l05346"></a>05346     <span class="keywordflow">return</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l05347"></a>05347 }
<a name="l05348"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a7ff3f79a345df4ed833a852dce8b0d4f">05348</a> <span class="keyword">static</span> <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a7ff3f79a345df4ed833a852dce8b0d4f">ui_context_rna_button_active</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l05349"></a>05349 {
<a name="l05350"></a>05350     <span class="keywordflow">return</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9c51e81d65589651b8a8e085eab7dc8f">ui_context_button_active</a>(C, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ac454ebad76a22672d34a180c12a4d49a">ui_context_rna_button_active_test</a>);
<a name="l05351"></a>05351 }
<a name="l05352"></a>05352 
<a name="l05353"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a77d2b589df88430bdcd0a67c281fa09d">05353</a> <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *<a class="code" href="../../d8/d1e/UI__interface_8h.html#a77d2b589df88430bdcd0a67c281fa09d">uiContextActiveButton</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l05354"></a>05354 {
<a name="l05355"></a>05355     <span class="keywordflow">return</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9c51e81d65589651b8a8e085eab7dc8f">ui_context_button_active</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l05356"></a>05356 }
<a name="l05357"></a>05357 
<a name="l05358"></a>05358 <span class="comment">/* helper function for insert keyframe, reset to default, etc operators */</span>
<a name="l05359"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa105b99bb4dba83bef5eb9dbcb894434">05359</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a7ae2be7857ae4735f23feebea7471e56">uiContextActiveProperty</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keyword">struct</span> <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> *ptr, <span class="keyword">struct</span> <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> **prop, <span class="keywordtype">int</span> *index)
<a name="l05360"></a>05360 {
<a name="l05361"></a>05361     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *activebut = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a7ff3f79a345df4ed833a852dce8b0d4f">ui_context_rna_button_active</a>(C);
<a name="l05362"></a>05362 
<a name="l05363"></a>05363     memset(ptr, 0, <span class="keyword">sizeof</span>(*ptr));
<a name="l05364"></a>05364 
<a name="l05365"></a>05365     <span class="keywordflow">if</span> (activebut &amp;&amp; activebut-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>) {
<a name="l05366"></a>05366         *ptr = activebut-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>;
<a name="l05367"></a>05367         *prop = activebut-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>;
<a name="l05368"></a>05368         *index = activebut-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ac7a245d1d0ad932e448f7c0ad9ef2ea2">rnaindex</a>;
<a name="l05369"></a>05369     }
<a name="l05370"></a>05370     <span class="keywordflow">else</span> {
<a name="l05371"></a>05371         *prop = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05372"></a>05372         *index = 0;
<a name="l05373"></a>05373     }
<a name="l05374"></a>05374 }
<a name="l05375"></a>05375 
<a name="l05376"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a10f8b261746644af808fcc06fe6fbb9e">05376</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#ac754c736fd098814f07c228978a1451b">uiContextActivePropertyHandle</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l05377"></a>05377 {
<a name="l05378"></a>05378     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *activebut = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a7ff3f79a345df4ed833a852dce8b0d4f">ui_context_rna_button_active</a>(C);
<a name="l05379"></a>05379     <span class="keywordflow">if</span> (activebut) {
<a name="l05380"></a>05380         <span class="comment">/* TODO, look into a better way to handle the button change</span>
<a name="l05381"></a>05381 <span class="comment">         * currently this is mainly so reset defaults works for the</span>
<a name="l05382"></a>05382 <span class="comment">         * operator redo panel - campbell */</span>
<a name="l05383"></a>05383         <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block = activebut-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>;
<a name="l05384"></a>05384         <span class="keywordflow">if</span> (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a6b69a2c68c67bfc81d90b00cc32cd267">handle_func</a>) {
<a name="l05385"></a>05385             block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a6b69a2c68c67bfc81d90b00cc32cd267">handle_func</a>(C, block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#ac8f71dc493486138abed1c1ed5a73490">handle_func_arg</a>, 0);
<a name="l05386"></a>05386         }
<a name="l05387"></a>05387     }
<a name="l05388"></a>05388 }
<a name="l05389"></a>05389 
<a name="l05390"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a20156e99c872b849396d36a8788eddd8">05390</a> <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../d8/d1e/UI__interface_8h.html#aa340fbbff50cbf5c700121c7a1ac7ae6">uiContextActiveOperator</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l05391"></a>05391 {
<a name="l05392"></a>05392     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar_ctx = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l05393"></a>05393     <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block;
<a name="l05394"></a>05394 
<a name="l05395"></a>05395     <span class="comment">/* background mode */</span>
<a name="l05396"></a>05396     <span class="keywordflow">if</span> (ar_ctx == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l05397"></a>05397         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05398"></a>05398     }
<a name="l05399"></a>05399 
<a name="l05400"></a>05400     <span class="comment">/* scan active regions ui */</span>
<a name="l05401"></a>05401     <span class="keywordflow">for</span> (block = ar_ctx-&gt;<a class="code" href="../../da/d23/structARegion.html#afbd94c7a138066b4e773e9d3401b0d87">uiblocks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; block; block = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a22b70a2cbc7345c42bf46c8e6dab6eb9">next</a>) {
<a name="l05402"></a>05402         <span class="keywordflow">if</span> (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#abe19083fa729e4fac5aa368876aff8b8">ui_operator</a>) {
<a name="l05403"></a>05403             <span class="keywordflow">return</span> block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#abe19083fa729e4fac5aa368876aff8b8">ui_operator</a>;
<a name="l05404"></a>05404         }
<a name="l05405"></a>05405     }
<a name="l05406"></a>05406 
<a name="l05407"></a>05407     <span class="comment">/* scan popups */</span>
<a name="l05408"></a>05408     {
<a name="l05409"></a>05409         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc = <a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C);
<a name="l05410"></a>05410         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l05411"></a>05411 
<a name="l05412"></a>05412         <span class="keywordflow">for</span> (ar = sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a5aed112496143ef5c69ddb1f9a8d5efd">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l05413"></a>05413             <span class="keywordflow">if</span> (ar == ar_ctx) {
<a name="l05414"></a>05414                 <span class="keywordflow">continue</span>;
<a name="l05415"></a>05415             }
<a name="l05416"></a>05416             <span class="keywordflow">for</span> (block = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#afbd94c7a138066b4e773e9d3401b0d87">uiblocks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; block; block = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a22b70a2cbc7345c42bf46c8e6dab6eb9">next</a>) {
<a name="l05417"></a>05417                 <span class="keywordflow">if</span> (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#abe19083fa729e4fac5aa368876aff8b8">ui_operator</a>) {
<a name="l05418"></a>05418                     <span class="keywordflow">return</span> block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#abe19083fa729e4fac5aa368876aff8b8">ui_operator</a>;
<a name="l05419"></a>05419                 }
<a name="l05420"></a>05420             }
<a name="l05421"></a>05421         }
<a name="l05422"></a>05422     }
<a name="l05423"></a>05423 
<a name="l05424"></a>05424     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05425"></a>05425 }
<a name="l05426"></a>05426 
<a name="l05427"></a>05427 <span class="comment">/* helper function for insert keyframe, reset to default, etc operators */</span>
<a name="l05428"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a00e3fc5ad9ee2ac3d29fa50c2a32da88">05428</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a1e3f6b31f1acb59f917665305edc24e2">uiContextAnimUpdate</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l05429"></a>05429 {
<a name="l05430"></a>05430     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l05431"></a>05431     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l05432"></a>05432     <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block;
<a name="l05433"></a>05433     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, *activebut;
<a name="l05434"></a>05434 
<a name="l05435"></a>05435     <span class="keywordflow">while</span> (ar) {
<a name="l05436"></a>05436         <span class="comment">/* find active button */</span>
<a name="l05437"></a>05437         activebut = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05438"></a>05438 
<a name="l05439"></a>05439         <span class="keywordflow">for</span> (block = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#afbd94c7a138066b4e773e9d3401b0d87">uiblocks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; block; block = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a22b70a2cbc7345c42bf46c8e6dab6eb9">next</a>) {
<a name="l05440"></a>05440             <span class="keywordflow">for</span> (but = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a844299999568743bc189fcb02847e9e6">buttons</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; but; but = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>) {
<a name="l05441"></a>05441                 <a class="code" href="../../d6/dc2/interface__anim_8c.html#aa9766887cb01bf2d941a6d6935ca00dc">ui_but_anim_flag</a>(but, (scene) ? scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a> : 0.0f);
<a name="l05442"></a>05442                 <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(ar);
<a name="l05443"></a>05443                 
<a name="l05444"></a>05444                 <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>)
<a name="l05445"></a>05445                     activebut = but;
<a name="l05446"></a>05446                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!activebut &amp;&amp; (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#aef8670638990f3f60d1c71ee4b120468">UI_BUT_LAST_ACTIVE</a>))
<a name="l05447"></a>05447                     activebut = but;
<a name="l05448"></a>05448             }
<a name="l05449"></a>05449         }
<a name="l05450"></a>05450 
<a name="l05451"></a>05451         <span class="keywordflow">if</span> (activebut) {
<a name="l05452"></a>05452             <span class="comment">/* always recurse into opened menu, so all buttons update (like colorpicker) */</span>
<a name="l05453"></a>05453             <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = activebut-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>;
<a name="l05454"></a>05454             <span class="keywordflow">if</span> (data &amp;&amp; data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a>)
<a name="l05455"></a>05455                 ar = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a>-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a1ff0c66125f1330b1f99b461093bc10c">region</a>;
<a name="l05456"></a>05456             <span class="keywordflow">else</span>
<a name="l05457"></a>05457                 <span class="keywordflow">return</span>;
<a name="l05458"></a>05458         }
<a name="l05459"></a>05459         <span class="keywordflow">else</span> {
<a name="l05460"></a>05460             <span class="comment">/* no active button */</span>
<a name="l05461"></a>05461             <span class="keywordflow">return</span>;
<a name="l05462"></a>05462         }
<a name="l05463"></a>05463     }
<a name="l05464"></a>05464 }
<a name="l05465"></a>05465 
<a name="l05466"></a>05466 <span class="comment">/************** handle activating a button *************/</span>
<a name="l05467"></a>05467 
<a name="l05468"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a48d831dbeada3ab376b0a974913ac2fb">05468</a> <span class="keyword">static</span> <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a48d831dbeada3ab376b0a974913ac2fb">uit_but_find_open_event</a>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l05469"></a>05469 {
<a name="l05470"></a>05470     <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block;
<a name="l05471"></a>05471     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l05472"></a>05472     
<a name="l05473"></a>05473     <span class="keywordflow">for</span> (block = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#afbd94c7a138066b4e773e9d3401b0d87">uiblocks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; block; block = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a22b70a2cbc7345c42bf46c8e6dab6eb9">next</a>) {
<a name="l05474"></a>05474         <span class="keywordflow">for</span> (but = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a844299999568743bc189fcb02847e9e6">buttons</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; but; but = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>)
<a name="l05475"></a>05475             <span class="keywordflow">if</span> (but == event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a>)
<a name="l05476"></a>05476                 <span class="keywordflow">return</span> but;
<a name="l05477"></a>05477     }
<a name="l05478"></a>05478     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05479"></a>05479 }
<a name="l05480"></a>05480 
<a name="l05481"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a418c092286ca75afad8af16253e00275">05481</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a418c092286ca75afad8af16253e00275">ui_handle_button_over</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar)
<a name="l05482"></a>05482 {
<a name="l05483"></a>05483     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l05484"></a>05484 
<a name="l05485"></a>05485     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>) {
<a name="l05486"></a>05486         but = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a2220821bcaa95133c18da192c1f24278">ui_but_find_mouse_over</a>(ar, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>);
<a name="l05487"></a>05487         <span class="keywordflow">if</span> (but)
<a name="l05488"></a>05488             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a2329af5d5be838a498a81be0dbfc6e09">button_activate_init</a>(C, ar, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0ba0ed75c6ab37a0b50ebaffdb3a4ad3f60">BUTTON_ACTIVATE_OVER</a>);
<a name="l05489"></a>05489     }
<a name="l05490"></a>05490     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a7e76795d5874bd49d91359d64a6f3ef3">EVT_BUT_OPEN</a>) {
<a name="l05491"></a>05491         but = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a48d831dbeada3ab376b0a974913ac2fb">uit_but_find_open_event</a>(ar, event);
<a name="l05492"></a>05492         <span class="keywordflow">if</span> (but) {
<a name="l05493"></a>05493             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a2329af5d5be838a498a81be0dbfc6e09">button_activate_init</a>(C, ar, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0ba0ed75c6ab37a0b50ebaffdb3a4ad3f60">BUTTON_ACTIVATE_OVER</a>);
<a name="l05494"></a>05494             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1787cc5b45354b4b5f045934dc82469a">ui_do_button</a>(C, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>, but, event);
<a name="l05495"></a>05495         }
<a name="l05496"></a>05496     }
<a name="l05497"></a>05497 
<a name="l05498"></a>05498     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l05499"></a>05499 }
<a name="l05500"></a>05500 
<a name="l05501"></a>05501 <span class="comment">/* exported to interface.c: uiButActiveOnly() */</span>
<a name="l05502"></a><a class="code" href="../../d1/d2f/interface__intern_8h.html#adaf73b2a2dd87684968fecd8cdb75d6d">05502</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a3490f4d9604ef2bc364fa0a4e00453e2">ui_button_activate_do</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but)
<a name="l05503"></a>05503 {
<a name="l05504"></a>05504     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win = <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l05505"></a>05505     <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> event;
<a name="l05506"></a>05506     
<a name="l05507"></a>05507     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a2329af5d5be838a498a81be0dbfc6e09">button_activate_init</a>(C, ar, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0ba0ed75c6ab37a0b50ebaffdb3a4ad3f60">BUTTON_ACTIVATE_OVER</a>);
<a name="l05508"></a>05508     
<a name="l05509"></a>05509     <span class="keyword">event</span> = *(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>);  <span class="comment">/* XXX huh huh? make api call */</span>
<a name="l05510"></a>05510     <span class="keyword">event</span>.type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a7e76795d5874bd49d91359d64a6f3ef3">EVT_BUT_OPEN</a>;
<a name="l05511"></a>05511     <span class="keyword">event</span>.val = <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>;
<a name="l05512"></a>05512     <span class="keyword">event</span>.customdata = but;
<a name="l05513"></a>05513     <span class="keyword">event</span>.customdatafree = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l05514"></a>05514     
<a name="l05515"></a>05515     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1787cc5b45354b4b5f045934dc82469a">ui_do_button</a>(C, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>, but, &amp;event);
<a name="l05516"></a>05516 }
<a name="l05517"></a>05517 
<a name="l05518"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab4089d3f2a01002abbea3eadec7a650b">05518</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab4089d3f2a01002abbea3eadec7a650b">ui_handle_button_activate</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0b">uiButtonActivateType</a> type)
<a name="l05519"></a>05519 {
<a name="l05520"></a>05520     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *oldbut;
<a name="l05521"></a>05521     <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l05522"></a>05522 
<a name="l05523"></a>05523     oldbut = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9e4f3ee0f30a82b8d2c4865d80b11a75">ui_but_find_activated</a>(ar);
<a name="l05524"></a>05524     <span class="keywordflow">if</span> (oldbut) {
<a name="l05525"></a>05525         data = oldbut-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>;
<a name="l05526"></a>05526         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l05527"></a>05527         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8c09fd77c9a750908dd5fe99a69609bd">button_activate_exit</a>(C, data, oldbut, 0, 0);
<a name="l05528"></a>05528     }
<a name="l05529"></a>05529 
<a name="l05530"></a>05530     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a2329af5d5be838a498a81be0dbfc6e09">button_activate_init</a>(C, ar, but, type);
<a name="l05531"></a>05531 }
<a name="l05532"></a>05532 
<a name="l05533"></a>05533 <span class="comment">/************ handle events for an activated button ***********/</span>
<a name="l05534"></a>05534 
<a name="l05535"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9a702f228e05fb9efdaf2d1632ad47b0">05535</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9a702f228e05fb9efdaf2d1632ad47b0">ui_handle_button_event</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but)
<a name="l05536"></a>05536 {
<a name="l05537"></a>05537     <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l05538"></a>05538     <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block;
<a name="l05539"></a>05539     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l05540"></a>05540     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *postbut;
<a name="l05541"></a>05541     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0b">uiButtonActivateType</a> posttype;
<a name="l05542"></a>05542     <span class="keywordtype">int</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a>;
<a name="l05543"></a>05543 
<a name="l05544"></a>05544     data = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>;
<a name="l05545"></a>05545     block = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>;
<a name="l05546"></a>05546     ar = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>;
<a name="l05547"></a>05547 
<a name="l05548"></a>05548     retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l05549"></a>05549     
<a name="l05550"></a>05550     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>) {
<a name="l05551"></a>05551         <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l05552"></a>05552             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aedc39a0f069c3164e42a4ab800df57d4">WINDEACTIVATE</a>:
<a name="l05553"></a>05553             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#acd3c0daf8c9c1c59de98513ee0a1127a">EVT_BUT_CANCEL</a>:
<a name="l05554"></a>05554                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l05555"></a>05555                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l05556"></a>05556                 retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l05557"></a>05557                 <span class="keywordflow">break</span>;
<a name="l05558"></a>05558             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>:
<a name="l05559"></a>05559                 <span class="comment">/* verify if we are still over the button, if not exit */</span>
<a name="l05560"></a>05560                 <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a96d54676d1014fb5361f50b5adf8f322">ui_mouse_inside_button</a>(ar, but, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>)) {
<a name="l05561"></a>05561                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l05562"></a>05562                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l05563"></a>05563                 }
<a name="l05564"></a>05564                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a2220821bcaa95133c18da192c1f24278">ui_but_find_mouse_over</a>(ar, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>) != but) {
<a name="l05565"></a>05565                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l05566"></a>05566                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l05567"></a>05567                 }
<a name="l05568"></a>05568                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> != event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#ae82a74a8a8f426501aab0b260aeb9189">prevx</a> || event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a> != event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa3a33c2ca6525fb33d25b67e50bea0eb">prevy</a>) {
<a name="l05569"></a>05569                     <span class="comment">/* re-enable tooltip on mouse move */</span>
<a name="l05570"></a>05570                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aef524b33ce6d1f1d0d0ebdf5d2622c85">ui_blocks_set_tooltips</a>(ar, 1);
<a name="l05571"></a>05571                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aee14e9d8d8e21e6cf39bbf72d28179c0">button_tooltip_timer_reset</a>(C, but);
<a name="l05572"></a>05572                 }
<a name="l05573"></a>05573 
<a name="l05574"></a>05574                 <span class="keywordflow">break</span>;
<a name="l05575"></a>05575             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a599217205dc3092c26567a2bd868ef3a">TIMER</a>: {
<a name="l05576"></a>05576                 <span class="comment">/* handle tooltip timer */</span>
<a name="l05577"></a>05577                 <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a> == data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a86b3e2994b78f9ccd7a3587c18276d24">tooltiptimer</a>) {
<a name="l05578"></a>05578                     <a class="code" href="../../d7/d6e/wm__window_8c.html#a1a9f31ba88dd1dd3982b3d8f02de2e75">WM_event_remove_timer</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0fef82cdcd9b3ec4bf3520230c1d67dd">wm</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7d256e7143c620fbd5619e88e21e80b0">window</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a86b3e2994b78f9ccd7a3587c18276d24">tooltiptimer</a>);
<a name="l05579"></a>05579                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a86b3e2994b78f9ccd7a3587c18276d24">tooltiptimer</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05580"></a>05580 
<a name="l05581"></a>05581                     <span class="keywordflow">if</span> (!data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a2bb369cd5eab731c2b934d37c3486be5">tooltip</a>)
<a name="l05582"></a>05582                         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a2bb369cd5eab731c2b934d37c3486be5">tooltip</a> = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a067724f46ef3a5058982c65000dd7ef9">ui_tooltip_create</a>(C, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, but);
<a name="l05583"></a>05583                 }
<a name="l05584"></a>05584                 <span class="comment">/* handle menu auto open timer */</span>
<a name="l05585"></a>05585                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a> == data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a37d213afa1ce75a5c1aa90d64dac3ada">autoopentimer</a>) {
<a name="l05586"></a>05586                     <a class="code" href="../../d7/d6e/wm__window_8c.html#a1a9f31ba88dd1dd3982b3d8f02de2e75">WM_event_remove_timer</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0fef82cdcd9b3ec4bf3520230c1d67dd">wm</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7d256e7143c620fbd5619e88e21e80b0">window</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a37d213afa1ce75a5c1aa90d64dac3ada">autoopentimer</a>);
<a name="l05587"></a>05587                     data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a37d213afa1ce75a5c1aa90d64dac3ada">autoopentimer</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05588"></a>05588 
<a name="l05589"></a>05589                     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a96d54676d1014fb5361f50b5adf8f322">ui_mouse_inside_button</a>(ar, but, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>))
<a name="l05590"></a>05590                         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ae1228af3749113bd521ffaaa4f5060e8">BUTTON_STATE_MENU_OPEN</a>);
<a name="l05591"></a>05591                 }
<a name="l05592"></a>05592 
<a name="l05593"></a>05593                 retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l05594"></a>05594                 <span class="keywordflow">break</span>;
<a name="l05595"></a>05595                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>:
<a name="l05596"></a>05596                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>:
<a name="l05597"></a>05597                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>:
<a name="l05598"></a>05598                     <span class="comment">/* XXX hardcoded keymap check... but anyway, while view changes, tooltips should be removed */</span>
<a name="l05599"></a>05599                     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a86b3e2994b78f9ccd7a3587c18276d24">tooltiptimer</a>) {
<a name="l05600"></a>05600                         <a class="code" href="../../d7/d6e/wm__window_8c.html#a1a9f31ba88dd1dd3982b3d8f02de2e75">WM_event_remove_timer</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a0fef82cdcd9b3ec4bf3520230c1d67dd">wm</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7d256e7143c620fbd5619e88e21e80b0">window</a>, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a86b3e2994b78f9ccd7a3587c18276d24">tooltiptimer</a>);
<a name="l05601"></a>05601                         data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a86b3e2994b78f9ccd7a3587c18276d24">tooltiptimer</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05602"></a>05602                     }
<a name="l05603"></a>05603                 <span class="comment">/* pass on purposedly */</span>
<a name="l05604"></a>05604                 <span class="keywordflow">default</span>:
<a name="l05605"></a>05605                     <span class="comment">/* handle button type specific events */</span>
<a name="l05606"></a>05606                     retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1787cc5b45354b4b5f045934dc82469a">ui_do_button</a>(C, block, but, event);
<a name="l05607"></a>05607             }
<a name="l05608"></a>05608         }
<a name="l05609"></a>05609     }
<a name="l05610"></a>05610     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a9fa352d4981373c052341e4a7dfd7c3d">BUTTON_STATE_WAIT_RELEASE</a>) {
<a name="l05611"></a>05611         <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l05612"></a>05612             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aedc39a0f069c3164e42a4ab800df57d4">WINDEACTIVATE</a>:
<a name="l05613"></a>05613                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l05614"></a>05614                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l05615"></a>05615                 <span class="keywordflow">break</span>;
<a name="l05616"></a>05616 
<a name="l05617"></a>05617             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>:
<a name="l05618"></a>05618                 <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a32298be536f02aa8bbde57c0c970124e">LINK</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a26966d6f3a8af2b1ef515852d322b2b0">INLINK</a>)) {
<a name="l05619"></a>05619                     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> |= <a class="code" href="../../d1/d2f/interface__intern_8h.html#ada5088cd71649979ef58a9b21e0420cb">UI_SELECT</a>;
<a name="l05620"></a>05620                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1787cc5b45354b4b5f045934dc82469a">ui_do_button</a>(C, block, but, event);
<a name="l05621"></a>05621                     <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>);
<a name="l05622"></a>05622                 }
<a name="l05623"></a>05623                 <span class="keywordflow">else</span> {
<a name="l05624"></a>05624                     <span class="comment">/* deselect the button when moving the mouse away */</span>
<a name="l05625"></a>05625                     <span class="comment">/* also de-activate for buttons that only show higlights */</span>
<a name="l05626"></a>05626                     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a96d54676d1014fb5361f50b5adf8f322">ui_mouse_inside_button</a>(ar, but, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>)) {
<a name="l05627"></a>05627                         <span class="keywordflow">if</span> (!(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d1/d2f/interface__intern_8h.html#ada5088cd71649979ef58a9b21e0420cb">UI_SELECT</a>)) {
<a name="l05628"></a>05628                             but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> |= (<a class="code" href="../../d1/d2f/interface__intern_8h.html#ada5088cd71649979ef58a9b21e0420cb">UI_SELECT</a> | <a class="code" href="../../d1/d2f/interface__intern_8h.html#a79b3f8d716499489d309feda1a3eaa43">UI_ACTIVE</a>);
<a name="l05629"></a>05629                             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 0;
<a name="l05630"></a>05630                             <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>);
<a name="l05631"></a>05631                         }
<a name="l05632"></a>05632                     }
<a name="l05633"></a>05633                     <span class="keywordflow">else</span> {
<a name="l05634"></a>05634                         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d1/d2f/interface__intern_8h.html#ada5088cd71649979ef58a9b21e0420cb">UI_SELECT</a>) {
<a name="l05635"></a>05635                             but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp;= ~(<a class="code" href="../../d1/d2f/interface__intern_8h.html#ada5088cd71649979ef58a9b21e0420cb">UI_SELECT</a> | <a class="code" href="../../d1/d2f/interface__intern_8h.html#a79b3f8d716499489d309feda1a3eaa43">UI_ACTIVE</a>);
<a name="l05636"></a>05636                             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l05637"></a>05637                             <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>);
<a name="l05638"></a>05638                         }
<a name="l05639"></a>05639                     }
<a name="l05640"></a>05640                 }               
<a name="l05641"></a>05641                 <span class="keywordflow">break</span>;
<a name="l05642"></a>05642             <span class="keywordflow">default</span>:
<a name="l05643"></a>05643                 <span class="comment">/* otherwise catch mouse release event */</span>
<a name="l05644"></a>05644                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1787cc5b45354b4b5f045934dc82469a">ui_do_button</a>(C, block, but, event);
<a name="l05645"></a>05645                 <span class="keywordflow">break</span>;
<a name="l05646"></a>05646         }
<a name="l05647"></a>05647 
<a name="l05648"></a>05648         retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l05649"></a>05649     }
<a name="l05650"></a>05650     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a3bf879676619cb413082552088d9360e">BUTTON_STATE_WAIT_FLASH</a>) {
<a name="l05651"></a>05651         <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l05652"></a>05652             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a599217205dc3092c26567a2bd868ef3a">TIMER</a>: {
<a name="l05653"></a>05653                 <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a> == data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aaaffd30db8d103c08aac277fb90247f9">flashtimer</a>)
<a name="l05654"></a>05654                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l05655"></a>05655             }
<a name="l05656"></a>05656         }
<a name="l05657"></a>05657 
<a name="l05658"></a>05658         retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l05659"></a>05659     }
<a name="l05660"></a>05660     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ae1228af3749113bd521ffaaa4f5060e8">BUTTON_STATE_MENU_OPEN</a>) {
<a name="l05661"></a>05661         <span class="comment">/* check for exit because of mouse-over another button */</span>
<a name="l05662"></a>05662         <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l05663"></a>05663             <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>:
<a name="l05664"></a>05664                 
<a name="l05665"></a>05665                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a> &amp;&amp; data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a>-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a1ff0c66125f1330b1f99b461093bc10c">region</a>)
<a name="l05666"></a>05666                     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa4eb2147a5c293f4d13c2dd99a384218">ui_mouse_inside_region</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a>-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a1ff0c66125f1330b1f99b461093bc10c">region</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>))
<a name="l05667"></a>05667                         <span class="keywordflow">break</span>;
<a name="l05668"></a>05668             
<a name="l05669"></a>05669                 {
<a name="l05670"></a>05670                     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *bt = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a2220821bcaa95133c18da192c1f24278">ui_but_find_mouse_over</a>(ar, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>);
<a name="l05671"></a>05671 
<a name="l05672"></a>05672                     <span class="keywordflow">if</span> (bt &amp;&amp; bt-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a> != data) {
<a name="l05673"></a>05673                         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> != <a class="code" href="../../dd/d8b/intern_2opennl_2superlu_2util_8h.html#a4d92d07523ba751afadecd63d3479e30a3e66f07732b51f2cb52e13d598f8abda">COL</a>) <span class="comment">/* exception */</span>
<a name="l05674"></a>05674                             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l05675"></a>05675                         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>);
<a name="l05676"></a>05676                     }
<a name="l05677"></a>05677                     <span class="keywordflow">break</span>;
<a name="l05678"></a>05678                 }
<a name="l05679"></a>05679         }
<a name="l05680"></a>05680 
<a name="l05681"></a>05681         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1787cc5b45354b4b5f045934dc82469a">ui_do_button</a>(C, block, but, event);
<a name="l05682"></a>05682         retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l05683"></a>05683     }
<a name="l05684"></a>05684     <span class="keywordflow">else</span> {
<a name="l05685"></a>05685         retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a1787cc5b45354b4b5f045934dc82469a">ui_do_button</a>(C, block, but, event);
<a name="l05686"></a>05686         <span class="comment">// retval= WM_UI_HANDLER_BREAK; XXX why ? </span>
<a name="l05687"></a>05687     }
<a name="l05688"></a>05688 
<a name="l05689"></a>05689     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ac4d9a980129045584ccbd9ebdd9472b0">BUTTON_STATE_EXIT</a>) {
<a name="l05690"></a>05690         postbut = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ace9a44756d7460fca8dd9f3eb9f807db">postbut</a>;
<a name="l05691"></a>05691         posttype = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#acfd4bf78a3b0c42ca0309227cf0fe11d">posttype</a>;
<a name="l05692"></a>05692 
<a name="l05693"></a>05693         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8c09fd77c9a750908dd5fe99a69609bd">button_activate_exit</a>(C, data, but, (postbut == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>), 0);
<a name="l05694"></a>05694 
<a name="l05695"></a>05695         <span class="comment">/* for jumping to the next button with tab while text editing */</span>
<a name="l05696"></a>05696         <span class="keywordflow">if</span> (postbut)
<a name="l05697"></a>05697             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a2329af5d5be838a498a81be0dbfc6e09">button_activate_init</a>(C, ar, postbut, posttype);
<a name="l05698"></a>05698     }
<a name="l05699"></a>05699 
<a name="l05700"></a>05700     <span class="keywordflow">return</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a>;
<a name="l05701"></a>05701 }
<a name="l05702"></a>05702 
<a name="l05703"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa2e9281e320bf704c3bae5cf8c1372b8">05703</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa2e9281e320bf704c3bae5cf8c1372b8">ui_handle_list_event</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar)
<a name="l05704"></a>05704 {
<a name="l05705"></a>05705     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a677bbc76410975309b5d594db370304d">ui_list_find_mouse_over</a>(ar, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>);
<a name="l05706"></a>05706     <span class="keywordtype">int</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l05707"></a>05707     <span class="keywordtype">int</span> value, <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>, <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>;
<a name="l05708"></a>05708 
<a name="l05709"></a>05709     <span class="keywordflow">if</span> (but &amp;&amp; (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>)) {
<a name="l05710"></a>05710         <a class="code" href="../../d7/d84/structPanel.html">Panel</a> *pa = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a2cba1bdecae17fb0f88c3d4416797319">panel</a>;
<a name="l05711"></a>05711 
<a name="l05712"></a>05712         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#afc161d5211a7975b71b2d478f936ad85">UPARROWKEY</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab85e7d9e3424f69f61d277f3aa68bff8">DOWNARROWKEY</a>) ||
<a name="l05713"></a>05713             ((<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a>))) {
<a name="l05714"></a>05714             <span class="comment">/* activate up/down the list */</span>
<a name="l05715"></a>05715             value = <a class="code" href="../../d3/d10/rna__access_8c.html#a7755e74d78f50e508966f2af17f7523e">RNA_property_int_get</a>(&amp;but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>);
<a name="l05716"></a>05716 
<a name="l05717"></a>05717             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#afc161d5211a7975b71b2d478f936ad85">UPARROWKEY</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>))
<a name="l05718"></a>05718                 value--;
<a name="l05719"></a>05719             <span class="keywordflow">else</span>
<a name="l05720"></a>05720                 value++;
<a name="l05721"></a>05721 
<a name="l05722"></a>05722             <span class="keywordflow">if</span> (value &lt; pa-&gt;list_scroll)
<a name="l05723"></a>05723                 pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#acf06ab0515da6b22b388d61b55c7520d">list_scroll</a> = value;
<a name="l05724"></a>05724             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value &gt;= pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#acf06ab0515da6b22b388d61b55c7520d">list_scroll</a> + pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#a5b8bbc438cda1ee81ae512aa9b89ebff">list_size</a>)
<a name="l05725"></a>05725                 pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#acf06ab0515da6b22b388d61b55c7520d">list_scroll</a> = value - pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#a5b8bbc438cda1ee81ae512aa9b89ebff">list_size</a> + 1;
<a name="l05726"></a>05726 
<a name="l05727"></a>05727             <a class="code" href="../../d3/d10/rna__access_8c.html#ac511ed744e0dad1b0a43e6c05d46b9ce">RNA_property_int_range</a>(&amp;but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>, &amp;min, &amp;max);
<a name="l05728"></a>05728             value = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a49a86f7d81f477961529de3add6d68ab">CLAMPIS</a>(value, min, max);
<a name="l05729"></a>05729 
<a name="l05730"></a>05730             <a class="code" href="../../d3/d10/rna__access_8c.html#a0b521aa0072858134949f9639de7faff">RNA_property_int_set</a>(&amp;but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>, value);
<a name="l05731"></a>05731             <a class="code" href="../../d3/d10/rna__access_8c.html#a5fa7d69c3a73312275e1e6d20baf3bc6">RNA_property_update</a>(C, &amp;but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>);
<a name="l05732"></a>05732             <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(ar);
<a name="l05733"></a>05733 
<a name="l05734"></a>05734             retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l05735"></a>05735         }
<a name="l05736"></a>05736         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a>) {
<a name="l05737"></a>05737             <span class="comment">/* silly replacement for proper grip */</span>
<a name="l05738"></a>05738             <span class="keywordflow">if</span> (pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#a6b5871cea5e9a75387031e19477fdb79">list_grip_size</a> == 0)
<a name="l05739"></a>05739                 pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#a6b5871cea5e9a75387031e19477fdb79">list_grip_size</a> = pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#a5b8bbc438cda1ee81ae512aa9b89ebff">list_size</a>;
<a name="l05740"></a>05740 
<a name="l05741"></a>05741             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>)
<a name="l05742"></a>05742                 pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#a6b5871cea5e9a75387031e19477fdb79">list_grip_size</a>--;
<a name="l05743"></a>05743             <span class="keywordflow">else</span>
<a name="l05744"></a>05744                 pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#a6b5871cea5e9a75387031e19477fdb79">list_grip_size</a>++;
<a name="l05745"></a>05745 
<a name="l05746"></a>05746             pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#a6b5871cea5e9a75387031e19477fdb79">list_grip_size</a> = <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#a6b5871cea5e9a75387031e19477fdb79">list_grip_size</a>, 1);
<a name="l05747"></a>05747 
<a name="l05748"></a>05748             <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(ar);
<a name="l05749"></a>05749 
<a name="l05750"></a>05750             retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l05751"></a>05751         }
<a name="l05752"></a>05752         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>)) {
<a name="l05753"></a>05753             <span class="keywordflow">if</span> (pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#a40a2d1aeffdec6d1e0ae40556ad47dc6">list_last_len</a> &gt; pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#a5b8bbc438cda1ee81ae512aa9b89ebff">list_size</a>) {
<a name="l05754"></a>05754                 <span class="comment">/* list template will clamp */</span>
<a name="l05755"></a>05755                 <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>)
<a name="l05756"></a>05756                     pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#acf06ab0515da6b22b388d61b55c7520d">list_scroll</a>--;
<a name="l05757"></a>05757                 <span class="keywordflow">else</span>
<a name="l05758"></a>05758                     pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#acf06ab0515da6b22b388d61b55c7520d">list_scroll</a>++;
<a name="l05759"></a>05759 
<a name="l05760"></a>05760                 <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(ar);
<a name="l05761"></a>05761 
<a name="l05762"></a>05762                 retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l05763"></a>05763             }
<a name="l05764"></a>05764         }
<a name="l05765"></a>05765     }
<a name="l05766"></a>05766 
<a name="l05767"></a>05767     <span class="keywordflow">return</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a>;
<a name="l05768"></a>05768 }
<a name="l05769"></a>05769 
<a name="l05770"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a64678527ed84bbae4935c712d65b4b7d">05770</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a64678527ed84bbae4935c712d65b4b7d">ui_handle_button_return_submenu</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but)
<a name="l05771"></a>05771 {
<a name="l05772"></a>05772     <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l05773"></a>05773     <a class="code" href="../../dc/d28/structuiPopupBlockHandle.html">uiPopupBlockHandle</a> *menu;
<a name="l05774"></a>05774 
<a name="l05775"></a>05775     data = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>;
<a name="l05776"></a>05776     menu = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a>;
<a name="l05777"></a>05777 
<a name="l05778"></a>05778     <span class="comment">/* copy over return values from the closing menu */</span>
<a name="l05779"></a>05779     <span class="keywordflow">if</span> ((menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a0958fdecb4298063870bc8a9b642724a">UI_RETURN_OK</a>) || (menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a535fc859b627f71ab3bc8a767e96a163">UI_RETURN_UPDATE</a>)) {
<a name="l05780"></a>05780         <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../dd/d8b/intern_2opennl_2superlu_2util_8h.html#a4d92d07523ba751afadecd63d3479e30a3e66f07732b51f2cb52e13d598f8abda">COL</a>)
<a name="l05781"></a>05781             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad5491422c06845bd964900a41902055d">vec</a>, menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a0b96cf12a38c5e3174adf617fab7b591">retvec</a>);
<a name="l05782"></a>05782         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad0d059e6a83d21bea4f4db1c9fbd240b">MENU</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#af6ad4ca5cd637c3ab6dad8114b8d3e75">ICONROW</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5975b2d368ff03c7359503587664fba5">ICONTEXTROW</a>))
<a name="l05783"></a>05783             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a7825fbcd327181d90671c650258902c3">value</a> = menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a5f9aa84a54844c9454956bfb988737a7">retvalue</a>;
<a name="l05784"></a>05784     }
<a name="l05785"></a>05785 
<a name="l05786"></a>05786     <span class="keywordflow">if</span> (menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a535fc859b627f71ab3bc8a767e96a163">UI_RETURN_UPDATE</a>) {
<a name="l05787"></a>05787         <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ae0ab7227e9e4ef09a14fa9a47f76f6fc">interactive</a>) <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a87504e0357211849ab7661ff46be2fef">ui_apply_button</a>(C, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a6725c7e00dbc6942369ae5c0d5dd0459">block</a>, but, data, 1);
<a name="l05788"></a>05788         <span class="keywordflow">else</span> <a class="code" href="../../dd/dda/interface_8c.html#a55862ceca84718f3a6d53cf63be86171">ui_check_but</a>(but);
<a name="l05789"></a>05789 
<a name="l05790"></a>05790         menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> = 0;
<a name="l05791"></a>05791     }
<a name="l05792"></a>05792     
<a name="l05793"></a>05793     <span class="comment">/* now change button state or exit, which will close the submenu */</span>
<a name="l05794"></a>05794     <span class="keywordflow">if</span> ((menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a0958fdecb4298063870bc8a9b642724a">UI_RETURN_OK</a>) || (menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#ace0267a120fea587350d10329515e70d">UI_RETURN_CANCEL</a>)) {
<a name="l05795"></a>05795         <span class="keywordflow">if</span> (menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> != <a class="code" href="../../d8/d1e/UI__interface_8h.html#a0958fdecb4298063870bc8a9b642724a">UI_RETURN_OK</a>)
<a name="l05796"></a>05796             data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l05797"></a>05797 
<a name="l05798"></a>05798         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8c09fd77c9a750908dd5fe99a69609bd">button_activate_exit</a>(C, data, but, 1, 0);
<a name="l05799"></a>05799     }
<a name="l05800"></a>05800     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#afc6399179bbacae07a2469215f5c0349">UI_RETURN_OUT</a>) {
<a name="l05801"></a>05801         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a> &amp;&amp; <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a96d54676d1014fb5361f50b5adf8f322">ui_mouse_inside_button</a>(data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a3d373998178fb48f3f39eff95d5c6191">region</a>, but, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>)) {
<a name="l05802"></a>05802             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>);
<a name="l05803"></a>05803         }
<a name="l05804"></a>05804         <span class="keywordflow">else</span> {
<a name="l05805"></a>05805             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d40/wm__event__types_8h.html#a618e1d69514f3de00cba0f0f9a538194">ISKEYBOARD</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>)) {
<a name="l05806"></a>05806                 <span class="comment">/* keyboard menu hierarchy navigation, going back to previous level */</span>
<a name="l05807"></a>05807                 but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#ad4f34bfddee9d298d226604baa1bf4e2">used_mouse</a> = 0;
<a name="l05808"></a>05808                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa1fa37b947ffcfda40d7b81d387cd697">button_activate_state</a>(C, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5a1b225be5d7b33a46c5933df6002d2fd3">BUTTON_STATE_HIGHLIGHT</a>);
<a name="l05809"></a>05809             }
<a name="l05810"></a>05810             <span class="keywordflow">else</span> {
<a name="l05811"></a>05811                 data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a1a3bdad15b38a0374af233ae0657adc3">cancel</a> = 1;
<a name="l05812"></a>05812                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a8c09fd77c9a750908dd5fe99a69609bd">button_activate_exit</a>(C, data, but, 1, 0);
<a name="l05813"></a>05813             }
<a name="l05814"></a>05814         }
<a name="l05815"></a>05815     }
<a name="l05816"></a>05816 }
<a name="l05817"></a>05817 
<a name="l05818"></a>05818 <span class="comment">/* ************************* menu handling *******************************/</span>
<a name="l05819"></a>05819 
<a name="l05820"></a>05820 <span class="comment">/* function used to prevent loosing the open menu when using nested pulldowns,</span>
<a name="l05821"></a>05821 <span class="comment"> * when moving mouse towards the pulldown menu over other buttons that could</span>
<a name="l05822"></a>05822 <span class="comment"> * steal the highlight from the current button, only checks:</span>
<a name="l05823"></a>05823 <span class="comment"> *</span>
<a name="l05824"></a>05824 <span class="comment"> * - while mouse moves in triangular area defined old mouse position and</span>
<a name="l05825"></a>05825 <span class="comment"> *   left/right side of new menu</span>
<a name="l05826"></a>05826 <span class="comment"> * - only for 1 second</span>
<a name="l05827"></a>05827 <span class="comment"> */</span>
<a name="l05828"></a>05828 
<a name="l05829"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6bd61cdbed7f1a010da41e74ecda7467">05829</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6bd61cdbed7f1a010da41e74ecda7467">ui_mouse_motion_towards_init</a>(<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html">uiPopupBlockHandle</a> *menu, <span class="keywordtype">int</span> mx, <span class="keywordtype">int</span> my, <span class="keywordtype">int</span> force)
<a name="l05830"></a>05830 {
<a name="l05831"></a>05831     <span class="keywordflow">if</span> (!menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a2f5dfa8ec27188d54ea7460305e4117a">dotowards</a> || force) {
<a name="l05832"></a>05832         menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a2f5dfa8ec27188d54ea7460305e4117a">dotowards</a> = 1;
<a name="l05833"></a>05833         menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a92f9136cc2c2bbd4b2698b569cc6dd82">towardsx</a> = mx;
<a name="l05834"></a>05834         menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#af00307e392d312d2c873e2405cb91816">towardsy</a> = my;
<a name="l05835"></a>05835 
<a name="l05836"></a>05836         <span class="keywordflow">if</span> (force)
<a name="l05837"></a>05837             menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a66c185cb5b1d23e446101334aa93c8fb">towardstime</a> = <a class="code" href="../../d3/db4/VEC3_8h.html#af78670ee54c1203d613f8fb0e022d214">DBL_MAX</a>;  <span class="comment">/* unlimited time */</span>
<a name="l05838"></a>05838         <span class="keywordflow">else</span>
<a name="l05839"></a>05839             menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a66c185cb5b1d23e446101334aa93c8fb">towardstime</a> = <a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>();
<a name="l05840"></a>05840     }
<a name="l05841"></a>05841 }
<a name="l05842"></a>05842 
<a name="l05843"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad65d33be8204418cd898c216274aa6ce">05843</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad65d33be8204418cd898c216274aa6ce">ui_mouse_motion_towards_check</a>(<a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <a class="code" href="../../dc/d28/structuiPopupBlockHandle.html">uiPopupBlockHandle</a> *menu, <span class="keywordtype">int</span> mx, <span class="keywordtype">int</span> my)
<a name="l05844"></a>05844 {
<a name="l05845"></a>05845     <span class="keywordtype">float</span> p1[2], p2[2], p3[2], p4[2], oldp[2], newp[2];
<a name="l05846"></a>05846     <span class="keywordtype">int</span> closer;
<a name="l05847"></a>05847 
<a name="l05848"></a>05848     <span class="keywordflow">if</span> (!menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a2f5dfa8ec27188d54ea7460305e4117a">dotowards</a>) <span class="keywordflow">return</span> 0;
<a name="l05849"></a>05849 
<a name="l05850"></a>05850     <span class="comment">/* verify that we are moving towards one of the edges of the</span>
<a name="l05851"></a>05851 <span class="comment">     * menu block, in other words, in the triangle formed by the</span>
<a name="l05852"></a>05852 <span class="comment">     * initial mouse location and two edge points. */</span>
<a name="l05853"></a>05853     p1[0] = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#aff4f04b1fe47fbc5e8c99baaa7714454">minx</a> - 20;
<a name="l05854"></a>05854     p1[1] = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a8c1f31a6c10605079edbf9efbd3920f3">miny</a> - 20;
<a name="l05855"></a>05855 
<a name="l05856"></a>05856     p2[0] = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a55ab0ddb306b70d5e5479aef2b8c3a2e">maxx</a> + 20;
<a name="l05857"></a>05857     p2[1] = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a8c1f31a6c10605079edbf9efbd3920f3">miny</a> - 20;
<a name="l05858"></a>05858     
<a name="l05859"></a>05859     p3[0] = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a55ab0ddb306b70d5e5479aef2b8c3a2e">maxx</a> + 20;
<a name="l05860"></a>05860     p3[1] = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#ae7c47f5582dff9e5cdcb94b59f42dba6">maxy</a> + 20;
<a name="l05861"></a>05861 
<a name="l05862"></a>05862     p4[0] = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#aff4f04b1fe47fbc5e8c99baaa7714454">minx</a> - 20;
<a name="l05863"></a>05863     p4[1] = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#ae7c47f5582dff9e5cdcb94b59f42dba6">maxy</a> + 20;
<a name="l05864"></a>05864 
<a name="l05865"></a>05865     oldp[0] = menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a92f9136cc2c2bbd4b2698b569cc6dd82">towardsx</a>;
<a name="l05866"></a>05866     oldp[1] = menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#af00307e392d312d2c873e2405cb91816">towardsy</a>;
<a name="l05867"></a>05867 
<a name="l05868"></a>05868     newp[0] = mx;
<a name="l05869"></a>05869     newp[1] = my;
<a name="l05870"></a>05870 
<a name="l05871"></a>05871     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ad64ff54d1edbd568345377c3d4660b78">len_v2v2</a>(oldp, newp) &lt; 4.0f)
<a name="l05872"></a>05872         <span class="keywordflow">return</span> menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a2f5dfa8ec27188d54ea7460305e4117a">dotowards</a>;
<a name="l05873"></a>05873 
<a name="l05874"></a>05874     closer = 0;
<a name="l05875"></a>05875     closer |= <a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#a9b9ad82d53315636d1e97cc4355e93c4">isect_point_tri_v2</a>(newp, oldp, p1, p2);
<a name="l05876"></a>05876     closer |= <a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#a9b9ad82d53315636d1e97cc4355e93c4">isect_point_tri_v2</a>(newp, oldp, p2, p3);
<a name="l05877"></a>05877     closer |= <a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#a9b9ad82d53315636d1e97cc4355e93c4">isect_point_tri_v2</a>(newp, oldp, p3, p4);
<a name="l05878"></a>05878     closer |= <a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#a9b9ad82d53315636d1e97cc4355e93c4">isect_point_tri_v2</a>(newp, oldp, p4, p1);
<a name="l05879"></a>05879 
<a name="l05880"></a>05880     <span class="keywordflow">if</span> (!closer)
<a name="l05881"></a>05881         menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a2f5dfa8ec27188d54ea7460305e4117a">dotowards</a> = 0;
<a name="l05882"></a>05882 
<a name="l05883"></a>05883     <span class="comment">/* 1 second timer */</span>
<a name="l05884"></a>05884     <span class="keywordflow">if</span> (<a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>() - menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a66c185cb5b1d23e446101334aa93c8fb">towardstime</a> &gt; <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a216cc8119d55ad21cd94017a9415203a">BUTTON_MOUSE_TOWARDS_THRESH</a>)
<a name="l05885"></a>05885         menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a2f5dfa8ec27188d54ea7460305e4117a">dotowards</a> = 0;
<a name="l05886"></a>05886 
<a name="l05887"></a>05887     <span class="keywordflow">return</span> menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a2f5dfa8ec27188d54ea7460305e4117a">dotowards</a>;
<a name="l05888"></a>05888 }
<a name="l05889"></a>05889 
<a name="l05890"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a12eae7310abdaad77f2092ba0024092e">05890</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a12eae7310abdaad77f2092ba0024092e">ui_menu_scroll_test</a>(<a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <span class="keywordtype">int</span> my)
<a name="l05891"></a>05891 {
<a name="l05892"></a>05892     <span class="keywordflow">if</span> (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a98c4c059c6ae512763c370fcedb1b744">flag</a> &amp; (<a class="code" href="../../d8/d1e/UI__interface_8h.html#ac8c08101573b32bdda8b56009657e4dd">UI_BLOCK_CLIPTOP</a> | <a class="code" href="../../d8/d1e/UI__interface_8h.html#ae5937b9eedcee9430db7e03ef89a4167">UI_BLOCK_CLIPBOTTOM</a>)) {
<a name="l05893"></a>05893         <span class="keywordflow">if</span> (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a98c4c059c6ae512763c370fcedb1b744">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#ac8c08101573b32bdda8b56009657e4dd">UI_BLOCK_CLIPTOP</a>) 
<a name="l05894"></a>05894             <span class="keywordflow">if</span> (my &gt; block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#ae7c47f5582dff9e5cdcb94b59f42dba6">maxy</a> - 14)
<a name="l05895"></a>05895                 <span class="keywordflow">return</span> <span class="charliteral">&#39;t&#39;</span>;
<a name="l05896"></a>05896         <span class="keywordflow">if</span> (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a98c4c059c6ae512763c370fcedb1b744">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#ae5937b9eedcee9430db7e03ef89a4167">UI_BLOCK_CLIPBOTTOM</a>)
<a name="l05897"></a>05897             <span class="keywordflow">if</span> (my &lt; block-&gt;miny + 14)
<a name="l05898"></a>05898                 <span class="keywordflow">return</span> <span class="charliteral">&#39;b&#39;</span>;
<a name="l05899"></a>05899     }
<a name="l05900"></a>05900     <span class="keywordflow">return</span> 0;
<a name="l05901"></a>05901 }
<a name="l05902"></a>05902 
<a name="l05903"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae04b6f7b16388e54944082743203e9e3">05903</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae04b6f7b16388e54944082743203e9e3">ui_menu_scroll</a>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block, <span class="keywordtype">int</span> my)
<a name="l05904"></a>05904 {
<a name="l05905"></a>05905     <span class="keywordtype">char</span> test = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a12eae7310abdaad77f2092ba0024092e">ui_menu_scroll_test</a>(block, my);
<a name="l05906"></a>05906     
<a name="l05907"></a>05907     <span class="keywordflow">if</span> (test) {
<a name="l05908"></a>05908         <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *b1 = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a844299999568743bc189fcb02847e9e6">buttons</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05909"></a>05909         <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *b2 = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a844299999568743bc189fcb02847e9e6">buttons</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>;
<a name="l05910"></a>05910         <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *bnext;
<a name="l05911"></a>05911         <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *bprev;
<a name="l05912"></a>05912         <span class="keywordtype">int</span> dy = 0;
<a name="l05913"></a>05913         
<a name="l05914"></a>05914         <span class="comment">/* get first and last visible buttons */</span>
<a name="l05915"></a>05915         <span class="keywordflow">while</span> (b1 &amp;&amp; <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae3d5df2bbc40362976c46ebdfacd6d86">ui_but_next</a>(b1) &amp;&amp; (b1-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d1/d2f/interface__intern_8h.html#ad9ecb519941dbb5eee2a1bfb444e041d">UI_SCROLLED</a>))
<a name="l05916"></a>05916             b1 = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae3d5df2bbc40362976c46ebdfacd6d86">ui_but_next</a>(b1);
<a name="l05917"></a>05917         <span class="keywordflow">while</span> (b2 &amp;&amp; <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a02dd6ae76735b285fb6405403acc30eb">ui_but_prev</a>(b2) &amp;&amp; (b2-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp; <a class="code" href="../../d1/d2f/interface__intern_8h.html#ad9ecb519941dbb5eee2a1bfb444e041d">UI_SCROLLED</a>))
<a name="l05918"></a>05918             b2 = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a02dd6ae76735b285fb6405403acc30eb">ui_but_prev</a>(b2);
<a name="l05919"></a>05919         <span class="comment">/* skips separators */</span>
<a name="l05920"></a>05920         bnext = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae3d5df2bbc40362976c46ebdfacd6d86">ui_but_next</a>(b1);
<a name="l05921"></a>05921         bprev = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a02dd6ae76735b285fb6405403acc30eb">ui_but_prev</a>(b2);
<a name="l05922"></a>05922         
<a name="l05923"></a>05923         <span class="keywordflow">if</span> (bnext == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || bprev == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05924"></a>05924             <span class="keywordflow">return</span> 0;
<a name="l05925"></a>05925         
<a name="l05926"></a>05926         <span class="keywordflow">if</span> (test == <span class="charliteral">&#39;t&#39;</span>) {
<a name="l05927"></a>05927             <span class="comment">/* bottom button is first button */</span>
<a name="l05928"></a>05928             <span class="keywordflow">if</span> (b1-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a> &lt; b2-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>)
<a name="l05929"></a>05929                 dy = bnext-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a> - b1-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>;
<a name="l05930"></a>05930             <span class="comment">/* bottom button is last button */</span>
<a name="l05931"></a>05931             <span class="keywordflow">else</span> 
<a name="l05932"></a>05932                 dy = bprev-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a> - b2-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>;
<a name="l05933"></a>05933         }
<a name="l05934"></a>05934         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (test == <span class="charliteral">&#39;b&#39;</span>) {
<a name="l05935"></a>05935             <span class="comment">/* bottom button is first button */</span>
<a name="l05936"></a>05936             <span class="keywordflow">if</span> (b1-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a> &lt; b2-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>)
<a name="l05937"></a>05937                 dy = b1-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a> - bnext-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>;
<a name="l05938"></a>05938             <span class="comment">/* bottom button is last button */</span>
<a name="l05939"></a>05939             <span class="keywordflow">else</span> 
<a name="l05940"></a>05940                 dy = b2-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a> - bprev-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a>;
<a name="l05941"></a>05941         }
<a name="l05942"></a>05942         <span class="keywordflow">if</span> (dy) {
<a name="l05943"></a>05943             
<a name="l05944"></a>05944             <span class="keywordflow">for</span> (b1 = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a844299999568743bc189fcb02847e9e6">buttons</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; b1; b1 = b1-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>) {
<a name="l05945"></a>05945                 b1-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aa9c15c50bb10c1b30074eb2f38e2fe35">y1</a> -= dy;
<a name="l05946"></a>05946                 b1-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#abbb172bca1cfaa5d7538af548f1a1666">y2</a> -= dy;
<a name="l05947"></a>05947             }
<a name="l05948"></a>05948             <span class="comment">/* set flags again */</span>
<a name="l05949"></a>05949             <a class="code" href="../../d1/d2f/interface__intern_8h.html#aede80db29520d32ac8a761b8c7634e3e">ui_popup_block_scrolltest</a>(block);
<a name="l05950"></a>05950             
<a name="l05951"></a>05951             <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(ar);
<a name="l05952"></a>05952             
<a name="l05953"></a>05953             <span class="keywordflow">return</span> 1;
<a name="l05954"></a>05954         }
<a name="l05955"></a>05955     }
<a name="l05956"></a>05956     
<a name="l05957"></a>05957     <span class="keywordflow">return</span> 0;
<a name="l05958"></a>05958 }
<a name="l05959"></a>05959 
<a name="l05960"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad8f88f5b3fb640f3e743c7cbf5639ec5">05960</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad8f88f5b3fb640f3e743c7cbf5639ec5">ui_handle_menu_event</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <a class="code" href="../../dc/d28/structuiPopupBlockHandle.html">uiPopupBlockHandle</a> *menu, <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(topmenu))
<a name="l05961"></a>05961 {
<a name="l05962"></a>05962     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l05963"></a>05963     <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block;
<a name="l05964"></a>05964     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but, *bt;
<a name="l05965"></a>05965     <span class="keywordtype">int</span> inside, act, count, mx, my, <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a>;
<a name="l05966"></a>05966 
<a name="l05967"></a>05967     ar = menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a1ff0c66125f1330b1f99b461093bc10c">region</a>;
<a name="l05968"></a>05968     block = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#afbd94c7a138066b4e773e9d3401b0d87">uiblocks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05969"></a>05969     
<a name="l05970"></a>05970     act = 0;
<a name="l05971"></a>05971     retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l05972"></a>05972 
<a name="l05973"></a>05973     mx = <span class="keyword">event</span>-&gt;x;
<a name="l05974"></a>05974     my = <span class="keyword">event</span>-&gt;y;
<a name="l05975"></a>05975     <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(ar, block, &amp;mx, &amp;my);
<a name="l05976"></a>05976 
<a name="l05977"></a>05977     <span class="comment">/* check if mouse is inside block */</span>
<a name="l05978"></a>05978     inside = 0;
<a name="l05979"></a>05979     <span class="keywordflow">if</span> (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#aff4f04b1fe47fbc5e8c99baaa7714454">minx</a> &lt;= mx &amp;&amp; block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a55ab0ddb306b70d5e5479aef2b8c3a2e">maxx</a> &gt;= mx)
<a name="l05980"></a>05980         <span class="keywordflow">if</span> (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a8c1f31a6c10605079edbf9efbd3920f3">miny</a> &lt;= my &amp;&amp; block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#ae7c47f5582dff9e5cdcb94b59f42dba6">maxy</a> &gt;= my)
<a name="l05981"></a>05981             inside = 1;
<a name="l05982"></a>05982 
<a name="l05983"></a>05983     <span class="comment">/* if there&#39;s an active modal button, don&#39;t check events or outside, except for search menu */</span>
<a name="l05984"></a>05984     but = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9e4f3ee0f30a82b8d2c4865d80b11a75">ui_but_find_activated</a>(ar);
<a name="l05985"></a>05985     <span class="keywordflow">if</span> (but &amp;&amp; <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a7fa3d84e94a2cfc8f26df61b2eccce90">button_modal_state</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a>) &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> != <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3a2c1c38a5465f6d46a2296e3ad09bbe">SEARCH_MENU</a>) {
<a name="l05986"></a>05986         <span class="comment">/* if a button is activated modal, always reset the start mouse</span>
<a name="l05987"></a>05987 <span class="comment">         * position of the towards mechanism to avoid loosing focus,</span>
<a name="l05988"></a>05988 <span class="comment">         * and don&#39;t handle events */</span>
<a name="l05989"></a>05989         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6bd61cdbed7f1a010da41e74ecda7467">ui_mouse_motion_towards_init</a>(menu, mx, my, 1);
<a name="l05990"></a>05990     }
<a name="l05991"></a>05991     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a599217205dc3092c26567a2bd868ef3a">TIMER</a>) {
<a name="l05992"></a>05992         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a> == menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a448c067b074d1a4bf6a70da43695ce38">scrolltimer</a>)
<a name="l05993"></a>05993             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae04b6f7b16388e54944082743203e9e3">ui_menu_scroll</a>(ar, block, my);
<a name="l05994"></a>05994     }
<a name="l05995"></a>05995     <span class="keywordflow">else</span> {
<a name="l05996"></a>05996         <span class="comment">/* for ui_mouse_motion_towards_block */</span>
<a name="l05997"></a>05997         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>) {
<a name="l05998"></a>05998             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6bd61cdbed7f1a010da41e74ecda7467">ui_mouse_motion_towards_init</a>(menu, mx, my, 0);
<a name="l05999"></a>05999             
<a name="l06000"></a>06000             <span class="comment">/* add menu scroll timer, if needed */</span>
<a name="l06001"></a>06001             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a12eae7310abdaad77f2092ba0024092e">ui_menu_scroll_test</a>(block, my))
<a name="l06002"></a>06002                 <span class="keywordflow">if</span> (menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a448c067b074d1a4bf6a70da43695ce38">scrolltimer</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l06003"></a>06003                     menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a448c067b074d1a4bf6a70da43695ce38">scrolltimer</a> =
<a name="l06004"></a>06004                         <a class="code" href="../../d7/d6e/wm__window_8c.html#af5bdd7109c7ea81c77a89d9f41585f3a">WM_event_add_timer</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C), <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C), <a class="code" href="../../d1/d40/wm__event__types_8h.html#a599217205dc3092c26567a2bd868ef3a">TIMER</a>, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a92cacfa34d1c9928890b246f8bc9dafb">MENU_SCROLL_INTERVAL</a>);
<a name="l06005"></a>06005         }
<a name="l06006"></a>06006         
<a name="l06007"></a>06007         <span class="comment">/* first block own event func */</span>
<a name="l06008"></a>06008         <span class="keywordflow">if</span> (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a9fb59593a53b115f6ec8ccb7819369b6">block_event_func</a> &amp;&amp; block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a9fb59593a53b115f6ec8ccb7819369b6">block_event_func</a>(C, block, event)) ;
<a name="l06009"></a>06009         <span class="comment">/* events not for active search menu button */</span>
<a name="l06010"></a>06010         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> != <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3a2c1c38a5465f6d46a2296e3ad09bbe">SEARCH_MENU</a>) {
<a name="l06011"></a>06011             <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l06012"></a>06012                 <span class="comment">/* closing sublevels of pulldowns */</span>
<a name="l06013"></a>06013                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a10c4c00065059a135492a87a229162af">LEFTARROWKEY</a>:
<a name="l06014"></a>06014                     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a> &amp;&amp; (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a98c4c059c6ae512763c370fcedb1b744">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a85cfd29a5959ab2b2fcc578bcbe6ef3c">UI_BLOCK_LOOP</a>))
<a name="l06015"></a>06015                         <span class="keywordflow">if</span> (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a496e412400953c51f51715972b58dc7c">saferct</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)
<a name="l06016"></a>06016                             menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> = <a class="code" href="../../d8/d1e/UI__interface_8h.html#afc6399179bbacae07a2469215f5c0349">UI_RETURN_OUT</a>;
<a name="l06017"></a>06017 
<a name="l06018"></a>06018                     retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l06019"></a>06019                     <span class="keywordflow">break</span>;
<a name="l06020"></a>06020 
<a name="l06021"></a>06021                 <span class="comment">/* opening sublevels of pulldowns */</span>
<a name="l06022"></a>06022                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a00226d1726c5da69413ce5e368332f0f">RIGHTARROWKEY</a>: 
<a name="l06023"></a>06023                     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a> &amp;&amp; (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a98c4c059c6ae512763c370fcedb1b744">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a85cfd29a5959ab2b2fcc578bcbe6ef3c">UI_BLOCK_LOOP</a>)) {
<a name="l06024"></a>06024                         but = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9e4f3ee0f30a82b8d2c4865d80b11a75">ui_but_find_activated</a>(ar);
<a name="l06025"></a>06025 
<a name="l06026"></a>06026                         <span class="keywordflow">if</span> (!but) {
<a name="l06027"></a>06027                             <span class="comment">/* no item active, we make first active */</span>
<a name="l06028"></a>06028                             <span class="keywordflow">if</span> (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#ad35dd5608c909b19f47a6fdb260ec2dc">direction</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#af3791d3791211de03880d6591735f7fc">UI_TOP</a>) but = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a969c3f614ac1c0816076b8a84c8d5347">ui_but_last</a>(block);
<a name="l06029"></a>06029                             <span class="keywordflow">else</span> but = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa6fe202ff1581edf19c97eabbc7d4dc6">ui_but_first</a>(block);
<a name="l06030"></a>06030                         }
<a name="l06031"></a>06031 
<a name="l06032"></a>06032                         <span class="keywordflow">if</span> (but &amp;&amp; <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a52220397ecea855b3a99746e451426e1">BLOCK</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a917e2674b6708b555abe909f360b12e1">PULLDOWN</a>))
<a name="l06033"></a>06033                             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab4089d3f2a01002abbea3eadec7a650b">ui_handle_button_activate</a>(C, ar, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0ba96a20f1754faaa0c4d3f914a2906d44d">BUTTON_ACTIVATE_OPEN</a>);
<a name="l06034"></a>06034                     }
<a name="l06035"></a>06035 
<a name="l06036"></a>06036                     retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l06037"></a>06037                     <span class="keywordflow">break</span>;
<a name="l06038"></a>06038                 
<a name="l06039"></a>06039                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#afc161d5211a7975b71b2d478f936ad85">UPARROWKEY</a>:
<a name="l06040"></a>06040                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab85e7d9e3424f69f61d277f3aa68bff8">DOWNARROWKEY</a>:
<a name="l06041"></a>06041                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>:
<a name="l06042"></a>06042                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>:
<a name="l06043"></a>06043                     <span class="comment">/* arrowkeys: only handle for block_loop blocks */</span>
<a name="l06044"></a>06044                     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a> || event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a> || event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a> || event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7dc2b3fa9f4563111cb1a461a1117192">oskey</a>) ;
<a name="l06045"></a>06045                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inside || (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a98c4c059c6ae512763c370fcedb1b744">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a85cfd29a5959ab2b2fcc578bcbe6ef3c">UI_BLOCK_LOOP</a>)) {
<a name="l06046"></a>06046                         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l06047"></a>06047                             but = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9e4f3ee0f30a82b8d2c4865d80b11a75">ui_but_find_activated</a>(ar);
<a name="l06048"></a>06048                             <span class="keywordflow">if</span> (but) {
<a name="l06049"></a>06049                                 <span class="comment">/* is there a situation where UI_LEFT or UI_RIGHT would also change navigation direction? */</span>
<a name="l06050"></a>06050                                 <span class="keywordflow">if</span> (((<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab85e7d9e3424f69f61d277f3aa68bff8">DOWNARROWKEY</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>)) &amp;&amp; (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#ad35dd5608c909b19f47a6fdb260ec2dc">direction</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#af8fb6027b0166761cb524a88fa0a7231">UI_DOWN</a>)) ||
<a name="l06051"></a>06051                                     ((<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab85e7d9e3424f69f61d277f3aa68bff8">DOWNARROWKEY</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>)) &amp;&amp; (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#ad35dd5608c909b19f47a6fdb260ec2dc">direction</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8350d6c621c09b1989b60d24369844f9">UI_RIGHT</a>)) ||
<a name="l06052"></a>06052                                     ((<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#afc161d5211a7975b71b2d478f936ad85">UPARROWKEY</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>)) &amp;&amp; (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#ad35dd5608c909b19f47a6fdb260ec2dc">direction</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#af3791d3791211de03880d6591735f7fc">UI_TOP</a>)))
<a name="l06053"></a>06053                                 {
<a name="l06054"></a>06054                                     <span class="comment">/* the following is just a hack - uiBut-&gt;type set to BUT and BUTM have there menus built </span>
<a name="l06055"></a>06055 <span class="comment">                                     * opposite ways - this should be changed so that all popup-menus use the same uiBlock-&gt;direction */</span>
<a name="l06056"></a>06056                                     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a02c336ab5ee16270de92af2f3f2cb5eb">BUT</a>)
<a name="l06057"></a>06057                                         but = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae3d5df2bbc40362976c46ebdfacd6d86">ui_but_next</a>(but);
<a name="l06058"></a>06058                                     <span class="keywordflow">else</span>
<a name="l06059"></a>06059                                         but = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a02dd6ae76735b285fb6405403acc30eb">ui_but_prev</a>(but);
<a name="l06060"></a>06060                                 }
<a name="l06061"></a>06061                                 <span class="keywordflow">else</span> {
<a name="l06062"></a>06062                                     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a02c336ab5ee16270de92af2f3f2cb5eb">BUT</a>)
<a name="l06063"></a>06063                                         but = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a02dd6ae76735b285fb6405403acc30eb">ui_but_prev</a>(but);
<a name="l06064"></a>06064                                     <span class="keywordflow">else</span>
<a name="l06065"></a>06065                                         but = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae3d5df2bbc40362976c46ebdfacd6d86">ui_but_next</a>(but);
<a name="l06066"></a>06066                                 }
<a name="l06067"></a>06067 
<a name="l06068"></a>06068                                 <span class="keywordflow">if</span> (but)
<a name="l06069"></a>06069                                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab4089d3f2a01002abbea3eadec7a650b">ui_handle_button_activate</a>(C, ar, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0bab111808df840be3c6692f0dc072933c7">BUTTON_ACTIVATE</a>);
<a name="l06070"></a>06070                             }
<a name="l06071"></a>06071 
<a name="l06072"></a>06072                             <span class="keywordflow">if</span> (!but) {
<a name="l06073"></a>06073                                 <span class="keywordflow">if</span> (((<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#afc161d5211a7975b71b2d478f936ad85">UPARROWKEY</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>)) &amp;&amp; (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#ad35dd5608c909b19f47a6fdb260ec2dc">direction</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#af8fb6027b0166761cb524a88fa0a7231">UI_DOWN</a>)) ||
<a name="l06074"></a>06074                                     ((<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#afc161d5211a7975b71b2d478f936ad85">UPARROWKEY</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>)) &amp;&amp; (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#ad35dd5608c909b19f47a6fdb260ec2dc">direction</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8350d6c621c09b1989b60d24369844f9">UI_RIGHT</a>)) ||
<a name="l06075"></a>06075                                     ((<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab85e7d9e3424f69f61d277f3aa68bff8">DOWNARROWKEY</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>)) &amp;&amp; (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#ad35dd5608c909b19f47a6fdb260ec2dc">direction</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#af3791d3791211de03880d6591735f7fc">UI_TOP</a>)))
<a name="l06076"></a>06076                                 {
<a name="l06077"></a>06077                                     <span class="keywordflow">if</span> ((bt = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa6fe202ff1581edf19c97eabbc7d4dc6">ui_but_first</a>(block)) &amp;&amp; (bt-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a02c336ab5ee16270de92af2f3f2cb5eb">BUT</a>)) {
<a name="l06078"></a>06078                                         bt = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a969c3f614ac1c0816076b8a84c8d5347">ui_but_last</a>(block);
<a name="l06079"></a>06079                                     }
<a name="l06080"></a>06080                                     <span class="keywordflow">else</span> {
<a name="l06081"></a>06081                                         <span class="comment">/* keep ui_but_first() */</span>
<a name="l06082"></a>06082                                     }
<a name="l06083"></a>06083                                 }
<a name="l06084"></a>06084                                 <span class="keywordflow">else</span> {
<a name="l06085"></a>06085                                     <span class="keywordflow">if</span> ((bt = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa6fe202ff1581edf19c97eabbc7d4dc6">ui_but_first</a>(block)) &amp;&amp; (bt-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a02c336ab5ee16270de92af2f3f2cb5eb">BUT</a>)) {
<a name="l06086"></a>06086                                         <span class="comment">/* keep ui_but_first() */</span>
<a name="l06087"></a>06087                                     }
<a name="l06088"></a>06088                                     <span class="keywordflow">else</span> {
<a name="l06089"></a>06089                                         bt = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a969c3f614ac1c0816076b8a84c8d5347">ui_but_last</a>(block);
<a name="l06090"></a>06090                                     }
<a name="l06091"></a>06091                                 }
<a name="l06092"></a>06092 
<a name="l06093"></a>06093                                 <span class="keywordflow">if</span> (bt)
<a name="l06094"></a>06094                                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab4089d3f2a01002abbea3eadec7a650b">ui_handle_button_activate</a>(C, ar, bt, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0bab111808df840be3c6692f0dc072933c7">BUTTON_ACTIVATE</a>);
<a name="l06095"></a>06095                             }
<a name="l06096"></a>06096                         }
<a name="l06097"></a>06097 
<a name="l06098"></a>06098                         retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l06099"></a>06099                     }
<a name="l06100"></a>06100 
<a name="l06101"></a>06101                     <span class="keywordflow">break</span>;
<a name="l06102"></a>06102 
<a name="l06103"></a>06103                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab9fb6b3cb0a4d451b63de95c43f0c71c">ONEKEY</a>:    <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a01d2fb85e309555aba53cd538c19e8f6">PAD1</a>:
<a name="l06104"></a>06104                     act = 1;
<a name="l06105"></a>06105                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a514ead02a18560423d79e5c1e8cdea52">TWOKEY</a>:    <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a99e5b4d67a9e666386ddf2101b962d6f">PAD2</a>:
<a name="l06106"></a>06106                     <span class="keywordflow">if</span> (act == 0) act = 2;
<a name="l06107"></a>06107                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#afc29e796f859c8e645a294b10c7fe2cb">THREEKEY</a>:  <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ad219dd30c4b1c517b3ded1a3da26018f">PAD3</a>:
<a name="l06108"></a>06108                     <span class="keywordflow">if</span> (act == 0) act = 3;
<a name="l06109"></a>06109                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a3d15f5dababa2ad8fb0c2a744e0c5207">FOURKEY</a>:   <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a59adfc10114409298d29e8a34f9420aa">PAD4</a>:
<a name="l06110"></a>06110                     <span class="keywordflow">if</span> (act == 0) act = 4;
<a name="l06111"></a>06111                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6d42a1643aaa139744c0a9a164622fd2">FIVEKEY</a>:   <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab1c311ab4886ead1cae73e276ee76371">PAD5</a>:
<a name="l06112"></a>06112                     <span class="keywordflow">if</span> (act == 0) act = 5;
<a name="l06113"></a>06113                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab710951e04d672ce9f23292a4d55126b">SIXKEY</a>:    <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2b9bf38285d3ef4cc630ba4b1ed1d41c">PAD6</a>:
<a name="l06114"></a>06114                     <span class="keywordflow">if</span> (act == 0) act = 6;
<a name="l06115"></a>06115                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a9e76fe8ee785f01500ad44394cd6e66e">SEVENKEY</a>:  <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a1cb7f7860cae61be1831169aa1d8ba06">PAD7</a>:
<a name="l06116"></a>06116                     <span class="keywordflow">if</span> (act == 0) act = 7;
<a name="l06117"></a>06117                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a27ea2a95deee54dc8c7ce9f9db4b2387">EIGHTKEY</a>:  <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#abbff1efb9138f1ccbe1f01fd17b912d8">PAD8</a>:
<a name="l06118"></a>06118                     <span class="keywordflow">if</span> (act == 0) act = 8;
<a name="l06119"></a>06119                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a06009c2bd60552b82b76d219409ba513">NINEKEY</a>:   <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a4c06e7c1830872541a40dc04cdd2b589">PAD9</a>:
<a name="l06120"></a>06120                     <span class="keywordflow">if</span> (act == 0) act = 9;
<a name="l06121"></a>06121                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a18fef1c6c42114045de29186f96e1878">ZEROKEY</a>:   <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a04cfc47c84309660da78fc8a479679c3">PAD0</a>:
<a name="l06122"></a>06122                     <span class="keywordflow">if</span> (act == 0) act = 10;
<a name="l06123"></a>06123 
<a name="l06124"></a>06124                     <span class="keywordflow">if</span> ((block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a98c4c059c6ae512763c370fcedb1b744">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#aedf1208b618d74822da46d6d8f878928">UI_BLOCK_NUMSELECT</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l06125"></a>06125                         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a>) act += 10;
<a name="l06126"></a>06126 
<a name="l06127"></a>06127                         count = 0;
<a name="l06128"></a>06128                         <span class="keywordflow">for</span> (but = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a844299999568743bc189fcb02847e9e6">buttons</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; but; but = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>) {
<a name="l06129"></a>06129                             <span class="keywordtype">int</span> doit = 0;
<a name="l06130"></a>06130                             
<a name="l06131"></a>06131                             <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> != <a class="code" href="../../d9/dc4/plugin_8h.html#a0b7df70d4a086a227bc482b07e2bbbca">LABEL</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> != <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad19009702facf6995a6aa5dbdf1c871a">SEPR</a>)
<a name="l06132"></a>06132                                 count++;
<a name="l06133"></a>06133                             
<a name="l06134"></a>06134                             <span class="comment">/* exception for rna layer buts */</span>
<a name="l06135"></a>06135                             <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#afd86c402bb3c4c40bac45a5023b09128">rnapoin</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a> &amp;&amp; but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>) {
<a name="l06136"></a>06136                                 <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(<a class="code" href="../../d3/d10/rna__access_8c.html#ac2188d2835e07f6dd15491f6764cae78">RNA_property_subtype</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#aee4d22f7078e1b1ed74fee4e0e97c621">rnaprop</a>), <a class="code" href="../../de/d7e/RNA__types_8h.html#afc8d3af46d7ce49bb3e75305354fd9bcabf01b70f8337c0f7df1349bbaf378641">PROP_LAYER</a>, <a class="code" href="../../de/d7e/RNA__types_8h.html#afc8d3af46d7ce49bb3e75305354fd9bca344a69a24cf037e369419b7b86dc38cf">PROP_LAYER_MEMBER</a>)) {
<a name="l06137"></a>06137                                     <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#ac7a245d1d0ad932e448f7c0ad9ef2ea2">rnaindex</a> == act - 1)
<a name="l06138"></a>06138                                         doit = 1;
<a name="l06139"></a>06139                                 }
<a name="l06140"></a>06140                             }
<a name="l06141"></a>06141                             <span class="comment">/* exception for menus like layer buts, with button aligning they&#39;re not drawn in order */</span>
<a name="l06142"></a>06142                             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a59cc7c2157b515ed2c780bb6f7b44e27">TOGR</a>) {
<a name="l06143"></a>06143                                 <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a7a4f7157b860db64cc0c798f2dc7e670">bitnr</a> == act - 1)
<a name="l06144"></a>06144                                     doit = 1;
<a name="l06145"></a>06145                             }
<a name="l06146"></a>06146                             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (count == act)
<a name="l06147"></a>06147                                 doit = 1;
<a name="l06148"></a>06148                             
<a name="l06149"></a>06149                             <span class="keywordflow">if</span> (doit) {
<a name="l06150"></a>06150                                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab4089d3f2a01002abbea3eadec7a650b">ui_handle_button_activate</a>(C, ar, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0ba83e55158cfac680f1af68501dc6219c6">BUTTON_ACTIVATE_APPLY</a>);
<a name="l06151"></a>06151                                 <span class="keywordflow">break</span>;
<a name="l06152"></a>06152                             }
<a name="l06153"></a>06153                         }
<a name="l06154"></a>06154 
<a name="l06155"></a>06155                         retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l06156"></a>06156                     }
<a name="l06157"></a>06157                     <span class="keywordflow">break</span>;
<a name="l06158"></a>06158 
<a name="l06159"></a>06159                 <span class="comment">/* Handle keystrokes on menu items */</span>
<a name="l06160"></a>06160                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a746a67a50a93dd2cac52c218ef94a218">AKEY</a>:
<a name="l06161"></a>06161                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a3ec89d7b25cbb572b2e11b10ad8bc196">BKEY</a>:
<a name="l06162"></a>06162                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a39f146afd78004fead59358c29028292">CKEY</a>:
<a name="l06163"></a>06163                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae108a0974a5073bf40514974c1e98028">DKEY</a>:
<a name="l06164"></a>06164                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab47f5c869dbeec85e5e133760db3e0d5">EKEY</a>:
<a name="l06165"></a>06165                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae7b7db7df7852dd2feedcbf061c6d609">FKEY</a>:
<a name="l06166"></a>06166                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ac4133479f03eb38f20b64e5a1d73ab0a">GKEY</a>:
<a name="l06167"></a>06167                 <span class="keywordflow">case</span> <a class="code" href="../../d9/ded/BLI__winstuff_8h.html#a5af76a936eef07cada7df669d90f3341">HKEY</a>:
<a name="l06168"></a>06168                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a8266bf9b4373825723254f4a186d3de6">IKEY</a>:
<a name="l06169"></a>06169                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a4d89b13f4c91c0fe71ea0e63c6f2c0b1">JKEY</a>:
<a name="l06170"></a>06170                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a08bc6a3adcfad743bcba777bfc5cb5ce">KKEY</a>:
<a name="l06171"></a>06171                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ab5e73c4a2145fa76f94d5cf763e2fc98">LKEY</a>:
<a name="l06172"></a>06172                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a4fd9ef5328e6ef038f4fcc6539405682">MKEY</a>:
<a name="l06173"></a>06173                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#adee45143f45097e633561db657024e66">NKEY</a>:
<a name="l06174"></a>06174                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ac20849472da73fdbe2fea6acca2b70da">OKEY</a>:
<a name="l06175"></a>06175                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a32a9e2b523ec8abcb158c4628f6d0d48">PKEY</a>:
<a name="l06176"></a>06176                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a4a864432ec0fec9609cedc8ee4c83f8d">QKEY</a>:
<a name="l06177"></a>06177                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a9fb42765696ec2a77dff4bc1267864c3">RKEY</a>:
<a name="l06178"></a>06178                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a32a2e419731c7ff93211038f83bb4acc">SKEY</a>:
<a name="l06179"></a>06179                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#af4a805cf5874fafa2a0bd8f959fad04e">TKEY</a>:
<a name="l06180"></a>06180                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a7d136ae22613ef0df2eef2eaec226fda">UKEY</a>:
<a name="l06181"></a>06181                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a8691f4871880a2b71eef19973c0664e1">VKEY</a>:
<a name="l06182"></a>06182                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a72b673275d904736b31f62f6c294c1eb">WKEY</a>:
<a name="l06183"></a>06183                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a16a045703cd7faafcbab3abe5953c4a2">XKEY</a>:
<a name="l06184"></a>06184                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#af58b3779d0b9691c9a871cc1ff0b880c">YKEY</a>:
<a name="l06185"></a>06185                 <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a5387e52eccf782cebe3b5eb2ca7655e1">ZKEY</a>:
<a name="l06186"></a>06186                 {
<a name="l06187"></a>06187                     <span class="keywordflow">if</span> ((event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) &amp;&amp;
<a name="l06188"></a>06188                         (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a> == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) &amp;&amp;
<a name="l06189"></a>06189                         (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a> ==  <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) &amp;&amp;
<a name="l06190"></a>06190                         (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7dc2b3fa9f4563111cb1a461a1117192">oskey</a> == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>))
<a name="l06191"></a>06191                     {
<a name="l06192"></a>06192                         <span class="keywordflow">for</span> (but = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a844299999568743bc189fcb02847e9e6">buttons</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; but; but = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a115d85d61bc4c6fd0756320cb94f554e">next</a>) {
<a name="l06193"></a>06193 
<a name="l06194"></a>06194                             <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a512fd9b8589a650c64553ad8570c8276">menu_key</a> == event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l06195"></a>06195                                 <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#a02c336ab5ee16270de92af2f3f2cb5eb">BUT</a>) {
<a name="l06196"></a>06196                                     <span class="comment">/* mainly for operator buttons */</span>
<a name="l06197"></a>06197                                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab4089d3f2a01002abbea3eadec7a650b">ui_handle_button_activate</a>(C, ar, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0ba83e55158cfac680f1af68501dc6219c6">BUTTON_ACTIVATE_APPLY</a>);
<a name="l06198"></a>06198                                 }
<a name="l06199"></a>06199                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a52220397ecea855b3a99746e451426e1">BLOCK</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a917e2674b6708b555abe909f360b12e1">PULLDOWN</a>)) {
<a name="l06200"></a>06200                                     <span class="comment">/* open submenus (like right arrow key) */</span>
<a name="l06201"></a>06201                                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab4089d3f2a01002abbea3eadec7a650b">ui_handle_button_activate</a>(C, ar, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0ba96a20f1754faaa0c4d3f914a2906d44d">BUTTON_ACTIVATE_OPEN</a>);
<a name="l06202"></a>06202                                 }
<a name="l06203"></a>06203                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a> == <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad0d059e6a83d21bea4f4db1c9fbd240b">MENU</a>) {
<a name="l06204"></a>06204                                     <span class="comment">/* activate menu items */</span>
<a name="l06205"></a>06205                                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab4089d3f2a01002abbea3eadec7a650b">ui_handle_button_activate</a>(C, ar, but, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa7d4c604128a50c79a4c6efd3b1c3e0bab111808df840be3c6692f0dc072933c7">BUTTON_ACTIVATE</a>);
<a name="l06206"></a>06206                                 }
<a name="l06207"></a>06207                                 <span class="keywordflow">else</span> {
<a name="l06208"></a>06208                                     printf(<span class="stringliteral">&quot;%s: error, but-&gt;menu_key type: %d\n&quot;</span>, __func__, but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>);
<a name="l06209"></a>06209                                 }
<a name="l06210"></a>06210 
<a name="l06211"></a>06211                                 <span class="keywordflow">break</span>;
<a name="l06212"></a>06212                             }
<a name="l06213"></a>06213                         }
<a name="l06214"></a>06214 
<a name="l06215"></a>06215                         retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l06216"></a>06216                     }
<a name="l06217"></a>06217                     <span class="keywordflow">break</span>;
<a name="l06218"></a>06218                 }
<a name="l06219"></a>06219             }
<a name="l06220"></a>06220         }
<a name="l06221"></a>06221         
<a name="l06222"></a>06222         <span class="comment">/* here we check return conditions for menus */</span>
<a name="l06223"></a>06223         <span class="keywordflow">if</span> (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a98c4c059c6ae512763c370fcedb1b744">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a85cfd29a5959ab2b2fcc578bcbe6ef3c">UI_BLOCK_LOOP</a>) {
<a name="l06224"></a>06224             <span class="comment">/* if we click outside the block, verify if we clicked on the</span>
<a name="l06225"></a>06225 <span class="comment">             * button that opened us, otherwise we need to close */</span>
<a name="l06226"></a>06226             <span class="keywordflow">if</span> (inside == 0) {
<a name="l06227"></a>06227                 <a class="code" href="../../d9/d70/structuiSafetyRct.html">uiSafetyRct</a> *saferct = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a496e412400953c51f51715972b58dc7c">saferct</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l06228"></a>06228 
<a name="l06229"></a>06229                 <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#adc87b609a6285a24e23172a90734044c">RIGHTMOUSE</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l06230"></a>06230                     <span class="keywordflow">if</span> (saferct &amp;&amp; !<a class="code" href="../../d5/d44/BLI__rect_8h.html#a6601514c8df73c1e060cb2b3f4887b09">BLI_in_rctf</a>(&amp;saferct-&gt;<a class="code" href="../../d9/d70/structuiSafetyRct.html#aa8a91807c0eaacbfaeae0d648b59c121">parent</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>)) {
<a name="l06231"></a>06231                         <span class="keywordflow">if</span> (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a98c4c059c6ae512763c370fcedb1b744">flag</a> &amp; (<a class="code" href="../../d8/d1e/UI__interface_8h.html#a44a24381fb7effecbc796cfd37ef6645">UI_BLOCK_OUT_1</a>))
<a name="l06232"></a>06232                             menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a0958fdecb4298063870bc8a9b642724a">UI_RETURN_OK</a>;
<a name="l06233"></a>06233                         <span class="keywordflow">else</span>
<a name="l06234"></a>06234                             menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> = <a class="code" href="../../d8/d1e/UI__interface_8h.html#afc6399179bbacae07a2469215f5c0349">UI_RETURN_OUT</a>;
<a name="l06235"></a>06235                     }
<a name="l06236"></a>06236                 }
<a name="l06237"></a>06237             }
<a name="l06238"></a>06238 
<a name="l06239"></a>06239             <span class="keywordflow">if</span> (menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a>) ;
<a name="l06240"></a>06240             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l06241"></a>06241                 <span class="comment">/* esc cancels this and all preceding menus */</span>
<a name="l06242"></a>06242                 menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> = <a class="code" href="../../d8/d1e/UI__interface_8h.html#ace0267a120fea587350d10329515e70d">UI_RETURN_CANCEL</a>;
<a name="l06243"></a>06243             }
<a name="l06244"></a>06244             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c861c5ebabe8fe076ed84a2aaa7a1a0">RETKEY</a>, <a class="code" href="../../d1/d40/wm__event__types_8h.html#aafdc675e684c8485e8e27c7f2bafcbef">PADENTER</a>) &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a4ce6386082cecfa0645ced2216d04172">val</a> == <a class="code" href="../../d4/ddc/WM__types_8h.html#a8cc410005d9d1dacfe81cdffb6388d09">KM_PRESS</a>) {
<a name="l06245"></a>06245                 <span class="comment">/* enter will always close this block, we let the event</span>
<a name="l06246"></a>06246 <span class="comment">                 * get handled by the button if it is activated, otherwise we cancel */</span>
<a name="l06247"></a>06247                 <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9e4f3ee0f30a82b8d2c4865d80b11a75">ui_but_find_activated</a>(ar))
<a name="l06248"></a>06248                     menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> = <a class="code" href="../../d8/d1e/UI__interface_8h.html#ace0267a120fea587350d10329515e70d">UI_RETURN_CANCEL</a> | <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa584366141a6f2f02ac8d70d796f894e">UI_RETURN_POPUP_OK</a>;
<a name="l06249"></a>06249             }
<a name="l06250"></a>06250             <span class="keywordflow">else</span> {
<a name="l06251"></a>06251                 <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad65d33be8204418cd898c216274aa6ce">ui_mouse_motion_towards_check</a>(block, menu, mx, my);
<a name="l06252"></a>06252 
<a name="l06253"></a>06253                 <span class="comment">/* check mouse moving outside of the menu */</span>
<a name="l06254"></a>06254                 <span class="keywordflow">if</span> (inside == 0 &amp;&amp; (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a98c4c059c6ae512763c370fcedb1b744">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#af62c6c69e8be99c028da09fa3a7ccda4">UI_BLOCK_MOVEMOUSE_QUIT</a>)) {
<a name="l06255"></a>06255                     <a class="code" href="../../d9/d70/structuiSafetyRct.html">uiSafetyRct</a> *saferct;
<a name="l06256"></a>06256                     
<a name="l06257"></a>06257                     <span class="comment">/* check for all parent rects, enables arrowkeys to be used */</span>
<a name="l06258"></a>06258                     <span class="keywordflow">for</span> (saferct = block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a496e412400953c51f51715972b58dc7c">saferct</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; saferct; saferct = saferct-&gt;<a class="code" href="../../d9/d70/structuiSafetyRct.html#aa0afde31ca7179e6c896bc8e6eb33692">next</a>) {
<a name="l06259"></a>06259                         <span class="comment">/* for mouse move we only check our own rect, for other</span>
<a name="l06260"></a>06260 <span class="comment">                         * events we check all preceding block rects too to make</span>
<a name="l06261"></a>06261 <span class="comment">                         * arrow keys navigation work */</span>
<a name="l06262"></a>06262                         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> != <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a> || saferct == block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a496e412400953c51f51715972b58dc7c">saferct</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l06263"></a>06263                             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d44/BLI__rect_8h.html#a6601514c8df73c1e060cb2b3f4887b09">BLI_in_rctf</a>(&amp;saferct-&gt;<a class="code" href="../../d9/d70/structuiSafetyRct.html#aa8a91807c0eaacbfaeae0d648b59c121">parent</a>, (<span class="keywordtype">float</span>)event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, (<span class="keywordtype">float</span>)event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>))
<a name="l06264"></a>06264                                 <span class="keywordflow">break</span>;
<a name="l06265"></a>06265                             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d44/BLI__rect_8h.html#a6601514c8df73c1e060cb2b3f4887b09">BLI_in_rctf</a>(&amp;saferct-&gt;<a class="code" href="../../d9/d70/structuiSafetyRct.html#a65b7dbfe9e4be95950570920f2da0c0d">safety</a>, (<span class="keywordtype">float</span>)event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, (<span class="keywordtype">float</span>)event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>))
<a name="l06266"></a>06266                                 <span class="keywordflow">break</span>;
<a name="l06267"></a>06267                         }
<a name="l06268"></a>06268                     }
<a name="l06269"></a>06269 
<a name="l06270"></a>06270                     <span class="comment">/* strict check, and include the parent rect */</span>
<a name="l06271"></a>06271                     <span class="keywordflow">if</span> (!menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a2f5dfa8ec27188d54ea7460305e4117a">dotowards</a> &amp;&amp; !saferct) {
<a name="l06272"></a>06272                         <span class="keywordflow">if</span> (block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a98c4c059c6ae512763c370fcedb1b744">flag</a> &amp; (<a class="code" href="../../d8/d1e/UI__interface_8h.html#a44a24381fb7effecbc796cfd37ef6645">UI_BLOCK_OUT_1</a>))
<a name="l06273"></a>06273                             menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a0958fdecb4298063870bc8a9b642724a">UI_RETURN_OK</a>;
<a name="l06274"></a>06274                         <span class="keywordflow">else</span>
<a name="l06275"></a>06275                             menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> = <a class="code" href="../../d8/d1e/UI__interface_8h.html#afc6399179bbacae07a2469215f5c0349">UI_RETURN_OUT</a>;
<a name="l06276"></a>06276                     }
<a name="l06277"></a>06277                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a2f5dfa8ec27188d54ea7460305e4117a">dotowards</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>)
<a name="l06278"></a>06278                         retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l06279"></a>06279                 }
<a name="l06280"></a>06280             }
<a name="l06281"></a>06281         }
<a name="l06282"></a>06282     }
<a name="l06283"></a>06283 
<a name="l06284"></a>06284     <span class="comment">/* if we are didn&#39;t handle the event yet, lets pass it on to</span>
<a name="l06285"></a>06285 <span class="comment">     * buttons inside this region. disabled inside check .. not sure</span>
<a name="l06286"></a>06286 <span class="comment">     * anymore why it was there? but it meant enter didn&#39;t work</span>
<a name="l06287"></a>06287 <span class="comment">     * for example when mouse was not over submenu */</span>
<a name="l06288"></a>06288     <span class="keywordflow">if</span> ((<span class="comment">/*inside &amp;&amp;*/</span> (!menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> || (menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a535fc859b627f71ab3bc8a767e96a163">UI_RETURN_UPDATE</a>)) &amp;&amp; retval == <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>) || event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a599217205dc3092c26567a2bd868ef3a">TIMER</a>) {
<a name="l06289"></a>06289         but = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9e4f3ee0f30a82b8d2c4865d80b11a75">ui_but_find_activated</a>(ar);
<a name="l06290"></a>06290 
<a name="l06291"></a>06291         <span class="keywordflow">if</span> (but) {
<a name="l06292"></a>06292             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *ctx_area = <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l06293"></a>06293             <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ctx_region = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l06294"></a>06294             
<a name="l06295"></a>06295             <span class="keywordflow">if</span> (menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aff192e920e4c4a0926ddc2188d27c6f2">ctx_area</a>) <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aff192e920e4c4a0926ddc2188d27c6f2">ctx_area</a>);
<a name="l06296"></a>06296             <span class="keywordflow">if</span> (menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#ac1487481dc356c9a39b62b96364bae96">ctx_region</a>) <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#ac1487481dc356c9a39b62b96364bae96">ctx_region</a>);
<a name="l06297"></a>06297             
<a name="l06298"></a>06298             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9a702f228e05fb9efdaf2d1632ad47b0">ui_handle_button_event</a>(C, event, but);
<a name="l06299"></a>06299             
<a name="l06300"></a>06300             <span class="keywordflow">if</span> (menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aff192e920e4c4a0926ddc2188d27c6f2">ctx_area</a>) <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, ctx_area);
<a name="l06301"></a>06301             <span class="keywordflow">if</span> (menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#ac1487481dc356c9a39b62b96364bae96">ctx_region</a>) <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, ctx_region);
<a name="l06302"></a>06302         }
<a name="l06303"></a>06303         <span class="keywordflow">else</span>
<a name="l06304"></a>06304             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a418c092286ca75afad8af16253e00275">ui_handle_button_over</a>(C, event, ar);
<a name="l06305"></a>06305     }
<a name="l06306"></a>06306 
<a name="l06307"></a>06307     <span class="comment">/* if we set a menu return value, ensure we continue passing this on to</span>
<a name="l06308"></a>06308 <span class="comment">     * lower menus and buttons, so always set continue then, and if we are</span>
<a name="l06309"></a>06309 <span class="comment">     * inside the region otherwise, ensure we swallow the event */</span>
<a name="l06310"></a>06310     <span class="keywordflow">if</span> (menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a>)
<a name="l06311"></a>06311         <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l06312"></a>06312     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inside)
<a name="l06313"></a>06313         <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l06314"></a>06314     <span class="keywordflow">else</span>
<a name="l06315"></a>06315         <span class="keywordflow">return</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a>;
<a name="l06316"></a>06316 }
<a name="l06317"></a>06317 
<a name="l06318"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ac8df92898f84b98599ad9be0a0668a18">06318</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ac8df92898f84b98599ad9be0a0668a18">ui_handle_menu_return_submenu</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <a class="code" href="../../dc/d28/structuiPopupBlockHandle.html">uiPopupBlockHandle</a> *menu)
<a name="l06319"></a>06319 {
<a name="l06320"></a>06320     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l06321"></a>06321     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l06322"></a>06322     <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block;
<a name="l06323"></a>06323     <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l06324"></a>06324     <a class="code" href="../../dc/d28/structuiPopupBlockHandle.html">uiPopupBlockHandle</a> *submenu;
<a name="l06325"></a>06325     <span class="keywordtype">int</span> mx, my, <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a8568effaf95c1efd2e0482ed79dfac4f">update</a>;
<a name="l06326"></a>06326 
<a name="l06327"></a>06327     ar = menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a1ff0c66125f1330b1f99b461093bc10c">region</a>;
<a name="l06328"></a>06328     block = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#afbd94c7a138066b4e773e9d3401b0d87">uiblocks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l06329"></a>06329 
<a name="l06330"></a>06330     but = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9e4f3ee0f30a82b8d2c4865d80b11a75">ui_but_find_activated</a>(ar);
<a name="l06331"></a>06331     data = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>;
<a name="l06332"></a>06332     submenu = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a>;
<a name="l06333"></a>06333 
<a name="l06334"></a>06334     <span class="keywordflow">if</span> (submenu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a>) {
<a name="l06335"></a>06335         <span class="comment">/* first decide if we want to close our own menu cascading, if</span>
<a name="l06336"></a>06336 <span class="comment">         * so pass on the sub menu return value to our own menu handle */</span>
<a name="l06337"></a>06337         <span class="keywordflow">if</span> ((submenu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a0958fdecb4298063870bc8a9b642724a">UI_RETURN_OK</a>) || (submenu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#ace0267a120fea587350d10329515e70d">UI_RETURN_CANCEL</a>)) {
<a name="l06338"></a>06338             <span class="keywordflow">if</span> (!(block-&gt;<a class="code" href="../../df/d5b/structuiBlock.html#a98c4c059c6ae512763c370fcedb1b744">flag</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a1e54286a0adf9f1390927708c76e9a3c">UI_BLOCK_KEEP_OPEN</a>)) {
<a name="l06339"></a>06339                 menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> = submenu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a>;
<a name="l06340"></a>06340                 menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a923c558b70bc91e610eeb7f44f31b028">butretval</a> = data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#af641ab327a24df951b822374fece4d13">retval</a>;
<a name="l06341"></a>06341             }
<a name="l06342"></a>06342         }
<a name="l06343"></a>06343 
<a name="l06344"></a>06344         update = (submenu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a535fc859b627f71ab3bc8a767e96a163">UI_RETURN_UPDATE</a>);
<a name="l06345"></a>06345 
<a name="l06346"></a>06346         <span class="comment">/* now let activated button in this menu exit, which</span>
<a name="l06347"></a>06347 <span class="comment">         * will actually close the submenu too */</span>
<a name="l06348"></a>06348         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a64678527ed84bbae4935c712d65b4b7d">ui_handle_button_return_submenu</a>(C, event, but);
<a name="l06349"></a>06349 
<a name="l06350"></a>06350         <span class="keywordflow">if</span> (update)
<a name="l06351"></a>06351             submenu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> = 0;
<a name="l06352"></a>06352     }
<a name="l06353"></a>06353 
<a name="l06354"></a>06354     <span class="comment">/* for cases where close does not cascade, allow the user to</span>
<a name="l06355"></a>06355 <span class="comment">     * move the mouse back towards the menu without closing */</span>
<a name="l06356"></a>06356     mx = <span class="keyword">event</span>-&gt;x;
<a name="l06357"></a>06357     my = <span class="keyword">event</span>-&gt;y;
<a name="l06358"></a>06358     <a class="code" href="../../dd/dda/interface_8c.html#a9015f7625fae6c6f13dd7c97219267ad">ui_window_to_block</a>(ar, block, &amp;mx, &amp;my);
<a name="l06359"></a>06359     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6bd61cdbed7f1a010da41e74ecda7467">ui_mouse_motion_towards_init</a>(menu, mx, my, 1);
<a name="l06360"></a>06360 
<a name="l06361"></a>06361     <span class="keywordflow">if</span> (menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a>)
<a name="l06362"></a>06362         <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l06363"></a>06363     <span class="keywordflow">else</span>
<a name="l06364"></a>06364         <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l06365"></a>06365 }
<a name="l06366"></a>06366 
<a name="l06367"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae06c1d0cb72f87fd819e4cd5d4282050">06367</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae06c1d0cb72f87fd819e4cd5d4282050">ui_handle_menus_recursive</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <a class="code" href="../../dc/d28/structuiPopupBlockHandle.html">uiPopupBlockHandle</a> *menu)
<a name="l06368"></a>06368 {
<a name="l06369"></a>06369     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l06370"></a>06370     <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l06371"></a>06371     <a class="code" href="../../dc/d28/structuiPopupBlockHandle.html">uiPopupBlockHandle</a> *submenu;
<a name="l06372"></a>06372     <span class="keywordtype">int</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l06373"></a>06373 
<a name="l06374"></a>06374     <span class="comment">/* check if we have a submenu, and handle events for it first */</span>
<a name="l06375"></a>06375     but = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9e4f3ee0f30a82b8d2c4865d80b11a75">ui_but_find_activated</a>(menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a1ff0c66125f1330b1f99b461093bc10c">region</a>);
<a name="l06376"></a>06376     data = (but) ? but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06377"></a>06377     submenu = (data) ? data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06378"></a>06378 
<a name="l06379"></a>06379     <span class="keywordflow">if</span> (submenu)
<a name="l06380"></a>06380         retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae06c1d0cb72f87fd819e4cd5d4282050">ui_handle_menus_recursive</a>(C, event, submenu);
<a name="l06381"></a>06381 
<a name="l06382"></a>06382     <span class="comment">/* now handle events for our own menu */</span>
<a name="l06383"></a>06383     <span class="keywordflow">if</span> (retval == <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a> || event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a599217205dc3092c26567a2bd868ef3a">TIMER</a>) {
<a name="l06384"></a>06384         <span class="keywordflow">if</span> (submenu &amp;&amp; submenu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a>)
<a name="l06385"></a>06385             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ac8df92898f84b98599ad9be0a0668a18">ui_handle_menu_return_submenu</a>(C, event, menu);
<a name="l06386"></a>06386         <span class="keywordflow">else</span>
<a name="l06387"></a>06387             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad8f88f5b3fb640f3e743c7cbf5639ec5">ui_handle_menu_event</a>(C, event, menu, (submenu == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));
<a name="l06388"></a>06388     }
<a name="l06389"></a>06389 
<a name="l06390"></a>06390     <span class="keywordflow">return</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a>;
<a name="l06391"></a>06391 }
<a name="l06392"></a>06392 
<a name="l06393"></a>06393 <span class="comment">/* *************** UI event handlers **************** */</span>
<a name="l06394"></a>06394 
<a name="l06395"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#adcd847bc823389fa9ec38e99b01ac4b0">06395</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#adcd847bc823389fa9ec38e99b01ac4b0">ui_handler_region</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(userdata))
<a name="l06396"></a>06396 {
<a name="l06397"></a>06397     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l06398"></a>06398     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l06399"></a>06399     <span class="keywordtype">int</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a>;
<a name="l06400"></a>06400 
<a name="l06401"></a>06401     <span class="comment">/* here we handle buttons at the region level, non-modal */</span>
<a name="l06402"></a>06402     ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l06403"></a>06403     retval = <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>;
<a name="l06404"></a>06404 
<a name="l06405"></a>06405     <span class="keywordflow">if</span> (ar == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a>;
<a name="l06406"></a>06406     <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#afbd94c7a138066b4e773e9d3401b0d87">uiblocks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a>;
<a name="l06407"></a>06407 
<a name="l06408"></a>06408     <span class="comment">/* either handle events for already activated button or try to activate */</span>
<a name="l06409"></a>06409     but = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9e4f3ee0f30a82b8d2c4865d80b11a75">ui_but_find_activated</a>(ar);
<a name="l06410"></a>06410 
<a name="l06411"></a>06411     retval = <a class="code" href="../../d1/d2f/interface__intern_8h.html#a4ee711dd0140965aa6e80bc1e2ad8d6b">ui_handler_panel_region</a>(C, event);
<a name="l06412"></a>06412 
<a name="l06413"></a>06413     <span class="keywordflow">if</span> (retval == <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>)
<a name="l06414"></a>06414         retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aa2e9281e320bf704c3bae5cf8c1372b8">ui_handle_list_event</a>(C, event, ar);
<a name="l06415"></a>06415 
<a name="l06416"></a>06416     <span class="keywordflow">if</span> (retval == <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a>) {
<a name="l06417"></a>06417         <span class="keywordflow">if</span> (but)
<a name="l06418"></a>06418             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9a702f228e05fb9efdaf2d1632ad47b0">ui_handle_button_event</a>(C, event, but);
<a name="l06419"></a>06419         <span class="keywordflow">else</span>
<a name="l06420"></a>06420             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a418c092286ca75afad8af16253e00275">ui_handle_button_over</a>(C, event, ar);
<a name="l06421"></a>06421     }
<a name="l06422"></a>06422 
<a name="l06423"></a>06423     <span class="comment">/* re-enable tooltips */</span>
<a name="l06424"></a>06424     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a> &amp;&amp; (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> != event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#ae82a74a8a8f426501aab0b260aeb9189">prevx</a> || event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a> != event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa3a33c2ca6525fb33d25b67e50bea0eb">prevy</a>))
<a name="l06425"></a>06425         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aef524b33ce6d1f1d0d0ebdf5d2622c85">ui_blocks_set_tooltips</a>(ar, 1);
<a name="l06426"></a>06426     
<a name="l06427"></a>06427     <span class="comment">/* delayed apply callbacks */</span>
<a name="l06428"></a>06428     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad67fd5103bd96676d77781bb042857c9">ui_apply_but_funcs_after</a>(C);
<a name="l06429"></a>06429 
<a name="l06430"></a>06430     <span class="keywordflow">return</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a>;
<a name="l06431"></a>06431 }
<a name="l06432"></a>06432 
<a name="l06433"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a7df995677c65c7b4e621922ab2d016b0">06433</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a7df995677c65c7b4e621922ab2d016b0">ui_handler_remove_region</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(userdata))
<a name="l06434"></a>06434 {
<a name="l06435"></a>06435     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l06436"></a>06436     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l06437"></a>06437 
<a name="l06438"></a>06438     ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l06439"></a>06439     <span class="keywordflow">if</span> (ar == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l06440"></a>06440 
<a name="l06441"></a>06441     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3111de0bcf6a2a301ac52bee57c33d81">uiFreeBlocks</a>(C, &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#afbd94c7a138066b4e773e9d3401b0d87">uiblocks</a>);
<a name="l06442"></a>06442     
<a name="l06443"></a>06443     sc = <a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C);
<a name="l06444"></a>06444     <span class="keywordflow">if</span> (sc == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l06445"></a>06445 
<a name="l06446"></a>06446     <span class="comment">/* delayed apply callbacks, but not for screen level regions, those</span>
<a name="l06447"></a>06447 <span class="comment">     * we rather do at the very end after closing them all, which will</span>
<a name="l06448"></a>06448 <span class="comment">     * be done in ui_handler_region/window */</span>
<a name="l06449"></a>06449     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a0a004822554284f0bb32fdc70cfeee1f">BLI_findindex</a>(&amp;sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a5aed112496143ef5c69ddb1f9a8d5efd">regionbase</a>, ar) == -1)
<a name="l06450"></a>06450         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad67fd5103bd96676d77781bb042857c9">ui_apply_but_funcs_after</a>(C);
<a name="l06451"></a>06451 }
<a name="l06452"></a>06452 
<a name="l06453"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a246c1ad78fec1f8434e19a6db4c079ac">06453</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a6af6aa616eab184a12bf533bd9ebea55">ui_handler_region_menu</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(userdata))
<a name="l06454"></a>06454 {
<a name="l06455"></a>06455     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l06456"></a>06456     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l06457"></a>06457     <a class="code" href="../../d1/d8b/structuiHandleButtonData.html">uiHandleButtonData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l06458"></a>06458     <span class="keywordtype">int</span> <a class="code" href="../../da/dfb/structuiAfterFunc.html#a22c367aaf90cc14cef6dfcd3c5338128">retval</a>;
<a name="l06459"></a>06459 
<a name="l06460"></a>06460     <span class="comment">/* here we handle buttons at the window level, modal, for example</span>
<a name="l06461"></a>06461 <span class="comment">     * while number sliding, text editing, or when a menu block is open */</span>
<a name="l06462"></a>06462     ar = <a class="code" href="../../df/d01/BKE__context_8h.html#a2753b66475f5c46f20ba08a747dd019d">CTX_wm_menu</a>(C);
<a name="l06463"></a>06463     <span class="keywordflow">if</span> (!ar)
<a name="l06464"></a>06464         ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l06465"></a>06465 
<a name="l06466"></a>06466     but = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9e4f3ee0f30a82b8d2c4865d80b11a75">ui_but_find_activated</a>(ar);
<a name="l06467"></a>06467 
<a name="l06468"></a>06468     <span class="keywordflow">if</span> (but) {
<a name="l06469"></a>06469         <span class="comment">/* handle activated button events */</span>
<a name="l06470"></a>06470         data = but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a1c3a7573c97fed011000a653b17d4471">active</a>;
<a name="l06471"></a>06471 
<a name="l06472"></a>06472         <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#a475c1186070ae10b47ca704b38afd43a">state</a> == <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a71a6990d3767ae26c7635f46a4c6fee5ae1228af3749113bd521ffaaa4f5060e8">BUTTON_STATE_MENU_OPEN</a>) {
<a name="l06473"></a>06473             <span class="comment">/* handle events for menus and their buttons recursively,</span>
<a name="l06474"></a>06474 <span class="comment">             * this will handle events from the top to the bottom menu */</span>
<a name="l06475"></a>06475             retval = <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae06c1d0cb72f87fd819e4cd5d4282050">ui_handle_menus_recursive</a>(C, event, data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a>);
<a name="l06476"></a>06476 
<a name="l06477"></a>06477             <span class="comment">/* handle events for the activated button */</span>
<a name="l06478"></a>06478             <span class="keywordflow">if</span> (retval == <a class="code" href="../../d4/ddc/WM__types_8h.html#a188140e06eaccc299b76eadc7d1c294c">WM_UI_HANDLER_CONTINUE</a> || event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a599217205dc3092c26567a2bd868ef3a">TIMER</a>) {
<a name="l06479"></a>06479                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d1/d8b/structuiHandleButtonData.html#aae350bf213065d85318267b093e71209">menu</a>-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a>)
<a name="l06480"></a>06480                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a64678527ed84bbae4935c712d65b4b7d">ui_handle_button_return_submenu</a>(C, event, but);
<a name="l06481"></a>06481                 <span class="keywordflow">else</span>
<a name="l06482"></a>06482                     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9a702f228e05fb9efdaf2d1632ad47b0">ui_handle_button_event</a>(C, event, but);
<a name="l06483"></a>06483             }
<a name="l06484"></a>06484         }
<a name="l06485"></a>06485         <span class="keywordflow">else</span> {
<a name="l06486"></a>06486             <span class="comment">/* handle events for the activated button */</span>
<a name="l06487"></a>06487             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a9a702f228e05fb9efdaf2d1632ad47b0">ui_handle_button_event</a>(C, event, but);
<a name="l06488"></a>06488         }
<a name="l06489"></a>06489     }
<a name="l06490"></a>06490 
<a name="l06491"></a>06491     <span class="comment">/* re-enable tooltips */</span>
<a name="l06492"></a>06492     <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a> &amp;&amp; (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> != event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#ae82a74a8a8f426501aab0b260aeb9189">prevx</a> || event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a> != event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa3a33c2ca6525fb33d25b67e50bea0eb">prevy</a>))
<a name="l06493"></a>06493         <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aef524b33ce6d1f1d0d0ebdf5d2622c85">ui_blocks_set_tooltips</a>(ar, 1);
<a name="l06494"></a>06494 
<a name="l06495"></a>06495     <span class="comment">/* delayed apply callbacks */</span>
<a name="l06496"></a>06496     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad67fd5103bd96676d77781bb042857c9">ui_apply_but_funcs_after</a>(C);
<a name="l06497"></a>06497 
<a name="l06498"></a>06498     <span class="comment">/* we block all events, this is modal interaction */</span>
<a name="l06499"></a>06499     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l06500"></a>06500 }
<a name="l06501"></a>06501 
<a name="l06502"></a>06502 <span class="comment">/* two types of popups, one with operator + enum, other with regular callbacks */</span>
<a name="l06503"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a4646a62fd92854d93933f38d638add64">06503</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a4646a62fd92854d93933f38d638add64">ui_handler_popup</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event, <span class="keywordtype">void</span> *userdata)
<a name="l06504"></a>06504 {
<a name="l06505"></a>06505     <a class="code" href="../../dc/d28/structuiPopupBlockHandle.html">uiPopupBlockHandle</a> *menu = userdata;
<a name="l06506"></a>06506 
<a name="l06507"></a>06507     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ae06c1d0cb72f87fd819e4cd5d4282050">ui_handle_menus_recursive</a>(C, event, menu);
<a name="l06508"></a>06508 
<a name="l06509"></a>06509     <span class="comment">/* free if done, does not free handle itself */</span>
<a name="l06510"></a>06510     <span class="keywordflow">if</span> (menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a>) {
<a name="l06511"></a>06511         <span class="comment">/* copy values, we have to free first (closes region) */</span>
<a name="l06512"></a>06512         <a class="code" href="../../dc/d28/structuiPopupBlockHandle.html">uiPopupBlockHandle</a> temp = *menu;
<a name="l06513"></a>06513         
<a name="l06514"></a>06514         <a class="code" href="../../d1/d2f/interface__intern_8h.html#a701a60081b1f2beff057c0aa8df9d2bd">ui_popup_block_free</a>(C, menu);
<a name="l06515"></a>06515         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a501c4785469ba022bd5f4b13f52d6df4">UI_remove_popup_handlers</a>(&amp;<a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C)-&gt;modalhandlers, menu);
<a name="l06516"></a>06516 
<a name="l06517"></a>06517         <span class="keywordflow">if</span> ((temp.<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#a0958fdecb4298063870bc8a9b642724a">UI_RETURN_OK</a>) || (temp.<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#aa80fac557616bd196ff99b556e5bb24e">menuretval</a> &amp; <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa584366141a6f2f02ac8d70d796f894e">UI_RETURN_POPUP_OK</a>)) {
<a name="l06518"></a>06518             <span class="keywordflow">if</span> (temp.<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a210d42fe6526c8b5fdc2d9393077b89e">popup_func</a>)
<a name="l06519"></a>06519                 temp.<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a210d42fe6526c8b5fdc2d9393077b89e">popup_func</a>(C, temp.<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#ae02ebb0c5f14bdb6cd02f3e60473691d">popup_arg</a>, temp.<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a5f9aa84a54844c9454956bfb988737a7">retvalue</a>);
<a name="l06520"></a>06520             <span class="keywordflow">if</span> (temp.<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a2f589f6a103e543e1ecd7fe45d534c0b">optype</a>)
<a name="l06521"></a>06521                 <a class="code" href="../../df/db0/wm__event__system_8c.html#a0208cd65e2ce6a150f2653214cfc57dd">WM_operator_name_call</a>(C, temp.<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a2f589f6a103e543e1ecd7fe45d534c0b">optype</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>, temp.<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#ac05784a27cbdcbd80cf5bfe03934b800">opcontext</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l06522"></a>06522         }
<a name="l06523"></a>06523         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp.<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#ac52c7fa9059429bff26885b3ad35b743">cancel_func</a>)
<a name="l06524"></a>06524             temp.<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#ac52c7fa9059429bff26885b3ad35b743">cancel_func</a>(temp.<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#ae02ebb0c5f14bdb6cd02f3e60473691d">popup_arg</a>);
<a name="l06525"></a>06525     }
<a name="l06526"></a>06526     <span class="keywordflow">else</span> {
<a name="l06527"></a>06527         <span class="comment">/* re-enable tooltips */</span>
<a name="l06528"></a>06528         <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a> &amp;&amp; (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> != event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#ae82a74a8a8f426501aab0b260aeb9189">prevx</a> || event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a> != event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa3a33c2ca6525fb33d25b67e50bea0eb">prevy</a>))
<a name="l06529"></a>06529             <a class="code" href="../../d3/d9b/interface__handlers_8c.html#aef524b33ce6d1f1d0d0ebdf5d2622c85">ui_blocks_set_tooltips</a>(menu-&gt;<a class="code" href="../../dc/d28/structuiPopupBlockHandle.html#a1ff0c66125f1330b1f99b461093bc10c">region</a>, 1);
<a name="l06530"></a>06530     }
<a name="l06531"></a>06531 
<a name="l06532"></a>06532     <span class="comment">/* delayed apply callbacks */</span>
<a name="l06533"></a>06533     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad67fd5103bd96676d77781bb042857c9">ui_apply_but_funcs_after</a>(C);
<a name="l06534"></a>06534 
<a name="l06535"></a>06535     <span class="comment">/* we block all events, this is modal interaction */</span>
<a name="l06536"></a>06536     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#aee005f5aef26b50371f30dba73402528">WM_UI_HANDLER_BREAK</a>;
<a name="l06537"></a>06537 }
<a name="l06538"></a>06538 
<a name="l06539"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab19394a15bbcdc4b5357aba1b765b4d4">06539</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab19394a15bbcdc4b5357aba1b765b4d4">ui_handler_remove_popup</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keywordtype">void</span> *userdata)
<a name="l06540"></a>06540 {
<a name="l06541"></a>06541     <a class="code" href="../../dc/d28/structuiPopupBlockHandle.html">uiPopupBlockHandle</a> *menu = userdata;
<a name="l06542"></a>06542 
<a name="l06543"></a>06543     <span class="comment">/* free menu block if window is closed for some reason */</span>
<a name="l06544"></a>06544     <a class="code" href="../../d1/d2f/interface__intern_8h.html#a701a60081b1f2beff057c0aa8df9d2bd">ui_popup_block_free</a>(C, menu);
<a name="l06545"></a>06545 
<a name="l06546"></a>06546     <span class="comment">/* delayed apply callbacks */</span>
<a name="l06547"></a>06547     <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ad67fd5103bd96676d77781bb042857c9">ui_apply_but_funcs_after</a>(C);
<a name="l06548"></a>06548 }
<a name="l06549"></a>06549 
<a name="l06550"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a55485e22139763bd51592cb525fd6d70">06550</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a9fe40aacf8e743df07b2b9a20bc72a16">UI_add_region_handlers</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *handlers)
<a name="l06551"></a>06551 {
<a name="l06552"></a>06552     <a class="code" href="../../df/db0/wm__event__system_8c.html#aa4559ef4b4b539b84f096c57577ff9a6">WM_event_remove_ui_handler</a>(handlers, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#adcd847bc823389fa9ec38e99b01ac4b0">ui_handler_region</a>, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a7df995677c65c7b4e621922ab2d016b0">ui_handler_remove_region</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);
<a name="l06553"></a>06553     <a class="code" href="../../df/db0/wm__event__system_8c.html#aee879a05c38567d71054117111d1269c">WM_event_add_ui_handler</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, handlers, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#adcd847bc823389fa9ec38e99b01ac4b0">ui_handler_region</a>, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a7df995677c65c7b4e621922ab2d016b0">ui_handler_remove_region</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l06554"></a>06554 }
<a name="l06555"></a>06555 
<a name="l06556"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab4a04e89e6be932046414bf96f7a309b">06556</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#ac0ee95586c9c2110de867abdaf891efd">UI_add_popup_handlers</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *handlers, <a class="code" href="../../dc/d28/structuiPopupBlockHandle.html">uiPopupBlockHandle</a> *popup)
<a name="l06557"></a>06557 {
<a name="l06558"></a>06558     <a class="code" href="../../df/db0/wm__event__system_8c.html#aee879a05c38567d71054117111d1269c">WM_event_add_ui_handler</a>(C, handlers, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a4646a62fd92854d93933f38d638add64">ui_handler_popup</a>, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab19394a15bbcdc4b5357aba1b765b4d4">ui_handler_remove_popup</a>, popup);
<a name="l06559"></a>06559 }
<a name="l06560"></a>06560 
<a name="l06561"></a><a class="code" href="../../d3/d9b/interface__handlers_8c.html#a60e28037cdfe9a9d2b3120b6e6fb6341">06561</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#a501c4785469ba022bd5f4b13f52d6df4">UI_remove_popup_handlers</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *handlers, <a class="code" href="../../dc/d28/structuiPopupBlockHandle.html">uiPopupBlockHandle</a> *popup)
<a name="l06562"></a>06562 {
<a name="l06563"></a>06563     <a class="code" href="../../df/db0/wm__event__system_8c.html#aa4559ef4b4b539b84f096c57577ff9a6">WM_event_remove_ui_handler</a>(handlers, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#a4646a62fd92854d93933f38d638add64">ui_handler_popup</a>, <a class="code" href="../../d3/d9b/interface__handlers_8c.html#ab19394a15bbcdc4b5357aba1b765b4d4">ui_handler_remove_popup</a>, popup, 0);
<a name="l06564"></a>06564 }
<a name="l06565"></a>06565 
<a name="l06566"></a>06566 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:25 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: writefile.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">writefile.c</div>  </div>
</div>
<div class="contents">
<a href="../../d3/d68/writefile_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> *</span>
<a name="l00022"></a>00022 <span class="comment"> * Contributor(s): Blender Foundation</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00025"></a>00025 <span class="comment"> */</span>
<a name="l00026"></a>00026 
<a name="l00032"></a>00032 <span class="comment">/*</span>
<a name="l00033"></a>00033 <span class="comment">FILEFORMAT: IFF-style structure  (but not IFF compatible!)</span>
<a name="l00034"></a>00034 <span class="comment"></span>
<a name="l00035"></a>00035 <span class="comment">start file:</span>
<a name="l00036"></a>00036 <span class="comment">    BLENDER_V100    12 bytes  (versie 1.00)</span>
<a name="l00037"></a>00037 <span class="comment">                    V = big endian, v = little endian</span>
<a name="l00038"></a>00038 <span class="comment">                    _ = 4 byte pointer, - = 8 byte pointer</span>
<a name="l00039"></a>00039 <span class="comment"></span>
<a name="l00040"></a>00040 <span class="comment">datablocks:     also see struct BHead</span>
<a name="l00041"></a>00041 <span class="comment">    &lt;bh.code&gt;           4 chars</span>
<a name="l00042"></a>00042 <span class="comment">    &lt;bh.len&gt;            int,  len data after BHead</span>
<a name="l00043"></a>00043 <span class="comment">    &lt;bh.old&gt;            void,  old pointer</span>
<a name="l00044"></a>00044 <span class="comment">    &lt;bh.SDNAnr&gt;         int</span>
<a name="l00045"></a>00045 <span class="comment">    &lt;bh.nr&gt;             int, in case of array: amount of structs</span>
<a name="l00046"></a>00046 <span class="comment">    data</span>
<a name="l00047"></a>00047 <span class="comment">    ...</span>
<a name="l00048"></a>00048 <span class="comment">    ...</span>
<a name="l00049"></a>00049 <span class="comment"></span>
<a name="l00050"></a>00050 <span class="comment">Almost all data in Blender are structures. Each struct saved</span>
<a name="l00051"></a>00051 <span class="comment">gets a BHead header.  With BHead the struct can be linked again</span>
<a name="l00052"></a>00052 <span class="comment">and compared with StructDNA .</span>
<a name="l00053"></a>00053 <span class="comment"></span>
<a name="l00054"></a>00054 <span class="comment">WRITE</span>
<a name="l00055"></a>00055 <span class="comment"></span>
<a name="l00056"></a>00056 <span class="comment">Preferred writing order: (not really a must, but why would you do it random?)</span>
<a name="l00057"></a>00057 <span class="comment">Any case: direct data is ALWAYS after the lib block</span>
<a name="l00058"></a>00058 <span class="comment"></span>
<a name="l00059"></a>00059 <span class="comment">(Local file data)</span>
<a name="l00060"></a>00060 <span class="comment">- for each LibBlock</span>
<a name="l00061"></a>00061 <span class="comment">    - write LibBlock</span>
<a name="l00062"></a>00062 <span class="comment">    - write associated direct data</span>
<a name="l00063"></a>00063 <span class="comment">(External file data)</span>
<a name="l00064"></a>00064 <span class="comment">- per library</span>
<a name="l00065"></a>00065 <span class="comment">    - write library block</span>
<a name="l00066"></a>00066 <span class="comment">    - per LibBlock</span>
<a name="l00067"></a>00067 <span class="comment">        - write the ID of LibBlock</span>
<a name="l00068"></a>00068 <span class="comment">- write TEST (128x128, blend file preview, optional)</span>
<a name="l00069"></a>00069 <span class="comment">- write FileGlobal (some global vars)</span>
<a name="l00070"></a>00070 <span class="comment">- write SDNA</span>
<a name="l00071"></a>00071 <span class="comment">- write USER if filename is ~/X.XX/config/startup.blend</span>
<a name="l00072"></a>00072 <span class="comment">*/</span>
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<a name="l00077"></a>00077 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00078"></a>00078 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 <span class="preprocessor">#include &quot;zlib.h&quot;</span>
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 <span class="preprocessor">#ifndef WIN32</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;unistd.h&gt;</span>
<a name="l00085"></a>00085 <span class="preprocessor">#else</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span><span class="preprocessor">#  include &quot;winsock2.h&quot;</span>
<a name="l00087"></a>00087 <span class="preprocessor">#  include &lt;io.h&gt;</span>
<a name="l00088"></a>00088 <span class="preprocessor">#  include &lt;process.h&gt;</span> <span class="comment">// for getpid</span>
<a name="l00089"></a>00089 <span class="preprocessor">#  include &quot;<a class="code" href="../../d9/ded/BLI__winstuff_8h.html" title="Compatibility-like things for windows.">BLI_winstuff.h</a>&quot;</span>
<a name="l00090"></a>00090 <span class="preprocessor">#endif</span>
<a name="l00091"></a>00091 <span class="preprocessor"></span>
<a name="l00092"></a>00092 <span class="comment">/* allow writefile to use deprecated functionality (for forward compatibility code) */</span>
<a name="l00093"></a><a class="code" href="../../d3/d68/writefile_8c.html#aab0b0efbdfa37ee26c8805af7d2e8c9c">00093</a> <span class="preprocessor">#define DNA_DEPRECATED_ALLOW</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span>
<a name="l00095"></a>00095 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html">DNA_anim_types.h</a>&quot;</span>
<a name="l00096"></a>00096 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d93/DNA__armature__types_8h.html">DNA_armature_types.h</a>&quot;</span>
<a name="l00097"></a>00097 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/de2/DNA__actuator__types_8h.html">DNA_actuator_types.h</a>&quot;</span>
<a name="l00098"></a>00098 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d37/DNA__brush__types_8h.html">DNA_brush_types.h</a>&quot;</span>
<a name="l00099"></a>00099 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d3b/DNA__camera__types_8h.html">DNA_camera_types.h</a>&quot;</span>
<a name="l00100"></a>00100 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d70/DNA__cloth__types_8h.html">DNA_cloth_types.h</a>&quot;</span>
<a name="l00101"></a>00101 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d03/DNA__constraint__types_8h.html">DNA_constraint_types.h</a>&quot;</span>
<a name="l00102"></a>00102 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d3e/DNA__controller__types_8h.html">DNA_controller_types.h</a>&quot;</span>
<a name="l00103"></a>00103 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/daf/DNA__dynamicpaint__types_8h.html">DNA_dynamicpaint_types.h</a>&quot;</span>
<a name="l00104"></a>00104 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dcc/DNA__genfile_8h.html" title="blenloader genfile private function prototypes">DNA_genfile.h</a>&quot;</span>
<a name="l00105"></a>00105 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d75/DNA__group__types_8h.html">DNA_group_types.h</a>&quot;</span>
<a name="l00106"></a>00106 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dcb/DNA__gpencil__types_8h.html">DNA_gpencil_types.h</a>&quot;</span>
<a name="l00107"></a>00107 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d61/DNA__fileglobal__types_8h.html">DNA_fileglobal_types.h</a>&quot;</span>
<a name="l00108"></a>00108 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d41/DNA__key__types_8h.html">DNA_key_types.h</a>&quot;</span>
<a name="l00109"></a>00109 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d2f/DNA__lattice__types_8h.html">DNA_lattice_types.h</a>&quot;</span>
<a name="l00110"></a>00110 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html">DNA_lamp_types.h</a>&quot;</span>
<a name="l00111"></a>00111 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d40/DNA__meta__types_8h.html">DNA_meta_types.h</a>&quot;</span>
<a name="l00112"></a>00112 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d96/DNA__mesh__types_8h.html">DNA_mesh_types.h</a>&quot;</span>
<a name="l00113"></a>00113 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html">DNA_meshdata_types.h</a>&quot;</span>
<a name="l00114"></a>00114 <span class="preprocessor">#include &quot;<a class="code" href="../../de/db2/DNA__material__types_8h.html">DNA_material_types.h</a>&quot;</span>
<a name="l00115"></a>00115 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d27/DNA__node__types_8h.html">DNA_node_types.h</a>&quot;</span>
<a name="l00116"></a>00116 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00117"></a>00117 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d60/DNA__object__force_8h.html">DNA_object_force.h</a>&quot;</span>
<a name="l00118"></a>00118 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d4d/DNA__packedFile__types_8h.html">DNA_packedFile_types.h</a>&quot;</span>
<a name="l00119"></a>00119 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d5a/DNA__particle__types_8h.html">DNA_particle_types.h</a>&quot;</span>
<a name="l00120"></a>00120 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d2b/DNA__property__types_8h.html">DNA_property_types.h</a>&quot;</span>
<a name="l00121"></a>00121 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00122"></a>00122 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d4e/DNA__sdna__types_8h.html">DNA_sdna_types.h</a>&quot;</span>
<a name="l00123"></a>00123 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/da9/DNA__sequence__types_8h.html">DNA_sequence_types.h</a>&quot;</span>
<a name="l00124"></a>00124 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html">DNA_sensor_types.h</a>&quot;</span>
<a name="l00125"></a>00125 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d8b/DNA__smoke__types_8h.html">DNA_smoke_types.h</a>&quot;</span>
<a name="l00126"></a>00126 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d5d/DNA__space__types_8h.html">DNA_space_types.h</a>&quot;</span>
<a name="l00127"></a>00127 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/da4/DNA__screen__types_8h.html">DNA_screen_types.h</a>&quot;</span>
<a name="l00128"></a>00128 <span class="preprocessor">#include &quot;<a class="code" href="../../da/de4/DNA__speaker__types_8h.html">DNA_speaker_types.h</a>&quot;</span>
<a name="l00129"></a>00129 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d66/DNA__sound__types_8h.html">DNA_sound_types.h</a>&quot;</span>
<a name="l00130"></a>00130 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d71/DNA__text__types_8h.html">DNA_text_types.h</a>&quot;</span>
<a name="l00131"></a>00131 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d06/DNA__view3d__types_8h.html">DNA_view3d_types.h</a>&quot;</span>
<a name="l00132"></a>00132 <span class="preprocessor">#include &quot;<a class="code" href="../../de/dcc/DNA__vfont__types_8h.html">DNA_vfont_types.h</a>&quot;</span>
<a name="l00133"></a>00133 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d3b/DNA__world__types_8h.html">DNA_world_types.h</a>&quot;</span>
<a name="l00134"></a>00134 <span class="preprocessor">#include &quot;<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html">DNA_windowmanager_types.h</a>&quot;</span>
<a name="l00135"></a>00135 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html">DNA_movieclip_types.h</a>&quot;</span>
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span> <span class="comment">// MEM_freeN</span>
<a name="l00138"></a>00138 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dd3/BLI__bitmap_8h.html">BLI_bitmap.h</a>&quot;</span>
<a name="l00139"></a>00139 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00140"></a>00140 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d31/BLI__linklist_8h.html" title="Routines for working with singly linked lists of &#39;links&#39; - pointers to other data.">BLI_linklist.h</a>&quot;</span>
<a name="l00141"></a>00141 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/dd1/BLI__bpath_8h.html">BLI_bpath.h</a>&quot;</span>
<a name="l00142"></a>00142 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00143"></a>00143 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/df5/BKE__action_8h.html" title="Blender kernel action and pose functionality.">BKE_action.h</a>&quot;</span>
<a name="l00146"></a>00146 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/ddf/BKE__blender_8h.html" title="Blender util stuff.">BKE_blender.h</a>&quot;</span>
<a name="l00147"></a>00147 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dfc/BKE__curve_8h.html">BKE_curve.h</a>&quot;</span>
<a name="l00148"></a>00148 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddd/BKE__constraint_8h.html">BKE_constraint.h</a>&quot;</span>
<a name="l00149"></a>00149 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span> <span class="comment">// for G</span>
<a name="l00150"></a>00150 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/db1/BKE__library_8h.html">BKE_library.h</a>&quot;</span> <span class="comment">// for  set_listbasepointers</span>
<a name="l00151"></a>00151 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00152"></a>00152 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d91/BKE__node_8h.html">BKE_node.h</a>&quot;</span>
<a name="l00153"></a>00153 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d40/BKE__report_8h.html">BKE_report.h</a>&quot;</span>
<a name="l00154"></a>00154 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d5f/BKE__sequencer_8h.html">BKE_sequencer.h</a>&quot;</span>
<a name="l00155"></a>00155 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dde/BKE__utildefines_8h.html" title="blender format specific macros">BKE_utildefines.h</a>&quot;</span>
<a name="l00156"></a>00156 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d0f/BKE__modifier_8h.html">BKE_modifier.h</a>&quot;</span>
<a name="l00157"></a>00157 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dba/BKE__fcurve_8h.html">BKE_fcurve.h</a>&quot;</span>
<a name="l00158"></a>00158 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d45/BKE__pointcache_8h.html">BKE_pointcache.h</a>&quot;</span>
<a name="l00159"></a>00159 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d7f/BKE__mesh_8h.html">BKE_mesh.h</a>&quot;</span>
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d5b/BLO__writefile_8h.html" title="external writefile function prototypes.">BLO_writefile.h</a>&quot;</span>
<a name="l00162"></a>00162 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d01/BLO__readfile_8h.html" title="external readfile function prototypes.">BLO_readfile.h</a>&quot;</span>
<a name="l00163"></a>00163 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d5f/BLO__undofile_8h.html">BLO_undofile.h</a>&quot;</span>
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d65/readfile_8h.html">readfile.h</a>&quot;</span>
<a name="l00166"></a>00166 
<a name="l00167"></a>00167 <span class="preprocessor">#include &lt;errno.h&gt;</span>
<a name="l00168"></a>00168 
<a name="l00169"></a>00169 <span class="comment">/* ********* my write, buffered writing with minimum size chunks ************ */</span>
<a name="l00170"></a>00170 
<a name="l00171"></a><a class="code" href="../../d3/d68/writefile_8c.html#a1619ef084eb5598cbe66e8c0b000d235">00171</a> <span class="preprocessor">#define MYWRITE_BUFFER_SIZE 100000</span>
<a name="l00172"></a><a class="code" href="../../d3/d68/writefile_8c.html#aed0537f5a62dbb0438bc6ad71624b0e0">00172</a> <span class="preprocessor"></span><span class="preprocessor">#define MYWRITE_MAX_CHUNK   32768</span>
<a name="l00173"></a>00173 <span class="preprocessor"></span>
<a name="l00174"></a><a class="code" href="../../d1/d19/structWriteData.html">00174</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00175"></a><a class="code" href="../../d1/d19/structWriteData.html#a6076ec75a8c6ce31db025d4e47c1b620">00175</a>     <span class="keyword">struct </span><a class="code" href="../../de/d21/structSDNA.html">SDNA</a> *<a class="code" href="../../d1/d19/structWriteData.html#a6076ec75a8c6ce31db025d4e47c1b620">sdna</a>;
<a name="l00176"></a>00176 
<a name="l00177"></a><a class="code" href="../../d1/d19/structWriteData.html#ae2f10bd25a2f26d17d3700544bee412d">00177</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d19/structWriteData.html#ae2f10bd25a2f26d17d3700544bee412d">file</a>;
<a name="l00178"></a><a class="code" href="../../d1/d19/structWriteData.html#a2929abfadfa58fb30b8bbe37ed673adf">00178</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="../../d1/d19/structWriteData.html#a2929abfadfa58fb30b8bbe37ed673adf">buf</a>;
<a name="l00179"></a><a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">00179</a>     <a class="code" href="../../d7/d4d/structMemFile.html">MemFile</a> *<a class="code" href="../../dd/de9/mesh__navmesh_8c.html#a5ca4cf7d126d1b70e95de936dbf5079d">compare</a>, *<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>;
<a name="l00180"></a>00180     
<a name="l00181"></a><a class="code" href="../../d1/d19/structWriteData.html#a05b5f5f4a13ebd2ccdfdd770f55c24b0">00181</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d19/structWriteData.html#a05b5f5f4a13ebd2ccdfdd770f55c24b0">tot</a>, count, <a class="code" href="../../d3/d22/seqeffects_8c.html#a7b34dac1400e04787532993b40ad9814">error</a>, memsize;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 <span class="preprocessor">#ifdef USE_BMESH_SAVE_AS_COMPAT</span>
<a name="l00184"></a>00184 <span class="preprocessor"></span>    <span class="keywordtype">char</span> use_mesh_compat; <span class="comment">/* option to save with older mesh format */</span>
<a name="l00185"></a>00185 <span class="preprocessor">#endif</span>
<a name="l00186"></a>00186 <span class="preprocessor"></span>} <a class="code" href="../../dd/d06/png_8c.html#aaffdf555efa36af0faefce92e6e527aa">WriteData</a>;
<a name="l00187"></a>00187 
<a name="l00188"></a><a class="code" href="../../d3/d68/writefile_8c.html#a54cf2126ffc737273fb2fd2310f967d3">00188</a> <span class="keyword">static</span> <a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *<a class="code" href="../../d3/d68/writefile_8c.html#a54cf2126ffc737273fb2fd2310f967d3">writedata_new</a>(<span class="keywordtype">int</span> file)
<a name="l00189"></a>00189 {
<a name="l00190"></a>00190     <a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(*wd), <span class="stringliteral">&quot;writedata&quot;</span>);
<a name="l00191"></a>00191 
<a name="l00192"></a>00192         <span class="comment">/* XXX, see note about this in readfile.c, remove</span>
<a name="l00193"></a>00193 <span class="comment">         * once we have an xp lock - zr</span>
<a name="l00194"></a>00194 <span class="comment">         */</span>
<a name="l00195"></a>00195 
<a name="l00196"></a>00196     <span class="keywordflow">if</span> (wd == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00197"></a>00197 
<a name="l00198"></a>00198     wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a6076ec75a8c6ce31db025d4e47c1b620">sdna</a>= <a class="code" href="../../d1/dcc/DNA__genfile_8h.html#ad2a0c183344bbd0082d10d8f7739f754">DNA_sdna_from_data</a>(<a class="code" href="../../d1/dcc/DNA__genfile_8h.html#a062991a4dc43ce3e8c304d8dc48e315c">DNAstr</a>, <a class="code" href="../../d1/dcc/DNA__genfile_8h.html#aed1375e383789bb3d022e86c59958f3b">DNAlen</a>, 0);
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ae2f10bd25a2f26d17d3700544bee412d">file</a>= file;
<a name="l00201"></a>00201 
<a name="l00202"></a>00202     wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a2929abfadfa58fb30b8bbe37ed673adf">buf</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<a class="code" href="../../d3/d68/writefile_8c.html#a1619ef084eb5598cbe66e8c0b000d235">MYWRITE_BUFFER_SIZE</a>, <span class="stringliteral">&quot;wd-&gt;buf&quot;</span>);
<a name="l00203"></a>00203 
<a name="l00204"></a>00204     <span class="keywordflow">return</span> wd;
<a name="l00205"></a>00205 }
<a name="l00206"></a>00206 
<a name="l00207"></a><a class="code" href="../../d3/d68/writefile_8c.html#a12c126a0bd4ccea756b587e4096da91e">00207</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a12c126a0bd4ccea756b587e4096da91e">writedata_do_write</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <span class="keyword">const</span> <span class="keywordtype">void</span> *mem, <span class="keywordtype">int</span> memlen)
<a name="l00208"></a>00208 {
<a name="l00209"></a>00209     <span class="keywordflow">if</span> ((wd == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a8b9bb5ff0d729b4cc10bd18ad659411b">error</a> || (mem == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || memlen &lt; 1) <span class="keywordflow">return</span>;
<a name="l00210"></a>00210     <span class="keywordflow">if</span> (wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a8b9bb5ff0d729b4cc10bd18ad659411b">error</a>) <span class="keywordflow">return</span>;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212     <span class="comment">/* memory based save */</span>
<a name="l00213"></a>00213     <span class="keywordflow">if</span> (wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l00214"></a>00214         <a class="code" href="../../dc/d5f/BLO__undofile_8h.html#adf4a6c85f989135fa6c0b09ede93ded5">add_memfilechunk</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>, mem, memlen);
<a name="l00215"></a>00215     }
<a name="l00216"></a>00216     <span class="keywordflow">else</span> {
<a name="l00217"></a>00217         <span class="keywordflow">if</span> (write(wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ae2f10bd25a2f26d17d3700544bee412d">file</a>, mem, memlen) != memlen)
<a name="l00218"></a>00218             wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a8b9bb5ff0d729b4cc10bd18ad659411b">error</a>= 1;
<a name="l00219"></a>00219         
<a name="l00220"></a>00220     }
<a name="l00221"></a>00221 }
<a name="l00222"></a>00222 
<a name="l00223"></a><a class="code" href="../../d3/d68/writefile_8c.html#a44c0ab62c92b7a1f9850ebfea21d7f19">00223</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a44c0ab62c92b7a1f9850ebfea21d7f19">writedata_free</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd)
<a name="l00224"></a>00224 {
<a name="l00225"></a>00225     <a class="code" href="../../d1/dcc/DNA__genfile_8h.html#a13458cebc31058b42a4f5da0b6f36831">DNA_sdna_free</a>(wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a6076ec75a8c6ce31db025d4e47c1b620">sdna</a>);
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a2929abfadfa58fb30b8bbe37ed673adf">buf</a>);
<a name="l00228"></a>00228     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(wd);
<a name="l00229"></a>00229 }
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 <span class="comment">/***/</span>
<a name="l00232"></a>00232 
<a name="l00240"></a><a class="code" href="../../d3/d68/writefile_8c.html#ab6d466684929096461d75d8e48c455e4">00240</a> <span class="preprocessor">#define MYWRITE_FLUSH       NULL</span>
<a name="l00241"></a>00241 <span class="preprocessor"></span>
<a name="l00242"></a><a class="code" href="../../d3/d68/writefile_8c.html#ad3cd0b85338465ac04a3b48cc084e1c9">00242</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#ad3cd0b85338465ac04a3b48cc084e1c9">mywrite</a>( <a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <span class="keyword">const</span> <span class="keywordtype">void</span> *adr, <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>)
<a name="l00243"></a>00243 {
<a name="l00244"></a>00244     <span class="keywordflow">if</span> (wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a8b9bb5ff0d729b4cc10bd18ad659411b">error</a>) <span class="keywordflow">return</span>;
<a name="l00245"></a>00245 
<a name="l00246"></a>00246     <span class="comment">/* flush helps compression for undo-save */</span>
<a name="l00247"></a>00247     <span class="keywordflow">if</span> (adr==<a class="code" href="../../d3/d68/writefile_8c.html#ab6d466684929096461d75d8e48c455e4">MYWRITE_FLUSH</a>) {
<a name="l00248"></a>00248         <span class="keywordflow">if</span> (wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#abe26f506a0985cc58fe7238daf53a058">count</a>) {
<a name="l00249"></a>00249             <a class="code" href="../../d3/d68/writefile_8c.html#a12c126a0bd4ccea756b587e4096da91e">writedata_do_write</a>(wd, wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a2929abfadfa58fb30b8bbe37ed673adf">buf</a>, wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#abe26f506a0985cc58fe7238daf53a058">count</a>);
<a name="l00250"></a>00250             wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#abe26f506a0985cc58fe7238daf53a058">count</a>= 0;
<a name="l00251"></a>00251         }
<a name="l00252"></a>00252         <span class="keywordflow">return</span>;
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a05b5f5f4a13ebd2ccdfdd770f55c24b0">tot</a>+= <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l00256"></a>00256     
<a name="l00257"></a>00257     <span class="comment">/* if we have a single big chunk, write existing data in</span>
<a name="l00258"></a>00258 <span class="comment">     * buffer and write out big chunk in smaller pieces */</span>
<a name="l00259"></a>00259     <span class="keywordflow">if</span> (len&gt;<a class="code" href="../../d3/d68/writefile_8c.html#aed0537f5a62dbb0438bc6ad71624b0e0">MYWRITE_MAX_CHUNK</a>) {
<a name="l00260"></a>00260         <span class="keywordflow">if</span> (wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#abe26f506a0985cc58fe7238daf53a058">count</a>) {
<a name="l00261"></a>00261             <a class="code" href="../../d3/d68/writefile_8c.html#a12c126a0bd4ccea756b587e4096da91e">writedata_do_write</a>(wd, wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a2929abfadfa58fb30b8bbe37ed673adf">buf</a>, wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#abe26f506a0985cc58fe7238daf53a058">count</a>);
<a name="l00262"></a>00262             wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#abe26f506a0985cc58fe7238daf53a058">count</a>= 0;
<a name="l00263"></a>00263         }
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         <span class="keywordflow">do</span> {
<a name="l00266"></a>00266             <span class="keywordtype">int</span> writelen= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(len, <a class="code" href="../../d3/d68/writefile_8c.html#aed0537f5a62dbb0438bc6ad71624b0e0">MYWRITE_MAX_CHUNK</a>);
<a name="l00267"></a>00267             <a class="code" href="../../d3/d68/writefile_8c.html#a12c126a0bd4ccea756b587e4096da91e">writedata_do_write</a>(wd, adr, writelen);
<a name="l00268"></a>00268             adr = (<span class="keyword">const</span> <span class="keywordtype">char</span> *)adr + writelen;
<a name="l00269"></a>00269             len -= writelen;
<a name="l00270"></a>00270         } <span class="keywordflow">while</span> (len &gt; 0);
<a name="l00271"></a>00271 
<a name="l00272"></a>00272         <span class="keywordflow">return</span>;
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     <span class="comment">/* if data would overflow buffer, write out the buffer */</span>
<a name="l00276"></a>00276     <span class="keywordflow">if</span> (len+wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#abe26f506a0985cc58fe7238daf53a058">count</a>&gt;<a class="code" href="../../d3/d68/writefile_8c.html#a1619ef084eb5598cbe66e8c0b000d235">MYWRITE_BUFFER_SIZE</a>-1) {
<a name="l00277"></a>00277         <a class="code" href="../../d3/d68/writefile_8c.html#a12c126a0bd4ccea756b587e4096da91e">writedata_do_write</a>(wd, wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a2929abfadfa58fb30b8bbe37ed673adf">buf</a>, wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#abe26f506a0985cc58fe7238daf53a058">count</a>);
<a name="l00278"></a>00278         wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#abe26f506a0985cc58fe7238daf53a058">count</a>= 0;
<a name="l00279"></a>00279     }
<a name="l00280"></a>00280 
<a name="l00281"></a>00281     <span class="comment">/* append data at end of buffer */</span>
<a name="l00282"></a>00282     memcpy(&amp;wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a2929abfadfa58fb30b8bbe37ed673adf">buf</a>[wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#abe26f506a0985cc58fe7238daf53a058">count</a>], adr, len);
<a name="l00283"></a>00283     wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#abe26f506a0985cc58fe7238daf53a058">count</a>+= <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l00284"></a>00284 }
<a name="l00285"></a>00285 
<a name="l00293"></a><a class="code" href="../../d3/d68/writefile_8c.html#a44bdf463d195605da52715c8c00c28af">00293</a> <span class="keyword">static</span> <a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *<a class="code" href="../../d3/d68/writefile_8c.html#a44bdf463d195605da52715c8c00c28af">bgnwrite</a>(<span class="keywordtype">int</span> file, <a class="code" href="../../d7/d4d/structMemFile.html">MemFile</a> *<a class="code" href="../../dd/de9/mesh__navmesh_8c.html#a5ca4cf7d126d1b70e95de936dbf5079d">compare</a>, <a class="code" href="../../d7/d4d/structMemFile.html">MemFile</a> *current)
<a name="l00294"></a>00294 {
<a name="l00295"></a>00295     <a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd= <a class="code" href="../../d3/d68/writefile_8c.html#a54cf2126ffc737273fb2fd2310f967d3">writedata_new</a>(file);
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <span class="keywordflow">if</span> (wd == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00298"></a>00298 
<a name="l00299"></a>00299     wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a30f0328c05a8cf4a70609debcfb09c74">compare</a>= <a class="code" href="../../dd/de9/mesh__navmesh_8c.html#a5ca4cf7d126d1b70e95de936dbf5079d">compare</a>;
<a name="l00300"></a>00300     wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>= current;
<a name="l00301"></a>00301     <span class="comment">/* this inits comparing */</span>
<a name="l00302"></a>00302     <a class="code" href="../../dc/d5f/BLO__undofile_8h.html#adf4a6c85f989135fa6c0b09ede93ded5">add_memfilechunk</a>(compare, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);
<a name="l00303"></a>00303     
<a name="l00304"></a>00304     <span class="keywordflow">return</span> wd;
<a name="l00305"></a>00305 }
<a name="l00306"></a>00306 
<a name="l00313"></a><a class="code" href="../../d3/d68/writefile_8c.html#a60f2d922302e99dadd80baf3df3edf83">00313</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d68/writefile_8c.html#a60f2d922302e99dadd80baf3df3edf83">endwrite</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd)
<a name="l00314"></a>00314 {
<a name="l00315"></a>00315     <span class="keywordtype">int</span> <a class="code" href="../../df/db3/freetypefont_8c.html#ab596967142db56aa5fbafe7c234eedda">err</a>;
<a name="l00316"></a>00316 
<a name="l00317"></a>00317     <span class="keywordflow">if</span> (wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#abe26f506a0985cc58fe7238daf53a058">count</a>) {
<a name="l00318"></a>00318         <a class="code" href="../../d3/d68/writefile_8c.html#a12c126a0bd4ccea756b587e4096da91e">writedata_do_write</a>(wd, wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a2929abfadfa58fb30b8bbe37ed673adf">buf</a>, wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#abe26f506a0985cc58fe7238daf53a058">count</a>);
<a name="l00319"></a>00319         wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#abe26f506a0985cc58fe7238daf53a058">count</a>= 0;
<a name="l00320"></a>00320     }
<a name="l00321"></a>00321     
<a name="l00322"></a>00322     err= wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a8b9bb5ff0d729b4cc10bd18ad659411b">error</a>;
<a name="l00323"></a>00323     <a class="code" href="../../d3/d68/writefile_8c.html#a44c0ab62c92b7a1f9850ebfea21d7f19">writedata_free</a>(wd);
<a name="l00324"></a>00324 
<a name="l00325"></a>00325     <span class="keywordflow">return</span> <a class="code" href="../../df/db3/freetypefont_8c.html#ab596967142db56aa5fbafe7c234eedda">err</a>;
<a name="l00326"></a>00326 }
<a name="l00327"></a>00327 
<a name="l00328"></a>00328 <span class="comment">/* ********** WRITE FILE ****************** */</span>
<a name="l00329"></a>00329 
<a name="l00330"></a><a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">00330</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <span class="keywordtype">int</span> filecode, <span class="keyword">const</span> <span class="keywordtype">char</span> *structname, <span class="keywordtype">int</span> nr, <span class="keywordtype">void</span> *adr)
<a name="l00331"></a>00331 {
<a name="l00332"></a>00332     <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> bh;
<a name="l00333"></a>00333     <span class="keywordtype">short</span> *sp;
<a name="l00334"></a>00334 
<a name="l00335"></a>00335     <span class="keywordflow">if</span> (adr==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || nr==0) <span class="keywordflow">return</span>;
<a name="l00336"></a>00336 
<a name="l00337"></a>00337     <span class="comment">/* init BHead */</span>
<a name="l00338"></a>00338     bh.<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a>= filecode;
<a name="l00339"></a>00339     bh.<a class="code" href="../../d4/d6e/structBHead.html#ab0d63f94747046bc0ab156b2ffd3fd5d">old</a>= adr;
<a name="l00340"></a>00340     bh.<a class="code" href="../../d4/d6e/structBHead.html#a39ba4fd645b8a64764fb33e4dc504f9f">nr</a>= nr;
<a name="l00341"></a>00341 
<a name="l00342"></a>00342     bh.<a class="code" href="../../d4/d6e/structBHead.html#a44a5e4281e4995966c7f6ccb85ce2f7c">SDNAnr</a>= <a class="code" href="../../d1/dcc/DNA__genfile_8h.html#a8904bef13c17229492e16cdf0a772272">DNA_struct_find_nr</a>(wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a6076ec75a8c6ce31db025d4e47c1b620">sdna</a>, structname);
<a name="l00343"></a>00343     <span class="keywordflow">if</span> (bh.<a class="code" href="../../d4/d6e/structBHead.html#a44a5e4281e4995966c7f6ccb85ce2f7c">SDNAnr</a>== -1) {
<a name="l00344"></a>00344         printf(<span class="stringliteral">&quot;error: can&#39;t find SDNA code &lt;%s&gt;\n&quot;</span>, structname);
<a name="l00345"></a>00345         <span class="keywordflow">return</span>;
<a name="l00346"></a>00346     }
<a name="l00347"></a>00347     sp= wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a6076ec75a8c6ce31db025d4e47c1b620">sdna</a>-&gt;<a class="code" href="../../de/d21/structSDNA.html#a7a8754dea529ccbcd709128e5d78e262">structs</a>[bh.<a class="code" href="../../d4/d6e/structBHead.html#a44a5e4281e4995966c7f6ccb85ce2f7c">SDNAnr</a>];
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     bh.<a class="code" href="../../d4/d6e/structBHead.html#ab7c9bfe00bf8436c1e01dec269189203">len</a>= nr*wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a6076ec75a8c6ce31db025d4e47c1b620">sdna</a>-&gt;<a class="code" href="../../de/d21/structSDNA.html#a2c18fb54b5b3cb8d3e6e2c924760c12a">typelens</a>[sp[0]];
<a name="l00350"></a>00350 
<a name="l00351"></a>00351     <span class="keywordflow">if</span> (bh.<a class="code" href="../../d4/d6e/structBHead.html#ab7c9bfe00bf8436c1e01dec269189203">len</a>==0) <span class="keywordflow">return</span>;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353     <a class="code" href="../../d3/d68/writefile_8c.html#ad3cd0b85338465ac04a3b48cc084e1c9">mywrite</a>(wd, &amp;bh, <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6e/structBHead.html">BHead</a>));
<a name="l00354"></a>00354     <a class="code" href="../../d3/d68/writefile_8c.html#ad3cd0b85338465ac04a3b48cc084e1c9">mywrite</a>(wd, adr, bh.<a class="code" href="../../d4/d6e/structBHead.html#ab7c9bfe00bf8436c1e01dec269189203">len</a>);
<a name="l00355"></a>00355 }
<a name="l00356"></a>00356 
<a name="l00357"></a><a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">00357</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <span class="keywordtype">int</span> filecode, <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>, <span class="keyword">const</span> <span class="keywordtype">void</span> *adr)  <span class="comment">/* do not use for structs */</span>
<a name="l00358"></a>00358 {
<a name="l00359"></a>00359     <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> bh;
<a name="l00360"></a>00360 
<a name="l00361"></a>00361     <span class="keywordflow">if</span> (adr==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00362"></a>00362     <span class="keywordflow">if</span> (len==0) <span class="keywordflow">return</span>;
<a name="l00363"></a>00363 
<a name="l00364"></a>00364     len += 3;
<a name="l00365"></a>00365     len -= (len % 4);
<a name="l00366"></a>00366 
<a name="l00367"></a>00367     <span class="comment">/* init BHead */</span>
<a name="l00368"></a>00368     bh.<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a>   = filecode;
<a name="l00369"></a>00369     bh.<a class="code" href="../../d4/d6e/structBHead.html#ab0d63f94747046bc0ab156b2ffd3fd5d">old</a>    = (<span class="keywordtype">void</span> *)adr;  <span class="comment">/* this is safe to cast from const */</span>
<a name="l00370"></a>00370     bh.<a class="code" href="../../d4/d6e/structBHead.html#a39ba4fd645b8a64764fb33e4dc504f9f">nr</a>     = 1;
<a name="l00371"></a>00371     bh.<a class="code" href="../../d4/d6e/structBHead.html#a44a5e4281e4995966c7f6ccb85ce2f7c">SDNAnr</a> = 0;
<a name="l00372"></a>00372     bh.<a class="code" href="../../d4/d6e/structBHead.html#ab7c9bfe00bf8436c1e01dec269189203">len</a>    = <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l00373"></a>00373 
<a name="l00374"></a>00374     <a class="code" href="../../d3/d68/writefile_8c.html#ad3cd0b85338465ac04a3b48cc084e1c9">mywrite</a>(wd, &amp;bh, <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6e/structBHead.html">BHead</a>));
<a name="l00375"></a>00375     <span class="keywordflow">if</span> (len) <a class="code" href="../../d3/d68/writefile_8c.html#ad3cd0b85338465ac04a3b48cc084e1c9">mywrite</a>(wd, adr, len);
<a name="l00376"></a>00376 }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378 <span class="comment">/* *************** writing some direct data structs used in more code parts **************** */</span>
<a name="l00379"></a>00379 <span class="comment">/*These functions are used by blender&#39;s .blend system for file saving/loading.*/</span>
<a name="l00380"></a>00380 <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a313b956dfa68a14fd26fbd243092bd71">IDP_WriteProperty_OnlyData</a>(<a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop, <span class="keywordtype">void</span> *wd);
<a name="l00381"></a>00381 <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(<a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop, <span class="keywordtype">void</span> *wd);
<a name="l00382"></a>00382 
<a name="l00383"></a><a class="code" href="../../d3/d68/writefile_8c.html#a2f7011ae2e9dfec3580178ebcd848e37">00383</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a2f7011ae2e9dfec3580178ebcd848e37">IDP_WriteArray</a>(<a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop, <span class="keywordtype">void</span> *wd)
<a name="l00384"></a>00384 {
<a name="l00385"></a>00385     <span class="comment">/*REMEMBER to set totalen to len in the linking code!!*/</span>
<a name="l00386"></a>00386     <span class="keywordflow">if</span> (prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a72556445175de01157febdba797a6cd5">pointer</a>) {
<a name="l00387"></a>00387         <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <a class="code" href="../../da/d2b/mallocn_8c.html#a7d1e6a2f5f9d271452a168d3a637d91f">MEM_allocN_len</a>(prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a72556445175de01157febdba797a6cd5">pointer</a>), prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a72556445175de01157febdba797a6cd5">pointer</a>);
<a name="l00388"></a>00388 
<a name="l00389"></a>00389         <span class="keywordflow">if</span> (prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#aec2d0f53108c1e8d492de12472c884f9">subtype</a> == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#abf4b8c1027c684282b432b3c8033a2de">IDP_GROUP</a>) {
<a name="l00390"></a>00390             <a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> **<a class="code" href="../../d2/d41/classarray.html">array</a>= prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a72556445175de01157febdba797a6cd5">pointer</a>;
<a name="l00391"></a>00391             <span class="keywordtype">int</span> a;
<a name="l00392"></a>00392 
<a name="l00393"></a>00393             <span class="keywordflow">for</span> (a=0; a&lt;prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#a29547849bca3ad9e553d7d6c715e86ca">len</a>; a++)
<a name="l00394"></a>00394                 <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(array[a], wd);
<a name="l00395"></a>00395         }
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397 }
<a name="l00398"></a>00398 
<a name="l00399"></a><a class="code" href="../../d3/d68/writefile_8c.html#aff845df4369e3afecdb6df4a211e9d91">00399</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#aff845df4369e3afecdb6df4a211e9d91">IDP_WriteIDPArray</a>(<a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop, <span class="keywordtype">void</span> *wd)
<a name="l00400"></a>00400 {
<a name="l00401"></a>00401     <span class="comment">/*REMEMBER to set totalen to len in the linking code!!*/</span>
<a name="l00402"></a>00402     <span class="keywordflow">if</span> (prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a72556445175de01157febdba797a6cd5">pointer</a>) {
<a name="l00403"></a>00403         <a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *<a class="code" href="../../d2/d41/classarray.html">array</a> = prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a72556445175de01157febdba797a6cd5">pointer</a>;
<a name="l00404"></a>00404         <span class="keywordtype">int</span> a;
<a name="l00405"></a>00405 
<a name="l00406"></a>00406         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;IDProperty&quot;</span>, prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#a29547849bca3ad9e553d7d6c715e86ca">len</a>, array);
<a name="l00407"></a>00407 
<a name="l00408"></a>00408         <span class="keywordflow">for</span> (a=0; a&lt;prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#a29547849bca3ad9e553d7d6c715e86ca">len</a>; a++)
<a name="l00409"></a>00409             <a class="code" href="../../d3/d68/writefile_8c.html#a313b956dfa68a14fd26fbd243092bd71">IDP_WriteProperty_OnlyData</a>(&amp;array[a], wd);
<a name="l00410"></a>00410     }
<a name="l00411"></a>00411 }
<a name="l00412"></a>00412 
<a name="l00413"></a><a class="code" href="../../d3/d68/writefile_8c.html#ac7f24815ce287db418b32184cc5c61a5">00413</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#ac7f24815ce287db418b32184cc5c61a5">IDP_WriteString</a>(<a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop, <span class="keywordtype">void</span> *wd)
<a name="l00414"></a>00414 {
<a name="l00415"></a>00415     <span class="comment">/*REMEMBER to set totalen to len in the linking code!!*/</span>
<a name="l00416"></a>00416     <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#a29547849bca3ad9e553d7d6c715e86ca">len</a>+1, prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a72556445175de01157febdba797a6cd5">pointer</a>);
<a name="l00417"></a>00417 }
<a name="l00418"></a>00418 
<a name="l00419"></a><a class="code" href="../../d3/d68/writefile_8c.html#a8782b303d87f6e93b4ea104009b259b5">00419</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a8782b303d87f6e93b4ea104009b259b5">IDP_WriteGroup</a>(<a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop, <span class="keywordtype">void</span> *wd)
<a name="l00420"></a>00420 {
<a name="l00421"></a>00421     <a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *loop;
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     <span class="keywordflow">for</span> (loop=prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#ab81781154390478d322a370681d54e3e">data</a>.<a class="code" href="../../da/dbd/structIDPropertyData.html#a656cd00581ccba5491691f77e1b5e6da">group</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; loop; loop=loop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#a6a1233a8db3fd1ee1b07db13323b65cf">next</a>) {
<a name="l00424"></a>00424         <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(loop, wd);
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426 }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 <span class="comment">/* Functions to read/write ID Properties */</span>
<a name="l00429"></a><a class="code" href="../../d3/d68/writefile_8c.html#a313b956dfa68a14fd26fbd243092bd71">00429</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a313b956dfa68a14fd26fbd243092bd71">IDP_WriteProperty_OnlyData</a>(<a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop, <span class="keywordtype">void</span> *wd)
<a name="l00430"></a>00430 {
<a name="l00431"></a>00431     <span class="keywordflow">switch</span> (prop-&gt;<a class="code" href="../../df/d42/structIDProperty.html#afc4e09dbab4908446252e5fcb1b3c5ae">type</a>) {
<a name="l00432"></a>00432         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#abf4b8c1027c684282b432b3c8033a2de">IDP_GROUP</a>:
<a name="l00433"></a>00433             <a class="code" href="../../d3/d68/writefile_8c.html#a8782b303d87f6e93b4ea104009b259b5">IDP_WriteGroup</a>(prop, wd);
<a name="l00434"></a>00434             <span class="keywordflow">break</span>;
<a name="l00435"></a>00435         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ad02ddcb1c7a01492cc16b20fc6868eb6">IDP_STRING</a>:
<a name="l00436"></a>00436             <a class="code" href="../../d3/d68/writefile_8c.html#ac7f24815ce287db418b32184cc5c61a5">IDP_WriteString</a>(prop, wd);
<a name="l00437"></a>00437             <span class="keywordflow">break</span>;
<a name="l00438"></a>00438         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a271555be6be919d1b73afc38fae790bb">IDP_ARRAY</a>:
<a name="l00439"></a>00439             <a class="code" href="../../d3/d68/writefile_8c.html#a2f7011ae2e9dfec3580178ebcd848e37">IDP_WriteArray</a>(prop, wd);
<a name="l00440"></a>00440             <span class="keywordflow">break</span>;
<a name="l00441"></a>00441         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a22b5486a9e963a270e0e59526cbba3d8">IDP_IDPARRAY</a>:
<a name="l00442"></a>00442             <a class="code" href="../../d3/d68/writefile_8c.html#aff845df4369e3afecdb6df4a211e9d91">IDP_WriteIDPArray</a>(prop, wd);
<a name="l00443"></a>00443             <span class="keywordflow">break</span>;
<a name="l00444"></a>00444     }
<a name="l00445"></a>00445 }
<a name="l00446"></a>00446 
<a name="l00447"></a><a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">00447</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(<a class="code" href="../../df/d42/structIDProperty.html">IDProperty</a> *prop, <span class="keywordtype">void</span> *wd)
<a name="l00448"></a>00448 {
<a name="l00449"></a>00449     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;IDProperty&quot;</span>, 1, prop);
<a name="l00450"></a>00450     <a class="code" href="../../d3/d68/writefile_8c.html#a313b956dfa68a14fd26fbd243092bd71">IDP_WriteProperty_OnlyData</a>(prop, wd);
<a name="l00451"></a>00451 }
<a name="l00452"></a>00452 
<a name="l00453"></a><a class="code" href="../../d3/d68/writefile_8c.html#a116d73b135b29f117b708788061e3d9d">00453</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a116d73b135b29f117b708788061e3d9d">write_fmodifiers</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *fmodifiers)
<a name="l00454"></a>00454 {
<a name="l00455"></a>00455     <a class="code" href="../../dc/d68/structFModifier.html">FModifier</a> *fcm;
<a name="l00456"></a>00456     
<a name="l00457"></a>00457     <span class="comment">/* Modifiers */</span>
<a name="l00458"></a>00458     <span class="keywordflow">for</span> (fcm= fmodifiers-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; fcm; fcm= fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a2b03be89329aab5401fcd674e0f2d9ca">next</a>) {
<a name="l00459"></a>00459         <a class="code" href="../../d9/daa/structFModifierTypeInfo.html">FModifierTypeInfo</a> *fmi= <a class="code" href="../../da/dba/BKE__fcurve_8h.html#ade83c93762981b1a27bd40eb88dcccb6">fmodifier_get_typeinfo</a>(fcm);
<a name="l00460"></a>00460         
<a name="l00461"></a>00461         <span class="comment">/* Write the specific data */</span>
<a name="l00462"></a>00462         <span class="keywordflow">if</span> (fmi &amp;&amp; fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a68e8b157c9aa0a3984e0b772054c4416">data</a>) {
<a name="l00463"></a>00463             <span class="comment">/* firstly, just write the plain fmi-&gt;data struct */</span>
<a name="l00464"></a>00464             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, fmi-&gt;<a class="code" href="../../d9/daa/structFModifierTypeInfo.html#ab8681d17c99632f0a8d86c58aa0c29cc">structName</a>, 1, fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a68e8b157c9aa0a3984e0b772054c4416">data</a>);
<a name="l00465"></a>00465             
<a name="l00466"></a>00466             <span class="comment">/* do any modifier specific stuff */</span>
<a name="l00467"></a>00467             <span class="keywordflow">switch</span> (fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a2618b2144f7498de1afe54faa6692344">type</a>) {
<a name="l00468"></a>00468                 <span class="keywordflow">case</span> <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a780a87e4018e6dbc53e4dc812f83c97ba57fb312e27b01da48bd9a5eabb7bd506">FMODIFIER_TYPE_GENERATOR</a>:
<a name="l00469"></a>00469                 {
<a name="l00470"></a>00470                     <a class="code" href="../../d6/d18/structFMod__Generator.html">FMod_Generator</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= (<a class="code" href="../../d6/d18/structFMod__Generator.html">FMod_Generator</a> *)fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a68e8b157c9aa0a3984e0b772054c4416">data</a>;
<a name="l00471"></a>00471                     
<a name="l00472"></a>00472                     <span class="comment">/* write coefficients array */</span>
<a name="l00473"></a>00473                     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (data-&gt;<a class="code" href="../../d6/d18/structFMod__Generator.html#aee6e820aad268412ab96a6f94e7bedf2">coefficients</a>)
<a name="l00474"></a>00474                         <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*(data-&gt;<a class="code" href="../../d6/d18/structFMod__Generator.html#aa2d2e069e48310cf427bb61540504e96">arraysize</a>), data-&gt;<a class="code" href="../../d6/d18/structFMod__Generator.html#aee6e820aad268412ab96a6f94e7bedf2">coefficients</a>);
<a name="l00475"></a>00475                 }
<a name="l00476"></a>00476                     <span class="keywordflow">break</span>;
<a name="l00477"></a>00477                 <span class="keywordflow">case</span> <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a780a87e4018e6dbc53e4dc812f83c97ba8375444b37911c90b1255246a0d274af">FMODIFIER_TYPE_ENVELOPE</a>:
<a name="l00478"></a>00478                 {
<a name="l00479"></a>00479                     <a class="code" href="../../d4/dac/structFMod__Envelope.html">FMod_Envelope</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= (<a class="code" href="../../d4/dac/structFMod__Envelope.html">FMod_Envelope</a> *)fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a68e8b157c9aa0a3984e0b772054c4416">data</a>;
<a name="l00480"></a>00480                     
<a name="l00481"></a>00481                     <span class="comment">/* write envelope data */</span>
<a name="l00482"></a>00482                     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (data-&gt;<a class="code" href="../../d4/dac/structFMod__Envelope.html#a434be05786035884f0f7f78f80812e4e">data</a>)
<a name="l00483"></a>00483                         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;FCM_EnvelopeData&quot;</span>, data-&gt;<a class="code" href="../../d4/dac/structFMod__Envelope.html#a2330bccf366488cd9b7df52f3fc07156">totvert</a>, data-&gt;<a class="code" href="../../d4/dac/structFMod__Envelope.html#a434be05786035884f0f7f78f80812e4e">data</a>);
<a name="l00484"></a>00484                 }
<a name="l00485"></a>00485                     <span class="keywordflow">break</span>;
<a name="l00486"></a>00486                 <span class="keywordflow">case</span> <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a780a87e4018e6dbc53e4dc812f83c97baa6f502fa0bc4eaa22eea8ee09ab8df62">FMODIFIER_TYPE_PYTHON</a>:
<a name="l00487"></a>00487                 {
<a name="l00488"></a>00488                     <a class="code" href="../../d3/dcb/structFMod__Python.html">FMod_Python</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = (<a class="code" href="../../d3/dcb/structFMod__Python.html">FMod_Python</a> *)fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a68e8b157c9aa0a3984e0b772054c4416">data</a>;
<a name="l00489"></a>00489                     
<a name="l00490"></a>00490                     <span class="comment">/* Write ID Properties -- and copy this comment EXACTLY for easy finding</span>
<a name="l00491"></a>00491 <span class="comment">                     * of library blocks that implement this.*/</span>
<a name="l00492"></a>00492                     <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(data-&gt;<a class="code" href="../../d3/dcb/structFMod__Python.html#a740f4de69d5331dc614700920af3f767">prop</a>, wd);
<a name="l00493"></a>00493                 }
<a name="l00494"></a>00494                     <span class="keywordflow">break</span>;
<a name="l00495"></a>00495             }
<a name="l00496"></a>00496         }
<a name="l00497"></a>00497         
<a name="l00498"></a>00498         <span class="comment">/* Write the modifier */</span>
<a name="l00499"></a>00499         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;FModifier&quot;</span>, 1, fcm);
<a name="l00500"></a>00500     }
<a name="l00501"></a>00501 }
<a name="l00502"></a>00502 
<a name="l00503"></a><a class="code" href="../../d3/d68/writefile_8c.html#abfa3e21a6fe0231693de548bc5fa9171">00503</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#abfa3e21a6fe0231693de548bc5fa9171">write_fcurves</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *fcurves)
<a name="l00504"></a>00504 {
<a name="l00505"></a>00505     <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu;
<a name="l00506"></a>00506     
<a name="l00507"></a>00507     <span class="keywordflow">for</span> (fcu=fcurves-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; fcu; fcu=fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a381b65464374cad861b80c44b9ae0759">next</a>) {
<a name="l00508"></a>00508         <span class="comment">/* F-Curve */</span>
<a name="l00509"></a>00509         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;FCurve&quot;</span>, 1, fcu);
<a name="l00510"></a>00510         
<a name="l00511"></a>00511         <span class="comment">/* curve data */</span>
<a name="l00512"></a>00512         <span class="keywordflow">if</span> (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a799ab2725f85e5ee19e9ef88a8d6b006">bezt</a>)      
<a name="l00513"></a>00513             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;BezTriple&quot;</span>, fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#adec915e7ed4f2b66b12313566bf5c33f">totvert</a>, fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a799ab2725f85e5ee19e9ef88a8d6b006">bezt</a>);
<a name="l00514"></a>00514         <span class="keywordflow">if</span> (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a568e66419fe835c1baaabb739b305e0a">fpt</a>)
<a name="l00515"></a>00515             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;FPoint&quot;</span>, fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#adec915e7ed4f2b66b12313566bf5c33f">totvert</a>, fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a568e66419fe835c1baaabb739b305e0a">fpt</a>);
<a name="l00516"></a>00516             
<a name="l00517"></a>00517         <span class="keywordflow">if</span> (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>)
<a name="l00518"></a>00518             <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>)+1, fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>);
<a name="l00519"></a>00519         
<a name="l00520"></a>00520         <span class="comment">/* driver data */</span>
<a name="l00521"></a>00521         <span class="keywordflow">if</span> (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a6c79ab38bad6125a0c63120a5bf4dd3e">driver</a>) {
<a name="l00522"></a>00522             <a class="code" href="../../d3/d1e/structChannelDriver.html">ChannelDriver</a> *driver= fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a6c79ab38bad6125a0c63120a5bf4dd3e">driver</a>;
<a name="l00523"></a>00523             <a class="code" href="../../d1/d24/structDriverVar.html">DriverVar</a> *dvar;
<a name="l00524"></a>00524             
<a name="l00525"></a>00525             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ChannelDriver&quot;</span>, 1, driver);
<a name="l00526"></a>00526             
<a name="l00527"></a>00527             <span class="comment">/* variables */</span>
<a name="l00528"></a>00528             <span class="keywordflow">for</span> (dvar= driver-&gt;<a class="code" href="../../d3/d1e/structChannelDriver.html#a14d54c061db1124addaba9a6a80cce1e">variables</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; dvar; dvar= dvar-&gt;<a class="code" href="../../d1/d24/structDriverVar.html#a6cbe874a49fab44dd2e2ec49b5a35da1">next</a>) {
<a name="l00529"></a>00529                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;DriverVar&quot;</span>, 1, dvar);
<a name="l00530"></a>00530                 
<a name="l00531"></a>00531                 <a class="code" href="../../da/dba/BKE__fcurve_8h.html#ab7a010e2c04c7ccc1c70a90f9346d3ef">DRIVER_TARGETS_USED_LOOPER</a>(dvar)
<a name="l00532"></a>00532                 {
<a name="l00533"></a>00533                     <span class="keywordflow">if</span> (dtar-&gt;rna_path)
<a name="l00534"></a>00534                         <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(dtar-&gt;rna_path)+1, dtar-&gt;rna_path);
<a name="l00535"></a>00535                 }
<a name="l00536"></a>00536                 <a class="code" href="../../da/dba/BKE__fcurve_8h.html#ae6f978c887bc26c0da1235ccef77444b">DRIVER_TARGETS_LOOPER_END</a>
<a name="l00537"></a>00537             }
<a name="l00538"></a>00538         }
<a name="l00539"></a>00539         
<a name="l00540"></a>00540         <span class="comment">/* write F-Modifiers */</span>
<a name="l00541"></a>00541         <a class="code" href="../../d3/d68/writefile_8c.html#a116d73b135b29f117b708788061e3d9d">write_fmodifiers</a>(wd, &amp;fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#afd96cdfbbfd2b148482ca111cefa1f74">modifiers</a>);
<a name="l00542"></a>00542     }
<a name="l00543"></a>00543 }
<a name="l00544"></a>00544 
<a name="l00545"></a><a class="code" href="../../d3/d68/writefile_8c.html#afbdb849615a1f371195bf963424d7134">00545</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#afbdb849615a1f371195bf963424d7134">write_actions</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l00546"></a>00546 {
<a name="l00547"></a>00547     <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *act;
<a name="l00548"></a>00548     <a class="code" href="../../d9/dcf/structbActionGroup.html">bActionGroup</a> *grp;
<a name="l00549"></a>00549     <a class="code" href="../../d2/d3e/structTimeMarker.html">TimeMarker</a> *marker;
<a name="l00550"></a>00550     
<a name="l00551"></a>00551     <span class="keywordflow">for</span> (act=idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; act; act= act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ad0f2d8efde1fdd4f81ee9fe471313bd6">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l00552"></a>00552         <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ad0f2d8efde1fdd4f81ee9fe471313bd6">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l00553"></a>00553             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a20fe08f8d0b2a4e6c0dbb2371aacadb0">ID_AC</a>, <span class="stringliteral">&quot;bAction&quot;</span>, 1, act);
<a name="l00554"></a>00554             <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ad0f2d8efde1fdd4f81ee9fe471313bd6">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ad0f2d8efde1fdd4f81ee9fe471313bd6">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l00555"></a>00555             
<a name="l00556"></a>00556             <a class="code" href="../../d3/d68/writefile_8c.html#abfa3e21a6fe0231693de548bc5fa9171">write_fcurves</a>(wd, &amp;act-&gt;<a class="code" href="../../d1/d48/structbAction.html#a17c9f9250f377305171640e7a4aa7666">curves</a>);
<a name="l00557"></a>00557             
<a name="l00558"></a>00558             <span class="keywordflow">for</span> (grp=act-&gt;<a class="code" href="../../d1/d48/structbAction.html#a6d7358fa79f9d0feec006dd2d71c9cd4">groups</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; grp; grp=grp-&gt;<a class="code" href="../../d9/dcf/structbActionGroup.html#a572a3c6b116924498cc9d6a41c93479f">next</a>) {
<a name="l00559"></a>00559                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bActionGroup&quot;</span>, 1, grp);
<a name="l00560"></a>00560             }
<a name="l00561"></a>00561             
<a name="l00562"></a>00562             <span class="keywordflow">for</span> (marker=act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ae841959f9a22c79888ab355d652146ca">markers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; marker; marker=marker-&gt;<a class="code" href="../../d2/d3e/structTimeMarker.html#ae24b020d13fed8c505c8c6405e31d6a6">next</a>) {
<a name="l00563"></a>00563                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;TimeMarker&quot;</span>, 1, marker);
<a name="l00564"></a>00564             }
<a name="l00565"></a>00565         }
<a name="l00566"></a>00566     }
<a name="l00567"></a>00567     
<a name="l00568"></a>00568     <span class="comment">/* flush helps the compression for undo-save */</span>
<a name="l00569"></a>00569     <a class="code" href="../../d3/d68/writefile_8c.html#ad3cd0b85338465ac04a3b48cc084e1c9">mywrite</a>(wd, <a class="code" href="../../d3/d68/writefile_8c.html#ab6d466684929096461d75d8e48c455e4">MYWRITE_FLUSH</a>, 0);
<a name="l00570"></a>00570 }
<a name="l00571"></a>00571 
<a name="l00572"></a><a class="code" href="../../d3/d68/writefile_8c.html#afcb6f8f4c6c5580febf5b3865531a5c1">00572</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#afcb6f8f4c6c5580febf5b3865531a5c1">write_keyingsets</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list)
<a name="l00573"></a>00573 {
<a name="l00574"></a>00574     <a class="code" href="../../d4/d2c/structKeyingSet.html">KeyingSet</a> *ks;
<a name="l00575"></a>00575     <a class="code" href="../../dc/d37/structKS__Path.html">KS_Path</a> *ksp;
<a name="l00576"></a>00576     
<a name="l00577"></a>00577     <span class="keywordflow">for</span> (ks= list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ks; ks= ks-&gt;<a class="code" href="../../d4/d2c/structKeyingSet.html#a7ebf1a5f7b5ec817bf053a9ace717a07">next</a>) {
<a name="l00578"></a>00578         <span class="comment">/* KeyingSet */</span>
<a name="l00579"></a>00579         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;KeyingSet&quot;</span>, 1, ks);
<a name="l00580"></a>00580         
<a name="l00581"></a>00581         <span class="comment">/* Paths */</span>
<a name="l00582"></a>00582         <span class="keywordflow">for</span> (ksp= ks-&gt;<a class="code" href="../../d4/d2c/structKeyingSet.html#a886536223416f3dbc721fe77a43a350b">paths</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ksp; ksp= ksp-&gt;<a class="code" href="../../dc/d37/structKS__Path.html#a1a4c3bf627d5885bdaf1cd80f27d3811">next</a>) {
<a name="l00583"></a>00583             <span class="comment">/* Path */</span>
<a name="l00584"></a>00584             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;KS_Path&quot;</span>, 1, ksp);
<a name="l00585"></a>00585             
<a name="l00586"></a>00586             <span class="keywordflow">if</span> (ksp-&gt;<a class="code" href="../../dc/d37/structKS__Path.html#acfb7309062d511b1d49218a26cb4c85a">rna_path</a>)
<a name="l00587"></a>00587                 <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(ksp-&gt;<a class="code" href="../../dc/d37/structKS__Path.html#acfb7309062d511b1d49218a26cb4c85a">rna_path</a>)+1, ksp-&gt;<a class="code" href="../../dc/d37/structKS__Path.html#acfb7309062d511b1d49218a26cb4c85a">rna_path</a>);
<a name="l00588"></a>00588         }
<a name="l00589"></a>00589     }
<a name="l00590"></a>00590 }
<a name="l00591"></a>00591 
<a name="l00592"></a><a class="code" href="../../d3/d68/writefile_8c.html#a5ae1d0c26d0e7928c859986b7d00e63a">00592</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a5ae1d0c26d0e7928c859986b7d00e63a">write_nlastrips</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *strips)
<a name="l00593"></a>00593 {
<a name="l00594"></a>00594     <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip;
<a name="l00595"></a>00595     
<a name="l00596"></a>00596     <span class="keywordflow">for</span> (strip= strips-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip= strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a0e1bf52d90da905fbab053178c869a8e">next</a>) {
<a name="l00597"></a>00597         <span class="comment">/* write the strip first */</span>
<a name="l00598"></a>00598         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;NlaStrip&quot;</span>, 1, strip);
<a name="l00599"></a>00599         
<a name="l00600"></a>00600         <span class="comment">/* write the strip&#39;s F-Curves and modifiers */</span>
<a name="l00601"></a>00601         <a class="code" href="../../d3/d68/writefile_8c.html#abfa3e21a6fe0231693de548bc5fa9171">write_fcurves</a>(wd, &amp;strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a58b04df157b3c8b38a99ef2ac6ba7948">fcurves</a>);
<a name="l00602"></a>00602         <a class="code" href="../../d3/d68/writefile_8c.html#a116d73b135b29f117b708788061e3d9d">write_fmodifiers</a>(wd, &amp;strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ac5ddce08df422b81dfa7a65674b5b296">modifiers</a>);
<a name="l00603"></a>00603         
<a name="l00604"></a>00604         <span class="comment">/* write the strip&#39;s children */</span>
<a name="l00605"></a>00605         <a class="code" href="../../d3/d68/writefile_8c.html#a5ae1d0c26d0e7928c859986b7d00e63a">write_nlastrips</a>(wd, &amp;strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a9cc3337843773f5b953893c79784044d">strips</a>);
<a name="l00606"></a>00606     }
<a name="l00607"></a>00607 }
<a name="l00608"></a>00608 
<a name="l00609"></a><a class="code" href="../../d3/d68/writefile_8c.html#a379bc37919bc126edd3aa042e0c9c6d3">00609</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a379bc37919bc126edd3aa042e0c9c6d3">write_nladata</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nlabase)
<a name="l00610"></a>00610 {
<a name="l00611"></a>00611     <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt;
<a name="l00612"></a>00612     
<a name="l00613"></a>00613     <span class="comment">/* write all the tracks */</span>
<a name="l00614"></a>00614     <span class="keywordflow">for</span> (nlt= nlabase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nlt; nlt= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a66180948e7084122081dfb79b212764c">next</a>) {
<a name="l00615"></a>00615         <span class="comment">/* write the track first */</span>
<a name="l00616"></a>00616         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;NlaTrack&quot;</span>, 1, nlt);
<a name="l00617"></a>00617         
<a name="l00618"></a>00618         <span class="comment">/* write the track&#39;s strips */</span>
<a name="l00619"></a>00619         <a class="code" href="../../d3/d68/writefile_8c.html#a5ae1d0c26d0e7928c859986b7d00e63a">write_nlastrips</a>(wd, &amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>);
<a name="l00620"></a>00620     }
<a name="l00621"></a>00621 }
<a name="l00622"></a>00622 
<a name="l00623"></a><a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">00623</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt)
<a name="l00624"></a>00624 {
<a name="l00625"></a>00625     <a class="code" href="../../dc/dd4/structAnimOverride.html">AnimOverride</a> *aor;
<a name="l00626"></a>00626     
<a name="l00627"></a>00627     <span class="comment">/* firstly, just write the AnimData block */</span>
<a name="l00628"></a>00628     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;AnimData&quot;</span>, 1, adt);
<a name="l00629"></a>00629     
<a name="l00630"></a>00630     <span class="comment">/* write drivers */</span>
<a name="l00631"></a>00631     <a class="code" href="../../d3/d68/writefile_8c.html#abfa3e21a6fe0231693de548bc5fa9171">write_fcurves</a>(wd, &amp;adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#aaca565f031ee1209087422d8a5d77769">drivers</a>);
<a name="l00632"></a>00632     
<a name="l00633"></a>00633     <span class="comment">/* write overrides */</span>
<a name="l00634"></a>00634     <span class="comment">// FIXME: are these needed?</span>
<a name="l00635"></a>00635     <span class="keywordflow">for</span> (aor= adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a1c14e2551e5675e3ea058382ce9bdff9">overrides</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; aor; aor= aor-&gt;<a class="code" href="../../dc/dd4/structAnimOverride.html#aabb573bca6cafae07f9cfbca79db31aa">next</a>) {
<a name="l00636"></a>00636         <span class="comment">/* overrides consist of base data + rna_path */</span>
<a name="l00637"></a>00637         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;AnimOverride&quot;</span>, 1, aor);
<a name="l00638"></a>00638         <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(aor-&gt;<a class="code" href="../../dc/dd4/structAnimOverride.html#a598d655ce7000a5aa68ebea7d8e2643c">rna_path</a>)+1, aor-&gt;<a class="code" href="../../dc/dd4/structAnimOverride.html#a598d655ce7000a5aa68ebea7d8e2643c">rna_path</a>);
<a name="l00639"></a>00639     }
<a name="l00640"></a>00640     
<a name="l00641"></a>00641     <span class="comment">// TODO write the remaps (if they are needed)</span>
<a name="l00642"></a>00642     
<a name="l00643"></a>00643     <span class="comment">/* write NLA data */</span>
<a name="l00644"></a>00644     <a class="code" href="../../d3/d68/writefile_8c.html#a379bc37919bc126edd3aa042e0c9c6d3">write_nladata</a>(wd, &amp;adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#ad6e27784ea3b52a7914bc9b00a47b5c1">nla_tracks</a>);
<a name="l00645"></a>00645 }
<a name="l00646"></a>00646 
<a name="l00647"></a><a class="code" href="../../d3/d68/writefile_8c.html#a1aee9b323a690ee9d46323ade9511325">00647</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a1aee9b323a690ee9d46323ade9511325">write_curvemapping</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d4/d40/structCurveMapping.html">CurveMapping</a> *cumap)
<a name="l00648"></a>00648 {
<a name="l00649"></a>00649     <span class="keywordtype">int</span> a;
<a name="l00650"></a>00650     
<a name="l00651"></a>00651     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;CurveMapping&quot;</span>, 1, cumap);
<a name="l00652"></a>00652     <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../da/ddd/DNA__color__types_8h.html#a03be79f4468bc6e046fbc08cb1f3f98c">CM_TOT</a>; a++)
<a name="l00653"></a>00653         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;CurveMapPoint&quot;</span>, cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a5105395e92fbba51dbc60ec65fb0c390">totpoint</a>, cumap-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#abaeb35254b998c201c1957d67a757f7c">cm</a>[a].<a class="code" href="../../df/d78/structCurveMap.html#a643068e2e4257d4d70f5759a426765c8">curve</a>);
<a name="l00654"></a>00654 }
<a name="l00655"></a>00655 
<a name="l00656"></a><a class="code" href="../../d3/d68/writefile_8c.html#ad63984231a7e301c0d409f9cf4d14850">00656</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#ad63984231a7e301c0d409f9cf4d14850">write_node_socket</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock)
<a name="l00657"></a>00657 {
<a name="l00658"></a>00658     <a class="code" href="../../dd/dfb/structbNodeSocketType.html">bNodeSocketType</a> *stype= <a class="code" href="../../d4/d91/BKE__node_8h.html#a569537bca3d5248cfc2322a915803d89">ntreeGetSocketType</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>);
<a name="l00659"></a>00659 
<a name="l00660"></a>00660     <span class="comment">/* forward compatibility code, so older blenders still open */</span>
<a name="l00661"></a>00661     sock-&gt;stack_type = 1;
<a name="l00662"></a>00662     
<a name="l00663"></a>00663     <span class="keywordflow">if</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>) {
<a name="l00664"></a>00664         <a class="code" href="../../d3/d8f/structbNodeSocketValueFloat.html">bNodeSocketValueFloat</a> *valfloat;
<a name="l00665"></a>00665         <a class="code" href="../../d5/dfe/structbNodeSocketValueVector.html">bNodeSocketValueVector</a> *valvector;
<a name="l00666"></a>00666         <a class="code" href="../../de/da3/structbNodeSocketValueRGBA.html">bNodeSocketValueRGBA</a> *valrgba;
<a name="l00667"></a>00667         
<a name="l00668"></a>00668         <span class="keywordflow">switch</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>) {
<a name="l00669"></a>00669         <span class="keywordflow">case</span> <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a8e6e748887f7b8c2fa267b03e905d417">SOCK_FLOAT</a>:
<a name="l00670"></a>00670             valfloat = sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>;
<a name="l00671"></a>00671             sock-&gt;ns.vec[0] = valfloat-&gt;<a class="code" href="../../d3/d8f/structbNodeSocketValueFloat.html#a0723d7da186a1221d1529c8e0dcfabc3">value</a>;
<a name="l00672"></a>00672             sock-&gt;ns.min = valfloat-&gt;<a class="code" href="../../d3/d8f/structbNodeSocketValueFloat.html#ae221429c176b74440bf90260651ecb65">min</a>;
<a name="l00673"></a>00673             sock-&gt;ns.max = valfloat-&gt;<a class="code" href="../../d3/d8f/structbNodeSocketValueFloat.html#adf686cc74a4e5b2a80710b26b0a03826">max</a>;
<a name="l00674"></a>00674             <span class="keywordflow">break</span>;
<a name="l00675"></a>00675         <span class="keywordflow">case</span> <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aeeee9e5d8c1d14907a357b9fdf3ebbd6">SOCK_VECTOR</a>:
<a name="l00676"></a>00676             valvector = sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>;
<a name="l00677"></a>00677             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(sock-&gt;ns.vec, valvector-&gt;<a class="code" href="../../d5/dfe/structbNodeSocketValueVector.html#a6063a02dc6fda631ffc366a4beb3eea6">value</a>);
<a name="l00678"></a>00678             sock-&gt;ns.min = valvector-&gt;<a class="code" href="../../d5/dfe/structbNodeSocketValueVector.html#a0eff35590a531b8f8863a9cb472a9013">min</a>;
<a name="l00679"></a>00679             sock-&gt;ns.max = valvector-&gt;<a class="code" href="../../d5/dfe/structbNodeSocketValueVector.html#ae3721a62b3093ea625c0b46c6a370abc">max</a>;
<a name="l00680"></a>00680             <span class="keywordflow">break</span>;
<a name="l00681"></a>00681         <span class="keywordflow">case</span> <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ab154e8443a228bbc7869bde335815870">SOCK_RGBA</a>:
<a name="l00682"></a>00682             valrgba = sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>;
<a name="l00683"></a>00683             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a097c602b13da72154b19976046f63ef3">copy_v4_v4</a>(sock-&gt;ns.vec, valrgba-&gt;<a class="code" href="../../de/da3/structbNodeSocketValueRGBA.html#aa786ca78ea273e1d4604dae181d71ab3">value</a>);
<a name="l00684"></a>00684             sock-&gt;ns.min = 0.0f;
<a name="l00685"></a>00685             sock-&gt;ns.max = 1.0f;
<a name="l00686"></a>00686             <span class="keywordflow">break</span>;
<a name="l00687"></a>00687         }
<a name="l00688"></a>00688     }
<a name="l00689"></a>00689 
<a name="l00690"></a>00690     <span class="comment">/* actual socket writing */</span>
<a name="l00691"></a>00691     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bNodeSocket&quot;</span>, 1, sock);
<a name="l00692"></a>00692     <span class="keywordflow">if</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>)
<a name="l00693"></a>00693         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, stype-&gt;<a class="code" href="../../dd/dfb/structbNodeSocketType.html#a546dd2689c791f64e19780618b96fe33">value_structname</a>, 1, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>);
<a name="l00694"></a>00694 }
<a name="l00695"></a>00695 
<a name="l00696"></a>00696 <span class="comment">/* this is only direct data, tree itself should have been written */</span>
<a name="l00697"></a><a class="code" href="../../d3/d68/writefile_8c.html#af9f71b9a5851076e655198986376e392">00697</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#af9f71b9a5851076e655198986376e392">write_nodetree</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00698"></a>00698 {
<a name="l00699"></a>00699     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00700"></a>00700     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00701"></a>00701     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l00702"></a>00702     
<a name="l00703"></a>00703     <span class="comment">/* for link_list() speed, we write per list */</span>
<a name="l00704"></a>00704     
<a name="l00705"></a>00705     <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#af6b8d484e7c71deb7a35e939800d54b5">adt</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(wd, ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#af6b8d484e7c71deb7a35e939800d54b5">adt</a>);
<a name="l00706"></a>00706     
<a name="l00707"></a>00707     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l00708"></a>00708         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bNode&quot;</span>, 1, node);
<a name="l00709"></a>00709 
<a name="l00710"></a>00710     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00711"></a>00711         <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00712"></a>00712             <a class="code" href="../../d3/d68/writefile_8c.html#ad63984231a7e301c0d409f9cf4d14850">write_node_socket</a>(wd, sock);
<a name="l00713"></a>00713         <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00714"></a>00714             <a class="code" href="../../d3/d68/writefile_8c.html#ad63984231a7e301c0d409f9cf4d14850">write_node_socket</a>(wd, sock);
<a name="l00715"></a>00715 
<a name="l00716"></a>00716         
<a name="l00717"></a>00717         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a> &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>!=<a class="code" href="../../d4/d91/BKE__node_8h.html#a2c68ef059534ec7a55087732345e875e">NODE_DYNAMIC</a>) {
<a name="l00718"></a>00718             <span class="comment">/* could be handlerized at some point, now only 1 exception still */</span>
<a name="l00719"></a>00719             <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a> &amp;&amp; (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a685d54959d3865af92b2902f073a38a5">SH_NODE_CURVE_VEC</a> || node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#ab4d352843431523db9be44e241247029">SH_NODE_CURVE_RGB</a>))
<a name="l00720"></a>00720                 <a class="code" href="../../d3/d68/writefile_8c.html#a1aee9b323a690ee9d46323ade9511325">write_curvemapping</a>(wd, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>);
<a name="l00721"></a>00721             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a> &amp;&amp; <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0388eda1f65113c4a15720e037c11cb4">ELEM4</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a938bbac603bea1f1790cfe6ec45ce121">CMP_NODE_TIME</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a837e7c0b2a241e438be5cbd6dc0d16d0">CMP_NODE_CURVE_VEC</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#aa32ec823eb8b629ad8adcd886553bf49">CMP_NODE_CURVE_RGB</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a6f5bd8f57b461853c73f9c740e254de0">CMP_NODE_HUECORRECT</a>))
<a name="l00722"></a>00722                 <a class="code" href="../../d3/d68/writefile_8c.html#a1aee9b323a690ee9d46323ade9511325">write_curvemapping</a>(wd, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>);
<a name="l00723"></a>00723             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a2a2ccfad1cf200204b0fdd594f45de7b">NTREE_TEXTURE</a> &amp;&amp; (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a09e4e447d3a445a4256fee63e6e58047">TEX_NODE_CURVE_RGB</a> || node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#ac5181d9fdffdb83ef75531cc878b0722">TEX_NODE_CURVE_TIME</a>) )
<a name="l00724"></a>00724                 <a class="code" href="../../d3/d68/writefile_8c.html#a1aee9b323a690ee9d46323ade9511325">write_curvemapping</a>(wd, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>);
<a name="l00725"></a>00725             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a> &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a7a7174378c79e98cd046514c9565a7b2">CMP_NODE_MOVIEDISTORTION</a>)
<a name="l00726"></a>00726                 <span class="comment">/* pass */</span>;
<a name="l00727"></a>00727             <span class="keywordflow">else</span>
<a name="l00728"></a>00728                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ad290e73f9d347f1f586d3f7ead86ce49">storagename</a>, 1, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>);
<a name="l00729"></a>00729         }
<a name="l00730"></a>00730         
<a name="l00731"></a>00731         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#a993ae4ed5e6e026e42a3f81b3ef71787">CMP_NODE_OUTPUT_FILE</a>) {
<a name="l00732"></a>00732             <span class="comment">/* inputs have own storage data */</span>
<a name="l00733"></a>00733             <span class="keywordflow">for</span> (sock=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00734"></a>00734                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;NodeImageMultiFileSocket&quot;</span>, 1, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a16dd98d87c594f25bb0676986a13dd9e">storage</a>);
<a name="l00735"></a>00735         }
<a name="l00736"></a>00736     }
<a name="l00737"></a>00737     
<a name="l00738"></a>00738     <span class="keywordflow">for</span> (link= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>)
<a name="l00739"></a>00739         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bNodeLink&quot;</span>, 1, link);
<a name="l00740"></a>00740     
<a name="l00741"></a>00741     <span class="comment">/* external sockets */</span>
<a name="l00742"></a>00742     <span class="keywordflow">for</span> (sock= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00743"></a>00743         <a class="code" href="../../d3/d68/writefile_8c.html#ad63984231a7e301c0d409f9cf4d14850">write_node_socket</a>(wd, sock);
<a name="l00744"></a>00744     <span class="keywordflow">for</span> (sock= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00745"></a>00745         <a class="code" href="../../d3/d68/writefile_8c.html#ad63984231a7e301c0d409f9cf4d14850">write_node_socket</a>(wd, sock);
<a name="l00746"></a>00746 }
<a name="l00747"></a>00747 
<a name="l00748"></a><a class="code" href="../../d3/d68/writefile_8c.html#afe872d7fd194b581e3aa69f05a1f0630">00748</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#afe872d7fd194b581e3aa69f05a1f0630">current_screen_compat</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> **screen)
<a name="l00749"></a>00749 {
<a name="l00750"></a>00750     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm;
<a name="l00751"></a>00751     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *window;
<a name="l00752"></a>00752 
<a name="l00753"></a>00753     <span class="comment">/* find a global current screen in the first open window, to have</span>
<a name="l00754"></a>00754 <span class="comment">     * a reasonable default for reading in older versions */</span>
<a name="l00755"></a>00755     wm= mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a1c415972a9fb2c7ce05e14d83affa0d8">wm</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00756"></a>00756     window= (wm)? wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>: <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00757"></a>00757     *screen= (window)? window-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>: <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00758"></a>00758 }
<a name="l00759"></a>00759 
<a name="l00760"></a><a class="code" href="../../dc/d75/structRenderInfo.html">00760</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../dc/d75/structRenderInfo.html">RenderInfo</a> {
<a name="l00761"></a><a class="code" href="../../dc/d75/structRenderInfo.html#acb1cf06a8cfa2803518e3f34a85a4e17">00761</a>     <span class="keywordtype">int</span> <a class="code" href="../../dc/d75/structRenderInfo.html#acb1cf06a8cfa2803518e3f34a85a4e17">sfra</a>;
<a name="l00762"></a><a class="code" href="../../dc/d75/structRenderInfo.html#a93ed2920be0eec6df7db89431c40d983">00762</a>     <span class="keywordtype">int</span> <a class="code" href="../../dc/d75/structRenderInfo.html#a93ed2920be0eec6df7db89431c40d983">efra</a>;
<a name="l00763"></a><a class="code" href="../../dc/d75/structRenderInfo.html#a91c085ae0eb21108cd29c0257344c90d">00763</a>     <span class="keywordtype">char</span> <a class="code" href="../../dc/d75/structRenderInfo.html#a91c085ae0eb21108cd29c0257344c90d">scene_name</a>[<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6d7bce2e9ad79af316c9690a5b84b75c">MAX_ID_NAME</a> - 2];
<a name="l00764"></a>00764 } <a class="code" href="../../d3/d68/writefile_8c.html#af61d1de31ba3cc75111c37bf6f743b45">RenderInfo</a>;
<a name="l00765"></a>00765 
<a name="l00766"></a><a class="code" href="../../d3/d68/writefile_8c.html#a5dea49377cc65c467c6322edbd362b76">00766</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a5dea49377cc65c467c6322edbd362b76">write_renderinfo</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar)      <span class="comment">/* for renderdeamon */</span>
<a name="l00767"></a>00767 {
<a name="l00768"></a>00768     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *curscreen;
<a name="l00769"></a>00769     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l00770"></a>00770     <a class="code" href="../../dc/d75/structRenderInfo.html">RenderInfo</a> <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l00771"></a>00771 
<a name="l00772"></a>00772     <span class="comment">/* XXX in future, handle multiple windows with multiple screnes? */</span>
<a name="l00773"></a>00773     <a class="code" href="../../d3/d68/writefile_8c.html#afe872d7fd194b581e3aa69f05a1f0630">current_screen_compat</a>(mainvar, &amp;curscreen);
<a name="l00774"></a>00774 
<a name="l00775"></a>00775     <span class="keywordflow">for</span> (sce= mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l00776"></a>00776         <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>  &amp;&amp; ( sce==curscreen-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a> || (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad853a19c13a6c728a07b82fbb9f52bc6">scemode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a73d0c7e0633bcce79ae0e793cf0be903">R_BG_RENDER</a>)) ) {
<a name="l00777"></a>00777             data.<a class="code" href="../../dc/d75/structRenderInfo.html#acb1cf06a8cfa2803518e3f34a85a4e17">sfra</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a97f52582406befb3dba13b121d886526">sfra</a>;
<a name="l00778"></a>00778             data.<a class="code" href="../../dc/d75/structRenderInfo.html#a93ed2920be0eec6df7db89431c40d983">efra</a> = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#af94766d58b62a533f851ce3f42ce026c">efra</a>;
<a name="l00779"></a>00779             memset(data.<a class="code" href="../../dc/d75/structRenderInfo.html#a91c085ae0eb21108cd29c0257344c90d">scene_name</a>, 0, <span class="keyword">sizeof</span>(data.<a class="code" href="../../dc/d75/structRenderInfo.html#a91c085ae0eb21108cd29c0257344c90d">scene_name</a>));
<a name="l00780"></a>00780 
<a name="l00781"></a>00781             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(data.<a class="code" href="../../dc/d75/structRenderInfo.html#a91c085ae0eb21108cd29c0257344c90d">scene_name</a>, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a> + 2, <span class="keyword">sizeof</span>(data.<a class="code" href="../../dc/d75/structRenderInfo.html#a91c085ae0eb21108cd29c0257344c90d">scene_name</a>));
<a name="l00782"></a>00782 
<a name="l00783"></a>00783             <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a717326380225f15b6c722685151c200f">REND</a>, <span class="keyword">sizeof</span>(data), &amp;data);
<a name="l00784"></a>00784         }
<a name="l00785"></a>00785     }
<a name="l00786"></a>00786 }
<a name="l00787"></a>00787 
<a name="l00788"></a><a class="code" href="../../d3/d68/writefile_8c.html#a6dc9c75c76bc780c8906927ecab33db9">00788</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a6dc9c75c76bc780c8906927ecab33db9">write_keymapitem</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d1/d5e/structwmKeyMapItem.html">wmKeyMapItem</a> *kmi)
<a name="l00789"></a>00789 {
<a name="l00790"></a>00790     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;wmKeyMapItem&quot;</span>, 1, kmi);
<a name="l00791"></a>00791     <span class="keywordflow">if</span> (kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#af438f7c1ba87d767332b810e2711ac14">properties</a>)
<a name="l00792"></a>00792         <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#af438f7c1ba87d767332b810e2711ac14">properties</a>, wd);
<a name="l00793"></a>00793 }
<a name="l00794"></a>00794 
<a name="l00795"></a><a class="code" href="../../d3/d68/writefile_8c.html#ac9025aa72886ad9d2bdc31f9cd26216b">00795</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#ac9025aa72886ad9d2bdc31f9cd26216b">write_userdef</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd)
<a name="l00796"></a>00796 {
<a name="l00797"></a>00797     <a class="code" href="../../d3/d85/structbTheme.html">bTheme</a> *btheme;
<a name="l00798"></a>00798     <a class="code" href="../../d3/d90/structwmKeyMap.html">wmKeyMap</a> *keymap;
<a name="l00799"></a>00799     <a class="code" href="../../d1/d5e/structwmKeyMapItem.html">wmKeyMapItem</a> *kmi;
<a name="l00800"></a>00800     <a class="code" href="../../d8/d86/structwmKeyMapDiffItem.html">wmKeyMapDiffItem</a> *kmdi;
<a name="l00801"></a>00801     <a class="code" href="../../d4/d04/structbAddon.html">bAddon</a> *bext;
<a name="l00802"></a>00802     <a class="code" href="../../d3/d28/structuiStyle.html">uiStyle</a> *style;
<a name="l00803"></a>00803     
<a name="l00804"></a>00804     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../dd/d8b/intern_2opennl_2superlu_2util_8h.html#a494fe72ce954689dd95399ea9f1d87f6ae2d30a195cee6b2961cc2c23ea4b520b">USER</a>, <span class="stringliteral">&quot;UserDef&quot;</span>, 1, &amp;<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>);
<a name="l00805"></a>00805 
<a name="l00806"></a>00806     <span class="keywordflow">for</span> (btheme= <a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.themes.first; btheme; btheme=btheme-&gt;<a class="code" href="../../d3/d85/structbTheme.html#a4d1b053df2aa3ada046b7f669f1a3732">next</a>)
<a name="l00807"></a>00807         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bTheme&quot;</span>, 1, btheme);
<a name="l00808"></a>00808 
<a name="l00809"></a>00809     <span class="keywordflow">for</span> (keymap= <a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.user_keymaps.first; keymap; keymap=keymap-&gt;<a class="code" href="../../d3/d90/structwmKeyMap.html#ac3bb52f35350d40470edbeadb43f2bba">next</a>) {
<a name="l00810"></a>00810         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;wmKeyMap&quot;</span>, 1, keymap);
<a name="l00811"></a>00811 
<a name="l00812"></a>00812         <span class="keywordflow">for</span> (kmdi=keymap-&gt;<a class="code" href="../../d3/d90/structwmKeyMap.html#a7177a12403442c4ced5970fbc30eba7b">diff_items</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; kmdi; kmdi=kmdi-&gt;<a class="code" href="../../d8/d86/structwmKeyMapDiffItem.html#a8c54a042e7cc06a68be027eca355398e">next</a>) {
<a name="l00813"></a>00813             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;wmKeyMapDiffItem&quot;</span>, 1, kmdi);
<a name="l00814"></a>00814             <span class="keywordflow">if</span> (kmdi-&gt;<a class="code" href="../../d8/d86/structwmKeyMapDiffItem.html#a036ecd7f91293d701d03985bab2094e2">remove_item</a>)
<a name="l00815"></a>00815                 <a class="code" href="../../d3/d68/writefile_8c.html#a6dc9c75c76bc780c8906927ecab33db9">write_keymapitem</a>(wd, kmdi-&gt;<a class="code" href="../../d8/d86/structwmKeyMapDiffItem.html#a036ecd7f91293d701d03985bab2094e2">remove_item</a>);
<a name="l00816"></a>00816             <span class="keywordflow">if</span> (kmdi-&gt;<a class="code" href="../../d8/d86/structwmKeyMapDiffItem.html#a7ffaea212b8e4e053246bacb0c04c902">add_item</a>)
<a name="l00817"></a>00817                 <a class="code" href="../../d3/d68/writefile_8c.html#a6dc9c75c76bc780c8906927ecab33db9">write_keymapitem</a>(wd, kmdi-&gt;<a class="code" href="../../d8/d86/structwmKeyMapDiffItem.html#a7ffaea212b8e4e053246bacb0c04c902">add_item</a>);
<a name="l00818"></a>00818         }
<a name="l00819"></a>00819 
<a name="l00820"></a>00820         <span class="keywordflow">for</span> (kmi=keymap-&gt;<a class="code" href="../../d3/d90/structwmKeyMap.html#a0ae48f8a4481c3faf008d60d6d61b4ad">items</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; kmi; kmi=kmi-&gt;<a class="code" href="../../d1/d5e/structwmKeyMapItem.html#a5cb105349fd3c21f73142d637602a75e">next</a>)
<a name="l00821"></a>00821             <a class="code" href="../../d3/d68/writefile_8c.html#a6dc9c75c76bc780c8906927ecab33db9">write_keymapitem</a>(wd, kmi);
<a name="l00822"></a>00822     }
<a name="l00823"></a>00823 
<a name="l00824"></a>00824     <span class="keywordflow">for</span> (bext= <a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.addons.first; bext; bext=bext-&gt;<a class="code" href="../../d4/d04/structbAddon.html#a6a000631cddcc75971a25bdf69cb4757">next</a>)
<a name="l00825"></a>00825         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bAddon&quot;</span>, 1, bext);
<a name="l00826"></a>00826     
<a name="l00827"></a>00827     <span class="keywordflow">for</span> (style= <a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.uistyles.first; style; style= style-&gt;<a class="code" href="../../d3/d28/structuiStyle.html#a258a5d5db26480d6eecb17d916839bef">next</a>) {
<a name="l00828"></a>00828         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;uiStyle&quot;</span>, 1, style);
<a name="l00829"></a>00829     }
<a name="l00830"></a>00830 }
<a name="l00831"></a>00831 
<a name="l00832"></a><a class="code" href="../../d3/d68/writefile_8c.html#a9a8fc5f231a13fd9078c3a88f126ee1e">00832</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a9a8fc5f231a13fd9078c3a88f126ee1e">write_boid_state</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../db/dfa/structBoidState.html">BoidState</a> *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>)
<a name="l00833"></a>00833 {
<a name="l00834"></a>00834     <a class="code" href="../../d5/d08/structBoidRule.html">BoidRule</a> *rule = state-&gt;<a class="code" href="../../db/dfa/structBoidState.html#ad8d710f50d63b84e59b358315bc9fa92">rules</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00835"></a>00835     <span class="comment">//BoidCondition *cond = state-&gt;conditions.first;</span>
<a name="l00836"></a>00836 
<a name="l00837"></a>00837     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;BoidState&quot;</span>, 1, state);
<a name="l00838"></a>00838 
<a name="l00839"></a>00839     <span class="keywordflow">for</span> (; rule; rule=rule-&gt;<a class="code" href="../../d5/d08/structBoidRule.html#a707cfdd3651380709dfae04c2b06e76d">next</a>) {
<a name="l00840"></a>00840         <span class="keywordflow">switch</span>(rule-&gt;<a class="code" href="../../d5/d08/structBoidRule.html#a6859c7ccbdf3d1f77e1542a4afa2e1fa">type</a>) {
<a name="l00841"></a>00841             <span class="keywordflow">case</span> <a class="code" href="../../d8/dbb/DNA__boid__types_8h.html#a186fa849c8c3a6efa9ca9d740700efe9a567af3edd59fbaac9798e90869c20dad">eBoidRuleType_Goal</a>:
<a name="l00842"></a>00842             <span class="keywordflow">case</span> <a class="code" href="../../d8/dbb/DNA__boid__types_8h.html#a186fa849c8c3a6efa9ca9d740700efe9ab006cc1f787b3169a73527d00fd64d9d">eBoidRuleType_Avoid</a>:
<a name="l00843"></a>00843                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;BoidRuleGoalAvoid&quot;</span>, 1, rule);
<a name="l00844"></a>00844                 <span class="keywordflow">break</span>;
<a name="l00845"></a>00845             <span class="keywordflow">case</span> <a class="code" href="../../d8/dbb/DNA__boid__types_8h.html#a186fa849c8c3a6efa9ca9d740700efe9ae17c40263cf11e06645723cc0a924efd">eBoidRuleType_AvoidCollision</a>:
<a name="l00846"></a>00846                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;BoidRuleAvoidCollision&quot;</span>, 1, rule);
<a name="l00847"></a>00847                 <span class="keywordflow">break</span>;
<a name="l00848"></a>00848             <span class="keywordflow">case</span> <a class="code" href="../../d8/dbb/DNA__boid__types_8h.html#a186fa849c8c3a6efa9ca9d740700efe9ad43d583c8f8b59c3bfbed5abcb766d53">eBoidRuleType_FollowLeader</a>:
<a name="l00849"></a>00849                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;BoidRuleFollowLeader&quot;</span>, 1, rule);
<a name="l00850"></a>00850                 <span class="keywordflow">break</span>;
<a name="l00851"></a>00851             <span class="keywordflow">case</span> <a class="code" href="../../d8/dbb/DNA__boid__types_8h.html#a186fa849c8c3a6efa9ca9d740700efe9aefd00179b2b6f3cc5b7b6dac2ff4b0b6">eBoidRuleType_AverageSpeed</a>:
<a name="l00852"></a>00852                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;BoidRuleAverageSpeed&quot;</span>, 1, rule);
<a name="l00853"></a>00853                 <span class="keywordflow">break</span>;
<a name="l00854"></a>00854             <span class="keywordflow">case</span> <a class="code" href="../../d8/dbb/DNA__boid__types_8h.html#a186fa849c8c3a6efa9ca9d740700efe9a967483f663ea043111343fbd721d912e">eBoidRuleType_Fight</a>:
<a name="l00855"></a>00855                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;BoidRuleFight&quot;</span>, 1, rule);
<a name="l00856"></a>00856                 <span class="keywordflow">break</span>;
<a name="l00857"></a>00857             <span class="keywordflow">default</span>:
<a name="l00858"></a>00858                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;BoidRule&quot;</span>, 1, rule);
<a name="l00859"></a>00859                 <span class="keywordflow">break</span>;
<a name="l00860"></a>00860         }
<a name="l00861"></a>00861     }
<a name="l00862"></a>00862     <span class="comment">//for (; cond; cond=cond-&gt;next)</span>
<a name="l00863"></a>00863     <span class="comment">//  writestruct(wd, DATA, &quot;BoidCondition&quot;, 1, cond);</span>
<a name="l00864"></a>00864 }
<a name="l00865"></a>00865 
<a name="l00866"></a>00866 <span class="comment">/* update this also to readfile.c */</span>
<a name="l00867"></a><a class="code" href="../../d3/d68/writefile_8c.html#abe729f5b3b9c12c02a97324c0b937553">00867</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d3/d68/writefile_8c.html#abe729f5b3b9c12c02a97324c0b937553">ptcache_data_struct</a>[] = {
<a name="l00868"></a>00868     <span class="stringliteral">&quot;&quot;</span>, <span class="comment">// BPHYS_DATA_INDEX</span>
<a name="l00869"></a>00869     <span class="stringliteral">&quot;&quot;</span>, <span class="comment">// BPHYS_DATA_LOCATION</span>
<a name="l00870"></a>00870     <span class="stringliteral">&quot;&quot;</span>, <span class="comment">// BPHYS_DATA_VELOCITY</span>
<a name="l00871"></a>00871     <span class="stringliteral">&quot;&quot;</span>, <span class="comment">// BPHYS_DATA_ROTATION</span>
<a name="l00872"></a>00872     <span class="stringliteral">&quot;&quot;</span>, <span class="comment">// BPHYS_DATA_AVELOCITY / BPHYS_DATA_XCONST */</span>
<a name="l00873"></a>00873     <span class="stringliteral">&quot;&quot;</span>, <span class="comment">// BPHYS_DATA_SIZE:</span>
<a name="l00874"></a>00874     <span class="stringliteral">&quot;&quot;</span>, <span class="comment">// BPHYS_DATA_TIMES:    </span>
<a name="l00875"></a>00875     <span class="stringliteral">&quot;BoidData&quot;</span> <span class="comment">// case BPHYS_DATA_BOIDS:</span>
<a name="l00876"></a>00876 };
<a name="l00877"></a><a class="code" href="../../d3/d68/writefile_8c.html#a7470cb4204cc6afc9ef1fdf0d62f3775">00877</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d3/d68/writefile_8c.html#a7470cb4204cc6afc9ef1fdf0d62f3775">ptcache_extra_struct</a>[] = {
<a name="l00878"></a>00878     <span class="stringliteral">&quot;&quot;</span>,
<a name="l00879"></a>00879     <span class="stringliteral">&quot;ParticleSpring&quot;</span>
<a name="l00880"></a>00880 };
<a name="l00881"></a><a class="code" href="../../d3/d68/writefile_8c.html#ae28ccd4bcfe8fe74737f6b6ad72ba73d">00881</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#ae28ccd4bcfe8fe74737f6b6ad72ba73d">write_pointcaches</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *ptcaches)
<a name="l00882"></a>00882 {
<a name="l00883"></a>00883     <a class="code" href="../../d6/d83/structPointCache.html">PointCache</a> *cache = ptcaches-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00884"></a>00884     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00885"></a>00885 
<a name="l00886"></a>00886     <span class="keywordflow">for</span> (; cache; cache=cache-&gt;<a class="code" href="../../d6/d83/structPointCache.html#a3689f725d54309e1b00a3b06ac0561a5">next</a>) {
<a name="l00887"></a>00887         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;PointCache&quot;</span>, 1, cache);
<a name="l00888"></a>00888 
<a name="l00889"></a>00889         <span class="keywordflow">if</span> ((cache-&gt;<a class="code" href="../../d6/d83/structPointCache.html#ae601ac8693d0881eb5da61700e84cf2d">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a4dfd845afe48aca448b8bbcef971cc5d">PTCACHE_DISK_CACHE</a>)==0) {
<a name="l00890"></a>00890             <a class="code" href="../../d0/d5b/structPTCacheMem.html">PTCacheMem</a> *pm = cache-&gt;<a class="code" href="../../d6/d83/structPointCache.html#a52981831e4870022ca700f626e4aae02">mem_cache</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00891"></a>00891 
<a name="l00892"></a>00892             <span class="keywordflow">for</span> (; pm; pm=pm-&gt;<a class="code" href="../../d0/d5b/structPTCacheMem.html#aae9b8467a9815e66d4568c26d7569196">next</a>) {
<a name="l00893"></a>00893                 <a class="code" href="../../d2/d97/structPTCacheExtra.html">PTCacheExtra</a> *extra = pm-&gt;<a class="code" href="../../d0/d5b/structPTCacheMem.html#a85b85c1fd14f7a8d9c467857ae274907">extradata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00894"></a>00894 
<a name="l00895"></a>00895                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;PTCacheMem&quot;</span>, 1, pm);
<a name="l00896"></a>00896                 
<a name="l00897"></a>00897                 <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d2/d60/DNA__object__force_8h.html#ad17b7c27ab6c314200ba5b6fe5d59e41">BPHYS_TOT_DATA</a>; i++) {
<a name="l00898"></a>00898                     <span class="keywordflow">if</span> (pm-&gt;<a class="code" href="../../d0/d5b/structPTCacheMem.html#a3e23164e2c5e315cbe28e185d046b616">data</a>[i] &amp;&amp; pm-&gt;<a class="code" href="../../d0/d5b/structPTCacheMem.html#a40aded037f759b90f45e0454c99745d3">data_types</a> &amp; (1&lt;&lt;i)) {
<a name="l00899"></a>00899                         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d68/writefile_8c.html#abe729f5b3b9c12c02a97324c0b937553">ptcache_data_struct</a>[i][0]==<span class="charliteral">&#39;\0&#39;</span>)
<a name="l00900"></a>00900                             <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <a class="code" href="../../da/d2b/mallocn_8c.html#a7d1e6a2f5f9d271452a168d3a637d91f">MEM_allocN_len</a>(pm-&gt;<a class="code" href="../../d0/d5b/structPTCacheMem.html#a3e23164e2c5e315cbe28e185d046b616">data</a>[i]), pm-&gt;<a class="code" href="../../d0/d5b/structPTCacheMem.html#a3e23164e2c5e315cbe28e185d046b616">data</a>[i]);
<a name="l00901"></a>00901                         <span class="keywordflow">else</span>
<a name="l00902"></a>00902                             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <a class="code" href="../../d3/d68/writefile_8c.html#abe729f5b3b9c12c02a97324c0b937553">ptcache_data_struct</a>[i], pm-&gt;<a class="code" href="../../d0/d5b/structPTCacheMem.html#aeddf4801bb286f61979cfc4a757a42fc">totpoint</a>, pm-&gt;<a class="code" href="../../d0/d5b/structPTCacheMem.html#a3e23164e2c5e315cbe28e185d046b616">data</a>[i]);
<a name="l00903"></a>00903                     }
<a name="l00904"></a>00904                 }
<a name="l00905"></a>00905 
<a name="l00906"></a>00906                 <span class="keywordflow">for</span> (; extra; extra=extra-&gt;<a class="code" href="../../d2/d97/structPTCacheExtra.html#a652f1bab30cf02b3519b372fc168c5bf">next</a>) {
<a name="l00907"></a>00907                     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d68/writefile_8c.html#a7470cb4204cc6afc9ef1fdf0d62f3775">ptcache_extra_struct</a>[extra-&gt;<a class="code" href="../../d2/d97/structPTCacheExtra.html#a004990f648d1650da45b84e9d8449e49">type</a>][0]==<span class="charliteral">&#39;\0&#39;</span>)
<a name="l00908"></a>00908                         <span class="keywordflow">continue</span>;
<a name="l00909"></a>00909                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;PTCacheExtra&quot;</span>, 1, extra);
<a name="l00910"></a>00910                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <a class="code" href="../../d3/d68/writefile_8c.html#a7470cb4204cc6afc9ef1fdf0d62f3775">ptcache_extra_struct</a>[extra-&gt;<a class="code" href="../../d2/d97/structPTCacheExtra.html#a004990f648d1650da45b84e9d8449e49">type</a>], extra-&gt;<a class="code" href="../../d2/d97/structPTCacheExtra.html#a5721f1f62572a0c917b242e9d90c3471">totdata</a>, extra-&gt;<a class="code" href="../../d2/d97/structPTCacheExtra.html#a1cd2313d6b40822712c6d68e0ca2161e">data</a>);
<a name="l00911"></a>00911                 }
<a name="l00912"></a>00912             }
<a name="l00913"></a>00913         }
<a name="l00914"></a>00914     }
<a name="l00915"></a>00915 }
<a name="l00916"></a><a class="code" href="../../d3/d68/writefile_8c.html#a3600e256e59da7f0fd7db92e5448dd0a">00916</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a3600e256e59da7f0fd7db92e5448dd0a">write_particlesettings</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l00917"></a>00917 {
<a name="l00918"></a>00918     <a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *part;
<a name="l00919"></a>00919     <a class="code" href="../../d3/dcf/structParticleDupliWeight.html">ParticleDupliWeight</a> *dw;
<a name="l00920"></a>00920     <a class="code" href="../../d3/d3b/structGroupObject.html">GroupObject</a> *go;
<a name="l00921"></a>00921     <span class="keywordtype">int</span> a;
<a name="l00922"></a>00922 
<a name="l00923"></a>00923     part= idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00924"></a>00924     <span class="keywordflow">while</span> (part) {
<a name="l00925"></a>00925         <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l00926"></a>00926             <span class="comment">/* write LibData */</span>
<a name="l00927"></a>00927             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa64d54c8b860f4a2c7cabc743f60512e">ID_PA</a>, <span class="stringliteral">&quot;ParticleSettings&quot;</span>, 1, part);
<a name="l00928"></a>00928             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l00929"></a>00929             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a35cf38441722e9b029ac80ee28f63031">adt</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(wd, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a35cf38441722e9b029ac80ee28f63031">adt</a>);
<a name="l00930"></a>00930             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;PartDeflect&quot;</span>, 1, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a9965e362e000f08c1a31e1a2562a1f07">pd</a>);
<a name="l00931"></a>00931             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;PartDeflect&quot;</span>, 1, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a1aa83e96a67b415c2aac979ad485f9e0">pd2</a>);
<a name="l00932"></a>00932             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;EffectorWeights&quot;</span>, 1, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a82846291d135c6395249f60253e2ce9d">effector_weights</a>);
<a name="l00933"></a>00933 
<a name="l00934"></a>00934             dw = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#adf0b066bbde2818c4d7f2a46d93b4ce7">dupliweights</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00935"></a>00935             <span class="keywordflow">for</span> (; dw; dw=dw-&gt;<a class="code" href="../../d3/dcf/structParticleDupliWeight.html#affc8c044db3cd1c708731828c8e9743d">next</a>) {
<a name="l00936"></a>00936                 <span class="comment">/* update indices */</span>
<a name="l00937"></a>00937                 dw-&gt;<a class="code" href="../../d3/dcf/structParticleDupliWeight.html#aa373b027f15ca7bb69ea3392fbfaad47">index</a> = 0;
<a name="l00938"></a>00938                 <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#af148cd19be57f2825db82cb9c453e682">dup_group</a>) { <span class="comment">/* can be NULL if lining fails or set to None */</span>
<a name="l00939"></a>00939                     go = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#af148cd19be57f2825db82cb9c453e682">dup_group</a>-&gt;<a class="code" href="../../d4/d91/structGroup.html#ad757bf69b6fd15b1d4e0980089d13be1">gobject</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00940"></a>00940                     <span class="keywordflow">while</span> (go &amp;&amp; go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a> != dw-&gt;<a class="code" href="../../d3/dcf/structParticleDupliWeight.html#ad432ad4d7384e0040c2c03ea43bbeb07">ob</a>) {
<a name="l00941"></a>00941                         go=go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#a81e7437ba90ec95c5fbb96e17e6a203d">next</a>;
<a name="l00942"></a>00942                         dw-&gt;<a class="code" href="../../d3/dcf/structParticleDupliWeight.html#aa373b027f15ca7bb69ea3392fbfaad47">index</a>++;
<a name="l00943"></a>00943                     }
<a name="l00944"></a>00944                 }
<a name="l00945"></a>00945                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ParticleDupliWeight&quot;</span>, 1, dw);
<a name="l00946"></a>00946             }
<a name="l00947"></a>00947 
<a name="l00948"></a>00948             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7f6ac08c9c2f17012eb0b626b91c040f">boids</a> &amp;&amp; part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a4868871c1c1ba91bd42b97081be0f76a">phystype</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a632b70a25b43cdad1aad17d2cd9a2c53">PART_PHYS_BOIDS</a>) {
<a name="l00949"></a>00949                 <a class="code" href="../../db/dfa/structBoidState.html">BoidState</a> *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a> = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7f6ac08c9c2f17012eb0b626b91c040f">boids</a>-&gt;<a class="code" href="../../dd/d94/structBoidSettings.html#a632b0e4786d070f07183c7659cac4444">states</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00950"></a>00950 
<a name="l00951"></a>00951                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;BoidSettings&quot;</span>, 1, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7f6ac08c9c2f17012eb0b626b91c040f">boids</a>);
<a name="l00952"></a>00952 
<a name="l00953"></a>00953                 <span class="keywordflow">for</span> (; <a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>; state=state-&gt;<a class="code" href="../../db/dfa/structBoidState.html#ae6d686752198cc7b700f9304cd6d3235">next</a>)
<a name="l00954"></a>00954                     <a class="code" href="../../d3/d68/writefile_8c.html#a9a8fc5f231a13fd9078c3a88f126ee1e">write_boid_state</a>(wd, state);
<a name="l00955"></a>00955             }
<a name="l00956"></a>00956             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ada8ff094092deeef0d812a97ab310a08">fluid</a> &amp;&amp; part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a4868871c1c1ba91bd42b97081be0f76a">phystype</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a5fa3865af8588ad97dc9b94b9fcc4e23">PART_PHYS_FLUID</a>) {
<a name="l00957"></a>00957                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SPHFluidSettings&quot;</span>, 1, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ada8ff094092deeef0d812a97ab310a08">fluid</a>); 
<a name="l00958"></a>00958             }
<a name="l00959"></a>00959 
<a name="l00960"></a>00960             <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l00961"></a>00961                 <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a92d6a0f7010711f045efc7d9b4b8478b">mtex</a>[a]) <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;MTex&quot;</span>, 1, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a92d6a0f7010711f045efc7d9b4b8478b">mtex</a>[a]);
<a name="l00962"></a>00962             }
<a name="l00963"></a>00963         }
<a name="l00964"></a>00964         part= part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l00965"></a>00965     }
<a name="l00966"></a>00966 }
<a name="l00967"></a><a class="code" href="../../d3/d68/writefile_8c.html#a5f7aca929e4c2ec1ce2241ccf4479125">00967</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a5f7aca929e4c2ec1ce2241ccf4479125">write_particlesystems</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *particles)
<a name="l00968"></a>00968 {
<a name="l00969"></a>00969     <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys= particles-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00970"></a>00970     <a class="code" href="../../df/db9/structParticleTarget.html">ParticleTarget</a> *pt;
<a name="l00971"></a>00971     <span class="keywordtype">int</span> a;
<a name="l00972"></a>00972 
<a name="l00973"></a>00973     <span class="keywordflow">for</span> (; psys; psys=psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a734228c70c56227c6f7a29145a5f5b57">next</a>) {
<a name="l00974"></a>00974         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ParticleSystem&quot;</span>, 1, psys);
<a name="l00975"></a>00975 
<a name="l00976"></a>00976         <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>) {
<a name="l00977"></a>00977             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ParticleData&quot;</span>, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ab52fdf06eac31dc7129f874718284014">totpart</a> ,psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>);
<a name="l00978"></a>00978 
<a name="l00979"></a>00979             <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a6d1bcac455641baf1d02cede42894902">hair</a>) {
<a name="l00980"></a>00980                 <a class="code" href="../../dc/d76/structParticleData.html">ParticleData</a> *pa = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>;
<a name="l00981"></a>00981 
<a name="l00982"></a>00982                 <span class="keywordflow">for</span> (a=0; a&lt;psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ab52fdf06eac31dc7129f874718284014">totpart</a>; a++, pa++)
<a name="l00983"></a>00983                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;HairKey&quot;</span>, pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a8ca52533a1433a54399e1d9edbad7d85">totkey</a>, pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a6d1bcac455641baf1d02cede42894902">hair</a>);
<a name="l00984"></a>00984             }
<a name="l00985"></a>00985 
<a name="l00986"></a>00986             <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a0605ad1a4ab015c2c627b8dc91e5b93c">boid</a> &amp;&amp; psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a4868871c1c1ba91bd42b97081be0f76a">phystype</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a632b70a25b43cdad1aad17d2cd9a2c53">PART_PHYS_BOIDS</a>)
<a name="l00987"></a>00987                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;BoidParticle&quot;</span>, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ab52fdf06eac31dc7129f874718284014">totpart</a>, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a0605ad1a4ab015c2c627b8dc91e5b93c">boid</a>);
<a name="l00988"></a>00988 
<a name="l00989"></a>00989             <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ada8ff094092deeef0d812a97ab310a08">fluid</a> &amp;&amp; psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a4868871c1c1ba91bd42b97081be0f76a">phystype</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a5fa3865af8588ad97dc9b94b9fcc4e23">PART_PHYS_FLUID</a> &amp;&amp; (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ada8ff094092deeef0d812a97ab310a08">fluid</a>-&gt;<a class="code" href="../../dc/dec/structSPHFluidSettings.html#a2acb321642a0e5b62262d6835001dccd">flag</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a52543435c6331404504cf2e8ff560dab">SPH_VISCOELASTIC_SPRINGS</a>))
<a name="l00990"></a>00990                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ParticleSpring&quot;</span>, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a17e89410420b3b119c941e20834ea58d">tot_fluidsprings</a>, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a0809cf17c48f503b178fbf788c0f0235">fluid_springs</a>);
<a name="l00991"></a>00991         }
<a name="l00992"></a>00992         pt = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a37c37da2c9bb6301d50a6133d00b6b75">targets</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00993"></a>00993         <span class="keywordflow">for</span> (; pt; pt=pt-&gt;<a class="code" href="../../df/db9/structParticleTarget.html#a6643a6f60f33e21a80a82e6140ddcbcc">next</a>)
<a name="l00994"></a>00994             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ParticleTarget&quot;</span>, 1, pt);
<a name="l00995"></a>00995 
<a name="l00996"></a>00996         <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a0b2c69153aaaa2095eef823b6f030713">child</a>) <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ChildParticle&quot;</span>, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#adb71b544d204f084dc3534a9a09052e5">totchild</a> ,psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a0b2c69153aaaa2095eef823b6f030713">child</a>);
<a name="l00997"></a>00997 
<a name="l00998"></a>00998         <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>) {
<a name="l00999"></a>00999             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ClothModifierData&quot;</span>, 1, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>);
<a name="l01000"></a>01000             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ClothSimSettings&quot;</span>, 1, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>);
<a name="l01001"></a>01001             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ClothCollSettings&quot;</span>, 1, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a85b96c63e4672af0fa100b6d8fda9269">clmd</a>-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#acaaa5b7360285674134abe28401bd0f9">coll_parms</a>);
<a name="l01002"></a>01002         }
<a name="l01003"></a>01003 
<a name="l01004"></a>01004         <a class="code" href="../../d3/d68/writefile_8c.html#ae28ccd4bcfe8fe74737f6b6ad72ba73d">write_pointcaches</a>(wd, &amp;psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a18021dc0203ac6bfb44d306d7a008989">ptcaches</a>);
<a name="l01005"></a>01005     }
<a name="l01006"></a>01006 }
<a name="l01007"></a>01007 
<a name="l01008"></a><a class="code" href="../../d3/d68/writefile_8c.html#a2c1af8cc9de9cd883156b93d19b5f151">01008</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a2c1af8cc9de9cd883156b93d19b5f151">write_properties</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)
<a name="l01009"></a>01009 {
<a name="l01010"></a>01010     <a class="code" href="../../d8/d4a/structbProperty.html">bProperty</a> *prop;
<a name="l01011"></a>01011 
<a name="l01012"></a>01012     prop= lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01013"></a>01013     <span class="keywordflow">while</span> (prop) {
<a name="l01014"></a>01014         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bProperty&quot;</span>, 1, prop);
<a name="l01015"></a>01015 
<a name="l01016"></a>01016         <span class="keywordflow">if</span> (prop-&gt;<a class="code" href="../../d8/d4a/structbProperty.html#a1dd80a92299a355f2d8a45964b3c3de0">poin</a> &amp;&amp; prop-&gt;<a class="code" href="../../d8/d4a/structbProperty.html#a1dd80a92299a355f2d8a45964b3c3de0">poin</a> != &amp;prop-&gt;<a class="code" href="../../d8/d4a/structbProperty.html#ae2e33a29623167cbed18f813196181f2">data</a>)
<a name="l01017"></a>01017             <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <a class="code" href="../../da/d2b/mallocn_8c.html#a7d1e6a2f5f9d271452a168d3a637d91f">MEM_allocN_len</a>(prop-&gt;<a class="code" href="../../d8/d4a/structbProperty.html#a1dd80a92299a355f2d8a45964b3c3de0">poin</a>), prop-&gt;<a class="code" href="../../d8/d4a/structbProperty.html#a1dd80a92299a355f2d8a45964b3c3de0">poin</a>);
<a name="l01018"></a>01018 
<a name="l01019"></a>01019         prop= prop-&gt;<a class="code" href="../../d8/d4a/structbProperty.html#a00f412f0af27917829febb5132a160d9">next</a>;
<a name="l01020"></a>01020     }
<a name="l01021"></a>01021 }
<a name="l01022"></a>01022 
<a name="l01023"></a><a class="code" href="../../d3/d68/writefile_8c.html#a61acf36182f5d0f56b720c60991c3a14">01023</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a61acf36182f5d0f56b720c60991c3a14">write_sensors</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)
<a name="l01024"></a>01024 {
<a name="l01025"></a>01025     <a class="code" href="../../db/d09/structbSensor.html">bSensor</a> *sens;
<a name="l01026"></a>01026 
<a name="l01027"></a>01027     sens= lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01028"></a>01028     <span class="keywordflow">while</span> (sens) {
<a name="l01029"></a>01029         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bSensor&quot;</span>, 1, sens);
<a name="l01030"></a>01030 
<a name="l01031"></a>01031         <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *)*sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#afa554e662911829345d321e1719bcaeb">totlinks</a>, sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a2ddf48bee4a768a2232ed032f5c2226a">links</a>);
<a name="l01032"></a>01032 
<a name="l01033"></a>01033         <span class="keywordflow">switch</span>(sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#ac325f3e6e74414e2539a8324902ca1ce">type</a>) {
<a name="l01034"></a>01034         <span class="keywordflow">case</span> <a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#a427f4a07862a9666e0af5c27b0af6605">SENS_NEAR</a>:
<a name="l01035"></a>01035             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bNearSensor&quot;</span>, 1, sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>);
<a name="l01036"></a>01036             <span class="keywordflow">break</span>;
<a name="l01037"></a>01037         <span class="keywordflow">case</span> <a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#ab123c332858e33a8799f7306a07e5dd0">SENS_MOUSE</a>:
<a name="l01038"></a>01038             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bMouseSensor&quot;</span>, 1, sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>);
<a name="l01039"></a>01039             <span class="keywordflow">break</span>;
<a name="l01040"></a>01040         <span class="keywordflow">case</span> <a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#a7c4f8e3b1bd33b18ebc913c6663a088a">SENS_TOUCH</a>:
<a name="l01041"></a>01041             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bTouchSensor&quot;</span>, 1, sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>);
<a name="l01042"></a>01042             <span class="keywordflow">break</span>;
<a name="l01043"></a>01043         <span class="keywordflow">case</span> <a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#ae40bccbe24a73af641991ecb2b04a76d">SENS_KEYBOARD</a>:
<a name="l01044"></a>01044             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bKeyboardSensor&quot;</span>, 1, sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>);
<a name="l01045"></a>01045             <span class="keywordflow">break</span>;
<a name="l01046"></a>01046         <span class="keywordflow">case</span> <a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#a69a52944a12b330d112d5e6a27224405">SENS_PROPERTY</a>:
<a name="l01047"></a>01047             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bPropertySensor&quot;</span>, 1, sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>);
<a name="l01048"></a>01048             <span class="keywordflow">break</span>;
<a name="l01049"></a>01049         <span class="keywordflow">case</span> <a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#a8202a6024a568afc54209c0733b079e2">SENS_ARMATURE</a>:
<a name="l01050"></a>01050             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bArmatureSensor&quot;</span>, 1, sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>);
<a name="l01051"></a>01051             <span class="keywordflow">break</span>;
<a name="l01052"></a>01052         <span class="keywordflow">case</span> <a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#ac6765d8c832550dd76e5218c7ce14dff">SENS_ACTUATOR</a>:
<a name="l01053"></a>01053             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bActuatorSensor&quot;</span>, 1, sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>);
<a name="l01054"></a>01054             <span class="keywordflow">break</span>;
<a name="l01055"></a>01055         <span class="keywordflow">case</span> <a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#a2584e2a6621338e40001bffd133632c3">SENS_DELAY</a>:
<a name="l01056"></a>01056             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bDelaySensor&quot;</span>, 1, sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>);
<a name="l01057"></a>01057             <span class="keywordflow">break</span>;
<a name="l01058"></a>01058         <span class="keywordflow">case</span> <a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#a00aa646b78d2304aca726b78bd2d1aa4">SENS_COLLISION</a>:
<a name="l01059"></a>01059             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bCollisionSensor&quot;</span>, 1, sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>);
<a name="l01060"></a>01060             <span class="keywordflow">break</span>;
<a name="l01061"></a>01061         <span class="keywordflow">case</span> <a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#a4666337cbfd0e85ec0b32f3e43a671aa">SENS_RADAR</a>:
<a name="l01062"></a>01062             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bRadarSensor&quot;</span>, 1, sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>);
<a name="l01063"></a>01063             <span class="keywordflow">break</span>;
<a name="l01064"></a>01064         <span class="keywordflow">case</span> <a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#a382dbe972ac8762d427c600197c275d5">SENS_RANDOM</a>:
<a name="l01065"></a>01065             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bRandomSensor&quot;</span>, 1, sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>);
<a name="l01066"></a>01066             <span class="keywordflow">break</span>;
<a name="l01067"></a>01067         <span class="keywordflow">case</span> <a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#a5ed95c49510097f187cd28aeeddd1491">SENS_RAY</a>:
<a name="l01068"></a>01068             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bRaySensor&quot;</span>, 1, sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>);
<a name="l01069"></a>01069             <span class="keywordflow">break</span>;
<a name="l01070"></a>01070         <span class="keywordflow">case</span> <a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#aedf7477b9ae594464a6164c3b18fb4d6">SENS_MESSAGE</a>:
<a name="l01071"></a>01071             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bMessageSensor&quot;</span>, 1, sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>);
<a name="l01072"></a>01072             <span class="keywordflow">break</span>;
<a name="l01073"></a>01073         <span class="keywordflow">case</span> <a class="code" href="../../d6/dc4/DNA__sensor__types_8h.html#a46d75e870befe13f2f71edbf9c4d4578">SENS_JOYSTICK</a>:
<a name="l01074"></a>01074             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bJoystickSensor&quot;</span>, 1, sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a446dcd67bf7b052661b148284882bcf1">data</a>);
<a name="l01075"></a>01075             <span class="keywordflow">break</span>;
<a name="l01076"></a>01076         <span class="keywordflow">default</span>:
<a name="l01077"></a>01077             ; <span class="comment">/* error: don&#39;t know how to write this file */</span>
<a name="l01078"></a>01078         }
<a name="l01079"></a>01079 
<a name="l01080"></a>01080         sens= sens-&gt;<a class="code" href="../../db/d09/structbSensor.html#a844da30cb7517bfebab4ec4e960e4ef1">next</a>;
<a name="l01081"></a>01081     }
<a name="l01082"></a>01082 }
<a name="l01083"></a>01083 
<a name="l01084"></a><a class="code" href="../../d3/d68/writefile_8c.html#a8052818cc8bcc5ca7c140525066cc41d">01084</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a8052818cc8bcc5ca7c140525066cc41d">write_controllers</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)
<a name="l01085"></a>01085 {
<a name="l01086"></a>01086     <a class="code" href="../../dd/d82/structbController.html">bController</a> *cont;
<a name="l01087"></a>01087 
<a name="l01088"></a>01088     cont= lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01089"></a>01089     <span class="keywordflow">while</span> (cont) {
<a name="l01090"></a>01090         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bController&quot;</span>, 1, cont);
<a name="l01091"></a>01091 
<a name="l01092"></a>01092         <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *)*cont-&gt;<a class="code" href="../../dd/d82/structbController.html#ac94b351dbb56572b804b3abf08d568f1">totlinks</a>, cont-&gt;<a class="code" href="../../dd/d82/structbController.html#a8547b3b1dc994585185196bdaaf063b7">links</a>);
<a name="l01093"></a>01093 
<a name="l01094"></a>01094         <span class="keywordflow">switch</span>(cont-&gt;<a class="code" href="../../dd/d82/structbController.html#a48474985990dd426df0fa0816b06d3b2">type</a>) {
<a name="l01095"></a>01095         <span class="keywordflow">case</span> <a class="code" href="../../d0/d3e/DNA__controller__types_8h.html#a095f4216092a99cc5977595f3592dec8">CONT_EXPRESSION</a>:
<a name="l01096"></a>01096             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bExpressionCont&quot;</span>, 1, cont-&gt;<a class="code" href="../../dd/d82/structbController.html#af6c30d2aedadc64bc687eb503a44b800">data</a>);
<a name="l01097"></a>01097             <span class="keywordflow">break</span>;
<a name="l01098"></a>01098         <span class="keywordflow">case</span> <a class="code" href="../../d0/d3e/DNA__controller__types_8h.html#addf43c3897e74c7dc474df500fb02898">CONT_PYTHON</a>:
<a name="l01099"></a>01099             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bPythonCont&quot;</span>, 1, cont-&gt;<a class="code" href="../../dd/d82/structbController.html#af6c30d2aedadc64bc687eb503a44b800">data</a>);
<a name="l01100"></a>01100             <span class="keywordflow">break</span>;
<a name="l01101"></a>01101         <span class="keywordflow">default</span>:
<a name="l01102"></a>01102             ; <span class="comment">/* error: don&#39;t know how to write this file */</span>
<a name="l01103"></a>01103         }
<a name="l01104"></a>01104 
<a name="l01105"></a>01105         cont= cont-&gt;<a class="code" href="../../dd/d82/structbController.html#abd185fdf6022047bfd51966024e3820b">next</a>;
<a name="l01106"></a>01106     }
<a name="l01107"></a>01107 }
<a name="l01108"></a>01108 
<a name="l01109"></a><a class="code" href="../../d3/d68/writefile_8c.html#af124fbc1b0994be35c3573644df46053">01109</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#af124fbc1b0994be35c3573644df46053">write_actuators</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)
<a name="l01110"></a>01110 {
<a name="l01111"></a>01111     <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *act;
<a name="l01112"></a>01112 
<a name="l01113"></a>01113     act= lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01114"></a>01114     <span class="keywordflow">while</span> (act) {
<a name="l01115"></a>01115         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bActuator&quot;</span>, 1, act);
<a name="l01116"></a>01116 
<a name="l01117"></a>01117         <span class="keywordflow">switch</span>(act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a545155415fccfa9b962b1d56471edd71">type</a>) {
<a name="l01118"></a>01118         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a64df7df8bf7e040450f186a4ac9c3753">ACT_ACTION</a>:
<a name="l01119"></a>01119         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#af3367e7ebe5e98e65421b9a957c6ccb8">ACT_SHAPEACTION</a>:
<a name="l01120"></a>01120             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bActionActuator&quot;</span>, 1, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l01121"></a>01121             <span class="keywordflow">break</span>;
<a name="l01122"></a>01122         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a8886ccc844380010702d2a9cbb991ee3">ACT_SOUND</a>:
<a name="l01123"></a>01123             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bSoundActuator&quot;</span>, 1, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l01124"></a>01124             <span class="keywordflow">break</span>;
<a name="l01125"></a>01125         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ab0aeb55ae4abd7843939f507c688af75">ACT_OBJECT</a>:
<a name="l01126"></a>01126             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bObjectActuator&quot;</span>, 1, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l01127"></a>01127             <span class="keywordflow">break</span>;
<a name="l01128"></a>01128         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a548a3bb674b346430996bd2431126833">ACT_IPO</a>:
<a name="l01129"></a>01129             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bIpoActuator&quot;</span>, 1, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l01130"></a>01130             <span class="keywordflow">break</span>;
<a name="l01131"></a>01131         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a3adf808ddc137a603bc4d0d92b31882a">ACT_PROPERTY</a>:
<a name="l01132"></a>01132             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bPropertyActuator&quot;</span>, 1, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l01133"></a>01133             <span class="keywordflow">break</span>;
<a name="l01134"></a>01134         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ad0a80e945d2f9f52b83f903c6f0a8bcd">ACT_CAMERA</a>:
<a name="l01135"></a>01135             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bCameraActuator&quot;</span>, 1, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l01136"></a>01136             <span class="keywordflow">break</span>;
<a name="l01137"></a>01137         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#af4219f856735c8b17e378aa709b9a180">ACT_CONSTRAINT</a>:
<a name="l01138"></a>01138             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bConstraintActuator&quot;</span>, 1, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l01139"></a>01139             <span class="keywordflow">break</span>;
<a name="l01140"></a>01140         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a0fc0c7354c3624cb0a4b65934480a969">ACT_EDIT_OBJECT</a>:
<a name="l01141"></a>01141             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bEditObjectActuator&quot;</span>, 1, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l01142"></a>01142             <span class="keywordflow">break</span>;
<a name="l01143"></a>01143         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#af24723332b675766ad1d11f031ac6cd4">ACT_SCENE</a>:
<a name="l01144"></a>01144             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bSceneActuator&quot;</span>, 1, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l01145"></a>01145             <span class="keywordflow">break</span>;
<a name="l01146"></a>01146         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a65e355c94eb65ce0605cd1725be6f069">ACT_GROUP</a>:
<a name="l01147"></a>01147             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bGroupActuator&quot;</span>, 1, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l01148"></a>01148             <span class="keywordflow">break</span>;
<a name="l01149"></a>01149         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#afa534426fa168b7b34a19736feb1f963">ACT_RANDOM</a>:
<a name="l01150"></a>01150             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bRandomActuator&quot;</span>, 1, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l01151"></a>01151             <span class="keywordflow">break</span>;
<a name="l01152"></a>01152         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ae4015d5dd2b07f1caedc5039e7dd3753">ACT_MESSAGE</a>:
<a name="l01153"></a>01153             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bMessageActuator&quot;</span>, 1, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l01154"></a>01154             <span class="keywordflow">break</span>;
<a name="l01155"></a>01155         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#adb174945b18d2f92217fcec653650608">ACT_GAME</a>:
<a name="l01156"></a>01156             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bGameActuator&quot;</span>, 1, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l01157"></a>01157             <span class="keywordflow">break</span>;
<a name="l01158"></a>01158         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a73675ab4080c6848799f85d363aa8278">ACT_VISIBILITY</a>:
<a name="l01159"></a>01159             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bVisibilityActuator&quot;</span>, 1, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l01160"></a>01160             <span class="keywordflow">break</span>;
<a name="l01161"></a>01161         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a6b9525822dbf86e1fbd601a18a27dcfb">ACT_2DFILTER</a>:
<a name="l01162"></a>01162             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bTwoDFilterActuator&quot;</span>, 1, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l01163"></a>01163             <span class="keywordflow">break</span>;
<a name="l01164"></a>01164         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#aff16c55b5a12651b7c6902a240530c24">ACT_PARENT</a>:
<a name="l01165"></a>01165             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bParentActuator&quot;</span>, 1, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l01166"></a>01166             <span class="keywordflow">break</span>;
<a name="l01167"></a>01167         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a0dc1d9f49f038a2f6dade9ba8a8e34ba">ACT_STATE</a>:
<a name="l01168"></a>01168             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bStateActuator&quot;</span>, 1, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l01169"></a>01169             <span class="keywordflow">break</span>;
<a name="l01170"></a>01170         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#aee9a04f8f07032f50c4743a6499405e7">ACT_ARMATURE</a>:
<a name="l01171"></a>01171             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bArmatureActuator&quot;</span>, 1, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l01172"></a>01172             <span class="keywordflow">break</span>;
<a name="l01173"></a>01173         <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a68b54400142bd60b87940076e4d92471">ACT_STEERING</a>:
<a name="l01174"></a>01174             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bSteeringActuator&quot;</span>, 1, act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#a60fe5eef63561b5c639ee582054ea933">data</a>);
<a name="l01175"></a>01175             <span class="keywordflow">break</span>;
<a name="l01176"></a>01176         <span class="keywordflow">default</span>:
<a name="l01177"></a>01177             ; <span class="comment">/* error: don&#39;t know how to write this file */</span>
<a name="l01178"></a>01178         }
<a name="l01179"></a>01179 
<a name="l01180"></a>01180         act= act-&gt;<a class="code" href="../../d0/d4a/structbActuator.html#ae77790d6a497010e1a250dcbc94e92c5">next</a>;
<a name="l01181"></a>01181     }
<a name="l01182"></a>01182 }
<a name="l01183"></a>01183 
<a name="l01184"></a><a class="code" href="../../d3/d68/writefile_8c.html#ac75b4bda72a3c3f687aba4f2b8111169">01184</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#ac75b4bda72a3c3f687aba4f2b8111169">write_motionpath</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../dc/d9d/structbMotionPath.html">bMotionPath</a> *mpath)
<a name="l01185"></a>01185 {
<a name="l01186"></a>01186     <span class="comment">/* sanity checks */</span>
<a name="l01187"></a>01187     <span class="keywordflow">if</span> (mpath == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01188"></a>01188         <span class="keywordflow">return</span>;
<a name="l01189"></a>01189     
<a name="l01190"></a>01190     <span class="comment">/* firstly, just write the motionpath struct */</span>
<a name="l01191"></a>01191     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bMotionPath&quot;</span>, 1, mpath);
<a name="l01192"></a>01192     
<a name="l01193"></a>01193     <span class="comment">/* now write the array of data */</span>
<a name="l01194"></a>01194     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bMotionPathVert&quot;</span>, mpath-&gt;<a class="code" href="../../dc/d9d/structbMotionPath.html#a550559c27125eed463c1ff89092de4aa">length</a>, mpath-&gt;<a class="code" href="../../dc/d9d/structbMotionPath.html#a8f9a28f56851a4cbe94dc1b75b870833">points</a>);
<a name="l01195"></a>01195 }
<a name="l01196"></a>01196 
<a name="l01197"></a><a class="code" href="../../d3/d68/writefile_8c.html#a69da569e23b1f839778abefd30545b86">01197</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a69da569e23b1f839778abefd30545b86">write_constraints</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *conlist)
<a name="l01198"></a>01198 {
<a name="l01199"></a>01199     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l01200"></a>01200 
<a name="l01201"></a>01201     <span class="keywordflow">for</span> (con=conlist-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; con; con=con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l01202"></a>01202         <a class="code" href="../../dc/ded/structbConstraintTypeInfo.html">bConstraintTypeInfo</a> *cti= <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#a8eac21e0105e441026a6b7cd7d78030d">constraint_get_typeinfo</a>(con);
<a name="l01203"></a>01203         
<a name="l01204"></a>01204         <span class="comment">/* Write the specific data */</span>
<a name="l01205"></a>01205         <span class="keywordflow">if</span> (cti &amp;&amp; con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>) {
<a name="l01206"></a>01206             <span class="comment">/* firstly, just write the plain con-&gt;data struct */</span>
<a name="l01207"></a>01207             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a1c734162dd6b46e59e0a188d363442c7">structName</a>, 1, con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>);
<a name="l01208"></a>01208             
<a name="l01209"></a>01209             <span class="comment">/* do any constraint specific stuff */</span>
<a name="l01210"></a>01210             <span class="keywordflow">switch</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a>) {
<a name="l01211"></a>01211                 <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a7e2841c90e49a4d5c28931df5f82bf32">CONSTRAINT_TYPE_PYTHON</a>:
<a name="l01212"></a>01212                 {
<a name="l01213"></a>01213                     <a class="code" href="../../d5/d64/structbPythonConstraint.html">bPythonConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = (<a class="code" href="../../d5/d64/structbPythonConstraint.html">bPythonConstraint</a> *)con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l01214"></a>01214                     <a class="code" href="../../d5/d78/structbConstraintTarget.html">bConstraintTarget</a> *ct;
<a name="l01215"></a>01215                     
<a name="l01216"></a>01216                     <span class="comment">/* write targets */</span>
<a name="l01217"></a>01217                     for (ct= data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#ad08ba0f7208324f62cfe83a3e1aa1405">targets</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ct; ct= ct-&gt;next)
<a name="l01218"></a>01218                         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bConstraintTarget&quot;</span>, 1, ct);
<a name="l01219"></a>01219                     
<a name="l01220"></a>01220                     <span class="comment">/* Write ID Properties -- and copy this comment EXACTLY for easy finding</span>
<a name="l01221"></a>01221 <span class="comment">                     * of library blocks that implement this.*/</span>
<a name="l01222"></a>01222                     <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#a22715d94c0730e17caa007d76fafcc67">prop</a>, wd);
<a name="l01223"></a>01223                 }
<a name="l01224"></a>01224                     <span class="keywordflow">break</span>;
<a name="l01225"></a>01225                 <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a71924f8e323782bf927aef8aaab46e97">CONSTRAINT_TYPE_SPLINEIK</a>: 
<a name="l01226"></a>01226                 {
<a name="l01227"></a>01227                     <a class="code" href="../../d5/d7b/structbSplineIKConstraint.html">bSplineIKConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= (<a class="code" href="../../d5/d7b/structbSplineIKConstraint.html">bSplineIKConstraint</a>*)con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l01228"></a>01228                     
<a name="l01229"></a>01229                     <span class="comment">/* write points array */</span>
<a name="l01230"></a>01230                     <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*(data-&gt;<a class="code" href="../../d5/d7b/structbSplineIKConstraint.html#ac2c9ec953f800fb957c75d4a38099426">numpoints</a>), data-&gt;<a class="code" href="../../d5/d7b/structbSplineIKConstraint.html#a50b3b161aaa52ff5a9f62e02e43caf63">points</a>);
<a name="l01231"></a>01231                 }
<a name="l01232"></a>01232                     <span class="keywordflow">break</span>;
<a name="l01233"></a>01233             }
<a name="l01234"></a>01234         }
<a name="l01235"></a>01235         
<a name="l01236"></a>01236         <span class="comment">/* Write the constraint */</span>
<a name="l01237"></a>01237         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bConstraint&quot;</span>, 1, con);
<a name="l01238"></a>01238     }
<a name="l01239"></a>01239 }
<a name="l01240"></a>01240 
<a name="l01241"></a><a class="code" href="../../d3/d68/writefile_8c.html#af7869fbf134e31a61534435253914bfa">01241</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#af7869fbf134e31a61534435253914bfa">write_pose</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d3/de4/structbPose.html">bPose</a> *pose)
<a name="l01242"></a>01242 {
<a name="l01243"></a>01243     <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *chan;
<a name="l01244"></a>01244     <a class="code" href="../../d9/dcf/structbActionGroup.html">bActionGroup</a> *grp;
<a name="l01245"></a>01245 
<a name="l01246"></a>01246     <span class="comment">/* Write each channel */</span>
<a name="l01247"></a>01247     <span class="keywordflow">if</span> (!pose)
<a name="l01248"></a>01248         <span class="keywordflow">return</span>;
<a name="l01249"></a>01249 
<a name="l01250"></a>01250     <span class="comment">/* Write channels */</span>
<a name="l01251"></a>01251     <span class="keywordflow">for</span> (chan=pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; chan; chan=chan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a73c14c1cca1a2d1e91778f44578eeca0">next</a>) {
<a name="l01252"></a>01252         <span class="comment">/* Write ID Properties -- and copy this comment EXACTLY for easy finding</span>
<a name="l01253"></a>01253 <span class="comment">         * of library blocks that implement this.*/</span>
<a name="l01254"></a>01254         <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a053b8b403c11109dcb74d5a31e5b80fc">prop</a>)
<a name="l01255"></a>01255             <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(chan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a053b8b403c11109dcb74d5a31e5b80fc">prop</a>, wd);
<a name="l01256"></a>01256         
<a name="l01257"></a>01257         <a class="code" href="../../d3/d68/writefile_8c.html#a69da569e23b1f839778abefd30545b86">write_constraints</a>(wd, &amp;chan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>);
<a name="l01258"></a>01258         
<a name="l01259"></a>01259         <a class="code" href="../../d3/d68/writefile_8c.html#ac75b4bda72a3c3f687aba4f2b8111169">write_motionpath</a>(wd, chan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a3dbec1e9fa7c6231f0328a74249f0c91">mpath</a>);
<a name="l01260"></a>01260         
<a name="l01261"></a>01261         <span class="comment">/* prevent crashes with autosave, when a bone duplicated in editmode has not yet been assigned to its posechannel */</span>
<a name="l01262"></a>01262         <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a31291bac57d8e3b0edaac489c94ed8b4">bone</a>) 
<a name="l01263"></a>01263             chan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#ab8002f1264e76592d3768b09dda30f56">selectflag</a>= chan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a31291bac57d8e3b0edaac489c94ed8b4">bone</a>-&gt;<a class="code" href="../../de/de0/structBone.html#a5b5e463a4ba414686cfe2954ada482fb">flag</a> &amp; <a class="code" href="../../d2/d93/DNA__armature__types_8h.html#ad26c2b448f0e416cffc8cd84065c3b50a176833e258350f5e845cfb780a4c280c">BONE_SELECTED</a>; <span class="comment">/* gets restored on read, for library armatures */</span>
<a name="l01264"></a>01264         
<a name="l01265"></a>01265         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bPoseChannel&quot;</span>, 1, chan);
<a name="l01266"></a>01266     }
<a name="l01267"></a>01267     
<a name="l01268"></a>01268     <span class="comment">/* Write groups */</span>
<a name="l01269"></a>01269     <span class="keywordflow">for</span> (grp=pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a60a155dd4019f3ee9a94c624589701ce">agroups</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; grp; grp=grp-&gt;<a class="code" href="../../d9/dcf/structbActionGroup.html#a572a3c6b116924498cc9d6a41c93479f">next</a>) 
<a name="l01270"></a>01270         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bActionGroup&quot;</span>, 1, grp);
<a name="l01271"></a>01271 
<a name="l01272"></a>01272     <span class="comment">/* write IK param */</span>
<a name="l01273"></a>01273     <span class="keywordflow">if</span> (pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a2c700562036f72cc3bfa089c1dbef380">ikparam</a>) {
<a name="l01274"></a>01274         <span class="keywordtype">char</span> *structname = (<span class="keywordtype">char</span> *)<a class="code" href="../../d8/df5/BKE__action_8h.html#a73eacc61589d6bb83142b735f6ab0cb3">get_ikparam_name</a>(pose);
<a name="l01275"></a>01275         <span class="keywordflow">if</span> (structname)
<a name="l01276"></a>01276             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, structname, 1, pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a2c700562036f72cc3bfa089c1dbef380">ikparam</a>);
<a name="l01277"></a>01277     }
<a name="l01278"></a>01278 
<a name="l01279"></a>01279     <span class="comment">/* Write this pose */</span>
<a name="l01280"></a>01280     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bPose&quot;</span>, 1, pose);
<a name="l01281"></a>01281 
<a name="l01282"></a>01282 }
<a name="l01283"></a>01283 
<a name="l01284"></a><a class="code" href="../../d3/d68/writefile_8c.html#ad5473e47cd24cc9e89d61af4d1d545c8">01284</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#ad5473e47cd24cc9e89d61af4d1d545c8">write_defgroups</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *defbase)
<a name="l01285"></a>01285 {
<a name="l01286"></a>01286     <a class="code" href="../../de/dad/structbDeformGroup.html">bDeformGroup</a>    *defgroup;
<a name="l01287"></a>01287 
<a name="l01288"></a>01288     <span class="keywordflow">for</span> (defgroup=defbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; defgroup; defgroup=defgroup-&gt;<a class="code" href="../../de/dad/structbDeformGroup.html#a8a7d7781bc9d928bff891de4188de7ad">next</a>)
<a name="l01289"></a>01289         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bDeformGroup&quot;</span>, 1, defgroup);
<a name="l01290"></a>01290 }
<a name="l01291"></a>01291 
<a name="l01292"></a><a class="code" href="../../d3/d68/writefile_8c.html#a87cc0ed9bbbe510ce30e55d11e9b31a0">01292</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a87cc0ed9bbbe510ce30e55d11e9b31a0">write_modifiers</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *modbase)
<a name="l01293"></a>01293 {
<a name="l01294"></a>01294     <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l01295"></a>01295 
<a name="l01296"></a>01296     <span class="keywordflow">if</span> (modbase == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l01297"></a>01297     <span class="keywordflow">for</span> (md=modbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md= md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l01298"></a>01298         <a class="code" href="../../db/dc5/structModifierTypeInfo.html">ModifierTypeInfo</a> *<a class="code" href="../../d8/d43/MT__random_8cpp.html#a0893639c022032e006e5b13378f7b4b2">mti</a> = <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#a837a63cd144446bec663f3a02e0ad397">modifierType_getInfo</a>(md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>);
<a name="l01299"></a>01299         <span class="keywordflow">if</span> (mti == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l01300"></a>01300         
<a name="l01301"></a>01301         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, mti-&gt;<a class="code" href="../../db/dc5/structModifierTypeInfo.html#acd7f3b984e26ed8622c22ab9aea2a65e">structName</a>, 1, md);
<a name="l01302"></a>01302             
<a name="l01303"></a>01303         <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a82ec76427c7cc0b352e6aadb2e3d0b89">eModifierType_Hook</a>) {
<a name="l01304"></a>01304             <a class="code" href="../../d8/d2c/structHookModifierData.html">HookModifierData</a> *hmd = (<a class="code" href="../../d8/d2c/structHookModifierData.html">HookModifierData</a>*) md;
<a name="l01305"></a>01305             
<a name="l01306"></a>01306             <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*hmd-&gt;<a class="code" href="../../d8/d2c/structHookModifierData.html#a0633d7b312679ba4e6df987268024e73">totindex</a>, hmd-&gt;<a class="code" href="../../d8/d2c/structHookModifierData.html#a93fbc2b0ce30ff63bf0f7e02eb0fa827">indexar</a>);
<a name="l01307"></a>01307         }
<a name="l01308"></a>01308         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a5fc484f055c7aba4c89beda85b5ba321">eModifierType_Cloth</a>) {
<a name="l01309"></a>01309             <a class="code" href="../../d5/d06/structClothModifierData.html">ClothModifierData</a> *clmd = (<a class="code" href="../../d5/d06/structClothModifierData.html">ClothModifierData</a>*) md;
<a name="l01310"></a>01310             
<a name="l01311"></a>01311             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ClothSimSettings&quot;</span>, 1, clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>);
<a name="l01312"></a>01312             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ClothCollSettings&quot;</span>, 1, clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#acaaa5b7360285674134abe28401bd0f9">coll_parms</a>);
<a name="l01313"></a>01313             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;EffectorWeights&quot;</span>, 1, clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a988c44f77f99941feca4eb68e4910e94">sim_parms</a>-&gt;<a class="code" href="../../df/d87/structClothSimSettings.html#a037f21034c9abf86dea5341c23be7e60">effector_weights</a>);
<a name="l01314"></a>01314             <a class="code" href="../../d3/d68/writefile_8c.html#ae28ccd4bcfe8fe74737f6b6ad72ba73d">write_pointcaches</a>(wd, &amp;clmd-&gt;<a class="code" href="../../d5/d06/structClothModifierData.html#a2bfdb45d82b0577deb1cdd5f879e931c">ptcaches</a>);
<a name="l01315"></a>01315         } 
<a name="l01316"></a>01316         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a7a78843e9dd6590fafc9b7682e691ac5">eModifierType_Smoke</a>) {
<a name="l01317"></a>01317             <a class="code" href="../../d5/d03/structSmokeModifierData.html">SmokeModifierData</a> *smd = (<a class="code" href="../../d5/d03/structSmokeModifierData.html">SmokeModifierData</a>*) md;
<a name="l01318"></a>01318             
<a name="l01319"></a>01319             <span class="keywordflow">if</span> (smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a43b5e848c1b44a089bd6d4461b0d2b1f">type</a> &amp; <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a88bed02ad1eb599ef628931fc9ab7973">MOD_SMOKE_TYPE_DOMAIN</a>)
<a name="l01320"></a>01320             {
<a name="l01321"></a>01321                 <span class="keywordflow">if</span> (smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>)
<a name="l01322"></a>01322                 {
<a name="l01323"></a>01323                     <a class="code" href="../../d3/d68/writefile_8c.html#ae28ccd4bcfe8fe74737f6b6ad72ba73d">write_pointcaches</a>(wd, &amp;(smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a8bec113790f4bff589a5299be6273801">ptcaches</a>[0]));
<a name="l01324"></a>01324 
<a name="l01325"></a>01325                     <span class="comment">/* create fake pointcache so that old blender versions can read it */</span>
<a name="l01326"></a>01326                     smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a51c76a80c09b649712b9bf226235c112">point_cache</a>[1] = <a class="code" href="../../db/d45/BKE__pointcache_8h.html#aaa30cc8980cfa020b23b61066cda11e1">BKE_ptcache_add</a>(&amp;smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a8bec113790f4bff589a5299be6273801">ptcaches</a>[1]);
<a name="l01327"></a>01327                     smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a51c76a80c09b649712b9bf226235c112">point_cache</a>[1]-&gt;<a class="code" href="../../d6/d83/structPointCache.html#ae601ac8693d0881eb5da61700e84cf2d">flag</a> |= <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a4dfd845afe48aca448b8bbcef971cc5d">PTCACHE_DISK_CACHE</a>|<a class="code" href="../../d2/d60/DNA__object__force_8h.html#a2b88c16b99a82dd327dfc9033085b982">PTCACHE_FAKE_SMOKE</a>;
<a name="l01328"></a>01328                     smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a51c76a80c09b649712b9bf226235c112">point_cache</a>[1]-&gt;<a class="code" href="../../d6/d83/structPointCache.html#a45c02298ee93df755a2f14ce5c8e5173">step</a> = 1;
<a name="l01329"></a>01329 
<a name="l01330"></a>01330                     <a class="code" href="../../d3/d68/writefile_8c.html#ae28ccd4bcfe8fe74737f6b6ad72ba73d">write_pointcaches</a>(wd, &amp;(smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a8bec113790f4bff589a5299be6273801">ptcaches</a>[1]));
<a name="l01331"></a>01331                 }
<a name="l01332"></a>01332                 
<a name="l01333"></a>01333                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SmokeDomainSettings&quot;</span>, 1, smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>);
<a name="l01334"></a>01334 
<a name="l01335"></a>01335                 <span class="keywordflow">if</span> (smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>) {
<a name="l01336"></a>01336                     <span class="comment">/* cleanup the fake pointcache */</span>
<a name="l01337"></a>01337                     <a class="code" href="../../db/d45/BKE__pointcache_8h.html#acd668a903f7dc38eabb18e0c44677c0d">BKE_ptcache_free_list</a>(&amp;smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a8bec113790f4bff589a5299be6273801">ptcaches</a>[1]);
<a name="l01338"></a>01338                     smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a51c76a80c09b649712b9bf226235c112">point_cache</a>[1] = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01339"></a>01339                     
<a name="l01340"></a>01340                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;EffectorWeights&quot;</span>, 1, smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a9d82dc71cf74a60bf31ba934137d1078">effector_weights</a>);
<a name="l01341"></a>01341                 }
<a name="l01342"></a>01342             }
<a name="l01343"></a>01343             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a43b5e848c1b44a089bd6d4461b0d2b1f">type</a> &amp; <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a36fe9119d95e89e9f77fcca43030c798">MOD_SMOKE_TYPE_FLOW</a>)
<a name="l01344"></a>01344                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SmokeFlowSettings&quot;</span>, 1, smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a2504c8cb3941b404272f8f0dacaf8bf4">flow</a>);
<a name="l01345"></a>01345             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a43b5e848c1b44a089bd6d4461b0d2b1f">type</a> &amp; <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a38072e25640d74866f67201327dd38c3">MOD_SMOKE_TYPE_COLL</a>)
<a name="l01346"></a>01346                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SmokeCollSettings&quot;</span>, 1, smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a704990a483a65c1af67a2fa2f182ae4f">coll</a>);
<a name="l01347"></a>01347         } 
<a name="l01348"></a>01348         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a1b7a8b34e7e5482f68e3447b75e56899">eModifierType_Fluidsim</a>) {
<a name="l01349"></a>01349             <a class="code" href="../../d0/dae/structFluidsimModifierData.html">FluidsimModifierData</a> *fluidmd = (<a class="code" href="../../d0/dae/structFluidsimModifierData.html">FluidsimModifierData</a>*) md;
<a name="l01350"></a>01350             
<a name="l01351"></a>01351             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;FluidsimSettings&quot;</span>, 1, fluidmd-&gt;<a class="code" href="../../d0/dae/structFluidsimModifierData.html#adca7b002e4bbf96014932ffe53e55be7">fss</a>);
<a name="l01352"></a>01352         }
<a name="l01353"></a>01353         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435abf6c2369ea1f5b0cab992eb27906823c">eModifierType_DynamicPaint</a>) {
<a name="l01354"></a>01354             <a class="code" href="../../de/d70/structDynamicPaintModifierData.html">DynamicPaintModifierData</a> *pmd = (<a class="code" href="../../de/d70/structDynamicPaintModifierData.html">DynamicPaintModifierData</a>*) md;
<a name="l01355"></a>01355             
<a name="l01356"></a>01356             <span class="keywordflow">if</span> (pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#a7f52b6a38d830d37a65adb2485555e6f">canvas</a>)
<a name="l01357"></a>01357             {
<a name="l01358"></a>01358                 <a class="code" href="../../dc/d46/structDynamicPaintSurface.html">DynamicPaintSurface</a> *surface;
<a name="l01359"></a>01359                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;DynamicPaintCanvasSettings&quot;</span>, 1, pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#a7f52b6a38d830d37a65adb2485555e6f">canvas</a>);
<a name="l01360"></a>01360                 
<a name="l01361"></a>01361                 <span class="comment">/* write surfaces */</span>
<a name="l01362"></a>01362                 <span class="keywordflow">for</span> (surface=pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#a7f52b6a38d830d37a65adb2485555e6f">canvas</a>-&gt;<a class="code" href="../../dd/d1c/structDynamicPaintCanvasSettings.html#ad228b42281d1a30b3a1471918032d6a5">surfaces</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; surface; surface=surface-&gt;<a class="code" href="../../dc/d46/structDynamicPaintSurface.html#a844dd16f25eea3afb63262bf54937b05">next</a>)
<a name="l01363"></a>01363                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;DynamicPaintSurface&quot;</span>, 1, surface);
<a name="l01364"></a>01364                 <span class="comment">/* write caches and effector weights */</span>
<a name="l01365"></a>01365                 <span class="keywordflow">for</span> (surface=pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#a7f52b6a38d830d37a65adb2485555e6f">canvas</a>-&gt;<a class="code" href="../../dd/d1c/structDynamicPaintCanvasSettings.html#ad228b42281d1a30b3a1471918032d6a5">surfaces</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; surface; surface=surface-&gt;<a class="code" href="../../dc/d46/structDynamicPaintSurface.html#a844dd16f25eea3afb63262bf54937b05">next</a>) {
<a name="l01366"></a>01366                     <a class="code" href="../../d3/d68/writefile_8c.html#ae28ccd4bcfe8fe74737f6b6ad72ba73d">write_pointcaches</a>(wd, &amp;(surface-&gt;<a class="code" href="../../dc/d46/structDynamicPaintSurface.html#ad5a5d56f2355389075826d9c3c69fd93">ptcaches</a>));
<a name="l01367"></a>01367 
<a name="l01368"></a>01368                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;EffectorWeights&quot;</span>, 1, surface-&gt;<a class="code" href="../../dc/d46/structDynamicPaintSurface.html#ab4e992f41674ea30309db68c8e3a05b6">effector_weights</a>);
<a name="l01369"></a>01369                 }
<a name="l01370"></a>01370             }
<a name="l01371"></a>01371             <span class="keywordflow">if</span> (pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#aa4ef61ed3ab25dcf9bc570403bc5113c">brush</a>)
<a name="l01372"></a>01372             {
<a name="l01373"></a>01373                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;DynamicPaintBrushSettings&quot;</span>, 1, pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#aa4ef61ed3ab25dcf9bc570403bc5113c">brush</a>);
<a name="l01374"></a>01374                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ColorBand&quot;</span>, 1, pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#aa4ef61ed3ab25dcf9bc570403bc5113c">brush</a>-&gt;<a class="code" href="../../d5/d38/structDynamicPaintBrushSettings.html#a770c7441fb2444e1d820fd6e20fc6a6a">paint_ramp</a>);
<a name="l01375"></a>01375                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ColorBand&quot;</span>, 1, pmd-&gt;<a class="code" href="../../de/d70/structDynamicPaintModifierData.html#aa4ef61ed3ab25dcf9bc570403bc5113c">brush</a>-&gt;<a class="code" href="../../d5/d38/structDynamicPaintBrushSettings.html#a0d98857f862c3a96b6462ccc8619616f">vel_ramp</a>);
<a name="l01376"></a>01376             }
<a name="l01377"></a>01377         } 
<a name="l01378"></a>01378         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435abc95e623f4353951954effc91fe021e2">eModifierType_Collision</a>) {
<a name="l01379"></a>01379             
<a name="l01380"></a>01380             <span class="comment">/*</span>
<a name="l01381"></a>01381 <span class="comment">            CollisionModifierData *collmd = (CollisionModifierData*) md;</span>
<a name="l01382"></a>01382 <span class="comment">            // TODO: CollisionModifier should use pointcache </span>
<a name="l01383"></a>01383 <span class="comment">            // + have proper reset events before enabling this</span>
<a name="l01384"></a>01384 <span class="comment">            writestruct(wd, DATA, &quot;MVert&quot;, collmd-&gt;numverts, collmd-&gt;x);</span>
<a name="l01385"></a>01385 <span class="comment">            writestruct(wd, DATA, &quot;MVert&quot;, collmd-&gt;numverts, collmd-&gt;xnew);</span>
<a name="l01386"></a>01386 <span class="comment">            writestruct(wd, DATA, &quot;MFace&quot;, collmd-&gt;numfaces, collmd-&gt;mfaces);</span>
<a name="l01387"></a>01387 <span class="comment">            */</span>
<a name="l01388"></a>01388         }
<a name="l01389"></a>01389         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a177f813942f48c8705d42b9820e02a80">eModifierType_MeshDeform</a>) {
<a name="l01390"></a>01390             <a class="code" href="../../de/df2/structMeshDeformModifierData.html">MeshDeformModifierData</a> *mmd = (<a class="code" href="../../de/df2/structMeshDeformModifierData.html">MeshDeformModifierData</a>*) md;
<a name="l01391"></a>01391             <span class="keywordtype">int</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a> = mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a4239efb94351352a15aa8dd67568a803">dyngridsize</a>;
<a name="l01392"></a>01392 
<a name="l01393"></a>01393             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;MDefInfluence&quot;</span>, mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#adc358c07a8bcdd723892f1175004637c">totinfluence</a>, mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a47eaa48153ba2e270f52211a56670b71">bindinfluences</a>);
<a name="l01394"></a>01394             <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*(mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a51bc7f19643fa62c74841cdcc5a2ea2c">totvert</a>+1), mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#ad5bcb347ba1b08b5fa809477ce46bc76">bindoffsets</a>);
<a name="l01395"></a>01395             <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*3*mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a8d21a0e3e8f264d0a9bbf406a134a46d">totcagevert</a>,
<a name="l01396"></a>01396                 mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#af2857fb00435f5809c4ab37c1e3a7281">bindcagecos</a>);
<a name="l01397"></a>01397             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;MDefCell&quot;</span>, size*size*size, mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a8525ae4d16c10f3f37a3bc1a5f46fa36">dyngrid</a>);
<a name="l01398"></a>01398             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;MDefInfluence&quot;</span>, mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#adc358c07a8bcdd723892f1175004637c">totinfluence</a>, mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a89f5f33ad3c86ea029ddec13a578b11c">dyninfluences</a>);
<a name="l01399"></a>01399             <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#a51bc7f19643fa62c74841cdcc5a2ea2c">totvert</a>, mmd-&gt;<a class="code" href="../../de/df2/structMeshDeformModifierData.html#ad133406450f26edd932ce27d482c246f">dynverts</a>);
<a name="l01400"></a>01400         }
<a name="l01401"></a>01401         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435aac667e2c4a4fa4c4287ddb0d7d58f37a">eModifierType_Warp</a>) {
<a name="l01402"></a>01402             <a class="code" href="../../d6/d24/structWarpModifierData.html">WarpModifierData</a> *tmd = (<a class="code" href="../../d6/d24/structWarpModifierData.html">WarpModifierData</a>*) md;
<a name="l01403"></a>01403             <span class="keywordflow">if</span> (tmd-&gt;<a class="code" href="../../d6/d24/structWarpModifierData.html#a3c6ed272756ae21aaf4f882e9b42eb28">curfalloff</a>) {
<a name="l01404"></a>01404                 <a class="code" href="../../d3/d68/writefile_8c.html#a1aee9b323a690ee9d46323ade9511325">write_curvemapping</a>(wd, tmd-&gt;<a class="code" href="../../d6/d24/structWarpModifierData.html#a3c6ed272756ae21aaf4f882e9b42eb28">curfalloff</a>);
<a name="l01405"></a>01405             }
<a name="l01406"></a>01406         }
<a name="l01407"></a>01407         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>==<a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435ac782f9207083f596c4d2fa983cc2875d">eModifierType_WeightVGEdit</a>) {
<a name="l01408"></a>01408             <a class="code" href="../../da/d90/structWeightVGEditModifierData.html">WeightVGEditModifierData</a> *wmd = (<a class="code" href="../../da/d90/structWeightVGEditModifierData.html">WeightVGEditModifierData</a>*) md;
<a name="l01409"></a>01409 
<a name="l01410"></a>01410             <span class="keywordflow">if</span> (wmd-&gt;<a class="code" href="../../da/d90/structWeightVGEditModifierData.html#a7fbfe9f2cb0314c61607d921be376945">cmap_curve</a>)
<a name="l01411"></a>01411                 <a class="code" href="../../d3/d68/writefile_8c.html#a1aee9b323a690ee9d46323ade9511325">write_curvemapping</a>(wd, wmd-&gt;<a class="code" href="../../da/d90/structWeightVGEditModifierData.html#a7fbfe9f2cb0314c61607d921be376945">cmap_curve</a>);
<a name="l01412"></a>01412         }
<a name="l01413"></a>01413     }
<a name="l01414"></a>01414 }
<a name="l01415"></a>01415 
<a name="l01416"></a><a class="code" href="../../d3/d68/writefile_8c.html#a0f729d275bab2450e9bc711224556c55">01416</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a0f729d275bab2450e9bc711224556c55">write_objects</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l01417"></a>01417 {
<a name="l01418"></a>01418     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l01419"></a>01419     
<a name="l01420"></a>01420     ob= idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01421"></a>01421     <span class="keywordflow">while</span> (ob) {
<a name="l01422"></a>01422         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l01423"></a>01423             <span class="comment">/* write LibData */</span>
<a name="l01424"></a>01424             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>, <span class="stringliteral">&quot;Object&quot;</span>, 1, ob);
<a name="l01425"></a>01425             
<a name="l01426"></a>01426             <span class="comment">/* Write ID Properties -- and copy this comment EXACTLY for easy finding</span>
<a name="l01427"></a>01427 <span class="comment">             * of library blocks that implement this.*/</span>
<a name="l01428"></a>01428             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l01429"></a>01429             
<a name="l01430"></a>01430             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(wd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>);
<a name="l01431"></a>01431             
<a name="l01432"></a>01432             <span class="comment">/* direct data */</span>
<a name="l01433"></a>01433             <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *)*ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad3bbabfca98cb47923254dd04d6961ac">totcol</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>);
<a name="l01434"></a>01434             <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad3bbabfca98cb47923254dd04d6961ac">totcol</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a58e55b421436f3c376299a2179619150">matbits</a>);
<a name="l01435"></a>01435             <span class="comment">/* write_effects(wd, &amp;ob-&gt;effect); */</span> <span class="comment">/* not used anymore */</span>
<a name="l01436"></a>01436             <a class="code" href="../../d3/d68/writefile_8c.html#a2c1af8cc9de9cd883156b93d19b5f151">write_properties</a>(wd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a08b5ac6620501dec9b98cb9f8c9a1fa3">prop</a>);
<a name="l01437"></a>01437             <a class="code" href="../../d3/d68/writefile_8c.html#a61acf36182f5d0f56b720c60991c3a14">write_sensors</a>(wd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#abe754872740b0e577c07c2b0bacd7c00">sensors</a>);
<a name="l01438"></a>01438             <a class="code" href="../../d3/d68/writefile_8c.html#a8052818cc8bcc5ca7c140525066cc41d">write_controllers</a>(wd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#ae2499a91d26d9dc8829a0505f6008066">controllers</a>);
<a name="l01439"></a>01439             <a class="code" href="../../d3/d68/writefile_8c.html#af124fbc1b0994be35c3573644df46053">write_actuators</a>(wd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa80169aa224451d207999b52c86751ad">actuators</a>);
<a name="l01440"></a>01440 
<a name="l01441"></a>01441             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>) {
<a name="l01442"></a>01442                 <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01443"></a>01443                 <span class="keywordflow">if</span> (arm &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a> &amp;&amp; arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a7d1c3812f46a8787c49bc84c68c1e118">act_bone</a>) {
<a name="l01444"></a>01444                     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#ab1412ec1f7e512c78c5f9823d68b03cd">proxy_act_bone</a>, arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a7d1c3812f46a8787c49bc84c68c1e118">act_bone</a>-&gt;<a class="code" href="../../de/de0/structBone.html#a64174a3246045ec9f985e604d30c6159">name</a>, <span class="keyword">sizeof</span>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#ab1412ec1f7e512c78c5f9823d68b03cd">proxy_act_bone</a>));
<a name="l01445"></a>01445                 }
<a name="l01446"></a>01446             }
<a name="l01447"></a>01447 
<a name="l01448"></a>01448             <a class="code" href="../../d3/d68/writefile_8c.html#af7869fbf134e31a61534435253914bfa">write_pose</a>(wd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>);
<a name="l01449"></a>01449             <a class="code" href="../../d3/d68/writefile_8c.html#ad5473e47cd24cc9e89d61af4d1d545c8">write_defgroups</a>(wd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a11c2e3299c854eb361471ea041397cb7">defbase</a>);
<a name="l01450"></a>01450             <a class="code" href="../../d3/d68/writefile_8c.html#a69da569e23b1f839778abefd30545b86">write_constraints</a>(wd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>);
<a name="l01451"></a>01451             <a class="code" href="../../d3/d68/writefile_8c.html#ac75b4bda72a3c3f687aba4f2b8111169">write_motionpath</a>(wd, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa274264cbbef5f41777e8370d5bc173a">mpath</a>);
<a name="l01452"></a>01452             
<a name="l01453"></a>01453             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;PartDeflect&quot;</span>, 1, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>);
<a name="l01454"></a>01454             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SoftBody&quot;</span>, 1, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>);
<a name="l01455"></a>01455             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>) {
<a name="l01456"></a>01456                 <a class="code" href="../../d3/d68/writefile_8c.html#ae28ccd4bcfe8fe74737f6b6ad72ba73d">write_pointcaches</a>(wd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a2b4fe2801e797119094ffa33d7a92d59">ptcaches</a>);
<a name="l01457"></a>01457                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;EffectorWeights&quot;</span>, 1, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a75f48a73a6ed8226e7942be5cbf15c65">effector_weights</a>);
<a name="l01458"></a>01458             }
<a name="l01459"></a>01459             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;BulletSoftBody&quot;</span>, 1, ob-&gt;<a class="code" href="../../de/de7/structObject.html#acaa3b12bf1664333e0bb2a4327faaef6">bsoft</a>);
<a name="l01460"></a>01460             
<a name="l01461"></a>01461             <a class="code" href="../../d3/d68/writefile_8c.html#a5f7aca929e4c2ec1ce2241ccf4479125">write_particlesystems</a>(wd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>);
<a name="l01462"></a>01462             <a class="code" href="../../d3/d68/writefile_8c.html#a87cc0ed9bbbe510ce30e55d11e9b31a0">write_modifiers</a>(wd, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>);
<a name="l01463"></a>01463         }
<a name="l01464"></a>01464         ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l01465"></a>01465     }
<a name="l01466"></a>01466 
<a name="l01467"></a>01467     <span class="comment">/* flush helps the compression for undo-save */</span>
<a name="l01468"></a>01468     <a class="code" href="../../d3/d68/writefile_8c.html#ad3cd0b85338465ac04a3b48cc084e1c9">mywrite</a>(wd, <a class="code" href="../../d3/d68/writefile_8c.html#ab6d466684929096461d75d8e48c455e4">MYWRITE_FLUSH</a>, 0);
<a name="l01469"></a>01469 }
<a name="l01470"></a>01470 
<a name="l01471"></a>01471 
<a name="l01472"></a><a class="code" href="../../d3/d68/writefile_8c.html#a2472176d7a22d63fb565be86f25b12f9">01472</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a2472176d7a22d63fb565be86f25b12f9">write_vfonts</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l01473"></a>01473 {
<a name="l01474"></a>01474     <a class="code" href="../../dc/dbe/structVFont.html">VFont</a> *vf;
<a name="l01475"></a>01475     <a class="code" href="../../dd/d77/structPackedFile.html">PackedFile</a> * <a class="code" href="../../d8/d9d/gim__memory_8h.html#aa7421a08567e946189db67fbebfb88e0" title="Prefetch 64.">pf</a>;
<a name="l01476"></a>01476 
<a name="l01477"></a>01477     vf= idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01478"></a>01478     <span class="keywordflow">while</span> (vf) {
<a name="l01479"></a>01479         <span class="keywordflow">if</span> (vf-&gt;<a class="code" href="../../dc/dbe/structVFont.html#aa6ee47902f7fe209564d555dd4d8969d">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l01480"></a>01480             <span class="comment">/* write LibData */</span>
<a name="l01481"></a>01481             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a00dc71b465cb83f24230f213cb0d79c1">ID_VF</a>, <span class="stringliteral">&quot;VFont&quot;</span>, 1, vf);
<a name="l01482"></a>01482             <span class="keywordflow">if</span> (vf-&gt;<a class="code" href="../../dc/dbe/structVFont.html#aa6ee47902f7fe209564d555dd4d8969d">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(vf-&gt;<a class="code" href="../../dc/dbe/structVFont.html#aa6ee47902f7fe209564d555dd4d8969d">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l01483"></a>01483 
<a name="l01484"></a>01484             <span class="comment">/* direct data */</span>
<a name="l01485"></a>01485 
<a name="l01486"></a>01486             <span class="keywordflow">if</span> (vf-&gt;<a class="code" href="../../dc/dbe/structVFont.html#afed9353561fc055c04cd4dda674c4aa5">packedfile</a>) {
<a name="l01487"></a>01487                 pf = vf-&gt;<a class="code" href="../../dc/dbe/structVFont.html#afed9353561fc055c04cd4dda674c4aa5">packedfile</a>;
<a name="l01488"></a>01488                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;PackedFile&quot;</span>, 1, pf);
<a name="l01489"></a>01489                 <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, pf-&gt;<a class="code" href="../../dd/d77/structPackedFile.html#ab46e545f88274c5c348303a84fd735d6">size</a>, pf-&gt;<a class="code" href="../../dd/d77/structPackedFile.html#ab26282078abf88909ab32213a4290f8e">data</a>);
<a name="l01490"></a>01490             }
<a name="l01491"></a>01491         }
<a name="l01492"></a>01492 
<a name="l01493"></a>01493         vf= vf-&gt;<a class="code" href="../../dc/dbe/structVFont.html#aa6ee47902f7fe209564d555dd4d8969d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l01494"></a>01494     }
<a name="l01495"></a>01495 }
<a name="l01496"></a>01496 
<a name="l01497"></a>01497 
<a name="l01498"></a><a class="code" href="../../d3/d68/writefile_8c.html#ab7b6e28528fe25ff92012c48ad986996">01498</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#ab7b6e28528fe25ff92012c48ad986996">write_keys</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l01499"></a>01499 {
<a name="l01500"></a>01500     <a class="code" href="../../d1/d9e/structKey.html">Key</a> *key;
<a name="l01501"></a>01501     <a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a> *kb;
<a name="l01502"></a>01502 
<a name="l01503"></a>01503     key= idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01504"></a>01504     <span class="keywordflow">while</span> (key) {
<a name="l01505"></a>01505         <span class="keywordflow">if</span> (key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a4e5a48e60e8ed39616fdbb90d501fc6c">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l01506"></a>01506             <span class="comment">/* write LibData */</span>
<a name="l01507"></a>01507             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a46c0b029a6e8fc3d7ebb18311b83397d">ID_KE</a>, <span class="stringliteral">&quot;Key&quot;</span>, 1, key);
<a name="l01508"></a>01508             <span class="keywordflow">if</span> (key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a4e5a48e60e8ed39616fdbb90d501fc6c">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a4e5a48e60e8ed39616fdbb90d501fc6c">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l01509"></a>01509             
<a name="l01510"></a>01510             <span class="keywordflow">if</span> (key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a9e6219935b7f5b387610055b81705180">adt</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(wd, key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a9e6219935b7f5b387610055b81705180">adt</a>);
<a name="l01511"></a>01511             
<a name="l01512"></a>01512             <span class="comment">/* direct data */</span>
<a name="l01513"></a>01513             kb= key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ab82a3a504826387b0811d68570496e2a">block</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01514"></a>01514             <span class="keywordflow">while</span> (kb) {
<a name="l01515"></a>01515                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;KeyBlock&quot;</span>, 1, kb);
<a name="l01516"></a>01516                 <span class="keywordflow">if</span> (kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#aec4b55f1b0c4c1e0c60a77f7ffb80401">data</a>) <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#a48866fbfcc064f4777e2d2841ce42fe4">totelem</a>*key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a61e6991b6b6a75a8c65470f3b240c193">elemsize</a>, kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#aec4b55f1b0c4c1e0c60a77f7ffb80401">data</a>);
<a name="l01517"></a>01517                 kb= kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#ac20a23b2cb5a21986a4c762933f8a95b">next</a>;
<a name="l01518"></a>01518             }
<a name="l01519"></a>01519         }
<a name="l01520"></a>01520 
<a name="l01521"></a>01521         key= key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a4e5a48e60e8ed39616fdbb90d501fc6c">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l01522"></a>01522     }
<a name="l01523"></a>01523     <span class="comment">/* flush helps the compression for undo-save */</span>
<a name="l01524"></a>01524     <a class="code" href="../../d3/d68/writefile_8c.html#ad3cd0b85338465ac04a3b48cc084e1c9">mywrite</a>(wd, <a class="code" href="../../d3/d68/writefile_8c.html#ab6d466684929096461d75d8e48c455e4">MYWRITE_FLUSH</a>, 0);
<a name="l01525"></a>01525 }
<a name="l01526"></a>01526 
<a name="l01527"></a><a class="code" href="../../d3/d68/writefile_8c.html#aa4f0d79410ab477e4060780b71344c56">01527</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#aa4f0d79410ab477e4060780b71344c56">write_cameras</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l01528"></a>01528 {
<a name="l01529"></a>01529     <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *cam;
<a name="l01530"></a>01530 
<a name="l01531"></a>01531     cam= idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01532"></a>01532     <span class="keywordflow">while</span> (cam) {
<a name="l01533"></a>01533         <span class="keywordflow">if</span> (cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l01534"></a>01534             <span class="comment">/* write LibData */</span>
<a name="l01535"></a>01535             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82bdb2fdea7abee55d993c0210101273">ID_CA</a>, <span class="stringliteral">&quot;Camera&quot;</span>, 1, cam);
<a name="l01536"></a>01536             <span class="keywordflow">if</span> (cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l01537"></a>01537             
<a name="l01538"></a>01538             <span class="keywordflow">if</span> (cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ac2cb75a787d0924ce330394fe4bfb2c4">adt</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(wd, cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ac2cb75a787d0924ce330394fe4bfb2c4">adt</a>);
<a name="l01539"></a>01539         }
<a name="l01540"></a>01540 
<a name="l01541"></a>01541         cam= cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l01542"></a>01542     }
<a name="l01543"></a>01543 }
<a name="l01544"></a>01544 
<a name="l01545"></a><a class="code" href="../../d3/d68/writefile_8c.html#ad132b9aa9af320109fe7b72b6f939b66">01545</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#ad132b9aa9af320109fe7b72b6f939b66">write_mballs</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l01546"></a>01546 {
<a name="l01547"></a>01547     <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb;
<a name="l01548"></a>01548     <a class="code" href="../../de/d87/structMetaElem.html">MetaElem</a> *ml;
<a name="l01549"></a>01549 
<a name="l01550"></a>01550     mb= idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01551"></a>01551     <span class="keywordflow">while</span> (mb) {
<a name="l01552"></a>01552         <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l01553"></a>01553             <span class="comment">/* write LibData */</span>
<a name="l01554"></a>01554             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a3e4005eef9876a2cb9d799bdb2a43998">ID_MB</a>, <span class="stringliteral">&quot;MetaBall&quot;</span>, 1, mb);
<a name="l01555"></a>01555             <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l01556"></a>01556 
<a name="l01557"></a>01557             <span class="comment">/* direct data */</span>
<a name="l01558"></a>01558             <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *)*mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ab8971ac14c6143431474bce14b1ea887">totcol</a>, mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ae78577af3d79eea5d59be6f39a9c768d">mat</a>);
<a name="l01559"></a>01559             <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad0590fb7ac842ab63fd568c1f393ebb0">adt</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(wd, mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad0590fb7ac842ab63fd568c1f393ebb0">adt</a>);
<a name="l01560"></a>01560 
<a name="l01561"></a>01561             ml= mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a582b25f0c9cf3bfa16c4c2d1785f1233">elems</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01562"></a>01562             <span class="keywordflow">while</span> (ml) {
<a name="l01563"></a>01563                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;MetaElem&quot;</span>, 1, ml);
<a name="l01564"></a>01564                 ml= ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a441cace5b6e487bfc3c2c29f3ab9e150">next</a>;
<a name="l01565"></a>01565             }
<a name="l01566"></a>01566         }
<a name="l01567"></a>01567         mb= mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l01568"></a>01568     }
<a name="l01569"></a>01569 }
<a name="l01570"></a>01570 
<a name="l01571"></a><a class="code" href="../../d3/d68/writefile_8c.html#a30bb1856cac8563a674f466a25f35fe4">01571</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d68/writefile_8c.html#a30bb1856cac8563a674f466a25f35fe4">amount_of_chars</a>(<span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>)
<a name="l01572"></a>01572 {
<a name="l01573"></a>01573     <span class="comment">// Since the data is saved as UTF-8 to the cu-&gt;str</span>
<a name="l01574"></a>01574     <span class="comment">// The cu-&gt;len is not same as the strlen(cu-&gt;str)</span>
<a name="l01575"></a>01575     <span class="keywordflow">return</span> <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(str);
<a name="l01576"></a>01576 }
<a name="l01577"></a>01577 
<a name="l01578"></a><a class="code" href="../../d3/d68/writefile_8c.html#a6d1ab02cb5286b5be2402b216ad07843">01578</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a6d1ab02cb5286b5be2402b216ad07843">write_curves</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l01579"></a>01579 {
<a name="l01580"></a>01580     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu;
<a name="l01581"></a>01581     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l01582"></a>01582 
<a name="l01583"></a>01583     cu= idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01584"></a>01584     <span class="keywordflow">while</span> (cu) {
<a name="l01585"></a>01585         <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l01586"></a>01586             <span class="comment">/* write LibData */</span>
<a name="l01587"></a>01587             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ace150506eaf644d92a5110cf45978379">ID_CU</a>, <span class="stringliteral">&quot;Curve&quot;</span>, 1, cu);
<a name="l01588"></a>01588             
<a name="l01589"></a>01589             <span class="comment">/* direct data */</span>
<a name="l01590"></a>01590             <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *)*cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a178aa2fd33adfb5df2b311a7d398ac36">totcol</a>, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0ff0285ca29eef8bf650f0746ac9a84a">mat</a>);
<a name="l01591"></a>01591             <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l01592"></a>01592             <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a43b677aa65b1d464d8e338afe597db66">adt</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(wd, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a43b677aa65b1d464d8e338afe597db66">adt</a>);
<a name="l01593"></a>01593             
<a name="l01594"></a>01594             <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a1735002958cbeb8aaf88094ef6596e78">vfont</a>) {
<a name="l01595"></a>01595                 <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <a class="code" href="../../d3/d68/writefile_8c.html#a30bb1856cac8563a674f466a25f35fe4">amount_of_chars</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab0b4dc5959c529381dbc6a954a8a39b6">str</a>)+1, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab0b4dc5959c529381dbc6a954a8a39b6">str</a>);
<a name="l01596"></a>01596                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;CharInfo&quot;</span>, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#adace7d1722758b9ffec9b98f9cf688b2">len</a>+1, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a95ab12824ad734ab8bc052cd7fdcc22d">strinfo</a>);
<a name="l01597"></a>01597                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;TextBox&quot;</span>, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a653d6829b5c84d43744c7939f32b0c3b">totbox</a>, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>);               
<a name="l01598"></a>01598             }
<a name="l01599"></a>01599             <span class="keywordflow">else</span> {
<a name="l01600"></a>01600                 <span class="comment">/* is also the order of reading */</span>
<a name="l01601"></a>01601                 nu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01602"></a>01602                 <span class="keywordflow">while</span> (nu) {
<a name="l01603"></a>01603                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;Nurb&quot;</span>, 1, nu);
<a name="l01604"></a>01604                     nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l01605"></a>01605                 }
<a name="l01606"></a>01606                 nu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01607"></a>01607                 <span class="keywordflow">while</span> (nu) {
<a name="l01608"></a>01608                     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>)
<a name="l01609"></a>01609                         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;BezTriple&quot;</span>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>);
<a name="l01610"></a>01610                     <span class="keywordflow">else</span> {
<a name="l01611"></a>01611                         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;BPoint&quot;</span>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l01612"></a>01612                         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>) <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a229d5ec44247fb38940870726ade9077">KNOTSU</a>(nu)*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>);
<a name="l01613"></a>01613                         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>) <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67f5d26ce1431098dc2c1d4282d8d7b0">KNOTSV</a>(nu)*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>);
<a name="l01614"></a>01614                     }
<a name="l01615"></a>01615                     nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l01616"></a>01616                 }
<a name="l01617"></a>01617             }
<a name="l01618"></a>01618         }
<a name="l01619"></a>01619         cu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l01620"></a>01620     }
<a name="l01621"></a>01621 
<a name="l01622"></a>01622     <span class="comment">/* flush helps the compression for undo-save */</span>
<a name="l01623"></a>01623     <a class="code" href="../../d3/d68/writefile_8c.html#ad3cd0b85338465ac04a3b48cc084e1c9">mywrite</a>(wd, <a class="code" href="../../d3/d68/writefile_8c.html#ab6d466684929096461d75d8e48c455e4">MYWRITE_FLUSH</a>, 0);
<a name="l01624"></a>01624 }
<a name="l01625"></a>01625 
<a name="l01626"></a><a class="code" href="../../d3/d68/writefile_8c.html#a77414bbdb313062b0bb90ee6e6c5f2f9">01626</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a77414bbdb313062b0bb90ee6e6c5f2f9">write_dverts</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <span class="keywordtype">int</span> count, <a class="code" href="../../dc/d0d/structMDeformVert.html">MDeformVert</a> *dvlist)
<a name="l01627"></a>01627 {
<a name="l01628"></a>01628     <span class="keywordflow">if</span> (dvlist) {
<a name="l01629"></a>01629         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01630"></a>01630         
<a name="l01631"></a>01631         <span class="comment">/* Write the dvert list */</span>
<a name="l01632"></a>01632         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;MDeformVert&quot;</span>, count, dvlist);
<a name="l01633"></a>01633         
<a name="l01634"></a>01634         <span class="comment">/* Write deformation data for each dvert */</span>
<a name="l01635"></a>01635         <span class="keywordflow">for</span> (i=0; i&lt;count; i++) {
<a name="l01636"></a>01636             <span class="keywordflow">if</span> (dvlist[i].dw)
<a name="l01637"></a>01637                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;MDeformWeight&quot;</span>, dvlist[i].totweight, dvlist[i].dw);
<a name="l01638"></a>01638         }
<a name="l01639"></a>01639     }
<a name="l01640"></a>01640 }
<a name="l01641"></a>01641 
<a name="l01642"></a><a class="code" href="../../d3/d68/writefile_8c.html#aad3448ef648f293ae915ec9d767a7898">01642</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#aad3448ef648f293ae915ec9d767a7898">write_mdisps</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <span class="keywordtype">int</span> count, <a class="code" href="../../da/d81/structMDisps.html">MDisps</a> *mdlist, <span class="keywordtype">int</span> external)
<a name="l01643"></a>01643 {
<a name="l01644"></a>01644     <span class="keywordflow">if</span> (mdlist) {
<a name="l01645"></a>01645         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01646"></a>01646         
<a name="l01647"></a>01647         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;MDisps&quot;</span>, count, mdlist);
<a name="l01648"></a>01648         <span class="keywordflow">for</span> (i = 0; i &lt; count; ++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {
<a name="l01649"></a>01649             <a class="code" href="../../da/d81/structMDisps.html">MDisps</a> *md = &amp;mdlist[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01650"></a>01650             <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../da/d81/structMDisps.html#a074f759a552afe40fba57e3069249e27">disps</a>) {
<a name="l01651"></a>01651                 <span class="keywordflow">if</span> (!external)
<a name="l01652"></a>01652                     <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*3*md-&gt;<a class="code" href="../../da/d81/structMDisps.html#aa761cd4860d10148af662dffee5e0ce5">totdisp</a>, md-&gt;<a class="code" href="../../da/d81/structMDisps.html#a074f759a552afe40fba57e3069249e27">disps</a>);
<a name="l01653"></a>01653             }
<a name="l01654"></a>01654             
<a name="l01655"></a>01655             <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../da/d81/structMDisps.html#a2f831907f51e69b0b0a3efe4a8f1776a">hidden</a>)
<a name="l01656"></a>01656                 <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <a class="code" href="../../df/dd3/BLI__bitmap_8h.html#a7bf433d6fcad6ed784b25a2bd94aa03b">BLI_BITMAP_SIZE</a>(md-&gt;<a class="code" href="../../da/d81/structMDisps.html#aa761cd4860d10148af662dffee5e0ce5">totdisp</a>), md-&gt;<a class="code" href="../../da/d81/structMDisps.html#a2f831907f51e69b0b0a3efe4a8f1776a">hidden</a>);
<a name="l01657"></a>01657         }
<a name="l01658"></a>01658     }
<a name="l01659"></a>01659 }
<a name="l01660"></a>01660 
<a name="l01661"></a><a class="code" href="../../d3/d68/writefile_8c.html#a4d832d7927b80901a144409208d122d4">01661</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a4d832d7927b80901a144409208d122d4">write_customdata</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <span class="keywordtype">int</span> count, <a class="code" href="../../df/d04/structCustomData.html">CustomData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">int</span> partial_type, <span class="keywordtype">int</span> partial_count)
<a name="l01662"></a>01662 {
<a name="l01663"></a>01663     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01664"></a>01664 
<a name="l01665"></a>01665     <span class="comment">/* write external customdata (not for undo) */</span>
<a name="l01666"></a>01666     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../df/d04/structCustomData.html#ae34ce54cf42df29842f387e8a27d34c4">external</a> &amp;&amp; !wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>)
<a name="l01667"></a>01667         <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a484c91e3f8677108c8440902533b92e6">CustomData_external_write</a>(data, <span class="keywordtype">id</span>, <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a7567efbca3712fc24b23bbe17a945322">CD_MASK_MESH</a>, count, 0);
<a name="l01668"></a>01668 
<a name="l01669"></a>01669     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;CustomDataLayer&quot;</span>, data-&gt;<a class="code" href="../../df/d04/structCustomData.html#a3ea0ad3c5e7b635d934fd45db4be3746">maxlayer</a>, data-&gt;<a class="code" href="../../df/d04/structCustomData.html#a91813d4d92a1349830c9b1e554cf7af6">layers</a>);
<a name="l01670"></a>01670 
<a name="l01671"></a>01671     <span class="keywordflow">for</span> (i=0; i&lt;data-&gt;<a class="code" href="../../df/d04/structCustomData.html#ae5b4833527392742d84e8f7b46f5f264">totlayer</a>; i++) {
<a name="l01672"></a>01672         <a class="code" href="../../d5/d97/structCustomDataLayer.html">CustomDataLayer</a> *layer= &amp;data-&gt;<a class="code" href="../../df/d04/structCustomData.html#a91813d4d92a1349830c9b1e554cf7af6">layers</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01673"></a>01673         <span class="keyword">const</span> <span class="keywordtype">char</span> *structname;
<a name="l01674"></a>01674         <span class="keywordtype">int</span> structnum, datasize;
<a name="l01675"></a>01675 
<a name="l01676"></a>01676         <span class="keywordflow">if</span> (layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a1ba604969c785bba31ef501e7a06cc9c">type</a> == <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a46e655a33ee15daada322dea203b832a">CD_MDEFORMVERT</a>) {
<a name="l01677"></a>01677             <span class="comment">/* layer types that allocate own memory need special handling */</span>
<a name="l01678"></a>01678             <a class="code" href="../../d3/d68/writefile_8c.html#a77414bbdb313062b0bb90ee6e6c5f2f9">write_dverts</a>(wd, count, layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a96b03d545e94aacd77c467efb04b1153">data</a>);
<a name="l01679"></a>01679         }
<a name="l01680"></a>01680         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a1ba604969c785bba31ef501e7a06cc9c">type</a> == <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a85dd305a310931c933a9d0a3fa0a69a4">CD_MDISPS</a>) {
<a name="l01681"></a>01681             <a class="code" href="../../d3/d68/writefile_8c.html#aad3448ef648f293ae915ec9d767a7898">write_mdisps</a>(wd, count, layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a96b03d545e94aacd77c467efb04b1153">data</a>, layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a8838b5a61a319759037c096d6b8d9887">flag</a> &amp; <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#ad4dfcdb69890db690267ef52a39245f6">CD_FLAG_EXTERNAL</a>);
<a name="l01682"></a>01682         }
<a name="l01683"></a>01683         <span class="keywordflow">else</span> {
<a name="l01684"></a>01684             <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a7b2101530260dda182a08c6f4b893e3b">CustomData_file_write_info</a>(layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a1ba604969c785bba31ef501e7a06cc9c">type</a>, &amp;structname, &amp;structnum);
<a name="l01685"></a>01685             <span class="keywordflow">if</span> (structnum) {
<a name="l01686"></a>01686                 <span class="comment">/* when using partial visibility, the MEdge and MFace layers</span>
<a name="l01687"></a>01687 <span class="comment">                 * are smaller than the original, so their type and count is</span>
<a name="l01688"></a>01688 <span class="comment">                 * passed to make this work */</span>
<a name="l01689"></a>01689                 <span class="keywordflow">if</span> (layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a1ba604969c785bba31ef501e7a06cc9c">type</a> != partial_type) datasize= structnum*count;
<a name="l01690"></a>01690                 <span class="keywordflow">else</span> datasize= structnum*partial_count;
<a name="l01691"></a>01691 
<a name="l01692"></a>01692                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, structname, datasize, layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a96b03d545e94aacd77c467efb04b1153">data</a>);
<a name="l01693"></a>01693             }
<a name="l01694"></a>01694             <span class="keywordflow">else</span>
<a name="l01695"></a>01695                 printf(<span class="stringliteral">&quot;%s error: layer &#39;%s&#39;:%d - can&#39;t be written to file\n&quot;</span>,
<a name="l01696"></a>01696                        __func__, structname, layer-&gt;<a class="code" href="../../d5/d97/structCustomDataLayer.html#a1ba604969c785bba31ef501e7a06cc9c">type</a>);
<a name="l01697"></a>01697         }
<a name="l01698"></a>01698     }
<a name="l01699"></a>01699 
<a name="l01700"></a>01700     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../df/d04/structCustomData.html#ae34ce54cf42df29842f387e8a27d34c4">external</a>)
<a name="l01701"></a>01701         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;CustomDataExternal&quot;</span>, 1, data-&gt;<a class="code" href="../../df/d04/structCustomData.html#ae34ce54cf42df29842f387e8a27d34c4">external</a>);
<a name="l01702"></a>01702 }
<a name="l01703"></a>01703 
<a name="l01704"></a><a class="code" href="../../d3/d68/writefile_8c.html#a011fc87915fa7dd4ad3c24aca0916479">01704</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a011fc87915fa7dd4ad3c24aca0916479">write_meshs</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l01705"></a>01705 {
<a name="l01706"></a>01706     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *mesh;
<a name="l01707"></a>01707     <span class="keywordtype">int</span> save_for_old_blender= 0;
<a name="l01708"></a>01708 
<a name="l01709"></a>01709 <span class="preprocessor">#ifdef USE_BMESH_SAVE_AS_COMPAT</span>
<a name="l01710"></a>01710 <span class="preprocessor"></span>    save_for_old_blender = wd-&gt;use_mesh_compat; <span class="comment">/* option to save with older mesh format */</span>
<a name="l01711"></a>01711 <span class="preprocessor">#endif</span>
<a name="l01712"></a>01712 <span class="preprocessor"></span>
<a name="l01713"></a>01713     mesh= idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01714"></a>01714     <span class="keywordflow">while</span> (mesh) {
<a name="l01715"></a>01715         <span class="keywordflow">if</span> (mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l01716"></a>01716             <span class="comment">/* write LibData */</span>
<a name="l01717"></a>01717             <span class="keywordflow">if</span> (!save_for_old_blender) {
<a name="l01718"></a>01718 
<a name="l01719"></a>01719 <span class="preprocessor">#ifdef USE_BMESH_SAVE_WITHOUT_MFACE</span>
<a name="l01720"></a>01720 <span class="preprocessor"></span>                <a class="code" href="../../da/d29/structMesh.html">Mesh</a> backup_mesh = {{0}};
<a name="l01721"></a>01721                 <span class="comment">/* cache only - don&#39;t write */</span>
<a name="l01722"></a>01722                 backup_mesh.<a class="code" href="../../da/d29/structMesh.html#ae2f9f6ccbbc64ba6aff375ae95510217">mface</a> = mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ae2f9f6ccbbc64ba6aff375ae95510217">mface</a>;
<a name="l01723"></a>01723                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ae2f9f6ccbbc64ba6aff375ae95510217">mface</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01724"></a>01724                 <span class="comment">/* -- */</span>
<a name="l01725"></a>01725                 backup_mesh.<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a> = mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>;
<a name="l01726"></a>01726                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a> = 0;
<a name="l01727"></a>01727                 <span class="comment">/* -- */</span>
<a name="l01728"></a>01728 <span class="preprocessor">#endif </span><span class="comment">/* USE_BMESH_SAVE_WITHOUT_MFACE */</span>
<a name="l01729"></a>01729 
<a name="l01730"></a>01730                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a2e6c796d1f9370e5fd552166098cdd27">ID_ME</a>, <span class="stringliteral">&quot;Mesh&quot;</span>, 1, mesh);
<a name="l01731"></a>01731 
<a name="l01732"></a>01732                 <span class="comment">/* direct data */</span>
<a name="l01733"></a>01733                 <span class="keywordflow">if</span> (mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l01734"></a>01734                 <span class="keywordflow">if</span> (mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a4f2d54305057ef6e0615135a03b6dedf">adt</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(wd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a4f2d54305057ef6e0615135a03b6dedf">adt</a>);
<a name="l01735"></a>01735 
<a name="l01736"></a>01736                 <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *)*mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac7bd892579cf8a793973b2ce2491ec06">totcol</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a4fdee04a24d1a821f3bfa659b3bd8156">mat</a>);
<a name="l01737"></a>01737                 <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../d8/dd9/structMSelect.html">MSelect</a>) * mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ad67207e84a0cc0e7dbdf3590664e7b45">totselect</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#af8063586234e2a7297ab9fc730e37e78">mselect</a>);
<a name="l01738"></a>01738 
<a name="l01739"></a>01739                 <a class="code" href="../../d3/d68/writefile_8c.html#a4d832d7927b80901a144409208d122d4">write_customdata</a>(wd, &amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a8eb428498e3a39055f51a7de431655ed">totvert</a>, &amp;mesh-&gt;vdata, -1, 0);
<a name="l01740"></a>01740                 <a class="code" href="../../d3/d68/writefile_8c.html#a4d832d7927b80901a144409208d122d4">write_customdata</a>(wd, &amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a686df37ba278d2bdc080e4d5a0f70dd5">totedge</a>, &amp;mesh-&gt;edata, -1, 0);
<a name="l01741"></a>01741                 <span class="comment">/* fdata is really a dummy - written so slots align */</span>
<a name="l01742"></a>01742                 <a class="code" href="../../d3/d68/writefile_8c.html#a4d832d7927b80901a144409208d122d4">write_customdata</a>(wd, &amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>, &amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>, -1, 0);
<a name="l01743"></a>01743                 <a class="code" href="../../d3/d68/writefile_8c.html#a4d832d7927b80901a144409208d122d4">write_customdata</a>(wd, &amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ad564f355ced9ae66d5e9b2d7681cc510">totloop</a>, &amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a255aca90ca2e5b36547795f3d79407f9">ldata</a>, -1, 0);
<a name="l01744"></a>01744                 <a class="code" href="../../d3/d68/writefile_8c.html#a4d832d7927b80901a144409208d122d4">write_customdata</a>(wd, &amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>, &amp;mesh-&gt;pdata, -1, 0);
<a name="l01745"></a>01745 
<a name="l01746"></a>01746 <span class="preprocessor">#ifdef USE_BMESH_SAVE_WITHOUT_MFACE</span>
<a name="l01747"></a>01747 <span class="preprocessor"></span>                <span class="comment">/* cache only - don&#39;t write */</span>
<a name="l01748"></a>01748                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ae2f9f6ccbbc64ba6aff375ae95510217">mface</a> = backup_mesh.<a class="code" href="../../da/d29/structMesh.html#ae2f9f6ccbbc64ba6aff375ae95510217">mface</a>;
<a name="l01749"></a>01749                 <span class="comment">/* -- */</span>
<a name="l01750"></a>01750                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a> = backup_mesh.<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>;
<a name="l01751"></a>01751 <span class="preprocessor">#endif </span><span class="comment">/* USE_BMESH_SAVE_WITHOUT_MFACE */</span>
<a name="l01752"></a>01752 
<a name="l01753"></a>01753             }
<a name="l01754"></a>01754             <span class="keywordflow">else</span> {
<a name="l01755"></a>01755 
<a name="l01756"></a>01756 <span class="preprocessor">#ifdef USE_BMESH_SAVE_AS_COMPAT</span>
<a name="l01757"></a>01757 <span class="preprocessor"></span>
<a name="l01758"></a>01758                 <a class="code" href="../../da/d29/structMesh.html">Mesh</a> backup_mesh = {{0}};
<a name="l01759"></a>01759 
<a name="l01760"></a>01760                 <span class="comment">/* backup */</span>
<a name="l01761"></a>01761                 backup_mesh.<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a> = mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>;
<a name="l01762"></a>01762                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01763"></a>01763                 <span class="comment">/* -- */</span>
<a name="l01764"></a>01764                 backup_mesh.<a class="code" href="../../da/d29/structMesh.html#ae2f9f6ccbbc64ba6aff375ae95510217">mface</a> = mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ae2f9f6ccbbc64ba6aff375ae95510217">mface</a>;
<a name="l01765"></a>01765                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ae2f9f6ccbbc64ba6aff375ae95510217">mface</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01766"></a>01766                 <span class="comment">/* -- */</span>
<a name="l01767"></a>01767                 backup_mesh.<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a> = mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>;
<a name="l01768"></a>01768                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a> = 0;
<a name="l01769"></a>01769                 <span class="comment">/* -- */</span>
<a name="l01770"></a>01770                 backup_mesh.<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a> = mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>;
<a name="l01771"></a>01771                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a> = 0;
<a name="l01772"></a>01772                 <span class="comment">/* -- */</span>
<a name="l01773"></a>01773                 backup_mesh.<a class="code" href="../../da/d29/structMesh.html#ad564f355ced9ae66d5e9b2d7681cc510">totloop</a> = mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ad564f355ced9ae66d5e9b2d7681cc510">totloop</a>;
<a name="l01774"></a>01774                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ad564f355ced9ae66d5e9b2d7681cc510">totloop</a> = 0;
<a name="l01775"></a>01775                 <span class="comment">/* -- */</span>
<a name="l01776"></a>01776                 backup_mesh.<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a> = mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>;
<a name="l01777"></a>01777                 memset(&amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../df/d04/structCustomData.html">CustomData</a>));
<a name="l01778"></a>01778                 <span class="comment">/* -- */</span>
<a name="l01779"></a>01779                 backup_mesh.pdata = mesh-&gt;pdata;
<a name="l01780"></a>01780                 memset(&amp;mesh-&gt;pdata, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../df/d04/structCustomData.html">CustomData</a>));
<a name="l01781"></a>01781                 <span class="comment">/* -- */</span>
<a name="l01782"></a>01782                 backup_mesh.<a class="code" href="../../da/d29/structMesh.html#a255aca90ca2e5b36547795f3d79407f9">ldata</a> = mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a255aca90ca2e5b36547795f3d79407f9">ldata</a>;
<a name="l01783"></a>01783                 memset(&amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a255aca90ca2e5b36547795f3d79407f9">ldata</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../df/d04/structCustomData.html">CustomData</a>));
<a name="l01784"></a>01784                 <span class="comment">/* -- */</span>
<a name="l01785"></a>01785                 backup_mesh.<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a> = mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>;
<a name="l01786"></a>01786                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01787"></a>01787                 <span class="comment">/* backup */</span>
<a name="l01788"></a>01788 
<a name="l01789"></a>01789 
<a name="l01790"></a>01790                 <span class="comment">/* now fill in polys to mfaces*/</span>
<a name="l01791"></a>01791                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>= <a class="code" href="../../df/d7f/BKE__mesh_8h.html#a3bb3e2b42caff90df9fd28e95cec8867">mesh_mpoly_to_mface</a>(&amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>, &amp;backup_mesh.<a class="code" href="../../da/d29/structMesh.html#a255aca90ca2e5b36547795f3d79407f9">ldata</a>, &amp;backup_mesh.pdata,
<a name="l01792"></a>01792                                                    mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>, backup_mesh.<a class="code" href="../../da/d29/structMesh.html#ad564f355ced9ae66d5e9b2d7681cc510">totloop</a>, backup_mesh.<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>);
<a name="l01793"></a>01793 
<a name="l01794"></a>01794                 <a class="code" href="../../df/d7f/BKE__mesh_8h.html#adc8217e8a6385eec61318e5f7489b462">mesh_update_customdata_pointers</a>(mesh, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01795"></a>01795 
<a name="l01796"></a>01796                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a2e6c796d1f9370e5fd552166098cdd27">ID_ME</a>, <span class="stringliteral">&quot;Mesh&quot;</span>, 1, mesh);
<a name="l01797"></a>01797 
<a name="l01798"></a>01798                 <span class="comment">/* direct data */</span>
<a name="l01799"></a>01799                 <span class="keywordflow">if</span> (mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l01800"></a>01800                 <span class="keywordflow">if</span> (mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a4f2d54305057ef6e0615135a03b6dedf">adt</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(wd, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a4f2d54305057ef6e0615135a03b6dedf">adt</a>);
<a name="l01801"></a>01801 
<a name="l01802"></a>01802                 <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *)*mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac7bd892579cf8a793973b2ce2491ec06">totcol</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a4fdee04a24d1a821f3bfa659b3bd8156">mat</a>);
<a name="l01803"></a>01803                 <span class="comment">/* writedata(wd, DATA, sizeof(MSelect) * mesh-&gt;totselect, mesh-&gt;mselect); */</span> <span class="comment">/* pre-bmesh NULL&#39;s */</span>
<a name="l01804"></a>01804 
<a name="l01805"></a>01805                 <a class="code" href="../../d3/d68/writefile_8c.html#a4d832d7927b80901a144409208d122d4">write_customdata</a>(wd, &amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a8eb428498e3a39055f51a7de431655ed">totvert</a>, &amp;mesh-&gt;vdata, -1, 0);
<a name="l01806"></a>01806                 <a class="code" href="../../d3/d68/writefile_8c.html#a4d832d7927b80901a144409208d122d4">write_customdata</a>(wd, &amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a686df37ba278d2bdc080e4d5a0f70dd5">totedge</a>, &amp;mesh-&gt;edata, -1, 0);
<a name="l01807"></a>01807                 <a class="code" href="../../d3/d68/writefile_8c.html#a4d832d7927b80901a144409208d122d4">write_customdata</a>(wd, &amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>, &amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>, -1, 0);
<a name="l01808"></a>01808                 <span class="comment">/* harmless for older blender versioins but _not_ writing these keeps file size down */</span>
<a name="l01809"></a>01809 <span class="preprocessor">#if 0</span>
<a name="l01810"></a>01810 <span class="preprocessor"></span>                <a class="code" href="../../d3/d68/writefile_8c.html#a4d832d7927b80901a144409208d122d4">write_customdata</a>(wd, &amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ad564f355ced9ae66d5e9b2d7681cc510">totloop</a>, &amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a255aca90ca2e5b36547795f3d79407f9">ldata</a>, -1, 0);
<a name="l01811"></a>01811                 <a class="code" href="../../d3/d68/writefile_8c.html#a4d832d7927b80901a144409208d122d4">write_customdata</a>(wd, &amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>, &amp;mesh-&gt;pdata, -1, 0);
<a name="l01812"></a>01812 <span class="preprocessor">#endif</span>
<a name="l01813"></a>01813 <span class="preprocessor"></span>
<a name="l01814"></a>01814                 <span class="comment">/* restore */</span>
<a name="l01815"></a>01815                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a> = backup_mesh.<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>;
<a name="l01816"></a>01816                 <span class="comment">/* -- */</span>
<a name="l01817"></a>01817                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ae2f9f6ccbbc64ba6aff375ae95510217">mface</a> = backup_mesh.<a class="code" href="../../da/d29/structMesh.html#ae2f9f6ccbbc64ba6aff375ae95510217">mface</a>;
<a name="l01818"></a>01818                 <span class="comment">/* -- */</span>
<a name="l01819"></a>01819                 <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a0ccefe4320d605b7cb632fa86bbb0ef1">CustomData_free</a>(&amp;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>, mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>);
<a name="l01820"></a>01820                 <span class="comment">/* -- */</span>
<a name="l01821"></a>01821                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>= backup_mesh.<a class="code" href="../../da/d29/structMesh.html#a9e7b23c7ac7bc3e81c3e3076f475bda4">fdata</a>;
<a name="l01822"></a>01822                 <span class="comment">/* -- */</span>
<a name="l01823"></a>01823                 mesh-&gt;pdata= backup_mesh.pdata;
<a name="l01824"></a>01824                 <span class="comment">/* -- */</span>
<a name="l01825"></a>01825                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a255aca90ca2e5b36547795f3d79407f9">ldata</a>= backup_mesh.<a class="code" href="../../da/d29/structMesh.html#a255aca90ca2e5b36547795f3d79407f9">ldata</a>;
<a name="l01826"></a>01826                 <span class="comment">/* -- */</span>
<a name="l01827"></a>01827                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a> = backup_mesh.<a class="code" href="../../da/d29/structMesh.html#a9dcac207036b39eff56533e7204cbb95">totface</a>;
<a name="l01828"></a>01828                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a> = backup_mesh.<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a>;
<a name="l01829"></a>01829                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ad564f355ced9ae66d5e9b2d7681cc510">totloop</a> = backup_mesh.<a class="code" href="../../da/d29/structMesh.html#ad564f355ced9ae66d5e9b2d7681cc510">totloop</a>;
<a name="l01830"></a>01830                 <span class="comment">/* -- */</span>
<a name="l01831"></a>01831                 <a class="code" href="../../df/d7f/BKE__mesh_8h.html#adc8217e8a6385eec61318e5f7489b462">mesh_update_customdata_pointers</a>(mesh, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01832"></a>01832                 <span class="comment">/* --*/</span>
<a name="l01833"></a>01833                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a> = backup_mesh.<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>; <span class="comment">/* keep this after updating custom pointers */</span>
<a name="l01834"></a>01834                 <span class="comment">/* restore */</span>
<a name="l01835"></a>01835 
<a name="l01836"></a>01836 <span class="preprocessor">#endif </span><span class="comment">/* USE_BMESH_SAVE_AS_COMPAT */</span>
<a name="l01837"></a>01837             }
<a name="l01838"></a>01838         }
<a name="l01839"></a>01839         mesh= mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac10779fc3e00d6d5b8f7ea32adaedd43">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l01840"></a>01840     }
<a name="l01841"></a>01841 }
<a name="l01842"></a>01842 
<a name="l01843"></a><a class="code" href="../../d3/d68/writefile_8c.html#a2a134a2c5c110931558ef6e2a84d8dcf">01843</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a2a134a2c5c110931558ef6e2a84d8dcf">write_lattices</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l01844"></a>01844 {
<a name="l01845"></a>01845     <a class="code" href="../../dd/d40/structLattice.html">Lattice</a> *lt;
<a name="l01846"></a>01846     
<a name="l01847"></a>01847     lt= idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01848"></a>01848     <span class="keywordflow">while</span> (lt) {
<a name="l01849"></a>01849         <span class="keywordflow">if</span> (lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae0c6751398f7133b5b11e8ceb107fe37">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l01850"></a>01850             <span class="comment">/* write LibData */</span>
<a name="l01851"></a>01851             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ad058b07954b2795eadc855a7a354578b">ID_LT</a>, <span class="stringliteral">&quot;Lattice&quot;</span>, 1, lt);
<a name="l01852"></a>01852             <span class="keywordflow">if</span> (lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae0c6751398f7133b5b11e8ceb107fe37">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae0c6751398f7133b5b11e8ceb107fe37">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l01853"></a>01853             
<a name="l01854"></a>01854             <span class="comment">/* write animdata */</span>
<a name="l01855"></a>01855             <span class="keywordflow">if</span> (lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#aefdb803caabd9962f7781773e027992e">adt</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(wd, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#aefdb803caabd9962f7781773e027992e">adt</a>);
<a name="l01856"></a>01856             
<a name="l01857"></a>01857             <span class="comment">/* direct data */</span>
<a name="l01858"></a>01858             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;BPoint&quot;</span>, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a086be8c4ef28587f6eb08c40d1bab473">pntsu</a>*lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a57fa6ffa7aaaed8c191e55d54eeebb74">pntsv</a>*lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a19be731ba1b95cd1ec5df36229baaee2">pntsw</a>, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae3dc9dd9304be3f153fa96f155d9c7de">def</a>);
<a name="l01859"></a>01859             
<a name="l01860"></a>01860             <a class="code" href="../../d3/d68/writefile_8c.html#a77414bbdb313062b0bb90ee6e6c5f2f9">write_dverts</a>(wd, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a086be8c4ef28587f6eb08c40d1bab473">pntsu</a>*lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a57fa6ffa7aaaed8c191e55d54eeebb74">pntsv</a>*lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a19be731ba1b95cd1ec5df36229baaee2">pntsw</a>, lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a4a2b2d1f76c8199226ae49ca62403fea">dvert</a>);
<a name="l01861"></a>01861             
<a name="l01862"></a>01862         }
<a name="l01863"></a>01863         lt= lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae0c6751398f7133b5b11e8ceb107fe37">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l01864"></a>01864     }
<a name="l01865"></a>01865 }
<a name="l01866"></a>01866 
<a name="l01867"></a><a class="code" href="../../d3/d68/writefile_8c.html#a526d596be5b6a444eb1966f851cf9c59">01867</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a526d596be5b6a444eb1966f851cf9c59">write_previews</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../df/dbe/structPreviewImage.html">PreviewImage</a> *prv)
<a name="l01868"></a>01868 {
<a name="l01869"></a>01869     <span class="keywordflow">if</span> (prv) {
<a name="l01870"></a>01870         <span class="keywordtype">short</span> w = prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#adda6eaec6c34f5df63e5a062a8bb4b6e">w</a>[1];
<a name="l01871"></a>01871         <span class="keywordtype">short</span> h = prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#a1ae50762651c6ce6a2f4ca35bf04ca25">h</a>[1];
<a name="l01872"></a>01872         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *rect = prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#adc07eb0c4338c99cee802180870bbbfb">rect</a>[1];
<a name="l01873"></a>01873         <span class="comment">/* don&#39;t write out large previews if not requested */</span>
<a name="l01874"></a>01874         <span class="keywordflow">if</span> (!(<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.flag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a388154726ebac615445990ae490cd40f">USER_SAVE_PREVIEWS</a>)) {
<a name="l01875"></a>01875             prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#adda6eaec6c34f5df63e5a062a8bb4b6e">w</a>[1] = 0;
<a name="l01876"></a>01876             prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#a1ae50762651c6ce6a2f4ca35bf04ca25">h</a>[1] = 0;
<a name="l01877"></a>01877             prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#adc07eb0c4338c99cee802180870bbbfb">rect</a>[1] = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01878"></a>01878         }
<a name="l01879"></a>01879         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;PreviewImage&quot;</span>, 1, prv);
<a name="l01880"></a>01880         <span class="keywordflow">if</span> (prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#adc07eb0c4338c99cee802180870bbbfb">rect</a>[0]) <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#adda6eaec6c34f5df63e5a062a8bb4b6e">w</a>[0]*prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#a1ae50762651c6ce6a2f4ca35bf04ca25">h</a>[0]*<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#adc07eb0c4338c99cee802180870bbbfb">rect</a>[0]);
<a name="l01881"></a>01881         <span class="keywordflow">if</span> (prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#adc07eb0c4338c99cee802180870bbbfb">rect</a>[1]) <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#adda6eaec6c34f5df63e5a062a8bb4b6e">w</a>[1]*prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#a1ae50762651c6ce6a2f4ca35bf04ca25">h</a>[1]*<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#adc07eb0c4338c99cee802180870bbbfb">rect</a>[1]);
<a name="l01882"></a>01882 
<a name="l01883"></a>01883         <span class="comment">/* restore preview, we still want to keep it in memory even if not saved to file */</span>
<a name="l01884"></a>01884         <span class="keywordflow">if</span> (!(<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.flag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a388154726ebac615445990ae490cd40f">USER_SAVE_PREVIEWS</a>) ) {
<a name="l01885"></a>01885             prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#adda6eaec6c34f5df63e5a062a8bb4b6e">w</a>[1] = w;
<a name="l01886"></a>01886             prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#a1ae50762651c6ce6a2f4ca35bf04ca25">h</a>[1] = h;
<a name="l01887"></a>01887             prv-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#adc07eb0c4338c99cee802180870bbbfb">rect</a>[1] = rect;
<a name="l01888"></a>01888         }
<a name="l01889"></a>01889     }
<a name="l01890"></a>01890 }
<a name="l01891"></a>01891 
<a name="l01892"></a><a class="code" href="../../d3/d68/writefile_8c.html#a7cd9f4a822eb00f352226447af605efe">01892</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a7cd9f4a822eb00f352226447af605efe">write_images</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l01893"></a>01893 {
<a name="l01894"></a>01894     <a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *ima;
<a name="l01895"></a>01895     <a class="code" href="../../dd/d77/structPackedFile.html">PackedFile</a> * <a class="code" href="../../d8/d9d/gim__memory_8h.html#aa7421a08567e946189db67fbebfb88e0" title="Prefetch 64.">pf</a>;
<a name="l01896"></a>01896 
<a name="l01897"></a>01897 
<a name="l01898"></a>01898     ima= idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01899"></a>01899     <span class="keywordflow">while</span> (ima) {
<a name="l01900"></a>01900         <span class="keywordflow">if</span> (ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l01901"></a>01901             <span class="comment">/* write LibData */</span>
<a name="l01902"></a>01902             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a564eac75543b047cf8b2b759818529c3">ID_IM</a>, <span class="stringliteral">&quot;Image&quot;</span>, 1, ima);
<a name="l01903"></a>01903             <span class="keywordflow">if</span> (ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l01904"></a>01904 
<a name="l01905"></a>01905             <span class="keywordflow">if</span> (ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a0e0851c62c73413ddefacfa48e199c8e">packedfile</a>) {
<a name="l01906"></a>01906                 pf = ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a0e0851c62c73413ddefacfa48e199c8e">packedfile</a>;
<a name="l01907"></a>01907                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;PackedFile&quot;</span>, 1, pf);
<a name="l01908"></a>01908                 <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, pf-&gt;<a class="code" href="../../dd/d77/structPackedFile.html#ab46e545f88274c5c348303a84fd735d6">size</a>, pf-&gt;<a class="code" href="../../dd/d77/structPackedFile.html#ab26282078abf88909ab32213a4290f8e">data</a>);
<a name="l01909"></a>01909             }
<a name="l01910"></a>01910 
<a name="l01911"></a>01911             <a class="code" href="../../d3/d68/writefile_8c.html#a526d596be5b6a444eb1966f851cf9c59">write_previews</a>(wd, ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a1c97663701a45c784752d88b3e9b1749">preview</a>);
<a name="l01912"></a>01912         }
<a name="l01913"></a>01913         ima= ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aaf5fcd281cf4337d6686322f82187896">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l01914"></a>01914     }
<a name="l01915"></a>01915     <span class="comment">/* flush helps the compression for undo-save */</span>
<a name="l01916"></a>01916     <a class="code" href="../../d3/d68/writefile_8c.html#ad3cd0b85338465ac04a3b48cc084e1c9">mywrite</a>(wd, <a class="code" href="../../d3/d68/writefile_8c.html#ab6d466684929096461d75d8e48c455e4">MYWRITE_FLUSH</a>, 0);
<a name="l01917"></a>01917 }
<a name="l01918"></a>01918 
<a name="l01919"></a><a class="code" href="../../d3/d68/writefile_8c.html#a840ba5cb329e11753da59d1a27fa0d9e">01919</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a840ba5cb329e11753da59d1a27fa0d9e">write_textures</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l01920"></a>01920 {
<a name="l01921"></a>01921     <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex;
<a name="l01922"></a>01922 
<a name="l01923"></a>01923     tex= idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01924"></a>01924     <span class="keywordflow">while</span> (tex) {
<a name="l01925"></a>01925         <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l01926"></a>01926             <span class="comment">/* write LibData */</span>
<a name="l01927"></a>01927             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac850344bf7854d7860b43adb1e65e228">ID_TE</a>, <span class="stringliteral">&quot;Tex&quot;</span>, 1, tex);
<a name="l01928"></a>01928             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l01929"></a>01929 
<a name="l01930"></a>01930             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a0ec2c56bda9943af0ea2540d25dca05b">adt</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(wd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a0ec2c56bda9943af0ea2540d25dca05b">adt</a>);
<a name="l01931"></a>01931 
<a name="l01932"></a>01932             <span class="comment">/* direct data */</span>
<a name="l01933"></a>01933             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aa7daf61fa1146d430403e81db6acb7cb">type</a> == <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#ab99dfbf8e7952fd8f8f0f6466c798545">TEX_PLUGIN</a> &amp;&amp; tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a215592459592ac15cc9c97c765f5e48c">plugin</a>) <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;PluginTex&quot;</span>, 1, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a215592459592ac15cc9c97c765f5e48c">plugin</a>);
<a name="l01934"></a>01934             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8a9db83c0f33abeb5ff2bf434abeac9e">coba</a>) <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ColorBand&quot;</span>, 1, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8a9db83c0f33abeb5ff2bf434abeac9e">coba</a>);
<a name="l01935"></a>01935             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aa7daf61fa1146d430403e81db6acb7cb">type</a> == <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a268a78c388efb693b879d6d21d3f60c7">TEX_ENVMAP</a> &amp;&amp; tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a38f85ab225d5634cf434ae45e7eed004">env</a>) <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;EnvMap&quot;</span>, 1, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a38f85ab225d5634cf434ae45e7eed004">env</a>);
<a name="l01936"></a>01936             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aa7daf61fa1146d430403e81db6acb7cb">type</a> == <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a0d2d438f1eb6896112dd8862eae03be2">TEX_POINTDENSITY</a> &amp;&amp; tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>) {
<a name="l01937"></a>01937                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;PointDensity&quot;</span>, 1, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>);
<a name="l01938"></a>01938                 <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#ac8b36aceadb3bd386d25c530b184abeb">coba</a>) <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ColorBand&quot;</span>, 1, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#ac8b36aceadb3bd386d25c530b184abeb">coba</a>);
<a name="l01939"></a>01939                 <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#a6abf2c1c53dd738d64351883bbeea86a">falloff_curve</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a1aee9b323a690ee9d46323ade9511325">write_curvemapping</a>(wd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8c0e121467f29b301d04a2f7ffb31b83">pd</a>-&gt;<a class="code" href="../../d3/d56/structPointDensity.html#a6abf2c1c53dd738d64351883bbeea86a">falloff_curve</a>);
<a name="l01940"></a>01940             }
<a name="l01941"></a>01941             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aa7daf61fa1146d430403e81db6acb7cb">type</a> == <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a7fd8163d72590628d35ab2695e48424a">TEX_VOXELDATA</a>) <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;VoxelData&quot;</span>, 1, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aba055da711843959e8dc4756642964d7">vd</a>);
<a name="l01942"></a>01942             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#aa7daf61fa1146d430403e81db6acb7cb">type</a> == <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a0bfbe31cefcbc95329fdcc8273fad989">TEX_OCEAN</a> &amp;&amp; tex-&gt;<a class="code" href="../../df/d2d/structTex.html#af341d5d70f3cbb308a0daa51dcf63efb">ot</a>) <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;OceanTex&quot;</span>, 1, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#af341d5d70f3cbb308a0daa51dcf63efb">ot</a>);
<a name="l01943"></a>01943             
<a name="l01944"></a>01944             <span class="comment">/* nodetree is integral part of texture, no libdata */</span>
<a name="l01945"></a>01945             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>) {
<a name="l01946"></a>01946                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bNodeTree&quot;</span>, 1, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>);
<a name="l01947"></a>01947                 <a class="code" href="../../d3/d68/writefile_8c.html#af9f71b9a5851076e655198986376e392">write_nodetree</a>(wd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>);
<a name="l01948"></a>01948             }
<a name="l01949"></a>01949             
<a name="l01950"></a>01950             <a class="code" href="../../d3/d68/writefile_8c.html#a526d596be5b6a444eb1966f851cf9c59">write_previews</a>(wd, tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a4d69ee82e64e0c519433a2962a0a1b3a">preview</a>);
<a name="l01951"></a>01951         }
<a name="l01952"></a>01952         tex= tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l01953"></a>01953     }
<a name="l01954"></a>01954 
<a name="l01955"></a>01955     <span class="comment">/* flush helps the compression for undo-save */</span>
<a name="l01956"></a>01956     <a class="code" href="../../d3/d68/writefile_8c.html#ad3cd0b85338465ac04a3b48cc084e1c9">mywrite</a>(wd, <a class="code" href="../../d3/d68/writefile_8c.html#ab6d466684929096461d75d8e48c455e4">MYWRITE_FLUSH</a>, 0);
<a name="l01957"></a>01957 }
<a name="l01958"></a>01958 
<a name="l01959"></a><a class="code" href="../../d3/d68/writefile_8c.html#a1e3c32b488a40f3ab3f3ade7b837bea6">01959</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a1e3c32b488a40f3ab3f3ade7b837bea6">write_materials</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l01960"></a>01960 {
<a name="l01961"></a>01961     <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma;
<a name="l01962"></a>01962     <span class="keywordtype">int</span> a;
<a name="l01963"></a>01963 
<a name="l01964"></a>01964     ma= idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01965"></a>01965     <span class="keywordflow">while</span> (ma) {
<a name="l01966"></a>01966         <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l01967"></a>01967             <span class="comment">/* write LibData */</span>
<a name="l01968"></a>01968             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#acf5020c901e2793a056ffca95ec8195a">ID_MA</a>, <span class="stringliteral">&quot;Material&quot;</span>, 1, ma);
<a name="l01969"></a>01969             
<a name="l01970"></a>01970             <span class="comment">/* Write ID Properties -- and copy this comment EXACTLY for easy finding</span>
<a name="l01971"></a>01971 <span class="comment">             * of library blocks that implement this.*/</span>
<a name="l01972"></a>01972             <span class="comment">/* manually set head group property to IDP_GROUP, just in case it hadn&#39;t been</span>
<a name="l01973"></a>01973 <span class="comment">             * set yet :) */</span>
<a name="l01974"></a>01974             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l01975"></a>01975             
<a name="l01976"></a>01976             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#abd1e09497ddf15bd6b49b0bc31ce3e42">adt</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(wd, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#abd1e09497ddf15bd6b49b0bc31ce3e42">adt</a>);
<a name="l01977"></a>01977 
<a name="l01978"></a>01978             <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l01979"></a>01979                 <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]) <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;MTex&quot;</span>, 1, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>[a]);
<a name="l01980"></a>01980             }
<a name="l01981"></a>01981             
<a name="l01982"></a>01982             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a64069c881aa121bf9faa495da7768b5f">ramp_col</a>) <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ColorBand&quot;</span>, 1, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a64069c881aa121bf9faa495da7768b5f">ramp_col</a>);
<a name="l01983"></a>01983             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a60395437e9ccda837921ab3bfa8e009c">ramp_spec</a>) <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ColorBand&quot;</span>, 1, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a60395437e9ccda837921ab3bfa8e009c">ramp_spec</a>);
<a name="l01984"></a>01984             
<a name="l01985"></a>01985             <span class="comment">/* nodetree is integral part of material, no libdata */</span>
<a name="l01986"></a>01986             <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>) {
<a name="l01987"></a>01987                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bNodeTree&quot;</span>, 1, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>);
<a name="l01988"></a>01988                 <a class="code" href="../../d3/d68/writefile_8c.html#af9f71b9a5851076e655198986376e392">write_nodetree</a>(wd, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>);
<a name="l01989"></a>01989             }
<a name="l01990"></a>01990 
<a name="l01991"></a>01991             <a class="code" href="../../d3/d68/writefile_8c.html#a526d596be5b6a444eb1966f851cf9c59">write_previews</a>(wd, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a59344162eb206d2d639fc13df892c153">preview</a>);            
<a name="l01992"></a>01992         }
<a name="l01993"></a>01993         ma= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l01994"></a>01994     }
<a name="l01995"></a>01995 }
<a name="l01996"></a>01996 
<a name="l01997"></a><a class="code" href="../../d3/d68/writefile_8c.html#a46c722e8ac156abc21df37e3237e7c46">01997</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a46c722e8ac156abc21df37e3237e7c46">write_worlds</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l01998"></a>01998 {
<a name="l01999"></a>01999     <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wrld;
<a name="l02000"></a>02000     <span class="keywordtype">int</span> a;
<a name="l02001"></a>02001 
<a name="l02002"></a>02002     wrld= idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02003"></a>02003     <span class="keywordflow">while</span> (wrld) {
<a name="l02004"></a>02004         <span class="keywordflow">if</span> (wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l02005"></a>02005             <span class="comment">/* write LibData */</span>
<a name="l02006"></a>02006             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa1ab8c153d4a007f72d37a2106ecbfa0">ID_WO</a>, <span class="stringliteral">&quot;World&quot;</span>, 1, wrld);
<a name="l02007"></a>02007             <span class="keywordflow">if</span> (wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l02008"></a>02008             
<a name="l02009"></a>02009             <span class="keywordflow">if</span> (wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a72f1ac7ad0412174afba2f873d70aa36">adt</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(wd, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a72f1ac7ad0412174afba2f873d70aa36">adt</a>);
<a name="l02010"></a>02010             
<a name="l02011"></a>02011             <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l02012"></a>02012                 <span class="keywordflow">if</span> (wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#aa41e14c520e87635c6c9a748dd144e25">mtex</a>[a]) <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;MTex&quot;</span>, 1, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#aa41e14c520e87635c6c9a748dd144e25">mtex</a>[a]);
<a name="l02013"></a>02013             }
<a name="l02014"></a>02014 
<a name="l02015"></a>02015             <span class="comment">/* nodetree is integral part of lamps, no libdata */</span>
<a name="l02016"></a>02016             <span class="keywordflow">if</span> (wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a141c5c72fbf4bedfab53b9f0f091b1a9">nodetree</a>) {
<a name="l02017"></a>02017                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bNodeTree&quot;</span>, 1, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a141c5c72fbf4bedfab53b9f0f091b1a9">nodetree</a>);
<a name="l02018"></a>02018                 <a class="code" href="../../d3/d68/writefile_8c.html#af9f71b9a5851076e655198986376e392">write_nodetree</a>(wd, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a141c5c72fbf4bedfab53b9f0f091b1a9">nodetree</a>);
<a name="l02019"></a>02019             }
<a name="l02020"></a>02020             
<a name="l02021"></a>02021             <a class="code" href="../../d3/d68/writefile_8c.html#a526d596be5b6a444eb1966f851cf9c59">write_previews</a>(wd, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a156e067e36c386be1f2a889528109195">preview</a>);
<a name="l02022"></a>02022         }
<a name="l02023"></a>02023         wrld= wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l02024"></a>02024     }
<a name="l02025"></a>02025 }
<a name="l02026"></a>02026 
<a name="l02027"></a><a class="code" href="../../d3/d68/writefile_8c.html#a58a8b94c1e2848cd0350a43bcbd09149">02027</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a58a8b94c1e2848cd0350a43bcbd09149">write_lamps</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l02028"></a>02028 {
<a name="l02029"></a>02029     <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la;
<a name="l02030"></a>02030     <span class="keywordtype">int</span> a;
<a name="l02031"></a>02031 
<a name="l02032"></a>02032     la= idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02033"></a>02033     <span class="keywordflow">while</span> (la) {
<a name="l02034"></a>02034         <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l02035"></a>02035             <span class="comment">/* write LibData */</span>
<a name="l02036"></a>02036             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82e259dda95124fd771a23f105f52810">ID_LA</a>, <span class="stringliteral">&quot;Lamp&quot;</span>, 1, la);
<a name="l02037"></a>02037             <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l02038"></a>02038             
<a name="l02039"></a>02039             <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6f57eb2f6f8da5eff909039d9188c0b1">adt</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(wd, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6f57eb2f6f8da5eff909039d9188c0b1">adt</a>);
<a name="l02040"></a>02040             
<a name="l02041"></a>02041             <span class="comment">/* direct data */</span>
<a name="l02042"></a>02042             <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l02043"></a>02043                 <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add02e1f88fe6e0ab0f54de00fd02b49e">mtex</a>[a]) <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;MTex&quot;</span>, 1, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add02e1f88fe6e0ab0f54de00fd02b49e">mtex</a>[a]);
<a name="l02044"></a>02044             }
<a name="l02045"></a>02045             
<a name="l02046"></a>02046             <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#ae75f87abb3b95ca23081c5e7cd008340">curfalloff</a>)
<a name="l02047"></a>02047                 <a class="code" href="../../d3/d68/writefile_8c.html#a1aee9b323a690ee9d46323ade9511325">write_curvemapping</a>(wd, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#ae75f87abb3b95ca23081c5e7cd008340">curfalloff</a>); 
<a name="l02048"></a>02048             
<a name="l02049"></a>02049             <span class="comment">/* nodetree is integral part of lamps, no libdata */</span>
<a name="l02050"></a>02050             <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a957058346e5bf9659eec90ba4e31d76f">nodetree</a>) {
<a name="l02051"></a>02051                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bNodeTree&quot;</span>, 1, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a957058346e5bf9659eec90ba4e31d76f">nodetree</a>);
<a name="l02052"></a>02052                 <a class="code" href="../../d3/d68/writefile_8c.html#af9f71b9a5851076e655198986376e392">write_nodetree</a>(wd, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a957058346e5bf9659eec90ba4e31d76f">nodetree</a>);
<a name="l02053"></a>02053             }
<a name="l02054"></a>02054 
<a name="l02055"></a>02055             <a class="code" href="../../d3/d68/writefile_8c.html#a526d596be5b6a444eb1966f851cf9c59">write_previews</a>(wd, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a08a7713434a8ef3d9649eb73953c37cb">preview</a>);
<a name="l02056"></a>02056             
<a name="l02057"></a>02057         }
<a name="l02058"></a>02058         la= la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l02059"></a>02059     }
<a name="l02060"></a>02060 }
<a name="l02061"></a>02061 
<a name="l02062"></a>02062 
<a name="l02063"></a><a class="code" href="../../d3/d68/writefile_8c.html#ab510d50d1745bb0094a768b5f677b977">02063</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#ab510d50d1745bb0094a768b5f677b977">write_scenes</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *scebase)
<a name="l02064"></a>02064 {
<a name="l02065"></a>02065     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l02066"></a>02066     <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l02067"></a>02067     <a class="code" href="../../d5/de9/structEditing.html">Editing</a> *ed;
<a name="l02068"></a>02068     <a class="code" href="../../dd/d1a/structSequence.html">Sequence</a> *seq;
<a name="l02069"></a>02069     <a class="code" href="../../de/d91/structMetaStack.html">MetaStack</a> *ms;
<a name="l02070"></a>02070     <a class="code" href="../../de/d68/structStrip.html">Strip</a> *strip;
<a name="l02071"></a>02071     <a class="code" href="../../d2/d3e/structTimeMarker.html">TimeMarker</a> *marker;
<a name="l02072"></a>02072     <a class="code" href="../../d5/d69/structTransformOrientation.html">TransformOrientation</a> *ts;
<a name="l02073"></a>02073     <a class="code" href="../../d1/d51/structSceneRenderLayer.html">SceneRenderLayer</a> *srl;
<a name="l02074"></a>02074     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *tos;
<a name="l02075"></a>02075     
<a name="l02076"></a>02076     sce= scebase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02077"></a>02077     <span class="keywordflow">while</span> (sce) {
<a name="l02078"></a>02078         <span class="comment">/* write LibData */</span>
<a name="l02079"></a>02079         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac2b425dbd1f73ad1720fafad2626d974">ID_SCE</a>, <span class="stringliteral">&quot;Scene&quot;</span>, 1, sce);
<a name="l02080"></a>02080         <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l02081"></a>02081         
<a name="l02082"></a>02082         <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#abdea91c45720e729d4fd49b37fee664e">adt</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(wd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#abdea91c45720e729d4fd49b37fee664e">adt</a>);
<a name="l02083"></a>02083         <a class="code" href="../../d3/d68/writefile_8c.html#afcb6f8f4c6c5580febf5b3865531a5c1">write_keyingsets</a>(wd, &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a61668a1aa7d493a6c770b8cd7a9c9e4e">keyingsets</a>);
<a name="l02084"></a>02084         
<a name="l02085"></a>02085         <span class="comment">/* direct data */</span>
<a name="l02086"></a>02086         base= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02087"></a>02087         <span class="keywordflow">while</span> (base) {
<a name="l02088"></a>02088             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;Base&quot;</span>, 1, base);
<a name="l02089"></a>02089             base= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a25befa992d0ce8876b7d62176212be68">next</a>;
<a name="l02090"></a>02090         }
<a name="l02091"></a>02091         
<a name="l02092"></a>02092         tos = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>;
<a name="l02093"></a>02093         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ToolSettings&quot;</span>, 1, tos);
<a name="l02094"></a>02094         <span class="keywordflow">if</span> (tos-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a71507c50ae356599dfb4bafef460474c">vpaint</a>) {
<a name="l02095"></a>02095             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;VPaint&quot;</span>, 1, tos-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a71507c50ae356599dfb4bafef460474c">vpaint</a>);
<a name="l02096"></a>02096         }
<a name="l02097"></a>02097         <span class="keywordflow">if</span> (tos-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#affa3e524b9068ff98a5f00bb56d8b4e2">wpaint</a>) {
<a name="l02098"></a>02098             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;VPaint&quot;</span>, 1, tos-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#affa3e524b9068ff98a5f00bb56d8b4e2">wpaint</a>);
<a name="l02099"></a>02099         }
<a name="l02100"></a>02100         <span class="keywordflow">if</span> (tos-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a3d7b2bfc12195d43d8dac148e95d0281">sculpt</a>) {
<a name="l02101"></a>02101             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;Sculpt&quot;</span>, 1, tos-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a3d7b2bfc12195d43d8dac148e95d0281">sculpt</a>);
<a name="l02102"></a>02102         }
<a name="l02103"></a>02103         <span class="keywordflow">if</span> (tos-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#ae213655363e0b6c06991bc62b04c346c">uvsculpt</a>) {
<a name="l02104"></a>02104             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;UvSculpt&quot;</span>, 1, tos-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#ae213655363e0b6c06991bc62b04c346c">uvsculpt</a>);
<a name="l02105"></a>02105         }
<a name="l02106"></a>02106 
<a name="l02107"></a>02107         <span class="comment">// write_paint(wd, &amp;tos-&gt;imapaint.paint);</span>
<a name="l02108"></a>02108 
<a name="l02109"></a>02109         ed= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a996dee77afe7797ef9349731bf2342e7">ed</a>;
<a name="l02110"></a>02110         <span class="keywordflow">if</span> (ed) {
<a name="l02111"></a>02111             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;Editing&quot;</span>, 1, ed);
<a name="l02112"></a>02112             
<a name="l02113"></a>02113             <span class="comment">/* reset write flags too */</span>
<a name="l02114"></a>02114             
<a name="l02115"></a>02115             <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#a3de0e0aacb6fcc8f1d3cbca62bd66daf">SEQ_BEGIN</a>(ed, seq) {
<a name="l02116"></a>02116                 <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>) seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a9bb3647b2bfc887c64bfe537f90ece9a">done</a>= 0;
<a name="l02117"></a>02117                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;Sequence&quot;</span>, 1, seq);
<a name="l02118"></a>02118             }
<a name="l02119"></a>02119             <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#afb362a5bc3609465e99eeaac37d5350a">SEQ_END</a>
<a name="l02120"></a>02120             
<a name="l02121"></a>02121             <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#a3de0e0aacb6fcc8f1d3cbca62bd66daf">SEQ_BEGIN</a>(ed, seq) {
<a name="l02122"></a>02122                 <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a> &amp;&amp; seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>-&gt;<a class="code" href="../../de/d68/structStrip.html#a9bb3647b2bfc887c64bfe537f90ece9a">done</a>==0) {
<a name="l02123"></a>02123                     <span class="comment">/* write strip with &#39;done&#39; at 0 because readfile */</span>
<a name="l02124"></a>02124                     
<a name="l02125"></a>02125                     <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a2ce155f30310ee1bf2aca9459e0e1780">plugin</a>) <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;PluginSeq&quot;</span>, 1, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a2ce155f30310ee1bf2aca9459e0e1780">plugin</a>);
<a name="l02126"></a>02126                     <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a1511098380a8c09302a09e43aef9d619">effectdata</a>) {
<a name="l02127"></a>02127                         <span class="keywordflow">switch</span>(seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a748f95b8453aa6af7b77a60532c474ae">type</a>) {
<a name="l02128"></a>02128                         <span class="keywordflow">case</span> <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#ae712fce1b76be5f0eb730367e48ac0fd">SEQ_COLOR</a>:
<a name="l02129"></a>02129                             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SolidColorVars&quot;</span>, 1, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a1511098380a8c09302a09e43aef9d619">effectdata</a>);
<a name="l02130"></a>02130                             <span class="keywordflow">break</span>;
<a name="l02131"></a>02131                         <span class="keywordflow">case</span> <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#a83413469cce986fba23ad6412baa63c6">SEQ_SPEED</a>:
<a name="l02132"></a>02132                             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SpeedControlVars&quot;</span>, 1, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a1511098380a8c09302a09e43aef9d619">effectdata</a>);
<a name="l02133"></a>02133                             <span class="keywordflow">break</span>;
<a name="l02134"></a>02134                         <span class="keywordflow">case</span> <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#ad57bedfd5a49ccaa1ff517002848a88c">SEQ_WIPE</a>:
<a name="l02135"></a>02135                             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;WipeVars&quot;</span>, 1, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a1511098380a8c09302a09e43aef9d619">effectdata</a>);
<a name="l02136"></a>02136                             <span class="keywordflow">break</span>;
<a name="l02137"></a>02137                         <span class="keywordflow">case</span> <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#af593d215afebd3a83ac6b88730be150c">SEQ_GLOW</a>:
<a name="l02138"></a>02138                             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;GlowVars&quot;</span>, 1, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a1511098380a8c09302a09e43aef9d619">effectdata</a>);
<a name="l02139"></a>02139                             <span class="keywordflow">break</span>;
<a name="l02140"></a>02140                         <span class="keywordflow">case</span> <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#a05e3ebe8d311ebda786fd4c99dc71b6e">SEQ_TRANSFORM</a>:
<a name="l02141"></a>02141                             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;TransformVars&quot;</span>, 1, seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a1511098380a8c09302a09e43aef9d619">effectdata</a>);
<a name="l02142"></a>02142                             <span class="keywordflow">break</span>;
<a name="l02143"></a>02143                         }
<a name="l02144"></a>02144                     }
<a name="l02145"></a>02145                     
<a name="l02146"></a>02146                     strip= seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#affbe3a1670437b9c5a70b45bcde77922">strip</a>;
<a name="l02147"></a>02147                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;Strip&quot;</span>, 1, strip);
<a name="l02148"></a>02148                     <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#add20bc7b873e8f7514725f6f3863de53">flag</a> &amp; <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#aae93fd5ad47e10cad18a068f1bbd87e1">SEQ_USE_CROP</a> &amp;&amp; strip-&gt;<a class="code" href="../../de/d68/structStrip.html#a8fc7c9bf25fc3ea39df3d610dccd8c98">crop</a>) {
<a name="l02149"></a>02149                         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;StripCrop&quot;</span>, 1, strip-&gt;<a class="code" href="../../de/d68/structStrip.html#a8fc7c9bf25fc3ea39df3d610dccd8c98">crop</a>);
<a name="l02150"></a>02150                     }
<a name="l02151"></a>02151                     <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#add20bc7b873e8f7514725f6f3863de53">flag</a> &amp; <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#a2204e50084fbbed919186dc2dad36f14">SEQ_USE_TRANSFORM</a> &amp;&amp; strip-&gt;<a class="code" href="../../de/d68/structStrip.html#a5af17c211cfb7bcbce74cccb65dce646">transform</a>) {
<a name="l02152"></a>02152                         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;StripTransform&quot;</span>, 1, strip-&gt;<a class="code" href="../../de/d68/structStrip.html#a5af17c211cfb7bcbce74cccb65dce646">transform</a>);
<a name="l02153"></a>02153                     }
<a name="l02154"></a>02154                     <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#add20bc7b873e8f7514725f6f3863de53">flag</a> &amp; <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#a4d0c26e4068782fec7aa66f28f085d77">SEQ_USE_PROXY</a> &amp;&amp; strip-&gt;<a class="code" href="../../de/d68/structStrip.html#a4c46b863a908159422228f7f444e5b99">proxy</a>) {
<a name="l02155"></a>02155                         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;StripProxy&quot;</span>, 1, strip-&gt;<a class="code" href="../../de/d68/structStrip.html#a4c46b863a908159422228f7f444e5b99">proxy</a>);
<a name="l02156"></a>02156                     }
<a name="l02157"></a>02157                     <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#add20bc7b873e8f7514725f6f3863de53">flag</a> &amp; <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#a305a49ff2589843313114656f4048c47">SEQ_USE_COLOR_BALANCE</a> &amp;&amp; strip-&gt;<a class="code" href="../../de/d68/structStrip.html#a233ff06d80b67b79240b38c5b6146165">color_balance</a>) {
<a name="l02158"></a>02158                         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;StripColorBalance&quot;</span>, 1, strip-&gt;<a class="code" href="../../de/d68/structStrip.html#a233ff06d80b67b79240b38c5b6146165">color_balance</a>);
<a name="l02159"></a>02159                     }
<a name="l02160"></a>02160                     <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a748f95b8453aa6af7b77a60532c474ae">type</a>==<a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#ac06b183625bca249c8c0d1168f907aeb">SEQ_IMAGE</a>)
<a name="l02161"></a>02161                         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;StripElem&quot;</span>, <a class="code" href="../../da/d2b/mallocn_8c.html#a7d1e6a2f5f9d271452a168d3a637d91f">MEM_allocN_len</a>(strip-&gt;<a class="code" href="../../de/d68/structStrip.html#a5f5ecc8c7ffc8375e8a43b2500738889">stripdata</a>) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../d0/d38/structStripElem.html">StripElem</a>), strip-&gt;<a class="code" href="../../de/d68/structStrip.html#a5f5ecc8c7ffc8375e8a43b2500738889">stripdata</a>);
<a name="l02162"></a>02162                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a748f95b8453aa6af7b77a60532c474ae">type</a>==<a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#af37f12bdb831d524294dcd62ff0a8805">SEQ_MOVIE</a> || seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a748f95b8453aa6af7b77a60532c474ae">type</a>==<a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#a8b0dfdfbb5067b1fe563ac12b3df6c69">SEQ_RAM_SOUND</a> || seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#a748f95b8453aa6af7b77a60532c474ae">type</a> == <a class="code" href="../../d7/da9/DNA__sequence__types_8h.html#af135daf13efd69a8d844dc7d9058cdc1">SEQ_HD_SOUND</a>)
<a name="l02163"></a>02163                         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;StripElem&quot;</span>, 1, strip-&gt;<a class="code" href="../../de/d68/structStrip.html#a5f5ecc8c7ffc8375e8a43b2500738889">stripdata</a>);
<a name="l02164"></a>02164                     
<a name="l02165"></a>02165                     strip-&gt;<a class="code" href="../../de/d68/structStrip.html#a9bb3647b2bfc887c64bfe537f90ece9a">done</a>= 1;
<a name="l02166"></a>02166                 }
<a name="l02167"></a>02167             }
<a name="l02168"></a>02168             <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#afb362a5bc3609465e99eeaac37d5350a">SEQ_END</a>
<a name="l02169"></a>02169                 
<a name="l02170"></a>02170             <span class="comment">/* new; meta stack too, even when its nasty restore code */</span>
<a name="l02171"></a>02171             <span class="keywordflow">for</span> (ms= ed-&gt;<a class="code" href="../../d5/de9/structEditing.html#a71fc675641a789cae753a4480aea15cf">metastack</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ms; ms= ms-&gt;<a class="code" href="../../de/d91/structMetaStack.html#ab702b65bad4cbd16dd0b32887fb5da32">next</a>) {
<a name="l02172"></a>02172                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;MetaStack&quot;</span>, 1, ms);
<a name="l02173"></a>02173             }
<a name="l02174"></a>02174         }
<a name="l02175"></a>02175         
<a name="l02176"></a>02176         <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a5bde997eb354cd32f806a2cfc82f3ac2">avicodecdata</a>) {
<a name="l02177"></a>02177             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;AviCodecData&quot;</span>, 1, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a5bde997eb354cd32f806a2cfc82f3ac2">avicodecdata</a>);
<a name="l02178"></a>02178             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a5bde997eb354cd32f806a2cfc82f3ac2">avicodecdata</a>-&gt;<a class="code" href="../../d9/d3e/structAviCodecData.html#a3fc87d8115240de7e27cd05d1bb1ed8b">lpFormat</a>) <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a5bde997eb354cd32f806a2cfc82f3ac2">avicodecdata</a>-&gt;<a class="code" href="../../d9/d3e/structAviCodecData.html#a16e6f6a51ecd4f5e395c3f7d62e731d9">cbFormat</a>, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a5bde997eb354cd32f806a2cfc82f3ac2">avicodecdata</a>-&gt;<a class="code" href="../../d9/d3e/structAviCodecData.html#a3fc87d8115240de7e27cd05d1bb1ed8b">lpFormat</a>);
<a name="l02179"></a>02179             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a5bde997eb354cd32f806a2cfc82f3ac2">avicodecdata</a>-&gt;<a class="code" href="../../d9/d3e/structAviCodecData.html#a426beb8964b8a27a366c28cc56588b71">lpParms</a>) <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a5bde997eb354cd32f806a2cfc82f3ac2">avicodecdata</a>-&gt;<a class="code" href="../../d9/d3e/structAviCodecData.html#ac68dffe2fe1cbc7aec60d353429221fa">cbParms</a>, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a5bde997eb354cd32f806a2cfc82f3ac2">avicodecdata</a>-&gt;<a class="code" href="../../d9/d3e/structAviCodecData.html#a426beb8964b8a27a366c28cc56588b71">lpParms</a>);
<a name="l02180"></a>02180         }
<a name="l02181"></a>02181 
<a name="l02182"></a>02182         <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#abb4ac3dcf18fb91c934d1a330802234b">qtcodecdata</a>) {
<a name="l02183"></a>02183             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;QuicktimeCodecData&quot;</span>, 1, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#abb4ac3dcf18fb91c934d1a330802234b">qtcodecdata</a>);
<a name="l02184"></a>02184             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#abb4ac3dcf18fb91c934d1a330802234b">qtcodecdata</a>-&gt;<a class="code" href="../../d2/d03/structQuicktimeCodecData.html#aba683799ebc5231dd3da28d70a5db6e9">cdParms</a>) <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#abb4ac3dcf18fb91c934d1a330802234b">qtcodecdata</a>-&gt;<a class="code" href="../../d2/d03/structQuicktimeCodecData.html#a283c4b4ff9df6799848cb4fbf7cf0d70">cdSize</a>, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#abb4ac3dcf18fb91c934d1a330802234b">qtcodecdata</a>-&gt;<a class="code" href="../../d2/d03/structQuicktimeCodecData.html#aba683799ebc5231dd3da28d70a5db6e9">cdParms</a>);
<a name="l02185"></a>02185         }
<a name="l02186"></a>02186         <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaad814d69e4d36c2e95c2c1263f2f8f7">ffcodecdata</a>.<a class="code" href="../../d3/d4d/structFFMpegCodecData.html#a9a7dc0b9a03ebde32a65b29c1ab01d3e">properties</a>) {
<a name="l02187"></a>02187             <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaad814d69e4d36c2e95c2c1263f2f8f7">ffcodecdata</a>.<a class="code" href="../../d3/d4d/structFFMpegCodecData.html#a9a7dc0b9a03ebde32a65b29c1ab01d3e">properties</a>, wd);
<a name="l02188"></a>02188         }
<a name="l02189"></a>02189 
<a name="l02190"></a>02190         <span class="comment">/* writing dynamic list of TimeMarkers to the blend file */</span>
<a name="l02191"></a>02191         <span class="keywordflow">for</span> (marker= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#ad75df026c409d765b297e18f988b9d93">markers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; marker; marker= marker-&gt;<a class="code" href="../../d2/d3e/structTimeMarker.html#ae24b020d13fed8c505c8c6405e31d6a6">next</a>)
<a name="l02192"></a>02192             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;TimeMarker&quot;</span>, 1, marker);
<a name="l02193"></a>02193         
<a name="l02194"></a>02194         <span class="comment">/* writing dynamic list of TransformOrientations to the blend file */</span>
<a name="l02195"></a>02195         <span class="keywordflow">for</span> (ts = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aea22a1b7c82a34733d85376ea882893d">transform_spaces</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ts; ts = ts-&gt;<a class="code" href="../../d5/d69/structTransformOrientation.html#a9253d1d1a14fb4973e16f7d64b6f78f4">next</a>)
<a name="l02196"></a>02196             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;TransformOrientation&quot;</span>, 1, ts);
<a name="l02197"></a>02197         
<a name="l02198"></a>02198         <span class="keywordflow">for</span> (srl= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a235b7b4bed2d2d73189d3e12c219672a">layers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; srl; srl= srl-&gt;<a class="code" href="../../d1/d51/structSceneRenderLayer.html#a9363918698634136fa21bafcabd79d27">next</a>)
<a name="l02199"></a>02199             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SceneRenderLayer&quot;</span>, 1, srl);
<a name="l02200"></a>02200         
<a name="l02201"></a>02201         <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>) {
<a name="l02202"></a>02202             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bNodeTree&quot;</span>, 1, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>);
<a name="l02203"></a>02203             <a class="code" href="../../d3/d68/writefile_8c.html#af9f71b9a5851076e655198986376e392">write_nodetree</a>(wd, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>);
<a name="l02204"></a>02204         }
<a name="l02205"></a>02205         
<a name="l02206"></a>02206         sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l02207"></a>02207     }
<a name="l02208"></a>02208     <span class="comment">/* flush helps the compression for undo-save */</span>
<a name="l02209"></a>02209     <a class="code" href="../../d3/d68/writefile_8c.html#ad3cd0b85338465ac04a3b48cc084e1c9">mywrite</a>(wd, <a class="code" href="../../d3/d68/writefile_8c.html#ab6d466684929096461d75d8e48c455e4">MYWRITE_FLUSH</a>, 0);
<a name="l02210"></a>02210 }
<a name="l02211"></a>02211 
<a name="l02212"></a><a class="code" href="../../d3/d68/writefile_8c.html#ab62957810b1d34923d8e0d35fd12456f">02212</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#ab62957810b1d34923d8e0d35fd12456f">write_gpencils</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)
<a name="l02213"></a>02213 {
<a name="l02214"></a>02214     <a class="code" href="../../dd/d52/structbGPdata.html">bGPdata</a> *gpd;
<a name="l02215"></a>02215     <a class="code" href="../../da/d7e/structbGPDlayer.html">bGPDlayer</a> *gpl;
<a name="l02216"></a>02216     <a class="code" href="../../d7/dcf/structbGPDframe.html">bGPDframe</a> *gpf;
<a name="l02217"></a>02217     <a class="code" href="../../d8/d2d/structbGPDstroke.html">bGPDstroke</a> *gps;
<a name="l02218"></a>02218     
<a name="l02219"></a>02219     <span class="keywordflow">for</span> (gpd= lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; gpd; gpd= gpd-&gt;<a class="code" href="../../dd/d52/structbGPdata.html#aaec6b9082af7de201b9cd5cf7bfafcd1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02220"></a>02220         <span class="keywordflow">if</span> (gpd-&gt;<a class="code" href="../../dd/d52/structbGPdata.html#aaec6b9082af7de201b9cd5cf7bfafcd1">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l02221"></a>02221             <span class="comment">/* write gpd data block to file */</span>
<a name="l02222"></a>02222             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a2df65579fd9eb1398862a7e915de5dc2">ID_GD</a>, <span class="stringliteral">&quot;bGPdata&quot;</span>, 1, gpd);
<a name="l02223"></a>02223             
<a name="l02224"></a>02224             <span class="comment">/* write grease-pencil layers to file */</span>
<a name="l02225"></a>02225             <span class="keywordflow">for</span> (gpl= gpd-&gt;<a class="code" href="../../dd/d52/structbGPdata.html#a758b708bf82bb5351255c6c1f974a0cc">layers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; gpl; gpl= gpl-&gt;<a class="code" href="../../da/d7e/structbGPDlayer.html#a428b812104383d1b973f98c4dde29ac9">next</a>) {
<a name="l02226"></a>02226                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bGPDlayer&quot;</span>, 1, gpl);
<a name="l02227"></a>02227                 
<a name="l02228"></a>02228                 <span class="comment">/* write this layer&#39;s frames to file */</span>
<a name="l02229"></a>02229                 <span class="keywordflow">for</span> (gpf= gpl-&gt;<a class="code" href="../../da/d7e/structbGPDlayer.html#ab6b8d0f88de061c89b2e6c982cf315d8">frames</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; gpf; gpf= gpf-&gt;<a class="code" href="../../d7/dcf/structbGPDframe.html#a4d6f43b91302df84606cc035b683243c">next</a>) {
<a name="l02230"></a>02230                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bGPDframe&quot;</span>, 1, gpf);
<a name="l02231"></a>02231                     
<a name="l02232"></a>02232                     <span class="comment">/* write strokes */</span>
<a name="l02233"></a>02233                     <span class="keywordflow">for</span> (gps= gpf-&gt;<a class="code" href="../../d7/dcf/structbGPDframe.html#abfcf891752f8fbe98056b519135c52a2">strokes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; gps; gps= gps-&gt;<a class="code" href="../../d8/d2d/structbGPDstroke.html#aeec4e6a65ac743fd5a2a3ede11f2f85e">next</a>) {
<a name="l02234"></a>02234                         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bGPDstroke&quot;</span>, 1, gps);
<a name="l02235"></a>02235                         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bGPDspoint&quot;</span>, gps-&gt;<a class="code" href="../../d8/d2d/structbGPDstroke.html#a6af828382e340e5590e3e39369e1ec6f">totpoints</a>, gps-&gt;<a class="code" href="../../d8/d2d/structbGPDstroke.html#a3891196ee51074815ea4e3a4bed391d4">points</a>);               
<a name="l02236"></a>02236                     }
<a name="l02237"></a>02237                 }
<a name="l02238"></a>02238             }
<a name="l02239"></a>02239         }
<a name="l02240"></a>02240     }
<a name="l02241"></a>02241 }
<a name="l02242"></a>02242 
<a name="l02243"></a><a class="code" href="../../d3/d68/writefile_8c.html#ae2274313c772ae830e94d5e04bda8c08">02243</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#ae2274313c772ae830e94d5e04bda8c08">write_windowmanagers</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)
<a name="l02244"></a>02244 {
<a name="l02245"></a>02245     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm;
<a name="l02246"></a>02246     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win;
<a name="l02247"></a>02247     
<a name="l02248"></a>02248     <span class="keywordflow">for</span> (wm= lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; wm; wm= wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a12a2dca17b6339529f24d0a850b35f41">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02249"></a>02249         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a31e01e435bf4f33398bb3504bc6ce2cb">ID_WM</a>, <span class="stringliteral">&quot;wmWindowManager&quot;</span>, 1, wm);
<a name="l02250"></a>02250         
<a name="l02251"></a>02251         <span class="keywordflow">for</span> (win= wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; win; win= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#accffa1b62f114b1781206c921fc92be1">next</a>)
<a name="l02252"></a>02252             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;wmWindow&quot;</span>, 1, win);
<a name="l02253"></a>02253     }
<a name="l02254"></a>02254 }
<a name="l02255"></a>02255 
<a name="l02256"></a><a class="code" href="../../d3/d68/writefile_8c.html#ae78b584464aeeb1a36c62a19b59bda3d">02256</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#ae78b584464aeeb1a36c62a19b59bda3d">write_region</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <span class="keywordtype">int</span> spacetype)
<a name="l02257"></a>02257 {   
<a name="l02258"></a>02258     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ARegion&quot;</span>, 1, ar);
<a name="l02259"></a>02259     
<a name="l02260"></a>02260     <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>) {
<a name="l02261"></a>02261         <span class="keywordflow">switch</span>(spacetype) {
<a name="l02262"></a>02262             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>:
<a name="l02263"></a>02263                 <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>==<a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>) {
<a name="l02264"></a>02264                     <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>;
<a name="l02265"></a>02265                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;RegionView3D&quot;</span>, 1, rv3d);
<a name="l02266"></a>02266                     
<a name="l02267"></a>02267                     <span class="keywordflow">if</span> (rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#aa55a6df5b8a0501c16cfdbcc794d627d">localvd</a>)
<a name="l02268"></a>02268                         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;RegionView3D&quot;</span>, 1, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#aa55a6df5b8a0501c16cfdbcc794d627d">localvd</a>);
<a name="l02269"></a>02269                     <span class="keywordflow">if</span> (rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#af03bef54d5f4dbf31d2f73a8d0c83d0a">clipbb</a>)
<a name="l02270"></a>02270                         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;BoundBox&quot;</span>, 1, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#af03bef54d5f4dbf31d2f73a8d0c83d0a">clipbb</a>);
<a name="l02271"></a>02271 
<a name="l02272"></a>02272                 }
<a name="l02273"></a>02273                 <span class="keywordflow">else</span>
<a name="l02274"></a>02274                     printf(<span class="stringliteral">&quot;regiondata write missing!\n&quot;</span>);
<a name="l02275"></a>02275                 <span class="keywordflow">break</span>;
<a name="l02276"></a>02276             <span class="keywordflow">default</span>:
<a name="l02277"></a>02277                 printf(<span class="stringliteral">&quot;regiondata write missing!\n&quot;</span>);
<a name="l02278"></a>02278         }
<a name="l02279"></a>02279     }
<a name="l02280"></a>02280 }
<a name="l02281"></a>02281 
<a name="l02282"></a><a class="code" href="../../d3/d68/writefile_8c.html#a6b62a6cad91c95080647e8b9a041a213">02282</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a6b62a6cad91c95080647e8b9a041a213">write_screens</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *scrbase)
<a name="l02283"></a>02283 {
<a name="l02284"></a>02284     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l02285"></a>02285     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l02286"></a>02286     <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *sv;
<a name="l02287"></a>02287     <a class="code" href="../../dd/d31/structScrEdge.html">ScrEdge</a> *se;
<a name="l02288"></a>02288 
<a name="l02289"></a>02289     sc= scrbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02290"></a>02290     <span class="keywordflow">while</span> (sc) {
<a name="l02291"></a>02291         
<a name="l02292"></a>02292         <span class="comment">/* write LibData */</span>
<a name="l02293"></a>02293         <span class="comment">/* in 2.50+ files, the file identifier for screens is patched, forward compatibility */</span>
<a name="l02294"></a>02294         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a8d16b9f1a746ad032e45127b34ccc452">ID_SCRN</a>, <span class="stringliteral">&quot;Screen&quot;</span>, 1, sc);
<a name="l02295"></a>02295         <span class="keywordflow">if</span> (sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) 
<a name="l02296"></a>02296             <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l02297"></a>02297         
<a name="l02298"></a>02298         <span class="comment">/* direct data */</span>
<a name="l02299"></a>02299         <span class="keywordflow">for</span> (sv= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a7b16bb3f5dea1f6159af5be6ea599474">vertbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sv; sv= sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a5926b403c5e00af979b2825ee76353eb">next</a>)
<a name="l02300"></a>02300             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ScrVert&quot;</span>, 1, sv);
<a name="l02301"></a>02301         
<a name="l02302"></a>02302         <span class="keywordflow">for</span> (se= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a15558c58cb9e3d4544f6ab5d9c031a9e">edgebase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; se; se= se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a7e0011f64d0b13a5234a7d4a2c1f1948">next</a>)
<a name="l02303"></a>02303             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ScrEdge&quot;</span>, 1, se);
<a name="l02304"></a>02304         
<a name="l02305"></a>02305         <span class="keywordflow">for</span> (sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l02306"></a>02306             <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l02307"></a>02307             <a class="code" href="../../d7/d84/structPanel.html">Panel</a> *pa;
<a name="l02308"></a>02308             <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l02309"></a>02309             
<a name="l02310"></a>02310             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ScrArea&quot;</span>, 1, sa);
<a name="l02311"></a>02311             
<a name="l02312"></a>02312             <span class="keywordflow">for</span> (ar= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l02313"></a>02313                 <a class="code" href="../../d3/d68/writefile_8c.html#ae78b584464aeeb1a36c62a19b59bda3d">write_region</a>(wd, ar, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a124203529b9ea4c84ca8f8ae4efff3e3">spacetype</a>);
<a name="l02314"></a>02314                 
<a name="l02315"></a>02315                 <span class="keywordflow">for</span> (pa= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a72e17f8a4110e1f9d78ff8fb657bf90f">panels</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; pa; pa= pa-&gt;<a class="code" href="../../d7/d84/structPanel.html#afa1196642c467e11f77b3fc0c5eea955">next</a>)
<a name="l02316"></a>02316                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;Panel&quot;</span>, 1, pa);
<a name="l02317"></a>02317             }
<a name="l02318"></a>02318             
<a name="l02319"></a>02319             sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02320"></a>02320             <span class="keywordflow">while</span> (sl) {
<a name="l02321"></a>02321                 <span class="keywordflow">for</span> (ar= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#aa233652ac9d46454aee8327666ecf8d0">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>)
<a name="l02322"></a>02322                     <a class="code" href="../../d3/d68/writefile_8c.html#ae78b584464aeeb1a36c62a19b59bda3d">write_region</a>(wd, ar, sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>);
<a name="l02323"></a>02323                 
<a name="l02324"></a>02324                 <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l02325"></a>02325                     <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d= (<a class="code" href="../../d6/deb/structView3D.html">View3D</a> *) sl;
<a name="l02326"></a>02326                     <a class="code" href="../../df/da6/structBGpic.html">BGpic</a> *bgpic;
<a name="l02327"></a>02327                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;View3D&quot;</span>, 1, v3d);
<a name="l02328"></a>02328                     <span class="keywordflow">for</span> (bgpic= v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a3246c1cbdd50c393126180ae4446992e">bgpicbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; bgpic; bgpic= bgpic-&gt;<a class="code" href="../../df/da6/structBGpic.html#a81c485660f1feac2cfa5c5813153c2f0">next</a>)
<a name="l02329"></a>02329                         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;BGpic&quot;</span>, 1, bgpic);
<a name="l02330"></a>02330                     <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a7e87bb98f5f62744d30d1accb87cc664">localvd</a>) <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;View3D&quot;</span>, 1, v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a7e87bb98f5f62744d30d1accb87cc664">localvd</a>);
<a name="l02331"></a>02331                 }
<a name="l02332"></a>02332                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca67184420c844bcef0dd50660142cede6">SPACE_IPO</a>) {
<a name="l02333"></a>02333                     <a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *sipo= (<a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *)sl;
<a name="l02334"></a>02334                     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> tmpGhosts = sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a59cfc5b0b12e4f30083e376887e6a71a">ghostCurves</a>;
<a name="l02335"></a>02335                     
<a name="l02336"></a>02336                     <span class="comment">/* temporarily disable ghost curves when saving */</span>
<a name="l02337"></a>02337                     sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a59cfc5b0b12e4f30083e376887e6a71a">ghostCurves</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a59cfc5b0b12e4f30083e376887e6a71a">ghostCurves</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02338"></a>02338                     
<a name="l02339"></a>02339                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SpaceIpo&quot;</span>, 1, sl);
<a name="l02340"></a>02340                     <span class="keywordflow">if</span> (sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a818aa81eeab86ebdc0bfddfa0e508e25">ads</a>) <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bDopeSheet&quot;</span>, 1, sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a818aa81eeab86ebdc0bfddfa0e508e25">ads</a>);
<a name="l02341"></a>02341                     
<a name="l02342"></a>02342                     <span class="comment">/* reenable ghost curves */</span>
<a name="l02343"></a>02343                     sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a59cfc5b0b12e4f30083e376887e6a71a">ghostCurves</a>= tmpGhosts;
<a name="l02344"></a>02344                 }
<a name="l02345"></a>02345                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa2a34290401af40dd7a52dd4041cc9da">SPACE_BUTS</a>) {
<a name="l02346"></a>02346                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SpaceButs&quot;</span>, 1, sl);
<a name="l02347"></a>02347                 }
<a name="l02348"></a>02348                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca5f4c324d2af06c247780942931169c7c">SPACE_FILE</a>) {
<a name="l02349"></a>02349                     <a class="code" href="../../d7/d1c/structSpaceFile.html">SpaceFile</a> *sfile= (<a class="code" href="../../d7/d1c/structSpaceFile.html">SpaceFile</a> *)sl;
<a name="l02350"></a>02350 
<a name="l02351"></a>02351                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SpaceFile&quot;</span>, 1, sl);
<a name="l02352"></a>02352                     <span class="keywordflow">if</span> (sfile-&gt;<a class="code" href="../../d7/d1c/structSpaceFile.html#a734998e9f91fa15ae0beb9f723a41d09">params</a>)
<a name="l02353"></a>02353                         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;FileSelectParams&quot;</span>, 1, sfile-&gt;<a class="code" href="../../d7/d1c/structSpaceFile.html#a734998e9f91fa15ae0beb9f723a41d09">params</a>);
<a name="l02354"></a>02354                 }
<a name="l02355"></a>02355                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa78bb4ba1705225aa14af78400406414">SPACE_SEQ</a>) {
<a name="l02356"></a>02356                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SpaceSeq&quot;</span>, 1, sl);
<a name="l02357"></a>02357                 }
<a name="l02358"></a>02358                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca1806179a239521ed61051b9e46b71818">SPACE_OUTLINER</a>) {
<a name="l02359"></a>02359                     <a class="code" href="../../d3/d88/structSpaceOops.html">SpaceOops</a> *so= (<a class="code" href="../../d3/d88/structSpaceOops.html">SpaceOops</a> *)sl;
<a name="l02360"></a>02360                     
<a name="l02361"></a>02361                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SpaceOops&quot;</span>, 1, so);
<a name="l02362"></a>02362 
<a name="l02363"></a>02363                     <span class="comment">/* outliner */</span>
<a name="l02364"></a>02364                     <span class="keywordflow">if</span> (so-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a21a6a94a1af691c1c919af80c76c4cb0">treestore</a>) {
<a name="l02365"></a>02365                         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;TreeStore&quot;</span>, 1, so-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a21a6a94a1af691c1c919af80c76c4cb0">treestore</a>);
<a name="l02366"></a>02366                         <span class="keywordflow">if</span> (so-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a21a6a94a1af691c1c919af80c76c4cb0">treestore</a>-&gt;<a class="code" href="../../d5/d0e/structTreeStore.html#a6a0409bdfd0120c3acda35c6cd8ebd3f">data</a>)
<a name="l02367"></a>02367                             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;TreeStoreElem&quot;</span>, so-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a21a6a94a1af691c1c919af80c76c4cb0">treestore</a>-&gt;<a class="code" href="../../d5/d0e/structTreeStore.html#adac2878f40e7dc9a6a8881f0b421d299">usedelem</a>, so-&gt;<a class="code" href="../../d3/d88/structSpaceOops.html#a21a6a94a1af691c1c919af80c76c4cb0">treestore</a>-&gt;<a class="code" href="../../d5/d0e/structTreeStore.html#a6a0409bdfd0120c3acda35c6cd8ebd3f">data</a>);
<a name="l02368"></a>02368                     }
<a name="l02369"></a>02369                 }
<a name="l02370"></a>02370                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>) {
<a name="l02371"></a>02371                     <a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *sima= (<a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *)sl;
<a name="l02372"></a>02372                     
<a name="l02373"></a>02373                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SpaceImage&quot;</span>, 1, sl);
<a name="l02374"></a>02374                     <span class="keywordflow">if</span> (sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#ac77779485c1d025f8eabb5686d58ac5a">cumap</a>)
<a name="l02375"></a>02375                         <a class="code" href="../../d3/d68/writefile_8c.html#a1aee9b323a690ee9d46323ade9511325">write_curvemapping</a>(wd, sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#ac77779485c1d025f8eabb5686d58ac5a">cumap</a>);
<a name="l02376"></a>02376                 }
<a name="l02377"></a>02377                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca02011ff3a4d991adb9b4c9360dd8b1c3">SPACE_TEXT</a>) {
<a name="l02378"></a>02378                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SpaceText&quot;</span>, 1, sl);
<a name="l02379"></a>02379                 }
<a name="l02380"></a>02380                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caac0ae90ad942da39f8e687b73c11e927">SPACE_SCRIPT</a>) {
<a name="l02381"></a>02381                     <a class="code" href="../../d3/d07/structSpaceScript.html">SpaceScript</a> *scr = (<a class="code" href="../../d3/d07/structSpaceScript.html">SpaceScript</a>*)sl;
<a name="l02382"></a>02382                     scr-&gt;<a class="code" href="../../d3/d07/structSpaceScript.html#a97932d66674f20aacbc60030049a3602">but_refs</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02383"></a>02383                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SpaceScript&quot;</span>, 1, sl);
<a name="l02384"></a>02384                 }
<a name="l02385"></a>02385                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>) {
<a name="l02386"></a>02386                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SpaceAction&quot;</span>, 1, sl);
<a name="l02387"></a>02387                 }
<a name="l02388"></a>02388                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>) {
<a name="l02389"></a>02389                     <a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *snla= (<a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *)sl;
<a name="l02390"></a>02390                     
<a name="l02391"></a>02391                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SpaceNla&quot;</span>, 1, snla);
<a name="l02392"></a>02392                     <span class="keywordflow">if</span> (snla-&gt;<a class="code" href="../../de/d91/structSpaceNla.html#af0d67c10fd08eed0458ab0f1bb73c0fc">ads</a>) <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;bDopeSheet&quot;</span>, 1, snla-&gt;<a class="code" href="../../de/d91/structSpaceNla.html#af0d67c10fd08eed0458ab0f1bb73c0fc">ads</a>);
<a name="l02393"></a>02393                 }
<a name="l02394"></a>02394                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca51011faadfd7d38d3d7a810c600e9458">SPACE_TIME</a>) {
<a name="l02395"></a>02395                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SpaceTime&quot;</span>, 1, sl);
<a name="l02396"></a>02396                 }
<a name="l02397"></a>02397                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca2ef41082c072d92dbf2d57e20442751d">SPACE_NODE</a>) {
<a name="l02398"></a>02398                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SpaceNode&quot;</span>, 1, sl);
<a name="l02399"></a>02399                 }
<a name="l02400"></a>02400                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca09ebd82af4cc18122664889b59473cad">SPACE_LOGIC</a>) {
<a name="l02401"></a>02401                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SpaceLogic&quot;</span>, 1, sl);
<a name="l02402"></a>02402                 }
<a name="l02403"></a>02403                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca1618fa49f6b8e3582db7b40d4e520817">SPACE_CONSOLE</a>) {
<a name="l02404"></a>02404                     <a class="code" href="../../da/d68/structSpaceConsole.html">SpaceConsole</a> *con = (<a class="code" href="../../da/d68/structSpaceConsole.html">SpaceConsole</a>*)sl;
<a name="l02405"></a>02405                     <a class="code" href="../../dd/df4/structConsoleLine.html">ConsoleLine</a> *cl;
<a name="l02406"></a>02406 
<a name="l02407"></a>02407                     <span class="keywordflow">for</span> (cl=con-&gt;<a class="code" href="../../da/d68/structSpaceConsole.html#a37b9aaee0bbd0009dd229c4e6c9cb3fe">history</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; cl; cl=cl-&gt;<a class="code" href="../../dd/df4/structConsoleLine.html#abf7833ee4b5b1cd336f71a4b77614412">next</a>) {
<a name="l02408"></a>02408                         <span class="comment">/* &#39;len_alloc&#39; is invalid on write, set from &#39;len&#39; on read */</span>
<a name="l02409"></a>02409                         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;ConsoleLine&quot;</span>, 1, cl);
<a name="l02410"></a>02410                         <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, cl-&gt;<a class="code" href="../../dd/df4/structConsoleLine.html#af752db442dc19c02cdae4b85da53d09a">len</a>+1, cl-&gt;<a class="code" href="../../dd/df4/structConsoleLine.html#a819831055f8adc1da76506b135ded576">line</a>);
<a name="l02411"></a>02411                     }
<a name="l02412"></a>02412                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SpaceConsole&quot;</span>, 1, sl);
<a name="l02413"></a>02413 
<a name="l02414"></a>02414                 }
<a name="l02415"></a>02415                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca448e29d9aaf96960c8bf83b631b4079d">SPACE_USERPREF</a>) {
<a name="l02416"></a>02416                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SpaceUserPref&quot;</span>, 1, sl);
<a name="l02417"></a>02417                 }
<a name="l02418"></a>02418                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca02bf62758ff66d33c28826738012179d">SPACE_CLIP</a>) {
<a name="l02419"></a>02419                     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;SpaceClip&quot;</span>, 1, sl);
<a name="l02420"></a>02420                 }
<a name="l02421"></a>02421 
<a name="l02422"></a>02422                 sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>;
<a name="l02423"></a>02423             }
<a name="l02424"></a>02424         }
<a name="l02425"></a>02425 
<a name="l02426"></a>02426         sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l02427"></a>02427     }
<a name="l02428"></a>02428 }
<a name="l02429"></a>02429 
<a name="l02430"></a><a class="code" href="../../d3/d68/writefile_8c.html#a6bd16021676b6060f11eeab695861e09">02430</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a6bd16021676b6060f11eeab695861e09">write_libraries</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *<a class="code" href="../../d5/d95/makesdna_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>)
<a name="l02431"></a>02431 {
<a name="l02432"></a>02432     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lbarray[<a class="code" href="../../d8/db1/BKE__library_8h.html#a509c3a883c4af775d87a47a3007189da">MAX_LIBARRAY</a>];
<a name="l02433"></a>02433     <a class="code" href="../../d8/d7e/structID.html">ID</a> *id;
<a name="l02434"></a>02434     <span class="keywordtype">int</span> a, tot, foundone;
<a name="l02435"></a>02435 
<a name="l02436"></a>02436     <span class="keywordflow">for</span> (; <a class="code" href="../../d5/d95/makesdna_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>; main= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a7c76b835863370aa406afc713e8fd0f8">next</a>) {
<a name="l02437"></a>02437 
<a name="l02438"></a>02438         a=tot= <a class="code" href="../../d8/db1/BKE__library_8h.html#ab83f638a06099438e181b7d635f3239c">set_listbasepointers</a>(main, lbarray);
<a name="l02439"></a>02439 
<a name="l02440"></a>02440         <span class="comment">/* test: is lib being used */</span>
<a name="l02441"></a>02441         foundone= 0;
<a name="l02442"></a>02442         <span class="keywordflow">while</span> (tot--) {
<a name="l02443"></a>02443             <span class="keywordflow">for</span> (<span class="keywordtype">id</span>= lbarray[tot]-&gt;first; id; <span class="keywordtype">id</span>= <span class="keywordtype">id</span>-&gt;<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02444"></a>02444                 <span class="keywordflow">if</span> (id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 &amp;&amp; (id-&gt;<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a48cc004c21e097c0d7c1c5fa8dc03b96">LIB_EXTERN</a>)) {
<a name="l02445"></a>02445                     foundone= 1;
<a name="l02446"></a>02446                     <span class="keywordflow">break</span>;
<a name="l02447"></a>02447                 }
<a name="l02448"></a>02448             }
<a name="l02449"></a>02449             <span class="keywordflow">if</span> (foundone) <span class="keywordflow">break</span>;
<a name="l02450"></a>02450         }
<a name="l02451"></a>02451 
<a name="l02452"></a>02452         <span class="keywordflow">if</span> (foundone) {
<a name="l02453"></a>02453             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#abaf1999f335a0db6ef4f452fae0fbd06">ID_LI</a>, <span class="stringliteral">&quot;Library&quot;</span>, 1, main-&gt;<a class="code" href="../../d0/dc0/structMain.html#afa97d1d4a3275a1092d3476a9820cd3d">curlib</a>);
<a name="l02454"></a>02454 
<a name="l02455"></a>02455             <span class="keywordflow">while</span> (a--) {
<a name="l02456"></a>02456                 <span class="keywordflow">for</span> (<span class="keywordtype">id</span>= lbarray[a]-&gt;first; id; <span class="keywordtype">id</span>= <span class="keywordtype">id</span>-&gt;<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02457"></a>02457                     <span class="keywordflow">if</span> (id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 &amp;&amp; (id-&gt;<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a48cc004c21e097c0d7c1c5fa8dc03b96">LIB_EXTERN</a>)) {
<a name="l02458"></a>02458                         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ae719dff14cceff0aafe109635eac72ea">ID_ID</a>, <span class="stringliteral">&quot;ID&quot;</span>, 1, <span class="keywordtype">id</span>);
<a name="l02459"></a>02459                     }
<a name="l02460"></a>02460                 }
<a name="l02461"></a>02461             }
<a name="l02462"></a>02462         }
<a name="l02463"></a>02463     }
<a name="l02464"></a>02464 }
<a name="l02465"></a>02465 
<a name="l02466"></a><a class="code" href="../../d3/d68/writefile_8c.html#acd3e0d6811a73e0a9285e81a84a807c9">02466</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#acd3e0d6811a73e0a9285e81a84a807c9">write_bone</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../de/de0/structBone.html">Bone</a>* bone)
<a name="l02467"></a>02467 {
<a name="l02468"></a>02468     <a class="code" href="../../de/de0/structBone.html">Bone</a>*   cbone;
<a name="l02469"></a>02469 
<a name="l02470"></a>02470     <span class="comment">// PATCH for upward compatibility after 2.37+ armature recode</span>
<a name="l02471"></a>02471     bone-&gt;<a class="code" href="../../de/de0/structBone.html#aa5d059c0e70a089f2322c5bffa105f77">size</a>[0]= bone-&gt;<a class="code" href="../../de/de0/structBone.html#aa5d059c0e70a089f2322c5bffa105f77">size</a>[1]= bone-&gt;<a class="code" href="../../de/de0/structBone.html#aa5d059c0e70a089f2322c5bffa105f77">size</a>[2]= 1.0f;
<a name="l02472"></a>02472         
<a name="l02473"></a>02473     <span class="comment">// Write this bone</span>
<a name="l02474"></a>02474     <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;Bone&quot;</span>, 1, bone);
<a name="l02475"></a>02475 
<a name="l02476"></a>02476     <span class="comment">/* Write ID Properties -- and copy this comment EXACTLY for easy finding</span>
<a name="l02477"></a>02477 <span class="comment">     * of library blocks that implement this.*/</span>
<a name="l02478"></a>02478     <span class="keywordflow">if</span> (bone-&gt;<a class="code" href="../../de/de0/structBone.html#aaba2ee560b6e3d1a41516ed6bff79fab">prop</a>)
<a name="l02479"></a>02479         <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(bone-&gt;<a class="code" href="../../de/de0/structBone.html#aaba2ee560b6e3d1a41516ed6bff79fab">prop</a>, wd);
<a name="l02480"></a>02480     
<a name="l02481"></a>02481     <span class="comment">// Write Children</span>
<a name="l02482"></a>02482     cbone= bone-&gt;<a class="code" href="../../de/de0/structBone.html#af3f173cbc93a3c319cc0f29dfbbf0878">childbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02483"></a>02483     <span class="keywordflow">while</span> (cbone) {
<a name="l02484"></a>02484         <a class="code" href="../../d3/d68/writefile_8c.html#acd3e0d6811a73e0a9285e81a84a807c9">write_bone</a>(wd, cbone);
<a name="l02485"></a>02485         cbone= cbone-&gt;<a class="code" href="../../de/de0/structBone.html#ae63d2260606d516a99ae75fbc7f22e21">next</a>;
<a name="l02486"></a>02486     }
<a name="l02487"></a>02487 }
<a name="l02488"></a>02488 
<a name="l02489"></a><a class="code" href="../../d3/d68/writefile_8c.html#a234facbe9c095dd9ed75faaefecfa41c">02489</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a234facbe9c095dd9ed75faaefecfa41c">write_armatures</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l02490"></a>02490 {
<a name="l02491"></a>02491     <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a>   *arm;
<a name="l02492"></a>02492     <a class="code" href="../../de/de0/structBone.html">Bone</a>        *bone;
<a name="l02493"></a>02493 
<a name="l02494"></a>02494     arm=idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02495"></a>02495     <span class="keywordflow">while</span> (arm) {
<a name="l02496"></a>02496         <span class="keywordflow">if</span> (arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#aac2e7b42212dbab58684702ed9f0921a">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l02497"></a>02497             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ae4ba19f70b08895557ef00b489e7d255">ID_AR</a>, <span class="stringliteral">&quot;bArmature&quot;</span>, 1, arm);
<a name="l02498"></a>02498             <span class="keywordflow">if</span> (arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#aac2e7b42212dbab58684702ed9f0921a">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#aac2e7b42212dbab58684702ed9f0921a">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l02499"></a>02499 
<a name="l02500"></a>02500             <span class="keywordflow">if</span> (arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a3da4410a3e26839cd1a675b0fe1f52d2">adt</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(wd, arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a3da4410a3e26839cd1a675b0fe1f52d2">adt</a>);
<a name="l02501"></a>02501 
<a name="l02502"></a>02502             <span class="comment">/* Direct data */</span>
<a name="l02503"></a>02503             bone= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a70ffd5ceaf18be398f1caa3b30151c0b">bonebase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02504"></a>02504             <span class="keywordflow">while</span> (bone) {
<a name="l02505"></a>02505                 <a class="code" href="../../d3/d68/writefile_8c.html#acd3e0d6811a73e0a9285e81a84a807c9">write_bone</a>(wd, bone);
<a name="l02506"></a>02506                 bone=bone-&gt;<a class="code" href="../../de/de0/structBone.html#ae63d2260606d516a99ae75fbc7f22e21">next</a>;
<a name="l02507"></a>02507             }
<a name="l02508"></a>02508         }
<a name="l02509"></a>02509         arm=arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#aac2e7b42212dbab58684702ed9f0921a">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l02510"></a>02510     }
<a name="l02511"></a>02511 
<a name="l02512"></a>02512     <span class="comment">/* flush helps the compression for undo-save */</span>
<a name="l02513"></a>02513     <a class="code" href="../../d3/d68/writefile_8c.html#ad3cd0b85338465ac04a3b48cc084e1c9">mywrite</a>(wd, <a class="code" href="../../d3/d68/writefile_8c.html#ab6d466684929096461d75d8e48c455e4">MYWRITE_FLUSH</a>, 0);
<a name="l02514"></a>02514 }
<a name="l02515"></a>02515 
<a name="l02516"></a><a class="code" href="../../d3/d68/writefile_8c.html#a771352b7035853d75722b3c843d1d225">02516</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a771352b7035853d75722b3c843d1d225">write_texts</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l02517"></a>02517 {
<a name="l02518"></a>02518     <a class="code" href="../../d2/dda/structText.html">Text</a> *text;
<a name="l02519"></a>02519     <a class="code" href="../../d8/de6/structTextLine.html">TextLine</a> *tmp;
<a name="l02520"></a>02520     <a class="code" href="../../d5/dbb/structTextMarker.html">TextMarker</a> *mrk;
<a name="l02521"></a>02521 
<a name="l02522"></a>02522     text= idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02523"></a>02523     <span class="keywordflow">while</span> (text) {
<a name="l02524"></a>02524         <span class="keywordflow">if</span> ( (text-&gt;<a class="code" href="../../d2/dda/structText.html#a0052b67f5d3d3ef7748a969cebfc2acf">flags</a> &amp; <a class="code" href="../../d7/d71/DNA__text__types_8h.html#a019459fa186f9ee384fb361b03a9f4df">TXT_ISMEM</a>) &amp;&amp; (text-&gt;<a class="code" href="../../d2/dda/structText.html#a0052b67f5d3d3ef7748a969cebfc2acf">flags</a> &amp; <a class="code" href="../../d7/d71/DNA__text__types_8h.html#a1cab0fb665bac909f466de9fc056da9b">TXT_ISEXT</a>)) text-&gt;<a class="code" href="../../d2/dda/structText.html#a0052b67f5d3d3ef7748a969cebfc2acf">flags</a> &amp;= ~<a class="code" href="../../d7/d71/DNA__text__types_8h.html#a1cab0fb665bac909f466de9fc056da9b">TXT_ISEXT</a>;
<a name="l02525"></a>02525 
<a name="l02526"></a>02526         <span class="comment">/* write LibData */</span>
<a name="l02527"></a>02527         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aedc19b629c5c0b30dd7697cd4ac4dc20">ID_TXT</a>, <span class="stringliteral">&quot;Text&quot;</span>, 1, text);
<a name="l02528"></a>02528         <span class="keywordflow">if</span> (text-&gt;<a class="code" href="../../d2/dda/structText.html#a69aa123f472ed716685c2af565d8a9b9">name</a>) <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(text-&gt;<a class="code" href="../../d2/dda/structText.html#a69aa123f472ed716685c2af565d8a9b9">name</a>)+1, text-&gt;<a class="code" href="../../d2/dda/structText.html#a69aa123f472ed716685c2af565d8a9b9">name</a>);
<a name="l02529"></a>02529         <span class="keywordflow">if</span> (text-&gt;<a class="code" href="../../d2/dda/structText.html#aedc1fa5aee16348150d4eacfbc6ea389">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(text-&gt;<a class="code" href="../../d2/dda/structText.html#aedc1fa5aee16348150d4eacfbc6ea389">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l02530"></a>02530 
<a name="l02531"></a>02531         <span class="keywordflow">if</span> (!(text-&gt;<a class="code" href="../../d2/dda/structText.html#a0052b67f5d3d3ef7748a969cebfc2acf">flags</a> &amp; <a class="code" href="../../d7/d71/DNA__text__types_8h.html#a1cab0fb665bac909f466de9fc056da9b">TXT_ISEXT</a>)) {
<a name="l02532"></a>02532             <span class="comment">/* now write the text data, in two steps for optimization in the readfunction */</span>
<a name="l02533"></a>02533             tmp= text-&gt;<a class="code" href="../../d2/dda/structText.html#a04317b744e009e393be9cbee3fe41998">lines</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02534"></a>02534             <span class="keywordflow">while</span> (tmp) {
<a name="l02535"></a>02535                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;TextLine&quot;</span>, 1, tmp);
<a name="l02536"></a>02536                 tmp= tmp-&gt;<a class="code" href="../../d8/de6/structTextLine.html#a9af045586797cc431ac66acd0c59fa76">next</a>;
<a name="l02537"></a>02537             }
<a name="l02538"></a>02538 
<a name="l02539"></a>02539             tmp= text-&gt;<a class="code" href="../../d2/dda/structText.html#a04317b744e009e393be9cbee3fe41998">lines</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02540"></a>02540             <span class="keywordflow">while</span> (tmp) {
<a name="l02541"></a>02541                 <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, tmp-&gt;<a class="code" href="../../d8/de6/structTextLine.html#a5b616daa2580786a91db9f7329c91197">len</a>+1, tmp-&gt;<a class="code" href="../../d8/de6/structTextLine.html#a2287a51f99b6d16c3f2086d8554dc800">line</a>);
<a name="l02542"></a>02542                 tmp= tmp-&gt;<a class="code" href="../../d8/de6/structTextLine.html#a9af045586797cc431ac66acd0c59fa76">next</a>;
<a name="l02543"></a>02543             }
<a name="l02544"></a>02544 
<a name="l02545"></a>02545             <span class="comment">/* write markers */</span>
<a name="l02546"></a>02546             mrk= text-&gt;<a class="code" href="../../d2/dda/structText.html#a4da28989c8e2320e9dd4f8966a488785">markers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02547"></a>02547             <span class="keywordflow">while</span> (mrk) {
<a name="l02548"></a>02548                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;TextMarker&quot;</span>, 1, mrk);
<a name="l02549"></a>02549                 mrk= mrk-&gt;<a class="code" href="../../d5/dbb/structTextMarker.html#a8f96be03835e642c2ad889aadf6ad9c1">next</a>;
<a name="l02550"></a>02550             }
<a name="l02551"></a>02551         }
<a name="l02552"></a>02552 
<a name="l02553"></a>02553 
<a name="l02554"></a>02554         text= text-&gt;<a class="code" href="../../d2/dda/structText.html#aedc1fa5aee16348150d4eacfbc6ea389">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l02555"></a>02555     }
<a name="l02556"></a>02556 
<a name="l02557"></a>02557     <span class="comment">/* flush helps the compression for undo-save */</span>
<a name="l02558"></a>02558     <a class="code" href="../../d3/d68/writefile_8c.html#ad3cd0b85338465ac04a3b48cc084e1c9">mywrite</a>(wd, <a class="code" href="../../d3/d68/writefile_8c.html#ab6d466684929096461d75d8e48c455e4">MYWRITE_FLUSH</a>, 0);
<a name="l02559"></a>02559 }
<a name="l02560"></a>02560 
<a name="l02561"></a><a class="code" href="../../d3/d68/writefile_8c.html#a144f30662c02c72f373e7524395ebc3c">02561</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a144f30662c02c72f373e7524395ebc3c">write_speakers</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l02562"></a>02562 {
<a name="l02563"></a>02563     <a class="code" href="../../d0/d89/structSpeaker.html">Speaker</a> *spk;
<a name="l02564"></a>02564 
<a name="l02565"></a>02565     spk= idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02566"></a>02566     <span class="keywordflow">while</span> (spk) {
<a name="l02567"></a>02567         <span class="keywordflow">if</span> (spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#a0218f7516aee6f7adb887205fcf48490">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l02568"></a>02568             <span class="comment">/* write LibData */</span>
<a name="l02569"></a>02569             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a0cd81e8a0b1724426ed2d1e36218cdf6">ID_SPK</a>, <span class="stringliteral">&quot;Speaker&quot;</span>, 1, spk);
<a name="l02570"></a>02570             <span class="keywordflow">if</span> (spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#a0218f7516aee6f7adb887205fcf48490">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#a0218f7516aee6f7adb887205fcf48490">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l02571"></a>02571 
<a name="l02572"></a>02572             <span class="keywordflow">if</span> (spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#a2da8956b59cff6870ca337c0440d10a6">adt</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(wd, spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#a2da8956b59cff6870ca337c0440d10a6">adt</a>);
<a name="l02573"></a>02573         }
<a name="l02574"></a>02574         spk= spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#a0218f7516aee6f7adb887205fcf48490">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l02575"></a>02575     }
<a name="l02576"></a>02576 }
<a name="l02577"></a>02577 
<a name="l02578"></a><a class="code" href="../../d3/d68/writefile_8c.html#a83c4e2b49a1d84a05e0640e10b77cd1a">02578</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a83c4e2b49a1d84a05e0640e10b77cd1a">write_sounds</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l02579"></a>02579 {
<a name="l02580"></a>02580     <a class="code" href="../../d9/dc6/structbSound.html">bSound</a> *sound;
<a name="l02581"></a>02581 
<a name="l02582"></a>02582     <a class="code" href="../../dd/d77/structPackedFile.html">PackedFile</a> * <a class="code" href="../../d8/d9d/gim__memory_8h.html#aa7421a08567e946189db67fbebfb88e0" title="Prefetch 64.">pf</a>;
<a name="l02583"></a>02583 
<a name="l02584"></a>02584     sound= idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02585"></a>02585     <span class="keywordflow">while</span> (sound) {
<a name="l02586"></a>02586         <span class="keywordflow">if</span> (sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a9ffb4b9e73985372a02d86115a8d1d7d">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l02587"></a>02587             <span class="comment">/* write LibData */</span>
<a name="l02588"></a>02588             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a3bae74282a62fb44842ff3767a86ec70">ID_SO</a>, <span class="stringliteral">&quot;bSound&quot;</span>, 1, sound);
<a name="l02589"></a>02589             <span class="keywordflow">if</span> (sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a9ffb4b9e73985372a02d86115a8d1d7d">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a9ffb4b9e73985372a02d86115a8d1d7d">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l02590"></a>02590 
<a name="l02591"></a>02591             <span class="keywordflow">if</span> (sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a4cff5c884fea9ec6a6b46d55d3409fed">packedfile</a>) {
<a name="l02592"></a>02592                 pf = sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a4cff5c884fea9ec6a6b46d55d3409fed">packedfile</a>;
<a name="l02593"></a>02593                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;PackedFile&quot;</span>, 1, pf);
<a name="l02594"></a>02594                 <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, pf-&gt;<a class="code" href="../../dd/d77/structPackedFile.html#ab46e545f88274c5c348303a84fd735d6">size</a>, pf-&gt;<a class="code" href="../../dd/d77/structPackedFile.html#ab26282078abf88909ab32213a4290f8e">data</a>);
<a name="l02595"></a>02595             }
<a name="l02596"></a>02596         }
<a name="l02597"></a>02597         sound= sound-&gt;<a class="code" href="../../d9/dc6/structbSound.html#a9ffb4b9e73985372a02d86115a8d1d7d">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l02598"></a>02598     }
<a name="l02599"></a>02599 
<a name="l02600"></a>02600     <span class="comment">/* flush helps the compression for undo-save */</span>
<a name="l02601"></a>02601     <a class="code" href="../../d3/d68/writefile_8c.html#ad3cd0b85338465ac04a3b48cc084e1c9">mywrite</a>(wd, <a class="code" href="../../d3/d68/writefile_8c.html#ab6d466684929096461d75d8e48c455e4">MYWRITE_FLUSH</a>, 0);
<a name="l02602"></a>02602 }
<a name="l02603"></a>02603 
<a name="l02604"></a><a class="code" href="../../d3/d68/writefile_8c.html#afd7c62b67b420d2a1590166d31c0c185">02604</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#afd7c62b67b420d2a1590166d31c0c185">write_groups</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l02605"></a>02605 {
<a name="l02606"></a>02606     <a class="code" href="../../d4/d91/structGroup.html">Group</a> *group;
<a name="l02607"></a>02607     <a class="code" href="../../d3/d3b/structGroupObject.html">GroupObject</a> *go;
<a name="l02608"></a>02608 
<a name="l02609"></a>02609     <span class="keywordflow">for</span> (group= idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; group; group= group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02610"></a>02610         <span class="keywordflow">if</span> (group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l02611"></a>02611             <span class="comment">/* write LibData */</span>
<a name="l02612"></a>02612             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#afc8c3d5178b4130eee3e7542ef0dcae7">ID_GR</a>, <span class="stringliteral">&quot;Group&quot;</span>, 1, group);
<a name="l02613"></a>02613             <span class="keywordflow">if</span> (group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l02614"></a>02614 
<a name="l02615"></a>02615             go= group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ad757bf69b6fd15b1d4e0980089d13be1">gobject</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02616"></a>02616             <span class="keywordflow">while</span> (go) {
<a name="l02617"></a>02617                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;GroupObject&quot;</span>, 1, go);
<a name="l02618"></a>02618                 go= go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#a81e7437ba90ec95c5fbb96e17e6a203d">next</a>;
<a name="l02619"></a>02619             }
<a name="l02620"></a>02620         }
<a name="l02621"></a>02621     }
<a name="l02622"></a>02622 }
<a name="l02623"></a>02623 
<a name="l02624"></a><a class="code" href="../../d3/d68/writefile_8c.html#ae74c7ffed5fb5d03a97481595244f0fb">02624</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#ae74c7ffed5fb5d03a97481595244f0fb">write_nodetrees</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l02625"></a>02625 {
<a name="l02626"></a>02626     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree;
<a name="l02627"></a>02627     
<a name="l02628"></a>02628     <span class="keywordflow">for</span> (ntree=idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ntree; ntree= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02629"></a>02629         <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l02630"></a>02630             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6e5ed4060f73b0f46e66af2dbef9dd2a">ID_NT</a>, <span class="stringliteral">&quot;bNodeTree&quot;</span>, 1, ntree);
<a name="l02631"></a>02631             <a class="code" href="../../d3/d68/writefile_8c.html#af9f71b9a5851076e655198986376e392">write_nodetree</a>(wd, ntree);
<a name="l02632"></a>02632             
<a name="l02633"></a>02633             <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l02634"></a>02634             
<a name="l02635"></a>02635             <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#af6b8d484e7c71deb7a35e939800d54b5">adt</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(wd, ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#af6b8d484e7c71deb7a35e939800d54b5">adt</a>);
<a name="l02636"></a>02636         }
<a name="l02637"></a>02637     }
<a name="l02638"></a>02638 }
<a name="l02639"></a>02639 
<a name="l02640"></a><a class="code" href="../../d3/d68/writefile_8c.html#a29a1d0af17a3a193b8fea18f696c974f">02640</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a29a1d0af17a3a193b8fea18f696c974f">write_brushes</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l02641"></a>02641 {
<a name="l02642"></a>02642     <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush;
<a name="l02643"></a>02643     
<a name="l02644"></a>02644     <span class="keywordflow">for</span> (brush=idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; brush; brush= brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a853736fc6943d266e72d96080bccf6f0">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02645"></a>02645         <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a853736fc6943d266e72d96080bccf6f0">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l02646"></a>02646             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac7f2ccbf688d8c6763420cb2fe028e5a">ID_BR</a>, <span class="stringliteral">&quot;Brush&quot;</span>, 1, brush);
<a name="l02647"></a>02647             <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a853736fc6943d266e72d96080bccf6f0">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a853736fc6943d266e72d96080bccf6f0">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l02648"></a>02648             
<a name="l02649"></a>02649             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;MTex&quot;</span>, 1, &amp;brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>);
<a name="l02650"></a>02650             
<a name="l02651"></a>02651             <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a5f7b0d9181df178da588821ce9f02d44">curve</a>)
<a name="l02652"></a>02652                 <a class="code" href="../../d3/d68/writefile_8c.html#a1aee9b323a690ee9d46323ade9511325">write_curvemapping</a>(wd, brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a5f7b0d9181df178da588821ce9f02d44">curve</a>);
<a name="l02653"></a>02653         }
<a name="l02654"></a>02654     }
<a name="l02655"></a>02655 }
<a name="l02656"></a>02656 
<a name="l02657"></a><a class="code" href="../../d3/d68/writefile_8c.html#a00740b7976a8b757826c1124d218df52">02657</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a00740b7976a8b757826c1124d218df52">write_scripts</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l02658"></a>02658 {
<a name="l02659"></a>02659     <a class="code" href="../../d7/d04/structScript.html">Script</a> *script;
<a name="l02660"></a>02660     
<a name="l02661"></a>02661     <span class="keywordflow">for</span> (script=idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; script; script= script-&gt;<a class="code" href="../../d7/d04/structScript.html#a6df9e8aa5bb7c2f06937070e74d82666">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02662"></a>02662         <span class="keywordflow">if</span> (script-&gt;<a class="code" href="../../d7/d04/structScript.html#a6df9e8aa5bb7c2f06937070e74d82666">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l02663"></a>02663             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a9677f9d5fdee0a3ab214151155cef964">ID_SCRIPT</a>, <span class="stringliteral">&quot;Script&quot;</span>, 1, script);
<a name="l02664"></a>02664             <span class="keywordflow">if</span> (script-&gt;<a class="code" href="../../d7/d04/structScript.html#a6df9e8aa5bb7c2f06937070e74d82666">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>) <a class="code" href="../../d3/d68/writefile_8c.html#a53a1bf772ca1a3a7e54f4472d240a675">IDP_WriteProperty</a>(script-&gt;<a class="code" href="../../d7/d04/structScript.html#a6df9e8aa5bb7c2f06937070e74d82666">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9bdcd8f6ae46e613cf8d6c0b9735a039">properties</a>, wd);
<a name="l02665"></a>02665         }
<a name="l02666"></a>02666     }
<a name="l02667"></a>02667 }
<a name="l02668"></a>02668 
<a name="l02669"></a><a class="code" href="../../d3/d68/writefile_8c.html#a8064073de4d946a1b149f9f6e314f90f">02669</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a8064073de4d946a1b149f9f6e314f90f">write_movieTracks</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *<a class="code" href="../../de/ddb/tracking_8c.html#afdbe7b66782dfc0090b48f59c3f1d76c">tracks</a>)
<a name="l02670"></a>02670 {
<a name="l02671"></a>02671     <a class="code" href="../../da/d5f/structMovieTrackingTrack.html">MovieTrackingTrack</a> *track;
<a name="l02672"></a>02672 
<a name="l02673"></a>02673     track= tracks-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02674"></a>02674     <span class="keywordflow">while</span> (track) {
<a name="l02675"></a>02675         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;MovieTrackingTrack&quot;</span>, 1, track);
<a name="l02676"></a>02676 
<a name="l02677"></a>02677         <span class="keywordflow">if</span> (track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a9b873f8e5dc871f03a5ea0a42095927e">markers</a>)
<a name="l02678"></a>02678             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;MovieTrackingMarker&quot;</span>, track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#ada388ae01f83b973d2efb1414aab67de">markersnr</a>, track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a9b873f8e5dc871f03a5ea0a42095927e">markers</a>);
<a name="l02679"></a>02679 
<a name="l02680"></a>02680         track= track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#aec565ab687123b2707c7be0182b24ea6">next</a>;
<a name="l02681"></a>02681     }
<a name="l02682"></a>02682 }
<a name="l02683"></a>02683 
<a name="l02684"></a><a class="code" href="../../d3/d68/writefile_8c.html#a3a919ad4863567f73f3360e944b10ebe">02684</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a3a919ad4863567f73f3360e944b10ebe">write_movieReconstruction</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../dd/d65/structMovieTrackingReconstruction.html">MovieTrackingReconstruction</a> *reconstruction)
<a name="l02685"></a>02685 {
<a name="l02686"></a>02686     <span class="keywordflow">if</span> (reconstruction-&gt;<a class="code" href="../../dd/d65/structMovieTrackingReconstruction.html#a858a10d0ab1f32e42121e13ed67ae008">camnr</a>)
<a name="l02687"></a>02687         <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;MovieReconstructedCamera&quot;</span>, reconstruction-&gt;<a class="code" href="../../dd/d65/structMovieTrackingReconstruction.html#a858a10d0ab1f32e42121e13ed67ae008">camnr</a>, reconstruction-&gt;<a class="code" href="../../dd/d65/structMovieTrackingReconstruction.html#ac680e228e4654f3375f1458195da30e1">cameras</a>);
<a name="l02688"></a>02688 }
<a name="l02689"></a>02689 
<a name="l02690"></a><a class="code" href="../../d3/d68/writefile_8c.html#a722fce9856fb12af2fc4fba84c5bc66d">02690</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a722fce9856fb12af2fc4fba84c5bc66d">write_movieclips</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *idbase)
<a name="l02691"></a>02691 {
<a name="l02692"></a>02692     <a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip;
<a name="l02693"></a>02693 
<a name="l02694"></a>02694     clip= idbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02695"></a>02695     <span class="keywordflow">while</span> (clip) {
<a name="l02696"></a>02696         <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a51cceb766b47f21cbe774967b1d73b8f">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>&gt;0 || wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#ace8539f7548e27ec909b5db92df9b526">current</a>) {
<a name="l02697"></a>02697             <a class="code" href="../../d9/ddb/structMovieTracking.html">MovieTracking</a> *tracking= &amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>;
<a name="l02698"></a>02698             <a class="code" href="../../d2/de6/structMovieTrackingObject.html">MovieTrackingObject</a> *object;
<a name="l02699"></a>02699             <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a7f8c4173f43796897d92d5c2ac8ec697">ID_MC</a>, <span class="stringliteral">&quot;MovieClip&quot;</span>, 1, clip);
<a name="l02700"></a>02700 
<a name="l02701"></a>02701             <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad244f196f473bf1f0efb2f65f3b5595e">adt</a>)
<a name="l02702"></a>02702                 <a class="code" href="../../d3/d68/writefile_8c.html#a386d87ebbb0b3a187c0784045cfb7fc0">write_animdata</a>(wd, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad244f196f473bf1f0efb2f65f3b5595e">adt</a>);
<a name="l02703"></a>02703 
<a name="l02704"></a>02704             <a class="code" href="../../d3/d68/writefile_8c.html#a8064073de4d946a1b149f9f6e314f90f">write_movieTracks</a>(wd, &amp;tracking-&gt;<a class="code" href="../../d9/ddb/structMovieTracking.html#a74fe531242e070b2108266db9046bf8f">tracks</a>);
<a name="l02705"></a>02705             <a class="code" href="../../d3/d68/writefile_8c.html#a3a919ad4863567f73f3360e944b10ebe">write_movieReconstruction</a>(wd, &amp;tracking-&gt;<a class="code" href="../../d9/ddb/structMovieTracking.html#a08fa44e235d5e8555098950eca818076">reconstruction</a>);
<a name="l02706"></a>02706 
<a name="l02707"></a>02707             <span class="keywordtype">object</span>= tracking-&gt;<a class="code" href="../../d9/ddb/structMovieTracking.html#a8b83f22c1c9fa84904d2a6689973b789">objects</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02708"></a>02708             <span class="keywordflow">while</span> (<span class="keywordtype">object</span>) {
<a name="l02709"></a>02709                 <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aad9ae913bdfab20dd94ad04ee2d5b045">DATA</a>, <span class="stringliteral">&quot;MovieTrackingObject&quot;</span>, 1, <span class="keywordtype">object</span>);
<a name="l02710"></a>02710 
<a name="l02711"></a>02711                 <a class="code" href="../../d3/d68/writefile_8c.html#a8064073de4d946a1b149f9f6e314f90f">write_movieTracks</a>(wd, &amp;object-&gt;<a class="code" href="../../d2/de6/structMovieTrackingObject.html#a6b02c7f7e4eb6807acefb344d36fc07c">tracks</a>);
<a name="l02712"></a>02712                 <a class="code" href="../../d3/d68/writefile_8c.html#a3a919ad4863567f73f3360e944b10ebe">write_movieReconstruction</a>(wd, &amp;object-&gt;<a class="code" href="../../d2/de6/structMovieTrackingObject.html#a94d8bb0ba214e1dfd431530a6fb17af3">reconstruction</a>);
<a name="l02713"></a>02713 
<a name="l02714"></a>02714                 <span class="keywordtype">object</span>= <span class="keywordtype">object</span>-&gt;next;
<a name="l02715"></a>02715             }
<a name="l02716"></a>02716         }
<a name="l02717"></a>02717 
<a name="l02718"></a>02718         clip= clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a51cceb766b47f21cbe774967b1d73b8f">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l02719"></a>02719     }
<a name="l02720"></a>02720 
<a name="l02721"></a>02721     <span class="comment">/* flush helps the compression for undo-save */</span>
<a name="l02722"></a>02722     <a class="code" href="../../d3/d68/writefile_8c.html#ad3cd0b85338465ac04a3b48cc084e1c9">mywrite</a>(wd, <a class="code" href="../../d3/d68/writefile_8c.html#ab6d466684929096461d75d8e48c455e4">MYWRITE_FLUSH</a>, 0);
<a name="l02723"></a>02723 }
<a name="l02724"></a>02724 
<a name="l02725"></a>02725 <span class="comment">/* context is usually defined by WM, two cases where no WM is available:</span>
<a name="l02726"></a>02726 <span class="comment"> * - for forward compatibility, curscreen has to be saved</span>
<a name="l02727"></a>02727 <span class="comment"> * - for undofile, curscene needs to be saved */</span>
<a name="l02728"></a><a class="code" href="../../d3/d68/writefile_8c.html#a7c2b058a770f9fdd60ea26d0f25fe54d">02728</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a7c2b058a770f9fdd60ea26d0f25fe54d">write_global</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <span class="keywordtype">int</span> fileflags, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar)
<a name="l02729"></a>02729 {
<a name="l02730"></a>02730     <a class="code" href="../../db/d9a/structFileGlobal.html">FileGlobal</a> fg;
<a name="l02731"></a>02731     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen;
<a name="l02732"></a>02732     <span class="keywordtype">char</span> subvstr[8];
<a name="l02733"></a>02733     
<a name="l02734"></a>02734     <span class="comment">/* prevent mem checkers from complaining */</span>
<a name="l02735"></a>02735     fg.<a class="code" href="../../db/d9a/structFileGlobal.html#af323500c2e55396492d8e910814a1fd4">pads</a>= fg.<a class="code" href="../../db/d9a/structFileGlobal.html#a384687cbec28ff7a0acdf6f98f30a413">pad</a>= 0;
<a name="l02736"></a>02736     memset(fg.<a class="code" href="../../db/d9a/structFileGlobal.html#affe6d9c896ff71a3e861e51fac141680">filename</a>, 0, <span class="keyword">sizeof</span>(fg.<a class="code" href="../../db/d9a/structFileGlobal.html#affe6d9c896ff71a3e861e51fac141680">filename</a>));
<a name="l02737"></a>02737 
<a name="l02738"></a>02738     <a class="code" href="../../d3/d68/writefile_8c.html#afe872d7fd194b581e3aa69f05a1f0630">current_screen_compat</a>(mainvar, &amp;screen);
<a name="l02739"></a>02739 
<a name="l02740"></a>02740     <span class="comment">/* XXX still remap G */</span>
<a name="l02741"></a>02741     fg.<a class="code" href="../../db/d9a/structFileGlobal.html#ac07df6dac9cdf380c1162a39275deee2">curscreen</a>= screen;
<a name="l02742"></a>02742     fg.<a class="code" href="../../db/d9a/structFileGlobal.html#a466ad2e08958277fb6e2aee7af5dd0e2">curscene</a>= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>;
<a name="l02743"></a>02743     fg.<a class="code" href="../../db/d9a/structFileGlobal.html#a6a95b3dccada4af0741cacdb5e348312">displaymode</a>= <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.displaymode;
<a name="l02744"></a>02744     fg.<a class="code" href="../../db/d9a/structFileGlobal.html#a6ba4e3ecd5302c24079f3a83e4bbfdf3">winpos</a>= <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.winpos;
<a name="l02745"></a>02745 
<a name="l02746"></a>02746     <span class="comment">/* prevent to save this, is not good convention, and feature with concerns... */</span>
<a name="l02747"></a>02747     fg.<a class="code" href="../../db/d9a/structFileGlobal.html#a7f8eadc30a8b154168b4852f8793063f">fileflags</a>= (fileflags &amp; ~(<a class="code" href="../../d1/d8c/BKE__global_8h.html#a30ceab40e66804ac4b10d00ab95eb917">G_FILE_NO_UI</a>|<a class="code" href="../../d1/d8c/BKE__global_8h.html#a3a009c32cfd2095384fd02bf717f778b">G_FILE_RELATIVE_REMAP</a>|<a class="code" href="../../d1/d8c/BKE__global_8h.html#aa6301fd6498208ef48869418a6eaba10">G_FILE_MESH_COMPAT</a>));
<a name="l02748"></a>02748 
<a name="l02749"></a>02749     fg.<a class="code" href="../../db/d9a/structFileGlobal.html#a28df6e05561b90006153f3a925653378">globalf</a>= <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.f;
<a name="l02750"></a>02750     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(fg.<a class="code" href="../../db/d9a/structFileGlobal.html#affe6d9c896ff71a3e861e51fac141680">filename</a>, mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a8cf7ece1c27b22c05a1198b28d42ebdf">name</a>, <span class="keyword">sizeof</span>(fg.<a class="code" href="../../db/d9a/structFileGlobal.html#affe6d9c896ff71a3e861e51fac141680">filename</a>));
<a name="l02751"></a>02751 
<a name="l02752"></a>02752     sprintf(subvstr, <span class="stringliteral">&quot;%4d&quot;</span>, <a class="code" href="../../d7/ddf/BKE__blender_8h.html#a01cbc3715abf12b99ea7892d911c3803">BLENDER_SUBVERSION</a>);
<a name="l02753"></a>02753     memcpy(fg.<a class="code" href="../../db/d9a/structFileGlobal.html#a59ff2dae80addc904f86504554e9b2f2">subvstr</a>, subvstr, 4);
<a name="l02754"></a>02754     
<a name="l02755"></a>02755     fg.<a class="code" href="../../db/d9a/structFileGlobal.html#a415a742799c367639e33080e74fb4449">subversion</a>= <a class="code" href="../../d7/ddf/BKE__blender_8h.html#a01cbc3715abf12b99ea7892d911c3803">BLENDER_SUBVERSION</a>;
<a name="l02756"></a>02756     fg.<a class="code" href="../../db/d9a/structFileGlobal.html#a9ab560aa2e6abea29fdf9bf8562c4cd5">minversion</a>= <a class="code" href="../../d7/ddf/BKE__blender_8h.html#a46d3b6a89c6fcd97e532f89cf4b787f6">BLENDER_MINVERSION</a>;
<a name="l02757"></a>02757     fg.<a class="code" href="../../db/d9a/structFileGlobal.html#a75fdb1f77be02db33fa3af5da5ba0b14">minsubversion</a>= <a class="code" href="../../d7/ddf/BKE__blender_8h.html#ad03b0b95302aa7e2632ae3ab72a1f899">BLENDER_MINSUBVERSION</a>;
<a name="l02758"></a>02758 <span class="preprocessor">#ifdef WITH_BUILDINFO</span>
<a name="l02759"></a>02759 <span class="preprocessor"></span>    {
<a name="l02760"></a>02760         <span class="keyword">extern</span> <span class="keywordtype">char</span> <a class="code" href="../../d5/d84/bpy__app_8c.html#a29b8bca2b4ff2b31285e07a15438015f">build_rev</a>[];
<a name="l02761"></a>02761         fg.<a class="code" href="../../db/d9a/structFileGlobal.html#a20f32c691c6f173a63bb0333d2127a53">revision</a>= atoi(build_rev);
<a name="l02762"></a>02762     }
<a name="l02763"></a>02763 <span class="preprocessor">#else</span>
<a name="l02764"></a>02764 <span class="preprocessor"></span>    fg.<a class="code" href="../../db/d9a/structFileGlobal.html#a20f32c691c6f173a63bb0333d2127a53">revision</a>= 0;
<a name="l02765"></a>02765 <span class="preprocessor">#endif</span>
<a name="l02766"></a>02766 <span class="preprocessor"></span>    <a class="code" href="../../d3/d68/writefile_8c.html#abeefaa4fa1f941110193263a024ed7f9">writestruct</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a2a900ad5a15c2c67fb345854b3d2ad09">GLOB</a>, <span class="stringliteral">&quot;FileGlobal&quot;</span>, 1, &amp;fg);
<a name="l02767"></a>02767 }
<a name="l02768"></a>02768 
<a name="l02769"></a>02769 <span class="comment">/* preview image, first 2 values are width and height</span>
<a name="l02770"></a>02770 <span class="comment"> * second are an RGBA image (unsigned char)</span>
<a name="l02771"></a>02771 <span class="comment"> * note, this uses &#39;TEST&#39; since new types will segfault on file load for older blender versions.</span>
<a name="l02772"></a>02772 <span class="comment"> */</span>
<a name="l02773"></a><a class="code" href="../../d3/d68/writefile_8c.html#a97df9667b6f4b122673389ffb021d9ac">02773</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d68/writefile_8c.html#a97df9667b6f4b122673389ffb021d9ac">write_thumb</a>(<a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd, <span class="keyword">const</span> <span class="keywordtype">int</span> *img)
<a name="l02774"></a>02774 {
<a name="l02775"></a>02775     <span class="keywordflow">if</span> (img)
<a name="l02776"></a>02776         <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#ab946e2e7f7679350627acfded8e2658b">TEST</a>, (2 + img[0] * img[1]) * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), img);
<a name="l02777"></a>02777 }
<a name="l02778"></a>02778 
<a name="l02779"></a>02779 <span class="comment">/* if MemFile * there&#39;s filesave to memory */</span>
<a name="l02780"></a><a class="code" href="../../d3/d68/writefile_8c.html#aae952932340e70be03d76147474a5c96">02780</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d68/writefile_8c.html#aae952932340e70be03d76147474a5c96">write_file_handle</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <span class="keywordtype">int</span> handle, <a class="code" href="../../d7/d4d/structMemFile.html">MemFile</a> *<a class="code" href="../../dd/de9/mesh__navmesh_8c.html#a5ca4cf7d126d1b70e95de936dbf5079d">compare</a>, <a class="code" href="../../d7/d4d/structMemFile.html">MemFile</a> *current, 
<a name="l02781"></a>02781                              <span class="keywordtype">int</span> write_user_block, <span class="keywordtype">int</span> write_flags, <span class="keyword">const</span> <span class="keywordtype">int</span> *thumb)
<a name="l02782"></a>02782 {
<a name="l02783"></a>02783     <a class="code" href="../../d4/d6e/structBHead.html">BHead</a> bhead;
<a name="l02784"></a>02784     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> mainlist;
<a name="l02785"></a>02785     <span class="keywordtype">char</span> buf[16];
<a name="l02786"></a>02786     <a class="code" href="../../d1/d19/structWriteData.html">WriteData</a> *wd;
<a name="l02787"></a>02787 
<a name="l02788"></a>02788     <a class="code" href="../../d0/d12/readfile_8c.html#aaf5f25a816c0bd974a821b502bcb6129">blo_split_main</a>(&amp;mainlist, mainvar);
<a name="l02789"></a>02789 
<a name="l02790"></a>02790     wd= <a class="code" href="../../d3/d68/writefile_8c.html#a44bdf463d195605da52715c8c00c28af">bgnwrite</a>(handle, compare, current);
<a name="l02791"></a>02791 
<a name="l02792"></a>02792 <span class="preprocessor">#ifdef USE_BMESH_SAVE_AS_COMPAT</span>
<a name="l02793"></a>02793 <span class="preprocessor"></span>    wd-&gt;use_mesh_compat = (write_flags &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#aa6301fd6498208ef48869418a6eaba10">G_FILE_MESH_COMPAT</a>) != 0;
<a name="l02794"></a>02794 <span class="preprocessor">#endif</span>
<a name="l02795"></a>02795 <span class="preprocessor"></span>
<a name="l02796"></a>02796     sprintf(buf, <span class="stringliteral">&quot;BLENDER%c%c%.3d&quot;</span>, (<span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*)==8)?<span class="charliteral">&#39;-&#39;</span>:<span class="charliteral">&#39;_&#39;</span>, (<a class="code" href="../../d1/d8c/BKE__global_8h.html#ab29b2916516ef2ec36d2f8f85ae20a78">ENDIAN_ORDER</a>==<a class="code" href="../../d1/d8c/BKE__global_8h.html#a497f70c46327d9156e6cf4d2d77a4500">B_ENDIAN</a>)?<span class="charliteral">&#39;V&#39;</span>:<span class="charliteral">&#39;v&#39;</span>, <a class="code" href="../../d7/ddf/BKE__blender_8h.html#a5dffb3de6e078b72298ed826456c2272">BLENDER_VERSION</a>);
<a name="l02797"></a>02797     <a class="code" href="../../d3/d68/writefile_8c.html#ad3cd0b85338465ac04a3b48cc084e1c9">mywrite</a>(wd, buf, 12);
<a name="l02798"></a>02798 
<a name="l02799"></a>02799     <a class="code" href="../../d3/d68/writefile_8c.html#a5dea49377cc65c467c6322edbd362b76">write_renderinfo</a>(wd, mainvar);
<a name="l02800"></a>02800     <a class="code" href="../../d3/d68/writefile_8c.html#a97df9667b6f4b122673389ffb021d9ac">write_thumb</a>(wd, thumb);
<a name="l02801"></a>02801     <a class="code" href="../../d3/d68/writefile_8c.html#a7c2b058a770f9fdd60ea26d0f25fe54d">write_global</a>(wd, write_flags, mainvar);
<a name="l02802"></a>02802 
<a name="l02803"></a>02803     <span class="comment">/* no UI save in undo */</span>
<a name="l02804"></a>02804     <span class="keywordflow">if</span> (current==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02805"></a>02805         <a class="code" href="../../d3/d68/writefile_8c.html#ae2274313c772ae830e94d5e04bda8c08">write_windowmanagers</a>(wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a1c415972a9fb2c7ce05e14d83affa0d8">wm</a>);
<a name="l02806"></a>02806         <a class="code" href="../../d3/d68/writefile_8c.html#a6b62a6cad91c95080647e8b9a041a213">write_screens</a>  (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>);
<a name="l02807"></a>02807     }
<a name="l02808"></a>02808     <a class="code" href="../../d3/d68/writefile_8c.html#a722fce9856fb12af2fc4fba84c5bc66d">write_movieclips</a> (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a416a41bec58eefdbc31a2730ca10f547">movieclip</a>);
<a name="l02809"></a>02809     <a class="code" href="../../d3/d68/writefile_8c.html#ab510d50d1745bb0094a768b5f677b977">write_scenes</a>   (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>);
<a name="l02810"></a>02810     <a class="code" href="../../d3/d68/writefile_8c.html#a6d1ab02cb5286b5be2402b216ad07843">write_curves</a>   (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac343a12d387c6a325f4e7677469a4b93">curve</a>);
<a name="l02811"></a>02811     <a class="code" href="../../d3/d68/writefile_8c.html#ad132b9aa9af320109fe7b72b6f939b66">write_mballs</a>   (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac1605716bd05f0456c07263500010810">mball</a>);
<a name="l02812"></a>02812     <a class="code" href="../../d3/d68/writefile_8c.html#a7cd9f4a822eb00f352226447af605efe">write_images</a>   (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a683bfdfa3f231a8a2cd1f88552a685dd">image</a>);
<a name="l02813"></a>02813     <a class="code" href="../../d3/d68/writefile_8c.html#aa4f0d79410ab477e4060780b71344c56">write_cameras</a>  (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a331d71d4f599b49bb6b38e48b7cfc7bf">camera</a>);
<a name="l02814"></a>02814     <a class="code" href="../../d3/d68/writefile_8c.html#a58a8b94c1e2848cd0350a43bcbd09149">write_lamps</a>    (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a5c8647f5ca9b577b50cda518ccd53b8a">lamp</a>);
<a name="l02815"></a>02815     <a class="code" href="../../d3/d68/writefile_8c.html#a2a134a2c5c110931558ef6e2a84d8dcf">write_lattices</a> (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#acc71d9ddb63ba1e24a044109bb6bab45">latt</a>);
<a name="l02816"></a>02816     <a class="code" href="../../d3/d68/writefile_8c.html#a2472176d7a22d63fb565be86f25b12f9">write_vfonts</a>   (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#abef2da7d5c3a1975eb74128e4d70c682">vfont</a>);
<a name="l02817"></a>02817     <a class="code" href="../../d3/d68/writefile_8c.html#ab7b6e28528fe25ff92012c48ad986996">write_keys</a>     (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a1194bb31422b5ad4cd169ea17a08c0a6">key</a>);
<a name="l02818"></a>02818     <a class="code" href="../../d3/d68/writefile_8c.html#a46c722e8ac156abc21df37e3237e7c46">write_worlds</a>   (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a10592adbf2eb366b863e2e60159107a4">world</a>);
<a name="l02819"></a>02819     <a class="code" href="../../d3/d68/writefile_8c.html#a771352b7035853d75722b3c843d1d225">write_texts</a>    (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#aba48dab3abbe5521b8493006361d2d51">text</a>);
<a name="l02820"></a>02820     <a class="code" href="../../d3/d68/writefile_8c.html#a144f30662c02c72f373e7524395ebc3c">write_speakers</a> (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#af9e10672ecb71ccca79b79ec38514b1e">speaker</a>);
<a name="l02821"></a>02821     <a class="code" href="../../d3/d68/writefile_8c.html#a83c4e2b49a1d84a05e0640e10b77cd1a">write_sounds</a>   (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a1a560470643338adeaba772bc1865333">sound</a>);
<a name="l02822"></a>02822     <a class="code" href="../../d3/d68/writefile_8c.html#afd7c62b67b420d2a1590166d31c0c185">write_groups</a>   (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a267e87055868d88574ec121db05cc8c7">group</a>);
<a name="l02823"></a>02823     <a class="code" href="../../d3/d68/writefile_8c.html#a234facbe9c095dd9ed75faaefecfa41c">write_armatures</a>(wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a9bba8f1a7b2f6ccfb84dd81508d120e9">armature</a>);
<a name="l02824"></a>02824     <a class="code" href="../../d3/d68/writefile_8c.html#afbdb849615a1f371195bf963424d7134">write_actions</a>  (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a672d2abaa0d861f3a2d938549cbe212b">action</a>);
<a name="l02825"></a>02825     <a class="code" href="../../d3/d68/writefile_8c.html#a0f729d275bab2450e9bc711224556c55">write_objects</a>  (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>);
<a name="l02826"></a>02826     <a class="code" href="../../d3/d68/writefile_8c.html#a1e3c32b488a40f3ab3f3ade7b837bea6">write_materials</a>(wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>);
<a name="l02827"></a>02827     <a class="code" href="../../d3/d68/writefile_8c.html#a840ba5cb329e11753da59d1a27fa0d9e">write_textures</a> (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>);
<a name="l02828"></a>02828     <a class="code" href="../../d3/d68/writefile_8c.html#a011fc87915fa7dd4ad3c24aca0916479">write_meshs</a>    (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>);
<a name="l02829"></a>02829     <a class="code" href="../../d3/d68/writefile_8c.html#a3600e256e59da7f0fd7db92e5448dd0a">write_particlesettings</a>(wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a73591db3b2acff6a45b32370df297511">particle</a>);
<a name="l02830"></a>02830     <a class="code" href="../../d3/d68/writefile_8c.html#ae74c7ffed5fb5d03a97481595244f0fb">write_nodetrees</a>(wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#acd0189c39fdd4147e3c8e069a80d85b6">nodetree</a>);
<a name="l02831"></a>02831     <a class="code" href="../../d3/d68/writefile_8c.html#a29a1d0af17a3a193b8fea18f696c974f">write_brushes</a>  (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a6f40decaf705d18b809d98637fee11f4">brush</a>);
<a name="l02832"></a>02832     <a class="code" href="../../d3/d68/writefile_8c.html#a00740b7976a8b757826c1124d218df52">write_scripts</a>  (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3e9b648f3c97050a53bdfc1a2a015916">script</a>);
<a name="l02833"></a>02833     <a class="code" href="../../d3/d68/writefile_8c.html#ab62957810b1d34923d8e0d35fd12456f">write_gpencils</a> (wd, &amp;mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4a86abfca9ece5bbb40d490b426da469">gpencil</a>);
<a name="l02834"></a>02834     <a class="code" href="../../d3/d68/writefile_8c.html#a6bd16021676b6060f11eeab695861e09">write_libraries</a>(wd,  mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a7c76b835863370aa406afc713e8fd0f8">next</a>);
<a name="l02835"></a>02835 
<a name="l02836"></a>02836     <span class="keywordflow">if</span> (write_user_block) {
<a name="l02837"></a>02837         <a class="code" href="../../d3/d68/writefile_8c.html#ac9025aa72886ad9d2bdc31f9cd26216b">write_userdef</a>(wd);
<a name="l02838"></a>02838     }
<a name="l02839"></a>02839                             
<a name="l02840"></a>02840     <span class="comment">/* dna as last, because (to be implemented) test for which structs are written */</span>
<a name="l02841"></a>02841     <a class="code" href="../../d3/d68/writefile_8c.html#af1d96b0f1e99e58137625e4490c25fab">writedata</a>(wd, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#af0b81c59b7165b704a231edc708875a5">DNA1</a>, wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a6076ec75a8c6ce31db025d4e47c1b620">sdna</a>-&gt;<a class="code" href="../../de/d21/structSDNA.html#a983b41b5050f2fdd9997ecd4dbe992dd">datalen</a>, wd-&gt;<a class="code" href="../../d1/d19/structWriteData.html#a6076ec75a8c6ce31db025d4e47c1b620">sdna</a>-&gt;<a class="code" href="../../de/d21/structSDNA.html#a618062affad8db93e0ff788ab90b3239">data</a>);
<a name="l02842"></a>02842 
<a name="l02843"></a>02843     <span class="comment">/* end of file */</span>
<a name="l02844"></a>02844     memset(&amp;bhead, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6e/structBHead.html">BHead</a>));
<a name="l02845"></a>02845     bhead.<a class="code" href="../../d4/d6e/structBHead.html#aabc48f8bc869f0f7a0ef57cfb2496ee4">code</a>= <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#aa66861a348d579619b65c8c8c8e2ba11">ENDB</a>;
<a name="l02846"></a>02846     <a class="code" href="../../d3/d68/writefile_8c.html#ad3cd0b85338465ac04a3b48cc084e1c9">mywrite</a>(wd, &amp;bhead, <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6e/structBHead.html">BHead</a>));
<a name="l02847"></a>02847 
<a name="l02848"></a>02848     <a class="code" href="../../d0/d12/readfile_8c.html#af48dcb9e6b4ce80b32f0bd8ac0f6b7a6">blo_join_main</a>(&amp;mainlist);
<a name="l02849"></a>02849 
<a name="l02850"></a>02850     <span class="keywordflow">return</span> <a class="code" href="../../d3/d68/writefile_8c.html#a60f2d922302e99dadd80baf3df3edf83">endwrite</a>(wd);
<a name="l02851"></a>02851 }
<a name="l02852"></a>02852 
<a name="l02853"></a>02853 <span class="comment">/* do reverse file history: .blend1 -&gt; .blend2, .blend -&gt; .blend1 */</span>
<a name="l02854"></a>02854 <span class="comment">/* return: success(0), failure(1) */</span>
<a name="l02855"></a><a class="code" href="../../d3/d68/writefile_8c.html#a6a06a262373cc52b3a7191441962d22a">02855</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d68/writefile_8c.html#a6a06a262373cc52b3a7191441962d22a">do_history</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <a class="code" href="../../df/df0/structReportList.html">ReportList</a> *reports)
<a name="l02856"></a>02856 {
<a name="l02857"></a>02857     <span class="keywordtype">char</span> tempname1[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>], tempname2[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l02858"></a>02858     <span class="keywordtype">int</span> hisnr= <a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.versions;
<a name="l02859"></a>02859     
<a name="l02860"></a>02860     <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.versions==0) <span class="keywordflow">return</span> 0;
<a name="l02861"></a>02861     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(name)&lt;2) {
<a name="l02862"></a>02862         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(reports, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Unable to make version backup: filename too short&quot;</span>);
<a name="l02863"></a>02863         <span class="keywordflow">return</span> 1;
<a name="l02864"></a>02864     }
<a name="l02865"></a>02865         
<a name="l02866"></a>02866     <span class="keywordflow">while</span> (hisnr &gt; 1) {
<a name="l02867"></a>02867         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(tempname1, <span class="keyword">sizeof</span>(tempname1), <span class="stringliteral">&quot;%s%d&quot;</span>, name, hisnr-1);
<a name="l02868"></a>02868         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(tempname2, <span class="keyword">sizeof</span>(tempname2), <span class="stringliteral">&quot;%s%d&quot;</span>, name, hisnr);
<a name="l02869"></a>02869     
<a name="l02870"></a>02870         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d63/BLI__fileops_8h.html#af698b70803b612aec5a87a0a41babed3">BLI_rename</a>(tempname1, tempname2)) {
<a name="l02871"></a>02871             <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(reports, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Unable to make version backup&quot;</span>);
<a name="l02872"></a>02872             <span class="keywordflow">return</span> 1;
<a name="l02873"></a>02873         }   
<a name="l02874"></a>02874         hisnr--;
<a name="l02875"></a>02875     }
<a name="l02876"></a>02876 
<a name="l02877"></a>02877     <span class="comment">/* is needed when hisnr==1 */</span>
<a name="l02878"></a>02878     <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(tempname1, <span class="keyword">sizeof</span>(tempname1), <span class="stringliteral">&quot;%s%d&quot;</span>, name, hisnr);
<a name="l02879"></a>02879 
<a name="l02880"></a>02880     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d63/BLI__fileops_8h.html#af698b70803b612aec5a87a0a41babed3">BLI_rename</a>(name, tempname1)) {
<a name="l02881"></a>02881         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(reports, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Unable to make version backup&quot;</span>);
<a name="l02882"></a>02882         <span class="keywordflow">return</span> 1;
<a name="l02883"></a>02883     }
<a name="l02884"></a>02884 
<a name="l02885"></a>02885     <span class="keywordflow">return</span> 0;
<a name="l02886"></a>02886 }
<a name="l02887"></a>02887 
<a name="l02888"></a>02888 <span class="comment">/* return: success (1) */</span>
<a name="l02889"></a><a class="code" href="../../d3/d68/writefile_8c.html#a2a6746528c67a6b8490a4d14385c352c">02889</a> <span class="keywordtype">int</span> <a class="code" href="../../d3/d5b/BLO__writefile_8h.html#ad9d0bbf0c43f00461ee808c6fe53dbf8">BLO_write_file</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <span class="keyword">const</span> <span class="keywordtype">char</span> *filepath, <span class="keywordtype">int</span> write_flags, <a class="code" href="../../df/df0/structReportList.html">ReportList</a> *reports, <span class="keyword">const</span> <span class="keywordtype">int</span> *thumb)
<a name="l02890"></a>02890 {
<a name="l02891"></a>02891     <span class="keywordtype">char</span> userfilename[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l02892"></a>02892     <span class="keywordtype">char</span> tempname[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>+1];
<a name="l02893"></a>02893     <span class="keywordtype">int</span> file, <a class="code" href="../../df/db3/freetypefont_8c.html#ab596967142db56aa5fbafe7c234eedda">err</a>, write_user_block;
<a name="l02894"></a>02894 
<a name="l02895"></a>02895     <span class="comment">/* open temporary file, so we preserve the original in case we crash */</span>
<a name="l02896"></a>02896     <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(tempname, <span class="keyword">sizeof</span>(tempname), <span class="stringliteral">&quot;%s@&quot;</span>, filepath);
<a name="l02897"></a>02897 
<a name="l02898"></a>02898     file = <a class="code" href="../../d2/d63/BLI__fileops_8h.html#a33346823641e2323fcf408264ceacaf2">BLI_open</a>(tempname,<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a36fa9b2e726512bc17a7a6d3e39002be">O_BINARY</a>+O_WRONLY+O_CREAT+O_TRUNC, 0666);
<a name="l02899"></a>02899     <span class="keywordflow">if</span> (file == -1) {
<a name="l02900"></a>02900         <a class="code" href="../../d2/d40/BKE__report_8h.html#af25c247b3b620d13cef87ec2bed1698e">BKE_reportf</a>(reports, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Can&#39;t open file %s for writing: %s.&quot;</span>, tempname, strerror(errno));
<a name="l02901"></a>02901         <span class="keywordflow">return</span> 0;
<a name="l02902"></a>02902     }
<a name="l02903"></a>02903 
<a name="l02904"></a>02904     <span class="comment">/* remapping of relative paths to new file location */</span>
<a name="l02905"></a>02905     <span class="keywordflow">if</span> (write_flags &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a3a009c32cfd2095384fd02bf717f778b">G_FILE_RELATIVE_REMAP</a>) {
<a name="l02906"></a>02906         <span class="keywordtype">char</span> dir1[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l02907"></a>02907         <span class="keywordtype">char</span> dir2[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l02908"></a>02908         <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a295e8cb30935da1afb1713d0d4b493c9">BLI_split_dir_part</a>(filepath, dir1, <span class="keyword">sizeof</span>(dir1));
<a name="l02909"></a>02909         <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a295e8cb30935da1afb1713d0d4b493c9">BLI_split_dir_part</a>(mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a8cf7ece1c27b22c05a1198b28d42ebdf">name</a>, dir2, <span class="keyword">sizeof</span>(dir2));
<a name="l02910"></a>02910 
<a name="l02911"></a>02911         <span class="comment">/* just in case there is some subtle difference */</span>
<a name="l02912"></a>02912         <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a7fcb2651a621a0b5e761fbe2a6add270">BLI_cleanup_dir</a>(mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a8cf7ece1c27b22c05a1198b28d42ebdf">name</a>, dir1);
<a name="l02913"></a>02913         <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a7fcb2651a621a0b5e761fbe2a6add270">BLI_cleanup_dir</a>(mainvar-&gt;<a class="code" href="../../d0/dc0/structMain.html#a8cf7ece1c27b22c05a1198b28d42ebdf">name</a>, dir2);
<a name="l02914"></a>02914 
<a name="l02915"></a>02915         <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af94a3a93cdb6b15b6f283ccf3d467f8e">BLI_path_cmp</a>(dir1, dir2)==0) {
<a name="l02916"></a>02916             write_flags &amp;= ~G_FILE_RELATIVE_REMAP;
<a name="l02917"></a>02917         }
<a name="l02918"></a>02918         <span class="keywordflow">else</span> {
<a name="l02919"></a>02919             <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.relbase_valid) {
<a name="l02920"></a>02920                 <span class="comment">/* blend may not have been saved before. Tn this case</span>
<a name="l02921"></a>02921 <span class="comment">                 * we should not have any relative paths, but if there</span>
<a name="l02922"></a>02922 <span class="comment">                 * is somehow, an invalid or empty G.main-&gt;name it will</span>
<a name="l02923"></a>02923 <span class="comment">                 * print an error, don&#39;t try make the absolute in this case. */</span>
<a name="l02924"></a>02924                 <a class="code" href="../../d5/dd1/BLI__bpath_8h.html#adce5b38296a7eb49e502c384950e5aea">makeFilesAbsolute</a>(mainvar, <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02925"></a>02925             }
<a name="l02926"></a>02926         }
<a name="l02927"></a>02927     }
<a name="l02928"></a>02928 
<a name="l02929"></a>02929     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a6f32ac1a463a6322c25cb5c1615c4b1c">BLI_make_file_string</a>(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name, userfilename, <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a2d45fdb5b2e7511c16f48f9064b2c82f">BLI_get_folder_create</a>(<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a637136ebeb2c8676285a55bf13e8145a">BLENDER_USER_CONFIG</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>), <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a9fe0f66ff9f71c5fa3abe02a15ba3c48">BLENDER_STARTUP_FILE</a>);
<a name="l02930"></a>02930     write_user_block= (<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af94a3a93cdb6b15b6f283ccf3d467f8e">BLI_path_cmp</a>(filepath, userfilename) == 0);
<a name="l02931"></a>02931 
<a name="l02932"></a>02932     <span class="keywordflow">if</span> (write_flags &amp; G_FILE_RELATIVE_REMAP)
<a name="l02933"></a>02933         <a class="code" href="../../d5/dd1/BLI__bpath_8h.html#a4ce9822bc810dfb52e09df5922572989">makeFilesRelative</a>(mainvar, filepath, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>); <span class="comment">/* note, making relative to something OTHER then G.main-&gt;name */</span>
<a name="l02934"></a>02934 
<a name="l02935"></a>02935     <span class="comment">/* actual file writing */</span>
<a name="l02936"></a>02936     err= <a class="code" href="../../d3/d68/writefile_8c.html#aae952932340e70be03d76147474a5c96">write_file_handle</a>(mainvar, file, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, write_user_block, write_flags, thumb);
<a name="l02937"></a>02937     close(file);
<a name="l02938"></a>02938 
<a name="l02939"></a>02939     <span class="keywordflow">if</span> (err) {
<a name="l02940"></a>02940         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(reports, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, strerror(errno));
<a name="l02941"></a>02941         <span class="keyword">remove</span>(tempname);
<a name="l02942"></a>02942 
<a name="l02943"></a>02943         <span class="keywordflow">return</span> 0;
<a name="l02944"></a>02944     }
<a name="l02945"></a>02945 
<a name="l02946"></a>02946     <span class="comment">/* file save to temporary file was successful */</span>
<a name="l02947"></a>02947     <span class="comment">/* now do reverse file history (move .blend1 -&gt; .blend2, .blend -&gt; .blend1) */</span>
<a name="l02948"></a>02948     <span class="keywordflow">if</span> (write_flags &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#aa4dd2446eaf20c90d33a0e0dda77523b">G_FILE_HISTORY</a>) { 
<a name="l02949"></a>02949         <span class="keywordtype">int</span> err_hist = <a class="code" href="../../d3/d68/writefile_8c.html#a6a06a262373cc52b3a7191441962d22a">do_history</a>(filepath, reports);
<a name="l02950"></a>02950         <span class="keywordflow">if</span> (err_hist) {
<a name="l02951"></a>02951             <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(reports, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Version backup failed. File saved with @&quot;</span>);
<a name="l02952"></a>02952             <span class="keywordflow">return</span> 0;
<a name="l02953"></a>02953         }
<a name="l02954"></a>02954     }
<a name="l02955"></a>02955 
<a name="l02956"></a>02956     <span class="keywordflow">if</span> (write_flags &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a9c5d604e914279acffd8936f50516dc7">G_FILE_COMPRESS</a>) {
<a name="l02957"></a>02957         <span class="comment">/* compressed files have the same ending as regular files... only from 2.4!!! */</span>
<a name="l02958"></a>02958         <span class="keywordtype">char</span> gzname[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>+4];
<a name="l02959"></a>02959         <span class="keywordtype">int</span> ret;
<a name="l02960"></a>02960 
<a name="l02961"></a>02961         <span class="comment">/* first write compressed to separate @.gz */</span>
<a name="l02962"></a>02962         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(gzname, <span class="keyword">sizeof</span>(gzname), <span class="stringliteral">&quot;%s@.gz&quot;</span>, filepath);
<a name="l02963"></a>02963         ret = <a class="code" href="../../d2/d63/BLI__fileops_8h.html#a9553c09a42d91f9ef057fdcdeff1af5e">BLI_file_gzip</a>(tempname, gzname);
<a name="l02964"></a>02964         
<a name="l02965"></a>02965         <span class="keywordflow">if</span> (0==ret) {
<a name="l02966"></a>02966             <span class="comment">/* now rename to real file name, and delete temp @ file too */</span>
<a name="l02967"></a>02967             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d63/BLI__fileops_8h.html#af698b70803b612aec5a87a0a41babed3">BLI_rename</a>(gzname, filepath) != 0) {
<a name="l02968"></a>02968                 <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(reports, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Can&#39;t change old file. File saved with @.&quot;</span>);
<a name="l02969"></a>02969                 <span class="keywordflow">return</span> 0;
<a name="l02970"></a>02970             }
<a name="l02971"></a>02971 
<a name="l02972"></a>02972             <a class="code" href="../../d2/d63/BLI__fileops_8h.html#a732fc591374d736271bdaad0ff555432">BLI_delete</a>(tempname, 0, 0);
<a name="l02973"></a>02973         }
<a name="l02974"></a>02974         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (-1==ret) {
<a name="l02975"></a>02975             <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(reports, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Failed opening .gz file.&quot;</span>);
<a name="l02976"></a>02976             <span class="keywordflow">return</span> 0;
<a name="l02977"></a>02977         }
<a name="l02978"></a>02978         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (-2==ret) {
<a name="l02979"></a>02979             <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(reports, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Failed opening .blend file for compression.&quot;</span>);
<a name="l02980"></a>02980             <span class="keywordflow">return</span> 0;
<a name="l02981"></a>02981         }
<a name="l02982"></a>02982     }
<a name="l02983"></a>02983     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d2/d63/BLI__fileops_8h.html#af698b70803b612aec5a87a0a41babed3">BLI_rename</a>(tempname, filepath) != 0) {
<a name="l02984"></a>02984         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(reports, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Can&#39;t change old file. File saved with @&quot;</span>);
<a name="l02985"></a>02985         <span class="keywordflow">return</span> 0;
<a name="l02986"></a>02986     }
<a name="l02987"></a>02987 
<a name="l02988"></a>02988     <span class="keywordflow">return</span> 1;
<a name="l02989"></a>02989 }
<a name="l02990"></a>02990 
<a name="l02991"></a>02991 <span class="comment">/* return: success (1) */</span>
<a name="l02992"></a><a class="code" href="../../d3/d68/writefile_8c.html#a88befdf4e873b7c244091aa1e704b3ef">02992</a> <span class="keywordtype">int</span> <a class="code" href="../../d3/d5b/BLO__writefile_8h.html#afb6f5d4e08023408ccbdd3f22b7d2232">BLO_write_file_mem</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *mainvar, <a class="code" href="../../d7/d4d/structMemFile.html">MemFile</a> *<a class="code" href="../../dd/de9/mesh__navmesh_8c.html#a5ca4cf7d126d1b70e95de936dbf5079d">compare</a>, <a class="code" href="../../d7/d4d/structMemFile.html">MemFile</a> *current, <span class="keywordtype">int</span> write_flags)
<a name="l02993"></a>02993 {
<a name="l02994"></a>02994     <span class="keywordtype">int</span> <a class="code" href="../../df/db3/freetypefont_8c.html#ab596967142db56aa5fbafe7c234eedda">err</a>;
<a name="l02995"></a>02995 
<a name="l02996"></a>02996     err= <a class="code" href="../../d3/d68/writefile_8c.html#aae952932340e70be03d76147474a5c96">write_file_handle</a>(mainvar, 0, compare, current, 0, write_flags, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02997"></a>02997     
<a name="l02998"></a>02998     <span class="keywordflow">if</span> (err==0) <span class="keywordflow">return</span> 1;
<a name="l02999"></a>02999     <span class="keywordflow">return</span> 0;
<a name="l03000"></a>03000 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:55:05 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

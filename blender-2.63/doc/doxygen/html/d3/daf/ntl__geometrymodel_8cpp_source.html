<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: ntl_geometrymodel.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">ntl_geometrymodel.cpp</div>  </div>
</div>
<div class="contents">
<a href="../../d3/daf/ntl__geometrymodel_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00004"></a>00004 <span class="comment">/******************************************************************************</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * El&#39;Beem - Free Surface Fluid Simulation with the Lattice Boltzmann Method</span>
<a name="l00007"></a>00007 <span class="comment"> * Copyright 2003-2006 Nils Thuerey</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * A simple box object</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *****************************************************************************/</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d16/ntl__geometrymodel_8h.html">ntl_geometrymodel.h</a>&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/dbe/ntl__ray_8h.html">ntl_ray.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d8d/ntl__world_8h.html">ntl_world.h</a>&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;zlib.h&quot;</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span><span class="preprocessor">#ifndef strncasecmp</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="preprocessor">#define strncasecmp(a,b,c) strcmp(a,b)</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span><span class="preprocessor">#endif // WIN32</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="comment">/******************************************************************************</span>
<a name="l00026"></a>00026 <span class="comment"> * Default Constructor </span>
<a name="l00027"></a>00027 <span class="comment"> *****************************************************************************/</span>
<a name="l00028"></a><a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#aeda75aba56daaabc019b17865f9bce00">00028</a> <a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#aeda75aba56daaabc019b17865f9bce00">ntlGeometryObjModel::ntlGeometryObjModel</a>( <span class="keywordtype">void</span> ) :
<a name="l00029"></a>00029     <a class="code" href="../../df/dc9/classntlGeometryObject.html">ntlGeometryObject</a>(),
<a name="l00030"></a>00030     mvStart( 0.0 ), mvEnd( 1.0 ),
<a name="l00031"></a>00031     mLoaded( false ),
<a name="l00032"></a>00032     mTriangles(), mVertices(), mNormals(),
<a name="l00033"></a>00033     mcAniVerts(), mcAniNorms(), 
<a name="l00034"></a>00034     mcAniTimes(), mAniTimeScale(1.), mAniTimeOffset(0.)
<a name="l00035"></a>00035 {
<a name="l00036"></a>00036 }
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="comment">/******************************************************************************</span>
<a name="l00039"></a>00039 <span class="comment"> * Destructor</span>
<a name="l00040"></a>00040 <span class="comment"> *****************************************************************************/</span>
<a name="l00041"></a><a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#a9882510c7b90ab04adb15fe2ae3ff002">00041</a> <a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#a9882510c7b90ab04adb15fe2ae3ff002">ntlGeometryObjModel::~ntlGeometryObjModel</a>()
<a name="l00042"></a>00042 {
<a name="l00043"></a>00043     <span class="keywordflow">if</span>(!mLoaded) {
<a name="l00044"></a>00044         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ntlGeometryObjModel&quot;</span>,<span class="stringliteral">&quot;delete obj...&quot;</span>);
<a name="l00045"></a>00045     }
<a name="l00046"></a>00046 }
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 
<a name="l00050"></a><a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#acd0140e37802872ce7941669871d0178">00050</a> <span class="keywordtype">bool</span> <a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#acd0140e37802872ce7941669871d0178">ntlGeometryObjModel::getMeshAnimated</a>() { 
<a name="l00051"></a>00051     <span class="keyword">const</span> <span class="keywordtype">bool</span> ret = (mcAniVerts.<a class="code" href="../../d1/df5/classAnimChannel.html#a52487afec24261ec3220359c2bfe22d9" title="get number of entries (value and time sizes have to be equal)">getSize</a>()&gt;1); 
<a name="l00052"></a>00052     <span class="comment">//errMsg(&quot;getMeshAnimated&quot;,&quot;ret=&quot;&lt;&lt;ret&lt;&lt;&quot;, size=&quot;&lt;&lt;mcAniVerts.getSize() );</span>
<a name="l00053"></a>00053     <span class="keywordflow">return</span> ret;
<a name="l00054"></a>00054 }
<a name="l00055"></a>00055 
<a name="l00057"></a><a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#aa316bd7a33a8cbf186380aac65bb448c">00057</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#aa316bd7a33a8cbf186380aac65bb448c">ntlGeometryObjModel::getExtends</a>(<a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> &amp;sstart, <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> &amp;send) {
<a name="l00058"></a>00058     <span class="keywordtype">bool</span> ini=<span class="keyword">false</span>;
<a name="l00059"></a>00059     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> start(0.),end(0.);
<a name="l00060"></a>00060     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s=0; s&lt;=(int)mcAniVerts.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size(); s++) {
<a name="l00061"></a>00061         vector&lt;ntlVec3f&gt; *sverts;
<a name="l00062"></a>00062         <span class="keywordflow">if</span>(mcAniVerts.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size()&gt;0) {
<a name="l00063"></a>00063             <span class="keywordflow">if</span>(s==(<span class="keywordtype">int</span>)mcAniVerts.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size()) <span class="keywordflow">continue</span>;
<a name="l00064"></a>00064             sverts  = &amp;(mcAniVerts.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>()[s].mVerts);
<a name="l00065"></a>00065         } <span class="keywordflow">else</span> sverts = &amp;mVertices;
<a name="l00066"></a>00066 
<a name="l00067"></a>00067         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;(int)sverts-&gt;size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00068"></a>00068 
<a name="l00069"></a>00069             <span class="keywordflow">if</span>(!ini) {
<a name="l00070"></a>00070                 start=(*sverts)[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00071"></a>00071                 end=(*sverts)[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00072"></a>00072                 <span class="comment">//errMsg(&quot;getExtends&quot;,&quot;ini &quot;&lt;&lt;s&lt;&lt;&quot;,&quot;&lt;&lt;i&lt;&lt;&quot; &quot;&lt;&lt;start&lt;&lt;&quot;,&quot;&lt;&lt;end);</span>
<a name="l00073"></a>00073                 ini=<span class="keyword">true</span>;
<a name="l00074"></a>00074             } <span class="keywordflow">else</span> {
<a name="l00075"></a>00075                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;3; j++) {
<a name="l00076"></a>00076                     <span class="keywordflow">if</span>(start[j] &gt; (*sverts)[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j]) { start[j]= (*sverts)[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j]; }
<a name="l00077"></a>00077                     <span class="keywordflow">if</span>(end[j]   &lt; (*sverts)[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j]) { end[j]  = (*sverts)[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j]; }
<a name="l00078"></a>00078                 }
<a name="l00079"></a>00079                 <span class="comment">//errMsg(&quot;getExtends&quot;,&quot;check &quot;&lt;&lt;s&lt;&lt;&quot;,&quot;&lt;&lt;i&lt;&lt;&quot; &quot;&lt;&lt;start&lt;&lt;&quot;,&quot;&lt;&lt;end&lt;&lt;&quot; &quot;&lt;&lt; (*sverts)[i]);</span>
<a name="l00080"></a>00080             }
<a name="l00081"></a>00081 
<a name="l00082"></a>00082         }
<a name="l00083"></a>00083     }
<a name="l00084"></a>00084     sstart=start;
<a name="l00085"></a>00085     send=end;
<a name="l00086"></a>00086 }
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="comment">/*****************************************************************************/</span>
<a name="l00090"></a>00090 <span class="comment">/* Init attributes etc. of this object */</span>
<a name="l00091"></a>00091 <span class="comment">/*****************************************************************************/</span>
<a name="l00092"></a><a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#a84c899149248b523ab00099280660649">00092</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#a84c899149248b523ab00099280660649">ntlGeometryObjModel::initialize</a>(<a class="code" href="../../d0/d95/classntlRenderGlobals.html" title="Class that handles global rendering parameters.">ntlRenderGlobals</a> *glob) 
<a name="l00093"></a>00093 {
<a name="l00094"></a>00094     <span class="comment">// perhaps the model is already inited from initModel below?</span>
<a name="l00095"></a>00095     <span class="keywordflow">if</span>(mLoaded==1) {
<a name="l00096"></a>00096         <span class="comment">// init default material</span>
<a name="l00097"></a>00097         <a class="code" href="../../df/dc9/classntlGeometryObject.html#a8f3258e45ebb6663e3bce898a61b75d5">searchMaterial</a>( glob-&gt;<a class="code" href="../../d0/d95/classntlRenderGlobals.html#a84d31b05d957e34c82f47526d3600cf5" title="Returns the property object list.">getMaterials</a>() );
<a name="l00098"></a>00098         <span class="keywordflow">return</span>;
<a name="l00099"></a>00099     }
<a name="l00100"></a>00100     
<a name="l00101"></a>00101     <a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#a84c899149248b523ab00099280660649">ntlGeometryObject::initialize</a>(glob);
<a name="l00102"></a>00102     mFilename = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a3ca411f70b712bec3d4dd4e81229e2cb">readString</a>(<span class="stringliteral">&quot;filename&quot;</span>, mFilename,<span class="stringliteral">&quot;ntlGeometryObjModel&quot;</span>, <span class="stringliteral">&quot;mFilename&quot;</span>, <span class="keyword">true</span>);
<a name="l00103"></a>00103 
<a name="l00104"></a>00104     <span class="keywordflow">if</span>(mFilename == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00105"></a>00105         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ntlGeometryObjModel::initialize&quot;</span>,<span class="stringliteral">&quot;Filename not given!&quot;</span>);
<a name="l00106"></a>00106         <span class="keywordflow">return</span>;
<a name="l00107"></a>00107     }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109     <span class="keyword">const</span> <span class="keywordtype">char</span> *suffix = strrchr(mFilename.c_str(), <span class="charliteral">&#39;.&#39;</span>);
<a name="l00110"></a>00110     <span class="keywordflow">if</span> (suffix) {
<a name="l00111"></a>00111         <span class="keywordflow">if</span> (!strncasecmp(suffix, <span class="stringliteral">&quot;.obj&quot;</span>, 4)) {
<a name="l00112"></a>00112             <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ntlGeometryObjModel::initialize&quot;</span>,<span class="stringliteral">&quot;.obj files not supported!&quot;</span>);
<a name="l00113"></a>00113             <span class="keywordflow">return</span>;
<a name="l00114"></a>00114         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncasecmp(suffix, <span class="stringliteral">&quot;.gz&quot;</span>, 3)) { 
<a name="l00115"></a>00115             <span class="comment">//mType = 1; // assume its .bobj.gz</span>
<a name="l00116"></a>00116         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncasecmp(suffix, <span class="stringliteral">&quot;.bobj&quot;</span>, 5)) { 
<a name="l00117"></a>00117             <span class="comment">//mType = 1;</span>
<a name="l00118"></a>00118         }
<a name="l00119"></a>00119     }
<a name="l00120"></a>00120 
<a name="l00121"></a>00121     <span class="keywordflow">if</span>(<a class="code" href="../../dd/dcf/classntlGeometryClass.html#a059eba2cf640c1ba262c8ef5932ca2af">getAttributeList</a>()-&gt;exists(<span class="stringliteral">&quot;ani_times&quot;</span>) || (!mcAniTimes.<a class="code" href="../../d1/df5/classAnimChannel.html#a5f91af8a72042b0474c7d556d7318f29" title="valid init?">isInited</a>()) ) {
<a name="l00122"></a>00122         mcAniTimes = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#a9293c76290503528601a743ce6689fbf">readChannelFloat</a>(<span class="stringliteral">&quot;ani_times&quot;</span>);
<a name="l00123"></a>00123     }
<a name="l00124"></a>00124     mAniTimeScale = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;ani_timescale&quot;</span>, mAniTimeScale,<span class="stringliteral">&quot;ntlGeometryObjModel&quot;</span>, <span class="stringliteral">&quot;mAniTimeScale&quot;</span>, <span class="keyword">false</span>);
<a name="l00125"></a>00125     mAniTimeOffset = <a class="code" href="../../dd/dcf/classntlGeometryClass.html#a09536ca99dbf9d387827bfdc64503812">mpAttrs</a>-&gt;<a class="code" href="../../d3/d8d/classAttributeList.html#aa3665e9ece0f9433c0d0d83c9965a493">readFloat</a>(<span class="stringliteral">&quot;ani_timeoffset&quot;</span>, mAniTimeOffset,<span class="stringliteral">&quot;ntlGeometryObjModel&quot;</span>, <span class="stringliteral">&quot;mAniTimeOffset&quot;</span>, <span class="keyword">false</span>);
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     <span class="comment">// continue with standard obj</span>
<a name="l00128"></a>00128     <span class="keywordflow">if</span>(<a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#a39013949372e5882b9b1f107e6fc4c3f">loadBobjModel</a>(mFilename)==0) mLoaded=1;
<a name="l00129"></a>00129     <span class="keywordflow">if</span>(!mLoaded) {
<a name="l00130"></a>00130         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ntlGeometryObjModel&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#aac9413fb9eeba06e80c56258d95b15d6">DM_WARNING</a>,<span class="stringliteral">&quot;Unable to load object file &#39;&quot;</span>&lt;&lt;mFilename&lt;&lt;<span class="stringliteral">&quot;&#39; !&quot;</span>, 0);
<a name="l00131"></a>00131     }
<a name="l00132"></a>00132     <span class="keywordflow">if</span>(<a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#acd0140e37802872ce7941669871d0178">getMeshAnimated</a>()) {
<a name="l00133"></a>00133         this-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a88e7f679c571b9eaf92b132cfb331beb">mIsAnimated</a> = <span class="keyword">true</span>;
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135 }
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 <span class="comment">/******************************************************************************</span>
<a name="l00138"></a>00138 <span class="comment"> * init model from given vertex and triangle arrays </span>
<a name="l00139"></a>00139 <span class="comment"> *****************************************************************************/</span>
<a name="l00140"></a>00140 
<a name="l00141"></a><a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#afde9cc5539c07a012dd815e37d77665f">00141</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#afde9cc5539c07a012dd815e37d77665f">ntlGeometryObjModel::initModel</a>(<span class="keywordtype">int</span> numVertices, <span class="keywordtype">float</span> *<a class="code" href="../../d9/d0b/structvertices.html">vertices</a>, <span class="keywordtype">int</span> numTriangles, <span class="keywordtype">int</span> *triangles,
<a name="l00142"></a>00142         <span class="keywordtype">int</span> channelSize, <span class="keywordtype">float</span> *channelVertices)
<a name="l00143"></a>00143 {
<a name="l00144"></a>00144     mVertices.clear();
<a name="l00145"></a>00145     mVertices.resize( numVertices );
<a name="l00146"></a>00146     mNormals.resize( numVertices );
<a name="l00147"></a>00147     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numVertices; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00148"></a>00148         mVertices[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(vertices[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+0],vertices[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+1],vertices[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+2]);
<a name="l00149"></a>00149         mNormals[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(1.0); <span class="comment">// unused, set to !=0.0</span>
<a name="l00150"></a>00150     }
<a name="l00151"></a>00151 
<a name="l00152"></a>00152     mTriangles.clear();
<a name="l00153"></a>00153     mTriangles.resize( 3*numTriangles );
<a name="l00154"></a>00154     <span class="keywordtype">int</span> triangleErrs=0;
<a name="l00155"></a>00155     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numTriangles; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00156"></a>00156         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;3;j++) {
<a name="l00157"></a>00157             mTriangles[3*<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+j] = triangles[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*3+j];
<a name="l00158"></a>00158             <span class="keywordflow">if</span>(mTriangles[3*<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+j]&lt;0) { mTriangles[3*<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+j]=0; triangleErrs++; }
<a name="l00159"></a>00159             <span class="keywordflow">if</span>(mTriangles[3*<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+j]&gt;=numVertices) { mTriangles[3*<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+j]=0; triangleErrs++; }
<a name="l00160"></a>00160         }
<a name="l00161"></a>00161     }
<a name="l00162"></a>00162     <span class="keywordflow">if</span>(triangleErrs&gt;0) {
<a name="l00163"></a>00163         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ntlGeometryObjModel::initModel&quot;</span>,<span class="stringliteral">&quot;Triangle errors occurred (&quot;</span>&lt;&lt;triangleErrs&lt;&lt;<span class="stringliteral">&quot;)!&quot;</span>);
<a name="l00164"></a>00164     }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <span class="comment">//fprintf(stderr,&quot;initModel DEBUG %d \n&quot;,channelSize);</span>
<a name="l00167"></a>00167     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ntlGeometryObjModel::initModel&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot;Csize:&quot;</span>&lt;&lt;channelSize&lt;&lt;<span class="stringliteral">&quot;, Cvert:&quot;</span>&lt;&lt;(<span class="keywordtype">long</span>)(channelVertices) ,10);
<a name="l00168"></a>00168     <span class="keywordflow">if</span>(channelVertices &amp;&amp; (channelSize&gt;0)) {
<a name="l00169"></a>00169         vector&lt;ntlSetVec3f&gt; aniverts;
<a name="l00170"></a>00170         vector&lt;ntlSetVec3f&gt; aninorms;
<a name="l00171"></a>00171         vector&lt;double&gt; anitimes;
<a name="l00172"></a>00172         aniverts.clear();
<a name="l00173"></a>00173         aninorms.clear();
<a name="l00174"></a>00174         anitimes.clear();
<a name="l00175"></a>00175         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> frame=0; frame&lt;channelSize; frame++) {
<a name="l00176"></a>00176             <a class="code" href="../../d5/d77/classntlSetVec3f.html">ntlSetVec3f</a> averts; averts.<a class="code" href="../../d5/d77/classntlSetVec3f.html#aad53065eae76375513f25369423bfdc8">mVerts</a>.clear();
<a name="l00177"></a>00177             <a class="code" href="../../d5/d77/classntlSetVec3f.html">ntlSetVec3f</a> anorms; anorms.<a class="code" href="../../d5/d77/classntlSetVec3f.html#aad53065eae76375513f25369423bfdc8">mVerts</a>.clear();
<a name="l00178"></a>00178             <span class="keywordtype">int</span> setsize = (3*numVertices+1);
<a name="l00179"></a>00179 
<a name="l00180"></a>00180             <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>(0.),n(1.);
<a name="l00181"></a>00181             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numVertices; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00182"></a>00182                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;3; j++) <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>[j] = channelVertices[frame*setsize+ 3*<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> +j];
<a name="l00183"></a>00183                 averts.<a class="code" href="../../d5/d77/classntlSetVec3f.html#aad53065eae76375513f25369423bfdc8">mVerts</a>.push_back(<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>);
<a name="l00184"></a>00184                 anorms.<a class="code" href="../../d5/d77/classntlSetVec3f.html#aad53065eae76375513f25369423bfdc8">mVerts</a>.push_back(<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>);
<a name="l00185"></a>00185                 <span class="comment">//debMsgStd(&quot;ntlGeometryObjModel::initModel&quot;,DM_MSG, &quot;Frame:&quot;&lt;&lt;frame&lt;&lt;&quot;,i:&quot;&lt;&lt;i&lt;&lt;&quot; &quot;&lt;&lt;p,10);</span>
<a name="l00186"></a>00186             }
<a name="l00187"></a>00187             <span class="keywordflow">if</span>( ((<span class="keywordtype">int</span>)averts.<a class="code" href="../../d5/d77/classntlSetVec3f.html#aad53065eae76375513f25369423bfdc8">mVerts</a>.size()==numVertices) &amp;&amp; 
<a name="l00188"></a>00188                 ((<span class="keywordtype">int</span>)anorms.<a class="code" href="../../d5/d77/classntlSetVec3f.html#aad53065eae76375513f25369423bfdc8">mVerts</a>.size()==numVertices) ) {
<a name="l00189"></a>00189                 aniverts.push_back(averts);
<a name="l00190"></a>00190                 aninorms.push_back(anorms);
<a name="l00191"></a>00191                 <span class="keywordtype">double</span> time = (double)channelVertices[frame*setsize+ setsize-1];
<a name="l00192"></a>00192                 anitimes.push_back(time);
<a name="l00193"></a>00193             } <span class="keywordflow">else</span> {
<a name="l00194"></a>00194                 <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ntlGeometryObjModel::initModel&quot;</span>,<span class="stringliteral">&quot;Invalid mesh, obj=&quot;</span>&lt;&lt;this-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aa0433486901f2f913b7ca5c80a0de218">getName</a>()&lt;&lt;<span class="stringliteral">&quot; frame=&quot;</span>&lt;&lt;frame&lt;&lt;<span class="stringliteral">&quot; verts=&quot;</span>&lt;&lt;averts.<a class="code" href="../../d5/d77/classntlSetVec3f.html#aad53065eae76375513f25369423bfdc8">mVerts</a>.size()&lt;&lt;<span class="stringliteral">&quot;/&quot;</span>&lt;&lt;numVertices&lt;&lt;<span class="stringliteral">&quot;. Skipping...&quot;</span>);
<a name="l00195"></a>00195             }
<a name="l00196"></a>00196             <span class="comment">//debMsgStd(&quot;ntlGeometryObjModel::initModel&quot;,DM_MSG, &quot;Frame:&quot;&lt;&lt;frame&lt;&lt;&quot; at t=&quot;&lt;&lt;time,10);</span>
<a name="l00197"></a>00197         }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199         mcAniVerts = <a class="code" href="../../d1/df5/classAnimChannel.html">AnimChannel&lt;ntlSetVec3f&gt;</a>(aniverts,anitimes);
<a name="l00200"></a>00200         mcAniNorms = <a class="code" href="../../d1/df5/classAnimChannel.html">AnimChannel&lt;ntlSetVec3f&gt;</a>(aninorms,anitimes);
<a name="l00201"></a>00201         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ntlGeometryObjModel::initModel&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot;Ani sets inited: &quot;</span>&lt;&lt; mcAniVerts.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size() &lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;mcAniNorms.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size() &lt;&lt;<span class="stringliteral">&quot; &quot;</span>, 1 );
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203     <span class="keywordflow">if</span>(<a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#acd0140e37802872ce7941669871d0178">getMeshAnimated</a>()) {
<a name="l00204"></a>00204         this-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a88e7f679c571b9eaf92b132cfb331beb">mIsAnimated</a> = <span class="keyword">true</span>;
<a name="l00205"></a>00205     }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207     <span class="comment">// inited, no need to parse attribs etc.</span>
<a name="l00208"></a>00208     mLoaded = 1;
<a name="l00209"></a>00209     <span class="keywordflow">return</span> 0;
<a name="l00210"></a>00210 }
<a name="l00211"></a>00211 
<a name="l00213"></a><a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#a77a1742b79ebcdf331b8d86acb675bef">00213</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#a77a1742b79ebcdf331b8d86acb675bef">ntlGeometryObjModel::calcTriangleDivs</a>(vector&lt;ntlVec3Gfx&gt; &amp;verts, vector&lt;ntlTriangle&gt; &amp;tris, <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a412b2b4fe010143b62a8019a03086110">gfxReal</a> fsTri) {
<a name="l00214"></a>00214     <span class="comment">// warning - copied from geomobj calc!</span>
<a name="l00215"></a>00215     <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ntlGeometryObjModel&quot;</span>,<span class="stringliteral">&quot;calcTriangleDivs special!&quot;</span>);
<a name="l00216"></a>00216     <a class="code" href="../../df/dc9/classntlGeometryObject.html#adef9a0506059e9d3f0a94bfc1fdc2159">mTriangleDivs1</a>.resize( tris.size() );
<a name="l00217"></a>00217     <a class="code" href="../../df/dc9/classntlGeometryObject.html#abebecc8ea1335989ee34eda73c455142">mTriangleDivs2</a>.resize( tris.size() );
<a name="l00218"></a>00218     <a class="code" href="../../df/dc9/classntlGeometryObject.html#a27e52274e896b546fe1018967ce3248b">mTriangleDivs3</a>.resize( tris.size() );
<a name="l00219"></a>00219     <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;tris.size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00220"></a>00220         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> p0 = verts[ tris[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getPoints()[0] ];
<a name="l00221"></a>00221         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> p1 = verts[ tris[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getPoints()[1] ];
<a name="l00222"></a>00222         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> p2 = verts[ tris[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getPoints()[2] ];
<a name="l00223"></a>00223         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> side1 = p1 - p0;
<a name="l00224"></a>00224         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> side2 = p2 - p0;
<a name="l00225"></a>00225         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3Gfx</a> side3 = p1 - p2;
<a name="l00226"></a>00226         <span class="keywordtype">int</span> divs1=0, divs2=0, divs3=0;
<a name="l00227"></a>00227         <span class="keywordflow">if</span>(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(side1) &gt; fsTri*fsTri) { divs1 = (int)(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a>(side1)/fsTri); }
<a name="l00228"></a>00228         <span class="keywordflow">if</span>(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(side2) &gt; fsTri*fsTri) { divs2 = (int)(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a>(side2)/fsTri); }
<a name="l00229"></a>00229         <span class="comment">//if(normNoSqrt(side3) &gt; fsTri*fsTri) { divs3 = (int)(norm(side3)/fsTri); }</span>
<a name="l00230"></a>00230 
<a name="l00231"></a>00231         <span class="comment">// special handling</span>
<a name="l00232"></a>00232         <span class="comment">// warning, requires objmodel triangle treatment (no verts dups)</span>
<a name="l00233"></a>00233         <span class="keywordflow">if</span>(<a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#acd0140e37802872ce7941669871d0178">getMeshAnimated</a>()) {
<a name="l00234"></a>00234             vector&lt;ntlSetVec3f&gt; &amp;sverts = mcAniVerts.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>();
<a name="l00235"></a>00235             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s=0; s&lt;(int)sverts.size(); s++) {
<a name="l00236"></a>00236                 p0 = sverts[s].mVerts[ tris[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getPoints()[0] ];
<a name="l00237"></a>00237                 p1 = sverts[s].mVerts[ tris[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getPoints()[1] ];
<a name="l00238"></a>00238                 p2 = sverts[s].mVerts[ tris[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].getPoints()[2] ];
<a name="l00239"></a>00239                 side1 = p1 - p0; side2 = p2 - p0; side3 = p1 - p2;
<a name="l00240"></a>00240                 <span class="keywordtype">int</span> tdivs1=0, tdivs2=0, tdivs3=0;
<a name="l00241"></a>00241                 <span class="keywordflow">if</span>(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(side1) &gt; fsTri*fsTri) { tdivs1 = (int)(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a>(side1)/fsTri); }
<a name="l00242"></a>00242                 <span class="keywordflow">if</span>(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a5dca86ef44aadc8acd1252a6d6981cf9">normNoSqrt</a>(side2) &gt; fsTri*fsTri) { tdivs2 = (int)(<a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a>(side2)/fsTri); }
<a name="l00243"></a>00243                 <span class="keywordflow">if</span>(tdivs1&gt;divs1) divs1=tdivs1;
<a name="l00244"></a>00244                 <span class="keywordflow">if</span>(tdivs2&gt;divs2) divs2=tdivs2;
<a name="l00245"></a>00245                 <span class="keywordflow">if</span>(tdivs3&gt;divs3) divs3=tdivs3;
<a name="l00246"></a>00246             }
<a name="l00247"></a>00247         } <span class="comment">// */</span>
<a name="l00248"></a>00248         <a class="code" href="../../df/dc9/classntlGeometryObject.html#adef9a0506059e9d3f0a94bfc1fdc2159">mTriangleDivs1</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = divs1;
<a name="l00249"></a>00249         <a class="code" href="../../df/dc9/classntlGeometryObject.html#abebecc8ea1335989ee34eda73c455142">mTriangleDivs2</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = divs2;
<a name="l00250"></a>00250         <a class="code" href="../../df/dc9/classntlGeometryObject.html#a27e52274e896b546fe1018967ce3248b">mTriangleDivs3</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = divs3;
<a name="l00251"></a>00251     }
<a name="l00252"></a>00252 }
<a name="l00253"></a>00253 
<a name="l00254"></a>00254 
<a name="l00255"></a>00255 <span class="comment">/******************************************************************************</span>
<a name="l00256"></a>00256 <span class="comment"> * load model from .obj file</span>
<a name="l00257"></a>00257 <span class="comment"> *****************************************************************************/</span>
<a name="l00258"></a>00258 
<a name="l00259"></a><a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#a39013949372e5882b9b1f107e6fc4c3f">00259</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#a39013949372e5882b9b1f107e6fc4c3f">ntlGeometryObjModel::loadBobjModel</a>(<span class="keywordtype">string</span> filename)
<a name="l00260"></a>00260 {
<a name="l00261"></a>00261     <span class="keywordtype">bool</span> haveAniSets=<span class="keyword">false</span>;
<a name="l00262"></a>00262     vector&lt;ntlSetVec3f&gt; aniverts;
<a name="l00263"></a>00263     vector&lt;ntlSetVec3f&gt; aninorms;
<a name="l00264"></a>00264     vector&lt;double&gt; anitimes;
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     <span class="keyword">const</span> <span class="keywordtype">bool</span> debugPrint=<span class="keyword">false</span>;
<a name="l00267"></a>00267     <span class="keyword">const</span> <span class="keywordtype">bool</span> debugPrintFull=<span class="keyword">false</span>;
<a name="l00268"></a>00268     gzFile gzf;
<a name="l00269"></a>00269     gzf = gzopen(filename.c_str(), <span class="stringliteral">&quot;rb&quot;</span>);
<a name="l00270"></a>00270     <span class="keywordflow">if</span> (!gzf) {
<a name="l00271"></a>00271         <a class="code" href="../../de/df0/utilities_8h.html#abbf67626aa468b4301520b9f6f292e1c">errFatal</a>(<span class="stringliteral">&quot;ntlGeometryObjModel::loadBobjModel&quot;</span>,<span class="stringliteral">&quot;Reading GZ_BOBJ, Unable to open &#39;&quot;</span>&lt;&lt; filename &lt;&lt;<span class="stringliteral">&quot;&#39;...\n&quot;</span>, <a class="code" href="../../de/df0/utilities_8h.html#a74894721e682bda2c22d5dacda988cad">SIMWORLD_INITERROR</a> );
<a name="l00272"></a>00272         <span class="keywordflow">return</span> 1;
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     <span class="keywordtype">int</span> numVerts;
<a name="l00276"></a>00276     <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>(numVerts)!=4) {  <span class="comment">// paranoia check</span>
<a name="l00277"></a>00277         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;Reading GZ_BOBJ&quot;</span>,<span class="stringliteral">&quot; Invalid int size, check compiler settings: int has to be 4 byte long&quot;</span>); 
<a name="l00278"></a>00278         <span class="keywordflow">goto</span> gzreaderror;
<a name="l00279"></a>00279     }
<a name="l00280"></a>00280     gzread(gzf, &amp;numVerts, <span class="keyword">sizeof</span>(numVerts) );
<a name="l00281"></a>00281     <span class="keywordflow">if</span>(numVerts&lt;0 || numVerts&gt;1e9) {
<a name="l00282"></a>00282         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;Reading GZ_BOBJ&quot;</span>,<span class="stringliteral">&quot; invalid num vertices &quot;</span>&lt;&lt; numVerts);
<a name="l00283"></a>00283         <span class="keywordflow">goto</span> gzreaderror;
<a name="l00284"></a>00284     }
<a name="l00285"></a>00285     mVertices.clear();
<a name="l00286"></a>00286     mVertices.resize( numVerts );
<a name="l00287"></a>00287     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numVerts; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00288"></a>00288         <span class="keywordtype">float</span> x[3];
<a name="l00289"></a>00289         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;3; j++) {
<a name="l00290"></a>00290             gzread(gzf, &amp;(x[j]), <span class="keyword">sizeof</span>( (x[j]) ) ); 
<a name="l00291"></a>00291         }
<a name="l00292"></a>00292         mVertices[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(x[0],x[1],x[2]);
<a name="l00293"></a>00293         <span class="keywordflow">if</span>(debugPrintFull) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;FULLV&quot;</span>,<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt; mVertices[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] );
<a name="l00294"></a>00294     }
<a name="l00295"></a>00295     <span class="keywordflow">if</span>(debugPrint) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;NV&quot;</span>,<span class="stringliteral">&quot; &quot;</span>&lt;&lt;numVerts&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt; mVertices.size() );
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <span class="comment">// should be the same as Vertices.size</span>
<a name="l00298"></a>00298     gzread(gzf, &amp;numVerts, <span class="keyword">sizeof</span>(numVerts) );
<a name="l00299"></a>00299     <span class="keywordflow">if</span>(numVerts&lt;0 || numVerts&gt;1e9) {
<a name="l00300"></a>00300         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;Reading GZ_BOBJ&quot;</span>,<span class="stringliteral">&quot;invalid num normals &quot;</span>&lt;&lt; numVerts);
<a name="l00301"></a>00301         <span class="keywordflow">goto</span> gzreaderror;
<a name="l00302"></a>00302     }
<a name="l00303"></a>00303     mNormals.clear();
<a name="l00304"></a>00304     mNormals.resize( numVerts );
<a name="l00305"></a>00305     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numVerts; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00306"></a>00306         <span class="keywordtype">float</span> n[3];
<a name="l00307"></a>00307         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;3; j++) {
<a name="l00308"></a>00308             gzread(gzf, &amp;(n[j]), <span class="keyword">sizeof</span>( (n[j]) ) ); 
<a name="l00309"></a>00309         }
<a name="l00310"></a>00310         mNormals[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(n[0],n[1],n[2]);
<a name="l00311"></a>00311         <span class="keywordflow">if</span>(debugPrintFull) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;FULLN&quot;</span>,<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt; mNormals[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] );
<a name="l00312"></a>00312     }
<a name="l00313"></a>00313     <span class="keywordflow">if</span>(debugPrint) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;NN&quot;</span>,<span class="stringliteral">&quot; &quot;</span>&lt;&lt;numVerts&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt; mNormals.size() );
<a name="l00314"></a>00314 
<a name="l00315"></a>00315     <span class="keywordtype">int</span> numTris;
<a name="l00316"></a>00316     gzread(gzf, &amp;numTris, <span class="keyword">sizeof</span>(numTris) );
<a name="l00317"></a>00317     <span class="keywordflow">if</span>(numTris&lt;0 || numTris&gt;1e9) {
<a name="l00318"></a>00318         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;Reading GZ_BOBJ&quot;</span>,<span class="stringliteral">&quot;invalid num normals &quot;</span>&lt;&lt; numTris);
<a name="l00319"></a>00319         <span class="keywordflow">goto</span> gzreaderror;
<a name="l00320"></a>00320     }
<a name="l00321"></a>00321     mTriangles.resize( 3*numTris );
<a name="l00322"></a>00322     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numTris; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00323"></a>00323         <span class="keywordtype">int</span> tri[3];
<a name="l00324"></a>00324         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;3; j++) {
<a name="l00325"></a>00325             gzread(gzf, &amp;(tri[j]), <span class="keyword">sizeof</span>( (tri[j]) ) ); 
<a name="l00326"></a>00326         }
<a name="l00327"></a>00327         mTriangles[3*<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+0] = tri[0];
<a name="l00328"></a>00328         mTriangles[3*<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1] = tri[1];
<a name="l00329"></a>00329         mTriangles[3*<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+2] = tri[2];
<a name="l00330"></a>00330     }
<a name="l00331"></a>00331     <span class="keywordflow">if</span>(debugPrint) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;NT&quot;</span>,<span class="stringliteral">&quot; &quot;</span>&lt;&lt;numTris&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt; mTriangles.size() );
<a name="l00332"></a>00332 
<a name="l00333"></a>00333     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ntlGeometryObjModel::loadBobjModel&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot;File &#39;&quot;</span>&lt;&lt;filename&lt;&lt;<span class="stringliteral">&quot;&#39; loaded, #Vertices: &quot;</span>&lt;&lt;mVertices.size()&lt;&lt;<span class="stringliteral">&quot;, #Normals: &quot;</span>&lt;&lt;mNormals.size()&lt;&lt;<span class="stringliteral">&quot;, #Triangles: &quot;</span>&lt;&lt;(mTriangles.size()/3)&lt;&lt;<span class="stringliteral">&quot; &quot;</span>, 1 );
<a name="l00334"></a>00334 
<a name="l00335"></a>00335     <span class="comment">// try to load animated mesh</span>
<a name="l00336"></a>00336     aniverts.clear();
<a name="l00337"></a>00337     aninorms.clear();
<a name="l00338"></a>00338     anitimes.clear();
<a name="l00339"></a>00339     <span class="keywordflow">while</span>(1) {
<a name="l00340"></a>00340         <span class="comment">//ntlVec3Gfx check;</span>
<a name="l00341"></a>00341         <span class="keywordtype">float</span> x[3];
<a name="l00342"></a>00342         <span class="keywordtype">float</span> frameTime=0.;
<a name="l00343"></a>00343         <span class="keywordtype">int</span> bytesRead = 0;
<a name="l00344"></a>00344         <span class="keywordtype">int</span> numNorms2=-1, numVerts2=-1;
<a name="l00345"></a>00345         <span class="comment">//for(int j=0; j&lt;3; j++) {</span>
<a name="l00346"></a>00346             <span class="comment">//x[j] = 0.;</span>
<a name="l00347"></a>00347             <span class="comment">//bytesRead += gzread(gzf, &amp;(x[j]), sizeof(float) ); </span>
<a name="l00348"></a>00348         <span class="comment">//}</span>
<a name="l00349"></a>00349         <span class="comment">//check = ntlVec3Gfx(x[0],x[1],x[2]);</span>
<a name="l00350"></a>00350         <span class="comment">//if(debugPrint) errMsg(&quot;ANI_NV1&quot;,&quot; &quot;&lt;&lt;check&lt;&lt;&quot; &quot;&lt;&lt;&quot; bytes:&quot;&lt;&lt;bytesRead );</span>
<a name="l00351"></a>00351         bytesRead += gzread(gzf, &amp;frameTime, <span class="keyword">sizeof</span>(frameTime) );
<a name="l00352"></a>00352         <span class="comment">//if(bytesRead!=3*sizeof(float)) {</span>
<a name="l00353"></a>00353         <span class="keywordflow">if</span>(bytesRead!=<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)) {
<a name="l00354"></a>00354             <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ntlGeometryObjModel::loadBobjModel&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot;File &#39;&quot;</span>&lt;&lt;filename&lt;&lt;<span class="stringliteral">&quot;&#39; end of gzfile. &quot;</span>, 10 );
<a name="l00355"></a>00355             <span class="keywordflow">if</span>(anitimes.size()&gt;0) {
<a name="l00356"></a>00356                 <span class="comment">// finally init channels and stop reading file</span>
<a name="l00357"></a>00357                 mcAniVerts = <a class="code" href="../../d1/df5/classAnimChannel.html">AnimChannel&lt;ntlSetVec3f&gt;</a>(aniverts,anitimes);
<a name="l00358"></a>00358                 mcAniNorms = <a class="code" href="../../d1/df5/classAnimChannel.html">AnimChannel&lt;ntlSetVec3f&gt;</a>(aninorms,anitimes);
<a name="l00359"></a>00359             }
<a name="l00360"></a>00360             <span class="keywordflow">goto</span> gzreaddone;
<a name="l00361"></a>00361         }
<a name="l00362"></a>00362         bytesRead += gzread(gzf, &amp;numVerts2, <span class="keyword">sizeof</span>(numVerts2) );
<a name="l00363"></a>00363         haveAniSets=<span class="keyword">true</span>;
<a name="l00364"></a>00364         <span class="comment">// continue to read new set</span>
<a name="l00365"></a>00365         vector&lt;ntlVec3Gfx&gt; vertset;
<a name="l00366"></a>00366         vector&lt;ntlVec3Gfx&gt; normset;
<a name="l00367"></a>00367         vertset.resize(numVerts);
<a name="l00368"></a>00368         normset.resize(numVerts);
<a name="l00369"></a>00369         <span class="comment">//vertset[0] = check;</span>
<a name="l00370"></a>00370         <span class="keywordflow">if</span>(debugPrintFull) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;FUL1V&quot;</span>,<span class="stringliteral">&quot; &quot;</span>&lt;&lt;0&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt; vertset[0] );
<a name="l00371"></a>00371 
<a name="l00372"></a>00372         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numVerts; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) { <span class="comment">// start at one!</span>
<a name="l00373"></a>00373             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;3; j++) {
<a name="l00374"></a>00374                 bytesRead += gzread(gzf, &amp;(x[j]), <span class="keyword">sizeof</span>( (x[j]) ) ); 
<a name="l00375"></a>00375             }
<a name="l00376"></a>00376             vertset[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(x[0],x[1],x[2]);
<a name="l00377"></a>00377             <span class="keywordflow">if</span>(debugPrintFull) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;FUL2V&quot;</span>,<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt; vertset[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] );
<a name="l00378"></a>00378         }
<a name="l00379"></a>00379         <span class="keywordflow">if</span>(debugPrint) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ANI_VV&quot;</span>,<span class="stringliteral">&quot; &quot;</span>&lt;&lt;numVerts&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt; vertset.size()&lt;&lt;<span class="stringliteral">&quot; bytes:&quot;</span>&lt;&lt;bytesRead );
<a name="l00380"></a>00380 
<a name="l00381"></a>00381         bytesRead += gzread(gzf, &amp;numNorms2, <span class="keyword">sizeof</span>(numNorms2) );
<a name="l00382"></a>00382         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;numVerts; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00383"></a>00383             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;3; j++) {
<a name="l00384"></a>00384                 bytesRead += gzread(gzf, &amp;(x[j]), <span class="keyword">sizeof</span>( (x[j]) ) ); 
<a name="l00385"></a>00385             }
<a name="l00386"></a>00386             normset[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(x[0],x[1],x[2]);
<a name="l00387"></a>00387             <span class="keywordflow">if</span>(debugPrintFull) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;FUL2N&quot;</span>,<span class="stringliteral">&quot; &quot;</span>&lt;&lt;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt; normset[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] );
<a name="l00388"></a>00388         }
<a name="l00389"></a>00389         <span class="keywordflow">if</span>(debugPrint) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ANI_NV&quot;</span>,<span class="stringliteral">&quot; &quot;</span>&lt;&lt;numVerts&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;numVerts2&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;numNorms2&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt; normset.size()&lt;&lt;<span class="stringliteral">&quot; bytes:&quot;</span>&lt;&lt;bytesRead );
<a name="l00390"></a>00390 
<a name="l00391"></a>00391         <span class="comment">// set ok</span>
<a name="l00392"></a>00392         <span class="keywordflow">if</span>(bytesRead== (<span class="keywordtype">int</span>)( (numVerts*2*3+1) *<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)+2*<span class="keyword">sizeof</span>(int) ) ) {
<a name="l00393"></a>00393             <span class="keywordflow">if</span>(aniverts.size()==0) {
<a name="l00394"></a>00394                 <span class="comment">// TODO, ignore first mesh?</span>
<a name="l00395"></a>00395                 <span class="keywordtype">double</span> anitime = (double)(frameTime-1.); <span class="comment">// start offset!? anitimes.size();</span>
<a name="l00396"></a>00396                 <span class="comment">// get for current frame entry</span>
<a name="l00397"></a>00397                 <span class="keywordflow">if</span>(mcAniTimes.<a class="code" href="../../d1/df5/classAnimChannel.html#a52487afec24261ec3220359c2bfe22d9" title="get number of entries (value and time sizes have to be equal)">getSize</a>()&gt;1)  anitime = mcAniTimes.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(anitime); 
<a name="l00398"></a>00398                 anitime = anitime*mAniTimeScale+mAniTimeOffset;
<a name="l00399"></a>00399 
<a name="l00400"></a>00400                 anitimes.push_back( anitime );
<a name="l00401"></a>00401                 aniverts.push_back( <a class="code" href="../../d5/d77/classntlSetVec3f.html">ntlSetVec3f</a>(mVertices) );
<a name="l00402"></a>00402                 aninorms.push_back( <a class="code" href="../../d5/d77/classntlSetVec3f.html">ntlSetVec3f</a>(mNormals) );
<a name="l00403"></a>00403                 <span class="keywordflow">if</span>(debugPrint) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ANI_NV&quot;</span>,<span class="stringliteral">&quot;new set &quot;</span>&lt;&lt;mVertices.size()&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt; mNormals.size()&lt;&lt;<span class="stringliteral">&quot; time:&quot;</span>&lt;&lt;anitime );
<a name="l00404"></a>00404             }
<a name="l00405"></a>00405             <span class="keywordtype">double</span> anitime = (double)(frameTime); <span class="comment">//anitimes.size();</span>
<a name="l00406"></a>00406             <span class="comment">// get for current frame entry</span>
<a name="l00407"></a>00407             <span class="keywordflow">if</span>(mcAniTimes.<a class="code" href="../../d1/df5/classAnimChannel.html#a52487afec24261ec3220359c2bfe22d9" title="get number of entries (value and time sizes have to be equal)">getSize</a>()&gt;1)  anitime = mcAniTimes.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(anitime); 
<a name="l00408"></a>00408             anitime = anitime*mAniTimeScale+mAniTimeOffset;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410             anitimes.push_back( anitime );
<a name="l00411"></a>00411             aniverts.push_back( <a class="code" href="../../d5/d77/classntlSetVec3f.html">ntlSetVec3f</a>(vertset) );
<a name="l00412"></a>00412             aninorms.push_back( <a class="code" href="../../d5/d77/classntlSetVec3f.html">ntlSetVec3f</a>(normset) );
<a name="l00413"></a>00413             <span class="keywordflow">if</span>(debugPrint) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ANI_NV&quot;</span>,<span class="stringliteral">&quot;new set &quot;</span>&lt;&lt;vertset.size()&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt; normset.size()&lt;&lt;<span class="stringliteral">&quot; time:&quot;</span>&lt;&lt;anitime );
<a name="l00414"></a>00414         } <span class="keywordflow">else</span> {
<a name="l00415"></a>00415             <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;ntlGeometryObjModel::loadBobjModel&quot;</span>,<span class="stringliteral">&quot;Malformed ani set! Aborting... (&quot;</span>&lt;&lt;bytesRead&lt;&lt;<span class="stringliteral">&quot;) &quot;</span>);
<a name="l00416"></a>00416             <span class="keywordflow">goto</span> gzreaddone;
<a name="l00417"></a>00417         }
<a name="l00418"></a>00418     } <span class="comment">// anim sets */</span>
<a name="l00419"></a>00419 
<a name="l00420"></a>00420 gzreaddone:
<a name="l00421"></a>00421 
<a name="l00422"></a>00422     <span class="keywordflow">if</span>(haveAniSets) { 
<a name="l00423"></a>00423         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;ntlGeometryObjModel::loadBobjModel&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>, <span class="stringliteral">&quot;File &#39;&quot;</span>&lt;&lt;filename&lt;&lt;<span class="stringliteral">&quot;&#39; ani sets loaded: &quot;</span>&lt;&lt; mcAniVerts.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size() &lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;mcAniNorms.<a class="code" href="../../d1/df5/classAnimChannel.html#a0bdfd17ab2a3d4438945c44ec75a22cc" title="raw access of value vector">accessValues</a>().size() &lt;&lt;<span class="stringliteral">&quot; &quot;</span>, 1 );
<a name="l00424"></a>00424     }
<a name="l00425"></a>00425     gzclose( gzf );
<a name="l00426"></a>00426     <span class="keywordflow">return</span> 0;
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 gzreaderror:
<a name="l00429"></a>00429     mTriangles.clear();
<a name="l00430"></a>00430     mVertices.clear();
<a name="l00431"></a>00431     mNormals.clear();
<a name="l00432"></a>00432     gzclose( gzf );
<a name="l00433"></a>00433     <a class="code" href="../../de/df0/utilities_8h.html#abbf67626aa468b4301520b9f6f292e1c">errFatal</a>(<span class="stringliteral">&quot;ntlGeometryObjModel::loadBobjModel&quot;</span>,<span class="stringliteral">&quot;Reading GZ_BOBJ, Unable to load &#39;&quot;</span>&lt;&lt; filename &lt;&lt;<span class="stringliteral">&quot;&#39;, exiting...\n&quot;</span>, <a class="code" href="../../de/df0/utilities_8h.html#a74894721e682bda2c22d5dacda988cad">SIMWORLD_INITERROR</a> );
<a name="l00434"></a>00434     <span class="keywordflow">return</span> 1;
<a name="l00435"></a>00435 }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437 
<a name="l00438"></a>00438 <span class="comment">/******************************************************************************</span>
<a name="l00439"></a>00439 <span class="comment"> * </span>
<a name="l00440"></a>00440 <span class="comment"> *****************************************************************************/</span>
<a name="l00441"></a>00441 <span class="keywordtype">void</span> 
<a name="l00442"></a><a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#abfd8ef6abacbd8b3da6c3d69adfa5cac">00442</a> <a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#abfd8ef6abacbd8b3da6c3d69adfa5cac">ntlGeometryObjModel::getTriangles</a>(<span class="keywordtype">double</span> t, vector&lt;ntlTriangle&gt; *triangles, 
<a name="l00443"></a>00443                                                             vector&lt;ntlVec3Gfx&gt; *<a class="code" href="../../d9/d0b/structvertices.html">vertices</a>, 
<a name="l00444"></a>00444                                                             vector&lt;ntlVec3Gfx&gt; *normals, <span class="keywordtype">int</span> objectId )
<a name="l00445"></a>00445 {
<a name="l00446"></a>00446     <span class="keywordflow">if</span>(!mLoaded) { <span class="comment">// invalid type...</span>
<a name="l00447"></a>00447         <span class="keywordflow">return</span>;
<a name="l00448"></a>00448     }
<a name="l00449"></a>00449     <span class="keywordflow">if</span>(mcAniVerts.<a class="code" href="../../d1/df5/classAnimChannel.html#a52487afec24261ec3220359c2bfe22d9" title="get number of entries (value and time sizes have to be equal)">getSize</a>()&gt;1) { mVertices = mcAniVerts.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(t).<a class="code" href="../../d5/d77/classntlSetVec3f.html#aad53065eae76375513f25369423bfdc8">mVerts</a>; }
<a name="l00450"></a>00450     <span class="keywordflow">if</span>(mcAniNorms.<a class="code" href="../../d1/df5/classAnimChannel.html#a52487afec24261ec3220359c2bfe22d9" title="get number of entries (value and time sizes have to be equal)">getSize</a>()&gt;1) { mNormals  = mcAniNorms.<a class="code" href="../../d1/df5/classAnimChannel.html#a2f8b4626f4c6c5a87c4de4235313d8e2">get</a>(t).<a class="code" href="../../d5/d77/classntlSetVec3f.html#aad53065eae76375513f25369423bfdc8">mVerts</a>; }
<a name="l00451"></a>00451 
<a name="l00452"></a>00452     <span class="keywordtype">int</span> startvert = vertices-&gt;size();
<a name="l00453"></a>00453     vertices-&gt;resize( vertices-&gt;size() + mVertices.size() );
<a name="l00454"></a>00454     normals-&gt;resize( normals-&gt;size() + mVertices.size() );
<a name="l00455"></a>00455     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;(int)mVertices.size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00456"></a>00456         (*vertices)[startvert+<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = mVertices[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00457"></a>00457         (*normals)[startvert+<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = mNormals[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00458"></a>00458     }
<a name="l00459"></a>00459 
<a name="l00460"></a>00460     triangles-&gt;reserve(triangles-&gt;size() + mTriangles.size()/3 );
<a name="l00461"></a>00461     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;(int)mTriangles.size(); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+=3) {
<a name="l00462"></a>00462         <span class="keywordtype">int</span> trip[3];
<a name="l00463"></a>00463         trip[0] = startvert+mTriangles[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+0];
<a name="l00464"></a>00464         trip[1] = startvert+mTriangles[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1];
<a name="l00465"></a>00465         trip[2] = startvert+mTriangles[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+2];
<a name="l00466"></a>00466 
<a name="l00467"></a>00467         <span class="comment">//sceneAddTriangle( </span>
<a name="l00468"></a>00468                 <span class="comment">//mVertices[trip[0]], mVertices[trip[1]], mVertices[trip[2]], </span>
<a name="l00469"></a>00469                 <span class="comment">//mNormals[trip[0]], mNormals[trip[1]], mNormals[trip[2]], </span>
<a name="l00470"></a>00470                 <span class="comment">//ntlVec3Gfx(0.0), 1 , triangles,vertices,normals ); /* normal unused */</span>
<a name="l00471"></a>00471         <a class="code" href="../../df/dc9/classntlGeometryObject.html#aa59d7b2cefa21d8d49e35cf3e6c752a7">sceneAddTriangleNoVert</a>( trip, <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a4006e3727805ede28b6ec98337c84427">ntlVec3Gfx</a>(0.0), 1 , triangles ); <span class="comment">/* normal unused */</span>
<a name="l00472"></a>00472     }
<a name="l00473"></a>00473     objectId = -1; <span class="comment">// remove warning</span>
<a name="l00474"></a>00474     <span class="comment">// bobj</span>
<a name="l00475"></a>00475     <span class="keywordflow">return</span>;
<a name="l00476"></a>00476 }
<a name="l00477"></a>00477 
<a name="l00478"></a>00478 
<a name="l00479"></a>00479 
<a name="l00480"></a>00480 
<a name="l00481"></a>00481 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:36 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

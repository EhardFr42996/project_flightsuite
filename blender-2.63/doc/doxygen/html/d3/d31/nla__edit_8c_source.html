<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: nla_edit.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">nla_edit.c</div>  </div>
</div>
<div class="contents">
<a href="../../d3/d31/nla__edit_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version. </span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2009 Blender Foundation, Joshua Leung</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * </span>
<a name="l00022"></a>00022 <span class="comment"> * Contributor(s): Joshua Leung (major recode)</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00025"></a>00025 <span class="comment"> */</span>
<a name="l00026"></a>00026 
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html">DNA_anim_types.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d88/BLI__rand_8h.html" title="Random number functions.">BLI_rand.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/df5/BKE__action_8h.html" title="Blender kernel action and pose functionality.">BKE_action.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dba/BKE__fcurve_8h.html">BKE_fcurve.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/de6/BKE__nla_8h.html">BKE_nla.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d40/BKE__report_8h.html">BKE_report.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/da3/BKE__screen_8h.html">BKE_screen.h</a>&quot;</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d6f/ED__anim__api_8h.html">ED_anim_api.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html">ED_keyframes_edit.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/da6/ED__markers_8h.html">ED_markers.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d12/ED__screen_8h.html">ED_screen.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/df2/ED__transform_8h.html">ED_transform.h</a>&quot;</span>
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d68/RNA__define_8h.html">RNA_define.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d68/RNA__enum__types_8h.html">RNA_enum_types.h</a>&quot;</span>
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d1e/UI__interface_8h.html">UI_interface.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d96/UI__resources_8h.html">UI_resources.h</a>&quot;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d63/UI__view2d_8h.html">UI_view2d.h</a>&quot;</span>
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d37/nla__intern_8h.html">nla_intern.h</a>&quot;</span> <span class="comment">// own include</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dcb/nla__private_8h.html">nla_private.h</a>&quot;</span> <span class="comment">// FIXME... maybe this shouldn&#39;t be included?</span>
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="comment">/* *********************************************** */</span>
<a name="l00076"></a>00076 <span class="comment">/* Utilities exported to other places... */</span>
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="comment">/* Perform validation for blending/extend settings */</span>
<a name="l00079"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a38612f440a01805e8b230908e5a97c8f">00079</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a38612f440a01805e8b230908e5a97c8f">ED_nla_postop_refresh</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac)
<a name="l00080"></a>00080 {
<a name="l00081"></a>00081     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00082"></a>00082     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00083"></a>00083     <span class="keywordtype">short</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a4e398ad453b0cbff2de76253616fd334">ANIMFILTER_ANIMDATA</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l00084"></a>00084     
<a name="l00085"></a>00085     <span class="comment">/* get blocks to work on */</span>
<a name="l00086"></a>00086     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00087"></a>00087     
<a name="l00088"></a>00088     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00089"></a>00089         <span class="comment">/* performing auto-blending, extend-mode validation, etc. */</span>
<a name="l00090"></a>00090         <a class="code" href="../../d9/de6/BKE__nla_8h.html#a87394b87f9cd2d2b667e55425a5b2da6">BKE_nla_validate_state</a>(ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>);
<a name="l00091"></a>00091     }
<a name="l00092"></a>00092     
<a name="l00093"></a>00093     <span class="comment">/* free temp memory */</span>
<a name="l00094"></a>00094     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00095"></a>00095 }
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="comment">/* *********************************************** */</span>
<a name="l00098"></a>00098 <span class="comment">/* &#39;Special&#39; Editing */</span>
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="comment">/* ******************** Tweak-Mode Operators ***************************** */</span>
<a name="l00101"></a>00101 <span class="comment">/* &#39;Tweak mode&#39; allows the action referenced by the active NLA-strip to be edited </span>
<a name="l00102"></a>00102 <span class="comment"> * as if it were the normal Active-Action of its AnimData block. </span>
<a name="l00103"></a>00103 <span class="comment"> */</span>
<a name="l00104"></a>00104 
<a name="l00105"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#abd59d4efe1095e974422a06f54dc4ddc">00105</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#abd59d4efe1095e974422a06f54dc4ddc">nlaedit_enable_tweakmode_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00106"></a>00106 {
<a name="l00107"></a>00107     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00108"></a>00108     
<a name="l00109"></a>00109     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00110"></a>00110     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00111"></a>00111     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00112"></a>00112     <span class="keywordtype">int</span> ok=0;
<a name="l00113"></a>00113     
<a name="l00114"></a>00114     <span class="comment">/* get editor data */</span>
<a name="l00115"></a>00115     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00116"></a>00116         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00117"></a>00117         
<a name="l00118"></a>00118     <span class="comment">/* get a list of the AnimData blocks being shown in the NLA */</span>
<a name="l00119"></a>00119     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a4e398ad453b0cbff2de76253616fd334">ANIMFILTER_ANIMDATA</a>);
<a name="l00120"></a>00120     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00121"></a>00121     
<a name="l00122"></a>00122     <span class="comment">/* if no blocks, popup error? */</span>
<a name="l00123"></a>00123     <span class="keywordflow">if</span> (anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00124"></a>00124         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;No AnimData blocks to enter tweakmode for&quot;</span>);
<a name="l00125"></a>00125         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00126"></a>00126     }   
<a name="l00127"></a>00127     
<a name="l00128"></a>00128     <span class="comment">/* for each AnimData block with NLA-data, try setting it in tweak-mode */</span>
<a name="l00129"></a>00129     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00130"></a>00130         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l00131"></a>00131         
<a name="l00132"></a>00132         <span class="comment">/* try entering tweakmode if valid */</span>
<a name="l00133"></a>00133         ok += <a class="code" href="../../d9/de6/BKE__nla_8h.html#aa52a32f34323dd9dec77e49ad06b6ad1">BKE_nla_tweakmode_enter</a>(adt);
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135     
<a name="l00136"></a>00136     <span class="comment">/* free temp data */</span>
<a name="l00137"></a>00137     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00138"></a>00138     
<a name="l00139"></a>00139     <span class="comment">/* if we managed to enter tweakmode on at least one AnimData block, </span>
<a name="l00140"></a>00140 <span class="comment">     * set the flag for this in the active scene and send notifiers</span>
<a name="l00141"></a>00141 <span class="comment">     */</span>
<a name="l00142"></a>00142     <span class="keywordflow">if</span> (ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a> &amp;&amp; ok) {
<a name="l00143"></a>00143         <span class="comment">/* set editing flag */</span>
<a name="l00144"></a>00144         ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#a60b2a18bedc706447c394de96c276eac">flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a12e3556c1744fba459bb5be28c4e6d53">SCE_NLA_EDIT_ON</a>;
<a name="l00145"></a>00145         
<a name="l00146"></a>00146         <span class="comment">/* set notifier that things have changed */</span>
<a name="l00147"></a>00147         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a1ae48304ab1b5da96c5319a62f9b3b80">ND_NLA_ACTCHANGE</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00148"></a>00148     }
<a name="l00149"></a>00149     <span class="keywordflow">else</span> {
<a name="l00150"></a>00150         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;No active strip(s) to enter tweakmode on&quot;</span>);
<a name="l00151"></a>00151         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00152"></a>00152     }
<a name="l00153"></a>00153     
<a name="l00154"></a>00154     <span class="comment">/* done */</span>
<a name="l00155"></a>00155     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00156"></a>00156 }
<a name="l00157"></a>00157  
<a name="l00158"></a><a class="code" href="../../da/d37/nla__intern_8h.html#a4a3b570a28282bb3da6ec169880c3fab">00158</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a4a3b570a28282bb3da6ec169880c3fab">NLA_OT_tweakmode_enter</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00159"></a>00159 {
<a name="l00160"></a>00160     <span class="comment">/* identifiers */</span>
<a name="l00161"></a>00161     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Enter Tweak Mode&quot;</span>;
<a name="l00162"></a>00162     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_tweakmode_enter&quot;</span>;
<a name="l00163"></a>00163     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Enter tweaking mode for the action referenced by the active strip&quot;</span>;
<a name="l00164"></a>00164     
<a name="l00165"></a>00165     <span class="comment">/* api callbacks */</span>
<a name="l00166"></a>00166     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#abd59d4efe1095e974422a06f54dc4ddc">nlaedit_enable_tweakmode_exec</a>;
<a name="l00167"></a>00167     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>;
<a name="l00168"></a>00168     
<a name="l00169"></a>00169     <span class="comment">/* flags */</span>
<a name="l00170"></a>00170     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00171"></a>00171 }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 <span class="comment">/* ------------- */</span>
<a name="l00174"></a>00174 
<a name="l00175"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a64b732286bf99f3338a17f308fc0beaf">00175</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a64b732286bf99f3338a17f308fc0beaf">nlaedit_disable_tweakmode_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00176"></a>00176 {
<a name="l00177"></a>00177     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00178"></a>00178     
<a name="l00179"></a>00179     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00180"></a>00180     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00181"></a>00181     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00182"></a>00182     
<a name="l00183"></a>00183     <span class="comment">/* get editor data */</span>
<a name="l00184"></a>00184     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00185"></a>00185         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00186"></a>00186         
<a name="l00187"></a>00187     <span class="comment">/* get a list of the AnimData blocks being shown in the NLA */</span>
<a name="l00188"></a>00188     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a4e398ad453b0cbff2de76253616fd334">ANIMFILTER_ANIMDATA</a>);
<a name="l00189"></a>00189     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00190"></a>00190     
<a name="l00191"></a>00191     <span class="comment">/* if no blocks, popup error? */</span>
<a name="l00192"></a>00192     <span class="keywordflow">if</span> (anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00193"></a>00193         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;No AnimData blocks to enter tweakmode for&quot;</span>);
<a name="l00194"></a>00194         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00195"></a>00195     }   
<a name="l00196"></a>00196     
<a name="l00197"></a>00197     <span class="comment">/* for each AnimData block with NLA-data, try exitting tweak-mode */</span>
<a name="l00198"></a>00198     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00199"></a>00199         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l00200"></a>00200         
<a name="l00201"></a>00201         <span class="comment">/* try entering tweakmode if valid */</span>
<a name="l00202"></a>00202         <a class="code" href="../../d9/de6/BKE__nla_8h.html#ad459b0824ec367ada95ad5b66e78a68d">BKE_nla_tweakmode_exit</a>(adt);
<a name="l00203"></a>00203     }
<a name="l00204"></a>00204     
<a name="l00205"></a>00205     <span class="comment">/* free temp data */</span>
<a name="l00206"></a>00206     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00207"></a>00207     
<a name="l00208"></a>00208     <span class="comment">/* if we managed to enter tweakmode on at least one AnimData block, </span>
<a name="l00209"></a>00209 <span class="comment">     * set the flag for this in the active scene and send notifiers</span>
<a name="l00210"></a>00210 <span class="comment">     */</span>
<a name="l00211"></a>00211     <span class="keywordflow">if</span> (ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>) {
<a name="l00212"></a>00212         <span class="comment">/* clear editing flag */</span>
<a name="l00213"></a>00213         ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#a60b2a18bedc706447c394de96c276eac">flag</a> &amp;= ~<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a12e3556c1744fba459bb5be28c4e6d53">SCE_NLA_EDIT_ON</a>;
<a name="l00214"></a>00214         
<a name="l00215"></a>00215         <span class="comment">/* set notifier that things have changed */</span>
<a name="l00216"></a>00216         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a1ae48304ab1b5da96c5319a62f9b3b80">ND_NLA_ACTCHANGE</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00217"></a>00217     }
<a name="l00218"></a>00218     
<a name="l00219"></a>00219     <span class="comment">/* done */</span>
<a name="l00220"></a>00220     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00221"></a>00221 }
<a name="l00222"></a>00222  
<a name="l00223"></a><a class="code" href="../../da/d37/nla__intern_8h.html#a2a15438ddc197488f3dbad51988f5776">00223</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a2a15438ddc197488f3dbad51988f5776">NLA_OT_tweakmode_exit</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00224"></a>00224 {
<a name="l00225"></a>00225     <span class="comment">/* identifiers */</span>
<a name="l00226"></a>00226     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Exit Tweak Mode&quot;</span>;
<a name="l00227"></a>00227     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_tweakmode_exit&quot;</span>;
<a name="l00228"></a>00228     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Exit tweaking mode for the action referenced by the active strip&quot;</span>;
<a name="l00229"></a>00229     
<a name="l00230"></a>00230     <span class="comment">/* api callbacks */</span>
<a name="l00231"></a>00231     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#a64b732286bf99f3338a17f308fc0beaf">nlaedit_disable_tweakmode_exec</a>;
<a name="l00232"></a>00232     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a912d240ae6168db6edae360088628a30">nlaop_poll_tweakmode_on</a>;
<a name="l00233"></a>00233     
<a name="l00234"></a>00234     <span class="comment">/* flags */</span>
<a name="l00235"></a>00235     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00236"></a>00236 }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 <span class="comment">/* *********************************************** */</span>
<a name="l00239"></a>00239 <span class="comment">/* NLA Strips Range Stuff */</span>
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 <span class="comment">/* *************************** Calculate Range ************************** */</span>
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 <span class="comment">/* Get the min/max strip extents */</span>
<a name="l00244"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a3974b0959ce0bb99634e4f33c4e1fab5">00244</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a3974b0959ce0bb99634e4f33c4e1fab5">get_nlastrip_extents</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keywordtype">float</span> *<a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>, <span class="keywordtype">float</span> *<a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>, <span class="keyword">const</span> <span class="keywordtype">short</span> onlySel)
<a name="l00245"></a>00245 {
<a name="l00246"></a>00246     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00247"></a>00247     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00248"></a>00248     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00249"></a>00249     
<a name="l00250"></a>00250     <span class="comment">/* get data to filter */</span>
<a name="l00251"></a>00251     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00252"></a>00252     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00253"></a>00253     
<a name="l00254"></a>00254     <span class="comment">/* set large values to try to override */</span>
<a name="l00255"></a>00255     *min= 999999999.0f;
<a name="l00256"></a>00256     *max= -999999999.0f;
<a name="l00257"></a>00257     
<a name="l00258"></a>00258     <span class="comment">/* check if any channels to set range with */</span>
<a name="l00259"></a>00259     <span class="keywordflow">if</span> (anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l00260"></a>00260         <span class="comment">/* go through channels, finding max extents */</span>
<a name="l00261"></a>00261         <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00262"></a>00262             <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt = (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l00263"></a>00263             <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip;
<a name="l00264"></a>00264             
<a name="l00265"></a>00265             for (strip = nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip = strip-&gt;next) {
<a name="l00266"></a>00266                 <span class="comment">/* only consider selected strips? */</span>
<a name="l00267"></a>00267                 <span class="keywordflow">if</span> ((onlySel == 0) || (strip-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a86b1827bba79c6683cdbeb6b1b4799e5">NLASTRIP_FLAG_SELECT</a>)) {
<a name="l00268"></a>00268                     <span class="comment">/* extend range if appropriate */</span>
<a name="l00269"></a>00269                     *min = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(*min, strip-&gt;start);
<a name="l00270"></a>00270                     *max = <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(*max, strip-&gt;end);
<a name="l00271"></a>00271                 }
<a name="l00272"></a>00272             }
<a name="l00273"></a>00273         }
<a name="l00274"></a>00274         
<a name="l00275"></a>00275         <span class="comment">/* free memory */</span>
<a name="l00276"></a>00276         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00277"></a>00277     }
<a name="l00278"></a>00278     <span class="keywordflow">else</span> {
<a name="l00279"></a>00279         <span class="comment">/* set default range */</span>
<a name="l00280"></a>00280         <span class="keywordflow">if</span> (ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>) {
<a name="l00281"></a>00281             *min= (float)ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a97f52582406befb3dba13b121d886526">sfra</a>;
<a name="l00282"></a>00282             *max= (<span class="keywordtype">float</span>)ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#af94766d58b62a533f851ce3f42ce026c">efra</a>;
<a name="l00283"></a>00283         }
<a name="l00284"></a>00284         <span class="keywordflow">else</span> {
<a name="l00285"></a>00285             *min= -5;
<a name="l00286"></a>00286             *max= 100;
<a name="l00287"></a>00287         }
<a name="l00288"></a>00288     }
<a name="l00289"></a>00289 }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291 <span class="comment">/* ****************** View-All Operator ****************** */</span>
<a name="l00292"></a>00292 
<a name="l00293"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a5e42b906ab152e543c5c8c27a0de348a">00293</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a5e42b906ab152e543c5c8c27a0de348a">nlaedit_viewall</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <span class="keyword">const</span> <span class="keywordtype">short</span> onlySel)
<a name="l00294"></a>00294 {
<a name="l00295"></a>00295     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00296"></a>00296     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d;
<a name="l00297"></a>00297     <span class="keywordtype">float</span> extra;
<a name="l00298"></a>00298     
<a name="l00299"></a>00299     <span class="comment">/* get editor data */</span>
<a name="l00300"></a>00300     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00301"></a>00301         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00302"></a>00302     v2d= &amp;ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a542e00138258c6836666296f30e0c2c0">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l00303"></a>00303     
<a name="l00304"></a>00304     <span class="comment">/* set the horizontal range, with an extra offset so that the extreme keys will be in view */</span>
<a name="l00305"></a>00305     <a class="code" href="../../d3/d31/nla__edit_8c.html#a3974b0959ce0bb99634e4f33c4e1fab5">get_nlastrip_extents</a>(&amp;ac, &amp;v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, &amp;v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>, onlySel);
<a name="l00306"></a>00306     
<a name="l00307"></a>00307     extra= 0.1f * (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>);
<a name="l00308"></a>00308     v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> -= extra;
<a name="l00309"></a>00309     v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> += extra;
<a name="l00310"></a>00310     
<a name="l00311"></a>00311     <span class="comment">/* set vertical range */</span>
<a name="l00312"></a>00312     v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = 0.0f;
<a name="l00313"></a>00313     v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = (float)-(v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>);
<a name="l00314"></a>00314     
<a name="l00315"></a>00315     <span class="comment">/* do View2D syncing */</span>
<a name="l00316"></a>00316     <a class="code" href="../../d5/d63/UI__view2d_8h.html#ab7089b88d3b7fdc1f26037f32468c7b1">UI_view2d_sync</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C), <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C), v2d, <a class="code" href="../../d5/d63/UI__view2d_8h.html#a1df4e9b75e5090a9a745b6f6bb9846af">V2D_LOCK_COPY</a>);
<a name="l00317"></a>00317     
<a name="l00318"></a>00318     <span class="comment">/* just redraw this view */</span>
<a name="l00319"></a>00319     <a class="code" href="../../d1/d12/ED__screen_8h.html#a0982c011d985308b08320d5f9604418b">ED_area_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C));
<a name="l00320"></a>00320     
<a name="l00321"></a>00321     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00322"></a>00322 }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 <span class="comment">/* ......... */</span>
<a name="l00325"></a>00325 
<a name="l00326"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a578998452013361578f728b200a1278b">00326</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a578998452013361578f728b200a1278b">nlaedit_viewall_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00327"></a>00327 {   
<a name="l00328"></a>00328     <span class="comment">/* whole range */</span>
<a name="l00329"></a>00329     <span class="keywordflow">return</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a5e42b906ab152e543c5c8c27a0de348a">nlaedit_viewall</a>(C, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00330"></a>00330 }
<a name="l00331"></a>00331 
<a name="l00332"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#ab33321a88e61c53935f3a2ad6e0e5978">00332</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#ab33321a88e61c53935f3a2ad6e0e5978">nlaedit_viewsel_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00333"></a>00333 {
<a name="l00334"></a>00334     <span class="comment">/* only selected */</span>
<a name="l00335"></a>00335     <span class="keywordflow">return</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a5e42b906ab152e543c5c8c27a0de348a">nlaedit_viewall</a>(C, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00336"></a>00336 }
<a name="l00337"></a>00337  
<a name="l00338"></a><a class="code" href="../../da/d37/nla__intern_8h.html#a14423824994105c2812f35348e91cb63">00338</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a14423824994105c2812f35348e91cb63">NLA_OT_view_all</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00339"></a>00339 {
<a name="l00340"></a>00340     <span class="comment">/* identifiers */</span>
<a name="l00341"></a>00341     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;View All&quot;</span>;
<a name="l00342"></a>00342     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_view_all&quot;</span>;
<a name="l00343"></a>00343     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Reset viewable area to show full strips range&quot;</span>;
<a name="l00344"></a>00344     
<a name="l00345"></a>00345     <span class="comment">/* api callbacks */</span>
<a name="l00346"></a>00346     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#a578998452013361578f728b200a1278b">nlaedit_viewall_exec</a>;
<a name="l00347"></a>00347     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a5ef52597df2373ca8e4e332cc9291c60">ED_operator_nla_active</a>;
<a name="l00348"></a>00348     
<a name="l00349"></a>00349     <span class="comment">/* flags */</span>
<a name="l00350"></a>00350     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00351"></a>00351 }
<a name="l00352"></a>00352 
<a name="l00353"></a><a class="code" href="../../da/d37/nla__intern_8h.html#ab6ff298909e26fa26cff047eaba60ec9">00353</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#ab6ff298909e26fa26cff047eaba60ec9">NLA_OT_view_selected</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00354"></a>00354 {
<a name="l00355"></a>00355     <span class="comment">/* identifiers */</span>
<a name="l00356"></a>00356     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;View Selected&quot;</span>;
<a name="l00357"></a>00357     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_view_selected&quot;</span>;
<a name="l00358"></a>00358     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Reset viewable area to show selected strips range&quot;</span>;
<a name="l00359"></a>00359     
<a name="l00360"></a>00360     <span class="comment">/* api callbacks */</span>
<a name="l00361"></a>00361     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#ab33321a88e61c53935f3a2ad6e0e5978">nlaedit_viewsel_exec</a>;
<a name="l00362"></a>00362     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a5ef52597df2373ca8e4e332cc9291c60">ED_operator_nla_active</a>;
<a name="l00363"></a>00363     
<a name="l00364"></a>00364     <span class="comment">/* flags */</span>
<a name="l00365"></a>00365     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00366"></a>00366 }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368 <span class="comment">/* *********************************************** */</span>
<a name="l00369"></a>00369 <span class="comment">/* NLA Editing Operations (Constructive/Destructive) */</span>
<a name="l00370"></a>00370 
<a name="l00371"></a>00371 <span class="comment">/* ******************** Add Action-Clip Operator ***************************** */</span>
<a name="l00372"></a>00372 <span class="comment">/* Add a new Action-Clip strip to the active track (or the active block if no space in the track) */</span>
<a name="l00373"></a>00373 
<a name="l00374"></a>00374 
<a name="l00375"></a>00375 <span class="comment">/* add the specified action as new strip */</span>
<a name="l00376"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#adaaf183970fd9ce4c43e6a56b8b9d994">00376</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#adaaf183970fd9ce4c43e6a56b8b9d994">nlaedit_add_actionclip_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00377"></a>00377 {
<a name="l00378"></a>00378     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00379"></a>00379     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene;
<a name="l00380"></a>00380     
<a name="l00381"></a>00381     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00382"></a>00382     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00383"></a>00383     <span class="keywordtype">size_t</span> items;
<a name="l00384"></a>00384     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00385"></a>00385 
<a name="l00386"></a>00386     <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *act;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     <span class="keywordtype">float</span> cfra;
<a name="l00389"></a>00389     
<a name="l00390"></a>00390     <span class="comment">/* get editor data */</span>
<a name="l00391"></a>00391     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00392"></a>00392         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00393"></a>00393         
<a name="l00394"></a>00394     scene= ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l00395"></a>00395     cfra= (float)<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a>;
<a name="l00396"></a>00396         
<a name="l00397"></a>00397     <span class="comment">/* get action to use */</span>
<a name="l00398"></a>00398     act= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;<a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C)-&gt;action, <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;action&quot;</span>));
<a name="l00399"></a>00399     
<a name="l00400"></a>00400     <span class="keywordflow">if</span> (act == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00401"></a>00401         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;No valid Action to add&quot;</span>);
<a name="l00402"></a>00402         <span class="comment">//printf(&quot;Add strip - actname = &#39;%s&#39;\n&quot;, actname);</span>
<a name="l00403"></a>00403         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00404"></a>00404     }
<a name="l00405"></a>00405     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ae1a06e3eae33f2a10deaa28a62c3997a">idroot</a> == 0) {
<a name="l00406"></a>00406         <span class="comment">/* hopefully in this case (i.e. library of userless actions), the user knows what they&#39;re doing... */</span>
<a name="l00407"></a>00407         <a class="code" href="../../d2/d40/BKE__report_8h.html#af25c247b3b620d13cef87ec2bed1698e">BKE_reportf</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68aa7428e90bb3916896145e5eb14a7dd7b">RPT_WARNING</a>,
<a name="l00408"></a>00408             <span class="stringliteral">&quot;Action &#39;%s&#39; does not specify what datablocks it can be used on. Try setting the &#39;ID Root Type&#39; setting from the Datablocks Editor for this Action to avoid future problems&quot;</span>,
<a name="l00409"></a>00409             act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ad0f2d8efde1fdd4f81ee9fe471313bd6">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2);
<a name="l00410"></a>00410     }
<a name="l00411"></a>00411     
<a name="l00412"></a>00412     <span class="comment">/* get a list of the editable tracks being shown in the NLA</span>
<a name="l00413"></a>00413 <span class="comment">     *  - this is limited to active ones for now, but could be expanded to </span>
<a name="l00414"></a>00414 <span class="comment">     */</span>
<a name="l00415"></a>00415     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a14ccbd8e983dd0fb6fa15416e2f91d57">ANIMFILTER_ACTIVE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l00416"></a>00416     items= <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00417"></a>00417     
<a name="l00418"></a>00418     <span class="keywordflow">if</span> (items == 0) {
<a name="l00419"></a>00419         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;No active track(s) to add strip to&quot;</span>);
<a name="l00420"></a>00420         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00421"></a>00421     }
<a name="l00422"></a>00422     
<a name="l00423"></a>00423     <span class="comment">/* for every active track, try to add strip to free space in track or to the top of the stack if no space */</span>
<a name="l00424"></a>00424     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00425"></a>00425         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l00426"></a>00426         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>;
<a name="l00427"></a>00427         <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00428"></a>00428         
<a name="l00429"></a>00429         <span class="comment">/* sanity check: only apply actions of the right type for this ID </span>
<a name="l00430"></a>00430 <span class="comment">         * NOTE: in the case that this hasn&#39;t been set, we&#39;ve already warned the user about this already</span>
<a name="l00431"></a>00431 <span class="comment">         */</span>
<a name="l00432"></a>00432         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> ((act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ae1a06e3eae33f2a10deaa28a62c3997a">idroot</a>) &amp;&amp; (act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ae1a06e3eae33f2a10deaa28a62c3997a">idroot</a> != <a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ad2686a20c9c11e9889e3f4d9a60b8b8c">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>))) {
<a name="l00433"></a>00433             <a class="code" href="../../d2/d40/BKE__report_8h.html#af25c247b3b620d13cef87ec2bed1698e">BKE_reportf</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, 
<a name="l00434"></a>00434                 <span class="stringliteral">&quot;Couldn&#39;t add action &#39;%s&#39; as it cannot be used relative to ID-blocks of type &#39;%s&#39;&quot;</span>,
<a name="l00435"></a>00435                 act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ad0f2d8efde1fdd4f81ee9fe471313bd6">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ad2686a20c9c11e9889e3f4d9a60b8b8c">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>);
<a name="l00436"></a>00436             <span class="keywordflow">continue</span>;
<a name="l00437"></a>00437         }
<a name="l00438"></a>00438         
<a name="l00439"></a>00439         <span class="comment">/* create a new strip, and offset it to start on the current frame */</span>
<a name="l00440"></a>00440         strip= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ac2ba7b495cb4b07a1eebff5950be650e">add_nlastrip</a>(act);
<a name="l00441"></a>00441         
<a name="l00442"></a>00442         strip-&gt;end      += (cfra - strip-&gt;start);
<a name="l00443"></a>00443         strip-&gt;start     = cfra;
<a name="l00444"></a>00444         
<a name="l00445"></a>00445         <span class="comment">/* firstly try adding strip to our current track, but if that fails, add to a new track */</span>
<a name="l00446"></a>00446         <span class="keywordflow">if</span> (<a class="code" href="../../d9/de6/BKE__nla_8h.html#a15ed3c0b4de96436ec6938f4a2aae230">BKE_nlatrack_add_strip</a>(nlt, strip) == 0) {
<a name="l00447"></a>00447             <span class="comment">/* trying to add to the current failed (no space), </span>
<a name="l00448"></a>00448 <span class="comment">             * so add a new track to the stack, and add to that...</span>
<a name="l00449"></a>00449 <span class="comment">             */</span>
<a name="l00450"></a>00450             nlt= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ade883909faa615e4f9aa88de3686d3ce">add_nlatrack</a>(adt, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00451"></a>00451             <a class="code" href="../../d9/de6/BKE__nla_8h.html#a15ed3c0b4de96436ec6938f4a2aae230">BKE_nlatrack_add_strip</a>(nlt, strip);
<a name="l00452"></a>00452         }
<a name="l00453"></a>00453         
<a name="l00454"></a>00454         <span class="comment">/* auto-name it */</span>
<a name="l00455"></a>00455         <a class="code" href="../../d9/de6/BKE__nla_8h.html#a3dc48bd590f3e9bde0afb153cf6901f4">BKE_nlastrip_validate_name</a>(adt, strip);
<a name="l00456"></a>00456     }
<a name="l00457"></a>00457     
<a name="l00458"></a>00458     <span class="comment">/* free temp data */</span>
<a name="l00459"></a>00459     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00460"></a>00460     
<a name="l00461"></a>00461     <span class="comment">/* refresh auto strip properties */</span>
<a name="l00462"></a>00462     <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a38612f440a01805e8b230908e5a97c8f">ED_nla_postop_refresh</a>(&amp;ac);
<a name="l00463"></a>00463     
<a name="l00464"></a>00464     <span class="comment">/* set notifier that things have changed */</span>
<a name="l00465"></a>00465     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00466"></a>00466     
<a name="l00467"></a>00467     <span class="comment">/* done */</span>
<a name="l00468"></a>00468     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00469"></a>00469 }
<a name="l00470"></a>00470 
<a name="l00471"></a><a class="code" href="../../da/d37/nla__intern_8h.html#adb07abb7ca29d9d798b0d80619907eda">00471</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#adb07abb7ca29d9d798b0d80619907eda">NLA_OT_actionclip_add</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00472"></a>00472 {
<a name="l00473"></a>00473     <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *prop;
<a name="l00474"></a>00474 
<a name="l00475"></a>00475     <span class="comment">/* identifiers */</span>
<a name="l00476"></a>00476     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Action Strip&quot;</span>;
<a name="l00477"></a>00477     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_actionclip_add&quot;</span>;
<a name="l00478"></a>00478     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Add an Action-Clip strip (i.e. an NLA Strip referencing an Action) to the active track&quot;</span>;
<a name="l00479"></a>00479     
<a name="l00480"></a>00480     <span class="comment">/* api callbacks */</span>
<a name="l00481"></a>00481     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a7fed5b2a4bd4179895d2e90c882ca3dd">WM_enum_search_invoke</a>;
<a name="l00482"></a>00482     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#adaaf183970fd9ce4c43e6a56b8b9d994">nlaedit_add_actionclip_exec</a>;
<a name="l00483"></a>00483     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>;
<a name="l00484"></a>00484     
<a name="l00485"></a>00485     <span class="comment">/* flags */</span>
<a name="l00486"></a>00486     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00487"></a>00487     
<a name="l00488"></a>00488     <span class="comment">/* props */</span>
<a name="l00489"></a>00489         <span class="comment">// TODO: this would be nicer as an ID-pointer...</span>
<a name="l00490"></a>00490     prop= <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;action&quot;</span>, <a class="code" href="../../d3/d10/rna__access_8c.html#abf24cbff0dda06cfad896088d53288fe">DummyRNA_NULL_items</a>, 0, <span class="stringliteral">&quot;Action&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00491"></a>00491     <a class="code" href="../../dc/d7e/rna__define_8c.html#adb30c6a3157cbd3193ff1a8de159389f">RNA_def_enum_funcs</a>(prop, <a class="code" href="../../d5/d68/RNA__enum__types_8h.html#a3aa4b2de944c849160ea793110442830">RNA_action_itemf</a>);
<a name="l00492"></a>00492     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = prop;
<a name="l00493"></a>00493 }
<a name="l00494"></a>00494 
<a name="l00495"></a>00495 <span class="comment">/* ******************** Add Transition Operator ***************************** */</span>
<a name="l00496"></a>00496 <span class="comment">/* Add a new transition strip between selected strips */</span>
<a name="l00497"></a>00497 
<a name="l00498"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a11196b145b0b7f55ba2ac010b425a3ae">00498</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a11196b145b0b7f55ba2ac010b425a3ae">nlaedit_add_transition_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00499"></a>00499 {
<a name="l00500"></a>00500     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00501"></a>00501     
<a name="l00502"></a>00502     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00503"></a>00503     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00504"></a>00504     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00505"></a>00505     
<a name="l00506"></a>00506     <span class="keywordtype">int</span> done = 0;
<a name="l00507"></a>00507     
<a name="l00508"></a>00508     <span class="comment">/* get editor data */</span>
<a name="l00509"></a>00509     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00510"></a>00510         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00511"></a>00511     
<a name="l00512"></a>00512     <span class="comment">/* get a list of the editable tracks being shown in the NLA */</span>
<a name="l00513"></a>00513     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l00514"></a>00514     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00515"></a>00515     
<a name="l00516"></a>00516     <span class="comment">/* for each track, find pairs of strips to add transitions to */</span>
<a name="l00517"></a>00517     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00518"></a>00518         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l00519"></a>00519         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>;
<a name="l00520"></a>00520         <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *s1, *s2;
<a name="l00521"></a>00521         
<a name="l00522"></a>00522         <span class="comment">/* get initial pair of strips */</span>
<a name="l00523"></a>00523         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>))
<a name="l00524"></a>00524             <span class="keywordflow">continue</span>;
<a name="l00525"></a>00525         s1= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00526"></a>00526         s2= s1-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a0e1bf52d90da905fbab053178c869a8e">next</a>;
<a name="l00527"></a>00527         
<a name="l00528"></a>00528         <span class="comment">/* loop over strips */</span>
<a name="l00529"></a>00529         <span class="keywordflow">for</span> (; s1 &amp;&amp; s2; s1=s2, s2=s2-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a0e1bf52d90da905fbab053178c869a8e">next</a>) {
<a name="l00530"></a>00530             <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip;
<a name="l00531"></a>00531             
<a name="l00532"></a>00532             <span class="comment">/* check if both are selected */</span>
<a name="l00533"></a>00533             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(0, (s1-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a38c39284c9b83acf3c582ca956ded9d1">flag</a> &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a86b1827bba79c6683cdbeb6b1b4799e5">NLASTRIP_FLAG_SELECT</a>), (s2-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a86b1827bba79c6683cdbeb6b1b4799e5">NLASTRIP_FLAG_SELECT</a>)))
<a name="l00534"></a>00534                 <span class="keywordflow">continue</span>;
<a name="l00535"></a>00535             <span class="comment">/* check if there&#39;s space between the two */</span>
<a name="l00536"></a>00536             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#acc074658bb6b51cde503721347a81b33">IS_EQF</a>(s1-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a8d7f4a18c61cd0cac5cbe8a344e875a1">end</a>, s2-&gt;start))
<a name="l00537"></a>00537                 <span class="keywordflow">continue</span>;
<a name="l00538"></a>00538             <span class="comment">/* make sure neither one is a transition </span>
<a name="l00539"></a>00539 <span class="comment">             *  - although this is impossible to create with the standard tools, </span>
<a name="l00540"></a>00540 <span class="comment">             *    the user may have altered the settings</span>
<a name="l00541"></a>00541 <span class="comment">             */</span>
<a name="l00542"></a>00542             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#abddb46a0c18f6964b5dcec7f2de51b55a507ee0ba236e46280991034c41d9b61a">NLASTRIP_TYPE_TRANSITION</a>, s1-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a25fb6e5c5f8719f65f416f509751b0ca">type</a>, s2-&gt;type))
<a name="l00543"></a>00543                 <span class="keywordflow">continue</span>;
<a name="l00544"></a>00544             <span class="comment">/* also make sure neither one is a soundclip */</span>
<a name="l00545"></a>00545             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#abddb46a0c18f6964b5dcec7f2de51b55a075d5802024bf6ca7013d4e4ae9ae3d2">NLASTRIP_TYPE_SOUND</a>, s1-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a25fb6e5c5f8719f65f416f509751b0ca">type</a>, s2-&gt;type))
<a name="l00546"></a>00546                 <span class="keywordflow">continue</span>;
<a name="l00547"></a>00547                 
<a name="l00548"></a>00548             <span class="comment">/* allocate new strip */</span>
<a name="l00549"></a>00549             strip= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a>), <span class="stringliteral">&quot;NlaStrip&quot;</span>);
<a name="l00550"></a>00550             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a9c299678f8810312806da26e6132ccc7">BLI_insertlinkafter</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, s1, strip);
<a name="l00551"></a>00551             
<a name="l00552"></a>00552             <span class="comment">/* set the type */</span>
<a name="l00553"></a>00553             strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a25fb6e5c5f8719f65f416f509751b0ca">type</a>= <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#abddb46a0c18f6964b5dcec7f2de51b55a507ee0ba236e46280991034c41d9b61a">NLASTRIP_TYPE_TRANSITION</a>;
<a name="l00554"></a>00554             
<a name="l00555"></a>00555             <span class="comment">/* generic settings </span>
<a name="l00556"></a>00556 <span class="comment">             *  - selected flag to highlight this to the user</span>
<a name="l00557"></a>00557 <span class="comment">             *  - auto-blends to ensure that blend in/out values are automatically </span>
<a name="l00558"></a>00558 <span class="comment">             *    determined by overlaps of strips</span>
<a name="l00559"></a>00559 <span class="comment">             */</span>
<a name="l00560"></a>00560             strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a38c39284c9b83acf3c582ca956ded9d1">flag</a> = <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a86b1827bba79c6683cdbeb6b1b4799e5">NLASTRIP_FLAG_SELECT</a>|<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a5957e93f21fddd289ccc66ac78c37b06">NLASTRIP_FLAG_AUTO_BLENDS</a>;
<a name="l00561"></a>00561             
<a name="l00562"></a>00562             <span class="comment">/* range is simply defined as the endpoints of the adjacent strips */</span>
<a name="l00563"></a>00563             strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ae2094c7a1fbf3ace399a32ec093c4fd5">start</a>    = s1-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a8d7f4a18c61cd0cac5cbe8a344e875a1">end</a>;
<a name="l00564"></a>00564             strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a8d7f4a18c61cd0cac5cbe8a344e875a1">end</a>      = s2-&gt;start;
<a name="l00565"></a>00565             
<a name="l00566"></a>00566             <span class="comment">/* scale and repeat aren&#39;t of any use, but shouldn&#39;t ever be 0 */</span>
<a name="l00567"></a>00567             strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a27146c6fc55825c160126786ad195950">scale</a>= 1.0f;
<a name="l00568"></a>00568             strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ac810e95f37c9233f9c679ff25592a97e">repeat</a> = 1.0f;
<a name="l00569"></a>00569             
<a name="l00570"></a>00570             <span class="comment">/* auto-name it */</span>
<a name="l00571"></a>00571             <a class="code" href="../../d9/de6/BKE__nla_8h.html#a3dc48bd590f3e9bde0afb153cf6901f4">BKE_nlastrip_validate_name</a>(adt, strip);
<a name="l00572"></a>00572             
<a name="l00573"></a>00573             <span class="comment">/* make note of this */</span>
<a name="l00574"></a>00574             done++;
<a name="l00575"></a>00575         }
<a name="l00576"></a>00576     }
<a name="l00577"></a>00577     
<a name="l00578"></a>00578     <span class="comment">/* free temp data */</span>
<a name="l00579"></a>00579     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00580"></a>00580     
<a name="l00581"></a>00581     <span class="comment">/* was anything added? */</span>
<a name="l00582"></a>00582     <span class="keywordflow">if</span> (done) {
<a name="l00583"></a>00583         <span class="comment">/* refresh auto strip properties */</span>
<a name="l00584"></a>00584         <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a38612f440a01805e8b230908e5a97c8f">ED_nla_postop_refresh</a>(&amp;ac);
<a name="l00585"></a>00585         
<a name="l00586"></a>00586         <span class="comment">/* set notifier that things have changed */</span>
<a name="l00587"></a>00587         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00588"></a>00588         
<a name="l00589"></a>00589         <span class="comment">/* done */</span>
<a name="l00590"></a>00590         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00591"></a>00591     }
<a name="l00592"></a>00592     <span class="keywordflow">else</span> {
<a name="l00593"></a>00593         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Needs at least a pair of adjacent selected strips with a gap between them&quot;</span>);
<a name="l00594"></a>00594         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00595"></a>00595     }
<a name="l00596"></a>00596 }
<a name="l00597"></a>00597 
<a name="l00598"></a><a class="code" href="../../da/d37/nla__intern_8h.html#aad0c328b314619fac402d6d9030d9212">00598</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#aad0c328b314619fac402d6d9030d9212">NLA_OT_transition_add</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00599"></a>00599 {
<a name="l00600"></a>00600     <span class="comment">/* identifiers */</span>
<a name="l00601"></a>00601     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Transition&quot;</span>;
<a name="l00602"></a>00602     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_transition_add&quot;</span>;
<a name="l00603"></a>00603     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Add a transition strip between two adjacent selected strips&quot;</span>;
<a name="l00604"></a>00604     
<a name="l00605"></a>00605     <span class="comment">/* api callbacks */</span>
<a name="l00606"></a>00606     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#a11196b145b0b7f55ba2ac010b425a3ae">nlaedit_add_transition_exec</a>;
<a name="l00607"></a>00607     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>;
<a name="l00608"></a>00608     
<a name="l00609"></a>00609     <span class="comment">/* flags */</span>
<a name="l00610"></a>00610     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00611"></a>00611 }
<a name="l00612"></a>00612 
<a name="l00613"></a>00613 <span class="comment">/* ******************** Add Sound Clip Operator ***************************** */</span>
<a name="l00614"></a>00614 <span class="comment">/* Add a new sound clip */</span>
<a name="l00615"></a>00615 
<a name="l00616"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a90bb8e96c66c7952e61043423b1b2c22">00616</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a90bb8e96c66c7952e61043423b1b2c22">nlaedit_add_sound_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00617"></a>00617 {
<a name="l00618"></a>00618     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00619"></a>00619     
<a name="l00620"></a>00620     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00621"></a>00621     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00622"></a>00622     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00623"></a>00623     
<a name="l00624"></a>00624     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene;
<a name="l00625"></a>00625     <span class="keywordtype">int</span> cfra;
<a name="l00626"></a>00626     
<a name="l00627"></a>00627     <span class="comment">/* get editor data */</span>
<a name="l00628"></a>00628     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00629"></a>00629         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00630"></a>00630     
<a name="l00631"></a>00631     scene = ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l00632"></a>00632     cfra = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a>;
<a name="l00633"></a>00633     
<a name="l00634"></a>00634     <span class="comment">/* get a list of the editable tracks being shown in the NLA */</span>
<a name="l00635"></a>00635     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045af15e0b18ede9eb0bdae48b6caab11403">ANIMFILTER_SEL</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l00636"></a>00636     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00637"></a>00637     
<a name="l00638"></a>00638     <span class="comment">/* for each track, add sound clips if it belongs to a speaker */</span>
<a name="l00639"></a>00639     <span class="comment">// TODO: what happens if there aren&#39;t any tracks... well that&#39;s a more general problem for later</span>
<a name="l00640"></a>00640     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00641"></a>00641         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = (<a class="code" href="../../de/de7/structObject.html">Object</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ad2686a20c9c11e9889e3f4d9a60b8b8c">id</a>; <span class="comment">/* may not be object until we actually check! */</span>
<a name="l00642"></a>00642         
<a name="l00643"></a>00643         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt = ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>;
<a name="l00644"></a>00644         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l00645"></a>00645         <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip;
<a name="l00646"></a>00646         
<a name="l00647"></a>00647         <span class="comment">/* does this belong to speaker - assumed to live on Object level only */</span>
<a name="l00648"></a>00648         <span class="keywordflow">if</span> ((<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ad2686a20c9c11e9889e3f4d9a60b8b8c">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>) != <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>) || (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> != <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#adbb088925cd622aa2bacd6c46c161549">OB_SPEAKER</a>))
<a name="l00649"></a>00649             <span class="keywordflow">continue</span>;
<a name="l00650"></a>00650             
<a name="l00651"></a>00651         <span class="comment">/* create a new strip, and offset it to start on the current frame */</span>
<a name="l00652"></a>00652         strip= <a class="code" href="../../d9/de6/BKE__nla_8h.html#a29ae7338f7790c6c899109c1801fbe14">add_nla_soundstrip</a>(ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>); 
<a name="l00653"></a>00653         
<a name="l00654"></a>00654         strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ae2094c7a1fbf3ace399a32ec093c4fd5">start</a>    += cfra;
<a name="l00655"></a>00655         strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a8d7f4a18c61cd0cac5cbe8a344e875a1">end</a>      += cfra;
<a name="l00656"></a>00656         
<a name="l00657"></a>00657         <span class="comment">/* firstly try adding strip to our current track, but if that fails, add to a new track */</span>
<a name="l00658"></a>00658         <span class="keywordflow">if</span> (<a class="code" href="../../d9/de6/BKE__nla_8h.html#a15ed3c0b4de96436ec6938f4a2aae230">BKE_nlatrack_add_strip</a>(nlt, strip) == 0) {
<a name="l00659"></a>00659             <span class="comment">/* trying to add to the current failed (no space), </span>
<a name="l00660"></a>00660 <span class="comment">             * so add a new track to the stack, and add to that...</span>
<a name="l00661"></a>00661 <span class="comment">             */</span>
<a name="l00662"></a>00662             nlt= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ade883909faa615e4f9aa88de3686d3ce">add_nlatrack</a>(adt, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00663"></a>00663             <a class="code" href="../../d9/de6/BKE__nla_8h.html#a15ed3c0b4de96436ec6938f4a2aae230">BKE_nlatrack_add_strip</a>(nlt, strip);
<a name="l00664"></a>00664         }
<a name="l00665"></a>00665         
<a name="l00666"></a>00666         <span class="comment">/* auto-name it */</span>
<a name="l00667"></a>00667         <a class="code" href="../../d9/de6/BKE__nla_8h.html#a3dc48bd590f3e9bde0afb153cf6901f4">BKE_nlastrip_validate_name</a>(adt, strip);
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669     
<a name="l00670"></a>00670     <span class="comment">/* free temp data */</span>
<a name="l00671"></a>00671     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00672"></a>00672     
<a name="l00673"></a>00673     <span class="comment">/* refresh auto strip properties */</span>
<a name="l00674"></a>00674     <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a38612f440a01805e8b230908e5a97c8f">ED_nla_postop_refresh</a>(&amp;ac);
<a name="l00675"></a>00675     
<a name="l00676"></a>00676     <span class="comment">/* set notifier that things have changed */</span>
<a name="l00677"></a>00677     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00678"></a>00678     
<a name="l00679"></a>00679     <span class="comment">/* done */</span>
<a name="l00680"></a>00680     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00681"></a>00681 }
<a name="l00682"></a>00682 
<a name="l00683"></a><a class="code" href="../../da/d37/nla__intern_8h.html#a3ce9d8be0d9b5404e24933e3b33466c6">00683</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a3ce9d8be0d9b5404e24933e3b33466c6">NLA_OT_soundclip_add</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00684"></a>00684 {
<a name="l00685"></a>00685     <span class="comment">/* identifiers */</span>
<a name="l00686"></a>00686     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Sound Clip&quot;</span>;
<a name="l00687"></a>00687     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_soundclip_add&quot;</span>;
<a name="l00688"></a>00688     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Add a strip for controlling when speaker plays its sound clip&quot;</span>;
<a name="l00689"></a>00689     
<a name="l00690"></a>00690     <span class="comment">/* api callbacks */</span>
<a name="l00691"></a>00691     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#a90bb8e96c66c7952e61043423b1b2c22">nlaedit_add_sound_exec</a>;
<a name="l00692"></a>00692     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>;
<a name="l00693"></a>00693     
<a name="l00694"></a>00694     <span class="comment">/* flags */</span>
<a name="l00695"></a>00695     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00696"></a>00696 }
<a name="l00697"></a>00697 
<a name="l00698"></a>00698 <span class="comment">/* ******************** Add Meta-Strip Operator ***************************** */</span>
<a name="l00699"></a>00699 <span class="comment">/* Add new meta-strips incorporating the selected strips */</span>
<a name="l00700"></a>00700 
<a name="l00701"></a>00701 <span class="comment">/* add the specified action as new strip */</span>
<a name="l00702"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#ab234123f057970cc47e703b423a7286e">00702</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#ab234123f057970cc47e703b423a7286e">nlaedit_add_meta_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00703"></a>00703 {
<a name="l00704"></a>00704     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00705"></a>00705     
<a name="l00706"></a>00706     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00707"></a>00707     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00708"></a>00708     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00709"></a>00709     
<a name="l00710"></a>00710     <span class="comment">/* get editor data */</span>
<a name="l00711"></a>00711     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00712"></a>00712         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00713"></a>00713     
<a name="l00714"></a>00714     <span class="comment">/* get a list of the editable tracks being shown in the NLA */</span>
<a name="l00715"></a>00715     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l00716"></a>00716     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00717"></a>00717     
<a name="l00718"></a>00718     <span class="comment">/* for each track, find pairs of strips to add transitions to */</span>
<a name="l00719"></a>00719     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00720"></a>00720         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l00721"></a>00721         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>;
<a name="l00722"></a>00722         <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip;
<a name="l00723"></a>00723         
<a name="l00724"></a>00724         <span class="comment">/* create meta-strips from the continuous chains of selected strips */</span>
<a name="l00725"></a>00725         <a class="code" href="../../d9/de6/BKE__nla_8h.html#a116c0ccd57c84cafd821c1a5752abdea">BKE_nlastrips_make_metas</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, 0);
<a name="l00726"></a>00726         
<a name="l00727"></a>00727         <span class="comment">/* name the metas */</span>
<a name="l00728"></a>00728         <span class="keywordflow">for</span> (strip= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip= strip-&gt;next) {
<a name="l00729"></a>00729             <span class="comment">/* auto-name this strip if selected (that means it is a meta) */</span>
<a name="l00730"></a>00730             <span class="keywordflow">if</span> (strip-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a86b1827bba79c6683cdbeb6b1b4799e5">NLASTRIP_FLAG_SELECT</a>)
<a name="l00731"></a>00731                 <a class="code" href="../../d9/de6/BKE__nla_8h.html#a3dc48bd590f3e9bde0afb153cf6901f4">BKE_nlastrip_validate_name</a>(adt, strip);
<a name="l00732"></a>00732         }
<a name="l00733"></a>00733     }
<a name="l00734"></a>00734     
<a name="l00735"></a>00735     <span class="comment">/* free temp data */</span>
<a name="l00736"></a>00736     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00737"></a>00737     
<a name="l00738"></a>00738     <span class="comment">/* set notifier that things have changed */</span>
<a name="l00739"></a>00739     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00740"></a>00740     
<a name="l00741"></a>00741     <span class="comment">/* done */</span>
<a name="l00742"></a>00742     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00743"></a>00743 }
<a name="l00744"></a>00744 
<a name="l00745"></a><a class="code" href="../../da/d37/nla__intern_8h.html#a596ee80d463ceb3149307039857e49d7">00745</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a596ee80d463ceb3149307039857e49d7">NLA_OT_meta_add</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00746"></a>00746 {
<a name="l00747"></a>00747     <span class="comment">/* identifiers */</span>
<a name="l00748"></a>00748     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Meta-Strips&quot;</span>;
<a name="l00749"></a>00749     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_meta_add&quot;</span>;
<a name="l00750"></a>00750     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Add new meta-strips incorporating the selected strips&quot;</span>;
<a name="l00751"></a>00751     
<a name="l00752"></a>00752     <span class="comment">/* api callbacks */</span>
<a name="l00753"></a>00753     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#ab234123f057970cc47e703b423a7286e">nlaedit_add_meta_exec</a>;
<a name="l00754"></a>00754     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>;
<a name="l00755"></a>00755     
<a name="l00756"></a>00756     <span class="comment">/* flags */</span>
<a name="l00757"></a>00757     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00758"></a>00758 }
<a name="l00759"></a>00759 
<a name="l00760"></a>00760 <span class="comment">/* ******************** Remove Meta-Strip Operator ***************************** */</span>
<a name="l00761"></a>00761 <span class="comment">/* Separate out the strips held by the selected meta-strips */</span>
<a name="l00762"></a>00762 
<a name="l00763"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#aedf8a25e1ee314874844d3f314e9b0c6">00763</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#aedf8a25e1ee314874844d3f314e9b0c6">nlaedit_remove_meta_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00764"></a>00764 {
<a name="l00765"></a>00765     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00766"></a>00766     
<a name="l00767"></a>00767     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00768"></a>00768     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00769"></a>00769     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00770"></a>00770     
<a name="l00771"></a>00771     <span class="comment">/* get editor data */</span>
<a name="l00772"></a>00772     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00773"></a>00773         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00774"></a>00774     
<a name="l00775"></a>00775     <span class="comment">/* get a list of the editable tracks being shown in the NLA */</span>
<a name="l00776"></a>00776     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l00777"></a>00777     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00778"></a>00778     
<a name="l00779"></a>00779     <span class="comment">/* for each track, find pairs of strips to add transitions to */</span>
<a name="l00780"></a>00780     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00781"></a>00781         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l00782"></a>00782         
<a name="l00783"></a>00783         <span class="comment">/* clear all selected meta-strips, regardless of whether they are temporary or not */</span>
<a name="l00784"></a>00784         <a class="code" href="../../d9/de6/BKE__nla_8h.html#a195e7c97865195c81abc1c4b13cc1f59">BKE_nlastrips_clear_metas</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, 1, 0);
<a name="l00785"></a>00785     }
<a name="l00786"></a>00786     
<a name="l00787"></a>00787     <span class="comment">/* free temp data */</span>
<a name="l00788"></a>00788     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00789"></a>00789     
<a name="l00790"></a>00790     <span class="comment">/* set notifier that things have changed */</span>
<a name="l00791"></a>00791     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00792"></a>00792     
<a name="l00793"></a>00793     <span class="comment">/* done */</span>
<a name="l00794"></a>00794     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00795"></a>00795 }
<a name="l00796"></a>00796 
<a name="l00797"></a><a class="code" href="../../da/d37/nla__intern_8h.html#a61170af2bef7097cfe2e68248a0d12f7">00797</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a61170af2bef7097cfe2e68248a0d12f7">NLA_OT_meta_remove</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00798"></a>00798 {
<a name="l00799"></a>00799     <span class="comment">/* identifiers */</span>
<a name="l00800"></a>00800     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Remove Meta-Strips&quot;</span>;
<a name="l00801"></a>00801     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_meta_remove&quot;</span>;
<a name="l00802"></a>00802     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Separate out the strips held by the selected meta-strips&quot;</span>;
<a name="l00803"></a>00803     
<a name="l00804"></a>00804     <span class="comment">/* api callbacks */</span>
<a name="l00805"></a>00805     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#aedf8a25e1ee314874844d3f314e9b0c6">nlaedit_remove_meta_exec</a>;
<a name="l00806"></a>00806     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>;
<a name="l00807"></a>00807     
<a name="l00808"></a>00808     <span class="comment">/* flags */</span>
<a name="l00809"></a>00809     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00810"></a>00810 }
<a name="l00811"></a>00811 
<a name="l00812"></a>00812 <span class="comment">/* ******************** Duplicate Strips Operator ************************** */</span>
<a name="l00813"></a>00813 <span class="comment">/* Duplicates the selected NLA-Strips, putting them on new tracks above the one</span>
<a name="l00814"></a>00814 <span class="comment"> * the originals were housed in.</span>
<a name="l00815"></a>00815 <span class="comment"> */</span>
<a name="l00816"></a>00816  
<a name="l00817"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a53af026301ca9322a8efe43e466938f4">00817</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a53af026301ca9322a8efe43e466938f4">nlaedit_duplicate_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00818"></a>00818 {
<a name="l00819"></a>00819     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00820"></a>00820     
<a name="l00821"></a>00821     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00822"></a>00822     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00823"></a>00823     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00824"></a>00824     
<a name="l00825"></a>00825     <span class="keywordtype">short</span> done = 0;
<a name="l00826"></a>00826     
<a name="l00827"></a>00827     <span class="comment">/* get editor data */</span>
<a name="l00828"></a>00828     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00829"></a>00829         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00830"></a>00830         
<a name="l00831"></a>00831     <span class="comment">/* get a list of editable tracks being shown in the NLA */</span>
<a name="l00832"></a>00832     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l00833"></a>00833     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00834"></a>00834     
<a name="l00835"></a>00835     <span class="comment">/* duplicate strips in tracks starting from the last one so that we&#39;re </span>
<a name="l00836"></a>00836 <span class="comment">     * less likely to duplicate strips we just duplicated...</span>
<a name="l00837"></a>00837 <span class="comment">     */</span>
<a name="l00838"></a>00838     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac7e4d957243061388808a861705e210d">prev</a>) {
<a name="l00839"></a>00839         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l00840"></a>00840         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>;
<a name="l00841"></a>00841         <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip, *nstrip, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l00842"></a>00842         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *track;
<a name="l00843"></a>00843         
<a name="l00844"></a>00844         for (strip= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip= <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>) {
<a name="l00845"></a>00845             <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>= strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a0e1bf52d90da905fbab053178c869a8e">next</a>;
<a name="l00846"></a>00846             
<a name="l00847"></a>00847             <span class="comment">/* if selected, split the strip at its midpoint */</span>
<a name="l00848"></a>00848             <span class="keywordflow">if</span> (strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a38c39284c9b83acf3c582ca956ded9d1">flag</a> &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a86b1827bba79c6683cdbeb6b1b4799e5">NLASTRIP_FLAG_SELECT</a>) {
<a name="l00849"></a>00849                 <span class="comment">/* make a copy (assume that this is possible) */</span>
<a name="l00850"></a>00850                 nstrip= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab724547257209551fc5a46059f73fec1">copy_nlastrip</a>(strip);
<a name="l00851"></a>00851                 
<a name="l00852"></a>00852                 <span class="comment">/* in case there&#39;s no space in the track above, or we haven&#39;t got a reference to it yet, try adding */</span>
<a name="l00853"></a>00853                 <span class="keywordflow">if</span> (<a class="code" href="../../d9/de6/BKE__nla_8h.html#a15ed3c0b4de96436ec6938f4a2aae230">BKE_nlatrack_add_strip</a>(nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a66180948e7084122081dfb79b212764c">next</a>, nstrip) == 0) {
<a name="l00854"></a>00854                     <span class="comment">/* need to add a new track above the one above the current one</span>
<a name="l00855"></a>00855 <span class="comment">                     *  - if the current one is the last one, nlt-&gt;next will be NULL, which defaults to adding </span>
<a name="l00856"></a>00856 <span class="comment">                     *    at the top of the stack anyway...</span>
<a name="l00857"></a>00857 <span class="comment">                     */</span>
<a name="l00858"></a>00858                     track= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ade883909faa615e4f9aa88de3686d3ce">add_nlatrack</a>(adt, nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a66180948e7084122081dfb79b212764c">next</a>);
<a name="l00859"></a>00859                     <a class="code" href="../../d9/de6/BKE__nla_8h.html#a15ed3c0b4de96436ec6938f4a2aae230">BKE_nlatrack_add_strip</a>(track, nstrip);
<a name="l00860"></a>00860                 }
<a name="l00861"></a>00861                 
<a name="l00862"></a>00862                 <span class="comment">/* deselect the original and the active flag */</span>
<a name="l00863"></a>00863                 strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a38c39284c9b83acf3c582ca956ded9d1">flag</a> &amp;= ~(<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a86b1827bba79c6683cdbeb6b1b4799e5">NLASTRIP_FLAG_SELECT</a>|<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a11b77f0bda6fb63b936acc20b58496ac">NLASTRIP_FLAG_ACTIVE</a>);
<a name="l00864"></a>00864                 
<a name="l00865"></a>00865                 <span class="comment">/* auto-name newly created strip */</span>
<a name="l00866"></a>00866                 <a class="code" href="../../d9/de6/BKE__nla_8h.html#a3dc48bd590f3e9bde0afb153cf6901f4">BKE_nlastrip_validate_name</a>(adt, nstrip);
<a name="l00867"></a>00867                 
<a name="l00868"></a>00868                 done++;
<a name="l00869"></a>00869             }
<a name="l00870"></a>00870         }
<a name="l00871"></a>00871     }
<a name="l00872"></a>00872     
<a name="l00873"></a>00873     <span class="comment">/* free temp data */</span>
<a name="l00874"></a>00874     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00875"></a>00875     
<a name="l00876"></a>00876     <span class="keywordflow">if</span> (done) {
<a name="l00877"></a>00877         <span class="comment">/* refresh auto strip properties */</span>
<a name="l00878"></a>00878         <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a38612f440a01805e8b230908e5a97c8f">ED_nla_postop_refresh</a>(&amp;ac);
<a name="l00879"></a>00879         
<a name="l00880"></a>00880         <span class="comment">/* set notifier that things have changed */</span>
<a name="l00881"></a>00881         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00882"></a>00882         
<a name="l00883"></a>00883         <span class="comment">/* done */</span>
<a name="l00884"></a>00884         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00885"></a>00885     }
<a name="l00886"></a>00886     <span class="keywordflow">else</span>
<a name="l00887"></a>00887         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00888"></a>00888 }
<a name="l00889"></a>00889 
<a name="l00890"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#abf26a85e4535015c8197fa5211474a55">00890</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#abf26a85e4535015c8197fa5211474a55">nlaedit_duplicate_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l00891"></a>00891 {
<a name="l00892"></a>00892     <a class="code" href="../../d3/d31/nla__edit_8c.html#a53af026301ca9322a8efe43e466938f4">nlaedit_duplicate_exec</a>(C, op);
<a name="l00893"></a>00893     
<a name="l00894"></a>00894     <a class="code" href="../../d3/d10/rna__access_8c.html#ad70d450cec9fe951de69b8c9128b8cc4">RNA_enum_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;mode&quot;</span>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84ac6708d3325ae542bd46d599286c1cf90">TFM_TRANSLATION</a>);
<a name="l00895"></a>00895     <a class="code" href="../../df/db0/wm__event__system_8c.html#a0208cd65e2ce6a150f2653214cfc57dd">WM_operator_name_call</a>(C, <span class="stringliteral">&quot;TRANSFORM_OT_transform&quot;</span>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39a0a4b36fb214cf9c59486cd041c118bd6">WM_OP_INVOKE_REGION_WIN</a>, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>);
<a name="l00896"></a>00896 
<a name="l00897"></a>00897     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00898"></a>00898 }
<a name="l00899"></a>00899 
<a name="l00900"></a><a class="code" href="../../da/d37/nla__intern_8h.html#ac211d46ebbba38ef1c1e90eddb011be2">00900</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#ac211d46ebbba38ef1c1e90eddb011be2">NLA_OT_duplicate</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00901"></a>00901 {
<a name="l00902"></a>00902     <span class="comment">/* identifiers */</span>
<a name="l00903"></a>00903     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Duplicate Strips&quot;</span>;
<a name="l00904"></a>00904     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_duplicate&quot;</span>;
<a name="l00905"></a>00905     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Duplicate selected NLA-Strips, adding the new strips in new tracks above the originals&quot;</span>;
<a name="l00906"></a>00906     
<a name="l00907"></a>00907     <span class="comment">/* api callbacks */</span>
<a name="l00908"></a>00908     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#abf26a85e4535015c8197fa5211474a55">nlaedit_duplicate_invoke</a>;
<a name="l00909"></a>00909     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#a53af026301ca9322a8efe43e466938f4">nlaedit_duplicate_exec</a>;
<a name="l00910"></a>00910     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>;
<a name="l00911"></a>00911     
<a name="l00912"></a>00912     <span class="comment">/* flags */</span>
<a name="l00913"></a>00913     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00914"></a>00914     
<a name="l00915"></a>00915     <span class="comment">/* to give to transform */</span>
<a name="l00916"></a>00916     <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;mode&quot;</span>, <a class="code" href="../../d3/d0f/transform__ops_8c.html#a0cc49fe43d3d0f938a1fc45c4cae96af">transform_mode_types</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84ac6708d3325ae542bd46d599286c1cf90">TFM_TRANSLATION</a>, <span class="stringliteral">&quot;Mode&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00917"></a>00917 }
<a name="l00918"></a>00918 
<a name="l00919"></a>00919 <span class="comment">/* ******************** Delete Strips Operator ***************************** */</span>
<a name="l00920"></a>00920 <span class="comment">/* Deletes the selected NLA-Strips */</span>
<a name="l00921"></a>00921 
<a name="l00922"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#ac1e3e22b61228a4746a46c82262b6a2e">00922</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#ac1e3e22b61228a4746a46c82262b6a2e">nlaedit_delete_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00923"></a>00923 {
<a name="l00924"></a>00924     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00925"></a>00925     
<a name="l00926"></a>00926     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00927"></a>00927     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00928"></a>00928     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00929"></a>00929     
<a name="l00930"></a>00930     <span class="comment">/* get editor data */</span>
<a name="l00931"></a>00931     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00932"></a>00932         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00933"></a>00933         
<a name="l00934"></a>00934     <span class="comment">/* get a list of the editable tracks being shown in the NLA */</span>
<a name="l00935"></a>00935     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l00936"></a>00936     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00937"></a>00937     
<a name="l00938"></a>00938     <span class="comment">/* for each NLA-Track, delete all selected strips */</span>
<a name="l00939"></a>00939     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00940"></a>00940         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l00941"></a>00941         <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip, *nstrip;
<a name="l00942"></a>00942         
<a name="l00943"></a>00943         for (strip= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip= nstrip) {
<a name="l00944"></a>00944             nstrip= strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a0e1bf52d90da905fbab053178c869a8e">next</a>;
<a name="l00945"></a>00945             
<a name="l00946"></a>00946             <span class="comment">/* if selected, delete */</span>
<a name="l00947"></a>00947             <span class="keywordflow">if</span> (strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a38c39284c9b83acf3c582ca956ded9d1">flag</a> &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a86b1827bba79c6683cdbeb6b1b4799e5">NLASTRIP_FLAG_SELECT</a>) {
<a name="l00948"></a>00948                 <span class="comment">/* if a strip either side of this was a transition, delete those too */</span>
<a name="l00949"></a>00949                 <span class="keywordflow">if</span> ((strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ace28c520f4fe04f5d37bc26f40f3c2d6">prev</a>) &amp;&amp; (strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ace28c520f4fe04f5d37bc26f40f3c2d6">prev</a>-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a25fb6e5c5f8719f65f416f509751b0ca">type</a> == <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#abddb46a0c18f6964b5dcec7f2de51b55a507ee0ba236e46280991034c41d9b61a">NLASTRIP_TYPE_TRANSITION</a>)) 
<a name="l00950"></a>00950                     <a class="code" href="../../d9/de6/BKE__nla_8h.html#a9c17a5e4c234227445423938413224a2">free_nlastrip</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ace28c520f4fe04f5d37bc26f40f3c2d6">prev</a>);
<a name="l00951"></a>00951                 <span class="keywordflow">if</span> ((nstrip) &amp;&amp; (nstrip-&gt;type == <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#abddb46a0c18f6964b5dcec7f2de51b55a507ee0ba236e46280991034c41d9b61a">NLASTRIP_TYPE_TRANSITION</a>)) {
<a name="l00952"></a>00952                     nstrip= nstrip-&gt;next;
<a name="l00953"></a>00953                     <a class="code" href="../../d9/de6/BKE__nla_8h.html#a9c17a5e4c234227445423938413224a2">free_nlastrip</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a0e1bf52d90da905fbab053178c869a8e">next</a>);
<a name="l00954"></a>00954                 }
<a name="l00955"></a>00955                 
<a name="l00956"></a>00956                 <span class="comment">/* finally, delete this strip */</span>
<a name="l00957"></a>00957                 <a class="code" href="../../d9/de6/BKE__nla_8h.html#a9c17a5e4c234227445423938413224a2">free_nlastrip</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, strip);
<a name="l00958"></a>00958             }
<a name="l00959"></a>00959         }
<a name="l00960"></a>00960     }
<a name="l00961"></a>00961     
<a name="l00962"></a>00962     <span class="comment">/* free temp data */</span>
<a name="l00963"></a>00963     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00964"></a>00964     
<a name="l00965"></a>00965     <span class="comment">/* refresh auto strip properties */</span>
<a name="l00966"></a>00966     <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a38612f440a01805e8b230908e5a97c8f">ED_nla_postop_refresh</a>(&amp;ac);
<a name="l00967"></a>00967     
<a name="l00968"></a>00968     <span class="comment">/* set notifier that things have changed */</span>
<a name="l00969"></a>00969     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00970"></a>00970     
<a name="l00971"></a>00971     <span class="comment">/* done */</span>
<a name="l00972"></a>00972     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00973"></a>00973 }
<a name="l00974"></a>00974 
<a name="l00975"></a><a class="code" href="../../da/d37/nla__intern_8h.html#a8f480a8f454ba837af5a5e22ae4e87d7">00975</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a8f480a8f454ba837af5a5e22ae4e87d7">NLA_OT_delete</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00976"></a>00976 {
<a name="l00977"></a>00977     <span class="comment">/* identifiers */</span>
<a name="l00978"></a>00978     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Delete Strips&quot;</span>;
<a name="l00979"></a>00979     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_delete&quot;</span>;
<a name="l00980"></a>00980     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Delete selected strips&quot;</span>;
<a name="l00981"></a>00981     
<a name="l00982"></a>00982     <span class="comment">/* api callbacks */</span>
<a name="l00983"></a>00983     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#ac1e3e22b61228a4746a46c82262b6a2e">nlaedit_delete_exec</a>;
<a name="l00984"></a>00984     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>;
<a name="l00985"></a>00985     
<a name="l00986"></a>00986     <span class="comment">/* flags */</span>
<a name="l00987"></a>00987     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00988"></a>00988 }
<a name="l00989"></a>00989 
<a name="l00990"></a>00990 <span class="comment">/* ******************** Split Strips Operator ***************************** */</span>
<a name="l00991"></a>00991 <span class="comment">/* Splits the selected NLA-Strips into two strips at the midpoint of the strip */</span>
<a name="l00992"></a>00992 <span class="comment">// TODO&#39;s? </span>
<a name="l00993"></a>00993 <span class="comment">//  - multiple splits</span>
<a name="l00994"></a>00994 <span class="comment">//  - variable-length splits?</span>
<a name="l00995"></a>00995 
<a name="l00996"></a>00996 <span class="comment">/* split a given Action-Clip strip */</span>
<a name="l00997"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a1d93ad3a08f3d2dc49f621f497f66b5c">00997</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a1d93ad3a08f3d2dc49f621f497f66b5c">nlaedit_split_strip_actclip</a> (<a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt, <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt, <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip, <span class="keywordtype">float</span> cfra)
<a name="l00998"></a>00998 {
<a name="l00999"></a>00999     <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *nstrip;
<a name="l01000"></a>01000     <span class="keywordtype">float</span> splitframe, splitaframe;
<a name="l01001"></a>01001     
<a name="l01002"></a>01002     <span class="comment">/* calculate the frames to do the splitting at </span>
<a name="l01003"></a>01003 <span class="comment">     *  - use current frame if within extents of strip </span>
<a name="l01004"></a>01004 <span class="comment">     */</span>
<a name="l01005"></a>01005     <span class="keywordflow">if</span> ((cfra &gt; strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ae2094c7a1fbf3ace399a32ec093c4fd5">start</a>) &amp;&amp; (cfra &lt; strip-&gt;end)) {
<a name="l01006"></a>01006         <span class="comment">/* use the current frame */</span>
<a name="l01007"></a>01007         splitframe= cfra;
<a name="l01008"></a>01008         splitaframe= <a class="code" href="../../db/dee/nla_8c.html#a014bad290540943f0a8b701539da0dd1">nlastrip_get_frame</a>(strip, cfra, <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035dad6f4c7caaf2b3ab5e648419d521cfc9e">NLATIME_CONVERT_UNMAP</a>);
<a name="l01009"></a>01009     }
<a name="l01010"></a>01010     <span class="keywordflow">else</span> {
<a name="l01011"></a>01011         <span class="comment">/* split in the middle */</span>
<a name="l01012"></a>01012         <span class="keywordtype">float</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l01013"></a>01013             
<a name="l01014"></a>01014             <span class="comment">/* strip extents */</span>
<a name="l01015"></a>01015         len= strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a8d7f4a18c61cd0cac5cbe8a344e875a1">end</a> - strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ae2094c7a1fbf3ace399a32ec093c4fd5">start</a>;
<a name="l01016"></a>01016         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#acc074658bb6b51cde503721347a81b33">IS_EQF</a>(len, 0.0f))
<a name="l01017"></a>01017             <span class="keywordflow">return</span>;
<a name="l01018"></a>01018         <span class="keywordflow">else</span>
<a name="l01019"></a>01019             splitframe= strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ae2094c7a1fbf3ace399a32ec093c4fd5">start</a> + (len / 2.0f);
<a name="l01020"></a>01020             
<a name="l01021"></a>01021             <span class="comment">/* action range */</span>
<a name="l01022"></a>01022         len= strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#aa701a7e948622bb5e5759c1491e43578">actend</a> - strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a014e33eeecd527bc006b4229cdf7ea72">actstart</a>;
<a name="l01023"></a>01023         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#acc074658bb6b51cde503721347a81b33">IS_EQF</a>(len, 0.0f))
<a name="l01024"></a>01024             splitaframe= strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#aa701a7e948622bb5e5759c1491e43578">actend</a>;
<a name="l01025"></a>01025         <span class="keywordflow">else</span>
<a name="l01026"></a>01026             splitaframe= strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a014e33eeecd527bc006b4229cdf7ea72">actstart</a> + (len / 2.0f);
<a name="l01027"></a>01027     }
<a name="l01028"></a>01028     
<a name="l01029"></a>01029     <span class="comment">/* make a copy (assume that this is possible) and append</span>
<a name="l01030"></a>01030 <span class="comment">     * it immediately after the current strip</span>
<a name="l01031"></a>01031 <span class="comment">     */</span>
<a name="l01032"></a>01032     nstrip= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab724547257209551fc5a46059f73fec1">copy_nlastrip</a>(strip);
<a name="l01033"></a>01033     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a9c299678f8810312806da26e6132ccc7">BLI_insertlinkafter</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, strip, nstrip);
<a name="l01034"></a>01034     
<a name="l01035"></a>01035     <span class="comment">/* set the endpoint of the first strip and the start of the new strip </span>
<a name="l01036"></a>01036 <span class="comment">     * to the splitframe values calculated above</span>
<a name="l01037"></a>01037 <span class="comment">     */</span>
<a name="l01038"></a>01038     strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a8d7f4a18c61cd0cac5cbe8a344e875a1">end</a>= splitframe;
<a name="l01039"></a>01039     nstrip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ae2094c7a1fbf3ace399a32ec093c4fd5">start</a>= splitframe;
<a name="l01040"></a>01040     
<a name="l01041"></a>01041     <span class="keywordflow">if</span> ((splitaframe &gt; strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a014e33eeecd527bc006b4229cdf7ea72">actstart</a>) &amp;&amp; (splitaframe &lt; strip-&gt;actend)) {
<a name="l01042"></a>01042         <span class="comment">/* only do this if we&#39;re splitting down the middle...  */</span>
<a name="l01043"></a>01043         strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#aa701a7e948622bb5e5759c1491e43578">actend</a>= splitaframe;
<a name="l01044"></a>01044         nstrip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a014e33eeecd527bc006b4229cdf7ea72">actstart</a>= splitaframe;
<a name="l01045"></a>01045     }
<a name="l01046"></a>01046     
<a name="l01047"></a>01047     <span class="comment">/* clear the active flag from the copy */</span>
<a name="l01048"></a>01048     nstrip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a38c39284c9b83acf3c582ca956ded9d1">flag</a> &amp;= ~<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a11b77f0bda6fb63b936acc20b58496ac">NLASTRIP_FLAG_ACTIVE</a>;
<a name="l01049"></a>01049     
<a name="l01050"></a>01050     <span class="comment">/* auto-name the new strip */</span>
<a name="l01051"></a>01051     <a class="code" href="../../d9/de6/BKE__nla_8h.html#a3dc48bd590f3e9bde0afb153cf6901f4">BKE_nlastrip_validate_name</a>(adt, nstrip);
<a name="l01052"></a>01052 }
<a name="l01053"></a>01053 
<a name="l01054"></a>01054 <span class="comment">/* split a given Meta strip */</span>
<a name="l01055"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a84957f36880c109b86a7aa28585c3f88">01055</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a84957f36880c109b86a7aa28585c3f88">nlaedit_split_strip_meta</a> (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt, <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip)
<a name="l01056"></a>01056 {
<a name="l01057"></a>01057     <span class="comment">/* simply ungroup it for now...  */</span>
<a name="l01058"></a>01058     <a class="code" href="../../d9/de6/BKE__nla_8h.html#a03ca282d2bd3c62f71cc20c7e24b544b">BKE_nlastrips_clear_metastrip</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, strip);
<a name="l01059"></a>01059 }
<a name="l01060"></a>01060 
<a name="l01061"></a>01061 <span class="comment">/* ----- */</span>
<a name="l01062"></a>01062 
<a name="l01063"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a67d7a3cc43d221b319b2d2910a732b1f">01063</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a67d7a3cc43d221b319b2d2910a732b1f">nlaedit_split_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l01064"></a>01064 {
<a name="l01065"></a>01065     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01066"></a>01066     
<a name="l01067"></a>01067     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01068"></a>01068     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l01069"></a>01069     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l01070"></a>01070     
<a name="l01071"></a>01071     <span class="comment">/* get editor data */</span>
<a name="l01072"></a>01072     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01073"></a>01073         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01074"></a>01074         
<a name="l01075"></a>01075     <span class="comment">/* get a list of editable tracks being shown in the NLA */</span>
<a name="l01076"></a>01076     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l01077"></a>01077     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l01078"></a>01078     
<a name="l01079"></a>01079     <span class="comment">/* for each NLA-Track, split all selected strips into two strips */</span>
<a name="l01080"></a>01080     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l01081"></a>01081         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l01082"></a>01082         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>;
<a name="l01083"></a>01083         <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l01084"></a>01084         
<a name="l01085"></a>01085         for (strip= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip= <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>) {
<a name="l01086"></a>01086             <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>= strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a0e1bf52d90da905fbab053178c869a8e">next</a>;
<a name="l01087"></a>01087             
<a name="l01088"></a>01088             <span class="comment">/* if selected, split the strip at its midpoint */</span>
<a name="l01089"></a>01089             <span class="keywordflow">if</span> (strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a38c39284c9b83acf3c582ca956ded9d1">flag</a> &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a86b1827bba79c6683cdbeb6b1b4799e5">NLASTRIP_FLAG_SELECT</a>) {
<a name="l01090"></a>01090                 <span class="comment">/* splitting method depends on the type of strip */</span>
<a name="l01091"></a>01091                 <span class="keywordflow">switch</span> (strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a25fb6e5c5f8719f65f416f509751b0ca">type</a>) {
<a name="l01092"></a>01092                     <span class="keywordflow">case</span> <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#abddb46a0c18f6964b5dcec7f2de51b55aea70130d952e36e417d38704d3299339">NLASTRIP_TYPE_CLIP</a>: <span class="comment">/* action-clip */</span>
<a name="l01093"></a>01093                         <a class="code" href="../../d3/d31/nla__edit_8c.html#a1d93ad3a08f3d2dc49f621f497f66b5c">nlaedit_split_strip_actclip</a>(adt, nlt, strip, (<span class="keywordtype">float</span>)ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a>);
<a name="l01094"></a>01094                         <span class="keywordflow">break</span>;
<a name="l01095"></a>01095                         
<a name="l01096"></a>01096                     <span class="keywordflow">case</span> <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#abddb46a0c18f6964b5dcec7f2de51b55a330575a46d56bc5ce45afa8b6b7d5bb2">NLASTRIP_TYPE_META</a>: <span class="comment">/* meta-strips need special handling */</span>
<a name="l01097"></a>01097                         <a class="code" href="../../d3/d31/nla__edit_8c.html#a84957f36880c109b86a7aa28585c3f88">nlaedit_split_strip_meta</a>(nlt, strip);
<a name="l01098"></a>01098                         <span class="keywordflow">break</span>;
<a name="l01099"></a>01099                     
<a name="l01100"></a>01100                     <span class="keywordflow">default</span>: <span class="comment">/* for things like Transitions, do not split! */</span>
<a name="l01101"></a>01101                         <span class="keywordflow">break</span>;
<a name="l01102"></a>01102                 }
<a name="l01103"></a>01103             }
<a name="l01104"></a>01104         }
<a name="l01105"></a>01105     }
<a name="l01106"></a>01106     
<a name="l01107"></a>01107     <span class="comment">/* free temp data */</span>
<a name="l01108"></a>01108     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01109"></a>01109     
<a name="l01110"></a>01110     <span class="comment">/* refresh auto strip properties */</span>
<a name="l01111"></a>01111     <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a38612f440a01805e8b230908e5a97c8f">ED_nla_postop_refresh</a>(&amp;ac);
<a name="l01112"></a>01112     
<a name="l01113"></a>01113     <span class="comment">/* set notifier that things have changed */</span>
<a name="l01114"></a>01114     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01115"></a>01115     
<a name="l01116"></a>01116     <span class="comment">/* done */</span>
<a name="l01117"></a>01117     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01118"></a>01118 }
<a name="l01119"></a>01119 
<a name="l01120"></a><a class="code" href="../../da/d37/nla__intern_8h.html#a2829435dd122301346f8e8930e339928">01120</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a2829435dd122301346f8e8930e339928">NLA_OT_split</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01121"></a>01121 {
<a name="l01122"></a>01122     <span class="comment">/* identifiers */</span>
<a name="l01123"></a>01123     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Split Strips&quot;</span>;
<a name="l01124"></a>01124     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_split&quot;</span>;
<a name="l01125"></a>01125     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Split selected strips at their midpoints&quot;</span>;
<a name="l01126"></a>01126     
<a name="l01127"></a>01127     <span class="comment">/* api callbacks */</span>
<a name="l01128"></a>01128     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#a67d7a3cc43d221b319b2d2910a732b1f">nlaedit_split_exec</a>;
<a name="l01129"></a>01129     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>;
<a name="l01130"></a>01130     
<a name="l01131"></a>01131     <span class="comment">/* flags */</span>
<a name="l01132"></a>01132     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01133"></a>01133 }
<a name="l01134"></a>01134 
<a name="l01135"></a>01135 <span class="comment">/* ******************** Bake Strips Operator ***************************** */</span>
<a name="l01136"></a>01136 <span class="comment">/* Bakes the NLA Strips for the active AnimData blocks */</span>
<a name="l01137"></a>01137 
<a name="l01138"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a86d1be255d7e88a3517c181ffb33901a">01138</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a86d1be255d7e88a3517c181ffb33901a">nlaedit_bake_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l01139"></a>01139 {
<a name="l01140"></a>01140     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01141"></a>01141     
<a name="l01142"></a>01142     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01143"></a>01143     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l01144"></a>01144     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l01145"></a>01145 <span class="comment">//  int flag = 0;</span>
<a name="l01146"></a>01146     
<a name="l01147"></a>01147     <span class="comment">/* get editor data */</span>
<a name="l01148"></a>01148     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01149"></a>01149         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01150"></a>01150         
<a name="l01151"></a>01151     <span class="comment">/* get a list of the editable tracks being shown in the NLA */</span>
<a name="l01152"></a>01152     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a4e398ad453b0cbff2de76253616fd334">ANIMFILTER_ANIMDATA</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l01153"></a>01153     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l01154"></a>01154     
<a name="l01155"></a>01155     <span class="comment">/* for each AnimData block, bake strips to animdata... */</span>
<a name="l01156"></a>01156     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l01157"></a>01157         <span class="comment">//BKE_nla_bake(ac.scene, ale-&gt;id, ale-&gt;data, flag);</span>
<a name="l01158"></a>01158     }
<a name="l01159"></a>01159     
<a name="l01160"></a>01160     <span class="comment">/* free temp data */</span>
<a name="l01161"></a>01161     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01162"></a>01162     
<a name="l01163"></a>01163     <span class="comment">/* refresh auto strip properties */</span>
<a name="l01164"></a>01164     <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a38612f440a01805e8b230908e5a97c8f">ED_nla_postop_refresh</a>(&amp;ac);
<a name="l01165"></a>01165     
<a name="l01166"></a>01166     <span class="comment">/* set notifier that things have changed */</span>
<a name="l01167"></a>01167     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01168"></a>01168     
<a name="l01169"></a>01169     <span class="comment">/* done */</span>
<a name="l01170"></a>01170     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01171"></a>01171 }
<a name="l01172"></a>01172 
<a name="l01173"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a17c4b3f41dbe8572c28d88869682096f">01173</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a17c4b3f41dbe8572c28d88869682096f">NLA_OT_bake</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01174"></a>01174 {
<a name="l01175"></a>01175     <span class="comment">/* identifiers */</span>
<a name="l01176"></a>01176     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Bake Strips&quot;</span>;
<a name="l01177"></a>01177     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_bake&quot;</span>;
<a name="l01178"></a>01178     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Bake all strips of selected AnimData blocks&quot;</span>;
<a name="l01179"></a>01179     
<a name="l01180"></a>01180     <span class="comment">/* api callbacks */</span>
<a name="l01181"></a>01181     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#a86d1be255d7e88a3517c181ffb33901a">nlaedit_bake_exec</a>;
<a name="l01182"></a>01182     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>;
<a name="l01183"></a>01183     
<a name="l01184"></a>01184     <span class="comment">/* flags */</span>
<a name="l01185"></a>01185     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01186"></a>01186 }
<a name="l01187"></a>01187 
<a name="l01188"></a>01188 <span class="comment">/* *********************************************** */</span>
<a name="l01189"></a>01189 <span class="comment">/* NLA Editing Operations (Modifying) */</span>
<a name="l01190"></a>01190 
<a name="l01191"></a>01191 <span class="comment">/* ******************** Toggle Muting Operator ************************** */</span>
<a name="l01192"></a>01192 <span class="comment">/* Toggles whether strips are muted or not */</span>
<a name="l01193"></a>01193 
<a name="l01194"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#af0994a31937b8575d7db91ed5c860fc1">01194</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#af0994a31937b8575d7db91ed5c860fc1">nlaedit_toggle_mute_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l01195"></a>01195 {
<a name="l01196"></a>01196     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01197"></a>01197     
<a name="l01198"></a>01198     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01199"></a>01199     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l01200"></a>01200     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l01201"></a>01201     
<a name="l01202"></a>01202     <span class="comment">/* get editor data */</span>
<a name="l01203"></a>01203     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01204"></a>01204         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01205"></a>01205         
<a name="l01206"></a>01206     <span class="comment">/* get a list of the editable tracks being shown in the NLA */</span>
<a name="l01207"></a>01207     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l01208"></a>01208     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l01209"></a>01209     
<a name="l01210"></a>01210     <span class="comment">/* go over all selected strips */</span>
<a name="l01211"></a>01211     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l01212"></a>01212         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l01213"></a>01213         <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip;
<a name="l01214"></a>01214         
<a name="l01215"></a>01215         <span class="comment">/* for every selected strip, toggle muting  */</span>
<a name="l01216"></a>01216         for (strip= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip= strip-&gt;next) {
<a name="l01217"></a>01217             <span class="keywordflow">if</span> (strip-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a86b1827bba79c6683cdbeb6b1b4799e5">NLASTRIP_FLAG_SELECT</a>) {
<a name="l01218"></a>01218                 <span class="comment">/* just flip the mute flag for now */</span>
<a name="l01219"></a>01219                 <span class="comment">// TODO: have a pre-pass to check if mute all or unmute all?</span>
<a name="l01220"></a>01220                 strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a38c39284c9b83acf3c582ca956ded9d1">flag</a> ^= <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a61116637b8face428895a0d7d1a47943">NLASTRIP_FLAG_MUTED</a>;
<a name="l01221"></a>01221             }
<a name="l01222"></a>01222         }
<a name="l01223"></a>01223     }
<a name="l01224"></a>01224     
<a name="l01225"></a>01225     <span class="comment">/* free temp data */</span>
<a name="l01226"></a>01226     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01227"></a>01227     
<a name="l01228"></a>01228     <span class="comment">/* set notifier that things have changed */</span>
<a name="l01229"></a>01229     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01230"></a>01230     
<a name="l01231"></a>01231     <span class="comment">/* done */</span>
<a name="l01232"></a>01232     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01233"></a>01233 }
<a name="l01234"></a>01234 
<a name="l01235"></a><a class="code" href="../../da/d37/nla__intern_8h.html#a7d1bcc63a1330e01b3076d41a0614e76">01235</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a7d1bcc63a1330e01b3076d41a0614e76">NLA_OT_mute_toggle</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01236"></a>01236 {
<a name="l01237"></a>01237     <span class="comment">/* identifiers */</span>
<a name="l01238"></a>01238     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Toggle Muting&quot;</span>;
<a name="l01239"></a>01239     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_mute_toggle&quot;</span>;
<a name="l01240"></a>01240     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Mute or un-mute selected strips&quot;</span>;
<a name="l01241"></a>01241     
<a name="l01242"></a>01242     <span class="comment">/* api callbacks */</span>
<a name="l01243"></a>01243     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#af0994a31937b8575d7db91ed5c860fc1">nlaedit_toggle_mute_exec</a>;
<a name="l01244"></a>01244     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>;
<a name="l01245"></a>01245     
<a name="l01246"></a>01246     <span class="comment">/* flags */</span>
<a name="l01247"></a>01247     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01248"></a>01248 }
<a name="l01249"></a>01249 
<a name="l01250"></a>01250 <span class="comment">/* ******************** Swap Strips Operator ************************** */</span>
<a name="l01251"></a>01251 <span class="comment">/* Tries to exchange strips within their owner tracks */</span>
<a name="l01252"></a>01252 
<a name="l01253"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#aea8f667d23733a07db1582c9017f2903">01253</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#aea8f667d23733a07db1582c9017f2903">nlaedit_swap_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01254"></a>01254 {
<a name="l01255"></a>01255     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01256"></a>01256     
<a name="l01257"></a>01257     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01258"></a>01258     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l01259"></a>01259     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l01260"></a>01260     
<a name="l01261"></a>01261     <span class="comment">/* get editor data */</span>
<a name="l01262"></a>01262     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01263"></a>01263         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01264"></a>01264         
<a name="l01265"></a>01265     <span class="comment">/* get a list of the editable tracks being shown in the NLA */</span>
<a name="l01266"></a>01266     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l01267"></a>01267     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l01268"></a>01268     
<a name="l01269"></a>01269     <span class="comment">/* consider each track in turn */</span>
<a name="l01270"></a>01270     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l01271"></a>01271         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l01272"></a>01272         
<a name="l01273"></a>01273         <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip, *stripN=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01274"></a>01274         <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *sa=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *sb=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01275"></a>01275         
<a name="l01276"></a>01276         <span class="comment">/* make temporary metastrips so that entire islands of selections can be moved around */</span>
<a name="l01277"></a>01277         <a class="code" href="../../d9/de6/BKE__nla_8h.html#a116c0ccd57c84cafd821c1a5752abdea">BKE_nlastrips_make_metas</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, 1);
<a name="l01278"></a>01278         
<a name="l01279"></a>01279         <span class="comment">/* special case: if there is only 1 island (i.e. temp meta BUT NOT unselected/normal/normal-meta strips) left after this, </span>
<a name="l01280"></a>01280 <span class="comment">         * and this island has two strips inside it, then we should be able to just swap these still...</span>
<a name="l01281"></a>01281 <span class="comment">         */</span>
<a name="l01282"></a>01282         <span class="keywordflow">if</span> ((nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>) &amp;&amp; (nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {
<a name="l01283"></a>01283             <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *mstrip = (<a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *)nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01284"></a>01284             
<a name="l01285"></a>01285             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> ((mstrip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a38c39284c9b83acf3c582ca956ded9d1">flag</a> &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a44376ba8584e916a87fddb2ec469f62e">NLASTRIP_FLAG_TEMP_META</a>) &amp;&amp; (<a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aa3b37105a0793ac30946a6d220ee97d7">BLI_countlist</a>(&amp;mstrip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a9cc3337843773f5b953893c79784044d">strips</a>) == 2)) {
<a name="l01286"></a>01286                 <span class="comment">/* remove this temp meta, so that we can see the strips inside */</span>
<a name="l01287"></a>01287                 <a class="code" href="../../d9/de6/BKE__nla_8h.html#a195e7c97865195c81abc1c4b13cc1f59">BKE_nlastrips_clear_metas</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, 0, 1);
<a name="l01288"></a>01288             }
<a name="l01289"></a>01289         }
<a name="l01290"></a>01290         
<a name="l01291"></a>01291         <span class="comment">/* get two selected strips only (these will be metas due to prev step) to operate on</span>
<a name="l01292"></a>01292 <span class="comment">         *  - only allow swapping 2, as with more the context becomes unclear</span>
<a name="l01293"></a>01293 <span class="comment">         */</span>
<a name="l01294"></a>01294         <span class="keywordflow">for</span> (strip = nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip = stripN) {
<a name="l01295"></a>01295             stripN = strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a0e1bf52d90da905fbab053178c869a8e">next</a>;
<a name="l01296"></a>01296             
<a name="l01297"></a>01297             <span class="keywordflow">if</span> (strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a38c39284c9b83acf3c582ca956ded9d1">flag</a> &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a86b1827bba79c6683cdbeb6b1b4799e5">NLASTRIP_FLAG_SELECT</a>) {
<a name="l01298"></a>01298                 <span class="comment">/* first or second strip? */</span>
<a name="l01299"></a>01299                 <span class="keywordflow">if</span> (sa == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01300"></a>01300                     <span class="comment">/* store as first */</span>
<a name="l01301"></a>01301                     sa = strip;
<a name="l01302"></a>01302                 }
<a name="l01303"></a>01303                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sb == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01304"></a>01304                     <span class="comment">/* store as second */</span>
<a name="l01305"></a>01305                     sb = strip;
<a name="l01306"></a>01306                 }
<a name="l01307"></a>01307                 <span class="keywordflow">else</span> {
<a name="l01308"></a>01308                     <span class="comment">/* too many selected */</span>
<a name="l01309"></a>01309                     <span class="keywordflow">break</span>;
<a name="l01310"></a>01310                 }
<a name="l01311"></a>01311             }
<a name="l01312"></a>01312         }
<a name="l01313"></a>01313         
<a name="l01314"></a>01314         <span class="keywordflow">if</span> (strip) {
<a name="l01315"></a>01315             <span class="comment">/* too many selected warning */</span>
<a name="l01316"></a>01316             <a class="code" href="../../d2/d40/BKE__report_8h.html#af25c247b3b620d13cef87ec2bed1698e">BKE_reportf</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68aa7428e90bb3916896145e5eb14a7dd7b">RPT_WARNING</a>, 
<a name="l01317"></a>01317                 <span class="stringliteral">&quot;Too many clusters of strips selected in NLA Track (%s): needs exactly 2 to be selected&quot;</span>,
<a name="l01318"></a>01318                 nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a9db0526fede88fb6cd696bac97c3a860">name</a>);
<a name="l01319"></a>01319         }
<a name="l01320"></a>01320         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sa == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01321"></a>01321             <span class="comment">/* no warning as this is just a common case, and it may get annoying when doing multiple tracks */</span>
<a name="l01322"></a>01322         }
<a name="l01323"></a>01323         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sb == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01324"></a>01324             <span class="comment">/* too few selected warning */</span>
<a name="l01325"></a>01325             <a class="code" href="../../d2/d40/BKE__report_8h.html#af25c247b3b620d13cef87ec2bed1698e">BKE_reportf</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68aa7428e90bb3916896145e5eb14a7dd7b">RPT_WARNING</a>,
<a name="l01326"></a>01326                 <span class="stringliteral">&quot;Too few clusters of strips selected in NLA Track (%s): needs exactly 2 to be selected&quot;</span>,
<a name="l01327"></a>01327                 nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a9db0526fede88fb6cd696bac97c3a860">name</a>);
<a name="l01328"></a>01328         }
<a name="l01329"></a>01329         <span class="keywordflow">else</span> {
<a name="l01330"></a>01330             <span class="keywordtype">float</span> nsa[2], nsb[2];
<a name="l01331"></a>01331             
<a name="l01332"></a>01332             <span class="comment">/* remove these strips from the track, so that we can test if they can fit in the proposed places */</span>
<a name="l01333"></a>01333             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, sa);
<a name="l01334"></a>01334             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, sb);
<a name="l01335"></a>01335             
<a name="l01336"></a>01336             <span class="comment">/* calculate new extents for strips */</span>
<a name="l01337"></a>01337                 <span class="comment">/* a --&gt; b */</span>
<a name="l01338"></a>01338             nsa[0] = sb-&gt;start;
<a name="l01339"></a>01339             nsa[1] = sb-&gt;start + (sa-&gt;end - sa-&gt;start);
<a name="l01340"></a>01340                 <span class="comment">/* b --&gt; a */</span>
<a name="l01341"></a>01341             nsb[0] = sa-&gt;start;
<a name="l01342"></a>01342             nsb[1] = sa-&gt;start + (sb-&gt;end - sb-&gt;start);
<a name="l01343"></a>01343             
<a name="l01344"></a>01344             <span class="comment">/* check if the track has room for the strips to be swapped */</span>
<a name="l01345"></a>01345             <span class="keywordflow">if</span> (<a class="code" href="../../d9/de6/BKE__nla_8h.html#a20bf0f1c3b2ec0b847f34e8b1b3abaf8">BKE_nlastrips_has_space</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, nsa[0], nsa[1]) &amp;&amp; 
<a name="l01346"></a>01346                 <a class="code" href="../../d9/de6/BKE__nla_8h.html#a20bf0f1c3b2ec0b847f34e8b1b3abaf8">BKE_nlastrips_has_space</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, nsb[0], nsb[1]))
<a name="l01347"></a>01347             {
<a name="l01348"></a>01348                 <span class="comment">/* set new extents for strips then */</span>
<a name="l01349"></a>01349                 sa-&gt;start = nsa[0];
<a name="l01350"></a>01350                 sa-&gt;end   = nsa[1];
<a name="l01351"></a>01351                 <a class="code" href="../../d9/de6/BKE__nla_8h.html#a5edf5738ee03c2158b209b897ab673d2">BKE_nlameta_flush_transforms</a>(sa);
<a name="l01352"></a>01352                 
<a name="l01353"></a>01353                 sb-&gt;start = nsb[0];
<a name="l01354"></a>01354                 sb-&gt;end   = nsb[1];
<a name="l01355"></a>01355                 <a class="code" href="../../d9/de6/BKE__nla_8h.html#a5edf5738ee03c2158b209b897ab673d2">BKE_nlameta_flush_transforms</a>(sb);
<a name="l01356"></a>01356             }
<a name="l01357"></a>01357             <span class="keywordflow">else</span> {
<a name="l01358"></a>01358                 <span class="comment">/* not enough room to swap, so show message */</span>
<a name="l01359"></a>01359                 <span class="keywordflow">if</span> ((sa-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a44376ba8584e916a87fddb2ec469f62e">NLASTRIP_FLAG_TEMP_META</a>) || (sb-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a44376ba8584e916a87fddb2ec469f62e">NLASTRIP_FLAG_TEMP_META</a>)) {
<a name="l01360"></a>01360                     <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68aa7428e90bb3916896145e5eb14a7dd7b">RPT_WARNING</a>,
<a name="l01361"></a>01361                         <span class="stringliteral">&quot;Cannot swap selected strips as they will not be able to fit in their new places&quot;</span>);
<a name="l01362"></a>01362                 }
<a name="l01363"></a>01363                 <span class="keywordflow">else</span> {
<a name="l01364"></a>01364                     <a class="code" href="../../d2/d40/BKE__report_8h.html#af25c247b3b620d13cef87ec2bed1698e">BKE_reportf</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68aa7428e90bb3916896145e5eb14a7dd7b">RPT_WARNING</a>,   
<a name="l01365"></a>01365                         <span class="stringliteral">&quot;Cannot swap &#39;%s&#39; and &#39;%s&#39; as one or both will not be able to fit in their new places&quot;</span>,
<a name="l01366"></a>01366                         sa-&gt;name, sb-&gt;name);
<a name="l01367"></a>01367                 }
<a name="l01368"></a>01368             }
<a name="l01369"></a>01369             
<a name="l01370"></a>01370             <span class="comment">/* add strips back to track now */</span>
<a name="l01371"></a>01371             <a class="code" href="../../d9/de6/BKE__nla_8h.html#a15ed3c0b4de96436ec6938f4a2aae230">BKE_nlatrack_add_strip</a>(nlt, sa);
<a name="l01372"></a>01372             <a class="code" href="../../d9/de6/BKE__nla_8h.html#a15ed3c0b4de96436ec6938f4a2aae230">BKE_nlatrack_add_strip</a>(nlt, sb);
<a name="l01373"></a>01373         }
<a name="l01374"></a>01374         
<a name="l01375"></a>01375         <span class="comment">/* clear (temp) metastrips */</span>
<a name="l01376"></a>01376         <a class="code" href="../../d9/de6/BKE__nla_8h.html#a195e7c97865195c81abc1c4b13cc1f59">BKE_nlastrips_clear_metas</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, 0, 1);
<a name="l01377"></a>01377     }
<a name="l01378"></a>01378     
<a name="l01379"></a>01379     <span class="comment">/* free temp data */</span>
<a name="l01380"></a>01380     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01381"></a>01381     
<a name="l01382"></a>01382     <span class="comment">/* refresh auto strip properties */</span>
<a name="l01383"></a>01383     <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a38612f440a01805e8b230908e5a97c8f">ED_nla_postop_refresh</a>(&amp;ac);
<a name="l01384"></a>01384     
<a name="l01385"></a>01385     <span class="comment">/* set notifier that things have changed */</span>
<a name="l01386"></a>01386     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01387"></a>01387     
<a name="l01388"></a>01388     <span class="comment">/* done */</span>
<a name="l01389"></a>01389     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01390"></a>01390 }
<a name="l01391"></a>01391 
<a name="l01392"></a><a class="code" href="../../da/d37/nla__intern_8h.html#a6b89317cb921abdb512c06836ee5736f">01392</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a6b89317cb921abdb512c06836ee5736f">NLA_OT_swap</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01393"></a>01393 {
<a name="l01394"></a>01394     <span class="comment">/* identifiers */</span>
<a name="l01395"></a>01395     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Swap Strips&quot;</span>;
<a name="l01396"></a>01396     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_swap&quot;</span>;
<a name="l01397"></a>01397     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Swap order of selected strips within tracks&quot;</span>;
<a name="l01398"></a>01398     
<a name="l01399"></a>01399     <span class="comment">/* api callbacks */</span>
<a name="l01400"></a>01400     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#aea8f667d23733a07db1582c9017f2903">nlaedit_swap_exec</a>;
<a name="l01401"></a>01401     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>;
<a name="l01402"></a>01402     
<a name="l01403"></a>01403     <span class="comment">/* flags */</span>
<a name="l01404"></a>01404     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01405"></a>01405 }
<a name="l01406"></a>01406 
<a name="l01407"></a>01407 <span class="comment">/* ******************** Move Strips Up Operator ************************** */</span>
<a name="l01408"></a>01408 <span class="comment">/* Tries to move the selected strips into the track above if possible. */</span>
<a name="l01409"></a>01409 
<a name="l01410"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a249df89614aa43de6b58536402f31d6d">01410</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a249df89614aa43de6b58536402f31d6d">nlaedit_move_up_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l01411"></a>01411 {
<a name="l01412"></a>01412     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01413"></a>01413     
<a name="l01414"></a>01414     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01415"></a>01415     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l01416"></a>01416     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l01417"></a>01417     
<a name="l01418"></a>01418     <span class="comment">/* get editor data */</span>
<a name="l01419"></a>01419     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01420"></a>01420         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01421"></a>01421         
<a name="l01422"></a>01422     <span class="comment">/* get a list of the editable tracks being shown in the NLA */</span>
<a name="l01423"></a>01423     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l01424"></a>01424     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l01425"></a>01425     
<a name="l01426"></a>01426     <span class="comment">/* since we&#39;re potentially moving strips from lower tracks to higher tracks, we should</span>
<a name="l01427"></a>01427 <span class="comment">     * loop over the tracks in reverse order to avoid moving earlier strips up multiple tracks</span>
<a name="l01428"></a>01428 <span class="comment">     */</span>
<a name="l01429"></a>01429     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac7e4d957243061388808a861705e210d">prev</a>) {
<a name="l01430"></a>01430         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l01431"></a>01431         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nltn= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a66180948e7084122081dfb79b212764c">next</a>;
<a name="l01432"></a>01432         <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip, *stripn;
<a name="l01433"></a>01433         
<a name="l01434"></a>01434         <span class="comment">/* if this track has no tracks after it, skip for now... */</span>
<a name="l01435"></a>01435         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (nltn == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01436"></a>01436             <span class="keywordflow">continue</span>;
<a name="l01437"></a>01437         
<a name="l01438"></a>01438         <span class="comment">/* for every selected strip, try to move */</span>
<a name="l01439"></a>01439         <span class="keywordflow">for</span> (strip= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip= stripn) {
<a name="l01440"></a>01440             stripn= strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a0e1bf52d90da905fbab053178c869a8e">next</a>;
<a name="l01441"></a>01441             
<a name="l01442"></a>01442             <span class="keywordflow">if</span> (strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a38c39284c9b83acf3c582ca956ded9d1">flag</a> &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a86b1827bba79c6683cdbeb6b1b4799e5">NLASTRIP_FLAG_SELECT</a>) {
<a name="l01443"></a>01443                 <span class="comment">/* check if the track above has room for this strip */</span>
<a name="l01444"></a>01444                 <span class="keywordflow">if</span> (<a class="code" href="../../d9/de6/BKE__nla_8h.html#ac3eceb4053efcd15a8acc3ca4f9b16b9">BKE_nlatrack_has_space</a>(nltn, strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ae2094c7a1fbf3ace399a32ec093c4fd5">start</a>, strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a8d7f4a18c61cd0cac5cbe8a344e875a1">end</a>)) {
<a name="l01445"></a>01445                     <span class="comment">/* remove from its current track, and add to the one above (it &#39;should&#39; work, so no need to worry) */</span>
<a name="l01446"></a>01446                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, strip);
<a name="l01447"></a>01447                     <a class="code" href="../../d9/de6/BKE__nla_8h.html#a15ed3c0b4de96436ec6938f4a2aae230">BKE_nlatrack_add_strip</a>(nltn, strip);
<a name="l01448"></a>01448                 }
<a name="l01449"></a>01449             }
<a name="l01450"></a>01450         }
<a name="l01451"></a>01451     }
<a name="l01452"></a>01452     
<a name="l01453"></a>01453     <span class="comment">/* free temp data */</span>
<a name="l01454"></a>01454     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01455"></a>01455     
<a name="l01456"></a>01456     <span class="comment">/* refresh auto strip properties */</span>
<a name="l01457"></a>01457     <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a38612f440a01805e8b230908e5a97c8f">ED_nla_postop_refresh</a>(&amp;ac);
<a name="l01458"></a>01458     
<a name="l01459"></a>01459     <span class="comment">/* set notifier that things have changed */</span>
<a name="l01460"></a>01460     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01461"></a>01461     
<a name="l01462"></a>01462     <span class="comment">/* done */</span>
<a name="l01463"></a>01463     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01464"></a>01464 }
<a name="l01465"></a>01465 
<a name="l01466"></a><a class="code" href="../../da/d37/nla__intern_8h.html#a7fd0ef371532795e7a7089116934c42c">01466</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a7fd0ef371532795e7a7089116934c42c">NLA_OT_move_up</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01467"></a>01467 {
<a name="l01468"></a>01468     <span class="comment">/* identifiers */</span>
<a name="l01469"></a>01469     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Move Strips Up&quot;</span>;
<a name="l01470"></a>01470     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_move_up&quot;</span>;
<a name="l01471"></a>01471     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Move selected strips up a track if there&#39;s room&quot;</span>;
<a name="l01472"></a>01472     
<a name="l01473"></a>01473     <span class="comment">/* api callbacks */</span>
<a name="l01474"></a>01474     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#a249df89614aa43de6b58536402f31d6d">nlaedit_move_up_exec</a>;
<a name="l01475"></a>01475     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>;
<a name="l01476"></a>01476     
<a name="l01477"></a>01477     <span class="comment">/* flags */</span>
<a name="l01478"></a>01478     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01479"></a>01479 }
<a name="l01480"></a>01480 
<a name="l01481"></a>01481 <span class="comment">/* ******************** Move Strips Down Operator ************************** */</span>
<a name="l01482"></a>01482 <span class="comment">/* Tries to move the selected strips into the track above if possible. */</span>
<a name="l01483"></a>01483 
<a name="l01484"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#ad2cf7c5496a8695114dac1cb56d332e3">01484</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#ad2cf7c5496a8695114dac1cb56d332e3">nlaedit_move_down_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l01485"></a>01485 {
<a name="l01486"></a>01486     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01487"></a>01487     
<a name="l01488"></a>01488     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01489"></a>01489     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l01490"></a>01490     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l01491"></a>01491     
<a name="l01492"></a>01492     <span class="comment">/* get editor data */</span>
<a name="l01493"></a>01493     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01494"></a>01494         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01495"></a>01495         
<a name="l01496"></a>01496     <span class="comment">/* get a list of the editable tracks being shown in the NLA */</span>
<a name="l01497"></a>01497     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l01498"></a>01498     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l01499"></a>01499     
<a name="l01500"></a>01500     <span class="comment">/* loop through the tracks in normal order, since we&#39;re pushing strips down,</span>
<a name="l01501"></a>01501 <span class="comment">     * strips won&#39;t get operated on twice</span>
<a name="l01502"></a>01502 <span class="comment">     */</span>
<a name="l01503"></a>01503     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l01504"></a>01504         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l01505"></a>01505         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nltp= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#aaa379eff1cc66ad0eeed63f3e19efe08">prev</a>;
<a name="l01506"></a>01506         <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip, *stripn;
<a name="l01507"></a>01507         
<a name="l01508"></a>01508         <span class="comment">/* if this track has no tracks before it, skip for now... */</span>
<a name="l01509"></a>01509         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (nltp == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01510"></a>01510             <span class="keywordflow">continue</span>;
<a name="l01511"></a>01511         
<a name="l01512"></a>01512         <span class="comment">/* for every selected strip, try to move */</span>
<a name="l01513"></a>01513         <span class="keywordflow">for</span> (strip= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip= stripn) {
<a name="l01514"></a>01514             stripn= strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a0e1bf52d90da905fbab053178c869a8e">next</a>;
<a name="l01515"></a>01515             
<a name="l01516"></a>01516             <span class="keywordflow">if</span> (strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a38c39284c9b83acf3c582ca956ded9d1">flag</a> &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a86b1827bba79c6683cdbeb6b1b4799e5">NLASTRIP_FLAG_SELECT</a>) {
<a name="l01517"></a>01517                 <span class="comment">/* check if the track below has room for this strip */</span>
<a name="l01518"></a>01518                 <span class="keywordflow">if</span> (<a class="code" href="../../d9/de6/BKE__nla_8h.html#ac3eceb4053efcd15a8acc3ca4f9b16b9">BKE_nlatrack_has_space</a>(nltp, strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ae2094c7a1fbf3ace399a32ec093c4fd5">start</a>, strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a8d7f4a18c61cd0cac5cbe8a344e875a1">end</a>)) {
<a name="l01519"></a>01519                     <span class="comment">/* remove from its current track, and add to the one above (it &#39;should&#39; work, so no need to worry) */</span>
<a name="l01520"></a>01520                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, strip);
<a name="l01521"></a>01521                     <a class="code" href="../../d9/de6/BKE__nla_8h.html#a15ed3c0b4de96436ec6938f4a2aae230">BKE_nlatrack_add_strip</a>(nltp, strip);
<a name="l01522"></a>01522                 }
<a name="l01523"></a>01523             }
<a name="l01524"></a>01524         }
<a name="l01525"></a>01525     }
<a name="l01526"></a>01526     
<a name="l01527"></a>01527     <span class="comment">/* free temp data */</span>
<a name="l01528"></a>01528     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01529"></a>01529     
<a name="l01530"></a>01530     <span class="comment">/* refresh auto strip properties */</span>
<a name="l01531"></a>01531     <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a38612f440a01805e8b230908e5a97c8f">ED_nla_postop_refresh</a>(&amp;ac);
<a name="l01532"></a>01532     
<a name="l01533"></a>01533     <span class="comment">/* set notifier that things have changed */</span>
<a name="l01534"></a>01534     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01535"></a>01535     
<a name="l01536"></a>01536     <span class="comment">/* done */</span>
<a name="l01537"></a>01537     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01538"></a>01538 }
<a name="l01539"></a>01539 
<a name="l01540"></a><a class="code" href="../../da/d37/nla__intern_8h.html#a9e4a443070f1f95c7e2dc38255ac32f2">01540</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a9e4a443070f1f95c7e2dc38255ac32f2">NLA_OT_move_down</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01541"></a>01541 {
<a name="l01542"></a>01542     <span class="comment">/* identifiers */</span>
<a name="l01543"></a>01543     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Move Strips Down&quot;</span>;
<a name="l01544"></a>01544     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_move_down&quot;</span>;
<a name="l01545"></a>01545     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Move selected strips down a track if there&#39;s room&quot;</span>;
<a name="l01546"></a>01546     
<a name="l01547"></a>01547     <span class="comment">/* api callbacks */</span>
<a name="l01548"></a>01548     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#ad2cf7c5496a8695114dac1cb56d332e3">nlaedit_move_down_exec</a>;
<a name="l01549"></a>01549     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>;
<a name="l01550"></a>01550     
<a name="l01551"></a>01551     <span class="comment">/* flags */</span>
<a name="l01552"></a>01552     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01553"></a>01553 }
<a name="l01554"></a>01554 
<a name="l01555"></a>01555 <span class="comment">/* ******************** Sync Action Length Operator ***************************** */</span>
<a name="l01556"></a>01556 <span class="comment">/* Recalculate the extents of the action ranges used for the selected strips  */</span>
<a name="l01557"></a>01557 
<a name="l01558"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a1b3f18fefae3d89c260ba83d962ffaea">01558</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a1b3f18fefae3d89c260ba83d962ffaea">nlaedit_sync_actlen_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01559"></a>01559 {
<a name="l01560"></a>01560     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01561"></a>01561     
<a name="l01562"></a>01562     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01563"></a>01563     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l01564"></a>01564     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l01565"></a>01565     <span class="keywordtype">short</span> active_only= <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;active&quot;</span>);
<a name="l01566"></a>01566     
<a name="l01567"></a>01567     <span class="comment">/* get editor data */</span>
<a name="l01568"></a>01568     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01569"></a>01569         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01570"></a>01570         
<a name="l01571"></a>01571     <span class="comment">/* get a list of the editable tracks being shown in the NLA */</span>
<a name="l01572"></a>01572     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l01573"></a>01573     <span class="keywordflow">if</span> (active_only) filter |= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a14ccbd8e983dd0fb6fa15416e2f91d57">ANIMFILTER_ACTIVE</a>;
<a name="l01574"></a>01574     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l01575"></a>01575     
<a name="l01576"></a>01576     <span class="comment">/* for each NLA-Track, apply scale of all selected strips */</span>
<a name="l01577"></a>01577     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l01578"></a>01578         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l01579"></a>01579         <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip;
<a name="l01580"></a>01580         
<a name="l01581"></a>01581         for (strip= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip= strip-&gt;next) {
<a name="l01582"></a>01582             <span class="comment">/* strip selection/active status check */</span>
<a name="l01583"></a>01583             <span class="keywordflow">if</span> (active_only) {
<a name="l01584"></a>01584                 <span class="keywordflow">if</span> ((strip-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a11b77f0bda6fb63b936acc20b58496ac">NLASTRIP_FLAG_ACTIVE</a>) == 0)
<a name="l01585"></a>01585                     <span class="keywordflow">continue</span>;
<a name="l01586"></a>01586             }
<a name="l01587"></a>01587             <span class="keywordflow">else</span> {
<a name="l01588"></a>01588                 <span class="keywordflow">if</span> ((strip-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a86b1827bba79c6683cdbeb6b1b4799e5">NLASTRIP_FLAG_SELECT</a>) == 0)
<a name="l01589"></a>01589                     <span class="keywordflow">continue</span>;
<a name="l01590"></a>01590             }
<a name="l01591"></a>01591             
<a name="l01592"></a>01592             <span class="comment">/* must be action-clip only (transitions don&#39;t have scale) */</span>
<a name="l01593"></a>01593             <span class="keywordflow">if</span> (strip-&gt;type == <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#abddb46a0c18f6964b5dcec7f2de51b55aea70130d952e36e417d38704d3299339">NLASTRIP_TYPE_CLIP</a>) {
<a name="l01594"></a>01594                 <span class="keywordflow">if</span> (strip-&gt;act == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) 
<a name="l01595"></a>01595                     <span class="keywordflow">continue</span>;
<a name="l01596"></a>01596                     
<a name="l01597"></a>01597                 <span class="comment">/* recalculate the length of the action */</span>
<a name="l01598"></a>01598                 <a class="code" href="../../d8/df5/BKE__action_8h.html#a6dd77f727bc29b2d0f031af51605915c">calc_action_range</a>(strip-&gt;act, &amp;strip-&gt;actstart, &amp;strip-&gt;actend, 0);
<a name="l01599"></a>01599                 
<a name="l01600"></a>01600                 <span class="comment">/* adjust the strip extents in response to this */</span>
<a name="l01601"></a>01601                 <a class="code" href="../../d9/de6/BKE__nla_8h.html#a5f1e18201a523a9f4183bb3c5bb1b7b9">BKE_nlastrip_recalculate_bounds</a>(strip);
<a name="l01602"></a>01602             }
<a name="l01603"></a>01603         }
<a name="l01604"></a>01604     }
<a name="l01605"></a>01605     
<a name="l01606"></a>01606     <span class="comment">/* free temp data */</span>
<a name="l01607"></a>01607     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01608"></a>01608     
<a name="l01609"></a>01609     <span class="comment">/* set notifier that things have changed */</span>
<a name="l01610"></a>01610     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01611"></a>01611     
<a name="l01612"></a>01612     <span class="comment">/* done */</span>
<a name="l01613"></a>01613     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01614"></a>01614 }
<a name="l01615"></a>01615 
<a name="l01616"></a><a class="code" href="../../da/d37/nla__intern_8h.html#ae2ebae5cdbf497424b72c0a5efe6113b">01616</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#ae2ebae5cdbf497424b72c0a5efe6113b">NLA_OT_action_sync_length</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01617"></a>01617 {
<a name="l01618"></a>01618     <span class="comment">/* identifiers */</span>
<a name="l01619"></a>01619     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Sync Action Length&quot;</span>;
<a name="l01620"></a>01620     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_action_sync_length&quot;</span>;
<a name="l01621"></a>01621     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Synchronize the length of the referenced Action with the length used in the strip&quot;</span>;
<a name="l01622"></a>01622     
<a name="l01623"></a>01623     <span class="comment">/* api callbacks */</span>
<a name="l01624"></a>01624     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#a1b3f18fefae3d89c260ba83d962ffaea">nlaedit_sync_actlen_exec</a>;
<a name="l01625"></a>01625     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a5ef52597df2373ca8e4e332cc9291c60">ED_operator_nla_active</a>; <span class="comment">// XXX: is this satisfactory... probably requires a check for active strip...</span>
<a name="l01626"></a>01626     
<a name="l01627"></a>01627     <span class="comment">/* flags */</span>
<a name="l01628"></a>01628     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01629"></a>01629     
<a name="l01630"></a>01630     <span class="comment">/* properties */</span>
<a name="l01631"></a>01631     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;active&quot;</span>, 1, <span class="stringliteral">&quot;Active Strip Only&quot;</span>, <span class="stringliteral">&quot;Only sync the active length for the active strip&quot;</span>);
<a name="l01632"></a>01632 }
<a name="l01633"></a>01633 
<a name="l01634"></a>01634 <span class="comment">/* ******************** Apply Scale Operator ***************************** */</span>
<a name="l01635"></a>01635 <span class="comment">/* Reset the scaling of the selected strips to 1.0f */</span>
<a name="l01636"></a>01636 
<a name="l01637"></a>01637 <span class="comment">/* apply scaling to keyframe */</span>
<a name="l01638"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#afb799a9f988fd2b7746f2da2f0da6edd">01638</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#afb799a9f988fd2b7746f2da2f0da6edd">bezt_apply_nlamapping</a> (<a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> *ked, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt)
<a name="l01639"></a>01639 {
<a name="l01640"></a>01640     <span class="comment">/* NLA-strip which has this scaling is stored in ked-&gt;data */</span>
<a name="l01641"></a>01641     <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip= (<a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *)ked-&gt;<a class="code" href="../../d5/d01/structKeyframeEditData.html#a501b1376c86503e0138fcd41e59df925">data</a>;
<a name="l01642"></a>01642     
<a name="l01643"></a>01643     <span class="comment">/* adjust all the times */</span>
<a name="l01644"></a>01644     bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0][0]= <a class="code" href="../../db/dee/nla_8c.html#a014bad290540943f0a8b701539da0dd1">nlastrip_get_frame</a>(strip, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0][0], <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035da67b7b4a040b6e4341cfbb48b51f8dcc3">NLATIME_CONVERT_MAP</a>);
<a name="l01645"></a>01645     bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][0]= <a class="code" href="../../db/dee/nla_8c.html#a014bad290540943f0a8b701539da0dd1">nlastrip_get_frame</a>(strip, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][0], <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035da67b7b4a040b6e4341cfbb48b51f8dcc3">NLATIME_CONVERT_MAP</a>);
<a name="l01646"></a>01646     bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2][0]= <a class="code" href="../../db/dee/nla_8c.html#a014bad290540943f0a8b701539da0dd1">nlastrip_get_frame</a>(strip, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2][0], <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035da67b7b4a040b6e4341cfbb48b51f8dcc3">NLATIME_CONVERT_MAP</a>);
<a name="l01647"></a>01647     
<a name="l01648"></a>01648     <span class="comment">/* nothing to return or else we exit */</span>
<a name="l01649"></a>01649     <span class="keywordflow">return</span> 0;
<a name="l01650"></a>01650 }
<a name="l01651"></a>01651 
<a name="l01652"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#af65cb778c51f6b1efcadb2458190d74a">01652</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#af65cb778c51f6b1efcadb2458190d74a">nlaedit_apply_scale_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l01653"></a>01653 {
<a name="l01654"></a>01654     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01655"></a>01655     
<a name="l01656"></a>01656     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01657"></a>01657     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l01658"></a>01658     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l01659"></a>01659     
<a name="l01660"></a>01660     <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked= {{<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}};
<a name="l01661"></a>01661     
<a name="l01662"></a>01662     <span class="comment">/* get editor data */</span>
<a name="l01663"></a>01663     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01664"></a>01664         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01665"></a>01665         
<a name="l01666"></a>01666     <span class="comment">/* get a list of the editable tracks being shown in the NLA */</span>
<a name="l01667"></a>01667     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l01668"></a>01668     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l01669"></a>01669     
<a name="l01670"></a>01670     <span class="comment">/* init the editing data */</span>
<a name="l01671"></a>01671     
<a name="l01672"></a>01672     <span class="comment">/* for each NLA-Track, apply scale of all selected strips */</span>
<a name="l01673"></a>01673     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l01674"></a>01674         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l01675"></a>01675         <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip;
<a name="l01676"></a>01676         
<a name="l01677"></a>01677         for (strip= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip= strip-&gt;next) {
<a name="l01678"></a>01678             <span class="comment">/* strip must be selected, and must be action-clip only (transitions don&#39;t have scale) */</span>
<a name="l01679"></a>01679             <span class="keywordflow">if</span> ((strip-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a86b1827bba79c6683cdbeb6b1b4799e5">NLASTRIP_FLAG_SELECT</a>) &amp;&amp; (strip-&gt;type == <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#abddb46a0c18f6964b5dcec7f2de51b55aea70130d952e36e417d38704d3299339">NLASTRIP_TYPE_CLIP</a>)) {
<a name="l01680"></a>01680                 <span class="comment">/* if the referenced action is used by other strips, make this strip use its own copy */</span>
<a name="l01681"></a>01681                 <span class="keywordflow">if</span> (strip-&gt;act == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) 
<a name="l01682"></a>01682                     <span class="keywordflow">continue</span>;
<a name="l01683"></a>01683                 <span class="keywordflow">if</span> (strip-&gt;act-&gt;id.us &gt; 1) {
<a name="l01684"></a>01684                     <span class="comment">/* make a copy of the Action to work on */</span>
<a name="l01685"></a>01685                     <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *act= <a class="code" href="../../d8/df5/BKE__action_8h.html#a2b3b7578e40afa786b725009fa9289d4">copy_action</a>(strip-&gt;act);
<a name="l01686"></a>01686                     
<a name="l01687"></a>01687                     <span class="comment">/* set this as the new referenced action, decrementing the users of the old one */</span>
<a name="l01688"></a>01688                     strip-&gt;act-&gt;id.us--;
<a name="l01689"></a>01689                     strip-&gt;act= act;
<a name="l01690"></a>01690                 }
<a name="l01691"></a>01691                 
<a name="l01692"></a>01692                 <span class="comment">/* setup iterator, and iterate over all the keyframes in the action, applying this scaling */</span>
<a name="l01693"></a>01693                 ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a501b1376c86503e0138fcd41e59df925">data</a>= strip;
<a name="l01694"></a>01694                 <a class="code" href="../../db/d71/keyframes__edit_8c.html#abde7bdbcee8cc1f72c1cf797a755f698">ANIM_animchanneldata_keyframes_loop</a>(&amp;ked, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a58e9368e226140c365269be25d531a8c">ads</a>, strip-&gt;act, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85ac1aa151cfcc7fa642d7c4c2fca27855b">ALE_ACT</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d3/d31/nla__edit_8c.html#afb799a9f988fd2b7746f2da2f0da6edd">bezt_apply_nlamapping</a>, <a class="code" href="../../da/dba/BKE__fcurve_8h.html#abb464452313d3795a48da7421069f9e3">calchandles_fcurve</a>);
<a name="l01695"></a>01695                 
<a name="l01696"></a>01696                 <span class="comment">/* clear scale of strip now that it has been applied,</span>
<a name="l01697"></a>01697 <span class="comment">                 * and recalculate the extents of the action now that it has been scaled</span>
<a name="l01698"></a>01698 <span class="comment">                 * but leave everything else alone </span>
<a name="l01699"></a>01699 <span class="comment">                 */</span>
<a name="l01700"></a>01700                 strip-&gt;scale= 1.0f;
<a name="l01701"></a>01701                 <a class="code" href="../../d8/df5/BKE__action_8h.html#a6dd77f727bc29b2d0f031af51605915c">calc_action_range</a>(strip-&gt;act, &amp;strip-&gt;actstart, &amp;strip-&gt;actend, 0);
<a name="l01702"></a>01702             }
<a name="l01703"></a>01703         }
<a name="l01704"></a>01704     }
<a name="l01705"></a>01705     
<a name="l01706"></a>01706     <span class="comment">/* free temp data */</span>
<a name="l01707"></a>01707     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01708"></a>01708     
<a name="l01709"></a>01709     <span class="comment">/* set notifier that things have changed */</span>
<a name="l01710"></a>01710     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01711"></a>01711     
<a name="l01712"></a>01712     <span class="comment">/* done */</span>
<a name="l01713"></a>01713     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01714"></a>01714 }
<a name="l01715"></a>01715 
<a name="l01716"></a><a class="code" href="../../da/d37/nla__intern_8h.html#af043d82cb878af58a756e1b783ad0fc9">01716</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#af043d82cb878af58a756e1b783ad0fc9">NLA_OT_apply_scale</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01717"></a>01717 {
<a name="l01718"></a>01718     <span class="comment">/* identifiers */</span>
<a name="l01719"></a>01719     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Apply Scale&quot;</span>;
<a name="l01720"></a>01720     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_apply_scale&quot;</span>;
<a name="l01721"></a>01721     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Apply scaling of selected strips to their referenced Actions&quot;</span>;
<a name="l01722"></a>01722     
<a name="l01723"></a>01723     <span class="comment">/* api callbacks */</span>
<a name="l01724"></a>01724     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#af65cb778c51f6b1efcadb2458190d74a">nlaedit_apply_scale_exec</a>;
<a name="l01725"></a>01725     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>;
<a name="l01726"></a>01726     
<a name="l01727"></a>01727     <span class="comment">/* flags */</span>
<a name="l01728"></a>01728     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01729"></a>01729 }
<a name="l01730"></a>01730 
<a name="l01731"></a>01731 <span class="comment">/* ******************** Clear Scale Operator ***************************** */</span>
<a name="l01732"></a>01732 <span class="comment">/* Reset the scaling of the selected strips to 1.0f */</span>
<a name="l01733"></a>01733 
<a name="l01734"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a3a982dc388ae1a665bf63b4efb60be72">01734</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a3a982dc388ae1a665bf63b4efb60be72">nlaedit_clear_scale_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l01735"></a>01735 {
<a name="l01736"></a>01736     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01737"></a>01737     
<a name="l01738"></a>01738     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01739"></a>01739     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l01740"></a>01740     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l01741"></a>01741     
<a name="l01742"></a>01742     <span class="comment">/* get editor data */</span>
<a name="l01743"></a>01743     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01744"></a>01744         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01745"></a>01745         
<a name="l01746"></a>01746     <span class="comment">/* get a list of the editable tracks being shown in the NLA */</span>
<a name="l01747"></a>01747     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l01748"></a>01748     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l01749"></a>01749     
<a name="l01750"></a>01750     <span class="comment">/* for each NLA-Track, reset scale of all selected strips */</span>
<a name="l01751"></a>01751     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l01752"></a>01752         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l01753"></a>01753         <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip;
<a name="l01754"></a>01754         
<a name="l01755"></a>01755         for (strip= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip= strip-&gt;next) {
<a name="l01756"></a>01756             <span class="comment">/* strip must be selected, and must be action-clip only (transitions don&#39;t have scale) */</span>
<a name="l01757"></a>01757             <span class="keywordflow">if</span> ((strip-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a86b1827bba79c6683cdbeb6b1b4799e5">NLASTRIP_FLAG_SELECT</a>) &amp;&amp; (strip-&gt;type == <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#abddb46a0c18f6964b5dcec7f2de51b55aea70130d952e36e417d38704d3299339">NLASTRIP_TYPE_CLIP</a>)) {
<a name="l01758"></a>01758                 <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> strip_ptr;
<a name="l01759"></a>01759                 
<a name="l01760"></a>01760                 <a class="code" href="../../d3/d10/rna__access_8c.html#a1f8fb80da9a6450a51ab2e9b97264f01">RNA_pointer_create</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#af756e7795471d4656788aae93617f074">RNA_NlaStrip</a>, strip, &amp;strip_ptr);
<a name="l01761"></a>01761                 <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(&amp;strip_ptr, <span class="stringliteral">&quot;scale&quot;</span>, 1.0f);
<a name="l01762"></a>01762             }
<a name="l01763"></a>01763         }
<a name="l01764"></a>01764     }
<a name="l01765"></a>01765     
<a name="l01766"></a>01766     <span class="comment">/* free temp data */</span>
<a name="l01767"></a>01767     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01768"></a>01768     
<a name="l01769"></a>01769     <span class="comment">/* refresh auto strip properties */</span>
<a name="l01770"></a>01770     <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a38612f440a01805e8b230908e5a97c8f">ED_nla_postop_refresh</a>(&amp;ac);
<a name="l01771"></a>01771     
<a name="l01772"></a>01772     <span class="comment">/* set notifier that things have changed */</span>
<a name="l01773"></a>01773     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01774"></a>01774     
<a name="l01775"></a>01775     <span class="comment">/* done */</span>
<a name="l01776"></a>01776     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01777"></a>01777 }
<a name="l01778"></a>01778 
<a name="l01779"></a><a class="code" href="../../da/d37/nla__intern_8h.html#a4a97d135b8323b8e0887914aee53e0e9">01779</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a4a97d135b8323b8e0887914aee53e0e9">NLA_OT_clear_scale</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01780"></a>01780 {
<a name="l01781"></a>01781     <span class="comment">/* identifiers */</span>
<a name="l01782"></a>01782     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Clear Scale&quot;</span>;
<a name="l01783"></a>01783     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_clear_scale&quot;</span>;
<a name="l01784"></a>01784     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Reset scaling of selected strips&quot;</span>;
<a name="l01785"></a>01785     
<a name="l01786"></a>01786     <span class="comment">/* api callbacks */</span>
<a name="l01787"></a>01787     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#a3a982dc388ae1a665bf63b4efb60be72">nlaedit_clear_scale_exec</a>;
<a name="l01788"></a>01788     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>;
<a name="l01789"></a>01789     
<a name="l01790"></a>01790     <span class="comment">/* flags */</span>
<a name="l01791"></a>01791     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01792"></a>01792 }
<a name="l01793"></a>01793 
<a name="l01794"></a>01794 <span class="comment">/* ******************** Snap Strips Operator ************************** */</span>
<a name="l01795"></a>01795 <span class="comment">/* Moves the start-point of the selected strips to the specified places */</span>
<a name="l01796"></a>01796 
<a name="l01797"></a>01797 <span class="comment">/* defines for snap keyframes tool */</span>
<a name="l01798"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a216c885bc2668f33604708d46a4b37fe">01798</a> <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> <a class="code" href="../../d3/d31/nla__edit_8c.html#a216c885bc2668f33604708d46a4b37fe">prop_nlaedit_snap_types</a>[] = {
<a name="l01799"></a>01799     {<a class="code" href="../../da/d37/nla__intern_8h.html#a15b3bbe041870ee299f7e042b0305e3cad4967c00e5d693370d9176937d99d420">NLAEDIT_SNAP_CFRA</a>, <span class="stringliteral">&quot;CFRA&quot;</span>, 0, <span class="stringliteral">&quot;Current frame&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l01800"></a>01800     {<a class="code" href="../../da/d37/nla__intern_8h.html#a15b3bbe041870ee299f7e042b0305e3cabbdbc91145ad548fe1231d146c3514f3">NLAEDIT_SNAP_NEAREST_FRAME</a>, <span class="stringliteral">&quot;NEAREST_FRAME&quot;</span>, 0, <span class="stringliteral">&quot;Nearest Frame&quot;</span>, <span class="stringliteral">&quot;&quot;</span>}, <span class="comment">// XXX as single entry?</span>
<a name="l01801"></a>01801     {<a class="code" href="../../da/d37/nla__intern_8h.html#a15b3bbe041870ee299f7e042b0305e3ca2a16f47f6a2b45f67ea3e65767e497c0">NLAEDIT_SNAP_NEAREST_SECOND</a>, <span class="stringliteral">&quot;NEAREST_SECOND&quot;</span>, 0, <span class="stringliteral">&quot;Nearest Second&quot;</span>, <span class="stringliteral">&quot;&quot;</span>}, <span class="comment">// XXX as single entry?</span>
<a name="l01802"></a>01802     {<a class="code" href="../../da/d37/nla__intern_8h.html#a15b3bbe041870ee299f7e042b0305e3ca26b9cd5a776d40aeb289c5cb78bbb394">NLAEDIT_SNAP_NEAREST_MARKER</a>, <span class="stringliteral">&quot;NEAREST_MARKER&quot;</span>, 0, <span class="stringliteral">&quot;Nearest Marker&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l01803"></a>01803     {0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL}
<a name="l01804"></a>01804 };
<a name="l01805"></a>01805 
<a name="l01806"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a0b72dc6284307a3e8e4e340459597910">01806</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a0b72dc6284307a3e8e4e340459597910">nlaedit_snap_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01807"></a>01807 {
<a name="l01808"></a>01808     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01809"></a>01809     
<a name="l01810"></a>01810     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01811"></a>01811     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l01812"></a>01812     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l01813"></a>01813     
<a name="l01814"></a>01814     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene;
<a name="l01815"></a>01815     <span class="keywordtype">int</span> mode = <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;type&quot;</span>);
<a name="l01816"></a>01816     <span class="keywordtype">float</span> secf;
<a name="l01817"></a>01817     
<a name="l01818"></a>01818     <span class="comment">/* get editor data */</span>
<a name="l01819"></a>01819     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01820"></a>01820         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01821"></a>01821         
<a name="l01822"></a>01822     <span class="comment">/* get a list of the editable tracks being shown in the NLA */</span>
<a name="l01823"></a>01823     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l01824"></a>01824     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l01825"></a>01825     
<a name="l01826"></a>01826     <span class="comment">/* get some necessary vars */</span>
<a name="l01827"></a>01827     scene= ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l01828"></a>01828     secf= (float)<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ac92ca5ab87034a348decad7ee8d4bd1b">FPS</a>;
<a name="l01829"></a>01829     
<a name="l01830"></a>01830     <span class="comment">/* since we may add tracks, perform this in reverse order */</span>
<a name="l01831"></a>01831     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac7e4d957243061388808a861705e210d">prev</a>) {
<a name="l01832"></a>01832         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> tmp_strips = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01833"></a>01833         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>;
<a name="l01834"></a>01834         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l01835"></a>01835         <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip, *stripn;
<a name="l01836"></a>01836         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *track;
<a name="l01837"></a>01837         
<a name="l01838"></a>01838         <span class="comment">/* create meta-strips from the continuous chains of selected strips */</span>
<a name="l01839"></a>01839         <a class="code" href="../../d9/de6/BKE__nla_8h.html#a116c0ccd57c84cafd821c1a5752abdea">BKE_nlastrips_make_metas</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, 1);
<a name="l01840"></a>01840         
<a name="l01841"></a>01841         <span class="comment">/* apply the snapping to all the temp meta-strips, then put them in a separate list to be added</span>
<a name="l01842"></a>01842 <span class="comment">         * back to the original only if they still fit</span>
<a name="l01843"></a>01843 <span class="comment">         */</span>
<a name="l01844"></a>01844         <span class="keywordflow">for</span> (strip= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip= stripn) {
<a name="l01845"></a>01845             stripn= strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a0e1bf52d90da905fbab053178c869a8e">next</a>;
<a name="l01846"></a>01846             
<a name="l01847"></a>01847             <span class="keywordflow">if</span> (strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a38c39284c9b83acf3c582ca956ded9d1">flag</a> &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a44376ba8584e916a87fddb2ec469f62e">NLASTRIP_FLAG_TEMP_META</a>) {
<a name="l01848"></a>01848                 <span class="keywordtype">float</span> start, end;
<a name="l01849"></a>01849                 
<a name="l01850"></a>01850                 <span class="comment">/* get the existing end-points */</span>
<a name="l01851"></a>01851                 start= strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ae2094c7a1fbf3ace399a32ec093c4fd5">start</a>;
<a name="l01852"></a>01852                 end= strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a8d7f4a18c61cd0cac5cbe8a344e875a1">end</a>;
<a name="l01853"></a>01853                 
<a name="l01854"></a>01854                 <span class="comment">/* calculate new start position based on snapping mode */</span>
<a name="l01855"></a>01855                 <span class="keywordflow">switch</span> (mode) {
<a name="l01856"></a>01856                     <span class="keywordflow">case</span> <a class="code" href="../../da/d37/nla__intern_8h.html#a15b3bbe041870ee299f7e042b0305e3cad4967c00e5d693370d9176937d99d420">NLAEDIT_SNAP_CFRA</a>: <span class="comment">/* to current frame */</span>
<a name="l01857"></a>01857                         strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ae2094c7a1fbf3ace399a32ec093c4fd5">start</a>= (float)<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a>;
<a name="l01858"></a>01858                         <span class="keywordflow">break</span>;
<a name="l01859"></a>01859                     <span class="keywordflow">case</span> <a class="code" href="../../da/d37/nla__intern_8h.html#a15b3bbe041870ee299f7e042b0305e3cabbdbc91145ad548fe1231d146c3514f3">NLAEDIT_SNAP_NEAREST_FRAME</a>: <span class="comment">/* to nearest frame */</span>
<a name="l01860"></a>01860                         strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ae2094c7a1fbf3ace399a32ec093c4fd5">start</a>= <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(start+0.5f);
<a name="l01861"></a>01861                         <span class="keywordflow">break</span>;
<a name="l01862"></a>01862                     <span class="keywordflow">case</span> <a class="code" href="../../da/d37/nla__intern_8h.html#a15b3bbe041870ee299f7e042b0305e3ca2a16f47f6a2b45f67ea3e65767e497c0">NLAEDIT_SNAP_NEAREST_SECOND</a>: <span class="comment">/* to nearest second */</span>
<a name="l01863"></a>01863                         strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ae2094c7a1fbf3ace399a32ec093c4fd5">start</a>= <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(start/secf + 0.5f) * secf;
<a name="l01864"></a>01864                         <span class="keywordflow">break</span>;
<a name="l01865"></a>01865                     <span class="keywordflow">case</span> <a class="code" href="../../da/d37/nla__intern_8h.html#a15b3bbe041870ee299f7e042b0305e3ca26b9cd5a776d40aeb289c5cb78bbb394">NLAEDIT_SNAP_NEAREST_MARKER</a>: <span class="comment">/* to nearest marker */</span>
<a name="l01866"></a>01866                         strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ae2094c7a1fbf3ace399a32ec093c4fd5">start</a>= (float)<a class="code" href="../../df/d12/anim__markers_8c.html#a7797c7d360bcb81e2d2c66f49fe6ac8a">ED_markers_find_nearest_marker_time</a>(ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a1b0dda891e001c9cff1ffeb3c4032673">markers</a>, start);
<a name="l01867"></a>01867                         <span class="keywordflow">break</span>;
<a name="l01868"></a>01868                     <span class="keywordflow">default</span>: <span class="comment">/* just in case... no snapping */</span>
<a name="l01869"></a>01869                         strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ae2094c7a1fbf3ace399a32ec093c4fd5">start</a>= start;
<a name="l01870"></a>01870                         <span class="keywordflow">break</span>;
<a name="l01871"></a>01871                 }
<a name="l01872"></a>01872                 
<a name="l01873"></a>01873                 <span class="comment">/* get new endpoint based on start-point (and old length) */</span>
<a name="l01874"></a>01874                 strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a8d7f4a18c61cd0cac5cbe8a344e875a1">end</a>= strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#ae2094c7a1fbf3ace399a32ec093c4fd5">start</a> + (end - start);
<a name="l01875"></a>01875                 
<a name="l01876"></a>01876                 <span class="comment">/* apply transforms to meta-strip to its children */</span>
<a name="l01877"></a>01877                 <a class="code" href="../../d9/de6/BKE__nla_8h.html#a5edf5738ee03c2158b209b897ab673d2">BKE_nlameta_flush_transforms</a>(strip);
<a name="l01878"></a>01878                 
<a name="l01879"></a>01879                 <span class="comment">/* remove strip from track, and add to the temp buffer */</span>
<a name="l01880"></a>01880                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, strip);
<a name="l01881"></a>01881                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;tmp_strips, strip);
<a name="l01882"></a>01882             }
<a name="l01883"></a>01883         }
<a name="l01884"></a>01884         
<a name="l01885"></a>01885         <span class="comment">/* try adding each meta-strip back to the track one at a time, to make sure they&#39;ll fit */</span>
<a name="l01886"></a>01886         <span class="keywordflow">for</span> (strip= tmp_strips.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip= stripn) {
<a name="l01887"></a>01887             stripn= strip-&gt;<a class="code" href="../../d7/d95/structNlaStrip.html#a0e1bf52d90da905fbab053178c869a8e">next</a>;
<a name="l01888"></a>01888             
<a name="l01889"></a>01889             <span class="comment">/* remove from temp-strips list */</span>
<a name="l01890"></a>01890             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;tmp_strips, strip);
<a name="l01891"></a>01891             
<a name="l01892"></a>01892             <span class="comment">/* in case there&#39;s no space in the current track, try adding */</span>
<a name="l01893"></a>01893             <span class="keywordflow">if</span> (<a class="code" href="../../d9/de6/BKE__nla_8h.html#a15ed3c0b4de96436ec6938f4a2aae230">BKE_nlatrack_add_strip</a>(nlt, strip) == 0) {
<a name="l01894"></a>01894                 <span class="comment">/* need to add a new track above the current one */</span>
<a name="l01895"></a>01895                 track= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ade883909faa615e4f9aa88de3686d3ce">add_nlatrack</a>(adt, nlt);
<a name="l01896"></a>01896                 <a class="code" href="../../d9/de6/BKE__nla_8h.html#a15ed3c0b4de96436ec6938f4a2aae230">BKE_nlatrack_add_strip</a>(track, strip);
<a name="l01897"></a>01897                 
<a name="l01898"></a>01898                 <span class="comment">/* clear temp meta-strips on this new track, as we may not be able to get back to it */</span>
<a name="l01899"></a>01899                 <a class="code" href="../../d9/de6/BKE__nla_8h.html#a195e7c97865195c81abc1c4b13cc1f59">BKE_nlastrips_clear_metas</a>(&amp;track-&gt;strips, 0, 1);
<a name="l01900"></a>01900             }
<a name="l01901"></a>01901         }
<a name="l01902"></a>01902         
<a name="l01903"></a>01903         <span class="comment">/* remove the meta-strips now that we&#39;re done */</span>
<a name="l01904"></a>01904         <a class="code" href="../../d9/de6/BKE__nla_8h.html#a195e7c97865195c81abc1c4b13cc1f59">BKE_nlastrips_clear_metas</a>(&amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>, 0, 1);
<a name="l01905"></a>01905     }
<a name="l01906"></a>01906     
<a name="l01907"></a>01907     <span class="comment">/* free temp data */</span>
<a name="l01908"></a>01908     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01909"></a>01909     
<a name="l01910"></a>01910     <span class="comment">/* refresh auto strip properties */</span>
<a name="l01911"></a>01911     <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a38612f440a01805e8b230908e5a97c8f">ED_nla_postop_refresh</a>(&amp;ac);
<a name="l01912"></a>01912     
<a name="l01913"></a>01913     <span class="comment">/* set notifier that things have changed */</span>
<a name="l01914"></a>01914     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01915"></a>01915     
<a name="l01916"></a>01916     <span class="comment">/* done */</span>
<a name="l01917"></a>01917     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01918"></a>01918 }
<a name="l01919"></a>01919 
<a name="l01920"></a><a class="code" href="../../da/d37/nla__intern_8h.html#a6292cdd75cba4a7417db91db3e9ff968">01920</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a6292cdd75cba4a7417db91db3e9ff968">NLA_OT_snap</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01921"></a>01921 {
<a name="l01922"></a>01922     <span class="comment">/* identifiers */</span>
<a name="l01923"></a>01923     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Snap Strips&quot;</span>;
<a name="l01924"></a>01924     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_snap&quot;</span>;
<a name="l01925"></a>01925     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Move start of strips to specified time&quot;</span>;
<a name="l01926"></a>01926     
<a name="l01927"></a>01927     <span class="comment">/* api callbacks */</span>
<a name="l01928"></a>01928     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a926375c583166540cfa96299e433e071">WM_menu_invoke</a>;
<a name="l01929"></a>01929     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#a0b72dc6284307a3e8e4e340459597910">nlaedit_snap_exec</a>;
<a name="l01930"></a>01930     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>;
<a name="l01931"></a>01931     
<a name="l01932"></a>01932     <span class="comment">/* flags */</span>
<a name="l01933"></a>01933     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01934"></a>01934     
<a name="l01935"></a>01935     <span class="comment">/* properties */</span>
<a name="l01936"></a>01936     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;type&quot;</span>, prop_nlaedit_snap_types, 0, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01937"></a>01937 }
<a name="l01938"></a>01938 
<a name="l01939"></a>01939 <span class="comment">/* *********************************************** */</span>
<a name="l01940"></a>01940 <span class="comment">/* NLA Modifiers */</span>
<a name="l01941"></a>01941 
<a name="l01942"></a>01942 <span class="comment">/* ******************** Add F-Modifier Operator *********************** */</span>
<a name="l01943"></a>01943 
<a name="l01944"></a>01944 <span class="comment">/* present a special customised popup menu for this, with some filtering */</span>
<a name="l01945"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a822c86fbbd9c33597523f5d1706d7989">01945</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a822c86fbbd9c33597523f5d1706d7989">nla_fmodifier_add_invoke</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op), <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l01946"></a>01946 {
<a name="l01947"></a>01947     <a class="code" href="../../d9/d4b/structuiPopupMenu.html">uiPopupMenu</a> *pup;
<a name="l01948"></a>01948     <a class="code" href="../../d4/d94/structuiLayout.html">uiLayout</a> *layout;
<a name="l01949"></a>01949     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01950"></a>01950     
<a name="l01951"></a>01951     pup= <a class="code" href="../../d8/d1e/UI__interface_8h.html#a402c012d9cde0ff0f0808c25c4213d43">uiPupMenuBegin</a>(C, <span class="stringliteral">&quot;Add F-Modifier&quot;</span>, ICON_NONE);
<a name="l01952"></a>01952     layout= <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8c1b07b81987cdc2168a7417f9104cca">uiPupMenuLayout</a>(pup);
<a name="l01953"></a>01953     
<a name="l01954"></a>01954     <span class="comment">/* start from 1 to skip the &#39;Invalid&#39; modifier type */</span>
<a name="l01955"></a>01955     <span class="keywordflow">for</span> (i = 1; i &lt; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a780a87e4018e6dbc53e4dc812f83c97ba647b327a58819c9a1533272504703d8c">FMODIFIER_NUM_TYPES</a>; i++) {
<a name="l01956"></a>01956         <a class="code" href="../../d9/daa/structFModifierTypeInfo.html">FModifierTypeInfo</a> *fmi= <a class="code" href="../../da/dba/BKE__fcurve_8h.html#ab3d348f3ab743fe9d0f9c196326bd15b">get_fmodifier_typeinfo</a>(i);
<a name="l01957"></a>01957         
<a name="l01958"></a>01958         <span class="comment">/* check if modifier is valid for this context */</span>
<a name="l01959"></a>01959         <span class="keywordflow">if</span> (fmi == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01960"></a>01960             <span class="keywordflow">continue</span>;
<a name="l01961"></a>01961         <span class="keywordflow">if</span> (i == <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a780a87e4018e6dbc53e4dc812f83c97ba0a9f871f719b71334e21fb78f83aa48d">FMODIFIER_TYPE_CYCLES</a>) <span class="comment">/* we already have repeat... */</span>
<a name="l01962"></a>01962             <span class="keywordflow">continue</span>;
<a name="l01963"></a>01963         
<a name="l01964"></a>01964         <span class="comment">/* add entry to add this type of modifier */</span>
<a name="l01965"></a>01965         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a6acba52fa82a73c1af44e3d52ddc5be2">uiItemEnumO</a>(layout, <span class="stringliteral">&quot;NLA_OT_fmodifier_add&quot;</span>, fmi-&gt;<a class="code" href="../../d9/daa/structFModifierTypeInfo.html#ab0818f1d0df09bfc2803ea9e7f940955">name</a>, 0, <span class="stringliteral">&quot;type&quot;</span>, i);
<a name="l01966"></a>01966     }
<a name="l01967"></a>01967     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a5e3bb0f5147561627b0f3f92789476bd">uiItemS</a>(layout);
<a name="l01968"></a>01968     
<a name="l01969"></a>01969     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3ab0b4d9de253d473a16d4f329d8b50f">uiPupMenuEnd</a>(C, pup);
<a name="l01970"></a>01970     
<a name="l01971"></a>01971     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01972"></a>01972 }
<a name="l01973"></a>01973 
<a name="l01974"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a2ac253721c26d2fd516c20f040a92e71">01974</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a2ac253721c26d2fd516c20f040a92e71">nla_fmodifier_add_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01975"></a>01975 {
<a name="l01976"></a>01976     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01977"></a>01977     
<a name="l01978"></a>01978     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01979"></a>01979     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l01980"></a>01980     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l01981"></a>01981     
<a name="l01982"></a>01982     <a class="code" href="../../dc/d68/structFModifier.html">FModifier</a> *fcm;
<a name="l01983"></a>01983     <span class="keywordtype">int</span> type= <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;type&quot;</span>);
<a name="l01984"></a>01984     <span class="keywordtype">short</span> onlyActive = <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;only_active&quot;</span>);
<a name="l01985"></a>01985     
<a name="l01986"></a>01986     <span class="comment">/* get editor data */</span>
<a name="l01987"></a>01987     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01988"></a>01988         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01989"></a>01989         
<a name="l01990"></a>01990     <span class="comment">/* get a list of the editable tracks being shown in the NLA */</span>
<a name="l01991"></a>01991     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l01992"></a>01992     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l01993"></a>01993     
<a name="l01994"></a>01994     <span class="comment">/* for each NLA-Track, add the specified modifier to all selected strips */</span>
<a name="l01995"></a>01995     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l01996"></a>01996         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l01997"></a>01997         <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip;
<a name="l01998"></a>01998         
<a name="l01999"></a>01999         for (strip= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip=strip-&gt;next) {
<a name="l02000"></a>02000             <span class="comment">/* can F-Modifier be added to the current strip? */</span>
<a name="l02001"></a>02001             <span class="keywordflow">if</span> (onlyActive) {
<a name="l02002"></a>02002                 <span class="comment">/* if not active, cannot add since we&#39;re only adding to active strip */</span>
<a name="l02003"></a>02003                 <span class="keywordflow">if</span> ((strip-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a11b77f0bda6fb63b936acc20b58496ac">NLASTRIP_FLAG_ACTIVE</a>)==0)
<a name="l02004"></a>02004                     <span class="keywordflow">continue</span>;
<a name="l02005"></a>02005             }
<a name="l02006"></a>02006             <span class="keywordflow">else</span> {
<a name="l02007"></a>02007                 <span class="comment">/* strip must be selected, since we&#39;re not just doing active */</span>
<a name="l02008"></a>02008                 <span class="keywordflow">if</span> ((strip-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a86b1827bba79c6683cdbeb6b1b4799e5">NLASTRIP_FLAG_SELECT</a>)==0)
<a name="l02009"></a>02009                     <span class="keywordflow">continue</span>;
<a name="l02010"></a>02010             }
<a name="l02011"></a>02011             
<a name="l02012"></a>02012             <span class="comment">/* sound clips are not affected by FModifiers */</span>
<a name="l02013"></a>02013             <span class="keywordflow">if</span> (strip-&gt;type == <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#abddb46a0c18f6964b5dcec7f2de51b55a075d5802024bf6ca7013d4e4ae9ae3d2">NLASTRIP_TYPE_SOUND</a>)
<a name="l02014"></a>02014                 <span class="keywordflow">continue</span>;
<a name="l02015"></a>02015             
<a name="l02016"></a>02016             <span class="comment">/* add F-Modifier of specified type to selected, and make it the active one */</span>
<a name="l02017"></a>02017             fcm= <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a782b8a634387db32ffbadd880093bf60">add_fmodifier</a>(&amp;strip-&gt;modifiers, type);
<a name="l02018"></a>02018             
<a name="l02019"></a>02019             <span class="keywordflow">if</span> (fcm)
<a name="l02020"></a>02020                 <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a91933cf356b9ffc693d92bfa1c2c6900">set_active_fmodifier</a>(&amp;strip-&gt;modifiers, fcm);
<a name="l02021"></a>02021             <span class="keywordflow">else</span> {
<a name="l02022"></a>02022                 <a class="code" href="../../d2/d40/BKE__report_8h.html#af25c247b3b620d13cef87ec2bed1698e">BKE_reportf</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>,
<a name="l02023"></a>02023                     <span class="stringliteral">&quot;Modifier couldn&#39;t be added to (%s : %s) (see console for details)&quot;</span>,
<a name="l02024"></a>02024                     nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a9db0526fede88fb6cd696bac97c3a860">name</a>, strip-&gt;name);
<a name="l02025"></a>02025             }
<a name="l02026"></a>02026         }
<a name="l02027"></a>02027     }
<a name="l02028"></a>02028     
<a name="l02029"></a>02029     <span class="comment">/* free temp data */</span>
<a name="l02030"></a>02030     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l02031"></a>02031     
<a name="l02032"></a>02032     <span class="comment">/* set notifier that things have changed */</span>
<a name="l02033"></a>02033     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02034"></a>02034     
<a name="l02035"></a>02035     <span class="comment">/* done */</span>
<a name="l02036"></a>02036     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02037"></a>02037 }
<a name="l02038"></a>02038  
<a name="l02039"></a><a class="code" href="../../da/d37/nla__intern_8h.html#a1610212cbccfc61e660e6f3f47f5ace9">02039</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a1610212cbccfc61e660e6f3f47f5ace9">NLA_OT_fmodifier_add</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02040"></a>02040 {
<a name="l02041"></a>02041     <span class="comment">/* identifiers */</span>
<a name="l02042"></a>02042     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add F-Modifier&quot;</span>;
<a name="l02043"></a>02043     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_fmodifier_add&quot;</span>;
<a name="l02044"></a>02044     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Add a F-Modifier of the specified type to the selected NLA-Strips&quot;</span>;
<a name="l02045"></a>02045     
<a name="l02046"></a>02046     <span class="comment">/* api callbacks */</span>
<a name="l02047"></a>02047     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#a822c86fbbd9c33597523f5d1706d7989">nla_fmodifier_add_invoke</a>;
<a name="l02048"></a>02048     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#a2ac253721c26d2fd516c20f040a92e71">nla_fmodifier_add_exec</a>;
<a name="l02049"></a>02049     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>; 
<a name="l02050"></a>02050     
<a name="l02051"></a>02051     <span class="comment">/* flags */</span>
<a name="l02052"></a>02052     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l02053"></a>02053     
<a name="l02054"></a>02054     <span class="comment">/* id-props */</span>
<a name="l02055"></a>02055     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;type&quot;</span>, <a class="code" href="../../d3/de6/rna__fcurve_8c.html#af5c64489113e4e386c9f787c0d913436">fmodifier_type_items</a>, 0, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l02056"></a>02056     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;only_active&quot;</span>, 0, <span class="stringliteral">&quot;Only Active&quot;</span>, <span class="stringliteral">&quot;Only add a F-Modifier of the specified type to the active strip&quot;</span>);
<a name="l02057"></a>02057 }
<a name="l02058"></a>02058 
<a name="l02059"></a>02059 <span class="comment">/* ******************** Copy F-Modifiers Operator *********************** */</span>
<a name="l02060"></a>02060 
<a name="l02061"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#ae595d7daafe96655d33a2da06b78a893">02061</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#ae595d7daafe96655d33a2da06b78a893">nla_fmodifier_copy_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l02062"></a>02062 {
<a name="l02063"></a>02063     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l02064"></a>02064     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l02065"></a>02065     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l02066"></a>02066     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>, ok=0;
<a name="l02067"></a>02067     
<a name="l02068"></a>02068     <span class="comment">/* get editor data */</span>
<a name="l02069"></a>02069     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l02070"></a>02070         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l02071"></a>02071     
<a name="l02072"></a>02072     <span class="comment">/* clear buffer first */</span>
<a name="l02073"></a>02073     <a class="code" href="../../d8/dc2/fmodifier__ui_8c.html#a5ef490bdac8e7413de5d7b2eaef66eee">free_fmodifiers_copybuf</a>();
<a name="l02074"></a>02074     
<a name="l02075"></a>02075     <span class="comment">/* get a list of the editable tracks being shown in the NLA */</span>
<a name="l02076"></a>02076     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l02077"></a>02077     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l02078"></a>02078     
<a name="l02079"></a>02079     <span class="comment">/* for each NLA-Track, add the specified modifier to all selected strips */</span>
<a name="l02080"></a>02080     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l02081"></a>02081         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l02082"></a>02082         <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip;
<a name="l02083"></a>02083         
<a name="l02084"></a>02084         for (strip= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip=strip-&gt;next) {
<a name="l02085"></a>02085             <span class="comment">/* only add F-Modifier if on active strip? */</span>
<a name="l02086"></a>02086             <span class="keywordflow">if</span> ((strip-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0b7bac2d7694a130339dbc176c1f39f2a11b77f0bda6fb63b936acc20b58496ac">NLASTRIP_FLAG_ACTIVE</a>)==0)
<a name="l02087"></a>02087                 <span class="keywordflow">continue</span>;
<a name="l02088"></a>02088                 
<a name="l02089"></a>02089             <span class="comment">// TODO: when &#39;active&#39; vs &#39;all&#39; boolean is added, change last param!</span>
<a name="l02090"></a>02090             ok += <a class="code" href="../../d8/dc2/fmodifier__ui_8c.html#a198fe2bf96dd2f72f4b274592e9ab21d">ANIM_fmodifiers_copy_to_buf</a>(&amp;strip-&gt;modifiers, 0);
<a name="l02091"></a>02091         }
<a name="l02092"></a>02092     }
<a name="l02093"></a>02093     
<a name="l02094"></a>02094     <span class="comment">/* successful or not? */</span>
<a name="l02095"></a>02095     <span class="keywordflow">if</span> (ok == 0) {
<a name="l02096"></a>02096         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;No F-Modifiers available to be copied&quot;</span>);
<a name="l02097"></a>02097         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l02098"></a>02098     }
<a name="l02099"></a>02099     <span class="keywordflow">else</span>
<a name="l02100"></a>02100         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02101"></a>02101 }
<a name="l02102"></a>02102  
<a name="l02103"></a><a class="code" href="../../da/d37/nla__intern_8h.html#a9c6514884d0d0e8e035dab7d48782e64">02103</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a9c6514884d0d0e8e035dab7d48782e64">NLA_OT_fmodifier_copy</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02104"></a>02104 {
<a name="l02105"></a>02105     <span class="comment">/* identifiers */</span>
<a name="l02106"></a>02106     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Copy F-Modifiers&quot;</span>;
<a name="l02107"></a>02107     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_fmodifier_copy&quot;</span>;
<a name="l02108"></a>02108     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Copy the F-Modifier(s) of the active NLA-Strip&quot;</span>;
<a name="l02109"></a>02109     
<a name="l02110"></a>02110     <span class="comment">/* api callbacks */</span>
<a name="l02111"></a>02111     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#ae595d7daafe96655d33a2da06b78a893">nla_fmodifier_copy_exec</a>;
<a name="l02112"></a>02112     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>; 
<a name="l02113"></a>02113     
<a name="l02114"></a>02114     <span class="comment">/* flags */</span>
<a name="l02115"></a>02115     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l02116"></a>02116     
<a name="l02117"></a>02117     <span class="comment">/* id-props */</span>
<a name="l02118"></a>02118     <span class="comment">//ot-&gt;prop = RNA_def_boolean(ot-&gt;srna, &quot;all&quot;, 1, &quot;All F-Modifiers&quot;, &quot;Copy all the F-Modifiers, instead of just the active one&quot;);</span>
<a name="l02119"></a>02119 }
<a name="l02120"></a>02120 
<a name="l02121"></a>02121 <span class="comment">/* ******************** Paste F-Modifiers Operator *********************** */</span>
<a name="l02122"></a>02122 
<a name="l02123"></a><a class="code" href="../../d3/d31/nla__edit_8c.html#a5ec996b62d6fca86e173ed3fcb119294">02123</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#a5ec996b62d6fca86e173ed3fcb119294">nla_fmodifier_paste_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l02124"></a>02124 {
<a name="l02125"></a>02125     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l02126"></a>02126     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l02127"></a>02127     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l02128"></a>02128     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>, ok=0;
<a name="l02129"></a>02129     
<a name="l02130"></a>02130     <span class="comment">/* get editor data */</span>
<a name="l02131"></a>02131     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l02132"></a>02132         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l02133"></a>02133     
<a name="l02134"></a>02134     <span class="comment">/* get a list of the editable tracks being shown in the NLA */</span>
<a name="l02135"></a>02135     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045af15e0b18ede9eb0bdae48b6caab11403">ANIMFILTER_SEL</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l02136"></a>02136     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l02137"></a>02137     
<a name="l02138"></a>02138     <span class="comment">/* for each NLA-Track, add the specified modifier to all selected strips */</span>
<a name="l02139"></a>02139     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l02140"></a>02140         <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l02141"></a>02141         <a class="code" href="../../d7/d95/structNlaStrip.html">NlaStrip</a> *strip;
<a name="l02142"></a>02142         
<a name="l02143"></a>02143         for (strip= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; strip; strip=strip-&gt;next) {
<a name="l02144"></a>02144             <span class="comment">// TODO: do we want to replace existing modifiers? add user pref for that!</span>
<a name="l02145"></a>02145             ok += <a class="code" href="../../d8/dc2/fmodifier__ui_8c.html#a7740a86860c6f20f50cc58936a325708">ANIM_fmodifiers_paste_from_buf</a>(&amp;strip-&gt;modifiers, 0);
<a name="l02146"></a>02146         }
<a name="l02147"></a>02147     }
<a name="l02148"></a>02148     
<a name="l02149"></a>02149     <span class="comment">/* clean up */</span>
<a name="l02150"></a>02150     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l02151"></a>02151     
<a name="l02152"></a>02152     <span class="comment">/* successful or not? */</span>
<a name="l02153"></a>02153     <span class="keywordflow">if</span> (ok) {
<a name="l02154"></a>02154         <span class="comment">/* set notifier that things have changed */</span>
<a name="l02155"></a>02155         <span class="comment">/* set notifier that things have changed */</span>
<a name="l02156"></a>02156         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa4d0c2a2f5c2beace2902512fd13e4ae">ND_NLA</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02157"></a>02157         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02158"></a>02158     }
<a name="l02159"></a>02159     <span class="keywordflow">else</span> {
<a name="l02160"></a>02160         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;No F-Modifiers to paste&quot;</span>);
<a name="l02161"></a>02161         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l02162"></a>02162     }
<a name="l02163"></a>02163 }
<a name="l02164"></a>02164  
<a name="l02165"></a><a class="code" href="../../da/d37/nla__intern_8h.html#adda708b115a6ae9f01574325bddb4ac0">02165</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d31/nla__edit_8c.html#adda708b115a6ae9f01574325bddb4ac0">NLA_OT_fmodifier_paste</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02166"></a>02166 {
<a name="l02167"></a>02167     <span class="comment">/* identifiers */</span>
<a name="l02168"></a>02168     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Paste F-Modifiers&quot;</span>;
<a name="l02169"></a>02169     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NLA_OT_fmodifier_paste&quot;</span>;
<a name="l02170"></a>02170     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Add copied F-Modifiers to the selected NLA-Strips&quot;</span>;
<a name="l02171"></a>02171     
<a name="l02172"></a>02172     <span class="comment">/* api callbacks */</span>
<a name="l02173"></a>02173     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d31/nla__edit_8c.html#a5ec996b62d6fca86e173ed3fcb119294">nla_fmodifier_paste_exec</a>;
<a name="l02174"></a>02174     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../da/d37/nla__intern_8h.html#a01e4a00bd6b49223d5cbab14cf3361de">nlaop_poll_tweakmode_off</a>;
<a name="l02175"></a>02175     
<a name="l02176"></a>02176     <span class="comment">/* flags */</span>
<a name="l02177"></a>02177     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l02178"></a>02178 }
<a name="l02179"></a>02179 
<a name="l02180"></a>02180 <span class="comment">/* *********************************************** */</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:34 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

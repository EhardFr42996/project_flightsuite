<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: drawobject.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">drawobject.c</div>  </div>
</div>
<div class="contents">
<a href="../../d3/d02/drawobject_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * Contributor(s): Blender Foundation, full recode and added functions</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00024"></a>00024 <span class="comment"> */</span>
<a name="l00025"></a>00025 
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d3b/DNA__camera__types_8h.html">DNA_camera_types.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d88/DNA__curve__types_8h.html">DNA_curve_types.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d03/DNA__constraint__types_8h.html">DNA_constraint_types.h</a>&quot;</span> <span class="comment">// for drawing constraint</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html">DNA_lamp_types.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d2f/DNA__lattice__types_8h.html">DNA_lattice_types.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../de/db2/DNA__material__types_8h.html">DNA_material_types.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d96/DNA__mesh__types_8h.html">DNA_mesh_types.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html">DNA_meshdata_types.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d40/DNA__meta__types_8h.html">DNA_meta_types.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d8b/DNA__smoke__types_8h.html">DNA_smoke_types.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../da/de4/DNA__speaker__types_8h.html">DNA_speaker_types.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d3b/DNA__world__types_8h.html">DNA_world_types.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d93/DNA__armature__types_8h.html">DNA_armature_types.h</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/dfb/BLI__edgehash_8h.html" title="A general unordered 2-int pair hash table ADT.">BLI_edgehash.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d88/BLI__rand_8h.html" title="Random number functions.">BLI_rand.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dd0/BKE__anim_8h.html">BKE_anim.h</a>&quot;</span>  <span class="comment">//for the where_on_path function</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d17/BKE__armature_8h.html">BKE_armature.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/dff/BKE__camera_8h.html" title="Camera datablock and utility functions.">BKE_camera.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddd/BKE__constraint_8h.html">BKE_constraint.h</a>&quot;</span> <span class="comment">// for the get_constraint_target function</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dfc/BKE__curve_8h.html">BKE_curve.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html">BKE_DerivedMesh.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dbd/BKE__deform_8h.html" title="support for deformation groups and hooks.">BKE_deform.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d12/BKE__displist_8h.html" title="display list (or rather multi purpose list) stuff.">BKE_displist.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d06/BKE__font_8h.html">BKE_font.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d77/BKE__image_8h.html">BKE_image.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d17/BKE__key_8h.html">BKE_key.h</a>&quot;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d8f/BKE__lattice_8h.html">BKE_lattice.h</a>&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d7f/BKE__mesh_8h.html">BKE_mesh.h</a>&quot;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d0f/BKE__material_8h.html" title="General operations, lookup, etc. for materials.">BKE_material.h</a>&quot;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dae/BKE__mball_8h.html">BKE_mball.h</a>&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d0f/BKE__modifier_8h.html">BKE_modifier.h</a>&quot;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dac/BKE__object_8h.html" title="General operations, lookup, etc. for blender objects.">BKE_object.h</a>&quot;</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d86/BKE__paint_8h.html">BKE_paint.h</a>&quot;</span>
<a name="l00077"></a>00077 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dca/BKE__particle_8h.html">BKE_particle.h</a>&quot;</span>
<a name="l00078"></a>00078 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d45/BKE__pointcache_8h.html">BKE_pointcache.h</a>&quot;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d53/BKE__scene_8h.html">BKE_scene.h</a>&quot;</span>
<a name="l00080"></a>00080 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d47/BKE__unit_8h.html">BKE_unit.h</a>&quot;</span>
<a name="l00081"></a>00081 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd4/BKE__movieclip_8h.html">BKE_movieclip.h</a>&quot;</span>
<a name="l00082"></a>00082 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d72/BKE__tracking_8h.html">BKE_tracking.h</a>&quot;</span>
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html">BKE_tessmesh.h</a>&quot;</span>
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d83/smoke__API_8h.html">smoke_API.h</a>&quot;</span>
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d49/IMB__imbuf_8h.html">IMB_imbuf.h</a>&quot;</span>
<a name="l00089"></a>00089 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html" title="Contains defines and structs used throughout the imbuf module.">IMB_imbuf_types.h</a>&quot;</span>
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d44/BIF__gl_8h.html">BIF_gl.h</a>&quot;</span>
<a name="l00092"></a>00092 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d71/BIF__glutil_8h.html">BIF_glutil.h</a>&quot;</span>
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/df0/GPU__draw_8h.html">GPU_draw.h</a>&quot;</span>
<a name="l00095"></a>00095 <span class="preprocessor">#include &quot;<a class="code" href="../../da/deb/GPU__extensions_8h.html">GPU_extensions.h</a>&quot;</span>
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/dd6/ED__mesh_8h.html">ED_mesh.h</a>&quot;</span>
<a name="l00098"></a>00098 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/db9/ED__particle_8h.html">ED_particle.h</a>&quot;</span>
<a name="l00099"></a>00099 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d12/ED__screen_8h.html">ED_screen.h</a>&quot;</span>
<a name="l00100"></a>00100 <span class="preprocessor">#include &quot;<a class="code" href="../../db/de3/ED__sculpt_8h.html">ED_sculpt.h</a>&quot;</span>
<a name="l00101"></a>00101 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d7d/ED__types_8h.html">ED_types.h</a>&quot;</span>
<a name="l00102"></a>00102 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d71/ED__curve_8h.html">ED_curve.h</a>&quot;</span> <span class="comment">/* for curve_editnurbs */</span>
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d96/UI__resources_8h.html">UI_resources.h</a>&quot;</span>
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00107"></a>00107 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d6f/wm__subwindow_8h.html">wm_subwindow.h</a>&quot;</span>
<a name="l00108"></a>00108 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d5d/BLF__api_8h.html">BLF_api.h</a>&quot;</span>
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/df4/view3d__intern_8h.html">view3d_intern.h</a>&quot;</span>  <span class="comment">// own include</span>
<a name="l00111"></a>00111 
<a name="l00112"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3">00112</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3">eWireDrawMode</a> {
<a name="l00113"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3ac80d84acc2f6ad2d7308d352738879a4">00113</a>     <a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3ac80d84acc2f6ad2d7308d352738879a4">OBDRAW_WIRE_OFF</a> = 0,
<a name="l00114"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3adc95d305da2175bc61763f7926c8a8d0">00114</a>     <a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3adc95d305da2175bc61763f7926c8a8d0">OBDRAW_WIRE_ON</a> = 1,
<a name="l00115"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3a05aeed3709b2192e9b096aeefe0f1792">00115</a>     <a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3a05aeed3709b2192e9b096aeefe0f1792">OBDRAW_WIRE_ON_DEPTH</a> = 2
<a name="l00116"></a>00116 } <a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3">eWireDrawMode</a>;
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 <span class="comment">/* user data structures for derived mesh callbacks */</span>
<a name="l00119"></a><a class="code" href="../../d4/de1/structforeachScreenVert__userData.html">00119</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/de1/structforeachScreenVert__userData.html">foreachScreenVert_userData</a> {
<a name="l00120"></a><a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a71530598f6d1ec155e001c53f86c1b9d">00120</a>     void (*<a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a71530598f6d1ec155e001c53f86c1b9d">func</a>)(<span class="keywordtype">void</span> *<a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a23d6f25d920e6e08efeccb8162cf111f">userData</a>, <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *eve, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> index);
<a name="l00121"></a><a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a23d6f25d920e6e08efeccb8162cf111f">00121</a>     <span class="keywordtype">void</span> *<a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a23d6f25d920e6e08efeccb8162cf111f">userData</a>;
<a name="l00122"></a><a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a0a7bc9ba2e3a38d9b3715215529721ab">00122</a>     <a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> <a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a0a7bc9ba2e3a38d9b3715215529721ab">vc</a>;
<a name="l00123"></a><a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a59bc081b4f062c2e920211ee61a85e69">00123</a>     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a578b283de8cc09dcb1fa8331d7519156">eV3DClipTest</a> <a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a59bc081b4f062c2e920211ee61a85e69">clipVerts</a>;
<a name="l00124"></a>00124 } <a class="code" href="../../d3/d02/drawobject_8c.html#aa4223f102a0d52e5ffa4e42572616c25">foreachScreenVert_userData</a>;
<a name="l00125"></a>00125 
<a name="l00126"></a><a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html">00126</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html">foreachScreenEdge_userData</a> {
<a name="l00127"></a><a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#ab9dee8cc83dad9739903bf4b2e5862fb">00127</a>     void (*<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#ab9dee8cc83dad9739903bf4b2e5862fb">func</a>)(<span class="keywordtype">void</span> *<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#ae147bb3d09dc5549c6f2ef8abfb3461f">userData</a>, <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *eed, <span class="keywordtype">int</span> x0, <span class="keywordtype">int</span> y0, <span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> index);
<a name="l00128"></a><a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#ae147bb3d09dc5549c6f2ef8abfb3461f">00128</a>     <span class="keywordtype">void</span> *<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#ae147bb3d09dc5549c6f2ef8abfb3461f">userData</a>;
<a name="l00129"></a><a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#a2fe168c824b94b3839f794d3be9caa76">00129</a>     <a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> <a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#a2fe168c824b94b3839f794d3be9caa76">vc</a>;
<a name="l00130"></a><a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#a190d849f1a42ead3c2ca3ae7a051bddf">00130</a>     <a class="code" href="../../d0/d28/structrcti.html">rcti</a> <a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#a190d849f1a42ead3c2ca3ae7a051bddf">win_rect</a>; <span class="comment">/* copy of: vc.ar-&gt;winx/winy, use for faster tests, minx/y will always be 0 */</span>
<a name="l00131"></a><a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#affb870354473938c07deeb073bfb669e">00131</a>     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a578b283de8cc09dcb1fa8331d7519156">eV3DClipTest</a> <a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#affb870354473938c07deeb073bfb669e">clipVerts</a>;
<a name="l00132"></a>00132 } <a class="code" href="../../d3/d02/drawobject_8c.html#adced6a3ae3b04d9d845b6b474af3ab49">foreachScreenEdge_userData</a>;
<a name="l00133"></a>00133 
<a name="l00134"></a><a class="code" href="../../d6/d75/structforeachScreenFace__userData.html">00134</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d75/structforeachScreenFace__userData.html">foreachScreenFace_userData</a> {
<a name="l00135"></a><a class="code" href="../../d6/d75/structforeachScreenFace__userData.html#afb67cee15484dd94016c3c94f7fdcdbe">00135</a>     void (*<a class="code" href="../../d6/d75/structforeachScreenFace__userData.html#afb67cee15484dd94016c3c94f7fdcdbe">func</a>)(<span class="keywordtype">void</span> *<a class="code" href="../../d6/d75/structforeachScreenFace__userData.html#a5895b2476a0bf8de38326ea32f79dae0">userData</a>, <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> index);
<a name="l00136"></a><a class="code" href="../../d6/d75/structforeachScreenFace__userData.html#a5895b2476a0bf8de38326ea32f79dae0">00136</a>     <span class="keywordtype">void</span> *<a class="code" href="../../d6/d75/structforeachScreenFace__userData.html#a5895b2476a0bf8de38326ea32f79dae0">userData</a>;
<a name="l00137"></a><a class="code" href="../../d6/d75/structforeachScreenFace__userData.html#a29a5567f8ecc34c4f3fecf30a7197b6d">00137</a>     <a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> <a class="code" href="../../d6/d75/structforeachScreenFace__userData.html#a29a5567f8ecc34c4f3fecf30a7197b6d">vc</a>;
<a name="l00138"></a>00138 } <a class="code" href="../../d3/d02/drawobject_8c.html#ae1b9b66d62bf24e73e71d12014268c83">foreachScreenFace_userData</a>;
<a name="l00139"></a>00139 
<a name="l00140"></a><a class="code" href="../../d0/d9c/structdrawDMVerts__userData.html">00140</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d9c/structdrawDMVerts__userData.html">drawDMVerts_userData</a> {
<a name="l00141"></a><a class="code" href="../../d0/d9c/structdrawDMVerts__userData.html#a80e0663ed5803692d0e023d548929f9a">00141</a>     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *<a class="code" href="../../d0/d9c/structdrawDMVerts__userData.html#a80e0663ed5803692d0e023d548929f9a">em</a>; <span class="comment">/* BMESH BRANCH ONLY */</span>
<a name="l00142"></a>00142 
<a name="l00143"></a><a class="code" href="../../d0/d9c/structdrawDMVerts__userData.html#afb07fcec42205490e5201f555458f5c5">00143</a>     <span class="keywordtype">int</span> <a class="code" href="../../d0/d9c/structdrawDMVerts__userData.html#afb07fcec42205490e5201f555458f5c5">sel</a>;
<a name="l00144"></a><a class="code" href="../../d0/d9c/structdrawDMVerts__userData.html#a3842fa8b094fc18c7012a27650c28e1c">00144</a>     <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *<a class="code" href="../../d0/d9c/structdrawDMVerts__userData.html#a3842fa8b094fc18c7012a27650c28e1c">eve_act</a>;
<a name="l00145"></a>00145 } <a class="code" href="../../d3/d02/drawobject_8c.html#a4a424d136d3812dfa08447faa63fb75b">drawDMVerts_userData</a>;
<a name="l00146"></a>00146 
<a name="l00147"></a><a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html">00147</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html">drawDMEdgesSel_userData</a> {
<a name="l00148"></a><a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html#a1331366255b83f333f9d5530cccc999e">00148</a>     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *<a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html#a1331366255b83f333f9d5530cccc999e">em</a>; <span class="comment">/* BMESH BRANCH ONLY */</span>
<a name="l00149"></a>00149 
<a name="l00150"></a><a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html#a1e36e54155150cef769ab189a895942c">00150</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html#a9bdac64d9183abb6670d30b86e213f0c">baseCol</a>, *<a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html#a1e36e54155150cef769ab189a895942c">selCol</a>, *<a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html#a4a202bdcbb9056e73a83c864860954b3">actCol</a>;
<a name="l00151"></a><a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html#af1b397f655bc5d124477fdc7f7297094">00151</a>     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *<a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html#af1b397f655bc5d124477fdc7f7297094">eed_act</a>;
<a name="l00152"></a>00152 } <a class="code" href="../../d3/d02/drawobject_8c.html#a12fb75acce4a496a215f0b909407554c">drawDMEdgesSel_userData</a>;
<a name="l00153"></a>00153 
<a name="l00154"></a><a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html">00154</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html">drawDMFacesSel_userData</a> {
<a name="l00155"></a><a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#ae92899886af90096a28b581e035842d0">00155</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#ae92899886af90096a28b581e035842d0">cols</a>[3];
<a name="l00156"></a>00156 
<a name="l00157"></a><a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#aba8efe78dcc5a467f1e6f9167c7e16be">00157</a>     <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#aba8efe78dcc5a467f1e6f9167c7e16be">dm</a>; <span class="comment">/* BMESH BRANCH ONLY */</span>
<a name="l00158"></a><a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#a84ef21e53cc5f198f859f9b64378aed9">00158</a>     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#a84ef21e53cc5f198f859f9b64378aed9">em</a>;  <span class="comment">/* BMESH BRANCH ONLY */</span>
<a name="l00159"></a>00159 
<a name="l00160"></a><a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#a545a706f2d14c4c5b92130335224fcb2">00160</a>     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#a545a706f2d14c4c5b92130335224fcb2">efa_act</a>;
<a name="l00161"></a><a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#a775e559169933b1dfe8e9d8c9327483c">00161</a>     <span class="keywordtype">int</span> *<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#a775e559169933b1dfe8e9d8c9327483c">orig_index</a>;
<a name="l00162"></a>00162 } <a class="code" href="../../d3/d02/drawobject_8c.html#a6d23b6560068a27905b72eaded55c66d">drawDMFacesSel_userData</a>;
<a name="l00163"></a>00163 
<a name="l00164"></a><a class="code" href="../../de/d2f/structdrawDMNormal__userData.html">00164</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../de/d2f/structdrawDMNormal__userData.html">drawDMNormal_userData</a> {
<a name="l00165"></a><a class="code" href="../../de/d2f/structdrawDMNormal__userData.html#a4f2afd55ed3b426272847be093de26a6">00165</a>     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *<a class="code" href="../../de/d2f/structdrawDMNormal__userData.html#a4f2afd55ed3b426272847be093de26a6">em</a>;
<a name="l00166"></a><a class="code" href="../../de/d2f/structdrawDMNormal__userData.html#a303390e8d35c9bb0dc26a32d03674376">00166</a>     <span class="keywordtype">float</span> <a class="code" href="../../de/d2f/structdrawDMNormal__userData.html#a303390e8d35c9bb0dc26a32d03674376">normalsize</a>;
<a name="l00167"></a>00167 } <a class="code" href="../../d3/d02/drawobject_8c.html#a45eb388edc5450abca84afcca52c9a14">drawDMNormal_userData</a>;
<a name="l00168"></a>00168 
<a name="l00169"></a><a class="code" href="../../dc/d05/structbbsObmodeMeshVerts__userData.html">00169</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../dc/d05/structbbsObmodeMeshVerts__userData.html">bbsObmodeMeshVerts_userData</a> {
<a name="l00170"></a><a class="code" href="../../dc/d05/structbbsObmodeMeshVerts__userData.html#ad818b5e0cbef32d88ed7d9b5b20e815c">00170</a>     <span class="keywordtype">void</span> *<a class="code" href="../../dc/d05/structbbsObmodeMeshVerts__userData.html#ad818b5e0cbef32d88ed7d9b5b20e815c">offset</a>;
<a name="l00171"></a><a class="code" href="../../dc/d05/structbbsObmodeMeshVerts__userData.html#a8049f3adc975e9ca4ad9c3836bce142a">00171</a>     <a class="code" href="../../d8/de5/structMVert.html">MVert</a> *<a class="code" href="../../dc/d05/structbbsObmodeMeshVerts__userData.html#a8049f3adc975e9ca4ad9c3836bce142a">mvert</a>;
<a name="l00172"></a>00172 } <a class="code" href="../../d3/d02/drawobject_8c.html#a1d001631289bbb5c93b3c4f6d5c9abd8">bbsObmodeMeshVerts_userData</a>;
<a name="l00173"></a>00173 
<a name="l00174"></a>00174 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a4d19f50de723a4c82b4a1695f99400d4">draw_bounding_volume</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keywordtype">char</span> type);
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a0c9cb577790366f98d5d39975f7446c4">drawcube_size</a>(<span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>);
<a name="l00177"></a>00177 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a27a385998c793e123c08108511e866c0">drawcircle_size</a>(<span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>);
<a name="l00178"></a>00178 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a325de6f098e3581b88d0394d4ad3f0d8">draw_empty_sphere</a>(<span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>);
<a name="l00179"></a>00179 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a28068615c786c14b3b89a90d2f1fb806">draw_empty_cone</a>(<span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>);
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 <span class="comment">/* this condition has been made more complex since editmode can draw textures */</span>
<a name="l00182"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a85a9a40d95e42913b5e214675483ca80">00182</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a85a9a40d95e42913b5e214675483ca80">check_object_draw_texture</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <span class="keywordtype">int</span> drawtype)
<a name="l00183"></a>00183 {
<a name="l00184"></a>00184     <span class="comment">/* texture and material draw modes */</span>
<a name="l00185"></a>00185     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a591cd4c57e5a79352f6733f6fa2bc1c9">drawtype</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a12c14080c880d52c6a50c271e8bb87f8">OB_TEXTURE</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9c65a551de1e814cda97b11b53904c8e">OB_MATERIAL</a>) &amp;&amp; drawtype &gt; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a02098d23ce96d480e90882bed52cb89d">OB_SOLID</a>)
<a name="l00186"></a>00186         <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     <span class="comment">/* textured solid */</span>
<a name="l00189"></a>00189     <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a591cd4c57e5a79352f6733f6fa2bc1c9">drawtype</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a02098d23ce96d480e90882bed52cb89d">OB_SOLID</a> &amp;&amp; (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a0f1d810430681f2fbfcef43c2887a38f">V3D_SOLID_TEX</a>) &amp;&amp; !<a class="code" href="../../d8/d53/BKE__scene_8h.html#a041ff0e68dd0152e85ceddddc9b53cdc">scene_use_new_shading_nodes</a>(scene))
<a name="l00190"></a>00190         <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00191"></a>00191     
<a name="l00192"></a>00192     <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00193"></a>00193 }
<a name="l00194"></a>00194 
<a name="l00195"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a5a9568e44f52a75716cc935f20a02da3">00195</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a5a9568e44f52a75716cc935f20a02da3">check_ob_drawface_dot</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *vd, <span class="keywordtype">char</span> dt)
<a name="l00196"></a>00196 {
<a name="l00197"></a>00197     <span class="keywordflow">if</span> ((sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a85db400bd7203c7be03555b02e6c2709">selectmode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a616adf2bfd4117c15663a28e464a5100">SCE_SELECT_FACE</a>) == 0)
<a name="l00198"></a>00198         <span class="keywordflow">return</span> 0;
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.f &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a956e0b2eee9cc0a798faf39ca1df10e6">G_BACKBUFSEL</a>)
<a name="l00201"></a>00201         <span class="keywordflow">return</span> 0;
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     <span class="keywordflow">if</span> ((vd-&gt;<a class="code" href="../../d6/deb/structView3D.html#a97a32d38ce1481d61d60dc677693ce5d">flag</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#ab80fcf8e0e16083a2ef8e7ca72cb6a39">V3D_ZBUF_SELECT</a>) == 0)
<a name="l00204"></a>00204         <span class="keywordflow">return</span> 1;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206     <span class="comment">/* if its drawing textures with zbuf sel, then don&#39;t draw dots */</span>
<a name="l00207"></a>00207     <span class="keywordflow">if</span> (dt == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a12c14080c880d52c6a50c271e8bb87f8">OB_TEXTURE</a> &amp;&amp; vd-&gt;<a class="code" href="../../d6/deb/structView3D.html#a591cd4c57e5a79352f6733f6fa2bc1c9">drawtype</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a12c14080c880d52c6a50c271e8bb87f8">OB_TEXTURE</a>)
<a name="l00208"></a>00208         <span class="keywordflow">return</span> 0;
<a name="l00209"></a>00209 
<a name="l00210"></a>00210     <span class="keywordflow">if</span> ((vd-&gt;<a class="code" href="../../d6/deb/structView3D.html#a591cd4c57e5a79352f6733f6fa2bc1c9">drawtype</a> &gt;= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a02098d23ce96d480e90882bed52cb89d">OB_SOLID</a>) &amp;&amp; (vd-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a0f1d810430681f2fbfcef43c2887a38f">V3D_SOLID_TEX</a>))
<a name="l00211"></a>00211         <span class="keywordflow">return</span> 0;
<a name="l00212"></a>00212 
<a name="l00213"></a>00213     <span class="keywordflow">return</span> 1;
<a name="l00214"></a>00214 }
<a name="l00215"></a>00215 
<a name="l00216"></a>00216 <span class="comment">/* ************* only use while object drawing **************</span>
<a name="l00217"></a>00217 <span class="comment"> * or after running ED_view3d_init_mats_rv3d</span>
<a name="l00218"></a>00218 <span class="comment"> * */</span>
<a name="l00219"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a0445d2c25a4d1c9c6f2d827d9f6d4a5b">00219</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a0445d2c25a4d1c9c6f2d827d9f6d4a5b">view3d_project_short_clip</a>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <span class="keyword">const</span> <span class="keywordtype">float</span> vec[3], <span class="keywordtype">short</span> adr[2], <span class="keywordtype">int</span> is_local)
<a name="l00220"></a>00220 {
<a name="l00221"></a>00221     <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>;
<a name="l00222"></a>00222     <span class="keywordtype">float</span> fx, fy, vec4[4];
<a name="l00223"></a>00223     
<a name="l00224"></a>00224     adr[0] = <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a9f2d1998b6b3d4dd9472a8092725e0ef">IS_CLIPPED</a>;
<a name="l00225"></a>00225     
<a name="l00226"></a>00226     <span class="comment">/* clipplanes in eye space */</span>
<a name="l00227"></a>00227     <span class="keywordflow">if</span> (rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a077da32c8352d8b7abb4b19919a14cf8">rflag</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5abc2fd47b1dba7a3d7836a57f6af9a9">RV3D_CLIPPING</a>) {
<a name="l00228"></a>00228         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6a/ED__view3d_8h.html#ac0ad69a1a1be9d1bc56fc2ba323c6fe4">ED_view3d_clipping_test</a>(rv3d, vec, is_local))
<a name="l00229"></a>00229             <span class="keywordflow">return</span>;
<a name="l00230"></a>00230     }
<a name="l00231"></a>00231     
<a name="l00232"></a>00232     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec4, vec);
<a name="l00233"></a>00233     vec4[3] = 1.0;
<a name="l00234"></a>00234     
<a name="l00235"></a>00235     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a0317104b02abeeb617a3d53af7070820">mul_m4_v4</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ad0cd2f1eea91b899b403cf8e432513f4">persmatob</a>, vec4);
<a name="l00236"></a>00236     
<a name="l00237"></a>00237     <span class="comment">/* clipplanes in window space */</span>
<a name="l00238"></a>00238     <span class="keywordflow">if</span> (vec4[3] &gt; (<span class="keywordtype">float</span>)<a class="code" href="../../d4/df4/view3d__intern_8h.html#abba8aba510fb4e36ed4bded2e95044f7">BL_NEAR_CLIP</a>) {    <span class="comment">/* is the NEAR clipping cutoff for picking */</span>
<a name="l00239"></a>00239         fx = (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a32e37003215c0dc7f77e12e4fc9db3f4">winx</a> / 2) * (1 + vec4[0] / vec4[3]);
<a name="l00240"></a>00240         
<a name="l00241"></a>00241         <span class="keywordflow">if</span> (fx &gt; 0 &amp;&amp; fx &lt; ar-&gt;winx) {
<a name="l00242"></a>00242             
<a name="l00243"></a>00243             fy = (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a908d20a23657ef143d2de1496be69f42">winy</a> / 2) * (1 + vec4[1] / vec4[3]);
<a name="l00244"></a>00244             
<a name="l00245"></a>00245             <span class="keywordflow">if</span> (fy &gt; 0.0f &amp;&amp; fy &lt; (<span class="keywordtype">float</span>)ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a908d20a23657ef143d2de1496be69f42">winy</a>) {
<a name="l00246"></a>00246                 adr[0] = (short)<a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(fx);
<a name="l00247"></a>00247                 adr[1] = (short)<a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(fy);
<a name="l00248"></a>00248             }
<a name="l00249"></a>00249         }
<a name="l00250"></a>00250     }
<a name="l00251"></a>00251 }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253 <span class="comment">/* BMESH NOTE: this function is unused in bmesh only */</span>
<a name="l00254"></a>00254 
<a name="l00255"></a>00255 <span class="comment">/* only use while object drawing */</span>
<a name="l00256"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a7c8ea248ccb5e34ba800d2dd382a0ebb">00256</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a26aa3564d15ae9e56cce569a324df5da">UNUSED_FUNCTION</a>(<a class="code" href="../../d3/d02/drawobject_8c.html#a7c8ea248ccb5e34ba800d2dd382a0ebb">view3d_project_short_noclip</a>) (<a class="code" href="../../da/d23/structARegion.html">ARegion</a> * ar, <span class="keyword">const</span> <span class="keywordtype">float</span> vec[3], <span class="keywordtype">short</span> adr[2])
<a name="l00257"></a>00257 {
<a name="l00258"></a>00258     <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d = ar-&gt;regiondata;
<a name="l00259"></a>00259     <span class="keywordtype">float</span> fx, fy, vec4[4];
<a name="l00260"></a>00260     
<a name="l00261"></a>00261     adr[0] = <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a9f2d1998b6b3d4dd9472a8092725e0ef">IS_CLIPPED</a>;
<a name="l00262"></a>00262     
<a name="l00263"></a>00263     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec4, vec);
<a name="l00264"></a>00264     vec4[3] = 1.0;
<a name="l00265"></a>00265     
<a name="l00266"></a>00266     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a0317104b02abeeb617a3d53af7070820">mul_m4_v4</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ad0cd2f1eea91b899b403cf8e432513f4">persmatob</a>, vec4);
<a name="l00267"></a>00267     
<a name="l00268"></a>00268     <span class="keywordflow">if</span> (vec4[3] &gt; (<span class="keywordtype">float</span>)<a class="code" href="../../d4/df4/view3d__intern_8h.html#abba8aba510fb4e36ed4bded2e95044f7">BL_NEAR_CLIP</a>) {    <span class="comment">/* is the NEAR clipping cutoff for picking */</span>
<a name="l00269"></a>00269         fx = (ar-&gt;winx / 2) * (1 + vec4[0] / vec4[3]);
<a name="l00270"></a>00270         
<a name="l00271"></a>00271         <span class="keywordflow">if</span> (fx &gt; -32700 &amp;&amp; fx &lt; 32700) {
<a name="l00272"></a>00272             
<a name="l00273"></a>00273             fy = (ar-&gt;winy / 2) * (1 + vec4[1] / vec4[3]);
<a name="l00274"></a>00274             
<a name="l00275"></a>00275             <span class="keywordflow">if</span> (fy &gt; -32700.0f &amp;&amp; fy &lt; 32700.0f) {
<a name="l00276"></a>00276                 adr[0] = (short)<a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(fx);
<a name="l00277"></a>00277                 adr[1] = (short)<a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(fy);
<a name="l00278"></a>00278             }
<a name="l00279"></a>00279         }
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281 }
<a name="l00282"></a>00282 
<a name="l00283"></a>00283 <span class="comment">/* same as view3d_project_short_clip but use persmat instead of persmatob for projection */</span>
<a name="l00284"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ad31dc916b99f9b7e54c3e97f6f15cb77">00284</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ad31dc916b99f9b7e54c3e97f6f15cb77">view3d_project_short_clip_persmat</a>(<a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <span class="keyword">const</span> <span class="keywordtype">float</span> vec[3], <span class="keywordtype">short</span> adr[2], <span class="keywordtype">int</span> is_local)
<a name="l00285"></a>00285 {
<a name="l00286"></a>00286     <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>;
<a name="l00287"></a>00287     <span class="keywordtype">float</span> fx, fy, vec4[4];
<a name="l00288"></a>00288 
<a name="l00289"></a>00289     adr[0] = <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a9f2d1998b6b3d4dd9472a8092725e0ef">IS_CLIPPED</a>;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291     <span class="comment">/* clipplanes in eye space */</span>
<a name="l00292"></a>00292     <span class="keywordflow">if</span> (rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a077da32c8352d8b7abb4b19919a14cf8">rflag</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5abc2fd47b1dba7a3d7836a57f6af9a9">RV3D_CLIPPING</a>) {
<a name="l00293"></a>00293         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6a/ED__view3d_8h.html#ac0ad69a1a1be9d1bc56fc2ba323c6fe4">ED_view3d_clipping_test</a>(rv3d, vec, is_local))
<a name="l00294"></a>00294             <span class="keywordflow">return</span>;
<a name="l00295"></a>00295     }
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec4, vec);
<a name="l00298"></a>00298     vec4[3] = 1.0;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a0317104b02abeeb617a3d53af7070820">mul_m4_v4</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8ab36b8b8caeec087fd9595c33e90775">persmat</a>, vec4);
<a name="l00301"></a>00301 
<a name="l00302"></a>00302     <span class="comment">/* clipplanes in window space */</span>
<a name="l00303"></a>00303     <span class="keywordflow">if</span> (vec4[3] &gt; (<span class="keywordtype">float</span>)<a class="code" href="../../d4/df4/view3d__intern_8h.html#abba8aba510fb4e36ed4bded2e95044f7">BL_NEAR_CLIP</a>) {    <span class="comment">/* is the NEAR clipping cutoff for picking */</span>
<a name="l00304"></a>00304         fx = (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a32e37003215c0dc7f77e12e4fc9db3f4">winx</a> / 2) * (1 + vec4[0] / vec4[3]);
<a name="l00305"></a>00305 
<a name="l00306"></a>00306         <span class="keywordflow">if</span> (fx &gt; 0 &amp;&amp; fx &lt; ar-&gt;winx) {
<a name="l00307"></a>00307 
<a name="l00308"></a>00308             fy = (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a908d20a23657ef143d2de1496be69f42">winy</a> / 2) * (1 + vec4[1] / vec4[3]);
<a name="l00309"></a>00309 
<a name="l00310"></a>00310             <span class="keywordflow">if</span> (fy &gt; 0.0f &amp;&amp; fy &lt; (<span class="keywordtype">float</span>)ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a908d20a23657ef143d2de1496be69f42">winy</a>) {
<a name="l00311"></a>00311                 adr[0] = (short)<a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(fx);
<a name="l00312"></a>00312                 adr[1] = (short)<a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(fy);
<a name="l00313"></a>00313             }
<a name="l00314"></a>00314         }
<a name="l00315"></a>00315     }
<a name="l00316"></a>00316 }
<a name="l00317"></a>00317 <span class="comment">/* ************************ */</span>
<a name="l00318"></a>00318 
<a name="l00319"></a>00319 <span class="comment">/* check for glsl drawing */</span>
<a name="l00320"></a>00320 
<a name="l00321"></a><a class="code" href="../../d4/df4/view3d__intern_8h.html#ac5589a6fd4d192c9afe8fd7b3831e74a">00321</a> <span class="keywordtype">int</span> <a class="code" href="../../d3/d02/drawobject_8c.html#aca409cda616fd2a1eb6eb2dc5b124fac">draw_glsl_material</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <span class="keywordtype">int</span> dt)
<a name="l00322"></a>00322 {
<a name="l00323"></a>00323     <span class="keywordflow">if</span> (!<a class="code" href="../../da/deb/GPU__extensions_8h.html#a6fb5a77a1e2ad67b049c9ffa2d59e5f2">GPU_glsl_support</a>())
<a name="l00324"></a>00324         <span class="keywordflow">return</span> 0;
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.f &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a7bc3ff94aabaed488f0d9b7199d11d22">G_PICKSEL</a>)
<a name="l00326"></a>00326         <span class="keywordflow">return</span> 0;
<a name="l00327"></a>00327     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d02/drawobject_8c.html#a85a9a40d95e42913b5e214675483ca80">check_object_draw_texture</a>(scene, v3d, dt))
<a name="l00328"></a>00328         <span class="keywordflow">return</span> 0;
<a name="l00329"></a>00329     <span class="keywordflow">if</span> (ob == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a119935c54737bd111df8fd516c390000">OBACT</a> &amp;&amp; (ob &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a6ab1cede4f6911c8042ca67d0c53b780">OB_MODE_WEIGHT_PAINT</a>))
<a name="l00330"></a>00330         <span class="keywordflow">return</span> 0;
<a name="l00331"></a>00331     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d53/BKE__scene_8h.html#a041ff0e68dd0152e85ceddddc9b53cdc">scene_use_new_shading_nodes</a>(scene))
<a name="l00332"></a>00332         <span class="keywordflow">return</span> 0;
<a name="l00333"></a>00333     
<a name="l00334"></a>00334     <span class="keywordflow">return</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#a6cede4314df04c85946a10fbd7e109f0">matmode</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a488f8a5dafd4bf3954c021a5a9ffecc6">GAME_MAT_GLSL</a>) &amp;&amp; (dt &gt; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a02098d23ce96d480e90882bed52cb89d">OB_SOLID</a>);
<a name="l00335"></a>00335 }
<a name="l00336"></a>00336 
<a name="l00337"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a8986b585fa17b43e611714a7a03112cf">00337</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a8986b585fa17b43e611714a7a03112cf">check_alpha_pass</a>(<a class="code" href="../../d3/da9/structBase.html">Base</a> *base)
<a name="l00338"></a>00338 {
<a name="l00339"></a>00339     <span class="keywordflow">if</span> (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ac31d50d415c660a44c0ccdc6b4854721">OB_FROMDUPLI</a>)
<a name="l00340"></a>00340         <span class="keywordflow">return</span> 0;
<a name="l00341"></a>00341 
<a name="l00342"></a>00342     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.f &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a7bc3ff94aabaed488f0d9b7199d11d22">G_PICKSEL</a>)
<a name="l00343"></a>00343         <span class="keywordflow">return</span> 0;
<a name="l00344"></a>00344     
<a name="l00345"></a>00345     <span class="keywordflow">return</span> (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a2e4203e6270100e25ef3d5ec64fc31a6">dtx</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a0ed6e1b47d274d4a990ad765bad2483f">OB_DRAWTRANSP</a>);
<a name="l00346"></a>00346 }
<a name="l00347"></a>00347 
<a name="l00348"></a>00348 <span class="comment">/***/</span>
<a name="l00349"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a1e463a8c474cdc32ead182590186e02f">00349</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a1e463a8c474cdc32ead182590186e02f">colortab</a>[24] =
<a name="l00350"></a>00350 {0x0,       0xFF88FF, 0xFFBBFF,
<a name="l00351"></a>00351  0x403000,  0xFFFF88, 0xFFFFBB,
<a name="l00352"></a>00352  0x104040,  0x66CCCC, 0x77CCCC,
<a name="l00353"></a>00353  0x104010,  0x55BB55, 0x66FF66,
<a name="l00354"></a>00354  0xFFFFFF};
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 
<a name="l00357"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a6da5962c90de0a2f82edd4dabe4762b3">00357</a> <span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../df/d81/structcube.html">cube</a>[8][3] = {
<a name="l00358"></a>00358     {-1.0, -1.0, -1.0},
<a name="l00359"></a>00359     {-1.0, -1.0,  1.0},
<a name="l00360"></a>00360     {-1.0,  1.0,  1.0},
<a name="l00361"></a>00361     {-1.0,  1.0, -1.0},
<a name="l00362"></a>00362     { 1.0, -1.0, -1.0},
<a name="l00363"></a>00363     { 1.0, -1.0,  1.0},
<a name="l00364"></a>00364     { 1.0,  1.0,  1.0},
<a name="l00365"></a>00365     { 1.0,  1.0, -1.0},
<a name="l00366"></a>00366 };
<a name="l00367"></a>00367 
<a name="l00368"></a>00368 <span class="comment">/* ----------------- OpenGL Circle Drawing - Tables for Optimized Drawing Speed ------------------ */</span>
<a name="l00369"></a>00369 <span class="comment">/* 32 values of sin function (still same result!) */</span>
<a name="l00370"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a87f1e315b48757f310023ad69320612e">00370</a> <span class="preprocessor">#define CIRCLE_RESOL 32</span>
<a name="l00371"></a>00371 <span class="preprocessor"></span>
<a name="l00372"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ab987af64fdf0720a928f8b0a353a666a">00372</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ab987af64fdf0720a928f8b0a353a666a">sinval</a>[<a class="code" href="../../d3/d02/drawobject_8c.html#a87f1e315b48757f310023ad69320612e">CIRCLE_RESOL</a>] = {
<a name="l00373"></a>00373     0.00000000,
<a name="l00374"></a>00374     0.20129852,
<a name="l00375"></a>00375     0.39435585,
<a name="l00376"></a>00376     0.57126821,
<a name="l00377"></a>00377     0.72479278,
<a name="l00378"></a>00378     0.84864425,
<a name="l00379"></a>00379     0.93775213,
<a name="l00380"></a>00380     0.98846832,
<a name="l00381"></a>00381     0.99871650,
<a name="l00382"></a>00382     0.96807711,
<a name="l00383"></a>00383     0.89780453,
<a name="l00384"></a>00384     0.79077573,
<a name="l00385"></a>00385     0.65137248,
<a name="l00386"></a>00386     0.48530196,
<a name="l00387"></a>00387     0.29936312,
<a name="l00388"></a>00388     0.10116832,
<a name="l00389"></a>00389     -0.10116832,
<a name="l00390"></a>00390     -0.29936312,
<a name="l00391"></a>00391     -0.48530196,
<a name="l00392"></a>00392     -0.65137248,
<a name="l00393"></a>00393     -0.79077573,
<a name="l00394"></a>00394     -0.89780453,
<a name="l00395"></a>00395     -0.96807711,
<a name="l00396"></a>00396     -0.99871650,
<a name="l00397"></a>00397     -0.98846832,
<a name="l00398"></a>00398     -0.93775213,
<a name="l00399"></a>00399     -0.84864425,
<a name="l00400"></a>00400     -0.72479278,
<a name="l00401"></a>00401     -0.57126821,
<a name="l00402"></a>00402     -0.39435585,
<a name="l00403"></a>00403     -0.20129852,
<a name="l00404"></a>00404     0.00000000
<a name="l00405"></a>00405 };
<a name="l00406"></a>00406 
<a name="l00407"></a>00407 <span class="comment">/* 32 values of cos function (still same result!) */</span>
<a name="l00408"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ad5e6588136f6b5fc21c0271039fe0eaa">00408</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ad5e6588136f6b5fc21c0271039fe0eaa">cosval</a>[<a class="code" href="../../d3/d02/drawobject_8c.html#a87f1e315b48757f310023ad69320612e">CIRCLE_RESOL</a>] = {
<a name="l00409"></a>00409     1.00000000,
<a name="l00410"></a>00410     0.97952994,
<a name="l00411"></a>00411     0.91895781,
<a name="l00412"></a>00412     0.82076344,
<a name="l00413"></a>00413     0.68896691,
<a name="l00414"></a>00414     0.52896401,
<a name="l00415"></a>00415     0.34730525,
<a name="l00416"></a>00416     0.15142777,
<a name="l00417"></a>00417     -0.05064916,
<a name="l00418"></a>00418     -0.25065253,
<a name="l00419"></a>00419     -0.44039415,
<a name="l00420"></a>00420     -0.61210598,
<a name="l00421"></a>00421     -0.75875812,
<a name="l00422"></a>00422     -0.87434661,
<a name="l00423"></a>00423     -0.95413925,
<a name="l00424"></a>00424     -0.99486932,
<a name="l00425"></a>00425     -0.99486932,
<a name="l00426"></a>00426     -0.95413925,
<a name="l00427"></a>00427     -0.87434661,
<a name="l00428"></a>00428     -0.75875812,
<a name="l00429"></a>00429     -0.61210598,
<a name="l00430"></a>00430     -0.44039415,
<a name="l00431"></a>00431     -0.25065253,
<a name="l00432"></a>00432     -0.05064916,
<a name="l00433"></a>00433     0.15142777,
<a name="l00434"></a>00434     0.34730525,
<a name="l00435"></a>00435     0.52896401,
<a name="l00436"></a>00436     0.68896691,
<a name="l00437"></a>00437     0.82076344,
<a name="l00438"></a>00438     0.91895781,
<a name="l00439"></a>00439     0.97952994,
<a name="l00440"></a>00440     1.00000000
<a name="l00441"></a>00441 };
<a name="l00442"></a>00442 
<a name="l00443"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ab5d17d80734309f7991c4c51906a63ce">00443</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ab5d17d80734309f7991c4c51906a63ce">draw_xyz_wire</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> c[3], <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>, <span class="keywordtype">int</span> axis)
<a name="l00444"></a>00444 {
<a name="l00445"></a>00445     <span class="keywordtype">float</span> v1[3] = {0.f, 0.f, 0.f}, v2[3] = {0.f, 0.f, 0.f};
<a name="l00446"></a>00446     <span class="keywordtype">float</span> dim = size * 0.1f;
<a name="l00447"></a>00447     <span class="keywordtype">float</span> dx[3], dy[3], dz[3];
<a name="l00448"></a>00448 
<a name="l00449"></a>00449     dx[0] = dim; dx[1] = 0.f; dx[2] = 0.f;
<a name="l00450"></a>00450     dy[0] = 0.f; dy[1] = dim; dy[2] = 0.f;
<a name="l00451"></a>00451     dz[0] = 0.f; dz[1] = 0.f; dz[2] = dim;
<a name="l00452"></a>00452 
<a name="l00453"></a>00453     <span class="keywordflow">switch</span> (axis) {
<a name="l00454"></a>00454         <span class="keywordflow">case</span> 0:     <span class="comment">/* x axis */</span>
<a name="l00455"></a>00455             glBegin(GL_LINES);
<a name="l00456"></a>00456             
<a name="l00457"></a>00457             <span class="comment">/* bottom left to top right */</span>
<a name="l00458"></a>00458             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(v1, c, dx);
<a name="l00459"></a>00459             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(v1, dy);
<a name="l00460"></a>00460             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(v2, c, dx);
<a name="l00461"></a>00461             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(v2, dy);
<a name="l00462"></a>00462             
<a name="l00463"></a>00463             glVertex3fv(v1);
<a name="l00464"></a>00464             glVertex3fv(v2);
<a name="l00465"></a>00465             
<a name="l00466"></a>00466             <span class="comment">/* top left to bottom right */</span>
<a name="l00467"></a>00467             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(dy, 2.f);
<a name="l00468"></a>00468             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(v1, dy);
<a name="l00469"></a>00469             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(v2, dy);
<a name="l00470"></a>00470             
<a name="l00471"></a>00471             glVertex3fv(v1);
<a name="l00472"></a>00472             glVertex3fv(v2);
<a name="l00473"></a>00473             
<a name="l00474"></a>00474             glEnd();
<a name="l00475"></a>00475             <span class="keywordflow">break</span>;
<a name="l00476"></a>00476         <span class="keywordflow">case</span> 1:     <span class="comment">/* y axis */</span>
<a name="l00477"></a>00477             glBegin(GL_LINES);
<a name="l00478"></a>00478             
<a name="l00479"></a>00479             <span class="comment">/* bottom left to top right */</span>
<a name="l00480"></a>00480             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(dx, 0.75f);
<a name="l00481"></a>00481             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(v1, c, dx);
<a name="l00482"></a>00482             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(v1, dy);
<a name="l00483"></a>00483             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(v2, c, dx);
<a name="l00484"></a>00484             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(v2, dy);
<a name="l00485"></a>00485             
<a name="l00486"></a>00486             glVertex3fv(v1);
<a name="l00487"></a>00487             glVertex3fv(v2);
<a name="l00488"></a>00488             
<a name="l00489"></a>00489             <span class="comment">/* top left to center */</span>
<a name="l00490"></a>00490             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(dy, 2.f);
<a name="l00491"></a>00491             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(v1, dy);
<a name="l00492"></a>00492             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(v2, c);
<a name="l00493"></a>00493             
<a name="l00494"></a>00494             glVertex3fv(v1);
<a name="l00495"></a>00495             glVertex3fv(v2);
<a name="l00496"></a>00496             
<a name="l00497"></a>00497             glEnd();
<a name="l00498"></a>00498             <span class="keywordflow">break</span>;
<a name="l00499"></a>00499         <span class="keywordflow">case</span> 2:     <span class="comment">/* z axis */</span>
<a name="l00500"></a>00500             glBegin(GL_LINE_STRIP);
<a name="l00501"></a>00501             
<a name="l00502"></a>00502             <span class="comment">/* start at top left */</span>
<a name="l00503"></a>00503             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(v1, c, dx);
<a name="l00504"></a>00504             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(v1, c, dz);
<a name="l00505"></a>00505             
<a name="l00506"></a>00506             glVertex3fv(v1);
<a name="l00507"></a>00507             
<a name="l00508"></a>00508             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(dx, 2.f);
<a name="l00509"></a>00509             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(v1, dx);
<a name="l00510"></a>00510 
<a name="l00511"></a>00511             glVertex3fv(v1);
<a name="l00512"></a>00512             
<a name="l00513"></a>00513             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(dz, 2.f);
<a name="l00514"></a>00514             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(v1, dx);
<a name="l00515"></a>00515             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(v1, dz);
<a name="l00516"></a>00516             
<a name="l00517"></a>00517             glVertex3fv(v1);
<a name="l00518"></a>00518             
<a name="l00519"></a>00519             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(v1, dx);
<a name="l00520"></a>00520         
<a name="l00521"></a>00521             glVertex3fv(v1);
<a name="l00522"></a>00522             
<a name="l00523"></a>00523             glEnd();
<a name="l00524"></a>00524             <span class="keywordflow">break</span>;
<a name="l00525"></a>00525     }
<a name="l00526"></a>00526     
<a name="l00527"></a>00527 }
<a name="l00528"></a>00528 
<a name="l00529"></a><a class="code" href="../../d4/df4/view3d__intern_8h.html#a3a22182290000ba6cce2b8d3eb8c3cc3">00529</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a3a22182290000ba6cce2b8d3eb8c3cc3">drawaxes</a>(<span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>, <span class="keywordtype">char</span> drawtype)
<a name="l00530"></a>00530 {
<a name="l00531"></a>00531     <span class="keywordtype">int</span> axis;
<a name="l00532"></a>00532     <span class="keywordtype">float</span> v1[3] = {0.0, 0.0, 0.0};
<a name="l00533"></a>00533     <span class="keywordtype">float</span> v2[3] = {0.0, 0.0, 0.0};
<a name="l00534"></a>00534     <span class="keywordtype">float</span> v3[3] = {0.0, 0.0, 0.0};
<a name="l00535"></a>00535     
<a name="l00536"></a>00536     <span class="keywordflow">switch</span> (drawtype) {
<a name="l00537"></a>00537 
<a name="l00538"></a>00538         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9d1de056519bc074a2b9274320833f46">OB_PLAINAXES</a>:
<a name="l00539"></a>00539             <span class="keywordflow">for</span> (axis = 0; axis &lt; 3; axis++) {
<a name="l00540"></a>00540                 glBegin(GL_LINES);
<a name="l00541"></a>00541 
<a name="l00542"></a>00542                 v1[axis] = <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l00543"></a>00543                 v2[axis] = -<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l00544"></a>00544                 glVertex3fv(v1);
<a name="l00545"></a>00545                 glVertex3fv(v2);
<a name="l00546"></a>00546 
<a name="l00547"></a>00547                 <span class="comment">/* reset v1 &amp; v2 to zero */</span>
<a name="l00548"></a>00548                 v1[axis] = v2[axis] = 0.0f;
<a name="l00549"></a>00549 
<a name="l00550"></a>00550                 glEnd();
<a name="l00551"></a>00551             }
<a name="l00552"></a>00552             <span class="keywordflow">break</span>;
<a name="l00553"></a>00553         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#af09502cf85bf2f57eb826eb3926308d0">OB_SINGLE_ARROW</a>:
<a name="l00554"></a>00554 
<a name="l00555"></a>00555             glBegin(GL_LINES);
<a name="l00556"></a>00556             <span class="comment">/* in positive z direction only */</span>
<a name="l00557"></a>00557             v1[2] = <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l00558"></a>00558             glVertex3fv(v1);
<a name="l00559"></a>00559             glVertex3fv(v2);
<a name="l00560"></a>00560             glEnd();
<a name="l00561"></a>00561 
<a name="l00562"></a>00562             <span class="comment">/* square pyramid */</span>
<a name="l00563"></a>00563             glBegin(GL_TRIANGLES);
<a name="l00564"></a>00564 
<a name="l00565"></a>00565             v2[0] = size * 0.035f; v2[1] = size * 0.035f;
<a name="l00566"></a>00566             v3[0] = size * -0.035f; v3[1] = size * 0.035f;
<a name="l00567"></a>00567             v2[2] = v3[2] = size * 0.75f;
<a name="l00568"></a>00568 
<a name="l00569"></a>00569             <span class="keywordflow">for</span> (axis = 0; axis &lt; 4; axis++) {
<a name="l00570"></a>00570                 <span class="keywordflow">if</span> (axis % 2 == 1) {
<a name="l00571"></a>00571                     v2[0] = -v2[0];
<a name="l00572"></a>00572                     v3[1] = -v3[1];
<a name="l00573"></a>00573                 }
<a name="l00574"></a>00574                 <span class="keywordflow">else</span> {
<a name="l00575"></a>00575                     v2[1] = -v2[1];
<a name="l00576"></a>00576                     v3[0] = -v3[0];
<a name="l00577"></a>00577                 }
<a name="l00578"></a>00578 
<a name="l00579"></a>00579                 glVertex3fv(v1);
<a name="l00580"></a>00580                 glVertex3fv(v2);
<a name="l00581"></a>00581                 glVertex3fv(v3);
<a name="l00582"></a>00582 
<a name="l00583"></a>00583             }
<a name="l00584"></a>00584             glEnd();
<a name="l00585"></a>00585 
<a name="l00586"></a>00586             <span class="keywordflow">break</span>;
<a name="l00587"></a>00587         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a65c615b276e7b55a1a2d4974db9c32b1">OB_CUBE</a>:
<a name="l00588"></a>00588             <a class="code" href="../../d3/d02/drawobject_8c.html#a0c9cb577790366f98d5d39975f7446c4">drawcube_size</a>(size);
<a name="l00589"></a>00589             <span class="keywordflow">break</span>;
<a name="l00590"></a>00590 
<a name="l00591"></a>00591         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9ad42672b885dfecdf3e2a367d3e898d">OB_CIRCLE</a>:
<a name="l00592"></a>00592             <a class="code" href="../../d3/d02/drawobject_8c.html#a27a385998c793e123c08108511e866c0">drawcircle_size</a>(size);
<a name="l00593"></a>00593             <span class="keywordflow">break</span>;
<a name="l00594"></a>00594 
<a name="l00595"></a>00595         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a053a3e65fc098e9638469e306d642f82">OB_EMPTY_SPHERE</a>:
<a name="l00596"></a>00596             <a class="code" href="../../d3/d02/drawobject_8c.html#a325de6f098e3581b88d0394d4ad3f0d8">draw_empty_sphere</a>(size);
<a name="l00597"></a>00597             <span class="keywordflow">break</span>;
<a name="l00598"></a>00598 
<a name="l00599"></a>00599         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1414d1ed36599941d99dc98adcc28177">OB_EMPTY_CONE</a>:
<a name="l00600"></a>00600             <a class="code" href="../../d3/d02/drawobject_8c.html#a28068615c786c14b3b89a90d2f1fb806">draw_empty_cone</a>(size);
<a name="l00601"></a>00601             <span class="keywordflow">break</span>;
<a name="l00602"></a>00602 
<a name="l00603"></a>00603         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ad90dfce658bb46e6844de094b5734af9">OB_ARROWS</a>:
<a name="l00604"></a>00604         <span class="keywordflow">default</span>:
<a name="l00605"></a>00605         {
<a name="l00606"></a>00606             <span class="keywordflow">for</span> (axis = 0; axis &lt; 3; axis++) {
<a name="l00607"></a>00607                 <span class="keyword">const</span> <span class="keywordtype">int</span> arrow_axis = (axis == 0) ? 1 : 0;
<a name="l00608"></a>00608 
<a name="l00609"></a>00609                 glBegin(GL_LINES);
<a name="l00610"></a>00610 
<a name="l00611"></a>00611                 v2[axis] = <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l00612"></a>00612                 glVertex3fv(v1);
<a name="l00613"></a>00613                 glVertex3fv(v2);
<a name="l00614"></a>00614                 
<a name="l00615"></a>00615                 v1[axis] = size * 0.85f;
<a name="l00616"></a>00616                 v1[arrow_axis] = -size * 0.08f;
<a name="l00617"></a>00617                 glVertex3fv(v1);
<a name="l00618"></a>00618                 glVertex3fv(v2);
<a name="l00619"></a>00619                 
<a name="l00620"></a>00620                 v1[arrow_axis] = size * 0.08f;
<a name="l00621"></a>00621                 glVertex3fv(v1);
<a name="l00622"></a>00622                 glVertex3fv(v2);
<a name="l00623"></a>00623 
<a name="l00624"></a>00624                 glEnd();
<a name="l00625"></a>00625                 
<a name="l00626"></a>00626                 v2[axis] += size * 0.125f;
<a name="l00627"></a>00627 
<a name="l00628"></a>00628                 <a class="code" href="../../d3/d02/drawobject_8c.html#ab5d17d80734309f7991c4c51906a63ce">draw_xyz_wire</a>(v2, size, axis);
<a name="l00629"></a>00629 
<a name="l00630"></a>00630 
<a name="l00631"></a>00631                 <span class="comment">/* reset v1 &amp; v2 to zero */</span>
<a name="l00632"></a>00632                 v1[arrow_axis] = v1[axis] = v2[axis] = 0.0f;
<a name="l00633"></a>00633             }
<a name="l00634"></a>00634             <span class="keywordflow">break</span>;
<a name="l00635"></a>00635         }
<a name="l00636"></a>00636     }
<a name="l00637"></a>00637 }
<a name="l00638"></a>00638 
<a name="l00639"></a>00639 
<a name="l00640"></a>00640 <span class="comment">/* Function to draw an Image on a empty Object */</span>
<a name="l00641"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a0005888693bf664cd5d95eef4209f615">00641</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a0005888693bf664cd5d95eef4209f615">draw_empty_image</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l00642"></a>00642 {
<a name="l00643"></a>00643     <a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *ima = (<a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00644"></a>00644     <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf = ima ? <a class="code" href="../../d2/d77/BKE__image_8h.html#a82acf4ed18d05029e80437a655baf008">BKE_image_get_ibuf</a>(ima, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00645"></a>00645 
<a name="l00646"></a>00646     <span class="keywordtype">float</span> scale, ofs_x, ofs_y, sca_x, sca_y;
<a name="l00647"></a>00647     <span class="keywordtype">int</span> ima_x, ima_y;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649     <span class="keywordflow">if</span> (ibuf &amp;&amp; (ibuf-&gt;rect == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (ibuf-&gt;rect_float != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {
<a name="l00650"></a>00650         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a3af34b4b5c6b91ddf5b872fcb9e2d66c">IMB_rect_from_float</a>(ibuf);
<a name="l00651"></a>00651     }
<a name="l00652"></a>00652 
<a name="l00653"></a>00653     <span class="comment">/* Get the buffer dimensions so we can fallback to fake ones */</span>
<a name="l00654"></a>00654     <span class="keywordflow">if</span> (ibuf &amp;&amp; ibuf-&gt;rect) {
<a name="l00655"></a>00655         ima_x = ibuf-&gt;x;
<a name="l00656"></a>00656         ima_y = ibuf-&gt;y;
<a name="l00657"></a>00657     }
<a name="l00658"></a>00658     <span class="keywordflow">else</span> {
<a name="l00659"></a>00659         ima_x = 1;
<a name="l00660"></a>00660         ima_y = 1;
<a name="l00661"></a>00661     }
<a name="l00662"></a>00662 
<a name="l00663"></a>00663     <span class="comment">/* Get the image aspect even if the buffer is invalid */</span>
<a name="l00664"></a>00664     <span class="keywordflow">if</span> (ima) {
<a name="l00665"></a>00665         <span class="keywordflow">if</span> (ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aa316a0e981811d7eaa7b413e812fc4d8">aspx</a> &gt; ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a5cdb91d931b057cb5bb7ac683e5598a2">aspy</a>) {
<a name="l00666"></a>00666             sca_x = 1.0f;
<a name="l00667"></a>00667             sca_y = ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a5cdb91d931b057cb5bb7ac683e5598a2">aspy</a> / ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aa316a0e981811d7eaa7b413e812fc4d8">aspx</a>;
<a name="l00668"></a>00668         }
<a name="l00669"></a>00669         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aa316a0e981811d7eaa7b413e812fc4d8">aspx</a> &lt; ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a5cdb91d931b057cb5bb7ac683e5598a2">aspy</a>) {
<a name="l00670"></a>00670             sca_x = ima-&gt;<a class="code" href="../../d8/d00/classImage.html#aa316a0e981811d7eaa7b413e812fc4d8">aspx</a> / ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a5cdb91d931b057cb5bb7ac683e5598a2">aspy</a>;
<a name="l00671"></a>00671             sca_y = 1.0f;
<a name="l00672"></a>00672         }
<a name="l00673"></a>00673         <span class="keywordflow">else</span> {
<a name="l00674"></a>00674             sca_x = 1.0f;
<a name="l00675"></a>00675             sca_y = 1.0f;
<a name="l00676"></a>00676         }
<a name="l00677"></a>00677     }
<a name="l00678"></a>00678     <span class="keywordflow">else</span> {
<a name="l00679"></a>00679         sca_x = 1.0f;
<a name="l00680"></a>00680         sca_y = 1.0f;
<a name="l00681"></a>00681     }
<a name="l00682"></a>00682 
<a name="l00683"></a>00683     <span class="comment">/* Calculate the scale center based on objects origin */</span>
<a name="l00684"></a>00684     ofs_x = ob-&gt;<a class="code" href="../../de/de7/structObject.html#afe1dda263ea54de76b0ae6871719d3c8">ima_ofs</a>[0] * ima_x;
<a name="l00685"></a>00685     ofs_y = ob-&gt;<a class="code" href="../../de/de7/structObject.html#afe1dda263ea54de76b0ae6871719d3c8">ima_ofs</a>[1] * ima_y;
<a name="l00686"></a>00686 
<a name="l00687"></a>00687     glMatrixMode(GL_MODELVIEW);
<a name="l00688"></a>00688     glPushMatrix();
<a name="l00689"></a>00689 
<a name="l00690"></a>00690     <span class="comment">/* Make sure we are drawing at the origin */</span>
<a name="l00691"></a>00691     glTranslatef(0.0f,  0.0f,  0.0f);
<a name="l00692"></a>00692 
<a name="l00693"></a>00693     <span class="comment">/* Calculate Image scale */</span>
<a name="l00694"></a>00694     scale = (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a9f106829a25bed222ba018f0d6d4f54a">empty_drawsize</a> / (float)<a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(ima_x * sca_x, ima_y * sca_y));
<a name="l00695"></a>00695 
<a name="l00696"></a>00696     <span class="comment">/* Set the object scale */</span>
<a name="l00697"></a>00697     glScalef(scale * sca_x, scale * sca_y, 1.0f);
<a name="l00698"></a>00698 
<a name="l00699"></a>00699     <span class="keywordflow">if</span> (ibuf &amp;&amp; ibuf-&gt;rect) {
<a name="l00700"></a>00700         <span class="comment">/* Setup GL params */</span>
<a name="l00701"></a>00701         glEnable(GL_BLEND);
<a name="l00702"></a>00702         glBlendFunc(GL_SRC_ALPHA,  GL_ONE_MINUS_SRC_ALPHA);
<a name="l00703"></a>00703 
<a name="l00704"></a>00704         <span class="comment">/* Use the object color and alpha */</span>
<a name="l00705"></a>00705         glColor4fv(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4c1b357960580f8c11b177ccf9ceccb8">col</a>);
<a name="l00706"></a>00706 
<a name="l00707"></a>00707         <span class="comment">/* Draw the Image on the screen */</span>
<a name="l00708"></a>00708         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#ac573d112048ba54a7ad1a14235a19601">glaDrawPixelsTex</a>(ofs_x, ofs_y, ima_x, ima_y, GL_UNSIGNED_BYTE, ibuf-&gt;rect);
<a name="l00709"></a>00709         glPixelTransferf(GL_ALPHA_SCALE, 1.0f);
<a name="l00710"></a>00710 
<a name="l00711"></a>00711         glDisable(GL_BLEND);
<a name="l00712"></a>00712     }
<a name="l00713"></a>00713 
<a name="l00714"></a>00714     <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>((ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) ? <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531acf22ebe596e9394104b732b077cbec7a">TH_SELECT</a> : <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l00715"></a>00715 
<a name="l00716"></a>00716     <span class="comment">/* Calculate the outline vertex positions */</span>
<a name="l00717"></a>00717     glBegin(GL_LINE_LOOP);
<a name="l00718"></a>00718     glVertex2f(ofs_x, ofs_y);
<a name="l00719"></a>00719     glVertex2f(ofs_x + ima_x, ofs_y);
<a name="l00720"></a>00720     glVertex2f(ofs_x + ima_x, ofs_y + ima_y);
<a name="l00721"></a>00721     glVertex2f(ofs_x, ofs_y + ima_y);
<a name="l00722"></a>00722     glEnd();
<a name="l00723"></a>00723 
<a name="l00724"></a>00724     <span class="comment">/* Reset GL settings */</span>
<a name="l00725"></a>00725     glMatrixMode(GL_MODELVIEW);
<a name="l00726"></a>00726     glPopMatrix();
<a name="l00727"></a>00727 }
<a name="l00728"></a>00728 
<a name="l00729"></a><a class="code" href="../../d3/d02/drawobject_8c.html#af63c35bf9c59de3008d3636f3c9778e6">00729</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#af63c35bf9c59de3008d3636f3c9778e6">circball_array_fill</a>(<span class="keywordtype">float</span> verts[<a class="code" href="../../d3/d02/drawobject_8c.html#a87f1e315b48757f310023ad69320612e">CIRCLE_RESOL</a>][3], <span class="keyword">const</span> <span class="keywordtype">float</span> cent[3], <span class="keywordtype">float</span> rad, <span class="keywordtype">float</span> tmat[][4])
<a name="l00730"></a>00730 {
<a name="l00731"></a>00731     <span class="keywordtype">float</span> vx[3], vy[3];
<a name="l00732"></a>00732     <span class="keywordtype">float</span> *viter = (<span class="keywordtype">float</span> *)verts;
<a name="l00733"></a>00733     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> a;
<a name="l00734"></a>00734 
<a name="l00735"></a>00735     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ad32a55246dbd69dbd150cd3fe480c734">mul_v3_v3fl</a>(vx, tmat[0], rad);
<a name="l00736"></a>00736     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ad32a55246dbd69dbd150cd3fe480c734">mul_v3_v3fl</a>(vy, tmat[1], rad);
<a name="l00737"></a>00737 
<a name="l00738"></a>00738     <span class="keywordflow">for</span> (a = 0; a &lt; <a class="code" href="../../d3/d02/drawobject_8c.html#a87f1e315b48757f310023ad69320612e">CIRCLE_RESOL</a>; a++, viter += 3) {
<a name="l00739"></a>00739         viter[0] = cent[0] + <a class="code" href="../../d3/d02/drawobject_8c.html#ab987af64fdf0720a928f8b0a353a666a">sinval</a>[a] * vx[0] + <a class="code" href="../../d3/d02/drawobject_8c.html#ad5e6588136f6b5fc21c0271039fe0eaa">cosval</a>[a] * vy[0];
<a name="l00740"></a>00740         viter[1] = cent[1] + <a class="code" href="../../d3/d02/drawobject_8c.html#ab987af64fdf0720a928f8b0a353a666a">sinval</a>[a] * vx[1] + <a class="code" href="../../d3/d02/drawobject_8c.html#ad5e6588136f6b5fc21c0271039fe0eaa">cosval</a>[a] * vy[1];
<a name="l00741"></a>00741         viter[2] = cent[2] + <a class="code" href="../../d3/d02/drawobject_8c.html#ab987af64fdf0720a928f8b0a353a666a">sinval</a>[a] * vx[2] + <a class="code" href="../../d3/d02/drawobject_8c.html#ad5e6588136f6b5fc21c0271039fe0eaa">cosval</a>[a] * vy[2];
<a name="l00742"></a>00742     }
<a name="l00743"></a>00743 }
<a name="l00744"></a>00744 
<a name="l00745"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a1fabc18d6380d34e0e2e66c162bdc284">00745</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(<span class="keywordtype">int</span> mode, <span class="keyword">const</span> <span class="keywordtype">float</span> cent[3], <span class="keywordtype">float</span> rad, <span class="keywordtype">float</span> tmat[][4])
<a name="l00746"></a>00746 {
<a name="l00747"></a>00747     <span class="keywordtype">float</span> verts[<a class="code" href="../../d3/d02/drawobject_8c.html#a87f1e315b48757f310023ad69320612e">CIRCLE_RESOL</a>][3];
<a name="l00748"></a>00748 
<a name="l00749"></a>00749     <a class="code" href="../../d3/d02/drawobject_8c.html#af63c35bf9c59de3008d3636f3c9778e6">circball_array_fill</a>(verts, cent, rad, tmat);
<a name="l00750"></a>00750 
<a name="l00751"></a>00751     glEnableClientState(GL_VERTEX_ARRAY);
<a name="l00752"></a>00752     glVertexPointer(3, GL_FLOAT, 0, verts);
<a name="l00753"></a>00753     glDrawArrays(mode, 0, <a class="code" href="../../d3/d02/drawobject_8c.html#a87f1e315b48757f310023ad69320612e">CIRCLE_RESOL</a>);
<a name="l00754"></a>00754     glDisableClientState(GL_VERTEX_ARRAY);
<a name="l00755"></a>00755 }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757 <span class="comment">/* circle for object centers, special_color is for library or ob users */</span>
<a name="l00758"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a5e0c1beaf183e24018f106144cc64d37">00758</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a5e0c1beaf183e24018f106144cc64d37">drawcentercircle</a>(<a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d, <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>[3], <span class="keywordtype">int</span> selstate, <span class="keywordtype">int</span> special_color)
<a name="l00759"></a>00759 {
<a name="l00760"></a>00760     <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a> = <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a6e321972f49ac4f4e1f04b7fc3671d35">ED_view3d_pixel_size</a>(rv3d, co) * (float)<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.obcenter_dia * 0.5f;
<a name="l00761"></a>00761     <span class="keywordtype">float</span> verts[<a class="code" href="../../d3/d02/drawobject_8c.html#a87f1e315b48757f310023ad69320612e">CIRCLE_RESOL</a>][3];
<a name="l00762"></a>00762 
<a name="l00763"></a>00763     <span class="comment">/* using gldepthfunc guarantees that it does write z values,</span>
<a name="l00764"></a>00764 <span class="comment">     * but not checks for it, so centers remain visible independent order of drawing */</span>
<a name="l00765"></a>00765     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#afd443bfd0de5169661f08aa1eeb3bd69">zbuf</a>) glDepthFunc(GL_ALWAYS);
<a name="l00766"></a>00766     glEnable(GL_BLEND);
<a name="l00767"></a>00767     
<a name="l00768"></a>00768     <span class="keywordflow">if</span> (special_color) {
<a name="l00769"></a>00769         <span class="keywordflow">if</span> (selstate == <a class="code" href="../../d2/d7d/ED__types_8h.html#a3a6d3cd70078e6046471ec528a09cd19">ACTIVE</a> || selstate == <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) glColor4ub(0x88, 0xFF, 0xFF, 155);
<a name="l00770"></a>00770 
<a name="l00771"></a>00771         <span class="keywordflow">else</span> glColor4ub(0x55, 0xCC, 0xCC, 155);
<a name="l00772"></a>00772     }
<a name="l00773"></a>00773     <span class="keywordflow">else</span> {
<a name="l00774"></a>00774         <span class="keywordflow">if</span> (selstate == <a class="code" href="../../d2/d7d/ED__types_8h.html#a3a6d3cd70078e6046471ec528a09cd19">ACTIVE</a>) <a class="code" href="../../de/d96/UI__resources_8h.html#a720062ccecc315c2c0588bfab9ad5cfb">UI_ThemeColorShadeAlpha</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531af47479527035752070059cf6669daf09">TH_ACTIVE</a>, 0, -80);
<a name="l00775"></a>00775         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (selstate == <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) <a class="code" href="../../de/d96/UI__resources_8h.html#a720062ccecc315c2c0588bfab9ad5cfb">UI_ThemeColorShadeAlpha</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531acf22ebe596e9394104b732b077cbec7a">TH_SELECT</a>, 0, -80);
<a name="l00776"></a>00776         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (selstate == <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>) <a class="code" href="../../de/d96/UI__resources_8h.html#a720062ccecc315c2c0588bfab9ad5cfb">UI_ThemeColorShadeAlpha</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a56cb220b76a5a0ace472c22380906297">TH_TRANSFORM</a>, 0, -80);
<a name="l00777"></a>00777     }
<a name="l00778"></a>00778 
<a name="l00779"></a>00779     <a class="code" href="../../d3/d02/drawobject_8c.html#af63c35bf9c59de3008d3636f3c9778e6">circball_array_fill</a>(verts, co, size, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#aef4739e48c5265fc0185283cd9f92303">viewinv</a>);
<a name="l00780"></a>00780 
<a name="l00781"></a>00781     <span class="comment">/* enable vertex array */</span>
<a name="l00782"></a>00782     glEnableClientState(GL_VERTEX_ARRAY);
<a name="l00783"></a>00783     glVertexPointer(3, GL_FLOAT, 0, verts);
<a name="l00784"></a>00784 
<a name="l00785"></a>00785     <span class="comment">/* 1. draw filled, blended polygon */</span>
<a name="l00786"></a>00786     glDrawArrays(GL_POLYGON, 0, <a class="code" href="../../d3/d02/drawobject_8c.html#a87f1e315b48757f310023ad69320612e">CIRCLE_RESOL</a>);
<a name="l00787"></a>00787 
<a name="l00788"></a>00788     <span class="comment">/* 2. draw outline */</span>
<a name="l00789"></a>00789     <a class="code" href="../../de/d96/UI__resources_8h.html#a720062ccecc315c2c0588bfab9ad5cfb">UI_ThemeColorShadeAlpha</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>, 0, -30);
<a name="l00790"></a>00790     glDrawArrays(GL_LINE_LOOP, 0, <a class="code" href="../../d3/d02/drawobject_8c.html#a87f1e315b48757f310023ad69320612e">CIRCLE_RESOL</a>);
<a name="l00791"></a>00791 
<a name="l00792"></a>00792     <span class="comment">/* finish up */</span>
<a name="l00793"></a>00793     glDisableClientState(GL_VERTEX_ARRAY);
<a name="l00794"></a>00794 
<a name="l00795"></a>00795     glDisable(GL_BLEND);
<a name="l00796"></a>00796 
<a name="l00797"></a>00797     <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#afd443bfd0de5169661f08aa1eeb3bd69">zbuf</a>) glDepthFunc(GL_LEQUAL);
<a name="l00798"></a>00798 }
<a name="l00799"></a>00799 
<a name="l00800"></a>00800 <span class="comment">/* *********** text drawing for object/particles/armature ************* */</span>
<a name="l00801"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a2dd2ad7732bc71e3f8b8e796af5c0f49">00801</a> <span class="keyword">static</span> <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> <a class="code" href="../../d3/d02/drawobject_8c.html#a2dd2ad7732bc71e3f8b8e796af5c0f49">CachedText</a>[3];
<a name="l00802"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a3550bc2d59436f4cd3ab6c64e02aa0f8">00802</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a3550bc2d59436f4cd3ab6c64e02aa0f8">CachedTextLevel</a> = 0;
<a name="l00803"></a>00803 
<a name="l00804"></a><a class="code" href="../../d2/d47/structViewCachedString.html">00804</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d47/structViewCachedString.html">ViewCachedString</a> {
<a name="l00805"></a><a class="code" href="../../d2/d47/structViewCachedString.html#acf240f4942bf5d5db188fbd08872703e">00805</a>     <span class="keyword">struct </span><a class="code" href="../../d2/d47/structViewCachedString.html">ViewCachedString</a> *<a class="code" href="../../d2/d47/structViewCachedString.html#af1dc53781ef1dcbf071ac9877a6c4472">next</a>, *<a class="code" href="../../d2/d47/structViewCachedString.html#acf240f4942bf5d5db188fbd08872703e">prev</a>;
<a name="l00806"></a><a class="code" href="../../d2/d47/structViewCachedString.html#a74ef1c316c81da14ae26814e00a61df7">00806</a>     <span class="keywordtype">float</span> <a class="code" href="../../d2/d47/structViewCachedString.html#a74ef1c316c81da14ae26814e00a61df7">vec</a>[3];
<a name="l00807"></a>00807     <span class="keyword">union </span>{
<a name="l00808"></a><a class="code" href="../../d2/d47/structViewCachedString.html#af01c791dfdd9011829987139ae10bea0">00808</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="../../d2/d47/structViewCachedString.html#af01c791dfdd9011829987139ae10bea0">ub</a>[4];
<a name="l00809"></a><a class="code" href="../../d2/d47/structViewCachedString.html#a88692fcc15452dafbfb0b57260223a8c">00809</a>         <span class="keywordtype">int</span> <a class="code" href="../../d2/d47/structViewCachedString.html#a88692fcc15452dafbfb0b57260223a8c">pack</a>;
<a name="l00810"></a>00810     } <a class="code" href="../../d2/d47/structViewCachedString.html#a5d3568e4b506a0ed08473de5e459c2f1">col</a>;
<a name="l00811"></a><a class="code" href="../../d2/d47/structViewCachedString.html#aac18cf0f90ccce8f1d5a02a839285b0d">00811</a>     <span class="keywordtype">short</span> <a class="code" href="../../d2/d47/structViewCachedString.html#aac18cf0f90ccce8f1d5a02a839285b0d">sco</a>[2];
<a name="l00812"></a><a class="code" href="../../d2/d47/structViewCachedString.html#a128ed28073d8d730adb5fd2bada23397">00812</a>     <span class="keywordtype">short</span> <a class="code" href="../../d2/d47/structViewCachedString.html#a128ed28073d8d730adb5fd2bada23397">xoffs</a>;
<a name="l00813"></a><a class="code" href="../../d2/d47/structViewCachedString.html#ad6213eda0e9dad409e2cef635975841d">00813</a>     <span class="keywordtype">short</span> <a class="code" href="../../d2/d47/structViewCachedString.html#ad6213eda0e9dad409e2cef635975841d">flag</a>;
<a name="l00814"></a><a class="code" href="../../d2/d47/structViewCachedString.html#a3ef9a68da77d11dec80690b35adfad14">00814</a>     <span class="keywordtype">int</span> <a class="code" href="../../d2/d47/structViewCachedString.html#a3ef9a68da77d11dec80690b35adfad14">str_len</a>, <a class="code" href="../../d2/d47/structViewCachedString.html#a31af9ed175af7c868471e7b54c5c347c">pad</a>;
<a name="l00815"></a>00815     <span class="comment">/* str is allocated past the end */</span>
<a name="l00816"></a>00816 } <a class="code" href="../../d3/d02/drawobject_8c.html#a8777a4c0c1c75f96934660f0bb714097">ViewCachedString</a>;
<a name="l00817"></a>00817 
<a name="l00818"></a><a class="code" href="../../d4/df4/view3d__intern_8h.html#ad72171d5caab24ec508b27b48dadae0e">00818</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ad72171d5caab24ec508b27b48dadae0e">view3d_cached_text_draw_begin</a>(<span class="keywordtype">void</span>)
<a name="l00819"></a>00819 {
<a name="l00820"></a>00820     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *<a class="code" href="../../de/d98/view2d_8c.html#a797c8304dc3e2c8426bf80d1fef49c86">strings</a> = &amp;CachedText[<a class="code" href="../../d3/d02/drawobject_8c.html#a3550bc2d59436f4cd3ab6c64e02aa0f8">CachedTextLevel</a>];
<a name="l00821"></a>00821     strings-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> = strings-&gt;<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00822"></a>00822     <a class="code" href="../../d3/d02/drawobject_8c.html#a3550bc2d59436f4cd3ab6c64e02aa0f8">CachedTextLevel</a>++;
<a name="l00823"></a>00823 }
<a name="l00824"></a>00824 
<a name="l00825"></a><a class="code" href="../../d4/df4/view3d__intern_8h.html#a6de94308481c2e9de88b710de50dad2f">00825</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a6de94308481c2e9de88b710de50dad2f">view3d_cached_text_draw_add</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>[3],
<a name="l00826"></a>00826                                  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>,
<a name="l00827"></a>00827                                  <span class="keywordtype">short</span> xoffs, <span class="keywordtype">short</span> flag,
<a name="l00828"></a>00828                                  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> col[4])
<a name="l00829"></a>00829 {
<a name="l00830"></a>00830     <span class="keywordtype">int</span> alloc_len = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(str) + 1;
<a name="l00831"></a>00831     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *<a class="code" href="../../de/d98/view2d_8c.html#a797c8304dc3e2c8426bf80d1fef49c86">strings</a> = &amp;CachedText[<a class="code" href="../../d3/d02/drawobject_8c.html#a3550bc2d59436f4cd3ab6c64e02aa0f8">CachedTextLevel</a> - 1];
<a name="l00832"></a>00832     <span class="comment">/* TODO, replace with more efficient malloc, perhaps memarena per draw? */</span>
<a name="l00833"></a>00833     <a class="code" href="../../d2/d47/structViewCachedString.html">ViewCachedString</a> *vos = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d2/d47/structViewCachedString.html">ViewCachedString</a>) + alloc_len, <span class="stringliteral">&quot;ViewCachedString&quot;</span>);
<a name="l00834"></a>00834 
<a name="l00835"></a>00835     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(strings, vos);
<a name="l00836"></a>00836     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#a74ef1c316c81da14ae26814e00a61df7">vec</a>, co);
<a name="l00837"></a>00837     vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#a5d3568e4b506a0ed08473de5e459c2f1">col</a>.<a class="code" href="../../d2/d47/structViewCachedString.html#a88692fcc15452dafbfb0b57260223a8c">pack</a> = *((<span class="keywordtype">int</span> *)col);
<a name="l00838"></a>00838     vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#a128ed28073d8d730adb5fd2bada23397">xoffs</a> = xoffs;
<a name="l00839"></a>00839     vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#ad6213eda0e9dad409e2cef635975841d">flag</a> = flag;
<a name="l00840"></a>00840     vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#a3ef9a68da77d11dec80690b35adfad14">str_len</a> = alloc_len - 1;
<a name="l00841"></a>00841 
<a name="l00842"></a>00842     <span class="comment">/* allocate past the end */</span>
<a name="l00843"></a>00843     memcpy(++vos, str, alloc_len);
<a name="l00844"></a>00844 }
<a name="l00845"></a>00845 
<a name="l00846"></a><a class="code" href="../../d4/df4/view3d__intern_8h.html#a831f54b6ec78f73295a73a8e6c90df4f">00846</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a831f54b6ec78f73295a73a8e6c90df4f">view3d_cached_text_draw_end</a>(<a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <span class="keywordtype">int</span> depth_write, <span class="keywordtype">float</span> mat[][4])
<a name="l00847"></a>00847 {
<a name="l00848"></a>00848     <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>;
<a name="l00849"></a>00849     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *<a class="code" href="../../de/d98/view2d_8c.html#a797c8304dc3e2c8426bf80d1fef49c86">strings</a> = &amp;CachedText[<a class="code" href="../../d3/d02/drawobject_8c.html#a3550bc2d59436f4cd3ab6c64e02aa0f8">CachedTextLevel</a> - 1];
<a name="l00850"></a>00850     <a class="code" href="../../d2/d47/structViewCachedString.html">ViewCachedString</a> *vos;
<a name="l00851"></a>00851     <span class="keywordtype">int</span> tot = 0;
<a name="l00852"></a>00852     
<a name="l00853"></a>00853     <span class="comment">/* project first and test */</span>
<a name="l00854"></a>00854     <span class="keywordflow">for</span> (vos = strings-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; vos; vos = vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#af1dc53781ef1dcbf071ac9877a6c4472">next</a>) {
<a name="l00855"></a>00855         <span class="keywordflow">if</span> (mat &amp;&amp; !(vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#ad6213eda0e9dad409e2cef635975841d">flag</a> &amp; <a class="code" href="../../d4/df4/view3d__intern_8h.html#ac2fc067b36e3433922ac41218f33a738">V3D_CACHE_TEXT_WORLDSPACE</a>))
<a name="l00856"></a>00856             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(mat, vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#a74ef1c316c81da14ae26814e00a61df7">vec</a>);
<a name="l00857"></a>00857 
<a name="l00858"></a>00858         <span class="keywordflow">if</span> (vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#ad6213eda0e9dad409e2cef635975841d">flag</a> &amp; <a class="code" href="../../d4/df4/view3d__intern_8h.html#a7e2a2659b0288528267f390c5774b2d4">V3D_CACHE_TEXT_GLOBALSPACE</a>)
<a name="l00859"></a>00859             <a class="code" href="../../d3/d02/drawobject_8c.html#ad31dc916b99f9b7e54c3e97f6f15cb77">view3d_project_short_clip_persmat</a>(ar, vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#a74ef1c316c81da14ae26814e00a61df7">vec</a>, vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#aac18cf0f90ccce8f1d5a02a839285b0d">sco</a>, (vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#ad6213eda0e9dad409e2cef635975841d">flag</a> &amp; <a class="code" href="../../d4/df4/view3d__intern_8h.html#ab4f4b536ee569fd39c3f392d530e6797">V3D_CACHE_TEXT_LOCALCLIP</a>) != 0);
<a name="l00860"></a>00860         <span class="keywordflow">else</span>
<a name="l00861"></a>00861             <a class="code" href="../../d3/d02/drawobject_8c.html#a0445d2c25a4d1c9c6f2d827d9f6d4a5b">view3d_project_short_clip</a>(ar, vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#a74ef1c316c81da14ae26814e00a61df7">vec</a>, vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#aac18cf0f90ccce8f1d5a02a839285b0d">sco</a>, (vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#ad6213eda0e9dad409e2cef635975841d">flag</a> &amp; <a class="code" href="../../d4/df4/view3d__intern_8h.html#ab4f4b536ee569fd39c3f392d530e6797">V3D_CACHE_TEXT_LOCALCLIP</a>) != 0);
<a name="l00862"></a>00862 
<a name="l00863"></a>00863         <span class="keywordflow">if</span> (vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#aac18cf0f90ccce8f1d5a02a839285b0d">sco</a>[0] != <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a9f2d1998b6b3d4dd9472a8092725e0ef">IS_CLIPPED</a>)
<a name="l00864"></a>00864             tot++;
<a name="l00865"></a>00865     }
<a name="l00866"></a>00866 
<a name="l00867"></a>00867     <span class="keywordflow">if</span> (tot) {
<a name="l00868"></a>00868         <span class="keywordtype">int</span> col_pack_prev = 0;
<a name="l00869"></a>00869 
<a name="l00870"></a>00870 <span class="preprocessor">#if 0</span>
<a name="l00871"></a>00871 <span class="preprocessor"></span>        <a class="code" href="../../d4/d07/structbglMats.html">bglMats</a> mats; <span class="comment">/* ZBuffer depth vars */</span>
<a name="l00872"></a>00872         <span class="keywordtype">double</span> ux, uy, uz;
<a name="l00873"></a>00873         <span class="keywordtype">float</span> depth;
<a name="l00874"></a>00874 
<a name="l00875"></a>00875         <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#afd443bfd0de5169661f08aa1eeb3bd69">zbuf</a>)
<a name="l00876"></a>00876             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#abd78cd326e87fcc38d503ead5890d9d4">bgl_get_mats</a>(&amp;mats);
<a name="l00877"></a>00877 <span class="preprocessor">#endif</span>
<a name="l00878"></a>00878 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a077da32c8352d8b7abb4b19919a14cf8">rflag</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5abc2fd47b1dba7a3d7836a57f6af9a9">RV3D_CLIPPING</a>) {
<a name="l00879"></a>00879             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#aa4cf5dc6374c7b1e81b8322fad984ece">ED_view3d_clipping_disable</a>();
<a name="l00880"></a>00880         }
<a name="l00881"></a>00881 
<a name="l00882"></a>00882         glMatrixMode(GL_PROJECTION);
<a name="l00883"></a>00883         glPushMatrix();
<a name="l00884"></a>00884         glMatrixMode(GL_MODELVIEW);
<a name="l00885"></a>00885         glPushMatrix();
<a name="l00886"></a>00886         <a class="code" href="../../d1/d12/ED__screen_8h.html#a2c148e08841a7ffb64470f579a1b6658">ED_region_pixelspace</a>(ar);
<a name="l00887"></a>00887         
<a name="l00888"></a>00888         <span class="keywordflow">if</span> (depth_write) {
<a name="l00889"></a>00889             <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#afd443bfd0de5169661f08aa1eeb3bd69">zbuf</a>) glDisable(GL_DEPTH_TEST);
<a name="l00890"></a>00890         }
<a name="l00891"></a>00891         <span class="keywordflow">else</span> {
<a name="l00892"></a>00892             glDepthMask(0);
<a name="l00893"></a>00893         }
<a name="l00894"></a>00894         
<a name="l00895"></a>00895         <span class="keywordflow">for</span> (vos = strings-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; vos; vos = vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#af1dc53781ef1dcbf071ac9877a6c4472">next</a>) {
<a name="l00896"></a>00896             <span class="comment">/* too slow, reading opengl info while drawing is very bad,</span>
<a name="l00897"></a>00897 <span class="comment">             * better to see if we can use the zbuffer while in pixel space - campbell */</span>
<a name="l00898"></a>00898 <span class="preprocessor">#if 0</span>
<a name="l00899"></a>00899 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#afd443bfd0de5169661f08aa1eeb3bd69">zbuf</a> &amp;&amp; (vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#ad6213eda0e9dad409e2cef635975841d">flag</a> &amp; <a class="code" href="../../d4/df4/view3d__intern_8h.html#a32162f554fa4847688c4f0f3a474780a">V3D_CACHE_TEXT_ZBUF</a>)) {
<a name="l00900"></a>00900                 gluProject(vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#a74ef1c316c81da14ae26814e00a61df7">vec</a>[0], vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#a74ef1c316c81da14ae26814e00a61df7">vec</a>[1], vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#a74ef1c316c81da14ae26814e00a61df7">vec</a>[2], mats.<a class="code" href="../../d4/d07/structbglMats.html#a0d177557f13d0bfad9e691c9ed47fbbf">modelview</a>, mats.<a class="code" href="../../d4/d07/structbglMats.html#a6879ea7b7a7aa876f044916bc22c93f6">projection</a>, (GLint *)mats.<a class="code" href="../../d4/d07/structbglMats.html#afa9aa1f59767b29f1981ae96ceaccbdd">viewport</a>, &amp;ux, &amp;uy, &amp;uz);
<a name="l00901"></a>00901                 glReadPixels(ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> + vos-&gt;mval[0] + vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#a128ed28073d8d730adb5fd2bada23397">xoffs</a>, ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> + vos-&gt;mval[1], 1, 1, GL_DEPTH_COMPONENT, GL_FLOAT, &amp;depth);
<a name="l00902"></a>00902 
<a name="l00903"></a>00903                 <span class="keywordflow">if</span> (uz &gt; depth)
<a name="l00904"></a>00904                     <span class="keywordflow">continue</span>;
<a name="l00905"></a>00905             }
<a name="l00906"></a>00906 <span class="preprocessor">#endif</span>
<a name="l00907"></a>00907 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#aac18cf0f90ccce8f1d5a02a839285b0d">sco</a>[0] != <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a9f2d1998b6b3d4dd9472a8092725e0ef">IS_CLIPPED</a>) {
<a name="l00908"></a>00908                 <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a> = (<span class="keywordtype">char</span> *)(vos + 1);
<a name="l00909"></a>00909 
<a name="l00910"></a>00910                 <span class="keywordflow">if</span> (col_pack_prev != vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#a5d3568e4b506a0ed08473de5e459c2f1">col</a>.<a class="code" href="../../d2/d47/structViewCachedString.html#a88692fcc15452dafbfb0b57260223a8c">pack</a>) {
<a name="l00911"></a>00911                     glColor3ubv(vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#a5d3568e4b506a0ed08473de5e459c2f1">col</a>.<a class="code" href="../../d2/d47/structViewCachedString.html#af01c791dfdd9011829987139ae10bea0">ub</a>);
<a name="l00912"></a>00912                     col_pack_prev = vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#a5d3568e4b506a0ed08473de5e459c2f1">col</a>.<a class="code" href="../../d2/d47/structViewCachedString.html#a88692fcc15452dafbfb0b57260223a8c">pack</a>;
<a name="l00913"></a>00913                 }
<a name="l00914"></a>00914 
<a name="l00915"></a>00915                 ((vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#ad6213eda0e9dad409e2cef635975841d">flag</a> &amp; <a class="code" href="../../d4/df4/view3d__intern_8h.html#a19cf47d47eeef9d2339453c4833c7e77">V3D_CACHE_TEXT_ASCII</a>) ?
<a name="l00916"></a>00916                  <a class="code" href="../../df/d5d/BLF__api_8h.html#a65a4b770f9f92cded5435cbef278ad99">BLF_draw_default_ascii</a> :
<a name="l00917"></a>00917                  <a class="code" href="../../df/d5d/BLF__api_8h.html#a9b623b39b9d6f9049b0777f431d8e76e">BLF_draw_default</a>
<a name="l00918"></a>00918                 )( (float)vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#aac18cf0f90ccce8f1d5a02a839285b0d">sco</a>[0] + vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#a128ed28073d8d730adb5fd2bada23397">xoffs</a>,
<a name="l00919"></a>00919                    (<span class="keywordtype">float</span>)vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#aac18cf0f90ccce8f1d5a02a839285b0d">sco</a>[1],
<a name="l00920"></a>00920                    (depth_write) ? 0.0f : 2.0f,
<a name="l00921"></a>00921                    str,
<a name="l00922"></a>00922                    vos-&gt;<a class="code" href="../../d2/d47/structViewCachedString.html#a3ef9a68da77d11dec80690b35adfad14">str_len</a>);
<a name="l00923"></a>00923             }
<a name="l00924"></a>00924         }
<a name="l00925"></a>00925         
<a name="l00926"></a>00926         <span class="keywordflow">if</span> (depth_write) {
<a name="l00927"></a>00927             <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#afd443bfd0de5169661f08aa1eeb3bd69">zbuf</a>) glEnable(GL_DEPTH_TEST);
<a name="l00928"></a>00928         }
<a name="l00929"></a>00929         <span class="keywordflow">else</span> glDepthMask(1);
<a name="l00930"></a>00930         
<a name="l00931"></a>00931         glMatrixMode(GL_PROJECTION);
<a name="l00932"></a>00932         glPopMatrix();
<a name="l00933"></a>00933         glMatrixMode(GL_MODELVIEW);
<a name="l00934"></a>00934         glPopMatrix();
<a name="l00935"></a>00935 
<a name="l00936"></a>00936         <span class="keywordflow">if</span> (rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a077da32c8352d8b7abb4b19919a14cf8">rflag</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5abc2fd47b1dba7a3d7836a57f6af9a9">RV3D_CLIPPING</a>) {
<a name="l00937"></a>00937             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#acc257e842dc24b77a88376dee00f5f07">ED_view3d_clipping_enable</a>();
<a name="l00938"></a>00938         }
<a name="l00939"></a>00939     }
<a name="l00940"></a>00940     
<a name="l00941"></a>00941     <span class="keywordflow">if</span> (strings-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)
<a name="l00942"></a>00942         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(strings);
<a name="l00943"></a>00943     
<a name="l00944"></a>00944     <a class="code" href="../../d3/d02/drawobject_8c.html#a3550bc2d59436f4cd3ab6c64e02aa0f8">CachedTextLevel</a>--;
<a name="l00945"></a>00945 }
<a name="l00946"></a>00946 
<a name="l00947"></a>00947 <span class="comment">/* ******************** primitive drawing ******************* */</span>
<a name="l00948"></a>00948 
<a name="l00949"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a269166b5f84721dcbcf71ec23bc65763">00949</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a269166b5f84721dcbcf71ec23bc65763">drawcube</a>(<span class="keywordtype">void</span>)
<a name="l00950"></a>00950 {
<a name="l00951"></a>00951 
<a name="l00952"></a>00952     glBegin(GL_LINE_STRIP);
<a name="l00953"></a>00953     glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[0]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[1]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[2]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[3]);
<a name="l00954"></a>00954     glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[0]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[4]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[5]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[6]);
<a name="l00955"></a>00955     glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[7]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[4]);
<a name="l00956"></a>00956     glEnd();
<a name="l00957"></a>00957 
<a name="l00958"></a>00958     glBegin(GL_LINE_STRIP);
<a name="l00959"></a>00959     glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[1]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[5]);
<a name="l00960"></a>00960     glEnd();
<a name="l00961"></a>00961 
<a name="l00962"></a>00962     glBegin(GL_LINE_STRIP);
<a name="l00963"></a>00963     glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[2]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[6]);
<a name="l00964"></a>00964     glEnd();
<a name="l00965"></a>00965 
<a name="l00966"></a>00966     glBegin(GL_LINE_STRIP);
<a name="l00967"></a>00967     glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[3]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[7]);
<a name="l00968"></a>00968     glEnd();
<a name="l00969"></a>00969 }
<a name="l00970"></a>00970 
<a name="l00971"></a>00971 <span class="comment">/* draws a cube on given the scaling of the cube, assuming that </span>
<a name="l00972"></a>00972 <span class="comment"> * all required matrices have been set (used for drawing empties)</span>
<a name="l00973"></a>00973 <span class="comment"> */</span>
<a name="l00974"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a0c9cb577790366f98d5d39975f7446c4">00974</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a0c9cb577790366f98d5d39975f7446c4">drawcube_size</a>(<span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l00975"></a>00975 {
<a name="l00976"></a>00976     glBegin(GL_LINE_STRIP);
<a name="l00977"></a>00977     glVertex3f(-size, -size, -size); glVertex3f(-size, -size, size);
<a name="l00978"></a>00978     glVertex3f(-size, size, size); glVertex3f(-size, size, -size);
<a name="l00979"></a>00979 
<a name="l00980"></a>00980     glVertex3f(-size, -size, -size); glVertex3f(size, -size, -size);
<a name="l00981"></a>00981     glVertex3f(size, -size, size); glVertex3f(size, size, size);
<a name="l00982"></a>00982 
<a name="l00983"></a>00983     glVertex3f(size, size, -size); glVertex3f(size, -size, -size);
<a name="l00984"></a>00984     glEnd();
<a name="l00985"></a>00985 
<a name="l00986"></a>00986     glBegin(GL_LINE_STRIP);
<a name="l00987"></a>00987     glVertex3f(-size, -size, size); glVertex3f(size, -size, size);
<a name="l00988"></a>00988     glEnd();
<a name="l00989"></a>00989 
<a name="l00990"></a>00990     glBegin(GL_LINE_STRIP);
<a name="l00991"></a>00991     glVertex3f(-size, size, size); glVertex3f(size, size, size);
<a name="l00992"></a>00992     glEnd();
<a name="l00993"></a>00993 
<a name="l00994"></a>00994     glBegin(GL_LINE_STRIP);
<a name="l00995"></a>00995     glVertex3f(-size, size, -size); glVertex3f(size, size, -size);
<a name="l00996"></a>00996     glEnd();
<a name="l00997"></a>00997 }
<a name="l00998"></a>00998 
<a name="l00999"></a>00999 <span class="comment">/* this is an unused (old) cube-drawing function based on a given size */</span>
<a name="l01000"></a>01000 <span class="preprocessor">#if 0</span>
<a name="l01001"></a>01001 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a0c9cb577790366f98d5d39975f7446c4">drawcube_size</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>[3])
<a name="l01002"></a>01002 {
<a name="l01003"></a>01003 
<a name="l01004"></a>01004     glPushMatrix();
<a name="l01005"></a>01005     glScalef(size[0],  size[1],  size[2]);
<a name="l01006"></a>01006     
<a name="l01007"></a>01007 
<a name="l01008"></a>01008     glBegin(GL_LINE_STRIP);
<a name="l01009"></a>01009     glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[0]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[1]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[2]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[3]);
<a name="l01010"></a>01010     glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[0]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[4]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[5]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[6]);
<a name="l01011"></a>01011     glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[7]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[4]);
<a name="l01012"></a>01012     glEnd();
<a name="l01013"></a>01013 
<a name="l01014"></a>01014     glBegin(GL_LINE_STRIP);
<a name="l01015"></a>01015     glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[1]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[5]);
<a name="l01016"></a>01016     glEnd();
<a name="l01017"></a>01017 
<a name="l01018"></a>01018     glBegin(GL_LINE_STRIP);
<a name="l01019"></a>01019     glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[2]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[6]);
<a name="l01020"></a>01020     glEnd();
<a name="l01021"></a>01021 
<a name="l01022"></a>01022     glBegin(GL_LINE_STRIP);
<a name="l01023"></a>01023     glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[3]); glVertex3fv(<a class="code" href="../../df/d81/structcube.html">cube</a>[7]);
<a name="l01024"></a>01024     glEnd();
<a name="l01025"></a>01025     
<a name="l01026"></a>01026     glPopMatrix();
<a name="l01027"></a>01027 }
<a name="l01028"></a>01028 <span class="preprocessor">#endif</span>
<a name="l01029"></a>01029 <span class="preprocessor"></span>
<a name="l01030"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ade44b0b868515966b51db336f63b2966">01030</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ade44b0b868515966b51db336f63b2966">drawshadbuflimits</a>(<a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la, <span class="keywordtype">float</span> mat[][4])
<a name="l01031"></a>01031 {
<a name="l01032"></a>01032     <span class="keywordtype">float</span> sta[3], end[3], lavec[3];
<a name="l01033"></a>01033 
<a name="l01034"></a>01034     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a728bb3f38e925644683c9ace0cee4977">negate_v3_v3</a>(lavec, mat[2]);
<a name="l01035"></a>01035     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(lavec);
<a name="l01036"></a>01036 
<a name="l01037"></a>01037     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ac993b3c38bb2d5e7de48e57aab03db7f">madd_v3_v3v3fl</a>(sta, mat[3], lavec, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a156245e4d5ec132d205a5d08afe6657d">clipsta</a>);
<a name="l01038"></a>01038     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ac993b3c38bb2d5e7de48e57aab03db7f">madd_v3_v3v3fl</a>(end, mat[3], lavec, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#ab6fadfcc03d2ecc3b5fa8058dc016e10">clipend</a>);
<a name="l01039"></a>01039 
<a name="l01040"></a>01040     glBegin(GL_LINE_STRIP);
<a name="l01041"></a>01041     glVertex3fv(sta);
<a name="l01042"></a>01042     glVertex3fv(end);
<a name="l01043"></a>01043     glEnd();
<a name="l01044"></a>01044 
<a name="l01045"></a>01045     glPointSize(3.0);
<a name="l01046"></a>01046     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#acbcc8c3223d7fc13a7931b0a1744b240">bglBegin</a>(GL_POINTS);
<a name="l01047"></a>01047     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(sta);
<a name="l01048"></a>01048     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(end);
<a name="l01049"></a>01049     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a2517dcaf453d3e58af25fd4c677dad45">bglEnd</a>();
<a name="l01050"></a>01050     glPointSize(1.0);
<a name="l01051"></a>01051 }
<a name="l01052"></a>01052 
<a name="l01053"></a>01053 
<a name="l01054"></a>01054 
<a name="l01055"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ae685d9e29401aad91a02016b00b0a669">01055</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ae685d9e29401aad91a02016b00b0a669">spotvolume</a>(<span class="keywordtype">float</span> lvec[3], <span class="keywordtype">float</span> vvec[3], <span class="keyword">const</span> <span class="keywordtype">float</span> inp)
<a name="l01056"></a>01056 {
<a name="l01057"></a>01057     <span class="comment">/* camera is at 0,0,0 */</span>
<a name="l01058"></a>01058     <span class="keywordtype">float</span> temp[3], plane[3], mat1[3][3], mat2[3][3], mat3[3][3], mat4[3][3], q[4], <a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>, <a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>, <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>;
<a name="l01059"></a>01059 
<a name="l01060"></a>01060     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(lvec);
<a name="l01061"></a>01061     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(vvec);             <span class="comment">/* is this the correct vector ? */</span>
<a name="l01062"></a>01062 
<a name="l01063"></a>01063     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(temp, vvec, lvec);      <span class="comment">/* equation for a plane through vvec en lvec */</span>
<a name="l01064"></a>01064     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(plane, lvec, temp);     <span class="comment">/* a plane perpendicular to this, parrallel with lvec */</span>
<a name="l01065"></a>01065 
<a name="l01066"></a>01066     <span class="comment">/* vectors are exactly aligned, use the X axis, this is arbitrary */</span>
<a name="l01067"></a>01067     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(plane) == 0.0f)
<a name="l01068"></a>01068         plane[1] = 1.0f;
<a name="l01069"></a>01069 
<a name="l01070"></a>01070     <span class="comment">/* now we&#39;ve got two equations: one of a cone and one of a plane, but we have</span>
<a name="l01071"></a>01071 <span class="comment">     * three unknowns. We remove one unknown by rotating the plane to z=0 (the plane normal) */</span>
<a name="l01072"></a>01072 
<a name="l01073"></a>01073     <span class="comment">/* rotate around cross product vector of (0,0,1) and plane normal, dot product degrees */</span>
<a name="l01074"></a>01074     <span class="comment">/* according definition, we derive cross product is (plane[1],-plane[0],0), en cos = plane[2]);*/</span>
<a name="l01075"></a>01075 
<a name="l01076"></a>01076     <span class="comment">/* translating this comment to english didnt really help me understanding the math! :-) (ton) */</span>
<a name="l01077"></a>01077     
<a name="l01078"></a>01078     q[1] =  plane[1];
<a name="l01079"></a>01079     q[2] = -plane[0];
<a name="l01080"></a>01080     q[3] =  0;
<a name="l01081"></a>01081     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(&amp;q[1]);
<a name="l01082"></a>01082 
<a name="l01083"></a>01083     angle = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a0b0ac0cef781c9d0eb9e57e3702f76db">saacos</a>(plane[2]) / 2.0f;
<a name="l01084"></a>01084     co = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a2503b77b52ff481a3507a596ae1f3938">cosf</a>(angle);
<a name="l01085"></a>01085     si = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a33f9e82220f9ff9453a6557bd04bd8c5">sqrtf</a>(1 - co * co);
<a name="l01086"></a>01086 
<a name="l01087"></a>01087     q[0] =  <a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>;
<a name="l01088"></a>01088     q[1] *= <a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>;
<a name="l01089"></a>01089     q[2] *= <a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>;
<a name="l01090"></a>01090     q[3] =  0;
<a name="l01091"></a>01091 
<a name="l01092"></a>01092     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#ae0343d0ff2af81f054d3916277409507">quat_to_mat3</a>(mat1, q);
<a name="l01093"></a>01093 
<a name="l01094"></a>01094     <span class="comment">/* rotate lamp vector now over acos(inp) degrees */</span>
<a name="l01095"></a>01095     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vvec, lvec);
<a name="l01096"></a>01096 
<a name="l01097"></a>01097     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ac2ec10af660a2f1d912816c842f37bfb">unit_m3</a>(mat2);
<a name="l01098"></a>01098     co = inp;
<a name="l01099"></a>01099     si = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a33f9e82220f9ff9453a6557bd04bd8c5">sqrtf</a>(1.0f - inp * inp);
<a name="l01100"></a>01100 
<a name="l01101"></a>01101     mat2[0][0] =  <a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>;
<a name="l01102"></a>01102     mat2[1][0] = -<a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>;
<a name="l01103"></a>01103     mat2[0][1] =  <a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>;
<a name="l01104"></a>01104     mat2[1][1] =  <a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>;
<a name="l01105"></a>01105     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(mat3, mat2, mat1);
<a name="l01106"></a>01106 
<a name="l01107"></a>01107     mat2[1][0] =  <a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>;
<a name="l01108"></a>01108     mat2[0][1] = -<a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>;
<a name="l01109"></a>01109     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(mat4, mat2, mat1);
<a name="l01110"></a>01110     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad34fc69317ce2354d58d80147b753408">transpose_m3</a>(mat1);
<a name="l01111"></a>01111 
<a name="l01112"></a>01112     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(mat2, mat1, mat3);
<a name="l01113"></a>01113     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(mat2, lvec);
<a name="l01114"></a>01114     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(mat2, mat1, mat4);
<a name="l01115"></a>01115     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(mat2, vvec);
<a name="l01116"></a>01116 
<a name="l01117"></a>01117     <span class="keywordflow">return</span>;
<a name="l01118"></a>01118 }
<a name="l01119"></a>01119 
<a name="l01120"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a3dc6638a8a711445b4a3f7dccda21840">01120</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a3dc6638a8a711445b4a3f7dccda21840">draw_spot_cone</a>(<a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la, <span class="keywordtype">float</span> x, <span class="keywordtype">float</span> z)
<a name="l01121"></a>01121 {
<a name="l01122"></a>01122     z = <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(z);
<a name="l01123"></a>01123 
<a name="l01124"></a>01124     glBegin(GL_TRIANGLE_FAN);
<a name="l01125"></a>01125     glVertex3f(0.0f, 0.0f, -x);
<a name="l01126"></a>01126 
<a name="l01127"></a>01127     <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a1998f8f61376aff315a6b618e8aa6bba">mode</a> &amp; <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#ab52bf56b834bad1d21c3aaa274943059">LA_SQUARE</a>) {
<a name="l01128"></a>01128         glVertex3f(z, z, 0);
<a name="l01129"></a>01129         glVertex3f(-z, z, 0);
<a name="l01130"></a>01130         glVertex3f(-z, -z, 0);
<a name="l01131"></a>01131         glVertex3f(z, -z, 0);
<a name="l01132"></a>01132         glVertex3f(z, z, 0);
<a name="l01133"></a>01133     }
<a name="l01134"></a>01134     <span class="keywordflow">else</span> {
<a name="l01135"></a>01135         <span class="keywordtype">float</span> <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>;
<a name="l01136"></a>01136         <span class="keywordtype">int</span> a;
<a name="l01137"></a>01137 
<a name="l01138"></a>01138         <span class="keywordflow">for</span> (a = 0; a &lt; 33; a++) {
<a name="l01139"></a>01139             angle = a * <a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> * 2 / (33 - 1);
<a name="l01140"></a>01140             glVertex3f(z * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a2503b77b52ff481a3507a596ae1f3938">cosf</a>(angle), z * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a1a55e3226c270625a4bff1befa977638">sinf</a>(angle), 0);
<a name="l01141"></a>01141         }
<a name="l01142"></a>01142     }
<a name="l01143"></a>01143 
<a name="l01144"></a>01144     glEnd();
<a name="l01145"></a>01145 }
<a name="l01146"></a>01146 
<a name="l01147"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a70473f55b1f12db07c71c0430a610450">01147</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a70473f55b1f12db07c71c0430a610450">draw_transp_spot_volume</a>(<a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la, <span class="keywordtype">float</span> x, <span class="keywordtype">float</span> z)
<a name="l01148"></a>01148 {
<a name="l01149"></a>01149     glEnable(GL_CULL_FACE);
<a name="l01150"></a>01150     glEnable(GL_BLEND);
<a name="l01151"></a>01151     glDepthMask(0);
<a name="l01152"></a>01152 
<a name="l01153"></a>01153     <span class="comment">/* draw backside darkening */</span>
<a name="l01154"></a>01154     glCullFace(GL_FRONT);
<a name="l01155"></a>01155 
<a name="l01156"></a>01156     glBlendFunc(GL_ZERO, GL_SRC_ALPHA);
<a name="l01157"></a>01157     glColor4f(0.0f, 0.0f, 0.0f, 0.4f);
<a name="l01158"></a>01158 
<a name="l01159"></a>01159     <a class="code" href="../../d3/d02/drawobject_8c.html#a3dc6638a8a711445b4a3f7dccda21840">draw_spot_cone</a>(la, x, z);
<a name="l01160"></a>01160 
<a name="l01161"></a>01161     <span class="comment">/* draw front side lighting */</span>
<a name="l01162"></a>01162     glCullFace(GL_BACK);
<a name="l01163"></a>01163 
<a name="l01164"></a>01164     glBlendFunc(GL_ONE, GL_ONE);
<a name="l01165"></a>01165     glColor4f(0.2f, 0.2f, 0.2f, 1.0f);
<a name="l01166"></a>01166 
<a name="l01167"></a>01167     <a class="code" href="../../d3/d02/drawobject_8c.html#a3dc6638a8a711445b4a3f7dccda21840">draw_spot_cone</a>(la, x, z);
<a name="l01168"></a>01168 
<a name="l01169"></a>01169     <span class="comment">/* restore state */</span>
<a name="l01170"></a>01170     glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
<a name="l01171"></a>01171     glDisable(GL_BLEND);
<a name="l01172"></a>01172     glDepthMask(1);
<a name="l01173"></a>01173     glDisable(GL_CULL_FACE);
<a name="l01174"></a>01174     glCullFace(GL_BACK);
<a name="l01175"></a>01175 }
<a name="l01176"></a>01176 
<a name="l01177"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ab03eef94f5166b074f18b58f49bf6757">01177</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ab03eef94f5166b074f18b58f49bf6757">drawlamp</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d, <a class="code" href="../../d3/da9/structBase.html">Base</a> *base, <span class="keywordtype">int</span> dt, <span class="keywordtype">int</span> flag)
<a name="l01178"></a>01178 {
<a name="l01179"></a>01179     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l01180"></a>01180     <span class="keyword">const</span> <span class="keywordtype">float</span> pixsize = <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a6e321972f49ac4f4e1f04b7fc3671d35">ED_view3d_pixel_size</a>(rv3d, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3]);
<a name="l01181"></a>01181     <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01182"></a>01182     <span class="keywordtype">float</span> vec[3], lvec[3], vvec[3], circrad, x, y, z;
<a name="l01183"></a>01183     <span class="keywordtype">float</span> lampsize;
<a name="l01184"></a>01184     <span class="keywordtype">float</span> imat[4][4], curcol[4];
<a name="l01185"></a>01185     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> col[4];
<a name="l01186"></a>01186     <span class="comment">/* cone can&#39;t be drawn for duplicated lamps, because duplilist would be freed to */</span>
<a name="l01187"></a>01187     <span class="comment">/* the moment of view3d_draw_transp() call */</span>
<a name="l01188"></a>01188     <span class="keyword">const</span> <span class="keywordtype">short</span> is_view = (rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8f435c152f17185773a21cd8b7067ebb">persp</a> == <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a4c869f8f07a58e54e43d35474bbe4757">RV3D_CAMOB</a> &amp;&amp; v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a> == base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>);
<a name="l01189"></a>01189     <span class="keyword">const</span> <span class="keywordtype">short</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a2b810a77ec9f4541986236361f46ee17">drawcone</a> = ((dt &gt; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>) &amp;&amp;
<a name="l01190"></a>01190                             !(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.f &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a7bc3ff94aabaed488f0d9b7199d11d22">G_PICKSEL</a>) &amp;&amp;
<a name="l01191"></a>01191                             (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6c8bfeca1d8a74252bfe284de7d754cb">type</a> == <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a55ba7e9dc61979b7097cb11dace90bdb">LA_SPOT</a>) &amp;&amp;
<a name="l01192"></a>01192                             (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a1998f8f61376aff315a6b618e8aa6bba">mode</a> &amp; <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#ac3e5e762c62b7388f85714bbece4e56c">LA_SHOW_CONE</a>) &amp;&amp;
<a name="l01193"></a>01193                             !(base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ac31d50d415c660a44c0ccdc6b4854721">OB_FROMDUPLI</a>) &amp;&amp;
<a name="l01194"></a>01194                             !is_view);
<a name="l01195"></a>01195 
<a name="l01196"></a>01196     <span class="keywordflow">if</span> (drawcone &amp;&amp; !v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#ae22790924a440701ed3d01ad4db5eee2">transp</a>) {
<a name="l01197"></a>01197         <span class="comment">/* in this case we need to draw delayed */</span>
<a name="l01198"></a>01198         <a class="code" href="../../d8/d7f/view3d__draw_8c.html#a62d12554313bcbe2e30a7e7eda84aa59">add_view3d_after</a>(&amp;v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#aa50bdf2e33288df03e6ee33f75806c4f">afterdraw_transp</a>, base, flag);
<a name="l01199"></a>01199         <span class="keywordflow">return</span>;
<a name="l01200"></a>01200     }
<a name="l01201"></a>01201     
<a name="l01202"></a>01202     <span class="comment">/* we first draw only the screen aligned &amp; fixed scale stuff */</span>
<a name="l01203"></a>01203     glPushMatrix();
<a name="l01204"></a>01204     <a class="code" href="../../dd/d44/BIF__gl_8h.html#a968938b254020ac622d83a3ab1226f4a">glLoadMatrixf</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ad04178a1375cc4ef5c59a76b723f822f">viewmat</a>);
<a name="l01205"></a>01205 
<a name="l01206"></a>01206     <span class="comment">/* lets calculate the scale: */</span>
<a name="l01207"></a>01207     lampsize = pixsize * ((float)<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.obcenter_dia * 0.5f);
<a name="l01208"></a>01208 
<a name="l01209"></a>01209     <span class="comment">/* and view aligned matrix: */</span>
<a name="l01210"></a>01210     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(imat, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#aef4739e48c5265fc0185283cd9f92303">viewinv</a>);
<a name="l01211"></a>01211     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(imat[0]);
<a name="l01212"></a>01212     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(imat[1]);
<a name="l01213"></a>01213 
<a name="l01214"></a>01214     <span class="comment">/* lamp center */</span>
<a name="l01215"></a>01215     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3]);
<a name="l01216"></a>01216     
<a name="l01217"></a>01217     <span class="comment">/* for AA effects */</span>
<a name="l01218"></a>01218     glGetFloatv(GL_CURRENT_COLOR, curcol);
<a name="l01219"></a>01219     curcol[3] = 0.6;
<a name="l01220"></a>01220     glColor4fv(curcol);
<a name="l01221"></a>01221     
<a name="l01222"></a>01222     <span class="keywordflow">if</span> (lampsize &gt; 0.0f) {
<a name="l01223"></a>01223 
<a name="l01224"></a>01224         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a> &gt; 1) {
<a name="l01225"></a>01225             <span class="keywordflow">if</span> (ob == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a119935c54737bd111df8fd516c390000">OBACT</a> || (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) glColor4ub(0x88, 0xFF, 0xFF, 155);
<a name="l01226"></a>01226             <span class="keywordflow">else</span> glColor4ub(0x77, 0xCC, 0xCC, 155);
<a name="l01227"></a>01227         }
<a name="l01228"></a>01228         
<a name="l01229"></a>01229         <span class="comment">/* Inner Circle */</span>
<a name="l01230"></a>01230         glEnable(GL_BLEND);
<a name="l01231"></a>01231         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, vec, lampsize, imat);
<a name="l01232"></a>01232         glDisable(GL_BLEND);
<a name="l01233"></a>01233         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_POLYGON, vec, lampsize, imat);
<a name="l01234"></a>01234         
<a name="l01235"></a>01235         <span class="comment">/* restore */</span>
<a name="l01236"></a>01236         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a> &gt; 1)
<a name="l01237"></a>01237             glColor4fv(curcol);
<a name="l01238"></a>01238 
<a name="l01239"></a>01239         <span class="comment">/* Outer circle */</span>
<a name="l01240"></a>01240         circrad = 3.0f * lampsize;
<a name="l01241"></a>01241         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(3);
<a name="l01242"></a>01242 
<a name="l01243"></a>01243         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, vec, circrad, imat);
<a name="l01244"></a>01244 
<a name="l01245"></a>01245         <span class="comment">/* draw dashed outer circle if shadow is on. remember some lamps can&#39;t have certain shadows! */</span>
<a name="l01246"></a>01246         <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6c8bfeca1d8a74252bfe284de7d754cb">type</a> != <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#acf32ec4edbecc1bb275c15d7b7c3496f">LA_HEMI</a>) {
<a name="l01247"></a>01247             <span class="keywordflow">if</span> ((la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a1998f8f61376aff315a6b618e8aa6bba">mode</a> &amp; <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a19442e8ee945704d7977da073a206e8f">LA_SHAD_RAY</a>) || ((la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a1998f8f61376aff315a6b618e8aa6bba">mode</a> &amp; <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a6d46bae4e340f7043f9507eaf1293c72">LA_SHAD_BUF</a>) &amp;&amp; (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6c8bfeca1d8a74252bfe284de7d754cb">type</a> == <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a55ba7e9dc61979b7097cb11dace90bdb">LA_SPOT</a>))) {
<a name="l01248"></a>01248                 <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, vec, circrad + 3.0f * pixsize, imat);
<a name="l01249"></a>01249             }
<a name="l01250"></a>01250         }
<a name="l01251"></a>01251     }
<a name="l01252"></a>01252     <span class="keywordflow">else</span> {
<a name="l01253"></a>01253         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(3);
<a name="l01254"></a>01254         circrad = 0.0f;
<a name="l01255"></a>01255     }
<a name="l01256"></a>01256     
<a name="l01257"></a>01257     <span class="comment">/* draw the pretty sun rays */</span>
<a name="l01258"></a>01258     <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6c8bfeca1d8a74252bfe284de7d754cb">type</a> == <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a863bf336582eacc01aec51ebf0a5f412">LA_SUN</a>) {
<a name="l01259"></a>01259         <span class="keywordtype">float</span> v1[3], v2[3], mat[3][3];
<a name="l01260"></a>01260         <span class="keywordtype">short</span> axis;
<a name="l01261"></a>01261         
<a name="l01262"></a>01262         <span class="comment">/* setup a 45 degree rotation matrix */</span>
<a name="l01263"></a>01263         <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a46606cf0bbd44c8a610848bfdaf685c0">vec_rot_to_mat3</a>(mat, imat[2], (<span class="keywordtype">float</span>)<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> / 4.0f);
<a name="l01264"></a>01264         
<a name="l01265"></a>01265         <span class="comment">/* vectors */</span>
<a name="l01266"></a>01266         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ad32a55246dbd69dbd150cd3fe480c734">mul_v3_v3fl</a>(v1, imat[0], circrad * 1.2f);
<a name="l01267"></a>01267         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ad32a55246dbd69dbd150cd3fe480c734">mul_v3_v3fl</a>(v2, imat[0], circrad * 2.5f);
<a name="l01268"></a>01268         
<a name="l01269"></a>01269         <span class="comment">/* center */</span>
<a name="l01270"></a>01270         glTranslatef(vec[0], vec[1], vec[2]);
<a name="l01271"></a>01271         
<a name="l01272"></a>01272         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(3);
<a name="l01273"></a>01273         
<a name="l01274"></a>01274         glBegin(GL_LINES);
<a name="l01275"></a>01275         <span class="keywordflow">for</span> (axis = 0; axis &lt; 8; axis++) {
<a name="l01276"></a>01276             glVertex3fv(v1);
<a name="l01277"></a>01277             glVertex3fv(v2);
<a name="l01278"></a>01278             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(mat, v1);
<a name="l01279"></a>01279             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(mat, v2);
<a name="l01280"></a>01280         }
<a name="l01281"></a>01281         glEnd();
<a name="l01282"></a>01282         
<a name="l01283"></a>01283         glTranslatef(-vec[0], -vec[1], -vec[2]);
<a name="l01284"></a>01284 
<a name="l01285"></a>01285     }
<a name="l01286"></a>01286     
<a name="l01287"></a>01287     <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6c8bfeca1d8a74252bfe284de7d754cb">type</a> == <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#ab67de808c369ec7696aff85a24eace8e">LA_LOCAL</a>) {
<a name="l01288"></a>01288         <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a1998f8f61376aff315a6b618e8aa6bba">mode</a> &amp; <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a6d59a2aff598eff08f19650920459fa8">LA_SPHERE</a>) {
<a name="l01289"></a>01289             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, vec, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a7dfb335997197bb8a645e3540a91bf4d">dist</a>, imat);
<a name="l01290"></a>01290         }
<a name="l01291"></a>01291     }
<a name="l01292"></a>01292     
<a name="l01293"></a>01293     glPopMatrix();  <span class="comment">/* back in object space */</span>
<a name="l01294"></a>01294     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#acd4d89007c860a4c74d459ac72593065">zero_v3</a>(vec);
<a name="l01295"></a>01295     
<a name="l01296"></a>01296     <span class="keywordflow">if</span> (is_view) {
<a name="l01297"></a>01297         <span class="comment">/* skip drawing extra info */</span>
<a name="l01298"></a>01298     }
<a name="l01299"></a>01299     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6c8bfeca1d8a74252bfe284de7d754cb">type</a> == <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a55ba7e9dc61979b7097cb11dace90bdb">LA_SPOT</a>) || (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6c8bfeca1d8a74252bfe284de7d754cb">type</a> == <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a3702fbb4c76f7b3c21aa19942dc26b5d">LA_YF_PHOTON</a>)) {
<a name="l01300"></a>01300         lvec[0] = lvec[1] = 0.0;
<a name="l01301"></a>01301         lvec[2] = 1.0;
<a name="l01302"></a>01302         x = rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8ab36b8b8caeec087fd9595c33e90775">persmat</a>[0][2];
<a name="l01303"></a>01303         y = rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8ab36b8b8caeec087fd9595c33e90775">persmat</a>[1][2];
<a name="l01304"></a>01304         z = rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8ab36b8b8caeec087fd9595c33e90775">persmat</a>[2][2];
<a name="l01305"></a>01305         vvec[0] = x * ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[0][0] + y * ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[0][1] + z * ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[0][2];
<a name="l01306"></a>01306         vvec[1] = x * ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[1][0] + y * ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[1][1] + z * ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[1][2];
<a name="l01307"></a>01307         vvec[2] = x * ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[2][0] + y * ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[2][1] + z * ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[2][2];
<a name="l01308"></a>01308 
<a name="l01309"></a>01309         y = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a2503b77b52ff481a3507a596ae1f3938">cosf</a>(la-&gt;<a class="code" href="../../d5/d72/structLamp.html#afbf90c480b2728c3b48a5680dd4a9487">spotsize</a> * (<span class="keywordtype">float</span>)(<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> / 360.0));
<a name="l01310"></a>01310         <a class="code" href="../../d3/d02/drawobject_8c.html#ae685d9e29401aad91a02016b00b0a669">spotvolume</a>(lvec, vvec, y);
<a name="l01311"></a>01311         x = -la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a7dfb335997197bb8a645e3540a91bf4d">dist</a>;
<a name="l01312"></a>01312         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(lvec, x);
<a name="l01313"></a>01313         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(vvec, x);
<a name="l01314"></a>01314 
<a name="l01315"></a>01315         <span class="comment">/* draw the angled sides of the cone */</span>
<a name="l01316"></a>01316         glBegin(GL_LINE_STRIP);
<a name="l01317"></a>01317         glVertex3fv(vvec);
<a name="l01318"></a>01318         glVertex3fv(vec);
<a name="l01319"></a>01319         glVertex3fv(lvec);
<a name="l01320"></a>01320         glEnd();
<a name="l01321"></a>01321         
<a name="l01322"></a>01322         z = x * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a33f9e82220f9ff9453a6557bd04bd8c5">sqrtf</a>(1.0f - y * y);
<a name="l01323"></a>01323         x *= y;
<a name="l01324"></a>01324 
<a name="l01325"></a>01325         <span class="comment">/* draw the circle/square at the end of the cone */</span>
<a name="l01326"></a>01326         glTranslatef(0.0, 0.0,  x);
<a name="l01327"></a>01327         <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a1998f8f61376aff315a6b618e8aa6bba">mode</a> &amp; <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#ab52bf56b834bad1d21c3aaa274943059">LA_SQUARE</a>) {
<a name="l01328"></a>01328             <span class="keywordtype">float</span> tvec[3];
<a name="l01329"></a>01329             <span class="keywordtype">float</span> z_abs = <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(z);
<a name="l01330"></a>01330 
<a name="l01331"></a>01331             tvec[0] = tvec[1] = z_abs;
<a name="l01332"></a>01332             tvec[2] = 0.0;
<a name="l01333"></a>01333 
<a name="l01334"></a>01334             glBegin(GL_LINE_LOOP);
<a name="l01335"></a>01335             glVertex3fv(tvec);
<a name="l01336"></a>01336             tvec[1] = -z_abs; <span class="comment">/* neg */</span>
<a name="l01337"></a>01337             glVertex3fv(tvec);
<a name="l01338"></a>01338             tvec[0] = -z_abs; <span class="comment">/* neg */</span>
<a name="l01339"></a>01339             glVertex3fv(tvec);
<a name="l01340"></a>01340             tvec[1] = z_abs; <span class="comment">/* pos */</span>
<a name="l01341"></a>01341             glVertex3fv(tvec);
<a name="l01342"></a>01342             glEnd();
<a name="l01343"></a>01343         }
<a name="l01344"></a>01344         <span class="keywordflow">else</span> <a class="code" href="../../d8/d7f/view3d__draw_8c.html#a30827d412673b6d41bb128255520a525">circ</a>(0.0, 0.0, <a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(z));
<a name="l01345"></a>01345         
<a name="l01346"></a>01346         <span class="comment">/* draw the circle/square representing spotbl */</span>
<a name="l01347"></a>01347         <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6c8bfeca1d8a74252bfe284de7d754cb">type</a> == <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a55ba7e9dc61979b7097cb11dace90bdb">LA_SPOT</a>) {
<a name="l01348"></a>01348             <span class="keywordtype">float</span> spotblcirc = <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(z) * (1 - <a class="code" href="../../d7/d47/NM__Scalar_8h.html#af46040b4ed6734ce0bcafe3e53d46dd3">pow</a>(la-&gt;<a class="code" href="../../d5/d72/structLamp.html#afa8564cb927dc5cf1398f89526db5fc1">spotblend</a>, 2));
<a name="l01349"></a>01349             <span class="comment">/* hide line if it is zero size or overlaps with outer border,</span>
<a name="l01350"></a>01350 <span class="comment">             * previously it adjusted to always to show it but that seems</span>
<a name="l01351"></a>01351 <span class="comment">             * confusing because it doesn&#39;t show the actual blend size */</span>
<a name="l01352"></a>01352             <span class="keywordflow">if</span> (spotblcirc != 0 &amp;&amp; spotblcirc != <a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(z))
<a name="l01353"></a>01353                 <a class="code" href="../../d8/d7f/view3d__draw_8c.html#a30827d412673b6d41bb128255520a525">circ</a>(0.0, 0.0, spotblcirc);
<a name="l01354"></a>01354         }
<a name="l01355"></a>01355 
<a name="l01356"></a>01356         <span class="keywordflow">if</span> (drawcone)
<a name="l01357"></a>01357             <a class="code" href="../../d3/d02/drawobject_8c.html#a70473f55b1f12db07c71c0430a610450">draw_transp_spot_volume</a>(la, x, z);
<a name="l01358"></a>01358 
<a name="l01359"></a>01359         <span class="comment">/* draw clip start, useful for wide cones where its not obvious where the start is */</span>
<a name="l01360"></a>01360         glTranslatef(0.0, 0.0, -x);  <span class="comment">/* reverse translation above */</span>
<a name="l01361"></a>01361         <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6c8bfeca1d8a74252bfe284de7d754cb">type</a> == <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a55ba7e9dc61979b7097cb11dace90bdb">LA_SPOT</a> &amp;&amp; (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a1998f8f61376aff315a6b618e8aa6bba">mode</a> &amp; <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a6d46bae4e340f7043f9507eaf1293c72">LA_SHAD_BUF</a>) ) {
<a name="l01362"></a>01362             <span class="keywordtype">float</span> lvec_clip[3];
<a name="l01363"></a>01363             <span class="keywordtype">float</span> vvec_clip[3];
<a name="l01364"></a>01364             <span class="keywordtype">float</span> clipsta_fac = la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a156245e4d5ec132d205a5d08afe6657d">clipsta</a> / -x;
<a name="l01365"></a>01365 
<a name="l01366"></a>01366             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1527309f09525ae91ed04692da13ba98">interp_v3_v3v3</a>(lvec_clip, vec, lvec, clipsta_fac);
<a name="l01367"></a>01367             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1527309f09525ae91ed04692da13ba98">interp_v3_v3v3</a>(vvec_clip, vec, vvec, clipsta_fac);
<a name="l01368"></a>01368 
<a name="l01369"></a>01369             glBegin(GL_LINE_STRIP);
<a name="l01370"></a>01370             glVertex3fv(lvec_clip);
<a name="l01371"></a>01371             glVertex3fv(vvec_clip);
<a name="l01372"></a>01372             glEnd();
<a name="l01373"></a>01373         }
<a name="l01374"></a>01374     }
<a name="l01375"></a>01375     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6c8bfeca1d8a74252bfe284de7d754cb">type</a>, <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#acf32ec4edbecc1bb275c15d7b7c3496f">LA_HEMI</a>, <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a863bf336582eacc01aec51ebf0a5f412">LA_SUN</a>)) {
<a name="l01376"></a>01376         
<a name="l01377"></a>01377         <span class="comment">/* draw the line from the circle along the dist */</span>
<a name="l01378"></a>01378         glBegin(GL_LINE_STRIP);
<a name="l01379"></a>01379         vec[2] = -circrad;
<a name="l01380"></a>01380         glVertex3fv(vec);
<a name="l01381"></a>01381         vec[2] = -la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a7dfb335997197bb8a645e3540a91bf4d">dist</a>;
<a name="l01382"></a>01382         glVertex3fv(vec);
<a name="l01383"></a>01383         glEnd();
<a name="l01384"></a>01384         
<a name="l01385"></a>01385         <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6c8bfeca1d8a74252bfe284de7d754cb">type</a> == <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#acf32ec4edbecc1bb275c15d7b7c3496f">LA_HEMI</a>) {
<a name="l01386"></a>01386             <span class="comment">/* draw the hemisphere curves */</span>
<a name="l01387"></a>01387             <span class="keywordtype">short</span> axis, steps, dir;
<a name="l01388"></a>01388             <span class="keywordtype">float</span> outdist, zdist, <a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a0ea807db9b245d41852d0326d715cc0b">mul</a>;
<a name="l01389"></a>01389             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#acd4d89007c860a4c74d459ac72593065">zero_v3</a>(vec);
<a name="l01390"></a>01390             outdist = 0.14; mul = 1.4; dir = 1;
<a name="l01391"></a>01391             
<a name="l01392"></a>01392             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(4);
<a name="l01393"></a>01393             <span class="comment">/* loop over the 4 compass points, and draw each arc as a LINE_STRIP */</span>
<a name="l01394"></a>01394             <span class="keywordflow">for</span> (axis = 0; axis &lt; 4; axis++) {
<a name="l01395"></a>01395                 <span class="keywordtype">float</span> v[3] = {0.0, 0.0, 0.0};
<a name="l01396"></a>01396                 zdist = 0.02;
<a name="l01397"></a>01397                 
<a name="l01398"></a>01398                 glBegin(GL_LINE_STRIP);
<a name="l01399"></a>01399                 
<a name="l01400"></a>01400                 <span class="keywordflow">for</span> (steps = 0; steps &lt; 6; steps++) {
<a name="l01401"></a>01401                     <span class="keywordflow">if</span> (axis == 0 || axis == 1) {       <span class="comment">/* x axis up, x axis down */</span>
<a name="l01402"></a>01402                         <span class="comment">/* make the arcs start at the edge of the energy circle */</span>
<a name="l01403"></a>01403                         <span class="keywordflow">if</span> (steps == 0) v[0] = dir * circrad;
<a name="l01404"></a>01404                         <span class="keywordflow">else</span> v[0] = v[0] + dir * (steps * outdist);
<a name="l01405"></a>01405                     }
<a name="l01406"></a>01406                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (axis == 2 || axis == 3) {      <span class="comment">/* y axis up, y axis down */</span>
<a name="l01407"></a>01407                         <span class="comment">/* make the arcs start at the edge of the energy circle */</span>
<a name="l01408"></a>01408                         v[1] = (steps == 0) ? (dir * circrad) : (v[1] + dir * (steps * outdist));
<a name="l01409"></a>01409                     }
<a name="l01410"></a>01410 
<a name="l01411"></a>01411                     v[2] = v[2] - steps * zdist;
<a name="l01412"></a>01412                     
<a name="l01413"></a>01413                     glVertex3fv(v);
<a name="l01414"></a>01414                     
<a name="l01415"></a>01415                     zdist = zdist * <a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a0ea807db9b245d41852d0326d715cc0b">mul</a>;
<a name="l01416"></a>01416                 }
<a name="l01417"></a>01417                 
<a name="l01418"></a>01418                 glEnd();
<a name="l01419"></a>01419                 <span class="comment">/* flip the direction */</span>
<a name="l01420"></a>01420                 dir = -dir;
<a name="l01421"></a>01421             }
<a name="l01422"></a>01422         }
<a name="l01423"></a>01423     }
<a name="l01424"></a>01424     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6c8bfeca1d8a74252bfe284de7d754cb">type</a> == <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a0f089dd53e59d56d00b73493496fa2c3">LA_AREA</a>) {
<a name="l01425"></a>01425         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(3);
<a name="l01426"></a>01426         <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a10975ef9c9b83e75e9b3020fe71890e7">area_shape</a> == <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a65c4ef5fe117046408686d043ebafd63">LA_AREA_SQUARE</a>)
<a name="l01427"></a>01427             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a927bebeabf30bfa7ca451c16fe9336e4">fdrawbox</a>(-la-&gt;<a class="code" href="../../d5/d72/structLamp.html#aafbcbc0e9154c1edc86646246268f4c3">area_size</a> * 0.5f, -la-&gt;<a class="code" href="../../d5/d72/structLamp.html#aafbcbc0e9154c1edc86646246268f4c3">area_size</a> * 0.5f, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#aafbcbc0e9154c1edc86646246268f4c3">area_size</a> * 0.5f, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#aafbcbc0e9154c1edc86646246268f4c3">area_size</a> * 0.5f);
<a name="l01428"></a>01428         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a10975ef9c9b83e75e9b3020fe71890e7">area_shape</a> == <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#aceb2f6f4db39df851f0a556dfb25fd4a">LA_AREA_RECT</a>)
<a name="l01429"></a>01429             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a927bebeabf30bfa7ca451c16fe9336e4">fdrawbox</a>(-la-&gt;<a class="code" href="../../d5/d72/structLamp.html#aafbcbc0e9154c1edc86646246268f4c3">area_size</a> * 0.5f, -la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a120b92de2b45623dac956c9caddaeac4">area_sizey</a> * 0.5f, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#aafbcbc0e9154c1edc86646246268f4c3">area_size</a> * 0.5f, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a120b92de2b45623dac956c9caddaeac4">area_sizey</a> * 0.5f);
<a name="l01430"></a>01430 
<a name="l01431"></a>01431         glBegin(GL_LINE_STRIP);
<a name="l01432"></a>01432         glVertex3f(0.0, 0.0, -circrad);
<a name="l01433"></a>01433         glVertex3f(0.0, 0.0, -la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a7dfb335997197bb8a645e3540a91bf4d">dist</a>);
<a name="l01434"></a>01434         glEnd();
<a name="l01435"></a>01435     }
<a name="l01436"></a>01436     
<a name="l01437"></a>01437     <span class="comment">/* and back to viewspace */</span>
<a name="l01438"></a>01438     <a class="code" href="../../dd/d44/BIF__gl_8h.html#a968938b254020ac622d83a3ab1226f4a">glLoadMatrixf</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ad04178a1375cc4ef5c59a76b723f822f">viewmat</a>);
<a name="l01439"></a>01439     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3]);
<a name="l01440"></a>01440 
<a name="l01441"></a>01441     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(0);
<a name="l01442"></a>01442     
<a name="l01443"></a>01443     <span class="keywordflow">if</span> ((la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6c8bfeca1d8a74252bfe284de7d754cb">type</a> == <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a55ba7e9dc61979b7097cb11dace90bdb">LA_SPOT</a>) &amp;&amp; (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a1998f8f61376aff315a6b618e8aa6bba">mode</a> &amp; <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a6d46bae4e340f7043f9507eaf1293c72">LA_SHAD_BUF</a>) &amp;&amp; (is_view == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) {
<a name="l01444"></a>01444         <a class="code" href="../../d3/d02/drawobject_8c.html#ade44b0b868515966b51db336f63b2966">drawshadbuflimits</a>(la, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l01445"></a>01445     }
<a name="l01446"></a>01446     
<a name="l01447"></a>01447     <a class="code" href="../../de/d96/UI__resources_8h.html#aeaa5bb9e6143ac7c02ac3f6db8a52339">UI_GetThemeColor4ubv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a5f8ef565a0dff9a0166102082b24c506">TH_LAMP</a>, col);
<a name="l01448"></a>01448     glColor4ubv(col);
<a name="l01449"></a>01449 
<a name="l01450"></a>01450     glEnable(GL_BLEND);
<a name="l01451"></a>01451     
<a name="l01452"></a>01452     <span class="keywordflow">if</span> (vec[2] &gt; 0) vec[2] -= circrad;
<a name="l01453"></a>01453     <span class="keywordflow">else</span> vec[2] += circrad;
<a name="l01454"></a>01454     
<a name="l01455"></a>01455     glBegin(GL_LINE_STRIP);
<a name="l01456"></a>01456     glVertex3fv(vec);
<a name="l01457"></a>01457     vec[2] = 0;
<a name="l01458"></a>01458     glVertex3fv(vec);
<a name="l01459"></a>01459     glEnd();
<a name="l01460"></a>01460     
<a name="l01461"></a>01461     glPointSize(2.0);
<a name="l01462"></a>01462     glBegin(GL_POINTS);
<a name="l01463"></a>01463     glVertex3fv(vec);
<a name="l01464"></a>01464     glEnd();
<a name="l01465"></a>01465     glPointSize(1.0);
<a name="l01466"></a>01466     
<a name="l01467"></a>01467     glDisable(GL_BLEND);
<a name="l01468"></a>01468     
<a name="l01469"></a>01469     <span class="comment">/* restore for drawing extra stuff */</span>
<a name="l01470"></a>01470     glColor3fv(curcol);
<a name="l01471"></a>01471 
<a name="l01472"></a>01472 }
<a name="l01473"></a>01473 
<a name="l01474"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a8a7d55bf72d180e594247f0e0b373cfa">01474</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a8a7d55bf72d180e594247f0e0b373cfa">draw_limit_line</a>(<span class="keywordtype">float</span> sta, <span class="keywordtype">float</span> end, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> col)
<a name="l01475"></a>01475 {
<a name="l01476"></a>01476     glBegin(GL_LINES);
<a name="l01477"></a>01477     glVertex3f(0.0, 0.0, -sta);
<a name="l01478"></a>01478     glVertex3f(0.0, 0.0, -end);
<a name="l01479"></a>01479     glEnd();
<a name="l01480"></a>01480 
<a name="l01481"></a>01481     glPointSize(3.0);
<a name="l01482"></a>01482     glBegin(GL_POINTS);
<a name="l01483"></a>01483     <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(col);
<a name="l01484"></a>01484     glVertex3f(0.0, 0.0, -sta);
<a name="l01485"></a>01485     glVertex3f(0.0, 0.0, -end);
<a name="l01486"></a>01486     glEnd();
<a name="l01487"></a>01487     glPointSize(1.0);
<a name="l01488"></a>01488 }       
<a name="l01489"></a>01489 
<a name="l01490"></a>01490 
<a name="l01491"></a>01491 <span class="comment">/* yafray: draw camera focus point (cross, similar to aqsis code in tuhopuu) */</span>
<a name="l01492"></a>01492 <span class="comment">/* qdn: now also enabled for Blender to set focus point for defocus composite node */</span>
<a name="l01493"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ae6f67a5802d56879b4a2dc4a58a69af0">01493</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ae6f67a5802d56879b4a2dc4a58a69af0">draw_focus_cross</a>(<span class="keywordtype">float</span> dist, <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l01494"></a>01494 {
<a name="l01495"></a>01495     glBegin(GL_LINES);
<a name="l01496"></a>01496     glVertex3f(-size, 0.f, -dist);
<a name="l01497"></a>01497     glVertex3f(size, 0.f, -dist);
<a name="l01498"></a>01498     glVertex3f(0.f, -size, -dist);
<a name="l01499"></a>01499     glVertex3f(0.f, size, -dist);
<a name="l01500"></a>01500     glEnd();
<a name="l01501"></a>01501 }
<a name="l01502"></a>01502 
<a name="l01503"></a>01503 <span class="preprocessor">#ifdef VIEW3D_CAMERA_BORDER_HACK</span>
<a name="l01504"></a><a class="code" href="../../d4/df4/view3d__intern_8h.html#ab91afbad0100d3d6d371eea756b6f8b7">01504</a> <span class="preprocessor"></span><span class="keywordtype">float</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ab91afbad0100d3d6d371eea756b6f8b7">view3d_camera_border_hack_col</a>[4];
<a name="l01505"></a><a class="code" href="../../d4/df4/view3d__intern_8h.html#a71099a3582be86b2e37722350e075ca1">01505</a> <span class="keywordtype">short</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a71099a3582be86b2e37722350e075ca1">view3d_camera_border_hack_test</a> = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01506"></a>01506 <span class="preprocessor">#endif</span>
<a name="l01507"></a>01507 <span class="preprocessor"></span>
<a name="l01508"></a>01508 <span class="comment">/* ****************** draw clip data *************** */</span>
<a name="l01509"></a>01509 
<a name="l01510"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a20cc6eacef7358e116639fe69c075da9">01510</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a20cc6eacef7358e116639fe69c075da9">draw_bundle_sphere</a>(<span class="keywordtype">void</span>)
<a name="l01511"></a>01511 {
<a name="l01512"></a>01512     <span class="keyword">static</span> GLuint displist = 0;
<a name="l01513"></a>01513 
<a name="l01514"></a>01514     <span class="keywordflow">if</span> (displist == 0) {
<a name="l01515"></a>01515         GLUquadricObj *qobj;
<a name="l01516"></a>01516 
<a name="l01517"></a>01517         displist = glGenLists(1);
<a name="l01518"></a>01518         glNewList(displist, GL_COMPILE);
<a name="l01519"></a>01519 
<a name="l01520"></a>01520         qobj = gluNewQuadric();
<a name="l01521"></a>01521         gluQuadricDrawStyle(qobj, GLU_FILL);
<a name="l01522"></a>01522         glShadeModel(GL_SMOOTH);
<a name="l01523"></a>01523         gluSphere(qobj, 0.05, 8, 8);
<a name="l01524"></a>01524         glShadeModel(GL_FLAT);
<a name="l01525"></a>01525         gluDeleteQuadric(qobj);
<a name="l01526"></a>01526 
<a name="l01527"></a>01527         glEndList();
<a name="l01528"></a>01528     }
<a name="l01529"></a>01529 
<a name="l01530"></a>01530     glCallList(displist);
<a name="l01531"></a>01531 }
<a name="l01532"></a>01532 
<a name="l01533"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a9a1d6d279b28757e6e4a3e37c2ca8144">01533</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a9a1d6d279b28757e6e4a3e37c2ca8144">draw_viewport_object_reconstruction</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d3/da9/structBase.html">Base</a> *base, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d,
<a name="l01534"></a>01534                                                 <a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d2/de6/structMovieTrackingObject.html">MovieTrackingObject</a> *tracking_object, <span class="keywordtype">int</span> flag,
<a name="l01535"></a>01535                                                 <span class="keywordtype">int</span> *global_track_index, <span class="keywordtype">int</span> draw_selected)
<a name="l01536"></a>01536 {
<a name="l01537"></a>01537     <a class="code" href="../../d9/ddb/structMovieTracking.html">MovieTracking</a> *tracking = &amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>;
<a name="l01538"></a>01538     <a class="code" href="../../da/d5f/structMovieTrackingTrack.html">MovieTrackingTrack</a> *track;
<a name="l01539"></a>01539     <span class="keywordtype">float</span> mat[4][4], imat[4][4];
<a name="l01540"></a>01540     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> col[4], scol[4];
<a name="l01541"></a>01541     <span class="keywordtype">int</span> tracknr = *global_track_index;
<a name="l01542"></a>01542     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *tracksbase = <a class="code" href="../../da/d72/BKE__tracking_8h.html#abec329052feec9dd243b253ac2ce2033">BKE_tracking_object_tracks</a>(tracking, tracking_object);
<a name="l01543"></a>01543 
<a name="l01544"></a>01544     <a class="code" href="../../de/d96/UI__resources_8h.html#aeaa5bb9e6143ac7c02ac3f6db8a52339">UI_GetThemeColor4ubv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531ade800b14585ec3bc83905fe667484c4b">TH_TEXT</a>, col);
<a name="l01545"></a>01545     <a class="code" href="../../de/d96/UI__resources_8h.html#aeaa5bb9e6143ac7c02ac3f6db8a52339">UI_GetThemeColor4ubv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531acf22ebe596e9394104b732b077cbec7a">TH_SELECT</a>, scol);
<a name="l01546"></a>01546 
<a name="l01547"></a>01547     <a class="code" href="../../da/d72/BKE__tracking_8h.html#ad50223def7cd0a2546dd3fec650ee253">BKE_get_tracking_mat</a>(scene, base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>, mat);
<a name="l01548"></a>01548 
<a name="l01549"></a>01549     glPushMatrix();
<a name="l01550"></a>01550 
<a name="l01551"></a>01551     <span class="keywordflow">if</span> (tracking_object-&gt;<a class="code" href="../../d2/de6/structMovieTrackingObject.html#ac43786f911f695796bba9afbdc976f2c">flag</a> &amp; <a class="code" href="../../d3/dd4/DNA__tracking__types_8h.html#a06e7a47b7bac422584f1ce1607f6268f">TRACKING_OBJECT_CAMERA</a>) {
<a name="l01552"></a>01552         <span class="comment">/* current ogl matrix is translated in camera space, bundles should</span>
<a name="l01553"></a>01553 <span class="comment">         * be rendered in world space, so camera matrix should be &quot;removed&quot;</span>
<a name="l01554"></a>01554 <span class="comment">         * from current ogl matrix */</span>
<a name="l01555"></a>01555         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(imat, base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l01556"></a>01556 
<a name="l01557"></a>01557         <a class="code" href="../../dd/d44/BIF__gl_8h.html#a22a8b7985dcd174e9add6f20aa37a962">glMultMatrixf</a>(imat);
<a name="l01558"></a>01558         <a class="code" href="../../dd/d44/BIF__gl_8h.html#a22a8b7985dcd174e9add6f20aa37a962">glMultMatrixf</a>(mat);
<a name="l01559"></a>01559     }
<a name="l01560"></a>01560     <span class="keywordflow">else</span> {
<a name="l01561"></a>01561         <span class="keywordtype">float</span> obmat[4][4];
<a name="l01562"></a>01562 
<a name="l01563"></a>01563         <a class="code" href="../../da/d72/BKE__tracking_8h.html#a96d54640646bbd7da504bd98baab321b">BKE_tracking_get_interpolated_camera</a>(tracking, tracking_object, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a>, obmat);
<a name="l01564"></a>01564 
<a name="l01565"></a>01565         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(imat, obmat);
<a name="l01566"></a>01566         <a class="code" href="../../dd/d44/BIF__gl_8h.html#a22a8b7985dcd174e9add6f20aa37a962">glMultMatrixf</a>(imat);
<a name="l01567"></a>01567     }
<a name="l01568"></a>01568 
<a name="l01569"></a>01569     <span class="keywordflow">for</span> (track = tracksbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; track; track = track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#aec565ab687123b2707c7be0182b24ea6">next</a>) {
<a name="l01570"></a>01570         <span class="keywordtype">int</span> selected = <a class="code" href="../../da/d72/BKE__tracking_8h.html#a51e36c49c74337e823a5d095389cf158">TRACK_SELECTED</a>(track);
<a name="l01571"></a>01571 
<a name="l01572"></a>01572         <span class="keywordflow">if</span> (draw_selected &amp;&amp; !selected)
<a name="l01573"></a>01573             <span class="keywordflow">continue</span>;
<a name="l01574"></a>01574 
<a name="l01575"></a>01575         <span class="keywordflow">if</span> ((track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a71bf96554b319d35bd7c5570c261ba9a">flag</a> &amp; <a class="code" href="../../d3/dd4/DNA__tracking__types_8h.html#a0ecbc30a5ba19dbf9ded156314eed34e">TRACK_HAS_BUNDLE</a>) == 0)
<a name="l01576"></a>01576             <span class="keywordflow">continue</span>;
<a name="l01577"></a>01577 
<a name="l01578"></a>01578         <span class="keywordflow">if</span> (flag &amp; <a class="code" href="../../d4/df4/view3d__intern_8h.html#a205a8c1771c3a0eab5ecd42de38c901c">DRAW_PICKING</a>)
<a name="l01579"></a>01579             glLoadName(base-&gt;<a class="code" href="../../d3/da9/structBase.html#a89a67eef05b0a12dd3c9bd69600486de">selcol</a> + (tracknr &lt;&lt; 16));
<a name="l01580"></a>01580 
<a name="l01581"></a>01581         glPushMatrix();
<a name="l01582"></a>01582         glTranslatef(track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a4e616aa095d540fba49777fdf9d2abd6">bundle_pos</a>[0], track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a4e616aa095d540fba49777fdf9d2abd6">bundle_pos</a>[1], track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a4e616aa095d540fba49777fdf9d2abd6">bundle_pos</a>[2]);
<a name="l01583"></a>01583         glScalef(v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a1403b2a117470cc7d9dd920e410a0dfe">bundle_size</a> / 0.05f, v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a1403b2a117470cc7d9dd920e410a0dfe">bundle_size</a> / 0.05f, v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a1403b2a117470cc7d9dd920e410a0dfe">bundle_size</a> / 0.05f);
<a name="l01584"></a>01584 
<a name="l01585"></a>01585         <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a591cd4c57e5a79352f6733f6fa2bc1c9">drawtype</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>) {
<a name="l01586"></a>01586             glDisable(GL_LIGHTING);
<a name="l01587"></a>01587 
<a name="l01588"></a>01588             <span class="keywordflow">if</span> (selected) {
<a name="l01589"></a>01589                 <span class="keywordflow">if</span> (base == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a71a9117cf3b8db805eb031926bff279a">BASACT</a>) <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531af47479527035752070059cf6669daf09">TH_ACTIVE</a>);
<a name="l01590"></a>01590                 <span class="keywordflow">else</span> <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531acf22ebe596e9394104b732b077cbec7a">TH_SELECT</a>);
<a name="l01591"></a>01591             }
<a name="l01592"></a>01592             <span class="keywordflow">else</span> {
<a name="l01593"></a>01593                 <span class="keywordflow">if</span> (track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a71bf96554b319d35bd7c5570c261ba9a">flag</a> &amp; <a class="code" href="../../d3/dd4/DNA__tracking__types_8h.html#a0a2e2700dc42a05a0068ea54a6d244b4">TRACK_CUSTOMCOLOR</a>) glColor3fv(track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a42c4767a2217437de09428056999a9cd">color</a>);
<a name="l01594"></a>01594                 <span class="keywordflow">else</span> <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l01595"></a>01595             }
<a name="l01596"></a>01596 
<a name="l01597"></a>01597             <a class="code" href="../../d3/d02/drawobject_8c.html#a3a22182290000ba6cce2b8d3eb8c3cc3">drawaxes</a>(0.05f, v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#aeb48804272fd41192e6d642a030447b7">bundle_drawtype</a>);
<a name="l01598"></a>01598 
<a name="l01599"></a>01599             glEnable(GL_LIGHTING);
<a name="l01600"></a>01600         }
<a name="l01601"></a>01601         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a591cd4c57e5a79352f6733f6fa2bc1c9">drawtype</a> &gt; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>) {
<a name="l01602"></a>01602             <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#aeb48804272fd41192e6d642a030447b7">bundle_drawtype</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a053a3e65fc098e9638469e306d642f82">OB_EMPTY_SPHERE</a>) {
<a name="l01603"></a>01603                 <span class="comment">/* selection outline */</span>
<a name="l01604"></a>01604                 <span class="keywordflow">if</span> (selected) {
<a name="l01605"></a>01605                     <span class="keywordflow">if</span> (base == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a71a9117cf3b8db805eb031926bff279a">BASACT</a>) <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531af47479527035752070059cf6669daf09">TH_ACTIVE</a>);
<a name="l01606"></a>01606                     <span class="keywordflow">else</span> <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531acf22ebe596e9394104b732b077cbec7a">TH_SELECT</a>);
<a name="l01607"></a>01607 
<a name="l01608"></a>01608                     glLineWidth(2.f);
<a name="l01609"></a>01609                     glDisable(GL_LIGHTING);
<a name="l01610"></a>01610                     glPolygonMode(GL_FRONT_AND_BACK, GL_LINE);
<a name="l01611"></a>01611 
<a name="l01612"></a>01612                     <a class="code" href="../../d3/d02/drawobject_8c.html#a20cc6eacef7358e116639fe69c075da9">draw_bundle_sphere</a>();
<a name="l01613"></a>01613 
<a name="l01614"></a>01614                     glPolygonMode(GL_FRONT_AND_BACK, GL_FILL);
<a name="l01615"></a>01615                     glEnable(GL_LIGHTING);
<a name="l01616"></a>01616                     glLineWidth(1.f);
<a name="l01617"></a>01617                 }
<a name="l01618"></a>01618 
<a name="l01619"></a>01619                 <span class="keywordflow">if</span> (track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a71bf96554b319d35bd7c5570c261ba9a">flag</a> &amp; <a class="code" href="../../d3/dd4/DNA__tracking__types_8h.html#a0a2e2700dc42a05a0068ea54a6d244b4">TRACK_CUSTOMCOLOR</a>) glColor3fv(track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a42c4767a2217437de09428056999a9cd">color</a>);
<a name="l01620"></a>01620                 <span class="keywordflow">else</span> <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a1a16c787731d385f6eb9fb0b8fad4ba4">TH_BUNDLE_SOLID</a>);
<a name="l01621"></a>01621 
<a name="l01622"></a>01622                 <a class="code" href="../../d3/d02/drawobject_8c.html#a20cc6eacef7358e116639fe69c075da9">draw_bundle_sphere</a>();
<a name="l01623"></a>01623             }
<a name="l01624"></a>01624             <span class="keywordflow">else</span> {
<a name="l01625"></a>01625                 glDisable(GL_LIGHTING);
<a name="l01626"></a>01626 
<a name="l01627"></a>01627                 <span class="keywordflow">if</span> (selected) {
<a name="l01628"></a>01628                     <span class="keywordflow">if</span> (base == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a71a9117cf3b8db805eb031926bff279a">BASACT</a>) <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531af47479527035752070059cf6669daf09">TH_ACTIVE</a>);
<a name="l01629"></a>01629                     <span class="keywordflow">else</span> <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531acf22ebe596e9394104b732b077cbec7a">TH_SELECT</a>);
<a name="l01630"></a>01630                 }
<a name="l01631"></a>01631                 <span class="keywordflow">else</span> {
<a name="l01632"></a>01632                     <span class="keywordflow">if</span> (track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a71bf96554b319d35bd7c5570c261ba9a">flag</a> &amp; <a class="code" href="../../d3/dd4/DNA__tracking__types_8h.html#a0a2e2700dc42a05a0068ea54a6d244b4">TRACK_CUSTOMCOLOR</a>) glColor3fv(track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a42c4767a2217437de09428056999a9cd">color</a>);
<a name="l01633"></a>01633                     <span class="keywordflow">else</span> <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l01634"></a>01634                 }
<a name="l01635"></a>01635 
<a name="l01636"></a>01636                 <a class="code" href="../../d3/d02/drawobject_8c.html#a3a22182290000ba6cce2b8d3eb8c3cc3">drawaxes</a>(0.05f, v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#aeb48804272fd41192e6d642a030447b7">bundle_drawtype</a>);
<a name="l01637"></a>01637 
<a name="l01638"></a>01638                 glEnable(GL_LIGHTING);
<a name="l01639"></a>01639             }
<a name="l01640"></a>01640         }
<a name="l01641"></a>01641 
<a name="l01642"></a>01642         glPopMatrix();
<a name="l01643"></a>01643 
<a name="l01644"></a>01644         <span class="keywordflow">if</span> ((flag &amp; DRAW_PICKING) == 0 &amp;&amp; (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a72c70dde0c932cbee909c7d9258927be">V3D_SHOW_BUNDLENAME</a>)) {
<a name="l01645"></a>01645             <span class="keywordtype">float</span> pos[3];
<a name="l01646"></a>01646             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> tcol[4];
<a name="l01647"></a>01647 
<a name="l01648"></a>01648             <span class="keywordflow">if</span> (selected) memcpy(tcol, scol, <span class="keyword">sizeof</span>(tcol));
<a name="l01649"></a>01649             <span class="keywordflow">else</span> memcpy(tcol, col, <span class="keyword">sizeof</span>(tcol));
<a name="l01650"></a>01650 
<a name="l01651"></a>01651             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad7be0179ee8a128512e2c7f0ad11c8d8">mul_v3_m4v3</a>(pos, mat, track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a4e616aa095d540fba49777fdf9d2abd6">bundle_pos</a>);
<a name="l01652"></a>01652             <a class="code" href="../../d3/d02/drawobject_8c.html#a6de94308481c2e9de88b710de50dad2f">view3d_cached_text_draw_add</a>(pos, track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a5ede2cebd7d3af52ad94c60a496c8781">name</a>, 10, <a class="code" href="../../d4/df4/view3d__intern_8h.html#a7e2a2659b0288528267f390c5774b2d4">V3D_CACHE_TEXT_GLOBALSPACE</a>, tcol);
<a name="l01653"></a>01653         }
<a name="l01654"></a>01654 
<a name="l01655"></a>01655         tracknr++;
<a name="l01656"></a>01656     }
<a name="l01657"></a>01657 
<a name="l01658"></a>01658     <span class="keywordflow">if</span> ((flag &amp; <a class="code" href="../../d4/df4/view3d__intern_8h.html#a205a8c1771c3a0eab5ecd42de38c901c">DRAW_PICKING</a>) == 0) {
<a name="l01659"></a>01659         <span class="keywordflow">if</span> ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a7a449af693d621a7ac24c44c6c25880c">V3D_SHOW_CAMERAPATH</a>) &amp;&amp; (tracking_object-&gt;<a class="code" href="../../d2/de6/structMovieTrackingObject.html#ac43786f911f695796bba9afbdc976f2c">flag</a> &amp; <a class="code" href="../../d3/dd4/DNA__tracking__types_8h.html#a06e7a47b7bac422584f1ce1607f6268f">TRACKING_OBJECT_CAMERA</a>)) {
<a name="l01660"></a>01660             <a class="code" href="../../dd/d65/structMovieTrackingReconstruction.html">MovieTrackingReconstruction</a> *reconstruction;
<a name="l01661"></a>01661             reconstruction = <a class="code" href="../../da/d72/BKE__tracking_8h.html#a93b49c63ec3d36b72f2c947eceda5ee7">BKE_tracking_object_reconstruction</a>(tracking, tracking_object);
<a name="l01662"></a>01662 
<a name="l01663"></a>01663             <span class="keywordflow">if</span> (reconstruction-&gt;<a class="code" href="../../dd/d65/structMovieTrackingReconstruction.html#a858a10d0ab1f32e42121e13ed67ae008">camnr</a>) {
<a name="l01664"></a>01664                 <a class="code" href="../../dc/db7/structMovieReconstructedCamera.html">MovieReconstructedCamera</a> *camera = reconstruction-&gt;<a class="code" href="../../dd/d65/structMovieTrackingReconstruction.html#ac680e228e4654f3375f1458195da30e1">cameras</a>;
<a name="l01665"></a>01665                 <span class="keywordtype">int</span> a = 0;
<a name="l01666"></a>01666 
<a name="l01667"></a>01667                 glDisable(GL_LIGHTING);
<a name="l01668"></a>01668                 <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531acf11f3c908e6ab338833e842c4b14046">TH_CAMERA_PATH</a>);
<a name="l01669"></a>01669                 glLineWidth(2.0f);
<a name="l01670"></a>01670 
<a name="l01671"></a>01671                 glBegin(GL_LINE_STRIP);
<a name="l01672"></a>01672                 <span class="keywordflow">for</span> (a = 0; a &lt; reconstruction-&gt;<a class="code" href="../../dd/d65/structMovieTrackingReconstruction.html#a858a10d0ab1f32e42121e13ed67ae008">camnr</a>; a++, camera++) {
<a name="l01673"></a>01673                     glVertex3fv(camera-&gt;<a class="code" href="../../dc/db7/structMovieReconstructedCamera.html#a9668120603df1c73d8c174083c52cbd7">mat</a>[3]);
<a name="l01674"></a>01674                 }
<a name="l01675"></a>01675                 glEnd();
<a name="l01676"></a>01676 
<a name="l01677"></a>01677                 glLineWidth(1.0f);
<a name="l01678"></a>01678                 glEnable(GL_LIGHTING);
<a name="l01679"></a>01679             }
<a name="l01680"></a>01680         }
<a name="l01681"></a>01681     }
<a name="l01682"></a>01682 
<a name="l01683"></a>01683     glPopMatrix();
<a name="l01684"></a>01684 
<a name="l01685"></a>01685     *global_track_index = tracknr;
<a name="l01686"></a>01686 }
<a name="l01687"></a>01687 
<a name="l01688"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a6887503b91f8f527bcce079f8c078e02">01688</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a6887503b91f8f527bcce079f8c078e02">draw_viewport_reconstruction</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d3/da9/structBase.html">Base</a> *base, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip,
<a name="l01689"></a>01689                                          <span class="keywordtype">int</span> flag, <span class="keywordtype">int</span> draw_selected)
<a name="l01690"></a>01690 {
<a name="l01691"></a>01691     <a class="code" href="../../d9/ddb/structMovieTracking.html">MovieTracking</a> *tracking = &amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>;
<a name="l01692"></a>01692     <a class="code" href="../../d2/de6/structMovieTrackingObject.html">MovieTrackingObject</a> *tracking_object;
<a name="l01693"></a>01693     <span class="keywordtype">float</span> curcol[4];
<a name="l01694"></a>01694     <span class="keywordtype">int</span> global_track_index = 1;
<a name="l01695"></a>01695 
<a name="l01696"></a>01696     <span class="keywordflow">if</span> ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a80073cb1e48d29283ad830be5353bdb3">V3D_SHOW_RECONSTRUCTION</a>) == 0)
<a name="l01697"></a>01697         <span class="keywordflow">return</span>;
<a name="l01698"></a>01698 
<a name="l01699"></a>01699     <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>)
<a name="l01700"></a>01700         <span class="keywordflow">return</span>;
<a name="l01701"></a>01701 
<a name="l01702"></a>01702     glGetFloatv(GL_CURRENT_COLOR, curcol);
<a name="l01703"></a>01703 
<a name="l01704"></a>01704     glEnable(GL_LIGHTING);
<a name="l01705"></a>01705     glColorMaterial(GL_FRONT_AND_BACK, GL_DIFFUSE);
<a name="l01706"></a>01706     glEnable(GL_COLOR_MATERIAL);
<a name="l01707"></a>01707     glShadeModel(GL_SMOOTH);
<a name="l01708"></a>01708 
<a name="l01709"></a>01709     tracking_object = tracking-&gt;<a class="code" href="../../d9/ddb/structMovieTracking.html#a8b83f22c1c9fa84904d2a6689973b789">objects</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01710"></a>01710     <span class="keywordflow">while</span> (tracking_object) {
<a name="l01711"></a>01711         <a class="code" href="../../d3/d02/drawobject_8c.html#a9a1d6d279b28757e6e4a3e37c2ca8144">draw_viewport_object_reconstruction</a>(scene, base, v3d, clip, tracking_object,
<a name="l01712"></a>01712                                             flag, &amp;global_track_index, draw_selected);
<a name="l01713"></a>01713 
<a name="l01714"></a>01714         tracking_object = tracking_object-&gt;<a class="code" href="../../d2/de6/structMovieTrackingObject.html#a9c25b559861625fafa9281d308689f46">next</a>;
<a name="l01715"></a>01715     }
<a name="l01716"></a>01716 
<a name="l01717"></a>01717     <span class="comment">/* restore */</span>
<a name="l01718"></a>01718     glShadeModel(GL_FLAT);
<a name="l01719"></a>01719     glDisable(GL_COLOR_MATERIAL);
<a name="l01720"></a>01720     glDisable(GL_LIGHTING);
<a name="l01721"></a>01721 
<a name="l01722"></a>01722     glColor4fv(curcol);
<a name="l01723"></a>01723 
<a name="l01724"></a>01724     <span class="keywordflow">if</span> (flag &amp; <a class="code" href="../../d4/df4/view3d__intern_8h.html#a205a8c1771c3a0eab5ecd42de38c901c">DRAW_PICKING</a>)
<a name="l01725"></a>01725         glLoadName(base-&gt;<a class="code" href="../../d3/da9/structBase.html#a89a67eef05b0a12dd3c9bd69600486de">selcol</a>);
<a name="l01726"></a>01726 }
<a name="l01727"></a>01727 
<a name="l01728"></a>01728 <span class="comment">/* flag similar to draw_object() */</span>
<a name="l01729"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a182a1751302b4857af2d324e4b1ca58e">01729</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a182a1751302b4857af2d324e4b1ca58e">drawcamera</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d, <a class="code" href="../../d3/da9/structBase.html">Base</a> *base, <span class="keywordtype">int</span> flag)
<a name="l01730"></a>01730 {
<a name="l01731"></a>01731     <span class="comment">/* a standing up pyramid with (0,0,0) as top */</span>
<a name="l01732"></a>01732     <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *cam;
<a name="l01733"></a>01733     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l01734"></a>01734     <span class="keywordtype">float</span> tvec[3];
<a name="l01735"></a>01735     <span class="keywordtype">float</span> vec[4][3], asp[2], shift[2], scale[3];
<a name="l01736"></a>01736     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01737"></a>01737     <span class="keywordtype">float</span> drawsize;
<a name="l01738"></a>01738     <span class="keyword">const</span> <span class="keywordtype">short</span> is_view = (rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8f435c152f17185773a21cd8b7067ebb">persp</a> == <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a4c869f8f07a58e54e43d35474bbe4757">RV3D_CAMOB</a> &amp;&amp; ob == v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>);
<a name="l01739"></a>01739     <a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip = <a class="code" href="../../df/dac/BKE__object_8h.html#ae5d85ba23fc1190fb741a7f16b0bbf0f">object_get_movieclip</a>(scene, base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>, 0);
<a name="l01740"></a>01740 
<a name="l01741"></a>01741     <span class="comment">/* draw data for movie clip set as active for scene */</span>
<a name="l01742"></a>01742     <span class="keywordflow">if</span> (clip) {
<a name="l01743"></a>01743         <a class="code" href="../../d3/d02/drawobject_8c.html#a6887503b91f8f527bcce079f8c078e02">draw_viewport_reconstruction</a>(scene, base, v3d, clip, flag, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01744"></a>01744         <a class="code" href="../../d3/d02/drawobject_8c.html#a6887503b91f8f527bcce079f8c078e02">draw_viewport_reconstruction</a>(scene, base, v3d, clip, flag, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01745"></a>01745     }
<a name="l01746"></a>01746 
<a name="l01747"></a>01747 <span class="preprocessor">#ifdef VIEW3D_CAMERA_BORDER_HACK</span>
<a name="l01748"></a>01748 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (is_view &amp;&amp; !(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.f &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a7bc3ff94aabaed488f0d9b7199d11d22">G_PICKSEL</a>)) {
<a name="l01749"></a>01749         glGetFloatv(GL_CURRENT_COLOR, <a class="code" href="../../d3/d02/drawobject_8c.html#ab91afbad0100d3d6d371eea756b6f8b7">view3d_camera_border_hack_col</a>);
<a name="l01750"></a>01750         <a class="code" href="../../d3/d02/drawobject_8c.html#a71099a3582be86b2e37722350e075ca1">view3d_camera_border_hack_test</a> = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01751"></a>01751         <span class="keywordflow">return</span>;
<a name="l01752"></a>01752     }
<a name="l01753"></a>01753 <span class="preprocessor">#endif</span>
<a name="l01754"></a>01754 <span class="preprocessor"></span>
<a name="l01755"></a>01755     cam = ob-&gt;data;
<a name="l01756"></a>01756 
<a name="l01757"></a>01757     scale[0] = 1.0f / <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(ob-&gt;obmat[0]);
<a name="l01758"></a>01758     scale[1] = 1.0f / <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(ob-&gt;obmat[1]);
<a name="l01759"></a>01759     scale[2] = 1.0f / <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(ob-&gt;obmat[2]);
<a name="l01760"></a>01760 
<a name="l01761"></a>01761     <a class="code" href="../../d2/dff/BKE__camera_8h.html#a87a875da3c96221d633327cc6557fb48">camera_view_frame_ex</a>(scene, cam, cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#af1fde3b857240c7f053ee0b5d89a6154">drawsize</a>, is_view, scale,
<a name="l01762"></a>01762                          asp, shift, &amp;drawsize, vec);
<a name="l01763"></a>01763 
<a name="l01764"></a>01764     glDisable(GL_LIGHTING);
<a name="l01765"></a>01765     glDisable(GL_CULL_FACE);
<a name="l01766"></a>01766 
<a name="l01767"></a>01767     <span class="comment">/* camera frame */</span>
<a name="l01768"></a>01768     glBegin(GL_LINE_LOOP);
<a name="l01769"></a>01769     glVertex3fv(vec[0]);
<a name="l01770"></a>01770     glVertex3fv(vec[1]);
<a name="l01771"></a>01771     glVertex3fv(vec[2]);
<a name="l01772"></a>01772     glVertex3fv(vec[3]);
<a name="l01773"></a>01773     glEnd();
<a name="l01774"></a>01774 
<a name="l01775"></a>01775     <span class="keywordflow">if</span> (is_view)
<a name="l01776"></a>01776         <span class="keywordflow">return</span>;
<a name="l01777"></a>01777 
<a name="l01778"></a>01778     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#acd4d89007c860a4c74d459ac72593065">zero_v3</a>(tvec);
<a name="l01779"></a>01779 
<a name="l01780"></a>01780     <span class="comment">/* center point to camera frame */</span>
<a name="l01781"></a>01781     glBegin(GL_LINE_STRIP);
<a name="l01782"></a>01782     glVertex3fv(vec[1]);
<a name="l01783"></a>01783     glVertex3fv(tvec);
<a name="l01784"></a>01784     glVertex3fv(vec[0]);
<a name="l01785"></a>01785     glVertex3fv(vec[3]);
<a name="l01786"></a>01786     glVertex3fv(tvec);
<a name="l01787"></a>01787     glVertex3fv(vec[2]);
<a name="l01788"></a>01788     glEnd();
<a name="l01789"></a>01789 
<a name="l01790"></a>01790 
<a name="l01791"></a>01791     <span class="comment">/* arrow on top */</span>
<a name="l01792"></a>01792     tvec[2] = vec[1][2]; <span class="comment">/* copy the depth */</span>
<a name="l01793"></a>01793 
<a name="l01794"></a>01794 
<a name="l01795"></a>01795     <span class="comment">/* draw an outline arrow for inactive cameras and filled</span>
<a name="l01796"></a>01796 <span class="comment">     * for active cameras. We actually draw both outline+filled</span>
<a name="l01797"></a>01797 <span class="comment">     * for active cameras so the wire can be seen side-on */</span>
<a name="l01798"></a>01798     <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
<a name="l01799"></a>01799         <span class="keywordflow">if</span> (i == 0) glBegin(GL_LINE_LOOP);
<a name="l01800"></a>01800         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 1 &amp;&amp; (ob == v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>)) glBegin(GL_TRIANGLES);
<a name="l01801"></a>01801         <span class="keywordflow">else</span> <span class="keywordflow">break</span>;
<a name="l01802"></a>01802 
<a name="l01803"></a>01803         tvec[0] = shift[0] + ((-0.7f * drawsize) * scale[0]);
<a name="l01804"></a>01804         tvec[1] = shift[1] + ((drawsize * (asp[1] + 0.1f)) * scale[1]);
<a name="l01805"></a>01805         glVertex3fv(tvec); <span class="comment">/* left */</span>
<a name="l01806"></a>01806         
<a name="l01807"></a>01807         tvec[0] = shift[0] + ((0.7f * drawsize) * scale[0]);
<a name="l01808"></a>01808         glVertex3fv(tvec); <span class="comment">/* right */</span>
<a name="l01809"></a>01809         
<a name="l01810"></a>01810         tvec[0] = shift[0];
<a name="l01811"></a>01811         tvec[1] = shift[1] + ((1.1f * drawsize * (asp[1] + 0.7f)) * scale[1]);
<a name="l01812"></a>01812         glVertex3fv(tvec); <span class="comment">/* top */</span>
<a name="l01813"></a>01813 
<a name="l01814"></a>01814         glEnd();
<a name="l01815"></a>01815     }
<a name="l01816"></a>01816 
<a name="l01817"></a>01817     <span class="keywordflow">if</span> (flag == 0) {
<a name="l01818"></a>01818         <span class="keywordflow">if</span> (cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ad56527aff42496f598ee9357b1244ae4">flag</a> &amp; (<a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a802b2f9a44169119118b2e270131acfa">CAM_SHOWLIMITS</a> + <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a0b042ec15564d838f7be2cc93b3bf769">CAM_SHOWMIST</a>)) {
<a name="l01819"></a>01819             <span class="keywordtype">float</span> nobmat[4][4];
<a name="l01820"></a>01820             <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wrld;
<a name="l01821"></a>01821 
<a name="l01822"></a>01822             <span class="comment">/* draw in normalized object matrix space */</span>
<a name="l01823"></a>01823             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(nobmat, ob-&gt;obmat);
<a name="l01824"></a>01824             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a927af9664e9476288c23d0f5e59c4edc">normalize_m4</a>(nobmat);
<a name="l01825"></a>01825 
<a name="l01826"></a>01826             glPushMatrix();
<a name="l01827"></a>01827             <a class="code" href="../../dd/d44/BIF__gl_8h.html#a968938b254020ac622d83a3ab1226f4a">glLoadMatrixf</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ad04178a1375cc4ef5c59a76b723f822f">viewmat</a>);
<a name="l01828"></a>01828             <a class="code" href="../../dd/d44/BIF__gl_8h.html#a22a8b7985dcd174e9add6f20aa37a962">glMultMatrixf</a>(nobmat);
<a name="l01829"></a>01829 
<a name="l01830"></a>01830             <span class="keywordflow">if</span> (cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ad56527aff42496f598ee9357b1244ae4">flag</a> &amp; <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a802b2f9a44169119118b2e270131acfa">CAM_SHOWLIMITS</a>) {
<a name="l01831"></a>01831                 <a class="code" href="../../d3/d02/drawobject_8c.html#a8a7d55bf72d180e594247f0e0b373cfa">draw_limit_line</a>(cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a3c6d9c49ef4066ff463617f719d1fef2">clipsta</a>, cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a394ace3dbfbcb6a755adb8690fe76288">clipend</a>, 0x77FFFF);
<a name="l01832"></a>01832                 <span class="comment">/* qdn: was yafray only, now also enabled for Blender to be used with defocus composite node */</span>
<a name="l01833"></a>01833                 <a class="code" href="../../d3/d02/drawobject_8c.html#ae6f67a5802d56879b4a2dc4a58a69af0">draw_focus_cross</a>(<a class="code" href="../../d2/dff/BKE__camera_8h.html#aa5e61ab28c19d40aef25d90946ccde3d">object_camera_dof_distance</a>(ob), cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#af1fde3b857240c7f053ee0b5d89a6154">drawsize</a>);
<a name="l01834"></a>01834             }
<a name="l01835"></a>01835 
<a name="l01836"></a>01836             wrld = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aefac18ed3d1ded63b012f79a3ca8ddb2">world</a>;
<a name="l01837"></a>01837             <span class="keywordflow">if</span> (cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ad56527aff42496f598ee9357b1244ae4">flag</a> &amp; <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a0b042ec15564d838f7be2cc93b3bf769">CAM_SHOWMIST</a>)
<a name="l01838"></a>01838                 <span class="keywordflow">if</span> (wrld) <a class="code" href="../../d3/d02/drawobject_8c.html#a8a7d55bf72d180e594247f0e0b373cfa">draw_limit_line</a>(wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a8b2f1072744743ef7a09b2a06d9538a8">miststa</a>, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a8b2f1072744743ef7a09b2a06d9538a8">miststa</a> + wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#ac2af5c5407c4c13815f9f95a10535224">mistdist</a>, 0xFFFFFF);
<a name="l01839"></a>01839 
<a name="l01840"></a>01840             glPopMatrix();
<a name="l01841"></a>01841         }
<a name="l01842"></a>01842     }
<a name="l01843"></a>01843 }
<a name="l01844"></a>01844 
<a name="l01845"></a>01845 <span class="comment">/* flag similar to draw_object() */</span>
<a name="l01846"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a8131e6ffdf820a977d626fe83da455f0">01846</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a8131e6ffdf820a977d626fe83da455f0">drawspeaker</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(scene), <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(v3d), <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(rv3d),
<a name="l01847"></a>01847                         <a class="code" href="../../de/de7/structObject.html">Object</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(ob), <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(flag))
<a name="l01848"></a>01848 {
<a name="l01849"></a>01849     <span class="comment">//Speaker *spk = ob-&gt;data;</span>
<a name="l01850"></a>01850 
<a name="l01851"></a>01851     <span class="keywordtype">float</span> vec[3];
<a name="l01852"></a>01852     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j;
<a name="l01853"></a>01853 
<a name="l01854"></a>01854     glEnable(GL_BLEND);
<a name="l01855"></a>01855 
<a name="l01856"></a>01856     <span class="keywordflow">for</span> (j = 0; j &lt; 3; j++) {
<a name="l01857"></a>01857         vec[2] = 0.25f * j - 0.125f;
<a name="l01858"></a>01858 
<a name="l01859"></a>01859         glBegin(GL_LINE_LOOP);
<a name="l01860"></a>01860         <span class="keywordflow">for</span> (i = 0; i &lt; 16; i++) {
<a name="l01861"></a>01861             vec[0] = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a2503b77b52ff481a3507a596ae1f3938">cosf</a>((<span class="keywordtype">float</span>)<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> * i / 8.0f) * (j == 0 ? 0.5f : 0.25f);
<a name="l01862"></a>01862             vec[1] = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a1a55e3226c270625a4bff1befa977638">sinf</a>((<span class="keywordtype">float</span>)<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> * i / 8.0f) * (j == 0 ? 0.5f : 0.25f);
<a name="l01863"></a>01863             glVertex3fv(vec);
<a name="l01864"></a>01864         }
<a name="l01865"></a>01865         glEnd();
<a name="l01866"></a>01866     }
<a name="l01867"></a>01867 
<a name="l01868"></a>01868     <span class="keywordflow">for</span> (j = 0; j &lt; 4; j++) {
<a name="l01869"></a>01869         vec[0] = (((j + 1) % 2) * (j - 1)) * 0.5f;
<a name="l01870"></a>01870         vec[1] = ((j % 2) * (j - 2)) * 0.5f;
<a name="l01871"></a>01871         glBegin(GL_LINE_STRIP);
<a name="l01872"></a>01872         <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++) {
<a name="l01873"></a>01873             <span class="keywordflow">if</span> (i == 1) {
<a name="l01874"></a>01874                 vec[0] *= 0.5f;
<a name="l01875"></a>01875                 vec[1] *= 0.5f;
<a name="l01876"></a>01876             }
<a name="l01877"></a>01877 
<a name="l01878"></a>01878             vec[2] = 0.25f * i - 0.125f;
<a name="l01879"></a>01879             glVertex3fv(vec);
<a name="l01880"></a>01880         }
<a name="l01881"></a>01881         glEnd();
<a name="l01882"></a>01882     }
<a name="l01883"></a>01883 
<a name="l01884"></a>01884     glDisable(GL_BLEND);
<a name="l01885"></a>01885 }
<a name="l01886"></a>01886 
<a name="l01887"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a07c71654147bfe09543cbc7c0e14bb63">01887</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a07c71654147bfe09543cbc7c0e14bb63">lattice_draw_verts</a>(<a class="code" href="../../dd/d40/structLattice.html">Lattice</a> *lt, <a class="code" href="../../d5/d2f/structDispList.html">DispList</a> *dl, <span class="keywordtype">short</span> sel)
<a name="l01888"></a>01888 {
<a name="l01889"></a>01889     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp = lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae3dc9dd9304be3f153fa96f155d9c7de">def</a>;
<a name="l01890"></a>01890     <span class="keywordtype">float</span> *<a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a> = dl ? dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01891"></a>01891     <span class="keywordtype">int</span> u, v, w;
<a name="l01892"></a>01892 
<a name="l01893"></a>01893     <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(sel ? <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a99466ebe41be745cf51950acc8423924">TH_VERTEX_SELECT</a> : <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a6933328b6df4400c196ee99ddd608afd">TH_VERTEX</a>);
<a name="l01894"></a>01894     glPointSize(<a class="code" href="../../de/d96/UI__resources_8h.html#ad9772e3578b739880ada62a6d21f4349">UI_GetThemeValuef</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a6c88c69347ab72b259eb7fcc8885327b">TH_VERTEX_SIZE</a>));
<a name="l01895"></a>01895     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#acbcc8c3223d7fc13a7931b0a1744b240">bglBegin</a>(GL_POINTS);
<a name="l01896"></a>01896 
<a name="l01897"></a>01897     <span class="keywordflow">for</span> (w = 0; w &lt; lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a19be731ba1b95cd1ec5df36229baaee2">pntsw</a>; w++) {
<a name="l01898"></a>01898         <span class="keywordtype">int</span> wxt = (w == 0 || w == lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a19be731ba1b95cd1ec5df36229baaee2">pntsw</a> - 1);
<a name="l01899"></a>01899         <span class="keywordflow">for</span> (v = 0; v &lt; lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a57fa6ffa7aaaed8c191e55d54eeebb74">pntsv</a>; v++) {
<a name="l01900"></a>01900             <span class="keywordtype">int</span> vxt = (v == 0 || v == lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a57fa6ffa7aaaed8c191e55d54eeebb74">pntsv</a> - 1);
<a name="l01901"></a>01901             <span class="keywordflow">for</span> (u = 0; u &lt; lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a086be8c4ef28587f6eb08c40d1bab473">pntsu</a>; u++, bp++, co += 3) {
<a name="l01902"></a>01902                 <span class="keywordtype">int</span> uxt = (u == 0 || u == lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a086be8c4ef28587f6eb08c40d1bab473">pntsu</a> - 1);
<a name="l01903"></a>01903                 <span class="keywordflow">if</span> (!(lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a63710ce306e2b866557d2af57fe75329">flag</a> &amp; <a class="code" href="../../d4/d2f/DNA__lattice__types_8h.html#a88fd8efda477754bb80253fa2c1dbcfa">LT_OUTSIDE</a>) || uxt || vxt || wxt) {
<a name="l01904"></a>01904                     <span class="keywordflow">if</span> (bp-&gt;hide == 0) {
<a name="l01905"></a>01905                         <span class="keywordflow">if</span> ((bp-&gt;f1 &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) == sel) {
<a name="l01906"></a>01906                             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(dl ? co : bp-&gt;vec);
<a name="l01907"></a>01907                         }
<a name="l01908"></a>01908                     }
<a name="l01909"></a>01909                 }
<a name="l01910"></a>01910             }
<a name="l01911"></a>01911         }
<a name="l01912"></a>01912     }
<a name="l01913"></a>01913     
<a name="l01914"></a>01914     glPointSize(1.0);
<a name="l01915"></a>01915     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a2517dcaf453d3e58af25fd4c677dad45">bglEnd</a>();
<a name="l01916"></a>01916 }
<a name="l01917"></a>01917 
<a name="l01918"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a43c0d4aa9bcd237a954eb2089e050df9">01918</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af80d19c11984560d25867b94fbd1c647">lattice_foreachScreenVert</a>(<a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> *vc, <span class="keywordtype">void</span> (*func)(<span class="keywordtype">void</span> *userData, <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y), <span class="keywordtype">void</span> *userData)
<a name="l01919"></a>01919 {
<a name="l01920"></a>01920     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#aa802aba424149fb5c03e34795a836810">obedit</a>;
<a name="l01921"></a>01921     <a class="code" href="../../dd/d40/structLattice.html">Lattice</a> *lt = obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01922"></a>01922     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp = lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a8b26fb4a2936b8ed7929cbffb12ac057">editlatt</a>-&gt;<a class="code" href="../../d5/d06/structEditLatt.html#ad6edc9c8b5a87d60189878e812587a9f">latt</a>-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae3dc9dd9304be3f153fa96f155d9c7de">def</a>;
<a name="l01923"></a>01923     <a class="code" href="../../d5/d2f/structDispList.html">DispList</a> *dl = <a class="code" href="../../d9/d12/BKE__displist_8h.html#ad5e487b875d521238ee319bfe8f659f8">find_displist</a>(&amp;obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a45d11e4826c3a8ba292c91691bb2885d">disp</a>, <a class="code" href="../../d9/d12/BKE__displist_8h.html#a91ca502ecb1aec32fd6e83349c74a085">DL_VERTS</a>);
<a name="l01924"></a>01924     <span class="keywordtype">float</span> *<a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a> = dl ? dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01925"></a>01925     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../d2/d6c/mball_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a8b26fb4a2936b8ed7929cbffb12ac057">editlatt</a>-&gt;<a class="code" href="../../d5/d06/structEditLatt.html#ad6edc9c8b5a87d60189878e812587a9f">latt</a>-&gt;<a class="code" href="../../dd/d40/structLattice.html#a086be8c4ef28587f6eb08c40d1bab473">pntsu</a> * lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a8b26fb4a2936b8ed7929cbffb12ac057">editlatt</a>-&gt;<a class="code" href="../../d5/d06/structEditLatt.html#ad6edc9c8b5a87d60189878e812587a9f">latt</a>-&gt;<a class="code" href="../../dd/d40/structLattice.html#a57fa6ffa7aaaed8c191e55d54eeebb74">pntsv</a> * lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a8b26fb4a2936b8ed7929cbffb12ac057">editlatt</a>-&gt;<a class="code" href="../../d5/d06/structEditLatt.html#ad6edc9c8b5a87d60189878e812587a9f">latt</a>-&gt;<a class="code" href="../../dd/d40/structLattice.html#a19be731ba1b95cd1ec5df36229baaee2">pntsw</a>;
<a name="l01926"></a>01926     <span class="keywordtype">short</span> s[2] = {<a class="code" href="../../d8/d6a/ED__view3d_8h.html#a9f2d1998b6b3d4dd9472a8092725e0ef">IS_CLIPPED</a>, 0};
<a name="l01927"></a>01927 
<a name="l01928"></a>01928     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af23af849d7708b6c8c92edc20bb450af">ED_view3d_clipping_local</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#ae849219034a130d5a58b5164ab8fc960">rv3d</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>); <span class="comment">/* for local clipping lookups */</span>
<a name="l01929"></a>01929 
<a name="l01930"></a>01930     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d2/d6c/mball_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>; i++, bp++, co += 3) {
<a name="l01931"></a>01931         <span class="keywordflow">if</span> (bp-&gt;hide == 0) {
<a name="l01932"></a>01932             <a class="code" href="../../d3/d02/drawobject_8c.html#a0445d2c25a4d1c9c6f2d827d9f6d4a5b">view3d_project_short_clip</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>, dl ? co : bp-&gt;vec, s, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01933"></a>01933             <span class="keywordflow">if</span> (s[0] != <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a9f2d1998b6b3d4dd9472a8092725e0ef">IS_CLIPPED</a>)
<a name="l01934"></a>01934                 func(userData, bp, s[0], s[1]);
<a name="l01935"></a>01935         }
<a name="l01936"></a>01936     }
<a name="l01937"></a>01937 }
<a name="l01938"></a>01938 
<a name="l01939"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a3ab892be75c3b3759e80c4a3d00634e4">01939</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a3ab892be75c3b3759e80c4a3d00634e4">drawlattice__point</a>(<a class="code" href="../../dd/d40/structLattice.html">Lattice</a> *lt, <a class="code" href="../../d5/d2f/structDispList.html">DispList</a> *dl, <span class="keywordtype">int</span> u, <span class="keywordtype">int</span> v, <span class="keywordtype">int</span> w, <span class="keywordtype">int</span> use_wcol)
<a name="l01940"></a>01940 {
<a name="l01941"></a>01941     <span class="keywordtype">int</span> index = ((w * lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a57fa6ffa7aaaed8c191e55d54eeebb74">pntsv</a> + v) * lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a086be8c4ef28587f6eb08c40d1bab473">pntsu</a>) + u;
<a name="l01942"></a>01942 
<a name="l01943"></a>01943     <span class="keywordflow">if</span> (use_wcol) {
<a name="l01944"></a>01944         <span class="keywordtype">float</span> col[3];
<a name="l01945"></a>01945         <a class="code" href="../../da/d40/structMDeformWeight.html">MDeformWeight</a> *mdw = <a class="code" href="../../d7/dbd/BKE__deform_8h.html#a5a72056408d78af746633e64f2223ea8">defvert_find_index</a>(lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a4a2b2d1f76c8199226ae49ca62403fea">dvert</a> + index, use_wcol - 1);
<a name="l01946"></a>01946         
<a name="l01947"></a>01947         <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#abb4c373c2f4f0297a7807ecd7f7a818c">weight_to_rgb</a>(col, mdw ? mdw-&gt;<a class="code" href="../../da/d40/structMDeformWeight.html#ab18b5a9762544ef80b24f5c5507bd7b7">weight</a> : 0.0f);
<a name="l01948"></a>01948         glColor3fv(col);
<a name="l01949"></a>01949 
<a name="l01950"></a>01950     }
<a name="l01951"></a>01951     
<a name="l01952"></a>01952     <span class="keywordflow">if</span> (dl) {
<a name="l01953"></a>01953         glVertex3fv(&amp;dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>[index * 3]);
<a name="l01954"></a>01954     }
<a name="l01955"></a>01955     <span class="keywordflow">else</span> {
<a name="l01956"></a>01956         glVertex3fv(lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#ae3dc9dd9304be3f153fa96f155d9c7de">def</a>[index].<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l01957"></a>01957     }
<a name="l01958"></a>01958 }
<a name="l01959"></a>01959 
<a name="l01960"></a>01960 <span class="comment">/* lattice color is hardcoded, now also shows weightgroup values in edit mode */</span>
<a name="l01961"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a56a30db33cb386d99e4b3116c0851f0a">01961</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a56a30db33cb386d99e4b3116c0851f0a">drawlattice</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l01962"></a>01962 {
<a name="l01963"></a>01963     <a class="code" href="../../dd/d40/structLattice.html">Lattice</a> *lt = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01964"></a>01964     <a class="code" href="../../d5/d2f/structDispList.html">DispList</a> *dl;
<a name="l01965"></a>01965     <span class="keywordtype">int</span> u, v, w;
<a name="l01966"></a>01966     <span class="keywordtype">int</span> use_wcol = 0, is_edit = (lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a8b26fb4a2936b8ed7929cbffb12ac057">editlatt</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01967"></a>01967 
<a name="l01968"></a>01968     <span class="comment">/* now we default make displist, this will modifiers work for non animated case */</span>
<a name="l01969"></a>01969     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a45d11e4826c3a8ba292c91691bb2885d">disp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01970"></a>01970         <a class="code" href="../../d8/d8f/BKE__lattice_8h.html#ac818dd36b732a8976182c4c12e6f575b">lattice_calc_modifiers</a>(scene, ob);
<a name="l01971"></a>01971     dl = <a class="code" href="../../d9/d12/BKE__displist_8h.html#ad5e487b875d521238ee319bfe8f659f8">find_displist</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a45d11e4826c3a8ba292c91691bb2885d">disp</a>, <a class="code" href="../../d9/d12/BKE__displist_8h.html#a91ca502ecb1aec32fd6e83349c74a085">DL_VERTS</a>);
<a name="l01972"></a>01972     
<a name="l01973"></a>01973     <span class="keywordflow">if</span> (is_edit) {
<a name="l01974"></a>01974         lt = lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a8b26fb4a2936b8ed7929cbffb12ac057">editlatt</a>-&gt;<a class="code" href="../../d5/d06/structEditLatt.html#ad6edc9c8b5a87d60189878e812587a9f">latt</a>;
<a name="l01975"></a>01975 
<a name="l01976"></a>01976         <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(0x004000);
<a name="l01977"></a>01977         
<a name="l01978"></a>01978         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a11c2e3299c854eb361471ea041397cb7">defbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> &amp;&amp; lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a4a2b2d1f76c8199226ae49ca62403fea">dvert</a>) {
<a name="l01979"></a>01979             use_wcol = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8460eeaead60eced482f83f2bf636417">actdef</a>;
<a name="l01980"></a>01980             glShadeModel(GL_SMOOTH);
<a name="l01981"></a>01981         }
<a name="l01982"></a>01982     }
<a name="l01983"></a>01983     
<a name="l01984"></a>01984     glBegin(GL_LINES);
<a name="l01985"></a>01985     <span class="keywordflow">for</span> (w = 0; w &lt; lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a19be731ba1b95cd1ec5df36229baaee2">pntsw</a>; w++) {
<a name="l01986"></a>01986         <span class="keywordtype">int</span> wxt = (w == 0 || w == lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a19be731ba1b95cd1ec5df36229baaee2">pntsw</a> - 1);
<a name="l01987"></a>01987         <span class="keywordflow">for</span> (v = 0; v &lt; lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a57fa6ffa7aaaed8c191e55d54eeebb74">pntsv</a>; v++) {
<a name="l01988"></a>01988             <span class="keywordtype">int</span> vxt = (v == 0 || v == lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a57fa6ffa7aaaed8c191e55d54eeebb74">pntsv</a> - 1);
<a name="l01989"></a>01989             <span class="keywordflow">for</span> (u = 0; u &lt; lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a086be8c4ef28587f6eb08c40d1bab473">pntsu</a>; u++) {
<a name="l01990"></a>01990                 <span class="keywordtype">int</span> uxt = (u == 0 || u == lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a086be8c4ef28587f6eb08c40d1bab473">pntsu</a> - 1);
<a name="l01991"></a>01991 
<a name="l01992"></a>01992                 <span class="keywordflow">if</span> (w &amp;&amp; ((uxt || vxt) || !(lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a63710ce306e2b866557d2af57fe75329">flag</a> &amp; <a class="code" href="../../d4/d2f/DNA__lattice__types_8h.html#a88fd8efda477754bb80253fa2c1dbcfa">LT_OUTSIDE</a>))) {
<a name="l01993"></a>01993                     <a class="code" href="../../d3/d02/drawobject_8c.html#a3ab892be75c3b3759e80c4a3d00634e4">drawlattice__point</a>(lt, dl, u, v, w - 1, use_wcol);
<a name="l01994"></a>01994                     <a class="code" href="../../d3/d02/drawobject_8c.html#a3ab892be75c3b3759e80c4a3d00634e4">drawlattice__point</a>(lt, dl, u, v, w, use_wcol);
<a name="l01995"></a>01995                 }
<a name="l01996"></a>01996                 <span class="keywordflow">if</span> (v &amp;&amp; ((uxt || wxt) || !(lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a63710ce306e2b866557d2af57fe75329">flag</a> &amp; <a class="code" href="../../d4/d2f/DNA__lattice__types_8h.html#a88fd8efda477754bb80253fa2c1dbcfa">LT_OUTSIDE</a>))) {
<a name="l01997"></a>01997                     <a class="code" href="../../d3/d02/drawobject_8c.html#a3ab892be75c3b3759e80c4a3d00634e4">drawlattice__point</a>(lt, dl, u, v - 1, w, use_wcol);
<a name="l01998"></a>01998                     <a class="code" href="../../d3/d02/drawobject_8c.html#a3ab892be75c3b3759e80c4a3d00634e4">drawlattice__point</a>(lt, dl, u, v, w, use_wcol);
<a name="l01999"></a>01999                 }
<a name="l02000"></a>02000                 <span class="keywordflow">if</span> (u &amp;&amp; ((vxt || wxt) || !(lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a63710ce306e2b866557d2af57fe75329">flag</a> &amp; <a class="code" href="../../d4/d2f/DNA__lattice__types_8h.html#a88fd8efda477754bb80253fa2c1dbcfa">LT_OUTSIDE</a>))) {
<a name="l02001"></a>02001                     <a class="code" href="../../d3/d02/drawobject_8c.html#a3ab892be75c3b3759e80c4a3d00634e4">drawlattice__point</a>(lt, dl, u - 1, v, w, use_wcol);
<a name="l02002"></a>02002                     <a class="code" href="../../d3/d02/drawobject_8c.html#a3ab892be75c3b3759e80c4a3d00634e4">drawlattice__point</a>(lt, dl, u, v, w, use_wcol);
<a name="l02003"></a>02003                 }
<a name="l02004"></a>02004             }
<a name="l02005"></a>02005         }
<a name="l02006"></a>02006     }
<a name="l02007"></a>02007     glEnd();
<a name="l02008"></a>02008     
<a name="l02009"></a>02009     <span class="comment">/* restoration for weight colors */</span>
<a name="l02010"></a>02010     <span class="keywordflow">if</span> (use_wcol)
<a name="l02011"></a>02011         glShadeModel(GL_FLAT);
<a name="l02012"></a>02012 
<a name="l02013"></a>02013     <span class="keywordflow">if</span> (is_edit) {
<a name="l02014"></a>02014         <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#afd443bfd0de5169661f08aa1eeb3bd69">zbuf</a>) glDisable(GL_DEPTH_TEST);
<a name="l02015"></a>02015         
<a name="l02016"></a>02016         <a class="code" href="../../d3/d02/drawobject_8c.html#a07c71654147bfe09543cbc7c0e14bb63">lattice_draw_verts</a>(lt, dl, 0);
<a name="l02017"></a>02017         <a class="code" href="../../d3/d02/drawobject_8c.html#a07c71654147bfe09543cbc7c0e14bb63">lattice_draw_verts</a>(lt, dl, 1);
<a name="l02018"></a>02018         
<a name="l02019"></a>02019         <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#afd443bfd0de5169661f08aa1eeb3bd69">zbuf</a>) glEnable(GL_DEPTH_TEST);
<a name="l02020"></a>02020     }
<a name="l02021"></a>02021 }
<a name="l02022"></a>02022 
<a name="l02023"></a>02023 <span class="comment">/* ***************** ******************** */</span>
<a name="l02024"></a>02024 
<a name="l02025"></a>02025 <span class="comment">/* Note! - foreach funcs should be called while drawing or directly after</span>
<a name="l02026"></a>02026 <span class="comment"> * if not, ED_view3d_init_mats_rv3d() can be used for selection tools</span>
<a name="l02027"></a>02027 <span class="comment"> * but would not give correct results with dupli&#39;s for eg. which don&#39;t</span>
<a name="l02028"></a>02028 <span class="comment"> * use the object matrix in the usual way */</span>
<a name="l02029"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ade3d354132b92b4db1363702f37bf449">02029</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ade3d354132b92b4db1363702f37bf449">mesh_foreachScreenVert__mapFunc</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>[3],
<a name="l02030"></a>02030                                             <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(no_f[3]), <span class="keyword">const</span> <span class="keywordtype">short</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(no_s[3]))
<a name="l02031"></a>02031 {
<a name="l02032"></a>02032     <a class="code" href="../../d4/de1/structforeachScreenVert__userData.html">foreachScreenVert_userData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = userData;
<a name="l02033"></a>02033     <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *eve = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a63e064e5e9c88cbdb131a3c55d1e6c26">EDBM_vert_at_index</a>(data-&gt;<a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a0a7bc9ba2e3a38d9b3715215529721ab">vc</a>.<a class="code" href="../../d8/d30/structViewContext.html#a779850db8a807574ddb22da4e3a5e38d">em</a>, index);
<a name="l02034"></a>02034 
<a name="l02035"></a>02035     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eve, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>)) {
<a name="l02036"></a>02036         <span class="keywordtype">short</span> s[2] = {<a class="code" href="../../d8/d6a/ED__view3d_8h.html#a9f2d1998b6b3d4dd9472a8092725e0ef">IS_CLIPPED</a>, 0};
<a name="l02037"></a>02037 
<a name="l02038"></a>02038         <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a59bc081b4f062c2e920211ee61a85e69">clipVerts</a> != <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a578b283de8cc09dcb1fa8331d7519156abe21c7953047595210084549499ff3ce">V3D_CLIP_TEST_OFF</a>) {
<a name="l02039"></a>02039             <a class="code" href="../../d3/d02/drawobject_8c.html#a0445d2c25a4d1c9c6f2d827d9f6d4a5b">view3d_project_short_clip</a>(data-&gt;<a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a0a7bc9ba2e3a38d9b3715215529721ab">vc</a>.<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>, co, s, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02040"></a>02040         }
<a name="l02041"></a>02041         <span class="keywordflow">else</span> {
<a name="l02042"></a>02042             <span class="keywordtype">float</span> co2[2];
<a name="l02043"></a>02043             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad7be0179ee8a128512e2c7f0ad11c8d8">mul_v3_m4v3</a>(co2, data-&gt;<a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a0a7bc9ba2e3a38d9b3715215529721ab">vc</a>.<a class="code" href="../../d8/d30/structViewContext.html#aa802aba424149fb5c03e34795a836810">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, co);
<a name="l02044"></a>02044             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#abe8ec29bb1b67a0652719120cf470a88">project_short_noclip</a>(data-&gt;<a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a0a7bc9ba2e3a38d9b3715215529721ab">vc</a>.<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>, co2, s);
<a name="l02045"></a>02045         }
<a name="l02046"></a>02046 
<a name="l02047"></a>02047         <span class="keywordflow">if</span> (s[0] != <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a9f2d1998b6b3d4dd9472a8092725e0ef">IS_CLIPPED</a>)
<a name="l02048"></a>02048             data-&gt;<a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a71530598f6d1ec155e001c53f86c1b9d">func</a>(data-&gt;<a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a23d6f25d920e6e08efeccb8162cf111f">userData</a>, eve, s[0], s[1], index);
<a name="l02049"></a>02049     }
<a name="l02050"></a>02050 }
<a name="l02051"></a>02051 
<a name="l02052"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a7541d97bebfefdb2a04ad6a21c5b94bb">02052</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a3b1f35aee37942c9e53c46c1d296a69a">mesh_foreachScreenVert</a>(
<a name="l02053"></a>02053     <a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> *vc,
<a name="l02054"></a>02054     <span class="keywordtype">void</span> (*func)(<span class="keywordtype">void</span> *userData, <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *eve, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> index),
<a name="l02055"></a>02055     <span class="keywordtype">void</span> *userData, <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a578b283de8cc09dcb1fa8331d7519156">eV3DClipTest</a> clipVerts)
<a name="l02056"></a>02056 {
<a name="l02057"></a>02057     <a class="code" href="../../d4/de1/structforeachScreenVert__userData.html">foreachScreenVert_userData</a> <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l02058"></a>02058     <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm = <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#aadc7033561fddea210085209cea4dfa1">editbmesh_get_derived_cage</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a318ac2fefa5f4e6ad6faa0a7249d7e73">scene</a>, vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#aa802aba424149fb5c03e34795a836810">obedit</a>, vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a779850db8a807574ddb22da4e3a5e38d">em</a>, <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#ac302305683fc6e7bba64ef68c74a1404">CD_MASK_BAREMESH</a>);
<a name="l02059"></a>02059     
<a name="l02060"></a>02060     data.<a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a0a7bc9ba2e3a38d9b3715215529721ab">vc</a> = *vc;
<a name="l02061"></a>02061     data.<a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a71530598f6d1ec155e001c53f86c1b9d">func</a> = func;
<a name="l02062"></a>02062     data.<a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a23d6f25d920e6e08efeccb8162cf111f">userData</a> = userData;
<a name="l02063"></a>02063     data.<a class="code" href="../../d4/de1/structforeachScreenVert__userData.html#a59bc081b4f062c2e920211ee61a85e69">clipVerts</a> = clipVerts;
<a name="l02064"></a>02064 
<a name="l02065"></a>02065     <span class="keywordflow">if</span> (clipVerts != <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a578b283de8cc09dcb1fa8331d7519156abe21c7953047595210084549499ff3ce">V3D_CLIP_TEST_OFF</a>)
<a name="l02066"></a>02066         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af23af849d7708b6c8c92edc20bb450af">ED_view3d_clipping_local</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#ae849219034a130d5a58b5164ab8fc960">rv3d</a>, vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#aa802aba424149fb5c03e34795a836810">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);  <span class="comment">/* for local clipping lookups */</span>
<a name="l02067"></a>02067 
<a name="l02068"></a>02068     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#aa97a3443500c36b7a92a1e2970370561">EDBM_index_arrays_init</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a779850db8a807574ddb22da4e3a5e38d">em</a>, 1, 0, 0);
<a name="l02069"></a>02069     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a14c8a2dc23a8af0e7aaf2190f7cf0202">foreachMappedVert</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#ade3d354132b92b4db1363702f37bf449">mesh_foreachScreenVert__mapFunc</a>, &amp;data);
<a name="l02070"></a>02070     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ade6a9b6920d5141b0102b60995a5b91f">EDBM_index_arrays_free</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a779850db8a807574ddb22da4e3a5e38d">em</a>);
<a name="l02071"></a>02071 
<a name="l02072"></a>02072     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a36c159344a023f5fbe64f12006c8647f">release</a>(dm);
<a name="l02073"></a>02073 }
<a name="l02074"></a>02074 
<a name="l02075"></a>02075 <span class="comment">/*  draw callback */</span>
<a name="l02076"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a142b6128275b837dd0ec77c9a7eafe7a">02076</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a142b6128275b837dd0ec77c9a7eafe7a">drawSelectedVertices__mapFunc</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">float</span> co[3],
<a name="l02077"></a>02077                                           <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(no_f[3]), <span class="keyword">const</span> <span class="keywordtype">short</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(no_s[3]))
<a name="l02078"></a>02078 {
<a name="l02079"></a>02079     <a class="code" href="../../d8/de5/structMVert.html">MVert</a> *mv = &amp;((<a class="code" href="../../d8/de5/structMVert.html">MVert</a> *)userData)[index];
<a name="l02080"></a>02080 
<a name="l02081"></a>02081     <span class="keywordflow">if</span> (!(mv-&gt;<a class="code" href="../../d8/de5/structMVert.html#ad635bc3f86fdb7266167069b0cd4cde9">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>)) {
<a name="l02082"></a>02082         <span class="keyword">const</span> <span class="keywordtype">char</span> sel = mv-&gt;<a class="code" href="../../d8/de5/structMVert.html#ad635bc3f86fdb7266167069b0cd4cde9">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l02083"></a>02083 
<a name="l02084"></a>02084         <span class="comment">// TODO define selected color</span>
<a name="l02085"></a>02085         <span class="keywordflow">if</span> (sel) {
<a name="l02086"></a>02086             glColor3f(1.0f, 1.0f, 0.0f);
<a name="l02087"></a>02087         }
<a name="l02088"></a>02088         <span class="keywordflow">else</span> {
<a name="l02089"></a>02089             glColor3f(0.0f, 0.0f, 0.0f);
<a name="l02090"></a>02090         }
<a name="l02091"></a>02091 
<a name="l02092"></a>02092         glVertex3fv(co);
<a name="l02093"></a>02093     }
<a name="l02094"></a>02094 }
<a name="l02095"></a>02095 
<a name="l02096"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a7ac346154ad0ffffa9073f549822e29f">02096</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a7ac346154ad0ffffa9073f549822e29f">drawSelectedVertices</a>(<a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm, <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me)
<a name="l02097"></a>02097 {
<a name="l02098"></a>02098     glBegin(GL_POINTS);
<a name="l02099"></a>02099     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a14c8a2dc23a8af0e7aaf2190f7cf0202">foreachMappedVert</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#a142b6128275b837dd0ec77c9a7eafe7a">drawSelectedVertices__mapFunc</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a422181e95f8eeb611b58ca26b5f62bdf">mvert</a>);
<a name="l02100"></a>02100     glEnd();
<a name="l02101"></a>02101 }
<a name="l02102"></a>02102 
<a name="l02103"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a7844785b9aba4fba49b95ac59c16f91a">02103</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a7844785b9aba4fba49b95ac59c16f91a">mesh_foreachScreenEdge__mapFunc</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">float</span> v0co[3], <span class="keyword">const</span> <span class="keywordtype">float</span> v1co[3])
<a name="l02104"></a>02104 {
<a name="l02105"></a>02105     <a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html">foreachScreenEdge_userData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = userData;
<a name="l02106"></a>02106     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *eed = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a84b498997c52686a55d7ea755d1e6bc3">EDBM_edge_at_index</a>(data-&gt;<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#a2fe168c824b94b3839f794d3be9caa76">vc</a>.<a class="code" href="../../d8/d30/structViewContext.html#a779850db8a807574ddb22da4e3a5e38d">em</a>, index);
<a name="l02107"></a>02107 
<a name="l02108"></a>02108     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eed, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>)) {
<a name="l02109"></a>02109         <span class="keywordtype">short</span> s[2][2];
<a name="l02110"></a>02110 
<a name="l02111"></a>02111         <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#affb870354473938c07deeb073bfb669e">clipVerts</a> == <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a578b283de8cc09dcb1fa8331d7519156a50b54fc86e631d3cb887eed01eb3ca53">V3D_CLIP_TEST_RV3D_CLIPPING</a>) {
<a name="l02112"></a>02112             <a class="code" href="../../d3/d02/drawobject_8c.html#a0445d2c25a4d1c9c6f2d827d9f6d4a5b">view3d_project_short_clip</a>(data-&gt;<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#a2fe168c824b94b3839f794d3be9caa76">vc</a>.<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>, v0co, s[0], <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02113"></a>02113             <a class="code" href="../../d3/d02/drawobject_8c.html#a0445d2c25a4d1c9c6f2d827d9f6d4a5b">view3d_project_short_clip</a>(data-&gt;<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#a2fe168c824b94b3839f794d3be9caa76">vc</a>.<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>, v1co, s[1], <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02114"></a>02114         }
<a name="l02115"></a>02115         <span class="keywordflow">else</span> {
<a name="l02116"></a>02116             <span class="keywordtype">float</span> v1_co[3], v2_co[3];
<a name="l02117"></a>02117 
<a name="l02118"></a>02118             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad7be0179ee8a128512e2c7f0ad11c8d8">mul_v3_m4v3</a>(v1_co, data-&gt;<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#a2fe168c824b94b3839f794d3be9caa76">vc</a>.<a class="code" href="../../d8/d30/structViewContext.html#aa802aba424149fb5c03e34795a836810">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, v0co);
<a name="l02119"></a>02119             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad7be0179ee8a128512e2c7f0ad11c8d8">mul_v3_m4v3</a>(v2_co, data-&gt;<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#a2fe168c824b94b3839f794d3be9caa76">vc</a>.<a class="code" href="../../d8/d30/structViewContext.html#aa802aba424149fb5c03e34795a836810">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, v1co);
<a name="l02120"></a>02120 
<a name="l02121"></a>02121             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#abe8ec29bb1b67a0652719120cf470a88">project_short_noclip</a>(data-&gt;<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#a2fe168c824b94b3839f794d3be9caa76">vc</a>.<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>, v1_co, s[0]);
<a name="l02122"></a>02122             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#abe8ec29bb1b67a0652719120cf470a88">project_short_noclip</a>(data-&gt;<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#a2fe168c824b94b3839f794d3be9caa76">vc</a>.<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>, v2_co, s[1]);
<a name="l02123"></a>02123 
<a name="l02124"></a>02124             <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#affb870354473938c07deeb073bfb669e">clipVerts</a> == <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a578b283de8cc09dcb1fa8331d7519156a5ca9988695260d7e00447e7819180e99">V3D_CLIP_TEST_REGION</a>) {
<a name="l02125"></a>02125                 <span class="comment">/* make an int copy */</span>
<a name="l02126"></a>02126                 <span class="keywordtype">int</span> s_int[2][2] = {{s[0][0], s[0][1]},
<a name="l02127"></a>02127                                    {s[1][0], s[1][1]}};
<a name="l02128"></a>02128                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d44/BLI__rect_8h.html#a6919a441b40500fcdb269cd28ed57de0">BLI_segment_in_rcti</a>(&amp;data-&gt;<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#a190d849f1a42ead3c2ca3ae7a051bddf">win_rect</a>, s_int[0], s_int[1])) {
<a name="l02129"></a>02129                     <span class="keywordflow">return</span>;
<a name="l02130"></a>02130                 }
<a name="l02131"></a>02131             }
<a name="l02132"></a>02132         }
<a name="l02133"></a>02133 
<a name="l02134"></a>02134         data-&gt;<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#ab9dee8cc83dad9739903bf4b2e5862fb">func</a>(data-&gt;<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#ae147bb3d09dc5549c6f2ef8abfb3461f">userData</a>, eed, s[0][0], s[0][1], s[1][0], s[1][1], index);
<a name="l02135"></a>02135     }
<a name="l02136"></a>02136 }
<a name="l02137"></a>02137 
<a name="l02138"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ad180e5cd59794e9b1752bbf364bce65d">02138</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af80dc95241d557a0ae6021aa8b1ecb71">mesh_foreachScreenEdge</a>(
<a name="l02139"></a>02139     <a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> *vc,
<a name="l02140"></a>02140     <span class="keywordtype">void</span> (*func)(<span class="keywordtype">void</span> *userData, <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *eed, <span class="keywordtype">int</span> x0, <span class="keywordtype">int</span> y0, <span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> index),
<a name="l02141"></a>02141     <span class="keywordtype">void</span> *userData, <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a578b283de8cc09dcb1fa8331d7519156">eV3DClipTest</a> clipVerts)
<a name="l02142"></a>02142 {
<a name="l02143"></a>02143     <a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html">foreachScreenEdge_userData</a> <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l02144"></a>02144     <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm = <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#aadc7033561fddea210085209cea4dfa1">editbmesh_get_derived_cage</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a318ac2fefa5f4e6ad6faa0a7249d7e73">scene</a>, vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#aa802aba424149fb5c03e34795a836810">obedit</a>, vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a779850db8a807574ddb22da4e3a5e38d">em</a>, <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#ac302305683fc6e7bba64ef68c74a1404">CD_MASK_BAREMESH</a>);
<a name="l02145"></a>02145 
<a name="l02146"></a>02146     data.<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#a2fe168c824b94b3839f794d3be9caa76">vc</a> = *vc;
<a name="l02147"></a>02147 
<a name="l02148"></a>02148     data.<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#a190d849f1a42ead3c2ca3ae7a051bddf">win_rect</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> = 0;
<a name="l02149"></a>02149     data.<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#a190d849f1a42ead3c2ca3ae7a051bddf">win_rect</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> = 0;
<a name="l02150"></a>02150     data.<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#a190d849f1a42ead3c2ca3ae7a051bddf">win_rect</a>.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> = vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#a32e37003215c0dc7f77e12e4fc9db3f4">winx</a>;
<a name="l02151"></a>02151     data.<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#a190d849f1a42ead3c2ca3ae7a051bddf">win_rect</a>.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> = vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#a908d20a23657ef143d2de1496be69f42">winy</a>;
<a name="l02152"></a>02152 
<a name="l02153"></a>02153     data.<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#ab9dee8cc83dad9739903bf4b2e5862fb">func</a> = func;
<a name="l02154"></a>02154     data.<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#ae147bb3d09dc5549c6f2ef8abfb3461f">userData</a> = userData;
<a name="l02155"></a>02155     data.<a class="code" href="../../d5/df0/structforeachScreenEdge__userData.html#affb870354473938c07deeb073bfb669e">clipVerts</a> = clipVerts;
<a name="l02156"></a>02156 
<a name="l02157"></a>02157     <span class="keywordflow">if</span> (clipVerts != <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a578b283de8cc09dcb1fa8331d7519156abe21c7953047595210084549499ff3ce">V3D_CLIP_TEST_OFF</a>)
<a name="l02158"></a>02158         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af23af849d7708b6c8c92edc20bb450af">ED_view3d_clipping_local</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#ae849219034a130d5a58b5164ab8fc960">rv3d</a>, vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#aa802aba424149fb5c03e34795a836810">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);  <span class="comment">/* for local clipping lookups */</span>
<a name="l02159"></a>02159 
<a name="l02160"></a>02160     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#aa97a3443500c36b7a92a1e2970370561">EDBM_index_arrays_init</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a779850db8a807574ddb22da4e3a5e38d">em</a>, 0, 1, 0);
<a name="l02161"></a>02161     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a173f549d7116937130db6951cf5c8777">foreachMappedEdge</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#a7844785b9aba4fba49b95ac59c16f91a">mesh_foreachScreenEdge__mapFunc</a>, &amp;data);
<a name="l02162"></a>02162     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ade6a9b6920d5141b0102b60995a5b91f">EDBM_index_arrays_free</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a779850db8a807574ddb22da4e3a5e38d">em</a>);
<a name="l02163"></a>02163 
<a name="l02164"></a>02164     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a36c159344a023f5fbe64f12006c8647f">release</a>(dm);
<a name="l02165"></a>02165 }
<a name="l02166"></a>02166 
<a name="l02167"></a><a class="code" href="../../d3/d02/drawobject_8c.html#aa67d768ea17b1dda8e96c23b5bc164ac">02167</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#aa67d768ea17b1dda8e96c23b5bc164ac">mesh_foreachScreenFace__mapFunc</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">float</span> cent[3], <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(no[3]))
<a name="l02168"></a>02168 {
<a name="l02169"></a>02169     <a class="code" href="../../d6/d75/structforeachScreenFace__userData.html">foreachScreenFace_userData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = userData;
<a name="l02170"></a>02170     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a79834f648f43a4b01046a46de38fbcec">EDBM_face_at_index</a>(data-&gt;<a class="code" href="../../d6/d75/structforeachScreenFace__userData.html#a29a5567f8ecc34c4f3fecf30a7197b6d">vc</a>.<a class="code" href="../../d8/d30/structViewContext.html#a779850db8a807574ddb22da4e3a5e38d">em</a>, index);
<a name="l02171"></a>02171 
<a name="l02172"></a>02172     <span class="keywordflow">if</span> (efa &amp;&amp; !<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>)) {
<a name="l02173"></a>02173         <span class="keywordtype">float</span> cent2[3];
<a name="l02174"></a>02174         <span class="keywordtype">short</span> s[2];
<a name="l02175"></a>02175 
<a name="l02176"></a>02176         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad7be0179ee8a128512e2c7f0ad11c8d8">mul_v3_m4v3</a>(cent2, data-&gt;<a class="code" href="../../d6/d75/structforeachScreenFace__userData.html#a29a5567f8ecc34c4f3fecf30a7197b6d">vc</a>.<a class="code" href="../../d8/d30/structViewContext.html#aa802aba424149fb5c03e34795a836810">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, cent);
<a name="l02177"></a>02177         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1f87ab9476813c561e60c884c6445ba1">project_short</a>(data-&gt;<a class="code" href="../../d6/d75/structforeachScreenFace__userData.html#a29a5567f8ecc34c4f3fecf30a7197b6d">vc</a>.<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>, cent2, s);
<a name="l02178"></a>02178 
<a name="l02179"></a>02179         <span class="keywordflow">if</span> (s[0] != <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a9f2d1998b6b3d4dd9472a8092725e0ef">IS_CLIPPED</a>) {
<a name="l02180"></a>02180             data-&gt;<a class="code" href="../../d6/d75/structforeachScreenFace__userData.html#afb67cee15484dd94016c3c94f7fdcdbe">func</a>(data-&gt;<a class="code" href="../../d6/d75/structforeachScreenFace__userData.html#a5895b2476a0bf8de38326ea32f79dae0">userData</a>, efa, s[0], s[1], index);
<a name="l02181"></a>02181         }
<a name="l02182"></a>02182     }
<a name="l02183"></a>02183 }
<a name="l02184"></a>02184 
<a name="l02185"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a271790437f048bd529d430c479bc1daa">02185</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d6a/ED__view3d_8h.html#aa3ebeaf5243eb54a1641757167e346e4">mesh_foreachScreenFace</a>(
<a name="l02186"></a>02186     <a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> *vc,
<a name="l02187"></a>02187     <span class="keywordtype">void</span> (*func)(<span class="keywordtype">void</span> *userData, <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> index),
<a name="l02188"></a>02188     <span class="keywordtype">void</span> *userData)
<a name="l02189"></a>02189 {
<a name="l02190"></a>02190     <a class="code" href="../../d6/d75/structforeachScreenFace__userData.html">foreachScreenFace_userData</a> <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l02191"></a>02191     <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm = <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#aadc7033561fddea210085209cea4dfa1">editbmesh_get_derived_cage</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a318ac2fefa5f4e6ad6faa0a7249d7e73">scene</a>, vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#aa802aba424149fb5c03e34795a836810">obedit</a>, vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a779850db8a807574ddb22da4e3a5e38d">em</a>, <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#ac302305683fc6e7bba64ef68c74a1404">CD_MASK_BAREMESH</a>);
<a name="l02192"></a>02192 
<a name="l02193"></a>02193     data.<a class="code" href="../../d6/d75/structforeachScreenFace__userData.html#a29a5567f8ecc34c4f3fecf30a7197b6d">vc</a> = *vc;
<a name="l02194"></a>02194     data.<a class="code" href="../../d6/d75/structforeachScreenFace__userData.html#afb67cee15484dd94016c3c94f7fdcdbe">func</a> = func;
<a name="l02195"></a>02195     data.<a class="code" href="../../d6/d75/structforeachScreenFace__userData.html#a5895b2476a0bf8de38326ea32f79dae0">userData</a> = userData;
<a name="l02196"></a>02196 
<a name="l02197"></a>02197     <span class="comment">//if (clipVerts)</span>
<a name="l02198"></a>02198     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af23af849d7708b6c8c92edc20bb450af">ED_view3d_clipping_local</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#ae849219034a130d5a58b5164ab8fc960">rv3d</a>, vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#aa802aba424149fb5c03e34795a836810">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>); <span class="comment">/* for local clipping lookups */</span>
<a name="l02199"></a>02199 
<a name="l02200"></a>02200     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#aa97a3443500c36b7a92a1e2970370561">EDBM_index_arrays_init</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a779850db8a807574ddb22da4e3a5e38d">em</a>, 0, 0, 1);
<a name="l02201"></a>02201     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a9a13cfc8abb45d854797053a05f754d1">foreachMappedFaceCenter</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#aa67d768ea17b1dda8e96c23b5bc164ac">mesh_foreachScreenFace__mapFunc</a>, &amp;data);
<a name="l02202"></a>02202     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ade6a9b6920d5141b0102b60995a5b91f">EDBM_index_arrays_free</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a779850db8a807574ddb22da4e3a5e38d">em</a>);
<a name="l02203"></a>02203 
<a name="l02204"></a>02204     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a36c159344a023f5fbe64f12006c8647f">release</a>(dm);
<a name="l02205"></a>02205 }
<a name="l02206"></a>02206 
<a name="l02207"></a><a class="code" href="../../d3/d02/drawobject_8c.html#abe0db6d92cdf91f52f7127eced8b7eca">02207</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a74cc4c276a67e166dcdb5056d8a45cef">nurbs_foreachScreenVert</a>(
<a name="l02208"></a>02208     <a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> *vc,
<a name="l02209"></a>02209     <span class="keywordtype">void</span> (*func)(<span class="keywordtype">void</span> *userData, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt, <span class="keywordtype">int</span> beztindex, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y),
<a name="l02210"></a>02210     <span class="keywordtype">void</span> *userData)
<a name="l02211"></a>02211 {
<a name="l02212"></a>02212     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu = vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#aa802aba424149fb5c03e34795a836810">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l02213"></a>02213     <span class="keywordtype">short</span> s[2] = {<a class="code" href="../../d8/d6a/ED__view3d_8h.html#a9f2d1998b6b3d4dd9472a8092725e0ef">IS_CLIPPED</a>, 0};
<a name="l02214"></a>02214     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l02215"></a>02215     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l02216"></a>02216     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nurbs = <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a444d55e9e251234b0c8e22da36a06819">curve_editnurbs</a>(cu);
<a name="l02217"></a>02217 
<a name="l02218"></a>02218     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af23af849d7708b6c8c92edc20bb450af">ED_view3d_clipping_local</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#ae849219034a130d5a58b5164ab8fc960">rv3d</a>, vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#aa802aba424149fb5c03e34795a836810">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>); <span class="comment">/* for local clipping lookups */</span>
<a name="l02219"></a>02219 
<a name="l02220"></a>02220     <span class="keywordflow">for</span> (nu = nurbs-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l02221"></a>02221         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l02222"></a>02222             <span class="keywordflow">for</span> (i = 0; i &lt; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; i++) {
<a name="l02223"></a>02223                 <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt = &amp;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02224"></a>02224 
<a name="l02225"></a>02225                 <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aaac89168848f34909c578acb0d6cca26">hide</a> == 0) {
<a name="l02226"></a>02226                     
<a name="l02227"></a>02227                     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a7c8120ba8f3b7624fdd42f9d5be7b56d">drawflag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ac8abd02e52a2a9d5f305be68c732923b">CU_HIDE_HANDLES</a>) {
<a name="l02228"></a>02228                         <a class="code" href="../../d3/d02/drawobject_8c.html#a0445d2c25a4d1c9c6f2d827d9f6d4a5b">view3d_project_short_clip</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1], s, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02229"></a>02229                         <span class="keywordflow">if</span> (s[0] != <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a9f2d1998b6b3d4dd9472a8092725e0ef">IS_CLIPPED</a>)
<a name="l02230"></a>02230                             func(userData, nu, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, bezt, 1, s[0], s[1]);
<a name="l02231"></a>02231                     }
<a name="l02232"></a>02232                     <span class="keywordflow">else</span> {
<a name="l02233"></a>02233                         <a class="code" href="../../d3/d02/drawobject_8c.html#a0445d2c25a4d1c9c6f2d827d9f6d4a5b">view3d_project_short_clip</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0], s, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02234"></a>02234                         <span class="keywordflow">if</span> (s[0] != <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a9f2d1998b6b3d4dd9472a8092725e0ef">IS_CLIPPED</a>)
<a name="l02235"></a>02235                             func(userData, nu, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, bezt, 0, s[0], s[1]);
<a name="l02236"></a>02236                         <a class="code" href="../../d3/d02/drawobject_8c.html#a0445d2c25a4d1c9c6f2d827d9f6d4a5b">view3d_project_short_clip</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1], s, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02237"></a>02237                         <span class="keywordflow">if</span> (s[0] != <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a9f2d1998b6b3d4dd9472a8092725e0ef">IS_CLIPPED</a>)
<a name="l02238"></a>02238                             func(userData, nu, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, bezt, 1, s[0], s[1]);
<a name="l02239"></a>02239                         <a class="code" href="../../d3/d02/drawobject_8c.html#a0445d2c25a4d1c9c6f2d827d9f6d4a5b">view3d_project_short_clip</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2], s, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02240"></a>02240                         <span class="keywordflow">if</span> (s[0] != <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a9f2d1998b6b3d4dd9472a8092725e0ef">IS_CLIPPED</a>)
<a name="l02241"></a>02241                             func(userData, nu, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, bezt, 2, s[0], s[1]);
<a name="l02242"></a>02242                     }
<a name="l02243"></a>02243                 }
<a name="l02244"></a>02244             }
<a name="l02245"></a>02245         }
<a name="l02246"></a>02246         <span class="keywordflow">else</span> {
<a name="l02247"></a>02247             <span class="keywordflow">for</span> (i = 0; i &lt; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> * nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; i++) {
<a name="l02248"></a>02248                 <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp = &amp;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02249"></a>02249 
<a name="l02250"></a>02250                 <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a> == 0) {
<a name="l02251"></a>02251                     <a class="code" href="../../d3/d02/drawobject_8c.html#a0445d2c25a4d1c9c6f2d827d9f6d4a5b">view3d_project_short_clip</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>, bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, s, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02252"></a>02252                     <span class="keywordflow">if</span> (s[0] != <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a9f2d1998b6b3d4dd9472a8092725e0ef">IS_CLIPPED</a>)
<a name="l02253"></a>02253                         func(userData, nu, bp, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -1, s[0], s[1]);
<a name="l02254"></a>02254                 }
<a name="l02255"></a>02255             }
<a name="l02256"></a>02256         }
<a name="l02257"></a>02257     }
<a name="l02258"></a>02258 }
<a name="l02259"></a>02259 
<a name="l02260"></a>02260 <span class="comment">/* ************** DRAW MESH ****************** */</span>
<a name="l02261"></a>02261 
<a name="l02262"></a>02262 <span class="comment">/* First section is all the &quot;simple&quot; draw routines, </span>
<a name="l02263"></a>02263 <span class="comment"> * ones that just pass some sort of primitive to GL,</span>
<a name="l02264"></a>02264 <span class="comment"> * with perhaps various options to control lighting,</span>
<a name="l02265"></a>02265 <span class="comment"> * color, etc.</span>
<a name="l02266"></a>02266 <span class="comment"> *</span>
<a name="l02267"></a>02267 <span class="comment"> * These routines should not have user interface related</span>
<a name="l02268"></a>02268 <span class="comment"> * logic!!!</span>
<a name="l02269"></a>02269 <span class="comment"> */</span>
<a name="l02270"></a>02270 
<a name="l02271"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a78a750c6e178bd94293b225473e1785e">02271</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a78a750c6e178bd94293b225473e1785e">draw_dm_face_normals__mapFunc</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">float</span> cent[3], <span class="keyword">const</span> <span class="keywordtype">float</span> no[3])
<a name="l02272"></a>02272 {
<a name="l02273"></a>02273     <a class="code" href="../../de/d2f/structdrawDMNormal__userData.html">drawDMNormal_userData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = userData;
<a name="l02274"></a>02274     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a79834f648f43a4b01046a46de38fbcec">EDBM_face_at_index</a>(data-&gt;<a class="code" href="../../de/d2f/structdrawDMNormal__userData.html#a4f2afd55ed3b426272847be093de26a6">em</a>, index);
<a name="l02275"></a>02275 
<a name="l02276"></a>02276     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>)) {
<a name="l02277"></a>02277         glVertex3fv(cent);
<a name="l02278"></a>02278         glVertex3f(cent[0] + no[0] * data-&gt;<a class="code" href="../../de/d2f/structdrawDMNormal__userData.html#a303390e8d35c9bb0dc26a32d03674376">normalsize</a>,
<a name="l02279"></a>02279                    cent[1] + no[1] * data-&gt;<a class="code" href="../../de/d2f/structdrawDMNormal__userData.html#a303390e8d35c9bb0dc26a32d03674376">normalsize</a>,
<a name="l02280"></a>02280                    cent[2] + no[2] * data-&gt;<a class="code" href="../../de/d2f/structdrawDMNormal__userData.html#a303390e8d35c9bb0dc26a32d03674376">normalsize</a>);
<a name="l02281"></a>02281     }
<a name="l02282"></a>02282 }
<a name="l02283"></a><a class="code" href="../../d3/d02/drawobject_8c.html#abd76371c3296d1a93ea28c74f1d60821">02283</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#abd76371c3296d1a93ea28c74f1d60821">draw_dm_face_normals</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm) 
<a name="l02284"></a>02284 {
<a name="l02285"></a>02285     <a class="code" href="../../de/d2f/structdrawDMNormal__userData.html">drawDMNormal_userData</a> <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l02286"></a>02286 
<a name="l02287"></a>02287     data.<a class="code" href="../../de/d2f/structdrawDMNormal__userData.html#a4f2afd55ed3b426272847be093de26a6">em</a> = em;
<a name="l02288"></a>02288     data.<a class="code" href="../../de/d2f/structdrawDMNormal__userData.html#a303390e8d35c9bb0dc26a32d03674376">normalsize</a> = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a061a6cacabb6dda02f9bc27be4df8628">normalsize</a>;
<a name="l02289"></a>02289 
<a name="l02290"></a>02290     glBegin(GL_LINES);
<a name="l02291"></a>02291     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a9a13cfc8abb45d854797053a05f754d1">foreachMappedFaceCenter</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#a78a750c6e178bd94293b225473e1785e">draw_dm_face_normals__mapFunc</a>, &amp;data);
<a name="l02292"></a>02292     glEnd();
<a name="l02293"></a>02293 }
<a name="l02294"></a>02294 
<a name="l02295"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a0c5142eb802de4283f1e43e8d9e16586">02295</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a0c5142eb802de4283f1e43e8d9e16586">draw_dm_face_centers__mapFunc</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">float</span> cent[3], <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(no[3]))
<a name="l02296"></a>02296 {
<a name="l02297"></a>02297     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a79834f648f43a4b01046a46de38fbcec">EDBM_face_at_index</a>(((<span class="keywordtype">void</span> **)userData)[0], index);
<a name="l02298"></a>02298     <span class="keywordtype">int</span> sel = *(((<span class="keywordtype">int</span> **)userData)[1]);
<a name="l02299"></a>02299     
<a name="l02300"></a>02300     <span class="keywordflow">if</span> (efa &amp;&amp; !<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>) &amp;&amp; <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>) == sel) {
<a name="l02301"></a>02301         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(cent);
<a name="l02302"></a>02302     }
<a name="l02303"></a>02303 }
<a name="l02304"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a1349fea9789cdbfd5f268bb50d36f431">02304</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a1349fea9789cdbfd5f268bb50d36f431">draw_dm_face_centers</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm, <span class="keywordtype">int</span> sel)
<a name="l02305"></a>02305 {
<a name="l02306"></a>02306     <span class="keywordtype">void</span> *ptrs[2] = {em, &amp;sel};
<a name="l02307"></a>02307 
<a name="l02308"></a>02308     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#acbcc8c3223d7fc13a7931b0a1744b240">bglBegin</a>(GL_POINTS);
<a name="l02309"></a>02309     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a9a13cfc8abb45d854797053a05f754d1">foreachMappedFaceCenter</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#a0c5142eb802de4283f1e43e8d9e16586">draw_dm_face_centers__mapFunc</a>, ptrs);
<a name="l02310"></a>02310     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a2517dcaf453d3e58af25fd4c677dad45">bglEnd</a>();
<a name="l02311"></a>02311 }
<a name="l02312"></a>02312 
<a name="l02313"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a879d67bc2c9d716167022a0aad2f22cc">02313</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a879d67bc2c9d716167022a0aad2f22cc">draw_dm_vert_normals__mapFunc</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">float</span> co[3], <span class="keyword">const</span> <span class="keywordtype">float</span> no_f[3], <span class="keyword">const</span> <span class="keywordtype">short</span> no_s[3])
<a name="l02314"></a>02314 {
<a name="l02315"></a>02315     <a class="code" href="../../de/d2f/structdrawDMNormal__userData.html">drawDMNormal_userData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = userData;
<a name="l02316"></a>02316     <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *eve = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a63e064e5e9c88cbdb131a3c55d1e6c26">EDBM_vert_at_index</a>(data-&gt;<a class="code" href="../../de/d2f/structdrawDMNormal__userData.html#a4f2afd55ed3b426272847be093de26a6">em</a>, index);
<a name="l02317"></a>02317 
<a name="l02318"></a>02318     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eve, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>)) {
<a name="l02319"></a>02319         glVertex3fv(co);
<a name="l02320"></a>02320 
<a name="l02321"></a>02321         <span class="keywordflow">if</span> (no_f) {
<a name="l02322"></a>02322             glVertex3f(co[0] + no_f[0] * data-&gt;<a class="code" href="../../de/d2f/structdrawDMNormal__userData.html#a303390e8d35c9bb0dc26a32d03674376">normalsize</a>,
<a name="l02323"></a>02323                        co[1] + no_f[1] * data-&gt;<a class="code" href="../../de/d2f/structdrawDMNormal__userData.html#a303390e8d35c9bb0dc26a32d03674376">normalsize</a>,
<a name="l02324"></a>02324                        co[2] + no_f[2] * data-&gt;<a class="code" href="../../de/d2f/structdrawDMNormal__userData.html#a303390e8d35c9bb0dc26a32d03674376">normalsize</a>);
<a name="l02325"></a>02325         }
<a name="l02326"></a>02326         <span class="keywordflow">else</span> {
<a name="l02327"></a>02327             glVertex3f(co[0] + no_s[0] * (data-&gt;<a class="code" href="../../de/d2f/structdrawDMNormal__userData.html#a303390e8d35c9bb0dc26a32d03674376">normalsize</a> / 32767.0f),
<a name="l02328"></a>02328                        co[1] + no_s[1] * (data-&gt;<a class="code" href="../../de/d2f/structdrawDMNormal__userData.html#a303390e8d35c9bb0dc26a32d03674376">normalsize</a> / 32767.0f),
<a name="l02329"></a>02329                        co[2] + no_s[2] * (data-&gt;<a class="code" href="../../de/d2f/structdrawDMNormal__userData.html#a303390e8d35c9bb0dc26a32d03674376">normalsize</a> / 32767.0f));
<a name="l02330"></a>02330         }
<a name="l02331"></a>02331     }
<a name="l02332"></a>02332 }
<a name="l02333"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a8b3576444f9a30ddf2164d6e77ef6d36">02333</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a8b3576444f9a30ddf2164d6e77ef6d36">draw_dm_vert_normals</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm) 
<a name="l02334"></a>02334 {
<a name="l02335"></a>02335     <a class="code" href="../../de/d2f/structdrawDMNormal__userData.html">drawDMNormal_userData</a> <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l02336"></a>02336 
<a name="l02337"></a>02337     data.<a class="code" href="../../de/d2f/structdrawDMNormal__userData.html#a4f2afd55ed3b426272847be093de26a6">em</a> = em;
<a name="l02338"></a>02338     data.<a class="code" href="../../de/d2f/structdrawDMNormal__userData.html#a303390e8d35c9bb0dc26a32d03674376">normalsize</a> = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a061a6cacabb6dda02f9bc27be4df8628">normalsize</a>;
<a name="l02339"></a>02339 
<a name="l02340"></a>02340     glBegin(GL_LINES);
<a name="l02341"></a>02341     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a14c8a2dc23a8af0e7aaf2190f7cf0202">foreachMappedVert</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#a879d67bc2c9d716167022a0aad2f22cc">draw_dm_vert_normals__mapFunc</a>, &amp;data);
<a name="l02342"></a>02342     glEnd();
<a name="l02343"></a>02343 }
<a name="l02344"></a>02344 
<a name="l02345"></a>02345 <span class="comment">/* Draw verts with color set based on selection */</span>
<a name="l02346"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a83b543fa66ff2b9d572b76e44bfe13cf">02346</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a83b543fa66ff2b9d572b76e44bfe13cf">draw_dm_verts__mapFunc</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">float</span> co[3],
<a name="l02347"></a>02347                                    <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(no_f[3]), <span class="keyword">const</span> <span class="keywordtype">short</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(no_s[3]))
<a name="l02348"></a>02348 {
<a name="l02349"></a>02349     <a class="code" href="../../d0/d9c/structdrawDMVerts__userData.html">drawDMVerts_userData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = userData;
<a name="l02350"></a>02350     <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *eve = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a63e064e5e9c88cbdb131a3c55d1e6c26">EDBM_vert_at_index</a>(data-&gt;<a class="code" href="../../d0/d9c/structdrawDMVerts__userData.html#a80e0663ed5803692d0e023d548929f9a">em</a>, index);
<a name="l02351"></a>02351 
<a name="l02352"></a>02352     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eve, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>) &amp;&amp; <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eve, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>) == data-&gt;<a class="code" href="../../d0/d9c/structdrawDMVerts__userData.html#afb07fcec42205490e5201f555458f5c5">sel</a>) {
<a name="l02353"></a>02353         <span class="comment">/* draw active larger - need to stop/start point drawing for this :/ */</span>
<a name="l02354"></a>02354         <span class="keywordflow">if</span> (eve == data-&gt;<a class="code" href="../../d0/d9c/structdrawDMVerts__userData.html#a3842fa8b094fc18c7012a27650c28e1c">eve_act</a>) {
<a name="l02355"></a>02355             <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a> = <a class="code" href="../../de/d96/UI__resources_8h.html#ad9772e3578b739880ada62a6d21f4349">UI_GetThemeValuef</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a6c88c69347ab72b259eb7fcc8885327b">TH_VERTEX_SIZE</a>);
<a name="l02356"></a>02356             <a class="code" href="../../de/d96/UI__resources_8h.html#ab3928c18aa7a95c23ed48412beb3a5d1">UI_ThemeColor4</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531aacfd0ce5535550b8698a39caac9702ea">TH_EDITMESH_ACTIVE</a>);
<a name="l02357"></a>02357             
<a name="l02358"></a>02358             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a2517dcaf453d3e58af25fd4c677dad45">bglEnd</a>();
<a name="l02359"></a>02359             
<a name="l02360"></a>02360             glPointSize(size);
<a name="l02361"></a>02361             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#acbcc8c3223d7fc13a7931b0a1744b240">bglBegin</a>(GL_POINTS);
<a name="l02362"></a>02362             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(co);
<a name="l02363"></a>02363             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a2517dcaf453d3e58af25fd4c677dad45">bglEnd</a>();
<a name="l02364"></a>02364             
<a name="l02365"></a>02365             <a class="code" href="../../de/d96/UI__resources_8h.html#ab3928c18aa7a95c23ed48412beb3a5d1">UI_ThemeColor4</a>(data-&gt;<a class="code" href="../../d0/d9c/structdrawDMVerts__userData.html#afb07fcec42205490e5201f555458f5c5">sel</a> ? <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a99466ebe41be745cf51950acc8423924">TH_VERTEX_SELECT</a> : <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a6933328b6df4400c196ee99ddd608afd">TH_VERTEX</a>);
<a name="l02366"></a>02366             glPointSize(size);
<a name="l02367"></a>02367             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#acbcc8c3223d7fc13a7931b0a1744b240">bglBegin</a>(GL_POINTS);
<a name="l02368"></a>02368         }
<a name="l02369"></a>02369         <span class="keywordflow">else</span> {
<a name="l02370"></a>02370             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(co);
<a name="l02371"></a>02371         }
<a name="l02372"></a>02372     }
<a name="l02373"></a>02373 }
<a name="l02374"></a>02374 
<a name="l02375"></a><a class="code" href="../../d3/d02/drawobject_8c.html#af0a53825ebb52ed6755b678de2b28dfd">02375</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#af0a53825ebb52ed6755b678de2b28dfd">draw_dm_verts</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm, <span class="keywordtype">int</span> sel, <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *eve_act)
<a name="l02376"></a>02376 {
<a name="l02377"></a>02377     <a class="code" href="../../d0/d9c/structdrawDMVerts__userData.html">drawDMVerts_userData</a> <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l02378"></a>02378     data.<a class="code" href="../../d0/d9c/structdrawDMVerts__userData.html#afb07fcec42205490e5201f555458f5c5">sel</a> = sel;
<a name="l02379"></a>02379     data.<a class="code" href="../../d0/d9c/structdrawDMVerts__userData.html#a3842fa8b094fc18c7012a27650c28e1c">eve_act</a> = eve_act;
<a name="l02380"></a>02380     data.<a class="code" href="../../d0/d9c/structdrawDMVerts__userData.html#a80e0663ed5803692d0e023d548929f9a">em</a> = em;
<a name="l02381"></a>02381 
<a name="l02382"></a>02382     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#acbcc8c3223d7fc13a7931b0a1744b240">bglBegin</a>(GL_POINTS);
<a name="l02383"></a>02383     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a14c8a2dc23a8af0e7aaf2190f7cf0202">foreachMappedVert</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#a83b543fa66ff2b9d572b76e44bfe13cf">draw_dm_verts__mapFunc</a>, &amp;data);
<a name="l02384"></a>02384     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a2517dcaf453d3e58af25fd4c677dad45">bglEnd</a>();
<a name="l02385"></a>02385 }
<a name="l02386"></a>02386 
<a name="l02387"></a>02387 <span class="comment">/* Draw edges with color set based on selection */</span>
<a name="l02388"></a><a class="code" href="../../d3/d02/drawobject_8c.html#aca785c5757f3e27c5df5b883583330c2">02388</a> <span class="keyword">static</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442">DMDrawOption</a> <a class="code" href="../../d3/d02/drawobject_8c.html#aca785c5757f3e27c5df5b883583330c2">draw_dm_edges_sel__setDrawOptions</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index)
<a name="l02389"></a>02389 {
<a name="l02390"></a>02390     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *eed;
<a name="l02391"></a>02391     <span class="comment">//unsigned char **cols = userData, *col;</span>
<a name="l02392"></a>02392     <a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html">drawDMEdgesSel_userData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = userData;
<a name="l02393"></a>02393     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *col;
<a name="l02394"></a>02394 
<a name="l02395"></a>02395     eed = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a84b498997c52686a55d7ea755d1e6bc3">EDBM_edge_at_index</a>(data-&gt;<a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html#a1331366255b83f333f9d5530cccc999e">em</a>, index);
<a name="l02396"></a>02396 
<a name="l02397"></a>02397     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eed, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>)) {
<a name="l02398"></a>02398         <span class="keywordflow">if</span> (eed == data-&gt;<a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html#af1b397f655bc5d124477fdc7f7297094">eed_act</a>) {
<a name="l02399"></a>02399             glColor4ubv(data-&gt;<a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html#a4a202bdcbb9056e73a83c864860954b3">actCol</a>);
<a name="l02400"></a>02400         }
<a name="l02401"></a>02401         <span class="keywordflow">else</span> {
<a name="l02402"></a>02402             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eed, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)) {
<a name="l02403"></a>02403                 col = data-&gt;<a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html#a1e36e54155150cef769ab189a895942c">selCol</a>;
<a name="l02404"></a>02404             }
<a name="l02405"></a>02405             <span class="keywordflow">else</span> {
<a name="l02406"></a>02406                 col = data-&gt;<a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html#a9bdac64d9183abb6670d30b86e213f0c">baseCol</a>;
<a name="l02407"></a>02407             }
<a name="l02408"></a>02408             <span class="comment">/* no alpha, this is used so a transparent color can disable drawing unselected edges in editmode  */</span>
<a name="l02409"></a>02409             <span class="keywordflow">if</span> (col[3] == 0)
<a name="l02410"></a>02410                 <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a618a0ba0086f3f3687726db84919260d">DM_DRAW_OPTION_SKIP</a>;
<a name="l02411"></a>02411             
<a name="l02412"></a>02412             glColor4ubv(col);
<a name="l02413"></a>02413         }
<a name="l02414"></a>02414         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442acfb2e0978e1605561279f2b599cf4499">DM_DRAW_OPTION_NORMAL</a>;
<a name="l02415"></a>02415     }
<a name="l02416"></a>02416     <span class="keywordflow">else</span> {
<a name="l02417"></a>02417         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a618a0ba0086f3f3687726db84919260d">DM_DRAW_OPTION_SKIP</a>;
<a name="l02418"></a>02418     }
<a name="l02419"></a>02419 }
<a name="l02420"></a><a class="code" href="../../d3/d02/drawobject_8c.html#af6f97d4c8d201dc5a991bba715e5fadf">02420</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#af6f97d4c8d201dc5a991bba715e5fadf">draw_dm_edges_sel</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *baseCol, 
<a name="l02421"></a>02421                               <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *selCol, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *actCol, <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *eed_act)
<a name="l02422"></a>02422 {
<a name="l02423"></a>02423     <a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html">drawDMEdgesSel_userData</a> <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l02424"></a>02424     
<a name="l02425"></a>02425     data.<a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html#a9bdac64d9183abb6670d30b86e213f0c">baseCol</a> = baseCol;
<a name="l02426"></a>02426     data.<a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html#a1e36e54155150cef769ab189a895942c">selCol</a> = selCol;
<a name="l02427"></a>02427     data.<a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html#a4a202bdcbb9056e73a83c864860954b3">actCol</a> = actCol;
<a name="l02428"></a>02428     data.<a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html#a1331366255b83f333f9d5530cccc999e">em</a> = em;
<a name="l02429"></a>02429     data.<a class="code" href="../../d8/d7e/structdrawDMEdgesSel__userData.html#af1b397f655bc5d124477fdc7f7297094">eed_act</a> = eed_act;
<a name="l02430"></a>02430     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a24108131d9cda75a80fb3361c81f3afa">drawMappedEdges</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#aca785c5757f3e27c5df5b883583330c2">draw_dm_edges_sel__setDrawOptions</a>, &amp;data);
<a name="l02431"></a>02431 }
<a name="l02432"></a>02432 
<a name="l02433"></a>02433 <span class="comment">/* Draw edges */</span>
<a name="l02434"></a><a class="code" href="../../d3/d02/drawobject_8c.html#aba20232c876c68e201ec86d6bd1b1bf5">02434</a> <span class="keyword">static</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442">DMDrawOption</a> <a class="code" href="../../d3/d02/drawobject_8c.html#aba20232c876c68e201ec86d6bd1b1bf5">draw_dm_edges__setDrawOptions</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index)
<a name="l02435"></a>02435 {
<a name="l02436"></a>02436     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(<a class="code" href="../../d5/dd6/ED__mesh_8h.html#a84b498997c52686a55d7ea755d1e6bc3">EDBM_edge_at_index</a>(userData, index), <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>))
<a name="l02437"></a>02437         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a618a0ba0086f3f3687726db84919260d">DM_DRAW_OPTION_SKIP</a>;
<a name="l02438"></a>02438     <span class="keywordflow">else</span>
<a name="l02439"></a>02439         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442acfb2e0978e1605561279f2b599cf4499">DM_DRAW_OPTION_NORMAL</a>;
<a name="l02440"></a>02440 }
<a name="l02441"></a>02441 
<a name="l02442"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a22d0ccad53c2361e1615159f4df40a3f">02442</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a22d0ccad53c2361e1615159f4df40a3f">draw_dm_edges</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm) 
<a name="l02443"></a>02443 {
<a name="l02444"></a>02444     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a24108131d9cda75a80fb3361c81f3afa">drawMappedEdges</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#aba20232c876c68e201ec86d6bd1b1bf5">draw_dm_edges__setDrawOptions</a>, em);
<a name="l02445"></a>02445 }
<a name="l02446"></a>02446 
<a name="l02447"></a>02447 <span class="comment">/* Draw edges with color interpolated based on selection */</span>
<a name="l02448"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a05b57a7fe9d0892bcb85566d5e8c2ed6">02448</a> <span class="keyword">static</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442">DMDrawOption</a> <a class="code" href="../../d3/d02/drawobject_8c.html#a05b57a7fe9d0892bcb85566d5e8c2ed6">draw_dm_edges_sel_interp__setDrawOptions</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index)
<a name="l02449"></a>02449 {
<a name="l02450"></a>02450     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(<a class="code" href="../../d5/dd6/ED__mesh_8h.html#a84b498997c52686a55d7ea755d1e6bc3">EDBM_edge_at_index</a>(((<span class="keywordtype">void</span> **)userData)[0], index), <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>))
<a name="l02451"></a>02451         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a618a0ba0086f3f3687726db84919260d">DM_DRAW_OPTION_SKIP</a>;
<a name="l02452"></a>02452     <span class="keywordflow">else</span>
<a name="l02453"></a>02453         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442acfb2e0978e1605561279f2b599cf4499">DM_DRAW_OPTION_NORMAL</a>;
<a name="l02454"></a>02454 }
<a name="l02455"></a><a class="code" href="../../d3/d02/drawobject_8c.html#aeef9dcad0d9735888a8b0a514c6825de">02455</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#aeef9dcad0d9735888a8b0a514c6825de">draw_dm_edges_sel_interp__setDrawInterpOptions</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index, <span class="keywordtype">float</span> t)
<a name="l02456"></a>02456 {
<a name="l02457"></a>02457     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *eed = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a84b498997c52686a55d7ea755d1e6bc3">EDBM_edge_at_index</a>(((<span class="keywordtype">void</span> **)userData)[0], index);
<a name="l02458"></a>02458     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **cols = userData;
<a name="l02459"></a>02459     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *col0 = cols[(<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eed-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab6378c5ea7e85917c389a1dfdff790ea">v1</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)) ? 2 : 1];
<a name="l02460"></a>02460     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *col1 = cols[(<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eed-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#a00090f09abd0ef12bcf279cb0c41c0ca">v2</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)) ? 2 : 1];
<a name="l02461"></a>02461 
<a name="l02462"></a>02462     glColor4ub(col0[0] + (col1[0] - col0[0]) * t,
<a name="l02463"></a>02463                col0[1] + (col1[1] - col0[1]) * t,
<a name="l02464"></a>02464                col0[2] + (col1[2] - col0[2]) * t,
<a name="l02465"></a>02465                col0[3] + (col1[3] - col0[3]) * t);
<a name="l02466"></a>02466 }
<a name="l02467"></a>02467 
<a name="l02468"></a><a class="code" href="../../d3/d02/drawobject_8c.html#aa9dea8aa86e7d5c589e4752f21be8ec8">02468</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#aa9dea8aa86e7d5c589e4752f21be8ec8">draw_dm_edges_sel_interp</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *baseCol, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *selCol)
<a name="l02469"></a>02469 {
<a name="l02470"></a>02470     <span class="keywordtype">void</span> *cols[3] = {em, baseCol, selCol};
<a name="l02471"></a>02471 
<a name="l02472"></a>02472     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a71cd451780c320e827319248c9abbb6d">drawMappedEdgesInterp</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#a05b57a7fe9d0892bcb85566d5e8c2ed6">draw_dm_edges_sel_interp__setDrawOptions</a>, <a class="code" href="../../d3/d02/drawobject_8c.html#aeef9dcad0d9735888a8b0a514c6825de">draw_dm_edges_sel_interp__setDrawInterpOptions</a>, cols);
<a name="l02473"></a>02473 }
<a name="l02474"></a>02474 
<a name="l02475"></a>02475 <span class="comment">/* Draw only seam edges */</span>
<a name="l02476"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ad1118f60f6d26f1e0d1f5fee06e7214d">02476</a> <span class="keyword">static</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442">DMDrawOption</a> <a class="code" href="../../d3/d02/drawobject_8c.html#ad1118f60f6d26f1e0d1f5fee06e7214d">draw_dm_edges_seams__setDrawOptions</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index)
<a name="l02477"></a>02477 {
<a name="l02478"></a>02478     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *eed = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a84b498997c52686a55d7ea755d1e6bc3">EDBM_edge_at_index</a>(userData, index);
<a name="l02479"></a>02479 
<a name="l02480"></a>02480     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eed, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>) &amp;&amp; <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eed, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a2cc0b5f9695e7e38ce7b0bed337e55d2">BM_ELEM_SEAM</a>))
<a name="l02481"></a>02481         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442acfb2e0978e1605561279f2b599cf4499">DM_DRAW_OPTION_NORMAL</a>;
<a name="l02482"></a>02482     <span class="keywordflow">else</span>
<a name="l02483"></a>02483         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a618a0ba0086f3f3687726db84919260d">DM_DRAW_OPTION_SKIP</a>;
<a name="l02484"></a>02484 }
<a name="l02485"></a>02485 
<a name="l02486"></a><a class="code" href="../../d3/d02/drawobject_8c.html#acfca879fe7357f922e62496e8f9a4905">02486</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#acfca879fe7357f922e62496e8f9a4905">draw_dm_edges_seams</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm)
<a name="l02487"></a>02487 {
<a name="l02488"></a>02488     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a24108131d9cda75a80fb3361c81f3afa">drawMappedEdges</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#ad1118f60f6d26f1e0d1f5fee06e7214d">draw_dm_edges_seams__setDrawOptions</a>, em);
<a name="l02489"></a>02489 }
<a name="l02490"></a>02490 
<a name="l02491"></a>02491 <span class="comment">/* Draw only sharp edges */</span>
<a name="l02492"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ace10f82af2ae507c60ac93fe25adc216">02492</a> <span class="keyword">static</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442">DMDrawOption</a> <a class="code" href="../../d3/d02/drawobject_8c.html#ace10f82af2ae507c60ac93fe25adc216">draw_dm_edges_sharp__setDrawOptions</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index)
<a name="l02493"></a>02493 {
<a name="l02494"></a>02494     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *eed = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a84b498997c52686a55d7ea755d1e6bc3">EDBM_edge_at_index</a>(userData, index);
<a name="l02495"></a>02495 
<a name="l02496"></a>02496     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eed, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>) &amp;&amp; !<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eed, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a7856d7ed2a68a3204cbc021ec2e57017">BM_ELEM_SMOOTH</a>))
<a name="l02497"></a>02497         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442acfb2e0978e1605561279f2b599cf4499">DM_DRAW_OPTION_NORMAL</a>;
<a name="l02498"></a>02498     <span class="keywordflow">else</span>
<a name="l02499"></a>02499         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a618a0ba0086f3f3687726db84919260d">DM_DRAW_OPTION_SKIP</a>;
<a name="l02500"></a>02500 }
<a name="l02501"></a>02501 
<a name="l02502"></a><a class="code" href="../../d3/d02/drawobject_8c.html#abcd4c35b3d8b4d1d4f7b8dd8f0d2866c">02502</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#abcd4c35b3d8b4d1d4f7b8dd8f0d2866c">draw_dm_edges_sharp</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm)
<a name="l02503"></a>02503 {
<a name="l02504"></a>02504     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a24108131d9cda75a80fb3361c81f3afa">drawMappedEdges</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#ace10f82af2ae507c60ac93fe25adc216">draw_dm_edges_sharp__setDrawOptions</a>, em);
<a name="l02505"></a>02505 }
<a name="l02506"></a>02506 
<a name="l02507"></a>02507 
<a name="l02508"></a>02508 <span class="comment">/* Draw faces with color set based on selection</span>
<a name="l02509"></a>02509 <span class="comment"> * return 2 for the active face so it renders with stipple enabled */</span>
<a name="l02510"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a34f36c58510a29bf9bd0361ef05e1dc3">02510</a> <span class="keyword">static</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442">DMDrawOption</a> <a class="code" href="../../d3/d02/drawobject_8c.html#a34f36c58510a29bf9bd0361ef05e1dc3">draw_dm_faces_sel__setDrawOptions</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index)
<a name="l02511"></a>02511 {
<a name="l02512"></a>02512     <a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html">drawDMFacesSel_userData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = userData;
<a name="l02513"></a>02513     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a79834f648f43a4b01046a46de38fbcec">EDBM_face_at_index</a>(data-&gt;<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#a84ef21e53cc5f198f859f9b64378aed9">em</a>, index);
<a name="l02514"></a>02514     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *col;
<a name="l02515"></a>02515     
<a name="l02516"></a>02516     <span class="keywordflow">if</span> (!efa)
<a name="l02517"></a>02517         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a618a0ba0086f3f3687726db84919260d">DM_DRAW_OPTION_SKIP</a>;
<a name="l02518"></a>02518     
<a name="l02519"></a>02519     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>)) {
<a name="l02520"></a>02520         <span class="keywordflow">if</span> (efa == data-&gt;<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#a545a706f2d14c4c5b92130335224fcb2">efa_act</a>) {
<a name="l02521"></a>02521             glColor4ubv(data-&gt;<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#ae92899886af90096a28b581e035842d0">cols</a>[2]);
<a name="l02522"></a>02522             <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a29b532bc98870f23b4b9029566944b5d">DM_DRAW_OPTION_STIPPLE</a>;
<a name="l02523"></a>02523         }
<a name="l02524"></a>02524         <span class="keywordflow">else</span> {
<a name="l02525"></a>02525             col = data-&gt;<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#ae92899886af90096a28b581e035842d0">cols</a>[<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>) ? 1 : 0];
<a name="l02526"></a>02526             <span class="keywordflow">if</span> (col[3] == 0)
<a name="l02527"></a>02527                 <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a618a0ba0086f3f3687726db84919260d">DM_DRAW_OPTION_SKIP</a>;
<a name="l02528"></a>02528             glColor4ubv(col);
<a name="l02529"></a>02529             <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442acfb2e0978e1605561279f2b599cf4499">DM_DRAW_OPTION_NORMAL</a>;
<a name="l02530"></a>02530         }
<a name="l02531"></a>02531     }
<a name="l02532"></a>02532     <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a618a0ba0086f3f3687726db84919260d">DM_DRAW_OPTION_SKIP</a>;
<a name="l02533"></a>02533 }
<a name="l02534"></a>02534 
<a name="l02535"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ace2388f4b588032b95c3e577df7b78ee">02535</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ace2388f4b588032b95c3e577df7b78ee">draw_dm_faces_sel__compareDrawOptions</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index, <span class="keywordtype">int</span> next_index)
<a name="l02536"></a>02536 {
<a name="l02537"></a>02537 
<a name="l02538"></a>02538     <a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html">drawDMFacesSel_userData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = userData;
<a name="l02539"></a>02539     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa;
<a name="l02540"></a>02540     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *next_efa;
<a name="l02541"></a>02541 
<a name="l02542"></a>02542     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *col, *next_col;
<a name="l02543"></a>02543 
<a name="l02544"></a>02544     <span class="keywordflow">if</span> (!data-&gt;<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#a775e559169933b1dfe8e9d8c9327483c">orig_index</a>)
<a name="l02545"></a>02545         <span class="keywordflow">return</span> 0;
<a name="l02546"></a>02546 
<a name="l02547"></a>02547     efa = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a79834f648f43a4b01046a46de38fbcec">EDBM_face_at_index</a>(data-&gt;<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#a84ef21e53cc5f198f859f9b64378aed9">em</a>, data-&gt;<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#a775e559169933b1dfe8e9d8c9327483c">orig_index</a>[index]);
<a name="l02548"></a>02548     next_efa = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a79834f648f43a4b01046a46de38fbcec">EDBM_face_at_index</a>(data-&gt;<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#a84ef21e53cc5f198f859f9b64378aed9">em</a>, data-&gt;<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#a775e559169933b1dfe8e9d8c9327483c">orig_index</a>[next_index]);
<a name="l02549"></a>02549 
<a name="l02550"></a>02550     <span class="keywordflow">if</span> (efa == next_efa)
<a name="l02551"></a>02551         <span class="keywordflow">return</span> 1;
<a name="l02552"></a>02552 
<a name="l02553"></a>02553     <span class="keywordflow">if</span> (efa == data-&gt;<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#a545a706f2d14c4c5b92130335224fcb2">efa_act</a> || next_efa == data-&gt;<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#a545a706f2d14c4c5b92130335224fcb2">efa_act</a>)
<a name="l02554"></a>02554         <span class="keywordflow">return</span> 0;
<a name="l02555"></a>02555 
<a name="l02556"></a>02556     col = data-&gt;<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#ae92899886af90096a28b581e035842d0">cols</a>[<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>) ? 1 : 0];
<a name="l02557"></a>02557     next_col = data-&gt;<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#ae92899886af90096a28b581e035842d0">cols</a>[<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(next_efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>) ? 1 : 0];
<a name="l02558"></a>02558 
<a name="l02559"></a>02559     <span class="keywordflow">if</span> (col[3] == 0 || next_col[3] == 0)
<a name="l02560"></a>02560         <span class="keywordflow">return</span> 0;
<a name="l02561"></a>02561 
<a name="l02562"></a>02562     <span class="keywordflow">return</span> col == next_col;
<a name="l02563"></a>02563 }
<a name="l02564"></a>02564 
<a name="l02565"></a>02565 <span class="comment">/* also draws the active face */</span>
<a name="l02566"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a5ba94c28d5694f77878342947e161350">02566</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a5ba94c28d5694f77878342947e161350">draw_dm_faces_sel</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *baseCol, 
<a name="l02567"></a>02567                               <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *selCol, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *actCol, <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa_act)
<a name="l02568"></a>02568 {
<a name="l02569"></a>02569     <a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html">drawDMFacesSel_userData</a> <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l02570"></a>02570     data.<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#aba8efe78dcc5a467f1e6f9167c7e16be">dm</a> = dm;
<a name="l02571"></a>02571     data.<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#ae92899886af90096a28b581e035842d0">cols</a>[0] = baseCol;
<a name="l02572"></a>02572     data.<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#a84ef21e53cc5f198f859f9b64378aed9">em</a> = em;
<a name="l02573"></a>02573     data.<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#ae92899886af90096a28b581e035842d0">cols</a>[1] = selCol;
<a name="l02574"></a>02574     data.<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#ae92899886af90096a28b581e035842d0">cols</a>[2] = actCol;
<a name="l02575"></a>02575     data.<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#a545a706f2d14c4c5b92130335224fcb2">efa_act</a> = efa_act;
<a name="l02576"></a>02576     data.<a class="code" href="../../d2/dca/structdrawDMFacesSel__userData.html#a775e559169933b1dfe8e9d8c9327483c">orig_index</a> = <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#a6f4a64ea66e4fa753666158e8fb9f2f2">DM_get_tessface_data_layer</a>(dm, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a5e2cdbe47f447a68d43a9410d8c42100">CD_ORIGINDEX</a>);
<a name="l02577"></a>02577 
<a name="l02578"></a>02578     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a68c34c18414350c39f74969f2cf3f276">drawMappedFaces</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#a34f36c58510a29bf9bd0361ef05e1dc3">draw_dm_faces_sel__setDrawOptions</a>, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>, <a class="code" href="../../d3/d02/drawobject_8c.html#ace2388f4b588032b95c3e577df7b78ee">draw_dm_faces_sel__compareDrawOptions</a>, &amp;data, 0);
<a name="l02579"></a>02579 }
<a name="l02580"></a>02580 
<a name="l02581"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a33c43762e0ded96d959e0b76b3de5569">02581</a> <span class="keyword">static</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442">DMDrawOption</a> <a class="code" href="../../d3/d02/drawobject_8c.html#a33c43762e0ded96d959e0b76b3de5569">draw_dm_creases__setDrawOptions</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index)
<a name="l02582"></a>02582 {
<a name="l02583"></a>02583     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = userData;
<a name="l02584"></a>02584     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *eed = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a84b498997c52686a55d7ea755d1e6bc3">EDBM_edge_at_index</a>(userData, index);
<a name="l02585"></a>02585     <span class="keywordtype">float</span> *crease = eed ? (<span class="keywordtype">float</span> *)<a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a5004aa4bd19e25b6479f21ae3bf32cbc">edata</a>, eed-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#a0217baa3eaeea6474b67327a32044284">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a5fbc42074eae5d0f3af863e7d0d70d56">CD_CREASE</a>) : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02586"></a>02586     
<a name="l02587"></a>02587     <span class="keywordflow">if</span> (!crease)
<a name="l02588"></a>02588         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a618a0ba0086f3f3687726db84919260d">DM_DRAW_OPTION_SKIP</a>;
<a name="l02589"></a>02589     
<a name="l02590"></a>02590     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eed, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>) &amp;&amp; *crease != 0.0f) {
<a name="l02591"></a>02591         <a class="code" href="../../de/d96/UI__resources_8h.html#ad4ede272051fd08d70f30570ad85a852">UI_ThemeColorBlend</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>, <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531adb2d34cc57d1e3b13b367ea90c040deb">TH_EDGE_CREASE</a>, *crease);
<a name="l02592"></a>02592         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442acfb2e0978e1605561279f2b599cf4499">DM_DRAW_OPTION_NORMAL</a>;
<a name="l02593"></a>02593     }
<a name="l02594"></a>02594     <span class="keywordflow">else</span> {
<a name="l02595"></a>02595         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a618a0ba0086f3f3687726db84919260d">DM_DRAW_OPTION_SKIP</a>;
<a name="l02596"></a>02596     }
<a name="l02597"></a>02597 }
<a name="l02598"></a><a class="code" href="../../d3/d02/drawobject_8c.html#aac8102739b34b0fb3a132fcb2286fd5d">02598</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#aac8102739b34b0fb3a132fcb2286fd5d">draw_dm_creases</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm)
<a name="l02599"></a>02599 {
<a name="l02600"></a>02600     glLineWidth(3.0);
<a name="l02601"></a>02601     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a24108131d9cda75a80fb3361c81f3afa">drawMappedEdges</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#a33c43762e0ded96d959e0b76b3de5569">draw_dm_creases__setDrawOptions</a>, em);
<a name="l02602"></a>02602     glLineWidth(1.0);
<a name="l02603"></a>02603 }
<a name="l02604"></a>02604 
<a name="l02605"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a0c898551032cb3b216eaafaa17ea3823">02605</a> <span class="keyword">static</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442">DMDrawOption</a> <a class="code" href="../../d3/d02/drawobject_8c.html#a0c898551032cb3b216eaafaa17ea3823">draw_dm_bweights__setDrawOptions</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index)
<a name="l02606"></a>02606 {
<a name="l02607"></a>02607     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = userData;
<a name="l02608"></a>02608     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *eed = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a84b498997c52686a55d7ea755d1e6bc3">EDBM_edge_at_index</a>(userData, index);
<a name="l02609"></a>02609     <span class="keywordtype">float</span> *bweight = (<span class="keywordtype">float</span> *)<a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a5004aa4bd19e25b6479f21ae3bf32cbc">edata</a>, eed-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#a0217baa3eaeea6474b67327a32044284">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#adf25332f1a7a48ffa0b27ae822c07d53">CD_BWEIGHT</a>);
<a name="l02610"></a>02610 
<a name="l02611"></a>02611     <span class="keywordflow">if</span> (!bweight)
<a name="l02612"></a>02612         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a618a0ba0086f3f3687726db84919260d">DM_DRAW_OPTION_SKIP</a>;
<a name="l02613"></a>02613     
<a name="l02614"></a>02614     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eed, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>) &amp;&amp; *bweight != 0.0f) {
<a name="l02615"></a>02615         <a class="code" href="../../de/d96/UI__resources_8h.html#ad4ede272051fd08d70f30570ad85a852">UI_ThemeColorBlend</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>, <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a47518625993defaa4b41bf49ecbe2d61">TH_EDGE_SELECT</a>, *bweight);
<a name="l02616"></a>02616         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442acfb2e0978e1605561279f2b599cf4499">DM_DRAW_OPTION_NORMAL</a>;
<a name="l02617"></a>02617     }
<a name="l02618"></a>02618     <span class="keywordflow">else</span> {
<a name="l02619"></a>02619         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a618a0ba0086f3f3687726db84919260d">DM_DRAW_OPTION_SKIP</a>;
<a name="l02620"></a>02620     }
<a name="l02621"></a>02621 }
<a name="l02622"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ac266592f6ecb542e4cc3d50948d04a04">02622</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ac266592f6ecb542e4cc3d50948d04a04">draw_dm_bweights__mapFunc</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">float</span> co[3],
<a name="l02623"></a>02623                                       <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(no_f[3]), <span class="keyword">const</span> <span class="keywordtype">short</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(no_s[3]))
<a name="l02624"></a>02624 {
<a name="l02625"></a>02625     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = userData;
<a name="l02626"></a>02626     <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *eve = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a63e064e5e9c88cbdb131a3c55d1e6c26">EDBM_vert_at_index</a>(userData, index);
<a name="l02627"></a>02627     <span class="keywordtype">float</span> *bweight = (<span class="keywordtype">float</span> *)<a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a3d10124795ce1025cd86a29fb3c8819c">vdata</a>, eve-&gt;<a class="code" href="../../df/d18/structBMVert.html#ae60b9e519f421cdd79d5e3309853d7f5">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#adf25332f1a7a48ffa0b27ae822c07d53">CD_BWEIGHT</a>);
<a name="l02628"></a>02628     
<a name="l02629"></a>02629     <span class="keywordflow">if</span> (!bweight)
<a name="l02630"></a>02630         <span class="keywordflow">return</span>;
<a name="l02631"></a>02631     
<a name="l02632"></a>02632     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eve, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>) &amp;&amp; *bweight != 0.0f) {
<a name="l02633"></a>02633         <a class="code" href="../../de/d96/UI__resources_8h.html#ad4ede272051fd08d70f30570ad85a852">UI_ThemeColorBlend</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a6933328b6df4400c196ee99ddd608afd">TH_VERTEX</a>, <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a99466ebe41be745cf51950acc8423924">TH_VERTEX_SELECT</a>, *bweight);
<a name="l02634"></a>02634         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(co);
<a name="l02635"></a>02635     }
<a name="l02636"></a>02636 }
<a name="l02637"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a4c5cccb630f7cee7f29061c817af710e">02637</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a4c5cccb630f7cee7f29061c817af710e">draw_dm_bweights</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm)
<a name="l02638"></a>02638 {
<a name="l02639"></a>02639     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>;
<a name="l02640"></a>02640 
<a name="l02641"></a>02641     <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a85db400bd7203c7be03555b02e6c2709">selectmode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8de5fe0f8dbf523c4699a7b54c429e2f">SCE_SELECT_VERTEX</a>) {
<a name="l02642"></a>02642         glPointSize(<a class="code" href="../../de/d96/UI__resources_8h.html#ad9772e3578b739880ada62a6d21f4349">UI_GetThemeValuef</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a6c88c69347ab72b259eb7fcc8885327b">TH_VERTEX_SIZE</a>) + 2);
<a name="l02643"></a>02643         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#acbcc8c3223d7fc13a7931b0a1744b240">bglBegin</a>(GL_POINTS);
<a name="l02644"></a>02644         dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a14c8a2dc23a8af0e7aaf2190f7cf0202">foreachMappedVert</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#ac266592f6ecb542e4cc3d50948d04a04">draw_dm_bweights__mapFunc</a>, em);
<a name="l02645"></a>02645         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a2517dcaf453d3e58af25fd4c677dad45">bglEnd</a>();
<a name="l02646"></a>02646     }
<a name="l02647"></a>02647     <span class="keywordflow">else</span> {
<a name="l02648"></a>02648         glLineWidth(3.0);
<a name="l02649"></a>02649         dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a24108131d9cda75a80fb3361c81f3afa">drawMappedEdges</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#a0c898551032cb3b216eaafaa17ea3823">draw_dm_bweights__setDrawOptions</a>, em);
<a name="l02650"></a>02650         glLineWidth(1.0);
<a name="l02651"></a>02651     }
<a name="l02652"></a>02652 }
<a name="l02653"></a>02653 
<a name="l02654"></a>02654 <span class="comment">/* Second section of routines: Combine first sets to form fancy</span>
<a name="l02655"></a>02655 <span class="comment"> * drawing routines (for example rendering twice to get overlays).</span>
<a name="l02656"></a>02656 <span class="comment"> *</span>
<a name="l02657"></a>02657 <span class="comment"> * Also includes routines that are basic drawing but are too</span>
<a name="l02658"></a>02658 <span class="comment"> * specialized to be split out (like drawing creases or measurements).</span>
<a name="l02659"></a>02659 <span class="comment"> */</span>
<a name="l02660"></a>02660 
<a name="l02661"></a>02661 <span class="comment">/* EditMesh drawing routines*/</span>
<a name="l02662"></a>02662 
<a name="l02663"></a><a class="code" href="../../d3/d02/drawobject_8c.html#af241895df5462e3325e78e5fdbe4f40d">02663</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#af241895df5462e3325e78e5fdbe4f40d">draw_em_fancy_verts</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit, 
<a name="l02664"></a>02664                                 <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *cageDM, <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *eve_act)
<a name="l02665"></a>02665 {
<a name="l02666"></a>02666     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>;
<a name="l02667"></a>02667     <span class="keywordtype">int</span> sel;
<a name="l02668"></a>02668 
<a name="l02669"></a>02669     <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#afd443bfd0de5169661f08aa1eeb3bd69">zbuf</a>) glDepthMask(0);      <span class="comment">// disable write in zbuffer, zbuf select</span>
<a name="l02670"></a>02670 
<a name="l02671"></a>02671     <span class="keywordflow">for</span> (sel = 0; sel &lt; 2; sel++) {
<a name="l02672"></a>02672         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> col[4], fcol[4];
<a name="l02673"></a>02673         <span class="keywordtype">int</span> pass;
<a name="l02674"></a>02674 
<a name="l02675"></a>02675         <a class="code" href="../../de/d96/UI__resources_8h.html#a7df10cffdef8a2191960e1db949d3f47">UI_GetThemeColor3ubv</a>(sel ? <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a99466ebe41be745cf51950acc8423924">TH_VERTEX_SELECT</a> : <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a6933328b6df4400c196ee99ddd608afd">TH_VERTEX</a>, col);
<a name="l02676"></a>02676         <a class="code" href="../../de/d96/UI__resources_8h.html#a7df10cffdef8a2191960e1db949d3f47">UI_GetThemeColor3ubv</a>(sel ? <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531ac07623b2780480941f88e7ff07f2c51a">TH_FACE_DOT</a> : <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>, fcol);
<a name="l02677"></a>02677 
<a name="l02678"></a>02678         <span class="keywordflow">for</span> (pass = 0; pass &lt; 2; pass++) {
<a name="l02679"></a>02679             <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a> = <a class="code" href="../../de/d96/UI__resources_8h.html#ad9772e3578b739880ada62a6d21f4349">UI_GetThemeValuef</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a6c88c69347ab72b259eb7fcc8885327b">TH_VERTEX_SIZE</a>);
<a name="l02680"></a>02680             <span class="keywordtype">float</span> fsize = <a class="code" href="../../de/d96/UI__resources_8h.html#ad9772e3578b739880ada62a6d21f4349">UI_GetThemeValuef</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a3c33de8dbb8af6733e351aaee5c87068">TH_FACEDOT_SIZE</a>);
<a name="l02681"></a>02681 
<a name="l02682"></a>02682             <span class="keywordflow">if</span> (pass == 0) {
<a name="l02683"></a>02683                 <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#afd443bfd0de5169661f08aa1eeb3bd69">zbuf</a> &amp;&amp; !(v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a97a32d38ce1481d61d60dc677693ce5d">flag</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#ab80fcf8e0e16083a2ef8e7ca72cb6a39">V3D_ZBUF_SELECT</a>)) {
<a name="l02684"></a>02684                     glDisable(GL_DEPTH_TEST);
<a name="l02685"></a>02685 
<a name="l02686"></a>02686                     glEnable(GL_BLEND);
<a name="l02687"></a>02687                 }
<a name="l02688"></a>02688                 <span class="keywordflow">else</span> {
<a name="l02689"></a>02689                     <span class="keywordflow">continue</span>;
<a name="l02690"></a>02690                 }
<a name="l02691"></a>02691 
<a name="l02692"></a>02692                 size = (size &gt; 2.1f ? size / 2.0f : <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>);
<a name="l02693"></a>02693                 fsize = (fsize &gt; 2.1f ? fsize / 2.0f : fsize);
<a name="l02694"></a>02694                 col[3] = fcol[3] = 100;
<a name="l02695"></a>02695             }
<a name="l02696"></a>02696             <span class="keywordflow">else</span> {
<a name="l02697"></a>02697                 col[3] = fcol[3] = 255;
<a name="l02698"></a>02698             }
<a name="l02699"></a>02699 
<a name="l02700"></a>02700             <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a85db400bd7203c7be03555b02e6c2709">selectmode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8de5fe0f8dbf523c4699a7b54c429e2f">SCE_SELECT_VERTEX</a>) {
<a name="l02701"></a>02701                 glPointSize(size);
<a name="l02702"></a>02702                 glColor4ubv(col);
<a name="l02703"></a>02703                 <a class="code" href="../../d3/d02/drawobject_8c.html#af0a53825ebb52ed6755b678de2b28dfd">draw_dm_verts</a>(em, cageDM, sel, eve_act);
<a name="l02704"></a>02704             }
<a name="l02705"></a>02705             
<a name="l02706"></a>02706             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d02/drawobject_8c.html#a5a9568e44f52a75716cc935f20a02da3">check_ob_drawface_dot</a>(scene, v3d, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a849f37900ed7ea1f55647f7f4f8ed123">dt</a>)) {
<a name="l02707"></a>02707                 glPointSize(fsize);
<a name="l02708"></a>02708                 glColor4ubv(fcol);
<a name="l02709"></a>02709                 <a class="code" href="../../d3/d02/drawobject_8c.html#a1349fea9789cdbfd5f268bb50d36f431">draw_dm_face_centers</a>(em, cageDM, sel);
<a name="l02710"></a>02710             }
<a name="l02711"></a>02711             
<a name="l02712"></a>02712             <span class="keywordflow">if</span> (pass == 0) {
<a name="l02713"></a>02713                 glDisable(GL_BLEND);
<a name="l02714"></a>02714                 glEnable(GL_DEPTH_TEST);
<a name="l02715"></a>02715             }
<a name="l02716"></a>02716         }
<a name="l02717"></a>02717     }
<a name="l02718"></a>02718 
<a name="l02719"></a>02719     <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#afd443bfd0de5169661f08aa1eeb3bd69">zbuf</a>) glDepthMask(1);
<a name="l02720"></a>02720     glPointSize(1.0);
<a name="l02721"></a>02721 }
<a name="l02722"></a>02722 
<a name="l02723"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a12c536150d2832a60ae844b1a5a6d3ad">02723</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a12c536150d2832a60ae844b1a5a6d3ad">draw_em_fancy_edges</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d,
<a name="l02724"></a>02724                                 <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *cageDM, <span class="keywordtype">short</span> sel_only,
<a name="l02725"></a>02725                                 <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *eed_act)
<a name="l02726"></a>02726 {
<a name="l02727"></a>02727     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>;
<a name="l02728"></a>02728     <span class="keywordtype">int</span> pass;
<a name="l02729"></a>02729     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> wireCol[4], selCol[4], actCol[4];
<a name="l02730"></a>02730 
<a name="l02731"></a>02731     <span class="comment">/* since this function does transparant... */</span>
<a name="l02732"></a>02732     <a class="code" href="../../de/d96/UI__resources_8h.html#aeaa5bb9e6143ac7c02ac3f6db8a52339">UI_GetThemeColor4ubv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a47518625993defaa4b41bf49ecbe2d61">TH_EDGE_SELECT</a>, selCol);
<a name="l02733"></a>02733     <a class="code" href="../../de/d96/UI__resources_8h.html#aeaa5bb9e6143ac7c02ac3f6db8a52339">UI_GetThemeColor4ubv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>, wireCol);
<a name="l02734"></a>02734     <a class="code" href="../../de/d96/UI__resources_8h.html#aeaa5bb9e6143ac7c02ac3f6db8a52339">UI_GetThemeColor4ubv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531aacfd0ce5535550b8698a39caac9702ea">TH_EDITMESH_ACTIVE</a>, actCol);
<a name="l02735"></a>02735     
<a name="l02736"></a>02736     <span class="comment">/* when sel only is used, don&#39;t render wire, only selected, this is used for</span>
<a name="l02737"></a>02737 <span class="comment">     * textured draw mode when the &#39;edges&#39; option is disabled */</span>
<a name="l02738"></a>02738     <span class="keywordflow">if</span> (sel_only)
<a name="l02739"></a>02739         wireCol[3] = 0;
<a name="l02740"></a>02740 
<a name="l02741"></a>02741     <span class="keywordflow">for</span> (pass = 0; pass &lt; 2; pass++) {
<a name="l02742"></a>02742         <span class="comment">/* show wires in transparant when no zbuf clipping for select */</span>
<a name="l02743"></a>02743         <span class="keywordflow">if</span> (pass == 0) {
<a name="l02744"></a>02744             <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#afd443bfd0de5169661f08aa1eeb3bd69">zbuf</a> &amp;&amp; (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a97a32d38ce1481d61d60dc677693ce5d">flag</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#ab80fcf8e0e16083a2ef8e7ca72cb6a39">V3D_ZBUF_SELECT</a>) == 0) {
<a name="l02745"></a>02745                 glEnable(GL_BLEND);
<a name="l02746"></a>02746                 glDisable(GL_DEPTH_TEST);
<a name="l02747"></a>02747                 selCol[3] = 85;
<a name="l02748"></a>02748                 <span class="keywordflow">if</span> (!sel_only) wireCol[3] = 85;
<a name="l02749"></a>02749             }
<a name="l02750"></a>02750             <span class="keywordflow">else</span> {
<a name="l02751"></a>02751                 <span class="keywordflow">continue</span>;
<a name="l02752"></a>02752             }
<a name="l02753"></a>02753         }
<a name="l02754"></a>02754         <span class="keywordflow">else</span> {
<a name="l02755"></a>02755             selCol[3] = 255;
<a name="l02756"></a>02756             <span class="keywordflow">if</span> (!sel_only) wireCol[3] = 255;
<a name="l02757"></a>02757         }
<a name="l02758"></a>02758 
<a name="l02759"></a>02759         <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a85db400bd7203c7be03555b02e6c2709">selectmode</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a616adf2bfd4117c15663a28e464a5100">SCE_SELECT_FACE</a>) {
<a name="l02760"></a>02760             <a class="code" href="../../d3/d02/drawobject_8c.html#af6f97d4c8d201dc5a991bba715e5fadf">draw_dm_edges_sel</a>(em, cageDM, wireCol, selCol, actCol, eed_act);
<a name="l02761"></a>02761         }
<a name="l02762"></a>02762         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad595684991ea05e3a160d1b1f523158c">drawflag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a709689534fb2da54ef7af3a643e664e3">ME_DRAWEDGES</a>) || (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a85db400bd7203c7be03555b02e6c2709">selectmode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ad6cb358a5c5612c639f998b0601e0865">SCE_SELECT_EDGE</a>) ) {
<a name="l02763"></a>02763             <span class="keywordflow">if</span> (cageDM-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a71cd451780c320e827319248c9abbb6d">drawMappedEdgesInterp</a> &amp;&amp; (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a85db400bd7203c7be03555b02e6c2709">selectmode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8de5fe0f8dbf523c4699a7b54c429e2f">SCE_SELECT_VERTEX</a>)) {
<a name="l02764"></a>02764                 glShadeModel(GL_SMOOTH);
<a name="l02765"></a>02765                 <a class="code" href="../../d3/d02/drawobject_8c.html#aa9dea8aa86e7d5c589e4752f21be8ec8">draw_dm_edges_sel_interp</a>(em, cageDM, wireCol, selCol);
<a name="l02766"></a>02766                 glShadeModel(GL_FLAT);
<a name="l02767"></a>02767             }
<a name="l02768"></a>02768             <span class="keywordflow">else</span> {
<a name="l02769"></a>02769                 <a class="code" href="../../d3/d02/drawobject_8c.html#af6f97d4c8d201dc5a991bba715e5fadf">draw_dm_edges_sel</a>(em, cageDM, wireCol, selCol, actCol, eed_act);
<a name="l02770"></a>02770             }
<a name="l02771"></a>02771         }
<a name="l02772"></a>02772         <span class="keywordflow">else</span> {
<a name="l02773"></a>02773             <span class="keywordflow">if</span> (!sel_only) {
<a name="l02774"></a>02774                 glColor4ubv(wireCol);
<a name="l02775"></a>02775                 <a class="code" href="../../d3/d02/drawobject_8c.html#a22d0ccad53c2361e1615159f4df40a3f">draw_dm_edges</a>(em, cageDM);
<a name="l02776"></a>02776             }
<a name="l02777"></a>02777         }
<a name="l02778"></a>02778 
<a name="l02779"></a>02779         <span class="keywordflow">if</span> (pass == 0) {
<a name="l02780"></a>02780             glDisable(GL_BLEND);
<a name="l02781"></a>02781             glEnable(GL_DEPTH_TEST);
<a name="l02782"></a>02782         }
<a name="l02783"></a>02783     }
<a name="l02784"></a>02784 }   
<a name="l02785"></a>02785 
<a name="l02786"></a><a class="code" href="../../d3/d02/drawobject_8c.html#af720df56d9a781dcafeebd83edb0aa0b">02786</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#af720df56d9a781dcafeebd83edb0aa0b">draw_em_measure_stats</a>(<a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d8/da3/structUnitSettings.html">UnitSettings</a> *unit)
<a name="l02787"></a>02787 {
<a name="l02788"></a>02788     <span class="keyword">const</span> <span class="keywordtype">short</span> txt_flag = <a class="code" href="../../d4/df4/view3d__intern_8h.html#a19cf47d47eeef9d2339453c4833c7e77">V3D_CACHE_TEXT_ASCII</a> | <a class="code" href="../../d4/df4/view3d__intern_8h.html#ab4f4b536ee569fd39c3f392d530e6797">V3D_CACHE_TEXT_LOCALCLIP</a>;
<a name="l02789"></a>02789     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l02790"></a>02790     <span class="keywordtype">float</span> v1[3], v2[3], v3[3], vmid[3], fvec[3];
<a name="l02791"></a>02791     <span class="keywordtype">char</span> numstr[32]; <span class="comment">/* Stores the measurement display text here */</span>
<a name="l02792"></a>02792     <span class="keyword">const</span> <span class="keywordtype">char</span> *conv_float; <span class="comment">/* Use a float conversion matching the grid size */</span>
<a name="l02793"></a>02793     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> col[4] = {0, 0, 0, 255}; <span class="comment">/* color of the text to draw */</span>
<a name="l02794"></a>02794     <span class="keywordtype">float</span> area; <span class="comment">/* area of the face */</span>
<a name="l02795"></a>02795     <span class="keywordtype">float</span> grid = unit-&gt;<a class="code" href="../../d8/da3/structUnitSettings.html#a3ac319ff602239809e75b3939a014846">system</a> ? unit-&gt;<a class="code" href="../../d8/da3/structUnitSettings.html#a0c970043cd1006145890fee0041a5161">scale_length</a> : v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#aaee600b6bd2db36f2d2b53d433ffa4eb">grid</a>;
<a name="l02796"></a>02796     <span class="keyword">const</span> <span class="keywordtype">int</span> do_split = unit-&gt;<a class="code" href="../../d8/da3/structUnitSettings.html#a712401d436782196ec57ac7403e3acec">flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a20c7f8b1b0fa45b52b8fba9094c9cab8">USER_UNIT_OPT_SPLIT</a>;
<a name="l02797"></a>02797     <span class="keyword">const</span> <span class="keywordtype">int</span> do_global = v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a97a32d38ce1481d61d60dc677693ce5d">flag</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a24b68f7cfb4a4ffcb5b006ac471b16f7">V3D_GLOBAL_STATS</a>;
<a name="l02798"></a>02798     <span class="keyword">const</span> <span class="keywordtype">int</span> do_moving = <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.moving;
<a name="l02799"></a>02799 
<a name="l02800"></a>02800     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter;
<a name="l02801"></a>02801     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l02802"></a>02802 
<a name="l02803"></a>02803     <span class="comment">/* make the precision of the pronted value proportionate to the gridsize */</span>
<a name="l02804"></a>02804 
<a name="l02805"></a>02805     <span class="keywordflow">if</span> (grid &lt; 0.01f) conv_float = <span class="stringliteral">&quot;%.6g&quot;</span>;
<a name="l02806"></a>02806     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (grid &lt; 0.1f) conv_float = <span class="stringliteral">&quot;%.5g&quot;</span>;
<a name="l02807"></a>02807     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (grid &lt; 1.0f) conv_float = <span class="stringliteral">&quot;%.4g&quot;</span>;
<a name="l02808"></a>02808     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (grid &lt; 10.0f) conv_float = <span class="stringliteral">&quot;%.3g&quot;</span>;
<a name="l02809"></a>02809     <span class="keywordflow">else</span> conv_float = <span class="stringliteral">&quot;%.2g&quot;</span>;
<a name="l02810"></a>02810     
<a name="l02811"></a>02811     <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad595684991ea05e3a160d1b1f523158c">drawflag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#aeb85e9b1a8be0380f6b5d3cf6714f7f2">ME_DRAWEXTRA_EDGELEN</a>) {
<a name="l02812"></a>02812         <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *eed;
<a name="l02813"></a>02813 
<a name="l02814"></a>02814         <a class="code" href="../../de/d96/UI__resources_8h.html#a7df10cffdef8a2191960e1db949d3f47">UI_GetThemeColor3ubv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531ad60950e3cbfcf044ac58341dbfab1978">TH_DRAWEXTRA_EDGELEN</a>, col);
<a name="l02815"></a>02815 
<a name="l02816"></a>02816         eed = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#aba8c82365003c5fcbb34bbcb4e50f8f6" title="Iterator New.">BM_iter_new</a>(&amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa38e0ad1c62821fba188c45ddd39d6723">BM_EDGES_OF_MESH</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02817"></a>02817         <span class="keywordflow">for</span> (; eed; eed = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#a0fc839bb30650592541b47e20669a995" title="Iterator Step.">BM_iter_step</a>(&amp;iter)) {
<a name="l02818"></a>02818             <span class="comment">/* draw selected edges, or edges next to selected verts while draging */</span>
<a name="l02819"></a>02819             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eed, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>) ||
<a name="l02820"></a>02820                 (do_moving &amp;&amp; (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eed-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab6378c5ea7e85917c389a1dfdff790ea">v1</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>) ||
<a name="l02821"></a>02821                                <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eed-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#a00090f09abd0ef12bcf279cb0c41c0ca">v2</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>))))
<a name="l02822"></a>02822             {
<a name="l02823"></a>02823 
<a name="l02824"></a>02824                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(v1, eed-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab6378c5ea7e85917c389a1dfdff790ea">v1</a>-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>);
<a name="l02825"></a>02825                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(v2, eed-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#a00090f09abd0ef12bcf279cb0c41c0ca">v2</a>-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>);
<a name="l02826"></a>02826 
<a name="l02827"></a>02827                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ac3186a97188a3cf15bc5e2f8b0e97ad2">mid_v3_v3v3</a>(vmid, v1, v2);
<a name="l02828"></a>02828 
<a name="l02829"></a>02829                 <span class="keywordflow">if</span> (do_global) {
<a name="l02830"></a>02830                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad5cae73de10c30273f8c0fdc00fa648c">mul_mat3_m4_v3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, v1);
<a name="l02831"></a>02831                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad5cae73de10c30273f8c0fdc00fa648c">mul_mat3_m4_v3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, v2);
<a name="l02832"></a>02832                 }
<a name="l02833"></a>02833 
<a name="l02834"></a>02834                 <span class="keywordflow">if</span> (unit-&gt;<a class="code" href="../../d8/da3/structUnitSettings.html#a3ac319ff602239809e75b3939a014846">system</a>) {
<a name="l02835"></a>02835                     <a class="code" href="../../dd/d47/BKE__unit_8h.html#ab08be762576ac9db1443315105ccf396">bUnit_AsString</a>(numstr, <span class="keyword">sizeof</span>(numstr), <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a97ecadbef10e5cc3decc2c02c3b96824">len_v3v3</a>(v1, v2) * unit-&gt;<a class="code" href="../../d8/da3/structUnitSettings.html#a0c970043cd1006145890fee0041a5161">scale_length</a>, 3,
<a name="l02836"></a>02836                                    unit-&gt;<a class="code" href="../../d8/da3/structUnitSettings.html#a3ac319ff602239809e75b3939a014846">system</a>, <a class="code" href="../../dd/d47/BKE__unit_8h.html#a4779c1dd27e30d714b820dfc6adfb66b">B_UNIT_LENGTH</a>, do_split, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l02837"></a>02837                 }
<a name="l02838"></a>02838                 <span class="keywordflow">else</span> {
<a name="l02839"></a>02839                     sprintf(numstr, conv_float, <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a97ecadbef10e5cc3decc2c02c3b96824">len_v3v3</a>(v1, v2));
<a name="l02840"></a>02840                 }
<a name="l02841"></a>02841 
<a name="l02842"></a>02842                 <a class="code" href="../../d3/d02/drawobject_8c.html#a6de94308481c2e9de88b710de50dad2f">view3d_cached_text_draw_add</a>(vmid, numstr, 0, txt_flag, col);
<a name="l02843"></a>02843             }
<a name="l02844"></a>02844         }
<a name="l02845"></a>02845     }
<a name="l02846"></a>02846 
<a name="l02847"></a>02847     <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad595684991ea05e3a160d1b1f523158c">drawflag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a3f8e286ca60cd26c4a679d74e4fa84f5">ME_DRAWEXTRA_FACEAREA</a>) {
<a name="l02848"></a>02848         <span class="comment">/* would be nice to use BM_face_calc_area, but that is for 2d faces</span>
<a name="l02849"></a>02849 <span class="comment">         * so instead add up tessellation triangle areas */</span>
<a name="l02850"></a>02850         <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *f;
<a name="l02851"></a>02851         <span class="keywordtype">int</span> n;
<a name="l02852"></a>02852 
<a name="l02853"></a>02853 <span class="preprocessor">#define DRAW_EM_MEASURE_STATS_FACEAREA()                                      \</span>
<a name="l02854"></a>02854 <span class="preprocessor">    if (BM_elem_flag_test(f, BM_ELEM_SELECT)) {                               \</span>
<a name="l02855"></a>02855 <span class="preprocessor">        mul_v3_fl(vmid, 1.0 / n);                                             \</span>
<a name="l02856"></a>02856 <span class="preprocessor">        if (unit-&gt;system)                                                     \</span>
<a name="l02857"></a>02857 <span class="preprocessor">            bUnit_AsString(numstr, sizeof(numstr), area * unit-&gt;scale_length, \</span>
<a name="l02858"></a>02858 <span class="preprocessor">                           3, unit-&gt;system, B_UNIT_LENGTH, do_split, FALSE);  \</span>
<a name="l02859"></a>02859 <span class="preprocessor">        else                                                                  \</span>
<a name="l02860"></a>02860 <span class="preprocessor">            BLI_snprintf(numstr, sizeof(numstr), conv_float, area);           \</span>
<a name="l02861"></a>02861 <span class="preprocessor">        view3d_cached_text_draw_add(vmid, numstr, 0, txt_flag, col);          \</span>
<a name="l02862"></a>02862 <span class="preprocessor">    }</span>
<a name="l02863"></a>02863 <span class="preprocessor"></span>
<a name="l02864"></a>02864         <a class="code" href="../../de/d96/UI__resources_8h.html#a7df10cffdef8a2191960e1db949d3f47">UI_GetThemeColor3ubv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531ae5a801628fa1b0e7cd6e4a0d7861884d">TH_DRAWEXTRA_FACEAREA</a>, col);
<a name="l02865"></a>02865         
<a name="l02866"></a>02866         f = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02867"></a>02867         area = 0.0;
<a name="l02868"></a>02868         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#acd4d89007c860a4c74d459ac72593065">zero_v3</a>(vmid);
<a name="l02869"></a>02869         n = 0;
<a name="l02870"></a>02870         <span class="keywordflow">for</span> (i = 0; i &lt; em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#adb1bea95a064e41031e34a5a18b3be21">tottri</a>; i++) {
<a name="l02871"></a>02871             <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> **l = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a569c5a14f9e26ded573dd9a6b848da93">looptris</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02872"></a>02872             <span class="keywordflow">if</span> (f &amp;&amp; l[0]-&gt;f != f) {
<a name="l02873"></a>02873                 <a class="code" href="../../d3/d02/drawobject_8c.html#a595379218923f87ec2b5ae1c7afac6bb">DRAW_EM_MEASURE_STATS_FACEAREA</a>();
<a name="l02874"></a>02874                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#acd4d89007c860a4c74d459ac72593065">zero_v3</a>(vmid);
<a name="l02875"></a>02875                 area = 0.0;
<a name="l02876"></a>02876                 n = 0;
<a name="l02877"></a>02877             }
<a name="l02878"></a>02878 
<a name="l02879"></a>02879             f = l[0]-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a91ef300365e03d63842c7b694626bbb7">f</a>;
<a name="l02880"></a>02880             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(v1, l[0]-&gt;v-&gt;co);
<a name="l02881"></a>02881             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(v2, l[1]-&gt;v-&gt;co);
<a name="l02882"></a>02882             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(v3, l[2]-&gt;v-&gt;co);
<a name="l02883"></a>02883             <span class="keywordflow">if</span> (do_global) {
<a name="l02884"></a>02884                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad5cae73de10c30273f8c0fdc00fa648c">mul_mat3_m4_v3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, v1);
<a name="l02885"></a>02885                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad5cae73de10c30273f8c0fdc00fa648c">mul_mat3_m4_v3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, v2);
<a name="l02886"></a>02886                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad5cae73de10c30273f8c0fdc00fa648c">mul_mat3_m4_v3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, v3);
<a name="l02887"></a>02887             }
<a name="l02888"></a>02888             area += <a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#a7f7cdc9495876ea234a775a93dc7d4c5">area_tri_v3</a>(v1, v2, v3);
<a name="l02889"></a>02889             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(vmid, v1);
<a name="l02890"></a>02890             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(vmid, v2);
<a name="l02891"></a>02891             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(vmid, v3);
<a name="l02892"></a>02892             n += 3;
<a name="l02893"></a>02893         }
<a name="l02894"></a>02894 
<a name="l02895"></a>02895         <span class="keywordflow">if</span> (f) {
<a name="l02896"></a>02896             <a class="code" href="../../d3/d02/drawobject_8c.html#a595379218923f87ec2b5ae1c7afac6bb">DRAW_EM_MEASURE_STATS_FACEAREA</a>();
<a name="l02897"></a>02897         }
<a name="l02898"></a>02898 <span class="preprocessor">#undef DRAW_EM_MEASURE_STATS_FACEAREA</span>
<a name="l02899"></a>02899 <span class="preprocessor"></span>    }
<a name="l02900"></a>02900 
<a name="l02901"></a>02901     <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad595684991ea05e3a160d1b1f523158c">drawflag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a2f72abdaaae75bc4618553ce9dd75cb0">ME_DRAWEXTRA_FACEANG</a>) {
<a name="l02902"></a>02902         <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa;
<a name="l02903"></a>02903 
<a name="l02904"></a>02904         <a class="code" href="../../de/d96/UI__resources_8h.html#a7df10cffdef8a2191960e1db949d3f47">UI_GetThemeColor3ubv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a24e8be86563b324a58f62657897a6610">TH_DRAWEXTRA_FACEANG</a>, col);
<a name="l02905"></a>02905 
<a name="l02906"></a>02906 
<a name="l02907"></a>02907         <span class="keywordflow">for</span> (efa = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#aba8c82365003c5fcbb34bbcb4e50f8f6" title="Iterator New.">BM_iter_new</a>(&amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02908"></a>02908              efa; efa = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#a0fc839bb30650592541b47e20669a995" title="Iterator Step.">BM_iter_step</a>(&amp;iter))
<a name="l02909"></a>02909         {
<a name="l02910"></a>02910             <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> liter;
<a name="l02911"></a>02911             <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *loop;
<a name="l02912"></a>02912 
<a name="l02913"></a>02913             <a class="code" href="../../d5/d03/bmesh__polygon_8c.html#aef6498aa537f2788d4d319275a0c737e">BM_face_calc_center_bounds</a>(efa, vmid);
<a name="l02914"></a>02914 
<a name="l02915"></a>02915             <span class="keywordflow">for</span> (loop = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#aba8c82365003c5fcbb34bbcb4e50f8f6" title="Iterator New.">BM_iter_new</a>(&amp;liter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>, efa);
<a name="l02916"></a>02916                  loop; loop = <a class="code" href="../../d5/d48/bmesh__iterators__inline_8h.html#a0fc839bb30650592541b47e20669a995" title="Iterator Step.">BM_iter_step</a>(&amp;liter))
<a name="l02917"></a>02917             {
<a name="l02918"></a>02918                 <span class="keywordtype">float</span> v1[3], v2[3], v3[3];
<a name="l02919"></a>02919 
<a name="l02920"></a>02920                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(v1, loop-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a7566c73bc0e246e2b6db70c5e2284102">prev</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>);
<a name="l02921"></a>02921                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(v2, loop-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>);
<a name="l02922"></a>02922                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(v3, loop-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#af78d4a4546e654c1dcc6ebe6476ff0b0">next</a>-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>);
<a name="l02923"></a>02923 
<a name="l02924"></a>02924                 <span class="keywordflow">if</span> (do_global) {
<a name="l02925"></a>02925                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad5cae73de10c30273f8c0fdc00fa648c">mul_mat3_m4_v3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, v1);
<a name="l02926"></a>02926                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad5cae73de10c30273f8c0fdc00fa648c">mul_mat3_m4_v3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, v2);
<a name="l02927"></a>02927                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad5cae73de10c30273f8c0fdc00fa648c">mul_mat3_m4_v3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, v3);
<a name="l02928"></a>02928                 }
<a name="l02929"></a>02929 
<a name="l02930"></a>02930                 <span class="keywordflow">if</span> ( (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)) ||
<a name="l02931"></a>02931                      (do_moving &amp;&amp; <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(loop-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)))
<a name="l02932"></a>02932                 {
<a name="l02933"></a>02933                     <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(numstr, <span class="keyword">sizeof</span>(numstr), <span class="stringliteral">&quot;%.3g&quot;</span>, <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a95c550a7b3c9b2628d20aef44bc12b56">RAD2DEGF</a>(<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a39e943df2bf33bb95854bdc955644ac3">angle_v3v3v3</a>(v1, v2, v3)));
<a name="l02934"></a>02934                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1527309f09525ae91ed04692da13ba98">interp_v3_v3v3</a>(fvec, vmid, v2, 0.8f);
<a name="l02935"></a>02935                     <a class="code" href="../../d3/d02/drawobject_8c.html#a6de94308481c2e9de88b710de50dad2f">view3d_cached_text_draw_add</a>(fvec, numstr, 0, txt_flag, col);
<a name="l02936"></a>02936                 }
<a name="l02937"></a>02937             }
<a name="l02938"></a>02938         }
<a name="l02939"></a>02939     }
<a name="l02940"></a>02940 }
<a name="l02941"></a>02941 
<a name="l02942"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ac33b6d14a4802e137725276e4b12e5d7">02942</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ac33b6d14a4802e137725276e4b12e5d7">draw_em_indices</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em)
<a name="l02943"></a>02943 {
<a name="l02944"></a>02944     <span class="keyword">const</span> <span class="keywordtype">short</span> txt_flag = <a class="code" href="../../d4/df4/view3d__intern_8h.html#a19cf47d47eeef9d2339453c4833c7e77">V3D_CACHE_TEXT_ASCII</a> | <a class="code" href="../../d4/df4/view3d__intern_8h.html#ab4f4b536ee569fd39c3f392d530e6797">V3D_CACHE_TEXT_LOCALCLIP</a>;
<a name="l02945"></a>02945     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *e;
<a name="l02946"></a>02946     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *f;
<a name="l02947"></a>02947     <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *v;
<a name="l02948"></a>02948     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l02949"></a>02949     <span class="keywordtype">char</span> numstr[32];
<a name="l02950"></a>02950     <span class="keywordtype">float</span> pos[3];
<a name="l02951"></a>02951     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> col[4];
<a name="l02952"></a>02952 
<a name="l02953"></a>02953     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter;
<a name="l02954"></a>02954     <a class="code" href="../../d7/d18/structBMesh.html">BMesh</a> *bm = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>;
<a name="l02955"></a>02955 
<a name="l02956"></a>02956     <span class="comment">/* For now, reuse appropriate theme colors from stats text colors */</span>
<a name="l02957"></a>02957     i = 0;
<a name="l02958"></a>02958     <span class="keywordflow">if</span> (em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a4ead55e843584fbde374a460c7d0cba8">selectmode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8de5fe0f8dbf523c4699a7b54c429e2f">SCE_SELECT_VERTEX</a>) {
<a name="l02959"></a>02959         <a class="code" href="../../de/d96/UI__resources_8h.html#a7df10cffdef8a2191960e1db949d3f47">UI_GetThemeColor3ubv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a24e8be86563b324a58f62657897a6610">TH_DRAWEXTRA_FACEANG</a>, col);
<a name="l02960"></a>02960         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (v, &amp;iter, bm, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa40e4413e8bcf7618b57cbbbc6b56382b">BM_VERTS_OF_MESH</a>) {
<a name="l02961"></a>02961             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(v, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)) {
<a name="l02962"></a>02962                 sprintf(numstr, <span class="stringliteral">&quot;%d&quot;</span>, i);
<a name="l02963"></a>02963                 <a class="code" href="../../d3/d02/drawobject_8c.html#a6de94308481c2e9de88b710de50dad2f">view3d_cached_text_draw_add</a>(v-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>, numstr, 0, txt_flag, col);
<a name="l02964"></a>02964             }
<a name="l02965"></a>02965             i++;
<a name="l02966"></a>02966         }
<a name="l02967"></a>02967     }
<a name="l02968"></a>02968 
<a name="l02969"></a>02969     <span class="keywordflow">if</span> (em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a4ead55e843584fbde374a460c7d0cba8">selectmode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ad6cb358a5c5612c639f998b0601e0865">SCE_SELECT_EDGE</a>) {
<a name="l02970"></a>02970         i = 0;
<a name="l02971"></a>02971         <a class="code" href="../../de/d96/UI__resources_8h.html#a7df10cffdef8a2191960e1db949d3f47">UI_GetThemeColor3ubv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531ad60950e3cbfcf044ac58341dbfab1978">TH_DRAWEXTRA_EDGELEN</a>, col);
<a name="l02972"></a>02972         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (e, &amp;iter, bm, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa38e0ad1c62821fba188c45ddd39d6723">BM_EDGES_OF_MESH</a>) {
<a name="l02973"></a>02973             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(e, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)) {
<a name="l02974"></a>02974                 sprintf(numstr, <span class="stringliteral">&quot;%d&quot;</span>, i);
<a name="l02975"></a>02975                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ac3186a97188a3cf15bc5e2f8b0e97ad2">mid_v3_v3v3</a>(pos, e-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab6378c5ea7e85917c389a1dfdff790ea">v1</a>-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>, e-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#a00090f09abd0ef12bcf279cb0c41c0ca">v2</a>-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>);
<a name="l02976"></a>02976                 <a class="code" href="../../d3/d02/drawobject_8c.html#a6de94308481c2e9de88b710de50dad2f">view3d_cached_text_draw_add</a>(pos, numstr, 0, txt_flag, col);
<a name="l02977"></a>02977             }
<a name="l02978"></a>02978             i++;
<a name="l02979"></a>02979         }
<a name="l02980"></a>02980     }
<a name="l02981"></a>02981 
<a name="l02982"></a>02982     <span class="keywordflow">if</span> (em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a4ead55e843584fbde374a460c7d0cba8">selectmode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a616adf2bfd4117c15663a28e464a5100">SCE_SELECT_FACE</a>) {
<a name="l02983"></a>02983         i = 0;
<a name="l02984"></a>02984         <a class="code" href="../../de/d96/UI__resources_8h.html#a7df10cffdef8a2191960e1db949d3f47">UI_GetThemeColor3ubv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531ae5a801628fa1b0e7cd6e4a0d7861884d">TH_DRAWEXTRA_FACEAREA</a>, col);
<a name="l02985"></a>02985         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (f, &amp;iter, bm, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l02986"></a>02986             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(f, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)) {
<a name="l02987"></a>02987                 <a class="code" href="../../d5/d03/bmesh__polygon_8c.html#a644b6a1f6913583185e8674ae7572405">BM_face_calc_center_mean</a>(f, pos);
<a name="l02988"></a>02988                 sprintf(numstr, <span class="stringliteral">&quot;%d&quot;</span>, i);
<a name="l02989"></a>02989                 <a class="code" href="../../d3/d02/drawobject_8c.html#a6de94308481c2e9de88b710de50dad2f">view3d_cached_text_draw_add</a>(pos, numstr, 0, txt_flag, col);
<a name="l02990"></a>02990             }
<a name="l02991"></a>02991             i++;
<a name="l02992"></a>02992         }
<a name="l02993"></a>02993     }
<a name="l02994"></a>02994 }
<a name="l02995"></a>02995 
<a name="l02996"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a82d05e0ccc7104f8c65b8bc0afea70e9">02996</a> <span class="keyword">static</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442">DMDrawOption</a> <a class="code" href="../../d3/d02/drawobject_8c.html#a82d05e0ccc7104f8c65b8bc0afea70e9">draw_em_fancy__setFaceOpts</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index)
<a name="l02997"></a>02997 {
<a name="l02998"></a>02998     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a79834f648f43a4b01046a46de38fbcec">EDBM_face_at_index</a>(userData, index);
<a name="l02999"></a>02999 
<a name="l03000"></a>03000     <span class="keywordflow">if</span> (efa &amp;&amp; !<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>)) {
<a name="l03001"></a>03001         <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>(efa-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a11d30c8a528fb993a7c111a8e957de5a">mat_nr</a> + 1, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03002"></a>03002         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442acfb2e0978e1605561279f2b599cf4499">DM_DRAW_OPTION_NORMAL</a>;
<a name="l03003"></a>03003     }
<a name="l03004"></a>03004     <span class="keywordflow">else</span>
<a name="l03005"></a>03005         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a618a0ba0086f3f3687726db84919260d">DM_DRAW_OPTION_SKIP</a>;
<a name="l03006"></a>03006 }
<a name="l03007"></a>03007 
<a name="l03008"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a42a9d7989677600087c2b2a47bb1b8c6">03008</a> <span class="keyword">static</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442">DMDrawOption</a> <a class="code" href="../../d3/d02/drawobject_8c.html#a42a9d7989677600087c2b2a47bb1b8c6">draw_em_fancy__setGLSLFaceOpts</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index)
<a name="l03009"></a>03009 {
<a name="l03010"></a>03010     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a79834f648f43a4b01046a46de38fbcec">EDBM_face_at_index</a>(userData, index);
<a name="l03011"></a>03011 
<a name="l03012"></a>03012     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>))
<a name="l03013"></a>03013         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a618a0ba0086f3f3687726db84919260d">DM_DRAW_OPTION_SKIP</a>;
<a name="l03014"></a>03014     <span class="keywordflow">else</span>
<a name="l03015"></a>03015         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442acfb2e0978e1605561279f2b599cf4499">DM_DRAW_OPTION_NORMAL</a>;
<a name="l03016"></a>03016 }
<a name="l03017"></a>03017 
<a name="l03018"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a64812ebf17fdf9e0794b39b89a1b6e64">03018</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a64812ebf17fdf9e0794b39b89a1b6e64">draw_em_fancy</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d,
<a name="l03019"></a>03019                           <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *cageDM, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *finalDM, <span class="keywordtype">int</span> dt)
<a name="l03020"></a>03020 
<a name="l03021"></a>03021 {
<a name="l03022"></a>03022     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l03023"></a>03023     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa_act = <a class="code" href="../../d5/def/bmesh__marking_8c.html#a6e02febedf269e86d8f9cb8efedd9500">BM_active_face_get</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>); <span class="comment">/* annoying but active faces is stored differently */</span>
<a name="l03024"></a>03024     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *eed_act = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03025"></a>03025     <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *eve_act = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03026"></a>03026     
<a name="l03027"></a>03027     <span class="keywordflow">if</span> (em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a4fed1ad7bcc6ca3497864569912a131e">selected</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>) {
<a name="l03028"></a>03028         <a class="code" href="../../da/dc8/structBMEditSelection.html">BMEditSelection</a> *ese = em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a4fed1ad7bcc6ca3497864569912a131e">selected</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>;
<a name="l03029"></a>03029         <span class="comment">/* face is handeled above */</span>
<a name="l03030"></a>03030 <span class="preprocessor">#if 0</span>
<a name="l03031"></a>03031 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (ese-&gt;type == <a class="code" href="../../d1/d77/bmesh__class_8h.html#a77867ab4129f63159b37bca3b652a798a279a53b6bc9b4dd104fa2607f8439075">BM_FACE</a>) {
<a name="l03032"></a>03032             efa_act = (<a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *)ese-&gt;data;
<a name="l03033"></a>03033         }
<a name="l03034"></a>03034         <span class="keywordflow">else</span> 
<a name="l03035"></a>03035 <span class="preprocessor">#endif</span>
<a name="l03036"></a>03036 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (ese-&gt;<a class="code" href="../../da/dc8/structBMEditSelection.html#aa56cdbb8125a847ea3c6327a9e82997c">htype</a> == <a class="code" href="../../d1/d77/bmesh__class_8h.html#a77867ab4129f63159b37bca3b652a798a9c98dbf43c8b979e7c2b4224eaf18c94">BM_EDGE</a>) {
<a name="l03037"></a>03037             eed_act = (<a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *)ese-&gt;<a class="code" href="../../da/dc8/structBMEditSelection.html#ae86356a64630dfee041388916476f782">ele</a>;
<a name="l03038"></a>03038         }
<a name="l03039"></a>03039         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ese-&gt;<a class="code" href="../../da/dc8/structBMEditSelection.html#aa56cdbb8125a847ea3c6327a9e82997c">htype</a> == <a class="code" href="../../d1/d77/bmesh__class_8h.html#a77867ab4129f63159b37bca3b652a798a69729bc1555e82d32291f917fcb7350c">BM_VERT</a>) {
<a name="l03040"></a>03040             eve_act = (<a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *)ese-&gt;<a class="code" href="../../da/dc8/structBMEditSelection.html#ae86356a64630dfee041388916476f782">ele</a>;
<a name="l03041"></a>03041         }
<a name="l03042"></a>03042     }
<a name="l03043"></a>03043     
<a name="l03044"></a>03044     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#aa97a3443500c36b7a92a1e2970370561">EDBM_index_arrays_init</a>(em, 1, 1, 1);
<a name="l03045"></a>03045 
<a name="l03046"></a>03046     <span class="keywordflow">if</span> (dt &gt; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>) {
<a name="l03047"></a>03047         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d02/drawobject_8c.html#a85a9a40d95e42913b5e214675483ca80">check_object_draw_texture</a>(scene, v3d, dt)) {
<a name="l03048"></a>03048             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d02/drawobject_8c.html#aca409cda616fd2a1eb6eb2dc5b124fac">draw_glsl_material</a>(scene, ob, v3d, dt)) {
<a name="l03049"></a>03049                 glFrontFace((ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1091cd84d4d7227ab41b167e84be3065">transflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a87014edc673c17c72d0cf437921da147">OB_NEG_SCALE</a>) ? GL_CW : GL_CCW);
<a name="l03050"></a>03050 
<a name="l03051"></a>03051                 finalDM-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a428ce2f394630252dcef8ed1c0485ae9">drawMappedFacesGLSL</a>(finalDM, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>,
<a name="l03052"></a>03052                                              <a class="code" href="../../d3/d02/drawobject_8c.html#a42a9d7989677600087c2b2a47bb1b8c6">draw_em_fancy__setGLSLFaceOpts</a>, em);
<a name="l03053"></a>03053                 <a class="code" href="../../d3/df0/GPU__draw_8h.html#a93e3b15a1a08a173c699b15068c35c35">GPU_disable_material</a>();
<a name="l03054"></a>03054 
<a name="l03055"></a>03055                 glFrontFace(GL_CCW);
<a name="l03056"></a>03056             }
<a name="l03057"></a>03057             <span class="keywordflow">else</span> {
<a name="l03058"></a>03058                 <a class="code" href="../../d8/d5e/drawmesh_8c.html#af04cd37a0540fc9fc810493f74083e92">draw_mesh_textured</a>(scene, v3d, rv3d, ob, finalDM, 0);
<a name="l03059"></a>03059             }
<a name="l03060"></a>03060         }
<a name="l03061"></a>03061         <span class="keywordflow">else</span> {
<a name="l03062"></a>03062             <span class="comment">/* 3 floats for position,</span>
<a name="l03063"></a>03063 <span class="comment">             * 3 for normal and times two because the faces may actually be quads instead of triangles */</span>
<a name="l03064"></a>03064             glLightModeli(GL_LIGHT_MODEL_TWO_SIDE, (me-&gt;<a class="code" href="../../da/d29/structMesh.html#a941cdd9a07c81485677efb6b444eb8ad">flag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a600ca431e8bfb463049665e0d172cf4e">ME_TWOSIDED</a>) ? GL_TRUE : GL_FALSE);
<a name="l03065"></a>03065 
<a name="l03066"></a>03066             glEnable(GL_LIGHTING);
<a name="l03067"></a>03067             glFrontFace((ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1091cd84d4d7227ab41b167e84be3065">transflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a87014edc673c17c72d0cf437921da147">OB_NEG_SCALE</a>) ? GL_CW : GL_CCW);
<a name="l03068"></a>03068             finalDM-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a68c34c18414350c39f74969f2cf3f276">drawMappedFaces</a>(finalDM, <a class="code" href="../../d3/d02/drawobject_8c.html#a82d05e0ccc7104f8c65b8bc0afea70e9">draw_em_fancy__setFaceOpts</a>, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>, 0);
<a name="l03069"></a>03069 
<a name="l03070"></a>03070             glFrontFace(GL_CCW);
<a name="l03071"></a>03071             glDisable(GL_LIGHTING);
<a name="l03072"></a>03072             glLightModeli(GL_LIGHT_MODEL_TWO_SIDE, GL_FALSE);
<a name="l03073"></a>03073         }
<a name="l03074"></a>03074 
<a name="l03075"></a>03075         <span class="comment">// Setup for drawing wire over, disable zbuffer</span>
<a name="l03076"></a>03076         <span class="comment">// write to show selected edge wires better</span>
<a name="l03077"></a>03077         <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l03078"></a>03078 
<a name="l03079"></a>03079         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a34edada4ce250a4abb76f2011ac70a76">bglPolygonOffset</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a5a4f191256ccc5c28828b922636ca588">dist</a>, 1.0);
<a name="l03080"></a>03080         glDepthMask(0);
<a name="l03081"></a>03081     }
<a name="l03082"></a>03082     <span class="keywordflow">else</span> {
<a name="l03083"></a>03083         <span class="keywordflow">if</span> (cageDM != finalDM) {
<a name="l03084"></a>03084             <a class="code" href="../../de/d96/UI__resources_8h.html#ad4ede272051fd08d70f30570ad85a852">UI_ThemeColorBlend</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>, <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a2f524dc89597307994ab7d91402f79cf">TH_BACK</a>, 0.7);
<a name="l03085"></a>03085             finalDM-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a05d1c2b6c7c1eff4fdf4fdb973bbba5c">drawEdges</a>(finalDM, 1, 0);
<a name="l03086"></a>03086         }
<a name="l03087"></a>03087     }
<a name="l03088"></a>03088     
<a name="l03089"></a>03089     <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad595684991ea05e3a160d1b1f523158c">drawflag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#ad2e35ed3d2158ed9ffed13dcdc9cfbba">ME_DRAWFACES</a>) {  <span class="comment">/* transp faces */</span>
<a name="l03090"></a>03090         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> col1[4], col2[4], col3[4];
<a name="l03091"></a>03091 
<a name="l03092"></a>03092         <a class="code" href="../../de/d96/UI__resources_8h.html#aeaa5bb9e6143ac7c02ac3f6db8a52339">UI_GetThemeColor4ubv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531af8120f2d041a86481d4532e7807e4362">TH_FACE</a>, col1);
<a name="l03093"></a>03093         <a class="code" href="../../de/d96/UI__resources_8h.html#aeaa5bb9e6143ac7c02ac3f6db8a52339">UI_GetThemeColor4ubv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a870205cdc22687a63a45c24b6637f366">TH_FACE_SELECT</a>, col2);
<a name="l03094"></a>03094         <a class="code" href="../../de/d96/UI__resources_8h.html#aeaa5bb9e6143ac7c02ac3f6db8a52339">UI_GetThemeColor4ubv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531aacfd0ce5535550b8698a39caac9702ea">TH_EDITMESH_ACTIVE</a>, col3);
<a name="l03095"></a>03095         
<a name="l03096"></a>03096         glEnable(GL_BLEND);
<a name="l03097"></a>03097         glDepthMask(0);     <span class="comment">// disable write in zbuffer, needed for nice transp</span>
<a name="l03098"></a>03098         
<a name="l03099"></a>03099         <span class="comment">/* don&#39;t draw unselected faces, only selected, this is MUCH nicer when texturing */</span>
<a name="l03100"></a>03100         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d02/drawobject_8c.html#a85a9a40d95e42913b5e214675483ca80">check_object_draw_texture</a>(scene, v3d, dt))
<a name="l03101"></a>03101             col1[3] = 0;
<a name="l03102"></a>03102         
<a name="l03103"></a>03103         <a class="code" href="../../d3/d02/drawobject_8c.html#a5ba94c28d5694f77878342947e161350">draw_dm_faces_sel</a>(em, cageDM, col1, col2, col3, efa_act);
<a name="l03104"></a>03104 
<a name="l03105"></a>03105         glDisable(GL_BLEND);
<a name="l03106"></a>03106         glDepthMask(1);     <span class="comment">// restore write in zbuffer</span>
<a name="l03107"></a>03107     }
<a name="l03108"></a>03108     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (efa_act) {
<a name="l03109"></a>03109         <span class="comment">/* even if draw faces is off it would be nice to draw the stipple face</span>
<a name="l03110"></a>03110 <span class="comment">         * Make all other faces zero alpha except for the active</span>
<a name="l03111"></a>03111 <span class="comment">         * */</span>
<a name="l03112"></a>03112         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> col1[4], col2[4], col3[4];
<a name="l03113"></a>03113         col1[3] = col2[3] = 0; <span class="comment">/* don&#39;t draw */</span>
<a name="l03114"></a>03114         <a class="code" href="../../de/d96/UI__resources_8h.html#aeaa5bb9e6143ac7c02ac3f6db8a52339">UI_GetThemeColor4ubv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531aacfd0ce5535550b8698a39caac9702ea">TH_EDITMESH_ACTIVE</a>, col3);
<a name="l03115"></a>03115         
<a name="l03116"></a>03116         glEnable(GL_BLEND);
<a name="l03117"></a>03117         glDepthMask(0);     <span class="comment">// disable write in zbuffer, needed for nice transp</span>
<a name="l03118"></a>03118         
<a name="l03119"></a>03119         <a class="code" href="../../d3/d02/drawobject_8c.html#a5ba94c28d5694f77878342947e161350">draw_dm_faces_sel</a>(em, cageDM, col1, col2, col3, efa_act);
<a name="l03120"></a>03120 
<a name="l03121"></a>03121         glDisable(GL_BLEND);
<a name="l03122"></a>03122         glDepthMask(1);     <span class="comment">// restore write in zbuffer</span>
<a name="l03123"></a>03123         
<a name="l03124"></a>03124     }
<a name="l03125"></a>03125 
<a name="l03126"></a>03126     <span class="comment">/* here starts all fancy draw-extra over */</span>
<a name="l03127"></a>03127     <span class="keywordflow">if</span> ((me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad595684991ea05e3a160d1b1f523158c">drawflag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a709689534fb2da54ef7af3a643e664e3">ME_DRAWEDGES</a>) == 0 &amp;&amp; <a class="code" href="../../d3/d02/drawobject_8c.html#a85a9a40d95e42913b5e214675483ca80">check_object_draw_texture</a>(scene, v3d, dt)) {
<a name="l03128"></a>03128         <span class="comment">/* we are drawing textures and &#39;ME_DRAWEDGES&#39; is disabled, don&#39;t draw any edges */</span>
<a name="l03129"></a>03129         
<a name="l03130"></a>03130         <span class="comment">/* only draw selected edges otherwise there is no way of telling if a face is selected */</span>
<a name="l03131"></a>03131         <a class="code" href="../../d3/d02/drawobject_8c.html#a12c536150d2832a60ae844b1a5a6d3ad">draw_em_fancy_edges</a>(em, scene, v3d, me, cageDM, 1, eed_act);
<a name="l03132"></a>03132         
<a name="l03133"></a>03133     }
<a name="l03134"></a>03134     <span class="keywordflow">else</span> {
<a name="l03135"></a>03135         <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad595684991ea05e3a160d1b1f523158c">drawflag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#adacf5e88838f2b4f436a14bf1fb3802c">ME_DRAWSEAMS</a>) {
<a name="l03136"></a>03136             <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a8e729904f42293f8f207654383765cb4">TH_EDGE_SEAM</a>);
<a name="l03137"></a>03137             glLineWidth(2);
<a name="l03138"></a>03138 
<a name="l03139"></a>03139             <a class="code" href="../../d3/d02/drawobject_8c.html#acfca879fe7357f922e62496e8f9a4905">draw_dm_edges_seams</a>(em, cageDM);
<a name="l03140"></a>03140 
<a name="l03141"></a>03141             glColor3ub(0, 0, 0);
<a name="l03142"></a>03142             glLineWidth(1);
<a name="l03143"></a>03143         }
<a name="l03144"></a>03144         
<a name="l03145"></a>03145         <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad595684991ea05e3a160d1b1f523158c">drawflag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a01ec7b5aae5c0f983d57da052c2d4a60">ME_DRAWSHARP</a>) {
<a name="l03146"></a>03146             <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a005df1013d34d834e8be7df63456464c">TH_EDGE_SHARP</a>);
<a name="l03147"></a>03147             glLineWidth(2);
<a name="l03148"></a>03148 
<a name="l03149"></a>03149             <a class="code" href="../../d3/d02/drawobject_8c.html#abcd4c35b3d8b4d1d4f7b8dd8f0d2866c">draw_dm_edges_sharp</a>(em, cageDM);
<a name="l03150"></a>03150 
<a name="l03151"></a>03151             glColor3ub(0, 0, 0);
<a name="l03152"></a>03152             glLineWidth(1);
<a name="l03153"></a>03153         }
<a name="l03154"></a>03154 
<a name="l03155"></a>03155         <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad595684991ea05e3a160d1b1f523158c">drawflag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a4adb0704ed596d70aff2290e1894a237">ME_DRAWCREASES</a> &amp;&amp; <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a6474531880fa81739ccdb10fdffd1866">CustomData_has_layer</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a5004aa4bd19e25b6479f21ae3bf32cbc">edata</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a5fbc42074eae5d0f3af863e7d0d70d56">CD_CREASE</a>)) {
<a name="l03156"></a>03156             <a class="code" href="../../d3/d02/drawobject_8c.html#aac8102739b34b0fb3a132fcb2286fd5d">draw_dm_creases</a>(em, cageDM);
<a name="l03157"></a>03157         }
<a name="l03158"></a>03158         <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad595684991ea05e3a160d1b1f523158c">drawflag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a4b900c20f041fb7bbfd47dd410b623d1">ME_DRAWBWEIGHTS</a>) {
<a name="l03159"></a>03159             <a class="code" href="../../d3/d02/drawobject_8c.html#a4c5cccb630f7cee7f29061c817af710e">draw_dm_bweights</a>(em, scene, cageDM);
<a name="l03160"></a>03160         }
<a name="l03161"></a>03161 
<a name="l03162"></a>03162         <a class="code" href="../../d3/d02/drawobject_8c.html#a12c536150d2832a60ae844b1a5a6d3ad">draw_em_fancy_edges</a>(em, scene, v3d, me, cageDM, 0, eed_act);
<a name="l03163"></a>03163     }
<a name="l03164"></a>03164     <span class="keywordflow">if</span> (em) {
<a name="l03165"></a>03165         <a class="code" href="../../d3/d02/drawobject_8c.html#af241895df5462e3325e78e5fdbe4f40d">draw_em_fancy_verts</a>(scene, v3d, ob, em, cageDM, eve_act);
<a name="l03166"></a>03166 
<a name="l03167"></a>03167         <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad595684991ea05e3a160d1b1f523158c">drawflag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a1bb840f104e3dc6854dc293e59cf593e">ME_DRAWNORMALS</a>) {
<a name="l03168"></a>03168             <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a0a01b3660c9caf2052b5693f7c6e845d">TH_NORMAL</a>);
<a name="l03169"></a>03169             <a class="code" href="../../d3/d02/drawobject_8c.html#abd76371c3296d1a93ea28c74f1d60821">draw_dm_face_normals</a>(em, scene, cageDM);
<a name="l03170"></a>03170         }
<a name="l03171"></a>03171         <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad595684991ea05e3a160d1b1f523158c">drawflag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a0e40322a8efe64428d7d03512d8f2740">ME_DRAW_VNORMALS</a>) {
<a name="l03172"></a>03172             <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531af940582eaa02c3ff2a25bf231d15a239">TH_VNORMAL</a>);
<a name="l03173"></a>03173             <a class="code" href="../../d3/d02/drawobject_8c.html#a8b3576444f9a30ddf2164d6e77ef6d36">draw_dm_vert_normals</a>(em, scene, cageDM);
<a name="l03174"></a>03174         }
<a name="l03175"></a>03175 
<a name="l03176"></a>03176         <span class="keywordflow">if</span> ( (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad595684991ea05e3a160d1b1f523158c">drawflag</a> &amp; (<a class="code" href="../../df/d96/DNA__mesh__types_8h.html#aeb85e9b1a8be0380f6b5d3cf6714f7f2">ME_DRAWEXTRA_EDGELEN</a> | <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a3f8e286ca60cd26c4a679d74e4fa84f5">ME_DRAWEXTRA_FACEAREA</a> | <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a2f72abdaaae75bc4618553ce9dd75cb0">ME_DRAWEXTRA_FACEANG</a>)) &amp;&amp;
<a name="l03177"></a>03177              !(v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>))
<a name="l03178"></a>03178         {
<a name="l03179"></a>03179             <a class="code" href="../../d3/d02/drawobject_8c.html#af720df56d9a781dcafeebd83edb0aa0b">draw_em_measure_stats</a>(v3d, ob, em, &amp;scene-&gt;<a class="code" href="../../d9/d27/structScene.html#abe370ff027b47b00fb8a81620639eff4">unit</a>);
<a name="l03180"></a>03180         }
<a name="l03181"></a>03181 
<a name="l03182"></a>03182         <span class="keywordflow">if</span> ((<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635a1207ca157c84a6be5a8a36c691c4aa72">G_DEBUG</a>) &amp;&amp; (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad595684991ea05e3a160d1b1f523158c">drawflag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a428ec15b2775a0beb945a5e3d2856861">ME_DRAWEXTRA_INDICES</a>) &amp;&amp;
<a name="l03183"></a>03183             !(v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>)) {
<a name="l03184"></a>03184             <a class="code" href="../../d3/d02/drawobject_8c.html#ac33b6d14a4802e137725276e4b12e5d7">draw_em_indices</a>(em);
<a name="l03185"></a>03185         }
<a name="l03186"></a>03186     }
<a name="l03187"></a>03187 
<a name="l03188"></a>03188     <span class="keywordflow">if</span> (dt &gt; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>) {
<a name="l03189"></a>03189         glDepthMask(1);
<a name="l03190"></a>03190         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a34edada4ce250a4abb76f2011ac70a76">bglPolygonOffset</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a5a4f191256ccc5c28828b922636ca588">dist</a>, 0.0);
<a name="l03191"></a>03191         <a class="code" href="../../d3/df0/GPU__draw_8h.html#a93e3b15a1a08a173c699b15068c35c35">GPU_disable_material</a>();
<a name="l03192"></a>03192     }
<a name="l03193"></a>03193 
<a name="l03194"></a>03194     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ade6a9b6920d5141b0102b60995a5b91f">EDBM_index_arrays_free</a>(em);
<a name="l03195"></a>03195 }
<a name="l03196"></a>03196 
<a name="l03197"></a>03197 <span class="comment">/* Mesh drawing routines */</span>
<a name="l03198"></a>03198 
<a name="l03199"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a0ce5944dca582d34c478ae482f47801b">03199</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a0ce5944dca582d34c478ae482f47801b">draw_mesh_object_outline</a>(<a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm)
<a name="l03200"></a>03200 {
<a name="l03201"></a>03201     
<a name="l03202"></a>03202     <span class="keywordflow">if</span> ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#ae22790924a440701ed3d01ad4db5eee2">transp</a> == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) &amp;&amp;  <span class="comment">/* not when we draw the transparent pass */</span>
<a name="l03203"></a>03203         (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a71c18d7335332f6a2fb10b7b1f9f94f5">OB_MODE_ALL_PAINT</a>) == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) <span class="comment">/* not when painting (its distracting) - campbell */</span>
<a name="l03204"></a>03204     {
<a name="l03205"></a>03205         glLineWidth(<a class="code" href="../../de/d96/UI__resources_8h.html#ad9772e3578b739880ada62a6d21f4349">UI_GetThemeValuef</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a59833dc47264720bb6817486722aad09">TH_OUTLINE_WIDTH</a>) * 2.0f);
<a name="l03206"></a>03206         glDepthMask(0);
<a name="l03207"></a>03207         
<a name="l03208"></a>03208         <span class="comment">/* if transparent, we cannot draw the edges for solid select... edges have no material info.</span>
<a name="l03209"></a>03209 <span class="comment">         * drawFacesSolid() doesn&#39;t draw the transparent faces */</span>
<a name="l03210"></a>03210         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a2e4203e6270100e25ef3d5ec64fc31a6">dtx</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a0ed6e1b47d274d4a990ad765bad2483f">OB_DRAWTRANSP</a>) {
<a name="l03211"></a>03211             glPolygonMode(GL_FRONT_AND_BACK, GL_LINE);
<a name="l03212"></a>03212             dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#ae8847d132e3b89911b0ee999b3843b95">drawFacesSolid</a>(dm, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>);
<a name="l03213"></a>03213             glPolygonMode(GL_FRONT_AND_BACK, GL_FILL);
<a name="l03214"></a>03214             <a class="code" href="../../d3/df0/GPU__draw_8h.html#a93e3b15a1a08a173c699b15068c35c35">GPU_disable_material</a>();
<a name="l03215"></a>03215         }
<a name="l03216"></a>03216         <span class="keywordflow">else</span> {
<a name="l03217"></a>03217             dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a05d1c2b6c7c1eff4fdf4fdb973bbba5c">drawEdges</a>(dm, 0, 1);
<a name="l03218"></a>03218         }
<a name="l03219"></a>03219 
<a name="l03220"></a>03220         glLineWidth(1.0);
<a name="l03221"></a>03221         glDepthMask(1);
<a name="l03222"></a>03222     }
<a name="l03223"></a>03223 }
<a name="l03224"></a>03224 
<a name="l03225"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a13a768fa69bcfbe3667e64b33f9fb2c4">03225</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a13a768fa69bcfbe3667e64b33f9fb2c4">draw_mesh_fancy</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d, <a class="code" href="../../d3/da9/structBase.html">Base</a> *base, <span class="keywordtype">int</span> dt, <span class="keywordtype">int</span> flag)
<a name="l03226"></a>03226 {
<a name="l03227"></a>03227     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l03228"></a>03228     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l03229"></a>03229     <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma = <a class="code" href="../../d4/d0f/BKE__material_8h.html#a941f5112d1047bcbcf3e2212685296a5">give_current_material</a>(ob, 1);
<a name="l03230"></a>03230     <span class="keyword">const</span> <span class="keywordtype">short</span> hasHaloMat = (ma &amp;&amp; (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ab2181c8ca6ce7ebdb8858702b9dd044c">material_type</a> == <a class="code" href="../../de/db2/DNA__material__types_8h.html#a263f8a32d8cbe3456366b40cb01deab1">MA_TYPE_HALO</a>));
<a name="l03231"></a>03231     <a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3">eWireDrawMode</a> draw_wire = <a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3ac80d84acc2f6ad2d7308d352738879a4">OBDRAW_WIRE_OFF</a>;
<a name="l03232"></a>03232     <span class="keywordtype">int</span> <span class="comment">/* totvert,*/</span> totedge, totface;
<a name="l03233"></a>03233     <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm = <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#a97d53912627cd01e30cab0c5a125485e">mesh_get_derived_final</a>(scene, ob, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a3a4f81e0f2023f6834ccb638ed26cd0c">customdata_mask</a>);
<a name="l03234"></a>03234     <span class="keyword">const</span> <span class="keywordtype">short</span> is_obact = (ob == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a119935c54737bd111df8fd516c390000">OBACT</a>);
<a name="l03235"></a>03235     <span class="keywordtype">int</span> draw_flags = (is_obact &amp;&amp; <a class="code" href="../../d8/d86/BKE__paint_8h.html#a56fc7a16c6dcfa3dd82680c86385e45f">paint_facesel_test</a>(ob)) ? <a class="code" href="../../d4/df4/view3d__intern_8h.html#aea0e76cfcf642fec7af307eccc559113">DRAW_FACE_SELECT</a> : 0;
<a name="l03236"></a>03236 
<a name="l03237"></a>03237     <span class="keywordflow">if</span> (!dm)
<a name="l03238"></a>03238         <span class="keywordflow">return</span>;
<a name="l03239"></a>03239 
<a name="l03240"></a>03240     <span class="comment">/* Check to draw dynamic paint colors (or weights from WeightVG modifiers).</span>
<a name="l03241"></a>03241 <span class="comment">     * Note: Last &quot;preview-active&quot; modifier in stack will win! */</span>
<a name="l03242"></a>03242     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#a6f4a64ea66e4fa753666158e8fb9f2f2">DM_get_tessface_data_layer</a>(dm, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a05dbd15401b25131931348cee85e3d92">CD_PREVIEW_MCOL</a>) &amp;&amp; <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#a11c8bf12ad07f016f7531e8eff44679c">modifiers_isPreview</a>(ob))
<a name="l03243"></a>03243         draw_flags |= <a class="code" href="../../d4/df4/view3d__intern_8h.html#af7090abebe97d767409c882c158d0f4a">DRAW_MODIFIERS_PREVIEW</a>;
<a name="l03244"></a>03244 
<a name="l03245"></a>03245     <span class="comment">/* Unwanted combination */</span>
<a name="l03246"></a>03246     <span class="keywordflow">if</span> (draw_flags &amp; <a class="code" href="../../d4/df4/view3d__intern_8h.html#aea0e76cfcf642fec7af307eccc559113">DRAW_FACE_SELECT</a>) {
<a name="l03247"></a>03247         draw_wire = <a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3ac80d84acc2f6ad2d7308d352738879a4">OBDRAW_WIRE_OFF</a>;
<a name="l03248"></a>03248     }
<a name="l03249"></a>03249     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a2e4203e6270100e25ef3d5ec64fc31a6">dtx</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5ab5449c65c7be34a82d408aff1c4e28">OB_DRAWWIRE</a>) {
<a name="l03250"></a>03250         draw_wire = <a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3a05aeed3709b2192e9b096aeefe0f1792">OBDRAW_WIRE_ON_DEPTH</a>; <span class="comment">/* draw wire after solid using zoffset and depth buffer adjusment */</span>
<a name="l03251"></a>03251     }
<a name="l03252"></a>03252     
<a name="l03253"></a>03253     <span class="comment">/* totvert = dm-&gt;getNumVerts(dm); */</span> <span class="comment">/*UNUSED*/</span>
<a name="l03254"></a>03254     totedge = dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a3b3f4272750d320851296b91df489952">getNumEdges</a>(dm);
<a name="l03255"></a>03255     totface = dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a3481fefe300b7d6b456071320be70c56">getNumTessFaces</a>(dm);
<a name="l03256"></a>03256     
<a name="l03257"></a>03257     <span class="comment">/* vertexpaint, faceselect wants this, but it doesnt work for shaded? */</span>
<a name="l03258"></a>03258     glFrontFace((ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1091cd84d4d7227ab41b167e84be3065">transflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a87014edc673c17c72d0cf437921da147">OB_NEG_SCALE</a>) ? GL_CW : GL_CCW);
<a name="l03259"></a>03259 
<a name="l03260"></a>03260     <span class="keywordflow">if</span> (dt == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a25d148b5766d55fc995b3e7eaba3187b">OB_BOUNDBOX</a>) {
<a name="l03261"></a>03261         <span class="keywordflow">if</span> (((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) &amp;&amp; v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a591cd4c57e5a79352f6733f6fa2bc1c9">drawtype</a> &gt;= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>) == 0)
<a name="l03262"></a>03262             <a class="code" href="../../d3/d02/drawobject_8c.html#a4d19f50de723a4c82b4a1695f99400d4">draw_bounding_volume</a>(scene, ob, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4975c8a0d650af6077543e9949c1cb28">boundtype</a>);
<a name="l03263"></a>03263     }
<a name="l03264"></a>03264     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hasHaloMat || (totface == 0 &amp;&amp; totedge == 0)) {
<a name="l03265"></a>03265         glPointSize(1.5);
<a name="l03266"></a>03266         dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a5fbf329323ac9455c78b088d4a45b919">drawVerts</a>(dm);
<a name="l03267"></a>03267         glPointSize(1.0);
<a name="l03268"></a>03268     }
<a name="l03269"></a>03269     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dt == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a> || totface == 0) {
<a name="l03270"></a>03270         draw_wire = <a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3adc95d305da2175bc61763f7926c8a8d0">OBDRAW_WIRE_ON</a>; <span class="comment">/* draw wire only, no depth buffer stuff  */</span>
<a name="l03271"></a>03271     }
<a name="l03272"></a>03272     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (draw_flags &amp; DRAW_FACE_SELECT || (is_obact &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550aefdee3fdb0d4e936026d0fbdeb55852d">OB_MODE_TEXTURE_PAINT</a>)) ||
<a name="l03273"></a>03273               <a class="code" href="../../d3/d02/drawobject_8c.html#a85a9a40d95e42913b5e214675483ca80">check_object_draw_texture</a>(scene, v3d, dt))
<a name="l03274"></a>03274     {
<a name="l03275"></a>03275         <span class="keywordflow">if</span> ( (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a97a32d38ce1481d61d60dc677693ce5d">flag</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5556e5caae70d11b0f6aacf0ebb02f2f">V3D_SELECT_OUTLINE</a>) &amp;&amp;
<a name="l03276"></a>03276              ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0) &amp;&amp;
<a name="l03277"></a>03277              (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) &amp;&amp;
<a name="l03278"></a>03278              !(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.f &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a7bc3ff94aabaed488f0d9b7199d11d22">G_PICKSEL</a> || (draw_flags &amp; DRAW_FACE_SELECT)) &amp;&amp;
<a name="l03279"></a>03279              (draw_wire == <a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3ac80d84acc2f6ad2d7308d352738879a4">OBDRAW_WIRE_OFF</a>))
<a name="l03280"></a>03280         {
<a name="l03281"></a>03281             <a class="code" href="../../d3/d02/drawobject_8c.html#a0ce5944dca582d34c478ae482f47801b">draw_mesh_object_outline</a>(v3d, ob, dm);
<a name="l03282"></a>03282         }
<a name="l03283"></a>03283 
<a name="l03284"></a>03284         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d02/drawobject_8c.html#aca409cda616fd2a1eb6eb2dc5b124fac">draw_glsl_material</a>(scene, ob, v3d, dt) &amp;&amp; !(draw_flags &amp; <a class="code" href="../../d4/df4/view3d__intern_8h.html#af7090abebe97d767409c882c158d0f4a">DRAW_MODIFIERS_PREVIEW</a>)) {
<a name="l03285"></a>03285             glFrontFace((ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1091cd84d4d7227ab41b167e84be3065">transflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a87014edc673c17c72d0cf437921da147">OB_NEG_SCALE</a>) ? GL_CW : GL_CCW);
<a name="l03286"></a>03286 
<a name="l03287"></a>03287             dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a9842d837891900256f008bbc3b47baab">drawFacesGLSL</a>(dm, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>);
<a name="l03288"></a>03288 <span class="comment">//          if (get_ob_property(ob, &quot;Text&quot;))</span>
<a name="l03289"></a>03289 <span class="comment">// XXX              draw_mesh_text(ob, 1);</span>
<a name="l03290"></a>03290             <a class="code" href="../../d3/df0/GPU__draw_8h.html#a93e3b15a1a08a173c699b15068c35c35">GPU_disable_material</a>();
<a name="l03291"></a>03291 
<a name="l03292"></a>03292             glFrontFace(GL_CCW);
<a name="l03293"></a>03293         }
<a name="l03294"></a>03294         <span class="keywordflow">else</span> {
<a name="l03295"></a>03295             <a class="code" href="../../d8/d5e/drawmesh_8c.html#af04cd37a0540fc9fc810493f74083e92">draw_mesh_textured</a>(scene, v3d, rv3d, ob, dm, draw_flags);
<a name="l03296"></a>03296         }
<a name="l03297"></a>03297 
<a name="l03298"></a>03298         <span class="keywordflow">if</span> (!(draw_flags &amp; DRAW_FACE_SELECT)) {
<a name="l03299"></a>03299             <span class="keywordflow">if</span> (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)
<a name="l03300"></a>03300                 <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(is_obact ? <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531af47479527035752070059cf6669daf09">TH_ACTIVE</a> : <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531acf22ebe596e9394104b732b077cbec7a">TH_SELECT</a>);
<a name="l03301"></a>03301             <span class="keywordflow">else</span>
<a name="l03302"></a>03302                 <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l03303"></a>03303 
<a name="l03304"></a>03304             <span class="keywordflow">if</span> ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0)
<a name="l03305"></a>03305                 dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a67bfd89c41ae5e949e88f8bf1199dfd8">drawLooseEdges</a>(dm);
<a name="l03306"></a>03306         }
<a name="l03307"></a>03307     }
<a name="l03308"></a>03308     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dt == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a02098d23ce96d480e90882bed52cb89d">OB_SOLID</a>) {
<a name="l03309"></a>03309         <span class="keywordflow">if</span> (is_obact &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; (<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550afa4f66c680fdf8f9cd7ef1ca969b1901">OB_MODE_VERTEX_PAINT</a> | <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a6ab1cede4f6911c8042ca67d0c53b780">OB_MODE_WEIGHT_PAINT</a>)) {
<a name="l03310"></a>03310             <span class="comment">/* weight paint in solid mode, special case. focus on making the weights clear</span>
<a name="l03311"></a>03311 <span class="comment">             * rather than the shading, this is also forced in wire view */</span>
<a name="l03312"></a>03312             <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>(0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03313"></a>03313             dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a68c34c18414350c39f74969f2cf3f276">drawMappedFaces</a>(dm, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>,
<a name="l03314"></a>03314                                 <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#a0f4fefe67bcaaeef025d1ec04a9014efaac2c4511ff1ea2e11b39e4ec6b20cc0e">DM_DRAW_USE_COLORS</a> | <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#a0f4fefe67bcaaeef025d1ec04a9014efa53bc64b355cb657df416a902043c3627">DM_DRAW_ALWAYS_SMOOTH</a>);
<a name="l03315"></a>03315 
<a name="l03316"></a>03316             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a34edada4ce250a4abb76f2011ac70a76">bglPolygonOffset</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a5a4f191256ccc5c28828b922636ca588">dist</a>, 1.0);
<a name="l03317"></a>03317             glDepthMask(0); <span class="comment">// disable write in zbuffer, selected edge wires show better</span>
<a name="l03318"></a>03318 
<a name="l03319"></a>03319             glEnable(GL_BLEND);
<a name="l03320"></a>03320             glColor4ub(255, 255, 255, 96);
<a name="l03321"></a>03321             glEnable(GL_LINE_STIPPLE);
<a name="l03322"></a>03322             glLineStipple(1, 0xAAAA);
<a name="l03323"></a>03323 
<a name="l03324"></a>03324             dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a05d1c2b6c7c1eff4fdf4fdb973bbba5c">drawEdges</a>(dm, 1, 1);
<a name="l03325"></a>03325 
<a name="l03326"></a>03326             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a34edada4ce250a4abb76f2011ac70a76">bglPolygonOffset</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a5a4f191256ccc5c28828b922636ca588">dist</a>, 0.0);
<a name="l03327"></a>03327             glDepthMask(1);
<a name="l03328"></a>03328             glDisable(GL_LINE_STIPPLE);
<a name="l03329"></a>03329             glDisable(GL_BLEND);
<a name="l03330"></a>03330 
<a name="l03331"></a>03331             <a class="code" href="../../d3/df0/GPU__draw_8h.html#a93e3b15a1a08a173c699b15068c35c35">GPU_disable_material</a>();
<a name="l03332"></a>03332             
<a name="l03333"></a>03333             <span class="comment">/* since we already draw wire as wp guide, don&#39;t draw over the top */</span>
<a name="l03334"></a>03334             draw_wire = <a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3ac80d84acc2f6ad2d7308d352738879a4">OBDRAW_WIRE_OFF</a>;
<a name="l03335"></a>03335         }
<a name="l03336"></a>03336         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (draw_flags &amp; <a class="code" href="../../d4/df4/view3d__intern_8h.html#af7090abebe97d767409c882c158d0f4a">DRAW_MODIFIERS_PREVIEW</a>) {
<a name="l03337"></a>03337             <span class="comment">/* for object selection draws no shade */</span>
<a name="l03338"></a>03338             <span class="keywordflow">if</span> (flag &amp; (<a class="code" href="../../d4/df4/view3d__intern_8h.html#a205a8c1771c3a0eab5ecd42de38c901c">DRAW_PICKING</a> | <a class="code" href="../../d4/df4/view3d__intern_8h.html#a865840f950d43c02ac67cce1663bd822">DRAW_CONSTCOLOR</a>)) {
<a name="l03339"></a>03339                 dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#ae8847d132e3b89911b0ee999b3843b95">drawFacesSolid</a>(dm, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>);
<a name="l03340"></a>03340             }
<a name="l03341"></a>03341             <span class="keywordflow">else</span> {
<a name="l03342"></a>03342                 <span class="comment">/* draw outline */</span>
<a name="l03343"></a>03343                 <span class="keywordflow">if</span> ( (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a97a32d38ce1481d61d60dc677693ce5d">flag</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5556e5caae70d11b0f6aacf0ebb02f2f">V3D_SELECT_OUTLINE</a>) &amp;&amp;
<a name="l03344"></a>03344                      ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0) &amp;&amp;
<a name="l03345"></a>03345                      (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) &amp;&amp;
<a name="l03346"></a>03346                      (draw_wire == <a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3ac80d84acc2f6ad2d7308d352738879a4">OBDRAW_WIRE_OFF</a>) &amp;&amp;
<a name="l03347"></a>03347                      (ob-&gt;<a class="code" href="../../de/de7/structObject.html#add5d1bf7bdd64ae917bed87d4d933277">sculpt</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
<a name="l03348"></a>03348                 {
<a name="l03349"></a>03349                     <a class="code" href="../../d3/d02/drawobject_8c.html#a0ce5944dca582d34c478ae482f47801b">draw_mesh_object_outline</a>(v3d, ob, dm);
<a name="l03350"></a>03350                 }
<a name="l03351"></a>03351 
<a name="l03352"></a>03352                 <span class="comment">/* materials arent compatible with vertex colors */</span>
<a name="l03353"></a>03353                 <a class="code" href="../../d3/df0/GPU__draw_8h.html#ac05a8ea057e161f6f5cc5c38a394a3e3">GPU_end_object_materials</a>();
<a name="l03354"></a>03354 
<a name="l03355"></a>03355                 <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>(0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03356"></a>03356                 
<a name="l03357"></a>03357                 <span class="comment">/* set default spec */</span>
<a name="l03358"></a>03358                 glColorMaterial(GL_FRONT_AND_BACK, GL_SPECULAR);
<a name="l03359"></a>03359                 glEnable(GL_COLOR_MATERIAL);    <span class="comment">/* according manpages needed */</span>
<a name="l03360"></a>03360                 glColor3ub(120, 120, 120);
<a name="l03361"></a>03361                 glDisable(GL_COLOR_MATERIAL);
<a name="l03362"></a>03362                 <span class="comment">/* diffuse */</span>
<a name="l03363"></a>03363                 glColorMaterial(GL_FRONT_AND_BACK, GL_DIFFUSE);
<a name="l03364"></a>03364                 glEnable(GL_LIGHTING);
<a name="l03365"></a>03365                 glEnable(GL_COLOR_MATERIAL);
<a name="l03366"></a>03366 
<a name="l03367"></a>03367                 dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a68c34c18414350c39f74969f2cf3f276">drawMappedFaces</a>(dm, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#a0f4fefe67bcaaeef025d1ec04a9014efaac2c4511ff1ea2e11b39e4ec6b20cc0e">DM_DRAW_USE_COLORS</a>);
<a name="l03368"></a>03368                 glDisable(GL_COLOR_MATERIAL);
<a name="l03369"></a>03369                 glDisable(GL_LIGHTING);
<a name="l03370"></a>03370 
<a name="l03371"></a>03371                 <a class="code" href="../../d3/df0/GPU__draw_8h.html#a93e3b15a1a08a173c699b15068c35c35">GPU_disable_material</a>();
<a name="l03372"></a>03372             }
<a name="l03373"></a>03373         }
<a name="l03374"></a>03374         <span class="keywordflow">else</span> {
<a name="l03375"></a>03375             <a class="code" href="../../d0/d6c/structPaint.html">Paint</a> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l03376"></a>03376 
<a name="l03377"></a>03377             <span class="keywordflow">if</span> ( (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a97a32d38ce1481d61d60dc677693ce5d">flag</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5556e5caae70d11b0f6aacf0ebb02f2f">V3D_SELECT_OUTLINE</a>) &amp;&amp;
<a name="l03378"></a>03378                  ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0) &amp;&amp;
<a name="l03379"></a>03379                  (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) &amp;&amp;
<a name="l03380"></a>03380                  (draw_wire == <a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3ac80d84acc2f6ad2d7308d352738879a4">OBDRAW_WIRE_OFF</a>) &amp;&amp;
<a name="l03381"></a>03381                  (ob-&gt;<a class="code" href="../../de/de7/structObject.html#add5d1bf7bdd64ae917bed87d4d933277">sculpt</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
<a name="l03382"></a>03382             {
<a name="l03383"></a>03383                 <a class="code" href="../../d3/d02/drawobject_8c.html#a0ce5944dca582d34c478ae482f47801b">draw_mesh_object_outline</a>(v3d, ob, dm);
<a name="l03384"></a>03384             }
<a name="l03385"></a>03385 
<a name="l03386"></a>03386             glLightModeli(GL_LIGHT_MODEL_TWO_SIDE, (me-&gt;<a class="code" href="../../da/d29/structMesh.html#a941cdd9a07c81485677efb6b444eb8ad">flag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a600ca431e8bfb463049665e0d172cf4e">ME_TWOSIDED</a>) ? GL_TRUE : GL_FALSE);
<a name="l03387"></a>03387 
<a name="l03388"></a>03388             glEnable(GL_LIGHTING);
<a name="l03389"></a>03389             glFrontFace((ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1091cd84d4d7227ab41b167e84be3065">transflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a87014edc673c17c72d0cf437921da147">OB_NEG_SCALE</a>) ? GL_CW : GL_CCW);
<a name="l03390"></a>03390 
<a name="l03391"></a>03391             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#add5d1bf7bdd64ae917bed87d4d933277">sculpt</a> &amp;&amp; (p = <a class="code" href="../../d8/d86/BKE__paint_8h.html#a4b3c2e4641d652cc475f36b3de296334">paint_get_active</a>(scene))) {
<a name="l03392"></a>03392                 <span class="keywordtype">float</span> planes[4][4];
<a name="l03393"></a>03393                 float (*fpl)[4] = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03394"></a>03394                 <span class="keywordtype">int</span> fast = (p-&gt;<a class="code" href="../../d0/d6c/structPaint.html#a89f27059527cc9fd7a8dec3e9e124183">flags</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a5031a8567a0671de309866bb78b88f87ac799a8e8951a9e2d269d519f06ef4c62">PAINT_FAST_NAVIGATE</a>) &amp;&amp; (rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a077da32c8352d8b7abb4b19919a14cf8">rflag</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#aeeb47cd227c6110396f1ae018facee2d">RV3D_NAVIGATING</a>);
<a name="l03395"></a>03395 
<a name="l03396"></a>03396                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#add5d1bf7bdd64ae917bed87d4d933277">sculpt</a>-&gt;<a class="code" href="../../dc/de3/structSculptSession.html#a5cb63972b746a848ec7cebe112dd85a4">partial_redraw</a>) {
<a name="l03397"></a>03397                     <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a4c516955ae19ced48acf70245d6269a8">do_draw</a> &amp; <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a10040b224eaa3cfe15444fdf2c01dcb8">RGN_DRAW_PARTIAL</a>) {
<a name="l03398"></a>03398                         <a class="code" href="../../db/de3/ED__sculpt_8h.html#a9b5570b252b3dc95051eb9f0dff2f626">sculpt_get_redraw_planes</a>(planes, ar, rv3d, ob);
<a name="l03399"></a>03399                         fpl = planes;
<a name="l03400"></a>03400                         ob-&gt;<a class="code" href="../../de/de7/structObject.html#add5d1bf7bdd64ae917bed87d4d933277">sculpt</a>-&gt;<a class="code" href="../../dc/de3/structSculptSession.html#a5cb63972b746a848ec7cebe112dd85a4">partial_redraw</a> = 0;
<a name="l03401"></a>03401                     }
<a name="l03402"></a>03402                 }
<a name="l03403"></a>03403 
<a name="l03404"></a>03404                 dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#ae8847d132e3b89911b0ee999b3843b95">drawFacesSolid</a>(dm, fpl, fast, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>);
<a name="l03405"></a>03405             }
<a name="l03406"></a>03406             <span class="keywordflow">else</span>
<a name="l03407"></a>03407                 dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#ae8847d132e3b89911b0ee999b3843b95">drawFacesSolid</a>(dm, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>);
<a name="l03408"></a>03408 
<a name="l03409"></a>03409             <a class="code" href="../../d3/df0/GPU__draw_8h.html#a93e3b15a1a08a173c699b15068c35c35">GPU_disable_material</a>();
<a name="l03410"></a>03410 
<a name="l03411"></a>03411             glFrontFace(GL_CCW);
<a name="l03412"></a>03412             glDisable(GL_LIGHTING);
<a name="l03413"></a>03413 
<a name="l03414"></a>03414             glLightModeli(GL_LIGHT_MODEL_TWO_SIDE, GL_FALSE);
<a name="l03415"></a>03415 
<a name="l03416"></a>03416             <span class="keywordflow">if</span> (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l03417"></a>03417                 <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(is_obact ? <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531af47479527035752070059cf6669daf09">TH_ACTIVE</a> : <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531acf22ebe596e9394104b732b077cbec7a">TH_SELECT</a>);
<a name="l03418"></a>03418             }
<a name="l03419"></a>03419             <span class="keywordflow">else</span> {
<a name="l03420"></a>03420                 <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l03421"></a>03421             }
<a name="l03422"></a>03422             <span class="keywordflow">if</span> (!ob-&gt;<a class="code" href="../../de/de7/structObject.html#add5d1bf7bdd64ae917bed87d4d933277">sculpt</a> &amp;&amp; (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0)
<a name="l03423"></a>03423                 dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a67bfd89c41ae5e949e88f8bf1199dfd8">drawLooseEdges</a>(dm);
<a name="l03424"></a>03424         }
<a name="l03425"></a>03425     }
<a name="l03426"></a>03426     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dt == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a3be2475cb504a06c687e2488eaec8942">OB_PAINT</a>) {
<a name="l03427"></a>03427         <span class="keywordflow">if</span> (is_obact) {
<a name="l03428"></a>03428             <span class="keywordflow">if</span> (ob &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a6ab1cede4f6911c8042ca67d0c53b780">OB_MODE_WEIGHT_PAINT</a>) {
<a name="l03429"></a>03429                 <span class="comment">/* enforce default material settings */</span>
<a name="l03430"></a>03430                 <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>(0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03431"></a>03431                 
<a name="l03432"></a>03432                 <span class="comment">/* but set default spec */</span>
<a name="l03433"></a>03433                 glColorMaterial(GL_FRONT_AND_BACK, GL_SPECULAR);
<a name="l03434"></a>03434                 glEnable(GL_COLOR_MATERIAL);    <span class="comment">/* according manpages needed */</span>
<a name="l03435"></a>03435                 glColor3ub(120, 120, 120);
<a name="l03436"></a>03436                 glDisable(GL_COLOR_MATERIAL);
<a name="l03437"></a>03437                 <span class="comment">/* diffuse */</span>
<a name="l03438"></a>03438                 glColorMaterial(GL_FRONT_AND_BACK, GL_DIFFUSE);
<a name="l03439"></a>03439                 glEnable(GL_LIGHTING);
<a name="l03440"></a>03440                 glEnable(GL_COLOR_MATERIAL);
<a name="l03441"></a>03441 
<a name="l03442"></a>03442                 dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a68c34c18414350c39f74969f2cf3f276">drawMappedFaces</a>(dm, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>,
<a name="l03443"></a>03443                                     <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#a0f4fefe67bcaaeef025d1ec04a9014efaac2c4511ff1ea2e11b39e4ec6b20cc0e">DM_DRAW_USE_COLORS</a> | <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#a0f4fefe67bcaaeef025d1ec04a9014efa53bc64b355cb657df416a902043c3627">DM_DRAW_ALWAYS_SMOOTH</a>);
<a name="l03444"></a>03444                 glDisable(GL_COLOR_MATERIAL);
<a name="l03445"></a>03445                 glDisable(GL_LIGHTING);
<a name="l03446"></a>03446 
<a name="l03447"></a>03447                 <a class="code" href="../../d3/df0/GPU__draw_8h.html#a93e3b15a1a08a173c699b15068c35c35">GPU_disable_material</a>();
<a name="l03448"></a>03448             }
<a name="l03449"></a>03449             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550afa4f66c680fdf8f9cd7ef1ca969b1901">OB_MODE_VERTEX_PAINT</a>) {
<a name="l03450"></a>03450                 <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#a42f7770f13a2a1ff5042036eed27edef">mloopcol</a>)
<a name="l03451"></a>03451                     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a68c34c18414350c39f74969f2cf3f276">drawMappedFaces</a>(dm, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,
<a name="l03452"></a>03452                                         <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#a0f4fefe67bcaaeef025d1ec04a9014efaac2c4511ff1ea2e11b39e4ec6b20cc0e">DM_DRAW_USE_COLORS</a> | <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#a0f4fefe67bcaaeef025d1ec04a9014efa53bc64b355cb657df416a902043c3627">DM_DRAW_ALWAYS_SMOOTH</a>);
<a name="l03453"></a>03453                 <span class="keywordflow">else</span> {
<a name="l03454"></a>03454                     glColor3f(1.0f, 1.0f, 1.0f);
<a name="l03455"></a>03455                     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a68c34c18414350c39f74969f2cf3f276">drawMappedFaces</a>(dm, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,
<a name="l03456"></a>03456                                         <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#a0f4fefe67bcaaeef025d1ec04a9014efa53bc64b355cb657df416a902043c3627">DM_DRAW_ALWAYS_SMOOTH</a>);
<a name="l03457"></a>03457                 }
<a name="l03458"></a>03458             }
<a name="l03459"></a>03459         }
<a name="l03460"></a>03460     }
<a name="l03461"></a>03461     
<a name="l03462"></a>03462     <span class="comment">/* set default draw color back for wire or for draw-extra later on */</span>
<a name="l03463"></a>03463     <span class="keywordflow">if</span> (dt != <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>) {
<a name="l03464"></a>03464         <span class="keywordflow">if</span> (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l03465"></a>03465             <span class="keywordflow">if</span> (is_obact &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9588748603be4778a9197f7edbf356d4">OB_FROMGROUP</a>)
<a name="l03466"></a>03466                 <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531ad2ba053e9237f2b78da8da066b4529e6">TH_GROUP_ACTIVE</a>);
<a name="l03467"></a>03467             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9588748603be4778a9197f7edbf356d4">OB_FROMGROUP</a>)
<a name="l03468"></a>03468                 <a class="code" href="../../de/d96/UI__resources_8h.html#a56c7a350537a25b88d0532488032aef6">UI_ThemeColorShade</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531ad2ba053e9237f2b78da8da066b4529e6">TH_GROUP_ACTIVE</a>, -16);
<a name="l03469"></a>03469             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flag != <a class="code" href="../../d4/df4/view3d__intern_8h.html#a865840f950d43c02ac67cce1663bd822">DRAW_CONSTCOLOR</a>)
<a name="l03470"></a>03470                 <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(is_obact ? <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531af47479527035752070059cf6669daf09">TH_ACTIVE</a> : <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531acf22ebe596e9394104b732b077cbec7a">TH_SELECT</a>);
<a name="l03471"></a>03471             <span class="keywordflow">else</span>
<a name="l03472"></a>03472                 glColor3ub(80, 80, 80);
<a name="l03473"></a>03473         }
<a name="l03474"></a>03474         <span class="keywordflow">else</span> {
<a name="l03475"></a>03475             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9588748603be4778a9197f7edbf356d4">OB_FROMGROUP</a>)
<a name="l03476"></a>03476                 <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a40a85507e5970cdab915fbc81828f3ff">TH_GROUP</a>);
<a name="l03477"></a>03477             <span class="keywordflow">else</span> {
<a name="l03478"></a>03478                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a2e4203e6270100e25ef3d5ec64fc31a6">dtx</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5ab5449c65c7be34a82d408aff1c4e28">OB_DRAWWIRE</a> &amp;&amp; flag == <a class="code" href="../../d4/df4/view3d__intern_8h.html#a865840f950d43c02ac67cce1663bd822">DRAW_CONSTCOLOR</a>)
<a name="l03479"></a>03479                     glColor3ub(80, 80, 80);
<a name="l03480"></a>03480                 <span class="keywordflow">else</span>
<a name="l03481"></a>03481                     <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l03482"></a>03482             }
<a name="l03483"></a>03483         }
<a name="l03484"></a>03484     }
<a name="l03485"></a>03485     <span class="keywordflow">if</span> (draw_wire != <a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3ac80d84acc2f6ad2d7308d352738879a4">OBDRAW_WIRE_OFF</a>) {
<a name="l03486"></a>03486 
<a name="l03487"></a>03487         <span class="comment">/* When using wireframe object draw in particle edit mode</span>
<a name="l03488"></a>03488 <span class="comment">         * the mesh gets in the way of seeing the particles, fade the wire color</span>
<a name="l03489"></a>03489 <span class="comment">         * with the background. */</span>
<a name="l03490"></a>03490         <span class="keywordflow">if</span> (is_obact &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a20027b5f4381f062402af134bcefe889">OB_MODE_PARTICLE_EDIT</a>)) {
<a name="l03491"></a>03491             <span class="keywordtype">float</span> col_wire[4], col_bg[4], col[3];
<a name="l03492"></a>03492 
<a name="l03493"></a>03493             <a class="code" href="../../de/d96/UI__resources_8h.html#a986d2ffa67e027bb858e453c1fd3d055">UI_GetThemeColor3fv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a2f524dc89597307994ab7d91402f79cf">TH_BACK</a>, col_bg);
<a name="l03494"></a>03494             glGetFloatv(GL_CURRENT_COLOR, col_wire);
<a name="l03495"></a>03495             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1527309f09525ae91ed04692da13ba98">interp_v3_v3v3</a>(col, col_bg, col_wire, 0.15);
<a name="l03496"></a>03496             glColor3fv(col);
<a name="l03497"></a>03497         }
<a name="l03498"></a>03498 
<a name="l03499"></a>03499         <span class="comment">/* If drawing wire and drawtype is not OB_WIRE then we are</span>
<a name="l03500"></a>03500 <span class="comment">         * overlaying the wires.</span>
<a name="l03501"></a>03501 <span class="comment">         *</span>
<a name="l03502"></a>03502 <span class="comment">         * UPDATE bug #10290 - With this wire-only objects can draw</span>
<a name="l03503"></a>03503 <span class="comment">         * behind other objects depending on their order in the scene. 2x if 0&#39;s below. undo&#39;ing zr&#39;s commit: r4059</span>
<a name="l03504"></a>03504 <span class="comment">         *</span>
<a name="l03505"></a>03505 <span class="comment">         * if draw wire is 1 then just drawing wire, no need for depth buffer stuff,</span>
<a name="l03506"></a>03506 <span class="comment">         * otherwise this wire is to overlay solid mode faces so do some depth buffer tricks.</span>
<a name="l03507"></a>03507 <span class="comment">         */</span>
<a name="l03508"></a>03508         <span class="keywordflow">if</span> (dt != <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a> &amp;&amp; (draw_wire == <a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3a05aeed3709b2192e9b096aeefe0f1792">OBDRAW_WIRE_ON_DEPTH</a>)) {
<a name="l03509"></a>03509             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a34edada4ce250a4abb76f2011ac70a76">bglPolygonOffset</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a5a4f191256ccc5c28828b922636ca588">dist</a>, 1.0);
<a name="l03510"></a>03510             glDepthMask(0); <span class="comment">// disable write in zbuffer, selected edge wires show better</span>
<a name="l03511"></a>03511         }
<a name="l03512"></a>03512         
<a name="l03513"></a>03513         <span class="keywordflow">if</span> (((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) &amp;&amp; v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a591cd4c57e5a79352f6733f6fa2bc1c9">drawtype</a> &gt;= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a02098d23ce96d480e90882bed52cb89d">OB_SOLID</a>) == 0)
<a name="l03514"></a>03514             dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a05d1c2b6c7c1eff4fdf4fdb973bbba5c">drawEdges</a>(dm, (dt == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a> || totface == 0), me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad595684991ea05e3a160d1b1f523158c">drawflag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a678fc945f47da33900a2a1d4616eb913">ME_ALLEDGES</a>);
<a name="l03515"></a>03515 
<a name="l03516"></a>03516         <span class="keywordflow">if</span> (dt != <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a> &amp;&amp; (draw_wire == <a class="code" href="../../d3/d02/drawobject_8c.html#ac037ae52799d095cb4a2d20dab5841e3a05aeed3709b2192e9b096aeefe0f1792">OBDRAW_WIRE_ON_DEPTH</a>)) {
<a name="l03517"></a>03517             glDepthMask(1);
<a name="l03518"></a>03518             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a34edada4ce250a4abb76f2011ac70a76">bglPolygonOffset</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a5a4f191256ccc5c28828b922636ca588">dist</a>, 0.0);
<a name="l03519"></a>03519         }
<a name="l03520"></a>03520     }
<a name="l03521"></a>03521     
<a name="l03522"></a>03522     <span class="keywordflow">if</span> (is_obact &amp;&amp; <a class="code" href="../../d8/d86/BKE__paint_8h.html#a347e2aab7dc47e1f5e58d0f43a8f2ca8">paint_vertsel_test</a>(ob)) {
<a name="l03523"></a>03523         
<a name="l03524"></a>03524         glColor3f(0.0f, 0.0f, 0.0f);
<a name="l03525"></a>03525         glPointSize(<a class="code" href="../../de/d96/UI__resources_8h.html#ad9772e3578b739880ada62a6d21f4349">UI_GetThemeValuef</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a6c88c69347ab72b259eb7fcc8885327b">TH_VERTEX_SIZE</a>));
<a name="l03526"></a>03526         
<a name="l03527"></a>03527         <a class="code" href="../../d3/d02/drawobject_8c.html#a7ac346154ad0ffffa9073f549822e29f">drawSelectedVertices</a>(dm, ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l03528"></a>03528         
<a name="l03529"></a>03529         glPointSize(1.0f);
<a name="l03530"></a>03530     }
<a name="l03531"></a>03531     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a36c159344a023f5fbe64f12006c8647f">release</a>(dm);
<a name="l03532"></a>03532 }
<a name="l03533"></a>03533 
<a name="l03534"></a>03534 <span class="comment">/* returns 1 if nothing was drawn, for detecting to draw an object center */</span>
<a name="l03535"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ad26c971cb1d3b4cdde9e58dc5bb729cb">03535</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ad26c971cb1d3b4cdde9e58dc5bb729cb">draw_mesh_object</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d, <a class="code" href="../../d3/da9/structBase.html">Base</a> *base, <span class="keywordtype">int</span> dt, <span class="keywordtype">int</span> flag)
<a name="l03536"></a>03536 {
<a name="l03537"></a>03537     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l03538"></a>03538     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a1aa1978dba5dab99d35b6ba89e88b5bb">obedit</a>;
<a name="l03539"></a>03539     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l03540"></a>03540     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>;
<a name="l03541"></a>03541     <span class="keywordtype">int</span> do_alpha_after = 0, drawlinked = 0, retval = 0, glsl, check_alpha, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03542"></a>03542 
<a name="l03543"></a>03543     <span class="comment">/* If we are drawing shadows and any of the materials don&#39;t cast a shadow,</span>
<a name="l03544"></a>03544 <span class="comment">     * then don&#39;t draw the object */</span>
<a name="l03545"></a>03545     <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#afb3cea5af9bdf7d33facf737c539460b">V3D_RENDER_SHADOW</a>) {
<a name="l03546"></a>03546         <span class="keywordflow">for</span> (i = 0; i &lt; ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad3bbabfca98cb47923254dd04d6961ac">totcol</a>; ++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {
<a name="l03547"></a>03547             <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma = <a class="code" href="../../d4/d0f/BKE__material_8h.html#a941f5112d1047bcbcf3e2212685296a5">give_current_material</a>(ob, i);
<a name="l03548"></a>03548             <span class="keywordflow">if</span> (ma &amp;&amp; !(ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ad4773378c42a4167bdd615d67997535e">mode</a> &amp; <a class="code" href="../../de/db2/DNA__material__types_8h.html#a57a66e703cc7c97d7e2feb1f6b5bccc6">MA_SHADBUF</a>)) {
<a name="l03549"></a>03549                 <span class="keywordflow">return</span> 1;
<a name="l03550"></a>03550             }
<a name="l03551"></a>03551         }
<a name="l03552"></a>03552     }
<a name="l03553"></a>03553     
<a name="l03554"></a>03554     <span class="keywordflow">if</span> (obedit &amp;&amp; ob != obedit &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a> == obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>) {
<a name="l03555"></a>03555         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d17/BKE__key_8h.html#a8f07b4f039eb391df3c5b429d2f79e62">ob_get_key</a>(ob) || <a class="code" href="../../d5/d17/BKE__key_8h.html#a8f07b4f039eb391df3c5b429d2f79e62">ob_get_key</a>(obedit)) {}
<a name="l03556"></a>03556         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> || obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {}
<a name="l03557"></a>03557         <span class="keywordflow">else</span> drawlinked = 1;
<a name="l03558"></a>03558     }
<a name="l03559"></a>03559     
<a name="l03560"></a>03560     <span class="keywordflow">if</span> (ob == obedit || drawlinked) {
<a name="l03561"></a>03561         <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *finalDM, *cageDM;
<a name="l03562"></a>03562         
<a name="l03563"></a>03563         <span class="keywordflow">if</span> (obedit != ob)
<a name="l03564"></a>03564             finalDM = cageDM = <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ad219e8b9311146ba070bcd1e98622a1d">editbmesh_get_derived_base</a>(ob, em);
<a name="l03565"></a>03565         <span class="keywordflow">else</span>
<a name="l03566"></a>03566             cageDM = <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#a6173b8466ecd4cd5c46176550ff7867c">editbmesh_get_derived_cage_and_final</a>(scene, ob, em, &amp;finalDM,
<a name="l03567"></a>03567                                                           scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a3a4f81e0f2023f6834ccb638ed26cd0c">customdata_mask</a>);
<a name="l03568"></a>03568 
<a name="l03569"></a>03569         <span class="keywordflow">if</span> (dt &gt; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>) {
<a name="l03570"></a>03570             glsl = <a class="code" href="../../d3/d02/drawobject_8c.html#aca409cda616fd2a1eb6eb2dc5b124fac">draw_glsl_material</a>(scene, ob, v3d, dt);
<a name="l03571"></a>03571 
<a name="l03572"></a>03572             <a class="code" href="../../d3/df0/GPU__draw_8h.html#a298d978884494b64b6a783903350e2f6">GPU_begin_object_materials</a>(v3d, rv3d, scene, ob, glsl, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03573"></a>03573         }
<a name="l03574"></a>03574 
<a name="l03575"></a>03575         <a class="code" href="../../d3/d02/drawobject_8c.html#a64812ebf17fdf9e0794b39b89a1b6e64">draw_em_fancy</a>(scene, v3d, rv3d, ob, em, cageDM, finalDM, dt);
<a name="l03576"></a>03576 
<a name="l03577"></a>03577         <a class="code" href="../../d3/df0/GPU__draw_8h.html#ac05a8ea057e161f6f5cc5c38a394a3e3">GPU_end_object_materials</a>();
<a name="l03578"></a>03578 
<a name="l03579"></a>03579         <span class="keywordflow">if</span> (obedit != ob &amp;&amp; finalDM)
<a name="l03580"></a>03580             finalDM-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a36c159344a023f5fbe64f12006c8647f">release</a>(finalDM);
<a name="l03581"></a>03581     }
<a name="l03582"></a>03582     <span class="keywordflow">else</span> {
<a name="l03583"></a>03583         <span class="comment">/* don&#39;t create boundbox here with mesh_get_bb(), the derived system will make it, puts deformed bb&#39;s OK */</span>
<a name="l03584"></a>03584         <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ac26ffb56473851155dc77789a012c5d9">totpoly</a> &lt;= 4 || <a class="code" href="../../d4/df4/view3d__intern_8h.html#a6bfc52d69da31d8e5c9a2eb4384fd90a">ED_view3d_boundbox_clip</a>(rv3d, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a>) ? ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a> : me-&gt;<a class="code" href="../../da/d29/structMesh.html#a71b32c841e28c59ad02129f2a0e72648">bb</a>)) {
<a name="l03585"></a>03585             glsl = <a class="code" href="../../d3/d02/drawobject_8c.html#aca409cda616fd2a1eb6eb2dc5b124fac">draw_glsl_material</a>(scene, ob, v3d, dt);
<a name="l03586"></a>03586             check_alpha = <a class="code" href="../../d3/d02/drawobject_8c.html#a8986b585fa17b43e611714a7a03112cf">check_alpha_pass</a>(base);
<a name="l03587"></a>03587 
<a name="l03588"></a>03588             <span class="keywordflow">if</span> (dt == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a02098d23ce96d480e90882bed52cb89d">OB_SOLID</a> || glsl) {
<a name="l03589"></a>03589                 <a class="code" href="../../d3/df0/GPU__draw_8h.html#a298d978884494b64b6a783903350e2f6">GPU_begin_object_materials</a>(v3d, rv3d, scene, ob, glsl,
<a name="l03590"></a>03590                                            (check_alpha) ? &amp;do_alpha_after : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03591"></a>03591             }
<a name="l03592"></a>03592 
<a name="l03593"></a>03593             <a class="code" href="../../d3/d02/drawobject_8c.html#a13a768fa69bcfbe3667e64b33f9fb2c4">draw_mesh_fancy</a>(scene, ar, v3d, rv3d, base, dt, flag);
<a name="l03594"></a>03594 
<a name="l03595"></a>03595             <a class="code" href="../../d3/df0/GPU__draw_8h.html#ac05a8ea057e161f6f5cc5c38a394a3e3">GPU_end_object_materials</a>();
<a name="l03596"></a>03596             
<a name="l03597"></a>03597             <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#a8eb428498e3a39055f51a7de431655ed">totvert</a> == 0) retval = 1;
<a name="l03598"></a>03598         }
<a name="l03599"></a>03599     }
<a name="l03600"></a>03600     
<a name="l03601"></a>03601     <span class="comment">/* GPU_begin_object_materials checked if this is needed */</span>
<a name="l03602"></a>03602     <span class="keywordflow">if</span> (do_alpha_after) {
<a name="l03603"></a>03603         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a2e4203e6270100e25ef3d5ec64fc31a6">dtx</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aec24cba637ae295c6076159bac9ff80d">OB_DRAWXRAY</a>) {
<a name="l03604"></a>03604             <a class="code" href="../../d8/d7f/view3d__draw_8c.html#a62d12554313bcbe2e30a7e7eda84aa59">add_view3d_after</a>(&amp;v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#aff04d5222f4500dd8529d2cd590ec582">afterdraw_xraytransp</a>, base, flag);
<a name="l03605"></a>03605         }
<a name="l03606"></a>03606         <span class="keywordflow">else</span> {
<a name="l03607"></a>03607             <a class="code" href="../../d8/d7f/view3d__draw_8c.html#a62d12554313bcbe2e30a7e7eda84aa59">add_view3d_after</a>(&amp;v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#aa50bdf2e33288df03e6ee33f75806c4f">afterdraw_transp</a>, base, flag);
<a name="l03608"></a>03608         }
<a name="l03609"></a>03609     }
<a name="l03610"></a>03610     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a2e4203e6270100e25ef3d5ec64fc31a6">dtx</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aec24cba637ae295c6076159bac9ff80d">OB_DRAWXRAY</a> &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a2e4203e6270100e25ef3d5ec64fc31a6">dtx</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a0ed6e1b47d274d4a990ad765bad2483f">OB_DRAWTRANSP</a>) {
<a name="l03611"></a>03611         <span class="comment">/* special case xray+transp when alpha is 1.0, without this the object vanishes */</span>
<a name="l03612"></a>03612         <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a6c3dbc2765218b5850a40f3afc522d42">xray</a> == 0 &amp;&amp; v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#ae22790924a440701ed3d01ad4db5eee2">transp</a> == 0) {
<a name="l03613"></a>03613             <a class="code" href="../../d8/d7f/view3d__draw_8c.html#a62d12554313bcbe2e30a7e7eda84aa59">add_view3d_after</a>(&amp;v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a5ebc452868e0552460b5e249d101d464">afterdraw_xray</a>, base, flag);
<a name="l03614"></a>03614         }
<a name="l03615"></a>03615     }
<a name="l03616"></a>03616     
<a name="l03617"></a>03617     <span class="keywordflow">return</span> retval;
<a name="l03618"></a>03618 }
<a name="l03619"></a>03619 
<a name="l03620"></a>03620 <span class="comment">/* ************** DRAW DISPLIST ****************** */</span>
<a name="l03621"></a>03621 
<a name="l03622"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a3f89300534f123858fc0c8d8e71e178d">03622</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a3f89300534f123858fc0c8d8e71e178d">draw_index_wire</a> = 1;
<a name="l03623"></a><a class="code" href="../../d3/d02/drawobject_8c.html#abf72105fd4a40cdf00c291b39ea9869e">03623</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d02/drawobject_8c.html#abf72105fd4a40cdf00c291b39ea9869e">index3_nors_incr</a> = 1;
<a name="l03624"></a>03624 
<a name="l03625"></a>03625 <span class="comment">/* returns 1 when nothing was drawn */</span>
<a name="l03626"></a><a class="code" href="../../d3/d02/drawobject_8c.html#aae58e1c67b48d497a097d5d021d59244">03626</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d02/drawobject_8c.html#aae58e1c67b48d497a097d5d021d59244">drawDispListwire</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *dlbase)
<a name="l03627"></a>03627 {
<a name="l03628"></a>03628     <a class="code" href="../../d5/d2f/structDispList.html">DispList</a> *dl;
<a name="l03629"></a>03629     <span class="keywordtype">int</span> parts, nr;
<a name="l03630"></a>03630     <span class="keywordtype">float</span> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l03631"></a>03631 
<a name="l03632"></a>03632     <span class="keywordflow">if</span> (dlbase == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> 1;
<a name="l03633"></a>03633     
<a name="l03634"></a>03634     glEnableClientState(GL_VERTEX_ARRAY);
<a name="l03635"></a>03635     glPolygonMode(GL_FRONT_AND_BACK, GL_LINE);
<a name="l03636"></a>03636 
<a name="l03637"></a>03637     <span class="keywordflow">for</span> (dl = dlbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; dl; dl = dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a902acb76b3f3a2b20b0c9f755c652bf9">next</a>) {
<a name="l03638"></a>03638         <span class="keywordflow">if</span> (dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a> == 0 || dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a> == 0)
<a name="l03639"></a>03639             <span class="keywordflow">continue</span>;
<a name="l03640"></a>03640         
<a name="l03641"></a>03641         data = dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>;
<a name="l03642"></a>03642 
<a name="l03643"></a>03643         <span class="keywordflow">switch</span> (dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a14a8a66c424ba6ecb972e49847b61483">type</a>) {
<a name="l03644"></a>03644             <span class="keywordflow">case</span> <a class="code" href="../../d9/d12/BKE__displist_8h.html#ad298e077cdc5f0f6e4d4060fbb08618c">DL_SEGM</a>:
<a name="l03645"></a>03645 
<a name="l03646"></a>03646                 glVertexPointer(3, GL_FLOAT, 0, data);
<a name="l03647"></a>03647 
<a name="l03648"></a>03648                 <span class="keywordflow">for</span> (parts = 0; parts &lt; dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>; parts++)
<a name="l03649"></a>03649                     glDrawArrays(GL_LINE_STRIP, parts * dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>, dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>);
<a name="l03650"></a>03650                 
<a name="l03651"></a>03651                 <span class="keywordflow">break</span>;
<a name="l03652"></a>03652             <span class="keywordflow">case</span> <a class="code" href="../../d9/d12/BKE__displist_8h.html#a0402654c17f3e8795c9d987a25b83c6f">DL_POLY</a>:
<a name="l03653"></a>03653 
<a name="l03654"></a>03654                 glVertexPointer(3, GL_FLOAT, 0, data);
<a name="l03655"></a>03655 
<a name="l03656"></a>03656                 <span class="keywordflow">for</span> (parts = 0; parts &lt; dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>; parts++)
<a name="l03657"></a>03657                     glDrawArrays(GL_LINE_LOOP, parts * dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>, dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>);
<a name="l03658"></a>03658 
<a name="l03659"></a>03659                 <span class="keywordflow">break</span>;
<a name="l03660"></a>03660             <span class="keywordflow">case</span> <a class="code" href="../../d9/d12/BKE__displist_8h.html#aa264a2c12f3c058a0b62f7ea6dccbefa">DL_SURF</a>:
<a name="l03661"></a>03661 
<a name="l03662"></a>03662                 glVertexPointer(3, GL_FLOAT, 0, data);
<a name="l03663"></a>03663 
<a name="l03664"></a>03664                 <span class="keywordflow">for</span> (parts = 0; parts &lt; dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>; parts++) {
<a name="l03665"></a>03665                     <span class="keywordflow">if</span> (dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#ab71643e664ff559f5e798fc7fc4cfe55">flag</a> &amp; <a class="code" href="../../d9/d12/BKE__displist_8h.html#aa455c760328fd01bc0e18aa819f4bb10">DL_CYCL_U</a>)
<a name="l03666"></a>03666                         glDrawArrays(GL_LINE_LOOP, parts * dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>, dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>);
<a name="l03667"></a>03667                     <span class="keywordflow">else</span>
<a name="l03668"></a>03668                         glDrawArrays(GL_LINE_STRIP, parts * dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>, dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>);
<a name="l03669"></a>03669                 }
<a name="l03670"></a>03670 
<a name="l03671"></a>03671                 <span class="keywordflow">for</span> (nr = 0; nr &lt; dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>; nr++) {
<a name="l03672"></a>03672                     <span class="keywordtype">int</span> ofs = 3 * dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>;
<a name="l03673"></a>03673 
<a name="l03674"></a>03674                     data = (dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>) + 3 * nr;
<a name="l03675"></a>03675                     parts = dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>;
<a name="l03676"></a>03676 
<a name="l03677"></a>03677                     <span class="keywordflow">if</span> (dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#ab71643e664ff559f5e798fc7fc4cfe55">flag</a> &amp; <a class="code" href="../../d9/d12/BKE__displist_8h.html#ac44be4fcc9a60be5fc4dc0074cee889c">DL_CYCL_V</a>) glBegin(GL_LINE_LOOP);
<a name="l03678"></a>03678                     <span class="keywordflow">else</span> glBegin(GL_LINE_STRIP);
<a name="l03679"></a>03679 
<a name="l03680"></a>03680                     <span class="keywordflow">while</span> (parts--) {
<a name="l03681"></a>03681                         glVertex3fv(data);
<a name="l03682"></a>03682                         data += ofs;
<a name="l03683"></a>03683                     }
<a name="l03684"></a>03684                     glEnd();
<a name="l03685"></a>03685 
<a name="l03686"></a>03686 <span class="comment">/* (ton) this code crashes for me when resolv is 86 or higher... no clue */</span>
<a name="l03687"></a>03687 <span class="comment">//              glVertexPointer(3, GL_FLOAT, sizeof(float)*3*dl-&gt;nr, data + 3*nr);</span>
<a name="l03688"></a>03688 <span class="comment">//              if (dl-&gt;flag &amp; DL_CYCL_V)</span>
<a name="l03689"></a>03689 <span class="comment">//                  glDrawArrays(GL_LINE_LOOP, 0, dl-&gt;parts);</span>
<a name="l03690"></a>03690 <span class="comment">//              else</span>
<a name="l03691"></a>03691 <span class="comment">//                  glDrawArrays(GL_LINE_STRIP, 0, dl-&gt;parts);</span>
<a name="l03692"></a>03692                 }
<a name="l03693"></a>03693                 <span class="keywordflow">break</span>;
<a name="l03694"></a>03694 
<a name="l03695"></a>03695             <span class="keywordflow">case</span> <a class="code" href="../../d9/d12/BKE__displist_8h.html#a8fdfde765231c4dfbe1df3f263abdd02">DL_INDEX3</a>:
<a name="l03696"></a>03696                 <span class="keywordflow">if</span> (draw_index_wire) {
<a name="l03697"></a>03697                     glVertexPointer(3, GL_FLOAT, 0, dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>);
<a name="l03698"></a>03698                     glDrawElements(GL_TRIANGLES, 3 * dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>, GL_UNSIGNED_INT, dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a6c3c9ad7f71c3ee1a79e23af0c6cef42">index</a>);
<a name="l03699"></a>03699                 }
<a name="l03700"></a>03700                 <span class="keywordflow">break</span>;
<a name="l03701"></a>03701 
<a name="l03702"></a>03702             <span class="keywordflow">case</span> <a class="code" href="../../d9/d12/BKE__displist_8h.html#ac31985d3494fb5bb0f23b72f1cc28487">DL_INDEX4</a>:
<a name="l03703"></a>03703                 <span class="keywordflow">if</span> (draw_index_wire) {
<a name="l03704"></a>03704                     glVertexPointer(3, GL_FLOAT, 0, dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>);
<a name="l03705"></a>03705                     glDrawElements(GL_QUADS, 4 * dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>, GL_UNSIGNED_INT, dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a6c3c9ad7f71c3ee1a79e23af0c6cef42">index</a>);
<a name="l03706"></a>03706                 }
<a name="l03707"></a>03707                 <span class="keywordflow">break</span>;
<a name="l03708"></a>03708         }
<a name="l03709"></a>03709     }
<a name="l03710"></a>03710     
<a name="l03711"></a>03711     glDisableClientState(GL_VERTEX_ARRAY);
<a name="l03712"></a>03712     glPolygonMode(GL_FRONT_AND_BACK, GL_FILL);
<a name="l03713"></a>03713     
<a name="l03714"></a>03714     <span class="keywordflow">return</span> 0;
<a name="l03715"></a>03715 }
<a name="l03716"></a>03716 
<a name="l03717"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a013bacb15531a9b5b0c6e053ca64dc43">03717</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a013bacb15531a9b5b0c6e053ca64dc43">drawDispListsolid</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keywordtype">int</span> glsl)
<a name="l03718"></a>03718 {
<a name="l03719"></a>03719     <a class="code" href="../../d5/d2f/structDispList.html">DispList</a> *dl;
<a name="l03720"></a>03720     <a class="code" href="../../df/d4b/structGPUVertexAttribs.html">GPUVertexAttribs</a> gattribs;
<a name="l03721"></a>03721     <span class="keywordtype">float</span> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, curcol[4];
<a name="l03722"></a>03722     <span class="keywordtype">float</span> *ndata;
<a name="l03723"></a>03723     
<a name="l03724"></a>03724     <span class="keywordflow">if</span> (lb == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l03725"></a>03725     
<a name="l03726"></a>03726     <span class="comment">/* for drawing wire */</span>
<a name="l03727"></a>03727     glGetFloatv(GL_CURRENT_COLOR, curcol);
<a name="l03728"></a>03728 
<a name="l03729"></a>03729     glEnable(GL_LIGHTING);
<a name="l03730"></a>03730     glEnableClientState(GL_VERTEX_ARRAY);
<a name="l03731"></a>03731     
<a name="l03732"></a>03732     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1091cd84d4d7227ab41b167e84be3065">transflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a87014edc673c17c72d0cf437921da147">OB_NEG_SCALE</a>) glFrontFace(GL_CW);
<a name="l03733"></a>03733     <span class="keywordflow">else</span> glFrontFace(GL_CCW);
<a name="l03734"></a>03734     
<a name="l03735"></a>03735     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a046d883c32490b5c5ca4c5e7b6504e35">OB_MBALL</a>) {   <span class="comment">// mball always smooth shaded</span>
<a name="l03736"></a>03736         glShadeModel(GL_SMOOTH);
<a name="l03737"></a>03737     }
<a name="l03738"></a>03738     
<a name="l03739"></a>03739     dl = lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03740"></a>03740     <span class="keywordflow">while</span> (dl) {
<a name="l03741"></a>03741         data = dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>;
<a name="l03742"></a>03742         ndata = dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#aa979db9e4f514999a21f547dab4caa19">nors</a>;
<a name="l03743"></a>03743 
<a name="l03744"></a>03744         <span class="keywordflow">switch</span> (dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a14a8a66c424ba6ecb972e49847b61483">type</a>) {
<a name="l03745"></a>03745             <span class="keywordflow">case</span> <a class="code" href="../../d9/d12/BKE__displist_8h.html#ad298e077cdc5f0f6e4d4060fbb08618c">DL_SEGM</a>:
<a name="l03746"></a>03746                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>) {
<a name="l03747"></a>03747                     <span class="keywordtype">int</span> nr;
<a name="l03748"></a>03748 
<a name="l03749"></a>03749                     glDisable(GL_LIGHTING);
<a name="l03750"></a>03750                     glColor3fv(curcol);
<a name="l03751"></a>03751 
<a name="l03752"></a>03752                     <span class="comment">// glVertexPointer(3, GL_FLOAT, 0, dl-&gt;verts);</span>
<a name="l03753"></a>03753                     <span class="comment">// glDrawArrays(GL_LINE_STRIP, 0, dl-&gt;nr);</span>
<a name="l03754"></a>03754 
<a name="l03755"></a>03755                     glBegin(GL_LINE_STRIP);
<a name="l03756"></a>03756                     <span class="keywordflow">for</span> (nr = dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>; nr; nr--, data += 3)
<a name="l03757"></a>03757                         glVertex3fv(data);
<a name="l03758"></a>03758                     glEnd();
<a name="l03759"></a>03759 
<a name="l03760"></a>03760                     glEnable(GL_LIGHTING);
<a name="l03761"></a>03761                 }
<a name="l03762"></a>03762                 <span class="keywordflow">break</span>;
<a name="l03763"></a>03763             <span class="keywordflow">case</span> <a class="code" href="../../d9/d12/BKE__displist_8h.html#a0402654c17f3e8795c9d987a25b83c6f">DL_POLY</a>:
<a name="l03764"></a>03764                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>) {
<a name="l03765"></a>03765                     <span class="keywordtype">int</span> nr;
<a name="l03766"></a>03766 
<a name="l03767"></a>03767                     glDisable(GL_LIGHTING);
<a name="l03768"></a>03768 
<a name="l03769"></a>03769                     <span class="comment">/* for some reason glDrawArrays crashes here in half of the platforms (not osx) */</span>
<a name="l03770"></a>03770                     <span class="comment">//glVertexPointer(3, GL_FLOAT, 0, dl-&gt;verts);</span>
<a name="l03771"></a>03771                     <span class="comment">//glDrawArrays(GL_LINE_LOOP, 0, dl-&gt;nr);</span>
<a name="l03772"></a>03772 
<a name="l03773"></a>03773                     glBegin(GL_LINE_LOOP);
<a name="l03774"></a>03774                     <span class="keywordflow">for</span> (nr = dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>; nr; nr--, data += 3)
<a name="l03775"></a>03775                         glVertex3fv(data);
<a name="l03776"></a>03776                     glEnd();
<a name="l03777"></a>03777 
<a name="l03778"></a>03778                     glEnable(GL_LIGHTING);
<a name="l03779"></a>03779                     <span class="keywordflow">break</span>;
<a name="l03780"></a>03780                 }
<a name="l03781"></a>03781             <span class="keywordflow">case</span> <a class="code" href="../../d9/d12/BKE__displist_8h.html#aa264a2c12f3c058a0b62f7ea6dccbefa">DL_SURF</a>:
<a name="l03782"></a>03782 
<a name="l03783"></a>03783                 <span class="keywordflow">if</span> (dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a6c3c9ad7f71c3ee1a79e23af0c6cef42">index</a>) {
<a name="l03784"></a>03784                     <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>(dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a2a8fc9734898234863f4a432e05233ec">col</a> + 1, (glsl) ? &amp;gattribs : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03785"></a>03785 
<a name="l03786"></a>03786                     <span class="keywordflow">if</span> (dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a8455b7d194d33c1c0868c7bfe946189f">rt</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a52776b893e7d78f3276b98e0b9f56cc1">CU_SMOOTH</a>) glShadeModel(GL_SMOOTH);
<a name="l03787"></a>03787                     <span class="keywordflow">else</span> glShadeModel(GL_FLAT);
<a name="l03788"></a>03788 
<a name="l03789"></a>03789                     glEnableClientState(GL_NORMAL_ARRAY);
<a name="l03790"></a>03790                     glVertexPointer(3, GL_FLOAT, 0, dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>);
<a name="l03791"></a>03791                     glNormalPointer(GL_FLOAT, 0, dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#aa979db9e4f514999a21f547dab4caa19">nors</a>);
<a name="l03792"></a>03792                     glDrawElements(GL_QUADS, 4 * dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a235a49e1942b571e33ecbb2ec3c696bb">totindex</a>, GL_UNSIGNED_INT, dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a6c3c9ad7f71c3ee1a79e23af0c6cef42">index</a>);
<a name="l03793"></a>03793                     glDisableClientState(GL_NORMAL_ARRAY);
<a name="l03794"></a>03794                 }
<a name="l03795"></a>03795                 <span class="keywordflow">break</span>;
<a name="l03796"></a>03796 
<a name="l03797"></a>03797             <span class="keywordflow">case</span> <a class="code" href="../../d9/d12/BKE__displist_8h.html#a8fdfde765231c4dfbe1df3f263abdd02">DL_INDEX3</a>:
<a name="l03798"></a>03798                 <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>(dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a2a8fc9734898234863f4a432e05233ec">col</a> + 1, (glsl) ? &amp;gattribs : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03799"></a>03799 
<a name="l03800"></a>03800                 glVertexPointer(3, GL_FLOAT, 0, dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>);
<a name="l03801"></a>03801 
<a name="l03802"></a>03802                 <span class="comment">/* voor polys only one normal needed */</span>
<a name="l03803"></a>03803                 <span class="keywordflow">if</span> (index3_nors_incr) {
<a name="l03804"></a>03804                     glEnableClientState(GL_NORMAL_ARRAY);
<a name="l03805"></a>03805                     glNormalPointer(GL_FLOAT, 0, dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#aa979db9e4f514999a21f547dab4caa19">nors</a>);
<a name="l03806"></a>03806                 }
<a name="l03807"></a>03807                 <span class="keywordflow">else</span>
<a name="l03808"></a>03808                     glNormal3fv(ndata);
<a name="l03809"></a>03809 
<a name="l03810"></a>03810                 glDrawElements(GL_TRIANGLES, 3 * dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>, GL_UNSIGNED_INT, dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a6c3c9ad7f71c3ee1a79e23af0c6cef42">index</a>);
<a name="l03811"></a>03811 
<a name="l03812"></a>03812                 <span class="keywordflow">if</span> (index3_nors_incr)
<a name="l03813"></a>03813                     glDisableClientState(GL_NORMAL_ARRAY);
<a name="l03814"></a>03814 
<a name="l03815"></a>03815                 <span class="keywordflow">break</span>;
<a name="l03816"></a>03816 
<a name="l03817"></a>03817             <span class="keywordflow">case</span> <a class="code" href="../../d9/d12/BKE__displist_8h.html#ac31985d3494fb5bb0f23b72f1cc28487">DL_INDEX4</a>:
<a name="l03818"></a>03818                 <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>(dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a2a8fc9734898234863f4a432e05233ec">col</a> + 1, (glsl) ? &amp;gattribs : NULL);
<a name="l03819"></a>03819 
<a name="l03820"></a>03820                 glEnableClientState(GL_NORMAL_ARRAY);
<a name="l03821"></a>03821                 glVertexPointer(3, GL_FLOAT, 0, dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>);
<a name="l03822"></a>03822                 glNormalPointer(GL_FLOAT, 0, dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#aa979db9e4f514999a21f547dab4caa19">nors</a>);
<a name="l03823"></a>03823                 glDrawElements(GL_QUADS, 4 * dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>, GL_UNSIGNED_INT, dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a6c3c9ad7f71c3ee1a79e23af0c6cef42">index</a>);
<a name="l03824"></a>03824                 glDisableClientState(GL_NORMAL_ARRAY);
<a name="l03825"></a>03825 
<a name="l03826"></a>03826                 <span class="keywordflow">break</span>;
<a name="l03827"></a>03827         }
<a name="l03828"></a>03828         dl = dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a902acb76b3f3a2b20b0c9f755c652bf9">next</a>;
<a name="l03829"></a>03829     }
<a name="l03830"></a>03830 
<a name="l03831"></a>03831     glDisableClientState(GL_VERTEX_ARRAY);
<a name="l03832"></a>03832     glShadeModel(GL_FLAT);
<a name="l03833"></a>03833     glDisable(GL_LIGHTING);
<a name="l03834"></a>03834     glFrontFace(GL_CCW);
<a name="l03835"></a>03835 }
<a name="l03836"></a>03836 
<a name="l03837"></a><a class="code" href="../../d3/d02/drawobject_8c.html#aa79d0bdf6ad739f24406022777dc73ec">03837</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#aa79d0bdf6ad739f24406022777dc73ec">drawCurveDMWired</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l03838"></a>03838 {
<a name="l03839"></a>03839     <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a90f2cb67625caff2124e0675ea32510d">derivedFinal</a>;
<a name="l03840"></a>03840     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a05d1c2b6c7c1eff4fdf4fdb973bbba5c">drawEdges</a>(dm, 1, 0);
<a name="l03841"></a>03841 }
<a name="l03842"></a>03842 
<a name="l03843"></a>03843 <span class="comment">/* return 1 when nothing was drawn */</span>
<a name="l03844"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ac701405e176e83d0b6a7067e2a78cd9e">03844</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ac701405e176e83d0b6a7067e2a78cd9e">drawCurveDerivedMesh</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d, <a class="code" href="../../d3/da9/structBase.html">Base</a> *base, <span class="keywordtype">int</span> dt)
<a name="l03845"></a>03845 {
<a name="l03846"></a>03846     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l03847"></a>03847     <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a90f2cb67625caff2124e0675ea32510d">derivedFinal</a>;
<a name="l03848"></a>03848 
<a name="l03849"></a>03849     <span class="keywordflow">if</span> (!dm) {
<a name="l03850"></a>03850         <span class="keywordflow">return</span> 1;
<a name="l03851"></a>03851     }
<a name="l03852"></a>03852 
<a name="l03853"></a>03853     <span class="keywordflow">if</span> (dt &gt; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a> &amp;&amp; dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a3481fefe300b7d6b456071320be70c56">getNumTessFaces</a>(dm)) {
<a name="l03854"></a>03854         <span class="keywordtype">int</span> glsl = <a class="code" href="../../d3/d02/drawobject_8c.html#aca409cda616fd2a1eb6eb2dc5b124fac">draw_glsl_material</a>(scene, ob, v3d, dt);
<a name="l03855"></a>03855         <a class="code" href="../../d3/df0/GPU__draw_8h.html#a298d978884494b64b6a783903350e2f6">GPU_begin_object_materials</a>(v3d, rv3d, scene, ob, glsl, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03856"></a>03856 
<a name="l03857"></a>03857         <span class="keywordflow">if</span> (!glsl) {
<a name="l03858"></a>03858             glEnable(GL_LIGHTING);
<a name="l03859"></a>03859             dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#ae8847d132e3b89911b0ee999b3843b95">drawFacesSolid</a>(dm, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>);
<a name="l03860"></a>03860             glDisable(GL_LIGHTING);
<a name="l03861"></a>03861         }
<a name="l03862"></a>03862         <span class="keywordflow">else</span>
<a name="l03863"></a>03863             dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a9842d837891900256f008bbc3b47baab">drawFacesGLSL</a>(dm, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>);
<a name="l03864"></a>03864 
<a name="l03865"></a>03865         <a class="code" href="../../d3/df0/GPU__draw_8h.html#ac05a8ea057e161f6f5cc5c38a394a3e3">GPU_end_object_materials</a>();
<a name="l03866"></a>03866     }
<a name="l03867"></a>03867     <span class="keywordflow">else</span> {
<a name="l03868"></a>03868         <span class="keywordflow">if</span> (((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) &amp;&amp; v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a591cd4c57e5a79352f6733f6fa2bc1c9">drawtype</a> &gt;= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a02098d23ce96d480e90882bed52cb89d">OB_SOLID</a>) == 0)
<a name="l03869"></a>03869             <a class="code" href="../../d3/d02/drawobject_8c.html#aa79d0bdf6ad739f24406022777dc73ec">drawCurveDMWired</a>(ob);
<a name="l03870"></a>03870     }
<a name="l03871"></a>03871 
<a name="l03872"></a>03872     <span class="keywordflow">return</span> 0;
<a name="l03873"></a>03873 }
<a name="l03874"></a>03874 
<a name="l03875"></a>03875 <span class="comment">/* returns 1 when nothing was drawn */</span>
<a name="l03876"></a><a class="code" href="../../d3/d02/drawobject_8c.html#af97e16e51d66bbc843bc1b5cfaa449bd">03876</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d02/drawobject_8c.html#af97e16e51d66bbc843bc1b5cfaa449bd">drawDispList</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d, <a class="code" href="../../d3/da9/structBase.html">Base</a> *base, <span class="keywordtype">int</span> dt)
<a name="l03877"></a>03877 {
<a name="l03878"></a>03878     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l03879"></a>03879     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03880"></a>03880     <a class="code" href="../../d5/d2f/structDispList.html">DispList</a> *dl;
<a name="l03881"></a>03881     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu;
<a name="l03882"></a>03882     <span class="keyword">const</span> <span class="keywordtype">short</span> render_only = (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>);
<a name="l03883"></a>03883     <span class="keyword">const</span> <span class="keywordtype">short</span> solid = (dt &gt; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>);
<a name="l03884"></a>03884     <span class="keywordtype">int</span> retval = 0;
<a name="l03885"></a>03885 
<a name="l03886"></a>03886     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d02/drawobject_8c.html#ac701405e176e83d0b6a7067e2a78cd9e">drawCurveDerivedMesh</a>(scene, v3d, rv3d, base, dt) == 0) {
<a name="l03887"></a>03887         <span class="keywordflow">return</span> 0;
<a name="l03888"></a>03888     }
<a name="l03889"></a>03889 
<a name="l03890"></a>03890     <span class="keywordflow">switch</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>) {
<a name="l03891"></a>03891         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1a94162b6fc469957966a01d41ff71d6">OB_FONT</a>:
<a name="l03892"></a>03892         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>:
<a name="l03893"></a>03893             cu = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l03894"></a>03894 
<a name="l03895"></a>03895             lb = &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a45d11e4826c3a8ba292c91691bb2885d">disp</a>;
<a name="l03896"></a>03896 
<a name="l03897"></a>03897             <span class="keywordflow">if</span> (solid) {
<a name="l03898"></a>03898                 dl = lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03899"></a>03899                 <span class="keywordflow">if</span> (dl == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> 1;
<a name="l03900"></a>03900 
<a name="l03901"></a>03901                 <span class="keywordflow">if</span> (dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#aa979db9e4f514999a21f547dab4caa19">nors</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <a class="code" href="../../d9/d12/BKE__displist_8h.html#a342521949193a88a94f52197edb28385">addnormalsDispList</a>(lb);
<a name="l03902"></a>03902                 index3_nors_incr = 0;
<a name="l03903"></a>03903 
<a name="l03904"></a>03904                 <span class="keywordflow">if</span> (<a class="code" href="../../d9/d12/BKE__displist_8h.html#a07032f2f6e32a6dd4ba044825c5d925e">displist_has_faces</a>(lb) == 0) {
<a name="l03905"></a>03905                     <span class="keywordflow">if</span> (!render_only) {
<a name="l03906"></a>03906                         draw_index_wire = 0;
<a name="l03907"></a>03907                         <a class="code" href="../../d3/d02/drawobject_8c.html#aae58e1c67b48d497a097d5d021d59244">drawDispListwire</a>(lb);
<a name="l03908"></a>03908                         draw_index_wire = 1;
<a name="l03909"></a>03909                     }
<a name="l03910"></a>03910                 }
<a name="l03911"></a>03911                 <span class="keywordflow">else</span> {
<a name="l03912"></a>03912                     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d02/drawobject_8c.html#aca409cda616fd2a1eb6eb2dc5b124fac">draw_glsl_material</a>(scene, ob, v3d, dt)) {
<a name="l03913"></a>03913                         <a class="code" href="../../d3/df0/GPU__draw_8h.html#a298d978884494b64b6a783903350e2f6">GPU_begin_object_materials</a>(v3d, rv3d, scene, ob, 1, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03914"></a>03914                         <a class="code" href="../../d3/d02/drawobject_8c.html#a013bacb15531a9b5b0c6e053ca64dc43">drawDispListsolid</a>(lb, ob, 1);
<a name="l03915"></a>03915                         <a class="code" href="../../d3/df0/GPU__draw_8h.html#ac05a8ea057e161f6f5cc5c38a394a3e3">GPU_end_object_materials</a>();
<a name="l03916"></a>03916                     }
<a name="l03917"></a>03917                     <span class="keywordflow">else</span> {
<a name="l03918"></a>03918                         <a class="code" href="../../d3/df0/GPU__draw_8h.html#a298d978884494b64b6a783903350e2f6">GPU_begin_object_materials</a>(v3d, rv3d, scene, ob, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03919"></a>03919                         <a class="code" href="../../d3/d02/drawobject_8c.html#a013bacb15531a9b5b0c6e053ca64dc43">drawDispListsolid</a>(lb, ob, 0);
<a name="l03920"></a>03920                         <a class="code" href="../../d3/df0/GPU__draw_8h.html#ac05a8ea057e161f6f5cc5c38a394a3e3">GPU_end_object_materials</a>();
<a name="l03921"></a>03921                     }
<a name="l03922"></a>03922                     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a> &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0051539d4e4be6831fed5babb371b19b">bevobj</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#aee5423fad7444492028435713c64be0f">taperobj</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a22c6cd81bc29dbb30accecc67979e587">ext1</a> == 0.0f &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#add39d47101587c286cd77e2045bc9129">ext2</a> == 0.0f) {
<a name="l03923"></a>03923                         <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(0);
<a name="l03924"></a>03924                         draw_index_wire = 0;
<a name="l03925"></a>03925                         <a class="code" href="../../d3/d02/drawobject_8c.html#aae58e1c67b48d497a097d5d021d59244">drawDispListwire</a>(lb);
<a name="l03926"></a>03926                         draw_index_wire = 1;
<a name="l03927"></a>03927                     }
<a name="l03928"></a>03928                 }
<a name="l03929"></a>03929                 index3_nors_incr = 1;
<a name="l03930"></a>03930             }
<a name="l03931"></a>03931             <span class="keywordflow">else</span> {
<a name="l03932"></a>03932                 <span class="keywordflow">if</span> (!render_only || (render_only &amp;&amp; <a class="code" href="../../d9/d12/BKE__displist_8h.html#a07032f2f6e32a6dd4ba044825c5d925e">displist_has_faces</a>(lb))) {
<a name="l03933"></a>03933                     draw_index_wire = 0;
<a name="l03934"></a>03934                     retval = <a class="code" href="../../d3/d02/drawobject_8c.html#aae58e1c67b48d497a097d5d021d59244">drawDispListwire</a>(lb);
<a name="l03935"></a>03935                     draw_index_wire = 1;
<a name="l03936"></a>03936                 }
<a name="l03937"></a>03937             }
<a name="l03938"></a>03938             <span class="keywordflow">break</span>;
<a name="l03939"></a>03939         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>:
<a name="l03940"></a>03940 
<a name="l03941"></a>03941             lb = &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a45d11e4826c3a8ba292c91691bb2885d">disp</a>;
<a name="l03942"></a>03942 
<a name="l03943"></a>03943             <span class="keywordflow">if</span> (solid) {
<a name="l03944"></a>03944                 dl = lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03945"></a>03945                 <span class="keywordflow">if</span> (dl == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> 1;
<a name="l03946"></a>03946 
<a name="l03947"></a>03947                 <span class="keywordflow">if</span> (dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#aa979db9e4f514999a21f547dab4caa19">nors</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <a class="code" href="../../d9/d12/BKE__displist_8h.html#a342521949193a88a94f52197edb28385">addnormalsDispList</a>(lb);
<a name="l03948"></a>03948 
<a name="l03949"></a>03949                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d02/drawobject_8c.html#aca409cda616fd2a1eb6eb2dc5b124fac">draw_glsl_material</a>(scene, ob, v3d, dt)) {
<a name="l03950"></a>03950                     <a class="code" href="../../d3/df0/GPU__draw_8h.html#a298d978884494b64b6a783903350e2f6">GPU_begin_object_materials</a>(v3d, rv3d, scene, ob, 1, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03951"></a>03951                     <a class="code" href="../../d3/d02/drawobject_8c.html#a013bacb15531a9b5b0c6e053ca64dc43">drawDispListsolid</a>(lb, ob, 1);
<a name="l03952"></a>03952                     <a class="code" href="../../d3/df0/GPU__draw_8h.html#ac05a8ea057e161f6f5cc5c38a394a3e3">GPU_end_object_materials</a>();
<a name="l03953"></a>03953                 }
<a name="l03954"></a>03954                 <span class="keywordflow">else</span> {
<a name="l03955"></a>03955                     <a class="code" href="../../d3/df0/GPU__draw_8h.html#a298d978884494b64b6a783903350e2f6">GPU_begin_object_materials</a>(v3d, rv3d, scene, ob, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03956"></a>03956                     <a class="code" href="../../d3/d02/drawobject_8c.html#a013bacb15531a9b5b0c6e053ca64dc43">drawDispListsolid</a>(lb, ob, 0);
<a name="l03957"></a>03957                     <a class="code" href="../../d3/df0/GPU__draw_8h.html#ac05a8ea057e161f6f5cc5c38a394a3e3">GPU_end_object_materials</a>();
<a name="l03958"></a>03958                 }
<a name="l03959"></a>03959             }
<a name="l03960"></a>03960             <span class="keywordflow">else</span> {
<a name="l03961"></a>03961                 retval = <a class="code" href="../../d3/d02/drawobject_8c.html#aae58e1c67b48d497a097d5d021d59244">drawDispListwire</a>(lb);
<a name="l03962"></a>03962             }
<a name="l03963"></a>03963             <span class="keywordflow">break</span>;
<a name="l03964"></a>03964         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a046d883c32490b5c5ca4c5e7b6504e35">OB_MBALL</a>:
<a name="l03965"></a>03965 
<a name="l03966"></a>03966             <span class="keywordflow">if</span> (<a class="code" href="../../df/dae/BKE__mball_8h.html#ac35c80651b886132c4740f3296b84f0e" title="Test, if Object *ob is basic MetaBall.">is_basis_mball</a>(ob)) {
<a name="l03967"></a>03967                 lb = &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a45d11e4826c3a8ba292c91691bb2885d">disp</a>;
<a name="l03968"></a>03968                 <span class="keywordflow">if</span> (lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <a class="code" href="../../d9/d12/BKE__displist_8h.html#a9915c0524464b04d2d03084c6fa87b3f">makeDispListMBall</a>(scene, ob);
<a name="l03969"></a>03969                 <span class="keywordflow">if</span> (lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> 1;
<a name="l03970"></a>03970 
<a name="l03971"></a>03971                 <span class="keywordflow">if</span> (solid) {
<a name="l03972"></a>03972 
<a name="l03973"></a>03973                     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d02/drawobject_8c.html#aca409cda616fd2a1eb6eb2dc5b124fac">draw_glsl_material</a>(scene, ob, v3d, dt)) {
<a name="l03974"></a>03974                         <a class="code" href="../../d3/df0/GPU__draw_8h.html#a298d978884494b64b6a783903350e2f6">GPU_begin_object_materials</a>(v3d, rv3d, scene, ob, 1, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03975"></a>03975                         <a class="code" href="../../d3/d02/drawobject_8c.html#a013bacb15531a9b5b0c6e053ca64dc43">drawDispListsolid</a>(lb, ob, 1);
<a name="l03976"></a>03976                         <a class="code" href="../../d3/df0/GPU__draw_8h.html#ac05a8ea057e161f6f5cc5c38a394a3e3">GPU_end_object_materials</a>();
<a name="l03977"></a>03977                     }
<a name="l03978"></a>03978                     <span class="keywordflow">else</span> {
<a name="l03979"></a>03979                         <a class="code" href="../../d3/df0/GPU__draw_8h.html#a298d978884494b64b6a783903350e2f6">GPU_begin_object_materials</a>(v3d, rv3d, scene, ob, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03980"></a>03980                         <a class="code" href="../../d3/d02/drawobject_8c.html#a013bacb15531a9b5b0c6e053ca64dc43">drawDispListsolid</a>(lb, ob, 0);
<a name="l03981"></a>03981                         <a class="code" href="../../d3/df0/GPU__draw_8h.html#ac05a8ea057e161f6f5cc5c38a394a3e3">GPU_end_object_materials</a>();
<a name="l03982"></a>03982                     }
<a name="l03983"></a>03983                 }
<a name="l03984"></a>03984                 <span class="keywordflow">else</span> {
<a name="l03985"></a>03985                     <span class="comment">/* MetaBalls use DL_INDEX4 type of DispList */</span>
<a name="l03986"></a>03986                     retval = <a class="code" href="../../d3/d02/drawobject_8c.html#aae58e1c67b48d497a097d5d021d59244">drawDispListwire</a>(lb);
<a name="l03987"></a>03987                 }
<a name="l03988"></a>03988             }
<a name="l03989"></a>03989             <span class="keywordflow">break</span>;
<a name="l03990"></a>03990     }
<a name="l03991"></a>03991     
<a name="l03992"></a>03992     <span class="keywordflow">return</span> retval;
<a name="l03993"></a>03993 }
<a name="l03994"></a>03994 
<a name="l03995"></a>03995 <span class="comment">/* *********** drawing for particles ************* */</span>
<a name="l03996"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a3ad015ec004b96640fb684e3c849de1b">03996</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a3ad015ec004b96640fb684e3c849de1b">draw_particle_arrays</a>(<span class="keywordtype">int</span> draw_as, <span class="keywordtype">int</span> totpoint, <span class="keywordtype">int</span> ob_dt, <span class="keywordtype">int</span> select)
<a name="l03997"></a>03997 {
<a name="l03998"></a>03998     <span class="comment">/* draw created data arrays */</span>
<a name="l03999"></a>03999     <span class="keywordflow">switch</span> (draw_as) {
<a name="l04000"></a>04000         <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a69b6e4f9d6a791f38ac00ad17bee796b">PART_DRAW_AXIS</a>:
<a name="l04001"></a>04001         <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ab18d745f282ec3533bbeeedf935ce63c">PART_DRAW_CROSS</a>:
<a name="l04002"></a>04002             glDrawArrays(GL_LINES, 0, 6 * totpoint);
<a name="l04003"></a>04003             <span class="keywordflow">break</span>;
<a name="l04004"></a>04004         <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0095bb5a5fb10ba1e61d296723c451ff">PART_DRAW_LINE</a>:
<a name="l04005"></a>04005             glDrawArrays(GL_LINES, 0, 2 * totpoint);
<a name="l04006"></a>04006             <span class="keywordflow">break</span>;
<a name="l04007"></a>04007         <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ae46a1d9cf35516920db6554623ff6369">PART_DRAW_BB</a>:
<a name="l04008"></a>04008             <span class="keywordflow">if</span> (ob_dt &lt;= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a> || select)
<a name="l04009"></a>04009                 glPolygonMode(GL_FRONT_AND_BACK, GL_LINE);
<a name="l04010"></a>04010             <span class="keywordflow">else</span>
<a name="l04011"></a>04011                 glPolygonMode(GL_FRONT_AND_BACK, GL_FILL);
<a name="l04012"></a>04012 
<a name="l04013"></a>04013             glDrawArrays(GL_QUADS, 0, 4 * totpoint);
<a name="l04014"></a>04014             <span class="keywordflow">break</span>;
<a name="l04015"></a>04015         <span class="keywordflow">default</span>:
<a name="l04016"></a>04016             glDrawArrays(GL_POINTS, 0, totpoint);
<a name="l04017"></a>04017             <span class="keywordflow">break</span>;
<a name="l04018"></a>04018     }
<a name="l04019"></a>04019 }
<a name="l04020"></a><a class="code" href="../../d3/d02/drawobject_8c.html#aa285505a18bbe068f67d3c4a2727561a">04020</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#aa285505a18bbe068f67d3c4a2727561a">draw_particle</a>(<a class="code" href="../../d3/d31/structParticleKey.html">ParticleKey</a> *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>, <span class="keywordtype">int</span> draw_as, <span class="keywordtype">short</span> draw, <span class="keywordtype">float</span> pixsize,
<a name="l04021"></a>04021                           <span class="keywordtype">float</span> imat[4][4], <span class="keywordtype">float</span> *draw_line, <a class="code" href="../../d0/d06/structParticleBillboardData.html">ParticleBillboardData</a> *bb, <a class="code" href="../../d0/df1/structParticleDrawData.html">ParticleDrawData</a> *pdd)
<a name="l04022"></a>04022 {
<a name="l04023"></a>04023     <span class="keywordtype">float</span> vec[3], vec2[3];
<a name="l04024"></a>04024     <span class="keywordtype">float</span> *vd = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04025"></a>04025     <span class="keywordtype">float</span> *cd = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04026"></a>04026     <span class="keywordtype">float</span> ma_col[3] = {0.0f, 0.0f, 0.0f};
<a name="l04027"></a>04027 
<a name="l04028"></a>04028     <span class="comment">/* null only for PART_DRAW_CIRC */</span>
<a name="l04029"></a>04029     <span class="keywordflow">if</span> (pdd) {
<a name="l04030"></a>04030         vd = pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a>;
<a name="l04031"></a>04031         cd = pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a20037b2bfc1c3ba01a053a8b63ae021d">cd</a>;
<a name="l04032"></a>04032 
<a name="l04033"></a>04033         <span class="keywordflow">if</span> (pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a2ca51ba90921eb169d1a30281dd9169a">ma_col</a>) {
<a name="l04034"></a>04034             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(ma_col, pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a2ca51ba90921eb169d1a30281dd9169a">ma_col</a>);
<a name="l04035"></a>04035         }
<a name="l04036"></a>04036     }
<a name="l04037"></a>04037 
<a name="l04038"></a>04038     <span class="keywordflow">switch</span> (draw_as) {
<a name="l04039"></a>04039         <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0549eb50419f4612e9ac387e304fbfbf">PART_DRAW_DOT</a>:
<a name="l04040"></a>04040         {
<a name="l04041"></a>04041             <span class="keywordflow">if</span> (vd) {
<a name="l04042"></a>04042                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vd, state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>); pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a> += 3;
<a name="l04043"></a>04043             }
<a name="l04044"></a>04044             <span class="keywordflow">if</span> (cd) {
<a name="l04045"></a>04045                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(cd, pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a2ca51ba90921eb169d1a30281dd9169a">ma_col</a>);
<a name="l04046"></a>04046                 pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a20037b2bfc1c3ba01a053a8b63ae021d">cd</a> += 3;
<a name="l04047"></a>04047             }
<a name="l04048"></a>04048             <span class="keywordflow">break</span>;
<a name="l04049"></a>04049         }
<a name="l04050"></a>04050         <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ab18d745f282ec3533bbeeedf935ce63c">PART_DRAW_CROSS</a>:
<a name="l04051"></a>04051         <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a69b6e4f9d6a791f38ac00ad17bee796b">PART_DRAW_AXIS</a>:
<a name="l04052"></a>04052         {
<a name="l04053"></a>04053             vec[0] = 2.0f * pixsize;
<a name="l04054"></a>04054             vec[1] = vec[2] = 0.0;
<a name="l04055"></a>04055             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a654dd0df4df6f960e592032f276f2c68">mul_qt_v3</a>(state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a33ddd3b5915822847448bee82089feea">rot</a>, vec);
<a name="l04056"></a>04056             <span class="keywordflow">if</span> (draw_as == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a69b6e4f9d6a791f38ac00ad17bee796b">PART_DRAW_AXIS</a>) {
<a name="l04057"></a>04057                 <span class="keywordflow">if</span> (cd) {
<a name="l04058"></a>04058                     cd[1] = cd[2] = cd[4] = cd[5] = 0.0;
<a name="l04059"></a>04059                     cd[0] = cd[3] = 1.0;
<a name="l04060"></a>04060                     cd[6] = cd[8] = cd[9] = cd[11] = 0.0;
<a name="l04061"></a>04061                     cd[7] = cd[10] = 1.0;
<a name="l04062"></a>04062                     cd[13] = cd[12] = cd[15] = cd[16] = 0.0;
<a name="l04063"></a>04063                     cd[14] = cd[17] = 1.0;
<a name="l04064"></a>04064                     pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a20037b2bfc1c3ba01a053a8b63ae021d">cd</a> += 18;
<a name="l04065"></a>04065                 }
<a name="l04066"></a>04066 
<a name="l04067"></a>04067                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec2, state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>);
<a name="l04068"></a>04068             }
<a name="l04069"></a>04069             <span class="keywordflow">else</span> {
<a name="l04070"></a>04070                 <span class="keywordflow">if</span> (cd) {
<a name="l04071"></a>04071                     cd[0] = cd[3] = cd[6] = cd[9] = cd[12] = cd[15] = ma_col[0];
<a name="l04072"></a>04072                     cd[1] = cd[4] = cd[7] = cd[10] = cd[13] = cd[16] = ma_col[1];
<a name="l04073"></a>04073                     cd[2] = cd[5] = cd[8] = cd[11] = cd[14] = cd[17] = ma_col[2];
<a name="l04074"></a>04074                     pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a20037b2bfc1c3ba01a053a8b63ae021d">cd</a> += 18;
<a name="l04075"></a>04075                 }
<a name="l04076"></a>04076                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(vec2, state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>, vec);
<a name="l04077"></a>04077             }
<a name="l04078"></a>04078 
<a name="l04079"></a>04079             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(vec, state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>);
<a name="l04080"></a>04080             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a>, vec); pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a> += 3;
<a name="l04081"></a>04081             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a>, vec2); pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a> += 3;
<a name="l04082"></a>04082 
<a name="l04083"></a>04083             vec[1] = 2.0f * pixsize;
<a name="l04084"></a>04084             vec[0] = vec[2] = 0.0;
<a name="l04085"></a>04085             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a654dd0df4df6f960e592032f276f2c68">mul_qt_v3</a>(state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a33ddd3b5915822847448bee82089feea">rot</a>, vec);
<a name="l04086"></a>04086             <span class="keywordflow">if</span> (draw_as == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a69b6e4f9d6a791f38ac00ad17bee796b">PART_DRAW_AXIS</a>) {
<a name="l04087"></a>04087                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec2, state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>);
<a name="l04088"></a>04088             }
<a name="l04089"></a>04089             <span class="keywordflow">else</span> <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(vec2, state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>, vec);
<a name="l04090"></a>04090 
<a name="l04091"></a>04091             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(vec, state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>);
<a name="l04092"></a>04092             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a>, vec); pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a> += 3;
<a name="l04093"></a>04093             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a>, vec2); pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a> += 3;
<a name="l04094"></a>04094 
<a name="l04095"></a>04095             vec[2] = 2.0f * pixsize;
<a name="l04096"></a>04096             vec[0] = vec[1] = 0.0;
<a name="l04097"></a>04097             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a654dd0df4df6f960e592032f276f2c68">mul_qt_v3</a>(state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a33ddd3b5915822847448bee82089feea">rot</a>, vec);
<a name="l04098"></a>04098             <span class="keywordflow">if</span> (draw_as == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a69b6e4f9d6a791f38ac00ad17bee796b">PART_DRAW_AXIS</a>) {
<a name="l04099"></a>04099                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec2, state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>);
<a name="l04100"></a>04100             }
<a name="l04101"></a>04101             <span class="keywordflow">else</span> <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(vec2, state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>, vec);
<a name="l04102"></a>04102 
<a name="l04103"></a>04103             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(vec, state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>);
<a name="l04104"></a>04104 
<a name="l04105"></a>04105             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a>, vec); pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a> += 3;
<a name="l04106"></a>04106             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a>, vec2); pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a> += 3;
<a name="l04107"></a>04107             <span class="keywordflow">break</span>;
<a name="l04108"></a>04108         }
<a name="l04109"></a>04109         <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0095bb5a5fb10ba1e61d296723c451ff">PART_DRAW_LINE</a>:
<a name="l04110"></a>04110         {
<a name="l04111"></a>04111             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a2784ffc7a428dff13e5f031178706fee">vel</a>);
<a name="l04112"></a>04112             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(vec);
<a name="l04113"></a>04113             <span class="keywordflow">if</span> (draw &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ace6b318ca43451b7c9faca362907f3c9">PART_DRAW_VEL_LENGTH</a>)
<a name="l04114"></a>04114                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(vec, <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a2784ffc7a428dff13e5f031178706fee">vel</a>));
<a name="l04115"></a>04115             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ac993b3c38bb2d5e7de48e57aab03db7f">madd_v3_v3v3fl</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a>, state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>, vec, -draw_line[0]); pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a> += 3;
<a name="l04116"></a>04116             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ac993b3c38bb2d5e7de48e57aab03db7f">madd_v3_v3v3fl</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a>, state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>, vec,  draw_line[1]); pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a> += 3;
<a name="l04117"></a>04117             <span class="keywordflow">if</span> (cd) {
<a name="l04118"></a>04118                 cd[0] = cd[3] = ma_col[0];
<a name="l04119"></a>04119                 cd[1] = cd[4] = ma_col[1];
<a name="l04120"></a>04120                 cd[2] = cd[5] = ma_col[2];
<a name="l04121"></a>04121                 pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a20037b2bfc1c3ba01a053a8b63ae021d">cd</a> += 6;
<a name="l04122"></a>04122             }
<a name="l04123"></a>04123             <span class="keywordflow">break</span>;
<a name="l04124"></a>04124         }
<a name="l04125"></a>04125         <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ac0cdecae5f153414e343c7d1bcdc929b">PART_DRAW_CIRC</a>:
<a name="l04126"></a>04126         {
<a name="l04127"></a>04127             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>, pixsize, imat);
<a name="l04128"></a>04128             <span class="keywordflow">break</span>;
<a name="l04129"></a>04129         }
<a name="l04130"></a>04130         <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ae46a1d9cf35516920db6554623ff6369">PART_DRAW_BB</a>:
<a name="l04131"></a>04131         {
<a name="l04132"></a>04132             <span class="keywordtype">float</span> xvec[3], yvec[3], zvec[3], bb_center[3];
<a name="l04133"></a>04133             <span class="keywordflow">if</span> (cd) {
<a name="l04134"></a>04134                 cd[0] = cd[3] = cd[6] = cd[9] = ma_col[0];
<a name="l04135"></a>04135                 cd[1] = cd[4] = cd[7] = cd[10] = ma_col[1];
<a name="l04136"></a>04136                 cd[2] = cd[5] = cd[8] = cd[11] = ma_col[2];
<a name="l04137"></a>04137                 pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a20037b2bfc1c3ba01a053a8b63ae021d">cd</a> += 12;
<a name="l04138"></a>04138             }
<a name="l04139"></a>04139 
<a name="l04140"></a>04140 
<a name="l04141"></a>04141             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bb-&gt;<a class="code" href="../../d0/d06/structParticleBillboardData.html#ac5613f70bcdcefc5455ea2c4aff65f3c">vec</a>, state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>);
<a name="l04142"></a>04142             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bb-&gt;<a class="code" href="../../d0/d06/structParticleBillboardData.html#ad341449bef17e96969999a1eb2ea043a">vel</a>, state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a2784ffc7a428dff13e5f031178706fee">vel</a>);
<a name="l04143"></a>04143 
<a name="l04144"></a>04144             <a class="code" href="../../db/dca/BKE__particle_8h.html#abb28932764fe0f4944cf3e7f2eeb7314">psys_make_billboard</a>(bb, xvec, yvec, zvec, bb_center);
<a name="l04145"></a>04145             
<a name="l04146"></a>04146             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a>, bb_center, xvec);
<a name="l04147"></a>04147             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a>, yvec); pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a> += 3;
<a name="l04148"></a>04148 
<a name="l04149"></a>04149             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a>, bb_center, xvec);
<a name="l04150"></a>04150             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a>, yvec); pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a> += 3;
<a name="l04151"></a>04151 
<a name="l04152"></a>04152             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a>, bb_center, xvec);
<a name="l04153"></a>04153             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a>, pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a>, yvec); pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a> += 3;
<a name="l04154"></a>04154 
<a name="l04155"></a>04155             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a>, bb_center, xvec);
<a name="l04156"></a>04156             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a>, pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a>, yvec); pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a> += 3;
<a name="l04157"></a>04157 
<a name="l04158"></a>04158             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a6e0975697bde76254db456649bd8cfe4">nd</a>, zvec); pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a6e0975697bde76254db456649bd8cfe4">nd</a> += 3;
<a name="l04159"></a>04159             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a6e0975697bde76254db456649bd8cfe4">nd</a>, zvec); pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a6e0975697bde76254db456649bd8cfe4">nd</a> += 3;
<a name="l04160"></a>04160             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a6e0975697bde76254db456649bd8cfe4">nd</a>, zvec); pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a6e0975697bde76254db456649bd8cfe4">nd</a> += 3;
<a name="l04161"></a>04161             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a6e0975697bde76254db456649bd8cfe4">nd</a>, zvec); pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a6e0975697bde76254db456649bd8cfe4">nd</a> += 3;
<a name="l04162"></a>04162             <span class="keywordflow">break</span>;
<a name="l04163"></a>04163         }
<a name="l04164"></a>04164     }
<a name="l04165"></a>04165 }
<a name="l04166"></a>04166 <span class="comment">/* unified drawing of all new particle systems draw types except dupli ob &amp; group   */</span>
<a name="l04167"></a>04167 <span class="comment">/* mostly tries to use vertex arrays for speed                                      */</span>
<a name="l04168"></a>04168 
<a name="l04169"></a>04169 <span class="comment">/* 1. check that everything is ok &amp; updated */</span>
<a name="l04170"></a>04170 <span class="comment">/* 2. start initializing things             */</span>
<a name="l04171"></a>04171 <span class="comment">/* 3. initialize according to draw type     */</span>
<a name="l04172"></a>04172 <span class="comment">/* 4. allocate drawing data arrays          */</span>
<a name="l04173"></a>04173 <span class="comment">/* 5. start filling the arrays              */</span>
<a name="l04174"></a>04174 <span class="comment">/* 6. draw the arrays                       */</span>
<a name="l04175"></a>04175 <span class="comment">/* 7. clean up                              */</span>
<a name="l04176"></a><a class="code" href="../../d3/d02/drawobject_8c.html#afb02231621bc16c307e3029fe8e0f2aa">04176</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#afb02231621bc16c307e3029fe8e0f2aa">draw_new_particle_system</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d,
<a name="l04177"></a>04177                                      <a class="code" href="../../d3/da9/structBase.html">Base</a> *base, <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys, <span class="keywordtype">int</span> ob_dt)
<a name="l04178"></a>04178 {
<a name="l04179"></a>04179     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l04180"></a>04180     <a class="code" href="../../df/db7/structParticleEditSettings.html">ParticleEditSettings</a> *pset = <a class="code" href="../../d3/db9/ED__particle_8h.html#a86d0b6facbed912844fcc9d3d6df82f2">PE_settings</a>(scene);
<a name="l04181"></a>04181     <a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *part = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>;
<a name="l04182"></a>04182     <a class="code" href="../../dc/d76/structParticleData.html">ParticleData</a> *pars = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>;
<a name="l04183"></a>04183     <a class="code" href="../../dc/d76/structParticleData.html">ParticleData</a> *pa;
<a name="l04184"></a>04184     <a class="code" href="../../d3/d31/structParticleKey.html">ParticleKey</a> <a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>, *states = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04185"></a>04185     <a class="code" href="../../d0/d06/structParticleBillboardData.html">ParticleBillboardData</a> bb;
<a name="l04186"></a>04186     <a class="code" href="../../de/df5/structParticleSimulationData.html">ParticleSimulationData</a> sim = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l04187"></a>04187     <a class="code" href="../../d0/df1/structParticleDrawData.html">ParticleDrawData</a> *pdd = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ad87d1dfe2f606dd7a3e646c182e63e4b">pdd</a>;
<a name="l04188"></a>04188     <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma;
<a name="l04189"></a>04189     <span class="keywordtype">float</span> vel[3], imat[4][4];
<a name="l04190"></a>04190     <span class="keywordtype">float</span> timestep, pixsize_scale, pa_size, r_tilt, r_length;
<a name="l04191"></a>04191     <span class="keywordtype">float</span> pa_time, pa_birthtime, pa_dietime, pa_health, intensity;
<a name="l04192"></a>04192     <span class="keywordtype">float</span> cfra;
<a name="l04193"></a>04193     <span class="keywordtype">float</span> ma_col[3] = {0.0f, 0.0f, 0.0f};
<a name="l04194"></a>04194     <span class="keywordtype">int</span> a, totpart, totpoint = 0, totve = 0, drawn, draw_as, totchild = 0;
<a name="l04195"></a>04195     <span class="keywordtype">int</span> select = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, create_cdata = 0, need_v = 0;
<a name="l04196"></a>04196     GLint polygonmode[2];
<a name="l04197"></a>04197     <span class="keywordtype">char</span> numstr[32];
<a name="l04198"></a>04198     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> tcol[4] = {0, 0, 0, 255};
<a name="l04199"></a>04199 
<a name="l04200"></a>04200 <span class="comment">/* 1. */</span>
<a name="l04201"></a>04201     <span class="keywordflow">if</span> (part == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || !<a class="code" href="../../db/dca/BKE__particle_8h.html#ae1ec21bf7aea2fdbe47e71514b97d919">psys_check_enabled</a>(ob, psys))
<a name="l04202"></a>04202         <span class="keywordflow">return</span>;
<a name="l04203"></a>04203 
<a name="l04204"></a>04204     <span class="keywordflow">if</span> (pars == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l04205"></a>04205 
<a name="l04206"></a>04206     <span class="comment">/* don&#39;t draw normal paths in edit mode */</span>
<a name="l04207"></a>04207     <span class="keywordflow">if</span> (<a class="code" href="../../db/dca/BKE__particle_8h.html#a1c1dc6c5a0228d884482290f64e6b5cc">psys_in_edit_mode</a>(scene, psys) &amp;&amp; (pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#a3bfdff8f61248e79650bdf43d58b165c">flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a224aa3154247ad38a5722be6f641fad7">PE_DRAW_PART</a>) == 0)
<a name="l04208"></a>04208         <span class="keywordflow">return</span>;
<a name="l04209"></a>04209 
<a name="l04210"></a>04210     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a675fa9a30bd2105087a98d138c6df66c">draw_as</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a4c845dcc070e77eedb10185fc4d61d06">PART_DRAW_REND</a>)
<a name="l04211"></a>04211         draw_as = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a1a44c6ba58be14e0084b4f71c87d66a2">ren_as</a>;
<a name="l04212"></a>04212     <span class="keywordflow">else</span>
<a name="l04213"></a>04213         draw_as = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a675fa9a30bd2105087a98d138c6df66c">draw_as</a>;
<a name="l04214"></a>04214 
<a name="l04215"></a>04215     <span class="keywordflow">if</span> (draw_as == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a55688d6811f05b2d3fc30fcfe9805218">PART_DRAW_NOT</a>)
<a name="l04216"></a>04216         <span class="keywordflow">return</span>;
<a name="l04217"></a>04217 
<a name="l04218"></a>04218 <span class="comment">/* 2. */</span>
<a name="l04219"></a>04219     sim.<a class="code" href="../../de/df5/structParticleSimulationData.html#a67a1b17ea6660e168f92a49bd9a7ba9b">scene</a> = scene;
<a name="l04220"></a>04220     sim.<a class="code" href="../../de/df5/structParticleSimulationData.html#af6baa9791f72b02831c66ea185b28b62">ob</a> = ob;
<a name="l04221"></a>04221     sim.<a class="code" href="../../de/df5/structParticleSimulationData.html#a98365d240570a76067ad5d707ba70ce8">psys</a> = psys;
<a name="l04222"></a>04222     sim.<a class="code" href="../../de/df5/structParticleSimulationData.html#a470ad1081b08b55049d9036438efba8d">psmd</a> = <a class="code" href="../../db/dca/BKE__particle_8h.html#abb46b353cec8d54be258c683d352fc1d">psys_get_modifier</a>(ob, psys);
<a name="l04223"></a>04223 
<a name="l04224"></a>04224     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a4868871c1c1ba91bd42b97081be0f76a">phystype</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a04539ab17dab33b4e345164c2831a4f8">PART_PHYS_KEYED</a>) {
<a name="l04225"></a>04225         <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a947c785248ab9746099a34c8bc093e8f">flag</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a789523a2c52fbcea1f0dd066be9895d2">PSYS_KEYED</a>) {
<a name="l04226"></a>04226             <a class="code" href="../../db/dca/BKE__particle_8h.html#a367eaf7149486c4f3ef97ffc0d61b48e">psys_count_keyed_targets</a>(&amp;sim);
<a name="l04227"></a>04227             <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#acef49744834313117c45690264d06cbc">totkeyed</a> == 0)
<a name="l04228"></a>04228                 <span class="keywordflow">return</span>;
<a name="l04229"></a>04229         }
<a name="l04230"></a>04230     }
<a name="l04231"></a>04231 
<a name="l04232"></a>04232     <span class="keywordflow">if</span> (select) {
<a name="l04233"></a>04233         select = 0;
<a name="l04234"></a>04234         <span class="keywordflow">if</span> (<a class="code" href="../../db/dca/BKE__particle_8h.html#a9eae54309f86c733c9cf7f7699a1fa83">psys_get_current</a>(ob) == psys)
<a name="l04235"></a>04235             select = 1;
<a name="l04236"></a>04236     }
<a name="l04237"></a>04237 
<a name="l04238"></a>04238     psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a947c785248ab9746099a34c8bc093e8f">flag</a> |= <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a62f17f5c32eeb28429a0b04904213b75">PSYS_DRAWING</a>;
<a name="l04239"></a>04239 
<a name="l04240"></a>04240     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a3489e9807bb2c3edb363c7159234ae80">type</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#aa38c7f44b9dcf5e9889f23cfae104145">PART_HAIR</a> &amp;&amp; !psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#aa4bf1fe43162b6ea089fdd908773ec94">childcache</a>)
<a name="l04241"></a>04241         totchild = 0;
<a name="l04242"></a>04242     <span class="keywordflow">else</span>
<a name="l04243"></a>04243         totchild = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#adb71b544d204f084dc3534a9a09052e5">totchild</a> * part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae487721b04b5b6187f39a9e768d4630b">disp</a> / 100;
<a name="l04244"></a>04244 
<a name="l04245"></a>04245     ma = <a class="code" href="../../d4/d0f/BKE__material_8h.html#a941f5112d1047bcbcf3e2212685296a5">give_current_material</a>(ob, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a8d022766b802cfbac21330d486f89469">omat</a>);
<a name="l04246"></a>04246 
<a name="l04247"></a>04247     <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#afd443bfd0de5169661f08aa1eeb3bd69">zbuf</a>) glDepthMask(1);
<a name="l04248"></a>04248 
<a name="l04249"></a>04249     <span class="keywordflow">if</span> ((ma) &amp;&amp; (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a65933dbeb37c2a6658e3f158ec5da55a">draw_col</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a10e629306107732d61df2eb2d590af87">PART_DRAW_COL_MAT</a>)) {
<a name="l04250"></a>04250         <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a9b3bb8bb3331550782244e732cd1d349">rgb_float_to_uchar</a>(tcol, &amp;(ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a9e892cbd7e25b6fd5ee00c383cd9cacf">r</a>));
<a name="l04251"></a>04251         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(ma_col, &amp;ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a9e892cbd7e25b6fd5ee00c383cd9cacf">r</a>);
<a name="l04252"></a>04252     }
<a name="l04253"></a>04253 
<a name="l04254"></a>04254     glColor3ubv(tcol);
<a name="l04255"></a>04255 
<a name="l04256"></a>04256     timestep = <a class="code" href="../../db/dca/BKE__particle_8h.html#a75c75a40fcacfa5cb9e05638d6e823ad">psys_get_timestep</a>(&amp;sim);
<a name="l04257"></a>04257 
<a name="l04258"></a>04258     <span class="keywordflow">if</span> ( (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ac31d50d415c660a44c0ccdc6b4854721">OB_FROMDUPLI</a>) &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9588748603be4778a9197f7edbf356d4">OB_FROMGROUP</a>) ) {
<a name="l04259"></a>04259         <span class="keywordtype">float</span> mat[4][4];
<a name="l04260"></a>04260         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ae41a59d6db4a10a85f8fbf1e3842ba81">mult_m4_m4m4</a>(mat, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a365fda1e3579186b77768df8dfbd00ed">imat</a>);
<a name="l04261"></a>04261         <a class="code" href="../../dd/d44/BIF__gl_8h.html#a22a8b7985dcd174e9add6f20aa37a962">glMultMatrixf</a>(mat);
<a name="l04262"></a>04262     }
<a name="l04263"></a>04263 
<a name="l04264"></a>04264     <span class="comment">/* needed for text display */</span>
<a name="l04265"></a>04265     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65d360837f87824d49ed08caf44dccb3">imat</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l04266"></a>04266 
<a name="l04267"></a>04267     totpart = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ab52fdf06eac31dc7129f874718284014">totpart</a>;
<a name="l04268"></a>04268 
<a name="l04269"></a>04269     cfra = <a class="code" href="../../d8/d53/BKE__scene_8h.html#aa1d515c11776decf154b4b1684408586">BKE_curframe</a>(scene);
<a name="l04270"></a>04270 
<a name="l04271"></a>04271     <span class="keywordflow">if</span> (draw_as == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0a6e2b5b7e3602b7647433415494031d">PART_DRAW_PATH</a> &amp;&amp; psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ae097f6afc34289ef7ef3a6d6741070ad">pathcache</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#aa4bf1fe43162b6ea089fdd908773ec94">childcache</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l04272"></a>04272         draw_as = <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0549eb50419f4612e9ac387e304fbfbf">PART_DRAW_DOT</a>;
<a name="l04273"></a>04273 
<a name="l04274"></a>04274 <span class="comment">/* 3. */</span>
<a name="l04275"></a>04275     <span class="keywordflow">switch</span> (draw_as) {
<a name="l04276"></a>04276         <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0549eb50419f4612e9ac387e304fbfbf">PART_DRAW_DOT</a>:
<a name="l04277"></a>04277             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a19107ffbc85790e10f5ef5809285c2d0">draw_size</a>)
<a name="l04278"></a>04278                 glPointSize(part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a19107ffbc85790e10f5ef5809285c2d0">draw_size</a>);
<a name="l04279"></a>04279             <span class="keywordflow">else</span>
<a name="l04280"></a>04280                 glPointSize(2.0);  <span class="comment">/* default dot size */</span>
<a name="l04281"></a>04281             <span class="keywordflow">break</span>;
<a name="l04282"></a>04282         <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ac0cdecae5f153414e343c7d1bcdc929b">PART_DRAW_CIRC</a>:
<a name="l04283"></a>04283             <span class="comment">/* calculate view aligned matrix: */</span>
<a name="l04284"></a>04284             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(imat, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#aef4739e48c5265fc0185283cd9f92303">viewinv</a>);
<a name="l04285"></a>04285             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(imat[0]);
<a name="l04286"></a>04286             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(imat[1]);
<a name="l04287"></a>04287         <span class="comment">/* no break! */</span>
<a name="l04288"></a>04288         <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ab18d745f282ec3533bbeeedf935ce63c">PART_DRAW_CROSS</a>:
<a name="l04289"></a>04289         <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a69b6e4f9d6a791f38ac00ad17bee796b">PART_DRAW_AXIS</a>:
<a name="l04290"></a>04290             <span class="comment">/* lets calculate the scale: */</span>
<a name="l04291"></a>04291             
<a name="l04292"></a>04292             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a19107ffbc85790e10f5ef5809285c2d0">draw_size</a> == 0.0)
<a name="l04293"></a>04293                 pixsize_scale = 2.0f;
<a name="l04294"></a>04294             <span class="keywordflow">else</span>
<a name="l04295"></a>04295                 pixsize_scale = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a19107ffbc85790e10f5ef5809285c2d0">draw_size</a>;
<a name="l04296"></a>04296 
<a name="l04297"></a>04297             <span class="keywordflow">if</span> (draw_as == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a69b6e4f9d6a791f38ac00ad17bee796b">PART_DRAW_AXIS</a>)
<a name="l04298"></a>04298                 create_cdata = 1;
<a name="l04299"></a>04299             <span class="keywordflow">break</span>;
<a name="l04300"></a>04300         <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a2506fdc9f159583f812c900402c5ec54">PART_DRAW_OB</a>:
<a name="l04301"></a>04301             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7c2985d43ca884158ee831018e589d36">dup_ob</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l04302"></a>04302                 draw_as = <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0549eb50419f4612e9ac387e304fbfbf">PART_DRAW_DOT</a>;
<a name="l04303"></a>04303             <span class="keywordflow">else</span>
<a name="l04304"></a>04304                 draw_as = 0;
<a name="l04305"></a>04305             <span class="keywordflow">break</span>;
<a name="l04306"></a>04306         <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ababc8a40b78ea25bfdb9cd7b85c83f19">PART_DRAW_GR</a>:
<a name="l04307"></a>04307             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#af148cd19be57f2825db82cb9c453e682">dup_group</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l04308"></a>04308                 draw_as = <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0549eb50419f4612e9ac387e304fbfbf">PART_DRAW_DOT</a>;
<a name="l04309"></a>04309             <span class="keywordflow">else</span>
<a name="l04310"></a>04310                 draw_as = 0;
<a name="l04311"></a>04311             <span class="keywordflow">break</span>;
<a name="l04312"></a>04312         <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ae46a1d9cf35516920db6554623ff6369">PART_DRAW_BB</a>:
<a name="l04313"></a>04313             <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a4558fec04ca4894122276ad8980afc57">bb_ob</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l04314"></a>04314                 printf(<span class="stringliteral">&quot;Billboards need an active camera or a target object!\n&quot;</span>);
<a name="l04315"></a>04315 
<a name="l04316"></a>04316                 draw_as = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a675fa9a30bd2105087a98d138c6df66c">draw_as</a> = <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0549eb50419f4612e9ac387e304fbfbf">PART_DRAW_DOT</a>;
<a name="l04317"></a>04317 
<a name="l04318"></a>04318                 <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a19107ffbc85790e10f5ef5809285c2d0">draw_size</a>)
<a name="l04319"></a>04319                     glPointSize(part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a19107ffbc85790e10f5ef5809285c2d0">draw_size</a>);
<a name="l04320"></a>04320                 <span class="keywordflow">else</span>
<a name="l04321"></a>04321                     glPointSize(2.0);  <span class="comment">/* default dot size */</span>
<a name="l04322"></a>04322             }
<a name="l04323"></a>04323             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a4558fec04ca4894122276ad8980afc57">bb_ob</a>)
<a name="l04324"></a>04324                 bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#ad6cc4f0f36f765ad6e2fa197c7421f82">ob</a> = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a4558fec04ca4894122276ad8980afc57">bb_ob</a>;
<a name="l04325"></a>04325             <span class="keywordflow">else</span>
<a name="l04326"></a>04326                 bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#ad6cc4f0f36f765ad6e2fa197c7421f82">ob</a> = v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>;
<a name="l04327"></a>04327 
<a name="l04328"></a>04328             bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#af0b0d7f8ba5d133a3e8a040cc7d997c8">align</a> = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#aa5e839fe2565853c676f08b7c1bbddcd">bb_align</a>;
<a name="l04329"></a>04329             bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a2831ab76c3e994bb050bf23f016b3044">anim</a> = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#afdda34843924a25a00f0483cf7a72fa5">bb_anim</a>;
<a name="l04330"></a>04330             bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a28b539cdfb04a1d71e5f86078bd75592">lock</a> = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a5a951252b1159b0d8250669edf0eb68d">PART_DRAW_BB_LOCK</a>;
<a name="l04331"></a>04331             <span class="keywordflow">break</span>;
<a name="l04332"></a>04332         <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0a6e2b5b7e3602b7647433415494031d">PART_DRAW_PATH</a>:
<a name="l04333"></a>04333             <span class="keywordflow">break</span>;
<a name="l04334"></a>04334         <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0095bb5a5fb10ba1e61d296723c451ff">PART_DRAW_LINE</a>:
<a name="l04335"></a>04335             need_v = 1;
<a name="l04336"></a>04336             <span class="keywordflow">break</span>;
<a name="l04337"></a>04337     }
<a name="l04338"></a>04338     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0788b15d7d738117f176ff34d304531c">PART_DRAW_SIZE</a> &amp;&amp; part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a675fa9a30bd2105087a98d138c6df66c">draw_as</a> != <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ac0cdecae5f153414e343c7d1bcdc929b">PART_DRAW_CIRC</a>) {
<a name="l04339"></a>04339         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(imat, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#aef4739e48c5265fc0185283cd9f92303">viewinv</a>);
<a name="l04340"></a>04340         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(imat[0]);
<a name="l04341"></a>04341         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(imat[1]);
<a name="l04342"></a>04342     }
<a name="l04343"></a>04343 
<a name="l04344"></a>04344     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(draw_as, <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0549eb50419f4612e9ac387e304fbfbf">PART_DRAW_DOT</a>, <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ab18d745f282ec3533bbeeedf935ce63c">PART_DRAW_CROSS</a>, <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0095bb5a5fb10ba1e61d296723c451ff">PART_DRAW_LINE</a>) &amp;&amp;
<a name="l04345"></a>04345         (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a65933dbeb37c2a6658e3f158ec5da55a">draw_col</a> &gt; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a10e629306107732d61df2eb2d590af87">PART_DRAW_COL_MAT</a>))
<a name="l04346"></a>04346     {
<a name="l04347"></a>04347         create_cdata = 1;
<a name="l04348"></a>04348     }
<a name="l04349"></a>04349 
<a name="l04350"></a>04350     <span class="keywordflow">if</span> (!create_cdata &amp;&amp; pdd &amp;&amp; pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ad6af04fd88d5fd00760a100e2de0dbbc">cdata</a>) {
<a name="l04351"></a>04351         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ad6af04fd88d5fd00760a100e2de0dbbc">cdata</a>);
<a name="l04352"></a>04352         pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ad6af04fd88d5fd00760a100e2de0dbbc">cdata</a> = pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a20037b2bfc1c3ba01a053a8b63ae021d">cd</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04353"></a>04353     }
<a name="l04354"></a>04354 
<a name="l04355"></a>04355 <span class="comment">/* 4. */</span>
<a name="l04356"></a>04356     <span class="keywordflow">if</span> (draw_as &amp;&amp; <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(draw_as, <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0a6e2b5b7e3602b7647433415494031d">PART_DRAW_PATH</a>, <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ac0cdecae5f153414e343c7d1bcdc929b">PART_DRAW_CIRC</a>) == 0) {
<a name="l04357"></a>04357         <span class="keywordtype">int</span> tot_vec_size = (totpart + totchild) * 3 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>);
<a name="l04358"></a>04358         <span class="keywordtype">int</span> create_ndata = 0;
<a name="l04359"></a>04359 
<a name="l04360"></a>04360         <span class="keywordflow">if</span> (!pdd)
<a name="l04361"></a>04361             pdd = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ad87d1dfe2f606dd7a3e646c182e63e4b">pdd</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/df1/structParticleDrawData.html">ParticleDrawData</a>), <span class="stringliteral">&quot;ParticlDrawData&quot;</span>);
<a name="l04362"></a>04362 
<a name="l04363"></a>04363         <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a675fa9a30bd2105087a98d138c6df66c">draw_as</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a4c845dcc070e77eedb10185fc4d61d06">PART_DRAW_REND</a> &amp;&amp; part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#aa71e16f10d575c3ec34ea6d934f66d1d">trail_count</a> &gt; 1) {
<a name="l04364"></a>04364             tot_vec_size *= part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#aa71e16f10d575c3ec34ea6d934f66d1d">trail_count</a>;
<a name="l04365"></a>04365             <a class="code" href="../../db/dca/BKE__particle_8h.html#aac4e8f186d54a552936b89431ce86c04">psys_make_temp_pointcache</a>(ob, psys);
<a name="l04366"></a>04366         }
<a name="l04367"></a>04367 
<a name="l04368"></a>04368         <span class="keywordflow">switch</span> (draw_as) {
<a name="l04369"></a>04369             <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a69b6e4f9d6a791f38ac00ad17bee796b">PART_DRAW_AXIS</a>:
<a name="l04370"></a>04370             <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ab18d745f282ec3533bbeeedf935ce63c">PART_DRAW_CROSS</a>:
<a name="l04371"></a>04371                 tot_vec_size *= 6;
<a name="l04372"></a>04372                 <span class="keywordflow">if</span> (draw_as != <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ab18d745f282ec3533bbeeedf935ce63c">PART_DRAW_CROSS</a>)
<a name="l04373"></a>04373                     create_cdata = 1;
<a name="l04374"></a>04374                 <span class="keywordflow">break</span>;
<a name="l04375"></a>04375             <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0095bb5a5fb10ba1e61d296723c451ff">PART_DRAW_LINE</a>:
<a name="l04376"></a>04376                 tot_vec_size *= 2;
<a name="l04377"></a>04377                 <span class="keywordflow">break</span>;
<a name="l04378"></a>04378             <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ae46a1d9cf35516920db6554623ff6369">PART_DRAW_BB</a>:
<a name="l04379"></a>04379                 tot_vec_size *= 4;
<a name="l04380"></a>04380                 create_ndata = 1;
<a name="l04381"></a>04381                 <span class="keywordflow">break</span>;
<a name="l04382"></a>04382         }
<a name="l04383"></a>04383 
<a name="l04384"></a>04384         <span class="keywordflow">if</span> (pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#aa30202a9369f90277fafe8d86d4645ac">tot_vec_size</a> != tot_vec_size)
<a name="l04385"></a>04385             <a class="code" href="../../db/dca/BKE__particle_8h.html#ac6b0f2bf9fba3a6722c26a397ebe7710">psys_free_pdd</a>(psys);
<a name="l04386"></a>04386 
<a name="l04387"></a>04387         <span class="keywordflow">if</span> (!pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a23b72c8651890291ac9d3ba9e083ae50">vdata</a>)
<a name="l04388"></a>04388             pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a23b72c8651890291ac9d3ba9e083ae50">vdata</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(tot_vec_size, <span class="stringliteral">&quot;particle_vdata&quot;</span>);
<a name="l04389"></a>04389         <span class="keywordflow">if</span> (create_cdata &amp;&amp; !pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ad6af04fd88d5fd00760a100e2de0dbbc">cdata</a>)
<a name="l04390"></a>04390             pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ad6af04fd88d5fd00760a100e2de0dbbc">cdata</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(tot_vec_size, <span class="stringliteral">&quot;particle_cdata&quot;</span>);
<a name="l04391"></a>04391         <span class="keywordflow">if</span> (create_ndata &amp;&amp; !pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#af817d82ae11743547c595c59a0c6c5de">ndata</a>)
<a name="l04392"></a>04392             pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#af817d82ae11743547c595c59a0c6c5de">ndata</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(tot_vec_size, <span class="stringliteral">&quot;particle_ndata&quot;</span>);
<a name="l04393"></a>04393 
<a name="l04394"></a>04394         <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ad82e7c35e314b544fbb11e3641c36042">PART_DRAW_VEL</a> &amp;&amp; draw_as != <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0095bb5a5fb10ba1e61d296723c451ff">PART_DRAW_LINE</a>) {
<a name="l04395"></a>04395             <span class="keywordflow">if</span> (!pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ab902e01c6c837a044ba8b0f58bb21a26">vedata</a>)
<a name="l04396"></a>04396                 pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ab902e01c6c837a044ba8b0f58bb21a26">vedata</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(2 * (totpart + totchild) * 3 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), <span class="stringliteral">&quot;particle_vedata&quot;</span>);
<a name="l04397"></a>04397 
<a name="l04398"></a>04398             need_v = 1;
<a name="l04399"></a>04399         }
<a name="l04400"></a>04400         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ab902e01c6c837a044ba8b0f58bb21a26">vedata</a>) {
<a name="l04401"></a>04401             <span class="comment">/* velocity data not needed, so free it */</span>
<a name="l04402"></a>04402             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ab902e01c6c837a044ba8b0f58bb21a26">vedata</a>);
<a name="l04403"></a>04403             pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ab902e01c6c837a044ba8b0f58bb21a26">vedata</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04404"></a>04404         }
<a name="l04405"></a>04405 
<a name="l04406"></a>04406         pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a149e90ba8efa7515e1e1a155a64675f1">vd</a> = pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a23b72c8651890291ac9d3ba9e083ae50">vdata</a>;
<a name="l04407"></a>04407         pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ac1fd7d25bfa228127f84805456aacfd3">ved</a> = pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ab902e01c6c837a044ba8b0f58bb21a26">vedata</a>;
<a name="l04408"></a>04408         pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a20037b2bfc1c3ba01a053a8b63ae021d">cd</a> = pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ad6af04fd88d5fd00760a100e2de0dbbc">cdata</a>;
<a name="l04409"></a>04409         pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a6e0975697bde76254db456649bd8cfe4">nd</a> = pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#af817d82ae11743547c595c59a0c6c5de">ndata</a>;
<a name="l04410"></a>04410         pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#aa30202a9369f90277fafe8d86d4645ac">tot_vec_size</a> = tot_vec_size;
<a name="l04411"></a>04411     }
<a name="l04412"></a>04412     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ad87d1dfe2f606dd7a3e646c182e63e4b">pdd</a>) {
<a name="l04413"></a>04413         <a class="code" href="../../db/dca/BKE__particle_8h.html#ac6b0f2bf9fba3a6722c26a397ebe7710">psys_free_pdd</a>(psys);
<a name="l04414"></a>04414         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ad87d1dfe2f606dd7a3e646c182e63e4b">pdd</a>);
<a name="l04415"></a>04415         pdd = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ad87d1dfe2f606dd7a3e646c182e63e4b">pdd</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04416"></a>04416     }
<a name="l04417"></a>04417 
<a name="l04418"></a>04418     <span class="keywordflow">if</span> (pdd) {
<a name="l04419"></a>04419         pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a2ca51ba90921eb169d1a30281dd9169a">ma_col</a> = ma_col;
<a name="l04420"></a>04420     }
<a name="l04421"></a>04421 
<a name="l04422"></a>04422     psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#aea69f41b4be4c08a4e87060a1769fba5">lattice</a> = <a class="code" href="../../db/dca/BKE__particle_8h.html#a7f29db3949d983f1e222f2c5bb1a2a91">psys_get_lattice</a>(&amp;sim);
<a name="l04423"></a>04423 
<a name="l04424"></a>04424     <span class="comment">/* circles don&#39;t use drawdata, so have to add a special case here */</span>
<a name="l04425"></a>04425     <span class="keywordflow">if</span> ((pdd || draw_as == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ac0cdecae5f153414e343c7d1bcdc929b">PART_DRAW_CIRC</a>) &amp;&amp; draw_as != <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0a6e2b5b7e3602b7647433415494031d">PART_DRAW_PATH</a>) {
<a name="l04426"></a>04426         <span class="comment">/* 5. */</span>
<a name="l04427"></a>04427         <span class="keywordflow">if</span> (pdd &amp;&amp; (pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a4eba3a0cda18872b81547eeac9e4e8d7">flag</a> &amp; <a class="code" href="../../db/dca/BKE__particle_8h.html#a1a450d97b58cdae347e7d4271813e3d5">PARTICLE_DRAW_DATA_UPDATED</a>) &amp;&amp;
<a name="l04428"></a>04428             (pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ab902e01c6c837a044ba8b0f58bb21a26">vedata</a> || part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> &amp; (<a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0788b15d7d738117f176ff34d304531c">PART_DRAW_SIZE</a> | <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ae45b4a264aaeca1867111253174ae48a">PART_DRAW_NUM</a> | <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#aba548e017995146c3404797c12ac0d53">PART_DRAW_HEALTH</a>)) == 0)
<a name="l04429"></a>04429         {
<a name="l04430"></a>04430             totpoint = pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a26ddc7615657d26cf6c9afc7f749574d">totpoint</a>; <span class="comment">/* draw data is up to date */</span>
<a name="l04431"></a>04431         }
<a name="l04432"></a>04432         <span class="keywordflow">else</span> {
<a name="l04433"></a>04433             <span class="keywordflow">for</span> (a = 0, pa = pars; a &lt; totpart + totchild; a++, pa++) {
<a name="l04434"></a>04434                 <span class="comment">/* setup per particle individual stuff */</span>
<a name="l04435"></a>04435                 <span class="keywordflow">if</span> (a &lt; totpart) {
<a name="l04436"></a>04436                     <span class="keywordflow">if</span> (totchild &amp;&amp; (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a189fdf56761a6c68b121bb493cad75e3">PART_DRAW_PARENT</a>) == 0) <span class="keywordflow">continue</span>;
<a name="l04437"></a>04437                     <span class="keywordflow">if</span> (pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#adddf5beca21354e46dfeadab76952feb">flag</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a5419c3719e77cf5a291da056590cda31">PARS_NO_DISP</a> || pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#adddf5beca21354e46dfeadab76952feb">flag</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a3fafe1ff48e0742fd0c2e5ba4e69b4b1">PARS_UNEXIST</a>) <span class="keywordflow">continue</span>;
<a name="l04438"></a>04438 
<a name="l04439"></a>04439                     pa_time = (cfra - pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#ae6722db00f35e282a732461109f8565e">time</a>) / pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a46996559ec8d16d89fff3baeb96b0abf">lifetime</a>;
<a name="l04440"></a>04440                     pa_birthtime = pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#ae6722db00f35e282a732461109f8565e">time</a>;
<a name="l04441"></a>04441                     pa_dietime = pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#acccb02a763b098fdf5056d256598bfcf">dietime</a>;
<a name="l04442"></a>04442                     pa_size = pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a4cd9a6f1328a2b83a7a27c8d38f2cbf6">size</a>;
<a name="l04443"></a>04443                     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a4868871c1c1ba91bd42b97081be0f76a">phystype</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a632b70a25b43cdad1aad17d2cd9a2c53">PART_PHYS_BOIDS</a>)
<a name="l04444"></a>04444                         pa_health = pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a0605ad1a4ab015c2c627b8dc91e5b93c">boid</a>-&gt;<a class="code" href="../../da/df5/structBoidParticle.html#a8afb53f7799acc747c40dd3882f8814c">data</a>.<a class="code" href="../../d6/de4/structBoidData.html#ac045a5e0dfdfeb549a63787aefa936a4">health</a>;
<a name="l04445"></a>04445                     <span class="keywordflow">else</span>
<a name="l04446"></a>04446                         pa_health = -1.0;
<a name="l04447"></a>04447 
<a name="l04448"></a>04448                     r_tilt = 2.0f * (<a class="code" href="../../db/dca/BKE__particle_8h.html#a7c026f5b7959546e115a594622f6da29">PSYS_FRAND</a>(a + 21) - 0.5f);
<a name="l04449"></a>04449                     r_length = <a class="code" href="../../db/dca/BKE__particle_8h.html#a7c026f5b7959546e115a594622f6da29">PSYS_FRAND</a>(a + 22);
<a name="l04450"></a>04450 
<a name="l04451"></a>04451                     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a65933dbeb37c2a6658e3f158ec5da55a">draw_col</a> &gt; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a10e629306107732d61df2eb2d590af87">PART_DRAW_COL_MAT</a>) {
<a name="l04452"></a>04452                         <span class="keywordflow">switch</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a65933dbeb37c2a6658e3f158ec5da55a">draw_col</a>) {
<a name="l04453"></a>04453                             <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#acd341057db0b0fae9245108dd7f1a0ed">PART_DRAW_COL_VEL</a>:
<a name="l04454"></a>04454                                 intensity = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a0e6ed09763e5a4103e1e12a2cf61d970">state</a>.<a class="code" href="../../d3/d31/structParticleKey.html#a2784ffc7a428dff13e5f031178706fee">vel</a>) / part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a2d648dbc33e21a46f06615339f693dbe">color_vec_max</a>;
<a name="l04455"></a>04455                                 <span class="keywordflow">break</span>;
<a name="l04456"></a>04456                             <span class="keywordflow">case</span> <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#aa48d978e5ddc67169913a9badc2a781b">PART_DRAW_COL_ACC</a>:
<a name="l04457"></a>04457                                 intensity = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a97ecadbef10e5cc3decc2c02c3b96824">len_v3v3</a>(pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a0e6ed09763e5a4103e1e12a2cf61d970">state</a>.<a class="code" href="../../d3/d31/structParticleKey.html#a2784ffc7a428dff13e5f031178706fee">vel</a>, pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a3378d1560fc77d3842f910e38b2c7078">prev_state</a>.<a class="code" href="../../d3/d31/structParticleKey.html#a2784ffc7a428dff13e5f031178706fee">vel</a>) / ((pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a0e6ed09763e5a4103e1e12a2cf61d970">state</a>.<a class="code" href="../../d3/d31/structParticleKey.html#aa16173a033cec6443d22d89550e7b0b6">time</a> - pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a3378d1560fc77d3842f910e38b2c7078">prev_state</a>.<a class="code" href="../../d3/d31/structParticleKey.html#aa16173a033cec6443d22d89550e7b0b6">time</a>) * part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a2d648dbc33e21a46f06615339f693dbe">color_vec_max</a>);
<a name="l04458"></a>04458                                 <span class="keywordflow">break</span>;
<a name="l04459"></a>04459                             <span class="keywordflow">default</span>:
<a name="l04460"></a>04460                                 intensity = 1.0f; <span class="comment">/* should never happen */</span>
<a name="l04461"></a>04461                         }
<a name="l04462"></a>04462                         <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(intensity, 0.f, 1.f);
<a name="l04463"></a>04463                         <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#abb4c373c2f4f0297a7807ecd7f7a818c">weight_to_rgb</a>(ma_col, intensity);
<a name="l04464"></a>04464                     }
<a name="l04465"></a>04465                 }
<a name="l04466"></a>04466                 <span class="keywordflow">else</span> {
<a name="l04467"></a>04467                     <a class="code" href="../../d9/ded/structChildParticle.html">ChildParticle</a> *cpa = &amp;psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a0b2c69153aaaa2095eef823b6f030713">child</a>[a - totpart];
<a name="l04468"></a>04468 
<a name="l04469"></a>04469                     pa_time = <a class="code" href="../../db/dca/BKE__particle_8h.html#a7e530bd4e2c24bf2360c0ef1d6d94fae">psys_get_child_time</a>(psys, cpa, cfra, &amp;pa_birthtime, &amp;pa_dietime);
<a name="l04470"></a>04470                     pa_size = <a class="code" href="../../db/dca/BKE__particle_8h.html#accaa14591eeac19fc0e8596c38c541cc">psys_get_child_size</a>(psys, cpa, cfra, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l04471"></a>04471 
<a name="l04472"></a>04472                     pa_health = -1.0;
<a name="l04473"></a>04473 
<a name="l04474"></a>04474                     r_tilt = 2.0f * (<a class="code" href="../../db/dca/BKE__particle_8h.html#a7c026f5b7959546e115a594622f6da29">PSYS_FRAND</a>(a + 21) - 0.5f);
<a name="l04475"></a>04475                     r_length = <a class="code" href="../../db/dca/BKE__particle_8h.html#a7c026f5b7959546e115a594622f6da29">PSYS_FRAND</a>(a + 22);
<a name="l04476"></a>04476                 }
<a name="l04477"></a>04477 
<a name="l04478"></a>04478                 drawn = 0;
<a name="l04479"></a>04479                 <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a675fa9a30bd2105087a98d138c6df66c">draw_as</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a4c845dcc070e77eedb10185fc4d61d06">PART_DRAW_REND</a> &amp;&amp; part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#aa71e16f10d575c3ec34ea6d934f66d1d">trail_count</a> &gt; 1) {
<a name="l04480"></a>04480                     <span class="keywordtype">float</span> <a class="code" href="../../d1/d22/stdosl_8h.html#a939ad05d43eeb38dcadd8218e52d9648">length</a> = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a15135d6b7e6634c4b7411a842b64a4ad">path_end</a> * (1.0f - part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7164c579cde3741895d0dd4ee2a41e61">randlength</a> * r_length);
<a name="l04481"></a>04481                     <span class="keywordtype">int</span> trail_count = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#aa71e16f10d575c3ec34ea6d934f66d1d">trail_count</a> * (1.0f - part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7164c579cde3741895d0dd4ee2a41e61">randlength</a> * r_length);
<a name="l04482"></a>04482                     <span class="keywordtype">float</span> ct = ((part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a09c59607aa0f7c01fd4fe7fbb34c7039">PART_ABS_PATH_TIME</a>) ? cfra : pa_time) - <a class="code" href="../../d1/d22/stdosl_8h.html#a939ad05d43eeb38dcadd8218e52d9648">length</a>;
<a name="l04483"></a>04483                     <span class="keywordtype">float</span> dt = length / (trail_count ? (float)trail_count : 1.0f);
<a name="l04484"></a>04484                     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;
<a name="l04485"></a>04485 
<a name="l04486"></a>04486                     ct += dt;
<a name="l04487"></a>04487                     <span class="keywordflow">for</span> (i = 0; i &lt; trail_count; i++, ct += dt) {
<a name="l04488"></a>04488                         <span class="keywordtype">float</span> pixsize;
<a name="l04489"></a>04489 
<a name="l04490"></a>04490                         <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a09c59607aa0f7c01fd4fe7fbb34c7039">PART_ABS_PATH_TIME</a>) {
<a name="l04491"></a>04491                             <span class="keywordflow">if</span> (ct &lt; pa_birthtime || ct &gt; pa_dietime)
<a name="l04492"></a>04492                                 <span class="keywordflow">continue</span>;
<a name="l04493"></a>04493                         }
<a name="l04494"></a>04494                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ct &lt; 0.0f || ct &gt; 1.0f)
<a name="l04495"></a>04495                             <span class="keywordflow">continue</span>;
<a name="l04496"></a>04496 
<a name="l04497"></a>04497                         state.<a class="code" href="../../d3/d31/structParticleKey.html#aa16173a033cec6443d22d89550e7b0b6">time</a> = (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a09c59607aa0f7c01fd4fe7fbb34c7039">PART_ABS_PATH_TIME</a>) ? -ct : -(pa_birthtime + ct * (pa_dietime - pa_birthtime));
<a name="l04498"></a>04498                         <a class="code" href="../../db/dca/BKE__particle_8h.html#a062a65390dae74a14fe41b2a22c67bea">psys_get_particle_on_path</a>(&amp;sim, a, &amp;state, need_v);
<a name="l04499"></a>04499 
<a name="l04500"></a>04500                         <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ac31ded3785aa33d38c83e1dc93156fea">parent</a>)
<a name="l04501"></a>04501                             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ac31ded3785aa33d38c83e1dc93156fea">parent</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, state.<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>);
<a name="l04502"></a>04502 
<a name="l04503"></a>04503                         <span class="comment">/* create actiual particle data */</span>
<a name="l04504"></a>04504                         <span class="keywordflow">if</span> (draw_as == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ae46a1d9cf35516920db6554623ff6369">PART_DRAW_BB</a>) {
<a name="l04505"></a>04505                             bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a395816e04f3038efc6030b75732139ae">offset</a>[0] = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#adc2a4787fc4fb6c47506b6cac21eef72">bb_offset</a>[0];
<a name="l04506"></a>04506                             bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a395816e04f3038efc6030b75732139ae">offset</a>[1] = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#adc2a4787fc4fb6c47506b6cac21eef72">bb_offset</a>[1];
<a name="l04507"></a>04507                             bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a83eae9a35401e80bc2b582e1fcbe5459">size</a>[0] = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a8c0b29bcecae8c2d4a86b20096589f2c">bb_size</a>[0] * pa_size;
<a name="l04508"></a>04508                             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#aa5e839fe2565853c676f08b7c1bbddcd">bb_align</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a5910cb4e6c113fc8e4328f567a413086">PART_BB_VEL</a>) {
<a name="l04509"></a>04509                                 <span class="keywordtype">float</span> pa_vel = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(state.<a class="code" href="../../d3/d31/structParticleKey.html#a2784ffc7a428dff13e5f031178706fee">vel</a>);
<a name="l04510"></a>04510                                 <span class="keywordtype">float</span> head = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ad9916f8f8768f9864473ad993bd4b249">bb_vel_head</a> * pa_vel;
<a name="l04511"></a>04511                                 <span class="keywordtype">float</span> tail = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a54f85cb00348993ac06a64e0dbaf8cb1">bb_vel_tail</a> * pa_vel;
<a name="l04512"></a>04512                                 bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a83eae9a35401e80bc2b582e1fcbe5459">size</a>[1] = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a8c0b29bcecae8c2d4a86b20096589f2c">bb_size</a>[1] * pa_size + head + tail;
<a name="l04513"></a>04513                                 <span class="comment">/* use offset to adjust the particle center. this is relative to size, so need to divide! */</span>
<a name="l04514"></a>04514                                 <span class="keywordflow">if</span> (bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a83eae9a35401e80bc2b582e1fcbe5459">size</a>[1] &gt; 0.0f)
<a name="l04515"></a>04515                                     bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a395816e04f3038efc6030b75732139ae">offset</a>[1] += (head - tail) / bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a83eae9a35401e80bc2b582e1fcbe5459">size</a>[1];
<a name="l04516"></a>04516                             }
<a name="l04517"></a>04517                             <span class="keywordflow">else</span>
<a name="l04518"></a>04518                                 bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a83eae9a35401e80bc2b582e1fcbe5459">size</a>[1] = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a8c0b29bcecae8c2d4a86b20096589f2c">bb_size</a>[1] * pa_size;
<a name="l04519"></a>04519                             bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a855befd8b0e77597769b9634bdb64e73">tilt</a> = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#abfd06f71fb5dbd817c8cb5ff0923edc5">bb_tilt</a> * (1.0f - part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#aa12de1d7cb10a4fe6b5a15206f0f217d">bb_rand_tilt</a> * r_tilt);
<a name="l04520"></a>04520                             bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#ac0204e98d02c54487c6fc257e7e00372">time</a> = ct;
<a name="l04521"></a>04521                         }
<a name="l04522"></a>04522 
<a name="l04523"></a>04523                         pixsize = <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a6e321972f49ac4f4e1f04b7fc3671d35">ED_view3d_pixel_size</a>(rv3d, state.<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>) * pixsize_scale;
<a name="l04524"></a>04524 
<a name="l04525"></a>04525                         <a class="code" href="../../d3/d02/drawobject_8c.html#aa285505a18bbe068f67d3c4a2727561a">draw_particle</a>(&amp;state, draw_as, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a>, pixsize, imat, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7461f5318b0513e5c424046ceebff77b">draw_line</a>, &amp;bb, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ad87d1dfe2f606dd7a3e646c182e63e4b">pdd</a>);
<a name="l04526"></a>04526 
<a name="l04527"></a>04527                         totpoint++;
<a name="l04528"></a>04528                         drawn = 1;
<a name="l04529"></a>04529                     }
<a name="l04530"></a>04530                 }
<a name="l04531"></a>04531                 <span class="keywordflow">else</span> {
<a name="l04532"></a>04532                     state.<a class="code" href="../../d3/d31/structParticleKey.html#aa16173a033cec6443d22d89550e7b0b6">time</a> = cfra;
<a name="l04533"></a>04533                     <span class="keywordflow">if</span> (<a class="code" href="../../db/dca/BKE__particle_8h.html#a954cd827b2145d733493e4fd5f33ab9f">psys_get_particle_state</a>(&amp;sim, a, &amp;state, 0)) {
<a name="l04534"></a>04534                         <span class="keywordtype">float</span> pixsize;
<a name="l04535"></a>04535 
<a name="l04536"></a>04536                         <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ac31ded3785aa33d38c83e1dc93156fea">parent</a>)
<a name="l04537"></a>04537                             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ac31ded3785aa33d38c83e1dc93156fea">parent</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, state.<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>);
<a name="l04538"></a>04538 
<a name="l04539"></a>04539                         <span class="comment">/* create actiual particle data */</span>
<a name="l04540"></a>04540                         <span class="keywordflow">if</span> (draw_as == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ae46a1d9cf35516920db6554623ff6369">PART_DRAW_BB</a>) {
<a name="l04541"></a>04541                             bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a395816e04f3038efc6030b75732139ae">offset</a>[0] = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#adc2a4787fc4fb6c47506b6cac21eef72">bb_offset</a>[0];
<a name="l04542"></a>04542                             bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a395816e04f3038efc6030b75732139ae">offset</a>[1] = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#adc2a4787fc4fb6c47506b6cac21eef72">bb_offset</a>[1];
<a name="l04543"></a>04543                             bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a83eae9a35401e80bc2b582e1fcbe5459">size</a>[0] = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a8c0b29bcecae8c2d4a86b20096589f2c">bb_size</a>[0] * pa_size;
<a name="l04544"></a>04544                             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#aa5e839fe2565853c676f08b7c1bbddcd">bb_align</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a5910cb4e6c113fc8e4328f567a413086">PART_BB_VEL</a>) {
<a name="l04545"></a>04545                                 <span class="keywordtype">float</span> pa_vel = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(state.<a class="code" href="../../d3/d31/structParticleKey.html#a2784ffc7a428dff13e5f031178706fee">vel</a>);
<a name="l04546"></a>04546                                 <span class="keywordtype">float</span> head = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ad9916f8f8768f9864473ad993bd4b249">bb_vel_head</a> * pa_vel;
<a name="l04547"></a>04547                                 <span class="keywordtype">float</span> tail = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a54f85cb00348993ac06a64e0dbaf8cb1">bb_vel_tail</a> * pa_vel;
<a name="l04548"></a>04548                                 bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a83eae9a35401e80bc2b582e1fcbe5459">size</a>[1] = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a8c0b29bcecae8c2d4a86b20096589f2c">bb_size</a>[1] * pa_size + head + tail;
<a name="l04549"></a>04549                                 <span class="comment">/* use offset to adjust the particle center. this is relative to size, so need to divide! */</span>
<a name="l04550"></a>04550                                 <span class="keywordflow">if</span> (bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a83eae9a35401e80bc2b582e1fcbe5459">size</a>[1] &gt; 0.0f)
<a name="l04551"></a>04551                                     bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a395816e04f3038efc6030b75732139ae">offset</a>[1] += (head - tail) / bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a83eae9a35401e80bc2b582e1fcbe5459">size</a>[1];
<a name="l04552"></a>04552                             }
<a name="l04553"></a>04553                             <span class="keywordflow">else</span>
<a name="l04554"></a>04554                                 bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a83eae9a35401e80bc2b582e1fcbe5459">size</a>[1] = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a8c0b29bcecae8c2d4a86b20096589f2c">bb_size</a>[1] * pa_size;
<a name="l04555"></a>04555                             bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#a855befd8b0e77597769b9634bdb64e73">tilt</a> = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#abfd06f71fb5dbd817c8cb5ff0923edc5">bb_tilt</a> * (1.0f - part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#aa12de1d7cb10a4fe6b5a15206f0f217d">bb_rand_tilt</a> * r_tilt);
<a name="l04556"></a>04556                             bb.<a class="code" href="../../d0/d06/structParticleBillboardData.html#ac0204e98d02c54487c6fc257e7e00372">time</a> = pa_time;
<a name="l04557"></a>04557                         }
<a name="l04558"></a>04558 
<a name="l04559"></a>04559                         pixsize = <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a6e321972f49ac4f4e1f04b7fc3671d35">ED_view3d_pixel_size</a>(rv3d, state.<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>) * pixsize_scale;
<a name="l04560"></a>04560 
<a name="l04561"></a>04561                         <a class="code" href="../../d3/d02/drawobject_8c.html#aa285505a18bbe068f67d3c4a2727561a">draw_particle</a>(&amp;state, draw_as, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a>, pixsize, imat, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7461f5318b0513e5c424046ceebff77b">draw_line</a>, &amp;bb, pdd);
<a name="l04562"></a>04562 
<a name="l04563"></a>04563                         totpoint++;
<a name="l04564"></a>04564                         drawn = 1;
<a name="l04565"></a>04565                     }
<a name="l04566"></a>04566                 }
<a name="l04567"></a>04567 
<a name="l04568"></a>04568                 <span class="keywordflow">if</span> (drawn) {
<a name="l04569"></a>04569                     <span class="comment">/* additional things to draw for each particle  */</span>
<a name="l04570"></a>04570                     <span class="comment">/* (velocity, size and number)                  */</span>
<a name="l04571"></a>04571                     <span class="keywordflow">if</span> ((part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ad82e7c35e314b544fbb11e3641c36042">PART_DRAW_VEL</a>) &amp;&amp; pdd &amp;&amp; pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ab902e01c6c837a044ba8b0f58bb21a26">vedata</a>) {
<a name="l04572"></a>04572                         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ac1fd7d25bfa228127f84805456aacfd3">ved</a>, state.<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>);
<a name="l04573"></a>04573                         pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ac1fd7d25bfa228127f84805456aacfd3">ved</a> += 3;
<a name="l04574"></a>04574                         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ad32a55246dbd69dbd150cd3fe480c734">mul_v3_v3fl</a>(vel, state.<a class="code" href="../../d3/d31/structParticleKey.html#a2784ffc7a428dff13e5f031178706fee">vel</a>, timestep);
<a name="l04575"></a>04575                         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ac1fd7d25bfa228127f84805456aacfd3">ved</a>, state.<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>, vel);
<a name="l04576"></a>04576                         pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ac1fd7d25bfa228127f84805456aacfd3">ved</a> += 3;
<a name="l04577"></a>04577 
<a name="l04578"></a>04578                         totve++;
<a name="l04579"></a>04579                     }
<a name="l04580"></a>04580 
<a name="l04581"></a>04581                     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0788b15d7d738117f176ff34d304531c">PART_DRAW_SIZE</a>) {
<a name="l04582"></a>04582                         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(3);
<a name="l04583"></a>04583                         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, state.<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>, pa_size, imat);
<a name="l04584"></a>04584                         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(0);
<a name="l04585"></a>04585                     }
<a name="l04586"></a>04586 
<a name="l04587"></a>04587 
<a name="l04588"></a>04588                     <span class="keywordflow">if</span> ((part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ae45b4a264aaeca1867111253174ae48a">PART_DRAW_NUM</a> || part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#aba548e017995146c3404797c12ac0d53">PART_DRAW_HEALTH</a>) &amp;&amp;
<a name="l04589"></a>04589                         (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0)
<a name="l04590"></a>04590                     {
<a name="l04591"></a>04591                         <span class="keywordtype">float</span> vec_txt[3];
<a name="l04592"></a>04592                         <span class="keywordtype">char</span> *val_pos = numstr;
<a name="l04593"></a>04593                         numstr[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l04594"></a>04594 
<a name="l04595"></a>04595                         <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ae45b4a264aaeca1867111253174ae48a">PART_DRAW_NUM</a>) {
<a name="l04596"></a>04596                             <span class="keywordflow">if</span> (a &lt; totpart &amp;&amp; (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#aba548e017995146c3404797c12ac0d53">PART_DRAW_HEALTH</a>) &amp;&amp; (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a4868871c1c1ba91bd42b97081be0f76a">phystype</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a632b70a25b43cdad1aad17d2cd9a2c53">PART_PHYS_BOIDS</a>)) {
<a name="l04597"></a>04597                                 sprintf(val_pos, <span class="stringliteral">&quot;%d:%.2f&quot;</span>, a, pa_health);
<a name="l04598"></a>04598                             }
<a name="l04599"></a>04599                             <span class="keywordflow">else</span> {
<a name="l04600"></a>04600                                 sprintf(val_pos, <span class="stringliteral">&quot;%d&quot;</span>, a);
<a name="l04601"></a>04601                             }
<a name="l04602"></a>04602                         }
<a name="l04603"></a>04603                         <span class="keywordflow">else</span> {
<a name="l04604"></a>04604                             <span class="keywordflow">if</span> (a &lt; totpart &amp;&amp; (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#aba548e017995146c3404797c12ac0d53">PART_DRAW_HEALTH</a>) &amp;&amp; (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a4868871c1c1ba91bd42b97081be0f76a">phystype</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a632b70a25b43cdad1aad17d2cd9a2c53">PART_PHYS_BOIDS</a>)) {
<a name="l04605"></a>04605                                 sprintf(val_pos, <span class="stringliteral">&quot;%.2f&quot;</span>, pa_health);
<a name="l04606"></a>04606                             }
<a name="l04607"></a>04607                         }
<a name="l04608"></a>04608 
<a name="l04609"></a>04609                         <span class="comment">/* in path drawing state.co is the end point */</span>
<a name="l04610"></a>04610                         <span class="comment">/* use worldspace beause object matrix is already applied */</span>
<a name="l04611"></a>04611                         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad7be0179ee8a128512e2c7f0ad11c8d8">mul_v3_m4v3</a>(vec_txt, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65d360837f87824d49ed08caf44dccb3">imat</a>, state.<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>);
<a name="l04612"></a>04612                         <a class="code" href="../../d3/d02/drawobject_8c.html#a6de94308481c2e9de88b710de50dad2f">view3d_cached_text_draw_add</a>(vec_txt, numstr, 10, <a class="code" href="../../d4/df4/view3d__intern_8h.html#ac2fc067b36e3433922ac41218f33a738">V3D_CACHE_TEXT_WORLDSPACE</a> | <a class="code" href="../../d4/df4/view3d__intern_8h.html#a19cf47d47eeef9d2339453c4833c7e77">V3D_CACHE_TEXT_ASCII</a>, tcol);
<a name="l04613"></a>04613                     }
<a name="l04614"></a>04614                 }
<a name="l04615"></a>04615             }
<a name="l04616"></a>04616         }
<a name="l04617"></a>04617     }
<a name="l04618"></a>04618 <span class="comment">/* 6. */</span>
<a name="l04619"></a>04619 
<a name="l04620"></a>04620     glGetIntegerv(GL_POLYGON_MODE, polygonmode);
<a name="l04621"></a>04621     glEnableClientState(GL_VERTEX_ARRAY);
<a name="l04622"></a>04622 
<a name="l04623"></a>04623     <span class="keywordflow">if</span> (draw_as == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a0a6e2b5b7e3602b7647433415494031d">PART_DRAW_PATH</a>) {
<a name="l04624"></a>04624         <a class="code" href="../../d1/d8d/structParticleCacheKey.html">ParticleCacheKey</a> **cache, *path;
<a name="l04625"></a>04625         <span class="keywordtype">float</span> <span class="comment">/* *cd2=NULL, */</span> <span class="comment">/* UNUSED */</span> *cdata2 = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04626"></a>04626 
<a name="l04627"></a>04627         <span class="comment">/* setup gl flags */</span>
<a name="l04628"></a>04628         <span class="keywordflow">if</span> (1) { <span class="comment">//ob_dt &gt; OB_WIRE) {</span>
<a name="l04629"></a>04629             glEnableClientState(GL_NORMAL_ARRAY);
<a name="l04630"></a>04630 
<a name="l04631"></a>04631             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a65933dbeb37c2a6658e3f158ec5da55a">draw_col</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a10e629306107732d61df2eb2d590af87">PART_DRAW_COL_MAT</a>)
<a name="l04632"></a>04632                 glEnableClientState(GL_COLOR_ARRAY);
<a name="l04633"></a>04633 
<a name="l04634"></a>04634             glEnable(GL_LIGHTING);
<a name="l04635"></a>04635             glColorMaterial(GL_FRONT_AND_BACK, GL_DIFFUSE);
<a name="l04636"></a>04636             glEnable(GL_COLOR_MATERIAL);
<a name="l04637"></a>04637         }
<a name="l04638"></a>04638 <span class="preprocessor">#if 0</span>
<a name="l04639"></a>04639 <span class="preprocessor"></span>        <span class="keywordflow">else</span> {
<a name="l04640"></a>04640             glDisableClientState(GL_NORMAL_ARRAY);
<a name="l04641"></a>04641 
<a name="l04642"></a>04642             glDisable(GL_COLOR_MATERIAL);
<a name="l04643"></a>04643             glDisable(GL_LIGHTING);
<a name="l04644"></a>04644             <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l04645"></a>04645         }
<a name="l04646"></a>04646 <span class="preprocessor">#endif</span>
<a name="l04647"></a>04647 <span class="preprocessor"></span>
<a name="l04648"></a>04648         <span class="keywordflow">if</span> (totchild &amp;&amp; (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a189fdf56761a6c68b121bb493cad75e3">PART_DRAW_PARENT</a>) == 0)
<a name="l04649"></a>04649             totpart = 0;
<a name="l04650"></a>04650         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ae097f6afc34289ef7ef3a6d6741070ad">pathcache</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l04651"></a>04651             totpart = 0;
<a name="l04652"></a>04652 
<a name="l04653"></a>04653         <span class="comment">/* draw actual/parent particles */</span>
<a name="l04654"></a>04654         cache = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ae097f6afc34289ef7ef3a6d6741070ad">pathcache</a>;
<a name="l04655"></a>04655         <span class="keywordflow">for</span> (a = 0, pa = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>; a &lt; totpart; a++, pa++) {
<a name="l04656"></a>04656             path = cache[a];
<a name="l04657"></a>04657             <span class="keywordflow">if</span> (path-&gt;<a class="code" href="../../d1/d8d/structParticleCacheKey.html#a62384f087dce67cd6bc170116446f531">steps</a> &gt; 0) {
<a name="l04658"></a>04658                 glVertexPointer(3, GL_FLOAT, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d8d/structParticleCacheKey.html">ParticleCacheKey</a>), path-&gt;<a class="code" href="../../d1/d8d/structParticleCacheKey.html#a7e45c47581f6d4b4c54daa32943e984a">co</a>);
<a name="l04659"></a>04659 
<a name="l04660"></a>04660                 <span class="keywordflow">if</span> (1) { <span class="comment">//ob_dt &gt; OB_WIRE) {</span>
<a name="l04661"></a>04661                     glNormalPointer(GL_FLOAT, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d8d/structParticleCacheKey.html">ParticleCacheKey</a>), path-&gt;<a class="code" href="../../d1/d8d/structParticleCacheKey.html#a76bef94633fd0d1a7e3445b2b1ad15d6">vel</a>);
<a name="l04662"></a>04662                     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a65933dbeb37c2a6658e3f158ec5da55a">draw_col</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a10e629306107732d61df2eb2d590af87">PART_DRAW_COL_MAT</a>)
<a name="l04663"></a>04663                         glColorPointer(3, GL_FLOAT, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d8d/structParticleCacheKey.html">ParticleCacheKey</a>), path-&gt;<a class="code" href="../../d1/d8d/structParticleCacheKey.html#ad92582f6fe66357ec97a5c7fe613c809">col</a>);
<a name="l04664"></a>04664                 }
<a name="l04665"></a>04665 
<a name="l04666"></a>04666                 glDrawArrays(GL_LINE_STRIP, 0, path-&gt;<a class="code" href="../../d1/d8d/structParticleCacheKey.html#a62384f087dce67cd6bc170116446f531">steps</a> + 1);
<a name="l04667"></a>04667             }
<a name="l04668"></a>04668         }
<a name="l04669"></a>04669         
<a name="l04670"></a>04670         <span class="comment">/* draw child particles */</span>
<a name="l04671"></a>04671         cache = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#aa4bf1fe43162b6ea089fdd908773ec94">childcache</a>;
<a name="l04672"></a>04672         <span class="keywordflow">for</span> (a = 0; a &lt; totchild; a++) {
<a name="l04673"></a>04673             path = cache[a];
<a name="l04674"></a>04674             glVertexPointer(3, GL_FLOAT, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d8d/structParticleCacheKey.html">ParticleCacheKey</a>), path-&gt;<a class="code" href="../../d1/d8d/structParticleCacheKey.html#a7e45c47581f6d4b4c54daa32943e984a">co</a>);
<a name="l04675"></a>04675 
<a name="l04676"></a>04676             <span class="keywordflow">if</span> (1) { <span class="comment">//ob_dt &gt; OB_WIRE) {</span>
<a name="l04677"></a>04677                 glNormalPointer(GL_FLOAT, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d8d/structParticleCacheKey.html">ParticleCacheKey</a>), path-&gt;<a class="code" href="../../d1/d8d/structParticleCacheKey.html#a76bef94633fd0d1a7e3445b2b1ad15d6">vel</a>);
<a name="l04678"></a>04678                 <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a65933dbeb37c2a6658e3f158ec5da55a">draw_col</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a10e629306107732d61df2eb2d590af87">PART_DRAW_COL_MAT</a>)
<a name="l04679"></a>04679                     glColorPointer(3, GL_FLOAT, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d8d/structParticleCacheKey.html">ParticleCacheKey</a>), path-&gt;<a class="code" href="../../d1/d8d/structParticleCacheKey.html#ad92582f6fe66357ec97a5c7fe613c809">col</a>);
<a name="l04680"></a>04680             }
<a name="l04681"></a>04681 
<a name="l04682"></a>04682             glDrawArrays(GL_LINE_STRIP, 0, path-&gt;<a class="code" href="../../d1/d8d/structParticleCacheKey.html#a62384f087dce67cd6bc170116446f531">steps</a> + 1);
<a name="l04683"></a>04683         }
<a name="l04684"></a>04684 
<a name="l04685"></a>04685 
<a name="l04686"></a>04686         <span class="comment">/* restore &amp; clean up */</span>
<a name="l04687"></a>04687         <span class="keywordflow">if</span> (1) { <span class="comment">//ob_dt &gt; OB_WIRE) {</span>
<a name="l04688"></a>04688             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a65933dbeb37c2a6658e3f158ec5da55a">draw_col</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a10e629306107732d61df2eb2d590af87">PART_DRAW_COL_MAT</a>)
<a name="l04689"></a>04689                 glDisable(GL_COLOR_ARRAY);
<a name="l04690"></a>04690             glDisable(GL_COLOR_MATERIAL);
<a name="l04691"></a>04691         }
<a name="l04692"></a>04692 
<a name="l04693"></a>04693         <span class="keywordflow">if</span> (cdata2)
<a name="l04694"></a>04694             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cdata2);
<a name="l04695"></a>04695         <span class="comment">/* cd2= */</span> <span class="comment">/* UNUSED */</span> cdata2 = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04696"></a>04696 
<a name="l04697"></a>04697         glLineWidth(1.0f);
<a name="l04698"></a>04698 
<a name="l04699"></a>04699         <span class="keywordflow">if</span> ((part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#ae7a7916f69a4fc69561faf787f6160c7">draw</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ae45b4a264aaeca1867111253174ae48a">PART_DRAW_NUM</a>) &amp;&amp; (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0) {
<a name="l04700"></a>04700             cache = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ae097f6afc34289ef7ef3a6d6741070ad">pathcache</a>;
<a name="l04701"></a>04701 
<a name="l04702"></a>04702             <span class="keywordflow">for</span> (a = 0, pa = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>; a &lt; totpart; a++, pa++) {
<a name="l04703"></a>04703                 <span class="keywordtype">float</span> vec_txt[3];
<a name="l04704"></a>04704                 <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(numstr, <span class="keyword">sizeof</span>(numstr), <span class="stringliteral">&quot;%i&quot;</span>, a);
<a name="l04705"></a>04705                 <span class="comment">/* use worldspace beause object matrix is already applied */</span>
<a name="l04706"></a>04706                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad7be0179ee8a128512e2c7f0ad11c8d8">mul_v3_m4v3</a>(vec_txt, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65d360837f87824d49ed08caf44dccb3">imat</a>, cache[a]-&gt;<a class="code" href="../../d1/d8d/structParticleCacheKey.html#a7e45c47581f6d4b4c54daa32943e984a">co</a>);
<a name="l04707"></a>04707                 <a class="code" href="../../d3/d02/drawobject_8c.html#a6de94308481c2e9de88b710de50dad2f">view3d_cached_text_draw_add</a>(vec_txt, numstr, 10, <a class="code" href="../../d4/df4/view3d__intern_8h.html#ac2fc067b36e3433922ac41218f33a738">V3D_CACHE_TEXT_WORLDSPACE</a> | <a class="code" href="../../d4/df4/view3d__intern_8h.html#a19cf47d47eeef9d2339453c4833c7e77">V3D_CACHE_TEXT_ASCII</a>, tcol);
<a name="l04708"></a>04708             }
<a name="l04709"></a>04709         }
<a name="l04710"></a>04710     }
<a name="l04711"></a>04711     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pdd &amp;&amp; <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(draw_as, 0, <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ac0cdecae5f153414e343c7d1bcdc929b">PART_DRAW_CIRC</a>) == 0) {
<a name="l04712"></a>04712         glDisableClientState(GL_COLOR_ARRAY);
<a name="l04713"></a>04713 
<a name="l04714"></a>04714         <span class="comment">/* enable point data array */</span>
<a name="l04715"></a>04715         <span class="keywordflow">if</span> (pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a23b72c8651890291ac9d3ba9e083ae50">vdata</a>) {
<a name="l04716"></a>04716             glEnableClientState(GL_VERTEX_ARRAY);
<a name="l04717"></a>04717             glVertexPointer(3, GL_FLOAT, 0, pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a23b72c8651890291ac9d3ba9e083ae50">vdata</a>);
<a name="l04718"></a>04718         }
<a name="l04719"></a>04719         <span class="keywordflow">else</span>
<a name="l04720"></a>04720             glDisableClientState(GL_VERTEX_ARRAY);
<a name="l04721"></a>04721 
<a name="l04722"></a>04722         <span class="keywordflow">if</span> (select) {
<a name="l04723"></a>04723             <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531af47479527035752070059cf6669daf09">TH_ACTIVE</a>);
<a name="l04724"></a>04724             
<a name="l04725"></a>04725             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a19107ffbc85790e10f5ef5809285c2d0">draw_size</a>)
<a name="l04726"></a>04726                 glPointSize(part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a19107ffbc85790e10f5ef5809285c2d0">draw_size</a> + 2);
<a name="l04727"></a>04727             <span class="keywordflow">else</span>
<a name="l04728"></a>04728                 glPointSize(4.0);
<a name="l04729"></a>04729 
<a name="l04730"></a>04730             glLineWidth(3.0);
<a name="l04731"></a>04731 
<a name="l04732"></a>04732             <a class="code" href="../../d3/d02/drawobject_8c.html#a3ad015ec004b96640fb684e3c849de1b">draw_particle_arrays</a>(draw_as, totpoint, ob_dt, 1);
<a name="l04733"></a>04733         }
<a name="l04734"></a>04734 
<a name="l04735"></a>04735         <span class="comment">/* restore from select */</span>
<a name="l04736"></a>04736         glColor3fv(ma_col);
<a name="l04737"></a>04737         glPointSize(part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a19107ffbc85790e10f5ef5809285c2d0">draw_size</a> ? part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a19107ffbc85790e10f5ef5809285c2d0">draw_size</a> : 2.0);
<a name="l04738"></a>04738         glLineWidth(1.0);
<a name="l04739"></a>04739 
<a name="l04740"></a>04740         <span class="comment">/* enable other data arrays */</span>
<a name="l04741"></a>04741 
<a name="l04742"></a>04742         <span class="comment">/* billboards are drawn this way */</span>
<a name="l04743"></a>04743         <span class="keywordflow">if</span> (pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#af817d82ae11743547c595c59a0c6c5de">ndata</a> &amp;&amp; ob_dt &gt; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>) {
<a name="l04744"></a>04744             glEnableClientState(GL_NORMAL_ARRAY);
<a name="l04745"></a>04745             glNormalPointer(GL_FLOAT, 0, pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#af817d82ae11743547c595c59a0c6c5de">ndata</a>);
<a name="l04746"></a>04746             glEnable(GL_LIGHTING);
<a name="l04747"></a>04747         }
<a name="l04748"></a>04748         <span class="keywordflow">else</span> {
<a name="l04749"></a>04749             glDisableClientState(GL_NORMAL_ARRAY);
<a name="l04750"></a>04750             glDisable(GL_LIGHTING);
<a name="l04751"></a>04751         }
<a name="l04752"></a>04752 
<a name="l04753"></a>04753         <span class="keywordflow">if</span> (pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ad6af04fd88d5fd00760a100e2de0dbbc">cdata</a>) {
<a name="l04754"></a>04754             glEnableClientState(GL_COLOR_ARRAY);
<a name="l04755"></a>04755             glColorPointer(3, GL_FLOAT, 0, pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ad6af04fd88d5fd00760a100e2de0dbbc">cdata</a>);
<a name="l04756"></a>04756         }
<a name="l04757"></a>04757 
<a name="l04758"></a>04758         <a class="code" href="../../d3/d02/drawobject_8c.html#a3ad015ec004b96640fb684e3c849de1b">draw_particle_arrays</a>(draw_as, totpoint, ob_dt, 0);
<a name="l04759"></a>04759 
<a name="l04760"></a>04760         pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a4eba3a0cda18872b81547eeac9e4e8d7">flag</a> |= <a class="code" href="../../db/dca/BKE__particle_8h.html#a1a450d97b58cdae347e7d4271813e3d5">PARTICLE_DRAW_DATA_UPDATED</a>;
<a name="l04761"></a>04761         pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a26ddc7615657d26cf6c9afc7f749574d">totpoint</a> = totpoint;
<a name="l04762"></a>04762     }
<a name="l04763"></a>04763 
<a name="l04764"></a>04764     <span class="keywordflow">if</span> (pdd &amp;&amp; pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ab902e01c6c837a044ba8b0f58bb21a26">vedata</a>) {
<a name="l04765"></a>04765         glDisableClientState(GL_COLOR_ARRAY);
<a name="l04766"></a>04766         <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(0xC0C0C0);
<a name="l04767"></a>04767         
<a name="l04768"></a>04768         glVertexPointer(3, GL_FLOAT, 0, pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#ab902e01c6c837a044ba8b0f58bb21a26">vedata</a>);
<a name="l04769"></a>04769         
<a name="l04770"></a>04770         glDrawArrays(GL_LINES, 0, 2 * totve);
<a name="l04771"></a>04771     }
<a name="l04772"></a>04772 
<a name="l04773"></a>04773     glPolygonMode(GL_FRONT, polygonmode[0]);
<a name="l04774"></a>04774     glPolygonMode(GL_BACK, polygonmode[1]);
<a name="l04775"></a>04775 
<a name="l04776"></a>04776 <span class="comment">/* 7. */</span>
<a name="l04777"></a>04777     
<a name="l04778"></a>04778     glDisable(GL_LIGHTING);
<a name="l04779"></a>04779     glDisableClientState(GL_COLOR_ARRAY);
<a name="l04780"></a>04780     glDisableClientState(GL_VERTEX_ARRAY);
<a name="l04781"></a>04781     glDisableClientState(GL_NORMAL_ARRAY);
<a name="l04782"></a>04782 
<a name="l04783"></a>04783     <span class="keywordflow">if</span> (states)
<a name="l04784"></a>04784         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(states);
<a name="l04785"></a>04785 
<a name="l04786"></a>04786     psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a947c785248ab9746099a34c8bc093e8f">flag</a> &amp;= ~<a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a62f17f5c32eeb28429a0b04904213b75">PSYS_DRAWING</a>;
<a name="l04787"></a>04787 
<a name="l04788"></a>04788     <span class="comment">/* draw data can&#39;t be saved for billboards as they must update to target changes */</span>
<a name="l04789"></a>04789     <span class="keywordflow">if</span> (draw_as == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ae46a1d9cf35516920db6554623ff6369">PART_DRAW_BB</a>) {
<a name="l04790"></a>04790         <a class="code" href="../../db/dca/BKE__particle_8h.html#ac6b0f2bf9fba3a6722c26a397ebe7710">psys_free_pdd</a>(psys);
<a name="l04791"></a>04791         pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a4eba3a0cda18872b81547eeac9e4e8d7">flag</a> &amp;= ~<a class="code" href="../../db/dca/BKE__particle_8h.html#a1a450d97b58cdae347e7d4271813e3d5">PARTICLE_DRAW_DATA_UPDATED</a>;
<a name="l04792"></a>04792     }
<a name="l04793"></a>04793 
<a name="l04794"></a>04794     <span class="keywordflow">if</span> (psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#aea69f41b4be4c08a4e87060a1769fba5">lattice</a>) {
<a name="l04795"></a>04795         <a class="code" href="../../d8/d8f/BKE__lattice_8h.html#af27478b3dea330c98efca2fec9bf70a3">end_latt_deform</a>(psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#aea69f41b4be4c08a4e87060a1769fba5">lattice</a>);
<a name="l04796"></a>04796         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#aea69f41b4be4c08a4e87060a1769fba5">lattice</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04797"></a>04797     }
<a name="l04798"></a>04798 
<a name="l04799"></a>04799     <span class="keywordflow">if</span> (pdd) {
<a name="l04800"></a>04800         <span class="comment">/* drop references to stack memory */</span>
<a name="l04801"></a>04801         pdd-&gt;<a class="code" href="../../d0/df1/structParticleDrawData.html#a2ca51ba90921eb169d1a30281dd9169a">ma_col</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04802"></a>04802     }
<a name="l04803"></a>04803 
<a name="l04804"></a>04804     <span class="keywordflow">if</span> ( (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ac31d50d415c660a44c0ccdc6b4854721">OB_FROMDUPLI</a>) &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9588748603be4778a9197f7edbf356d4">OB_FROMGROUP</a>) ) {
<a name="l04805"></a>04805         <a class="code" href="../../dd/d44/BIF__gl_8h.html#a968938b254020ac622d83a3ab1226f4a">glLoadMatrixf</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ad04178a1375cc4ef5c59a76b723f822f">viewmat</a>);
<a name="l04806"></a>04806     }
<a name="l04807"></a>04807 }
<a name="l04808"></a>04808 
<a name="l04809"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a7c469e2c089768a1b0b547f28ffd62f1">04809</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a7c469e2c089768a1b0b547f28ffd62f1">draw_update_ptcache_edit</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d7/d0e/structPTCacheEdit.html">PTCacheEdit</a> *edit)
<a name="l04810"></a>04810 {
<a name="l04811"></a>04811     <span class="keywordflow">if</span> (edit-&gt;<a class="code" href="../../d7/d0e/structPTCacheEdit.html#a6f0e603624cf89a84b5cf2615971549f">psys</a> &amp;&amp; edit-&gt;<a class="code" href="../../d7/d0e/structPTCacheEdit.html#a6f0e603624cf89a84b5cf2615971549f">psys</a>-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a947c785248ab9746099a34c8bc093e8f">flag</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ae7f51c5045d66192c7ea9f5c4c9b9c35">PSYS_HAIR_UPDATED</a>)
<a name="l04812"></a>04812         <a class="code" href="../../d3/db9/ED__particle_8h.html#a7e1da80d51544c33376b8065e50195e4">PE_update_object</a>(scene, ob, 0);
<a name="l04813"></a>04813 
<a name="l04814"></a>04814     <span class="comment">/* create path and child path cache if it doesn&#39;t exist already */</span>
<a name="l04815"></a>04815     <span class="keywordflow">if</span> (edit-&gt;<a class="code" href="../../d7/d0e/structPTCacheEdit.html#a44144da61c9d8a7065f82a2ca000cc12">pathcache</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l04816"></a>04816         <a class="code" href="../../db/dca/BKE__particle_8h.html#ad7610d2e8a23d0d426cd6e60e42e72ec">psys_cache_edit_paths</a>(scene, ob, edit, <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a>);
<a name="l04817"></a>04817 }
<a name="l04818"></a>04818 
<a name="l04819"></a><a class="code" href="../../d3/d02/drawobject_8c.html#aecee1250134aa1f1f469d8acfbb76c81">04819</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#aecee1250134aa1f1f469d8acfbb76c81">draw_ptcache_edit</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../d7/d0e/structPTCacheEdit.html">PTCacheEdit</a> *edit)
<a name="l04820"></a>04820 {
<a name="l04821"></a>04821     <a class="code" href="../../d1/d8d/structParticleCacheKey.html">ParticleCacheKey</a> **cache, *path, *pkey;
<a name="l04822"></a>04822     <a class="code" href="../../d0/d2e/structPTCacheEditPoint.html">PTCacheEditPoint</a> *<a class="code" href="../../d8/dae/structpoint.html">point</a>;
<a name="l04823"></a>04823     <a class="code" href="../../dc/d1f/structPTCacheEditKey.html">PTCacheEditKey</a> *key;
<a name="l04824"></a>04824     <a class="code" href="../../df/db7/structParticleEditSettings.html">ParticleEditSettings</a> *pset = <a class="code" href="../../d3/db9/ED__particle_8h.html#a86d0b6facbed912844fcc9d3d6df82f2">PE_settings</a>(scene);
<a name="l04825"></a>04825     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, k, totpoint = edit-&gt;<a class="code" href="../../d7/d0e/structPTCacheEdit.html#ac0bb56531a0ca85ed5fe6cc56e649dc8">totpoint</a>, timed = pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#a3bfdff8f61248e79650bdf43d58b165c">flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a92749a9831c2cbf00b9ca3b6cc356982">PE_FADE_TIME</a> ? pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#abfb82a67439a09c0e98209b54516d8e8">fade_frames</a> : 0;
<a name="l04826"></a>04826     <span class="keywordtype">int</span> steps = 1;
<a name="l04827"></a>04827     <span class="keywordtype">float</span> sel_col[3];
<a name="l04828"></a>04828     <span class="keywordtype">float</span> nosel_col[3];
<a name="l04829"></a>04829     <span class="keywordtype">float</span> *pathcol = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *pcol;
<a name="l04830"></a>04830 
<a name="l04831"></a>04831     <span class="keywordflow">if</span> (edit-&gt;<a class="code" href="../../d7/d0e/structPTCacheEdit.html#a44144da61c9d8a7065f82a2ca000cc12">pathcache</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l04832"></a>04832         <span class="keywordflow">return</span>;
<a name="l04833"></a>04833 
<a name="l04834"></a>04834     <a class="code" href="../../d3/db9/ED__particle_8h.html#a20774a39229344ca2d18c85116c627e3">PE_hide_keys_time</a>(scene, edit, <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a>);
<a name="l04835"></a>04835 
<a name="l04836"></a>04836     <span class="comment">/* opengl setup */</span>
<a name="l04837"></a>04837     <span class="keywordflow">if</span> ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a97a32d38ce1481d61d60dc677693ce5d">flag</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#ab80fcf8e0e16083a2ef8e7ca72cb6a39">V3D_ZBUF_SELECT</a>) == 0)
<a name="l04838"></a>04838         glDisable(GL_DEPTH_TEST);
<a name="l04839"></a>04839 
<a name="l04840"></a>04840     <span class="comment">/* get selection theme colors */</span>
<a name="l04841"></a>04841     <a class="code" href="../../de/d96/UI__resources_8h.html#a986d2ffa67e027bb858e453c1fd3d055">UI_GetThemeColor3fv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a99466ebe41be745cf51950acc8423924">TH_VERTEX_SELECT</a>, sel_col);
<a name="l04842"></a>04842     <a class="code" href="../../de/d96/UI__resources_8h.html#a986d2ffa67e027bb858e453c1fd3d055">UI_GetThemeColor3fv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a6933328b6df4400c196ee99ddd608afd">TH_VERTEX</a>, nosel_col);
<a name="l04843"></a>04843 
<a name="l04844"></a>04844     <span class="comment">/* draw paths */</span>
<a name="l04845"></a>04845     <span class="keywordflow">if</span> (timed) {
<a name="l04846"></a>04846         glEnable(GL_BLEND);
<a name="l04847"></a>04847         steps = (*edit-&gt;<a class="code" href="../../d7/d0e/structPTCacheEdit.html#a44144da61c9d8a7065f82a2ca000cc12">pathcache</a>)-&gt;steps + 1;
<a name="l04848"></a>04848         pathcol = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(steps * 4 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), <span class="stringliteral">&quot;particle path color data&quot;</span>);
<a name="l04849"></a>04849     }
<a name="l04850"></a>04850 
<a name="l04851"></a>04851     glEnableClientState(GL_VERTEX_ARRAY);
<a name="l04852"></a>04852     glEnableClientState(GL_COLOR_ARRAY);
<a name="l04853"></a>04853 
<a name="l04854"></a>04854     glColorMaterial(GL_FRONT_AND_BACK, GL_DIFFUSE);
<a name="l04855"></a>04855     glEnable(GL_COLOR_MATERIAL);
<a name="l04856"></a>04856     glShadeModel(GL_SMOOTH);
<a name="l04857"></a>04857 
<a name="l04858"></a>04858     <span class="keywordflow">if</span> (pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#a5a8b3fad8136f57241b3e47e30abbec1">brushtype</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ab4e10642ea49f898b957b26871697591">PE_BRUSH_WEIGHT</a>) {
<a name="l04859"></a>04859         glLineWidth(2.0f);
<a name="l04860"></a>04860         glDisable(GL_LIGHTING);
<a name="l04861"></a>04861     }
<a name="l04862"></a>04862 
<a name="l04863"></a>04863     cache = edit-&gt;<a class="code" href="../../d7/d0e/structPTCacheEdit.html#a44144da61c9d8a7065f82a2ca000cc12">pathcache</a>;
<a name="l04864"></a>04864     <span class="keywordflow">for</span> (i = 0; i &lt; totpoint; i++) {
<a name="l04865"></a>04865         path = cache[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l04866"></a>04866         glVertexPointer(3, GL_FLOAT, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d8d/structParticleCacheKey.html">ParticleCacheKey</a>), path-&gt;<a class="code" href="../../d1/d8d/structParticleCacheKey.html#a7e45c47581f6d4b4c54daa32943e984a">co</a>);
<a name="l04867"></a>04867 
<a name="l04868"></a>04868         <span class="keywordflow">if</span> (timed) {
<a name="l04869"></a>04869             <span class="keywordflow">for</span> (k = 0, pcol = pathcol, pkey = path; k &lt; steps; k++, pkey++, pcol += 4) {
<a name="l04870"></a>04870                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pcol, pkey-&gt;col);
<a name="l04871"></a>04871                 pcol[3] = 1.0f - <a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>((<span class="keywordtype">float</span>)(<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a>) -pkey-&gt;time) / (float)pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#abfb82a67439a09c0e98209b54516d8e8">fade_frames</a>;
<a name="l04872"></a>04872             }
<a name="l04873"></a>04873 
<a name="l04874"></a>04874             glColorPointer(4, GL_FLOAT, 4 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), pathcol);
<a name="l04875"></a>04875         }
<a name="l04876"></a>04876         <span class="keywordflow">else</span>
<a name="l04877"></a>04877             glColorPointer(3, GL_FLOAT, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d8d/structParticleCacheKey.html">ParticleCacheKey</a>), path-&gt;<a class="code" href="../../d1/d8d/structParticleCacheKey.html#ad92582f6fe66357ec97a5c7fe613c809">col</a>);
<a name="l04878"></a>04878 
<a name="l04879"></a>04879         glDrawArrays(GL_LINE_STRIP, 0, path-&gt;<a class="code" href="../../d1/d8d/structParticleCacheKey.html#a62384f087dce67cd6bc170116446f531">steps</a> + 1);
<a name="l04880"></a>04880     }
<a name="l04881"></a>04881 
<a name="l04882"></a>04882     <span class="keywordflow">if</span> (pathcol) { <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(pathcol); pathcol = pcol = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; }
<a name="l04883"></a>04883 
<a name="l04884"></a>04884 
<a name="l04885"></a>04885     <span class="comment">/* draw edit vertices */</span>
<a name="l04886"></a>04886     <span class="keywordflow">if</span> (pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#a1ec9fc0bf8c9038769de37144f7099da">selectmode</a> != <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a25a19c97747b2f50583d8bf6298cfc68">SCE_SELECT_PATH</a>) {
<a name="l04887"></a>04887         glPointSize(<a class="code" href="../../de/d96/UI__resources_8h.html#ad9772e3578b739880ada62a6d21f4349">UI_GetThemeValuef</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a6c88c69347ab72b259eb7fcc8885327b">TH_VERTEX_SIZE</a>));
<a name="l04888"></a>04888 
<a name="l04889"></a>04889         <span class="keywordflow">if</span> (pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#a1ec9fc0bf8c9038769de37144f7099da">selectmode</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a777556399722dabfd6a730bbf91bc5e5">SCE_SELECT_POINT</a>) {
<a name="l04890"></a>04890             <span class="keywordtype">float</span> *pd = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *pdata = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04891"></a>04891             <span class="keywordtype">float</span> *cd = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *cdata = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04892"></a>04892             <span class="keywordtype">int</span> totkeys = 0;
<a name="l04893"></a>04893 
<a name="l04894"></a>04894             <span class="keywordflow">for</span> (i = 0, point = edit-&gt;<a class="code" href="../../d7/d0e/structPTCacheEdit.html#a5f0bf35d3fac54cb9ac4a52804991bc5">points</a>; i &lt; totpoint; i++, point++)
<a name="l04895"></a>04895                 <span class="keywordflow">if</span> (!(point-&gt;<a class="code" href="../../d0/d2e/structPTCacheEditPoint.html#ad8079a32c677f9118e38e138c6723925">flag</a> &amp; <a class="code" href="../../db/d45/BKE__pointcache_8h.html#a6f4d98a551c48085fc9660300ca71068">PEP_HIDE</a>))
<a name="l04896"></a>04896                     totkeys += point-&gt;<a class="code" href="../../d0/d2e/structPTCacheEditPoint.html#a2c9f1f11d166e5964ea7b3025cb6ccc2">totkey</a>;
<a name="l04897"></a>04897 
<a name="l04898"></a>04898             <span class="keywordflow">if</span> (edit-&gt;<a class="code" href="../../d7/d0e/structPTCacheEdit.html#a5f0bf35d3fac54cb9ac4a52804991bc5">points</a> &amp;&amp; !(edit-&gt;<a class="code" href="../../d7/d0e/structPTCacheEdit.html#a5f0bf35d3fac54cb9ac4a52804991bc5">points</a>-&gt;<a class="code" href="../../d0/d2e/structPTCacheEditPoint.html#a432a04cbd1fe4e05861d7cbc82fe0fcd">keys</a>-&gt;<a class="code" href="../../dc/d1f/structPTCacheEditKey.html#a81f5e0b9e210ed324092f769f5f752a7">flag</a> &amp; <a class="code" href="../../db/d45/BKE__pointcache_8h.html#af0fddeff6d2e9d6961c0eb55d17871e5">PEK_USE_WCO</a>))
<a name="l04899"></a>04899                 pd = pdata = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(totkeys * 3 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), <span class="stringliteral">&quot;particle edit point data&quot;</span>);
<a name="l04900"></a>04900             cd = cdata = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(totkeys * (timed ? 4 : 3) * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), <span class="stringliteral">&quot;particle edit color data&quot;</span>);
<a name="l04901"></a>04901 
<a name="l04902"></a>04902             <span class="keywordflow">for</span> (i = 0, point = edit-&gt;<a class="code" href="../../d7/d0e/structPTCacheEdit.html#a5f0bf35d3fac54cb9ac4a52804991bc5">points</a>; i &lt; totpoint; i++, point++) {
<a name="l04903"></a>04903                 <span class="keywordflow">if</span> (point-&gt;<a class="code" href="../../d0/d2e/structPTCacheEditPoint.html#ad8079a32c677f9118e38e138c6723925">flag</a> &amp; <a class="code" href="../../db/d45/BKE__pointcache_8h.html#a6f4d98a551c48085fc9660300ca71068">PEP_HIDE</a>)
<a name="l04904"></a>04904                     <span class="keywordflow">continue</span>;
<a name="l04905"></a>04905 
<a name="l04906"></a>04906                 <span class="keywordflow">for</span> (k = 0, key = point-&gt;<a class="code" href="../../d0/d2e/structPTCacheEditPoint.html#a432a04cbd1fe4e05861d7cbc82fe0fcd">keys</a>; k &lt; point-&gt;totkey; k++, key++) {
<a name="l04907"></a>04907                     <span class="keywordflow">if</span> (pd) {
<a name="l04908"></a>04908                         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(pd, key-&gt;<a class="code" href="../../dc/d1f/structPTCacheEditKey.html#adcbee937bfac0b462d93c2514da1a34c">co</a>);
<a name="l04909"></a>04909                         pd += 3;
<a name="l04910"></a>04910                     }
<a name="l04911"></a>04911 
<a name="l04912"></a>04912                     <span class="keywordflow">if</span> (key-&gt;<a class="code" href="../../dc/d1f/structPTCacheEditKey.html#a81f5e0b9e210ed324092f769f5f752a7">flag</a> &amp; <a class="code" href="../../db/d45/BKE__pointcache_8h.html#ad4de69f91bcf4b4fca0193d764032249">PEK_SELECT</a>) {
<a name="l04913"></a>04913                         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(cd, sel_col);
<a name="l04914"></a>04914                     }
<a name="l04915"></a>04915                     <span class="keywordflow">else</span> {
<a name="l04916"></a>04916                         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(cd, nosel_col);
<a name="l04917"></a>04917                     }
<a name="l04918"></a>04918 
<a name="l04919"></a>04919                     <span class="keywordflow">if</span> (timed)
<a name="l04920"></a>04920                         *(cd + 3) = 1.0f - <a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>((<span class="keywordtype">float</span>)<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a> - *key-&gt;<a class="code" href="../../dc/d1f/structPTCacheEditKey.html#ab55cdbdf1896248a488eec019c50296a">time</a>) / (<span class="keywordtype">float</span>)pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#abfb82a67439a09c0e98209b54516d8e8">fade_frames</a>;
<a name="l04921"></a>04921 
<a name="l04922"></a>04922                     cd += (timed ? 4 : 3);
<a name="l04923"></a>04923                 }
<a name="l04924"></a>04924             }
<a name="l04925"></a>04925             cd = cdata;
<a name="l04926"></a>04926             pd = pdata;
<a name="l04927"></a>04927             <span class="keywordflow">for</span> (i = 0, point = edit-&gt;<a class="code" href="../../d7/d0e/structPTCacheEdit.html#a5f0bf35d3fac54cb9ac4a52804991bc5">points</a>; i &lt; totpoint; i++, point++) {
<a name="l04928"></a>04928                 <span class="keywordflow">if</span> (point-&gt;<a class="code" href="../../d0/d2e/structPTCacheEditPoint.html#ad8079a32c677f9118e38e138c6723925">flag</a> &amp; <a class="code" href="../../db/d45/BKE__pointcache_8h.html#a6f4d98a551c48085fc9660300ca71068">PEP_HIDE</a> || point-&gt;<a class="code" href="../../d0/d2e/structPTCacheEditPoint.html#a2c9f1f11d166e5964ea7b3025cb6ccc2">totkey</a> == 0)
<a name="l04929"></a>04929                     <span class="keywordflow">continue</span>;
<a name="l04930"></a>04930 
<a name="l04931"></a>04931                 <span class="keywordflow">if</span> (point-&gt;<a class="code" href="../../d0/d2e/structPTCacheEditPoint.html#a432a04cbd1fe4e05861d7cbc82fe0fcd">keys</a>-&gt;<a class="code" href="../../dc/d1f/structPTCacheEditKey.html#a81f5e0b9e210ed324092f769f5f752a7">flag</a> &amp; <a class="code" href="../../db/d45/BKE__pointcache_8h.html#af0fddeff6d2e9d6961c0eb55d17871e5">PEK_USE_WCO</a>)
<a name="l04932"></a>04932                     glVertexPointer(3, GL_FLOAT, <span class="keyword">sizeof</span>(<a class="code" href="../../dc/d1f/structPTCacheEditKey.html">PTCacheEditKey</a>), point-&gt;<a class="code" href="../../d0/d2e/structPTCacheEditPoint.html#a432a04cbd1fe4e05861d7cbc82fe0fcd">keys</a>-&gt;<a class="code" href="../../dc/d1f/structPTCacheEditKey.html#ab1ca3e5afe9cfe6447d30f90c651b4d7">world_co</a>);
<a name="l04933"></a>04933                 <span class="keywordflow">else</span>
<a name="l04934"></a>04934                     glVertexPointer(3, GL_FLOAT, 3 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), pd);
<a name="l04935"></a>04935 
<a name="l04936"></a>04936                 glColorPointer((timed ? 4 : 3), GL_FLOAT, (timed ? 4 : 3) * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), cd);
<a name="l04937"></a>04937 
<a name="l04938"></a>04938                 glDrawArrays(GL_POINTS, 0, point-&gt;<a class="code" href="../../d0/d2e/structPTCacheEditPoint.html#a2c9f1f11d166e5964ea7b3025cb6ccc2">totkey</a>);
<a name="l04939"></a>04939 
<a name="l04940"></a>04940                 pd += pd ? 3 * point-&gt;<a class="code" href="../../d0/d2e/structPTCacheEditPoint.html#a2c9f1f11d166e5964ea7b3025cb6ccc2">totkey</a> : 0;
<a name="l04941"></a>04941                 cd += (timed ? 4 : 3) * point-&gt;<a class="code" href="../../d0/d2e/structPTCacheEditPoint.html#a2c9f1f11d166e5964ea7b3025cb6ccc2">totkey</a>;
<a name="l04942"></a>04942             }
<a name="l04943"></a>04943             <span class="keywordflow">if</span> (pdata) { <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(pdata); pd = pdata = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; }
<a name="l04944"></a>04944             <span class="keywordflow">if</span> (cdata) { <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cdata); cd = cdata = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; }
<a name="l04945"></a>04945         }
<a name="l04946"></a>04946         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pset-&gt;<a class="code" href="../../df/db7/structParticleEditSettings.html#a1ec9fc0bf8c9038769de37144f7099da">selectmode</a> == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a6518af8455eb5372b6380e50c7a4002b">SCE_SELECT_END</a>) {
<a name="l04947"></a>04947             <span class="keywordflow">for</span> (i = 0, point = edit-&gt;<a class="code" href="../../d7/d0e/structPTCacheEdit.html#a5f0bf35d3fac54cb9ac4a52804991bc5">points</a>; i &lt; totpoint; i++, point++) {
<a name="l04948"></a>04948                 <span class="keywordflow">if</span> ((point-&gt;<a class="code" href="../../d0/d2e/structPTCacheEditPoint.html#ad8079a32c677f9118e38e138c6723925">flag</a> &amp; <a class="code" href="../../db/d45/BKE__pointcache_8h.html#a6f4d98a551c48085fc9660300ca71068">PEP_HIDE</a>) == 0 &amp;&amp; point-&gt;<a class="code" href="../../d0/d2e/structPTCacheEditPoint.html#a2c9f1f11d166e5964ea7b3025cb6ccc2">totkey</a>) {
<a name="l04949"></a>04949                     key = point-&gt;<a class="code" href="../../d0/d2e/structPTCacheEditPoint.html#a432a04cbd1fe4e05861d7cbc82fe0fcd">keys</a> + point-&gt;<a class="code" href="../../d0/d2e/structPTCacheEditPoint.html#a2c9f1f11d166e5964ea7b3025cb6ccc2">totkey</a> - 1;
<a name="l04950"></a>04950                     <span class="keywordflow">if</span> (key-&gt;<a class="code" href="../../dc/d1f/structPTCacheEditKey.html#a81f5e0b9e210ed324092f769f5f752a7">flag</a> &amp; <a class="code" href="../../db/d45/BKE__pointcache_8h.html#ad4de69f91bcf4b4fca0193d764032249">PEK_SELECT</a>)
<a name="l04951"></a>04951                         glColor3fv(sel_col);
<a name="l04952"></a>04952                     <span class="keywordflow">else</span>
<a name="l04953"></a>04953                         glColor3fv(nosel_col);
<a name="l04954"></a>04954                     <span class="comment">/* has to be like this.. otherwise selection won&#39;t work, have try glArrayElement later..*/</span>
<a name="l04955"></a>04955                     glBegin(GL_POINTS);
<a name="l04956"></a>04956                     glVertex3fv(key-&gt;<a class="code" href="../../dc/d1f/structPTCacheEditKey.html#a81f5e0b9e210ed324092f769f5f752a7">flag</a> &amp; <a class="code" href="../../db/d45/BKE__pointcache_8h.html#af0fddeff6d2e9d6961c0eb55d17871e5">PEK_USE_WCO</a> ? key-&gt;<a class="code" href="../../dc/d1f/structPTCacheEditKey.html#ab1ca3e5afe9cfe6447d30f90c651b4d7">world_co</a> : key-&gt;<a class="code" href="../../dc/d1f/structPTCacheEditKey.html#adcbee937bfac0b462d93c2514da1a34c">co</a>);
<a name="l04957"></a>04957                     glEnd();
<a name="l04958"></a>04958                 }
<a name="l04959"></a>04959             }
<a name="l04960"></a>04960         }
<a name="l04961"></a>04961     }
<a name="l04962"></a>04962 
<a name="l04963"></a>04963     glDisable(GL_BLEND);
<a name="l04964"></a>04964     glDisable(GL_LIGHTING);
<a name="l04965"></a>04965     glDisable(GL_COLOR_MATERIAL);
<a name="l04966"></a>04966     glDisableClientState(GL_COLOR_ARRAY);
<a name="l04967"></a>04967     glDisableClientState(GL_NORMAL_ARRAY);
<a name="l04968"></a>04968     glDisableClientState(GL_VERTEX_ARRAY);
<a name="l04969"></a>04969     glShadeModel(GL_FLAT);
<a name="l04970"></a>04970     <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#afd443bfd0de5169661f08aa1eeb3bd69">zbuf</a>) glEnable(GL_DEPTH_TEST);
<a name="l04971"></a>04971     glLineWidth(1.0f);
<a name="l04972"></a>04972     glPointSize(1.0);
<a name="l04973"></a>04973 }
<a name="l04974"></a>04974 <span class="comment">//static void ob_draw_RE_motion(float com[3],float rotscale[3][3],float tw,float th)</span>
<a name="l04975"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a511dfc398b53b6f78100e5241e01918c">04975</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a511dfc398b53b6f78100e5241e01918c">ob_draw_RE_motion</a>(<span class="keywordtype">float</span> com[3], <span class="keywordtype">float</span> rotscale[3][3], <span class="keywordtype">float</span> itw, <span class="keywordtype">float</span> ith, <span class="keywordtype">float</span> drw_size)
<a name="l04976"></a>04976 {
<a name="l04977"></a>04977     <span class="keywordtype">float</span> tr[3][3];
<a name="l04978"></a>04978     <span class="keywordtype">float</span> root[3], tip[3];
<a name="l04979"></a>04979     <span class="keywordtype">float</span> tw, th;
<a name="l04980"></a>04980     <span class="comment">/* take a copy for not spoiling original */</span>
<a name="l04981"></a>04981     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aceb90dff38c8c92e00335f2da648d61e">copy_m3_m3</a>(tr, rotscale);
<a name="l04982"></a>04982     tw = itw * drw_size;
<a name="l04983"></a>04983     th = ith * drw_size;
<a name="l04984"></a>04984 
<a name="l04985"></a>04985     glColor4ub(0x7F, 0x00, 0x00, 155);
<a name="l04986"></a>04986     glBegin(GL_LINES);
<a name="l04987"></a>04987     root[1] = root[2] = 0.0f;
<a name="l04988"></a>04988     root[0] = -drw_size;
<a name="l04989"></a>04989     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tr, root);
<a name="l04990"></a>04990     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(root, com);
<a name="l04991"></a>04991     glVertex3fv(root);
<a name="l04992"></a>04992     tip[1] = tip[2] = 0.0f;
<a name="l04993"></a>04993     tip[0] = drw_size;
<a name="l04994"></a>04994     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tr, tip);
<a name="l04995"></a>04995     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(tip, com);
<a name="l04996"></a>04996     glVertex3fv(tip);
<a name="l04997"></a>04997     glEnd();
<a name="l04998"></a>04998 
<a name="l04999"></a>04999     root[1] = 0.0f; root[2] = tw;
<a name="l05000"></a>05000     root[0] = th;
<a name="l05001"></a>05001     glBegin(GL_LINES);
<a name="l05002"></a>05002     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tr, root);
<a name="l05003"></a>05003     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(root, com);
<a name="l05004"></a>05004     glVertex3fv(root);
<a name="l05005"></a>05005     glVertex3fv(tip);
<a name="l05006"></a>05006     glEnd();
<a name="l05007"></a>05007 
<a name="l05008"></a>05008     root[1] = 0.0f; root[2] = -tw;
<a name="l05009"></a>05009     root[0] = th;
<a name="l05010"></a>05010     glBegin(GL_LINES);
<a name="l05011"></a>05011     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tr, root);
<a name="l05012"></a>05012     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(root, com);
<a name="l05013"></a>05013     glVertex3fv(root);
<a name="l05014"></a>05014     glVertex3fv(tip);
<a name="l05015"></a>05015     glEnd();
<a name="l05016"></a>05016 
<a name="l05017"></a>05017     root[1] = tw; root[2] = 0.0f;
<a name="l05018"></a>05018     root[0] = th;
<a name="l05019"></a>05019     glBegin(GL_LINES);
<a name="l05020"></a>05020     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tr, root);
<a name="l05021"></a>05021     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(root, com);
<a name="l05022"></a>05022     glVertex3fv(root);
<a name="l05023"></a>05023     glVertex3fv(tip);
<a name="l05024"></a>05024     glEnd();
<a name="l05025"></a>05025 
<a name="l05026"></a>05026     root[1] = -tw; root[2] = 0.0f;
<a name="l05027"></a>05027     root[0] = th;
<a name="l05028"></a>05028     glBegin(GL_LINES);
<a name="l05029"></a>05029     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tr, root);
<a name="l05030"></a>05030     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(root, com);
<a name="l05031"></a>05031     glVertex3fv(root);
<a name="l05032"></a>05032     glVertex3fv(tip);
<a name="l05033"></a>05033     glEnd();
<a name="l05034"></a>05034 
<a name="l05035"></a>05035     glColor4ub(0x00, 0x7F, 0x00, 155);
<a name="l05036"></a>05036 
<a name="l05037"></a>05037     glBegin(GL_LINES);
<a name="l05038"></a>05038     root[0] = root[2] = 0.0f;
<a name="l05039"></a>05039     root[1] = -drw_size;
<a name="l05040"></a>05040     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tr, root);
<a name="l05041"></a>05041     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(root, com);
<a name="l05042"></a>05042     glVertex3fv(root);
<a name="l05043"></a>05043     tip[0] = tip[2] = 0.0f;
<a name="l05044"></a>05044     tip[1] = drw_size;
<a name="l05045"></a>05045     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tr, tip);
<a name="l05046"></a>05046     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(tip, com);
<a name="l05047"></a>05047     glVertex3fv(tip);
<a name="l05048"></a>05048     glEnd();
<a name="l05049"></a>05049 
<a name="l05050"></a>05050     root[0] = 0.0f; root[2] = tw;
<a name="l05051"></a>05051     root[1] = th;
<a name="l05052"></a>05052     glBegin(GL_LINES);
<a name="l05053"></a>05053     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tr, root);
<a name="l05054"></a>05054     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(root, com);
<a name="l05055"></a>05055     glVertex3fv(root);
<a name="l05056"></a>05056     glVertex3fv(tip);
<a name="l05057"></a>05057     glEnd();
<a name="l05058"></a>05058 
<a name="l05059"></a>05059     root[0] = 0.0f; root[2] = -tw;
<a name="l05060"></a>05060     root[1] = th;
<a name="l05061"></a>05061     glBegin(GL_LINES);
<a name="l05062"></a>05062     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tr, root);
<a name="l05063"></a>05063     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(root, com);
<a name="l05064"></a>05064     glVertex3fv(root);
<a name="l05065"></a>05065     glVertex3fv(tip);
<a name="l05066"></a>05066     glEnd();
<a name="l05067"></a>05067 
<a name="l05068"></a>05068     root[0] = tw; root[2] = 0.0f;
<a name="l05069"></a>05069     root[1] = th;
<a name="l05070"></a>05070     glBegin(GL_LINES);
<a name="l05071"></a>05071     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tr, root);
<a name="l05072"></a>05072     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(root, com);
<a name="l05073"></a>05073     glVertex3fv(root);
<a name="l05074"></a>05074     glVertex3fv(tip);
<a name="l05075"></a>05075     glEnd();
<a name="l05076"></a>05076 
<a name="l05077"></a>05077     root[0] = -tw; root[2] = 0.0f;
<a name="l05078"></a>05078     root[1] = th;
<a name="l05079"></a>05079     glBegin(GL_LINES);
<a name="l05080"></a>05080     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tr, root);
<a name="l05081"></a>05081     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(root, com);
<a name="l05082"></a>05082     glVertex3fv(root);
<a name="l05083"></a>05083     glVertex3fv(tip);
<a name="l05084"></a>05084     glEnd();
<a name="l05085"></a>05085 
<a name="l05086"></a>05086     glColor4ub(0x00, 0x00, 0x7F, 155);
<a name="l05087"></a>05087     glBegin(GL_LINES);
<a name="l05088"></a>05088     root[0] = root[1] = 0.0f;
<a name="l05089"></a>05089     root[2] = -drw_size;
<a name="l05090"></a>05090     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tr, root);
<a name="l05091"></a>05091     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(root, com);
<a name="l05092"></a>05092     glVertex3fv(root);
<a name="l05093"></a>05093     tip[0] = tip[1] = 0.0f;
<a name="l05094"></a>05094     tip[2] = drw_size;
<a name="l05095"></a>05095     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tr, tip);
<a name="l05096"></a>05096     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(tip, com);
<a name="l05097"></a>05097     glVertex3fv(tip);
<a name="l05098"></a>05098     glEnd();
<a name="l05099"></a>05099 
<a name="l05100"></a>05100     root[0] = 0.0f; root[1] = tw;
<a name="l05101"></a>05101     root[2] = th;
<a name="l05102"></a>05102     glBegin(GL_LINES);
<a name="l05103"></a>05103     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tr, root);
<a name="l05104"></a>05104     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(root, com);
<a name="l05105"></a>05105     glVertex3fv(root);
<a name="l05106"></a>05106     glVertex3fv(tip);
<a name="l05107"></a>05107     glEnd();
<a name="l05108"></a>05108 
<a name="l05109"></a>05109     root[0] = 0.0f; root[1] = -tw;
<a name="l05110"></a>05110     root[2] = th;
<a name="l05111"></a>05111     glBegin(GL_LINES);
<a name="l05112"></a>05112     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tr, root);
<a name="l05113"></a>05113     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(root, com);
<a name="l05114"></a>05114     glVertex3fv(root);
<a name="l05115"></a>05115     glVertex3fv(tip);
<a name="l05116"></a>05116     glEnd();
<a name="l05117"></a>05117 
<a name="l05118"></a>05118     root[0] = tw; root[1] = 0.0f;
<a name="l05119"></a>05119     root[2] = th;
<a name="l05120"></a>05120     glBegin(GL_LINES);
<a name="l05121"></a>05121     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tr, root);
<a name="l05122"></a>05122     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(root, com);
<a name="l05123"></a>05123     glVertex3fv(root);
<a name="l05124"></a>05124     glVertex3fv(tip);
<a name="l05125"></a>05125     glEnd();
<a name="l05126"></a>05126 
<a name="l05127"></a>05127     root[0] = -tw; root[1] = 0.0f;
<a name="l05128"></a>05128     root[2] = th;
<a name="l05129"></a>05129     glBegin(GL_LINES);
<a name="l05130"></a>05130     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(tr, root);
<a name="l05131"></a>05131     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(root, com);
<a name="l05132"></a>05132     glVertex3fv(root);
<a name="l05133"></a>05133     glVertex3fv(tip);
<a name="l05134"></a>05134     glEnd();
<a name="l05135"></a>05135 }
<a name="l05136"></a>05136 
<a name="l05137"></a>05137 <span class="comment">/*place to add drawers */</span>
<a name="l05138"></a>05138 
<a name="l05139"></a><a class="code" href="../../d3/d02/drawobject_8c.html#aaca3ed99ca924ea0398804a01e550c75">05139</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#aaca3ed99ca924ea0398804a01e550c75">tekenhandlesN</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, <span class="keywordtype">short</span> sel, <span class="keywordtype">short</span> hide_handles)
<a name="l05140"></a>05140 {
<a name="l05141"></a>05141     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l05142"></a>05142     <span class="keywordtype">float</span> *fp;
<a name="l05143"></a>05143     <span class="keywordtype">int</span> a;
<a name="l05144"></a>05144 
<a name="l05145"></a>05145     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ac50bf4fd67b2b09d82909961cd25da2f">hide</a> || hide_handles) <span class="keywordflow">return</span>;
<a name="l05146"></a>05146 
<a name="l05147"></a>05147     glBegin(GL_LINES);
<a name="l05148"></a>05148 
<a name="l05149"></a>05149     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l05150"></a>05150 
<a name="l05151"></a>05151 <span class="preprocessor">#define TH_HANDLE_COL_TOT ((TH_HANDLE_SEL_FREE - TH_HANDLE_FREE) + 1)</span>
<a name="l05152"></a>05152 <span class="preprocessor"></span>        <span class="comment">/* use MIN2 when indexing to ensure newer files don&#39;t read outside the array */</span>
<a name="l05153"></a>05153         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> handle_cols[<a class="code" href="../../d3/d02/drawobject_8c.html#a1e394429f86a6421c8429b02eb7874b6">TH_HANDLE_COL_TOT</a>][3];
<a name="l05154"></a>05154         <span class="keyword">const</span> <span class="keywordtype">int</span> basecol = sel ? <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a854958b572de6f7127221d98a787eb59">TH_HANDLE_SEL_FREE</a> : <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531acf9a48b7352e1fd4e9a77211c8f40a36">TH_HANDLE_FREE</a>;
<a name="l05155"></a>05155 
<a name="l05156"></a>05156         <span class="keywordflow">for</span> (a = 0; a &lt; <a class="code" href="../../d3/d02/drawobject_8c.html#a1e394429f86a6421c8429b02eb7874b6">TH_HANDLE_COL_TOT</a>; a++) {
<a name="l05157"></a>05157             <a class="code" href="../../de/d96/UI__resources_8h.html#a7df10cffdef8a2191960e1db949d3f47">UI_GetThemeColor3ubv</a>(basecol + a, handle_cols[a]);
<a name="l05158"></a>05158         }
<a name="l05159"></a>05159 
<a name="l05160"></a>05160         bezt = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l05161"></a>05161         a = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l05162"></a>05162         <span class="keywordflow">while</span> (a--) {
<a name="l05163"></a>05163             <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aaac89168848f34909c578acb0d6cca26">hide</a> == 0) {
<a name="l05164"></a>05164                 <span class="keywordflow">if</span> ( (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) == sel) {
<a name="l05165"></a>05165                     fp = bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0];
<a name="l05166"></a>05166 
<a name="l05167"></a>05167                     glColor3ubv(handle_cols[<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>, TH_HANDLE_COL_TOT - 1)]);
<a name="l05168"></a>05168                     glVertex3fv(fp);
<a name="l05169"></a>05169                     glVertex3fv(fp + 3);
<a name="l05170"></a>05170 
<a name="l05171"></a>05171                     glColor3ubv(handle_cols[<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>, TH_HANDLE_COL_TOT - 1)]);
<a name="l05172"></a>05172                     glVertex3fv(fp + 3);
<a name="l05173"></a>05173                     glVertex3fv(fp + 6);
<a name="l05174"></a>05174                 }
<a name="l05175"></a>05175                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) == sel) {
<a name="l05176"></a>05176                     fp = bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0];
<a name="l05177"></a>05177 
<a name="l05178"></a>05178                     glColor3ubv(handle_cols[<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>, TH_HANDLE_COL_TOT - 1)]);
<a name="l05179"></a>05179                     glVertex3fv(fp);
<a name="l05180"></a>05180                     glVertex3fv(fp + 3);
<a name="l05181"></a>05181                 }
<a name="l05182"></a>05182                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) == sel) {
<a name="l05183"></a>05183                     fp = bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1];
<a name="l05184"></a>05184 
<a name="l05185"></a>05185                     glColor3ubv(handle_cols[<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>, TH_HANDLE_COL_TOT - 1)]);
<a name="l05186"></a>05186                     glVertex3fv(fp);
<a name="l05187"></a>05187                     glVertex3fv(fp + 3);
<a name="l05188"></a>05188                 }
<a name="l05189"></a>05189             }
<a name="l05190"></a>05190             bezt++;
<a name="l05191"></a>05191         }
<a name="l05192"></a>05192 
<a name="l05193"></a>05193 <span class="preprocessor">#undef TH_HANDLE_COL_TOT</span>
<a name="l05194"></a>05194 <span class="preprocessor"></span>
<a name="l05195"></a>05195     }
<a name="l05196"></a>05196     glEnd();
<a name="l05197"></a>05197 }
<a name="l05198"></a>05198 
<a name="l05199"></a><a class="code" href="../../d3/d02/drawobject_8c.html#aa8033681e2a0807093b900cba7e38aba">05199</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#aa8033681e2a0807093b900cba7e38aba">tekenhandlesN_active</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l05200"></a>05200 {
<a name="l05201"></a>05201     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l05202"></a>05202     <span class="keywordtype">float</span> *fp;
<a name="l05203"></a>05203     <span class="keywordtype">int</span> a;
<a name="l05204"></a>05204 
<a name="l05205"></a>05205     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ac50bf4fd67b2b09d82909961cd25da2f">hide</a>) <span class="keywordflow">return</span>;
<a name="l05206"></a>05206 
<a name="l05207"></a>05207     <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a4a65da48d83dfff7570ba52924d0babc">TH_ACTIVE_SPLINE</a>);
<a name="l05208"></a>05208     glLineWidth(2);
<a name="l05209"></a>05209 
<a name="l05210"></a>05210     glBegin(GL_LINES);
<a name="l05211"></a>05211 
<a name="l05212"></a>05212     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l05213"></a>05213         bezt = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l05214"></a>05214         a = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l05215"></a>05215         <span class="keywordflow">while</span> (a--) {
<a name="l05216"></a>05216             <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aaac89168848f34909c578acb0d6cca26">hide</a> == 0) {
<a name="l05217"></a>05217                 fp = bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0];
<a name="l05218"></a>05218 
<a name="l05219"></a>05219                 glVertex3fv(fp);
<a name="l05220"></a>05220                 glVertex3fv(fp + 3);
<a name="l05221"></a>05221 
<a name="l05222"></a>05222                 glVertex3fv(fp + 3);
<a name="l05223"></a>05223                 glVertex3fv(fp + 6);
<a name="l05224"></a>05224             }
<a name="l05225"></a>05225             bezt++;
<a name="l05226"></a>05226         }
<a name="l05227"></a>05227     }
<a name="l05228"></a>05228     glEnd();
<a name="l05229"></a>05229 
<a name="l05230"></a>05230     glColor3ub(0, 0, 0);
<a name="l05231"></a>05231     glLineWidth(1);
<a name="l05232"></a>05232 }
<a name="l05233"></a>05233 
<a name="l05234"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a3a5571aa334fecf8281ae209e6ad61dd">05234</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a3a5571aa334fecf8281ae209e6ad61dd">tekenvertsN</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, <span class="keywordtype">short</span> sel, <span class="keywordtype">short</span> hide_handles, <span class="keywordtype">void</span> *lastsel)
<a name="l05235"></a>05235 {
<a name="l05236"></a>05236     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l05237"></a>05237     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l05238"></a>05238     <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l05239"></a>05239     <span class="keywordtype">int</span> a, color;
<a name="l05240"></a>05240 
<a name="l05241"></a>05241     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ac50bf4fd67b2b09d82909961cd25da2f">hide</a>) <span class="keywordflow">return</span>;
<a name="l05242"></a>05242 
<a name="l05243"></a>05243     <span class="keywordflow">if</span> (sel) color = <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a99466ebe41be745cf51950acc8423924">TH_VERTEX_SELECT</a>;
<a name="l05244"></a>05244     <span class="keywordflow">else</span> color = <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a6933328b6df4400c196ee99ddd608afd">TH_VERTEX</a>;
<a name="l05245"></a>05245 
<a name="l05246"></a>05246     <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(color);
<a name="l05247"></a>05247 
<a name="l05248"></a>05248     size = <a class="code" href="../../de/d96/UI__resources_8h.html#ad9772e3578b739880ada62a6d21f4349">UI_GetThemeValuef</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a6c88c69347ab72b259eb7fcc8885327b">TH_VERTEX_SIZE</a>);
<a name="l05249"></a>05249     glPointSize(size);
<a name="l05250"></a>05250     
<a name="l05251"></a>05251     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#acbcc8c3223d7fc13a7931b0a1744b240">bglBegin</a>(GL_POINTS);
<a name="l05252"></a>05252     
<a name="l05253"></a>05253     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l05254"></a>05254 
<a name="l05255"></a>05255         bezt = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l05256"></a>05256         a = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l05257"></a>05257         <span class="keywordflow">while</span> (a--) {
<a name="l05258"></a>05258             <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aaac89168848f34909c578acb0d6cca26">hide</a> == 0) {
<a name="l05259"></a>05259                 <span class="keywordflow">if</span> (sel == 1 &amp;&amp; bezt == lastsel) {
<a name="l05260"></a>05260                     <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531ac12cd3ca9d54a3860ac5955c5e14e67c">TH_LASTSEL_POINT</a>);
<a name="l05261"></a>05261                     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1]);
<a name="l05262"></a>05262 
<a name="l05263"></a>05263                     <span class="keywordflow">if</span> (!hide_handles) {
<a name="l05264"></a>05264                         <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0]);
<a name="l05265"></a>05265                         <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2]);
<a name="l05266"></a>05266                     }
<a name="l05267"></a>05267 
<a name="l05268"></a>05268                     <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(color);
<a name="l05269"></a>05269                 }
<a name="l05270"></a>05270                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hide_handles) {
<a name="l05271"></a>05271                     <span class="keywordflow">if</span> ((bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) == sel) <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1]);
<a name="l05272"></a>05272                 }
<a name="l05273"></a>05273                 <span class="keywordflow">else</span> {
<a name="l05274"></a>05274                     <span class="keywordflow">if</span> ((bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) == sel) <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0]);
<a name="l05275"></a>05275                     <span class="keywordflow">if</span> ((bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) == sel) <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1]);
<a name="l05276"></a>05276                     <span class="keywordflow">if</span> ((bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) == sel) <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2]);
<a name="l05277"></a>05277                 }
<a name="l05278"></a>05278             }
<a name="l05279"></a>05279             bezt++;
<a name="l05280"></a>05280         }
<a name="l05281"></a>05281     }
<a name="l05282"></a>05282     <span class="keywordflow">else</span> {
<a name="l05283"></a>05283         bp = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l05284"></a>05284         a = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> * nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l05285"></a>05285         <span class="keywordflow">while</span> (a--) {
<a name="l05286"></a>05286             <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a> == 0) {
<a name="l05287"></a>05287                 <span class="keywordflow">if</span> (bp == lastsel) {
<a name="l05288"></a>05288                     <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531ac12cd3ca9d54a3860ac5955c5e14e67c">TH_LASTSEL_POINT</a>);
<a name="l05289"></a>05289                     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l05290"></a>05290                     <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(color);
<a name="l05291"></a>05291                 }
<a name="l05292"></a>05292                 <span class="keywordflow">else</span> {
<a name="l05293"></a>05293                     <span class="keywordflow">if</span> ((bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) == sel) <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l05294"></a>05294                 }
<a name="l05295"></a>05295             }
<a name="l05296"></a>05296             bp++;
<a name="l05297"></a>05297         }
<a name="l05298"></a>05298     }
<a name="l05299"></a>05299     
<a name="l05300"></a>05300     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a2517dcaf453d3e58af25fd4c677dad45">bglEnd</a>();
<a name="l05301"></a>05301     glPointSize(1.0);
<a name="l05302"></a>05302 }
<a name="l05303"></a>05303 
<a name="l05304"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a1743d2ab1fde5096109ddea93f986842">05304</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a1743d2ab1fde5096109ddea93f986842">editnurb_draw_active_poly</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l05305"></a>05305 {
<a name="l05306"></a>05306     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l05307"></a>05307     <span class="keywordtype">int</span> a, b;
<a name="l05308"></a>05308 
<a name="l05309"></a>05309     <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a4a65da48d83dfff7570ba52924d0babc">TH_ACTIVE_SPLINE</a>);
<a name="l05310"></a>05310     glLineWidth(2);
<a name="l05311"></a>05311 
<a name="l05312"></a>05312     bp = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l05313"></a>05313     <span class="keywordflow">for</span> (b = 0; b &lt; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; b++) {
<a name="l05314"></a>05314         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; 1) glBegin(GL_LINE_LOOP);
<a name="l05315"></a>05315         <span class="keywordflow">else</span> glBegin(GL_LINE_STRIP);
<a name="l05316"></a>05316 
<a name="l05317"></a>05317         <span class="keywordflow">for</span> (a = 0; a &lt; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; a++, bp++) {
<a name="l05318"></a>05318             glVertex3fv(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l05319"></a>05319         }
<a name="l05320"></a>05320 
<a name="l05321"></a>05321         glEnd();
<a name="l05322"></a>05322     }
<a name="l05323"></a>05323 
<a name="l05324"></a>05324     glColor3ub(0, 0, 0);
<a name="l05325"></a>05325     glLineWidth(1);
<a name="l05326"></a>05326 }
<a name="l05327"></a>05327 
<a name="l05328"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ac6fe1862f45484c7278643eef50ca57a">05328</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ac6fe1862f45484c7278643eef50ca57a">editnurb_draw_active_nurbs</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l05329"></a>05329 {
<a name="l05330"></a>05330     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp, *bp1;
<a name="l05331"></a>05331     <span class="keywordtype">int</span> a, b, ofs;
<a name="l05332"></a>05332 
<a name="l05333"></a>05333     <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a4a65da48d83dfff7570ba52924d0babc">TH_ACTIVE_SPLINE</a>);
<a name="l05334"></a>05334     glLineWidth(2);
<a name="l05335"></a>05335 
<a name="l05336"></a>05336     glBegin(GL_LINES);
<a name="l05337"></a>05337     bp = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l05338"></a>05338     <span class="keywordflow">for</span> (b = 0; b &lt; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; b++) {
<a name="l05339"></a>05339         bp1 = bp;
<a name="l05340"></a>05340         bp++;
<a name="l05341"></a>05341 
<a name="l05342"></a>05342         <span class="keywordflow">for</span> (a = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> - 1; a &gt; 0; a--, bp++) {
<a name="l05343"></a>05343             <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a> == 0 &amp;&amp; bp1-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a> == 0) {
<a name="l05344"></a>05344                 glVertex3fv(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l05345"></a>05345                 glVertex3fv(bp1-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l05346"></a>05346             }
<a name="l05347"></a>05347             bp1 = bp;
<a name="l05348"></a>05348         }
<a name="l05349"></a>05349     }
<a name="l05350"></a>05350 
<a name="l05351"></a>05351     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> &gt; 1) {    <span class="comment">/* surface */</span>
<a name="l05352"></a>05352 
<a name="l05353"></a>05353         ofs = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l05354"></a>05354         <span class="keywordflow">for</span> (b = 0; b &lt; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; b++) {
<a name="l05355"></a>05355             bp1 = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> + b;
<a name="l05356"></a>05356             bp = bp1 + ofs;
<a name="l05357"></a>05357             <span class="keywordflow">for</span> (a = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> - 1; a &gt; 0; a--, bp += ofs) {
<a name="l05358"></a>05358                 <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a> == 0 &amp;&amp; bp1-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a> == 0) {
<a name="l05359"></a>05359                     glVertex3fv(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l05360"></a>05360                     glVertex3fv(bp1-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l05361"></a>05361                 }
<a name="l05362"></a>05362                 bp1 = bp;
<a name="l05363"></a>05363             }
<a name="l05364"></a>05364         }
<a name="l05365"></a>05365     }
<a name="l05366"></a>05366 
<a name="l05367"></a>05367     glEnd();
<a name="l05368"></a>05368 
<a name="l05369"></a>05369     glColor3ub(0, 0, 0);
<a name="l05370"></a>05370     glLineWidth(1);
<a name="l05371"></a>05371 }
<a name="l05372"></a>05372 
<a name="l05373"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a173fbff49c9d3da47dab9a7f77af2eaa">05373</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a173fbff49c9d3da47dab9a7f77af2eaa">draw_editnurb</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nurb, <span class="keywordtype">int</span> sel)
<a name="l05374"></a>05374 {
<a name="l05375"></a>05375     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l05376"></a>05376     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp, *bp1;
<a name="l05377"></a>05377     <span class="keywordtype">int</span> a, b, ofs, index;
<a name="l05378"></a>05378     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu = (<a class="code" href="../../da/d10/structCurve.html">Curve</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l05379"></a>05379 
<a name="l05380"></a>05380     index = 0;
<a name="l05381"></a>05381     nu = nurb;
<a name="l05382"></a>05382     while (nu) {
<a name="l05383"></a>05383         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ac50bf4fd67b2b09d82909961cd25da2f">hide</a> == 0) {
<a name="l05384"></a>05384             <span class="keywordflow">switch</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a>) {
<a name="l05385"></a>05385                 <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af3fcb97faad660091cefad29858eec77">CU_POLY</a>:
<a name="l05386"></a>05386                     <span class="keywordflow">if</span> (!sel &amp;&amp; index == cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5fc2001ce6a5bcf7d4f102f15d9edb2f">actnu</a>) {
<a name="l05387"></a>05387                         <span class="comment">/* we should draw active spline highlight below everything */</span>
<a name="l05388"></a>05388                         <a class="code" href="../../d3/d02/drawobject_8c.html#a1743d2ab1fde5096109ddea93f986842">editnurb_draw_active_poly</a>(nu);
<a name="l05389"></a>05389                     }
<a name="l05390"></a>05390 
<a name="l05391"></a>05391                     <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a8cd5c9f00893a228177266e839ea2bf3">TH_NURB_ULINE</a>);
<a name="l05392"></a>05392                     bp = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l05393"></a>05393                     <span class="keywordflow">for</span> (b = 0; b &lt; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; b++) {
<a name="l05394"></a>05394                         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; 1) glBegin(GL_LINE_LOOP);
<a name="l05395"></a>05395                         <span class="keywordflow">else</span> glBegin(GL_LINE_STRIP);
<a name="l05396"></a>05396 
<a name="l05397"></a>05397                         <span class="keywordflow">for</span> (a = 0; a &lt; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; a++, bp++) {
<a name="l05398"></a>05398                             glVertex3fv(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l05399"></a>05399                         }
<a name="l05400"></a>05400 
<a name="l05401"></a>05401                         glEnd();
<a name="l05402"></a>05402                     }
<a name="l05403"></a>05403                     <span class="keywordflow">break</span>;
<a name="l05404"></a>05404                 <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>:
<a name="l05405"></a>05405                     <span class="keywordflow">if</span> (!sel &amp;&amp; index == cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5fc2001ce6a5bcf7d4f102f15d9edb2f">actnu</a>) {
<a name="l05406"></a>05406                         <span class="comment">/* we should draw active spline highlight below everything */</span>
<a name="l05407"></a>05407                         <a class="code" href="../../d3/d02/drawobject_8c.html#ac6fe1862f45484c7278643eef50ca57a">editnurb_draw_active_nurbs</a>(nu);
<a name="l05408"></a>05408                     }
<a name="l05409"></a>05409 
<a name="l05410"></a>05410                     bp = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l05411"></a>05411                     <span class="keywordflow">for</span> (b = 0; b &lt; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; b++) {
<a name="l05412"></a>05412                         bp1 = bp;
<a name="l05413"></a>05413                         bp++;
<a name="l05414"></a>05414                         <span class="keywordflow">for</span> (a = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> - 1; a &gt; 0; a--, bp++) {
<a name="l05415"></a>05415                             <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a> == 0 &amp;&amp; bp1-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a> == 0) {
<a name="l05416"></a>05416                                 <span class="keywordflow">if</span> (sel) {
<a name="l05417"></a>05417                                     <span class="keywordflow">if</span> ( (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) &amp;&amp; (bp1-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) ) {
<a name="l05418"></a>05418                                         <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531af44ca88c761813184dde7866d6ff198f">TH_NURB_SEL_ULINE</a>);
<a name="l05419"></a>05419 
<a name="l05420"></a>05420                                         glBegin(GL_LINE_STRIP);
<a name="l05421"></a>05421                                         glVertex3fv(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l05422"></a>05422                                         glVertex3fv(bp1-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l05423"></a>05423                                         glEnd();
<a name="l05424"></a>05424                                     }
<a name="l05425"></a>05425                                 }
<a name="l05426"></a>05426                                 <span class="keywordflow">else</span> {
<a name="l05427"></a>05427                                     <span class="keywordflow">if</span> ((bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) &amp;&amp; (bp1-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) {
<a name="l05428"></a>05428                                         <span class="comment">/* pass */</span>
<a name="l05429"></a>05429                                     }
<a name="l05430"></a>05430                                     <span class="keywordflow">else</span> {
<a name="l05431"></a>05431                                         <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a8cd5c9f00893a228177266e839ea2bf3">TH_NURB_ULINE</a>);
<a name="l05432"></a>05432 
<a name="l05433"></a>05433                                         glBegin(GL_LINE_STRIP);
<a name="l05434"></a>05434                                         glVertex3fv(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l05435"></a>05435                                         glVertex3fv(bp1-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l05436"></a>05436                                         glEnd();
<a name="l05437"></a>05437                                     }
<a name="l05438"></a>05438                                 }
<a name="l05439"></a>05439                             }
<a name="l05440"></a>05440                             bp1 = bp;
<a name="l05441"></a>05441                         }
<a name="l05442"></a>05442                     }
<a name="l05443"></a>05443                     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> &gt; 1) {    <span class="comment">/* surface */</span>
<a name="l05444"></a>05444 
<a name="l05445"></a>05445                         ofs = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l05446"></a>05446                         <span class="keywordflow">for</span> (b = 0; b &lt; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; b++) {
<a name="l05447"></a>05447                             bp1 = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> + b;
<a name="l05448"></a>05448                             bp = bp1 + ofs;
<a name="l05449"></a>05449                             <span class="keywordflow">for</span> (a = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> - 1; a &gt; 0; a--, bp += ofs) {
<a name="l05450"></a>05450                                 <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a> == 0 &amp;&amp; bp1-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a> == 0) {
<a name="l05451"></a>05451                                     <span class="keywordflow">if</span> (sel) {
<a name="l05452"></a>05452                                         <span class="keywordflow">if</span> ( (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) &amp;&amp; (bp1-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) ) {
<a name="l05453"></a>05453                                             <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a164ea5605018dbde4e43035bb9bf6680">TH_NURB_SEL_VLINE</a>);
<a name="l05454"></a>05454 
<a name="l05455"></a>05455                                             glBegin(GL_LINE_STRIP);
<a name="l05456"></a>05456                                             glVertex3fv(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l05457"></a>05457                                             glVertex3fv(bp1-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l05458"></a>05458                                             glEnd();
<a name="l05459"></a>05459                                         }
<a name="l05460"></a>05460                                     }
<a name="l05461"></a>05461                                     <span class="keywordflow">else</span> {
<a name="l05462"></a>05462                                         <span class="keywordflow">if</span> ((bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) &amp;&amp; (bp1-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) {
<a name="l05463"></a>05463                                             <span class="comment">/* pass */</span>
<a name="l05464"></a>05464                                         }
<a name="l05465"></a>05465                                         <span class="keywordflow">else</span> {
<a name="l05466"></a>05466                                             <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a62f63eceee4bbbd2dca2a25363e178cc">TH_NURB_VLINE</a>);
<a name="l05467"></a>05467 
<a name="l05468"></a>05468                                             glBegin(GL_LINE_STRIP);
<a name="l05469"></a>05469                                             glVertex3fv(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l05470"></a>05470                                             glVertex3fv(bp1-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l05471"></a>05471                                             glEnd();
<a name="l05472"></a>05472                                         }
<a name="l05473"></a>05473                                     }
<a name="l05474"></a>05474                                 }
<a name="l05475"></a>05475                                 bp1 = bp;
<a name="l05476"></a>05476                             }
<a name="l05477"></a>05477                         }
<a name="l05478"></a>05478 
<a name="l05479"></a>05479                     }
<a name="l05480"></a>05480                     <span class="keywordflow">break</span>;
<a name="l05481"></a>05481             }
<a name="l05482"></a>05482         }
<a name="l05483"></a>05483 
<a name="l05484"></a>05484         ++index;
<a name="l05485"></a>05485         nu = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l05486"></a>05486     }
<a name="l05487"></a>05487 }
<a name="l05488"></a>05488 
<a name="l05489"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ad0386654ccfe47ed5aac0efcedbd6c65">05489</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ad0386654ccfe47ed5aac0efcedbd6c65">drawnurb</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d, <a class="code" href="../../d3/da9/structBase.html">Base</a> *base, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nurb, <span class="keywordtype">int</span> dt)
<a name="l05490"></a>05490 {
<a name="l05491"></a>05491     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>;
<a name="l05492"></a>05492     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l05493"></a>05493     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l05494"></a>05494     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l05495"></a>05495     <a class="code" href="../../da/d87/structBevList.html">BevList</a> *bl;
<a name="l05496"></a>05496     <span class="keywordtype">short</span> hide_handles = (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a7c8120ba8f3b7624fdd42f9d5be7b56d">drawflag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ac8abd02e52a2a9d5f305be68c732923b">CU_HIDE_HANDLES</a>);
<a name="l05497"></a>05497     <span class="keywordtype">int</span> index;
<a name="l05498"></a>05498 
<a name="l05499"></a>05499     <span class="comment">/* DispList */</span>
<a name="l05500"></a>05500     <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l05501"></a>05501     <a class="code" href="../../d3/d02/drawobject_8c.html#af97e16e51d66bbc843bc1b5cfaa449bd">drawDispList</a>(scene, v3d, rv3d, base, dt);
<a name="l05502"></a>05502 
<a name="l05503"></a>05503     <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#afd443bfd0de5169661f08aa1eeb3bd69">zbuf</a>) glDisable(GL_DEPTH_TEST);
<a name="l05504"></a>05504     
<a name="l05505"></a>05505     <span class="comment">/* first non-selected and active handles */</span>
<a name="l05506"></a>05506     index = 0;
<a name="l05507"></a>05507     <span class="keywordflow">for</span> (nu = nurb; nu; nu = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l05508"></a>05508         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l05509"></a>05509             <span class="keywordflow">if</span> (index == cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5fc2001ce6a5bcf7d4f102f15d9edb2f">actnu</a> &amp;&amp; !hide_handles)
<a name="l05510"></a>05510                 <a class="code" href="../../d3/d02/drawobject_8c.html#aa8033681e2a0807093b900cba7e38aba">tekenhandlesN_active</a>(nu);
<a name="l05511"></a>05511             <a class="code" href="../../d3/d02/drawobject_8c.html#aaca3ed99ca924ea0398804a01e550c75">tekenhandlesN</a>(nu, 0, hide_handles);
<a name="l05512"></a>05512         }
<a name="l05513"></a>05513         ++index;
<a name="l05514"></a>05514     }
<a name="l05515"></a>05515     <a class="code" href="../../d3/d02/drawobject_8c.html#a173fbff49c9d3da47dab9a7f77af2eaa">draw_editnurb</a>(ob, nurb, 0);
<a name="l05516"></a>05516     <a class="code" href="../../d3/d02/drawobject_8c.html#a173fbff49c9d3da47dab9a7f77af2eaa">draw_editnurb</a>(ob, nurb, 1);
<a name="l05517"></a>05517     <span class="comment">/* selected handles */</span>
<a name="l05518"></a>05518     <span class="keywordflow">for</span> (nu = nurb; nu; nu = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l05519"></a>05519         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a> &amp;&amp; (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a7c8120ba8f3b7624fdd42f9d5be7b56d">drawflag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ac8abd02e52a2a9d5f305be68c732923b">CU_HIDE_HANDLES</a>) == 0)
<a name="l05520"></a>05520             <a class="code" href="../../d3/d02/drawobject_8c.html#aaca3ed99ca924ea0398804a01e550c75">tekenhandlesN</a>(nu, 1, hide_handles);
<a name="l05521"></a>05521         <a class="code" href="../../d3/d02/drawobject_8c.html#a3a5571aa334fecf8281ae209e6ad61dd">tekenvertsN</a>(nu, 0, hide_handles, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l05522"></a>05522     }
<a name="l05523"></a>05523     
<a name="l05524"></a>05524     <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#afd443bfd0de5169661f08aa1eeb3bd69">zbuf</a>) glEnable(GL_DEPTH_TEST);
<a name="l05525"></a>05525 
<a name="l05526"></a>05526     <span class="comment">/* direction vectors for 3d curve paths</span>
<a name="l05527"></a>05527 <span class="comment">     * when at its lowest, don&#39;t render normals */</span>
<a name="l05528"></a>05528     <span class="keywordflow">if</span> ((cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae2e952bfa23ce6735422c9e7bae27dac">CU_3D</a>) &amp;&amp; (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a061a6cacabb6dda02f9bc27be4df8628">normalsize</a> &gt; 0.0015f) &amp;&amp; (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a7c8120ba8f3b7624fdd42f9d5be7b56d">drawflag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#adcbf99c9891ed315cdf22009a69d5dea">CU_HIDE_NORMALS</a>) == 0) {
<a name="l05529"></a>05529 
<a name="l05530"></a>05530         <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l05531"></a>05531         <span class="keywordflow">for</span> (bl = cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a70b76680fbc09de0e26f7eeec36be3f2">bev</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>, nu = nurb; nu &amp;&amp; bl; bl = bl-&gt;<a class="code" href="../../da/d87/structBevList.html#a68186a5eb7cc0b0aab5620b475f2603f">next</a>, nu = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l05532"></a>05532             <a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *bevp = (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl + 1);
<a name="l05533"></a>05533             <span class="keywordtype">int</span> nr = bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>;
<a name="l05534"></a>05534             <span class="keywordtype">int</span> skip = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#aa4d5f2ef5e32e94dcbe14a1a7d946a30">resolu</a> / 16;
<a name="l05535"></a>05535             
<a name="l05536"></a>05536             <span class="keywordflow">while</span> (nr-- &gt; 0) { <span class="comment">/* accounts for empty bevel lists */</span>
<a name="l05537"></a>05537                 <span class="keyword">const</span> <span class="keywordtype">float</span> fac = bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a641e16f06b4291eee7ae6b7f792bda9a">radius</a> * ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a061a6cacabb6dda02f9bc27be4df8628">normalsize</a>;
<a name="l05538"></a>05538                 <span class="keywordtype">float</span> vec_a[3]; <span class="comment">// Offset perpendicular to the curve</span>
<a name="l05539"></a>05539                 <span class="keywordtype">float</span> vec_b[3]; <span class="comment">// Delta along the curve</span>
<a name="l05540"></a>05540 
<a name="l05541"></a>05541                 vec_a[0] = fac;
<a name="l05542"></a>05542                 vec_a[1] = 0.0f;
<a name="l05543"></a>05543                 vec_a[2] = 0.0f;
<a name="l05544"></a>05544 
<a name="l05545"></a>05545                 vec_b[0] = -fac;
<a name="l05546"></a>05546                 vec_b[1] = 0.0f;
<a name="l05547"></a>05547                 vec_b[2] = 0.0f;
<a name="l05548"></a>05548                 
<a name="l05549"></a>05549                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a654dd0df4df6f960e592032f276f2c68">mul_qt_v3</a>(bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>, vec_a);
<a name="l05550"></a>05550                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a654dd0df4df6f960e592032f276f2c68">mul_qt_v3</a>(bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>, vec_b);
<a name="l05551"></a>05551                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(vec_a, bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>);
<a name="l05552"></a>05552                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(vec_b, bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>);
<a name="l05553"></a>05553 
<a name="l05554"></a>05554                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1b4079b4f57c1eaf908d521b5a0f867e">madd_v3_v3fl</a>(vec_a, bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>, -fac);
<a name="l05555"></a>05555                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1b4079b4f57c1eaf908d521b5a0f867e">madd_v3_v3fl</a>(vec_b, bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>, -fac);
<a name="l05556"></a>05556 
<a name="l05557"></a>05557                 glBegin(GL_LINE_STRIP);
<a name="l05558"></a>05558                 glVertex3fv(vec_a);
<a name="l05559"></a>05559                 glVertex3fv(bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>);
<a name="l05560"></a>05560                 glVertex3fv(vec_b);
<a name="l05561"></a>05561                 glEnd();
<a name="l05562"></a>05562                 
<a name="l05563"></a>05563                 bevp += skip + 1;
<a name="l05564"></a>05564                 nr -= skip;
<a name="l05565"></a>05565             }
<a name="l05566"></a>05566         }
<a name="l05567"></a>05567     }
<a name="l05568"></a>05568 
<a name="l05569"></a>05569     <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#afd443bfd0de5169661f08aa1eeb3bd69">zbuf</a>) glDisable(GL_DEPTH_TEST);
<a name="l05570"></a>05570     
<a name="l05571"></a>05571     <span class="keywordflow">for</span> (nu = nurb; nu; nu = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l05572"></a>05572         <a class="code" href="../../d3/d02/drawobject_8c.html#a3a5571aa334fecf8281ae209e6ad61dd">tekenvertsN</a>(nu, 1, hide_handles, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>);
<a name="l05573"></a>05573     }
<a name="l05574"></a>05574     
<a name="l05575"></a>05575     <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#afd443bfd0de5169661f08aa1eeb3bd69">zbuf</a>) glEnable(GL_DEPTH_TEST);
<a name="l05576"></a>05576 }
<a name="l05577"></a>05577 
<a name="l05578"></a>05578 <span class="comment">/* draw a sphere for use as an empty drawtype */</span>
<a name="l05579"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a325de6f098e3581b88d0394d4ad3f0d8">05579</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a325de6f098e3581b88d0394d4ad3f0d8">draw_empty_sphere</a>(<span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l05580"></a>05580 {
<a name="l05581"></a>05581     <span class="keyword">static</span> GLuint displist = 0;
<a name="l05582"></a>05582     
<a name="l05583"></a>05583     <span class="keywordflow">if</span> (displist == 0) {
<a name="l05584"></a>05584         GLUquadricObj   *qobj;
<a name="l05585"></a>05585         
<a name="l05586"></a>05586         displist = glGenLists(1);
<a name="l05587"></a>05587         glNewList(displist, GL_COMPILE);
<a name="l05588"></a>05588         
<a name="l05589"></a>05589         glPushMatrix();
<a name="l05590"></a>05590         
<a name="l05591"></a>05591         qobj = gluNewQuadric();
<a name="l05592"></a>05592         gluQuadricDrawStyle(qobj, GLU_SILHOUETTE);
<a name="l05593"></a>05593         gluDisk(qobj, 0.0,  1, 16, 1);
<a name="l05594"></a>05594         
<a name="l05595"></a>05595         glRotatef(90, 0, 1, 0);
<a name="l05596"></a>05596         gluDisk(qobj, 0.0,  1, 16, 1);
<a name="l05597"></a>05597         
<a name="l05598"></a>05598         glRotatef(90, 1, 0, 0);
<a name="l05599"></a>05599         gluDisk(qobj, 0.0,  1, 16, 1);
<a name="l05600"></a>05600         
<a name="l05601"></a>05601         gluDeleteQuadric(qobj);
<a name="l05602"></a>05602         
<a name="l05603"></a>05603         glPopMatrix();
<a name="l05604"></a>05604         glEndList();
<a name="l05605"></a>05605     }
<a name="l05606"></a>05606     
<a name="l05607"></a>05607     glScalef(size, size, size);
<a name="l05608"></a>05608     glCallList(displist);
<a name="l05609"></a>05609     glScalef(1.0f / size, 1.0f / size, 1.0f / size);
<a name="l05610"></a>05610 }
<a name="l05611"></a>05611 
<a name="l05612"></a>05612 <span class="comment">/* draw a cone for use as an empty drawtype */</span>
<a name="l05613"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a28068615c786c14b3b89a90d2f1fb806">05613</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a28068615c786c14b3b89a90d2f1fb806">draw_empty_cone</a>(<span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l05614"></a>05614 {
<a name="l05615"></a>05615     <span class="keywordtype">float</span> cent = 0;
<a name="l05616"></a>05616     <span class="keywordtype">float</span> radius;
<a name="l05617"></a>05617     GLUquadricObj *qobj = gluNewQuadric();
<a name="l05618"></a>05618     gluQuadricDrawStyle(qobj, GLU_SILHOUETTE);
<a name="l05619"></a>05619     
<a name="l05620"></a>05620     
<a name="l05621"></a>05621     glPushMatrix();
<a name="l05622"></a>05622     
<a name="l05623"></a>05623     radius = <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l05624"></a>05624     glTranslatef(cent, cent, cent);
<a name="l05625"></a>05625     glScalef(radius, size * 2.0f, radius);
<a name="l05626"></a>05626     glRotatef(-90.0, 1.0, 0.0, 0.0);
<a name="l05627"></a>05627     gluCylinder(qobj, 1.0, 0.0, 1.0, 8, 1);
<a name="l05628"></a>05628 
<a name="l05629"></a>05629     glPopMatrix();
<a name="l05630"></a>05630     
<a name="l05631"></a>05631     gluDeleteQuadric(qobj);
<a name="l05632"></a>05632 }
<a name="l05633"></a>05633 
<a name="l05634"></a>05634 <span class="comment">/* draw points on curve speed handles */</span>
<a name="l05635"></a>05635 <span class="preprocessor">#if 0 // XXX old animation system stuff</span>
<a name="l05636"></a>05636 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span> curve_draw_speed(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l05637"></a>05637 {
<a name="l05638"></a>05638     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l05639"></a>05639     <a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *icu;
<a name="l05640"></a>05640     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l05641"></a>05641     <span class="keywordtype">float</span> loc[4], dir[3];
<a name="l05642"></a>05642     <span class="keywordtype">int</span> a;
<a name="l05643"></a>05643     
<a name="l05644"></a>05644     <span class="keywordflow">if</span> (cu-&gt;ipo == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05645"></a>05645         <span class="keywordflow">return</span>;
<a name="l05646"></a>05646     
<a name="l05647"></a>05647     icu = cu-&gt;ipo-&gt;curve.first;
<a name="l05648"></a>05648     <span class="keywordflow">if</span> (icu == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || icu-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#a6c92b94aac5b2ca487002d58d71ce6b6">totvert</a> &lt; 2)
<a name="l05649"></a>05649         <span class="keywordflow">return</span>;
<a name="l05650"></a>05650     
<a name="l05651"></a>05651     glPointSize(<a class="code" href="../../de/d96/UI__resources_8h.html#ad9772e3578b739880ada62a6d21f4349">UI_GetThemeValuef</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a6c88c69347ab72b259eb7fcc8885327b">TH_VERTEX_SIZE</a>) );
<a name="l05652"></a>05652     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#acbcc8c3223d7fc13a7931b0a1744b240">bglBegin</a>(GL_POINTS);
<a name="l05653"></a>05653 
<a name="l05654"></a>05654     <span class="keywordflow">for</span> (a = 0, bezt = icu-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#a2c2ff134af40961c76a8f410200a77d9">bezt</a>; a &lt; icu-&gt;totvert; a++, bezt++) {
<a name="l05655"></a>05655         <span class="keywordflow">if</span> (<a class="code" href="../../df/dd0/BKE__anim_8h.html#a36e926e41221928bb037b16aa04becc0">where_on_path</a>(ob, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1], loc, dir)) {
<a name="l05656"></a>05656             <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>((bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) &amp;&amp; ob == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a119935c54737bd111df8fd516c390000">OBACT</a> ? <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a99466ebe41be745cf51950acc8423924">TH_VERTEX_SELECT</a> : <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a6933328b6df4400c196ee99ddd608afd">TH_VERTEX</a>);
<a name="l05657"></a>05657             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(loc);
<a name="l05658"></a>05658         }
<a name="l05659"></a>05659     }
<a name="l05660"></a>05660 
<a name="l05661"></a>05661     glPointSize(1.0);
<a name="l05662"></a>05662     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a2517dcaf453d3e58af25fd4c677dad45">bglEnd</a>();
<a name="l05663"></a>05663 }
<a name="l05664"></a>05664 <span class="preprocessor">#endif // XXX old animation system stuff</span>
<a name="l05665"></a>05665 <span class="preprocessor"></span>
<a name="l05666"></a>05666 
<a name="l05667"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a018bfdc571ead2277bbb144f6d86dcef">05667</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a018bfdc571ead2277bbb144f6d86dcef">draw_textcurs</a>(<span class="keywordtype">float</span> textcurs[4][2])
<a name="l05668"></a>05668 {
<a name="l05669"></a>05669     <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(0);
<a name="l05670"></a>05670     
<a name="l05671"></a>05671     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#aab536618fe6f02df9a92c5f379ec7a9b">set_inverted_drawing</a>(1);
<a name="l05672"></a>05672     glBegin(GL_QUADS);
<a name="l05673"></a>05673     glVertex2fv(textcurs[0]);
<a name="l05674"></a>05674     glVertex2fv(textcurs[1]);
<a name="l05675"></a>05675     glVertex2fv(textcurs[2]);
<a name="l05676"></a>05676     glVertex2fv(textcurs[3]);
<a name="l05677"></a>05677     glEnd();
<a name="l05678"></a>05678     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#aab536618fe6f02df9a92c5f379ec7a9b">set_inverted_drawing</a>(0);
<a name="l05679"></a>05679 }
<a name="l05680"></a>05680 
<a name="l05681"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a0b2acd27bf8c26f845b34f0f700d9986">05681</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a0b2acd27bf8c26f845b34f0f700d9986">drawspiral</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> cent[3], <span class="keywordtype">float</span> rad, <span class="keywordtype">float</span> tmat[][4], <span class="keywordtype">int</span> start)
<a name="l05682"></a>05682 {
<a name="l05683"></a>05683     <span class="keywordtype">float</span> vec[3], vx[3], vy[3];
<a name="l05684"></a>05684     <span class="keyword">const</span> <span class="keywordtype">float</span> tot_inv = (1.0f / (float)<a class="code" href="../../d3/d02/drawobject_8c.html#a87f1e315b48757f310023ad69320612e">CIRCLE_RESOL</a>);
<a name="l05685"></a>05685     <span class="keywordtype">int</span> a;
<a name="l05686"></a>05686     <span class="keywordtype">char</span> <a class="code" href="../../d9/d42/btQuaternion_8h.html#ae51e49cc6a687e7b1534a6a03fafe2c8" title="Return the inverse of a quaternion.">inverse</a> = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l05687"></a>05687     <span class="keywordtype">float</span> x, y, fac;
<a name="l05688"></a>05688 
<a name="l05689"></a>05689     <span class="keywordflow">if</span> (start &lt; 0) {
<a name="l05690"></a>05690         inverse = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l05691"></a>05691         start = -start;
<a name="l05692"></a>05692     }
<a name="l05693"></a>05693 
<a name="l05694"></a>05694     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ad32a55246dbd69dbd150cd3fe480c734">mul_v3_v3fl</a>(vx, tmat[0], rad);
<a name="l05695"></a>05695     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ad32a55246dbd69dbd150cd3fe480c734">mul_v3_v3fl</a>(vy, tmat[1], rad);
<a name="l05696"></a>05696 
<a name="l05697"></a>05697     glBegin(GL_LINE_STRIP);
<a name="l05698"></a>05698 
<a name="l05699"></a>05699     <span class="keywordflow">if</span> (inverse == 0) {
<a name="l05700"></a>05700         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, cent);
<a name="l05701"></a>05701         glVertex3fv(vec);
<a name="l05702"></a>05702 
<a name="l05703"></a>05703         <span class="keywordflow">for</span> (a = 0; a &lt; <a class="code" href="../../d3/d02/drawobject_8c.html#a87f1e315b48757f310023ad69320612e">CIRCLE_RESOL</a>; a++) {
<a name="l05704"></a>05704             <span class="keywordflow">if</span> (a + start &gt;= CIRCLE_RESOL)
<a name="l05705"></a>05705                 start = -a + 1;
<a name="l05706"></a>05706 
<a name="l05707"></a>05707             fac = (float)a * tot_inv;
<a name="l05708"></a>05708             x = <a class="code" href="../../d3/d02/drawobject_8c.html#ab987af64fdf0720a928f8b0a353a666a">sinval</a>[a + start] * fac;
<a name="l05709"></a>05709             y = <a class="code" href="../../d3/d02/drawobject_8c.html#ad5e6588136f6b5fc21c0271039fe0eaa">cosval</a>[a + start] * fac;
<a name="l05710"></a>05710 
<a name="l05711"></a>05711             vec[0] = cent[0] + (x * vx[0] + y * vy[0]);
<a name="l05712"></a>05712             vec[1] = cent[1] + (x * vx[1] + y * vy[1]);
<a name="l05713"></a>05713             vec[2] = cent[2] + (x * vx[2] + y * vy[2]);
<a name="l05714"></a>05714 
<a name="l05715"></a>05715             glVertex3fv(vec);
<a name="l05716"></a>05716         }
<a name="l05717"></a>05717     }
<a name="l05718"></a>05718     <span class="keywordflow">else</span> {
<a name="l05719"></a>05719         fac = (float)(<a class="code" href="../../d3/d02/drawobject_8c.html#a87f1e315b48757f310023ad69320612e">CIRCLE_RESOL</a> - 1) * tot_inv;
<a name="l05720"></a>05720         x = <a class="code" href="../../d3/d02/drawobject_8c.html#ab987af64fdf0720a928f8b0a353a666a">sinval</a>[start] * fac;
<a name="l05721"></a>05721         y = <a class="code" href="../../d3/d02/drawobject_8c.html#ad5e6588136f6b5fc21c0271039fe0eaa">cosval</a>[start] * fac;
<a name="l05722"></a>05722 
<a name="l05723"></a>05723         vec[0] = cent[0] + (x * vx[0] + y * vy[0]);
<a name="l05724"></a>05724         vec[1] = cent[1] + (x * vx[1] + y * vy[1]);
<a name="l05725"></a>05725         vec[2] = cent[2] + (x * vx[2] + y * vy[2]);
<a name="l05726"></a>05726 
<a name="l05727"></a>05727         glVertex3fv(vec);
<a name="l05728"></a>05728 
<a name="l05729"></a>05729         <span class="keywordflow">for</span> (a = 0; a &lt; <a class="code" href="../../d3/d02/drawobject_8c.html#a87f1e315b48757f310023ad69320612e">CIRCLE_RESOL</a>; a++) {
<a name="l05730"></a>05730             <span class="keywordflow">if</span> (a + start &gt;= CIRCLE_RESOL)
<a name="l05731"></a>05731                 start = -a + 1;
<a name="l05732"></a>05732 
<a name="l05733"></a>05733             fac = (float)(-a + (CIRCLE_RESOL - 1)) * tot_inv;
<a name="l05734"></a>05734             x = <a class="code" href="../../d3/d02/drawobject_8c.html#ab987af64fdf0720a928f8b0a353a666a">sinval</a>[a + start] * fac;
<a name="l05735"></a>05735             y = <a class="code" href="../../d3/d02/drawobject_8c.html#ad5e6588136f6b5fc21c0271039fe0eaa">cosval</a>[a + start] * fac;
<a name="l05736"></a>05736 
<a name="l05737"></a>05737             vec[0] = cent[0] + (x * vx[0] + y * vy[0]);
<a name="l05738"></a>05738             vec[1] = cent[1] + (x * vx[1] + y * vy[1]);
<a name="l05739"></a>05739             vec[2] = cent[2] + (x * vx[2] + y * vy[2]);
<a name="l05740"></a>05740             glVertex3fv(vec);
<a name="l05741"></a>05741         }
<a name="l05742"></a>05742     }
<a name="l05743"></a>05743 
<a name="l05744"></a>05744     glEnd();
<a name="l05745"></a>05745 }
<a name="l05746"></a>05746 
<a name="l05747"></a>05747 <span class="comment">/* draws a circle on x-z plane given the scaling of the circle, assuming that </span>
<a name="l05748"></a>05748 <span class="comment"> * all required matrices have been set (used for drawing empties)</span>
<a name="l05749"></a>05749 <span class="comment"> */</span>
<a name="l05750"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a27a385998c793e123c08108511e866c0">05750</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a27a385998c793e123c08108511e866c0">drawcircle_size</a>(<span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l05751"></a>05751 {
<a name="l05752"></a>05752     <span class="keywordtype">float</span> x, y;
<a name="l05753"></a>05753     <span class="keywordtype">short</span> <a class="code" href="../../d1/d22/stdosl_8h.html#ac74fcb237b43bb067bbb22bb8e70d44f">degrees</a>;
<a name="l05754"></a>05754 
<a name="l05755"></a>05755     glBegin(GL_LINE_LOOP);
<a name="l05756"></a>05756 
<a name="l05757"></a>05757     <span class="comment">/* coordinates are: cos(degrees*11.25)=x, sin(degrees*11.25)=y, 0.0f=z */</span>
<a name="l05758"></a>05758     <span class="keywordflow">for</span> (degrees = 0; degrees &lt; <a class="code" href="../../d3/d02/drawobject_8c.html#a87f1e315b48757f310023ad69320612e">CIRCLE_RESOL</a>; degrees++) {
<a name="l05759"></a>05759         x = <a class="code" href="../../d3/d02/drawobject_8c.html#ad5e6588136f6b5fc21c0271039fe0eaa">cosval</a>[<a class="code" href="../../d1/d22/stdosl_8h.html#ac74fcb237b43bb067bbb22bb8e70d44f">degrees</a>];
<a name="l05760"></a>05760         y = <a class="code" href="../../d3/d02/drawobject_8c.html#ab987af64fdf0720a928f8b0a353a666a">sinval</a>[<a class="code" href="../../d1/d22/stdosl_8h.html#ac74fcb237b43bb067bbb22bb8e70d44f">degrees</a>];
<a name="l05761"></a>05761         
<a name="l05762"></a>05762         glVertex3f(x * size, 0.0f, y * size);
<a name="l05763"></a>05763     }
<a name="l05764"></a>05764     
<a name="l05765"></a>05765     glEnd();
<a name="l05766"></a>05766 
<a name="l05767"></a>05767 }
<a name="l05768"></a>05768 
<a name="l05769"></a>05769 <span class="comment">/* needs fixing if non-identity matrice used */</span>
<a name="l05770"></a><a class="code" href="../../d3/d02/drawobject_8c.html#aebe375e1f420f509f82498a2a053c1b1">05770</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#aebe375e1f420f509f82498a2a053c1b1">drawtube</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> vec[3], <span class="keywordtype">float</span> radius, <span class="keywordtype">float</span> height, <span class="keywordtype">float</span> tmat[][4])
<a name="l05771"></a>05771 {
<a name="l05772"></a>05772     <span class="keywordtype">float</span> cur[3];
<a name="l05773"></a>05773     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, vec, radius, tmat);
<a name="l05774"></a>05774 
<a name="l05775"></a>05775     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(cur, vec);
<a name="l05776"></a>05776     cur[2] += height;
<a name="l05777"></a>05777 
<a name="l05778"></a>05778     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, cur, radius, tmat);
<a name="l05779"></a>05779 
<a name="l05780"></a>05780     glBegin(GL_LINES);
<a name="l05781"></a>05781     glVertex3f(vec[0] + radius, vec[1], vec[2]);
<a name="l05782"></a>05782     glVertex3f(cur[0] + radius, cur[1], cur[2]);
<a name="l05783"></a>05783     glVertex3f(vec[0] - radius, vec[1], vec[2]);
<a name="l05784"></a>05784     glVertex3f(cur[0] - radius, cur[1], cur[2]);
<a name="l05785"></a>05785     glVertex3f(vec[0], vec[1] + radius, vec[2]);
<a name="l05786"></a>05786     glVertex3f(cur[0], cur[1] + radius, cur[2]);
<a name="l05787"></a>05787     glVertex3f(vec[0], vec[1] - radius, vec[2]);
<a name="l05788"></a>05788     glVertex3f(cur[0], cur[1] - radius, cur[2]);
<a name="l05789"></a>05789     glEnd();
<a name="l05790"></a>05790 }
<a name="l05791"></a>05791 <span class="comment">/* needs fixing if non-identity matrice used */</span>
<a name="l05792"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a2b810a77ec9f4541986236361f46ee17">05792</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a2b810a77ec9f4541986236361f46ee17">drawcone</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> vec[3], <span class="keywordtype">float</span> radius, <span class="keywordtype">float</span> height, <span class="keywordtype">float</span> tmat[][4])
<a name="l05793"></a>05793 {
<a name="l05794"></a>05794     <span class="keywordtype">float</span> cur[3];
<a name="l05795"></a>05795 
<a name="l05796"></a>05796     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(cur, vec);
<a name="l05797"></a>05797     cur[2] += height;
<a name="l05798"></a>05798 
<a name="l05799"></a>05799     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, cur, radius, tmat);
<a name="l05800"></a>05800 
<a name="l05801"></a>05801     glBegin(GL_LINES);
<a name="l05802"></a>05802     glVertex3f(vec[0], vec[1], vec[2]);
<a name="l05803"></a>05803     glVertex3f(cur[0] + radius, cur[1], cur[2]);
<a name="l05804"></a>05804     glVertex3f(vec[0], vec[1], vec[2]);
<a name="l05805"></a>05805     glVertex3f(cur[0] - radius, cur[1], cur[2]);
<a name="l05806"></a>05806     glVertex3f(vec[0], vec[1], vec[2]);
<a name="l05807"></a>05807     glVertex3f(cur[0], cur[1] + radius, cur[2]);
<a name="l05808"></a>05808     glVertex3f(vec[0], vec[1], vec[2]);
<a name="l05809"></a>05809     glVertex3f(cur[0], cur[1] - radius, cur[2]);
<a name="l05810"></a>05810     glEnd();
<a name="l05811"></a>05811 }
<a name="l05812"></a>05812 <span class="comment">/* return 1 if nothing was drawn */</span>
<a name="l05813"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a1e31dd2fb4beefa1e320ece0c86f0590">05813</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a1e31dd2fb4beefa1e320ece0c86f0590">drawmball</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d, <a class="code" href="../../d3/da9/structBase.html">Base</a> *base, <span class="keywordtype">int</span> dt)
<a name="l05814"></a>05814 {
<a name="l05815"></a>05815     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l05816"></a>05816     <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb;
<a name="l05817"></a>05817     <a class="code" href="../../de/d87/structMetaElem.html">MetaElem</a> *ml;
<a name="l05818"></a>05818     <span class="keywordtype">float</span> imat[4][4];
<a name="l05819"></a>05819     <span class="keywordtype">int</span> code = 1;
<a name="l05820"></a>05820     
<a name="l05821"></a>05821     mb = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l05822"></a>05822 
<a name="l05823"></a>05823     <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad613f238c10a857cb981c9963efc365a">editelems</a>) {
<a name="l05824"></a>05824         <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l05825"></a>05825         <span class="keywordflow">if</span> ((<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.f &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a7bc3ff94aabaed488f0d9b7199d11d22">G_PICKSEL</a>) == 0) <a class="code" href="../../d3/d02/drawobject_8c.html#af97e16e51d66bbc843bc1b5cfaa449bd">drawDispList</a>(scene, v3d, rv3d, base, dt);
<a name="l05826"></a>05826         ml = mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad613f238c10a857cb981c9963efc365a">editelems</a>-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05827"></a>05827     }
<a name="l05828"></a>05828     <span class="keywordflow">else</span> {
<a name="l05829"></a>05829         <span class="keywordflow">if</span> ((base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ac31d50d415c660a44c0ccdc6b4854721">OB_FROMDUPLI</a>) == 0)
<a name="l05830"></a>05830             <a class="code" href="../../d3/d02/drawobject_8c.html#af97e16e51d66bbc843bc1b5cfaa449bd">drawDispList</a>(scene, v3d, rv3d, base, dt);
<a name="l05831"></a>05831         ml = mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a582b25f0c9cf3bfa16c4c2d1785f1233">elems</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05832"></a>05832     }
<a name="l05833"></a>05833 
<a name="l05834"></a>05834     <span class="keywordflow">if</span> (ml == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> 1;
<a name="l05835"></a>05835 
<a name="l05836"></a>05836     <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) <span class="keywordflow">return</span> 0;
<a name="l05837"></a>05837     
<a name="l05838"></a>05838     <span class="comment">/* in case solid draw, reset wire colors */</span>
<a name="l05839"></a>05839     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l05840"></a>05840         <span class="keywordflow">if</span> (ob == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a119935c54737bd111df8fd516c390000">OBACT</a>) <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531af47479527035752070059cf6669daf09">TH_ACTIVE</a>);
<a name="l05841"></a>05841         <span class="keywordflow">else</span> <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531acf22ebe596e9394104b732b077cbec7a">TH_SELECT</a>);
<a name="l05842"></a>05842     }
<a name="l05843"></a>05843     <span class="keywordflow">else</span> <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l05844"></a>05844 
<a name="l05845"></a>05845     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(imat, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a12d37f255c840dce64ab32aac76bb860">viewmatob</a>);
<a name="l05846"></a>05846     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(imat[0]);
<a name="l05847"></a>05847     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(imat[1]);
<a name="l05848"></a>05848     
<a name="l05849"></a>05849     <span class="keywordflow">while</span> (ml) {
<a name="l05850"></a>05850 
<a name="l05851"></a>05851         <span class="comment">/* draw radius */</span>
<a name="l05852"></a>05852         <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad613f238c10a857cb981c9963efc365a">editelems</a>) {
<a name="l05853"></a>05853             <span class="keywordflow">if</span> ((ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#afcd96395129ff8fdd4006c8ea5cb4915">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) &amp;&amp; (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#afcd96395129ff8fdd4006c8ea5cb4915">flag</a> &amp; <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#aad1557458d5997886054a40a75c6b1a0">MB_SCALE_RAD</a>)) <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(0xA0A0F0);
<a name="l05854"></a>05854             <span class="keywordflow">else</span> <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(0x3030A0);
<a name="l05855"></a>05855             
<a name="l05856"></a>05856             <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.f &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a7bc3ff94aabaed488f0d9b7199d11d22">G_PICKSEL</a>) {
<a name="l05857"></a>05857                 ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a79649fb235c22002fa4d6f71f67edff0">selcol1</a> = code;
<a name="l05858"></a>05858                 glLoadName(code++);
<a name="l05859"></a>05859             }
<a name="l05860"></a>05860         }
<a name="l05861"></a>05861         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, &amp;(ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a65f806a2e216ec2f3b15f7fd27538bd8">x</a>), ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a>, imat);
<a name="l05862"></a>05862 
<a name="l05863"></a>05863         <span class="comment">/* draw stiffness */</span>
<a name="l05864"></a>05864         <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad613f238c10a857cb981c9963efc365a">editelems</a>) {
<a name="l05865"></a>05865             <span class="keywordflow">if</span> ((ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#afcd96395129ff8fdd4006c8ea5cb4915">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) &amp;&amp; !(ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#afcd96395129ff8fdd4006c8ea5cb4915">flag</a> &amp; <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#aad1557458d5997886054a40a75c6b1a0">MB_SCALE_RAD</a>)) <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(0xA0F0A0);
<a name="l05866"></a>05866             <span class="keywordflow">else</span> <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(0x30A030);
<a name="l05867"></a>05867             
<a name="l05868"></a>05868             <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.f &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a7bc3ff94aabaed488f0d9b7199d11d22">G_PICKSEL</a>) {
<a name="l05869"></a>05869                 ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#ac41967096f5b79477f31480f35919672">selcol2</a> = code;
<a name="l05870"></a>05870                 glLoadName(code++);
<a name="l05871"></a>05871             }
<a name="l05872"></a>05872             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, &amp;(ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a65f806a2e216ec2f3b15f7fd27538bd8">x</a>), ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a> * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a6301bd3eb834120f83458269b0730d80">atanf</a>(ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#ab77dbffce529c16d46d8b202b2b535ca">s</a>) / (<span class="keywordtype">float</span>)<a class="code" href="../../dd/d06/BLI__math__base_8h.html#a958e4508ed28ee5cc04249144312c15f">M_PI_2</a>, imat);
<a name="l05873"></a>05873         }
<a name="l05874"></a>05874         
<a name="l05875"></a>05875         ml = ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a441cace5b6e487bfc3c2c29f3ab9e150">next</a>;
<a name="l05876"></a>05876     }
<a name="l05877"></a>05877     <span class="keywordflow">return</span> 0;
<a name="l05878"></a>05878 }
<a name="l05879"></a>05879 
<a name="l05880"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ac4db5bd4516a8db6a229fb0af7e0e27b">05880</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ac4db5bd4516a8db6a229fb0af7e0e27b">draw_forcefield</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d)
<a name="l05881"></a>05881 {
<a name="l05882"></a>05882     <a class="code" href="../../d3/d76/structPartDeflect.html">PartDeflect</a> *pd = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>;
<a name="l05883"></a>05883     <span class="keywordtype">float</span> imat[4][4], tmat[4][4];
<a name="l05884"></a>05884     <span class="keywordtype">float</span> vec[3] = {0.0, 0.0, 0.0};
<a name="l05885"></a>05885     <span class="keywordtype">int</span> curcol;
<a name="l05886"></a>05886     <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l05887"></a>05887 
<a name="l05888"></a>05888     <span class="comment">/* XXX why? */</span>
<a name="l05889"></a>05889     <span class="keywordflow">if</span> (ob != scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a1aa1978dba5dab99d35b6ba89e88b5bb">obedit</a> &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) {
<a name="l05890"></a>05890         <span class="keywordflow">if</span> (ob == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a119935c54737bd111df8fd516c390000">OBACT</a>) curcol = <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531af47479527035752070059cf6669daf09">TH_ACTIVE</a>;
<a name="l05891"></a>05891         <span class="keywordflow">else</span> curcol = <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531acf22ebe596e9394104b732b077cbec7a">TH_SELECT</a>;
<a name="l05892"></a>05892     }
<a name="l05893"></a>05893     <span class="keywordflow">else</span> curcol = <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a9fa6bac12a2d13ceef827d4f05bd2e11">TH_EMPTY</a>;
<a name="l05894"></a>05894     
<a name="l05895"></a>05895     <span class="comment">/* scale size of circle etc with the empty drawsize */</span>
<a name="l05896"></a>05896     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aae7aa3fbf86ed3619e54240da402fab1">OB_EMPTY</a>) size = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a9f106829a25bed222ba018f0d6d4f54a">empty_drawsize</a>;
<a name="l05897"></a>05897     <span class="keywordflow">else</span> size = 1.0;
<a name="l05898"></a>05898     
<a name="l05899"></a>05899     <span class="comment">/* calculus here, is reused in PFIELD_FORCE */</span>
<a name="l05900"></a>05900     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(imat, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a12d37f255c840dce64ab32aac76bb860">viewmatob</a>);
<a name="l05901"></a>05901 <span class="comment">//  normalize_v3(imat[0]);      // we don&#39;t do this because field doesnt scale either... apart from wind!</span>
<a name="l05902"></a>05902 <span class="comment">//  normalize_v3(imat[1]);</span>
<a name="l05903"></a>05903     
<a name="l05904"></a>05904     <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba22fb65898d213ba25a4a89bbe5c50fc0">PFIELD_WIND</a>) {
<a name="l05905"></a>05905         <span class="keywordtype">float</span> force_val;
<a name="l05906"></a>05906         
<a name="l05907"></a>05907         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(tmat);
<a name="l05908"></a>05908         <a class="code" href="../../de/d96/UI__resources_8h.html#ad4ede272051fd08d70f30570ad85a852">UI_ThemeColorBlend</a>(curcol, <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a2f524dc89597307994ab7d91402f79cf">TH_BACK</a>, 0.5);
<a name="l05909"></a>05909         
<a name="l05910"></a>05910         <span class="comment">//if (has_ipo_code(ob-&gt;ipo, OB_PD_FSTR))</span>
<a name="l05911"></a>05911         <span class="comment">//  force_val = IPO_GetFloatValue(ob-&gt;ipo, OB_PD_FSTR, scene-&gt;r.cfra);</span>
<a name="l05912"></a>05912         <span class="comment">//else</span>
<a name="l05913"></a>05913         {
<a name="l05914"></a>05914             force_val = pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a6cff5078ee6e06da8a0164ba49cf5a7c">f_strength</a>;
<a name="l05915"></a>05915         }
<a name="l05916"></a>05916         force_val *= 0.1f;
<a name="l05917"></a>05917         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, vec, size, tmat);
<a name="l05918"></a>05918         vec[2] = 0.5f * force_val;
<a name="l05919"></a>05919         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, vec, size, tmat);
<a name="l05920"></a>05920         vec[2] = 1.0f * force_val;
<a name="l05921"></a>05921         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, vec, size, tmat);
<a name="l05922"></a>05922         vec[2] = 1.5f * force_val;
<a name="l05923"></a>05923         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, vec, size, tmat);
<a name="l05924"></a>05924         vec[2] = 0.0f; <span class="comment">/* reset vec for max dist circle */</span>
<a name="l05925"></a>05925         
<a name="l05926"></a>05926     }
<a name="l05927"></a>05927     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba4cec14f5eac6fcea81c188de2fbf81ed">PFIELD_FORCE</a>) {
<a name="l05928"></a>05928         <span class="keywordtype">float</span> ffall_val;
<a name="l05929"></a>05929 
<a name="l05930"></a>05930         <span class="comment">//if (has_ipo_code(ob-&gt;ipo, OB_PD_FFALL))</span>
<a name="l05931"></a>05931         <span class="comment">//  ffall_val = IPO_GetFloatValue(ob-&gt;ipo, OB_PD_FFALL, scene-&gt;r.cfra);</span>
<a name="l05932"></a>05932         <span class="comment">//else</span>
<a name="l05933"></a>05933         {
<a name="l05934"></a>05934             ffall_val = pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a7b691a9c35f8608bcb146af245f862b1">f_power</a>;
<a name="l05935"></a>05935         }
<a name="l05936"></a>05936 
<a name="l05937"></a>05937         <a class="code" href="../../de/d96/UI__resources_8h.html#ad4ede272051fd08d70f30570ad85a852">UI_ThemeColorBlend</a>(curcol, <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a2f524dc89597307994ab7d91402f79cf">TH_BACK</a>, 0.5);
<a name="l05938"></a>05938         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, vec, size, imat);
<a name="l05939"></a>05939         <a class="code" href="../../de/d96/UI__resources_8h.html#ad4ede272051fd08d70f30570ad85a852">UI_ThemeColorBlend</a>(curcol, <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a2f524dc89597307994ab7d91402f79cf">TH_BACK</a>, 0.9f - 0.4f / <a class="code" href="../../dd/d06/BLI__math__base_8h.html#acc9eed6743d69a0f62071dc0c7dd6ae8">powf</a>(1.5f, ffall_val));
<a name="l05940"></a>05940         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, vec, size * 1.5f, imat);
<a name="l05941"></a>05941         <a class="code" href="../../de/d96/UI__resources_8h.html#ad4ede272051fd08d70f30570ad85a852">UI_ThemeColorBlend</a>(curcol, <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a2f524dc89597307994ab7d91402f79cf">TH_BACK</a>, 0.9f - 0.4f / <a class="code" href="../../dd/d06/BLI__math__base_8h.html#acc9eed6743d69a0f62071dc0c7dd6ae8">powf</a>(2.0f, ffall_val));
<a name="l05942"></a>05942         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, vec, size * 2.0f, imat);
<a name="l05943"></a>05943     }
<a name="l05944"></a>05944     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1bab1e0e1326ceb8b34f025660dd2399a02">PFIELD_VORTEX</a>) {
<a name="l05945"></a>05945         <span class="keywordtype">float</span> <span class="comment">/*ffall_val,*/</span> force_val;
<a name="l05946"></a>05946 
<a name="l05947"></a>05947         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(tmat);
<a name="l05948"></a>05948         <span class="comment">//if (has_ipo_code(ob-&gt;ipo, OB_PD_FFALL))</span>
<a name="l05949"></a>05949         <span class="comment">//  ffall_val = IPO_GetFloatValue(ob-&gt;ipo, OB_PD_FFALL, scene-&gt;r.cfra);</span>
<a name="l05950"></a>05950         <span class="comment">//else</span>
<a name="l05951"></a>05951         <span class="comment">//  ffall_val = pd-&gt;f_power;</span>
<a name="l05952"></a>05952 
<a name="l05953"></a>05953         <span class="comment">//if (has_ipo_code(ob-&gt;ipo, OB_PD_FSTR))</span>
<a name="l05954"></a>05954         <span class="comment">//  force_val = IPO_GetFloatValue(ob-&gt;ipo, OB_PD_FSTR, scene-&gt;r.cfra);</span>
<a name="l05955"></a>05955         <span class="comment">//else</span>
<a name="l05956"></a>05956         {
<a name="l05957"></a>05957             force_val = pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a6cff5078ee6e06da8a0164ba49cf5a7c">f_strength</a>;
<a name="l05958"></a>05958         }
<a name="l05959"></a>05959 
<a name="l05960"></a>05960         <a class="code" href="../../de/d96/UI__resources_8h.html#ad4ede272051fd08d70f30570ad85a852">UI_ThemeColorBlend</a>(curcol, <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a2f524dc89597307994ab7d91402f79cf">TH_BACK</a>, 0.7f);
<a name="l05961"></a>05961         <span class="keywordflow">if</span> (force_val &lt; 0) {
<a name="l05962"></a>05962             <a class="code" href="../../d3/d02/drawobject_8c.html#a0b2acd27bf8c26f845b34f0f700d9986">drawspiral</a>(vec, size, tmat, 1);
<a name="l05963"></a>05963             <a class="code" href="../../d3/d02/drawobject_8c.html#a0b2acd27bf8c26f845b34f0f700d9986">drawspiral</a>(vec, size, tmat, 16);
<a name="l05964"></a>05964         }
<a name="l05965"></a>05965         <span class="keywordflow">else</span> {
<a name="l05966"></a>05966             <a class="code" href="../../d3/d02/drawobject_8c.html#a0b2acd27bf8c26f845b34f0f700d9986">drawspiral</a>(vec, size, tmat, -1);
<a name="l05967"></a>05967             <a class="code" href="../../d3/d02/drawobject_8c.html#a0b2acd27bf8c26f845b34f0f700d9986">drawspiral</a>(vec, size, tmat, -16);
<a name="l05968"></a>05968         }
<a name="l05969"></a>05969     }
<a name="l05970"></a>05970     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba9598d9b623f4d97c79250a80fec316b6">PFIELD_GUIDE</a> &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>) {
<a name="l05971"></a>05971         <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l05972"></a>05972         <span class="keywordflow">if</span> ((cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae59d98d3a2c7e6fddf4aa7fff72bcf88">CU_PATH</a>) &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a946ca944a39e912802a59396578e5a1f">path</a> &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a946ca944a39e912802a59396578e5a1f">path</a>-&gt;<a class="code" href="../../d3/d20/structPath.html#a15dc781d9ad24530d3a8d218c7b79aca">data</a>) {
<a name="l05973"></a>05973             <span class="keywordtype">float</span> mindist, guidevec1[4], guidevec2[3];
<a name="l05974"></a>05974 
<a name="l05975"></a>05975             <span class="comment">//if (has_ipo_code(ob-&gt;ipo, OB_PD_FSTR))</span>
<a name="l05976"></a>05976             <span class="comment">//  mindist = IPO_GetFloatValue(ob-&gt;ipo, OB_PD_FSTR, scene-&gt;r.cfra);</span>
<a name="l05977"></a>05977             <span class="comment">//else</span>
<a name="l05978"></a>05978             {
<a name="l05979"></a>05979                 mindist = pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a6cff5078ee6e06da8a0164ba49cf5a7c">f_strength</a>;
<a name="l05980"></a>05980             }
<a name="l05981"></a>05981 
<a name="l05982"></a>05982             <span class="comment">/*path end*/</span>
<a name="l05983"></a>05983             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(3);
<a name="l05984"></a>05984             <a class="code" href="../../df/dd0/BKE__anim_8h.html#a36e926e41221928bb037b16aa04becc0">where_on_path</a>(ob, 1.0f, guidevec1, guidevec2, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l05985"></a>05985             <a class="code" href="../../de/d96/UI__resources_8h.html#ad4ede272051fd08d70f30570ad85a852">UI_ThemeColorBlend</a>(curcol, <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a2f524dc89597307994ab7d91402f79cf">TH_BACK</a>, 0.5);
<a name="l05986"></a>05986             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, guidevec1, mindist, imat);
<a name="l05987"></a>05987 
<a name="l05988"></a>05988             <span class="comment">/*path beginning*/</span>
<a name="l05989"></a>05989             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(0);
<a name="l05990"></a>05990             <a class="code" href="../../df/dd0/BKE__anim_8h.html#a36e926e41221928bb037b16aa04becc0">where_on_path</a>(ob, 0.0f, guidevec1, guidevec2, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l05991"></a>05991             <a class="code" href="../../de/d96/UI__resources_8h.html#ad4ede272051fd08d70f30570ad85a852">UI_ThemeColorBlend</a>(curcol, <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a2f524dc89597307994ab7d91402f79cf">TH_BACK</a>, 0.5);
<a name="l05992"></a>05992             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, guidevec1, mindist, imat);
<a name="l05993"></a>05993             
<a name="l05994"></a>05994             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, guidevec1); <span class="comment">/* max center */</span>
<a name="l05995"></a>05995         }
<a name="l05996"></a>05996     }
<a name="l05997"></a>05997 
<a name="l05998"></a>05998     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(3);
<a name="l05999"></a>05999     <a class="code" href="../../de/d96/UI__resources_8h.html#ad4ede272051fd08d70f30570ad85a852">UI_ThemeColorBlend</a>(curcol, <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a2f524dc89597307994ab7d91402f79cf">TH_BACK</a>, 0.5);
<a name="l06000"></a>06000 
<a name="l06001"></a>06001     <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a9854ac968a485aeaef50167c9068b7f8">falloff</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ad5255ec498661b241725dfa68f010cb2">PFIELD_FALL_SPHERE</a>) {
<a name="l06002"></a>06002         <span class="comment">/* as last, guide curve alters it */</span>
<a name="l06003"></a>06003         <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#aebe9057cbff4580b7382058209d6406c">PFIELD_USEMAX</a>)
<a name="l06004"></a>06004             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, vec, pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a23ef38ec3a78cd5875d4bbef354698bd">maxdist</a>, imat);
<a name="l06005"></a>06005 
<a name="l06006"></a>06006         <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a4270a27eb9eb77e2dc072b7e46036f7e">PFIELD_USEMIN</a>)
<a name="l06007"></a>06007             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, vec, pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a89ecb02215e2583356d0b47e1369f2ee">mindist</a>, imat);
<a name="l06008"></a>06008     }
<a name="l06009"></a>06009     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a9854ac968a485aeaef50167c9068b7f8">falloff</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#aa0848947844fb0bf16a462b88d097130">PFIELD_FALL_TUBE</a>) {
<a name="l06010"></a>06010         <span class="keywordtype">float</span> radius, <a class="code" href="../../d1/d22/stdosl_8h.html#a4d04eb0874bac8d51beb2f1d36fe6107">distance</a>;
<a name="l06011"></a>06011 
<a name="l06012"></a>06012         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(tmat);
<a name="l06013"></a>06013 
<a name="l06014"></a>06014         vec[0] = vec[1] = 0.0f;
<a name="l06015"></a>06015         radius = (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#aae0a9e7044b6f344ff49991f1c1fa82a">PFIELD_USEMAXR</a>) ? pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#ab36c66edf5e70cf4dd1c324dae460ffd">maxrad</a> : 1.0f;
<a name="l06016"></a>06016         distance = (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#aebe9057cbff4580b7382058209d6406c">PFIELD_USEMAX</a>) ? pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a23ef38ec3a78cd5875d4bbef354698bd">maxdist</a> : 0.0f;
<a name="l06017"></a>06017         vec[2] = <a class="code" href="../../d1/d22/stdosl_8h.html#a4d04eb0874bac8d51beb2f1d36fe6107">distance</a>;
<a name="l06018"></a>06018         distance = (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#aa66a7173c70781ae4b85960c9c3471bf">PFIELD_POSZ</a>) ? -distance : -2.0f * distance;
<a name="l06019"></a>06019 
<a name="l06020"></a>06020         <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; (<a class="code" href="../../d2/d60/DNA__object__force_8h.html#aebe9057cbff4580b7382058209d6406c">PFIELD_USEMAX</a> | <a class="code" href="../../d2/d60/DNA__object__force_8h.html#aae0a9e7044b6f344ff49991f1c1fa82a">PFIELD_USEMAXR</a>))
<a name="l06021"></a>06021             <a class="code" href="../../d3/d02/drawobject_8c.html#aebe375e1f420f509f82498a2a053c1b1">drawtube</a>(vec, radius, distance, tmat);
<a name="l06022"></a>06022 
<a name="l06023"></a>06023         radius = (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a3c06a387f4f07cf04db9d954c574ee48">PFIELD_USEMINR</a>) ? pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a8004517d15423896959411ae525ba8da">minrad</a> : 1.0f;
<a name="l06024"></a>06024         distance = (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a4270a27eb9eb77e2dc072b7e46036f7e">PFIELD_USEMIN</a>) ? pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a89ecb02215e2583356d0b47e1369f2ee">mindist</a> : 0.0f;
<a name="l06025"></a>06025         vec[2] = <a class="code" href="../../d1/d22/stdosl_8h.html#a4d04eb0874bac8d51beb2f1d36fe6107">distance</a>;
<a name="l06026"></a>06026         distance = (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#aa66a7173c70781ae4b85960c9c3471bf">PFIELD_POSZ</a>) ? -distance : -2.0f * distance;
<a name="l06027"></a>06027 
<a name="l06028"></a>06028         <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; (<a class="code" href="../../d2/d60/DNA__object__force_8h.html#a4270a27eb9eb77e2dc072b7e46036f7e">PFIELD_USEMIN</a> | <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a3c06a387f4f07cf04db9d954c574ee48">PFIELD_USEMINR</a>))
<a name="l06029"></a>06029             <a class="code" href="../../d3/d02/drawobject_8c.html#aebe375e1f420f509f82498a2a053c1b1">drawtube</a>(vec, radius, distance, tmat);
<a name="l06030"></a>06030     }
<a name="l06031"></a>06031     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a9854ac968a485aeaef50167c9068b7f8">falloff</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a3e6bb406a9c41a3bdcddde8bc5026ef7">PFIELD_FALL_CONE</a>) {
<a name="l06032"></a>06032         <span class="keywordtype">float</span> radius, <a class="code" href="../../d1/d22/stdosl_8h.html#a4d04eb0874bac8d51beb2f1d36fe6107">distance</a>;
<a name="l06033"></a>06033 
<a name="l06034"></a>06034         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(tmat);
<a name="l06035"></a>06035 
<a name="l06036"></a>06036         radius = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>((pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#aae0a9e7044b6f344ff49991f1c1fa82a">PFIELD_USEMAXR</a>) ? pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#ab36c66edf5e70cf4dd1c324dae460ffd">maxrad</a> : 1.0f);
<a name="l06037"></a>06037         distance = (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#aebe9057cbff4580b7382058209d6406c">PFIELD_USEMAX</a>) ? pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a23ef38ec3a78cd5875d4bbef354698bd">maxdist</a> : 0.0f;
<a name="l06038"></a>06038 
<a name="l06039"></a>06039         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; (<a class="code" href="../../d2/d60/DNA__object__force_8h.html#aebe9057cbff4580b7382058209d6406c">PFIELD_USEMAX</a> | <a class="code" href="../../d2/d60/DNA__object__force_8h.html#aae0a9e7044b6f344ff49991f1c1fa82a">PFIELD_USEMAXR</a>)) {
<a name="l06040"></a>06040             <a class="code" href="../../d3/d02/drawobject_8c.html#a2b810a77ec9f4541986236361f46ee17">drawcone</a>(vec, distance * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a1a55e3226c270625a4bff1befa977638">sinf</a>(radius), distance * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a2503b77b52ff481a3507a596ae1f3938">cosf</a>(radius), tmat);
<a name="l06041"></a>06041             <span class="keywordflow">if</span> ((pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#aa66a7173c70781ae4b85960c9c3471bf">PFIELD_POSZ</a>) == 0)
<a name="l06042"></a>06042                 <a class="code" href="../../d3/d02/drawobject_8c.html#a2b810a77ec9f4541986236361f46ee17">drawcone</a>(vec, distance * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a1a55e3226c270625a4bff1befa977638">sinf</a>(radius), -distance * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a2503b77b52ff481a3507a596ae1f3938">cosf</a>(radius), tmat);
<a name="l06043"></a>06043         }
<a name="l06044"></a>06044 
<a name="l06045"></a>06045         radius = <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>((pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a3c06a387f4f07cf04db9d954c574ee48">PFIELD_USEMINR</a>) ? pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a8004517d15423896959411ae525ba8da">minrad</a> : 1.0f);
<a name="l06046"></a>06046         distance = (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a4270a27eb9eb77e2dc072b7e46036f7e">PFIELD_USEMIN</a>) ? pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a89ecb02215e2583356d0b47e1369f2ee">mindist</a> : 0.0f;
<a name="l06047"></a>06047 
<a name="l06048"></a>06048         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; (<a class="code" href="../../d2/d60/DNA__object__force_8h.html#a4270a27eb9eb77e2dc072b7e46036f7e">PFIELD_USEMIN</a> | <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a3c06a387f4f07cf04db9d954c574ee48">PFIELD_USEMINR</a>)) {
<a name="l06049"></a>06049             <a class="code" href="../../d3/d02/drawobject_8c.html#a2b810a77ec9f4541986236361f46ee17">drawcone</a>(vec, distance * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a1a55e3226c270625a4bff1befa977638">sinf</a>(radius), distance * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a2503b77b52ff481a3507a596ae1f3938">cosf</a>(radius), tmat);
<a name="l06050"></a>06050             <span class="keywordflow">if</span> ((pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#aa66a7173c70781ae4b85960c9c3471bf">PFIELD_POSZ</a>) == 0)
<a name="l06051"></a>06051                 <a class="code" href="../../d3/d02/drawobject_8c.html#a2b810a77ec9f4541986236361f46ee17">drawcone</a>(vec, distance * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a1a55e3226c270625a4bff1befa977638">sinf</a>(radius), -distance * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a2503b77b52ff481a3507a596ae1f3938">cosf</a>(radius), tmat);
<a name="l06052"></a>06052         }
<a name="l06053"></a>06053     }
<a name="l06054"></a>06054     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(0);
<a name="l06055"></a>06055 }
<a name="l06056"></a>06056 
<a name="l06057"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a4eb61ad4673bb52fba1bdfc7c0bda235">06057</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a4eb61ad4673bb52fba1bdfc7c0bda235">draw_box</a>(<span class="keywordtype">float</span> vec[8][3])
<a name="l06058"></a>06058 {
<a name="l06059"></a>06059     glBegin(GL_LINE_STRIP);
<a name="l06060"></a>06060     glVertex3fv(vec[0]); glVertex3fv(vec[1]); glVertex3fv(vec[2]); glVertex3fv(vec[3]);
<a name="l06061"></a>06061     glVertex3fv(vec[0]); glVertex3fv(vec[4]); glVertex3fv(vec[5]); glVertex3fv(vec[6]);
<a name="l06062"></a>06062     glVertex3fv(vec[7]); glVertex3fv(vec[4]);
<a name="l06063"></a>06063     glEnd();
<a name="l06064"></a>06064 
<a name="l06065"></a>06065     glBegin(GL_LINES);
<a name="l06066"></a>06066     glVertex3fv(vec[1]); glVertex3fv(vec[5]);
<a name="l06067"></a>06067     glVertex3fv(vec[2]); glVertex3fv(vec[6]);
<a name="l06068"></a>06068     glVertex3fv(vec[3]); glVertex3fv(vec[7]);
<a name="l06069"></a>06069     glEnd();
<a name="l06070"></a>06070 }
<a name="l06071"></a>06071 
<a name="l06072"></a>06072 <span class="comment">/* uses boundbox, function used by Ketsji */</span>
<a name="l06073"></a>06073 <span class="preprocessor">#if 0</span>
<a name="l06074"></a>06074 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span> get_local_bounds(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keywordtype">float</span> center[3], <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>[3])
<a name="l06075"></a>06075 {
<a name="l06076"></a>06076     <a class="code" href="../../d3/d8a/structBoundBox.html">BoundBox</a> *bb = <a class="code" href="../../df/dac/BKE__object_8h.html#a06d0e9b4ebc3a7cf0f99a8916f90a851">object_get_boundbox</a>(ob);
<a name="l06077"></a>06077     
<a name="l06078"></a>06078     <span class="keywordflow">if</span> (bb == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l06079"></a>06079         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#acd4d89007c860a4c74d459ac72593065">zero_v3</a>(center);
<a name="l06080"></a>06080         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(size, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a46e0f5309f8c13d85e16fa6436acf9f8">size</a>);
<a name="l06081"></a>06081     }
<a name="l06082"></a>06082     <span class="keywordflow">else</span> {
<a name="l06083"></a>06083         size[0] = 0.5 * <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][0] - bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[4][0]);
<a name="l06084"></a>06084         size[1] = 0.5 * <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][1] - bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[2][1]);
<a name="l06085"></a>06085         size[2] = 0.5 * <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][2] - bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[1][2]);
<a name="l06086"></a>06086 
<a name="l06087"></a>06087         center[0] = (bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][0] + bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[4][0]) / 2.0;
<a name="l06088"></a>06088         center[1] = (bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][1] + bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[2][1]) / 2.0;
<a name="l06089"></a>06089         center[2] = (bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][2] + bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[1][2]) / 2.0;
<a name="l06090"></a>06090     }
<a name="l06091"></a>06091 }
<a name="l06092"></a>06092 <span class="preprocessor">#endif</span>
<a name="l06093"></a>06093 <span class="preprocessor"></span>
<a name="l06094"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a8d9416a684d9f68163c60f6c2ec8679a">06094</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a8d9416a684d9f68163c60f6c2ec8679a">draw_bb_quadric</a>(<a class="code" href="../../d3/d8a/structBoundBox.html">BoundBox</a> *bb, <span class="keywordtype">char</span> type)
<a name="l06095"></a>06095 {
<a name="l06096"></a>06096     <span class="keywordtype">float</span> size[3], cent[3];
<a name="l06097"></a>06097     GLUquadricObj *qobj = gluNewQuadric();
<a name="l06098"></a>06098     
<a name="l06099"></a>06099     gluQuadricDrawStyle(qobj, GLU_SILHOUETTE);
<a name="l06100"></a>06100     
<a name="l06101"></a>06101     size[0] = 0.5f * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][0] - bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[4][0]);
<a name="l06102"></a>06102     size[1] = 0.5f * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][1] - bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[2][1]);
<a name="l06103"></a>06103     size[2] = 0.5f * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][2] - bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[1][2]);
<a name="l06104"></a>06104 
<a name="l06105"></a>06105     cent[0] = 0.5f * (bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][0] + bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[4][0]);
<a name="l06106"></a>06106     cent[1] = 0.5f * (bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][1] + bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[2][1]);
<a name="l06107"></a>06107     cent[2] = 0.5f * (bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][2] + bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[1][2]);
<a name="l06108"></a>06108     
<a name="l06109"></a>06109     glPushMatrix();
<a name="l06110"></a>06110     <span class="keywordflow">if</span> (type == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a12dc86faea388ad0da209de37046e165">OB_BOUND_SPHERE</a>) {
<a name="l06111"></a>06111         glTranslatef(cent[0], cent[1], cent[2]);
<a name="l06112"></a>06112         glScalef(size[0], size[1], size[2]);
<a name="l06113"></a>06113         gluSphere(qobj, 1.0, 8, 5);
<a name="l06114"></a>06114     }
<a name="l06115"></a>06115     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a2aa458321e483c765698791514be074d">OB_BOUND_CYLINDER</a>) {
<a name="l06116"></a>06116         <span class="keywordtype">float</span> radius = size[0] &gt; size[1] ? size[0] : size[1];
<a name="l06117"></a>06117         glTranslatef(cent[0], cent[1], cent[2] - size[2]);
<a name="l06118"></a>06118         glScalef(radius, radius, 2.0f * size[2]);
<a name="l06119"></a>06119         gluCylinder(qobj, 1.0, 1.0, 1.0, 8, 1);
<a name="l06120"></a>06120     }
<a name="l06121"></a>06121     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a2ef5a74afe035ebf8b1344f6ab0f00c0">OB_BOUND_CONE</a>) {
<a name="l06122"></a>06122         <span class="keywordtype">float</span> radius = size[0] &gt; size[1] ? size[0] : size[1];
<a name="l06123"></a>06123         glTranslatef(cent[0], cent[1], cent[2] - size[2]);
<a name="l06124"></a>06124         glScalef(radius, radius, 2.0f * size[2]);
<a name="l06125"></a>06125         gluCylinder(qobj, 1.0, 0.0, 1.0, 8, 1);
<a name="l06126"></a>06126     }
<a name="l06127"></a>06127     glPopMatrix();
<a name="l06128"></a>06128     
<a name="l06129"></a>06129     gluDeleteQuadric(qobj);
<a name="l06130"></a>06130 }
<a name="l06131"></a>06131 
<a name="l06132"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a4d19f50de723a4c82b4a1695f99400d4">06132</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a4d19f50de723a4c82b4a1695f99400d4">draw_bounding_volume</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keywordtype">char</span> type)
<a name="l06133"></a>06133 {
<a name="l06134"></a>06134     <a class="code" href="../../d3/d8a/structBoundBox.html">BoundBox</a> *bb = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06135"></a>06135     
<a name="l06136"></a>06136     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>) {
<a name="l06137"></a>06137         bb = <a class="code" href="../../df/d7f/BKE__mesh_8h.html#aa011adb6b84866cd80dd86d451554653">mesh_get_bb</a>(ob);
<a name="l06138"></a>06138     }
<a name="l06139"></a>06139     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1a94162b6fc469957966a01d41ff71d6">OB_FONT</a>)) {
<a name="l06140"></a>06140         bb = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a> ? ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a> : ( (<a class="code" href="../../da/d10/structCurve.html">Curve</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>)-&gt;bb;
<a name="l06141"></a>06141     }
<a name="l06142"></a>06142     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a046d883c32490b5c5ca4c5e7b6504e35">OB_MBALL</a>) {
<a name="l06143"></a>06143         <span class="keywordflow">if</span> (<a class="code" href="../../df/dae/BKE__mball_8h.html#ac35c80651b886132c4740f3296b84f0e" title="Test, if Object *ob is basic MetaBall.">is_basis_mball</a>(ob)) {
<a name="l06144"></a>06144             bb = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a>;
<a name="l06145"></a>06145             <span class="keywordflow">if</span> (bb == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l06146"></a>06146                 <a class="code" href="../../d9/d12/BKE__displist_8h.html#a9915c0524464b04d2d03084c6fa87b3f">makeDispListMBall</a>(scene, ob);
<a name="l06147"></a>06147                 bb = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a>;
<a name="l06148"></a>06148             }
<a name="l06149"></a>06149         }
<a name="l06150"></a>06150     }
<a name="l06151"></a>06151     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>) {
<a name="l06152"></a>06152         bb = <a class="code" href="../../da/d17/BKE__armature_8h.html#a1fa23f9322fca73f1028af5d120a6454">BKE_armature_get_bb</a>(ob);
<a name="l06153"></a>06153     }
<a name="l06154"></a>06154     <span class="keywordflow">else</span> {
<a name="l06155"></a>06155         <a class="code" href="../../d3/d02/drawobject_8c.html#a269166b5f84721dcbcf71ec23bc65763">drawcube</a>();
<a name="l06156"></a>06156         <span class="keywordflow">return</span>;
<a name="l06157"></a>06157     }
<a name="l06158"></a>06158     
<a name="l06159"></a>06159     <span class="keywordflow">if</span> (bb == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l06160"></a>06160     
<a name="l06161"></a>06161     <span class="keywordflow">if</span> (type == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a72f33cfe4bcec0c725cff4b05f5f4ce5">OB_BOUND_BOX</a>) <a class="code" href="../../d3/d02/drawobject_8c.html#a4eb61ad4673bb52fba1bdfc7c0bda235">draw_box</a>(bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>);
<a name="l06162"></a>06162     <span class="keywordflow">else</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a8d9416a684d9f68163c60f6c2ec8679a">draw_bb_quadric</a>(bb, type);
<a name="l06163"></a>06163     
<a name="l06164"></a>06164 }
<a name="l06165"></a>06165 
<a name="l06166"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a4f3e5237be3cb57e6124f92eaaad7553">06166</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a4f3e5237be3cb57e6124f92eaaad7553">drawtexspace</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l06167"></a>06167 {
<a name="l06168"></a>06168     <span class="keywordtype">float</span> vec[8][3], loc[3], size[3];
<a name="l06169"></a>06169     
<a name="l06170"></a>06170     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>) {
<a name="l06171"></a>06171         <a class="code" href="../../df/d7f/BKE__mesh_8h.html#ac4f3c3b63da7e1e65a49d259a39bb7a4">mesh_get_texspace</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, loc, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, size);
<a name="l06172"></a>06172     }
<a name="l06173"></a>06173     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1a94162b6fc469957966a01d41ff71d6">OB_FONT</a>)) {
<a name="l06174"></a>06174         <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l06175"></a>06175         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(size, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>);
<a name="l06176"></a>06176         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(loc, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0e1c86cf707b01a2754d17a15df09914">loc</a>);
<a name="l06177"></a>06177     }
<a name="l06178"></a>06178     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a046d883c32490b5c5ca4c5e7b6504e35">OB_MBALL</a>) {
<a name="l06179"></a>06179         <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l06180"></a>06180         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(size, mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a3198ab542f7285db71c8965aaffcf7db">size</a>);
<a name="l06181"></a>06181         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(loc, mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac5809adfbe49e7259afa9ed4c8e1bf12">loc</a>);
<a name="l06182"></a>06182     }
<a name="l06183"></a>06183     <span class="keywordflow">else</span> <span class="keywordflow">return</span>;
<a name="l06184"></a>06184     
<a name="l06185"></a>06185     vec[0][0] = vec[1][0] = vec[2][0] = vec[3][0] = loc[0] - size[0];
<a name="l06186"></a>06186     vec[4][0] = vec[5][0] = vec[6][0] = vec[7][0] = loc[0] + size[0];
<a name="l06187"></a>06187     
<a name="l06188"></a>06188     vec[0][1] = vec[1][1] = vec[4][1] = vec[5][1] = loc[1] - size[1];
<a name="l06189"></a>06189     vec[2][1] = vec[3][1] = vec[6][1] = vec[7][1] = loc[1] + size[1];
<a name="l06190"></a>06190 
<a name="l06191"></a>06191     vec[0][2] = vec[3][2] = vec[4][2] = vec[7][2] = loc[2] - size[2];
<a name="l06192"></a>06192     vec[1][2] = vec[2][2] = vec[5][2] = vec[6][2] = loc[2] + size[2];
<a name="l06193"></a>06193     
<a name="l06194"></a>06194     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(2);
<a name="l06195"></a>06195 
<a name="l06196"></a>06196     <a class="code" href="../../d3/d02/drawobject_8c.html#a4eb61ad4673bb52fba1bdfc7c0bda235">draw_box</a>(vec);
<a name="l06197"></a>06197 
<a name="l06198"></a>06198     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(0);
<a name="l06199"></a>06199 }
<a name="l06200"></a>06200 
<a name="l06201"></a>06201 <span class="comment">/* draws wire outline */</span>
<a name="l06202"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a008f97d0f5e88f0859a2aeb0fe8ecf44">06202</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a008f97d0f5e88f0859a2aeb0fe8ecf44">drawObjectSelect</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../d3/da9/structBase.html">Base</a> *base)
<a name="l06203"></a>06203 {
<a name="l06204"></a>06204     <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>;
<a name="l06205"></a>06205     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l06206"></a>06206     
<a name="l06207"></a>06207     glLineWidth(2.0);
<a name="l06208"></a>06208     glDepthMask(0);
<a name="l06209"></a>06209     
<a name="l06210"></a>06210     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1a94162b6fc469957966a01d41ff71d6">OB_FONT</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>)) {
<a name="l06211"></a>06211         <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l06212"></a>06212         <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a90f2cb67625caff2124e0675ea32510d">derivedFinal</a>;
<a name="l06213"></a>06213         <span class="keywordtype">int</span> hasfaces = 0;
<a name="l06214"></a>06214 
<a name="l06215"></a>06215         <span class="keywordflow">if</span> (dm) {
<a name="l06216"></a>06216             hasfaces = dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a3481fefe300b7d6b456071320be70c56">getNumTessFaces</a>(dm);
<a name="l06217"></a>06217         }
<a name="l06218"></a>06218         <span class="keywordflow">else</span> {
<a name="l06219"></a>06219             hasfaces = <a class="code" href="../../d9/d12/BKE__displist_8h.html#a07032f2f6e32a6dd4ba044825c5d925e">displist_has_faces</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a45d11e4826c3a8ba292c91691bb2885d">disp</a>);
<a name="l06220"></a>06220         }
<a name="l06221"></a>06221 
<a name="l06222"></a>06222         <span class="keywordflow">if</span> (hasfaces &amp;&amp; <a class="code" href="../../d4/df4/view3d__intern_8h.html#a6bfc52d69da31d8e5c9a2eb4384fd90a">ED_view3d_boundbox_clip</a>(rv3d, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a> ? ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a> : cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a523cd93ea45778db87896479460cd5d0">bb</a>)) {
<a name="l06223"></a>06223             draw_index_wire = 0;
<a name="l06224"></a>06224             <span class="keywordflow">if</span> (dm) {
<a name="l06225"></a>06225                 <a class="code" href="../../d3/d02/drawobject_8c.html#a0ce5944dca582d34c478ae482f47801b">draw_mesh_object_outline</a>(v3d, ob, dm);
<a name="l06226"></a>06226             }
<a name="l06227"></a>06227             <span class="keywordflow">else</span> {
<a name="l06228"></a>06228                 <a class="code" href="../../d3/d02/drawobject_8c.html#aae58e1c67b48d497a097d5d021d59244">drawDispListwire</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a45d11e4826c3a8ba292c91691bb2885d">disp</a>);
<a name="l06229"></a>06229             }
<a name="l06230"></a>06230             draw_index_wire = 1;
<a name="l06231"></a>06231         }
<a name="l06232"></a>06232     }
<a name="l06233"></a>06233     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a046d883c32490b5c5ca4c5e7b6504e35">OB_MBALL</a>) {
<a name="l06234"></a>06234         <span class="keywordflow">if</span> (<a class="code" href="../../df/dae/BKE__mball_8h.html#ac35c80651b886132c4740f3296b84f0e" title="Test, if Object *ob is basic MetaBall.">is_basis_mball</a>(ob)) {
<a name="l06235"></a>06235             <span class="keywordflow">if</span> ((base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ac31d50d415c660a44c0ccdc6b4854721">OB_FROMDUPLI</a>) == 0)
<a name="l06236"></a>06236                 <a class="code" href="../../d3/d02/drawobject_8c.html#aae58e1c67b48d497a097d5d021d59244">drawDispListwire</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a45d11e4826c3a8ba292c91691bb2885d">disp</a>);
<a name="l06237"></a>06237         }
<a name="l06238"></a>06238     }
<a name="l06239"></a>06239     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>) {
<a name="l06240"></a>06240         <span class="keywordflow">if</span> (!(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550acfed9b4bf4a7e2d3c5ae0b3571e38950">OB_MODE_POSE</a> &amp;&amp; base == scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a040bbb56eb7746d04c4ae455e5b1c638">basact</a>))
<a name="l06241"></a>06241             <a class="code" href="../../d4/dd4/drawarmature_8c.html#a2c84ad02321d03ce664526e074da63f3">draw_armature</a>(scene, v3d, ar, base, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06242"></a>06242     }
<a name="l06243"></a>06243 
<a name="l06244"></a>06244     glLineWidth(1.0);
<a name="l06245"></a>06245     glDepthMask(1);
<a name="l06246"></a>06246 }
<a name="l06247"></a>06247 
<a name="l06248"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a92092ed8db0b6d3432aa29d4e30ad27a">06248</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a92092ed8db0b6d3432aa29d4e30ad27a">drawWireExtra</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob) 
<a name="l06249"></a>06249 {
<a name="l06250"></a>06250     <span class="keywordflow">if</span> (ob != scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a1aa1978dba5dab99d35b6ba89e88b5bb">obedit</a> &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) {
<a name="l06251"></a>06251         <span class="keywordflow">if</span> (ob == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a119935c54737bd111df8fd516c390000">OBACT</a>) {
<a name="l06252"></a>06252             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9588748603be4778a9197f7edbf356d4">OB_FROMGROUP</a>) <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531ad2ba053e9237f2b78da8da066b4529e6">TH_GROUP_ACTIVE</a>);
<a name="l06253"></a>06253             <span class="keywordflow">else</span> <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531af47479527035752070059cf6669daf09">TH_ACTIVE</a>);
<a name="l06254"></a>06254         }
<a name="l06255"></a>06255         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9588748603be4778a9197f7edbf356d4">OB_FROMGROUP</a>)
<a name="l06256"></a>06256             <a class="code" href="../../de/d96/UI__resources_8h.html#a56c7a350537a25b88d0532488032aef6">UI_ThemeColorShade</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531ad2ba053e9237f2b78da8da066b4529e6">TH_GROUP_ACTIVE</a>, -16);
<a name="l06257"></a>06257         <span class="keywordflow">else</span>
<a name="l06258"></a>06258             <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531acf22ebe596e9394104b732b077cbec7a">TH_SELECT</a>);
<a name="l06259"></a>06259     }
<a name="l06260"></a>06260     <span class="keywordflow">else</span> {
<a name="l06261"></a>06261         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9588748603be4778a9197f7edbf356d4">OB_FROMGROUP</a>)
<a name="l06262"></a>06262             <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a40a85507e5970cdab915fbc81828f3ff">TH_GROUP</a>);
<a name="l06263"></a>06263         <span class="keywordflow">else</span> {
<a name="l06264"></a>06264             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a2e4203e6270100e25ef3d5ec64fc31a6">dtx</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5ab5449c65c7be34a82d408aff1c4e28">OB_DRAWWIRE</a>) {
<a name="l06265"></a>06265                 glColor3ub(80, 80, 80);
<a name="l06266"></a>06266             }
<a name="l06267"></a>06267             <span class="keywordflow">else</span> {
<a name="l06268"></a>06268                 <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l06269"></a>06269             }
<a name="l06270"></a>06270         }
<a name="l06271"></a>06271     }
<a name="l06272"></a>06272     
<a name="l06273"></a>06273     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a34edada4ce250a4abb76f2011ac70a76">bglPolygonOffset</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a5a4f191256ccc5c28828b922636ca588">dist</a>, 1.0);
<a name="l06274"></a>06274     glDepthMask(0); <span class="comment">// disable write in zbuffer, selected edge wires show better</span>
<a name="l06275"></a>06275     
<a name="l06276"></a>06276     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1a94162b6fc469957966a01d41ff71d6">OB_FONT</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>)) {
<a name="l06277"></a>06277         <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l06278"></a>06278         <span class="keywordflow">if</span> (<a class="code" href="../../d4/df4/view3d__intern_8h.html#a6bfc52d69da31d8e5c9a2eb4384fd90a">ED_view3d_boundbox_clip</a>(rv3d, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a> ? ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a> : cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a523cd93ea45778db87896479460cd5d0">bb</a>)) {
<a name="l06279"></a>06279             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>)
<a name="l06280"></a>06280                 draw_index_wire = 0;
<a name="l06281"></a>06281 
<a name="l06282"></a>06282             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a90f2cb67625caff2124e0675ea32510d">derivedFinal</a>) {
<a name="l06283"></a>06283                 <a class="code" href="../../d3/d02/drawobject_8c.html#aa79d0bdf6ad739f24406022777dc73ec">drawCurveDMWired</a>(ob);
<a name="l06284"></a>06284             }
<a name="l06285"></a>06285             <span class="keywordflow">else</span> {
<a name="l06286"></a>06286                 <a class="code" href="../../d3/d02/drawobject_8c.html#aae58e1c67b48d497a097d5d021d59244">drawDispListwire</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a45d11e4826c3a8ba292c91691bb2885d">disp</a>);
<a name="l06287"></a>06287             }
<a name="l06288"></a>06288 
<a name="l06289"></a>06289             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>)
<a name="l06290"></a>06290                 draw_index_wire = 1;
<a name="l06291"></a>06291         }
<a name="l06292"></a>06292     }
<a name="l06293"></a>06293     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a046d883c32490b5c5ca4c5e7b6504e35">OB_MBALL</a>) {
<a name="l06294"></a>06294         <span class="keywordflow">if</span> (<a class="code" href="../../df/dae/BKE__mball_8h.html#ac35c80651b886132c4740f3296b84f0e" title="Test, if Object *ob is basic MetaBall.">is_basis_mball</a>(ob)) {
<a name="l06295"></a>06295             <a class="code" href="../../d3/d02/drawobject_8c.html#aae58e1c67b48d497a097d5d021d59244">drawDispListwire</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a45d11e4826c3a8ba292c91691bb2885d">disp</a>);
<a name="l06296"></a>06296         }
<a name="l06297"></a>06297     }
<a name="l06298"></a>06298 
<a name="l06299"></a>06299     glDepthMask(1);
<a name="l06300"></a>06300     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a34edada4ce250a4abb76f2011ac70a76">bglPolygonOffset</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a5a4f191256ccc5c28828b922636ca588">dist</a>, 0.0);
<a name="l06301"></a>06301 }
<a name="l06302"></a>06302 
<a name="l06303"></a>06303 <span class="comment">/* should be called in view space */</span>
<a name="l06304"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a2d935b450223f072a853343296463b98">06304</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a2d935b450223f072a853343296463b98">draw_hooks</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l06305"></a>06305 {
<a name="l06306"></a>06306     <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l06307"></a>06307     <span class="keywordtype">float</span> vec[3];
<a name="l06308"></a>06308     
<a name="l06309"></a>06309     <span class="keywordflow">for</span> (md = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md = md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l06310"></a>06310         <span class="keywordflow">if</span> (md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a> == <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a82ec76427c7cc0b352e6aadb2e3d0b89">eModifierType_Hook</a>) {
<a name="l06311"></a>06311             <a class="code" href="../../d8/d2c/structHookModifierData.html">HookModifierData</a> *hmd = (<a class="code" href="../../d8/d2c/structHookModifierData.html">HookModifierData</a> *) md;
<a name="l06312"></a>06312 
<a name="l06313"></a>06313             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad7be0179ee8a128512e2c7f0ad11c8d8">mul_v3_m4v3</a>(vec, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, hmd-&gt;<a class="code" href="../../d8/d2c/structHookModifierData.html#af21fa566f20408a653399940303a8dd9">cent</a>);
<a name="l06314"></a>06314 
<a name="l06315"></a>06315             <span class="keywordflow">if</span> (hmd-&gt;<a class="code" href="../../d8/d2c/structHookModifierData.html#ae539a97632b216b678294b1c1fa80a88">object</a>) {
<a name="l06316"></a>06316                 <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(3);
<a name="l06317"></a>06317                 glBegin(GL_LINES);
<a name="l06318"></a>06318                 glVertex3fv(hmd-&gt;<a class="code" href="../../d8/d2c/structHookModifierData.html#ae539a97632b216b678294b1c1fa80a88">object</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3]);
<a name="l06319"></a>06319                 glVertex3fv(vec);
<a name="l06320"></a>06320                 glEnd();
<a name="l06321"></a>06321                 <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(0);
<a name="l06322"></a>06322             }
<a name="l06323"></a>06323 
<a name="l06324"></a>06324             glPointSize(3.0);
<a name="l06325"></a>06325             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#acbcc8c3223d7fc13a7931b0a1744b240">bglBegin</a>(GL_POINTS);
<a name="l06326"></a>06326             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(vec);
<a name="l06327"></a>06327             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a2517dcaf453d3e58af25fd4c677dad45">bglEnd</a>();
<a name="l06328"></a>06328             glPointSize(1.0);
<a name="l06329"></a>06329         }
<a name="l06330"></a>06330     }
<a name="l06331"></a>06331 }
<a name="l06332"></a>06332 
<a name="l06333"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a8f15e288a13a6935c832ec813654529d">06333</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a8f15e288a13a6935c832ec813654529d">drawRBpivot</a>(<a class="code" href="../../d8/dd4/structbRigidBodyJointConstraint.html">bRigidBodyJointConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l06334"></a>06334 {
<a name="l06335"></a>06335     <span class="keyword">const</span> <span class="keywordtype">char</span> *axis_str[3] = {<span class="stringliteral">&quot;px&quot;</span>, <span class="stringliteral">&quot;py&quot;</span>, <span class="stringliteral">&quot;pz&quot;</span>};
<a name="l06336"></a>06336     <span class="keywordtype">int</span> axis;
<a name="l06337"></a>06337     <span class="keywordtype">float</span> mat[4][4];
<a name="l06338"></a>06338 
<a name="l06339"></a>06339     <span class="comment">/* color */</span>
<a name="l06340"></a>06340     <span class="keywordtype">float</span> curcol[4];
<a name="l06341"></a>06341     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> tcol[4];
<a name="l06342"></a>06342 
<a name="l06343"></a>06343     glGetFloatv(GL_CURRENT_COLOR, curcol);
<a name="l06344"></a>06344     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a9b3bb8bb3331550782244e732cd1d349">rgb_float_to_uchar</a>(tcol, curcol);
<a name="l06345"></a>06345     tcol[3] = 255;
<a name="l06346"></a>06346 
<a name="l06347"></a>06347     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#afc3de3a2327040557f8b94047b2a8a96">eul_to_mat4</a>(mat, &amp;data-&gt;<a class="code" href="../../d8/dd4/structbRigidBodyJointConstraint.html#aaf68f1bac8f98640c374183e5179b24a">axX</a>);
<a name="l06348"></a>06348     glLineWidth(4.0f);
<a name="l06349"></a>06349     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(2);
<a name="l06350"></a>06350     <span class="keywordflow">for</span> (axis = 0; axis &lt; 3; axis++) {
<a name="l06351"></a>06351         <span class="keywordtype">float</span> dir[3] = {0, 0, 0};
<a name="l06352"></a>06352         <span class="keywordtype">float</span> v[3];
<a name="l06353"></a>06353 
<a name="l06354"></a>06354         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(v, &amp;data-&gt;<a class="code" href="../../d8/dd4/structbRigidBodyJointConstraint.html#aa60a2e3c9ff99b85ead8d170baa41aa1">pivX</a>);
<a name="l06355"></a>06355 
<a name="l06356"></a>06356         dir[axis] = 1.f;
<a name="l06357"></a>06357         glBegin(GL_LINES);
<a name="l06358"></a>06358         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(mat, dir);
<a name="l06359"></a>06359         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(v, dir);
<a name="l06360"></a>06360         glVertex3fv(&amp;data-&gt;<a class="code" href="../../d8/dd4/structbRigidBodyJointConstraint.html#aa60a2e3c9ff99b85ead8d170baa41aa1">pivX</a>);
<a name="l06361"></a>06361         glVertex3fv(v);
<a name="l06362"></a>06362         glEnd();
<a name="l06363"></a>06363 
<a name="l06364"></a>06364         <a class="code" href="../../d3/d02/drawobject_8c.html#a6de94308481c2e9de88b710de50dad2f">view3d_cached_text_draw_add</a>(v, axis_str[axis], 0, <a class="code" href="../../d4/df4/view3d__intern_8h.html#a19cf47d47eeef9d2339453c4833c7e77">V3D_CACHE_TEXT_ASCII</a>, tcol);
<a name="l06365"></a>06365     }
<a name="l06366"></a>06366     glLineWidth(1.0f);
<a name="l06367"></a>06367     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(0);
<a name="l06368"></a>06368 }
<a name="l06369"></a>06369 
<a name="l06370"></a>06370 <span class="comment">/* flag can be DRAW_PICKING and/or DRAW_CONSTCOLOR, DRAW_SCENESET */</span>
<a name="l06371"></a><a class="code" href="../../d4/df4/view3d__intern_8h.html#a086372a6e6ea67f5e9a0c950aeb09b39">06371</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a7b8c6cefd30eb439ad84f5ff8db81b85">draw_object</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../d3/da9/structBase.html">Base</a> *base, <span class="keywordtype">int</span> flag)
<a name="l06372"></a>06372 {
<a name="l06373"></a>06373     <span class="keyword">static</span> <span class="keywordtype">int</span> warning_recursive = 0;
<a name="l06374"></a>06374     <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06375"></a>06375     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l06376"></a>06376     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu;
<a name="l06377"></a>06377     <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>;
<a name="l06378"></a>06378     <span class="keywordtype">float</span> vec1[3], vec2[3];
<a name="l06379"></a>06379     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> col = 0;
<a name="l06380"></a>06380     <span class="keywordtype">int</span> <span class="comment">/*sel, drawtype,*/</span> colindex = 0;
<a name="l06381"></a>06381     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, selstart, selend, empty_object = 0;
<a name="l06382"></a>06382     <span class="keywordtype">short</span> dt, dtx, zbufoff = 0;
<a name="l06383"></a>06383     <span class="keyword">const</span> <span class="keywordtype">short</span> is_obact = (ob == <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a119935c54737bd111df8fd516c390000">OBACT</a>);
<a name="l06384"></a>06384 
<a name="l06385"></a>06385     <span class="comment">/* only once set now, will be removed too, should become a global standard */</span>
<a name="l06386"></a>06386     glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
<a name="l06387"></a>06387 
<a name="l06388"></a>06388     <span class="keywordflow">if</span> (ob != scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a1aa1978dba5dab99d35b6ba89e88b5bb">obedit</a>) {
<a name="l06389"></a>06389         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#afc7a8aca0c2cf33c6323883e313362b0">restrictflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a405802c89add02dcf80f5fbcce040b09">OB_RESTRICT_VIEW</a>) {
<a name="l06390"></a>06390             <span class="keywordflow">return</span>;
<a name="l06391"></a>06391         }
<a name="l06392"></a>06392         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((ob-&gt;<a class="code" href="../../de/de7/structObject.html#afc7a8aca0c2cf33c6323883e313362b0">restrictflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ab94b52225b1bb3d5083e9855b32902d0">OB_RESTRICT_RENDER</a>) &amp;&amp;
<a name="l06393"></a>06393                  (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>))
<a name="l06394"></a>06394         {
<a name="l06395"></a>06395             <span class="keywordflow">return</span>;
<a name="l06396"></a>06396         }
<a name="l06397"></a>06397     }
<a name="l06398"></a>06398 
<a name="l06399"></a>06399     <span class="comment">/* XXX particles are not safe for simultaneous threaded render */</span>
<a name="l06400"></a>06400     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.rendering &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)
<a name="l06401"></a>06401         <span class="keywordflow">return</span>;
<a name="l06402"></a>06402 
<a name="l06403"></a>06403     <span class="comment">/* xray delay? */</span>
<a name="l06404"></a>06404     <span class="keywordflow">if</span> ((flag &amp; <a class="code" href="../../d4/df4/view3d__intern_8h.html#a205a8c1771c3a0eab5ecd42de38c901c">DRAW_PICKING</a>) == 0 &amp;&amp; (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ac31d50d415c660a44c0ccdc6b4854721">OB_FROMDUPLI</a>) == 0) {
<a name="l06405"></a>06405         <span class="comment">/* don&#39;t do xray in particle mode, need the z-buffer */</span>
<a name="l06406"></a>06406         <span class="keywordflow">if</span> (!(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a20027b5f4381f062402af134bcefe889">OB_MODE_PARTICLE_EDIT</a>)) {
<a name="l06407"></a>06407             <span class="comment">/* xray and transp are set when it is drawing the 2nd/3rd pass */</span>
<a name="l06408"></a>06408             <span class="keywordflow">if</span> (!v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a6c3dbc2765218b5850a40f3afc522d42">xray</a> &amp;&amp; !v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#ae22790924a440701ed3d01ad4db5eee2">transp</a> &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a2e4203e6270100e25ef3d5ec64fc31a6">dtx</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aec24cba637ae295c6076159bac9ff80d">OB_DRAWXRAY</a>) &amp;&amp; !(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a2e4203e6270100e25ef3d5ec64fc31a6">dtx</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a0ed6e1b47d274d4a990ad765bad2483f">OB_DRAWTRANSP</a>)) {
<a name="l06409"></a>06409                 <a class="code" href="../../d8/d7f/view3d__draw_8c.html#a62d12554313bcbe2e30a7e7eda84aa59">add_view3d_after</a>(&amp;v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a5ebc452868e0552460b5e249d101d464">afterdraw_xray</a>, base, flag);
<a name="l06410"></a>06410                 <span class="keywordflow">return</span>;
<a name="l06411"></a>06411             }
<a name="l06412"></a>06412         }
<a name="l06413"></a>06413     }
<a name="l06414"></a>06414 
<a name="l06415"></a>06415     <span class="comment">/* no return after this point, otherwise leaks */</span>
<a name="l06416"></a>06416     <a class="code" href="../../d3/d02/drawobject_8c.html#ad72171d5caab24ec508b27b48dadae0e">view3d_cached_text_draw_begin</a>();
<a name="l06417"></a>06417     
<a name="l06418"></a>06418     <span class="comment">/* patch? children objects with a timeoffs change the parents. How to solve! */</span>
<a name="l06419"></a>06419     <span class="comment">/* if ( ((int)ob-&gt;ctime) != F_(scene-&gt;r.cfra)) where_is_object(scene, ob); */</span>
<a name="l06420"></a>06420     
<a name="l06421"></a>06421     <span class="comment">/* draw motion paths (in view space) */</span>
<a name="l06422"></a>06422     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa274264cbbef5f41777e8370d5bc173a">mpath</a> &amp;&amp; (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0) {
<a name="l06423"></a>06423         <a class="code" href="../../db/de3/structbAnimVizSettings.html">bAnimVizSettings</a> *avs = &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#afcef3a6289a8d4b0d84542f25b7ba7e1">avs</a>;
<a name="l06424"></a>06424         
<a name="l06425"></a>06425         <span class="comment">/* setup drawing environment for paths */</span>
<a name="l06426"></a>06426         <a class="code" href="../../d5/dfe/drawanimviz_8c.html#a9e9d12d3c712df9ace768e3b4fdf836c">draw_motion_paths_init</a>(v3d, ar);
<a name="l06427"></a>06427         
<a name="l06428"></a>06428         <span class="comment">/* draw motion path for object */</span>
<a name="l06429"></a>06429         <a class="code" href="../../d5/dfe/drawanimviz_8c.html#afbcdb1f5a8ffd824f96a8f4e44f6c9aa">draw_motion_path_instance</a>(scene, ob, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, avs, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa274264cbbef5f41777e8370d5bc173a">mpath</a>);
<a name="l06430"></a>06430         
<a name="l06431"></a>06431         <span class="comment">/* cleanup after drawing */</span>
<a name="l06432"></a>06432         <a class="code" href="../../d5/dfe/drawanimviz_8c.html#a9520b76f526f4012ba82a162cddcdd88">draw_motion_paths_cleanup</a>(v3d);
<a name="l06433"></a>06433     }
<a name="l06434"></a>06434 
<a name="l06435"></a>06435     <span class="comment">/* multiply view with object matrix.</span>
<a name="l06436"></a>06436 <span class="comment">     * local viewmat and persmat, to calculate projections */</span>
<a name="l06437"></a>06437     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af77e75028798a3f75263d2ad6ab74406">ED_view3d_init_mats_rv3d_gl</a>(ob, rv3d);
<a name="l06438"></a>06438 
<a name="l06439"></a>06439     <span class="comment">/* which wire color */</span>
<a name="l06440"></a>06440     <span class="keywordflow">if</span> ((flag &amp; <a class="code" href="../../d4/df4/view3d__intern_8h.html#a865840f950d43c02ac67cce1663bd822">DRAW_CONSTCOLOR</a>) == 0) {
<a name="l06441"></a>06441         <span class="comment">/* confusing logic here, there are 2 methods of setting the color</span>
<a name="l06442"></a>06442 <span class="comment">         * &#39;colortab[colindex]&#39; and &#39;theme_id&#39;, colindex overrides theme_id.</span>
<a name="l06443"></a>06443 <span class="comment">         *</span>
<a name="l06444"></a>06444 <span class="comment">         * note: no theme yet for &#39;colindex&#39; */</span>
<a name="l06445"></a>06445         <span class="keywordtype">int</span> theme_id = <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>;
<a name="l06446"></a>06446         <span class="keywordtype">int</span> theme_shade = 0;
<a name="l06447"></a>06447 
<a name="l06448"></a>06448         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1f87ab9476813c561e60c884c6445ba1">project_short</a>(ar, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3], &amp;base-&gt;<a class="code" href="../../d3/da9/structBase.html#abd184791fccfcb7dfefb83440164fa3f">sx</a>);
<a name="l06449"></a>06449 
<a name="l06450"></a>06450         <span class="keywordflow">if</span> ((scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a1aa1978dba5dab99d35b6ba89e88b5bb">obedit</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp;
<a name="l06451"></a>06451             (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.moving &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a71f001a4a61f21c861d976df4c9648a7">G_TRANSFORM_OBJ</a>) &amp;&amp;
<a name="l06452"></a>06452             (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; (<a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a> + <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#abd8be106ef4ef20b1be3b4532e8f7397">BA_WAS_SEL</a>)))
<a name="l06453"></a>06453         {
<a name="l06454"></a>06454             theme_id = <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a56cb220b76a5a0ace472c22380906297">TH_TRANSFORM</a>;
<a name="l06455"></a>06455         }
<a name="l06456"></a>06456         <span class="keywordflow">else</span> {
<a name="l06457"></a>06457             <span class="comment">/* Sets the &#39;colindex&#39; */</span>
<a name="l06458"></a>06458             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>) {
<a name="l06459"></a>06459                 colindex = (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; (<a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a> + <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#abd8be106ef4ef20b1be3b4532e8f7397">BA_WAS_SEL</a>)) ? 4 : 3;
<a name="l06460"></a>06460             }
<a name="l06461"></a>06461             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (warning_recursive == 1) {
<a name="l06462"></a>06462                 <span class="keywordflow">if</span> (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; (<a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a> + <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#abd8be106ef4ef20b1be3b4532e8f7397">BA_WAS_SEL</a>)) {
<a name="l06463"></a>06463                     colindex = (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a040bbb56eb7746d04c4ae455e5b1c638">basact</a> == base) ? 8 : 7;
<a name="l06464"></a>06464                 }
<a name="l06465"></a>06465                 <span class="keywordflow">else</span> {
<a name="l06466"></a>06466                     colindex = 6;
<a name="l06467"></a>06467                 }
<a name="l06468"></a>06468             }
<a name="l06469"></a>06469             <span class="comment">/* Sets the &#39;theme_id&#39; or fallback to wire */</span>
<a name="l06470"></a>06470             <span class="keywordflow">else</span> {
<a name="l06471"></a>06471                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a9588748603be4778a9197f7edbf356d4">OB_FROMGROUP</a>) {
<a name="l06472"></a>06472                     <span class="keywordflow">if</span> (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; (<a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a> + <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#abd8be106ef4ef20b1be3b4532e8f7397">BA_WAS_SEL</a>)) {
<a name="l06473"></a>06473                         <span class="comment">/* uses darker active color for non-active + selected*/</span>
<a name="l06474"></a>06474                         theme_id = <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531ad2ba053e9237f2b78da8da066b4529e6">TH_GROUP_ACTIVE</a>;
<a name="l06475"></a>06475                         
<a name="l06476"></a>06476                         <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a040bbb56eb7746d04c4ae455e5b1c638">basact</a> != base) {
<a name="l06477"></a>06477                             theme_shade = -16;
<a name="l06478"></a>06478                         }
<a name="l06479"></a>06479                     }
<a name="l06480"></a>06480                     <span class="keywordflow">else</span> {
<a name="l06481"></a>06481                         theme_id = <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a40a85507e5970cdab915fbc81828f3ff">TH_GROUP</a>;
<a name="l06482"></a>06482                     }
<a name="l06483"></a>06483                 }
<a name="l06484"></a>06484                 <span class="keywordflow">else</span> {
<a name="l06485"></a>06485                     <span class="keywordflow">if</span> (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; (<a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a> + <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#abd8be106ef4ef20b1be3b4532e8f7397">BA_WAS_SEL</a>)) {
<a name="l06486"></a>06486                         theme_id = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a040bbb56eb7746d04c4ae455e5b1c638">basact</a> == base ? <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531af47479527035752070059cf6669daf09">TH_ACTIVE</a> : <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531acf22ebe596e9394104b732b077cbec7a">TH_SELECT</a>;
<a name="l06487"></a>06487                     }
<a name="l06488"></a>06488                     <span class="keywordflow">else</span> {
<a name="l06489"></a>06489                         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1514ec0465b89013544107c908e7abca">OB_LAMP</a>) theme_id = <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a5f8ef565a0dff9a0166102082b24c506">TH_LAMP</a>;
<a name="l06490"></a>06490                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#adbb088925cd622aa2bacd6c46c161549">OB_SPEAKER</a>) theme_id = <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a6742d9348b7690d722f5186a1fa97587">TH_SPEAKER</a>;
<a name="l06491"></a>06491                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#afd7fa4376c670f245aeed7a7116c7005">OB_CAMERA</a>) theme_id = <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a4dbe412d530f78eb5a0c83e91e5086cd">TH_CAMERA</a>;
<a name="l06492"></a>06492                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aae7aa3fbf86ed3619e54240da402fab1">OB_EMPTY</a>) theme_id = <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a9fa6bac12a2d13ceef827d4f05bd2e11">TH_EMPTY</a>;
<a name="l06493"></a>06493                         <span class="comment">/* fallback to TH_WIRE */</span>
<a name="l06494"></a>06494                     }
<a name="l06495"></a>06495                 }
<a name="l06496"></a>06496             }
<a name="l06497"></a>06497         }
<a name="l06498"></a>06498 
<a name="l06499"></a>06499         <span class="comment">/* finally set the color */</span>
<a name="l06500"></a>06500         <span class="keywordflow">if</span> (colindex == 0) {
<a name="l06501"></a>06501             <span class="keywordflow">if</span> (theme_shade == 0) <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(theme_id);
<a name="l06502"></a>06502             <span class="keywordflow">else</span> <a class="code" href="../../de/d96/UI__resources_8h.html#a56c7a350537a25b88d0532488032aef6">UI_ThemeColorShade</a>(theme_id, theme_shade);
<a name="l06503"></a>06503         }
<a name="l06504"></a>06504         <span class="keywordflow">else</span> {
<a name="l06505"></a>06505             col = <a class="code" href="../../d3/d02/drawobject_8c.html#a1e463a8c474cdc32ead182590186e02f">colortab</a>[colindex];
<a name="l06506"></a>06506             <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(col);
<a name="l06507"></a>06507         }
<a name="l06508"></a>06508     }
<a name="l06509"></a>06509 
<a name="l06510"></a>06510     <span class="comment">/* maximum drawtype */</span>
<a name="l06511"></a>06511     dt = v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a591cd4c57e5a79352f6733f6fa2bc1c9">drawtype</a>;
<a name="l06512"></a>06512     <span class="keywordflow">if</span> (dt == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5ffb4ceb8fefd165399fc583a8f9d893">OB_RENDER</a>) dt = <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a02098d23ce96d480e90882bed52cb89d">OB_SOLID</a>;
<a name="l06513"></a>06513     dt = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(dt, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a849f37900ed7ea1f55647f7f4f8ed123">dt</a>);
<a name="l06514"></a>06514     <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#afd443bfd0de5169661f08aa1eeb3bd69">zbuf</a> == 0 &amp;&amp; dt &gt; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>) dt = <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>;
<a name="l06515"></a>06515     dtx = 0;
<a name="l06516"></a>06516 
<a name="l06517"></a>06517     <span class="comment">/* faceselect exception: also draw solid when dt==wire, except in editmode */</span>
<a name="l06518"></a>06518     <span class="keywordflow">if</span> (is_obact &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; (<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550afa4f66c680fdf8f9cd7ef1ca969b1901">OB_MODE_VERTEX_PAINT</a> | <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a6ab1cede4f6911c8042ca67d0c53b780">OB_MODE_WEIGHT_PAINT</a> | <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550aefdee3fdb0d4e936026d0fbdeb55852d">OB_MODE_TEXTURE_PAINT</a>))) {
<a name="l06519"></a>06519         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>) {
<a name="l06520"></a>06520 
<a name="l06521"></a>06521             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a5aed90bff10a0fd5ad47c9ee79ae4580">OB_MODE_EDIT</a>) {
<a name="l06522"></a>06522                 <span class="comment">/* pass */</span>
<a name="l06523"></a>06523             }
<a name="l06524"></a>06524             <span class="keywordflow">else</span> {
<a name="l06525"></a>06525                 <span class="keywordflow">if</span> (dt &lt; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a02098d23ce96d480e90882bed52cb89d">OB_SOLID</a>) {
<a name="l06526"></a>06526                     zbufoff = 1;
<a name="l06527"></a>06527                     dt = <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a02098d23ce96d480e90882bed52cb89d">OB_SOLID</a>;
<a name="l06528"></a>06528                 }
<a name="l06529"></a>06529                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; (<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550afa4f66c680fdf8f9cd7ef1ca969b1901">OB_MODE_VERTEX_PAINT</a> | <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a6ab1cede4f6911c8042ca67d0c53b780">OB_MODE_WEIGHT_PAINT</a>))
<a name="l06530"></a>06530                     dt = <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a3be2475cb504a06c687e2488eaec8942">OB_PAINT</a>;
<a name="l06531"></a>06531 
<a name="l06532"></a>06532                 glEnable(GL_DEPTH_TEST);
<a name="l06533"></a>06533             }
<a name="l06534"></a>06534         }
<a name="l06535"></a>06535         <span class="keywordflow">else</span> {
<a name="l06536"></a>06536             <span class="keywordflow">if</span> (dt &lt; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a02098d23ce96d480e90882bed52cb89d">OB_SOLID</a>) {
<a name="l06537"></a>06537                 dt = <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a02098d23ce96d480e90882bed52cb89d">OB_SOLID</a>;
<a name="l06538"></a>06538                 glEnable(GL_DEPTH_TEST);
<a name="l06539"></a>06539                 zbufoff = 1;
<a name="l06540"></a>06540             }
<a name="l06541"></a>06541         }
<a name="l06542"></a>06542     }
<a name="l06543"></a>06543     
<a name="l06544"></a>06544     <span class="comment">/* draw-extra supported for boundbox drawmode too */</span>
<a name="l06545"></a>06545     <span class="keywordflow">if</span> (dt &gt;= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a25d148b5766d55fc995b3e7eaba3187b">OB_BOUNDBOX</a>) {
<a name="l06546"></a>06546 
<a name="l06547"></a>06547         dtx = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a2e4203e6270100e25ef3d5ec64fc31a6">dtx</a>;
<a name="l06548"></a>06548         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a5aed90bff10a0fd5ad47c9ee79ae4580">OB_MODE_EDIT</a>) {
<a name="l06549"></a>06549             <span class="comment">// the only 2 extra drawtypes alowed in editmode</span>
<a name="l06550"></a>06550             dtx = dtx &amp; (<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5ab5449c65c7be34a82d408aff1c4e28">OB_DRAWWIRE</a> | <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a46c4f0268f8d111413eed56955421a63">OB_TEXSPACE</a>);
<a name="l06551"></a>06551         }
<a name="l06552"></a>06552 
<a name="l06553"></a>06553     }
<a name="l06554"></a>06554 
<a name="l06555"></a>06555     <span class="comment">/* bad exception, solve this! otherwise outline shows too late */</span>
<a name="l06556"></a>06556     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1a94162b6fc469957966a01d41ff71d6">OB_FONT</a>)) {
<a name="l06557"></a>06557         <span class="comment">/* still needed for curves hidden in other layers. depgraph doesnt handle that yet */</span>
<a name="l06558"></a>06558         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a45d11e4826c3a8ba292c91691bb2885d">disp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <a class="code" href="../../d9/d12/BKE__displist_8h.html#a5ca43234b8f9db71b0318b29716b5487">makeDispListCurveTypes</a>(scene, ob, 0);
<a name="l06559"></a>06559     }
<a name="l06560"></a>06560     
<a name="l06561"></a>06561     <span class="comment">/* draw outline for selected objects, mesh does itself */</span>
<a name="l06562"></a>06562     <span class="keywordflow">if</span> ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a97a32d38ce1481d61d60dc677693ce5d">flag</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5556e5caae70d11b0f6aacf0ebb02f2f">V3D_SELECT_OUTLINE</a>) &amp;&amp; ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0) &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> != <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>) {
<a name="l06563"></a>06563         <span class="keywordflow">if</span> (dt &gt; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a> &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a5aed90bff10a0fd5ad47c9ee79ae4580">OB_MODE_EDIT</a>) == 0 &amp;&amp; (flag &amp; <a class="code" href="../../d4/df4/view3d__intern_8h.html#aabb48674b87768c6adcfb2873ef4c6b3">DRAW_SCENESET</a>) == 0) {
<a name="l06564"></a>06564             <span class="keywordflow">if</span> (!(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a2e4203e6270100e25ef3d5ec64fc31a6">dtx</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5ab5449c65c7be34a82d408aff1c4e28">OB_DRAWWIRE</a>) &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) &amp;&amp; !(flag &amp; DRAW_PICKING)) {
<a name="l06565"></a>06565                 
<a name="l06566"></a>06566                 <a class="code" href="../../d3/d02/drawobject_8c.html#a008f97d0f5e88f0859a2aeb0fe8ecf44">drawObjectSelect</a>(scene, v3d, ar, base);
<a name="l06567"></a>06567             }
<a name="l06568"></a>06568         }
<a name="l06569"></a>06569     }
<a name="l06570"></a>06570 
<a name="l06571"></a>06571     <span class="keywordflow">switch</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>) {
<a name="l06572"></a>06572         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>:
<a name="l06573"></a>06573             empty_object = <a class="code" href="../../d3/d02/drawobject_8c.html#ad26c971cb1d3b4cdde9e58dc5bb729cb">draw_mesh_object</a>(scene, ar, v3d, rv3d, base, dt, flag);
<a name="l06574"></a>06574             <span class="keywordflow">if</span> (flag != DRAW_CONSTCOLOR) dtx &amp;= ~<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5ab5449c65c7be34a82d408aff1c4e28">OB_DRAWWIRE</a>;  <span class="comment">// mesh draws wire itself</span>
<a name="l06575"></a>06575 
<a name="l06576"></a>06576             <span class="keywordflow">break</span>;
<a name="l06577"></a>06577         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1a94162b6fc469957966a01d41ff71d6">OB_FONT</a>:
<a name="l06578"></a>06578             cu = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l06579"></a>06579             <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5cea9d9cf980788715e190c6261cd0a3">editfont</a>) {
<a name="l06580"></a>06580                 <a class="code" href="../../d3/d02/drawobject_8c.html#a018bfdc571ead2277bbb144f6d86dcef">draw_textcurs</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5cea9d9cf980788715e190c6261cd0a3">editfont</a>-&gt;<a class="code" href="../../d7/d68/structEditFont.html#a15f5f5f86ca00452bde65c58102d81f2">textcurs</a>);
<a name="l06581"></a>06581 
<a name="l06582"></a>06582                 <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a7493d742f4824273b8212996f79e6a20">CU_FAST</a>) {
<a name="l06583"></a>06583                     <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(0xFFFFFF);
<a name="l06584"></a>06584                     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#aab536618fe6f02df9a92c5f379ec7a9b">set_inverted_drawing</a>(1);
<a name="l06585"></a>06585                     <a class="code" href="../../d3/d02/drawobject_8c.html#af97e16e51d66bbc843bc1b5cfaa449bd">drawDispList</a>(scene, v3d, rv3d, base, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>);
<a name="l06586"></a>06586                     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#aab536618fe6f02df9a92c5f379ec7a9b">set_inverted_drawing</a>(0);
<a name="l06587"></a>06587                 }
<a name="l06588"></a>06588                 <span class="keywordflow">else</span> {
<a name="l06589"></a>06589                     <a class="code" href="../../d3/d02/drawobject_8c.html#af97e16e51d66bbc843bc1b5cfaa449bd">drawDispList</a>(scene, v3d, rv3d, base, dt);
<a name="l06590"></a>06590                 }
<a name="l06591"></a>06591 
<a name="l06592"></a>06592                 <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#aa0c45dd94520ace52b5175df8b6b9dab">linewidth</a> != 0.0f) {
<a name="l06593"></a>06593                     <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l06594"></a>06594                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec1, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0e6a9ddfde7f2673fc3aad5b97a24656">orig</a>);
<a name="l06595"></a>06595                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec2, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0e6a9ddfde7f2673fc3aad5b97a24656">orig</a>);
<a name="l06596"></a>06596                     vec1[0] += cu-&gt;<a class="code" href="../../da/d10/structCurve.html#aa0c45dd94520ace52b5175df8b6b9dab">linewidth</a>;
<a name="l06597"></a>06597                     vec2[0] += cu-&gt;<a class="code" href="../../da/d10/structCurve.html#aa0c45dd94520ace52b5175df8b6b9dab">linewidth</a>;
<a name="l06598"></a>06598                     vec1[1] += cu-&gt;<a class="code" href="../../da/d10/structCurve.html#acbb034dac5b4158a67bcf9150c9fa630">linedist</a> * cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ad0e4ea215dcd01147ad06b76e581eb9c">fsize</a>;
<a name="l06599"></a>06599                     vec2[1] -= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a6ac9bb68bd8b19384d36c5f4617ede0e">lines</a> * cu-&gt;<a class="code" href="../../da/d10/structCurve.html#acbb034dac5b4158a67bcf9150c9fa630">linedist</a> * cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ad0e4ea215dcd01147ad06b76e581eb9c">fsize</a>;
<a name="l06600"></a>06600                     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(3);
<a name="l06601"></a>06601                     glBegin(GL_LINE_STRIP);
<a name="l06602"></a>06602                     glVertex2fv(vec1);
<a name="l06603"></a>06603                     glVertex2fv(vec2);
<a name="l06604"></a>06604                     glEnd();
<a name="l06605"></a>06605                     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(0);
<a name="l06606"></a>06606                 }
<a name="l06607"></a>06607 
<a name="l06608"></a>06608                 <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(3);
<a name="l06609"></a>06609                 <span class="keywordflow">for</span> (i = 0; i &lt; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a653d6829b5c84d43744c7939f32b0c3b">totbox</a>; i++) {
<a name="l06610"></a>06610                     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>[i].<a class="code" href="../../de/d25/structTextBox.html#a3cc521cc3bd6b4ba5592e898e0eaa863">w</a> != 0.0f) {
<a name="l06611"></a>06611                         <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(i == (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a59951ed35caba6bc89103679b3a1c7b8">actbox</a> - 1) ? <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531af47479527035752070059cf6669daf09">TH_ACTIVE</a> : <a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a35a1ce14aa2c5a004ba0af0ce628b3dd">TH_WIRE</a>);
<a name="l06612"></a>06612                         vec1[0] = (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a1d0112868c4d31b067bf662f81c83790">xof</a> * cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ad0e4ea215dcd01147ad06b76e581eb9c">fsize</a>) + cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>[i].<a class="code" href="../../de/d25/structTextBox.html#aec6aed2bbe57bc20e43917b72a4da610">x</a>;
<a name="l06613"></a>06613                         vec1[1] = (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ad28126b68b497a6f89737747072cd928">yof</a> * cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ad0e4ea215dcd01147ad06b76e581eb9c">fsize</a>) + cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../de/d25/structTextBox.html#a2f77f6a8c084e2bcb50b9d758ac4c3ef">y</a> + cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ad0e4ea215dcd01147ad06b76e581eb9c">fsize</a>;
<a name="l06614"></a>06614                         vec1[2] = 0.001;
<a name="l06615"></a>06615                         glBegin(GL_LINE_STRIP);
<a name="l06616"></a>06616                         glVertex3fv(vec1);
<a name="l06617"></a>06617                         vec1[0] += cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../de/d25/structTextBox.html#a3cc521cc3bd6b4ba5592e898e0eaa863">w</a>;
<a name="l06618"></a>06618                         glVertex3fv(vec1);
<a name="l06619"></a>06619                         vec1[1] -= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../de/d25/structTextBox.html#a1fd41eef9b87497341c61d9e89e5da43">h</a>;
<a name="l06620"></a>06620                         glVertex3fv(vec1);
<a name="l06621"></a>06621                         vec1[0] -= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../de/d25/structTextBox.html#a3cc521cc3bd6b4ba5592e898e0eaa863">w</a>;
<a name="l06622"></a>06622                         glVertex3fv(vec1);
<a name="l06623"></a>06623                         vec1[1] += cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../de/d25/structTextBox.html#a1fd41eef9b87497341c61d9e89e5da43">h</a>;
<a name="l06624"></a>06624                         glVertex3fv(vec1);
<a name="l06625"></a>06625                         glEnd();
<a name="l06626"></a>06626                     }
<a name="l06627"></a>06627                 }
<a name="l06628"></a>06628                 <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(0);
<a name="l06629"></a>06629 
<a name="l06630"></a>06630 
<a name="l06631"></a>06631                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d06/BKE__font_8h.html#abb4a02f496f77aefaeefcbd81c1410d8">BKE_font_getselection</a>(ob, &amp;selstart, &amp;selend) &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ad215e7da46b3f909ff9d9542030f6111">selboxes</a>) {
<a name="l06632"></a>06632                     <span class="keywordtype">float</span> selboxw;
<a name="l06633"></a>06633 
<a name="l06634"></a>06634                     <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(0xffffff);
<a name="l06635"></a>06635                     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#aab536618fe6f02df9a92c5f379ec7a9b">set_inverted_drawing</a>(1);
<a name="l06636"></a>06636                     <span class="keywordflow">for</span> (i = 0; i &lt; (selend - selstart + 1); i++) {
<a name="l06637"></a>06637                         <a class="code" href="../../db/db5/structSelBox.html">SelBox</a> *sb = &amp;(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ad215e7da46b3f909ff9d9542030f6111">selboxes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);
<a name="l06638"></a>06638 
<a name="l06639"></a>06639                         <span class="keywordflow">if</span> (i &lt; (selend - selstart)) {
<a name="l06640"></a>06640                             <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ad215e7da46b3f909ff9d9542030f6111">selboxes</a>[i + 1].<a class="code" href="../../db/db5/structSelBox.html#af41d6b651d97d472ae70ca6c12a8e0cd">y</a> == sb-&gt;<a class="code" href="../../db/db5/structSelBox.html#af41d6b651d97d472ae70ca6c12a8e0cd">y</a>)
<a name="l06641"></a>06641                                 selboxw = cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ad215e7da46b3f909ff9d9542030f6111">selboxes</a>[i + 1].<a class="code" href="../../db/db5/structSelBox.html#accc1e84e6f2b465f22a1f35ffad82d1d">x</a> - sb-&gt;<a class="code" href="../../db/db5/structSelBox.html#accc1e84e6f2b465f22a1f35ffad82d1d">x</a>;
<a name="l06642"></a>06642                             <span class="keywordflow">else</span>
<a name="l06643"></a>06643                                 selboxw = sb-&gt;<a class="code" href="../../db/db5/structSelBox.html#a96ee047f9bb8d6d4b6648677f78fbe75">w</a>;
<a name="l06644"></a>06644                         }
<a name="l06645"></a>06645                         <span class="keywordflow">else</span> {
<a name="l06646"></a>06646                             selboxw = sb-&gt;<a class="code" href="../../db/db5/structSelBox.html#a96ee047f9bb8d6d4b6648677f78fbe75">w</a>;
<a name="l06647"></a>06647                         }
<a name="l06648"></a>06648                         glBegin(GL_QUADS);
<a name="l06649"></a>06649                         glVertex3f(sb-&gt;<a class="code" href="../../db/db5/structSelBox.html#accc1e84e6f2b465f22a1f35ffad82d1d">x</a>, sb-&gt;<a class="code" href="../../db/db5/structSelBox.html#af41d6b651d97d472ae70ca6c12a8e0cd">y</a>, 0.001);
<a name="l06650"></a>06650                         glVertex3f(sb-&gt;<a class="code" href="../../db/db5/structSelBox.html#accc1e84e6f2b465f22a1f35ffad82d1d">x</a> + selboxw, sb-&gt;<a class="code" href="../../db/db5/structSelBox.html#af41d6b651d97d472ae70ca6c12a8e0cd">y</a>, 0.001);
<a name="l06651"></a>06651                         glVertex3f(sb-&gt;<a class="code" href="../../db/db5/structSelBox.html#accc1e84e6f2b465f22a1f35ffad82d1d">x</a> + selboxw, sb-&gt;<a class="code" href="../../db/db5/structSelBox.html#af41d6b651d97d472ae70ca6c12a8e0cd">y</a> + sb-&gt;<a class="code" href="../../db/db5/structSelBox.html#ade443e4ce605b9737453efe9b25f8e0f">h</a>, 0.001);
<a name="l06652"></a>06652                         glVertex3f(sb-&gt;<a class="code" href="../../db/db5/structSelBox.html#accc1e84e6f2b465f22a1f35ffad82d1d">x</a>, sb-&gt;<a class="code" href="../../db/db5/structSelBox.html#af41d6b651d97d472ae70ca6c12a8e0cd">y</a> + sb-&gt;<a class="code" href="../../db/db5/structSelBox.html#ade443e4ce605b9737453efe9b25f8e0f">h</a>, 0.001);
<a name="l06653"></a>06653                         glEnd();
<a name="l06654"></a>06654                     }
<a name="l06655"></a>06655                     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#aab536618fe6f02df9a92c5f379ec7a9b">set_inverted_drawing</a>(0);
<a name="l06656"></a>06656                 }
<a name="l06657"></a>06657             }
<a name="l06658"></a>06658             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dt == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a25d148b5766d55fc995b3e7eaba3187b">OB_BOUNDBOX</a>) {
<a name="l06659"></a>06659                 <span class="keywordflow">if</span> (((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) &amp;&amp; v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a591cd4c57e5a79352f6733f6fa2bc1c9">drawtype</a> &gt;= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>) == 0) {
<a name="l06660"></a>06660                     <a class="code" href="../../d3/d02/drawobject_8c.html#a4d19f50de723a4c82b4a1695f99400d4">draw_bounding_volume</a>(scene, ob, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4975c8a0d650af6077543e9949c1cb28">boundtype</a>);
<a name="l06661"></a>06661                 }
<a name="l06662"></a>06662             }
<a name="l06663"></a>06663             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d4/df4/view3d__intern_8h.html#a6bfc52d69da31d8e5c9a2eb4384fd90a">ED_view3d_boundbox_clip</a>(rv3d, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a> ? ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a> : cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a523cd93ea45778db87896479460cd5d0">bb</a>)) {
<a name="l06664"></a>06664                 empty_object = <a class="code" href="../../d3/d02/drawobject_8c.html#af97e16e51d66bbc843bc1b5cfaa449bd">drawDispList</a>(scene, v3d, rv3d, base, dt);
<a name="l06665"></a>06665             }
<a name="l06666"></a>06666 
<a name="l06667"></a>06667             <span class="keywordflow">break</span>;
<a name="l06668"></a>06668         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>:
<a name="l06669"></a>06669         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>:
<a name="l06670"></a>06670             cu = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l06671"></a>06671 
<a name="l06672"></a>06672             <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>) {
<a name="l06673"></a>06673                 <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nurbs = <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a444d55e9e251234b0c8e22da36a06819">curve_editnurbs</a>(cu);
<a name="l06674"></a>06674                 <a class="code" href="../../d3/d02/drawobject_8c.html#ad0386654ccfe47ed5aac0efcedbd6c65">drawnurb</a>(scene, v3d, rv3d, base, nurbs-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>, dt);
<a name="l06675"></a>06675             }
<a name="l06676"></a>06676             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dt == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a25d148b5766d55fc995b3e7eaba3187b">OB_BOUNDBOX</a>) {
<a name="l06677"></a>06677                 <span class="keywordflow">if</span> (((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) &amp;&amp; (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a591cd4c57e5a79352f6733f6fa2bc1c9">drawtype</a> &gt;= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>)) == 0) {
<a name="l06678"></a>06678                     <a class="code" href="../../d3/d02/drawobject_8c.html#a4d19f50de723a4c82b4a1695f99400d4">draw_bounding_volume</a>(scene, ob, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4975c8a0d650af6077543e9949c1cb28">boundtype</a>);
<a name="l06679"></a>06679                 }
<a name="l06680"></a>06680             }
<a name="l06681"></a>06681             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d4/df4/view3d__intern_8h.html#a6bfc52d69da31d8e5c9a2eb4384fd90a">ED_view3d_boundbox_clip</a>(rv3d, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a> ? ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a> : cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a523cd93ea45778db87896479460cd5d0">bb</a>)) {
<a name="l06682"></a>06682                 empty_object = <a class="code" href="../../d3/d02/drawobject_8c.html#af97e16e51d66bbc843bc1b5cfaa449bd">drawDispList</a>(scene, v3d, rv3d, base, dt);
<a name="l06683"></a>06683 
<a name="l06684"></a>06684 <span class="comment">//XXX old animsys               if (cu-&gt;path)</span>
<a name="l06685"></a>06685 <span class="comment">//                                  curve_draw_speed(scene, ob);</span>
<a name="l06686"></a>06686             }
<a name="l06687"></a>06687             <span class="keywordflow">break</span>;
<a name="l06688"></a>06688         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a046d883c32490b5c5ca4c5e7b6504e35">OB_MBALL</a>:
<a name="l06689"></a>06689         {
<a name="l06690"></a>06690             <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l06691"></a>06691             
<a name="l06692"></a>06692             <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad613f238c10a857cb981c9963efc365a">editelems</a>)
<a name="l06693"></a>06693                 <a class="code" href="../../d3/d02/drawobject_8c.html#a1e31dd2fb4beefa1e320ece0c86f0590">drawmball</a>(scene, v3d, rv3d, base, dt);
<a name="l06694"></a>06694             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dt == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a25d148b5766d55fc995b3e7eaba3187b">OB_BOUNDBOX</a>) {
<a name="l06695"></a>06695                 <span class="keywordflow">if</span> (((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) &amp;&amp; (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a591cd4c57e5a79352f6733f6fa2bc1c9">drawtype</a> &gt;= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>)) == 0) {
<a name="l06696"></a>06696                     <a class="code" href="../../d3/d02/drawobject_8c.html#a4d19f50de723a4c82b4a1695f99400d4">draw_bounding_volume</a>(scene, ob, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4975c8a0d650af6077543e9949c1cb28">boundtype</a>);
<a name="l06697"></a>06697                 }
<a name="l06698"></a>06698             }
<a name="l06699"></a>06699             <span class="keywordflow">else</span>
<a name="l06700"></a>06700                 empty_object = <a class="code" href="../../d3/d02/drawobject_8c.html#a1e31dd2fb4beefa1e320ece0c86f0590">drawmball</a>(scene, v3d, rv3d, base, dt);
<a name="l06701"></a>06701             <span class="keywordflow">break</span>;
<a name="l06702"></a>06702         }
<a name="l06703"></a>06703         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aae7aa3fbf86ed3619e54240da402fab1">OB_EMPTY</a>:
<a name="l06704"></a>06704             <span class="keywordflow">if</span> ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0) {
<a name="l06705"></a>06705                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a7c962f95df9a7a7ccb78c59f1234e35c">empty_drawtype</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a2485dca5bae0f18fd747640883c5123d">OB_EMPTY_IMAGE</a>) {
<a name="l06706"></a>06706                     <a class="code" href="../../d3/d02/drawobject_8c.html#a0005888693bf664cd5d95eef4209f615">draw_empty_image</a>(ob);
<a name="l06707"></a>06707                 }
<a name="l06708"></a>06708                 <span class="keywordflow">else</span> {
<a name="l06709"></a>06709                     <a class="code" href="../../d3/d02/drawobject_8c.html#a3a22182290000ba6cce2b8d3eb8c3cc3">drawaxes</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a9f106829a25bed222ba018f0d6d4f54a">empty_drawsize</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a7c962f95df9a7a7ccb78c59f1234e35c">empty_drawtype</a>);
<a name="l06710"></a>06710                 }
<a name="l06711"></a>06711             }
<a name="l06712"></a>06712             <span class="keywordflow">break</span>;
<a name="l06713"></a>06713         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1514ec0465b89013544107c908e7abca">OB_LAMP</a>:
<a name="l06714"></a>06714             <span class="keywordflow">if</span> ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0) {
<a name="l06715"></a>06715                 <a class="code" href="../../d3/d02/drawobject_8c.html#ab03eef94f5166b074f18b58f49bf6757">drawlamp</a>(scene, v3d, rv3d, base, dt, flag);
<a name="l06716"></a>06716                 <span class="keywordflow">if</span> (dtx || (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) <a class="code" href="../../dd/d44/BIF__gl_8h.html#a22a8b7985dcd174e9add6f20aa37a962">glMultMatrixf</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l06717"></a>06717             }
<a name="l06718"></a>06718             <span class="keywordflow">break</span>;
<a name="l06719"></a>06719         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#afd7fa4376c670f245aeed7a7116c7005">OB_CAMERA</a>:
<a name="l06720"></a>06720             <span class="keywordflow">if</span> ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0 ||
<a name="l06721"></a>06721                 (rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8f435c152f17185773a21cd8b7067ebb">persp</a> == <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a4c869f8f07a58e54e43d35474bbe4757">RV3D_CAMOB</a> &amp;&amp; v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a> == ob)) <span class="comment">/* special exception for active camera */</span>
<a name="l06722"></a>06722             {
<a name="l06723"></a>06723                 <a class="code" href="../../d3/d02/drawobject_8c.html#a182a1751302b4857af2d324e4b1ca58e">drawcamera</a>(scene, v3d, rv3d, base, flag);
<a name="l06724"></a>06724                 <span class="keywordflow">break</span>;
<a name="l06725"></a>06725             }
<a name="l06726"></a>06726         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#adbb088925cd622aa2bacd6c46c161549">OB_SPEAKER</a>:
<a name="l06727"></a>06727             <span class="keywordflow">if</span> ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0)
<a name="l06728"></a>06728                 <a class="code" href="../../d3/d02/drawobject_8c.html#a8131e6ffdf820a977d626fe83da455f0">drawspeaker</a>(scene, v3d, rv3d, ob, flag);
<a name="l06729"></a>06729             <span class="keywordflow">break</span>;
<a name="l06730"></a>06730         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a648672abc238f500c884f10b9416cb27">OB_LATTICE</a>:
<a name="l06731"></a>06731             <span class="keywordflow">if</span> ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0) {
<a name="l06732"></a>06732                 <a class="code" href="../../d3/d02/drawobject_8c.html#a56a30db33cb386d99e4b3116c0851f0a">drawlattice</a>(scene, v3d, ob);
<a name="l06733"></a>06733             }
<a name="l06734"></a>06734             <span class="keywordflow">break</span>;
<a name="l06735"></a>06735         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>:
<a name="l06736"></a>06736             <span class="keywordflow">if</span> ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0) {
<a name="l06737"></a>06737                 <span class="comment">/* Do not allow boundbox in edit nor pose mode! */</span>
<a name="l06738"></a>06738                 <span class="keywordflow">if</span> ((dt == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a25d148b5766d55fc995b3e7eaba3187b">OB_BOUNDBOX</a>) &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; (<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a5aed90bff10a0fd5ad47c9ee79ae4580">OB_MODE_EDIT</a> | <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550acfed9b4bf4a7e2d3c5ae0b3571e38950">OB_MODE_POSE</a>)))
<a name="l06739"></a>06739                     dt = <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>;
<a name="l06740"></a>06740                 <span class="keywordflow">if</span> (dt == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a25d148b5766d55fc995b3e7eaba3187b">OB_BOUNDBOX</a>) {
<a name="l06741"></a>06741                     <a class="code" href="../../d3/d02/drawobject_8c.html#a4d19f50de723a4c82b4a1695f99400d4">draw_bounding_volume</a>(scene, ob, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4975c8a0d650af6077543e9949c1cb28">boundtype</a>);
<a name="l06742"></a>06742                 }
<a name="l06743"></a>06743                 <span class="keywordflow">else</span> {
<a name="l06744"></a>06744                     <span class="keywordflow">if</span> (dt &gt; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>)
<a name="l06745"></a>06745                         <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>(0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);  <span class="comment">/* we use default material */</span>
<a name="l06746"></a>06746                     empty_object = <a class="code" href="../../d4/dd4/drawarmature_8c.html#a2c84ad02321d03ce664526e074da63f3">draw_armature</a>(scene, v3d, ar, base, dt, flag, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l06747"></a>06747                     <span class="keywordflow">if</span> (dt &gt; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>)
<a name="l06748"></a>06748                         <a class="code" href="../../d3/df0/GPU__draw_8h.html#a93e3b15a1a08a173c699b15068c35c35">GPU_disable_material</a>();
<a name="l06749"></a>06749                 }
<a name="l06750"></a>06750             }
<a name="l06751"></a>06751             <span class="keywordflow">break</span>;
<a name="l06752"></a>06752         <span class="keywordflow">default</span>:
<a name="l06753"></a>06753             <span class="keywordflow">if</span> ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0) {
<a name="l06754"></a>06754                 <a class="code" href="../../d3/d02/drawobject_8c.html#a3a22182290000ba6cce2b8d3eb8c3cc3">drawaxes</a>(1.0, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ad90dfce658bb46e6844de094b5734af9">OB_ARROWS</a>);
<a name="l06755"></a>06755             }
<a name="l06756"></a>06756     }
<a name="l06757"></a>06757 
<a name="l06758"></a>06758     <span class="keywordflow">if</span> ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0) {
<a name="l06759"></a>06759 
<a name="l06760"></a>06760         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a> <span class="comment">/*&amp;&amp; flag &amp; OB_SBMOTION*/</span>) {
<a name="l06761"></a>06761             <span class="keywordtype">float</span> mrt[3][3], msc[3][3], mtr[3][3];
<a name="l06762"></a>06762             <a class="code" href="../../df/d9a/structSoftBody.html">SoftBody</a> *sb = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06763"></a>06763             <span class="keywordtype">float</span> tipw = 0.5f, tiph = 0.5f, drawsize = 4.0f;
<a name="l06764"></a>06764             <span class="keywordflow">if</span> ((sb = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65de819e902d20e3001de9ef8cad19df">soft</a>)) {
<a name="l06765"></a>06765                 <span class="keywordflow">if</span> (sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a2af705a72f050fb8a85e6a58b01d2dfe">solverflags</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a791f3e0c8e047b862fb7e9d6128b827e">SBSO_ESTIMATEIPO</a>) {
<a name="l06766"></a>06766 
<a name="l06767"></a>06767                     <a class="code" href="../../dd/d44/BIF__gl_8h.html#a968938b254020ac622d83a3ab1226f4a">glLoadMatrixf</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ad04178a1375cc4ef5c59a76b723f822f">viewmat</a>);
<a name="l06768"></a>06768                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aceb90dff38c8c92e00335f2da648d61e">copy_m3_m3</a>(msc, sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a212f6d8277fdf733a09e9a38b51a67cb">lscale</a>);
<a name="l06769"></a>06769                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aceb90dff38c8c92e00335f2da648d61e">copy_m3_m3</a>(mrt, sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#a23a432fb40494aed3960b89ecbedd956">lrot</a>);
<a name="l06770"></a>06770                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(mtr, mrt, msc);
<a name="l06771"></a>06771                     <a class="code" href="../../d3/d02/drawobject_8c.html#a511dfc398b53b6f78100e5241e01918c">ob_draw_RE_motion</a>(sb-&gt;<a class="code" href="../../df/d9a/structSoftBody.html#ac92f71d4bd70e214d43b836420243fe5">lcom</a>, mtr, tipw, tiph, drawsize);
<a name="l06772"></a>06772                     <a class="code" href="../../dd/d44/BIF__gl_8h.html#a22a8b7985dcd174e9add6f20aa37a962">glMultMatrixf</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l06773"></a>06773                 }
<a name="l06774"></a>06774             }
<a name="l06775"></a>06775         }
<a name="l06776"></a>06776 
<a name="l06777"></a>06777         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a> &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a>) {
<a name="l06778"></a>06778             <a class="code" href="../../d3/d02/drawobject_8c.html#ac4db5bd4516a8db6a229fb0af7e0e27b">draw_forcefield</a>(scene, ob, rv3d);
<a name="l06779"></a>06779         }
<a name="l06780"></a>06780     }
<a name="l06781"></a>06781 
<a name="l06782"></a>06782     <span class="comment">/* code for new particle system */</span>
<a name="l06783"></a>06783     <span class="keywordflow">if</span> ((warning_recursive == 0) &amp;&amp;
<a name="l06784"></a>06784         (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) &amp;&amp;
<a name="l06785"></a>06785         (flag &amp; DRAW_PICKING) == 0 &amp;&amp;
<a name="l06786"></a>06786         (ob != scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a1aa1978dba5dab99d35b6ba89e88b5bb">obedit</a>)
<a name="l06787"></a>06787         )
<a name="l06788"></a>06788     {
<a name="l06789"></a>06789         <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys;
<a name="l06790"></a>06790 
<a name="l06791"></a>06791         <span class="keywordflow">if</span> (col || (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(0xFFFFFF);    <span class="comment">/* for visibility, also while wpaint */</span>
<a name="l06792"></a>06792         <span class="comment">//glDepthMask(GL_FALSE);</span>
<a name="l06793"></a>06793 
<a name="l06794"></a>06794         <a class="code" href="../../dd/d44/BIF__gl_8h.html#a968938b254020ac622d83a3ab1226f4a">glLoadMatrixf</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ad04178a1375cc4ef5c59a76b723f822f">viewmat</a>);
<a name="l06795"></a>06795         
<a name="l06796"></a>06796         <a class="code" href="../../d3/d02/drawobject_8c.html#ad72171d5caab24ec508b27b48dadae0e">view3d_cached_text_draw_begin</a>();
<a name="l06797"></a>06797 
<a name="l06798"></a>06798         <span class="keywordflow">for</span> (psys = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; psys; psys = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a734228c70c56227c6f7a29145a5f5b57">next</a>) {
<a name="l06799"></a>06799             <span class="comment">/* run this so that possible child particles get cached */</span>
<a name="l06800"></a>06800             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a20027b5f4381f062402af134bcefe889">OB_MODE_PARTICLE_EDIT</a> &amp;&amp; is_obact) {
<a name="l06801"></a>06801                 <a class="code" href="../../d7/d0e/structPTCacheEdit.html">PTCacheEdit</a> *edit = <a class="code" href="../../d3/db9/ED__particle_8h.html#a6e5453e34477cb16a35a5628b8e4f114">PE_create_current</a>(scene, ob);
<a name="l06802"></a>06802                 <span class="keywordflow">if</span> (edit &amp;&amp; edit-&gt;<a class="code" href="../../d7/d0e/structPTCacheEdit.html#a6f0e603624cf89a84b5cf2615971549f">psys</a> == psys)
<a name="l06803"></a>06803                     <a class="code" href="../../d3/d02/drawobject_8c.html#a7c469e2c089768a1b0b547f28ffd62f1">draw_update_ptcache_edit</a>(scene, ob, edit);
<a name="l06804"></a>06804             }
<a name="l06805"></a>06805 
<a name="l06806"></a>06806             <a class="code" href="../../d3/d02/drawobject_8c.html#afb02231621bc16c307e3029fe8e0f2aa">draw_new_particle_system</a>(scene, v3d, rv3d, base, psys, dt);
<a name="l06807"></a>06807         }
<a name="l06808"></a>06808         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65d360837f87824d49ed08caf44dccb3">imat</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l06809"></a>06809         <a class="code" href="../../d3/d02/drawobject_8c.html#a831f54b6ec78f73295a73a8e6c90df4f">view3d_cached_text_draw_end</a>(v3d, ar, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l06810"></a>06810 
<a name="l06811"></a>06811         <a class="code" href="../../dd/d44/BIF__gl_8h.html#a22a8b7985dcd174e9add6f20aa37a962">glMultMatrixf</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l06812"></a>06812         
<a name="l06813"></a>06813         <span class="comment">//glDepthMask(GL_TRUE);</span>
<a name="l06814"></a>06814         <span class="keywordflow">if</span> (col) <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(col);
<a name="l06815"></a>06815     }
<a name="l06816"></a>06816 
<a name="l06817"></a>06817     <span class="comment">/* draw edit particles last so that they can draw over child particles */</span>
<a name="l06818"></a>06818     <span class="keywordflow">if</span> ( (warning_recursive == 0) &amp;&amp;
<a name="l06819"></a>06819          (flag &amp; DRAW_PICKING) == 0 &amp;&amp;
<a name="l06820"></a>06820          (!scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a1aa1978dba5dab99d35b6ba89e88b5bb">obedit</a>))
<a name="l06821"></a>06821     {
<a name="l06822"></a>06822 
<a name="l06823"></a>06823         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a20027b5f4381f062402af134bcefe889">OB_MODE_PARTICLE_EDIT</a> &amp;&amp; is_obact) {
<a name="l06824"></a>06824             <a class="code" href="../../d7/d0e/structPTCacheEdit.html">PTCacheEdit</a> *edit = <a class="code" href="../../d3/db9/ED__particle_8h.html#a6e5453e34477cb16a35a5628b8e4f114">PE_create_current</a>(scene, ob);
<a name="l06825"></a>06825             <span class="keywordflow">if</span> (edit) {
<a name="l06826"></a>06826                 <a class="code" href="../../dd/d44/BIF__gl_8h.html#a968938b254020ac622d83a3ab1226f4a">glLoadMatrixf</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ad04178a1375cc4ef5c59a76b723f822f">viewmat</a>);
<a name="l06827"></a>06827                 <a class="code" href="../../d3/d02/drawobject_8c.html#a7c469e2c089768a1b0b547f28ffd62f1">draw_update_ptcache_edit</a>(scene, ob, edit);
<a name="l06828"></a>06828                 <a class="code" href="../../d3/d02/drawobject_8c.html#aecee1250134aa1f1f469d8acfbb76c81">draw_ptcache_edit</a>(scene, v3d, edit);
<a name="l06829"></a>06829                 <a class="code" href="../../dd/d44/BIF__gl_8h.html#a22a8b7985dcd174e9add6f20aa37a962">glMultMatrixf</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l06830"></a>06830             }
<a name="l06831"></a>06831         }
<a name="l06832"></a>06832     }
<a name="l06833"></a>06833 
<a name="l06834"></a>06834     <span class="comment">/* draw code for smoke */</span>
<a name="l06835"></a>06835     <span class="keywordflow">if</span> ((md = <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#a90fa4bb334209f7e9f25fc6c4a594574">modifiers_findByType</a>(ob, <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a7a78843e9dd6590fafc9b7682e691ac5">eModifierType_Smoke</a>))) {
<a name="l06836"></a>06836         <a class="code" href="../../d5/d03/structSmokeModifierData.html">SmokeModifierData</a> *smd = (<a class="code" href="../../d5/d03/structSmokeModifierData.html">SmokeModifierData</a> *)md;
<a name="l06837"></a>06837 
<a name="l06838"></a>06838         <span class="comment">// draw collision objects</span>
<a name="l06839"></a>06839         <span class="keywordflow">if</span> ((smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a43b5e848c1b44a089bd6d4461b0d2b1f">type</a> &amp; <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a38072e25640d74866f67201327dd38c3">MOD_SMOKE_TYPE_COLL</a>) &amp;&amp; smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a704990a483a65c1af67a2fa2f182ae4f">coll</a>) {
<a name="l06840"></a>06840 <span class="preprocessor">#if 0</span>
<a name="l06841"></a>06841 <span class="preprocessor"></span>            <a class="code" href="../../d7/d78/structSmokeCollSettings.html">SmokeCollSettings</a> *scs = smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a704990a483a65c1af67a2fa2f182ae4f">coll</a>;
<a name="l06842"></a>06842             <span class="keywordflow">if</span> (scs-&gt;<a class="code" href="../../d7/d78/structSmokeCollSettings.html#ac7b03c1af6e045f213d0cd405b1b5c0a">points</a>) {
<a name="l06843"></a>06843                 <span class="keywordtype">size_t</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l06844"></a>06844 
<a name="l06845"></a>06845                 <a class="code" href="../../dd/d44/BIF__gl_8h.html#a968938b254020ac622d83a3ab1226f4a">glLoadMatrixf</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ad04178a1375cc4ef5c59a76b723f822f">viewmat</a>);
<a name="l06846"></a>06846 
<a name="l06847"></a>06847                 <span class="keywordflow">if</span> (col || (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(0xFFFFFF);
<a name="l06848"></a>06848                 glDepthMask(GL_FALSE);
<a name="l06849"></a>06849                 glEnable(GL_BLEND);
<a name="l06850"></a>06850                 
<a name="l06851"></a>06851 
<a name="l06852"></a>06852                 <span class="comment">// glPointSize(3.0);</span>
<a name="l06853"></a>06853                 <a class="code" href="../../d9/d71/BIF__glutil_8h.html#acbcc8c3223d7fc13a7931b0a1744b240">bglBegin</a>(GL_POINTS);
<a name="l06854"></a>06854 
<a name="l06855"></a>06855                 <span class="keywordflow">for</span> (i = 0; i &lt; scs-&gt;<a class="code" href="../../d7/d78/structSmokeCollSettings.html#a5a08ff21c50a3af92d73a83b46aaa59e">numpoints</a>; i++)
<a name="l06856"></a>06856                 {
<a name="l06857"></a>06857                     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(&amp;scs-&gt;<a class="code" href="../../d7/d78/structSmokeCollSettings.html#ac7b03c1af6e045f213d0cd405b1b5c0a">points</a>[3 * i]);
<a name="l06858"></a>06858                 }
<a name="l06859"></a>06859 
<a name="l06860"></a>06860                 <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a2517dcaf453d3e58af25fd4c677dad45">bglEnd</a>();
<a name="l06861"></a>06861                 glPointSize(1.0);
<a name="l06862"></a>06862 
<a name="l06863"></a>06863                 <a class="code" href="../../dd/d44/BIF__gl_8h.html#a22a8b7985dcd174e9add6f20aa37a962">glMultMatrixf</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l06864"></a>06864                 glDisable(GL_BLEND);
<a name="l06865"></a>06865                 glDepthMask(GL_TRUE);
<a name="l06866"></a>06866                 <span class="keywordflow">if</span> (col) <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(col);
<a name="l06867"></a>06867                 
<a name="l06868"></a>06868             }
<a name="l06869"></a>06869 <span class="preprocessor">#endif</span>
<a name="l06870"></a>06870 <span class="preprocessor"></span>        }
<a name="l06871"></a>06871 
<a name="l06872"></a>06872         <span class="comment">// only draw domains</span>
<a name="l06873"></a>06873         <span class="keywordflow">if</span> (smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a> &amp;&amp; smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a2243482d9f65b8cb4f1018f8092a73b2">fluid</a>) {
<a name="l06874"></a>06874             <span class="keywordflow">if</span> (CFRA &lt; smd-&gt;domain-&gt;point_cache[0]-&gt;startframe) {
<a name="l06875"></a>06875                 <span class="comment">/* don&#39;t show smoke before simulation starts, this could be made an option in the future */</span>
<a name="l06876"></a>06876             }
<a name="l06877"></a>06877             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a6b4254083936838e368963db2bd1c41d">wt</a> || !(smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a4c248dff71204ae06e68b3febc45370e">viewsettings</a> &amp; <a class="code" href="../../d8/d8b/DNA__smoke__types_8h.html#a8e7dc51a09248f5138a57c6a7ec6787b">MOD_SMOKE_VIEW_SHOWBIG</a>)) {
<a name="l06878"></a>06878 <span class="comment">// #if 0</span>
<a name="l06879"></a>06879                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a3005abce710fed5dc020c86e94f0a4da">tex</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06880"></a>06880                 <a class="code" href="../../d3/df0/GPU__draw_8h.html#a792cedff09f4bce4a62800e0537986ce">GPU_create_smoke</a>(smd, 0);
<a name="l06881"></a>06881                 <a class="code" href="../../da/d0c/drawvolume_8c.html#aa0d38434f3f34170c5ae47fc27bd0e0e">draw_volume</a>(ar, smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a3005abce710fed5dc020c86e94f0a4da">tex</a>,
<a name="l06882"></a>06882                             smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a33262c179a98e788d79a5b4b14b83a3b">p0</a>, smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a341e43d24b5a22ffc242c78d0d32afbd">p1</a>,
<a name="l06883"></a>06883                             smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a8b75df097b3493a0b15c32e2e0df6faa">res</a>, smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#af51b747d4bbdff439c269b5afd59f33d">dx</a>,
<a name="l06884"></a>06884                             smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a4b6918c3240e92a1c7cc25fd044e4f36">tex_shadow</a>);
<a name="l06885"></a>06885                 <a class="code" href="../../d3/df0/GPU__draw_8h.html#afea6911533467883c82f6a508dc37a41">GPU_free_smoke</a>(smd);
<a name="l06886"></a>06886 <span class="comment">// #endif</span>
<a name="l06887"></a>06887 <span class="preprocessor">#if 0</span>
<a name="l06888"></a>06888 <span class="preprocessor"></span>                <span class="keywordtype">int</span> x, y, z;
<a name="l06889"></a>06889                 <span class="keywordtype">float</span> *density = <a class="code" href="../../dc/d83/smoke__API_8h.html#aed5cd30cbab2f971b17acaf0f29035ea">smoke_get_density</a>(smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a2243482d9f65b8cb4f1018f8092a73b2">fluid</a>);
<a name="l06890"></a>06890 
<a name="l06891"></a>06891                 <a class="code" href="../../dd/d44/BIF__gl_8h.html#a968938b254020ac622d83a3ab1226f4a">glLoadMatrixf</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ad04178a1375cc4ef5c59a76b723f822f">viewmat</a>);
<a name="l06892"></a>06892                 <span class="comment">// glMultMatrixf(ob-&gt;obmat);</span>
<a name="l06893"></a>06893 
<a name="l06894"></a>06894                 <span class="keywordflow">if</span> (col || (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(0xFFFFFF);
<a name="l06895"></a>06895                 glDepthMask(GL_FALSE);
<a name="l06896"></a>06896                 glEnable(GL_BLEND);
<a name="l06897"></a>06897                 
<a name="l06898"></a>06898 
<a name="l06899"></a>06899                 <span class="comment">// glPointSize(3.0);</span>
<a name="l06900"></a>06900                 <a class="code" href="../../d9/d71/BIF__glutil_8h.html#acbcc8c3223d7fc13a7931b0a1744b240">bglBegin</a>(GL_POINTS);
<a name="l06901"></a>06901 
<a name="l06902"></a>06902                 <span class="keywordflow">for</span> (x = 0; x &lt; smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a8b75df097b3493a0b15c32e2e0df6faa">res</a>[0]; x++) {
<a name="l06903"></a>06903                     <span class="keywordflow">for</span> (y = 0; y &lt; smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a8b75df097b3493a0b15c32e2e0df6faa">res</a>[1]; y++) {
<a name="l06904"></a>06904                         <span class="keywordflow">for</span> (z = 0; z &lt; smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a8b75df097b3493a0b15c32e2e0df6faa">res</a>[2]; z++) {
<a name="l06905"></a>06905                             <span class="keywordtype">float</span> tmp[3];
<a name="l06906"></a>06906                             <span class="keywordtype">int</span> index = <a class="code" href="../../dc/d83/smoke__API_8h.html#a718d651b9f150104db68d6473ad04010">smoke_get_index</a>(x, smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a8b75df097b3493a0b15c32e2e0df6faa">res</a>[0], y, smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a8b75df097b3493a0b15c32e2e0df6faa">res</a>[1], z);
<a name="l06907"></a>06907 
<a name="l06908"></a>06908                             <span class="keywordflow">if</span> (density[index] &gt; FLT_EPSILON) {
<a name="l06909"></a>06909                                 <span class="keywordtype">float</span> color[3];
<a name="l06910"></a>06910                                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(tmp, smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a33262c179a98e788d79a5b4b14b83a3b">p0</a>);
<a name="l06911"></a>06911                                 tmp[0] += smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#af51b747d4bbdff439c269b5afd59f33d">dx</a> * x + smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#af51b747d4bbdff439c269b5afd59f33d">dx</a> * 0.5;
<a name="l06912"></a>06912                                 tmp[1] += smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#af51b747d4bbdff439c269b5afd59f33d">dx</a> * y + smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#af51b747d4bbdff439c269b5afd59f33d">dx</a> * 0.5;
<a name="l06913"></a>06913                                 tmp[2] += smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#af51b747d4bbdff439c269b5afd59f33d">dx</a> * z + smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#af51b747d4bbdff439c269b5afd59f33d">dx</a> * 0.5;
<a name="l06914"></a>06914                                 color[0] = color[1] = color[2] = density[index];
<a name="l06915"></a>06915                                 glColor3fv(color);
<a name="l06916"></a>06916                                 <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(tmp);
<a name="l06917"></a>06917                             }
<a name="l06918"></a>06918                         }
<a name="l06919"></a>06919                     }
<a name="l06920"></a>06920                 }
<a name="l06921"></a>06921 
<a name="l06922"></a>06922                 <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a2517dcaf453d3e58af25fd4c677dad45">bglEnd</a>();
<a name="l06923"></a>06923                 glPointSize(1.0);
<a name="l06924"></a>06924 
<a name="l06925"></a>06925                 <a class="code" href="../../dd/d44/BIF__gl_8h.html#a22a8b7985dcd174e9add6f20aa37a962">glMultMatrixf</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l06926"></a>06926                 glDisable(GL_BLEND);
<a name="l06927"></a>06927                 glDepthMask(GL_TRUE);
<a name="l06928"></a>06928                 <span class="keywordflow">if</span> (col) <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(col);
<a name="l06929"></a>06929 <span class="preprocessor">#endif</span>
<a name="l06930"></a>06930 <span class="preprocessor"></span>            }
<a name="l06931"></a>06931             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a6b4254083936838e368963db2bd1c41d">wt</a> &amp;&amp; (smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a4c248dff71204ae06e68b3febc45370e">viewsettings</a> &amp; <a class="code" href="../../d8/d8b/DNA__smoke__types_8h.html#a8e7dc51a09248f5138a57c6a7ec6787b">MOD_SMOKE_VIEW_SHOWBIG</a>)) {
<a name="l06932"></a>06932                 smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a3005abce710fed5dc020c86e94f0a4da">tex</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06933"></a>06933                 <a class="code" href="../../d3/df0/GPU__draw_8h.html#a792cedff09f4bce4a62800e0537986ce">GPU_create_smoke</a>(smd, 1);
<a name="l06934"></a>06934                 <a class="code" href="../../da/d0c/drawvolume_8c.html#aa0d38434f3f34170c5ae47fc27bd0e0e">draw_volume</a>(ar, smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a3005abce710fed5dc020c86e94f0a4da">tex</a>,
<a name="l06935"></a>06935                             smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a33262c179a98e788d79a5b4b14b83a3b">p0</a>, smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a341e43d24b5a22ffc242c78d0d32afbd">p1</a>,
<a name="l06936"></a>06936                             smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#ad19b7f8c910667704c2706a0c5443ef0">res_wt</a>, smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a38f3d940bb91bc4acd789cb79ad2f906">dx_wt</a>,
<a name="l06937"></a>06937                             smd-&gt;<a class="code" href="../../d5/d03/structSmokeModifierData.html#a691a7d81e9cd652cba5a0e756ac4656c">domain</a>-&gt;<a class="code" href="../../df/df0/structSmokeDomainSettings.html#a4b6918c3240e92a1c7cc25fd044e4f36">tex_shadow</a>);
<a name="l06938"></a>06938                 <a class="code" href="../../d3/df0/GPU__draw_8h.html#afea6911533467883c82f6a508dc37a41">GPU_free_smoke</a>(smd);
<a name="l06939"></a>06939             }
<a name="l06940"></a>06940         }
<a name="l06941"></a>06941     }
<a name="l06942"></a>06942 
<a name="l06943"></a>06943     <span class="keywordflow">if</span> ((v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0) {
<a name="l06944"></a>06944         <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l06945"></a>06945 
<a name="l06946"></a>06946         <span class="keywordflow">for</span> (con = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; con; con = con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l06947"></a>06947             <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a44c442a006038ebc212011d1c158646f">CONSTRAINT_TYPE_RIGIDBODYJOINT</a>) {
<a name="l06948"></a>06948                 <a class="code" href="../../d8/dd4/structbRigidBodyJointConstraint.html">bRigidBodyJointConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = (<a class="code" href="../../d8/dd4/structbRigidBodyJointConstraint.html">bRigidBodyJointConstraint</a> *)con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l06949"></a>06949                 <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (data-&gt;<a class="code" href="../../d8/dd4/structbRigidBodyJointConstraint.html#a518afabd9132a136e762fe183c0d6308">flag</a> &amp; <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#af84372e1b524955a15ffc36a49896cdf">CONSTRAINT_DRAW_PIVOT</a>)
<a name="l06950"></a>06950                     <a class="code" href="../../d3/d02/drawobject_8c.html#a8f15e288a13a6935c832ec813654529d">drawRBpivot</a>(data);
<a name="l06951"></a>06951             }
<a name="l06952"></a>06952         }
<a name="l06953"></a>06953 
<a name="l06954"></a>06954         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa98e0216a27ddd692f1ec329ce4a4db4">gameflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a53ba2501623bb81463914897c276c1d3">OB_BOUNDS</a>) {
<a name="l06955"></a>06955             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4975c8a0d650af6077543e9949c1cb28">boundtype</a> != ob-&gt;<a class="code" href="../../de/de7/structObject.html#a16dc75c68bc6868b924999fea2e85183">collision_boundtype</a> || (dtx &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a25d148b5766d55fc995b3e7eaba3187b">OB_BOUNDBOX</a>) == 0) {
<a name="l06956"></a>06956                 <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(2);
<a name="l06957"></a>06957                 <a class="code" href="../../d3/d02/drawobject_8c.html#a4d19f50de723a4c82b4a1695f99400d4">draw_bounding_volume</a>(scene, ob, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a16dc75c68bc6868b924999fea2e85183">collision_boundtype</a>);
<a name="l06958"></a>06958                 <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(0);
<a name="l06959"></a>06959             }
<a name="l06960"></a>06960         }
<a name="l06961"></a>06961 
<a name="l06962"></a>06962         <span class="comment">/* draw extra: after normal draw because of makeDispList */</span>
<a name="l06963"></a>06963         <span class="keywordflow">if</span> (dtx &amp;&amp; (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.f &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a21b53c6c4fd77a9107e749bba55056d1">G_RENDER_OGL</a>) == 0) {
<a name="l06964"></a>06964 
<a name="l06965"></a>06965             <span class="keywordflow">if</span> (dtx &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a831f5da7358a600ebfc36dd59b086ca1">OB_AXIS</a>) {
<a name="l06966"></a>06966                 <a class="code" href="../../d3/d02/drawobject_8c.html#a3a22182290000ba6cce2b8d3eb8c3cc3">drawaxes</a>(1.0f, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ad90dfce658bb46e6844de094b5734af9">OB_ARROWS</a>);
<a name="l06967"></a>06967             }
<a name="l06968"></a>06968             <span class="keywordflow">if</span> (dtx &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a25d148b5766d55fc995b3e7eaba3187b">OB_BOUNDBOX</a>) {
<a name="l06969"></a>06969                 <a class="code" href="../../d3/d02/drawobject_8c.html#a4d19f50de723a4c82b4a1695f99400d4">draw_bounding_volume</a>(scene, ob, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4975c8a0d650af6077543e9949c1cb28">boundtype</a>);
<a name="l06970"></a>06970             }
<a name="l06971"></a>06971             <span class="keywordflow">if</span> (dtx &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a46c4f0268f8d111413eed56955421a63">OB_TEXSPACE</a>) {
<a name="l06972"></a>06972                 <a class="code" href="../../d3/d02/drawobject_8c.html#a4f3e5237be3cb57e6124f92eaaad7553">drawtexspace</a>(ob);
<a name="l06973"></a>06973             }
<a name="l06974"></a>06974             <span class="keywordflow">if</span> (dtx &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a47fa7ac0e05b12ebbcc6740667b26b6f">OB_DRAWNAME</a>) {
<a name="l06975"></a>06975                 <span class="comment">/* patch for several 3d cards (IBM mostly) that crash on glSelect with text drawing */</span>
<a name="l06976"></a>06976                 <span class="comment">/* but, we also don&#39;t draw names for sets or duplicators */</span>
<a name="l06977"></a>06977                 <span class="keywordflow">if</span> (flag == 0) {
<a name="l06978"></a>06978                     <span class="keywordtype">float</span> zero[3] = {0, 0, 0};
<a name="l06979"></a>06979                     <span class="keywordtype">float</span> curcol[4];
<a name="l06980"></a>06980                     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> tcol[4];
<a name="l06981"></a>06981                     glGetFloatv(GL_CURRENT_COLOR, curcol);
<a name="l06982"></a>06982                     <a class="code" href="../../d8/de1/BLI__math__color_8h.html#a9b3bb8bb3331550782244e732cd1d349">rgb_float_to_uchar</a>(tcol, curcol);
<a name="l06983"></a>06983                     tcol[3] = 255;
<a name="l06984"></a>06984                     <a class="code" href="../../d3/d02/drawobject_8c.html#a6de94308481c2e9de88b710de50dad2f">view3d_cached_text_draw_add</a>(zero, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a> + 2, 10, 0, tcol);
<a name="l06985"></a>06985                 }
<a name="l06986"></a>06986             }
<a name="l06987"></a>06987             <span class="comment">/*if (dtx &amp; OB_DRAWIMAGE) drawDispListwire(&amp;ob-&gt;disp);*/</span>
<a name="l06988"></a>06988             <span class="keywordflow">if</span> ((dtx &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5ab5449c65c7be34a82d408aff1c4e28">OB_DRAWWIRE</a>) &amp;&amp; dt &gt;= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a02098d23ce96d480e90882bed52cb89d">OB_SOLID</a>) {
<a name="l06989"></a>06989                 <a class="code" href="../../d3/d02/drawobject_8c.html#a92092ed8db0b6d3432aa29d4e30ad27a">drawWireExtra</a>(scene, rv3d, ob);
<a name="l06990"></a>06990             }
<a name="l06991"></a>06991         }
<a name="l06992"></a>06992     }
<a name="l06993"></a>06993 
<a name="l06994"></a>06994     <span class="keywordflow">if</span> (dt &lt;= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a02098d23ce96d480e90882bed52cb89d">OB_SOLID</a> &amp;&amp; (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0) {
<a name="l06995"></a>06995         <span class="keywordflow">if</span> ((ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa98e0216a27ddd692f1ec329ce4a4db4">gameflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ab0e087d4d1cba100d6aada23fef63137">OB_DYNAMIC</a>) ||
<a name="l06996"></a>06996             ((ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa98e0216a27ddd692f1ec329ce4a4db4">gameflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a53ba2501623bb81463914897c276c1d3">OB_BOUNDS</a>) &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4975c8a0d650af6077543e9949c1cb28">boundtype</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a12dc86faea388ad0da209de37046e165">OB_BOUND_SPHERE</a>)))
<a name="l06997"></a>06997         {
<a name="l06998"></a>06998             <span class="keywordtype">float</span> imat[4][4], vec[3] = {0.0f, 0.0f, 0.0f};
<a name="l06999"></a>06999 
<a name="l07000"></a>07000             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(imat, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a12d37f255c840dce64ab32aac76bb860">viewmatob</a>);
<a name="l07001"></a>07001 
<a name="l07002"></a>07002             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(2);
<a name="l07003"></a>07003             <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a1fabc18d6380d34e0e2e66c162bdc284">drawcircball</a>(GL_LINE_LOOP, vec, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a068e01267176aa1f09b6651fc61ff6f7">inertia</a>, imat);
<a name="l07004"></a>07004             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(0);
<a name="l07005"></a>07005         }
<a name="l07006"></a>07006     }
<a name="l07007"></a>07007     
<a name="l07008"></a>07008     <span class="comment">/* return warning, this is cached text draw */</span>
<a name="l07009"></a>07009     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65d360837f87824d49ed08caf44dccb3">imat</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l07010"></a>07010     <a class="code" href="../../d3/d02/drawobject_8c.html#a831f54b6ec78f73295a73a8e6c90df4f">view3d_cached_text_draw_end</a>(v3d, ar, 1, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l07011"></a>07011 
<a name="l07012"></a>07012     <a class="code" href="../../dd/d44/BIF__gl_8h.html#a968938b254020ac622d83a3ab1226f4a">glLoadMatrixf</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ad04178a1375cc4ef5c59a76b723f822f">viewmat</a>);
<a name="l07013"></a>07013 
<a name="l07014"></a>07014     <span class="keywordflow">if</span> (zbufoff) {
<a name="l07015"></a>07015         glDisable(GL_DEPTH_TEST);
<a name="l07016"></a>07016     }
<a name="l07017"></a>07017 
<a name="l07018"></a>07018     <span class="keywordflow">if</span> ((warning_recursive) ||
<a name="l07019"></a>07019         (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ac31d50d415c660a44c0ccdc6b4854721">OB_FROMDUPLI</a>) ||
<a name="l07020"></a>07020         (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>))
<a name="l07021"></a>07021     {
<a name="l07022"></a>07022         <span class="keywordflow">return</span>;
<a name="l07023"></a>07023     }
<a name="l07024"></a>07024 
<a name="l07025"></a>07025     <span class="comment">/* object centers, need to be drawn in viewmat space for speed, but OK for picking select */</span>
<a name="l07026"></a>07026     <span class="keywordflow">if</span> (!is_obact || !(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; (<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550afa4f66c680fdf8f9cd7ef1ca969b1901">OB_MODE_VERTEX_PAINT</a> | <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a6ab1cede4f6911c8042ca67d0c53b780">OB_MODE_WEIGHT_PAINT</a> | <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550aefdee3fdb0d4e936026d0fbdeb55852d">OB_MODE_TEXTURE_PAINT</a>))) {
<a name="l07027"></a>07027         <span class="keywordtype">int</span> do_draw_center = -1; <span class="comment">/* defines below are zero or positive... */</span>
<a name="l07028"></a>07028 
<a name="l07029"></a>07029         <span class="keywordflow">if</span> (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) {
<a name="l07030"></a>07030             <span class="comment">/* don&#39;t draw */</span>
<a name="l07031"></a>07031         }
<a name="l07032"></a>07032         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a040bbb56eb7746d04c4ae455e5b1c638">basact</a>) == base)
<a name="l07033"></a>07033             do_draw_center = <a class="code" href="../../d2/d7d/ED__types_8h.html#a3a6d3cd70078e6046471ec528a09cd19">ACTIVE</a>;
<a name="l07034"></a>07034         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)
<a name="l07035"></a>07035             do_draw_center = <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l07036"></a>07036         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (empty_object || (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a97a32d38ce1481d61d60dc677693ce5d">flag</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a569e65680377d6a40aa6eb3bd8b9ad18">V3D_DRAW_CENTERS</a>))
<a name="l07037"></a>07037             do_draw_center = <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>;
<a name="l07038"></a>07038 
<a name="l07039"></a>07039         <span class="keywordflow">if</span> (do_draw_center != -1) {
<a name="l07040"></a>07040             <span class="keywordflow">if</span> (flag &amp; DRAW_PICKING) {
<a name="l07041"></a>07041                 <span class="comment">/* draw a single point for opengl selection */</span>
<a name="l07042"></a>07042                 glBegin(GL_POINTS);
<a name="l07043"></a>07043                 glVertex3fv(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3]);
<a name="l07044"></a>07044                 glEnd();
<a name="l07045"></a>07045             }
<a name="l07046"></a>07046             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((flag &amp; DRAW_CONSTCOLOR) == 0) {
<a name="l07047"></a>07047                 <span class="comment">/* we don&#39;t draw centers for duplicators and sets */</span>
<a name="l07048"></a>07048                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.obcenter_dia &gt; 0) {
<a name="l07049"></a>07049                     <span class="comment">/* check &gt; 0 otherwise grease pencil can draw into the circle select which is annoying. */</span>
<a name="l07050"></a>07050                     <a class="code" href="../../d3/d02/drawobject_8c.html#a5e0c1beaf183e24018f106144cc64d37">drawcentercircle</a>(v3d, rv3d, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3], do_draw_center, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a> || ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a> &gt; 1);
<a name="l07051"></a>07051                 }
<a name="l07052"></a>07052             }
<a name="l07053"></a>07053         }
<a name="l07054"></a>07054     }
<a name="l07055"></a>07055 
<a name="l07056"></a>07056     <span class="comment">/* not for sets, duplicators or picking */</span>
<a name="l07057"></a>07057     <span class="keywordflow">if</span> (flag == 0 &amp;&amp; (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a97a32d38ce1481d61d60dc677693ce5d">flag</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a4dd562f53c32ac84e1a07aa4289c401d">V3D_HIDE_HELPLINES</a>) == 0 &amp;&amp; (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a70f4e893f7a84825c972ac65835d02bb">flag2</a> &amp; <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5cb67e48c19ed7b93ea2d25ad4e7ee80">V3D_RENDER_OVERRIDE</a>) == 0) {
<a name="l07058"></a>07058         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list;
<a name="l07059"></a>07059         
<a name="l07060"></a>07060         <span class="comment">/* draw hook center and offset line */</span>
<a name="l07061"></a>07061         <span class="keywordflow">if</span> (ob != scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a1aa1978dba5dab99d35b6ba89e88b5bb">obedit</a>) <a class="code" href="../../d3/d02/drawobject_8c.html#a2d935b450223f072a853343296463b98">draw_hooks</a>(ob);
<a name="l07062"></a>07062         
<a name="l07063"></a>07063         <span class="comment">/* help lines and so */</span>
<a name="l07064"></a>07064         <span class="keywordflow">if</span> (ob != scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a1aa1978dba5dab99d35b6ba89e88b5bb">obedit</a> &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a> &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa9cfa964651e1e2f3044c9c79cf004b3">lay</a> &amp; v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a45ac0a23240ec719b0952d62190e9130">lay</a>)) {
<a name="l07065"></a>07065             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(3);
<a name="l07066"></a>07066             glBegin(GL_LINES);
<a name="l07067"></a>07067             glVertex3fv(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3]);
<a name="l07068"></a>07068             glVertex3fv(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0e6a9ddfde7f2673fc3aad5b97a24656">orig</a>);
<a name="l07069"></a>07069             glEnd();
<a name="l07070"></a>07070             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(0);
<a name="l07071"></a>07071         }
<a name="l07072"></a>07072 
<a name="l07073"></a>07073         <span class="comment">/* Drawing the constraint lines */</span>
<a name="l07074"></a>07074         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l07075"></a>07075             <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *curcon;
<a name="l07076"></a>07076             <a class="code" href="../../d0/d58/structbConstraintOb.html">bConstraintOb</a> *cob;
<a name="l07077"></a>07077             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> col1[4], col2[4];
<a name="l07078"></a>07078             
<a name="l07079"></a>07079             list = &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>;
<a name="l07080"></a>07080             
<a name="l07081"></a>07081             <a class="code" href="../../de/d96/UI__resources_8h.html#a7df10cffdef8a2191960e1db949d3f47">UI_GetThemeColor3ubv</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a295ee87ce46db238cf7fd0adeddcf83d">TH_GRID</a>, col1);
<a name="l07082"></a>07082             <a class="code" href="../../de/d96/UI__resources_8h.html#a0987940839c284639e62eaa495a117a3">UI_make_axis_color</a>(col1, col2, <span class="charliteral">&#39;Z&#39;</span>);
<a name="l07083"></a>07083             glColor3ubv(col2);
<a name="l07084"></a>07084             
<a name="l07085"></a>07085             cob = <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#a66ae7f7e0e8d070e5cef7e791045a132">constraints_make_evalob</a>(scene, ob, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#adfb54b57e8687ce7b32072d253bfde5ca80fce2faf62ad6f0acce0e3319b4b6c8">CONSTRAINT_OBTYPE_OBJECT</a>);
<a name="l07086"></a>07086             
<a name="l07087"></a>07087             <span class="keywordflow">for</span> (curcon = list-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; curcon; curcon = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l07088"></a>07088                 <a class="code" href="../../dc/ded/structbConstraintTypeInfo.html">bConstraintTypeInfo</a> *cti = <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#a8eac21e0105e441026a6b7cd7d78030d">constraint_get_typeinfo</a>(curcon);
<a name="l07089"></a>07089                 <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> targets = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l07090"></a>07090                 <a class="code" href="../../d5/d78/structbConstraintTarget.html">bConstraintTarget</a> *ct;
<a name="l07091"></a>07091                 
<a name="l07092"></a>07092                 <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#af4d4e80ea9c413dd7df1b5895ed439f9">type</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a3119d40b7e938fe99cbc91a9c75bdf9e">CONSTRAINT_TYPE_FOLLOWTRACK</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a3321fd3e52140da450d8f6725b3678af">CONSTRAINT_TYPE_OBJECTSOLVER</a>)) {
<a name="l07093"></a>07093                     <span class="comment">/* special case for object solver and follow track constraints because they don&#39;t fill</span>
<a name="l07094"></a>07094 <span class="comment">                     * constraint targets properly (design limitation -- scene is needed for their target</span>
<a name="l07095"></a>07095 <span class="comment">                     * but it can&#39;t be accessed from get_targets callvack) */</span>
<a name="l07096"></a>07096 
<a name="l07097"></a>07097                     <a class="code" href="../../de/de7/structObject.html">Object</a> *camob = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07098"></a>07098 
<a name="l07099"></a>07099                     <span class="keywordflow">if</span> (cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#af4d4e80ea9c413dd7df1b5895ed439f9">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a3119d40b7e938fe99cbc91a9c75bdf9e">CONSTRAINT_TYPE_FOLLOWTRACK</a>) {
<a name="l07100"></a>07100                         <a class="code" href="../../d5/de6/structbFollowTrackConstraint.html">bFollowTrackConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = (<a class="code" href="../../d5/de6/structbFollowTrackConstraint.html">bFollowTrackConstraint</a> *)curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l07101"></a>07101 
<a name="l07102"></a>07102                         camob = data-&gt;<a class="code" href="../../d5/de6/structbFollowTrackConstraint.html#a21d74691e44df1d243e521ee4bc27ad4">camera</a> ? data-&gt;<a class="code" href="../../d5/de6/structbFollowTrackConstraint.html#a21d74691e44df1d243e521ee4bc27ad4">camera</a> : scene-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>;
<a name="l07103"></a>07103                     }
<a name="l07104"></a>07104                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#af4d4e80ea9c413dd7df1b5895ed439f9">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a3321fd3e52140da450d8f6725b3678af">CONSTRAINT_TYPE_OBJECTSOLVER</a>) {
<a name="l07105"></a>07105                         <a class="code" href="../../db/d59/structbObjectSolverConstraint.html">bObjectSolverConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = (<a class="code" href="../../db/d59/structbObjectSolverConstraint.html">bObjectSolverConstraint</a> *)curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l07106"></a>07106 
<a name="l07107"></a>07107                         camob = data-&gt;<a class="code" href="../../db/d59/structbObjectSolverConstraint.html#a689504ca062a51bb3e816b548a1e528d">camera</a> ? data-&gt;<a class="code" href="../../db/d59/structbObjectSolverConstraint.html#a689504ca062a51bb3e816b548a1e528d">camera</a> : scene-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>;
<a name="l07108"></a>07108                     }
<a name="l07109"></a>07109 
<a name="l07110"></a>07110                     <span class="keywordflow">if</span> (camob) {
<a name="l07111"></a>07111                         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(3);
<a name="l07112"></a>07112                         glBegin(GL_LINES);
<a name="l07113"></a>07113                         glVertex3fv(camob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3]);
<a name="l07114"></a>07114                         glVertex3fv(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3]);
<a name="l07115"></a>07115                         glEnd();
<a name="l07116"></a>07116                         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(0);
<a name="l07117"></a>07117                     }
<a name="l07118"></a>07118                 }
<a name="l07119"></a>07119                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> &amp; <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efda250d4736d1258139f3d64a092266c72d">CONSTRAINT_EXPAND</a>) &amp;&amp; (cti) &amp;&amp; (cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a25b05ed0f4c02b26dbbc775b47d0b934">get_constraint_targets</a>)) {
<a name="l07120"></a>07120                     cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a25b05ed0f4c02b26dbbc775b47d0b934">get_constraint_targets</a>(curcon, &amp;targets);
<a name="l07121"></a>07121                     
<a name="l07122"></a>07122                     <span class="keywordflow">for</span> (ct = targets.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ct; ct = ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a5ea4a1b1fa4761a30cb66c75a8ac9054">next</a>) {
<a name="l07123"></a>07123                         <span class="comment">/* calculate target&#39;s matrix */</span>
<a name="l07124"></a>07124                         <span class="keywordflow">if</span> (cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#ac71e480d9a6a329a8b3e3dc71130a09f">get_target_matrix</a>)
<a name="l07125"></a>07125                             cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#ac71e480d9a6a329a8b3e3dc71130a09f">get_target_matrix</a>(curcon, cob, ct, <a class="code" href="../../d8/d53/BKE__scene_8h.html#aa1d515c11776decf154b4b1684408586">BKE_curframe</a>(scene));
<a name="l07126"></a>07126                         <span class="keywordflow">else</span>
<a name="l07127"></a>07127                             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#afff10505f6c21c7a27618c36bd1295a3">matrix</a>);
<a name="l07128"></a>07128                         
<a name="l07129"></a>07129                         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(3);
<a name="l07130"></a>07130                         glBegin(GL_LINES);
<a name="l07131"></a>07131                         glVertex3fv(ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#afff10505f6c21c7a27618c36bd1295a3">matrix</a>[3]);
<a name="l07132"></a>07132                         glVertex3fv(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3]);
<a name="l07133"></a>07133                         glEnd();
<a name="l07134"></a>07134                         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a97e0af63da34003debb284a98403315d">setlinestyle</a>(0);
<a name="l07135"></a>07135                     }
<a name="l07136"></a>07136                     
<a name="l07137"></a>07137                     <span class="keywordflow">if</span> (cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a5afd4078d269cd49108678e99cca935f">flush_constraint_targets</a>)
<a name="l07138"></a>07138                         cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a5afd4078d269cd49108678e99cca935f">flush_constraint_targets</a>(curcon, &amp;targets, 1);
<a name="l07139"></a>07139                 }
<a name="l07140"></a>07140             }
<a name="l07141"></a>07141             
<a name="l07142"></a>07142             <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#afd27f475b6d3ed93b5f045e201dcf687">constraints_clear_evalob</a>(cob);
<a name="l07143"></a>07143         }
<a name="l07144"></a>07144     }
<a name="l07145"></a>07145 
<a name="l07146"></a>07146     <a class="code" href="../../d2/d77/BKE__image_8h.html#ab5dc7a4d3aedf6f24c52e4a033f708bf">free_old_images</a>();
<a name="l07147"></a>07147 }
<a name="l07148"></a>07148 
<a name="l07149"></a>07149 <span class="comment">/* ***************** BACKBUF SEL (BBS) ********* */</span>
<a name="l07150"></a>07150 
<a name="l07151"></a><a class="code" href="../../d3/d02/drawobject_8c.html#af71ecab81f0fe322ed02943b62edc19e">07151</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#af71ecab81f0fe322ed02943b62edc19e">bbs_obmode_mesh_verts__mapFunc</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">float</span> co[3],
<a name="l07152"></a>07152                                            <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(no_f[3]), <span class="keyword">const</span> <span class="keywordtype">short</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(no_s[3]))
<a name="l07153"></a>07153 {
<a name="l07154"></a>07154     <a class="code" href="../../dc/d05/structbbsObmodeMeshVerts__userData.html">bbsObmodeMeshVerts_userData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = userData;
<a name="l07155"></a>07155     <a class="code" href="../../d8/de5/structMVert.html">MVert</a> *mv = &amp;data-&gt;<a class="code" href="../../dc/d05/structbbsObmodeMeshVerts__userData.html#a8049f3adc975e9ca4ad9c3836bce142a">mvert</a>[index];
<a name="l07156"></a>07156     <span class="keywordtype">int</span> offset = (intptr_t) data-&gt;<a class="code" href="../../dc/d05/structbbsObmodeMeshVerts__userData.html#ad818b5e0cbef32d88ed7d9b5b20e815c">offset</a>;
<a name="l07157"></a>07157 
<a name="l07158"></a>07158     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (!(mv-&gt;<a class="code" href="../../d8/de5/structMVert.html#ad635bc3f86fdb7266167069b0cd4cde9">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>)) {
<a name="l07159"></a>07159         <a class="code" href="../../df/d4d/wm__subwindow_8c.html#a08e011afdfcaa54ff62311e08c89a8af">WM_set_framebuffer_index_color</a>(offset + index);
<a name="l07160"></a>07160         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(co);
<a name="l07161"></a>07161     }
<a name="l07162"></a>07162 }
<a name="l07163"></a>07163 
<a name="l07164"></a><a class="code" href="../../d3/d02/drawobject_8c.html#aad84df5e30e617e0bedc32bda9482a5b">07164</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#aad84df5e30e617e0bedc32bda9482a5b">bbs_obmode_mesh_verts</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm, <span class="keywordtype">int</span> offset)
<a name="l07165"></a>07165 {
<a name="l07166"></a>07166     <a class="code" href="../../dc/d05/structbbsObmodeMeshVerts__userData.html">bbsObmodeMeshVerts_userData</a> <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l07167"></a>07167     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l07168"></a>07168     <a class="code" href="../../d8/de5/structMVert.html">MVert</a> *mvert = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a422181e95f8eeb611b58ca26b5f62bdf">mvert</a>;
<a name="l07169"></a>07169     data.<a class="code" href="../../dc/d05/structbbsObmodeMeshVerts__userData.html#a8049f3adc975e9ca4ad9c3836bce142a">mvert</a> = mvert;
<a name="l07170"></a>07170     data.<a class="code" href="../../dc/d05/structbbsObmodeMeshVerts__userData.html#ad818b5e0cbef32d88ed7d9b5b20e815c">offset</a> = (<span class="keywordtype">void</span> *)(intptr_t) offset;
<a name="l07171"></a>07171     glPointSize(<a class="code" href="../../de/d96/UI__resources_8h.html#ad9772e3578b739880ada62a6d21f4349">UI_GetThemeValuef</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a6c88c69347ab72b259eb7fcc8885327b">TH_VERTEX_SIZE</a>) );
<a name="l07172"></a>07172     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#acbcc8c3223d7fc13a7931b0a1744b240">bglBegin</a>(GL_POINTS);
<a name="l07173"></a>07173     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a14c8a2dc23a8af0e7aaf2190f7cf0202">foreachMappedVert</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#af71ecab81f0fe322ed02943b62edc19e">bbs_obmode_mesh_verts__mapFunc</a>, &amp;data);
<a name="l07174"></a>07174     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a2517dcaf453d3e58af25fd4c677dad45">bglEnd</a>();
<a name="l07175"></a>07175     glPointSize(1.0);
<a name="l07176"></a>07176 }
<a name="l07177"></a>07177 
<a name="l07178"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a87861929c79d1778d4ab636e0394add9">07178</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a87861929c79d1778d4ab636e0394add9">bbs_mesh_verts__mapFunc</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">float</span> co[3],
<a name="l07179"></a>07179                                     <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(no_f[3]), <span class="keyword">const</span> <span class="keywordtype">short</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(no_s[3]))
<a name="l07180"></a>07180 {
<a name="l07181"></a>07181     <span class="keywordtype">void</span> **ptrs = userData;
<a name="l07182"></a>07182     <span class="keywordtype">int</span> offset = (intptr_t) ptrs[0];
<a name="l07183"></a>07183     <a class="code" href="../../df/d18/structBMVert.html">BMVert</a> *eve = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a63e064e5e9c88cbdb131a3c55d1e6c26">EDBM_vert_at_index</a>(ptrs[1], index);
<a name="l07184"></a>07184 
<a name="l07185"></a>07185     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eve, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>)) {
<a name="l07186"></a>07186         <a class="code" href="../../df/d4d/wm__subwindow_8c.html#a08e011afdfcaa54ff62311e08c89a8af">WM_set_framebuffer_index_color</a>(offset + index);
<a name="l07187"></a>07187         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(co);
<a name="l07188"></a>07188     }
<a name="l07189"></a>07189 }
<a name="l07190"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ab2beac4e0adb15ef2d2909a1772f1cbb">07190</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#ab2beac4e0adb15ef2d2909a1772f1cbb">bbs_mesh_verts</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm, <span class="keywordtype">int</span> offset)
<a name="l07191"></a>07191 {
<a name="l07192"></a>07192     <span class="keywordtype">void</span> *ptrs[2] = {(<span class="keywordtype">void</span> *)(intptr_t) offset, em};
<a name="l07193"></a>07193 
<a name="l07194"></a>07194     glPointSize(<a class="code" href="../../de/d96/UI__resources_8h.html#ad9772e3578b739880ada62a6d21f4349">UI_GetThemeValuef</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a6c88c69347ab72b259eb7fcc8885327b">TH_VERTEX_SIZE</a>) );
<a name="l07195"></a>07195     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#acbcc8c3223d7fc13a7931b0a1744b240">bglBegin</a>(GL_POINTS);
<a name="l07196"></a>07196     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a14c8a2dc23a8af0e7aaf2190f7cf0202">foreachMappedVert</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#a87861929c79d1778d4ab636e0394add9">bbs_mesh_verts__mapFunc</a>, ptrs);
<a name="l07197"></a>07197     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a2517dcaf453d3e58af25fd4c677dad45">bglEnd</a>();
<a name="l07198"></a>07198     glPointSize(1.0);
<a name="l07199"></a>07199 }       
<a name="l07200"></a>07200 
<a name="l07201"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a802ed7cd903351c5f105c8ca29bd9a9a">07201</a> <span class="keyword">static</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442">DMDrawOption</a> <a class="code" href="../../d3/d02/drawobject_8c.html#a802ed7cd903351c5f105c8ca29bd9a9a">bbs_mesh_wire__setDrawOptions</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index)
<a name="l07202"></a>07202 {
<a name="l07203"></a>07203     <span class="keywordtype">void</span> **ptrs = userData;
<a name="l07204"></a>07204     <span class="keywordtype">int</span> offset = (intptr_t) ptrs[0];
<a name="l07205"></a>07205     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *eed = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a84b498997c52686a55d7ea755d1e6bc3">EDBM_edge_at_index</a>(ptrs[1], index);
<a name="l07206"></a>07206 
<a name="l07207"></a>07207     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eed, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>)) {
<a name="l07208"></a>07208         <a class="code" href="../../df/d4d/wm__subwindow_8c.html#a08e011afdfcaa54ff62311e08c89a8af">WM_set_framebuffer_index_color</a>(offset + index);
<a name="l07209"></a>07209         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442acfb2e0978e1605561279f2b599cf4499">DM_DRAW_OPTION_NORMAL</a>;
<a name="l07210"></a>07210     }
<a name="l07211"></a>07211     <span class="keywordflow">else</span> {
<a name="l07212"></a>07212         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a618a0ba0086f3f3687726db84919260d">DM_DRAW_OPTION_SKIP</a>;
<a name="l07213"></a>07213     }
<a name="l07214"></a>07214 }
<a name="l07215"></a><a class="code" href="../../d3/d02/drawobject_8c.html#aba1df702fe4a5f05bf17b2858325c33f">07215</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#aba1df702fe4a5f05bf17b2858325c33f">bbs_mesh_wire</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm, <span class="keywordtype">int</span> offset)
<a name="l07216"></a>07216 {
<a name="l07217"></a>07217     <span class="keywordtype">void</span> *ptrs[2] = {(<span class="keywordtype">void</span> *)(intptr_t) offset, em};
<a name="l07218"></a>07218     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a24108131d9cda75a80fb3361c81f3afa">drawMappedEdges</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#a802ed7cd903351c5f105c8ca29bd9a9a">bbs_mesh_wire__setDrawOptions</a>, ptrs);
<a name="l07219"></a>07219 }       
<a name="l07220"></a>07220 
<a name="l07221"></a><a class="code" href="../../d3/d02/drawobject_8c.html#ab4950a795080abee7546be81d3179419">07221</a> <span class="keyword">static</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442">DMDrawOption</a> <a class="code" href="../../d3/d02/drawobject_8c.html#ab4950a795080abee7546be81d3179419">bbs_mesh_solid__setSolidDrawOptions</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index)
<a name="l07222"></a>07222 {
<a name="l07223"></a>07223     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a79834f648f43a4b01046a46de38fbcec">EDBM_face_at_index</a>(((<span class="keywordtype">void</span> **)userData)[0], index);
<a name="l07224"></a>07224     
<a name="l07225"></a>07225     <span class="keywordflow">if</span> (efa &amp;&amp; !<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>)) {
<a name="l07226"></a>07226         <span class="keywordflow">if</span> (((<span class="keywordtype">void</span> **)userData)[1]) {
<a name="l07227"></a>07227             <a class="code" href="../../df/d4d/wm__subwindow_8c.html#a08e011afdfcaa54ff62311e08c89a8af">WM_set_framebuffer_index_color</a>(index + 1);
<a name="l07228"></a>07228         }
<a name="l07229"></a>07229         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442acfb2e0978e1605561279f2b599cf4499">DM_DRAW_OPTION_NORMAL</a>;
<a name="l07230"></a>07230     }
<a name="l07231"></a>07231     <span class="keywordflow">else</span> {
<a name="l07232"></a>07232         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a618a0ba0086f3f3687726db84919260d">DM_DRAW_OPTION_SKIP</a>;
<a name="l07233"></a>07233     }
<a name="l07234"></a>07234 }
<a name="l07235"></a>07235 
<a name="l07236"></a><a class="code" href="../../d3/d02/drawobject_8c.html#aea34d57beae14d42352c86382a2c6f92">07236</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#aea34d57beae14d42352c86382a2c6f92">bbs_mesh_solid__drawCenter</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">float</span> cent[3], <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(no[3]))
<a name="l07237"></a>07237 {
<a name="l07238"></a>07238     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a79834f648f43a4b01046a46de38fbcec">EDBM_face_at_index</a>(((<span class="keywordtype">void</span> **)userData)[0], index);
<a name="l07239"></a>07239 
<a name="l07240"></a>07240     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>)) {
<a name="l07241"></a>07241         <a class="code" href="../../df/d4d/wm__subwindow_8c.html#a08e011afdfcaa54ff62311e08c89a8af">WM_set_framebuffer_index_color</a>(index + 1);
<a name="l07242"></a>07242 
<a name="l07243"></a>07243         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a679aa41454f90b090a4450859811b3ff">bglVertex3fv</a>(cent);
<a name="l07244"></a>07244     }
<a name="l07245"></a>07245 }
<a name="l07246"></a>07246 
<a name="l07247"></a>07247 <span class="comment">/* two options, facecolors or black */</span>
<a name="l07248"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a8fecb0cd074f44fee66e4a2fb250e553">07248</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a8fecb0cd074f44fee66e4a2fb250e553">bbs_mesh_solid_EM</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d,
<a name="l07249"></a>07249                               <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm, <span class="keywordtype">int</span> facecol)
<a name="l07250"></a>07250 {
<a name="l07251"></a>07251     <span class="keywordtype">void</span> *ptrs[2] = {em, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}; <span class="comment">//second one being null means to draw black</span>
<a name="l07252"></a>07252     <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(0);
<a name="l07253"></a>07253 
<a name="l07254"></a>07254     <span class="keywordflow">if</span> (facecol) {
<a name="l07255"></a>07255         ptrs[1] = (<span class="keywordtype">void</span> *)(intptr_t) 1;
<a name="l07256"></a>07256         dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a68c34c18414350c39f74969f2cf3f276">drawMappedFaces</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#ab4950a795080abee7546be81d3179419">bbs_mesh_solid__setSolidDrawOptions</a>, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ptrs, 0);
<a name="l07257"></a>07257 
<a name="l07258"></a>07258         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d02/drawobject_8c.html#a5a9568e44f52a75716cc935f20a02da3">check_ob_drawface_dot</a>(scene, v3d, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a849f37900ed7ea1f55647f7f4f8ed123">dt</a>)) {
<a name="l07259"></a>07259             glPointSize(<a class="code" href="../../de/d96/UI__resources_8h.html#ad9772e3578b739880ada62a6d21f4349">UI_GetThemeValuef</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a3c33de8dbb8af6733e351aaee5c87068">TH_FACEDOT_SIZE</a>));
<a name="l07260"></a>07260 
<a name="l07261"></a>07261             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#acbcc8c3223d7fc13a7931b0a1744b240">bglBegin</a>(GL_POINTS);
<a name="l07262"></a>07262             dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a9a13cfc8abb45d854797053a05f754d1">foreachMappedFaceCenter</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#aea34d57beae14d42352c86382a2c6f92">bbs_mesh_solid__drawCenter</a>, ptrs);
<a name="l07263"></a>07263             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a2517dcaf453d3e58af25fd4c677dad45">bglEnd</a>();
<a name="l07264"></a>07264         }
<a name="l07265"></a>07265 
<a name="l07266"></a>07266     }
<a name="l07267"></a>07267     <span class="keywordflow">else</span> {
<a name="l07268"></a>07268         dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a68c34c18414350c39f74969f2cf3f276">drawMappedFaces</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#ab4950a795080abee7546be81d3179419">bbs_mesh_solid__setSolidDrawOptions</a>, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ptrs, 0);
<a name="l07269"></a>07269     }
<a name="l07270"></a>07270 }
<a name="l07271"></a>07271 
<a name="l07272"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a8b0296a61de65fa312b04d924c4d29e4">07272</a> <span class="keyword">static</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442">DMDrawOption</a> <a class="code" href="../../d3/d02/drawobject_8c.html#a8b0296a61de65fa312b04d924c4d29e4">bbs_mesh_solid__setDrawOpts</a>(<span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(userData), <span class="keywordtype">int</span> index)
<a name="l07273"></a>07273 {
<a name="l07274"></a>07274     <a class="code" href="../../df/d4d/wm__subwindow_8c.html#a08e011afdfcaa54ff62311e08c89a8af">WM_set_framebuffer_index_color</a>(index + 1);
<a name="l07275"></a>07275     <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442acfb2e0978e1605561279f2b599cf4499">DM_DRAW_OPTION_NORMAL</a>;
<a name="l07276"></a>07276 }
<a name="l07277"></a>07277 
<a name="l07278"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a0aaf300fddbaaf5c9d00192d91fe1674">07278</a> <span class="keyword">static</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442">DMDrawOption</a> <a class="code" href="../../d3/d02/drawobject_8c.html#a0aaf300fddbaaf5c9d00192d91fe1674">bbs_mesh_solid_hide__setDrawOpts</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index)
<a name="l07279"></a>07279 {
<a name="l07280"></a>07280     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = userData;
<a name="l07281"></a>07281 
<a name="l07282"></a>07282     <span class="keywordflow">if</span> (!(me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>[index].<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>)) {
<a name="l07283"></a>07283         <a class="code" href="../../df/d4d/wm__subwindow_8c.html#a08e011afdfcaa54ff62311e08c89a8af">WM_set_framebuffer_index_color</a>(index + 1);
<a name="l07284"></a>07284         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442acfb2e0978e1605561279f2b599cf4499">DM_DRAW_OPTION_NORMAL</a>;
<a name="l07285"></a>07285     }
<a name="l07286"></a>07286     <span class="keywordflow">else</span> {
<a name="l07287"></a>07287         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a618a0ba0086f3f3687726db84919260d">DM_DRAW_OPTION_SKIP</a>;
<a name="l07288"></a>07288     }
<a name="l07289"></a>07289 }
<a name="l07290"></a>07290 
<a name="l07291"></a>07291 <span class="comment">// must have called WM_set_framebuffer_index_color beforehand</span>
<a name="l07292"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a9c84747c646d2903d71b9fa16c3ae838">07292</a> <span class="keyword">static</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442">DMDrawOption</a> <a class="code" href="../../d3/d02/drawobject_8c.html#a9c84747c646d2903d71b9fa16c3ae838">bbs_mesh_solid_hide2__setDrawOpts</a>(<span class="keywordtype">void</span> *userData, <span class="keywordtype">int</span> index)
<a name="l07293"></a>07293 {
<a name="l07294"></a>07294     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = userData;
<a name="l07295"></a>07295 
<a name="l07296"></a>07296     <span class="keywordflow">if</span> (!(me-&gt;<a class="code" href="../../da/d29/structMesh.html#aed0e442be859c2a4f8067eda4f81c064">mpoly</a>[index].<a class="code" href="../../d2/dca/structMPoly.html#a208492a1db60c4d108f51334e5e80d53">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a9336832abc5e4645418d182f520d058f">ME_HIDE</a>)) {
<a name="l07297"></a>07297         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442acfb2e0978e1605561279f2b599cf4499">DM_DRAW_OPTION_NORMAL</a>;
<a name="l07298"></a>07298     }
<a name="l07299"></a>07299     <span class="keywordflow">else</span> {
<a name="l07300"></a>07300         <span class="keywordflow">return</span> <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ae0bb6c16ac9c597ad3863acd97417442a618a0ba0086f3f3687726db84919260d">DM_DRAW_OPTION_SKIP</a>;
<a name="l07301"></a>07301     }
<a name="l07302"></a>07302 }
<a name="l07303"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a26117d919ef80f29c06ff2674bf31135">07303</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a26117d919ef80f29c06ff2674bf31135">bbs_mesh_solid</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l07304"></a>07304 {
<a name="l07305"></a>07305     <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm = <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#a97d53912627cd01e30cab0c5a125485e">mesh_get_derived_final</a>(scene, ob, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a3a4f81e0f2023f6834ccb638ed26cd0c">customdata_mask</a>);
<a name="l07306"></a>07306     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = (<a class="code" href="../../da/d29/structMesh.html">Mesh</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l07307"></a>07307     
<a name="l07308"></a>07308     glColor3ub(0, 0, 0);
<a name="l07309"></a>07309 
<a name="l07310"></a>07310     <span class="keywordflow">if</span> ((me-&gt;<a class="code" href="../../da/d29/structMesh.html#a8e2607f7fddc692e3082aac5b180c35e">editflag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#ae2c6ba156c41b5bc56a253cd8bf33b13">ME_EDIT_PAINT_MASK</a>))
<a name="l07311"></a>07311         dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a68c34c18414350c39f74969f2cf3f276">drawMappedFaces</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#a0aaf300fddbaaf5c9d00192d91fe1674">bbs_mesh_solid_hide__setDrawOpts</a>, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, me, 0);
<a name="l07312"></a>07312     <span class="keywordflow">else</span>
<a name="l07313"></a>07313         dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a68c34c18414350c39f74969f2cf3f276">drawMappedFaces</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#a8b0296a61de65fa312b04d924c4d29e4">bbs_mesh_solid__setDrawOpts</a>, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, me, 0);
<a name="l07314"></a>07314 
<a name="l07315"></a>07315     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a36c159344a023f5fbe64f12006c8647f">release</a>(dm);
<a name="l07316"></a>07316 }
<a name="l07317"></a>07317 
<a name="l07318"></a><a class="code" href="../../d4/df4/view3d__intern_8h.html#abd962ac70684bc04e6e41bf1e627ed04">07318</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a1fb22168e4ee2362f1bb110ef88c65fb">draw_object_backbufsel</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l07319"></a>07319 {
<a name="l07320"></a>07320     <a class="code" href="../../d0/d65/structToolSettings.html">ToolSettings</a> *ts = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>;
<a name="l07321"></a>07321 
<a name="l07322"></a>07322     <a class="code" href="../../dd/d44/BIF__gl_8h.html#a22a8b7985dcd174e9add6f20aa37a962">glMultMatrixf</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l07323"></a>07323 
<a name="l07324"></a>07324     glClearDepth(1.0); glClear(GL_DEPTH_BUFFER_BIT);
<a name="l07325"></a>07325     glEnable(GL_DEPTH_TEST);
<a name="l07326"></a>07326 
<a name="l07327"></a>07327     <span class="keywordflow">switch</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>) {
<a name="l07328"></a>07328         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>:
<a name="l07329"></a>07329             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a5aed90bff10a0fd5ad47c9ee79ae4580">OB_MODE_EDIT</a>) {
<a name="l07330"></a>07330                 <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l07331"></a>07331                 <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>;
<a name="l07332"></a>07332 
<a name="l07333"></a>07333                 <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm = <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#aadc7033561fddea210085209cea4dfa1">editbmesh_get_derived_cage</a>(scene, ob, em, <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#ac302305683fc6e7bba64ef68c74a1404">CD_MASK_BAREMESH</a>);
<a name="l07334"></a>07334 
<a name="l07335"></a>07335                 <a class="code" href="../../d5/dd6/ED__mesh_8h.html#aa97a3443500c36b7a92a1e2970370561">EDBM_index_arrays_init</a>(em, 1, 1, 1);
<a name="l07336"></a>07336 
<a name="l07337"></a>07337                 <a class="code" href="../../d3/d02/drawobject_8c.html#a8fecb0cd074f44fee66e4a2fb250e553">bbs_mesh_solid_EM</a>(em, scene, v3d, ob, dm, ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a85db400bd7203c7be03555b02e6c2709">selectmode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a616adf2bfd4117c15663a28e464a5100">SCE_SELECT_FACE</a>);
<a name="l07338"></a>07338                 <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a85db400bd7203c7be03555b02e6c2709">selectmode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a616adf2bfd4117c15663a28e464a5100">SCE_SELECT_FACE</a>)
<a name="l07339"></a>07339                     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ace25243b399cbba3d6a783c565aa6aaf">bm_solidoffs</a> = 1 + em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#ae4e0288302780574590bab5f8ff43fa4">totface</a>;
<a name="l07340"></a>07340                 <span class="keywordflow">else</span>
<a name="l07341"></a>07341                     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ace25243b399cbba3d6a783c565aa6aaf">bm_solidoffs</a> = 1;
<a name="l07342"></a>07342 
<a name="l07343"></a>07343                 <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a34edada4ce250a4abb76f2011ac70a76">bglPolygonOffset</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a5a4f191256ccc5c28828b922636ca588">dist</a>, 1.0);
<a name="l07344"></a>07344 
<a name="l07345"></a>07345                 <span class="comment">// we draw edges always, for loop (select) tools</span>
<a name="l07346"></a>07346                 <a class="code" href="../../d3/d02/drawobject_8c.html#aba1df702fe4a5f05bf17b2858325c33f">bbs_mesh_wire</a>(em, dm, <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ace25243b399cbba3d6a783c565aa6aaf">bm_solidoffs</a>);
<a name="l07347"></a>07347                 <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a66909bb3751cdac68486f64dac0baf8d">bm_wireoffs</a> = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ace25243b399cbba3d6a783c565aa6aaf">bm_solidoffs</a> + em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a3f12552bb4c91af433df2e26260ac672">totedge</a>;
<a name="l07348"></a>07348 
<a name="l07349"></a>07349                 <span class="comment">// we draw verts if vert select mode or if in transform (for snap).</span>
<a name="l07350"></a>07350                 <span class="keywordflow">if</span> ((ts-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a85db400bd7203c7be03555b02e6c2709">selectmode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8de5fe0f8dbf523c4699a7b54c429e2f">SCE_SELECT_VERTEX</a>) || (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.moving &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a3b208b8db70bf81383a8baf1c4a128c2">G_TRANSFORM_EDIT</a>)) {
<a name="l07351"></a>07351                     <a class="code" href="../../d3/d02/drawobject_8c.html#ab2beac4e0adb15ef2d2909a1772f1cbb">bbs_mesh_verts</a>(em, dm, <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a66909bb3751cdac68486f64dac0baf8d">bm_wireoffs</a>);
<a name="l07352"></a>07352                     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#adf10a1790c3ffb30a006c9aed35ad400">bm_vertoffs</a> = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a66909bb3751cdac68486f64dac0baf8d">bm_wireoffs</a> + em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#a003a55069d35eec157e4dfb5a0d78165">totvert</a>;
<a name="l07353"></a>07353                 }
<a name="l07354"></a>07354                 <span class="keywordflow">else</span> {
<a name="l07355"></a>07355                     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#adf10a1790c3ffb30a006c9aed35ad400">bm_vertoffs</a> = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a66909bb3751cdac68486f64dac0baf8d">bm_wireoffs</a>;
<a name="l07356"></a>07356                 }
<a name="l07357"></a>07357 
<a name="l07358"></a>07358                 <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a34edada4ce250a4abb76f2011ac70a76">bglPolygonOffset</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a5a4f191256ccc5c28828b922636ca588">dist</a>, 0.0);
<a name="l07359"></a>07359 
<a name="l07360"></a>07360                 dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a36c159344a023f5fbe64f12006c8647f">release</a>(dm);
<a name="l07361"></a>07361 
<a name="l07362"></a>07362                 <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ade6a9b6920d5141b0102b60995a5b91f">EDBM_index_arrays_free</a>(em);
<a name="l07363"></a>07363             }
<a name="l07364"></a>07364             <span class="keywordflow">else</span> {
<a name="l07365"></a>07365                 <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l07366"></a>07366                 <span class="keywordflow">if</span> ((me-&gt;<a class="code" href="../../da/d29/structMesh.html#a8e2607f7fddc692e3082aac5b180c35e">editflag</a> &amp; <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#af66396a073d4e81b048ffe20d23fc612">ME_EDIT_VERT_SEL</a>) &amp;&amp;
<a name="l07367"></a>07367                     <span class="comment">/* currently vertex select only supports weight paint */</span>
<a name="l07368"></a>07368                     (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a6ab1cede4f6911c8042ca67d0c53b780">OB_MODE_WEIGHT_PAINT</a>))
<a name="l07369"></a>07369                 {
<a name="l07370"></a>07370                     <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm = <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#a97d53912627cd01e30cab0c5a125485e">mesh_get_derived_final</a>(scene, ob, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a3a4f81e0f2023f6834ccb638ed26cd0c">customdata_mask</a>);
<a name="l07371"></a>07371                     glColor3ub(0, 0, 0);
<a name="l07372"></a>07372 
<a name="l07373"></a>07373                     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a68c34c18414350c39f74969f2cf3f276">drawMappedFaces</a>(dm, <a class="code" href="../../d3/d02/drawobject_8c.html#a9c84747c646d2903d71b9fa16c3ae838">bbs_mesh_solid_hide2__setDrawOpts</a>, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, me, 0);
<a name="l07374"></a>07374 
<a name="l07375"></a>07375 
<a name="l07376"></a>07376                     <a class="code" href="../../d3/d02/drawobject_8c.html#aad84df5e30e617e0bedc32bda9482a5b">bbs_obmode_mesh_verts</a>(ob, dm, 1);
<a name="l07377"></a>07377                     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#adf10a1790c3ffb30a006c9aed35ad400">bm_vertoffs</a> = me-&gt;<a class="code" href="../../da/d29/structMesh.html#a8eb428498e3a39055f51a7de431655ed">totvert</a> + 1;
<a name="l07378"></a>07378                     dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a36c159344a023f5fbe64f12006c8647f">release</a>(dm);
<a name="l07379"></a>07379                 }
<a name="l07380"></a>07380                 <span class="keywordflow">else</span> {
<a name="l07381"></a>07381                     <a class="code" href="../../d3/d02/drawobject_8c.html#a26117d919ef80f29c06ff2674bf31135">bbs_mesh_solid</a>(scene, ob);
<a name="l07382"></a>07382                 }
<a name="l07383"></a>07383             }
<a name="l07384"></a>07384             <span class="keywordflow">break</span>;
<a name="l07385"></a>07385         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>:
<a name="l07386"></a>07386         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>:
<a name="l07387"></a>07387             <span class="keywordflow">break</span>;
<a name="l07388"></a>07388     }
<a name="l07389"></a>07389 
<a name="l07390"></a>07390     <a class="code" href="../../dd/d44/BIF__gl_8h.html#a968938b254020ac622d83a3ab1226f4a">glLoadMatrixf</a>(rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ad04178a1375cc4ef5c59a76b723f822f">viewmat</a>);
<a name="l07391"></a>07391 }
<a name="l07392"></a>07392 
<a name="l07393"></a>07393 
<a name="l07394"></a>07394 <span class="comment">/* ************* draw object instances for bones, for example ****************** */</span>
<a name="l07395"></a>07395 <span class="comment">/*               assumes all matrices/etc set OK */</span>
<a name="l07396"></a>07396 
<a name="l07397"></a>07397 <span class="comment">/* helper function for drawing object instances - meshes */</span>
<a name="l07398"></a><a class="code" href="../../d3/d02/drawobject_8c.html#a6f04e6a68440f263680a333a71236d31">07398</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a6f04e6a68440f263680a333a71236d31">draw_object_mesh_instance</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d, 
<a name="l07399"></a>07399                                       <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keywordtype">int</span> dt, <span class="keywordtype">int</span> outline)
<a name="l07400"></a>07400 {
<a name="l07401"></a>07401     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l07402"></a>07402     <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *edm = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07403"></a>07403     <span class="keywordtype">int</span> glsl;
<a name="l07404"></a>07404     
<a name="l07405"></a>07405     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a5aed90bff10a0fd5ad47c9ee79ae4580">OB_MODE_EDIT</a>)
<a name="l07406"></a>07406         edm = <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#ad219e8b9311146ba070bcd1e98622a1d">editbmesh_get_derived_base</a>(ob, me-&gt;<a class="code" href="../../da/d29/structMesh.html#a1b0a1797d0b3927b83f36b2d8d579ddb">edit_btmesh</a>);
<a name="l07407"></a>07407     <span class="keywordflow">else</span>
<a name="l07408"></a>07408         dm = <a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html#a97d53912627cd01e30cab0c5a125485e">mesh_get_derived_final</a>(scene, ob, <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#ac302305683fc6e7bba64ef68c74a1404">CD_MASK_BAREMESH</a>);
<a name="l07409"></a>07409 
<a name="l07410"></a>07410     <span class="keywordflow">if</span> (dt &lt;= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a112caf28bb615ee6c87ff744d1228182">OB_WIRE</a>) {
<a name="l07411"></a>07411         <span class="keywordflow">if</span> (dm)
<a name="l07412"></a>07412             dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a05d1c2b6c7c1eff4fdf4fdb973bbba5c">drawEdges</a>(dm, 1, 0);
<a name="l07413"></a>07413         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (edm)
<a name="l07414"></a>07414             edm-&gt;drawEdges(edm, 1, 0);
<a name="l07415"></a>07415     }
<a name="l07416"></a>07416     <span class="keywordflow">else</span> {
<a name="l07417"></a>07417         <span class="keywordflow">if</span> (outline)
<a name="l07418"></a>07418             <a class="code" href="../../d3/d02/drawobject_8c.html#a0ce5944dca582d34c478ae482f47801b">draw_mesh_object_outline</a>(v3d, ob, dm ? dm : edm);
<a name="l07419"></a>07419 
<a name="l07420"></a>07420         <span class="keywordflow">if</span> (dm) {
<a name="l07421"></a>07421             glsl = <a class="code" href="../../d3/d02/drawobject_8c.html#aca409cda616fd2a1eb6eb2dc5b124fac">draw_glsl_material</a>(scene, ob, v3d, dt);
<a name="l07422"></a>07422             <a class="code" href="../../d3/df0/GPU__draw_8h.html#a298d978884494b64b6a783903350e2f6">GPU_begin_object_materials</a>(v3d, rv3d, scene, ob, glsl, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l07423"></a>07423         }
<a name="l07424"></a>07424         <span class="keywordflow">else</span> {
<a name="l07425"></a>07425             glEnable(GL_COLOR_MATERIAL);
<a name="l07426"></a>07426             <a class="code" href="../../de/d96/UI__resources_8h.html#af31db5d1a7c8b15e6e8a008482426f3a">UI_ThemeColor</a>(<a class="code" href="../../de/d96/UI__resources_8h.html#ae33c78feb670de33d2abf21ec0624531a04d87007e8ef50f9f7af47fc599ffeb4">TH_BONE_SOLID</a>);
<a name="l07427"></a>07427             glDisable(GL_COLOR_MATERIAL);
<a name="l07428"></a>07428         }
<a name="l07429"></a>07429         
<a name="l07430"></a>07430         glFrontFace((ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1091cd84d4d7227ab41b167e84be3065">transflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a87014edc673c17c72d0cf437921da147">OB_NEG_SCALE</a>) ? GL_CW : GL_CCW);
<a name="l07431"></a>07431         glEnable(GL_LIGHTING);
<a name="l07432"></a>07432         
<a name="l07433"></a>07433         <span class="keywordflow">if</span> (dm) {
<a name="l07434"></a>07434             dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#ae8847d132e3b89911b0ee999b3843b95">drawFacesSolid</a>(dm, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>);
<a name="l07435"></a>07435             <a class="code" href="../../d3/df0/GPU__draw_8h.html#ac05a8ea057e161f6f5cc5c38a394a3e3">GPU_end_object_materials</a>();
<a name="l07436"></a>07436         }
<a name="l07437"></a>07437         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (edm)
<a name="l07438"></a>07438             edm-&gt;drawMappedFaces(edm, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d3/df0/GPU__draw_8h.html#a65117c75f7e8a1d5bc9479ef2cdc26c6">GPU_enable_material</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);
<a name="l07439"></a>07439         
<a name="l07440"></a>07440         glDisable(GL_LIGHTING);
<a name="l07441"></a>07441     }
<a name="l07442"></a>07442 
<a name="l07443"></a>07443     <span class="keywordflow">if</span> (edm) edm-&gt;release(edm);
<a name="l07444"></a>07444     <span class="keywordflow">if</span> (dm) dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a36c159344a023f5fbe64f12006c8647f">release</a>(dm);
<a name="l07445"></a>07445 }
<a name="l07446"></a>07446 
<a name="l07447"></a><a class="code" href="../../d4/df4/view3d__intern_8h.html#a0a9ab5cf33186da714b93ec42a1ea876">07447</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d02/drawobject_8c.html#a497801113de27ac7595a10041bca79b4">draw_object_instance</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keywordtype">int</span> dt, <span class="keywordtype">int</span> outline)
<a name="l07448"></a>07448 {
<a name="l07449"></a>07449     <span class="keywordflow">if</span> (ob == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l07450"></a>07450         <span class="keywordflow">return</span>;
<a name="l07451"></a>07451 
<a name="l07452"></a>07452     <span class="keywordflow">switch</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>) {
<a name="l07453"></a>07453         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>:
<a name="l07454"></a>07454             <a class="code" href="../../d3/d02/drawobject_8c.html#a6f04e6a68440f263680a333a71236d31">draw_object_mesh_instance</a>(scene, v3d, rv3d, ob, dt, outline);
<a name="l07455"></a>07455             <span class="keywordflow">break</span>;
<a name="l07456"></a>07456         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aae7aa3fbf86ed3619e54240da402fab1">OB_EMPTY</a>:
<a name="l07457"></a>07457             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a7c962f95df9a7a7ccb78c59f1234e35c">empty_drawtype</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a2485dca5bae0f18fd747640883c5123d">OB_EMPTY_IMAGE</a>) {
<a name="l07458"></a>07458                 <a class="code" href="../../d3/d02/drawobject_8c.html#a0005888693bf664cd5d95eef4209f615">draw_empty_image</a>(ob);
<a name="l07459"></a>07459             }
<a name="l07460"></a>07460             <span class="keywordflow">else</span> {
<a name="l07461"></a>07461                 <a class="code" href="../../d3/d02/drawobject_8c.html#a3a22182290000ba6cce2b8d3eb8c3cc3">drawaxes</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a9f106829a25bed222ba018f0d6d4f54a">empty_drawsize</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a7c962f95df9a7a7ccb78c59f1234e35c">empty_drawtype</a>);
<a name="l07462"></a>07462             }
<a name="l07463"></a>07463             <span class="keywordflow">break</span>;
<a name="l07464"></a>07464     }
<a name="l07465"></a>07465 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:15 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

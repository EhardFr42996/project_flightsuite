<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: graph_select.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">graph_select.c</div>  </div>
</div>
<div class="contents">
<a href="../../d3/d19/graph__select_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2008 Blender Foundation</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * Contributor(s): Joshua Leung</span>
<a name="l00021"></a>00021 <span class="comment"> *</span>
<a name="l00022"></a>00022 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00023"></a>00023 <span class="comment"> */</span>
<a name="l00024"></a>00024 
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;float.h&gt;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html">DNA_anim_types.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/da4/DNA__screen__types_8h.html">DNA_screen_types.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d5d/DNA__space__types_8h.html">DNA_space_types.h</a>&quot;</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d68/RNA__define_8h.html">RNA_define.h</a>&quot;</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dba/BKE__fcurve_8h.html">BKE_fcurve.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/de6/BKE__nla_8h.html">BKE_nla.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d63/UI__view2d_8h.html">UI_view2d.h</a>&quot;</span>
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d6f/ED__anim__api_8h.html">ED_anim_api.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html">ED_keyframes_edit.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/da6/ED__markers_8h.html">ED_markers.h</a>&quot;</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d57/graph__intern_8h.html">graph_intern.h</a>&quot;</span>
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="comment">/* ************************************************************************** */</span>
<a name="l00067"></a>00067 <span class="comment">/* KEYFRAMES STUFF */</span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="comment">/* ******************** Deselect All Operator ***************************** */</span>
<a name="l00070"></a>00070 <span class="comment">/* This operator works in one of three ways:</span>
<a name="l00071"></a>00071 <span class="comment"> *  1) (de)select all (AKEY) - test if select all or deselect all</span>
<a name="l00072"></a>00072 <span class="comment"> *  2) invert all (CTRL-IKEY) - invert selection of all keyframes</span>
<a name="l00073"></a>00073 <span class="comment"> *  3) (de)select all - no testing is done; only for use internal tools as normal function...</span>
<a name="l00074"></a>00074 <span class="comment"> */</span>
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="comment">/* Deselects keyframes in the Graph Editor</span>
<a name="l00077"></a>00077 <span class="comment"> *  - This is called by the deselect all operator, as well as other ones!</span>
<a name="l00078"></a>00078 <span class="comment"> *</span>
<a name="l00079"></a>00079 <span class="comment"> *  - test: check if select or deselect all</span>
<a name="l00080"></a>00080 <span class="comment"> *  - sel: how to select keyframes </span>
<a name="l00081"></a>00081 <span class="comment"> *      0 = deselect</span>
<a name="l00082"></a>00082 <span class="comment"> *      1 = select</span>
<a name="l00083"></a>00083 <span class="comment"> *      2 = invert</span>
<a name="l00084"></a>00084 <span class="comment"> *  - do_channels: whether to affect selection status of channels</span>
<a name="l00085"></a>00085 <span class="comment"> */</span>
<a name="l00086"></a><a class="code" href="../../d3/d19/graph__select_8c.html#ae6a15c0c11dddaaaeb80f1203480b66f">00086</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d19/graph__select_8c.html#ae6a15c0c11dddaaaeb80f1203480b66f">deselect_graph_keys</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keywordtype">short</span> test, <span class="keywordtype">short</span> sel, <span class="keywordtype">short</span> do_channels)
<a name="l00087"></a>00087 {
<a name="l00088"></a>00088     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00089"></a>00089     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00090"></a>00090     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00091"></a>00091     
<a name="l00092"></a>00092     <a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *sipo= (<a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *)ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#ace702244f50216d9ca6d1112f6a45c77">sl</a>;
<a name="l00093"></a>00093     <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked= {{<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}};
<a name="l00094"></a>00094     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> test_cb, sel_cb;
<a name="l00095"></a>00095     
<a name="l00096"></a>00096     <span class="comment">/* determine type-based settings */</span>
<a name="l00097"></a>00097     <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a6c5e4b5cf2c3e1b6558850c56dbd490c">ANIMFILTER_CURVE_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00098"></a>00098     
<a name="l00099"></a>00099     <span class="comment">/* filter data */</span>
<a name="l00100"></a>00100     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>, ac-&gt;data, ac-&gt;datatype);
<a name="l00101"></a>00101     
<a name="l00102"></a>00102     <span class="comment">/* init BezTriple looping data */</span>
<a name="l00103"></a>00103     test_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#ad8d50a9387bd9e246565328e381e1026">ANIM_editkeyframes_ok</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a8e98b37d6c08d1ff6782cda85ede7f39aa3a47676c0cdcc866536e24fe737afdb">BEZT_OK_SELECTED</a>);
<a name="l00104"></a>00104     
<a name="l00105"></a>00105     <span class="comment">/* See if we should be selecting or deselecting */</span>
<a name="l00106"></a>00106     <span class="keywordflow">if</span> (test) {
<a name="l00107"></a>00107         <span class="keywordflow">for</span> (ale= anim_data.first; ale; ale= ale-&gt;next) {
<a name="l00108"></a>00108             <span class="keywordflow">if</span> (<a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;key_data, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, test_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {
<a name="l00109"></a>00109                 sel= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804ab7419accdf73227e0606e04a38313ab9">SELECT_SUBTRACT</a>;
<a name="l00110"></a>00110                 <span class="keywordflow">break</span>;
<a name="l00111"></a>00111             }
<a name="l00112"></a>00112         }
<a name="l00113"></a>00113     }
<a name="l00114"></a>00114     
<a name="l00115"></a>00115     <span class="comment">/* convert sel to selectmode, and use that to get editor */</span>
<a name="l00116"></a>00116     sel_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#aa3e4b477e4fa097f19f20000c6ada48c">ANIM_editkeyframes_select</a>(sel);
<a name="l00117"></a>00117     
<a name="l00118"></a>00118     <span class="comment">/* Now set the flags */</span>
<a name="l00119"></a>00119     <span class="keywordflow">for</span> (ale= anim_data.first; ale; ale= ale-&gt;next) {
<a name="l00120"></a>00120         <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu= (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ale-&gt;key_data;
<a name="l00121"></a>00121         
<a name="l00122"></a>00122         <span class="comment">/* Keyframes First */</span>
<a name="l00123"></a>00123         <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;key_data, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, sel_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00124"></a>00124         
<a name="l00125"></a>00125         <span class="comment">/* affect channel selection status? */</span>
<a name="l00126"></a>00126         <span class="keywordflow">if</span> (do_channels) {
<a name="l00127"></a>00127             <span class="comment">/* only change selection of channel when the visibility of keyframes doesn&#39;t depend on this */</span>
<a name="l00128"></a>00128             <span class="keywordflow">if</span> ((sipo-&gt;flag &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a75dbc29df6b2a8b56cdcb84f336ab97f">SIPO_SELCUVERTSONLY</a>) == 0) {
<a name="l00129"></a>00129                 <span class="comment">/* deactivate the F-Curve, and deselect if deselecting keyframes.</span>
<a name="l00130"></a>00130 <span class="comment">                 * otherwise select the F-Curve too since we&#39;ve selected all the keyframes</span>
<a name="l00131"></a>00131 <span class="comment">                 */</span>
<a name="l00132"></a>00132                 <span class="keywordflow">if</span> (sel == <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804ab7419accdf73227e0606e04a38313ab9">SELECT_SUBTRACT</a>) 
<a name="l00133"></a>00133                     fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#ad6eecd82ed24f053525b459881e405ea">flag</a> &amp;= ~<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#ac0aededd6dcdcaa6f2dcf7d0f812e464a663e89ede10f0771e57578f6ec020a8b">FCURVE_SELECTED</a>;
<a name="l00134"></a>00134                 <span class="keywordflow">else</span>
<a name="l00135"></a>00135                     fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#ad6eecd82ed24f053525b459881e405ea">flag</a> |= <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#ac0aededd6dcdcaa6f2dcf7d0f812e464a663e89ede10f0771e57578f6ec020a8b">FCURVE_SELECTED</a>;
<a name="l00136"></a>00136             }
<a name="l00137"></a>00137             
<a name="l00138"></a>00138             <span class="comment">/* always deactivate all F-Curves if we perform batch ops for selection */</span>
<a name="l00139"></a>00139             fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#ad6eecd82ed24f053525b459881e405ea">flag</a> &amp;= ~<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#ac0aededd6dcdcaa6f2dcf7d0f812e464a4dafc6cfdb87097d84384ce770383b66">FCURVE_ACTIVE</a>;
<a name="l00140"></a>00140         }
<a name="l00141"></a>00141     }
<a name="l00142"></a>00142     
<a name="l00143"></a>00143     <span class="comment">/* Cleanup */</span>
<a name="l00144"></a>00144     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00145"></a>00145 }
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 <span class="comment">/* ------------------- */</span>
<a name="l00148"></a>00148 
<a name="l00149"></a><a class="code" href="../../d3/d19/graph__select_8c.html#a9b04d8f1b95646ab60cbd1e17bacf6af">00149</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d19/graph__select_8c.html#a9b04d8f1b95646ab60cbd1e17bacf6af">graphkeys_deselectall_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00150"></a>00150 {
<a name="l00151"></a>00151     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00152"></a>00152     
<a name="l00153"></a>00153     <span class="comment">/* get editor data */</span>
<a name="l00154"></a>00154     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00155"></a>00155         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00156"></a>00156         
<a name="l00157"></a>00157     <span class="comment">/* &#39;standard&#39; behavior - check if selected, then apply relevant selection */</span>
<a name="l00158"></a>00158     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;invert&quot;</span>))
<a name="l00159"></a>00159         <a class="code" href="../../d3/d19/graph__select_8c.html#ae6a15c0c11dddaaaeb80f1203480b66f">deselect_graph_keys</a>(&amp;ac, 0, <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804a162baf509d3532338823464402c56433">SELECT_INVERT</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00160"></a>00160     <span class="keywordflow">else</span>
<a name="l00161"></a>00161         <a class="code" href="../../d3/d19/graph__select_8c.html#ae6a15c0c11dddaaaeb80f1203480b66f">deselect_graph_keys</a>(&amp;ac, 1, <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00162"></a>00162     
<a name="l00163"></a>00163     <span class="comment">/* set notifier that things have changed */</span>
<a name="l00164"></a>00164     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#af783162b06c79f4448366ebc70ec8416">NA_SELECTED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00165"></a>00165     
<a name="l00166"></a>00166     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00167"></a>00167 }
<a name="l00168"></a>00168  
<a name="l00169"></a><a class="code" href="../../d3/d19/graph__select_8c.html#af67e17e3f4508a9bffb22e016d33f75d">00169</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d57/graph__intern_8h.html#aa10e784e865917dc0f78701825ab39b8">GRAPH_OT_select_all_toggle</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00170"></a>00170 {
<a name="l00171"></a>00171     <span class="comment">/* identifiers */</span>
<a name="l00172"></a>00172     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select All&quot;</span>;
<a name="l00173"></a>00173     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;GRAPH_OT_select_all_toggle&quot;</span>;
<a name="l00174"></a>00174     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Toggle selection of all keyframes&quot;</span>;
<a name="l00175"></a>00175     
<a name="l00176"></a>00176     <span class="comment">/* api callbacks */</span>
<a name="l00177"></a>00177     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d19/graph__select_8c.html#a9b04d8f1b95646ab60cbd1e17bacf6af">graphkeys_deselectall_exec</a>;
<a name="l00178"></a>00178     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../df/d57/graph__intern_8h.html#a744a53e563652085fbaff72bbab2eada">graphop_visible_keyframes_poll</a>;
<a name="l00179"></a>00179     
<a name="l00180"></a>00180     <span class="comment">/* flags */</span>
<a name="l00181"></a>00181     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a><span class="comment">/*|OPTYPE_UNDO*/</span>;
<a name="l00182"></a>00182     
<a name="l00183"></a>00183     <span class="comment">/* props */</span>
<a name="l00184"></a>00184     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;invert&quot;</span>, 0, <span class="stringliteral">&quot;Invert&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00185"></a>00185 }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 <span class="comment">/* ******************** Border Select Operator **************************** */</span>
<a name="l00188"></a>00188 <span class="comment">/* This operator currently works in one of three ways:</span>
<a name="l00189"></a>00189 <span class="comment"> *  -&gt; BKEY     - 1) all keyframes within region are selected (validation with BEZT_OK_REGION)</span>
<a name="l00190"></a>00190 <span class="comment"> *  -&gt; ALT-BKEY - depending on which axis of the region was larger...</span>
<a name="l00191"></a>00191 <span class="comment"> *      -&gt; 2) x-axis, so select all frames within frame range (validation with BEZT_OK_FRAMERANGE)</span>
<a name="l00192"></a>00192 <span class="comment"> *      -&gt; 3) y-axis, so select all frames within channels that region included (validation with BEZT_OK_VALUERANGE)</span>
<a name="l00193"></a>00193 <span class="comment"> */</span>
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 <span class="comment">/* Borderselect only selects keyframes now, as overshooting handles often get caught too,</span>
<a name="l00196"></a>00196 <span class="comment"> * which means that they may be inadvertently moved as well. However, incl_handles overrides</span>
<a name="l00197"></a>00197 <span class="comment"> * this, and allow handles to be considered independently too.</span>
<a name="l00198"></a>00198 <span class="comment"> * Also, for convenience, handles should get same status as keyframe (if it was within bounds).</span>
<a name="l00199"></a>00199 <span class="comment"> */</span>
<a name="l00200"></a><a class="code" href="../../d3/d19/graph__select_8c.html#a3906ca213920d5b7ed6df7d5697ece81">00200</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d19/graph__select_8c.html#a3906ca213920d5b7ed6df7d5697ece81">borderselect_graphkeys</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d0/d28/structrcti.html">rcti</a> rect, <span class="keywordtype">short</span> mode, <span class="keywordtype">short</span> selectmode, <span class="keywordtype">short</span> incl_handles)
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00203"></a>00203     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00204"></a>00204     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>, mapping_flag;
<a name="l00205"></a>00205     
<a name="l00206"></a>00206     <a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *sipo= (<a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *)ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#ace702244f50216d9ca6d1112f6a45c77">sl</a>;
<a name="l00207"></a>00207     <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked;
<a name="l00208"></a>00208     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> ok_cb, select_cb;
<a name="l00209"></a>00209     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d= &amp;ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a542e00138258c6836666296f30e0c2c0">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l00210"></a>00210     <a class="code" href="../../da/d10/structrctf.html">rctf</a> rectf;
<a name="l00211"></a>00211     
<a name="l00212"></a>00212     <span class="comment">/* convert mouse coordinates to frame ranges and channel coordinates corrected for view pan/zoom */</span>
<a name="l00213"></a>00213     <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(v2d, rect.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>, rect.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>, &amp;rectf.xmin, &amp;rectf.ymin);
<a name="l00214"></a>00214     <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(v2d, rect.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a>, rect.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a>, &amp;rectf.xmax, &amp;rectf.ymax);
<a name="l00215"></a>00215     
<a name="l00216"></a>00216     <span class="comment">/* filter data */</span>
<a name="l00217"></a>00217     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a6c5e4b5cf2c3e1b6558850c56dbd490c">ANIMFILTER_CURVE_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00218"></a>00218     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00219"></a>00219     
<a name="l00220"></a>00220     <span class="comment">/* get beztriple editing/validation funcs  */</span>
<a name="l00221"></a>00221     select_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#aa3e4b477e4fa097f19f20000c6ada48c">ANIM_editkeyframes_select</a>(selectmode);
<a name="l00222"></a>00222     ok_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#ad8d50a9387bd9e246565328e381e1026">ANIM_editkeyframes_ok</a>(mode);
<a name="l00223"></a>00223     
<a name="l00224"></a>00224     <span class="comment">/* init editing data */</span>
<a name="l00225"></a>00225     memset(&amp;ked, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a>));
<a name="l00226"></a>00226     ked.data= &amp;rectf;
<a name="l00227"></a>00227     
<a name="l00228"></a>00228     <span class="comment">/* treat handles separately? */</span>
<a name="l00229"></a>00229     <span class="keywordflow">if</span> (incl_handles) {
<a name="l00230"></a>00230         ked.iterflags |= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a9e1c008140b5006a231f0665e6272037a89ea7422d97ecfb17b72fdaac253c5a2">KEYFRAME_ITER_INCL_HANDLES</a>;
<a name="l00231"></a>00231         mapping_flag= 0;
<a name="l00232"></a>00232     }
<a name="l00233"></a>00233     <span class="keywordflow">else</span>
<a name="l00234"></a>00234         mapping_flag= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#af8d3a9243f537152cd4a74368ed8646fa4d225778e53bab1cc9ecee1748198b01">ANIM_UNITCONV_ONLYKEYS</a>;
<a name="l00235"></a>00235     
<a name="l00236"></a>00236     <span class="comment">/* loop over data, doing border select */</span>
<a name="l00237"></a>00237     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00238"></a>00238         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../d5/d34/anim__draw_8c.html#a37ad7a1d679ae57a5492066d63bb9c72">ANIM_nla_mapping_get</a>(ac, ale);
<a name="l00239"></a>00239         <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu= (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>;
<a name="l00240"></a>00240         
<a name="l00241"></a>00241         <span class="comment">/* apply unit corrections */</span>
<a name="l00242"></a>00242         <a class="code" href="../../d5/d34/anim__draw_8c.html#a75bfcc3b028bc0b703acd3de0c046c65">ANIM_unit_mapping_apply_fcurve</a>(ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ad2686a20c9c11e9889e3f4d9a60b8b8c">id</a>, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, mapping_flag);
<a name="l00243"></a>00243         
<a name="l00244"></a>00244         <span class="comment">/* apply NLA mapping to all the keyframes, since it&#39;s easier than trying to</span>
<a name="l00245"></a>00245 <span class="comment">         * guess when a callback might use something different</span>
<a name="l00246"></a>00246 <span class="comment">         */</span>
<a name="l00247"></a>00247         <span class="keywordflow">if</span> (adt)
<a name="l00248"></a>00248             <a class="code" href="../../d5/d34/anim__draw_8c.html#af3391f209e37113f866e6bc3d15bcf97">ANIM_nla_mapping_apply_fcurve</a>(adt, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, 0, incl_handles==0);
<a name="l00249"></a>00249         
<a name="l00250"></a>00250         <span class="comment">/* set horizontal range (if applicable) </span>
<a name="l00251"></a>00251 <span class="comment">         * NOTE: these values are only used for x-range and y-range but not region </span>
<a name="l00252"></a>00252 <span class="comment">         *      (which uses ked.data, i.e. rectf)</span>
<a name="l00253"></a>00253 <span class="comment">         */</span>
<a name="l00254"></a>00254         <span class="keywordflow">if</span> (mode != <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a8e98b37d6c08d1ff6782cda85ede7f39a9d5dccb95515d359d186bf514938cf14">BEZT_OK_VALUERANGE</a>) {
<a name="l00255"></a>00255             ked.f1= rectf.xmin;
<a name="l00256"></a>00256             ked.f2= rectf.xmax;
<a name="l00257"></a>00257         }
<a name="l00258"></a>00258         <span class="keywordflow">else</span> {
<a name="l00259"></a>00259             ked.f1= rectf.ymin;
<a name="l00260"></a>00260             ked.f2= rectf.ymax;
<a name="l00261"></a>00261         }
<a name="l00262"></a>00262         
<a name="l00263"></a>00263         <span class="comment">/* firstly, check if any keyframes will be hit by this */</span>
<a name="l00264"></a>00264         <span class="keywordflow">if</span> (<a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, fcu, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ok_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {
<a name="l00265"></a>00265             <span class="comment">/* select keyframes that are in the appropriate places */</span>
<a name="l00266"></a>00266             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, fcu, ok_cb, select_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00267"></a>00267             
<a name="l00268"></a>00268             <span class="comment">/* only change selection of channel when the visibility of keyframes doesn&#39;t depend on this */</span>
<a name="l00269"></a>00269             <span class="keywordflow">if</span> ((sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#afb3a36cb2d2bf16fbe5787baa810e4ea">flag</a> &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a75dbc29df6b2a8b56cdcb84f336ab97f">SIPO_SELCUVERTSONLY</a>) == 0) {
<a name="l00270"></a>00270                 <span class="comment">/* select the curve too now that curve will be touched */</span>
<a name="l00271"></a>00271                 <span class="keywordflow">if</span> (selectmode == <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>)
<a name="l00272"></a>00272                     fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#ad6eecd82ed24f053525b459881e405ea">flag</a> |= <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#ac0aededd6dcdcaa6f2dcf7d0f812e464a663e89ede10f0771e57578f6ec020a8b">FCURVE_SELECTED</a>;
<a name="l00273"></a>00273             }
<a name="l00274"></a>00274         }
<a name="l00275"></a>00275         
<a name="l00276"></a>00276         <span class="comment">/* un-apply NLA mapping from all the keyframes */</span>
<a name="l00277"></a>00277         <span class="keywordflow">if</span> (adt)
<a name="l00278"></a>00278             <a class="code" href="../../d5/d34/anim__draw_8c.html#af3391f209e37113f866e6bc3d15bcf97">ANIM_nla_mapping_apply_fcurve</a>(adt, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, 1, incl_handles==0);
<a name="l00279"></a>00279             
<a name="l00280"></a>00280         <span class="comment">/* unapply unit corrections */</span>
<a name="l00281"></a>00281         <a class="code" href="../../d5/d34/anim__draw_8c.html#a75bfcc3b028bc0b703acd3de0c046c65">ANIM_unit_mapping_apply_fcurve</a>(ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ad2686a20c9c11e9889e3f4d9a60b8b8c">id</a>, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#af8d3a9243f537152cd4a74368ed8646faebcc08454a0e723f7e0b2765c4762af0">ANIM_UNITCONV_RESTORE</a>|mapping_flag);
<a name="l00282"></a>00282     }
<a name="l00283"></a>00283     
<a name="l00284"></a>00284     <span class="comment">/* cleanup */</span>
<a name="l00285"></a>00285     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00286"></a>00286 }
<a name="l00287"></a>00287 
<a name="l00288"></a>00288 <span class="comment">/* ------------------- */</span>
<a name="l00289"></a>00289 
<a name="l00290"></a><a class="code" href="../../d3/d19/graph__select_8c.html#a2a610c1891927e0f77b0c39e07445ed1">00290</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d19/graph__select_8c.html#a2a610c1891927e0f77b0c39e07445ed1">graphkeys_borderselect_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00291"></a>00291 {
<a name="l00292"></a>00292     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00293"></a>00293     <a class="code" href="../../d0/d28/structrcti.html">rcti</a> rect;
<a name="l00294"></a>00294     <span class="keywordtype">short</span> mode=0, selectmode=0;
<a name="l00295"></a>00295     <span class="keywordtype">short</span> incl_handles;
<a name="l00296"></a>00296     <span class="keywordtype">int</span> extend;
<a name="l00297"></a>00297     
<a name="l00298"></a>00298     <span class="comment">/* get editor data */</span>
<a name="l00299"></a>00299     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00300"></a>00300         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00301"></a>00301 
<a name="l00302"></a>00302     <span class="comment">/* clear all selection if not extending selection */</span>
<a name="l00303"></a>00303     extend= <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;extend&quot;</span>);
<a name="l00304"></a>00304     <span class="keywordflow">if</span> (!extend)
<a name="l00305"></a>00305         <a class="code" href="../../d3/d19/graph__select_8c.html#ae6a15c0c11dddaaaeb80f1203480b66f">deselect_graph_keys</a>(&amp;ac, 1, <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804ab7419accdf73227e0606e04a38313ab9">SELECT_SUBTRACT</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00306"></a>00306 
<a name="l00307"></a>00307     <span class="comment">/* get select mode </span>
<a name="l00308"></a>00308 <span class="comment">     *  - &#39;gesture_mode&#39; from the operator specifies how to select</span>
<a name="l00309"></a>00309 <span class="comment">     *  - &#39;include_handles&#39; from the operator specifies whether to include handles in the selection</span>
<a name="l00310"></a>00310 <span class="comment">     */</span>
<a name="l00311"></a>00311     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;gesture_mode&quot;</span>)==<a class="code" href="../../d1/d40/wm__event__types_8h.html#a99328936c1f7e4fc8d4a889098d4d22d">GESTURE_MODAL_SELECT</a>)
<a name="l00312"></a>00312         selectmode= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>;
<a name="l00313"></a>00313     <span class="keywordflow">else</span>
<a name="l00314"></a>00314         selectmode= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804ab7419accdf73227e0606e04a38313ab9">SELECT_SUBTRACT</a>;
<a name="l00315"></a>00315         
<a name="l00316"></a>00316     incl_handles = <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;include_handles&quot;</span>);
<a name="l00317"></a>00317     
<a name="l00318"></a>00318     <span class="comment">/* get settings from operator */</span>
<a name="l00319"></a>00319     rect.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> = <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;xmin&quot;</span>);
<a name="l00320"></a>00320     rect.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> = <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;ymin&quot;</span>);
<a name="l00321"></a>00321     rect.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> = <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;xmax&quot;</span>);
<a name="l00322"></a>00322     rect.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> = <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;ymax&quot;</span>);
<a name="l00323"></a>00323     
<a name="l00324"></a>00324     <span class="comment">/* selection &#39;mode&#39; depends on whether borderselect region only matters on one axis */</span>
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;axis_range&quot;</span>)) {
<a name="l00326"></a>00326         <span class="comment">/* mode depends on which axis of the range is larger to determine which axis to use </span>
<a name="l00327"></a>00327 <span class="comment">         *  - checking this in region-space is fine, as it&#39;s fundamentally still going to be a different rect size</span>
<a name="l00328"></a>00328 <span class="comment">         *  - the frame-range select option is favored over the channel one (x over y), as frame-range one is often</span>
<a name="l00329"></a>00329 <span class="comment">         *    used for tweaking timing when &quot;blocking&quot;, while channels is not that useful...</span>
<a name="l00330"></a>00330 <span class="comment">         */</span>
<a name="l00331"></a>00331         <span class="keywordflow">if</span> ((rect.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> - rect.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>) &gt;= (rect.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> - rect.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>))
<a name="l00332"></a>00332             mode= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a8e98b37d6c08d1ff6782cda85ede7f39a2cb87e66a2560d4e0d141bbb4dddd837">BEZT_OK_FRAMERANGE</a>;
<a name="l00333"></a>00333         <span class="keywordflow">else</span>
<a name="l00334"></a>00334             mode= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a8e98b37d6c08d1ff6782cda85ede7f39a9d5dccb95515d359d186bf514938cf14">BEZT_OK_VALUERANGE</a>;
<a name="l00335"></a>00335     }
<a name="l00336"></a>00336     <span class="keywordflow">else</span> 
<a name="l00337"></a>00337         mode= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a8e98b37d6c08d1ff6782cda85ede7f39ae409d5673da844a7819ae2fb741b2114">BEZT_OK_REGION</a>;
<a name="l00338"></a>00338     
<a name="l00339"></a>00339     <span class="comment">/* apply borderselect action */</span>
<a name="l00340"></a>00340     <a class="code" href="../../d3/d19/graph__select_8c.html#a3906ca213920d5b7ed6df7d5697ece81">borderselect_graphkeys</a>(&amp;ac, rect, mode, selectmode, incl_handles);
<a name="l00341"></a>00341     
<a name="l00342"></a>00342     <span class="comment">/* send notifier that keyframe selection has changed */</span>
<a name="l00343"></a>00343     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#af783162b06c79f4448366ebc70ec8416">NA_SELECTED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00344"></a>00344     
<a name="l00345"></a>00345     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00346"></a>00346 } 
<a name="l00347"></a>00347 
<a name="l00348"></a><a class="code" href="../../d3/d19/graph__select_8c.html#a0171eae021dd70091ba1ffd946dbfa45">00348</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d57/graph__intern_8h.html#abc941a30bc8b917a3bed24be5f081dd6">GRAPH_OT_select_border</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00349"></a>00349 {
<a name="l00350"></a>00350     <span class="comment">/* identifiers */</span>
<a name="l00351"></a>00351     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Border Select&quot;</span>;
<a name="l00352"></a>00352     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;GRAPH_OT_select_border&quot;</span>;
<a name="l00353"></a>00353     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Select all keyframes within the specified region&quot;</span>;
<a name="l00354"></a>00354     
<a name="l00355"></a>00355     <span class="comment">/* api callbacks */</span>
<a name="l00356"></a>00356     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a8d45022b7baa1add659b6798c15601b1">WM_border_select_invoke</a>;
<a name="l00357"></a>00357     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d19/graph__select_8c.html#a2a610c1891927e0f77b0c39e07445ed1">graphkeys_borderselect_exec</a>;
<a name="l00358"></a>00358     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#ab6bb53ebc07c5ca59c0a1a687124de2b">WM_border_select_modal</a>;
<a name="l00359"></a>00359     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a30c4cae4bcb919d6519d9a1b5b77cdb0">WM_border_select_cancel</a>;
<a name="l00360"></a>00360     
<a name="l00361"></a>00361     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../df/d57/graph__intern_8h.html#a744a53e563652085fbaff72bbab2eada">graphop_visible_keyframes_poll</a>;
<a name="l00362"></a>00362     
<a name="l00363"></a>00363     <span class="comment">/* flags */</span>
<a name="l00364"></a>00364     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a><span class="comment">/*|OPTYPE_UNDO*/</span>;
<a name="l00365"></a>00365     
<a name="l00366"></a>00366     <span class="comment">/* rna */</span>
<a name="l00367"></a>00367     <a class="code" href="../../d6/dae/wm__operators_8c.html#a7df9a6eccb78facfa397098a5ad2bc4a">WM_operator_properties_gesture_border</a>(ot, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00368"></a>00368     
<a name="l00369"></a>00369     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;axis_range&quot;</span>, 0, <span class="stringliteral">&quot;Axis Range&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00370"></a>00370     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;include_handles&quot;</span>, 0, <span class="stringliteral">&quot;Include Handles&quot;</span>, <span class="stringliteral">&quot;Are handles tested individually against the selection criteria&quot;</span>);
<a name="l00371"></a>00371 }
<a name="l00372"></a>00372 
<a name="l00373"></a>00373 <span class="comment">/* ******************** Column Select Operator **************************** */</span>
<a name="l00374"></a>00374 <span class="comment">/* This operator works in one of four ways:</span>
<a name="l00375"></a>00375 <span class="comment"> *  - 1) select all keyframes in the same frame as a selected one  (KKEY)</span>
<a name="l00376"></a>00376 <span class="comment"> *  - 2) select all keyframes in the same frame as the current frame marker (CTRL-KKEY)</span>
<a name="l00377"></a>00377 <span class="comment"> *  - 3) select all keyframes in the same frame as a selected markers (SHIFT-KKEY)</span>
<a name="l00378"></a>00378 <span class="comment"> *  - 4) select all keyframes that occur between selected markers (ALT-KKEY)</span>
<a name="l00379"></a>00379 <span class="comment"> */</span>
<a name="l00380"></a>00380 
<a name="l00381"></a>00381 <span class="comment">/* defines for column-select mode */</span>
<a name="l00382"></a><a class="code" href="../../d3/d19/graph__select_8c.html#a8b1e5a19115dfa70e4d1f851567781e8">00382</a> <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> <a class="code" href="../../d3/d19/graph__select_8c.html#a8b1e5a19115dfa70e4d1f851567781e8">prop_column_select_types</a>[] = {
<a name="l00383"></a>00383     {<a class="code" href="../../df/d57/graph__intern_8h.html#a2f1398dba5e4a5616b83437528bdb28ea7df8c9108a2412ff5218835a690fd8b6">GRAPHKEYS_COLUMNSEL_KEYS</a>, <span class="stringliteral">&quot;KEYS&quot;</span>, 0, <span class="stringliteral">&quot;On Selected Keyframes&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00384"></a>00384     {<a class="code" href="../../df/d57/graph__intern_8h.html#a2f1398dba5e4a5616b83437528bdb28eaf74fbfc35fc78da9407fdbb8141bd9cd">GRAPHKEYS_COLUMNSEL_CFRA</a>, <span class="stringliteral">&quot;CFRA&quot;</span>, 0, <span class="stringliteral">&quot;On Current Frame&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00385"></a>00385     {<a class="code" href="../../df/d57/graph__intern_8h.html#a2f1398dba5e4a5616b83437528bdb28ea9fdea6406e09eef3ca919bd3657706aa">GRAPHKEYS_COLUMNSEL_MARKERS_COLUMN</a>, <span class="stringliteral">&quot;MARKERS_COLUMN&quot;</span>, 0, <span class="stringliteral">&quot;On Selected Markers&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00386"></a>00386     {<a class="code" href="../../df/d57/graph__intern_8h.html#a2f1398dba5e4a5616b83437528bdb28ea468ef7b85b9e8f7c83f60e6ab800f178">GRAPHKEYS_COLUMNSEL_MARKERS_BETWEEN</a>, <span class="stringliteral">&quot;MARKERS_BETWEEN&quot;</span>, 0, <span class="stringliteral">&quot;Between Min/Max Selected Markers&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00387"></a>00387     {0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL}
<a name="l00388"></a>00388 };
<a name="l00389"></a>00389 
<a name="l00390"></a>00390 <span class="comment">/* ------------------- */</span> 
<a name="l00391"></a>00391 
<a name="l00392"></a>00392 <span class="comment">/* Selects all visible keyframes between the specified markers */</span>
<a name="l00393"></a>00393 <span class="comment">/* TODO, this is almost an _exact_ duplicate of a function of the same name in action_select.c</span>
<a name="l00394"></a>00394 <span class="comment"> * should de-duplicate - campbell */</span>
<a name="l00395"></a><a class="code" href="../../d3/d19/graph__select_8c.html#ab35639eb4ba5466732f49e6079f19584">00395</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d19/graph__select_8c.html#ab35639eb4ba5466732f49e6079f19584">markers_selectkeys_between</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac)
<a name="l00396"></a>00396 {
<a name="l00397"></a>00397     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00398"></a>00398     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00399"></a>00399     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00400"></a>00400     
<a name="l00401"></a>00401     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> ok_cb, select_cb;
<a name="l00402"></a>00402     <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked= {{<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}};
<a name="l00403"></a>00403     <span class="keywordtype">float</span> <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>, <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>;
<a name="l00404"></a>00404     
<a name="l00405"></a>00405     <span class="comment">/* get extreme markers */</span>
<a name="l00406"></a>00406     <a class="code" href="../../df/d12/anim__markers_8c.html#a7cb68faae882cb7e57da326dc69530e4">ED_markers_get_minmax</a>(ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a1b0dda891e001c9cff1ffeb3c4032673">markers</a>, 1, &amp;min, &amp;max);
<a name="l00407"></a>00407     min -= 0.5f;
<a name="l00408"></a>00408     max += 0.5f;
<a name="l00409"></a>00409     
<a name="l00410"></a>00410     <span class="comment">/* get editing funcs + data */</span>
<a name="l00411"></a>00411     ok_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#ad8d50a9387bd9e246565328e381e1026">ANIM_editkeyframes_ok</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a8e98b37d6c08d1ff6782cda85ede7f39a2cb87e66a2560d4e0d141bbb4dddd837">BEZT_OK_FRAMERANGE</a>);
<a name="l00412"></a>00412     select_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#aa3e4b477e4fa097f19f20000c6ada48c">ANIM_editkeyframes_select</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>);
<a name="l00413"></a>00413 
<a name="l00414"></a>00414     ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1444ccfbecc1ce0317e003838ccc261d">f1</a>= <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>;
<a name="l00415"></a>00415     ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1bb18ae755c595cc9b7d45e49fd6666a">f2</a>= <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>;
<a name="l00416"></a>00416     
<a name="l00417"></a>00417     <span class="comment">/* filter data */</span>
<a name="l00418"></a>00418     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a6c5e4b5cf2c3e1b6558850c56dbd490c">ANIMFILTER_CURVE_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00419"></a>00419     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00420"></a>00420     
<a name="l00421"></a>00421     <span class="comment">/* select keys in-between */</span>
<a name="l00422"></a>00422     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00423"></a>00423         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../d5/d34/anim__draw_8c.html#a37ad7a1d679ae57a5492066d63bb9c72">ANIM_nla_mapping_get</a>(ac, ale);
<a name="l00424"></a>00424 
<a name="l00425"></a>00425         <span class="keywordflow">if</span> (adt) {
<a name="l00426"></a>00426             <a class="code" href="../../d5/d34/anim__draw_8c.html#af3391f209e37113f866e6bc3d15bcf97">ANIM_nla_mapping_apply_fcurve</a>(adt, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, 0, 1);
<a name="l00427"></a>00427             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, ok_cb, select_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00428"></a>00428             <a class="code" href="../../d5/d34/anim__draw_8c.html#af3391f209e37113f866e6bc3d15bcf97">ANIM_nla_mapping_apply_fcurve</a>(adt, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, 1, 1);
<a name="l00429"></a>00429         }
<a name="l00430"></a>00430         <span class="keywordflow">else</span> {
<a name="l00431"></a>00431             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, ok_cb, select_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00432"></a>00432         }
<a name="l00433"></a>00433     }
<a name="l00434"></a>00434     
<a name="l00435"></a>00435     <span class="comment">/* Cleanup */</span>
<a name="l00436"></a>00436     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00437"></a>00437 }
<a name="l00438"></a>00438 
<a name="l00439"></a>00439 
<a name="l00440"></a>00440 <span class="comment">/* Selects all visible keyframes in the same frames as the specified elements */</span>
<a name="l00441"></a><a class="code" href="../../d3/d19/graph__select_8c.html#af71cb41952afd91fcb122a17568db215">00441</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d19/graph__select_8c.html#af71cb41952afd91fcb122a17568db215">columnselect_graph_keys</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keywordtype">short</span> mode)
<a name="l00442"></a>00442 {
<a name="l00443"></a>00443     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00444"></a>00444     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00445"></a>00445     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00446"></a>00446     
<a name="l00447"></a>00447     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l00448"></a>00448     <a class="code" href="../../db/d00/structCfraElem.html">CfraElem</a> *ce;
<a name="l00449"></a>00449     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> select_cb, ok_cb;
<a name="l00450"></a>00450     <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked;
<a name="l00451"></a>00451     
<a name="l00452"></a>00452     <span class="comment">/* initialize keyframe editing data */</span>
<a name="l00453"></a>00453     memset(&amp;ked, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a>));
<a name="l00454"></a>00454     
<a name="l00455"></a>00455     <span class="comment">/* build list of columns */</span>
<a name="l00456"></a>00456     <span class="keywordflow">switch</span> (mode) {
<a name="l00457"></a>00457         <span class="keywordflow">case</span> <a class="code" href="../../df/d57/graph__intern_8h.html#a2f1398dba5e4a5616b83437528bdb28ea7df8c9108a2412ff5218835a690fd8b6">GRAPHKEYS_COLUMNSEL_KEYS</a>: <span class="comment">/* list of selected keys */</span>
<a name="l00458"></a>00458             filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a6c5e4b5cf2c3e1b6558850c56dbd490c">ANIMFILTER_CURVE_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00459"></a>00459             <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00460"></a>00460             
<a name="l00461"></a>00461             <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>)
<a name="l00462"></a>00462                 <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/d71/keyframes__edit_8c.html#ab01a4640feb02d522fa94fe1b06328cb">bezt_to_cfraelem</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00463"></a>00463             
<a name="l00464"></a>00464             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00465"></a>00465             <span class="keywordflow">break</span>;
<a name="l00466"></a>00466             
<a name="l00467"></a>00467         <span class="keywordflow">case</span> <a class="code" href="../../df/d57/graph__intern_8h.html#a2f1398dba5e4a5616b83437528bdb28eaf74fbfc35fc78da9407fdbb8141bd9cd">GRAPHKEYS_COLUMNSEL_CFRA</a>: <span class="comment">/* current frame */</span>
<a name="l00468"></a>00468             <span class="comment">/* make a single CfraElem for storing this */</span>
<a name="l00469"></a>00469             ce= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../db/d00/structCfraElem.html">CfraElem</a>), <span class="stringliteral">&quot;cfraElem&quot;</span>);
<a name="l00470"></a>00470             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a2348e0effff022a6ba66371076556163">list</a>, ce);
<a name="l00471"></a>00471             
<a name="l00472"></a>00472             ce-&gt;<a class="code" href="../../db/d00/structCfraElem.html#a021a2c83db7f2b1bfc3b9d425e646522">cfra</a>= (float)<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a>;
<a name="l00473"></a>00473             <span class="keywordflow">break</span>;
<a name="l00474"></a>00474             
<a name="l00475"></a>00475         <span class="keywordflow">case</span> <a class="code" href="../../df/d57/graph__intern_8h.html#a2f1398dba5e4a5616b83437528bdb28ea9fdea6406e09eef3ca919bd3657706aa">GRAPHKEYS_COLUMNSEL_MARKERS_COLUMN</a>: <span class="comment">/* list of selected markers */</span>
<a name="l00476"></a>00476             <a class="code" href="../../df/d12/anim__markers_8c.html#a1d5d03257253a65f19e588ffe3b22036">ED_markers_make_cfra_list</a>(ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a1b0dda891e001c9cff1ffeb3c4032673">markers</a>, &amp;ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a2348e0effff022a6ba66371076556163">list</a>, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>);
<a name="l00477"></a>00477             <span class="keywordflow">break</span>;
<a name="l00478"></a>00478             
<a name="l00479"></a>00479         <span class="keywordflow">default</span>: <span class="comment">/* invalid option */</span>
<a name="l00480"></a>00480             <span class="keywordflow">return</span>;
<a name="l00481"></a>00481     }
<a name="l00482"></a>00482     
<a name="l00483"></a>00483     <span class="comment">/* set up BezTriple edit callbacks */</span>
<a name="l00484"></a>00484     select_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#aa3e4b477e4fa097f19f20000c6ada48c">ANIM_editkeyframes_select</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>);
<a name="l00485"></a>00485     ok_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#ad8d50a9387bd9e246565328e381e1026">ANIM_editkeyframes_ok</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a8e98b37d6c08d1ff6782cda85ede7f39a4a09064815ad73e482e1293530e146cd">BEZT_OK_FRAME</a>);
<a name="l00486"></a>00486     
<a name="l00487"></a>00487     <span class="comment">/* loop through all of the keys and select additional keyframes</span>
<a name="l00488"></a>00488 <span class="comment">     * based on the keys found to be selected above</span>
<a name="l00489"></a>00489 <span class="comment">     */</span>
<a name="l00490"></a>00490     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a6c5e4b5cf2c3e1b6558850c56dbd490c">ANIMFILTER_CURVE_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00491"></a>00491     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00492"></a>00492     
<a name="l00493"></a>00493     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00494"></a>00494         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../d5/d34/anim__draw_8c.html#a37ad7a1d679ae57a5492066d63bb9c72">ANIM_nla_mapping_get</a>(ac, ale);
<a name="l00495"></a>00495         
<a name="l00496"></a>00496         <span class="comment">/* loop over cfraelems (stored in the KeyframeEditData-&gt;list)</span>
<a name="l00497"></a>00497 <span class="comment">         *  - we need to do this here, as we can apply fewer NLA-mapping conversions</span>
<a name="l00498"></a>00498 <span class="comment">         */</span>
<a name="l00499"></a>00499         <span class="keywordflow">for</span> (ce= ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a2348e0effff022a6ba66371076556163">list</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ce; ce= ce-&gt;<a class="code" href="../../db/d00/structCfraElem.html#ab87202e5ec809b32216d4c8f5f2cde42">next</a>) {
<a name="l00500"></a>00500             <span class="comment">/* set frame for validation callback to refer to */</span>
<a name="l00501"></a>00501             ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1444ccfbecc1ce0317e003838ccc261d">f1</a>= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab4ae36c08ea78520b80d5d517ac20da4">BKE_nla_tweakedit_remap</a>(adt, ce-&gt;<a class="code" href="../../db/d00/structCfraElem.html#a021a2c83db7f2b1bfc3b9d425e646522">cfra</a>, <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035dad6f4c7caaf2b3ab5e648419d521cfc9e">NLATIME_CONVERT_UNMAP</a>);
<a name="l00502"></a>00502 
<a name="l00503"></a>00503             <span class="comment">/* select elements with frame number matching cfraelem */</span>
<a name="l00504"></a>00504             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, ok_cb, select_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00505"></a>00505         }
<a name="l00506"></a>00506     }
<a name="l00507"></a>00507     
<a name="l00508"></a>00508     <span class="comment">/* free elements */</span>
<a name="l00509"></a>00509     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a2348e0effff022a6ba66371076556163">list</a>);
<a name="l00510"></a>00510     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00511"></a>00511 }
<a name="l00512"></a>00512 
<a name="l00513"></a>00513 <span class="comment">/* ------------------- */</span>
<a name="l00514"></a>00514 
<a name="l00515"></a><a class="code" href="../../d3/d19/graph__select_8c.html#af927224cebb7ad295e7523867bed4697">00515</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d19/graph__select_8c.html#af927224cebb7ad295e7523867bed4697">graphkeys_columnselect_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00516"></a>00516 {
<a name="l00517"></a>00517     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00518"></a>00518     <span class="keywordtype">short</span> mode;
<a name="l00519"></a>00519     
<a name="l00520"></a>00520     <span class="comment">/* get editor data */</span>
<a name="l00521"></a>00521     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00522"></a>00522         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00523"></a>00523         
<a name="l00524"></a>00524     <span class="comment">/* action to take depends on the mode */</span>
<a name="l00525"></a>00525     mode= <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;mode&quot;</span>);
<a name="l00526"></a>00526     
<a name="l00527"></a>00527     <span class="keywordflow">if</span> (mode == <a class="code" href="../../df/d57/graph__intern_8h.html#a2f1398dba5e4a5616b83437528bdb28ea468ef7b85b9e8f7c83f60e6ab800f178">GRAPHKEYS_COLUMNSEL_MARKERS_BETWEEN</a>)
<a name="l00528"></a>00528         <a class="code" href="../../d3/d19/graph__select_8c.html#ab35639eb4ba5466732f49e6079f19584">markers_selectkeys_between</a>(&amp;ac);
<a name="l00529"></a>00529     <span class="keywordflow">else</span>
<a name="l00530"></a>00530         <a class="code" href="../../d3/d19/graph__select_8c.html#af71cb41952afd91fcb122a17568db215">columnselect_graph_keys</a>(&amp;ac, mode);
<a name="l00531"></a>00531     
<a name="l00532"></a>00532     <span class="comment">/* set notifier that keyframe selection has changed */</span>
<a name="l00533"></a>00533     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#af783162b06c79f4448366ebc70ec8416">NA_SELECTED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00534"></a>00534     
<a name="l00535"></a>00535     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00536"></a>00536 }
<a name="l00537"></a>00537  
<a name="l00538"></a><a class="code" href="../../d3/d19/graph__select_8c.html#a251e08f0e79a5559422853e1d853d504">00538</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d57/graph__intern_8h.html#a18c0ef60e24eeecfe3f6e1b789ded683">GRAPH_OT_select_column</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00539"></a>00539 {
<a name="l00540"></a>00540     <span class="comment">/* identifiers */</span>
<a name="l00541"></a>00541     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select All&quot;</span>;
<a name="l00542"></a>00542     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;GRAPH_OT_select_column&quot;</span>;
<a name="l00543"></a>00543     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Select all keyframes on the specified frame(s)&quot;</span>;
<a name="l00544"></a>00544     
<a name="l00545"></a>00545     <span class="comment">/* api callbacks */</span>
<a name="l00546"></a>00546     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d19/graph__select_8c.html#af927224cebb7ad295e7523867bed4697">graphkeys_columnselect_exec</a>;
<a name="l00547"></a>00547     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../df/d57/graph__intern_8h.html#a744a53e563652085fbaff72bbab2eada">graphop_visible_keyframes_poll</a>;
<a name="l00548"></a>00548     
<a name="l00549"></a>00549     <span class="comment">/* flags */</span>
<a name="l00550"></a>00550     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a><span class="comment">/*|OPTYPE_UNDO*/</span>;
<a name="l00551"></a>00551     
<a name="l00552"></a>00552     <span class="comment">/* props */</span>
<a name="l00553"></a>00553     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;mode&quot;</span>, prop_column_select_types, 0, <span class="stringliteral">&quot;Mode&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00554"></a>00554 }
<a name="l00555"></a>00555 
<a name="l00556"></a>00556 <span class="comment">/* ******************** Select Linked Operator *********************** */</span>
<a name="l00557"></a>00557 
<a name="l00558"></a><a class="code" href="../../d3/d19/graph__select_8c.html#aa05742d0dc343c4b1ec2f413506d189a">00558</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d19/graph__select_8c.html#aa05742d0dc343c4b1ec2f413506d189a">graphkeys_select_linked_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00559"></a>00559 {
<a name="l00560"></a>00560     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00561"></a>00561     
<a name="l00562"></a>00562     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00563"></a>00563     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00564"></a>00564     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00565"></a>00565     
<a name="l00566"></a>00566     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> ok_cb = <a class="code" href="../../db/d71/keyframes__edit_8c.html#ad8d50a9387bd9e246565328e381e1026">ANIM_editkeyframes_ok</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a8e98b37d6c08d1ff6782cda85ede7f39aa3a47676c0cdcc866536e24fe737afdb">BEZT_OK_SELECTED</a>);
<a name="l00567"></a>00567     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> sel_cb = <a class="code" href="../../db/d71/keyframes__edit_8c.html#aa3e4b477e4fa097f19f20000c6ada48c">ANIM_editkeyframes_select</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>);
<a name="l00568"></a>00568     
<a name="l00569"></a>00569     <span class="comment">/* get editor data */</span>
<a name="l00570"></a>00570     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00571"></a>00571         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00572"></a>00572     
<a name="l00573"></a>00573     <span class="comment">/* loop through all of the keys and select additional keyframes based on these */</span>
<a name="l00574"></a>00574     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a6c5e4b5cf2c3e1b6558850c56dbd490c">ANIMFILTER_CURVE_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00575"></a>00575     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00576"></a>00576     
<a name="l00577"></a>00577     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00578"></a>00578         <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu= (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>;
<a name="l00579"></a>00579         
<a name="l00580"></a>00580         <span class="comment">/* check if anything selected? */</span>
<a name="l00581"></a>00581         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (<a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, fcu, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ok_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {
<a name="l00582"></a>00582             <span class="comment">/* select every keyframe in this curve then */</span>
<a name="l00583"></a>00583             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, fcu, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, sel_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00584"></a>00584         }
<a name="l00585"></a>00585     }
<a name="l00586"></a>00586     
<a name="l00587"></a>00587     <span class="comment">/* Cleanup */</span>
<a name="l00588"></a>00588     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00589"></a>00589     
<a name="l00590"></a>00590     <span class="comment">/* set notifier that keyframe selection has changed */</span>
<a name="l00591"></a>00591     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#af783162b06c79f4448366ebc70ec8416">NA_SELECTED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00592"></a>00592     
<a name="l00593"></a>00593     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00594"></a>00594 }
<a name="l00595"></a>00595 
<a name="l00596"></a><a class="code" href="../../d3/d19/graph__select_8c.html#aa91ac56139a03e96d44b49da81e30bc4">00596</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d57/graph__intern_8h.html#a045f3890065a0de93899cc7c5179c08a">GRAPH_OT_select_linked</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00597"></a>00597 {
<a name="l00598"></a>00598     <span class="comment">/* identifiers */</span>
<a name="l00599"></a>00599     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select Linked&quot;</span>;
<a name="l00600"></a>00600     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;GRAPH_OT_select_linked&quot;</span>;
<a name="l00601"></a>00601     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Select keyframes occurring in the same F-Curves as selected ones&quot;</span>;
<a name="l00602"></a>00602     
<a name="l00603"></a>00603     <span class="comment">/* api callbacks */</span>
<a name="l00604"></a>00604     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d19/graph__select_8c.html#aa05742d0dc343c4b1ec2f413506d189a">graphkeys_select_linked_exec</a>;
<a name="l00605"></a>00605     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../df/d57/graph__intern_8h.html#a744a53e563652085fbaff72bbab2eada">graphop_visible_keyframes_poll</a>;
<a name="l00606"></a>00606     
<a name="l00607"></a>00607     <span class="comment">/* flags */</span>
<a name="l00608"></a>00608     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a><span class="comment">/*|OPTYPE_UNDO*/</span>;
<a name="l00609"></a>00609 }
<a name="l00610"></a>00610 
<a name="l00611"></a>00611 <span class="comment">/* ******************** Select More/Less Operators *********************** */</span>
<a name="l00612"></a>00612 
<a name="l00613"></a>00613 <span class="comment">/* Common code to perform selection */</span>
<a name="l00614"></a><a class="code" href="../../d3/d19/graph__select_8c.html#ae393f6aec5433d0677d2512892a3fe16">00614</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d19/graph__select_8c.html#ae393f6aec5433d0677d2512892a3fe16">select_moreless_graph_keys</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keywordtype">short</span> mode)
<a name="l00615"></a>00615 {
<a name="l00616"></a>00616     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00617"></a>00617     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00618"></a>00618     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00619"></a>00619     
<a name="l00620"></a>00620     <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked;
<a name="l00621"></a>00621     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> build_cb;
<a name="l00622"></a>00622     
<a name="l00623"></a>00623     
<a name="l00624"></a>00624     <span class="comment">/* init selmap building data */</span>
<a name="l00625"></a>00625     build_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#ab471bd100d29dc73ad9a9756de7d8575">ANIM_editkeyframes_buildselmap</a>(mode);
<a name="l00626"></a>00626     memset(&amp;ked, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a>)); 
<a name="l00627"></a>00627     
<a name="l00628"></a>00628     <span class="comment">/* loop through all of the keys and select additional keyframes based on these */</span>
<a name="l00629"></a>00629     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a6c5e4b5cf2c3e1b6558850c56dbd490c">ANIMFILTER_CURVE_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00630"></a>00630     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00631"></a>00631     
<a name="l00632"></a>00632     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00633"></a>00633         <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu= (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>;
<a name="l00634"></a>00634         
<a name="l00635"></a>00635         <span class="comment">/* only continue if F-Curve has keyframes */</span>
<a name="l00636"></a>00636         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a799ab2725f85e5ee19e9ef88a8d6b006">bezt</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00637"></a>00637             <span class="keywordflow">continue</span>;
<a name="l00638"></a>00638         
<a name="l00639"></a>00639         <span class="comment">/* build up map of whether F-Curve&#39;s keyframes should be selected or not */</span>
<a name="l00640"></a>00640         ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a501b1376c86503e0138fcd41e59df925">data</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#adec915e7ed4f2b66b12313566bf5c33f">totvert</a>, <span class="stringliteral">&quot;selmap graphEdit&quot;</span>);
<a name="l00641"></a>00641         <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, fcu, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, build_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00642"></a>00642         
<a name="l00643"></a>00643         <span class="comment">/* based on this map, adjust the selection status of the keyframes */</span>
<a name="l00644"></a>00644         <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, fcu, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/d71/keyframes__edit_8c.html#a23529aac61a04e34f494fb916ff3687d">bezt_selmap_flush</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00645"></a>00645         
<a name="l00646"></a>00646         <span class="comment">/* free the selmap used here */</span>
<a name="l00647"></a>00647         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a501b1376c86503e0138fcd41e59df925">data</a>);
<a name="l00648"></a>00648         ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a501b1376c86503e0138fcd41e59df925">data</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00649"></a>00649     }
<a name="l00650"></a>00650     
<a name="l00651"></a>00651     <span class="comment">/* Cleanup */</span>
<a name="l00652"></a>00652     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00653"></a>00653 }
<a name="l00654"></a>00654 
<a name="l00655"></a>00655 <span class="comment">/* ----------------- */</span>
<a name="l00656"></a>00656 
<a name="l00657"></a><a class="code" href="../../d3/d19/graph__select_8c.html#af75b8610ce04c35b6de437cb21b24211">00657</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d19/graph__select_8c.html#af75b8610ce04c35b6de437cb21b24211">graphkeys_select_more_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00658"></a>00658 {
<a name="l00659"></a>00659     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00660"></a>00660     
<a name="l00661"></a>00661     <span class="comment">/* get editor data */</span>
<a name="l00662"></a>00662     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00663"></a>00663         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00664"></a>00664     
<a name="l00665"></a>00665     <span class="comment">/* perform select changes */</span>
<a name="l00666"></a>00666     <a class="code" href="../../d3/d19/graph__select_8c.html#ae393f6aec5433d0677d2512892a3fe16">select_moreless_graph_keys</a>(&amp;ac, <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ace2d6e55f37527adb63d403141ec9cf4a3964dfb75cae2ecc21cde2d532fd952c">SELMAP_MORE</a>);
<a name="l00667"></a>00667     
<a name="l00668"></a>00668     <span class="comment">/* set notifier that keyframe selection has changed */</span>
<a name="l00669"></a>00669     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#af783162b06c79f4448366ebc70ec8416">NA_SELECTED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00670"></a>00670     
<a name="l00671"></a>00671     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00672"></a>00672 }
<a name="l00673"></a>00673 
<a name="l00674"></a><a class="code" href="../../d3/d19/graph__select_8c.html#a9012bf2c320e4e955230c2c7d147ab0b">00674</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d57/graph__intern_8h.html#a508353eb8196b6ffcacfa3933fd0c39d">GRAPH_OT_select_more</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00675"></a>00675 {
<a name="l00676"></a>00676     <span class="comment">/* identifiers */</span>
<a name="l00677"></a>00677     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select More&quot;</span>;
<a name="l00678"></a>00678     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;GRAPH_OT_select_more&quot;</span>;
<a name="l00679"></a>00679     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Select keyframes beside already selected ones&quot;</span>;
<a name="l00680"></a>00680     
<a name="l00681"></a>00681     <span class="comment">/* api callbacks */</span>
<a name="l00682"></a>00682     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d19/graph__select_8c.html#af75b8610ce04c35b6de437cb21b24211">graphkeys_select_more_exec</a>;
<a name="l00683"></a>00683     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../df/d57/graph__intern_8h.html#a744a53e563652085fbaff72bbab2eada">graphop_visible_keyframes_poll</a>;
<a name="l00684"></a>00684     
<a name="l00685"></a>00685     <span class="comment">/* flags */</span>
<a name="l00686"></a>00686     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a><span class="comment">/*|OPTYPE_UNDO*/</span>;
<a name="l00687"></a>00687 }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689 <span class="comment">/* ----------------- */</span>
<a name="l00690"></a>00690 
<a name="l00691"></a><a class="code" href="../../d3/d19/graph__select_8c.html#ad0dc34f70abc0720ff73d2a92bd50d03">00691</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d19/graph__select_8c.html#ad0dc34f70abc0720ff73d2a92bd50d03">graphkeys_select_less_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00692"></a>00692 {
<a name="l00693"></a>00693     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00694"></a>00694     
<a name="l00695"></a>00695     <span class="comment">/* get editor data */</span>
<a name="l00696"></a>00696     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00697"></a>00697         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00698"></a>00698     
<a name="l00699"></a>00699     <span class="comment">/* perform select changes */</span>
<a name="l00700"></a>00700     <a class="code" href="../../d3/d19/graph__select_8c.html#ae393f6aec5433d0677d2512892a3fe16">select_moreless_graph_keys</a>(&amp;ac, <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ace2d6e55f37527adb63d403141ec9cf4add3f60ed8b19160a4f0ab471ddcf83a0">SELMAP_LESS</a>);
<a name="l00701"></a>00701     
<a name="l00702"></a>00702     <span class="comment">/* set notifier that keyframe selection has changed */</span>
<a name="l00703"></a>00703     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#af783162b06c79f4448366ebc70ec8416">NA_SELECTED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00704"></a>00704     
<a name="l00705"></a>00705     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00706"></a>00706 }
<a name="l00707"></a>00707 
<a name="l00708"></a><a class="code" href="../../d3/d19/graph__select_8c.html#af9f223faa33efc5525f23e21f8fa5a8b">00708</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d57/graph__intern_8h.html#aa4e29d9de8f9d9c7f509ee0fec5fcc8e">GRAPH_OT_select_less</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00709"></a>00709 {
<a name="l00710"></a>00710     <span class="comment">/* identifiers */</span>
<a name="l00711"></a>00711     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select Less&quot;</span>;
<a name="l00712"></a>00712     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;GRAPH_OT_select_less&quot;</span>;
<a name="l00713"></a>00713     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Deselect keyframes on ends of selection islands&quot;</span>;
<a name="l00714"></a>00714     
<a name="l00715"></a>00715     <span class="comment">/* api callbacks */</span>
<a name="l00716"></a>00716     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d19/graph__select_8c.html#ad0dc34f70abc0720ff73d2a92bd50d03">graphkeys_select_less_exec</a>;
<a name="l00717"></a>00717     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../df/d57/graph__intern_8h.html#a744a53e563652085fbaff72bbab2eada">graphop_visible_keyframes_poll</a>;
<a name="l00718"></a>00718     
<a name="l00719"></a>00719     <span class="comment">/* flags */</span>
<a name="l00720"></a>00720     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a><span class="comment">/*|OPTYPE_UNDO*/</span>;
<a name="l00721"></a>00721 }
<a name="l00722"></a>00722 
<a name="l00723"></a>00723 <span class="comment">/* ******************** Select Left/Right Operator ************************* */</span>
<a name="l00724"></a>00724 <span class="comment">/* Select keyframes left/right of the current frame indicator */</span>
<a name="l00725"></a>00725 
<a name="l00726"></a>00726 <span class="comment">/* defines for left-right select tool */</span>
<a name="l00727"></a><a class="code" href="../../d3/d19/graph__select_8c.html#a094ad18ad2e630c2bef5b66fac1fe2ce">00727</a> <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> <a class="code" href="../../d3/d19/graph__select_8c.html#a094ad18ad2e630c2bef5b66fac1fe2ce">prop_graphkeys_leftright_select_types</a>[] = {
<a name="l00728"></a>00728     {<a class="code" href="../../df/d57/graph__intern_8h.html#aa7df87806f64f3b241c8cde9eb57cad5a4427864bfa9824e9c944066684c1e741">GRAPHKEYS_LRSEL_TEST</a>, <span class="stringliteral">&quot;CHECK&quot;</span>, 0, <span class="stringliteral">&quot;Check if Select Left or Right&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00729"></a>00729     {<a class="code" href="../../df/d57/graph__intern_8h.html#aa7df87806f64f3b241c8cde9eb57cad5aecb958a381845894328ab6855cf2b2ec">GRAPHKEYS_LRSEL_LEFT</a>, <span class="stringliteral">&quot;LEFT&quot;</span>, 0, <span class="stringliteral">&quot;Before current frame&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00730"></a>00730     {<a class="code" href="../../df/d57/graph__intern_8h.html#aa7df87806f64f3b241c8cde9eb57cad5a5dc95bc90537faf0739fcc910eaad2fc">GRAPHKEYS_LRSEL_RIGHT</a>, <span class="stringliteral">&quot;RIGHT&quot;</span>, 0, <span class="stringliteral">&quot;After current frame&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00731"></a>00731     {0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL}
<a name="l00732"></a>00732 };
<a name="l00733"></a>00733 
<a name="l00734"></a>00734 <span class="comment">/* --------------------------------- */</span>
<a name="l00735"></a>00735 
<a name="l00736"></a><a class="code" href="../../d3/d19/graph__select_8c.html#a4d1f1756f31a1bfc1b0cae1e31a696a3">00736</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d19/graph__select_8c.html#a4d1f1756f31a1bfc1b0cae1e31a696a3">graphkeys_select_leftright</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keywordtype">short</span> leftright, <span class="keywordtype">short</span> select_mode)
<a name="l00737"></a>00737 {
<a name="l00738"></a>00738     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00739"></a>00739     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00740"></a>00740     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00741"></a>00741     
<a name="l00742"></a>00742     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> ok_cb, select_cb;
<a name="l00743"></a>00743     <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked= {{<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}};
<a name="l00744"></a>00744     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l00745"></a>00745     
<a name="l00746"></a>00746     <span class="comment">/* if select mode is replace, deselect all keyframes (and channels) first */</span>
<a name="l00747"></a>00747     <span class="keywordflow">if</span> (select_mode==<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acb7b1d330c02cc10e6cd32aa5c706c51">SELECT_REPLACE</a>) {
<a name="l00748"></a>00748         select_mode= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>;
<a name="l00749"></a>00749         
<a name="l00750"></a>00750         <span class="comment">/* - deselect all other keyframes, so that just the newly selected remain</span>
<a name="l00751"></a>00751 <span class="comment">         * - channels aren&#39;t deselected, since we don&#39;t re-select any as a consequence</span>
<a name="l00752"></a>00752 <span class="comment">         */</span>
<a name="l00753"></a>00753         <a class="code" href="../../d3/d19/graph__select_8c.html#ae6a15c0c11dddaaaeb80f1203480b66f">deselect_graph_keys</a>(ac, 0, <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804ab7419accdf73227e0606e04a38313ab9">SELECT_SUBTRACT</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00754"></a>00754     }
<a name="l00755"></a>00755     
<a name="l00756"></a>00756     <span class="comment">/* set callbacks and editing data */</span>
<a name="l00757"></a>00757     ok_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#ad8d50a9387bd9e246565328e381e1026">ANIM_editkeyframes_ok</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a8e98b37d6c08d1ff6782cda85ede7f39a2cb87e66a2560d4e0d141bbb4dddd837">BEZT_OK_FRAMERANGE</a>);
<a name="l00758"></a>00758     select_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#aa3e4b477e4fa097f19f20000c6ada48c">ANIM_editkeyframes_select</a>(select_mode);
<a name="l00759"></a>00759     
<a name="l00760"></a>00760     <span class="keywordflow">if</span> (leftright == <a class="code" href="../../df/d57/graph__intern_8h.html#aa7df87806f64f3b241c8cde9eb57cad5aecb958a381845894328ab6855cf2b2ec">GRAPHKEYS_LRSEL_LEFT</a>) {
<a name="l00761"></a>00761         ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1444ccfbecc1ce0317e003838ccc261d">f1</a> = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#aee77b92451acc33c76f651b7385575b2">MINAFRAMEF</a>;
<a name="l00762"></a>00762         ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1bb18ae755c595cc9b7d45e49fd6666a">f2</a> = (float)(<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a> + 0.1f);
<a name="l00763"></a>00763     } 
<a name="l00764"></a>00764     <span class="keywordflow">else</span> {
<a name="l00765"></a>00765         ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1444ccfbecc1ce0317e003838ccc261d">f1</a> = (float)(<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a> - 0.1f);
<a name="l00766"></a>00766         ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1bb18ae755c595cc9b7d45e49fd6666a">f2</a> = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8b0387485434f20a213dad5180070988">MAXFRAMEF</a>;
<a name="l00767"></a>00767     }
<a name="l00768"></a>00768     
<a name="l00769"></a>00769     <span class="comment">/* filter data */</span>
<a name="l00770"></a>00770     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00771"></a>00771     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00772"></a>00772         
<a name="l00773"></a>00773     <span class="comment">/* select keys */</span>
<a name="l00774"></a>00774     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00775"></a>00775         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../d5/d34/anim__draw_8c.html#a37ad7a1d679ae57a5492066d63bb9c72">ANIM_nla_mapping_get</a>(ac, ale);
<a name="l00776"></a>00776         
<a name="l00777"></a>00777         <span class="keywordflow">if</span> (adt) {
<a name="l00778"></a>00778             <a class="code" href="../../d5/d34/anim__draw_8c.html#af3391f209e37113f866e6bc3d15bcf97">ANIM_nla_mapping_apply_fcurve</a>(adt, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, 0, 1);
<a name="l00779"></a>00779             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, ok_cb, select_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00780"></a>00780             <a class="code" href="../../d5/d34/anim__draw_8c.html#af3391f209e37113f866e6bc3d15bcf97">ANIM_nla_mapping_apply_fcurve</a>(adt, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, 1, 1);
<a name="l00781"></a>00781         }
<a name="l00782"></a>00782         <span class="keywordflow">else</span>
<a name="l00783"></a>00783             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, ok_cb, select_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00784"></a>00784     }
<a name="l00785"></a>00785 
<a name="l00786"></a>00786     <span class="comment">/* Cleanup */</span>
<a name="l00787"></a>00787     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00788"></a>00788 }
<a name="l00789"></a>00789 
<a name="l00790"></a>00790 <span class="comment">/* ----------------- */</span>
<a name="l00791"></a>00791 
<a name="l00792"></a><a class="code" href="../../d3/d19/graph__select_8c.html#a7ce60f87a40a50a4bc49a806dc8cc94c">00792</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d19/graph__select_8c.html#a7ce60f87a40a50a4bc49a806dc8cc94c">graphkeys_select_leftright_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00793"></a>00793 {
<a name="l00794"></a>00794     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00795"></a>00795     <span class="keywordtype">short</span> leftright = <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;mode&quot;</span>);
<a name="l00796"></a>00796     <span class="keywordtype">short</span> selectmode;
<a name="l00797"></a>00797     
<a name="l00798"></a>00798     <span class="comment">/* get editor data */</span>
<a name="l00799"></a>00799     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00800"></a>00800         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00801"></a>00801     
<a name="l00802"></a>00802     <span class="comment">/* select mode is either replace (deselect all, then add) or add/extend */</span>
<a name="l00803"></a>00803     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;extend&quot;</span>))
<a name="l00804"></a>00804         selectmode= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804a162baf509d3532338823464402c56433">SELECT_INVERT</a>;
<a name="l00805"></a>00805     <span class="keywordflow">else</span>
<a name="l00806"></a>00806         selectmode= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acb7b1d330c02cc10e6cd32aa5c706c51">SELECT_REPLACE</a>;
<a name="l00807"></a>00807         
<a name="l00808"></a>00808     <span class="comment">/* if &quot;test&quot; mode is set, we don&#39;t have any info to set this with */</span>
<a name="l00809"></a>00809     <span class="keywordflow">if</span> (leftright == <a class="code" href="../../df/d57/graph__intern_8h.html#aa7df87806f64f3b241c8cde9eb57cad5a4427864bfa9824e9c944066684c1e741">GRAPHKEYS_LRSEL_TEST</a>)
<a name="l00810"></a>00810         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00811"></a>00811     
<a name="l00812"></a>00812     <span class="comment">/* do the selecting now */</span>
<a name="l00813"></a>00813     <a class="code" href="../../d3/d19/graph__select_8c.html#a4d1f1756f31a1bfc1b0cae1e31a696a3">graphkeys_select_leftright</a>(&amp;ac, leftright, selectmode);
<a name="l00814"></a>00814     
<a name="l00815"></a>00815     <span class="comment">/* set notifier that keyframe selection (and channels too) have changed */</span>
<a name="l00816"></a>00816     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ae33d7b6d741944268e2e95aa7416d97f">ND_ANIMCHAN</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#af783162b06c79f4448366ebc70ec8416">NA_SELECTED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00817"></a>00817     
<a name="l00818"></a>00818     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00819"></a>00819 }
<a name="l00820"></a>00820 
<a name="l00821"></a><a class="code" href="../../d3/d19/graph__select_8c.html#a88a1dbc6abb927cd65f453bb91b37c33">00821</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d19/graph__select_8c.html#a88a1dbc6abb927cd65f453bb91b37c33">graphkeys_select_leftright_invoke</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l00822"></a>00822 {
<a name="l00823"></a>00823     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00824"></a>00824     <span class="keywordtype">short</span> leftright = <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;mode&quot;</span>);
<a name="l00825"></a>00825     
<a name="l00826"></a>00826     <span class="comment">/* get editor data */</span>
<a name="l00827"></a>00827     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00828"></a>00828         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00829"></a>00829         
<a name="l00830"></a>00830     <span class="comment">/* handle mode-based testing */</span>
<a name="l00831"></a>00831     <span class="keywordflow">if</span> (leftright == <a class="code" href="../../df/d57/graph__intern_8h.html#aa7df87806f64f3b241c8cde9eb57cad5a4427864bfa9824e9c944066684c1e741">GRAPHKEYS_LRSEL_TEST</a>) {
<a name="l00832"></a>00832         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l00833"></a>00833         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar= ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a542e00138258c6836666296f30e0c2c0">ar</a>;
<a name="l00834"></a>00834         <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d= &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l00835"></a>00835         <span class="keywordtype">float</span> x;
<a name="l00836"></a>00836 
<a name="l00837"></a>00837         <span class="comment">/* determine which side of the current frame mouse is on */</span>
<a name="l00838"></a>00838         <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(v2d, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[0], event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[1], &amp;x, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00839"></a>00839         <span class="keywordflow">if</span> (x &lt; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a>)
<a name="l00840"></a>00840             <a class="code" href="../../d3/d10/rna__access_8c.html#ad70d450cec9fe951de69b8c9128b8cc4">RNA_enum_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;mode&quot;</span>, <a class="code" href="../../df/d57/graph__intern_8h.html#aa7df87806f64f3b241c8cde9eb57cad5aecb958a381845894328ab6855cf2b2ec">GRAPHKEYS_LRSEL_LEFT</a>);
<a name="l00841"></a>00841         <span class="keywordflow">else</span>    
<a name="l00842"></a>00842             <a class="code" href="../../d3/d10/rna__access_8c.html#ad70d450cec9fe951de69b8c9128b8cc4">RNA_enum_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;mode&quot;</span>, <a class="code" href="../../df/d57/graph__intern_8h.html#aa7df87806f64f3b241c8cde9eb57cad5a5dc95bc90537faf0739fcc910eaad2fc">GRAPHKEYS_LRSEL_RIGHT</a>);
<a name="l00843"></a>00843     }
<a name="l00844"></a>00844     
<a name="l00845"></a>00845     <span class="comment">/* perform selection */</span>
<a name="l00846"></a>00846     <span class="keywordflow">return</span> <a class="code" href="../../d3/d19/graph__select_8c.html#a7ce60f87a40a50a4bc49a806dc8cc94c">graphkeys_select_leftright_exec</a>(C, op);
<a name="l00847"></a>00847 }
<a name="l00848"></a>00848 
<a name="l00849"></a><a class="code" href="../../d3/d19/graph__select_8c.html#ac5b1abddbfe84373bf43721838799c4a">00849</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d57/graph__intern_8h.html#ac22bfd1644b22ffd83cf0b50d13025d6">GRAPH_OT_select_leftright</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00850"></a>00850 {
<a name="l00851"></a>00851     <span class="comment">/* identifiers */</span>
<a name="l00852"></a>00852     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select Left/Right&quot;</span>;
<a name="l00853"></a>00853     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;GRAPH_OT_select_leftright&quot;</span>;
<a name="l00854"></a>00854     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Select keyframes to the left or the right of the current frame&quot;</span>;
<a name="l00855"></a>00855     
<a name="l00856"></a>00856     <span class="comment">/* api callbacks  */</span>
<a name="l00857"></a>00857     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a>= <a class="code" href="../../d3/d19/graph__select_8c.html#a88a1dbc6abb927cd65f453bb91b37c33">graphkeys_select_leftright_invoke</a>;
<a name="l00858"></a>00858     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d3/d19/graph__select_8c.html#a7ce60f87a40a50a4bc49a806dc8cc94c">graphkeys_select_leftright_exec</a>;
<a name="l00859"></a>00859     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../df/d57/graph__intern_8h.html#a744a53e563652085fbaff72bbab2eada">graphop_visible_keyframes_poll</a>;
<a name="l00860"></a>00860     
<a name="l00861"></a>00861     <span class="comment">/* flags */</span>
<a name="l00862"></a>00862     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00863"></a>00863     
<a name="l00864"></a>00864     <span class="comment">/* id-props */</span>
<a name="l00865"></a>00865     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;mode&quot;</span>, prop_graphkeys_leftright_select_types, <a class="code" href="../../df/d57/graph__intern_8h.html#aa7df87806f64f3b241c8cde9eb57cad5a4427864bfa9824e9c944066684c1e741">GRAPHKEYS_LRSEL_TEST</a>, <span class="stringliteral">&quot;Mode&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00866"></a>00866     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;extend&quot;</span>, 0, <span class="stringliteral">&quot;Extend Select&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00867"></a>00867 }
<a name="l00868"></a>00868 
<a name="l00869"></a>00869 <span class="comment">/* ******************** Mouse-Click Select Operator *********************** */</span>
<a name="l00870"></a>00870 <span class="comment">/* This operator works in one of three ways:</span>
<a name="l00871"></a>00871 <span class="comment"> *  - 1) keyframe under mouse - no special modifiers</span>
<a name="l00872"></a>00872 <span class="comment"> *  - 2) all keyframes on the same side of current frame indicator as mouse - ALT modifier</span>
<a name="l00873"></a>00873 <span class="comment"> *  - 3) column select all keyframes in frame under mouse - CTRL modifier</span>
<a name="l00874"></a>00874 <span class="comment"> *</span>
<a name="l00875"></a>00875 <span class="comment"> * In addition to these basic options, the SHIFT modifier can be used to toggle the </span>
<a name="l00876"></a>00876 <span class="comment"> * selection mode between replacing the selection (without) and inverting the selection (with).</span>
<a name="l00877"></a>00877 <span class="comment"> */</span>
<a name="l00878"></a>00878 
<a name="l00879"></a>00879 <span class="comment">/* temp info for caching handle vertices close */</span>
<a name="l00880"></a><a class="code" href="../../da/d30/structtNearestVertInfo.html">00880</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../da/d30/structtNearestVertInfo.html">tNearestVertInfo</a> {
<a name="l00881"></a><a class="code" href="../../da/d30/structtNearestVertInfo.html#a43526a41c8af6d5dd1cd926d51888f72">00881</a>     <span class="keyword">struct </span><a class="code" href="../../da/d30/structtNearestVertInfo.html">tNearestVertInfo</a> *<a class="code" href="../../da/d30/structtNearestVertInfo.html#a78c33e4eef330d8b4151e4b97e57d209">next</a>, *<a class="code" href="../../da/d30/structtNearestVertInfo.html#a43526a41c8af6d5dd1cd926d51888f72">prev</a>;
<a name="l00882"></a>00882     
<a name="l00883"></a><a class="code" href="../../da/d30/structtNearestVertInfo.html#a06711c4a8303cdbebbc34f5ba42e6be4">00883</a>     <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *<a class="code" href="../../da/d30/structtNearestVertInfo.html#a06711c4a8303cdbebbc34f5ba42e6be4">fcu</a>;        <span class="comment">/* F-Curve that keyframe comes from */</span>
<a name="l00884"></a>00884     
<a name="l00885"></a><a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">00885</a>     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *<a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">bezt</a>;    <span class="comment">/* keyframe to consider */</span>
<a name="l00886"></a><a class="code" href="../../da/d30/structtNearestVertInfo.html#a005d20fbf16f6f5f1112a51114cb24c2">00886</a>     <a class="code" href="../../dc/d4a/structFPoint.html">FPoint</a> *<a class="code" href="../../da/d30/structtNearestVertInfo.html#a005d20fbf16f6f5f1112a51114cb24c2">fpt</a>;        <span class="comment">/* sample point to consider */</span>
<a name="l00887"></a>00887     
<a name="l00888"></a><a class="code" href="../../da/d30/structtNearestVertInfo.html#ad19cdbc8b4bb655b6fe8f9529335c073">00888</a>     <span class="keywordtype">short</span> <a class="code" href="../../da/d30/structtNearestVertInfo.html#ad19cdbc8b4bb655b6fe8f9529335c073">hpoint</a>;       <span class="comment">/* the handle index that we hit (eHandleIndex) */</span>
<a name="l00889"></a><a class="code" href="../../da/d30/structtNearestVertInfo.html#a4c30b354d0e1510e3af2e9ac5c676fb7">00889</a>     <span class="keywordtype">short</span> <a class="code" href="../../da/d30/structtNearestVertInfo.html#a4c30b354d0e1510e3af2e9ac5c676fb7">sel</a>;          <span class="comment">/* whether the handle is selected or not */</span>
<a name="l00890"></a><a class="code" href="../../da/d30/structtNearestVertInfo.html#a7aeb4a3e042e13c7321ae5a7f2ba1177">00890</a>     <span class="keywordtype">int</span> <a class="code" href="../../da/d30/structtNearestVertInfo.html#a7aeb4a3e042e13c7321ae5a7f2ba1177">dist</a>;           <span class="comment">/* distance from mouse to vert */</span>
<a name="l00891"></a>00891 } <a class="code" href="../../d3/d19/graph__select_8c.html#ad1e1c1c287d2c97c8cfcc4b9c871fa3c">tNearestVertInfo</a>;
<a name="l00892"></a>00892 
<a name="l00893"></a>00893 <span class="comment">/* Tags for the type of graph vert that we have */</span>
<a name="l00894"></a><a class="code" href="../../d3/d19/graph__select_8c.html#aca50ea70dd20319ebd0a5899224d292f">00894</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d3/d19/graph__select_8c.html#aca50ea70dd20319ebd0a5899224d292f">eGraphVertIndex</a> {
<a name="l00895"></a><a class="code" href="../../d3/d19/graph__select_8c.html#aca50ea70dd20319ebd0a5899224d292fa587e0a6ab418f51541e51a9c46bc8114">00895</a>     <a class="code" href="../../d3/d19/graph__select_8c.html#aca50ea70dd20319ebd0a5899224d292fa587e0a6ab418f51541e51a9c46bc8114">NEAREST_HANDLE_LEFT</a> = -1,
<a name="l00896"></a><a class="code" href="../../d3/d19/graph__select_8c.html#aca50ea70dd20319ebd0a5899224d292fa5f4bef4fc77bebadcc1829dd4304b561">00896</a>     <a class="code" href="../../d3/d19/graph__select_8c.html#aca50ea70dd20319ebd0a5899224d292fa5f4bef4fc77bebadcc1829dd4304b561">NEAREST_HANDLE_KEY</a>,
<a name="l00897"></a><a class="code" href="../../d3/d19/graph__select_8c.html#aca50ea70dd20319ebd0a5899224d292fafb2b7742c28bf4c9a77510a7497680c5">00897</a>     <a class="code" href="../../d3/d19/graph__select_8c.html#aca50ea70dd20319ebd0a5899224d292fafb2b7742c28bf4c9a77510a7497680c5">NEAREST_HANDLE_RIGHT</a>
<a name="l00898"></a>00898 } <a class="code" href="../../d3/d19/graph__select_8c.html#aca50ea70dd20319ebd0a5899224d292f">eGraphVertIndex</a>; 
<a name="l00899"></a>00899 
<a name="l00900"></a>00900 <span class="comment">/* Tolerance for absolute radius (in pixels) of the vert from the cursor to use */</span>
<a name="l00901"></a>00901 <span class="comment">// TODO: perhaps this should depend a bit on the size that the user set the vertices to be?</span>
<a name="l00902"></a><a class="code" href="../../d3/d19/graph__select_8c.html#aa332fd7d48ce874a747bafe8940dab72">00902</a> <span class="preprocessor">#define GVERTSEL_TOL    10</span>
<a name="l00903"></a>00903 <span class="preprocessor"></span>
<a name="l00904"></a>00904 <span class="comment">/* ....... */</span>
<a name="l00905"></a>00905 
<a name="l00906"></a>00906 <span class="comment">/* check if its ok to select a handle */</span>
<a name="l00907"></a>00907 <span class="comment">// XXX also need to check for int-values only?</span>
<a name="l00908"></a><a class="code" href="../../d3/d19/graph__select_8c.html#af0c5244cf2c148a8e6c93f3ad2fd8c75">00908</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d19/graph__select_8c.html#af0c5244cf2c148a8e6c93f3ad2fd8c75">fcurve_handle_sel_check</a>(<a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *sipo, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *<a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">bezt</a>)
<a name="l00909"></a>00909 {
<a name="l00910"></a>00910     <span class="keywordflow">if</span> (sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#afb3a36cb2d2bf16fbe5787baa810e4ea">flag</a> &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a1c8d4978dc9d97d9e9921d916b9af6dd">SIPO_NOHANDLES</a>) <span class="keywordflow">return</span> 0;
<a name="l00911"></a>00911     <span class="keywordflow">if</span> ((sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#afb3a36cb2d2bf16fbe5787baa810e4ea">flag</a> &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a9113eaf2c94d32ec6dcfc0031b2c73b1">SIPO_SELVHANDLESONLY</a>) &amp;&amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a30e90c4df6243a5254d5a1b61c5c8a9c">BEZSELECTED</a>(bezt)==0) <span class="keywordflow">return</span> 0;
<a name="l00912"></a>00912     <span class="keywordflow">return</span> 1;
<a name="l00913"></a>00913 }
<a name="l00914"></a>00914 
<a name="l00915"></a>00915 <span class="comment">/* check if the given vertex is within bounds or not */</span>
<a name="l00916"></a>00916 <span class="comment">// TODO: should we return if we hit something?</span>
<a name="l00917"></a><a class="code" href="../../d3/d19/graph__select_8c.html#aa942222642506ecb6f9c246c3d0b6dd4">00917</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d19/graph__select_8c.html#aa942222642506ecb6f9c246c3d0b6dd4">nearest_fcurve_vert_store</a> (<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *matches, <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d, <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *<a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">bezt</a>, <a class="code" href="../../dc/d4a/structFPoint.html">FPoint</a> *<a class="code" href="../../da/d30/structtNearestVertInfo.html#a005d20fbf16f6f5f1112a51114cb24c2">fpt</a>, <span class="keywordtype">short</span> <a class="code" href="../../da/d30/structtNearestVertInfo.html#ad19cdbc8b4bb655b6fe8f9529335c073">hpoint</a>, <span class="keyword">const</span> <span class="keywordtype">int</span> mval[2])
<a name="l00918"></a>00918 {
<a name="l00919"></a>00919     <span class="comment">/* Keyframes or Samples? */</span>
<a name="l00920"></a>00920     <span class="keywordflow">if</span> (bezt) {
<a name="l00921"></a>00921         <span class="keywordtype">int</span> screen_co[2], <a class="code" href="../../da/d30/structtNearestVertInfo.html#a7aeb4a3e042e13c7321ae5a7f2ba1177">dist</a>;
<a name="l00922"></a>00922         
<a name="l00923"></a>00923         <span class="comment">/* convert from data-space to screen coordinates </span>
<a name="l00924"></a>00924 <span class="comment">         * NOTE: hpoint+1 gives us 0,1,2 respectively for each handle, </span>
<a name="l00925"></a>00925 <span class="comment">         *  needed to access the relevant vertex coordinates in the 3x3 </span>
<a name="l00926"></a>00926 <span class="comment">         *  &#39;vec&#39; matrix</span>
<a name="l00927"></a>00927 <span class="comment">         */</span>
<a name="l00928"></a>00928         <a class="code" href="../../d5/d63/UI__view2d_8h.html#accea1c4009d4c24471c1fcf6889fa6f5">UI_view2d_view_to_region</a>(v2d, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[hpoint+1][0], bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[hpoint+1][1], &amp;screen_co[0], &amp;screen_co[1]);
<a name="l00929"></a>00929         
<a name="l00930"></a>00930         <span class="comment">/* check if distance from mouse cursor to vert in screen space is within tolerance */</span>
<a name="l00931"></a>00931             <span class="comment">// XXX: inlined distance calculation, since we cannot do this on ints using the math lib...</span>
<a name="l00932"></a>00932         <span class="comment">//dist = len_v2v2(mval, screen_co);</span>
<a name="l00933"></a>00933         dist = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>((mval[0] - screen_co[0])*(mval[0] - screen_co[0]) + 
<a name="l00934"></a>00934                     (mval[1] - screen_co[1])*(mval[1] - screen_co[1]));
<a name="l00935"></a>00935         
<a name="l00936"></a>00936         <span class="keywordflow">if</span> (dist &lt;= <a class="code" href="../../d3/d19/graph__select_8c.html#aa332fd7d48ce874a747bafe8940dab72">GVERTSEL_TOL</a>) {
<a name="l00937"></a>00937             <a class="code" href="../../da/d30/structtNearestVertInfo.html">tNearestVertInfo</a> *nvi = (<a class="code" href="../../da/d30/structtNearestVertInfo.html">tNearestVertInfo</a> *)matches-&gt;<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>;
<a name="l00938"></a>00938             <span class="keywordtype">short</span> replace = 0;
<a name="l00939"></a>00939             
<a name="l00940"></a>00940             <span class="comment">/* if there is already a point for the F-Curve, check if this point is closer than that was */</span>
<a name="l00941"></a>00941             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> ((nvi) &amp;&amp; (nvi-&gt;<a class="code" href="../../da/d30/structtNearestVertInfo.html#a06711c4a8303cdbebbc34f5ba42e6be4">fcu</a> == <a class="code" href="../../da/d30/structtNearestVertInfo.html#a06711c4a8303cdbebbc34f5ba42e6be4">fcu</a>)) {
<a name="l00942"></a>00942                 <span class="comment">/* replace if we are closer, or if equal and that one wasn&#39;t selected but we are... */</span>
<a name="l00943"></a>00943                 <span class="keywordflow">if</span> ( (nvi-&gt;<a class="code" href="../../da/d30/structtNearestVertInfo.html#a7aeb4a3e042e13c7321ae5a7f2ba1177">dist</a> &gt; dist) || ((nvi-&gt;<a class="code" href="../../da/d30/structtNearestVertInfo.html#a4c30b354d0e1510e3af2e9ac5c676fb7">sel</a> == 0) &amp;&amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a30e90c4df6243a5254d5a1b61c5c8a9c">BEZSELECTED</a>(bezt)) )
<a name="l00944"></a>00944                     replace= 1;
<a name="l00945"></a>00945             }
<a name="l00946"></a>00946             <span class="comment">/* add new if not replacing... */</span>
<a name="l00947"></a>00947             <span class="keywordflow">if</span> (replace == 0)
<a name="l00948"></a>00948                 nvi = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d30/structtNearestVertInfo.html">tNearestVertInfo</a>), <span class="stringliteral">&quot;Nearest Graph Vert Info - Bezt&quot;</span>);
<a name="l00949"></a>00949             
<a name="l00950"></a>00950             <span class="comment">/* store values */</span>
<a name="l00951"></a>00951             nvi-&gt;<a class="code" href="../../da/d30/structtNearestVertInfo.html#a06711c4a8303cdbebbc34f5ba42e6be4">fcu</a> = <a class="code" href="../../da/d30/structtNearestVertInfo.html#a06711c4a8303cdbebbc34f5ba42e6be4">fcu</a>;
<a name="l00952"></a>00952             nvi-&gt;<a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">bezt</a> = <a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">bezt</a>;
<a name="l00953"></a>00953             nvi-&gt;<a class="code" href="../../da/d30/structtNearestVertInfo.html#ad19cdbc8b4bb655b6fe8f9529335c073">hpoint</a> = <a class="code" href="../../da/d30/structtNearestVertInfo.html#ad19cdbc8b4bb655b6fe8f9529335c073">hpoint</a>;
<a name="l00954"></a>00954             nvi-&gt;<a class="code" href="../../da/d30/structtNearestVertInfo.html#a7aeb4a3e042e13c7321ae5a7f2ba1177">dist</a> = <a class="code" href="../../da/d30/structtNearestVertInfo.html#a7aeb4a3e042e13c7321ae5a7f2ba1177">dist</a>;
<a name="l00955"></a>00955             
<a name="l00956"></a>00956             nvi-&gt;<a class="code" href="../../da/d30/structtNearestVertInfo.html#a4c30b354d0e1510e3af2e9ac5c676fb7">sel</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a30e90c4df6243a5254d5a1b61c5c8a9c">BEZSELECTED</a>(bezt); <span class="comment">// XXX... should this use the individual verts instead?</span>
<a name="l00957"></a>00957             
<a name="l00958"></a>00958             <span class="comment">/* add to list of matches if appropriate... */</span>
<a name="l00959"></a>00959             <span class="keywordflow">if</span> (replace == 0)
<a name="l00960"></a>00960                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(matches, nvi);
<a name="l00961"></a>00961         }
<a name="l00962"></a>00962     }
<a name="l00963"></a>00963     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fpt) {
<a name="l00964"></a>00964         <span class="comment">// TODO...</span>
<a name="l00965"></a>00965     }
<a name="l00966"></a>00966 } 
<a name="l00967"></a>00967 
<a name="l00968"></a>00968 <span class="comment">/* helper for find_nearest_fcurve_vert() - build the list of nearest matches */</span>
<a name="l00969"></a><a class="code" href="../../d3/d19/graph__select_8c.html#af80bf3fc1fb5316d56a02a588c157448">00969</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d19/graph__select_8c.html#af80bf3fc1fb5316d56a02a588c157448">get_nearest_fcurve_verts_list</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keyword">const</span> <span class="keywordtype">int</span> mval[2], <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *matches)
<a name="l00970"></a>00970 {
<a name="l00971"></a>00971     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00972"></a>00972     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00973"></a>00973     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00974"></a>00974     
<a name="l00975"></a>00975     <a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *sipo= (<a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *)ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#ace702244f50216d9ca6d1112f6a45c77">sl</a>;
<a name="l00976"></a>00976     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d= &amp;ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a542e00138258c6836666296f30e0c2c0">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l00977"></a>00977     
<a name="l00978"></a>00978     <span class="comment">/* get curves to search through </span>
<a name="l00979"></a>00979 <span class="comment">     *  - if the option to only show keyframes that belong to selected F-Curves is enabled,</span>
<a name="l00980"></a>00980 <span class="comment">     *    include the &#39;only selected&#39; flag...</span>
<a name="l00981"></a>00981 <span class="comment">     */</span>
<a name="l00982"></a>00982     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a6c5e4b5cf2c3e1b6558850c56dbd490c">ANIMFILTER_CURVE_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00983"></a>00983     <span class="keywordflow">if</span> (sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#afb3a36cb2d2bf16fbe5787baa810e4ea">flag</a> &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a75dbc29df6b2a8b56cdcb84f336ab97f">SIPO_SELCUVERTSONLY</a>)   <span class="comment">// FIXME: this should really be check for by the filtering code...</span>
<a name="l00984"></a>00984         filter |= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045af15e0b18ede9eb0bdae48b6caab11403">ANIMFILTER_SEL</a>;
<a name="l00985"></a>00985     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00986"></a>00986     
<a name="l00987"></a>00987     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00988"></a>00988         <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu= (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>;
<a name="l00989"></a>00989         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= <a class="code" href="../../d5/d34/anim__draw_8c.html#a37ad7a1d679ae57a5492066d63bb9c72">ANIM_nla_mapping_get</a>(ac, ale);
<a name="l00990"></a>00990         
<a name="l00991"></a>00991         <span class="comment">/* apply unit corrections */</span>
<a name="l00992"></a>00992         <a class="code" href="../../d5/d34/anim__draw_8c.html#a75bfcc3b028bc0b703acd3de0c046c65">ANIM_unit_mapping_apply_fcurve</a>(ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ad2686a20c9c11e9889e3f4d9a60b8b8c">id</a>, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, 0);
<a name="l00993"></a>00993         
<a name="l00994"></a>00994         <span class="comment">/* apply NLA mapping to all the keyframes */</span>
<a name="l00995"></a>00995         <span class="keywordflow">if</span> (adt)
<a name="l00996"></a>00996             <a class="code" href="../../d5/d34/anim__draw_8c.html#af3391f209e37113f866e6bc3d15bcf97">ANIM_nla_mapping_apply_fcurve</a>(adt, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, 0, 0);
<a name="l00997"></a>00997         
<a name="l00998"></a>00998         <span class="keywordflow">if</span> (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a799ab2725f85e5ee19e9ef88a8d6b006">bezt</a>) {
<a name="l00999"></a>00999             <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt1=fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a799ab2725f85e5ee19e9ef88a8d6b006">bezt</a>, *prevbezt=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01000"></a>01000             <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01001"></a>01001             
<a name="l01002"></a>01002             <span class="keywordflow">for</span> (i=0; i &lt; fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#adec915e7ed4f2b66b12313566bf5c33f">totvert</a>; i++, prevbezt=bezt1, bezt1++) {
<a name="l01003"></a>01003                 <span class="comment">/* keyframe */</span>
<a name="l01004"></a>01004                 <a class="code" href="../../d3/d19/graph__select_8c.html#aa942222642506ecb6f9c246c3d0b6dd4">nearest_fcurve_vert_store</a>(matches, v2d, fcu, bezt1, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d3/d19/graph__select_8c.html#aca50ea70dd20319ebd0a5899224d292fa5f4bef4fc77bebadcc1829dd4304b561">NEAREST_HANDLE_KEY</a>, mval);
<a name="l01005"></a>01005                 
<a name="l01006"></a>01006                 <span class="comment">/* handles - only do them if they&#39;re visible */</span>
<a name="l01007"></a>01007                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d19/graph__select_8c.html#af0c5244cf2c148a8e6c93f3ad2fd8c75">fcurve_handle_sel_check</a>(sipo, bezt1) &amp;&amp; (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#adec915e7ed4f2b66b12313566bf5c33f">totvert</a> &gt; 1)) {
<a name="l01008"></a>01008                     <span class="comment">/* first handle only visible if previous segment had handles */</span>
<a name="l01009"></a>01009                     <span class="keywordflow">if</span> ((!prevbezt &amp;&amp; (bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a2b20e9a54cf1f1637920ae56f75d0926">ipo</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ad74346e6c15814750cc9c5eb6369fda5a9163255a4d331348a32c994ea1b191ce">BEZT_IPO_BEZ</a>)) || (prevbezt &amp;&amp; (prevbezt-&gt;ipo==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ad74346e6c15814750cc9c5eb6369fda5a9163255a4d331348a32c994ea1b191ce">BEZT_IPO_BEZ</a>))) {
<a name="l01010"></a>01010                         <a class="code" href="../../d3/d19/graph__select_8c.html#aa942222642506ecb6f9c246c3d0b6dd4">nearest_fcurve_vert_store</a>(matches, v2d, fcu, bezt1, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d3/d19/graph__select_8c.html#aca50ea70dd20319ebd0a5899224d292fa587e0a6ab418f51541e51a9c46bc8114">NEAREST_HANDLE_LEFT</a>, mval);
<a name="l01011"></a>01011                     }
<a name="l01012"></a>01012                     
<a name="l01013"></a>01013                     <span class="comment">/* second handle only visible if this segment is bezier */</span>
<a name="l01014"></a>01014                     <span class="keywordflow">if</span> (bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a2b20e9a54cf1f1637920ae56f75d0926">ipo</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ad74346e6c15814750cc9c5eb6369fda5a9163255a4d331348a32c994ea1b191ce">BEZT_IPO_BEZ</a>) {
<a name="l01015"></a>01015                         <a class="code" href="../../d3/d19/graph__select_8c.html#aa942222642506ecb6f9c246c3d0b6dd4">nearest_fcurve_vert_store</a>(matches, v2d, fcu, bezt1, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d3/d19/graph__select_8c.html#aca50ea70dd20319ebd0a5899224d292fafb2b7742c28bf4c9a77510a7497680c5">NEAREST_HANDLE_RIGHT</a>, mval);
<a name="l01016"></a>01016                     }
<a name="l01017"></a>01017                 }
<a name="l01018"></a>01018             }
<a name="l01019"></a>01019         }
<a name="l01020"></a>01020         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a568e66419fe835c1baaabb739b305e0a">fpt</a>) {
<a name="l01021"></a>01021             <span class="comment">// TODO; do this for samples too</span>
<a name="l01022"></a>01022             
<a name="l01023"></a>01023         }
<a name="l01024"></a>01024         
<a name="l01025"></a>01025         <span class="comment">/* un-apply NLA mapping from all the keyframes */</span>
<a name="l01026"></a>01026         <span class="keywordflow">if</span> (adt)
<a name="l01027"></a>01027             <a class="code" href="../../d5/d34/anim__draw_8c.html#af3391f209e37113f866e6bc3d15bcf97">ANIM_nla_mapping_apply_fcurve</a>(adt, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, 1, 0);
<a name="l01028"></a>01028         
<a name="l01029"></a>01029         <span class="comment">/* unapply unit corrections */</span>
<a name="l01030"></a>01030         <a class="code" href="../../d5/d34/anim__draw_8c.html#a75bfcc3b028bc0b703acd3de0c046c65">ANIM_unit_mapping_apply_fcurve</a>(ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ad2686a20c9c11e9889e3f4d9a60b8b8c">id</a>, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#af8d3a9243f537152cd4a74368ed8646faebcc08454a0e723f7e0b2765c4762af0">ANIM_UNITCONV_RESTORE</a>);
<a name="l01031"></a>01031     }
<a name="l01032"></a>01032     
<a name="l01033"></a>01033     <span class="comment">/* free channels */</span>
<a name="l01034"></a>01034     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01035"></a>01035 }
<a name="l01036"></a>01036 
<a name="l01037"></a>01037 <span class="comment">/* helper for find_nearest_fcurve_vert() - get the best match to use */</span>
<a name="l01038"></a><a class="code" href="../../d3/d19/graph__select_8c.html#a5a946b4a2cbe9f9f7aff5275b2fb5ef2">01038</a> <span class="keyword">static</span> <a class="code" href="../../da/d30/structtNearestVertInfo.html">tNearestVertInfo</a> *<a class="code" href="../../d3/d19/graph__select_8c.html#a5a946b4a2cbe9f9f7aff5275b2fb5ef2">get_best_nearest_fcurve_vert</a> (<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *matches)
<a name="l01039"></a>01039 {
<a name="l01040"></a>01040     <a class="code" href="../../da/d30/structtNearestVertInfo.html">tNearestVertInfo</a> *nvi = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01041"></a>01041     <span class="keywordtype">short</span> found = 0;
<a name="l01042"></a>01042     
<a name="l01043"></a>01043     <span class="comment">/* abort if list is empty */</span>
<a name="l01044"></a>01044     <span class="keywordflow">if</span> (matches-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) 
<a name="l01045"></a>01045         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01046"></a>01046         
<a name="l01047"></a>01047     <span class="comment">/* if list only has 1 item, remove it from the list and return */</span>
<a name="l01048"></a>01048     <span class="keywordflow">if</span> (matches-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == matches-&gt;<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>) {
<a name="l01049"></a>01049         <span class="comment">/* need to remove from the list, otherwise it gets freed and then we can&#39;t return it */</span>
<a name="l01050"></a>01050         nvi= matches-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01051"></a>01051         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(matches, nvi);
<a name="l01052"></a>01052         
<a name="l01053"></a>01053         <span class="keywordflow">return</span> nvi;
<a name="l01054"></a>01054     }
<a name="l01055"></a>01055     
<a name="l01056"></a>01056     <span class="comment">/* try to find the first selected F-Curve vert, then take the one after it */</span>
<a name="l01057"></a>01057     <span class="keywordflow">for</span> (nvi = matches-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nvi; nvi = nvi-&gt;<a class="code" href="../../da/d30/structtNearestVertInfo.html#a78c33e4eef330d8b4151e4b97e57d209">next</a>) {
<a name="l01058"></a>01058         <span class="comment">/* which mode of search are we in: find first selected, or find vert? */</span>
<a name="l01059"></a>01059         <span class="keywordflow">if</span> (found) {
<a name="l01060"></a>01060             <span class="comment">/* just take this vert now that we&#39;ve found the selected one </span>
<a name="l01061"></a>01061 <span class="comment">             *  - we&#39;ll need to remove this from the list so that it can be returned to the original caller</span>
<a name="l01062"></a>01062 <span class="comment">             */</span>
<a name="l01063"></a>01063             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(matches, nvi);
<a name="l01064"></a>01064             <span class="keywordflow">return</span> nvi;
<a name="l01065"></a>01065         }
<a name="l01066"></a>01066         <span class="keywordflow">else</span> {
<a name="l01067"></a>01067             <span class="comment">/* if vert is selected, we&#39;ve got what we want... */</span>
<a name="l01068"></a>01068             <span class="keywordflow">if</span> (nvi-&gt;<a class="code" href="../../da/d30/structtNearestVertInfo.html#a4c30b354d0e1510e3af2e9ac5c676fb7">sel</a>)
<a name="l01069"></a>01069                 found= 1;
<a name="l01070"></a>01070         }
<a name="l01071"></a>01071     }
<a name="l01072"></a>01072     
<a name="l01073"></a>01073     <span class="comment">/* if we&#39;re still here, this means that we failed to find anything appropriate in the first pass,</span>
<a name="l01074"></a>01074 <span class="comment">     * so just take the first item now...</span>
<a name="l01075"></a>01075 <span class="comment">     */</span>
<a name="l01076"></a>01076     nvi = matches-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01077"></a>01077     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(matches, nvi);
<a name="l01078"></a>01078     <span class="keywordflow">return</span> nvi;
<a name="l01079"></a>01079 }
<a name="l01080"></a>01080 
<a name="l01081"></a>01081 <span class="comment">/* Find the nearest vertices (either a handle or the keyframe) that are nearest to the mouse cursor (in area coordinates) </span>
<a name="l01082"></a>01082 <span class="comment"> * NOTE: the match info found must still be freed </span>
<a name="l01083"></a>01083 <span class="comment"> */</span>
<a name="l01084"></a><a class="code" href="../../d3/d19/graph__select_8c.html#a7b2767317fb81a1a65cca3bff42b6962">01084</a> <span class="keyword">static</span> <a class="code" href="../../da/d30/structtNearestVertInfo.html">tNearestVertInfo</a> *<a class="code" href="../../d3/d19/graph__select_8c.html#a7b2767317fb81a1a65cca3bff42b6962">find_nearest_fcurve_vert</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keyword">const</span> <span class="keywordtype">int</span> mval[2])
<a name="l01085"></a>01085 {
<a name="l01086"></a>01086     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> matches = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01087"></a>01087     <a class="code" href="../../da/d30/structtNearestVertInfo.html">tNearestVertInfo</a> *nvi;
<a name="l01088"></a>01088     
<a name="l01089"></a>01089     <span class="comment">/* step 1: get the nearest verts */</span>
<a name="l01090"></a>01090     <a class="code" href="../../d3/d19/graph__select_8c.html#af80bf3fc1fb5316d56a02a588c157448">get_nearest_fcurve_verts_list</a>(ac, mval, &amp;matches);
<a name="l01091"></a>01091     
<a name="l01092"></a>01092     <span class="comment">/* step 2: find the best vert */</span>
<a name="l01093"></a>01093     nvi= <a class="code" href="../../d3/d19/graph__select_8c.html#a5a946b4a2cbe9f9f7aff5275b2fb5ef2">get_best_nearest_fcurve_vert</a>(&amp;matches);
<a name="l01094"></a>01094     
<a name="l01095"></a>01095     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;matches);
<a name="l01096"></a>01096     
<a name="l01097"></a>01097     <span class="comment">/* return the best vert found */</span>
<a name="l01098"></a>01098     <span class="keywordflow">return</span> nvi;
<a name="l01099"></a>01099 }
<a name="l01100"></a>01100 
<a name="l01101"></a>01101 <span class="comment">/* ------------------- */</span>
<a name="l01102"></a>01102 
<a name="l01103"></a>01103 <span class="comment">/* option 1) select keyframe directly under mouse */</span>
<a name="l01104"></a><a class="code" href="../../d3/d19/graph__select_8c.html#aa8d2ac53060301f7f0f277e06cc73ca4">01104</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d19/graph__select_8c.html#aa8d2ac53060301f7f0f277e06cc73ca4">mouse_graph_keys</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keyword">const</span> <span class="keywordtype">int</span> mval[2], <span class="keywordtype">short</span> select_mode, <span class="keywordtype">short</span> curves_only)
<a name="l01105"></a>01105 {
<a name="l01106"></a>01106     <a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *sipo= (<a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *)ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#ace702244f50216d9ca6d1112f6a45c77">sl</a>;
<a name="l01107"></a>01107     <a class="code" href="../../da/d30/structtNearestVertInfo.html">tNearestVertInfo</a> *nvi;
<a name="l01108"></a>01108     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *<a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">bezt</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01109"></a>01109     
<a name="l01110"></a>01110     <span class="comment">/* find the beztriple that we&#39;re selecting, and the handle that was clicked on */</span>
<a name="l01111"></a>01111     nvi = <a class="code" href="../../d3/d19/graph__select_8c.html#a7b2767317fb81a1a65cca3bff42b6962">find_nearest_fcurve_vert</a>(ac, mval);
<a name="l01112"></a>01112     
<a name="l01113"></a>01113     <span class="comment">/* check if anything to select */</span>
<a name="l01114"></a>01114     <span class="keywordflow">if</span> (nvi == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)    
<a name="l01115"></a>01115         <span class="keywordflow">return</span>;
<a name="l01116"></a>01116     
<a name="l01117"></a>01117     <span class="comment">/* deselect all other curves? */</span>
<a name="l01118"></a>01118     <span class="keywordflow">if</span> (select_mode == <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acb7b1d330c02cc10e6cd32aa5c706c51">SELECT_REPLACE</a>) {
<a name="l01119"></a>01119         <span class="comment">/* reset selection mode */</span>
<a name="l01120"></a>01120         select_mode= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>;
<a name="l01121"></a>01121         
<a name="l01122"></a>01122         <span class="comment">/* deselect all other keyframes (+ F-Curves too) */</span>
<a name="l01123"></a>01123         <a class="code" href="../../d3/d19/graph__select_8c.html#ae6a15c0c11dddaaaeb80f1203480b66f">deselect_graph_keys</a>(ac, 0, <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804ab7419accdf73227e0606e04a38313ab9">SELECT_SUBTRACT</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01124"></a>01124         
<a name="l01125"></a>01125         <span class="comment">/* deselect other channels too, but only only do this if </span>
<a name="l01126"></a>01126 <span class="comment">         * selection of channel when the visibility of keyframes </span>
<a name="l01127"></a>01127 <span class="comment">         * doesn&#39;t depend on this </span>
<a name="l01128"></a>01128 <span class="comment">         */</span>
<a name="l01129"></a>01129         <span class="keywordflow">if</span> ((sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#afb3a36cb2d2bf16fbe5787baa810e4ea">flag</a> &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a75dbc29df6b2a8b56cdcb84f336ab97f">SIPO_SELCUVERTSONLY</a>) == 0)
<a name="l01130"></a>01130             <a class="code" href="../../d8/dc4/anim__channels__edit_8c.html#abe6a60e7cc2befcb9b2bd05decc44332">ANIM_deselect_anim_channels</a>(ac, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>, 0, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a04957cf96d6816c3527b7f7dfb7d7ad7ab9039d7fc8065046cc579c779d0994ed">ACHANNEL_SETFLAG_CLEAR</a>);
<a name="l01131"></a>01131     }
<a name="l01132"></a>01132     
<a name="l01133"></a>01133     <span class="comment">/* if points can be selected on this F-Curve */</span>
<a name="l01134"></a>01134     <span class="comment">// TODO: what about those with no keyframes?</span>
<a name="l01135"></a>01135     <span class="keywordflow">if</span> ((curves_only == 0) &amp;&amp; ((nvi-&gt;fcu-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#ac0aededd6dcdcaa6f2dcf7d0f812e464ab581d30efbbb3a1a1f6f979d26d1cd25">FCURVE_PROTECTED</a>)==0)) {
<a name="l01136"></a>01136         <span class="comment">/* only if there&#39;s keyframe */</span>
<a name="l01137"></a>01137         <span class="keywordflow">if</span> (nvi-&gt;bezt) {
<a name="l01138"></a>01138             <a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">bezt</a>= nvi-&gt;bezt; <span class="comment">/* used to check bezt seletion is set */</span>
<a name="l01139"></a>01139             <span class="comment">/* depends on selection mode */</span>
<a name="l01140"></a>01140             <span class="keywordflow">if</span> (select_mode == <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804a162baf509d3532338823464402c56433">SELECT_INVERT</a>) {
<a name="l01141"></a>01141                 <span class="comment">/* keyframe - invert select of all */</span>
<a name="l01142"></a>01142                 <span class="keywordflow">if</span> (nvi-&gt;hpoint == <a class="code" href="../../d3/d19/graph__select_8c.html#aca50ea70dd20319ebd0a5899224d292fa5f4bef4fc77bebadcc1829dd4304b561">NEAREST_HANDLE_KEY</a>) {
<a name="l01143"></a>01143                     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a30e90c4df6243a5254d5a1b61c5c8a9c">BEZSELECTED</a>(<a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">bezt</a>)) {
<a name="l01144"></a>01144                         <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a93dcc657832994a8d1c2768bc2e19fa6">BEZ_DESEL</a>(<a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">bezt</a>);
<a name="l01145"></a>01145                     }
<a name="l01146"></a>01146                     <span class="keywordflow">else</span> {
<a name="l01147"></a>01147                         <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a243e99ba94633b9581fb4a6e7b6375d0">BEZ_SEL</a>(<a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">bezt</a>);
<a name="l01148"></a>01148                     }
<a name="l01149"></a>01149                 }
<a name="l01150"></a>01150                 
<a name="l01151"></a>01151                 <span class="comment">/* handles - toggle selection of relevant handle */</span>
<a name="l01152"></a>01152                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nvi-&gt;hpoint == <a class="code" href="../../d3/d19/graph__select_8c.html#aca50ea70dd20319ebd0a5899224d292fa587e0a6ab418f51541e51a9c46bc8114">NEAREST_HANDLE_LEFT</a>) {
<a name="l01153"></a>01153                     <span class="comment">/* toggle selection */</span>
<a name="l01154"></a>01154                     <a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">bezt</a>-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> ^= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l01155"></a>01155                 }
<a name="l01156"></a>01156                 <span class="keywordflow">else</span> {
<a name="l01157"></a>01157                     <span class="comment">/* toggle selection */</span>
<a name="l01158"></a>01158                     <a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">bezt</a>-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> ^= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l01159"></a>01159                 }
<a name="l01160"></a>01160             }
<a name="l01161"></a>01161             <span class="keywordflow">else</span> {
<a name="l01162"></a>01162                 <span class="comment">/* if the keyframe was clicked on, select all verts of given beztriple */</span>
<a name="l01163"></a>01163                 <span class="keywordflow">if</span> (nvi-&gt;hpoint == <a class="code" href="../../d3/d19/graph__select_8c.html#aca50ea70dd20319ebd0a5899224d292fa5f4bef4fc77bebadcc1829dd4304b561">NEAREST_HANDLE_KEY</a>) {
<a name="l01164"></a>01164                     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a243e99ba94633b9581fb4a6e7b6375d0">BEZ_SEL</a>(<a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">bezt</a>);
<a name="l01165"></a>01165                 }
<a name="l01166"></a>01166                 <span class="comment">/* otherwise, select the handle that applied */</span>
<a name="l01167"></a>01167                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nvi-&gt;hpoint == <a class="code" href="../../d3/d19/graph__select_8c.html#aca50ea70dd20319ebd0a5899224d292fa587e0a6ab418f51541e51a9c46bc8114">NEAREST_HANDLE_LEFT</a>) 
<a name="l01168"></a>01168                     <a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">bezt</a>-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> |= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l01169"></a>01169                 <span class="keywordflow">else</span> 
<a name="l01170"></a>01170                     <a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">bezt</a>-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> |= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l01171"></a>01171             }
<a name="l01172"></a>01172         }
<a name="l01173"></a>01173         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nvi-&gt;fpt) {
<a name="l01174"></a>01174             <span class="comment">// TODO: need to handle sample points</span>
<a name="l01175"></a>01175         }
<a name="l01176"></a>01176     }
<a name="l01177"></a>01177     <span class="keywordflow">else</span> {
<a name="l01178"></a>01178         <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> select_cb;
<a name="l01179"></a>01179         <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked;
<a name="l01180"></a>01180         
<a name="l01181"></a>01181         <span class="comment">/* initialize keyframe editing data */</span>
<a name="l01182"></a>01182         memset(&amp;ked, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a>));
<a name="l01183"></a>01183         
<a name="l01184"></a>01184         <span class="comment">/* set up BezTriple edit callbacks */</span>
<a name="l01185"></a>01185         select_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#aa3e4b477e4fa097f19f20000c6ada48c">ANIM_editkeyframes_select</a>(select_mode);
<a name="l01186"></a>01186         
<a name="l01187"></a>01187         <span class="comment">/* select all keyframes */</span>
<a name="l01188"></a>01188         <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, nvi-&gt;<a class="code" href="../../d5/d01/structKeyframeEditData.html#a0dc5a03e9718b99cf5dfb1caf3218c09">fcu</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, select_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01189"></a>01189     }
<a name="l01190"></a>01190     
<a name="l01191"></a>01191     <span class="comment">/* only change selection of channel when the visibility of keyframes doesn&#39;t depend on this */</span>
<a name="l01192"></a>01192     <span class="keywordflow">if</span> ((sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#afb3a36cb2d2bf16fbe5787baa810e4ea">flag</a> &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a75dbc29df6b2a8b56cdcb84f336ab97f">SIPO_SELCUVERTSONLY</a>) == 0) {
<a name="l01193"></a>01193         <span class="comment">/* select or deselect curve? */</span>
<a name="l01194"></a>01194         <span class="keywordflow">if</span> (<a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">bezt</a>) {
<a name="l01195"></a>01195             <span class="comment">/* take selection status from item that got hit, to prevent flip/flop on channel </span>
<a name="l01196"></a>01196 <span class="comment">             * selection status when shift-selecting (i.e. &quot;SELECT_INVERT&quot;) points</span>
<a name="l01197"></a>01197 <span class="comment">             */</span>
<a name="l01198"></a>01198             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a30e90c4df6243a5254d5a1b61c5c8a9c">BEZSELECTED</a>(<a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">bezt</a>))
<a name="l01199"></a>01199                 nvi-&gt;fcu-&gt;flag |= <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#ac0aededd6dcdcaa6f2dcf7d0f812e464a663e89ede10f0771e57578f6ec020a8b">FCURVE_SELECTED</a>;
<a name="l01200"></a>01200             <span class="keywordflow">else</span>
<a name="l01201"></a>01201                 nvi-&gt;fcu-&gt;flag &amp;= ~<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#ac0aededd6dcdcaa6f2dcf7d0f812e464a663e89ede10f0771e57578f6ec020a8b">FCURVE_SELECTED</a>;
<a name="l01202"></a>01202         }
<a name="l01203"></a>01203         <span class="keywordflow">else</span> {
<a name="l01204"></a>01204             <span class="comment">/* didn&#39;t hit any channel, so just apply that selection mode to the curve&#39;s selection status */</span>
<a name="l01205"></a>01205             <span class="keywordflow">if</span> (select_mode == <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804a162baf509d3532338823464402c56433">SELECT_INVERT</a>)
<a name="l01206"></a>01206                 nvi-&gt;fcu-&gt;flag ^= <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#ac0aededd6dcdcaa6f2dcf7d0f812e464a663e89ede10f0771e57578f6ec020a8b">FCURVE_SELECTED</a>;
<a name="l01207"></a>01207             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (select_mode == <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>)
<a name="l01208"></a>01208                 nvi-&gt;fcu-&gt;flag |= <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#ac0aededd6dcdcaa6f2dcf7d0f812e464a663e89ede10f0771e57578f6ec020a8b">FCURVE_SELECTED</a>;
<a name="l01209"></a>01209         }
<a name="l01210"></a>01210     }
<a name="l01211"></a>01211 
<a name="l01212"></a>01212     <span class="comment">/* set active F-Curve (NOTE: sync the filter flags with findnearest_fcurve_vert) */</span>
<a name="l01213"></a>01213     <span class="comment">/* needs to be called with (sipo-&gt;flag &amp; SIPO_SELCUVERTSONLY) otherwise the active flag won&#39;t be set [#26452] */</span>
<a name="l01214"></a>01214     <span class="keywordflow">if</span> (nvi-&gt;fcu-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#ac0aededd6dcdcaa6f2dcf7d0f812e464a663e89ede10f0771e57578f6ec020a8b">FCURVE_SELECTED</a>) {
<a name="l01215"></a>01215         <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a6c5e4b5cf2c3e1b6558850c56dbd490c">ANIMFILTER_CURVE_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l01216"></a>01216         <a class="code" href="../../d8/dc4/anim__channels__edit_8c.html#ae95b85a4cef48fc497c697f7c08596f6">ANIM_set_active_channel</a>(ac, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>, filter, nvi-&gt;fcu, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7ac4150495b0727fbef95906be4efeba41">ANIMTYPE_FCURVE</a>);
<a name="l01217"></a>01217     }
<a name="l01218"></a>01218 
<a name="l01219"></a>01219     <span class="comment">/* free temp sample data for filtering */</span>
<a name="l01220"></a>01220     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nvi);
<a name="l01221"></a>01221 }
<a name="l01222"></a>01222 
<a name="l01223"></a>01223 <span class="comment">/* Option 2) Selects all the keyframes on either side of the current frame (depends on which side the mouse is on) */</span>
<a name="l01224"></a>01224 <span class="comment">/* (see graphkeys_select_leftright) */</span>
<a name="l01225"></a>01225 
<a name="l01226"></a>01226 <span class="comment">/* Option 3) Selects all visible keyframes in the same frame as the mouse click */</span>
<a name="l01227"></a><a class="code" href="../../d3/d19/graph__select_8c.html#a6b698275c98b63c52addb08c3b0efd72">01227</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d19/graph__select_8c.html#a6b698275c98b63c52addb08c3b0efd72">graphkeys_mselect_column</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keyword">const</span> <span class="keywordtype">int</span> mval[2], <span class="keywordtype">short</span> select_mode)
<a name="l01228"></a>01228 {
<a name="l01229"></a>01229     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01230"></a>01230     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l01231"></a>01231     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l01232"></a>01232     
<a name="l01233"></a>01233     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> select_cb, ok_cb;
<a name="l01234"></a>01234     <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked;
<a name="l01235"></a>01235     <a class="code" href="../../da/d30/structtNearestVertInfo.html">tNearestVertInfo</a> *nvi;
<a name="l01236"></a>01236     <span class="keywordtype">float</span> selx = (float)ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a>;
<a name="l01237"></a>01237     
<a name="l01238"></a>01238     <span class="comment">/* find the beztriple that we&#39;re selecting, and the handle that was clicked on */</span>
<a name="l01239"></a>01239     nvi = <a class="code" href="../../d3/d19/graph__select_8c.html#a7b2767317fb81a1a65cca3bff42b6962">find_nearest_fcurve_vert</a>(ac, mval);
<a name="l01240"></a>01240     
<a name="l01241"></a>01241     <span class="comment">/* check if anything to select */</span>
<a name="l01242"></a>01242     <span class="keywordflow">if</span> (nvi == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)    
<a name="l01243"></a>01243         <span class="keywordflow">return</span>;
<a name="l01244"></a>01244     
<a name="l01245"></a>01245     <span class="comment">/* get frame number on which elements should be selected */</span>
<a name="l01246"></a>01246     <span class="comment">// TODO: should we restrict to integer frames only?</span>
<a name="l01247"></a>01247     <span class="keywordflow">if</span> (nvi-&gt;<a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">bezt</a>)
<a name="l01248"></a>01248         selx= nvi-&gt;<a class="code" href="../../da/d30/structtNearestVertInfo.html#a255ad175d973be6f719b3097e9de63a4">bezt</a>-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][0];
<a name="l01249"></a>01249     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nvi-&gt;<a class="code" href="../../da/d30/structtNearestVertInfo.html#a005d20fbf16f6f5f1112a51114cb24c2">fpt</a>)
<a name="l01250"></a>01250         selx= nvi-&gt;<a class="code" href="../../da/d30/structtNearestVertInfo.html#a005d20fbf16f6f5f1112a51114cb24c2">fpt</a>-&gt;<a class="code" href="../../dc/d4a/structFPoint.html#af7a341292136798d8aae227f1cceffeb">vec</a>[0];
<a name="l01251"></a>01251     
<a name="l01252"></a>01252     <span class="comment">/* if select mode is replace, deselect all keyframes first */</span>
<a name="l01253"></a>01253     <span class="keywordflow">if</span> (select_mode==<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acb7b1d330c02cc10e6cd32aa5c706c51">SELECT_REPLACE</a>) {
<a name="l01254"></a>01254         <span class="comment">/* reset selection mode to add to selection */</span>
<a name="l01255"></a>01255         select_mode= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acbee6125d220eb0638f284e310ed7dd2">SELECT_ADD</a>;
<a name="l01256"></a>01256         
<a name="l01257"></a>01257         <span class="comment">/* - deselect all other keyframes, so that just the newly selected remain</span>
<a name="l01258"></a>01258 <span class="comment">         * - channels aren&#39;t deselected, since we don&#39;t re-select any as a consequence</span>
<a name="l01259"></a>01259 <span class="comment">         */</span>
<a name="l01260"></a>01260         <a class="code" href="../../d3/d19/graph__select_8c.html#ae6a15c0c11dddaaaeb80f1203480b66f">deselect_graph_keys</a>(ac, 0, <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804ab7419accdf73227e0606e04a38313ab9">SELECT_SUBTRACT</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01261"></a>01261     }
<a name="l01262"></a>01262     
<a name="l01263"></a>01263     <span class="comment">/* initialize keyframe editing data */</span>
<a name="l01264"></a>01264     memset(&amp;ked, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a>));
<a name="l01265"></a>01265     
<a name="l01266"></a>01266     <span class="comment">/* set up BezTriple edit callbacks */</span>
<a name="l01267"></a>01267     select_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#aa3e4b477e4fa097f19f20000c6ada48c">ANIM_editkeyframes_select</a>(select_mode);
<a name="l01268"></a>01268     ok_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#ad8d50a9387bd9e246565328e381e1026">ANIM_editkeyframes_ok</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a8e98b37d6c08d1ff6782cda85ede7f39a4a09064815ad73e482e1293530e146cd">BEZT_OK_FRAME</a>);
<a name="l01269"></a>01269     
<a name="l01270"></a>01270     <span class="comment">/* loop through all of the keys and select additional keyframes</span>
<a name="l01271"></a>01271 <span class="comment">     * based on the keys found to be selected above</span>
<a name="l01272"></a>01272 <span class="comment">     */</span>
<a name="l01273"></a>01273     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a6c5e4b5cf2c3e1b6558850c56dbd490c">ANIMFILTER_CURVE_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l01274"></a>01274     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l01275"></a>01275     
<a name="l01276"></a>01276     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l01277"></a>01277         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= <a class="code" href="../../d5/d34/anim__draw_8c.html#a37ad7a1d679ae57a5492066d63bb9c72">ANIM_nla_mapping_get</a>(ac, ale);
<a name="l01278"></a>01278         
<a name="l01279"></a>01279         <span class="comment">/* set frame for validation callback to refer to */</span>
<a name="l01280"></a>01280         <span class="keywordflow">if</span> (adt)
<a name="l01281"></a>01281             ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1444ccfbecc1ce0317e003838ccc261d">f1</a>= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab4ae36c08ea78520b80d5d517ac20da4">BKE_nla_tweakedit_remap</a>(adt, selx, <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035dad6f4c7caaf2b3ab5e648419d521cfc9e">NLATIME_CONVERT_UNMAP</a>);
<a name="l01282"></a>01282         <span class="keywordflow">else</span>
<a name="l01283"></a>01283             ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1444ccfbecc1ce0317e003838ccc261d">f1</a>= selx;
<a name="l01284"></a>01284         
<a name="l01285"></a>01285         <span class="comment">/* select elements with frame number matching cfra */</span>
<a name="l01286"></a>01286         <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, ok_cb, select_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01287"></a>01287     }
<a name="l01288"></a>01288     
<a name="l01289"></a>01289     <span class="comment">/* free elements */</span>
<a name="l01290"></a>01290     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nvi);
<a name="l01291"></a>01291     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a2348e0effff022a6ba66371076556163">list</a>);
<a name="l01292"></a>01292     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01293"></a>01293 }
<a name="l01294"></a>01294  
<a name="l01295"></a>01295 <span class="comment">/* ------------------- */</span>
<a name="l01296"></a>01296 
<a name="l01297"></a>01297 <span class="comment">/* handle clicking */</span>
<a name="l01298"></a><a class="code" href="../../d3/d19/graph__select_8c.html#aa85d6269bc31eb13cb50d0e3b332b9d2">01298</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d19/graph__select_8c.html#aa85d6269bc31eb13cb50d0e3b332b9d2">graphkeys_clickselect_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01299"></a>01299 {
<a name="l01300"></a>01300     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01301"></a>01301     <span class="keywordtype">short</span> selectmode;
<a name="l01302"></a>01302 
<a name="l01303"></a>01303     <span class="comment">/* get editor data */</span>
<a name="l01304"></a>01304     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01305"></a>01305         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01306"></a>01306 
<a name="l01307"></a>01307     <span class="comment">/* select mode is either replace (deselect all, then add) or add/extend */</span>
<a name="l01308"></a>01308     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;extend&quot;</span>))
<a name="l01309"></a>01309         selectmode= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804a162baf509d3532338823464402c56433">SELECT_INVERT</a>;
<a name="l01310"></a>01310     <span class="keywordflow">else</span>
<a name="l01311"></a>01311         selectmode= <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#ad482afe81f1047e2b4d6bc85a221c804acb7b1d330c02cc10e6cd32aa5c706c51">SELECT_REPLACE</a>;
<a name="l01312"></a>01312     
<a name="l01313"></a>01313     <span class="comment">/* figure out action to take */</span>
<a name="l01314"></a>01314     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;column&quot;</span>)) {
<a name="l01315"></a>01315         <span class="comment">/* select all keyframes in the same frame as the one that was under the mouse */</span>
<a name="l01316"></a>01316         <a class="code" href="../../d3/d19/graph__select_8c.html#a6b698275c98b63c52addb08c3b0efd72">graphkeys_mselect_column</a>(&amp;ac, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>, selectmode);
<a name="l01317"></a>01317     }
<a name="l01318"></a>01318     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;curves&quot;</span>)) {
<a name="l01319"></a>01319         <span class="comment">/* select all keyframes in the same F-Curve as the one under the mouse */</span>
<a name="l01320"></a>01320         <a class="code" href="../../d3/d19/graph__select_8c.html#aa8d2ac53060301f7f0f277e06cc73ca4">mouse_graph_keys</a>(&amp;ac, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>, selectmode, 1);
<a name="l01321"></a>01321     }
<a name="l01322"></a>01322     <span class="keywordflow">else</span> {
<a name="l01323"></a>01323         <span class="comment">/* select keyframe under mouse */</span>
<a name="l01324"></a>01324         <a class="code" href="../../d3/d19/graph__select_8c.html#aa8d2ac53060301f7f0f277e06cc73ca4">mouse_graph_keys</a>(&amp;ac, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>, selectmode, 0);
<a name="l01325"></a>01325     }
<a name="l01326"></a>01326     
<a name="l01327"></a>01327     <span class="comment">/* set notifier that keyframe selection (and also channel selection in some cases) has changed */</span>
<a name="l01328"></a>01328     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ae33d7b6d741944268e2e95aa7416d97f">ND_ANIMCHAN</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#af783162b06c79f4448366ebc70ec8416">NA_SELECTED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01329"></a>01329     
<a name="l01330"></a>01330     <span class="comment">/* for tweak grab to work */</span>
<a name="l01331"></a>01331     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>|<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l01332"></a>01332 }
<a name="l01333"></a>01333  
<a name="l01334"></a><a class="code" href="../../d3/d19/graph__select_8c.html#a87ec415f8e4cbbec2dc66f15e4a7aab7">01334</a> <span class="keywordtype">void</span> <a class="code" href="../../df/d57/graph__intern_8h.html#a9b8107bfbe381a92b8606728b0a80623">GRAPH_OT_clickselect</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01335"></a>01335 {
<a name="l01336"></a>01336     <span class="comment">/* identifiers */</span>
<a name="l01337"></a>01337     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Mouse Select Keys&quot;</span>;
<a name="l01338"></a>01338     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;GRAPH_OT_clickselect&quot;</span>;
<a name="l01339"></a>01339     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Select keyframes by clicking on them&quot;</span>;
<a name="l01340"></a>01340     
<a name="l01341"></a>01341     <span class="comment">/* api callbacks */</span>
<a name="l01342"></a>01342     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d3/d19/graph__select_8c.html#aa85d6269bc31eb13cb50d0e3b332b9d2">graphkeys_clickselect_invoke</a>;
<a name="l01343"></a>01343     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../df/d57/graph__intern_8h.html#a744a53e563652085fbaff72bbab2eada">graphop_visible_keyframes_poll</a>;
<a name="l01344"></a>01344     
<a name="l01345"></a>01345     <span class="comment">/* id-props */</span>
<a name="l01346"></a>01346     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;extend&quot;</span>, 0, <span class="stringliteral">&quot;Extend Select&quot;</span>, <span class="stringliteral">&quot;&quot;</span>); <span class="comment">// SHIFTKEY</span>
<a name="l01347"></a>01347     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;column&quot;</span>, 0, <span class="stringliteral">&quot;Column Select&quot;</span>, <span class="stringliteral">&quot;Select all keyframes that occur on the same frame as the one under the mouse&quot;</span>); <span class="comment">// ALTKEY</span>
<a name="l01348"></a>01348     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;curves&quot;</span>, 0, <span class="stringliteral">&quot;Only Curves&quot;</span>, <span class="stringliteral">&quot;Select all the keyframes in the curve&quot;</span>); <span class="comment">// CTRLKEY + ALTKEY</span>
<a name="l01349"></a>01349 }
<a name="l01350"></a>01350 
<a name="l01351"></a>01351 <span class="comment">/* ************************************************************************** */</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:23 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: object_constraint.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">object_constraint.c</div>  </div>
</div>
<div class="contents">
<a href="../../d4/d72/object__constraint_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): Joshua Leung, Blender Foundation</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc9/BLI__dynstr_8h.html" title="A dynamically sized string ADT.">BLI_dynstr.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d03/DNA__constraint__types_8h.html">DNA_constraint_types.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d88/DNA__curve__types_8h.html">DNA_curve_types.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d71/DNA__text__types_8h.html">DNA_text_types.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/df5/BKE__action_8h.html" title="Blender kernel action and pose functionality.">BKE_action.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d17/BKE__armature_8h.html">BKE_armature.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddd/BKE__constraint_8h.html">BKE_constraint.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html">BKE_depsgraph.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dac/BKE__object_8h.html" title="General operations, lookup, etc. for blender objects.">BKE_object.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d40/BKE__report_8h.html">BKE_report.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d72/BKE__tracking_8h.html">BKE_tracking.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/dd6/BIK__api_8h.html">BIK_api.h</a>&quot;</span>
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="preprocessor">#ifdef WITH_PYTHON</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="../../dc/d76/BPY__extern_8h.html">BPY_extern.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#endif</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d68/RNA__define_8h.html">RNA_define.h</a>&quot;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d68/RNA__enum__types_8h.html">RNA_enum_types.h</a>&quot;</span>
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7a/ED__object_8h.html">ED_object.h</a>&quot;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d98/ED__armature_8h.html">ED_armature.h</a>&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d12/ED__screen_8h.html">ED_screen.h</a>&quot;</span>
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d1e/UI__interface_8h.html">UI_interface.h</a>&quot;</span>
<a name="l00077"></a>00077 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d96/UI__resources_8h.html">UI_resources.h</a>&quot;</span>
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d80/object__intern_8h.html">object_intern.h</a>&quot;</span>
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 <span class="comment">/* -------------- Get Active Constraint Data ---------------------- */</span>
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 <span class="comment">/* if object in posemode, active bone constraints, else object constraints */</span>
<a name="l00084"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#aea84d970d51f8832f5b58bce6d197b4e">00084</a> <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *<a class="code" href="../../da/d7a/ED__object_8h.html#a74a92e4b5b822a699db2cf03728cb370">get_active_constraints</a> (<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l00085"></a>00085 {
<a name="l00086"></a>00086     <span class="keywordflow">if</span> (ob == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00087"></a>00087         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00088"></a>00088     
<a name="l00089"></a>00089     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550acfed9b4bf4a7e2d3c5ae0b3571e38950">OB_MODE_POSE</a>) {
<a name="l00090"></a>00090         <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan;
<a name="l00091"></a>00091         
<a name="l00092"></a>00092         pchan = <a class="code" href="../../d8/df5/BKE__action_8h.html#aec3c2979d744c68e3fdbec5adfad77f1">get_active_posechannel</a>(ob);
<a name="l00093"></a>00093         <span class="keywordflow">if</span> (pchan)
<a name="l00094"></a>00094             <span class="keywordflow">return</span> &amp;pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>;
<a name="l00095"></a>00095     }
<a name="l00096"></a>00096     <span class="keywordflow">else</span> 
<a name="l00097"></a>00097         <span class="keywordflow">return</span> &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>;
<a name="l00098"></a>00098     
<a name="l00099"></a>00099     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00100"></a>00100 }
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 <span class="comment">/* Find the list that a given constraint belongs to, and/or also get the posechannel this is from (if applicable) */</span>
<a name="l00103"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#ad8e74d1e4efa3513f571fce7ace4a473">00103</a> <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *<a class="code" href="../../da/d7a/ED__object_8h.html#a10a5db8d564962968141ad56bb055f65">get_constraint_lb</a> (<a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con, <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> **pchan_r)
<a name="l00104"></a>00104 {
<a name="l00105"></a>00105     <span class="keywordflow">if</span> (pchan_r)
<a name="l00106"></a>00106         *pchan_r= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00107"></a>00107     
<a name="l00108"></a>00108     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ob, con))
<a name="l00109"></a>00109         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00110"></a>00110     
<a name="l00111"></a>00111     <span class="comment">/* try object constraints first */</span>
<a name="l00112"></a>00112     <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a0a004822554284f0bb32fdc70cfeee1f">BLI_findindex</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>, con) != -1)) {
<a name="l00113"></a>00113         <span class="keywordflow">return</span> &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>;
<a name="l00114"></a>00114     }
<a name="l00115"></a>00115     
<a name="l00116"></a>00116     <span class="comment">/* if armature, try pose bones too */</span>
<a name="l00117"></a>00117     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>) {
<a name="l00118"></a>00118         <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan;
<a name="l00119"></a>00119         
<a name="l00120"></a>00120         <span class="comment">/* try each bone in order </span>
<a name="l00121"></a>00121 <span class="comment">         * NOTE: it&#39;s not possible to directly look up the active bone yet, so this will have to do</span>
<a name="l00122"></a>00122 <span class="comment">         */</span>
<a name="l00123"></a>00123         <span class="keywordflow">for</span> (pchan= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; pchan; pchan= pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a73c14c1cca1a2d1e91778f44578eeca0">next</a>) {
<a name="l00124"></a>00124             <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a0a004822554284f0bb32fdc70cfeee1f">BLI_findindex</a>(&amp;pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>, con) != -1)) {
<a name="l00125"></a>00125                 
<a name="l00126"></a>00126                 <span class="keywordflow">if</span> (pchan_r)
<a name="l00127"></a>00127                     *pchan_r= pchan;
<a name="l00128"></a>00128                 
<a name="l00129"></a>00129                 <span class="keywordflow">return</span> &amp;pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>;
<a name="l00130"></a>00130             }
<a name="l00131"></a>00131         }
<a name="l00132"></a>00132     }
<a name="l00133"></a>00133     
<a name="l00134"></a>00134     <span class="comment">/* done */</span>
<a name="l00135"></a>00135     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00136"></a>00136 }
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <span class="comment">/* single constraint */</span>
<a name="l00139"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#acbbb18648effd54fdc9b5d0561a7aa37">00139</a> <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *<a class="code" href="../../da/d7a/ED__object_8h.html#ad1ac83b9b9d63af92886a51802cb6448">get_active_constraint</a> (<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l00140"></a>00140 {
<a name="l00141"></a>00141     <span class="keywordflow">return</span> <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#a196bb91320bbc949bfaa58c1cfcc2a9e">constraints_get_active</a>(<a class="code" href="../../da/d7a/ED__object_8h.html#a74a92e4b5b822a699db2cf03728cb370">get_active_constraints</a>(ob));
<a name="l00142"></a>00142 }
<a name="l00143"></a>00143 
<a name="l00144"></a>00144 <span class="comment">/* -------------- Constraint Management (Add New, Remove, Rename) -------------------- */</span>
<a name="l00145"></a>00145 <span class="preprocessor">#ifdef WITH_PYTHON</span>
<a name="l00146"></a>00146 <span class="preprocessor"></span><span class="comment">/* ------------- PyConstraints ------------------ */</span>
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 <span class="comment">/* this callback sets the text-file to be used for selected menu item */</span>
<a name="l00149"></a>00149 <span class="keyword">static</span> <span class="keywordtype">void</span> validate_pyconstraint_cb (<span class="keywordtype">void</span> *arg1, <span class="keywordtype">void</span> *arg2)
<a name="l00150"></a>00150 {
<a name="l00151"></a>00151     <a class="code" href="../../d5/d64/structbPythonConstraint.html">bPythonConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = arg1;
<a name="l00152"></a>00152     <a class="code" href="../../d2/dda/structText.html">Text</a> *text= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00153"></a>00153     <span class="keywordtype">int</span> <a class="code" href="../../de/de7/structObject.html#a82d960f06759ba165265b23c7e13908b">index</a> = *((<span class="keywordtype">int</span> *)arg2);
<a name="l00154"></a>00154     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00155"></a>00155     
<a name="l00156"></a>00156     <span class="comment">/* exception for no script */</span>
<a name="l00157"></a>00157     <span class="keywordflow">if</span> (index) {
<a name="l00158"></a>00158         <span class="comment">/* innovative use of a for...loop to search */</span>
<a name="l00159"></a>00159         <span class="keywordflow">for</span> (text=<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;text.first, i=1; text &amp;&amp; index!=i; i++, text=text-&gt;<a class="code" href="../../d2/dda/structText.html#aedc1fa5aee16348150d4eacfbc6ea389">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>);
<a name="l00160"></a>00160     }
<a name="l00161"></a>00161     data-&gt;<a class="code" href="../../d5/d64/structbPythonConstraint.html#aa252f474e169cb7977640affb35237ca">text</a> = text;
<a name="l00162"></a>00162 }
<a name="l00163"></a>00163 
<a name="l00164"></a>00164 <span class="comment">/* this returns a string for the list of usable pyconstraint script names */</span>
<a name="l00165"></a>00165 <span class="keyword">static</span> <span class="keywordtype">char</span> *buildmenu_pyconstraints (<a class="code" href="../../d2/dda/structText.html">Text</a> *con_text, <span class="keywordtype">int</span> *pyconindex)
<a name="l00166"></a>00166 {
<a name="l00167"></a>00167     <a class="code" href="../../d4/de5/structDynStr.html">DynStr</a> *pupds= <a class="code" href="../../d7/dc9/BLI__dynstr_8h.html#ae83ee20abb290558ce2e8f151ed54227">BLI_dynstr_new</a>();
<a name="l00168"></a>00168     <a class="code" href="../../d2/dda/structText.html">Text</a> *text;
<a name="l00169"></a>00169     <span class="keywordtype">char</span> *<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>;
<a name="l00170"></a>00170     <span class="keywordtype">char</span> buf[64];
<a name="l00171"></a>00171     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00172"></a>00172     
<a name="l00173"></a>00173     <span class="comment">/* add title first */</span>
<a name="l00174"></a>00174     sprintf(buf, <span class="stringliteral">&quot;Scripts: %%t|[None]%%x0|&quot;</span>);
<a name="l00175"></a>00175     <a class="code" href="../../d7/dc9/BLI__dynstr_8h.html#a55db0fd7c4f2fd5714777dbbd56238b4">BLI_dynstr_append</a>(pupds, buf);
<a name="l00176"></a>00176     
<a name="l00177"></a>00177     <span class="comment">/* init active-index first */</span>
<a name="l00178"></a>00178     <span class="keywordflow">if</span> (con_text == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00179"></a>00179         *pyconindex= 0;
<a name="l00180"></a>00180     
<a name="l00181"></a>00181     <span class="comment">/* loop through markers, adding them */</span>
<a name="l00182"></a>00182     <span class="keywordflow">for</span> (text=<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;text.first, i=1; text; i++, text=text-&gt;<a class="code" href="../../d2/dda/structText.html#aedc1fa5aee16348150d4eacfbc6ea389">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l00183"></a>00183         <span class="comment">/* this is important to ensure that right script is shown as active */</span>
<a name="l00184"></a>00184         <span class="keywordflow">if</span> (text == con_text) *pyconindex = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00185"></a>00185         
<a name="l00186"></a>00186         <span class="comment">/* only include valid pyconstraint scripts */</span>
<a name="l00187"></a>00187         <span class="keywordflow">if</span> (<a class="code" href="../../dc/d76/BPY__extern_8h.html#a9e66488152052f9b224e3a91c2f98b51">BPY_is_pyconstraint</a>(text)) {
<a name="l00188"></a>00188             <a class="code" href="../../d7/dc9/BLI__dynstr_8h.html#a55db0fd7c4f2fd5714777dbbd56238b4">BLI_dynstr_append</a>(pupds, text-&gt;<a class="code" href="../../d2/dda/structText.html#aedc1fa5aee16348150d4eacfbc6ea389">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2);
<a name="l00189"></a>00189             
<a name="l00190"></a>00190             sprintf(buf, <span class="stringliteral">&quot;%%x%d&quot;</span>, i);
<a name="l00191"></a>00191             <a class="code" href="../../d7/dc9/BLI__dynstr_8h.html#a55db0fd7c4f2fd5714777dbbd56238b4">BLI_dynstr_append</a>(pupds, buf);
<a name="l00192"></a>00192             
<a name="l00193"></a>00193             <span class="keywordflow">if</span> (text-&gt;<a class="code" href="../../d2/dda/structText.html#aedc1fa5aee16348150d4eacfbc6ea389">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l00194"></a>00194                 <a class="code" href="../../d7/dc9/BLI__dynstr_8h.html#a55db0fd7c4f2fd5714777dbbd56238b4">BLI_dynstr_append</a>(pupds, <span class="stringliteral">&quot;|&quot;</span>);
<a name="l00195"></a>00195         }
<a name="l00196"></a>00196     }
<a name="l00197"></a>00197     
<a name="l00198"></a>00198     <span class="comment">/* convert to normal MEM_malloc&#39;d string */</span>
<a name="l00199"></a>00199     str= <a class="code" href="../../d7/dc9/BLI__dynstr_8h.html#a4ec5498b239c83c6657f206d2f2f4968">BLI_dynstr_get_cstring</a>(pupds);
<a name="l00200"></a>00200     <a class="code" href="../../d7/dc9/BLI__dynstr_8h.html#a3687f0d324bc2026a013872ce32d157a">BLI_dynstr_free</a>(pupds);
<a name="l00201"></a>00201     
<a name="l00202"></a>00202     <span class="keywordflow">return</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>;
<a name="l00203"></a>00203 }
<a name="l00204"></a>00204 <span class="preprocessor">#endif </span><span class="comment">/* WITH_PYTHON */</span>
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 <span class="preprocessor">#if 0 // UNUSED, until pyconstraints are added back.</span>
<a name="l00207"></a>00207 <span class="preprocessor"></span><span class="comment">/* this callback gets called when the &#39;refresh&#39; button of a pyconstraint gets pressed */</span>
<a name="l00208"></a>00208 <span class="keyword">static</span> <span class="keywordtype">void</span> update_pyconstraint_cb (<span class="keywordtype">void</span> *arg1, <span class="keywordtype">void</span> *arg2)
<a name="l00209"></a>00209 {
<a name="l00210"></a>00210 <span class="preprocessor">#ifndef WITH_PYTHON</span>
<a name="l00211"></a>00211 <span class="preprocessor"></span>    (void)arg1; <span class="comment">/* unused */</span>
<a name="l00212"></a>00212     (void)arg2; <span class="comment">/* unused */</span>
<a name="l00213"></a>00213 <span class="preprocessor">#else</span>
<a name="l00214"></a>00214 <span class="preprocessor"></span>    <a class="code" href="../../de/de7/structObject.html">Object</a> *owner= (<a class="code" href="../../de/de7/structObject.html">Object</a> *)arg1;
<a name="l00215"></a>00215     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con= (<a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *)arg2;
<a name="l00216"></a>00216     <span class="keywordflow">if</span> (owner &amp;&amp; con)
<a name="l00217"></a>00217         <a class="code" href="../../dc/d76/BPY__extern_8h.html#aa8f63ee5c2c253213647d21f77e2c17c">BPY_pyconstraint_update</a>(owner, con);
<a name="l00218"></a>00218 <span class="preprocessor">#endif</span>
<a name="l00219"></a>00219 <span class="preprocessor"></span>}
<a name="l00220"></a>00220 <span class="preprocessor">#endif // UNUSED</span>
<a name="l00221"></a>00221 <span class="preprocessor"></span>
<a name="l00222"></a>00222 <span class="comment">/* helper function for add_constriant - sets the last target for the active constraint */</span>
<a name="l00223"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a1557a055b29e28f20ab2fe777bd43436">00223</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a1557a055b29e28f20ab2fe777bd43436">set_constraint_nth_target</a> (<a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con, <a class="code" href="../../de/de7/structObject.html">Object</a> *target, <span class="keyword">const</span> <span class="keywordtype">char</span> subtarget[], <span class="keywordtype">int</span> index)
<a name="l00224"></a>00224 {
<a name="l00225"></a>00225     <a class="code" href="../../dc/ded/structbConstraintTypeInfo.html">bConstraintTypeInfo</a> *cti= <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#a8eac21e0105e441026a6b7cd7d78030d">constraint_get_typeinfo</a>(con);
<a name="l00226"></a>00226     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> targets = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00227"></a>00227     <a class="code" href="../../d5/d78/structbConstraintTarget.html">bConstraintTarget</a> *ct;
<a name="l00228"></a>00228     <span class="keywordtype">int</span> num_targets, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00229"></a>00229     
<a name="l00230"></a>00230     <span class="keywordflow">if</span> (cti &amp;&amp; cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a25b05ed0f4c02b26dbbc775b47d0b934">get_constraint_targets</a>) {
<a name="l00231"></a>00231         cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a25b05ed0f4c02b26dbbc775b47d0b934">get_constraint_targets</a>(con, &amp;targets);
<a name="l00232"></a>00232         num_targets= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aa3b37105a0793ac30946a6d220ee97d7">BLI_countlist</a>(&amp;targets);
<a name="l00233"></a>00233         
<a name="l00234"></a>00234         <span class="keywordflow">if</span> (index &lt; 0) {
<a name="l00235"></a>00235             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>(index) &lt; num_targets)
<a name="l00236"></a>00236                 index= num_targets - <a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>(index);
<a name="l00237"></a>00237             <span class="keywordflow">else</span>
<a name="l00238"></a>00238                 index= num_targets - 1;
<a name="l00239"></a>00239         }
<a name="l00240"></a>00240         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index &gt;= num_targets) {
<a name="l00241"></a>00241             index= num_targets - 1;
<a name="l00242"></a>00242         }
<a name="l00243"></a>00243         
<a name="l00244"></a>00244         <span class="keywordflow">for</span> (ct=targets.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>, i=0; ct; ct= ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a5ea4a1b1fa4761a30cb66c75a8ac9054">next</a>, i++) {
<a name="l00245"></a>00245             <span class="keywordflow">if</span> (i == index) {
<a name="l00246"></a>00246                 ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a0f75cb18129bdb2c0aee21ac528b8f5e">tar</a>= target;
<a name="l00247"></a>00247                 <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#ab1f6a09b2a30f6f55449e3e5871fafed">subtarget</a>, subtarget, <span class="keyword">sizeof</span>(ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#ab1f6a09b2a30f6f55449e3e5871fafed">subtarget</a>));
<a name="l00248"></a>00248                 <span class="keywordflow">break</span>;
<a name="l00249"></a>00249             }
<a name="l00250"></a>00250         }
<a name="l00251"></a>00251         
<a name="l00252"></a>00252         <span class="keywordflow">if</span> (cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a5afd4078d269cd49108678e99cca935f">flush_constraint_targets</a>)
<a name="l00253"></a>00253             cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a5afd4078d269cd49108678e99cca935f">flush_constraint_targets</a>(con, &amp;targets, 0);
<a name="l00254"></a>00254     }
<a name="l00255"></a>00255 }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257 <span class="comment">/* ------------- Constraint Sanity Testing ------------------- */</span>
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 <span class="comment">/* checks validity of object pointers, and NULLs,</span>
<a name="l00260"></a>00260 <span class="comment"> * if Bone doesnt exist it sets the CONSTRAINT_DISABLE flag.</span>
<a name="l00261"></a>00261 <span class="comment"> */</span>
<a name="l00262"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a64bb9814225b5f7a823e3cf3f27a03bf">00262</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a64bb9814225b5f7a823e3cf3f27a03bf">test_constraints</a> (<a class="code" href="../../de/de7/structObject.html">Object</a> *owner, <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan)
<a name="l00263"></a>00263 {
<a name="l00264"></a>00264     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *curcon;
<a name="l00265"></a>00265     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *conlist= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00266"></a>00266     <span class="keywordtype">int</span> <a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>;
<a name="l00267"></a>00267     
<a name="l00268"></a>00268     <span class="keywordflow">if</span> (owner==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00269"></a>00269     
<a name="l00270"></a>00270     <span class="comment">/* Check parents */</span>
<a name="l00271"></a>00271     <span class="keywordflow">if</span> (pchan) {
<a name="l00272"></a>00272         <span class="keywordflow">switch</span> (owner-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>) {
<a name="l00273"></a>00273             <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>:
<a name="l00274"></a>00274                 type = <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#adfb54b57e8687ce7b32072d253bfde5ca8f84f807a0f7d3897ed2a2d07dbb93d8">CONSTRAINT_OBTYPE_BONE</a>;
<a name="l00275"></a>00275                 <span class="keywordflow">break</span>;
<a name="l00276"></a>00276             <span class="keywordflow">default</span>:
<a name="l00277"></a>00277                 type = <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#adfb54b57e8687ce7b32072d253bfde5ca80fce2faf62ad6f0acce0e3319b4b6c8">CONSTRAINT_OBTYPE_OBJECT</a>;
<a name="l00278"></a>00278                 <span class="keywordflow">break</span>;
<a name="l00279"></a>00279         }
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281     <span class="keywordflow">else</span>
<a name="l00282"></a>00282         type = <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#adfb54b57e8687ce7b32072d253bfde5ca80fce2faf62ad6f0acce0e3319b4b6c8">CONSTRAINT_OBTYPE_OBJECT</a>;
<a name="l00283"></a>00283     
<a name="l00284"></a>00284     <span class="comment">/* Get the constraint list for this object */</span>
<a name="l00285"></a>00285     <span class="keywordflow">switch</span> (type) {
<a name="l00286"></a>00286         <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#adfb54b57e8687ce7b32072d253bfde5ca80fce2faf62ad6f0acce0e3319b4b6c8">CONSTRAINT_OBTYPE_OBJECT</a>:
<a name="l00287"></a>00287             conlist = &amp;owner-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>;
<a name="l00288"></a>00288             <span class="keywordflow">break</span>;
<a name="l00289"></a>00289         <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#adfb54b57e8687ce7b32072d253bfde5ca8f84f807a0f7d3897ed2a2d07dbb93d8">CONSTRAINT_OBTYPE_BONE</a>:
<a name="l00290"></a>00290             conlist = &amp;pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>;
<a name="l00291"></a>00291             <span class="keywordflow">break</span>;
<a name="l00292"></a>00292     }
<a name="l00293"></a>00293     
<a name="l00294"></a>00294     <span class="comment">/* Check all constraints - is constraint valid? */</span>
<a name="l00295"></a>00295     <span class="keywordflow">if</span> (conlist) {
<a name="l00296"></a>00296         <span class="keywordflow">for</span> (curcon = conlist-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; curcon; curcon=curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l00297"></a>00297             <a class="code" href="../../dc/ded/structbConstraintTypeInfo.html">bConstraintTypeInfo</a> *cti= <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#a8eac21e0105e441026a6b7cd7d78030d">constraint_get_typeinfo</a>(curcon);
<a name="l00298"></a>00298             <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> targets = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00299"></a>00299             <a class="code" href="../../d5/d78/structbConstraintTarget.html">bConstraintTarget</a> *ct;
<a name="l00300"></a>00300             
<a name="l00301"></a>00301             <span class="comment">/* clear disabled-flag first */</span>
<a name="l00302"></a>00302             curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> &amp;= ~<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00303"></a>00303             
<a name="l00304"></a>00304             <span class="keywordflow">if</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a8061c31c9da4a7351ce57037615d2c16">CONSTRAINT_TYPE_KINEMATIC</a>) {
<a name="l00305"></a>00305                 <a class="code" href="../../d4/d5b/structbKinematicConstraint.html">bKinematicConstraint</a> *data = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l00306"></a>00306                 
<a name="l00307"></a>00307                 <span class="comment">/* bad: we need a separate set of checks here as poletarget is </span>
<a name="l00308"></a>00308 <span class="comment">                 *      optional... otherwise poletarget must exist too or else</span>
<a name="l00309"></a>00309 <span class="comment">                 *      the constraint is deemed invalid</span>
<a name="l00310"></a>00310 <span class="comment">                 */</span>
<a name="l00311"></a>00311                 <span class="comment">/* default IK check ... */</span>
<a name="l00312"></a>00312                 <span class="keywordflow">if</span> (<a class="code" href="../../df/dac/BKE__object_8h.html#a10999dc4914a9ff4141337d5ead891ae">exist_object</a>(data-&gt;<a class="code" href="../../d4/d5b/structbKinematicConstraint.html#a40d06e4dc4d012bd48f578721cffbe5b">tar</a>) == 0) {
<a name="l00313"></a>00313                     data-&gt;<a class="code" href="../../d4/d5b/structbKinematicConstraint.html#a40d06e4dc4d012bd48f578721cffbe5b">tar</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00314"></a>00314                     curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00315"></a>00315                 }
<a name="l00316"></a>00316                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d4/d5b/structbKinematicConstraint.html#a40d06e4dc4d012bd48f578721cffbe5b">tar</a> == owner) {
<a name="l00317"></a>00317                     <span class="keywordflow">if</span> (!<a class="code" href="../../da/d17/BKE__armature_8h.html#aa555e0c2fb76b7edbcbd5fc8344b993a">get_named_bone</a>(<a class="code" href="../../da/d17/BKE__armature_8h.html#a0c6c9c472b6b6bb51a784294b3688ae9">get_armature</a>(owner), data-&gt;<a class="code" href="../../d4/d5b/structbKinematicConstraint.html#ae1995de4033715d3d3c571f70f92d344">subtarget</a>)) {
<a name="l00318"></a>00318                         curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00319"></a>00319                     }
<a name="l00320"></a>00320                 }
<a name="l00321"></a>00321                 
<a name="l00322"></a>00322                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d4/d5b/structbKinematicConstraint.html#a4136315d7e8e716a0139e10e3a11e86e">poletar</a>) {
<a name="l00323"></a>00323                     <span class="keywordflow">if</span> (<a class="code" href="../../df/dac/BKE__object_8h.html#a10999dc4914a9ff4141337d5ead891ae">exist_object</a>(data-&gt;<a class="code" href="../../d4/d5b/structbKinematicConstraint.html#a4136315d7e8e716a0139e10e3a11e86e">poletar</a>) == 0) {
<a name="l00324"></a>00324                         data-&gt;<a class="code" href="../../d4/d5b/structbKinematicConstraint.html#a4136315d7e8e716a0139e10e3a11e86e">poletar</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00325"></a>00325                         curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00326"></a>00326                     }
<a name="l00327"></a>00327                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d4/d5b/structbKinematicConstraint.html#a4136315d7e8e716a0139e10e3a11e86e">poletar</a> == owner) {
<a name="l00328"></a>00328                         <span class="keywordflow">if</span> (!<a class="code" href="../../da/d17/BKE__armature_8h.html#aa555e0c2fb76b7edbcbd5fc8344b993a">get_named_bone</a>(<a class="code" href="../../da/d17/BKE__armature_8h.html#a0c6c9c472b6b6bb51a784294b3688ae9">get_armature</a>(owner), data-&gt;<a class="code" href="../../d4/d5b/structbKinematicConstraint.html#a992bd610645d0c60b2f3b3f214fb42d1">polesubtarget</a>)) {
<a name="l00329"></a>00329                             curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00330"></a>00330                         }
<a name="l00331"></a>00331                     }
<a name="l00332"></a>00332                 }
<a name="l00333"></a>00333                 <span class="comment">/* ... can be overwritten here */</span>
<a name="l00334"></a>00334                 <a class="code" href="../../d8/dd6/BIK__api_8h.html#a92f90e66f904c9f7deb0def6ec3f7a09">BIK_test_constraint</a>(owner, curcon);
<a name="l00335"></a>00335                 <span class="comment">/* targets have already been checked for this */</span>
<a name="l00336"></a>00336                 <span class="keywordflow">continue</span>;
<a name="l00337"></a>00337             }
<a name="l00338"></a>00338             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a1475b62b3b1ed41f068a0f5a579f8f23">CONSTRAINT_TYPE_PIVOT</a>) {
<a name="l00339"></a>00339                 <a class="code" href="../../df/d43/structbPivotConstraint.html">bPivotConstraint</a> *data = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l00340"></a>00340                 
<a name="l00341"></a>00341                 <span class="comment">/* target doesn&#39;t have to exist, but if it is non-null, it must exist! */</span>
<a name="l00342"></a>00342                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../df/d43/structbPivotConstraint.html#a3e2e3d07f0500a8eaa31b6cb4225aba7">tar</a> &amp;&amp; <a class="code" href="../../df/dac/BKE__object_8h.html#a10999dc4914a9ff4141337d5ead891ae">exist_object</a>(data-&gt;<a class="code" href="../../df/d43/structbPivotConstraint.html#a3e2e3d07f0500a8eaa31b6cb4225aba7">tar</a>)==0) {
<a name="l00343"></a>00343                     data-&gt;<a class="code" href="../../df/d43/structbPivotConstraint.html#a3e2e3d07f0500a8eaa31b6cb4225aba7">tar</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00344"></a>00344                     curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00345"></a>00345                 }
<a name="l00346"></a>00346                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../df/d43/structbPivotConstraint.html#a3e2e3d07f0500a8eaa31b6cb4225aba7">tar</a> == owner) {
<a name="l00347"></a>00347                     <span class="keywordflow">if</span> (!<a class="code" href="../../da/d17/BKE__armature_8h.html#aa555e0c2fb76b7edbcbd5fc8344b993a">get_named_bone</a>(<a class="code" href="../../da/d17/BKE__armature_8h.html#a0c6c9c472b6b6bb51a784294b3688ae9">get_armature</a>(owner), data-&gt;<a class="code" href="../../df/d43/structbPivotConstraint.html#a3527d570e92e86ff44df23d8a66da023">subtarget</a>)) {
<a name="l00348"></a>00348                         curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00349"></a>00349                     }
<a name="l00350"></a>00350                 }
<a name="l00351"></a>00351                 
<a name="l00352"></a>00352                 <span class="comment">/* targets have already been checked for this */</span>
<a name="l00353"></a>00353                 <span class="keywordflow">continue</span>;
<a name="l00354"></a>00354             }
<a name="l00355"></a>00355             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5acb260fa057d2251a78fe7939f09e4613">CONSTRAINT_TYPE_ACTION</a>) {
<a name="l00356"></a>00356                 <a class="code" href="../../da/dc5/structbActionConstraint.html">bActionConstraint</a> *data = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l00357"></a>00357                 
<a name="l00358"></a>00358                 <span class="comment">/* validate action */</span>
<a name="l00359"></a>00359                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../da/dc5/structbActionConstraint.html#a6b1be879529b9ddc52d3ea079ca670b3">act</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) 
<a name="l00360"></a>00360                     curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00361"></a>00361             }
<a name="l00362"></a>00362             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5adb7c70567fff24da35d0186e600ee38b">CONSTRAINT_TYPE_FOLLOWPATH</a>) {
<a name="l00363"></a>00363                 <a class="code" href="../../d4/dc4/structbFollowPathConstraint.html">bFollowPathConstraint</a> *data = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l00364"></a>00364                 
<a name="l00365"></a>00365                 <span class="comment">/* don&#39;t allow track/up axes to be the same */</span>
<a name="l00366"></a>00366                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d4/dc4/structbFollowPathConstraint.html#a09f270d993ecee5d79db6ec79dff33cf">upflag</a>==data-&gt;<a class="code" href="../../d4/dc4/structbFollowPathConstraint.html#afb33465118ada3736432f30fb90233c1">trackflag</a>)
<a name="l00367"></a>00367                     curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00368"></a>00368                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d4/dc4/structbFollowPathConstraint.html#a09f270d993ecee5d79db6ec79dff33cf">upflag</a>+3==data-&gt;<a class="code" href="../../d4/dc4/structbFollowPathConstraint.html#afb33465118ada3736432f30fb90233c1">trackflag</a>)
<a name="l00369"></a>00369                     curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00370"></a>00370             }
<a name="l00371"></a>00371             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a0a299f49fea25012a0b3cf4fab903ad7">CONSTRAINT_TYPE_TRACKTO</a>) {
<a name="l00372"></a>00372                 <a class="code" href="../../dd/d05/structbTrackToConstraint.html">bTrackToConstraint</a> *data = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l00373"></a>00373                 
<a name="l00374"></a>00374                 <span class="comment">/* don&#39;t allow track/up axes to be the same */</span>
<a name="l00375"></a>00375                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../dd/d05/structbTrackToConstraint.html#a6f0450a775ae6ae088a8d2aed7f9fd8a">reserved2</a>==data-&gt;<a class="code" href="../../dd/d05/structbTrackToConstraint.html#a57a6c51fb9b08f803a88be5ca6efab07">reserved1</a>)
<a name="l00376"></a>00376                     curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00377"></a>00377                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../dd/d05/structbTrackToConstraint.html#a6f0450a775ae6ae088a8d2aed7f9fd8a">reserved2</a>+3==data-&gt;<a class="code" href="../../dd/d05/structbTrackToConstraint.html#a57a6c51fb9b08f803a88be5ca6efab07">reserved1</a>)
<a name="l00378"></a>00378                     curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00379"></a>00379             }
<a name="l00380"></a>00380             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5ac9eb1f7a921d259ad6baeea151f04630">CONSTRAINT_TYPE_LOCKTRACK</a>) {
<a name="l00381"></a>00381                 <a class="code" href="../../d6/d26/structbLockTrackConstraint.html">bLockTrackConstraint</a> *data = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l00382"></a>00382                 
<a name="l00383"></a>00383                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d6/d26/structbLockTrackConstraint.html#a4fb383e2f559d22e3b93ac8a0bb6da5f">lockflag</a>==data-&gt;<a class="code" href="../../d6/d26/structbLockTrackConstraint.html#a73144e0df0fae9b7518e197f26f3cc88">trackflag</a>)
<a name="l00384"></a>00384                     curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00385"></a>00385                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d6/d26/structbLockTrackConstraint.html#a4fb383e2f559d22e3b93ac8a0bb6da5f">lockflag</a>+3==data-&gt;<a class="code" href="../../d6/d26/structbLockTrackConstraint.html#a73144e0df0fae9b7518e197f26f3cc88">trackflag</a>)
<a name="l00386"></a>00386                     curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00387"></a>00387             }
<a name="l00388"></a>00388             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a71924f8e323782bf927aef8aaab46e97">CONSTRAINT_TYPE_SPLINEIK</a>) {
<a name="l00389"></a>00389                 <a class="code" href="../../d5/d7b/structbSplineIKConstraint.html">bSplineIKConstraint</a> *data = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l00390"></a>00390                 
<a name="l00391"></a>00391                 <span class="comment">/* if the number of points does not match the amount required by the chain length,</span>
<a name="l00392"></a>00392 <span class="comment">                 * free the points array and request a rebind...</span>
<a name="l00393"></a>00393 <span class="comment">                 */</span>
<a name="l00394"></a>00394                 <span class="keywordflow">if</span> ((data-&gt;<a class="code" href="../../d5/d7b/structbSplineIKConstraint.html#a50b3b161aaa52ff5a9f62e02e43caf63">points</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (data-&gt;<a class="code" href="../../d5/d7b/structbSplineIKConstraint.html#ac2c9ec953f800fb957c75d4a38099426">numpoints</a> != data-&gt;<a class="code" href="../../d5/d7b/structbSplineIKConstraint.html#a1ab06cba015c9e09e183d550316ca768">chainlen</a>+1)) {
<a name="l00395"></a>00395                     <span class="comment">/* free the points array */</span>
<a name="l00396"></a>00396                     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d5/d7b/structbSplineIKConstraint.html#a50b3b161aaa52ff5a9f62e02e43caf63">points</a>) {
<a name="l00397"></a>00397                         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(data-&gt;<a class="code" href="../../d5/d7b/structbSplineIKConstraint.html#a50b3b161aaa52ff5a9f62e02e43caf63">points</a>);
<a name="l00398"></a>00398                         data-&gt;<a class="code" href="../../d5/d7b/structbSplineIKConstraint.html#a50b3b161aaa52ff5a9f62e02e43caf63">points</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00399"></a>00399                     }
<a name="l00400"></a>00400                     
<a name="l00401"></a>00401                     <span class="comment">/* clear the bound flag, forcing a rebind next time this is evaluated */</span>
<a name="l00402"></a>00402                     data-&gt;<a class="code" href="../../d5/d7b/structbSplineIKConstraint.html#ac9e02d45be24f996d141458c20a8b758">flag</a> &amp;= ~<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#aa1118db5d0284a97d9dc7fca1799887daae9aba138f140ee155f5e0c6da9e1bfc">CONSTRAINT_SPLINEIK_BOUND</a>;
<a name="l00403"></a>00403                 }
<a name="l00404"></a>00404             }
<a name="l00405"></a>00405             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a3119d40b7e938fe99cbc91a9c75bdf9e">CONSTRAINT_TYPE_FOLLOWTRACK</a>) {
<a name="l00406"></a>00406                 <a class="code" href="../../d5/de6/structbFollowTrackConstraint.html">bFollowTrackConstraint</a> *data = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l00407"></a>00407 
<a name="l00408"></a>00408                 <span class="keywordflow">if</span> ((data-&gt;<a class="code" href="../../d5/de6/structbFollowTrackConstraint.html#aa350d31beb147b9d6ecb3dfff9c9c792">flag</a>&amp;<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a326565741c55e72ef7499d78b9cdf545ad71fdab97f682ec802202d50765e62b7">CAMERASOLVER_ACTIVECLIP</a>)==0) {
<a name="l00409"></a>00409                     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d5/de6/structbFollowTrackConstraint.html#a3eda8a26a14814fca95654254ebda0a7">clip</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; data-&gt;<a class="code" href="../../d5/de6/structbFollowTrackConstraint.html#a177eee43aa9a6e0e8c6fda1b1c443f5e">track</a>[0]) {
<a name="l00410"></a>00410                         <a class="code" href="../../d9/ddb/structMovieTracking.html">MovieTracking</a> *tracking= &amp;data-&gt;<a class="code" href="../../d5/de6/structbFollowTrackConstraint.html#a3eda8a26a14814fca95654254ebda0a7">clip</a>-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>;
<a name="l00411"></a>00411                         <a class="code" href="../../d2/de6/structMovieTrackingObject.html">MovieTrackingObject</a> *tracking_object;
<a name="l00412"></a>00412 
<a name="l00413"></a>00413                         <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d5/de6/structbFollowTrackConstraint.html#aff460753242871341653d637a6862441">object</a>[0])
<a name="l00414"></a>00414                             tracking_object= <a class="code" href="../../da/d72/BKE__tracking_8h.html#a44872d3e133985f2608b4a5b3465417e">BKE_tracking_named_object</a>(tracking, data-&gt;<a class="code" href="../../d5/de6/structbFollowTrackConstraint.html#aff460753242871341653d637a6862441">object</a>);
<a name="l00415"></a>00415                         <span class="keywordflow">else</span>
<a name="l00416"></a>00416                             tracking_object= <a class="code" href="../../da/d72/BKE__tracking_8h.html#a6cf53366cb46f7d547264460318ef68b">BKE_tracking_get_camera_object</a>(tracking);
<a name="l00417"></a>00417 
<a name="l00418"></a>00418                         <span class="keywordflow">if</span> (!tracking_object) {
<a name="l00419"></a>00419                             curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00420"></a>00420                         }
<a name="l00421"></a>00421                         <span class="keywordflow">else</span> {
<a name="l00422"></a>00422                             <span class="keywordflow">if</span> (!<a class="code" href="../../da/d72/BKE__tracking_8h.html#af41c185b3eac53033ba48fcb2be7e76c">BKE_tracking_named_track</a>(tracking, tracking_object, data-&gt;<a class="code" href="../../d5/de6/structbFollowTrackConstraint.html#a177eee43aa9a6e0e8c6fda1b1c443f5e">track</a>))
<a name="l00423"></a>00423                                 curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00424"></a>00424                         }
<a name="l00425"></a>00425                     }
<a name="l00426"></a>00426                     <span class="keywordflow">else</span> curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00427"></a>00427                 }
<a name="l00428"></a>00428             }
<a name="l00429"></a>00429             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a6add20c4d241c5a886ce8b6b86f363cd">CONSTRAINT_TYPE_CAMERASOLVER</a>) {
<a name="l00430"></a>00430                 <a class="code" href="../../d3/d2e/structbCameraSolverConstraint.html">bCameraSolverConstraint</a> *data = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l00431"></a>00431 
<a name="l00432"></a>00432                 <span class="keywordflow">if</span> ((data-&gt;<a class="code" href="../../d3/d2e/structbCameraSolverConstraint.html#a4d8b3d9913a5cb12eea4aed65fd642de">flag</a>&amp;<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a326565741c55e72ef7499d78b9cdf545ad71fdab97f682ec802202d50765e62b7">CAMERASOLVER_ACTIVECLIP</a>)==0 &amp;&amp; data-&gt;<a class="code" href="../../d3/d2e/structbCameraSolverConstraint.html#a0ab3030b369b8e2c63210061c9e0bd1d">clip</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00433"></a>00433                     curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00434"></a>00434             }
<a name="l00435"></a>00435             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a3321fd3e52140da450d8f6725b3678af">CONSTRAINT_TYPE_OBJECTSOLVER</a>) {
<a name="l00436"></a>00436                 <a class="code" href="../../db/d59/structbObjectSolverConstraint.html">bObjectSolverConstraint</a> *data = curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l00437"></a>00437 
<a name="l00438"></a>00438                 <span class="keywordflow">if</span> ((data-&gt;<a class="code" href="../../db/d59/structbObjectSolverConstraint.html#a26fbb357b862c76abbdd6c72720a649e">flag</a>&amp;<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a326565741c55e72ef7499d78b9cdf545ad71fdab97f682ec802202d50765e62b7">CAMERASOLVER_ACTIVECLIP</a>)==0 &amp;&amp; data-&gt;<a class="code" href="../../db/d59/structbObjectSolverConstraint.html#a5219c2f1918b3f468a05565ec61a00df">clip</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00439"></a>00439                     curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00440"></a>00440             }
<a name="l00441"></a>00441             
<a name="l00442"></a>00442             <span class="comment">/* Check targets for constraints */</span>
<a name="l00443"></a>00443             <span class="keywordflow">if</span> (cti &amp;&amp; cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a25b05ed0f4c02b26dbbc775b47d0b934">get_constraint_targets</a>) {
<a name="l00444"></a>00444                 cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a25b05ed0f4c02b26dbbc775b47d0b934">get_constraint_targets</a>(curcon, &amp;targets);
<a name="l00445"></a>00445                 
<a name="l00446"></a>00446                 <span class="comment">/* disable and clear constraints targets that are incorrect */</span>
<a name="l00447"></a>00447                 <span class="keywordflow">for</span> (ct= targets.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ct; ct= ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a5ea4a1b1fa4761a30cb66c75a8ac9054">next</a>) {
<a name="l00448"></a>00448                     <span class="comment">/* general validity checks (for those constraints that need this) */</span>
<a name="l00449"></a>00449                     <span class="keywordflow">if</span> (<a class="code" href="../../df/dac/BKE__object_8h.html#a10999dc4914a9ff4141337d5ead891ae">exist_object</a>(ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a0f75cb18129bdb2c0aee21ac528b8f5e">tar</a>) == 0) {
<a name="l00450"></a>00450                         <span class="comment">/* object doesn&#39;t exist, but constraint requires target */</span>
<a name="l00451"></a>00451                         ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a0f75cb18129bdb2c0aee21ac528b8f5e">tar</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00452"></a>00452                         curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00453"></a>00453                     }
<a name="l00454"></a>00454                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a0f75cb18129bdb2c0aee21ac528b8f5e">tar</a> == owner) {
<a name="l00455"></a>00455                         <span class="keywordflow">if</span> (type == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#adfb54b57e8687ce7b32072d253bfde5ca8f84f807a0f7d3897ed2a2d07dbb93d8">CONSTRAINT_OBTYPE_BONE</a>) {
<a name="l00456"></a>00456                             <span class="keywordflow">if</span> (!<a class="code" href="../../da/d17/BKE__armature_8h.html#aa555e0c2fb76b7edbcbd5fc8344b993a">get_named_bone</a>(<a class="code" href="../../da/d17/BKE__armature_8h.html#a0c6c9c472b6b6bb51a784294b3688ae9">get_armature</a>(owner), ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#ab1f6a09b2a30f6f55449e3e5871fafed">subtarget</a>)) {
<a name="l00457"></a>00457                                 <span class="comment">/* bone must exist in armature... */</span>
<a name="l00458"></a>00458                                 <span class="comment">// TODO: clear subtarget?</span>
<a name="l00459"></a>00459                                 curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00460"></a>00460                             }
<a name="l00461"></a>00461                             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a8e947cbe29071a1c347abe644fe9c0c1">name</a>, ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#ab1f6a09b2a30f6f55449e3e5871fafed">subtarget</a>) == 0) {
<a name="l00462"></a>00462                                 <span class="comment">/* cannot target self */</span>
<a name="l00463"></a>00463                                 ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#ab1f6a09b2a30f6f55449e3e5871fafed">subtarget</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00464"></a>00464                                 curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00465"></a>00465                             }
<a name="l00466"></a>00466                         }
<a name="l00467"></a>00467                         <span class="keywordflow">else</span> {
<a name="l00468"></a>00468                             <span class="comment">/* cannot use self as target */</span>
<a name="l00469"></a>00469                             ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a0f75cb18129bdb2c0aee21ac528b8f5e">tar</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00470"></a>00470                             curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00471"></a>00471                         }
<a name="l00472"></a>00472                     }
<a name="l00473"></a>00473                     
<a name="l00474"></a>00474                     <span class="comment">/* target checks for specific constraints */</span>
<a name="l00475"></a>00475                     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5adb7c70567fff24da35d0186e600ee38b">CONSTRAINT_TYPE_FOLLOWPATH</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5ac424899ac5c4e35a6d54f817f5756e5f">CONSTRAINT_TYPE_CLAMPTO</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a71924f8e323782bf927aef8aaab46e97">CONSTRAINT_TYPE_SPLINEIK</a>)) {
<a name="l00476"></a>00476                         <span class="keywordflow">if</span> (ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a0f75cb18129bdb2c0aee21ac528b8f5e">tar</a>) {
<a name="l00477"></a>00477                             <span class="keywordflow">if</span> (ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a0f75cb18129bdb2c0aee21ac528b8f5e">tar</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> != <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>) {
<a name="l00478"></a>00478                                 ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a0f75cb18129bdb2c0aee21ac528b8f5e">tar</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00479"></a>00479                                 curcon-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> |= <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdac624d1811979843b913fe2a7c3833c53">CONSTRAINT_DISABLE</a>;
<a name="l00480"></a>00480                             }
<a name="l00481"></a>00481                             <span class="keywordflow">else</span> {
<a name="l00482"></a>00482                                 <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a0f75cb18129bdb2c0aee21ac528b8f5e">tar</a>-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00483"></a>00483                                 
<a name="l00484"></a>00484                                 <span class="comment">/* auto-set &#39;Path&#39; setting on curve so this works  */</span>
<a name="l00485"></a>00485                                 cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> |= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae59d98d3a2c7e6fddf4aa7fff72bcf88">CU_PATH</a>;
<a name="l00486"></a>00486                             }
<a name="l00487"></a>00487                         }                       
<a name="l00488"></a>00488                     }
<a name="l00489"></a>00489                 }   
<a name="l00490"></a>00490                 
<a name="l00491"></a>00491                 <span class="comment">/* free any temporary targets */</span>
<a name="l00492"></a>00492                 <span class="keywordflow">if</span> (cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a5afd4078d269cd49108678e99cca935f">flush_constraint_targets</a>)
<a name="l00493"></a>00493                     cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a5afd4078d269cd49108678e99cca935f">flush_constraint_targets</a>(curcon, &amp;targets, 0);
<a name="l00494"></a>00494             }
<a name="l00495"></a>00495         }
<a name="l00496"></a>00496     }
<a name="l00497"></a>00497 }
<a name="l00498"></a>00498 
<a name="l00499"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a9c7b5ac144c614afd8c693d833ad1f10">00499</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d7a/ED__object_8h.html#a90879e5510cd0af7f8050cc6f4462e2d">object_test_constraints</a> (<a class="code" href="../../de/de7/structObject.html">Object</a> *owner)
<a name="l00500"></a>00500 {
<a name="l00501"></a>00501     <span class="keywordflow">if</span> (owner-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)
<a name="l00502"></a>00502         <a class="code" href="../../d4/d72/object__constraint_8c.html#a64bb9814225b5f7a823e3cf3f27a03bf">test_constraints</a>(owner, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00503"></a>00503     
<a name="l00504"></a>00504     <span class="keywordflow">if</span> (owner-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a> &amp;&amp; owner-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>) {
<a name="l00505"></a>00505         <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan;
<a name="l00506"></a>00506         
<a name="l00507"></a>00507         <span class="keywordflow">for</span> (pchan= owner-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; pchan; pchan= pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a73c14c1cca1a2d1e91778f44578eeca0">next</a>) {
<a name="l00508"></a>00508             <span class="keywordflow">if</span> (pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)
<a name="l00509"></a>00509                 <a class="code" href="../../d4/d72/object__constraint_8c.html#a64bb9814225b5f7a823e3cf3f27a03bf">test_constraints</a>(owner, pchan);
<a name="l00510"></a>00510         }
<a name="l00511"></a>00511     }
<a name="l00512"></a>00512 }
<a name="l00513"></a>00513 
<a name="l00514"></a>00514 
<a name="l00515"></a>00515 <span class="comment">/************************ generic functions for operators using constraint names and data context *********************/</span>
<a name="l00516"></a>00516 
<a name="l00517"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a60457a8f1c34aeede499d2dc6883d477">00517</a> <span class="preprocessor">#define EDIT_CONSTRAINT_OWNER_OBJECT    0</span>
<a name="l00518"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a54fa0c3673b6ca266a7700dd92c95772">00518</a> <span class="preprocessor"></span><span class="preprocessor">#define EDIT_CONSTRAINT_OWNER_BONE      1</span>
<a name="l00519"></a>00519 <span class="preprocessor"></span>
<a name="l00520"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#ab6b9066ba5ab4ef45b7638eb171d8548">00520</a> <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> <a class="code" href="../../d4/d72/object__constraint_8c.html#ab6b9066ba5ab4ef45b7638eb171d8548">constraint_owner_items</a>[] = {
<a name="l00521"></a>00521     {<a class="code" href="../../d4/d72/object__constraint_8c.html#a60457a8f1c34aeede499d2dc6883d477">EDIT_CONSTRAINT_OWNER_OBJECT</a>, <span class="stringliteral">&quot;OBJECT&quot;</span>, 0, <span class="stringliteral">&quot;Object&quot;</span>, <span class="stringliteral">&quot;Edit a constraint on the active object&quot;</span>},
<a name="l00522"></a>00522     {<a class="code" href="../../d4/d72/object__constraint_8c.html#a54fa0c3673b6ca266a7700dd92c95772">EDIT_CONSTRAINT_OWNER_BONE</a>, <span class="stringliteral">&quot;BONE&quot;</span>, 0, <span class="stringliteral">&quot;Bone&quot;</span>, <span class="stringliteral">&quot;Edit a constraint on the active bone&quot;</span>},
<a name="l00523"></a>00523     {0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL}};
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 
<a name="l00526"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a7585a496daf641f27e94daede3b43e1b">00526</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a7585a496daf641f27e94daede3b43e1b">edit_constraint_poll_generic</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/d61/structStructRNA.html">StructRNA</a> *rna_type)
<a name="l00527"></a>00527 {
<a name="l00528"></a>00528     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> ptr= <a class="code" href="../../df/d01/BKE__context_8h.html#a67398d15e34f7a4b3c0b5eec1bf5fb94">CTX_data_pointer_get_type</a>(C, <span class="stringliteral">&quot;constraint&quot;</span>, rna_type);
<a name="l00529"></a>00529     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= (ptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a7afa52885727738cb03bbdf46e808e1b">id</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>) ? ptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a7afa52885727738cb03bbdf46e808e1b">id</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a> : <a class="code" href="../../da/d7a/ED__object_8h.html#a0a87646a151e018a119ed266356bb24b">ED_object_active_context</a>(C);
<a name="l00530"></a>00530 
<a name="l00531"></a>00531     <span class="keywordflow">if</span> (!ob || ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>) <span class="keywordflow">return</span> 0;
<a name="l00532"></a>00532     <span class="keywordflow">if</span> (ptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a7afa52885727738cb03bbdf46e808e1b">id</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a> &amp;&amp; ((<a class="code" href="../../d8/d7e/structID.html">ID</a>*)ptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a7afa52885727738cb03bbdf46e808e1b">id</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>)-&gt;lib) <span class="keywordflow">return</span> 0;
<a name="l00533"></a>00533 
<a name="l00534"></a>00534     <span class="keywordflow">return</span> 1;
<a name="l00535"></a>00535 }
<a name="l00536"></a>00536 
<a name="l00537"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a366ae312809796ad64aca6320750751a">00537</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a366ae312809796ad64aca6320750751a">edit_constraint_poll</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l00538"></a>00538 {
<a name="l00539"></a>00539     <span class="keywordflow">return</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a7585a496daf641f27e94daede3b43e1b">edit_constraint_poll_generic</a>(C, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#a46220a132f6713aaeb269ef7c811a20b">RNA_Constraint</a>);
<a name="l00540"></a>00540 }
<a name="l00541"></a>00541 
<a name="l00542"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#ad48e444f657b579369eb5b184b6c5761">00542</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#ad48e444f657b579369eb5b184b6c5761">edit_constraint_properties</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00543"></a>00543 {
<a name="l00544"></a>00544     <a class="code" href="../../dc/d7e/rna__define_8c.html#ac53a3ed18da454971065d5b4e4cb4d62">RNA_def_string</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;constraint&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../d1/db4/DNA__defs_8h.html#ac7c0207aa5a0e10d378be03b68041350">MAX_NAME</a>, <span class="stringliteral">&quot;Constraint&quot;</span>, <span class="stringliteral">&quot;Name of the constraint to edit&quot;</span>);
<a name="l00545"></a>00545     <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;owner&quot;</span>, constraint_owner_items, 0, <span class="stringliteral">&quot;Owner&quot;</span>, <span class="stringliteral">&quot;The owner of this constraint&quot;</span>);
<a name="l00546"></a>00546 }
<a name="l00547"></a>00547 
<a name="l00548"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#af873978d94c6d92c46aa6e2547741278">00548</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#af873978d94c6d92c46aa6e2547741278">edit_constraint_invoke_properties</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00549"></a>00549 {
<a name="l00550"></a>00550     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> ptr= <a class="code" href="../../df/d01/BKE__context_8h.html#a67398d15e34f7a4b3c0b5eec1bf5fb94">CTX_data_pointer_get_type</a>(C, <span class="stringliteral">&quot;constraint&quot;</span>, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#a46220a132f6713aaeb269ef7c811a20b">RNA_Constraint</a>);
<a name="l00551"></a>00551     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= (ptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a7afa52885727738cb03bbdf46e808e1b">id</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>)?ptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a7afa52885727738cb03bbdf46e808e1b">id</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>:<a class="code" href="../../da/d7a/ED__object_8h.html#a0a87646a151e018a119ed266356bb24b">ED_object_active_context</a>(C);
<a name="l00552"></a>00552     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l00553"></a>00553     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list;
<a name="l00554"></a>00554     
<a name="l00555"></a>00555     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;constraint&quot;</span>) &amp;&amp; <a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;owner&quot;</span>))
<a name="l00556"></a>00556         <span class="keywordflow">return</span> 1;
<a name="l00557"></a>00557     
<a name="l00558"></a>00558     <span class="keywordflow">if</span> (ptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>) {
<a name="l00559"></a>00559         con = ptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>;
<a name="l00560"></a>00560         <a class="code" href="../../d3/d10/rna__access_8c.html#a229b9421e0a1d2e5fd079ec933a2d6f5">RNA_string_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;constraint&quot;</span>, con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a331611e15b92efae7bdd74c1a849e8e6">name</a>);
<a name="l00561"></a>00561         
<a name="l00562"></a>00562         list = <a class="code" href="../../da/d7a/ED__object_8h.html#a10a5db8d564962968141ad56bb055f65">get_constraint_lb</a>(ob, con, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00563"></a>00563         
<a name="l00564"></a>00564         <span class="keywordflow">if</span> (&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a> == list)
<a name="l00565"></a>00565             <a class="code" href="../../d3/d10/rna__access_8c.html#ad70d450cec9fe951de69b8c9128b8cc4">RNA_enum_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;owner&quot;</span>, <a class="code" href="../../d4/d72/object__constraint_8c.html#a60457a8f1c34aeede499d2dc6883d477">EDIT_CONSTRAINT_OWNER_OBJECT</a>);
<a name="l00566"></a>00566         <span class="keywordflow">else</span>
<a name="l00567"></a>00567             <a class="code" href="../../d3/d10/rna__access_8c.html#ad70d450cec9fe951de69b8c9128b8cc4">RNA_enum_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;owner&quot;</span>, <a class="code" href="../../d4/d72/object__constraint_8c.html#a54fa0c3673b6ca266a7700dd92c95772">EDIT_CONSTRAINT_OWNER_BONE</a>);
<a name="l00568"></a>00568         
<a name="l00569"></a>00569         <span class="keywordflow">return</span> 1;
<a name="l00570"></a>00570     }
<a name="l00571"></a>00571     
<a name="l00572"></a>00572     <span class="keywordflow">return</span> 0;
<a name="l00573"></a>00573 }
<a name="l00574"></a>00574 
<a name="l00575"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a49182e6ac9036f6c631bacf98ea1f38b">00575</a> <span class="keyword">static</span> <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *<a class="code" href="../../d4/d72/object__constraint_8c.html#a49182e6ac9036f6c631bacf98ea1f38b">edit_constraint_property_get</a>(<a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keywordtype">int</span> <a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>)
<a name="l00576"></a>00576 {
<a name="l00577"></a>00577     <span class="keywordtype">char</span> constraint_name[<a class="code" href="../../d1/db4/DNA__defs_8h.html#ac7c0207aa5a0e10d378be03b68041350">MAX_NAME</a>];
<a name="l00578"></a>00578     <span class="keywordtype">int</span> owner = <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;owner&quot;</span>);
<a name="l00579"></a>00579     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l00580"></a>00580     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00581"></a>00581     
<a name="l00582"></a>00582     <a class="code" href="../../d3/d10/rna__access_8c.html#a810e909d61281bbb2d9fe99f9f2219ab">RNA_string_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;constraint&quot;</span>, constraint_name);
<a name="l00583"></a>00583     
<a name="l00584"></a>00584     <span class="keywordflow">if</span> (owner == <a class="code" href="../../d4/d72/object__constraint_8c.html#a60457a8f1c34aeede499d2dc6883d477">EDIT_CONSTRAINT_OWNER_OBJECT</a>) {
<a name="l00585"></a>00585         list = &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>;
<a name="l00586"></a>00586     } 
<a name="l00587"></a>00587     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (owner == <a class="code" href="../../d4/d72/object__constraint_8c.html#a54fa0c3673b6ca266a7700dd92c95772">EDIT_CONSTRAINT_OWNER_BONE</a>) {
<a name="l00588"></a>00588         <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan= <a class="code" href="../../d8/df5/BKE__action_8h.html#aec3c2979d744c68e3fdbec5adfad77f1">get_active_posechannel</a>(ob);
<a name="l00589"></a>00589         <span class="keywordflow">if</span> (pchan)
<a name="l00590"></a>00590             list = &amp;pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>;
<a name="l00591"></a>00591         <span class="keywordflow">else</span> {
<a name="l00592"></a>00592             <span class="comment">//if (G.debug &amp; G_DEBUG)</span>
<a name="l00593"></a>00593             <span class="comment">//printf(&quot;edit_constraint_property_get: No active bone for object &#39;%s&#39;\n&quot;, (ob)? ob-&gt;id.name+2 : &quot;&lt;None&gt;&quot;);</span>
<a name="l00594"></a>00594             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00595"></a>00595         }
<a name="l00596"></a>00596     }
<a name="l00597"></a>00597     <span class="keywordflow">else</span> {
<a name="l00598"></a>00598         <span class="comment">//if (G.debug &amp; G_DEBUG)</span>
<a name="l00599"></a>00599         <span class="comment">//printf(&quot;edit_constraint_property_get: defaulting to getting list in the standard way\n&quot;);</span>
<a name="l00600"></a>00600         list = <a class="code" href="../../da/d7a/ED__object_8h.html#a74a92e4b5b822a699db2cf03728cb370">get_active_constraints</a>(ob);
<a name="l00601"></a>00601     }
<a name="l00602"></a>00602     
<a name="l00603"></a>00603     con = <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#a368e710cf233b17fd3c673f1e26ac459">constraints_findByName</a>(list, constraint_name);
<a name="l00604"></a>00604     <span class="comment">//if (G.debug &amp; G_DEBUG)</span>
<a name="l00605"></a>00605     <span class="comment">//printf(&quot;constraint found = %p, %s\n&quot;, (void *)con, (con)?con-&gt;name:&quot;&lt;Not found&gt;&quot;);</span>
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     <span class="keywordflow">if</span> (con &amp;&amp; (type != 0) &amp;&amp; (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a> != type))
<a name="l00608"></a>00608         con = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00609"></a>00609     
<a name="l00610"></a>00610     <span class="keywordflow">return</span> con;
<a name="l00611"></a>00611 }
<a name="l00612"></a>00612 
<a name="l00613"></a>00613 <span class="comment">/* ********************** CONSTRAINT-SPECIFIC STUFF ********************* */</span>
<a name="l00614"></a>00614 
<a name="l00615"></a>00615 <span class="comment">/* ---------- Distance-Dependent Constraints ---------- */</span>
<a name="l00616"></a>00616 <span class="comment">/* StretchTo, Limit Distance */</span>
<a name="l00617"></a>00617 
<a name="l00618"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a097504cd866e1c0badc372a18300c0fc">00618</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a097504cd866e1c0badc372a18300c0fc">stretchto_reset_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00619"></a>00619 {
<a name="l00620"></a>00620     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = <a class="code" href="../../da/d7a/ED__object_8h.html#a0a87646a151e018a119ed266356bb24b">ED_object_active_context</a>(C);
<a name="l00621"></a>00621     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con = <a class="code" href="../../d4/d72/object__constraint_8c.html#a49182e6ac9036f6c631bacf98ea1f38b">edit_constraint_property_get</a>(op, ob, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5adc029945841cd527499cd6e4e5df1f14">CONSTRAINT_TYPE_STRETCHTO</a>);
<a name="l00622"></a>00622     <a class="code" href="../../d2/ddf/structbStretchToConstraint.html">bStretchToConstraint</a> *data= (con) ? (<a class="code" href="../../d2/ddf/structbStretchToConstraint.html">bStretchToConstraint</a> *)con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00623"></a>00623     
<a name="l00624"></a>00624     <span class="comment">/* despite 3 layers of checks, we may still not be able to find a constraint */</span>
<a name="l00625"></a>00625     <span class="keywordflow">if</span> (data == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00626"></a>00626         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00627"></a>00627     
<a name="l00628"></a>00628     <span class="comment">/* just set original length to 0.0, which will cause a reset on next recalc */</span>
<a name="l00629"></a>00629     data-&gt;<a class="code" href="../../d2/ddf/structbStretchToConstraint.html#a0e19a09025d89c0d7df430560c96985b">orglength</a> = 0.0f;
<a name="l00630"></a>00630     <a class="code" href="../../da/d7a/ED__object_8h.html#af9a0a7130bdc95da734476b92f6ce42c">ED_object_constraint_update</a>(ob);
<a name="l00631"></a>00631     
<a name="l00632"></a>00632     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a87355bd87948236606ac66097a378e02">ND_CONSTRAINT</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00633"></a>00633     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00634"></a>00634 }
<a name="l00635"></a>00635 
<a name="l00636"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a7f9a9d2a41606e6e93c5b3a23545da22">00636</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a7f9a9d2a41606e6e93c5b3a23545da22">stretchto_reset_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l00637"></a>00637 {
<a name="l00638"></a>00638     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d72/object__constraint_8c.html#af873978d94c6d92c46aa6e2547741278">edit_constraint_invoke_properties</a>(C, op))
<a name="l00639"></a>00639         <span class="keywordflow">return</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a097504cd866e1c0badc372a18300c0fc">stretchto_reset_exec</a>(C, op);
<a name="l00640"></a>00640     <span class="keywordflow">else</span>
<a name="l00641"></a>00641         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00642"></a>00642 }
<a name="l00643"></a>00643 
<a name="l00644"></a><a class="code" href="../../d3/d80/object__intern_8h.html#ae49cff70881f73767fcf4cd50500ab9b">00644</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a4569012d8c2691e14a8d158b4c9c3d7f">CONSTRAINT_OT_stretchto_reset</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00645"></a>00645 {
<a name="l00646"></a>00646     <span class="comment">/* identifiers */</span>
<a name="l00647"></a>00647     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Reset Original Length&quot;</span>;
<a name="l00648"></a>00648     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CONSTRAINT_OT_stretchto_reset&quot;</span>;
<a name="l00649"></a>00649     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Reset original length of bone for Stretch To Constraint&quot;</span>;
<a name="l00650"></a>00650     
<a name="l00651"></a>00651     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a097504cd866e1c0badc372a18300c0fc">stretchto_reset_exec</a>;
<a name="l00652"></a>00652     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a7f9a9d2a41606e6e93c5b3a23545da22">stretchto_reset_invoke</a>;
<a name="l00653"></a>00653     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a366ae312809796ad64aca6320750751a">edit_constraint_poll</a>;
<a name="l00654"></a>00654     
<a name="l00655"></a>00655     <span class="comment">/* flags */</span>
<a name="l00656"></a>00656     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00657"></a>00657     <a class="code" href="../../d4/d72/object__constraint_8c.html#ad48e444f657b579369eb5b184b6c5761">edit_constraint_properties</a>(ot);
<a name="l00658"></a>00658 }
<a name="l00659"></a>00659 
<a name="l00660"></a>00660 
<a name="l00661"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#ab1388808b321ad5de850ab36397f99b6">00661</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#ab1388808b321ad5de850ab36397f99b6">limitdistance_reset_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00662"></a>00662 {
<a name="l00663"></a>00663     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = <a class="code" href="../../da/d7a/ED__object_8h.html#a0a87646a151e018a119ed266356bb24b">ED_object_active_context</a>(C);
<a name="l00664"></a>00664     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con = <a class="code" href="../../d4/d72/object__constraint_8c.html#a49182e6ac9036f6c631bacf98ea1f38b">edit_constraint_property_get</a>(op, ob, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a93f32e658d1d1a07eae1680fa573e7ec">CONSTRAINT_TYPE_DISTLIMIT</a>);
<a name="l00665"></a>00665     <a class="code" href="../../db/d81/structbDistLimitConstraint.html">bDistLimitConstraint</a> *data= (con) ? (<a class="code" href="../../db/d81/structbDistLimitConstraint.html">bDistLimitConstraint</a> *)con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00666"></a>00666     
<a name="l00667"></a>00667     <span class="comment">/* despite 3 layers of checks, we may still not be able to find a constraint */</span>
<a name="l00668"></a>00668     <span class="keywordflow">if</span> (data == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00669"></a>00669         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00670"></a>00670     
<a name="l00671"></a>00671     <span class="comment">/* just set original length to 0.0, which will cause a reset on next recalc */</span>
<a name="l00672"></a>00672     data-&gt;<a class="code" href="../../db/d81/structbDistLimitConstraint.html#a92240ff45e10d07c85c848975de1f965">dist</a> = 0.0f;
<a name="l00673"></a>00673     <a class="code" href="../../da/d7a/ED__object_8h.html#af9a0a7130bdc95da734476b92f6ce42c">ED_object_constraint_update</a>(ob);
<a name="l00674"></a>00674     
<a name="l00675"></a>00675     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a87355bd87948236606ac66097a378e02">ND_CONSTRAINT</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00676"></a>00676     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00677"></a>00677 }
<a name="l00678"></a>00678 
<a name="l00679"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#ad379ec6626d5a161392164911cb54092">00679</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#ad379ec6626d5a161392164911cb54092">limitdistance_reset_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l00680"></a>00680 {
<a name="l00681"></a>00681     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d72/object__constraint_8c.html#af873978d94c6d92c46aa6e2547741278">edit_constraint_invoke_properties</a>(C, op))
<a name="l00682"></a>00682         <span class="keywordflow">return</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#ab1388808b321ad5de850ab36397f99b6">limitdistance_reset_exec</a>(C, op);
<a name="l00683"></a>00683     <span class="keywordflow">else</span>
<a name="l00684"></a>00684         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00685"></a>00685 }
<a name="l00686"></a>00686 
<a name="l00687"></a><a class="code" href="../../d3/d80/object__intern_8h.html#a283586b25708934fb155862c5251a456">00687</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a69137890406dda19e7371b1d8d6e914f">CONSTRAINT_OT_limitdistance_reset</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00688"></a>00688 {
<a name="l00689"></a>00689     <span class="comment">/* identifiers */</span>
<a name="l00690"></a>00690     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Reset Distance&quot;</span>;
<a name="l00691"></a>00691     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CONSTRAINT_OT_limitdistance_reset&quot;</span>;
<a name="l00692"></a>00692     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Reset limiting distance for Limit Distance Constraint&quot;</span>;
<a name="l00693"></a>00693     
<a name="l00694"></a>00694     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#ab1388808b321ad5de850ab36397f99b6">limitdistance_reset_exec</a>;
<a name="l00695"></a>00695     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#ad379ec6626d5a161392164911cb54092">limitdistance_reset_invoke</a>;
<a name="l00696"></a>00696     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a366ae312809796ad64aca6320750751a">edit_constraint_poll</a>;
<a name="l00697"></a>00697     
<a name="l00698"></a>00698     <span class="comment">/* flags */</span>
<a name="l00699"></a>00699     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00700"></a>00700     <a class="code" href="../../d4/d72/object__constraint_8c.html#ad48e444f657b579369eb5b184b6c5761">edit_constraint_properties</a>(ot);
<a name="l00701"></a>00701 }
<a name="l00702"></a>00702 
<a name="l00703"></a>00703 <span class="comment">/* ------------- Child-Of Constraint ------------------ */</span>
<a name="l00704"></a>00704 
<a name="l00705"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a6c47885b6bc8c898a5339d84a2b87c04">00705</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a6c47885b6bc8c898a5339d84a2b87c04">child_get_inverse_matrix</a> (<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con, <span class="keywordtype">float</span> invmat[4][4])
<a name="l00706"></a>00706 {
<a name="l00707"></a>00707     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *lastcon = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00708"></a>00708     <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00709"></a>00709     
<a name="l00710"></a>00710     <span class="comment">/* nullify inverse matrix first */</span>
<a name="l00711"></a>00711     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(invmat);
<a name="l00712"></a>00712     
<a name="l00713"></a>00713     <span class="comment">/* try to find a pose channel - assume that this is the constraint owner */</span>
<a name="l00714"></a>00714     <span class="comment">// TODO: get from context instead?</span>
<a name="l00715"></a>00715     <span class="keywordflow">if</span> (ob &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>)
<a name="l00716"></a>00716         pchan= <a class="code" href="../../d8/df5/BKE__action_8h.html#aec3c2979d744c68e3fdbec5adfad77f1">get_active_posechannel</a>(ob);
<a name="l00717"></a>00717     
<a name="l00718"></a>00718     <span class="comment">/* calculate/set inverse matrix:</span>
<a name="l00719"></a>00719 <span class="comment">     *  We just calculate all transform-stack eval up to but not including this constraint.</span>
<a name="l00720"></a>00720 <span class="comment">     *  This is because inverse should just inverse correct for just the constraint&#39;s influence</span>
<a name="l00721"></a>00721 <span class="comment">     *  when it gets applied; that is, at the time of application, we don&#39;t know anything about</span>
<a name="l00722"></a>00722 <span class="comment">     *  what follows.</span>
<a name="l00723"></a>00723 <span class="comment">     */</span>
<a name="l00724"></a>00724     <span class="keywordflow">if</span> (pchan) {
<a name="l00725"></a>00725         <span class="keywordtype">float</span> <a class="code" href="../../de/de7/structObject.html#a65d360837f87824d49ed08caf44dccb3">imat</a>[4][4], tmat[4][4];
<a name="l00726"></a>00726         <span class="keywordtype">float</span> pmat[4][4];
<a name="l00727"></a>00727         
<a name="l00728"></a>00728         <span class="comment">/* 1. calculate posemat where inverse doesn&#39;t exist yet (inverse was cleared above), </span>
<a name="l00729"></a>00729 <span class="comment">         * to use as baseline (&quot;pmat&quot;) to derive delta from. This extra calc saves users </span>
<a name="l00730"></a>00730 <span class="comment">         * from having pressing &quot;Clear Inverse&quot; first</span>
<a name="l00731"></a>00731 <span class="comment">         */</span>
<a name="l00732"></a>00732         <a class="code" href="../../da/d17/BKE__armature_8h.html#a3fe187591b5f112128d0139196accf48">where_is_pose</a>(scene, ob);
<a name="l00733"></a>00733         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(pmat, pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#ad23f235559683327d9de9463e878401c">pose_mat</a>);
<a name="l00734"></a>00734         
<a name="l00735"></a>00735         <span class="comment">/* 2. knock out constraints starting from this one */</span>
<a name="l00736"></a>00736         lastcon = pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>;
<a name="l00737"></a>00737         pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a197290be38dd24e2fd2254044a5600f2">prev</a>;
<a name="l00738"></a>00738         
<a name="l00739"></a>00739         <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a197290be38dd24e2fd2254044a5600f2">prev</a>) {
<a name="l00740"></a>00740             <span class="comment">/* new end must not point to this one, else this chain cutting is useless */</span>
<a name="l00741"></a>00741             con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a197290be38dd24e2fd2254044a5600f2">prev</a>-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00742"></a>00742         }
<a name="l00743"></a>00743         <span class="keywordflow">else</span> {
<a name="l00744"></a>00744             <span class="comment">/* constraint was first */</span>
<a name="l00745"></a>00745             pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00746"></a>00746         }
<a name="l00747"></a>00747         
<a name="l00748"></a>00748         <span class="comment">/* 3. solve pose without disabled constraints */</span>
<a name="l00749"></a>00749         <a class="code" href="../../da/d17/BKE__armature_8h.html#a3fe187591b5f112128d0139196accf48">where_is_pose</a>(scene, ob);
<a name="l00750"></a>00750         
<a name="l00751"></a>00751         <span class="comment">/* 4. determine effect of constraint by removing the newly calculated </span>
<a name="l00752"></a>00752 <span class="comment">         * pchan-&gt;pose_mat from the original pchan-&gt;pose_mat, thus determining </span>
<a name="l00753"></a>00753 <span class="comment">         * the effect of the constraint</span>
<a name="l00754"></a>00754 <span class="comment">         */</span>
<a name="l00755"></a>00755         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(imat, pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#ad23f235559683327d9de9463e878401c">pose_mat</a>);
<a name="l00756"></a>00756         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ae41a59d6db4a10a85f8fbf1e3842ba81">mult_m4_m4m4</a>(tmat, pmat, imat);
<a name="l00757"></a>00757         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(invmat, tmat);
<a name="l00758"></a>00758         
<a name="l00759"></a>00759         <span class="comment">/* 5. restore constraints */</span>
<a name="l00760"></a>00760         pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = lastcon;
<a name="l00761"></a>00761         
<a name="l00762"></a>00762         <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a197290be38dd24e2fd2254044a5600f2">prev</a>) {
<a name="l00763"></a>00763             <span class="comment">/* hook up prev to this one again */</span>
<a name="l00764"></a>00764             con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a197290be38dd24e2fd2254044a5600f2">prev</a>-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a> = con;
<a name="l00765"></a>00765         }
<a name="l00766"></a>00766         <span class="keywordflow">else</span> {
<a name="l00767"></a>00767             <span class="comment">/* set as first again */</span>
<a name="l00768"></a>00768             pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> = con;
<a name="l00769"></a>00769         }
<a name="l00770"></a>00770         
<a name="l00771"></a>00771         <span class="comment">/* 6. recalculate pose with new inv-mat applied */</span>
<a name="l00772"></a>00772         <a class="code" href="../../da/d17/BKE__armature_8h.html#a3fe187591b5f112128d0139196accf48">where_is_pose</a>(scene, ob);
<a name="l00773"></a>00773     }
<a name="l00774"></a>00774     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob) {
<a name="l00775"></a>00775         <a class="code" href="../../de/de7/structObject.html">Object</a> workob;
<a name="l00776"></a>00776         
<a name="l00777"></a>00777         <span class="comment">/* use what_does_parent to find inverse - just like for normal parenting */</span>
<a name="l00778"></a>00778         <a class="code" href="../../df/dac/BKE__object_8h.html#a47bd162131b92025c4eff4bb2316a9d2">what_does_parent</a>(scene, ob, &amp;workob);
<a name="l00779"></a>00779         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(invmat, workob.<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l00780"></a>00780     }
<a name="l00781"></a>00781 }
<a name="l00782"></a>00782 
<a name="l00783"></a>00783 <span class="comment">/* ChildOf Constraint - set inverse callback */</span>
<a name="l00784"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#abb3532a0687bbcc45c55dd5e50a3fc36">00784</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#abb3532a0687bbcc45c55dd5e50a3fc36">childof_set_inverse_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00785"></a>00785 {
<a name="l00786"></a>00786     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00787"></a>00787     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = <a class="code" href="../../da/d7a/ED__object_8h.html#a0a87646a151e018a119ed266356bb24b">ED_object_active_context</a>(C);
<a name="l00788"></a>00788     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con = <a class="code" href="../../d4/d72/object__constraint_8c.html#a49182e6ac9036f6c631bacf98ea1f38b">edit_constraint_property_get</a>(op, ob, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a23ff53dbd5e0a68bbd1656c899089630">CONSTRAINT_TYPE_CHILDOF</a>);
<a name="l00789"></a>00789     <a class="code" href="../../dd/d51/structbChildOfConstraint.html">bChildOfConstraint</a> *data= (con) ? (<a class="code" href="../../dd/d51/structbChildOfConstraint.html">bChildOfConstraint</a> *)con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00790"></a>00790 
<a name="l00791"></a>00791     <span class="comment">/* despite 3 layers of checks, we may still not be able to find a constraint */</span>
<a name="l00792"></a>00792     <span class="keywordflow">if</span> (data == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00793"></a>00793         printf(<span class="stringliteral">&quot;DEBUG: Child-Of Set Inverse - object = &#39;%s&#39;\n&quot;</span>, (ob)? ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2 : <span class="stringliteral">&quot;&lt;None&gt;&quot;</span>);
<a name="l00794"></a>00794         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Couldn&#39;t find constraint data for Child-Of Set Inverse&quot;</span>);
<a name="l00795"></a>00795         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00796"></a>00796     }
<a name="l00797"></a>00797     
<a name="l00798"></a>00798     <a class="code" href="../../d4/d72/object__constraint_8c.html#a6c47885b6bc8c898a5339d84a2b87c04">child_get_inverse_matrix</a>(scene, ob, con, data-&gt;<a class="code" href="../../dd/d51/structbChildOfConstraint.html#a0f26a2f96574dcb808d5b6876776ff78">invmat</a>);
<a name="l00799"></a>00799 
<a name="l00800"></a>00800     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a87355bd87948236606ac66097a378e02">ND_CONSTRAINT</a>, ob);
<a name="l00801"></a>00801     
<a name="l00802"></a>00802     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00803"></a>00803 }
<a name="l00804"></a>00804 
<a name="l00805"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a184434c4a00ef22f605b00929aebe0e5">00805</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a184434c4a00ef22f605b00929aebe0e5">childof_set_inverse_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l00806"></a>00806 {
<a name="l00807"></a>00807     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d72/object__constraint_8c.html#af873978d94c6d92c46aa6e2547741278">edit_constraint_invoke_properties</a>(C, op))
<a name="l00808"></a>00808         <span class="keywordflow">return</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#abb3532a0687bbcc45c55dd5e50a3fc36">childof_set_inverse_exec</a>(C, op);
<a name="l00809"></a>00809     <span class="keywordflow">else</span>
<a name="l00810"></a>00810         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00811"></a>00811 }
<a name="l00812"></a>00812 
<a name="l00813"></a><a class="code" href="../../d3/d80/object__intern_8h.html#ab3dfe871c2c0572e2812153f48862ba5">00813</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#aed9d8127c25d852029d9a3fbf7e8089a">CONSTRAINT_OT_childof_set_inverse</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00814"></a>00814 {
<a name="l00815"></a>00815     <span class="comment">/* identifiers */</span>
<a name="l00816"></a>00816     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Set Inverse&quot;</span>;
<a name="l00817"></a>00817     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CONSTRAINT_OT_childof_set_inverse&quot;</span>;
<a name="l00818"></a>00818     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Set inverse correction for ChildOf constraint&quot;</span>;
<a name="l00819"></a>00819     
<a name="l00820"></a>00820     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#abb3532a0687bbcc45c55dd5e50a3fc36">childof_set_inverse_exec</a>;
<a name="l00821"></a>00821     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a184434c4a00ef22f605b00929aebe0e5">childof_set_inverse_invoke</a>;
<a name="l00822"></a>00822     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a366ae312809796ad64aca6320750751a">edit_constraint_poll</a>;
<a name="l00823"></a>00823     
<a name="l00824"></a>00824     <span class="comment">/* flags */</span>
<a name="l00825"></a>00825     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00826"></a>00826     <a class="code" href="../../d4/d72/object__constraint_8c.html#ad48e444f657b579369eb5b184b6c5761">edit_constraint_properties</a>(ot);
<a name="l00827"></a>00827 }
<a name="l00828"></a>00828 
<a name="l00829"></a>00829 <span class="comment">/* ChildOf Constraint - clear inverse callback */</span>
<a name="l00830"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a354dc509c70ac1adf3b97e6c1932dc7a">00830</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a354dc509c70ac1adf3b97e6c1932dc7a">childof_clear_inverse_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00831"></a>00831 {
<a name="l00832"></a>00832     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = <a class="code" href="../../da/d7a/ED__object_8h.html#a0a87646a151e018a119ed266356bb24b">ED_object_active_context</a>(C);
<a name="l00833"></a>00833     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con = <a class="code" href="../../d4/d72/object__constraint_8c.html#a49182e6ac9036f6c631bacf98ea1f38b">edit_constraint_property_get</a>(op, ob, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a23ff53dbd5e0a68bbd1656c899089630">CONSTRAINT_TYPE_CHILDOF</a>);
<a name="l00834"></a>00834     <a class="code" href="../../dd/d51/structbChildOfConstraint.html">bChildOfConstraint</a> *data= (con) ? (<a class="code" href="../../dd/d51/structbChildOfConstraint.html">bChildOfConstraint</a> *)con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00835"></a>00835     
<a name="l00836"></a>00836     <span class="keywordflow">if</span> (data==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00837"></a>00837         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Childof constraint not found&quot;</span>);
<a name="l00838"></a>00838         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00839"></a>00839     }
<a name="l00840"></a>00840     
<a name="l00841"></a>00841     <span class="comment">/* simply clear the matrix */</span>
<a name="l00842"></a>00842     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(data-&gt;<a class="code" href="../../dd/d51/structbChildOfConstraint.html#a0f26a2f96574dcb808d5b6876776ff78">invmat</a>);
<a name="l00843"></a>00843     
<a name="l00844"></a>00844     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a87355bd87948236606ac66097a378e02">ND_CONSTRAINT</a>, ob);
<a name="l00845"></a>00845     
<a name="l00846"></a>00846     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00847"></a>00847 }
<a name="l00848"></a>00848 
<a name="l00849"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a62f948a7acf1661866543709554d5354">00849</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a62f948a7acf1661866543709554d5354">childof_clear_inverse_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l00850"></a>00850 {
<a name="l00851"></a>00851     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d72/object__constraint_8c.html#af873978d94c6d92c46aa6e2547741278">edit_constraint_invoke_properties</a>(C, op))
<a name="l00852"></a>00852         <span class="keywordflow">return</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a354dc509c70ac1adf3b97e6c1932dc7a">childof_clear_inverse_exec</a>(C, op);
<a name="l00853"></a>00853     <span class="keywordflow">else</span>
<a name="l00854"></a>00854         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00855"></a>00855 }
<a name="l00856"></a>00856 
<a name="l00857"></a><a class="code" href="../../d3/d80/object__intern_8h.html#a27ac654f8a97a0f08f9ab7c98b41a8f9">00857</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#afc6c618fe09dcd918a3f28ae5ac9cada">CONSTRAINT_OT_childof_clear_inverse</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00858"></a>00858 {
<a name="l00859"></a>00859     <span class="comment">/* identifiers */</span>
<a name="l00860"></a>00860     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Clear Inverse&quot;</span>;
<a name="l00861"></a>00861     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CONSTRAINT_OT_childof_clear_inverse&quot;</span>;
<a name="l00862"></a>00862     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Clear inverse correction for ChildOf constraint&quot;</span>;
<a name="l00863"></a>00863     
<a name="l00864"></a>00864     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a354dc509c70ac1adf3b97e6c1932dc7a">childof_clear_inverse_exec</a>;
<a name="l00865"></a>00865     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a62f948a7acf1661866543709554d5354">childof_clear_inverse_invoke</a>;
<a name="l00866"></a>00866     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a366ae312809796ad64aca6320750751a">edit_constraint_poll</a>;
<a name="l00867"></a>00867     
<a name="l00868"></a>00868     <span class="comment">/* flags */</span>
<a name="l00869"></a>00869     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00870"></a>00870     <a class="code" href="../../d4/d72/object__constraint_8c.html#ad48e444f657b579369eb5b184b6c5761">edit_constraint_properties</a>(ot);
<a name="l00871"></a>00871 }
<a name="l00872"></a>00872 
<a name="l00873"></a>00873 <span class="comment">/* ------------- Object Solver Constraint ------------------ */</span>
<a name="l00874"></a>00874 
<a name="l00875"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a5e75eed61258bdcaffddfccce390ca12">00875</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a5e75eed61258bdcaffddfccce390ca12">objectsolver_set_inverse_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00876"></a>00876 {
<a name="l00877"></a>00877     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00878"></a>00878     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = <a class="code" href="../../da/d7a/ED__object_8h.html#a0a87646a151e018a119ed266356bb24b">ED_object_active_context</a>(C);
<a name="l00879"></a>00879     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con = <a class="code" href="../../d4/d72/object__constraint_8c.html#a49182e6ac9036f6c631bacf98ea1f38b">edit_constraint_property_get</a>(op, ob, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a3321fd3e52140da450d8f6725b3678af">CONSTRAINT_TYPE_OBJECTSOLVER</a>);
<a name="l00880"></a>00880     <a class="code" href="../../db/d59/structbObjectSolverConstraint.html">bObjectSolverConstraint</a> *data= (con) ? (<a class="code" href="../../db/d59/structbObjectSolverConstraint.html">bObjectSolverConstraint</a> *)con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00881"></a>00881 
<a name="l00882"></a>00882     <span class="comment">/* despite 3 layers of checks, we may still not be able to find a constraint */</span>
<a name="l00883"></a>00883     <span class="keywordflow">if</span> (data == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00884"></a>00884         printf(<span class="stringliteral">&quot;DEBUG: Child-Of Set Inverse - object = &#39;%s&#39;\n&quot;</span>, (ob)? ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2 : <span class="stringliteral">&quot;&lt;None&gt;&quot;</span>);
<a name="l00885"></a>00885         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Couldn&#39;t find constraint data for Child-Of Set Inverse&quot;</span>);
<a name="l00886"></a>00886         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00887"></a>00887     }
<a name="l00888"></a>00888 
<a name="l00889"></a>00889     <a class="code" href="../../d4/d72/object__constraint_8c.html#a6c47885b6bc8c898a5339d84a2b87c04">child_get_inverse_matrix</a>(scene, ob, con, data-&gt;<a class="code" href="../../db/d59/structbObjectSolverConstraint.html#acd5dc3b174b603a620c44ff8a6824576">invmat</a>);
<a name="l00890"></a>00890 
<a name="l00891"></a>00891     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a87355bd87948236606ac66097a378e02">ND_CONSTRAINT</a>, ob);
<a name="l00892"></a>00892 
<a name="l00893"></a>00893     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00894"></a>00894 }
<a name="l00895"></a>00895 
<a name="l00896"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a8f4be4836367a05d1524665b470fc2e0">00896</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a8f4be4836367a05d1524665b470fc2e0">objectsolver_set_inverse_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l00897"></a>00897 {
<a name="l00898"></a>00898     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d72/object__constraint_8c.html#af873978d94c6d92c46aa6e2547741278">edit_constraint_invoke_properties</a>(C, op))
<a name="l00899"></a>00899         <span class="keywordflow">return</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a5e75eed61258bdcaffddfccce390ca12">objectsolver_set_inverse_exec</a>(C, op);
<a name="l00900"></a>00900     <span class="keywordflow">else</span>
<a name="l00901"></a>00901         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00902"></a>00902 }
<a name="l00903"></a>00903 
<a name="l00904"></a><a class="code" href="../../d3/d80/object__intern_8h.html#a00fe50374186f5b427da43e8129e0ccb">00904</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a66d7e90c3b7f65cb5f1cc0269456b5d0">CONSTRAINT_OT_objectsolver_set_inverse</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00905"></a>00905 {
<a name="l00906"></a>00906     <span class="comment">/* identifiers */</span>
<a name="l00907"></a>00907     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Set Inverse&quot;</span>;
<a name="l00908"></a>00908     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CONSTRAINT_OT_objectsolver_set_inverse&quot;</span>;
<a name="l00909"></a>00909     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Set inverse correction for ObjectSolver constraint&quot;</span>;
<a name="l00910"></a>00910 
<a name="l00911"></a>00911     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a5e75eed61258bdcaffddfccce390ca12">objectsolver_set_inverse_exec</a>;
<a name="l00912"></a>00912     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a8f4be4836367a05d1524665b470fc2e0">objectsolver_set_inverse_invoke</a>;
<a name="l00913"></a>00913     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a366ae312809796ad64aca6320750751a">edit_constraint_poll</a>;
<a name="l00914"></a>00914 
<a name="l00915"></a>00915     <span class="comment">/* flags */</span>
<a name="l00916"></a>00916     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00917"></a>00917     <a class="code" href="../../d4/d72/object__constraint_8c.html#ad48e444f657b579369eb5b184b6c5761">edit_constraint_properties</a>(ot);
<a name="l00918"></a>00918 }
<a name="l00919"></a>00919 
<a name="l00920"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a7f140e3e10ed5a97c28d3c1aaa1ee3f9">00920</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a7f140e3e10ed5a97c28d3c1aaa1ee3f9">objectsolver_clear_inverse_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00921"></a>00921 {
<a name="l00922"></a>00922     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = <a class="code" href="../../da/d7a/ED__object_8h.html#a0a87646a151e018a119ed266356bb24b">ED_object_active_context</a>(C);
<a name="l00923"></a>00923     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con = <a class="code" href="../../d4/d72/object__constraint_8c.html#a49182e6ac9036f6c631bacf98ea1f38b">edit_constraint_property_get</a>(op, ob, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a3321fd3e52140da450d8f6725b3678af">CONSTRAINT_TYPE_OBJECTSOLVER</a>);
<a name="l00924"></a>00924     <a class="code" href="../../db/d59/structbObjectSolverConstraint.html">bObjectSolverConstraint</a> *data= (con) ? (<a class="code" href="../../db/d59/structbObjectSolverConstraint.html">bObjectSolverConstraint</a> *)con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00925"></a>00925 
<a name="l00926"></a>00926     <span class="keywordflow">if</span> (data==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00927"></a>00927         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Childof constraint not found&quot;</span>);
<a name="l00928"></a>00928         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00929"></a>00929     }
<a name="l00930"></a>00930 
<a name="l00931"></a>00931     <span class="comment">/* simply clear the matrix */</span>
<a name="l00932"></a>00932     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(data-&gt;<a class="code" href="../../db/d59/structbObjectSolverConstraint.html#acd5dc3b174b603a620c44ff8a6824576">invmat</a>);
<a name="l00933"></a>00933 
<a name="l00934"></a>00934     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a87355bd87948236606ac66097a378e02">ND_CONSTRAINT</a>, ob);
<a name="l00935"></a>00935 
<a name="l00936"></a>00936     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00937"></a>00937 }
<a name="l00938"></a>00938 
<a name="l00939"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#ae8472d6ec534da885c6f2b1a3d5a0a80">00939</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#ae8472d6ec534da885c6f2b1a3d5a0a80">objectsolver_clear_inverse_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l00940"></a>00940 {
<a name="l00941"></a>00941     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d72/object__constraint_8c.html#af873978d94c6d92c46aa6e2547741278">edit_constraint_invoke_properties</a>(C, op))
<a name="l00942"></a>00942         <span class="keywordflow">return</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a7f140e3e10ed5a97c28d3c1aaa1ee3f9">objectsolver_clear_inverse_exec</a>(C, op);
<a name="l00943"></a>00943     <span class="keywordflow">else</span>
<a name="l00944"></a>00944         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00945"></a>00945 }
<a name="l00946"></a>00946 
<a name="l00947"></a><a class="code" href="../../d3/d80/object__intern_8h.html#a5983e90138d757ff5cd7008bfb8aec49">00947</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#af4144bfac93200f1c0c7ba941a5d2554">CONSTRAINT_OT_objectsolver_clear_inverse</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00948"></a>00948 {
<a name="l00949"></a>00949     <span class="comment">/* identifiers */</span>
<a name="l00950"></a>00950     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Clear Inverse&quot;</span>;
<a name="l00951"></a>00951     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CONSTRAINT_OT_objectsolver_clear_inverse&quot;</span>;
<a name="l00952"></a>00952     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Clear inverse correction for ObjectSolver constraint&quot;</span>;
<a name="l00953"></a>00953 
<a name="l00954"></a>00954     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a7f140e3e10ed5a97c28d3c1aaa1ee3f9">objectsolver_clear_inverse_exec</a>;
<a name="l00955"></a>00955     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#ae8472d6ec534da885c6f2b1a3d5a0a80">objectsolver_clear_inverse_invoke</a>;
<a name="l00956"></a>00956     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a366ae312809796ad64aca6320750751a">edit_constraint_poll</a>;
<a name="l00957"></a>00957 
<a name="l00958"></a>00958     <span class="comment">/* flags */</span>
<a name="l00959"></a>00959     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00960"></a>00960     <a class="code" href="../../d4/d72/object__constraint_8c.html#ad48e444f657b579369eb5b184b6c5761">edit_constraint_properties</a>(ot);
<a name="l00961"></a>00961 }
<a name="l00962"></a>00962 
<a name="l00963"></a>00963 <span class="comment">/***************************** BUTTONS ****************************/</span>
<a name="l00964"></a>00964 
<a name="l00965"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a2f7c4f08bb8c10347994d4caf6422d8b">00965</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d7a/ED__object_8h.html#a7ff8632c94c40fd3b6962783a0be855b">ED_object_constraint_set_active</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con)
<a name="l00966"></a>00966 {   
<a name="l00967"></a>00967     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb = <a class="code" href="../../da/d7a/ED__object_8h.html#a10a5db8d564962968141ad56bb055f65">get_constraint_lb</a>(ob, con, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00968"></a>00968     
<a name="l00969"></a>00969     <span class="comment">/* lets be nice and escape if its active already */</span>
<a name="l00970"></a>00970     <span class="comment">// NOTE: this assumes that the stack doesn&#39;t have other active ones set...</span>
<a name="l00971"></a>00971     <span class="keywordflow">if</span> ((lb &amp;&amp; con) &amp;&amp; (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#ac6a72c0507023027796fab32f3780463">flag</a> &amp; <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a0362894a1749bab66380cae2ce4b1efdaaefd9ce005a96cfcee2d70d1f9308e62">CONSTRAINT_ACTIVE</a>))
<a name="l00972"></a>00972         <span class="keywordflow">return</span>;
<a name="l00973"></a>00973     
<a name="l00974"></a>00974     <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#a60f079ce9c272104eebc86196df55e84">constraints_set_active</a>(lb, con);
<a name="l00975"></a>00975 }
<a name="l00976"></a>00976 
<a name="l00977"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#aa1a89b06e6e4605cfd52c9f916e5d5e1">00977</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d7a/ED__object_8h.html#af9a0a7130bdc95da734476b92f6ce42c">ED_object_constraint_update</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l00978"></a>00978 {
<a name="l00979"></a>00979 
<a name="l00980"></a>00980     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>) <a class="code" href="../../d8/df5/BKE__action_8h.html#a2217b3c2db934940cd12c0bb795a1a5e">update_pose_constraint_flags</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>);
<a name="l00981"></a>00981 
<a name="l00982"></a>00982     <a class="code" href="../../da/d7a/ED__object_8h.html#a90879e5510cd0af7f8050cc6f4462e2d">object_test_constraints</a>(ob);
<a name="l00983"></a>00983 
<a name="l00984"></a>00984     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>) <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>);
<a name="l00985"></a>00985     <span class="keywordflow">else</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>);
<a name="l00986"></a>00986 }
<a name="l00987"></a>00987 
<a name="l00988"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a369ea60d1f5ad48dcd73979193427366">00988</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d7a/ED__object_8h.html#acfc13cf988b9e53f8878fa54e7a456dc">ED_object_constraint_dependency_update</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l00989"></a>00989 {
<a name="l00990"></a>00990     <a class="code" href="../../da/d7a/ED__object_8h.html#af9a0a7130bdc95da734476b92f6ce42c">ED_object_constraint_update</a>(ob);
<a name="l00991"></a>00991 
<a name="l00992"></a>00992     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>) ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a64ec87fedfe2de572e1c5418d9eac677">flag</a> |= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#adcdc440dbd940088a1e1af80558e483daa8b3bbff9fe194cbe52e3aad051a19a6">POSE_RECALC</a>;    <span class="comment">// checks &amp; sorts pose channels</span>
<a name="l00993"></a>00993     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a1916587a9ec19eb3543b1c1bc54a8ded">DAG_scene_sort</a>(bmain, scene);
<a name="l00994"></a>00994 }
<a name="l00995"></a>00995 
<a name="l00996"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#ad47c85d9c6af2f439ce3618c74dd7310">00996</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#ad47c85d9c6af2f439ce3618c74dd7310">constraint_poll</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l00997"></a>00997 {
<a name="l00998"></a>00998     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> ptr= <a class="code" href="../../df/d01/BKE__context_8h.html#a67398d15e34f7a4b3c0b5eec1bf5fb94">CTX_data_pointer_get_type</a>(C, <span class="stringliteral">&quot;constraint&quot;</span>, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#a46220a132f6713aaeb269ef7c811a20b">RNA_Constraint</a>);
<a name="l00999"></a>00999     <span class="keywordflow">return</span> (ptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a7afa52885727738cb03bbdf46e808e1b">id</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a> &amp;&amp; ptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>);
<a name="l01000"></a>01000 }
<a name="l01001"></a>01001 
<a name="l01002"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a0dc723ae668420e22fa86863ff09f05d">01002</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a0dc723ae668420e22fa86863ff09f05d">constraint_delete_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l01003"></a>01003 {
<a name="l01004"></a>01004     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> ptr= <a class="code" href="../../df/d01/BKE__context_8h.html#a67398d15e34f7a4b3c0b5eec1bf5fb94">CTX_data_pointer_get_type</a>(C, <span class="stringliteral">&quot;constraint&quot;</span>, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#a46220a132f6713aaeb269ef7c811a20b">RNA_Constraint</a>);
<a name="l01005"></a>01005     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= ptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a7afa52885727738cb03bbdf46e808e1b">id</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>;
<a name="l01006"></a>01006     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con= ptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>;
<a name="l01007"></a>01007     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb = <a class="code" href="../../da/d7a/ED__object_8h.html#a10a5db8d564962968141ad56bb055f65">get_constraint_lb</a>(ob, con, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01008"></a>01008     <span class="keyword">const</span> <span class="keywordtype">short</span> is_ik= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a8061c31c9da4a7351ce57037615d2c16">CONSTRAINT_TYPE_KINEMATIC</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a71924f8e323782bf927aef8aaab46e97">CONSTRAINT_TYPE_SPLINEIK</a>);
<a name="l01009"></a>01009 
<a name="l01010"></a>01010     <span class="comment">/* free the constraint */</span>
<a name="l01011"></a>01011     <span class="keywordflow">if</span> (<a class="code" href="../../d4/ddd/BKE__constraint_8h.html#abbd4caf3eb7ada285e11379033a9555c">remove_constraint</a>(lb, con)) {
<a name="l01012"></a>01012         <span class="comment">/* there&#39;s no active constraint now, so make sure this is the case */</span>
<a name="l01013"></a>01013         <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#a60f079ce9c272104eebc86196df55e84">constraints_set_active</a>(lb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01014"></a>01014         
<a name="l01015"></a>01015         <a class="code" href="../../da/d7a/ED__object_8h.html#af9a0a7130bdc95da734476b92f6ce42c">ED_object_constraint_update</a>(ob); <span class="comment">/* needed to set the flags on posebones correctly */</span>
<a name="l01016"></a>01016 
<a name="l01017"></a>01017         <span class="comment">/* ITASC needs to be rebuilt once a constraint is removed [#26920] */</span>
<a name="l01018"></a>01018         <span class="keywordflow">if</span> (is_ik) {
<a name="l01019"></a>01019             <a class="code" href="../../d8/dd6/BIK__api_8h.html#af44761c3903b1320aacfd57cb202a176">BIK_clear_data</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>);
<a name="l01020"></a>01020         }
<a name="l01021"></a>01021 
<a name="l01022"></a>01022         <span class="comment">/* notifiers */</span>
<a name="l01023"></a>01023         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a87355bd87948236606ac66097a378e02">ND_CONSTRAINT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a9e971b3c86d560d28a06ea074e04fa84">NA_REMOVED</a>, ob);
<a name="l01024"></a>01024         
<a name="l01025"></a>01025         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01026"></a>01026     }
<a name="l01027"></a>01027     <span class="keywordflow">else</span> {
<a name="l01028"></a>01028         <span class="comment">/* couldn&#39;t remove due to some invalid data */</span>
<a name="l01029"></a>01029         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01030"></a>01030     }
<a name="l01031"></a>01031 }
<a name="l01032"></a>01032 
<a name="l01033"></a><a class="code" href="../../d3/d80/object__intern_8h.html#acb012a564781ffb22eb13156a1fbd1a9">01033</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a3decfe70f84c05e7ef8a3d70c8baa940">CONSTRAINT_OT_delete</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01034"></a>01034 {
<a name="l01035"></a>01035     <span class="comment">/* identifiers */</span>
<a name="l01036"></a>01036     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Delete Constraint&quot;</span>;
<a name="l01037"></a>01037     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CONSTRAINT_OT_delete&quot;</span>;
<a name="l01038"></a>01038     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Remove constraint from constraint stack&quot;</span>;
<a name="l01039"></a>01039     
<a name="l01040"></a>01040     <span class="comment">/* callbacks */</span>
<a name="l01041"></a>01041     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a0dc723ae668420e22fa86863ff09f05d">constraint_delete_exec</a>;
<a name="l01042"></a>01042     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#ad47c85d9c6af2f439ce3618c74dd7310">constraint_poll</a>;
<a name="l01043"></a>01043     
<a name="l01044"></a>01044     <span class="comment">/* flags */</span>
<a name="l01045"></a>01045     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>; 
<a name="l01046"></a>01046 }
<a name="l01047"></a>01047 
<a name="l01048"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a6390e15b96bf0d5aa1ed2e26dd2e6889">01048</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a6390e15b96bf0d5aa1ed2e26dd2e6889">constraint_move_down_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01049"></a>01049 {
<a name="l01050"></a>01050     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = <a class="code" href="../../da/d7a/ED__object_8h.html#a0a87646a151e018a119ed266356bb24b">ED_object_active_context</a>(C);
<a name="l01051"></a>01051     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con = <a class="code" href="../../d4/d72/object__constraint_8c.html#a49182e6ac9036f6c631bacf98ea1f38b">edit_constraint_property_get</a>(op, ob, 0);
<a name="l01052"></a>01052     
<a name="l01053"></a>01053     <span class="keywordflow">if</span> (con &amp;&amp; con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l01054"></a>01054         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *conlist= <a class="code" href="../../da/d7a/ED__object_8h.html#a10a5db8d564962968141ad56bb055f65">get_constraint_lb</a>(ob, con, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01055"></a>01055         <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *nextCon= con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>;
<a name="l01056"></a>01056         
<a name="l01057"></a>01057         <span class="comment">/* insert the nominated constraint after the one that used to be after it */</span>
<a name="l01058"></a>01058         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(conlist, con);
<a name="l01059"></a>01059         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a9c299678f8810312806da26e6132ccc7">BLI_insertlinkafter</a>(conlist, nextCon, con);
<a name="l01060"></a>01060         
<a name="l01061"></a>01061         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a87355bd87948236606ac66097a378e02">ND_CONSTRAINT</a>, ob);
<a name="l01062"></a>01062         
<a name="l01063"></a>01063         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01064"></a>01064     }
<a name="l01065"></a>01065     
<a name="l01066"></a>01066     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01067"></a>01067 }
<a name="l01068"></a>01068 
<a name="l01069"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a615d523882963352e32f4676656011bc">01069</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a615d523882963352e32f4676656011bc">constraint_move_down_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l01070"></a>01070 {
<a name="l01071"></a>01071     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d72/object__constraint_8c.html#af873978d94c6d92c46aa6e2547741278">edit_constraint_invoke_properties</a>(C, op))
<a name="l01072"></a>01072         <span class="keywordflow">return</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a6390e15b96bf0d5aa1ed2e26dd2e6889">constraint_move_down_exec</a>(C, op);
<a name="l01073"></a>01073     <span class="keywordflow">else</span>
<a name="l01074"></a>01074         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01075"></a>01075 }
<a name="l01076"></a>01076 
<a name="l01077"></a>01077 
<a name="l01078"></a><a class="code" href="../../d3/d80/object__intern_8h.html#a38e49422c7b82ca5daf998392b98f190">01078</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a6a52ab665667f88b74adf0fe88832423">CONSTRAINT_OT_move_down</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01079"></a>01079 {
<a name="l01080"></a>01080     <span class="comment">/* identifiers */</span>
<a name="l01081"></a>01081     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Move Constraint Down&quot;</span>;
<a name="l01082"></a>01082     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CONSTRAINT_OT_move_down&quot;</span>;
<a name="l01083"></a>01083     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Move constraint down in constraint stack&quot;</span>;
<a name="l01084"></a>01084     
<a name="l01085"></a>01085     <span class="comment">/* callbacks */</span>
<a name="l01086"></a>01086     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a6390e15b96bf0d5aa1ed2e26dd2e6889">constraint_move_down_exec</a>;
<a name="l01087"></a>01087     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a615d523882963352e32f4676656011bc">constraint_move_down_invoke</a>;
<a name="l01088"></a>01088     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a366ae312809796ad64aca6320750751a">edit_constraint_poll</a>;
<a name="l01089"></a>01089     
<a name="l01090"></a>01090     <span class="comment">/* flags */</span>
<a name="l01091"></a>01091     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>; 
<a name="l01092"></a>01092     <a class="code" href="../../d4/d72/object__constraint_8c.html#ad48e444f657b579369eb5b184b6c5761">edit_constraint_properties</a>(ot);
<a name="l01093"></a>01093 }
<a name="l01094"></a>01094 
<a name="l01095"></a>01095 
<a name="l01096"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#adcf0953da8d733acf529130454033886">01096</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#adcf0953da8d733acf529130454033886">constraint_move_up_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01097"></a>01097 {
<a name="l01098"></a>01098     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = <a class="code" href="../../da/d7a/ED__object_8h.html#a0a87646a151e018a119ed266356bb24b">ED_object_active_context</a>(C);
<a name="l01099"></a>01099     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con = <a class="code" href="../../d4/d72/object__constraint_8c.html#a49182e6ac9036f6c631bacf98ea1f38b">edit_constraint_property_get</a>(op, ob, 0);
<a name="l01100"></a>01100     
<a name="l01101"></a>01101     <span class="keywordflow">if</span> (con &amp;&amp; con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a197290be38dd24e2fd2254044a5600f2">prev</a>) {
<a name="l01102"></a>01102         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *conlist= <a class="code" href="../../da/d7a/ED__object_8h.html#a10a5db8d564962968141ad56bb055f65">get_constraint_lb</a>(ob, con, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01103"></a>01103         <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *prevCon= con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a197290be38dd24e2fd2254044a5600f2">prev</a>;
<a name="l01104"></a>01104         
<a name="l01105"></a>01105         <span class="comment">/* insert the nominated constraint before the one that used to be before it */</span>
<a name="l01106"></a>01106         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(conlist, con);
<a name="l01107"></a>01107         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a168dc4cffe5e3a86086f3cfc4f7b95e6">BLI_insertlinkbefore</a>(conlist, prevCon, con);
<a name="l01108"></a>01108         
<a name="l01109"></a>01109         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a87355bd87948236606ac66097a378e02">ND_CONSTRAINT</a>, ob);
<a name="l01110"></a>01110         
<a name="l01111"></a>01111         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01112"></a>01112     }
<a name="l01113"></a>01113     
<a name="l01114"></a>01114     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01115"></a>01115 }
<a name="l01116"></a>01116 
<a name="l01117"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#af0b146341bab7a11bbd4f97ae7c3a68c">01117</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#af0b146341bab7a11bbd4f97ae7c3a68c">constraint_move_up_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l01118"></a>01118 {
<a name="l01119"></a>01119     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d72/object__constraint_8c.html#af873978d94c6d92c46aa6e2547741278">edit_constraint_invoke_properties</a>(C, op))
<a name="l01120"></a>01120         <span class="keywordflow">return</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#adcf0953da8d733acf529130454033886">constraint_move_up_exec</a>(C, op);
<a name="l01121"></a>01121     <span class="keywordflow">else</span>
<a name="l01122"></a>01122         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01123"></a>01123 }
<a name="l01124"></a>01124 
<a name="l01125"></a><a class="code" href="../../d3/d80/object__intern_8h.html#a177e7c726e5c94d0a1bd307f33d92565">01125</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a962c763cff60dd32ebb2319473325a8d">CONSTRAINT_OT_move_up</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01126"></a>01126 {
<a name="l01127"></a>01127     <span class="comment">/* identifiers */</span>
<a name="l01128"></a>01128     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Move Constraint Up&quot;</span>;
<a name="l01129"></a>01129     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CONSTRAINT_OT_move_up&quot;</span>;
<a name="l01130"></a>01130     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Move constraint up in constraint stack&quot;</span>;
<a name="l01131"></a>01131     
<a name="l01132"></a>01132     <span class="comment">/* callbacks */</span>
<a name="l01133"></a>01133     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#adcf0953da8d733acf529130454033886">constraint_move_up_exec</a>;
<a name="l01134"></a>01134     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#af0b146341bab7a11bbd4f97ae7c3a68c">constraint_move_up_invoke</a>;
<a name="l01135"></a>01135     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a366ae312809796ad64aca6320750751a">edit_constraint_poll</a>;
<a name="l01136"></a>01136     
<a name="l01137"></a>01137     <span class="comment">/* flags */</span>
<a name="l01138"></a>01138     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>; 
<a name="l01139"></a>01139     <a class="code" href="../../d4/d72/object__constraint_8c.html#ad48e444f657b579369eb5b184b6c5761">edit_constraint_properties</a>(ot);
<a name="l01140"></a>01140 }
<a name="l01141"></a>01141 
<a name="l01142"></a>01142 <span class="comment">/***************************** OPERATORS ****************************/</span>
<a name="l01143"></a>01143 
<a name="l01144"></a>01144 <span class="comment">/************************ remove constraint operators *********************/</span>
<a name="l01145"></a>01145 
<a name="l01146"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#ab1f869ee0f71dd0482277ee5c26dc566">01146</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#ab1f869ee0f71dd0482277ee5c26dc566">pose_constraints_clear_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l01147"></a>01147 {
<a name="l01148"></a>01148     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C);
<a name="l01149"></a>01149     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l01150"></a>01150     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= <a class="code" href="../../df/dac/BKE__object_8h.html#a7c81fbe77e3bc5283e2746857d88c94c">object_pose_armature_get</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a86fd97bb1e59c64106c001ab29db25c7">CTX_data_active_object</a>(C));
<a name="l01151"></a>01151     
<a name="l01152"></a>01152     <span class="comment">/* free constraints for all selected bones */</span>
<a name="l01153"></a>01153     <a class="code" href="../../df/d01/BKE__context_8h.html#a63ffcaf5af72270fb66c773139bdedb2">CTX_DATA_BEGIN</a>(C, <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a>*, pchan, selected_pose_bones)
<a name="l01154"></a>01154     {
<a name="l01155"></a>01155         <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#ad5ee51f123851ce058c3e068d9df0bf2">free_constraints</a>(&amp;pchan-&gt;constraints);
<a name="l01156"></a>01156         pchan-&gt;constflag &amp;= ~(<a class="code" href="../../dc/d2a/DNA__action__types_8h.html#aa054ea9cc32895cc3299d8e9331ab3e8a946cee8332ffabf5684e8a57f5ba5a5d">PCHAN_HAS_IK</a>|<a class="code" href="../../dc/d2a/DNA__action__types_8h.html#aa054ea9cc32895cc3299d8e9331ab3e8ac0c0e30c4204303927e602fab84c6cfa">PCHAN_HAS_SPLINEIK</a>|<a class="code" href="../../dc/d2a/DNA__action__types_8h.html#aa054ea9cc32895cc3299d8e9331ab3e8a2b0c89a0d0e370b0e50e4705c78edc11">PCHAN_HAS_CONST</a>);
<a name="l01157"></a>01157     }
<a name="l01158"></a>01158     <a class="code" href="../../df/d01/BKE__context_8h.html#af19e54c354c69aacc4c6f2e2fcafde0f">CTX_DATA_END</a>;
<a name="l01159"></a>01159     
<a name="l01160"></a>01160     <span class="comment">/* force depsgraph to get recalculated since relationships removed */</span>
<a name="l01161"></a>01161     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a1916587a9ec19eb3543b1c1bc54a8ded">DAG_scene_sort</a>(bmain, scene);       <span class="comment">/* sort order of objects */</span> 
<a name="l01162"></a>01162     
<a name="l01163"></a>01163     <span class="comment">/* note, calling BIK_clear_data() isn&#39;t needed here */</span>
<a name="l01164"></a>01164 
<a name="l01165"></a>01165     <span class="comment">/* do updates */</span>
<a name="l01166"></a>01166     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>);
<a name="l01167"></a>01167     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a87355bd87948236606ac66097a378e02">ND_CONSTRAINT</a>, ob);
<a name="l01168"></a>01168     
<a name="l01169"></a>01169     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01170"></a>01170 }
<a name="l01171"></a>01171 
<a name="l01172"></a><a class="code" href="../../d3/d80/object__intern_8h.html#a7579a44aaea0d0f1d144a601161e6269">01172</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a7bfd0788342e67640405fc41faf101a2">POSE_OT_constraints_clear</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01173"></a>01173 {
<a name="l01174"></a>01174     <span class="comment">/* identifiers */</span>
<a name="l01175"></a>01175     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Clear Pose Constraints&quot;</span>;
<a name="l01176"></a>01176     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;POSE_OT_constraints_clear&quot;</span>;
<a name="l01177"></a>01177     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Clear all the constraints for the selected bones&quot;</span>;
<a name="l01178"></a>01178     
<a name="l01179"></a>01179     <span class="comment">/* callbacks */</span>
<a name="l01180"></a>01180     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#ab1f869ee0f71dd0482277ee5c26dc566">pose_constraints_clear_exec</a>;
<a name="l01181"></a>01181     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a58cfd064018383fbdd69f7d409248fbb">ED_operator_posemode</a>; <span class="comment">// XXX - do we want to ensure there are selected bones too?</span>
<a name="l01182"></a>01182 }
<a name="l01183"></a>01183 
<a name="l01184"></a>01184 
<a name="l01185"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a2273397869cf96e5074f9db7fc997030">01185</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a2273397869cf96e5074f9db7fc997030">object_constraints_clear_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l01186"></a>01186 {
<a name="l01187"></a>01187     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C);
<a name="l01188"></a>01188     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l01189"></a>01189     
<a name="l01190"></a>01190     <span class="comment">/* do freeing */</span>
<a name="l01191"></a>01191     <a class="code" href="../../df/d01/BKE__context_8h.html#a63ffcaf5af72270fb66c773139bdedb2">CTX_DATA_BEGIN</a>(C, <a class="code" href="../../de/de7/structObject.html">Object</a>*, ob, selected_editable_objects) 
<a name="l01192"></a>01192     {
<a name="l01193"></a>01193         <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#ad5ee51f123851ce058c3e068d9df0bf2">free_constraints</a>(&amp;ob-&gt;constraints);
<a name="l01194"></a>01194         <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(&amp;ob-&gt;id, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>);
<a name="l01195"></a>01195     }
<a name="l01196"></a>01196     <a class="code" href="../../df/d01/BKE__context_8h.html#af19e54c354c69aacc4c6f2e2fcafde0f">CTX_DATA_END</a>;
<a name="l01197"></a>01197     
<a name="l01198"></a>01198     <span class="comment">/* force depsgraph to get recalculated since relationships removed */</span>
<a name="l01199"></a>01199     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a1916587a9ec19eb3543b1c1bc54a8ded">DAG_scene_sort</a>(bmain, scene);       <span class="comment">/* sort order of objects */</span> 
<a name="l01200"></a>01200     
<a name="l01201"></a>01201     <span class="comment">/* do updates */</span>
<a name="l01202"></a>01202     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a87355bd87948236606ac66097a378e02">ND_CONSTRAINT</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01203"></a>01203     
<a name="l01204"></a>01204     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01205"></a>01205 }
<a name="l01206"></a>01206 
<a name="l01207"></a><a class="code" href="../../d3/d80/object__intern_8h.html#a2aff42ae8c1ad8ccbdba1ccd083643fd">01207</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a68be139f91502f3ff302abe1b90122c0">OBJECT_OT_constraints_clear</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01208"></a>01208 {
<a name="l01209"></a>01209     <span class="comment">/* identifiers */</span>
<a name="l01210"></a>01210     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Clear Object Constraints&quot;</span>;
<a name="l01211"></a>01211     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;OBJECT_OT_constraints_clear&quot;</span>;
<a name="l01212"></a>01212     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Clear all the constraints for the active Object only&quot;</span>;
<a name="l01213"></a>01213     
<a name="l01214"></a>01214     <span class="comment">/* callbacks */</span>
<a name="l01215"></a>01215     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a2273397869cf96e5074f9db7fc997030">object_constraints_clear_exec</a>;
<a name="l01216"></a>01216     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#adf69a13ccdb50f050485340e86a00d34">ED_operator_object_active_editable</a>;
<a name="l01217"></a>01217 }
<a name="l01218"></a>01218 
<a name="l01219"></a>01219 <span class="comment">/************************ copy all constraints operators *********************/</span>
<a name="l01220"></a>01220 
<a name="l01221"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#abf6b0dfa431a80098fb3e2feb330b8cd">01221</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#abf6b0dfa431a80098fb3e2feb330b8cd">pose_constraint_copy_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01222"></a>01222 {
<a name="l01223"></a>01223     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C);
<a name="l01224"></a>01224     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l01225"></a>01225     <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan = <a class="code" href="../../df/d01/BKE__context_8h.html#afd2f8912aa143c0bf416c4ade0f0b03e">CTX_data_active_pose_bone</a>(C);
<a name="l01226"></a>01226     
<a name="l01227"></a>01227     <span class="comment">/* don&#39;t do anything if bone doesn&#39;t exist or doesn&#39;t have any constraints */</span>
<a name="l01228"></a>01228     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, pchan, pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)) {
<a name="l01229"></a>01229         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;No active bone with constraints for copying&quot;</span>);
<a name="l01230"></a>01230         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01231"></a>01231     }
<a name="l01232"></a>01232     
<a name="l01233"></a>01233     <span class="comment">/* copy all constraints from active posebone to all selected posebones */</span>
<a name="l01234"></a>01234     <a class="code" href="../../df/d01/BKE__context_8h.html#a63ffcaf5af72270fb66c773139bdedb2">CTX_DATA_BEGIN</a>(C, <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a>*, chan, selected_pose_bones) 
<a name="l01235"></a>01235     {
<a name="l01236"></a>01236         <span class="comment">/* if we&#39;re not handling the object we&#39;re copying from, copy all constraints over */</span>
<a name="l01237"></a>01237         <span class="keywordflow">if</span> (pchan != chan) {
<a name="l01238"></a>01238             <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#aae4fc24d25acff1839e4df3812990864">copy_constraints</a>(&amp;chan-&gt;constraints, &amp;pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01239"></a>01239             <span class="comment">/* update flags (need to add here, not just copy) */</span>
<a name="l01240"></a>01240             chan-&gt;constflag |= pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#abf27c9382f3dd90c6a03b2e8fd69d1fc">constflag</a>;
<a name="l01241"></a>01241         }
<a name="l01242"></a>01242     }
<a name="l01243"></a>01243     <a class="code" href="../../df/d01/BKE__context_8h.html#af19e54c354c69aacc4c6f2e2fcafde0f">CTX_DATA_END</a>;
<a name="l01244"></a>01244     
<a name="l01245"></a>01245     <span class="comment">/* force depsgraph to get recalculated since new relationships added */</span>
<a name="l01246"></a>01246     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a1916587a9ec19eb3543b1c1bc54a8ded">DAG_scene_sort</a>(bmain, scene);       <span class="comment">/* sort order of objects/bones */</span>
<a name="l01247"></a>01247 
<a name="l01248"></a>01248     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a87355bd87948236606ac66097a378e02">ND_CONSTRAINT</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01249"></a>01249     
<a name="l01250"></a>01250     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01251"></a>01251 }
<a name="l01252"></a>01252 
<a name="l01253"></a><a class="code" href="../../d3/d80/object__intern_8h.html#a8db139400586f8233dfe8080e76b46bc">01253</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a4deffa009077999bf13c6c5303dafba9">POSE_OT_constraints_copy</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01254"></a>01254 {
<a name="l01255"></a>01255     <span class="comment">/* identifiers */</span>
<a name="l01256"></a>01256     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Copy Constraints to Selected&quot;</span>;
<a name="l01257"></a>01257     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;POSE_OT_constraints_copy&quot;</span>;
<a name="l01258"></a>01258     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Copy constraints to other selected bones&quot;</span>;
<a name="l01259"></a>01259     
<a name="l01260"></a>01260     <span class="comment">/* api callbacks */</span>
<a name="l01261"></a>01261     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#abf6b0dfa431a80098fb3e2feb330b8cd">pose_constraint_copy_exec</a>;
<a name="l01262"></a>01262     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a58cfd064018383fbdd69f7d409248fbb">ED_operator_posemode</a>;
<a name="l01263"></a>01263 
<a name="l01264"></a>01264     <span class="comment">/* flags */</span>
<a name="l01265"></a>01265     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01266"></a>01266 }
<a name="l01267"></a>01267 
<a name="l01268"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a9784c715a3a4e041d558d70cbd80b631">01268</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a9784c715a3a4e041d558d70cbd80b631">object_constraint_copy_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l01269"></a>01269 {
<a name="l01270"></a>01270     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C);
<a name="l01271"></a>01271     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l01272"></a>01272     <a class="code" href="../../de/de7/structObject.html">Object</a> *obact = <a class="code" href="../../da/d7a/ED__object_8h.html#a0a87646a151e018a119ed266356bb24b">ED_object_active_context</a>(C);
<a name="l01273"></a>01273     
<a name="l01274"></a>01274     <span class="comment">/* copy all constraints from active object to all selected objects */</span>
<a name="l01275"></a>01275     <a class="code" href="../../df/d01/BKE__context_8h.html#a63ffcaf5af72270fb66c773139bdedb2">CTX_DATA_BEGIN</a>(C, <a class="code" href="../../de/de7/structObject.html">Object</a>*, ob, selected_editable_objects) 
<a name="l01276"></a>01276     {
<a name="l01277"></a>01277         <span class="comment">/* if we&#39;re not handling the object we&#39;re copying from, copy all constraints over */</span>
<a name="l01278"></a>01278         <span class="keywordflow">if</span> (obact != ob) {
<a name="l01279"></a>01279             <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#aae4fc24d25acff1839e4df3812990864">copy_constraints</a>(&amp;ob-&gt;constraints, &amp;obact-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01280"></a>01280             <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(&amp;ob-&gt;id, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>);
<a name="l01281"></a>01281         }
<a name="l01282"></a>01282     }
<a name="l01283"></a>01283     <a class="code" href="../../df/d01/BKE__context_8h.html#af19e54c354c69aacc4c6f2e2fcafde0f">CTX_DATA_END</a>;
<a name="l01284"></a>01284     
<a name="l01285"></a>01285     <span class="comment">/* force depsgraph to get recalculated since new relationships added */</span>
<a name="l01286"></a>01286     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a1916587a9ec19eb3543b1c1bc54a8ded">DAG_scene_sort</a>(bmain, scene);       <span class="comment">/* sort order of objects */</span>
<a name="l01287"></a>01287     
<a name="l01288"></a>01288     <span class="comment">/* notifiers for updates */</span>
<a name="l01289"></a>01289     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a87355bd87948236606ac66097a378e02">ND_CONSTRAINT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a66ee93621fb1e26b8b9bb49dc3c2c2af">NA_ADDED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01290"></a>01290     
<a name="l01291"></a>01291     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01292"></a>01292 }
<a name="l01293"></a>01293 
<a name="l01294"></a><a class="code" href="../../d3/d80/object__intern_8h.html#a5e15d637129fa2a2341b278adb14f361">01294</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a1997bdce274e70ba5a2317d41a6e1ba2">OBJECT_OT_constraints_copy</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01295"></a>01295 {
<a name="l01296"></a>01296     <span class="comment">/* identifiers */</span>
<a name="l01297"></a>01297     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Copy Constraints to Selected&quot;</span>;
<a name="l01298"></a>01298     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;OBJECT_OT_constraints_copy&quot;</span>;
<a name="l01299"></a>01299     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Copy constraints to other selected objects&quot;</span>;
<a name="l01300"></a>01300     
<a name="l01301"></a>01301     <span class="comment">/* api callbacks */</span>
<a name="l01302"></a>01302     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a9784c715a3a4e041d558d70cbd80b631">object_constraint_copy_exec</a>;
<a name="l01303"></a>01303     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#adf69a13ccdb50f050485340e86a00d34">ED_operator_object_active_editable</a>;
<a name="l01304"></a>01304 
<a name="l01305"></a>01305     <span class="comment">/* flags */</span>
<a name="l01306"></a>01306     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01307"></a>01307 }
<a name="l01308"></a>01308 
<a name="l01309"></a>01309 <span class="comment">/************************ add constraint operators *********************/</span>
<a name="l01310"></a>01310 
<a name="l01311"></a>01311 <span class="comment">/* get the Object and/or PoseChannel to use as target */</span>
<a name="l01312"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a953a444fc4e532b4472de5b5675909b7">01312</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a953a444fc4e532b4472de5b5675909b7">get_new_constraint_target</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keywordtype">int</span> con_type, <a class="code" href="../../de/de7/structObject.html">Object</a> **tar_ob, <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> **tar_pchan, <span class="keywordtype">short</span> <a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a9a801fa87c9bf3472c399696366fe81c">add</a>)
<a name="l01313"></a>01313 {
<a name="l01314"></a>01314     <a class="code" href="../../de/de7/structObject.html">Object</a> *obact= <a class="code" href="../../da/d7a/ED__object_8h.html#a0a87646a151e018a119ed266356bb24b">ED_object_active_context</a>(C);
<a name="l01315"></a>01315     <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchanact= <a class="code" href="../../d8/df5/BKE__action_8h.html#aec3c2979d744c68e3fdbec5adfad77f1">get_active_posechannel</a>(obact);
<a name="l01316"></a>01316     <span class="keywordtype">short</span> only_curve= 0, only_mesh= 0, only_ob= 0;
<a name="l01317"></a>01317     <span class="keywordtype">short</span> found= 0;
<a name="l01318"></a>01318     
<a name="l01319"></a>01319     <span class="comment">/* clear tar_ob and tar_pchan fields before use </span>
<a name="l01320"></a>01320 <span class="comment">     *  - assume for now that both always exist...</span>
<a name="l01321"></a>01321 <span class="comment">     */</span>
<a name="l01322"></a>01322     *tar_ob= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01323"></a>01323     *tar_pchan= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01324"></a>01324     
<a name="l01325"></a>01325     <span class="comment">/* check if constraint type doesn&#39;t requires a target</span>
<a name="l01326"></a>01326 <span class="comment">     *  - if so, no need to get any targets </span>
<a name="l01327"></a>01327 <span class="comment">     */</span>
<a name="l01328"></a>01328     <span class="keywordflow">switch</span> (con_type) {
<a name="l01329"></a>01329         <span class="comment">/* no-target constraints --------------------------- */</span>
<a name="l01330"></a>01330             <span class="comment">/* null constraint - shouldn&#39;t even be added! */</span>
<a name="l01331"></a>01331         <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a82cd381e2c3f10ae3f420bd2b20e1806">CONSTRAINT_TYPE_NULL</a>:
<a name="l01332"></a>01332             <span class="comment">/* limit constraints - no targets needed */</span>
<a name="l01333"></a>01333         <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5aacf7ad78cacd4f1d8e999ef0ab64caf6">CONSTRAINT_TYPE_LOCLIMIT</a>:
<a name="l01334"></a>01334         <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a5dbe292ea3b5603f1d949964a243ba81">CONSTRAINT_TYPE_ROTLIMIT</a>:
<a name="l01335"></a>01335         <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5aca95934ef8542fe449181c527d483d5b">CONSTRAINT_TYPE_SIZELIMIT</a>:
<a name="l01336"></a>01336         <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5ae85db63d5ed121ee8b5f4095fa60ec36">CONSTRAINT_TYPE_SAMEVOL</a>:
<a name="l01337"></a>01337             <span class="keywordflow">return</span> 0;
<a name="l01338"></a>01338             
<a name="l01339"></a>01339         <span class="comment">/* restricted target-type constraints -------------- */</span>
<a name="l01340"></a>01340         <span class="comment">/* NOTE: for these, we cannot try to add a target object if no valid ones are found, since that doesn&#39;t work */</span>
<a name="l01341"></a>01341             <span class="comment">/* curve-based constraints - set the only_curve and only_ob flags */</span>
<a name="l01342"></a>01342         <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5ac424899ac5c4e35a6d54f817f5756e5f">CONSTRAINT_TYPE_CLAMPTO</a>:
<a name="l01343"></a>01343         <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5adb7c70567fff24da35d0186e600ee38b">CONSTRAINT_TYPE_FOLLOWPATH</a>:
<a name="l01344"></a>01344         <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a71924f8e323782bf927aef8aaab46e97">CONSTRAINT_TYPE_SPLINEIK</a>:
<a name="l01345"></a>01345             only_curve= 1;
<a name="l01346"></a>01346             only_ob= 1;
<a name="l01347"></a>01347             add= 0;
<a name="l01348"></a>01348             <span class="keywordflow">break</span>;
<a name="l01349"></a>01349             
<a name="l01350"></a>01350             <span class="comment">/* mesh only? */</span>
<a name="l01351"></a>01351         <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a52c1d84ee8628b318c1c5efe2a61dae2">CONSTRAINT_TYPE_SHRINKWRAP</a>:
<a name="l01352"></a>01352             only_mesh= 1;
<a name="l01353"></a>01353             only_ob= 1;
<a name="l01354"></a>01354             add= 0;
<a name="l01355"></a>01355             <span class="keywordflow">break</span>;
<a name="l01356"></a>01356             
<a name="l01357"></a>01357             <span class="comment">/* object only - add here is ok? */</span>
<a name="l01358"></a>01358         <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a44c442a006038ebc212011d1c158646f">CONSTRAINT_TYPE_RIGIDBODYJOINT</a>:
<a name="l01359"></a>01359             only_ob= 1;
<a name="l01360"></a>01360             <span class="keywordflow">break</span>;
<a name="l01361"></a>01361     }
<a name="l01362"></a>01362     
<a name="l01363"></a>01363     <span class="comment">/* if the active Object is Armature, and we can search for bones, do so... */</span>
<a name="l01364"></a>01364     <span class="keywordflow">if</span> ((obact-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>) &amp;&amp; (only_ob == 0)) {
<a name="l01365"></a>01365         <span class="comment">/* search in list of selected Pose-Channels for target */</span>
<a name="l01366"></a>01366         <a class="code" href="../../df/d01/BKE__context_8h.html#a63ffcaf5af72270fb66c773139bdedb2">CTX_DATA_BEGIN</a>(C, <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a>*, pchan, selected_pose_bones) 
<a name="l01367"></a>01367         {
<a name="l01368"></a>01368             <span class="comment">/* just use the first one that we encounter, as long as it is not the active one */</span>
<a name="l01369"></a>01369             <span class="keywordflow">if</span> (pchan != pchanact) {
<a name="l01370"></a>01370                 *tar_ob= obact;
<a name="l01371"></a>01371                 *tar_pchan= pchan;
<a name="l01372"></a>01372                 found= 1;
<a name="l01373"></a>01373                 
<a name="l01374"></a>01374                 <span class="keywordflow">break</span>;
<a name="l01375"></a>01375             }
<a name="l01376"></a>01376         }
<a name="l01377"></a>01377         <a class="code" href="../../df/d01/BKE__context_8h.html#af19e54c354c69aacc4c6f2e2fcafde0f">CTX_DATA_END</a>;
<a name="l01378"></a>01378     }
<a name="l01379"></a>01379     
<a name="l01380"></a>01380     <span class="comment">/* if not yet found, try selected Objects... */</span>
<a name="l01381"></a>01381     <span class="keywordflow">if</span> (found == 0) {
<a name="l01382"></a>01382         <span class="comment">/* search in selected objects context */</span>
<a name="l01383"></a>01383         <a class="code" href="../../df/d01/BKE__context_8h.html#a63ffcaf5af72270fb66c773139bdedb2">CTX_DATA_BEGIN</a>(C, <a class="code" href="../../de/de7/structObject.html">Object</a>*, ob, selected_objects) 
<a name="l01384"></a>01384         {
<a name="l01385"></a>01385             <span class="comment">/* just use the first object we encounter (that isn&#39;t the active object) </span>
<a name="l01386"></a>01386 <span class="comment">             * and which fulfills the criteria for the object-target that we&#39;ve got </span>
<a name="l01387"></a>01387 <span class="comment">             */</span>
<a name="l01388"></a>01388             <span class="keywordflow">if</span> ( (ob != obact) &amp;&amp;
<a name="l01389"></a>01389                  ((!only_curve) || (ob-&gt;type == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>)) &amp;&amp; 
<a name="l01390"></a>01390                  ((!only_mesh) || (ob-&gt;type == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>)) )
<a name="l01391"></a>01391             {
<a name="l01392"></a>01392                 <span class="comment">/* set target */</span>
<a name="l01393"></a>01393                 *tar_ob= ob;
<a name="l01394"></a>01394                 found= 1;
<a name="l01395"></a>01395                 
<a name="l01396"></a>01396                 <span class="comment">/* perform some special operations on the target */</span>
<a name="l01397"></a>01397                 <span class="keywordflow">if</span> (only_curve) {
<a name="l01398"></a>01398                     <span class="comment">/* Curve-Path option must be enabled for follow-path constraints to be able to work */</span>
<a name="l01399"></a>01399                     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= (<a class="code" href="../../da/d10/structCurve.html">Curve</a> *)ob-&gt;data;
<a name="l01400"></a>01400                     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> |= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae59d98d3a2c7e6fddf4aa7fff72bcf88">CU_PATH</a>;
<a name="l01401"></a>01401                 }
<a name="l01402"></a>01402                 
<a name="l01403"></a>01403                 <span class="keywordflow">break</span>;
<a name="l01404"></a>01404             }
<a name="l01405"></a>01405         }
<a name="l01406"></a>01406         <a class="code" href="../../df/d01/BKE__context_8h.html#af19e54c354c69aacc4c6f2e2fcafde0f">CTX_DATA_END</a>;
<a name="l01407"></a>01407     }
<a name="l01408"></a>01408     
<a name="l01409"></a>01409     <span class="comment">/* if still not found, add a new empty to act as a target (if allowed) */</span>
<a name="l01410"></a>01410     <span class="keywordflow">if</span> ((found == 0) &amp;&amp; (<a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a9a801fa87c9bf3472c399696366fe81c">add</a>)) {
<a name="l01411"></a>01411         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l01412"></a>01412         <a class="code" href="../../d3/da9/structBase.html">Base</a> *base= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a71a9117cf3b8db805eb031926bff279a">BASACT</a>, *newbase=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01413"></a>01413         <a class="code" href="../../de/de7/structObject.html">Object</a> *obt;
<a name="l01414"></a>01414         
<a name="l01415"></a>01415         <span class="comment">/* add new target object */</span>
<a name="l01416"></a>01416         obt= <a class="code" href="../../df/dac/BKE__object_8h.html#a85239425cf97a3a7bdc40dd2590490c4">add_object</a>(scene, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aae7aa3fbf86ed3619e54240da402fab1">OB_EMPTY</a>);
<a name="l01417"></a>01417         
<a name="l01418"></a>01418         <span class="comment">/* set layers OK */</span>
<a name="l01419"></a>01419         newbase= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a71a9117cf3b8db805eb031926bff279a">BASACT</a>;
<a name="l01420"></a>01420         newbase-&gt;lay= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a8c3a6cb18ff56393b617978c497c54aa">lay</a>;
<a name="l01421"></a>01421         obt-&gt;<a class="code" href="../../de/de7/structObject.html#aa9cfa964651e1e2f3044c9c79cf004b3">lay</a>= newbase-&gt;lay;
<a name="l01422"></a>01422         
<a name="l01423"></a>01423         <span class="comment">/* transform cent to global coords for loc */</span>
<a name="l01424"></a>01424         <span class="keywordflow">if</span> (pchanact) {
<a name="l01425"></a>01425             <span class="comment">/* since by default, IK targets the tip of the last bone, use the tip of the active PoseChannel </span>
<a name="l01426"></a>01426 <span class="comment">             * if adding a target for an IK Constraint</span>
<a name="l01427"></a>01427 <span class="comment">             */</span>
<a name="l01428"></a>01428             <span class="keywordflow">if</span> (con_type == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a8061c31c9da4a7351ce57037615d2c16">CONSTRAINT_TYPE_KINEMATIC</a>)
<a name="l01429"></a>01429                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad7be0179ee8a128512e2c7f0ad11c8d8">mul_v3_m4v3</a>(obt-&gt;<a class="code" href="../../de/de7/structObject.html#a56283253ed00c7461cae7602135fbba9">loc</a>, obact-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, pchanact-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a5095025766a8ba300df21670591fb943">pose_tail</a>);
<a name="l01430"></a>01430             <span class="keywordflow">else</span>
<a name="l01431"></a>01431                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad7be0179ee8a128512e2c7f0ad11c8d8">mul_v3_m4v3</a>(obt-&gt;<a class="code" href="../../de/de7/structObject.html#a56283253ed00c7461cae7602135fbba9">loc</a>, obact-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, pchanact-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a45cd2d153728723d688e9c83b1201160">pose_head</a>);
<a name="l01432"></a>01432         }
<a name="l01433"></a>01433         <span class="keywordflow">else</span> {
<a name="l01434"></a>01434             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(obt-&gt;<a class="code" href="../../de/de7/structObject.html#a56283253ed00c7461cae7602135fbba9">loc</a>, obact-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3]);
<a name="l01435"></a>01435         }
<a name="l01436"></a>01436 
<a name="l01437"></a>01437         <span class="comment">/* restore, add_object sets active */</span>
<a name="l01438"></a>01438         <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a71a9117cf3b8db805eb031926bff279a">BASACT</a>= base;
<a name="l01439"></a>01439         base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> |= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l01440"></a>01440         
<a name="l01441"></a>01441         <span class="comment">/* make our new target the new object */</span>
<a name="l01442"></a>01442         *tar_ob= obt;
<a name="l01443"></a>01443         found= 1;
<a name="l01444"></a>01444     }
<a name="l01445"></a>01445     
<a name="l01446"></a>01446     <span class="comment">/* return whether there&#39;s any target */</span>
<a name="l01447"></a>01447     <span class="keywordflow">return</span> found;
<a name="l01448"></a>01448 }
<a name="l01449"></a>01449 
<a name="l01450"></a>01450 <span class="comment">/* used by add constraint operators to add the constraint required */</span>
<a name="l01451"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#adc7d823a043611fb011345a0c8fffa18">01451</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#adc7d823a043611fb011345a0c8fffa18">constraint_add_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *list, <span class="keywordtype">int</span> <a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>, <span class="keywordtype">short</span> setTarget)
<a name="l01452"></a>01452 {
<a name="l01453"></a>01453     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C);
<a name="l01454"></a>01454     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l01455"></a>01455     <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan;
<a name="l01456"></a>01456     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l01457"></a>01457     
<a name="l01458"></a>01458     <span class="keywordflow">if</span> (list == &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>) {
<a name="l01459"></a>01459         pchan= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01460"></a>01460     }
<a name="l01461"></a>01461     <span class="keywordflow">else</span> {
<a name="l01462"></a>01462         pchan= <a class="code" href="../../d8/df5/BKE__action_8h.html#aec3c2979d744c68e3fdbec5adfad77f1">get_active_posechannel</a>(ob);
<a name="l01463"></a>01463         
<a name="l01464"></a>01464         <span class="comment">/* ensure not to confuse object/pose adding */</span>
<a name="l01465"></a>01465         <span class="keywordflow">if</span> (pchan == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01466"></a>01466             <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;No active pose bone to add a constraint to&quot;</span>);
<a name="l01467"></a>01467             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01468"></a>01468         }
<a name="l01469"></a>01469     }
<a name="l01470"></a>01470     <span class="comment">/* check if constraint to be added is valid for the given constraints stack */</span>
<a name="l01471"></a>01471     <span class="keywordflow">if</span> (type == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a82cd381e2c3f10ae3f420bd2b20e1806">CONSTRAINT_TYPE_NULL</a>) {
<a name="l01472"></a>01472         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01473"></a>01473     }
<a name="l01474"></a>01474     <span class="keywordflow">if</span> ( (type == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a44c442a006038ebc212011d1c158646f">CONSTRAINT_TYPE_RIGIDBODYJOINT</a>) &amp;&amp; (list != &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>) ) {
<a name="l01475"></a>01475         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Rigid Body Joint Constraint can only be added to Objects&quot;</span>);
<a name="l01476"></a>01476         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01477"></a>01477     }
<a name="l01478"></a>01478     <span class="keywordflow">if</span> ( (type == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a8061c31c9da4a7351ce57037615d2c16">CONSTRAINT_TYPE_KINEMATIC</a>) &amp;&amp; ((!pchan) || (list != &amp;pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>)) ) {
<a name="l01479"></a>01479         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;IK Constraint can only be added to Bones&quot;</span>);
<a name="l01480"></a>01480         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01481"></a>01481     }
<a name="l01482"></a>01482     <span class="keywordflow">if</span> ( (type == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a71924f8e323782bf927aef8aaab46e97">CONSTRAINT_TYPE_SPLINEIK</a>) &amp;&amp; ((!pchan) || (list != &amp;pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>)) ) {
<a name="l01483"></a>01483         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Spline IK Constraint can only be added to Bones&quot;</span>);
<a name="l01484"></a>01484         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01485"></a>01485     }
<a name="l01486"></a>01486     
<a name="l01487"></a>01487     <span class="comment">/* create a new constraint of the type requried, and add it to the active/given constraints list */</span>
<a name="l01488"></a>01488     <span class="keywordflow">if</span> (pchan)
<a name="l01489"></a>01489         con = <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#aba923a1518a377e86d6ad75df65e92fe">add_pose_constraint</a>(ob, pchan, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, type);
<a name="l01490"></a>01490     <span class="keywordflow">else</span>
<a name="l01491"></a>01491         con = <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#ae97b0ba60cdc11d7d8b2d44ed0369892">add_ob_constraint</a>(ob, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, type);
<a name="l01492"></a>01492     
<a name="l01493"></a>01493     <span class="comment">/* get the first selected object/bone, and make that the target</span>
<a name="l01494"></a>01494 <span class="comment">     *  - apart from the buttons-window add buttons, we shouldn&#39;t add in this way</span>
<a name="l01495"></a>01495 <span class="comment">     */</span>
<a name="l01496"></a>01496     <span class="keywordflow">if</span> (setTarget) {
<a name="l01497"></a>01497         <a class="code" href="../../de/de7/structObject.html">Object</a> *tar_ob= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01498"></a>01498         <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *tar_pchan= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01499"></a>01499         
<a name="l01500"></a>01500         <span class="comment">/* get the target objects, adding them as need be */</span>
<a name="l01501"></a>01501         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d72/object__constraint_8c.html#a953a444fc4e532b4472de5b5675909b7">get_new_constraint_target</a>(C, type, &amp;tar_ob, &amp;tar_pchan, 1)) {
<a name="l01502"></a>01502             <span class="comment">/* method of setting target depends on the type of target we&#39;ve got </span>
<a name="l01503"></a>01503 <span class="comment">             *  - by default, just set the first target (distinction here is only for multiple-targeted constraints)</span>
<a name="l01504"></a>01504 <span class="comment">             */</span>
<a name="l01505"></a>01505             <span class="keywordflow">if</span> (tar_pchan)
<a name="l01506"></a>01506                 <a class="code" href="../../d4/d72/object__constraint_8c.html#a1557a055b29e28f20ab2fe777bd43436">set_constraint_nth_target</a>(con, tar_ob, tar_pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a8e947cbe29071a1c347abe644fe9c0c1">name</a>, 0);
<a name="l01507"></a>01507             <span class="keywordflow">else</span>
<a name="l01508"></a>01508                 <a class="code" href="../../d4/d72/object__constraint_8c.html#a1557a055b29e28f20ab2fe777bd43436">set_constraint_nth_target</a>(con, tar_ob, <span class="stringliteral">&quot;&quot;</span>, 0);
<a name="l01509"></a>01509         }
<a name="l01510"></a>01510     }
<a name="l01511"></a>01511     
<a name="l01512"></a>01512     <span class="comment">/* do type-specific tweaking to the constraint settings  */</span>
<a name="l01513"></a>01513     <span class="keywordflow">switch</span> (type) {
<a name="l01514"></a>01514         <span class="keywordflow">case</span> <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a7e2841c90e49a4d5c28931df5f82bf32">CONSTRAINT_TYPE_PYTHON</a>: <span class="comment">// FIXME: this code is not really valid anymore</span>
<a name="l01515"></a>01515         {
<a name="l01516"></a>01516 <span class="preprocessor">#ifdef WITH_PYTHON</span>
<a name="l01517"></a>01517 <span class="preprocessor"></span>            <span class="keywordtype">char</span> *menustr;
<a name="l01518"></a>01518             <span class="keywordtype">int</span> scriptint= 0;
<a name="l01519"></a>01519             <span class="comment">/* popup a list of usable scripts */</span>
<a name="l01520"></a>01520             menustr = buildmenu_pyconstraints(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;scriptint);
<a name="l01521"></a>01521             <span class="comment">// XXX scriptint = pupmenu(menustr);</span>
<a name="l01522"></a>01522             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(menustr);
<a name="l01523"></a>01523             
<a name="l01524"></a>01524             <span class="comment">/* only add constraint if a script was chosen */</span>
<a name="l01525"></a>01525             <span class="keywordflow">if</span> (scriptint) {
<a name="l01526"></a>01526                 <span class="comment">/* add constraint */</span>
<a name="l01527"></a>01527                 validate_pyconstraint_cb(con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>, &amp;scriptint);
<a name="l01528"></a>01528                 
<a name="l01529"></a>01529                 <span class="comment">/* make sure target allowance is set correctly */</span>
<a name="l01530"></a>01530                 <a class="code" href="../../dc/d76/BPY__extern_8h.html#aa8f63ee5c2c253213647d21f77e2c17c">BPY_pyconstraint_update</a>(ob, con);
<a name="l01531"></a>01531             }
<a name="l01532"></a>01532 <span class="preprocessor">#endif</span>
<a name="l01533"></a>01533 <span class="preprocessor"></span>            <span class="keywordflow">break</span>;
<a name="l01534"></a>01534         }
<a name="l01535"></a>01535 
<a name="l01536"></a>01536         <span class="keywordflow">default</span>:
<a name="l01537"></a>01537             <span class="keywordflow">break</span>;
<a name="l01538"></a>01538     }
<a name="l01539"></a>01539     
<a name="l01540"></a>01540     <span class="comment">/* make sure all settings are valid - similar to above checks, but sometimes can be wrong */</span>
<a name="l01541"></a>01541     <a class="code" href="../../da/d7a/ED__object_8h.html#a90879e5510cd0af7f8050cc6f4462e2d">object_test_constraints</a>(ob);
<a name="l01542"></a>01542 
<a name="l01543"></a>01543     <span class="keywordflow">if</span> (pchan)
<a name="l01544"></a>01544         <a class="code" href="../../d8/df5/BKE__action_8h.html#a2217b3c2db934940cd12c0bb795a1a5e">update_pose_constraint_flags</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>);
<a name="l01545"></a>01545 
<a name="l01546"></a>01546 
<a name="l01547"></a>01547     <span class="comment">/* force depsgraph to get recalculated since new relationships added */</span>
<a name="l01548"></a>01548     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a1916587a9ec19eb3543b1c1bc54a8ded">DAG_scene_sort</a>(bmain, scene);       <span class="comment">/* sort order of objects */</span>
<a name="l01549"></a>01549     
<a name="l01550"></a>01550     <span class="keywordflow">if</span> ((ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>) &amp;&amp; (pchan)) {
<a name="l01551"></a>01551         ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a64ec87fedfe2de572e1c5418d9eac677">flag</a> |= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#adcdc440dbd940088a1e1af80558e483daa8b3bbff9fe194cbe52e3aad051a19a6">POSE_RECALC</a>;  <span class="comment">/* sort pose channels */</span>
<a name="l01552"></a>01552         <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>);
<a name="l01553"></a>01553     }
<a name="l01554"></a>01554     <span class="keywordflow">else</span>
<a name="l01555"></a>01555         <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>);
<a name="l01556"></a>01556     
<a name="l01557"></a>01557     <span class="comment">/* notifiers for updates */</span>
<a name="l01558"></a>01558     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a87355bd87948236606ac66097a378e02">ND_CONSTRAINT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a66ee93621fb1e26b8b9bb49dc3c2c2af">NA_ADDED</a>, ob);
<a name="l01559"></a>01559     
<a name="l01560"></a>01560     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01561"></a>01561 }
<a name="l01562"></a>01562 
<a name="l01563"></a>01563 <span class="comment">/* ------------------ */</span>
<a name="l01564"></a>01564 
<a name="l01565"></a>01565 <span class="comment">/* dummy operator callback */</span>
<a name="l01566"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a3c25cffd555f2703fb37af8069025877">01566</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a3c25cffd555f2703fb37af8069025877">object_constraint_add_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01567"></a>01567 {
<a name="l01568"></a>01568     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob=<a class="code" href="../../da/d7a/ED__object_8h.html#a0a87646a151e018a119ed266356bb24b">ED_object_active_context</a>(C);
<a name="l01569"></a>01569     <span class="keywordtype">int</span> <a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>= <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;type&quot;</span>);
<a name="l01570"></a>01570     <span class="keywordtype">short</span> with_targets= 0;
<a name="l01571"></a>01571     
<a name="l01572"></a>01572     <span class="keywordflow">if</span> (!ob) {
<a name="l01573"></a>01573         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;No active object to add constraint to&quot;</span>);
<a name="l01574"></a>01574         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01575"></a>01575     }
<a name="l01576"></a>01576         
<a name="l01577"></a>01577     <span class="comment">/* hack: set constraint targets from selected objects in context is allowed when</span>
<a name="l01578"></a>01578 <span class="comment">     *      operator name included &#39;with_targets&#39;, since the menu doesn&#39;t allow multiple properties</span>
<a name="l01579"></a>01579 <span class="comment">     */</span>
<a name="l01580"></a>01580     <span class="keywordflow">if</span> (strstr(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a42b15acb4df45b846c38202a208c0c32">idname</a>, <span class="stringliteral">&quot;with_targets&quot;</span>))
<a name="l01581"></a>01581         with_targets= 1;
<a name="l01582"></a>01582 
<a name="l01583"></a>01583     <span class="keywordflow">return</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#adc7d823a043611fb011345a0c8fffa18">constraint_add_exec</a>(C, op, ob, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>, type, with_targets);
<a name="l01584"></a>01584 }
<a name="l01585"></a>01585 
<a name="l01586"></a>01586 <span class="comment">/* dummy operator callback */</span>
<a name="l01587"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a7c611f04f4b31eb92ea34b64d69016c3">01587</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a7c611f04f4b31eb92ea34b64d69016c3">pose_constraint_add_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01588"></a>01588 {
<a name="l01589"></a>01589     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= <a class="code" href="../../df/dac/BKE__object_8h.html#a7c81fbe77e3bc5283e2746857d88c94c">object_pose_armature_get</a>(<a class="code" href="../../da/d7a/ED__object_8h.html#a0a87646a151e018a119ed266356bb24b">ED_object_active_context</a>(C));
<a name="l01590"></a>01590     <span class="keywordtype">int</span> <a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>= <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;type&quot;</span>);
<a name="l01591"></a>01591     <span class="keywordtype">short</span> with_targets= 0;
<a name="l01592"></a>01592     
<a name="l01593"></a>01593     <span class="keywordflow">if</span> (!ob) {
<a name="l01594"></a>01594         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;No active object to add constraint to&quot;</span>);
<a name="l01595"></a>01595         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01596"></a>01596     }
<a name="l01597"></a>01597         
<a name="l01598"></a>01598     <span class="comment">/* hack: set constraint targets from selected objects in context is allowed when</span>
<a name="l01599"></a>01599 <span class="comment">     *      operator name included &#39;with_targets&#39;, since the menu doesn&#39;t allow multiple properties</span>
<a name="l01600"></a>01600 <span class="comment">     */</span>
<a name="l01601"></a>01601     <span class="keywordflow">if</span> (strstr(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a42b15acb4df45b846c38202a208c0c32">idname</a>, <span class="stringliteral">&quot;with_targets&quot;</span>))
<a name="l01602"></a>01602         with_targets= 1;
<a name="l01603"></a>01603     
<a name="l01604"></a>01604     <span class="keywordflow">return</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#adc7d823a043611fb011345a0c8fffa18">constraint_add_exec</a>(C, op, ob, <a class="code" href="../../da/d7a/ED__object_8h.html#a74a92e4b5b822a699db2cf03728cb370">get_active_constraints</a>(ob), type, with_targets);
<a name="l01605"></a>01605 }
<a name="l01606"></a>01606 
<a name="l01607"></a>01607 <span class="comment">/* ------------------ */</span>
<a name="l01608"></a>01608 
<a name="l01609"></a><a class="code" href="../../d3/d80/object__intern_8h.html#a3194d52f2185756c2d616bb72881e2d5">01609</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a8091bed7ed36e04c76ddab51dcf99ea1">OBJECT_OT_constraint_add</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01610"></a>01610 {
<a name="l01611"></a>01611     <span class="comment">/* identifiers */</span>
<a name="l01612"></a>01612     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Constraint&quot;</span>;
<a name="l01613"></a>01613     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Add a constraint to the active object&quot;</span>;
<a name="l01614"></a>01614     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;OBJECT_OT_constraint_add&quot;</span>;
<a name="l01615"></a>01615     
<a name="l01616"></a>01616     <span class="comment">/* api callbacks */</span>
<a name="l01617"></a>01617     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a926375c583166540cfa96299e433e071">WM_menu_invoke</a>;
<a name="l01618"></a>01618     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a3c25cffd555f2703fb37af8069025877">object_constraint_add_exec</a>;
<a name="l01619"></a>01619     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#adf69a13ccdb50f050485340e86a00d34">ED_operator_object_active_editable</a>;
<a name="l01620"></a>01620     
<a name="l01621"></a>01621     <span class="comment">/* flags */</span>
<a name="l01622"></a>01622     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01623"></a>01623     
<a name="l01624"></a>01624     <span class="comment">/* properties */</span>
<a name="l01625"></a>01625     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;type&quot;</span>, <a class="code" href="../../d2/da3/rna__constraint_8c.html#a14cb4d43e9960fb7e1f2b4f640905ee1">constraint_type_items</a>, 0, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01626"></a>01626 }
<a name="l01627"></a>01627 
<a name="l01628"></a><a class="code" href="../../d3/d80/object__intern_8h.html#afa76fd6c0554518f888d936df0e8d0f8">01628</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a31ee89e59530963854f3618196bc1040">OBJECT_OT_constraint_add_with_targets</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01629"></a>01629 {
<a name="l01630"></a>01630     <span class="comment">/* identifiers */</span>
<a name="l01631"></a>01631     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Constraint (with Targets)&quot;</span>;
<a name="l01632"></a>01632     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Add a constraint to the active object, with target (where applicable) set to the selected Objects/Bones&quot;</span>;
<a name="l01633"></a>01633     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;OBJECT_OT_constraint_add_with_targets&quot;</span>;
<a name="l01634"></a>01634     
<a name="l01635"></a>01635     <span class="comment">/* api callbacks */</span>
<a name="l01636"></a>01636     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a926375c583166540cfa96299e433e071">WM_menu_invoke</a>;
<a name="l01637"></a>01637     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a3c25cffd555f2703fb37af8069025877">object_constraint_add_exec</a>;
<a name="l01638"></a>01638     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#adf69a13ccdb50f050485340e86a00d34">ED_operator_object_active_editable</a>;
<a name="l01639"></a>01639     
<a name="l01640"></a>01640     <span class="comment">/* flags */</span>
<a name="l01641"></a>01641     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01642"></a>01642     
<a name="l01643"></a>01643     <span class="comment">/* properties */</span>
<a name="l01644"></a>01644     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;type&quot;</span>, <a class="code" href="../../d2/da3/rna__constraint_8c.html#a14cb4d43e9960fb7e1f2b4f640905ee1">constraint_type_items</a>, 0, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01645"></a>01645 }
<a name="l01646"></a>01646 
<a name="l01647"></a><a class="code" href="../../d3/d80/object__intern_8h.html#ab0d23bf5db49eae4b293dfbdba3e63ca">01647</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#ac4cb98c2b796d6fc2f9bd5e758cc9904">POSE_OT_constraint_add</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01648"></a>01648 {
<a name="l01649"></a>01649     <span class="comment">/* identifiers */</span>
<a name="l01650"></a>01650     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Constraint&quot;</span>;
<a name="l01651"></a>01651     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Add a constraint to the active bone&quot;</span>;
<a name="l01652"></a>01652     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;POSE_OT_constraint_add&quot;</span>;
<a name="l01653"></a>01653     
<a name="l01654"></a>01654     <span class="comment">/* api callbacks */</span>
<a name="l01655"></a>01655     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a926375c583166540cfa96299e433e071">WM_menu_invoke</a>;
<a name="l01656"></a>01656     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a7c611f04f4b31eb92ea34b64d69016c3">pose_constraint_add_exec</a>;
<a name="l01657"></a>01657     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a58cfd064018383fbdd69f7d409248fbb">ED_operator_posemode</a>;
<a name="l01658"></a>01658     
<a name="l01659"></a>01659     <span class="comment">/* flags */</span>
<a name="l01660"></a>01660     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01661"></a>01661     
<a name="l01662"></a>01662     <span class="comment">/* properties */</span>
<a name="l01663"></a>01663     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;type&quot;</span>, <a class="code" href="../../d2/da3/rna__constraint_8c.html#a14cb4d43e9960fb7e1f2b4f640905ee1">constraint_type_items</a>, 0, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01664"></a>01664 }
<a name="l01665"></a>01665 
<a name="l01666"></a><a class="code" href="../../d3/d80/object__intern_8h.html#a6b7fbf1fc02dbf1a2e7b2e74beed9f1f">01666</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#aa6dbb32c53943f3d9a385fe3c5fe459e">POSE_OT_constraint_add_with_targets</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01667"></a>01667 {
<a name="l01668"></a>01668     <span class="comment">/* identifiers */</span>
<a name="l01669"></a>01669     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Constraint (with Targets)&quot;</span>;
<a name="l01670"></a>01670     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Add a constraint to the active bone, with target (where applicable) set to the selected Objects/Bones&quot;</span>;
<a name="l01671"></a>01671     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;POSE_OT_constraint_add_with_targets&quot;</span>;
<a name="l01672"></a>01672     
<a name="l01673"></a>01673     <span class="comment">/* api callbacks */</span>
<a name="l01674"></a>01674     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a926375c583166540cfa96299e433e071">WM_menu_invoke</a>;
<a name="l01675"></a>01675     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a7c611f04f4b31eb92ea34b64d69016c3">pose_constraint_add_exec</a>;
<a name="l01676"></a>01676     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a58cfd064018383fbdd69f7d409248fbb">ED_operator_posemode</a>;
<a name="l01677"></a>01677     
<a name="l01678"></a>01678     <span class="comment">/* flags */</span>
<a name="l01679"></a>01679     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01680"></a>01680     
<a name="l01681"></a>01681     <span class="comment">/* properties */</span>
<a name="l01682"></a>01682     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;type&quot;</span>, <a class="code" href="../../d2/da3/rna__constraint_8c.html#a14cb4d43e9960fb7e1f2b4f640905ee1">constraint_type_items</a>, 0, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01683"></a>01683 }
<a name="l01684"></a>01684 
<a name="l01685"></a>01685 <span class="comment">/************************ IK Constraint operators *********************/</span>
<a name="l01686"></a>01686 <span class="comment">/* NOTE: only for Pose-Channels */</span>
<a name="l01687"></a>01687 <span class="comment">// TODO: should these be here, or back in editors/armature/poseobject.c again?</span>
<a name="l01688"></a>01688 
<a name="l01689"></a>01689 <span class="comment">/* present menu with options + validation for targets to use */</span>
<a name="l01690"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#aefaf4a5947e0057b894f072350117ca4">01690</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#aefaf4a5947e0057b894f072350117ca4">pose_ik_add_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(evt))
<a name="l01691"></a>01691 {
<a name="l01692"></a>01692     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= <a class="code" href="../../df/dac/BKE__object_8h.html#a7c81fbe77e3bc5283e2746857d88c94c">object_pose_armature_get</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a86fd97bb1e59c64106c001ab29db25c7">CTX_data_active_object</a>(C));
<a name="l01693"></a>01693     <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan= <a class="code" href="../../d8/df5/BKE__action_8h.html#aec3c2979d744c68e3fdbec5adfad77f1">get_active_posechannel</a>(ob);
<a name="l01694"></a>01694     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01695"></a>01695     
<a name="l01696"></a>01696     <a class="code" href="../../d9/d4b/structuiPopupMenu.html">uiPopupMenu</a> *pup;
<a name="l01697"></a>01697     <a class="code" href="../../d4/d94/structuiLayout.html">uiLayout</a> *layout;
<a name="l01698"></a>01698     <a class="code" href="../../de/de7/structObject.html">Object</a> *tar_ob= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01699"></a>01699     <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *tar_pchan= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01700"></a>01700     
<a name="l01701"></a>01701     <span class="comment">/* must have active bone */</span>
<a name="l01702"></a>01702     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ob, pchan)) {
<a name="l01703"></a>01703         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Must have active bone to add IK Constraint to&quot;</span>);
<a name="l01704"></a>01704         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01705"></a>01705     }
<a name="l01706"></a>01706     
<a name="l01707"></a>01707     <span class="comment">/* bone must not have any constraints already */</span>
<a name="l01708"></a>01708     <span class="keywordflow">for</span> (con= pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; con; con= con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l01709"></a>01709         <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a>==<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a8061c31c9da4a7351ce57037615d2c16">CONSTRAINT_TYPE_KINEMATIC</a>) <span class="keywordflow">break</span>;
<a name="l01710"></a>01710     }
<a name="l01711"></a>01711     <span class="keywordflow">if</span> (con) {
<a name="l01712"></a>01712         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Bone already has IK Constraint&quot;</span>);
<a name="l01713"></a>01713         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01714"></a>01714     }
<a name="l01715"></a>01715     
<a name="l01716"></a>01716     <span class="comment">/* prepare popup menu to choose targetting options */</span>
<a name="l01717"></a>01717     pup= <a class="code" href="../../d8/d1e/UI__interface_8h.html#a402c012d9cde0ff0f0808c25c4213d43">uiPupMenuBegin</a>(C, <span class="stringliteral">&quot;Add IK&quot;</span>, ICON_NONE);
<a name="l01718"></a>01718     layout= <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8c1b07b81987cdc2168a7417f9104cca">uiPupMenuLayout</a>(pup);
<a name="l01719"></a>01719     
<a name="l01720"></a>01720     <span class="comment">/* the type of targets we&#39;ll set determines the menu entries to show... */</span>
<a name="l01721"></a>01721     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d72/object__constraint_8c.html#a953a444fc4e532b4472de5b5675909b7">get_new_constraint_target</a>(C, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a8061c31c9da4a7351ce57037615d2c16">CONSTRAINT_TYPE_KINEMATIC</a>, &amp;tar_ob, &amp;tar_pchan, 0)) {
<a name="l01722"></a>01722         <span class="comment">/* bone target, or object target? </span>
<a name="l01723"></a>01723 <span class="comment">         *  - the only thing that matters is that we want a target...</span>
<a name="l01724"></a>01724 <span class="comment">         */</span>
<a name="l01725"></a>01725         <span class="keywordflow">if</span> (tar_pchan)
<a name="l01726"></a>01726             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;To Active Bone&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;POSE_OT_ik_add&quot;</span>, <span class="stringliteral">&quot;with_targets&quot;</span>, 1);
<a name="l01727"></a>01727         <span class="keywordflow">else</span>
<a name="l01728"></a>01728             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;To Active Object&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;POSE_OT_ik_add&quot;</span>, <span class="stringliteral">&quot;with_targets&quot;</span>, 1);
<a name="l01729"></a>01729     }
<a name="l01730"></a>01730     <span class="keywordflow">else</span> {
<a name="l01731"></a>01731         <span class="comment">/* we have a choice of adding to a new empty, or not setting any target (targetless IK) */</span>
<a name="l01732"></a>01732         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;To New Empty Object&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;POSE_OT_ik_add&quot;</span>, <span class="stringliteral">&quot;with_targets&quot;</span>, 1);
<a name="l01733"></a>01733         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a00e34a25f52f438d44b1514bb8e6e975">uiItemBooleanO</a>(layout, <span class="stringliteral">&quot;Without Targets&quot;</span>, ICON_NONE, <span class="stringliteral">&quot;POSE_OT_ik_add&quot;</span>, <span class="stringliteral">&quot;with_targets&quot;</span>, 0);
<a name="l01734"></a>01734     }
<a name="l01735"></a>01735     
<a name="l01736"></a>01736     <span class="comment">/* finish building the menu, and process it (should result in calling self again) */</span>
<a name="l01737"></a>01737     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3ab0b4d9de253d473a16d4f329d8b50f">uiPupMenuEnd</a>(C, pup);
<a name="l01738"></a>01738     
<a name="l01739"></a>01739     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01740"></a>01740 }
<a name="l01741"></a>01741 
<a name="l01742"></a>01742 <span class="comment">/* call constraint_add_exec() to add the IK constraint */</span>
<a name="l01743"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#abfe60a8a3e7b607d4187b5cc74f85380">01743</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#abfe60a8a3e7b607d4187b5cc74f85380">pose_ik_add_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01744"></a>01744 {
<a name="l01745"></a>01745     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= <a class="code" href="../../df/d01/BKE__context_8h.html#a86fd97bb1e59c64106c001ab29db25c7">CTX_data_active_object</a>(C);
<a name="l01746"></a>01746     <span class="keywordtype">int</span> with_targets= <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;with_targets&quot;</span>);
<a name="l01747"></a>01747     
<a name="l01748"></a>01748     <span class="comment">/* add the constraint - all necessary checks should have been done by the invoke() callback already... */</span>
<a name="l01749"></a>01749     <span class="keywordflow">return</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#adc7d823a043611fb011345a0c8fffa18">constraint_add_exec</a>(C, op, ob, <a class="code" href="../../da/d7a/ED__object_8h.html#a74a92e4b5b822a699db2cf03728cb370">get_active_constraints</a>(ob), <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a8061c31c9da4a7351ce57037615d2c16">CONSTRAINT_TYPE_KINEMATIC</a>, with_targets);
<a name="l01750"></a>01750 }
<a name="l01751"></a>01751 
<a name="l01752"></a><a class="code" href="../../d3/d80/object__intern_8h.html#ad3b339039403e6f15d4af2a176fc1b0e">01752</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#ac6985d894b650fe63f089426d63caa8c">POSE_OT_ik_add</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01753"></a>01753 {
<a name="l01754"></a>01754     <span class="comment">/* identifiers */</span>
<a name="l01755"></a>01755     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add IK to Bone&quot;</span>;
<a name="l01756"></a>01756     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Add IK Constraint to the active Bone&quot;</span>;
<a name="l01757"></a>01757     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;POSE_OT_ik_add&quot;</span>;
<a name="l01758"></a>01758     
<a name="l01759"></a>01759     <span class="comment">/* api callbacks */</span>
<a name="l01760"></a>01760     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#aefaf4a5947e0057b894f072350117ca4">pose_ik_add_invoke</a>;
<a name="l01761"></a>01761     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#abfe60a8a3e7b607d4187b5cc74f85380">pose_ik_add_exec</a>;
<a name="l01762"></a>01762     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a58cfd064018383fbdd69f7d409248fbb">ED_operator_posemode</a>;
<a name="l01763"></a>01763     
<a name="l01764"></a>01764     <span class="comment">/* flags */</span>
<a name="l01765"></a>01765     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01766"></a>01766     
<a name="l01767"></a>01767     <span class="comment">/* properties */</span>
<a name="l01768"></a>01768     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;with_targets&quot;</span>, 1, <span class="stringliteral">&quot;With Targets&quot;</span>, <span class="stringliteral">&quot;Assign IK Constraint with targets derived from the select bones/objects&quot;</span>);
<a name="l01769"></a>01769 }
<a name="l01770"></a>01770 
<a name="l01771"></a>01771 <span class="comment">/* ------------------ */</span>
<a name="l01772"></a>01772 
<a name="l01773"></a>01773 <span class="comment">/* remove IK constraints from selected bones */</span>
<a name="l01774"></a><a class="code" href="../../d4/d72/object__constraint_8c.html#a8e837b41431fcae2011e3b5e1026cf02">01774</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#a8e837b41431fcae2011e3b5e1026cf02">pose_ik_clear_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l01775"></a>01775 {
<a name="l01776"></a>01776     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= <a class="code" href="../../df/dac/BKE__object_8h.html#a7c81fbe77e3bc5283e2746857d88c94c">object_pose_armature_get</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a86fd97bb1e59c64106c001ab29db25c7">CTX_data_active_object</a>(C));
<a name="l01777"></a>01777     
<a name="l01778"></a>01778     <span class="comment">/* only remove IK Constraints */</span>
<a name="l01779"></a>01779     <a class="code" href="../../df/d01/BKE__context_8h.html#a63ffcaf5af72270fb66c773139bdedb2">CTX_DATA_BEGIN</a>(C, <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a>*, pchan, selected_pose_bones) 
<a name="l01780"></a>01780     {
<a name="l01781"></a>01781         <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l01782"></a>01782         
<a name="l01783"></a>01783         <span class="comment">// TODO: should we be checking if these contraints were local before we try and remove them?</span>
<a name="l01784"></a>01784         <span class="keywordflow">for</span> (con= pchan-&gt;constraints.first; con; con= next) {
<a name="l01785"></a>01785             next= con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>;
<a name="l01786"></a>01786             <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a>==<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a8061c31c9da4a7351ce57037615d2c16">CONSTRAINT_TYPE_KINEMATIC</a>) {
<a name="l01787"></a>01787                 <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#abbd4caf3eb7ada285e11379033a9555c">remove_constraint</a>(&amp;pchan-&gt;constraints, con);
<a name="l01788"></a>01788             }
<a name="l01789"></a>01789         }
<a name="l01790"></a>01790         pchan-&gt;constflag &amp;= ~(<a class="code" href="../../dc/d2a/DNA__action__types_8h.html#aa054ea9cc32895cc3299d8e9331ab3e8a946cee8332ffabf5684e8a57f5ba5a5d">PCHAN_HAS_IK</a>|<a class="code" href="../../dc/d2a/DNA__action__types_8h.html#aa054ea9cc32895cc3299d8e9331ab3e8a9e67d1a8c5e011793063f3e3815f7e16">PCHAN_HAS_TARGET</a>);
<a name="l01791"></a>01791     }
<a name="l01792"></a>01792     <a class="code" href="../../df/d01/BKE__context_8h.html#af19e54c354c69aacc4c6f2e2fcafde0f">CTX_DATA_END</a>;
<a name="l01793"></a>01793     
<a name="l01794"></a>01794     <span class="comment">/* refresh depsgraph */</span>
<a name="l01795"></a>01795     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>);
<a name="l01796"></a>01796 
<a name="l01797"></a>01797     <span class="comment">/* note, notifier might evolve */</span>
<a name="l01798"></a>01798     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a87355bd87948236606ac66097a378e02">ND_CONSTRAINT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a9e971b3c86d560d28a06ea074e04fa84">NA_REMOVED</a>, ob);
<a name="l01799"></a>01799     
<a name="l01800"></a>01800     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01801"></a>01801 }
<a name="l01802"></a>01802 
<a name="l01803"></a><a class="code" href="../../d3/d80/object__intern_8h.html#a578093a693ca2ef8a57b082bedd553de">01803</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d72/object__constraint_8c.html#ad5a3af9ba7bf84d2b5ca35a22b50e09e">POSE_OT_ik_clear</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01804"></a>01804 {
<a name="l01805"></a>01805     <span class="comment">/* identifiers */</span>
<a name="l01806"></a>01806     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Remove IK&quot;</span>;
<a name="l01807"></a>01807     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Remove all IK Constraints from selected bones&quot;</span>;
<a name="l01808"></a>01808     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;POSE_OT_ik_clear&quot;</span>;
<a name="l01809"></a>01809     
<a name="l01810"></a>01810     <span class="comment">/* api callbacks */</span>
<a name="l01811"></a>01811     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d4/d72/object__constraint_8c.html#a8e837b41431fcae2011e3b5e1026cf02">pose_ik_clear_exec</a>;
<a name="l01812"></a>01812     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a58cfd064018383fbdd69f7d409248fbb">ED_operator_posemode</a>;
<a name="l01813"></a>01813     
<a name="l01814"></a>01814     <span class="comment">/* flags */</span>
<a name="l01815"></a>01815     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01816"></a>01816 }
<a name="l01817"></a>01817 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:38 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

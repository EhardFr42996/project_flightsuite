<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: effect.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">effect.c</div>  </div>
</div>
<div class="contents">
<a href="../../d7/d50/effect_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): none yet.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;stddef.h&gt;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d88/DNA__curve__types_8h.html">DNA_curve_types.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d8e/DNA__effect__types_8h.html">DNA_effect_types.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d75/DNA__group__types_8h.html">DNA_group_types.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d5e/DNA__ipo__types_8h.html">DNA_ipo_types.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d41/DNA__key__types_8h.html">DNA_key_types.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d2f/DNA__lattice__types_8h.html">DNA_lattice_types.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d43/DNA__listBase_8h.html" title="These structs are the foundation for all linked lists in the library system.">DNA_listBase.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d96/DNA__mesh__types_8h.html">DNA_mesh_types.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html">DNA_meshdata_types.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../de/db2/DNA__material__types_8h.html">DNA_material_types.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d60/DNA__object__force_8h.html">DNA_object_force.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d5a/DNA__particle__types_8h.html">DNA_particle_types.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../da/ddf/DNA__texture__types_8h.html">DNA_texture_types.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d49/BLI__jitter_8h.html">BLI_jitter.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d88/BLI__rand_8h.html" title="Random number functions.">BLI_rand.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d2e/PIL__time_8h.html">PIL_time.h</a>&quot;</span>
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/df5/BKE__action_8h.html" title="Blender kernel action and pose functionality.">BKE_action.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dd0/BKE__anim_8h.html">BKE_anim.h</a>&quot;</span>       <span class="comment">/* needed for where_on_path */</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d17/BKE__armature_8h.html">BKE_armature.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/ddf/BKE__blender_8h.html" title="Blender util stuff.">BKE_blender.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/de6/BKE__collision_8h.html">BKE_collision.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddd/BKE__constraint_8h.html">BKE_constraint.h</a>&quot;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dbd/BKE__deform_8h.html" title="support for deformation groups and hooks.">BKE_deform.h</a>&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html">BKE_depsgraph.h</a>&quot;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d12/BKE__displist_8h.html" title="display list (or rather multi purpose list) stuff.">BKE_displist.h</a>&quot;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d7f/BKE__DerivedMesh_8h.html">BKE_DerivedMesh.h</a>&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d15/BKE__cdderivedmesh_8h.html">BKE_cdderivedmesh.h</a>&quot;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d65/BKE__effect_8h.html">BKE_effect.h</a>&quot;</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span>
<a name="l00077"></a>00077 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/df5/BKE__group_8h.html">BKE_group.h</a>&quot;</span>
<a name="l00078"></a>00078 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d48/BKE__ipo_8h.html">BKE_ipo.h</a>&quot;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d17/BKE__key_8h.html">BKE_key.h</a>&quot;</span>
<a name="l00080"></a>00080 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d8f/BKE__lattice_8h.html">BKE_lattice.h</a>&quot;</span>
<a name="l00081"></a>00081 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d7f/BKE__mesh_8h.html">BKE_mesh.h</a>&quot;</span>
<a name="l00082"></a>00082 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d0f/BKE__material_8h.html" title="General operations, lookup, etc. for materials.">BKE_material.h</a>&quot;</span>
<a name="l00083"></a>00083 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00084"></a>00084 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d0f/BKE__modifier_8h.html">BKE_modifier.h</a>&quot;</span>
<a name="l00085"></a>00085 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dac/BKE__object_8h.html" title="General operations, lookup, etc. for blender objects.">BKE_object.h</a>&quot;</span>
<a name="l00086"></a>00086 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dca/BKE__particle_8h.html">BKE_particle.h</a>&quot;</span>
<a name="l00087"></a>00087 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d53/BKE__scene_8h.html">BKE_scene.h</a>&quot;</span>
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/de4/RE__render__ext_8h.html">RE_render_ext.h</a>&quot;</span>
<a name="l00091"></a>00091 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d49/RE__shader__ext_8h.html">RE_shader_ext.h</a>&quot;</span>
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="comment">/* fluid sim particle import */</span>
<a name="l00094"></a>00094 <span class="preprocessor">#ifdef WITH_MOD_FLUID</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="../../d8/d92/DNA__object__fluidsim_8h.html">DNA_object_fluidsim.h</a>&quot;</span>
<a name="l00096"></a>00096 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/db4/LBM__fluidsim_8h.html">LBM_fluidsim.h</a>&quot;</span>
<a name="l00097"></a>00097 <span class="preprocessor">#include &lt;zlib.h&gt;</span>
<a name="l00098"></a>00098 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00099"></a>00099 <span class="preprocessor">#endif // WITH_MOD_FLUID</span>
<a name="l00100"></a>00100 <span class="preprocessor"></span>
<a name="l00101"></a>00101 <span class="comment">//XXX #include &quot;BIF_screen.h&quot;</span>
<a name="l00102"></a>00102 
<a name="l00103"></a><a class="code" href="../../d7/d50/effect_8c.html#accea4ca7a195fde15a90f7c70086007b">00103</a> <a class="code" href="../../db/d19/structEffectorWeights.html">EffectorWeights</a> *<a class="code" href="../../dc/d65/BKE__effect_8h.html#ad0116e11e09f0615cc817f48a9557e85">BKE_add_effector_weights</a>(<a class="code" href="../../d4/d91/structGroup.html">Group</a> *group)
<a name="l00104"></a>00104 {
<a name="l00105"></a>00105     <a class="code" href="../../db/d19/structEffectorWeights.html">EffectorWeights</a> *weights = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../db/d19/structEffectorWeights.html">EffectorWeights</a>), <span class="stringliteral">&quot;EffectorWeights&quot;</span>);
<a name="l00106"></a>00106     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00107"></a>00107 
<a name="l00108"></a>00108     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba087d67185eb982a741712be1a1434776">NUM_PFIELD_TYPES</a>; i++)
<a name="l00109"></a>00109         weights-&gt;<a class="code" href="../../db/d19/structEffectorWeights.html#a7bdfc847d45615d3d76cc8404d4ce989">weight</a>[i] = 1.0f;
<a name="l00110"></a>00110 
<a name="l00111"></a>00111     weights-&gt;<a class="code" href="../../db/d19/structEffectorWeights.html#af1e527b00a665e3ac926d0aa7c54b9d0">global_gravity</a> = 1.0f;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113     weights-&gt;<a class="code" href="../../db/d19/structEffectorWeights.html#a43d09358bdd0b25e6c35c513ab993b34">group</a> = group;
<a name="l00114"></a>00114 
<a name="l00115"></a>00115     <span class="keywordflow">return</span> weights;
<a name="l00116"></a>00116 }
<a name="l00117"></a><a class="code" href="../../d7/d50/effect_8c.html#a2f9a838f30082e7122ba759b7c98be9b">00117</a> <a class="code" href="../../d3/d76/structPartDeflect.html">PartDeflect</a> *<a class="code" href="../../dc/d65/BKE__effect_8h.html#a1f9e944ae6357270e13c64fa3e39e34c">object_add_collision_fields</a>(<span class="keywordtype">int</span> <a class="code" href="../../d0/dbe/structUndoElem.html#a48df87fe93d0a4a83e5668e9bb3bf9dc">type</a>)
<a name="l00118"></a>00118 {
<a name="l00119"></a>00119     <a class="code" href="../../d3/d76/structPartDeflect.html">PartDeflect</a> *pd;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121     pd= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d3/d76/structPartDeflect.html">PartDeflect</a>), <span class="stringliteral">&quot;PartDeflect&quot;</span>);
<a name="l00122"></a>00122 
<a name="l00123"></a>00123     pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> = <a class="code" href="../../d0/dbe/structUndoElem.html#a48df87fe93d0a4a83e5668e9bb3bf9dc">type</a>;
<a name="l00124"></a>00124     pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#afce13d76e7256686a62205f0b63a9a1d">pdef_sbdamp</a> = 0.1f;
<a name="l00125"></a>00125     pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a92a4c8053ace57341092d9bba00f9f2e">pdef_sbift</a>  = 0.2f;
<a name="l00126"></a>00126     pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a0ba43582aa767541372924054d9a000e">pdef_sboft</a>  = 0.02f;
<a name="l00127"></a>00127     pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a0f7a3f82ff39133f40f053481067d2f2">seed</a> = ((<span class="keywordtype">unsigned</span> int)(ceil(<a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>()))+1) % 128;
<a name="l00128"></a>00128     pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a6cff5078ee6e06da8a0164ba49cf5a7c">f_strength</a> = 1.0f;
<a name="l00129"></a>00129     pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#ab4be0fda5a3555ae6c29750c37090a54">f_damp</a> = 1.0f;
<a name="l00130"></a>00130 
<a name="l00131"></a>00131     <span class="comment">/* set sensible defaults based on type */</span>
<a name="l00132"></a>00132     <span class="keywordflow">switch</span>(type) {
<a name="l00133"></a>00133         <span class="keywordflow">case</span> <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1bab1e0e1326ceb8b34f025660dd2399a02">PFIELD_VORTEX</a>:
<a name="l00134"></a>00134             pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a44ba6da57ec66074da56f4c50066c198">shape</a> = <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a5b5d514f756439c8010a56c2f821712f">PFIELD_SHAPE_PLANE</a>;
<a name="l00135"></a>00135             <span class="keywordflow">break</span>;
<a name="l00136"></a>00136         <span class="keywordflow">case</span> <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba22fb65898d213ba25a4a89bbe5c50fc0">PFIELD_WIND</a>:
<a name="l00137"></a>00137             pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a44ba6da57ec66074da56f4c50066c198">shape</a> = <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a5b5d514f756439c8010a56c2f821712f">PFIELD_SHAPE_PLANE</a>;
<a name="l00138"></a>00138             pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a2436a09ffb8e272f433bea87d584ffc3">f_flow</a> = 1.0f; <span class="comment">/* realistic wind behavior */</span>
<a name="l00139"></a>00139             <span class="keywordflow">break</span>;
<a name="l00140"></a>00140         <span class="keywordflow">case</span> <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1baca7d52fea971450bd4a0333c24005a8b">PFIELD_TEXTURE</a>:
<a name="l00141"></a>00141             pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a8b8ef2fe2e38b34204ad09fbcd8e7034">f_size</a> = 1.0f;
<a name="l00142"></a>00142             <span class="keywordflow">break</span>;
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144     pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> = <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a7d6e9762b62db2b3edfbe874453d6204">PFIELD_DO_LOCATION</a>|<a class="code" href="../../d2/d60/DNA__object__force_8h.html#aad7b941552bd426573226b82e0f37ce1">PFIELD_DO_ROTATION</a>;
<a name="l00145"></a>00145 
<a name="l00146"></a>00146     <span class="keywordflow">return</span> pd;
<a name="l00147"></a>00147 }
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 <span class="comment">/* temporal struct, used for reading return of mesh_get_mapped_verts_nors() */</span>
<a name="l00150"></a>00150 
<a name="l00151"></a><a class="code" href="../../d5/d56/structVeNoCo.html">00151</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d56/structVeNoCo.html">VeNoCo</a> {
<a name="l00152"></a><a class="code" href="../../d5/d56/structVeNoCo.html#ab3726146f040b159825f0de6018f281c">00152</a>     <span class="keywordtype">float</span> <a class="code" href="../../d5/d56/structVeNoCo.html#abc9df628ceb2176f94f7d3bd4038176c">co</a>[3], <a class="code" href="../../d5/d56/structVeNoCo.html#ab3726146f040b159825f0de6018f281c">no</a>[3];
<a name="l00153"></a>00153 } <a class="code" href="../../d7/d50/effect_8c.html#adb7ee5571f9bdd7256b8afd88e27a3ae">VeNoCo</a>;
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 <span class="comment">/* ***************** PARTICLES ***************** */</span>
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 <span class="comment">/* -------------------------- Effectors ------------------ */</span>
<a name="l00158"></a><a class="code" href="../../d7/d50/effect_8c.html#aeefed3e9330123954f29b7dc7896b3b1">00158</a> <span class="keywordtype">void</span> <a class="code" href="../../dc/d65/BKE__effect_8h.html#ac13b42b3b1c1fcfd66a411f36fc0e14e">free_partdeflect</a>(<a class="code" href="../../d3/d76/structPartDeflect.html">PartDeflect</a> *pd)
<a name="l00159"></a>00159 {
<a name="l00160"></a>00160     <span class="keywordflow">if</span> (!pd)
<a name="l00161"></a>00161         <span class="keywordflow">return</span>;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a5d55db7630e361083388cae31bbf36e9">tex</a>)
<a name="l00164"></a>00164         pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a5d55db7630e361083388cae31bbf36e9">tex</a>-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--;
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a1a9b02c0ce6e796e05bca15bdc5776c0">rng</a>)
<a name="l00167"></a>00167         <a class="code" href="../../d3/d88/BLI__rand_8h.html#af2fb0bfbfbf970240b7a1dcaa3130196">rng_free</a>(pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a1a9b02c0ce6e796e05bca15bdc5776c0">rng</a>);
<a name="l00168"></a>00168 
<a name="l00169"></a>00169     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(pd);
<a name="l00170"></a>00170 }
<a name="l00171"></a>00171 
<a name="l00172"></a><a class="code" href="../../d7/d50/effect_8c.html#adb5a7f0a8aea8834c8e2139655ea1d2c">00172</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d50/effect_8c.html#adb5a7f0a8aea8834c8e2139655ea1d2c">precalculate_effector</a>(<a class="code" href="../../d6/d53/structEffectorCache.html">EffectorCache</a> *eff)
<a name="l00173"></a>00173 {
<a name="l00174"></a>00174     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cfra = (<span class="keywordtype">unsigned</span> int)(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#aa5f00cbdbeb2f4504874670311c4837e">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a> &gt;= 0 ? eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#aa5f00cbdbeb2f4504874670311c4837e">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a> : -eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#aa5f00cbdbeb2f4504874670311c4837e">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a>);
<a name="l00175"></a>00175     <span class="keywordflow">if</span> (!eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a1a9b02c0ce6e796e05bca15bdc5776c0">rng</a>)
<a name="l00176"></a>00176         eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a1a9b02c0ce6e796e05bca15bdc5776c0">rng</a> = <a class="code" href="../../d3/d88/BLI__rand_8h.html#adf17633489552c8dd24245b3a9e02ea4">rng_new</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a0f7a3f82ff39133f40f053481067d2f2">seed</a> + cfra);
<a name="l00177"></a>00177     <span class="keywordflow">else</span>
<a name="l00178"></a>00178         <a class="code" href="../../d3/d88/BLI__rand_8h.html#a3e9c47d7f74f1990272945126795c31d">rng_srandom</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a1a9b02c0ce6e796e05bca15bdc5776c0">rng</a>, eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a0f7a3f82ff39133f40f053481067d2f2">seed</a> + cfra);
<a name="l00179"></a>00179 
<a name="l00180"></a>00180     <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba9598d9b623f4d97c79250a80fec316b6">PFIELD_GUIDE</a> &amp;&amp; eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>) {
<a name="l00181"></a>00181         <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00182"></a>00182         <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae59d98d3a2c7e6fddf4aa7fff72bcf88">CU_PATH</a>) {
<a name="l00183"></a>00183             <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a946ca944a39e912802a59396578e5a1f">path</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a946ca944a39e912802a59396578e5a1f">path</a>-&gt;<a class="code" href="../../d3/d20/structPath.html#a15dc781d9ad24530d3a8d218c7b79aca">data</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00184"></a>00184                 <a class="code" href="../../d9/d12/BKE__displist_8h.html#a5ca43234b8f9db71b0318b29716b5487">makeDispListCurveTypes</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#aa5f00cbdbeb2f4504874670311c4837e">scene</a>, eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>, 0);
<a name="l00185"></a>00185 
<a name="l00186"></a>00186             <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a946ca944a39e912802a59396578e5a1f">path</a> &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a946ca944a39e912802a59396578e5a1f">path</a>-&gt;<a class="code" href="../../d3/d20/structPath.html#a15dc781d9ad24530d3a8d218c7b79aca">data</a>) {
<a name="l00187"></a>00187                 <a class="code" href="../../df/dd0/BKE__anim_8h.html#a36e926e41221928bb037b16aa04becc0">where_on_path</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>, 0.0, eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a9407dbd2056371ddc369428a9d14312f">guide_loc</a>, eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a854129439df13df70d35904face62f97">guide_dir</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a95d77ba57e6396030c392887ac9e234b">guide_radius</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00188"></a>00188                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a9407dbd2056371ddc369428a9d14312f">guide_loc</a>);
<a name="l00189"></a>00189                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad5cae73de10c30273f8c0fdc00fa648c">mul_mat3_m4_v3</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a854129439df13df70d35904face62f97">guide_dir</a>);
<a name="l00190"></a>00190             }
<a name="l00191"></a>00191         }
<a name="l00192"></a>00192     }
<a name="l00193"></a>00193     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a44ba6da57ec66074da56f4c50066c198">shape</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a0bdeb46403257fa557dc3abeaccb2b6d">PFIELD_SHAPE_SURFACE</a>) {
<a name="l00194"></a>00194         eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a5601aed35e5b5965fe11190dd32ee81c">surmd</a> = (<a class="code" href="../../df/d40/structSurfaceModifierData.html">SurfaceModifierData</a> *)<a class="code" href="../../d3/d0f/BKE__modifier_8h.html#a90fa4bb334209f7e9f25fc6c4a594574">modifiers_findByType</a> ( eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>, <a class="code" href="../../da/df0/DNA__modifier__types_8h.html#a96ba018ea46fb28e626c3b573aca5435a5163fb176684a2ff2f47657ac51ab973">eModifierType_Surface</a> );
<a name="l00195"></a>00195         <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>)
<a name="l00196"></a>00196             eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ab0196afe758f721bf48df6de7211677f">flag</a> |= <a class="code" href="../../dc/d65/BKE__effect_8h.html#acb1cae64af27946fa736cdaf5f06ff30">PE_USE_NORMAL_DATA</a>;
<a name="l00197"></a>00197     }
<a name="l00198"></a>00198     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a2b8136e4412ed716fabc2f80e00a0d2d">psys</a>)
<a name="l00199"></a>00199         <a class="code" href="../../db/dca/BKE__particle_8h.html#aa570fc2652464faaab8b8edbe67fe176">psys_update_particle_tree</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a2b8136e4412ed716fabc2f80e00a0d2d">psys</a>, eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#aa5f00cbdbeb2f4504874670311c4837e">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a>);
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     <span class="comment">/* Store object velocity */</span>
<a name="l00202"></a>00202     <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>) {
<a name="l00203"></a>00203         <span class="keywordtype">float</span> old_vel[3];
<a name="l00204"></a>00204 
<a name="l00205"></a>00205         <a class="code" href="../../df/dac/BKE__object_8h.html#a041216c9db7724b51417887b9e31f5d3">where_is_object_time</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#aa5f00cbdbeb2f4504874670311c4837e">scene</a>, eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>, cfra - 1.0f);
<a name="l00206"></a>00206         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(old_vel, eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3]); 
<a name="l00207"></a>00207         <a class="code" href="../../df/dac/BKE__object_8h.html#a041216c9db7724b51417887b9e31f5d3">where_is_object_time</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#aa5f00cbdbeb2f4504874670311c4837e">scene</a>, eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>, cfra);
<a name="l00208"></a>00208         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a03347969fd91cd6ae18f42978df6cf90">velocity</a>, eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3], old_vel);
<a name="l00209"></a>00209     }
<a name="l00210"></a>00210 }
<a name="l00211"></a><a class="code" href="../../d7/d50/effect_8c.html#ab0376ce115872a10698f6e96ef7b808d">00211</a> <span class="keyword">static</span> <a class="code" href="../../d6/d53/structEffectorCache.html">EffectorCache</a> *<a class="code" href="../../d7/d50/effect_8c.html#ab0376ce115872a10698f6e96ef7b808d">new_effector_cache</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys, <a class="code" href="../../d3/d76/structPartDeflect.html">PartDeflect</a> *pd)
<a name="l00212"></a>00212 {
<a name="l00213"></a>00213     <a class="code" href="../../d6/d53/structEffectorCache.html">EffectorCache</a> *eff = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d53/structEffectorCache.html">EffectorCache</a>), <span class="stringliteral">&quot;EffectorCache&quot;</span>);
<a name="l00214"></a>00214     eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#aa5f00cbdbeb2f4504874670311c4837e">scene</a> = scene;
<a name="l00215"></a>00215     eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a> = ob;
<a name="l00216"></a>00216     eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a2b8136e4412ed716fabc2f80e00a0d2d">psys</a> = psys;
<a name="l00217"></a>00217     eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a> = pd;
<a name="l00218"></a>00218     eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a831db80e88fe35675bf7c9fe948ec95f">frame</a> = -1;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <a class="code" href="../../d7/d50/effect_8c.html#adb5a7f0a8aea8834c8e2139655ea1d2c">precalculate_effector</a>(eff);
<a name="l00221"></a>00221 
<a name="l00222"></a>00222     <span class="keywordflow">return</span> eff;
<a name="l00223"></a>00223 }
<a name="l00224"></a><a class="code" href="../../d7/d50/effect_8c.html#a1330c6ccb0ba85918e559f36a5156ee9">00224</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d50/effect_8c.html#a1330c6ccb0ba85918e559f36a5156ee9">add_object_to_effectors</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> **effectors, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../db/d19/structEffectorWeights.html">EffectorWeights</a> *weights, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob_src)
<a name="l00225"></a>00225 {
<a name="l00226"></a>00226     <a class="code" href="../../d6/d53/structEffectorCache.html">EffectorCache</a> *eff = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228     <span class="keywordflow">if</span> ( ob == ob_src || weights-&gt;<a class="code" href="../../db/d19/structEffectorWeights.html#a7bdfc847d45615d3d76cc8404d4ce989">weight</a>[ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a>] == 0.0f )
<a name="l00229"></a>00229         <span class="keywordflow">return</span>;
<a name="l00230"></a>00230 
<a name="l00231"></a>00231     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a44ba6da57ec66074da56f4c50066c198">shape</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a73a452a69b3f0ab1a0862de970d2691f">PFIELD_SHAPE_POINTS</a> &amp;&amp; !ob-&gt;<a class="code" href="../../de/de7/structObject.html#a90f2cb67625caff2124e0675ea32510d">derivedFinal</a> )
<a name="l00232"></a>00232         <span class="keywordflow">return</span>;
<a name="l00233"></a>00233 
<a name="l00234"></a>00234     <span class="keywordflow">if</span> (*effectors == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00235"></a>00235         *effectors = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a>), <span class="stringliteral">&quot;effectors list&quot;</span>);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     eff = <a class="code" href="../../d7/d50/effect_8c.html#ab0376ce115872a10698f6e96ef7b808d">new_effector_cache</a>(scene, ob, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     <span class="comment">/* make sure imat is up to date */</span>
<a name="l00240"></a>00240     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a65d360837f87824d49ed08caf44dccb3">imat</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l00241"></a>00241 
<a name="l00242"></a>00242     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(*effectors, eff);
<a name="l00243"></a>00243 }
<a name="l00244"></a><a class="code" href="../../d7/d50/effect_8c.html#af056fc87c60fab38f71647a0c20f4f6a">00244</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d50/effect_8c.html#af056fc87c60fab38f71647a0c20f4f6a">add_particles_to_effectors</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> **effectors, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../db/d19/structEffectorWeights.html">EffectorWeights</a> *weights, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys, <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys_src)
<a name="l00245"></a>00245 {
<a name="l00246"></a>00246     <a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *part= psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>;
<a name="l00247"></a>00247 
<a name="l00248"></a>00248     <span class="keywordflow">if</span> ( !<a class="code" href="../../db/dca/BKE__particle_8h.html#ae1ec21bf7aea2fdbe47e71514b97d919">psys_check_enabled</a>(ob, psys) )
<a name="l00249"></a>00249         <span class="keywordflow">return</span>;
<a name="l00250"></a>00250 
<a name="l00251"></a>00251     <span class="keywordflow">if</span> ( psys == psys_src &amp;&amp; (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a395ca2446ef372e1f852d7e4efc2b396">flag</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a2d53d283c8ef06414094dd45c466a1a1">PART_SELF_EFFECT</a>) == 0)
<a name="l00252"></a>00252         <span class="keywordflow">return</span>;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254     <span class="keywordflow">if</span> ( part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a9965e362e000f08c1a31e1a2562a1f07">pd</a> &amp;&amp; part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a9965e362e000f08c1a31e1a2562a1f07">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> &amp;&amp; weights-&gt;<a class="code" href="../../db/d19/structEffectorWeights.html#a7bdfc847d45615d3d76cc8404d4ce989">weight</a>[part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a9965e362e000f08c1a31e1a2562a1f07">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a>] != 0.0f) {
<a name="l00255"></a>00255         <span class="keywordflow">if</span> (*effectors == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00256"></a>00256             *effectors = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a>), <span class="stringliteral">&quot;effectors list&quot;</span>);
<a name="l00257"></a>00257 
<a name="l00258"></a>00258         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(*effectors, <a class="code" href="../../d7/d50/effect_8c.html#ab0376ce115872a10698f6e96ef7b808d">new_effector_cache</a>(scene, ob, psys, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a9965e362e000f08c1a31e1a2562a1f07">pd</a>));
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a1aa83e96a67b415c2aac979ad485f9e0">pd2</a> &amp;&amp; part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a1aa83e96a67b415c2aac979ad485f9e0">pd2</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> &amp;&amp; weights-&gt;<a class="code" href="../../db/d19/structEffectorWeights.html#a7bdfc847d45615d3d76cc8404d4ce989">weight</a>[part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a1aa83e96a67b415c2aac979ad485f9e0">pd2</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a>] != 0.0f) {
<a name="l00262"></a>00262         <span class="keywordflow">if</span> (*effectors == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00263"></a>00263             *effectors = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a>), <span class="stringliteral">&quot;effectors list&quot;</span>);
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(*effectors, <a class="code" href="../../d7/d50/effect_8c.html#ab0376ce115872a10698f6e96ef7b808d">new_effector_cache</a>(scene, ob, psys, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a1aa83e96a67b415c2aac979ad485f9e0">pd2</a>));
<a name="l00266"></a>00266     }
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 <span class="comment">/* returns ListBase handle with objects taking part in the effecting */</span>
<a name="l00270"></a><a class="code" href="../../d7/d50/effect_8c.html#ad78dc70def3d78954e6909a84a4e8033">00270</a> <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *<a class="code" href="../../dc/d65/BKE__effect_8h.html#a6ebcd51628cbb20d3556d779e0b506fe">pdInitEffectors</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob_src, <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys_src, <a class="code" href="../../db/d19/structEffectorWeights.html">EffectorWeights</a> *weights)
<a name="l00271"></a>00271 {
<a name="l00272"></a>00272     <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l00273"></a>00273     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> layer= ob_src-&gt;<a class="code" href="../../de/de7/structObject.html#aa9cfa964651e1e2f3044c9c79cf004b3">lay</a>;
<a name="l00274"></a>00274     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *effectors = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00275"></a>00275     
<a name="l00276"></a>00276     <span class="keywordflow">if</span> (weights-&gt;<a class="code" href="../../db/d19/structEffectorWeights.html#a43d09358bdd0b25e6c35c513ab993b34">group</a>) {
<a name="l00277"></a>00277         <a class="code" href="../../d3/d3b/structGroupObject.html">GroupObject</a> *go;
<a name="l00278"></a>00278         
<a name="l00279"></a>00279         <span class="keywordflow">for</span> (go= weights-&gt;<a class="code" href="../../db/d19/structEffectorWeights.html#a43d09358bdd0b25e6c35c513ab993b34">group</a>-&gt;<a class="code" href="../../d4/d91/structGroup.html#ad757bf69b6fd15b1d4e0980089d13be1">gobject</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; go; go= go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#a81e7437ba90ec95c5fbb96e17e6a203d">next</a>) {
<a name="l00280"></a>00280             <span class="keywordflow">if</span> ( (go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa9cfa964651e1e2f3044c9c79cf004b3">lay</a> &amp; layer) ) {
<a name="l00281"></a>00281                 <span class="keywordflow">if</span> ( go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a> &amp;&amp; go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> )
<a name="l00282"></a>00282                     <a class="code" href="../../d7/d50/effect_8c.html#a1330c6ccb0ba85918e559f36a5156ee9">add_object_to_effectors</a>(&amp;effectors, scene, weights, go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>, ob_src);
<a name="l00283"></a>00283 
<a name="l00284"></a>00284                 <span class="keywordflow">if</span> ( go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> ) {
<a name="l00285"></a>00285                     <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys= go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00286"></a>00286 
<a name="l00287"></a>00287                     <span class="keywordflow">for</span> ( ; psys; psys=psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a734228c70c56227c6f7a29145a5f5b57">next</a> )
<a name="l00288"></a>00288                         <a class="code" href="../../d7/d50/effect_8c.html#af056fc87c60fab38f71647a0c20f4f6a">add_particles_to_effectors</a>(&amp;effectors, scene, weights, go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>, psys, psys_src);
<a name="l00289"></a>00289                 }
<a name="l00290"></a>00290             }
<a name="l00291"></a>00291         }
<a name="l00292"></a>00292     }
<a name="l00293"></a>00293     <span class="keywordflow">else</span> {
<a name="l00294"></a>00294         <span class="keywordflow">for</span> (base = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; base; base= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a25befa992d0ce8876b7d62176212be68">next</a>) {
<a name="l00295"></a>00295             <span class="keywordflow">if</span> ( (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a8c3a6cb18ff56393b617978c497c54aa">lay</a> &amp; layer) ) {
<a name="l00296"></a>00296                 <span class="keywordflow">if</span> ( base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a> &amp;&amp; base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> )
<a name="l00297"></a>00297                 <a class="code" href="../../d7/d50/effect_8c.html#a1330c6ccb0ba85918e559f36a5156ee9">add_object_to_effectors</a>(&amp;effectors, scene, weights, base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>, ob_src);
<a name="l00298"></a>00298 
<a name="l00299"></a>00299                 <span class="keywordflow">if</span> ( base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> ) {
<a name="l00300"></a>00300                     <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00301"></a>00301 
<a name="l00302"></a>00302                     <span class="keywordflow">for</span> ( ; psys; psys=psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a734228c70c56227c6f7a29145a5f5b57">next</a> )
<a name="l00303"></a>00303                         <a class="code" href="../../d7/d50/effect_8c.html#af056fc87c60fab38f71647a0c20f4f6a">add_particles_to_effectors</a>(&amp;effectors, scene, weights, base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>, psys, psys_src);
<a name="l00304"></a>00304                 }
<a name="l00305"></a>00305             }
<a name="l00306"></a>00306         }
<a name="l00307"></a>00307     }
<a name="l00308"></a>00308     <span class="keywordflow">return</span> effectors;
<a name="l00309"></a>00309 }
<a name="l00310"></a>00310 
<a name="l00311"></a><a class="code" href="../../d7/d50/effect_8c.html#a18827471ab2b8f596f70325a93528582">00311</a> <span class="keywordtype">void</span> <a class="code" href="../../dc/d65/BKE__effect_8h.html#a7da5e7ad353e025440f05a9adbd7032d">pdEndEffectors</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> **effectors)
<a name="l00312"></a>00312 {
<a name="l00313"></a>00313     <span class="keywordflow">if</span> (*effectors) {
<a name="l00314"></a>00314         <a class="code" href="../../d6/d53/structEffectorCache.html">EffectorCache</a> *eff = (*effectors)-&gt;first;
<a name="l00315"></a>00315 
<a name="l00316"></a>00316         <span class="keywordflow">for</span> (; eff; eff=eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#adb86179b9e326c4785cc0023860f828b">next</a>) {
<a name="l00317"></a>00317             <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ab3388b92411f7a9077a8a3c2a2b87d3f">guide_data</a>)
<a name="l00318"></a>00318                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ab3388b92411f7a9077a8a3c2a2b87d3f">guide_data</a>);
<a name="l00319"></a>00319         }
<a name="l00320"></a>00320 
<a name="l00321"></a>00321         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(*effectors);
<a name="l00322"></a>00322         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(*effectors);
<a name="l00323"></a>00323         *effectors = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00324"></a>00324     }
<a name="l00325"></a>00325 }
<a name="l00326"></a>00326 
<a name="l00327"></a>00327 
<a name="l00328"></a><a class="code" href="../../d7/d50/effect_8c.html#a67b8cb4abe8c4829d6ab0e2c2df75317">00328</a> <span class="keywordtype">void</span> <a class="code" href="../../dc/d65/BKE__effect_8h.html#ae9109fc44dd1583fda8a8e5a293e2783">pd_point_from_particle</a>(<a class="code" href="../../de/df5/structParticleSimulationData.html">ParticleSimulationData</a> *sim, <a class="code" href="../../dc/d76/structParticleData.html">ParticleData</a> *pa, <a class="code" href="../../d3/d31/structParticleKey.html">ParticleKey</a> *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>, <a class="code" href="../../db/d29/structEffectedPoint.html">EffectedPoint</a> *<a class="code" href="../../d8/dae/structpoint.html">point</a>)
<a name="l00329"></a>00329 {
<a name="l00330"></a>00330     <a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *part = sim-&gt;<a class="code" href="../../de/df5/structParticleSimulationData.html#a98365d240570a76067ad5d707ba70ce8">psys</a>-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>;
<a name="l00331"></a>00331     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a8275f6f74ab812a1426d2ebc1c0e80ed">loc</a> = state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>;
<a name="l00332"></a>00332     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a341b7512601d963e4f0458ecf036b2ac">vel</a> = state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a2784ffc7a428dff13e5f031178706fee">vel</a>;
<a name="l00333"></a>00333     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#ad9d245ed66d8add2d6867927e34334b1">index</a> = pa - sim-&gt;<a class="code" href="../../de/df5/structParticleSimulationData.html#a98365d240570a76067ad5d707ba70ce8">psys</a>-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a>;
<a name="l00334"></a>00334     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a6274eee752f583626ac2cd725395127f">size</a> = pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a4cd9a6f1328a2b83a7a27c8d38f2cbf6">size</a>;
<a name="l00335"></a>00335     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#ab889cdc12c65133bb406548554a99365">charge</a> = 0.0f;
<a name="l00336"></a>00336     
<a name="l00337"></a>00337     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a9965e362e000f08c1a31e1a2562a1f07">pd</a> &amp;&amp; part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a9965e362e000f08c1a31e1a2562a1f07">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba62551cc8701c9e2cea1b33c76a3e2a7f">PFIELD_CHARGE</a>)
<a name="l00338"></a>00338         point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#ab889cdc12c65133bb406548554a99365">charge</a> += part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a9965e362e000f08c1a31e1a2562a1f07">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a6cff5078ee6e06da8a0164ba49cf5a7c">f_strength</a>;
<a name="l00339"></a>00339 
<a name="l00340"></a>00340     <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a1aa83e96a67b415c2aac979ad485f9e0">pd2</a> &amp;&amp; part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a1aa83e96a67b415c2aac979ad485f9e0">pd2</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba62551cc8701c9e2cea1b33c76a3e2a7f">PFIELD_CHARGE</a>)
<a name="l00341"></a>00341         point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#ab889cdc12c65133bb406548554a99365">charge</a> += part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a1aa83e96a67b415c2aac979ad485f9e0">pd2</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a6cff5078ee6e06da8a0164ba49cf5a7c">f_strength</a>;
<a name="l00342"></a>00342 
<a name="l00343"></a>00343     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a046d9c160ba8dab8dfcb696a586f1674">vel_to_sec</a> = 1.0f;
<a name="l00344"></a>00344     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a776ffa765588fb44029ca596f9e68fa5">vel_to_frame</a> = <a class="code" href="../../db/dca/BKE__particle_8h.html#a75c75a40fcacfa5cb9e05638d6e823ad">psys_get_timestep</a>(sim);
<a name="l00345"></a>00345 
<a name="l00346"></a>00346     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a87ef0021915ff187a80514475d40edb1">flag</a> = 0;
<a name="l00347"></a>00347 
<a name="l00348"></a>00348     <span class="keywordflow">if</span> (sim-&gt;<a class="code" href="../../de/df5/structParticleSimulationData.html#a98365d240570a76067ad5d707ba70ce8">psys</a>-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a395ca2446ef372e1f852d7e4efc2b396">flag</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ad0717fb365b30da8ad2381fd9a688a4c">PART_ROT_DYN</a>) {
<a name="l00349"></a>00349         point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#ab1794e8b56a3784f00b1253742d8a2e8">ave</a> = state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a1a1abb763544678adb29ac1305ca63b9">ave</a>;
<a name="l00350"></a>00350         point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a995f245118e3370de559e8658f6d83d2">rot</a> = state-&gt;<a class="code" href="../../d3/d31/structParticleKey.html#a33ddd3b5915822847448bee82089feea">rot</a>;
<a name="l00351"></a>00351     }
<a name="l00352"></a>00352     <span class="keywordflow">else</span>
<a name="l00353"></a>00353         point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#ab1794e8b56a3784f00b1253742d8a2e8">ave</a> = point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a995f245118e3370de559e8658f6d83d2">rot</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00354"></a>00354 
<a name="l00355"></a>00355     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a43d66df2a07e1d83aba4c2980a674793">psys</a> = sim-&gt;<a class="code" href="../../de/df5/structParticleSimulationData.html#a98365d240570a76067ad5d707ba70ce8">psys</a>;
<a name="l00356"></a>00356 }
<a name="l00357"></a>00357 
<a name="l00358"></a><a class="code" href="../../d7/d50/effect_8c.html#a64228288e1ad59ff89b8a59a4f26cd87">00358</a> <span class="keywordtype">void</span> <a class="code" href="../../dc/d65/BKE__effect_8h.html#ae22b94ef02dbbc4e3b85dc9f8e001c6b">pd_point_from_loc</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <span class="keywordtype">float</span> *loc, <span class="keywordtype">float</span> *vel, <span class="keywordtype">int</span> index, <a class="code" href="../../db/d29/structEffectedPoint.html">EffectedPoint</a> *<a class="code" href="../../d8/dae/structpoint.html">point</a>)
<a name="l00359"></a>00359 {
<a name="l00360"></a>00360     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a8275f6f74ab812a1426d2ebc1c0e80ed">loc</a> = loc;
<a name="l00361"></a>00361     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a341b7512601d963e4f0458ecf036b2ac">vel</a> = vel;
<a name="l00362"></a>00362     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#ad9d245ed66d8add2d6867927e34334b1">index</a> = index;
<a name="l00363"></a>00363     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a6274eee752f583626ac2cd725395127f">size</a> = 0.0f;
<a name="l00364"></a>00364 
<a name="l00365"></a>00365     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a046d9c160ba8dab8dfcb696a586f1674">vel_to_sec</a> = (float)scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a071df993e13c05fc37e6f9a82c0679f5">frs_sec</a>;
<a name="l00366"></a>00366     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a776ffa765588fb44029ca596f9e68fa5">vel_to_frame</a> = 1.0f;
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a87ef0021915ff187a80514475d40edb1">flag</a> = 0;
<a name="l00369"></a>00369 
<a name="l00370"></a>00370     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#ab1794e8b56a3784f00b1253742d8a2e8">ave</a> = point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a995f245118e3370de559e8658f6d83d2">rot</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00371"></a>00371     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a43d66df2a07e1d83aba4c2980a674793">psys</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00372"></a>00372 }
<a name="l00373"></a><a class="code" href="../../d7/d50/effect_8c.html#ac17cc879acea119e4c98c7616a30457f">00373</a> <span class="keywordtype">void</span> <a class="code" href="../../dc/d65/BKE__effect_8h.html#a7ed88ae8138e32a6549a8ce984275137">pd_point_from_soft</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <span class="keywordtype">float</span> *loc, <span class="keywordtype">float</span> *vel, <span class="keywordtype">int</span> index, <a class="code" href="../../db/d29/structEffectedPoint.html">EffectedPoint</a> *<a class="code" href="../../d8/dae/structpoint.html">point</a>)
<a name="l00374"></a>00374 {
<a name="l00375"></a>00375     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a8275f6f74ab812a1426d2ebc1c0e80ed">loc</a> = loc;
<a name="l00376"></a>00376     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a341b7512601d963e4f0458ecf036b2ac">vel</a> = vel;
<a name="l00377"></a>00377     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#ad9d245ed66d8add2d6867927e34334b1">index</a> = index;
<a name="l00378"></a>00378     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a6274eee752f583626ac2cd725395127f">size</a> = 0.0f;
<a name="l00379"></a>00379 
<a name="l00380"></a>00380     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a046d9c160ba8dab8dfcb696a586f1674">vel_to_sec</a> = (float)scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a071df993e13c05fc37e6f9a82c0679f5">frs_sec</a>;
<a name="l00381"></a>00381     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a776ffa765588fb44029ca596f9e68fa5">vel_to_frame</a> = 1.0f;
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a87ef0021915ff187a80514475d40edb1">flag</a> = <a class="code" href="../../dc/d65/BKE__effect_8h.html#ae3176f609ab517b6be5ec61d3ae1f2b7">PE_WIND_AS_SPEED</a>;
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#ab1794e8b56a3784f00b1253742d8a2e8">ave</a> = point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a995f245118e3370de559e8658f6d83d2">rot</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00386"></a>00386 
<a name="l00387"></a>00387     point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a43d66df2a07e1d83aba4c2980a674793">psys</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00388"></a>00388 }
<a name="l00389"></a>00389 <span class="comment">/************************************************/</span>
<a name="l00390"></a>00390 <span class="comment">/*          Effectors       */</span>
<a name="l00391"></a>00391 <span class="comment">/************************************************/</span>
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 <span class="comment">// triangle - ray callback function</span>
<a name="l00394"></a><a class="code" href="../../d7/d50/effect_8c.html#a96ebcc2a39da676635d6c9b31cb20299">00394</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d50/effect_8c.html#a96ebcc2a39da676635d6c9b31cb20299">eff_tri_ray_hit</a>(<span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(userData), <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(index), <span class="keyword">const</span> <a class="code" href="../../d5/d6e/structBVHTreeRay.html">BVHTreeRay</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(ray), <a class="code" href="../../d7/dd9/structBVHTreeRayHit.html">BVHTreeRayHit</a> *hit)
<a name="l00395"></a>00395 {   
<a name="l00396"></a>00396     <span class="comment">// whenever we hit a bounding box, we don&#39;t check further</span>
<a name="l00397"></a>00397     hit-&gt;<a class="code" href="../../d7/dd9/structBVHTreeRayHit.html#aacc4e450c7e6b40afcdd2da1ef64be6a">dist</a> = -1;
<a name="l00398"></a>00398     hit-&gt;<a class="code" href="../../d7/dd9/structBVHTreeRayHit.html#a4f2b11fb74f73302e32f0842c4abee1e">index</a> = 1;
<a name="l00399"></a>00399 }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401 <span class="comment">// get visibility of a wind ray</span>
<a name="l00402"></a><a class="code" href="../../d7/d50/effect_8c.html#aeb898451d1574dc6bacc24dbc1fa8ca9">00402</a> <span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../d7/d50/effect_8c.html#aeb898451d1574dc6bacc24dbc1fa8ca9">eff_calc_visibility</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *colliders, <a class="code" href="../../d6/d53/structEffectorCache.html">EffectorCache</a> *eff, <a class="code" href="../../d8/d38/structEffectorData.html">EffectorData</a> *efd, <a class="code" href="../../db/d29/structEffectedPoint.html">EffectedPoint</a> *<a class="code" href="../../d8/dae/structpoint.html">point</a>)
<a name="l00403"></a>00403 {
<a name="l00404"></a>00404     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *colls = colliders;
<a name="l00405"></a>00405     <a class="code" href="../../d7/d85/structColliderCache.html">ColliderCache</a> *col;
<a name="l00406"></a>00406     <span class="keywordtype">float</span> <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a>[3], <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a> = 0.0;
<a name="l00407"></a>00407     <span class="keywordtype">float</span> visibility = 1.0, absorption = 0.0;
<a name="l00408"></a>00408     
<a name="l00409"></a>00409     <span class="keywordflow">if</span> (!(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a2f71a7f95a02de6118cebc88d7cd3059">PFIELD_VISIBILITY</a>))
<a name="l00410"></a>00410         <span class="keywordflow">return</span> visibility;
<a name="l00411"></a>00411 
<a name="l00412"></a>00412     <span class="keywordflow">if</span> (!colls)
<a name="l00413"></a>00413         colls = <a class="code" href="../../d6/de6/BKE__collision_8h.html#a8a72494b6a3ccf837fb0d48d0bcd8466">get_collider_cache</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#aa5f00cbdbeb2f4504874670311c4837e">scene</a>, eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00414"></a>00414 
<a name="l00415"></a>00415     <span class="keywordflow">if</span> (!colls)
<a name="l00416"></a>00416         <span class="keywordflow">return</span> visibility;
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a728bb3f38e925644683c9ace0cee4977">negate_v3_v3</a>(norm, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a3560debc48a5b9082fde6dd0ecb43670">vec_to_point</a>);
<a name="l00419"></a>00419     len = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(norm);
<a name="l00420"></a>00420     
<a name="l00421"></a>00421     <span class="comment">// check all collision objects</span>
<a name="l00422"></a>00422     <span class="keywordflow">for</span> (col = colls-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; col; col = col-&gt;<a class="code" href="../../d7/d85/structColliderCache.html#ae6807bf10c556470545dd4044350be64">next</a>)
<a name="l00423"></a>00423     {
<a name="l00424"></a>00424         <a class="code" href="../../d7/d2f/structCollisionModifierData.html">CollisionModifierData</a> *collmd = col-&gt;<a class="code" href="../../d7/d85/structColliderCache.html#abfdb93d2d3e379c739d01cb50361c695">collmd</a>;
<a name="l00425"></a>00425 
<a name="l00426"></a>00426         <span class="keywordflow">if</span> (col-&gt;<a class="code" href="../../d7/d85/structColliderCache.html#a6a3c50558d09e5c9e70c1a963b6d0703">ob</a> == eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>)
<a name="l00427"></a>00427             <span class="keywordflow">continue</span>;
<a name="l00428"></a>00428         
<a name="l00429"></a>00429         <span class="keywordflow">if</span> (collmd-&gt;<a class="code" href="../../d7/d2f/structCollisionModifierData.html#a239507a70644d0438b50d1969f744aac">bvhtree</a>) {
<a name="l00430"></a>00430             <a class="code" href="../../d7/dd9/structBVHTreeRayHit.html">BVHTreeRayHit</a> hit;
<a name="l00431"></a>00431             
<a name="l00432"></a>00432             hit.<a class="code" href="../../d7/dd9/structBVHTreeRayHit.html#a4f2b11fb74f73302e32f0842c4abee1e">index</a> = -1;
<a name="l00433"></a>00433             hit.<a class="code" href="../../d7/dd9/structBVHTreeRayHit.html#aacc4e450c7e6b40afcdd2da1ef64be6a">dist</a> = len + FLT_EPSILON;
<a name="l00434"></a>00434             
<a name="l00435"></a>00435             <span class="comment">// check if the way is blocked</span>
<a name="l00436"></a>00436             <span class="keywordflow">if</span> (<a class="code" href="../../d5/dc5/BLI__kdopbvh_8h.html#a961a896017037e95a717e06943983f44">BLI_bvhtree_ray_cast</a>(collmd-&gt;<a class="code" href="../../d7/d2f/structCollisionModifierData.html#a239507a70644d0438b50d1969f744aac">bvhtree</a>, point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a8275f6f74ab812a1426d2ebc1c0e80ed">loc</a>, norm, 0.0f, &amp;hit, <a class="code" href="../../d7/d50/effect_8c.html#a96ebcc2a39da676635d6c9b31cb20299">eff_tri_ray_hit</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)&gt;=0) {
<a name="l00437"></a>00437                 absorption= col-&gt;<a class="code" href="../../d7/d85/structColliderCache.html#a6a3c50558d09e5c9e70c1a963b6d0703">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a8a60d3c67647e89b3d2185ebf5696f9b">absorption</a>;
<a name="l00438"></a>00438 
<a name="l00439"></a>00439                 <span class="comment">// visibility is only between 0 and 1, calculated from 1-absorption</span>
<a name="l00440"></a>00440                 visibility *= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a49a86f7d81f477961529de3add6d68ab">CLAMPIS</a>(1.0f-absorption, 0.0f, 1.0f);
<a name="l00441"></a>00441                 
<a name="l00442"></a>00442                 <span class="keywordflow">if</span> (visibility &lt;= 0.0f)
<a name="l00443"></a>00443                     <span class="keywordflow">break</span>;
<a name="l00444"></a>00444             }
<a name="l00445"></a>00445         }
<a name="l00446"></a>00446     }
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     <span class="keywordflow">if</span> (!colliders)
<a name="l00449"></a>00449         <a class="code" href="../../d6/de6/BKE__collision_8h.html#ad0ad8be2c5f909fc0418178e2f023ffe">free_collider_cache</a>(&amp;colls);
<a name="l00450"></a>00450     
<a name="l00451"></a>00451     <span class="keywordflow">return</span> visibility;
<a name="l00452"></a>00452 }
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 <span class="comment">// noise function for wind e.g.</span>
<a name="l00455"></a><a class="code" href="../../d7/d50/effect_8c.html#a198538be4d1d5ff8e3e922e0bf7f06f2">00455</a> <span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../d7/d50/effect_8c.html#a198538be4d1d5ff8e3e922e0bf7f06f2">wind_func</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/d3e/structRNG.html">RNG</a> *rng, <span class="keywordtype">float</span> strength)
<a name="l00456"></a>00456 {
<a name="l00457"></a>00457     <span class="keywordtype">int</span> <a class="code" href="../../d4/d44/frames_8inl.html#a9f76654728449cbb330e854b25f77ec3" title="addDelta operator for displacement rotational velocity.">random</a> = (<a class="code" href="../../d3/d88/BLI__rand_8h.html#a45ae0985904a0542e7823787f5d09e1b">rng_getInt</a>(rng)+1) % 128; <span class="comment">// max 2357</span>
<a name="l00458"></a>00458     <span class="keywordtype">float</span> force = <a class="code" href="../../d3/d88/BLI__rand_8h.html#ab057c7a77c085d764280bae1b48aa85e">rng_getFloat</a>(rng) + 1.0f;
<a name="l00459"></a>00459     <span class="keywordtype">float</span> ret;
<a name="l00460"></a>00460     <span class="keywordtype">float</span> <a class="code" href="../../d1/d13/namespaceTNT.html#a051812668d41cc65f9b8f0518e47b466">sign</a> = 0;
<a name="l00461"></a>00461     
<a name="l00462"></a>00462     sign = ((float)random &gt; 64.0f) ? 1.0f: -1.0f; <span class="comment">// dividing by 2 is not giving equal sign distribution</span>
<a name="l00463"></a>00463     
<a name="l00464"></a>00464     ret = sign*((float)random / force)*strength/128.0f;
<a name="l00465"></a>00465     
<a name="l00466"></a>00466     <span class="keywordflow">return</span> ret;
<a name="l00467"></a>00467 }
<a name="l00468"></a>00468 
<a name="l00469"></a>00469 <span class="comment">/* maxdist: zero effect from this distance outwards (if usemax) */</span>
<a name="l00470"></a>00470 <span class="comment">/* mindist: full effect up to this distance (if usemin) */</span>
<a name="l00471"></a>00471 <span class="comment">/* power: falloff with formula 1/r^power */</span>
<a name="l00472"></a><a class="code" href="../../d7/d50/effect_8c.html#af03173e8f6806582722366c37c0f80ce">00472</a> <span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../d7/d50/effect_8c.html#af03173e8f6806582722366c37c0f80ce">falloff_func</a>(<span class="keywordtype">float</span> fac, <span class="keywordtype">int</span> usemin, <span class="keywordtype">float</span> mindist, <span class="keywordtype">int</span> usemax, <span class="keywordtype">float</span> maxdist, <span class="keywordtype">float</span> power)
<a name="l00473"></a>00473 {
<a name="l00474"></a>00474     <span class="comment">/* first quick checks */</span>
<a name="l00475"></a>00475     <span class="keywordflow">if</span> (usemax &amp;&amp; fac &gt; maxdist)
<a name="l00476"></a>00476         <span class="keywordflow">return</span> 0.0f;
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     <span class="keywordflow">if</span> (usemin &amp;&amp; fac &lt; mindist)
<a name="l00479"></a>00479         <span class="keywordflow">return</span> 1.0f;
<a name="l00480"></a>00480 
<a name="l00481"></a>00481     <span class="keywordflow">if</span> (!usemin)
<a name="l00482"></a>00482         mindist = 0.0;
<a name="l00483"></a>00483 
<a name="l00484"></a>00484     <span class="keywordflow">return</span> <a class="code" href="../../d7/d47/NM__Scalar_8h.html#af46040b4ed6734ce0bcafe3e53d46dd3">pow</a>((<span class="keywordtype">double</span>)(1.0f+fac-mindist), (<span class="keywordtype">double</span>)(-power));
<a name="l00485"></a>00485 }
<a name="l00486"></a>00486 
<a name="l00487"></a><a class="code" href="../../d7/d50/effect_8c.html#a6e4e7e7e25186ce4355c918d176a9272">00487</a> <span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../d7/d50/effect_8c.html#a6e4e7e7e25186ce4355c918d176a9272">falloff_func_dist</a>(<a class="code" href="../../d3/d76/structPartDeflect.html">PartDeflect</a> *pd, <span class="keywordtype">float</span> fac)
<a name="l00488"></a>00488 {
<a name="l00489"></a>00489     <span class="keywordflow">return</span> <a class="code" href="../../d7/d50/effect_8c.html#af03173e8f6806582722366c37c0f80ce">falloff_func</a>(fac, pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a>&amp;<a class="code" href="../../d2/d60/DNA__object__force_8h.html#a4270a27eb9eb77e2dc072b7e46036f7e">PFIELD_USEMIN</a>, pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a89ecb02215e2583356d0b47e1369f2ee">mindist</a>, pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a>&amp;<a class="code" href="../../d2/d60/DNA__object__force_8h.html#aebe9057cbff4580b7382058209d6406c">PFIELD_USEMAX</a>, pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a23ef38ec3a78cd5875d4bbef354698bd">maxdist</a>, pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a7b691a9c35f8608bcb146af245f862b1">f_power</a>);
<a name="l00490"></a>00490 }
<a name="l00491"></a>00491 
<a name="l00492"></a><a class="code" href="../../d7/d50/effect_8c.html#af6306aed90738aaf9fc6b13fc18b909c">00492</a> <span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../d7/d50/effect_8c.html#af6306aed90738aaf9fc6b13fc18b909c">falloff_func_rad</a>(<a class="code" href="../../d3/d76/structPartDeflect.html">PartDeflect</a> *pd, <span class="keywordtype">float</span> fac)
<a name="l00493"></a>00493 {
<a name="l00494"></a>00494     <span class="keywordflow">return</span> <a class="code" href="../../d7/d50/effect_8c.html#af03173e8f6806582722366c37c0f80ce">falloff_func</a>(fac, pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a>&amp;<a class="code" href="../../d2/d60/DNA__object__force_8h.html#a3c06a387f4f07cf04db9d954c574ee48">PFIELD_USEMINR</a>, pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a8004517d15423896959411ae525ba8da">minrad</a>, pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a>&amp;<a class="code" href="../../d2/d60/DNA__object__force_8h.html#aae0a9e7044b6f344ff49991f1c1fa82a">PFIELD_USEMAXR</a>, pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#ab36c66edf5e70cf4dd1c324dae460ffd">maxrad</a>, pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a71a80b7016ba64de0ba119f16162a046">f_power_r</a>);
<a name="l00495"></a>00495 }
<a name="l00496"></a>00496 
<a name="l00497"></a><a class="code" href="../../d7/d50/effect_8c.html#ae0afb082cc7e115a875cb868a690648d">00497</a> <span class="keywordtype">float</span> <a class="code" href="../../dc/d65/BKE__effect_8h.html#a405478a1f2b0fd107e25a1494009895e">effector_falloff</a>(<a class="code" href="../../d6/d53/structEffectorCache.html">EffectorCache</a> *eff, <a class="code" href="../../d8/d38/structEffectorData.html">EffectorData</a> *efd, <a class="code" href="../../db/d29/structEffectedPoint.html">EffectedPoint</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<a class="code" href="../../d8/dae/structpoint.html">point</a>), <a class="code" href="../../db/d19/structEffectorWeights.html">EffectorWeights</a> *weights)
<a name="l00498"></a>00498 {
<a name="l00499"></a>00499     <span class="keywordtype">float</span> temp[3];
<a name="l00500"></a>00500     <span class="keywordtype">float</span> falloff = weights ? weights-&gt;<a class="code" href="../../db/d19/structEffectorWeights.html#a7bdfc847d45615d3d76cc8404d4ce989">weight</a>[0] * weights-&gt;<a class="code" href="../../db/d19/structEffectorWeights.html#a7bdfc847d45615d3d76cc8404d4ce989">weight</a>[eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a>] : 1.0f;
<a name="l00501"></a>00501     <span class="keywordtype">float</span> fac, r_fac;
<a name="l00502"></a>00502 
<a name="l00503"></a>00503     fac = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a76629ccfe891bccda30f790ed501e959">dot_v3v3</a>(efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a54ddf51bd07be2313283172b98066e69">vec_to_point2</a>);
<a name="l00504"></a>00504 
<a name="l00505"></a>00505     <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a798ba7b99c9bcb08442c5cc6abdc53b3">zdir</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a55b0966082a93bc9fc287f54d85c8ce9">PFIELD_Z_POS</a> &amp;&amp; fac &lt; 0.0f)
<a name="l00506"></a>00506         falloff=0.0f;
<a name="l00507"></a>00507     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a798ba7b99c9bcb08442c5cc6abdc53b3">zdir</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#aab3b102bf8b8dbf15ee935df78b433d4">PFIELD_Z_NEG</a> &amp;&amp; fac &gt; 0.0f)
<a name="l00508"></a>00508         falloff=0.0f;
<a name="l00509"></a>00509     <span class="keywordflow">else</span> <span class="keywordflow">switch</span>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a9854ac968a485aeaef50167c9068b7f8">falloff</a>) {
<a name="l00510"></a>00510         <span class="keywordflow">case</span> <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ad5255ec498661b241725dfa68f010cb2">PFIELD_FALL_SPHERE</a>:
<a name="l00511"></a>00511             falloff*= <a class="code" href="../../d7/d50/effect_8c.html#a6e4e7e7e25186ce4355c918d176a9272">falloff_func_dist</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a18029b83ae6f56e10095044119bc32f2">distance</a>);
<a name="l00512"></a>00512             <span class="keywordflow">break</span>;
<a name="l00513"></a>00513 
<a name="l00514"></a>00514         <span class="keywordflow">case</span> <a class="code" href="../../d2/d60/DNA__object__force_8h.html#aa0848947844fb0bf16a462b88d097130">PFIELD_FALL_TUBE</a>:
<a name="l00515"></a>00515             falloff*= <a class="code" href="../../d7/d50/effect_8c.html#a6e4e7e7e25186ce4355c918d176a9272">falloff_func_dist</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(fac));
<a name="l00516"></a>00516             <span class="keywordflow">if</span> (falloff == 0.0f)
<a name="l00517"></a>00517                 <span class="keywordflow">break</span>;
<a name="l00518"></a>00518 
<a name="l00519"></a>00519             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ac993b3c38bb2d5e7de48e57aab03db7f">madd_v3_v3v3fl</a>(temp, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a3560debc48a5b9082fde6dd0ecb43670">vec_to_point</a>, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>, -fac);
<a name="l00520"></a>00520             r_fac= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(temp);
<a name="l00521"></a>00521             falloff*= <a class="code" href="../../d7/d50/effect_8c.html#af6306aed90738aaf9fc6b13fc18b909c">falloff_func_rad</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>, r_fac);
<a name="l00522"></a>00522             <span class="keywordflow">break</span>;
<a name="l00523"></a>00523         <span class="keywordflow">case</span> <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a3e6bb406a9c41a3bdcddde8bc5026ef7">PFIELD_FALL_CONE</a>:
<a name="l00524"></a>00524             falloff*= <a class="code" href="../../d7/d50/effect_8c.html#a6e4e7e7e25186ce4355c918d176a9272">falloff_func_dist</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ae2f08dc603ae93c402abd918ba4e23e1">ABS</a>(fac));
<a name="l00525"></a>00525             <span class="keywordflow">if</span> (falloff == 0.0f)
<a name="l00526"></a>00526                 <span class="keywordflow">break</span>;
<a name="l00527"></a>00527 
<a name="l00528"></a>00528             r_fac= <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a95c550a7b3c9b2628d20aef44bc12b56">RAD2DEGF</a>(<a class="code" href="../../dd/d06/BLI__math__base_8h.html#a0b0ac0cef781c9d0eb9e57e3702f76db">saacos</a>(fac/<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a3560debc48a5b9082fde6dd0ecb43670">vec_to_point</a>)));
<a name="l00529"></a>00529             falloff*= <a class="code" href="../../d7/d50/effect_8c.html#af6306aed90738aaf9fc6b13fc18b909c">falloff_func_rad</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>, r_fac);
<a name="l00530"></a>00530 
<a name="l00531"></a>00531             <span class="keywordflow">break</span>;
<a name="l00532"></a>00532     }
<a name="l00533"></a>00533 
<a name="l00534"></a>00534     <span class="keywordflow">return</span> falloff;
<a name="l00535"></a>00535 }
<a name="l00536"></a>00536 
<a name="l00537"></a><a class="code" href="../../d7/d50/effect_8c.html#ac5b950a2fa3de4233e3e7dd689490306">00537</a> <span class="keywordtype">int</span> <a class="code" href="../../dc/d65/BKE__effect_8h.html#ac5b950a2fa3de4233e3e7dd689490306">closest_point_on_surface</a>(<a class="code" href="../../df/d40/structSurfaceModifierData.html">SurfaceModifierData</a> *surmd, <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>[3], <span class="keywordtype">float</span> surface_co[3], <span class="keywordtype">float</span> surface_nor[3], <span class="keywordtype">float</span> surface_vel[3])
<a name="l00538"></a>00538 {
<a name="l00539"></a>00539     <a class="code" href="../../da/df6/structBVHTreeNearest.html">BVHTreeNearest</a> nearest;
<a name="l00540"></a>00540 
<a name="l00541"></a>00541     nearest.<a class="code" href="../../da/df6/structBVHTreeNearest.html#a6adc3b3ada5dfaf14539d75ef484f10c">index</a> = -1;
<a name="l00542"></a>00542     nearest.<a class="code" href="../../da/df6/structBVHTreeNearest.html#a5fe4356b1da3b75698257fbc324cf94a">dist</a> = <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>;
<a name="l00543"></a>00543 
<a name="l00544"></a>00544     <a class="code" href="../../d5/dc5/BLI__kdopbvh_8h.html#afb2998b036283c715c148903376327ae">BLI_bvhtree_find_nearest</a>(surmd-&gt;<a class="code" href="../../df/d40/structSurfaceModifierData.html#a1251b2026266851805ac1267d1a7b4cf">bvhtree</a>-&gt;<a class="code" href="../../d2/d80/structBVHTreeFromMesh.html#ac99e3605d29760b3752a8633e08c5970">tree</a>, co, &amp;nearest, surmd-&gt;<a class="code" href="../../df/d40/structSurfaceModifierData.html#a1251b2026266851805ac1267d1a7b4cf">bvhtree</a>-&gt;<a class="code" href="../../d2/d80/structBVHTreeFromMesh.html#ad2eadcf8b622ef9ead3aa69e52d242b4">nearest_callback</a>, surmd-&gt;<a class="code" href="../../df/d40/structSurfaceModifierData.html#a1251b2026266851805ac1267d1a7b4cf">bvhtree</a>);
<a name="l00545"></a>00545 
<a name="l00546"></a>00546     <span class="keywordflow">if</span> (nearest.<a class="code" href="../../da/df6/structBVHTreeNearest.html#a6adc3b3ada5dfaf14539d75ef484f10c">index</a> != -1) {
<a name="l00547"></a>00547         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(surface_co, nearest.<a class="code" href="../../da/df6/structBVHTreeNearest.html#a29f81655eebc60b9c11be8faf9842686">co</a>);
<a name="l00548"></a>00548 
<a name="l00549"></a>00549         <span class="keywordflow">if</span> (surface_nor) {
<a name="l00550"></a>00550             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(surface_nor, nearest.<a class="code" href="../../da/df6/structBVHTreeNearest.html#aa1420b4aad9b8459b0cd1736dd746f30">no</a>);
<a name="l00551"></a>00551         }
<a name="l00552"></a>00552 
<a name="l00553"></a>00553         <span class="keywordflow">if</span> (surface_vel) {
<a name="l00554"></a>00554             <a class="code" href="../../d6/da0/structMFace.html">MFace</a> *mface = <a class="code" href="../../dd/d15/BKE__cdderivedmesh_8h.html#a67b1c0b6953f0e6bc074bdcf9e3bbe81">CDDM_get_tessface</a>(surmd-&gt;<a class="code" href="../../df/d40/structSurfaceModifierData.html#ad1afefb644fb13273366566a1d3a5a80">dm</a>, nearest.<a class="code" href="../../da/df6/structBVHTreeNearest.html#a6adc3b3ada5dfaf14539d75ef484f10c">index</a>);
<a name="l00555"></a>00555             
<a name="l00556"></a>00556             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(surface_vel, surmd-&gt;<a class="code" href="../../df/d40/structSurfaceModifierData.html#ae9775c51ba39878e23684a54c35e9d4a">v</a>[mface-&gt;<a class="code" href="../../d6/da0/structMFace.html#a7bbd2d1ca59c1ed8edd859c0a869081d">v1</a>].<a class="code" href="../../d8/de5/structMVert.html#a7682e4afa4b2ff47a3e17a4a3f670f1f">co</a>);
<a name="l00557"></a>00557             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(surface_vel, surmd-&gt;<a class="code" href="../../df/d40/structSurfaceModifierData.html#ae9775c51ba39878e23684a54c35e9d4a">v</a>[mface-&gt;<a class="code" href="../../d6/da0/structMFace.html#a3e56f10b57b97167b3db97024920f693">v2</a>].<a class="code" href="../../d8/de5/structMVert.html#a7682e4afa4b2ff47a3e17a4a3f670f1f">co</a>);
<a name="l00558"></a>00558             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(surface_vel, surmd-&gt;<a class="code" href="../../df/d40/structSurfaceModifierData.html#ae9775c51ba39878e23684a54c35e9d4a">v</a>[mface-&gt;<a class="code" href="../../d6/da0/structMFace.html#ac3bd1c8c8cb82e73685b9bfead2b30da">v3</a>].<a class="code" href="../../d8/de5/structMVert.html#a7682e4afa4b2ff47a3e17a4a3f670f1f">co</a>);
<a name="l00559"></a>00559             <span class="keywordflow">if</span> (mface-&gt;<a class="code" href="../../d6/da0/structMFace.html#ab3fb5a76f4c838226244c710af79e3fc">v4</a>)
<a name="l00560"></a>00560                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(surface_vel, surmd-&gt;<a class="code" href="../../df/d40/structSurfaceModifierData.html#ae9775c51ba39878e23684a54c35e9d4a">v</a>[mface-&gt;<a class="code" href="../../d6/da0/structMFace.html#ab3fb5a76f4c838226244c710af79e3fc">v4</a>].<a class="code" href="../../d8/de5/structMVert.html#a7682e4afa4b2ff47a3e17a4a3f670f1f">co</a>);
<a name="l00561"></a>00561 
<a name="l00562"></a>00562             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(surface_vel, mface-&gt;<a class="code" href="../../d6/da0/structMFace.html#ab3fb5a76f4c838226244c710af79e3fc">v4</a> ? 0.25f : 0.333f);
<a name="l00563"></a>00563         }
<a name="l00564"></a>00564         <span class="keywordflow">return</span> 1;
<a name="l00565"></a>00565     }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567     <span class="keywordflow">return</span> 0;
<a name="l00568"></a>00568 }
<a name="l00569"></a><a class="code" href="../../d7/d50/effect_8c.html#aa9748ff0200e54938c09dad35cb61d02">00569</a> <span class="keywordtype">int</span> <a class="code" href="../../dc/d65/BKE__effect_8h.html#a58303bb299cca9ec440911d2ead4e3fa">get_effector_data</a>(<a class="code" href="../../d6/d53/structEffectorCache.html">EffectorCache</a> *eff, <a class="code" href="../../d8/d38/structEffectorData.html">EffectorData</a> *efd, <a class="code" href="../../db/d29/structEffectedPoint.html">EffectedPoint</a> *<a class="code" href="../../d8/dae/structpoint.html">point</a>, <span class="keywordtype">int</span> real_velocity)
<a name="l00570"></a>00570 {
<a name="l00571"></a>00571     <span class="keywordtype">float</span> cfra = eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#aa5f00cbdbeb2f4504874670311c4837e">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a>;
<a name="l00572"></a>00572     <span class="keywordtype">int</span> ret = 0;
<a name="l00573"></a>00573 
<a name="l00574"></a>00574     <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a> &amp;&amp; eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a44ba6da57ec66074da56f4c50066c198">shape</a>==<a class="code" href="../../d2/d60/DNA__object__force_8h.html#a0bdeb46403257fa557dc3abeaccb2b6d">PFIELD_SHAPE_SURFACE</a> &amp;&amp; eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a5601aed35e5b5965fe11190dd32ee81c">surmd</a>) {
<a name="l00575"></a>00575         <span class="comment">/* closest point in the object surface is an effector */</span>
<a name="l00576"></a>00576         <span class="keywordtype">float</span> vec[3];
<a name="l00577"></a>00577 
<a name="l00578"></a>00578         <span class="comment">/* using velocity corrected location allows for easier sliding over effector surface */</span>
<a name="l00579"></a>00579         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a341b7512601d963e4f0458ecf036b2ac">vel</a>);
<a name="l00580"></a>00580         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(vec, point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a776ffa765588fb44029ca596f9e68fa5">vel_to_frame</a>);
<a name="l00581"></a>00581         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(vec, point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a8275f6f74ab812a1426d2ebc1c0e80ed">loc</a>);
<a name="l00582"></a>00582 
<a name="l00583"></a>00583         ret = <a class="code" href="../../dc/d65/BKE__effect_8h.html#ac5b950a2fa3de4233e3e7dd689490306">closest_point_on_surface</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a5601aed35e5b5965fe11190dd32ee81c">surmd</a>, vec, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a138575d6a5576674487ccde7a8bf52da">loc</a>, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>, real_velocity ? efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#aee929cc2925f4fbdd1398a3bbedb7e48">vel</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00584"></a>00584 
<a name="l00585"></a>00585         efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#ac34d95405e9473dde56ee105cf6cf2fb">size</a> = 0.0f;
<a name="l00586"></a>00586     }
<a name="l00587"></a>00587     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a> &amp;&amp; eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a44ba6da57ec66074da56f4c50066c198">shape</a>==<a class="code" href="../../d2/d60/DNA__object__force_8h.html#a73a452a69b3f0ab1a0862de970d2691f">PFIELD_SHAPE_POINTS</a>) {
<a name="l00588"></a>00588 
<a name="l00589"></a>00589         <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a90f2cb67625caff2124e0675ea32510d">derivedFinal</a>) {
<a name="l00590"></a>00590             <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *dm = eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a90f2cb67625caff2124e0675ea32510d">derivedFinal</a>;
<a name="l00591"></a>00591 
<a name="l00592"></a>00592             dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a4eb80dfbf127ea39db823865610b127e">getVertCo</a>(dm, *efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a62bc137175b16c9654e6b44c24b05f96">index</a>, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a138575d6a5576674487ccde7a8bf52da">loc</a>);
<a name="l00593"></a>00593             dm-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a35d607166e97c1c1b6dc29fd36b6ee3c">getVertNo</a>(dm, *efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a62bc137175b16c9654e6b44c24b05f96">index</a>, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>);
<a name="l00594"></a>00594 
<a name="l00595"></a>00595             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a138575d6a5576674487ccde7a8bf52da">loc</a>);
<a name="l00596"></a>00596             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad5cae73de10c30273f8c0fdc00fa648c">mul_mat3_m4_v3</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>);
<a name="l00597"></a>00597 
<a name="l00598"></a>00598             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>);
<a name="l00599"></a>00599 
<a name="l00600"></a>00600             efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#ac34d95405e9473dde56ee105cf6cf2fb">size</a> = 0.0f;
<a name="l00601"></a>00601 
<a name="l00602"></a>00602             
<a name="l00603"></a>00603             ret = 1;
<a name="l00604"></a>00604         }
<a name="l00605"></a>00605     }
<a name="l00606"></a>00606     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a2b8136e4412ed716fabc2f80e00a0d2d">psys</a>) {
<a name="l00607"></a>00607         <a class="code" href="../../dc/d76/structParticleData.html">ParticleData</a> *pa = eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a2b8136e4412ed716fabc2f80e00a0d2d">psys</a>-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a27f735cb50764ca866693a88b0e9ec5d">particles</a> + *efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a62bc137175b16c9654e6b44c24b05f96">index</a>;
<a name="l00608"></a>00608         <a class="code" href="../../d3/d31/structParticleKey.html">ParticleKey</a> <a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>;
<a name="l00609"></a>00609 
<a name="l00610"></a>00610         <span class="comment">/* exclude the particle itself for self effecting particles */</span>
<a name="l00611"></a>00611         <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a2b8136e4412ed716fabc2f80e00a0d2d">psys</a> == point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a43d66df2a07e1d83aba4c2980a674793">psys</a> &amp;&amp; *efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a62bc137175b16c9654e6b44c24b05f96">index</a> == point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#ad9d245ed66d8add2d6867927e34334b1">index</a>) {
<a name="l00612"></a>00612             <span class="comment">/* pass */</span>
<a name="l00613"></a>00613         }
<a name="l00614"></a>00614         <span class="keywordflow">else</span> {
<a name="l00615"></a>00615             <a class="code" href="../../de/df5/structParticleSimulationData.html">ParticleSimulationData</a> sim= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00616"></a>00616             sim.<a class="code" href="../../de/df5/structParticleSimulationData.html#a67a1b17ea6660e168f92a49bd9a7ba9b">scene</a>= eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#aa5f00cbdbeb2f4504874670311c4837e">scene</a>;
<a name="l00617"></a>00617             sim.<a class="code" href="../../de/df5/structParticleSimulationData.html#af6baa9791f72b02831c66ea185b28b62">ob</a>= eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>;
<a name="l00618"></a>00618             sim.<a class="code" href="../../de/df5/structParticleSimulationData.html#a98365d240570a76067ad5d707ba70ce8">psys</a>= eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a2b8136e4412ed716fabc2f80e00a0d2d">psys</a>;
<a name="l00619"></a>00619 
<a name="l00620"></a>00620             <span class="comment">/* TODO: time from actual previous calculated frame (step might not be 1) */</span>
<a name="l00621"></a>00621             state.<a class="code" href="../../d3/d31/structParticleKey.html#aa16173a033cec6443d22d89550e7b0b6">time</a> = cfra - 1.0f;
<a name="l00622"></a>00622             ret = <a class="code" href="../../db/dca/BKE__particle_8h.html#a954cd827b2145d733493e4fd5f33ab9f">psys_get_particle_state</a>(&amp;sim, *efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a62bc137175b16c9654e6b44c24b05f96">index</a>, &amp;state, 0);
<a name="l00623"></a>00623 
<a name="l00624"></a>00624             <span class="comment">/* TODO */</span>
<a name="l00625"></a>00625             <span class="comment">//if (eff-&gt;pd-&gt;forcefiled == PFIELD_HARMONIC &amp;&amp; ret==0) {</span>
<a name="l00626"></a>00626             <span class="comment">//  if (pa-&gt;dietime &lt; eff-&gt;psys-&gt;cfra)</span>
<a name="l00627"></a>00627             <span class="comment">//      eff-&gt;flag |= PE_VELOCITY_TO_IMPULSE;</span>
<a name="l00628"></a>00628             <span class="comment">//}</span>
<a name="l00629"></a>00629 
<a name="l00630"></a>00630             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a138575d6a5576674487ccde7a8bf52da">loc</a>, state.<a class="code" href="../../d3/d31/structParticleKey.html#a95888d245d557f8e453844d9aad97019">co</a>);
<a name="l00631"></a>00631 
<a name="l00632"></a>00632             <span class="comment">/* rather than use the velocity use rotated x-axis (defaults to velocity) */</span>
<a name="l00633"></a>00633             efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>[0] = 1.f;
<a name="l00634"></a>00634             efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>[1] = efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>[2] = 0.f;
<a name="l00635"></a>00635             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a654dd0df4df6f960e592032f276f2c68">mul_qt_v3</a>(state.<a class="code" href="../../d3/d31/structParticleKey.html#a33ddd3b5915822847448bee82089feea">rot</a>, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>);
<a name="l00636"></a>00636         
<a name="l00637"></a>00637             <span class="keywordflow">if</span> (real_velocity)
<a name="l00638"></a>00638                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#aee929cc2925f4fbdd1398a3bbedb7e48">vel</a>, state.<a class="code" href="../../d3/d31/structParticleKey.html#a2784ffc7a428dff13e5f031178706fee">vel</a>);
<a name="l00639"></a>00639 
<a name="l00640"></a>00640             efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#ac34d95405e9473dde56ee105cf6cf2fb">size</a> = pa-&gt;<a class="code" href="../../dc/d76/structParticleData.html#a4cd9a6f1328a2b83a7a27c8d38f2cbf6">size</a>;
<a name="l00641"></a>00641         }
<a name="l00642"></a>00642     }
<a name="l00643"></a>00643     <span class="keywordflow">else</span> {
<a name="l00644"></a>00644         <span class="comment">/* use center of object for distance calculus */</span>
<a name="l00645"></a>00645         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob = eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>;
<a name="l00646"></a>00646         <a class="code" href="../../de/de7/structObject.html">Object</a> obcopy = *ob;
<a name="l00647"></a>00647 
<a name="l00648"></a>00648         <span class="comment">/* use z-axis as normal*/</span>
<a name="l00649"></a>00649         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#aaa8b4ca59d77eb2612341c608507e087">normalize_v3_v3</a>(efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[2]);
<a name="l00650"></a>00650 
<a name="l00651"></a>00651         <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a> &amp;&amp; eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a44ba6da57ec66074da56f4c50066c198">shape</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a5b5d514f756439c8010a56c2f821712f">PFIELD_SHAPE_PLANE</a>) {
<a name="l00652"></a>00652             <span class="keywordtype">float</span> temp[3], translate[3];
<a name="l00653"></a>00653             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(temp, point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a8275f6f74ab812a1426d2ebc1c0e80ed">loc</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3]);
<a name="l00654"></a>00654             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a0a8ff93b28d3d1f8e81650662fbb496d">project_v3_v3v3</a>(translate, temp, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>);
<a name="l00655"></a>00655 
<a name="l00656"></a>00656             <span class="comment">/* for vortex the shape chooses between old / new force */</span>
<a name="l00657"></a>00657             <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1bab1e0e1326ceb8b34f025660dd2399a02">PFIELD_VORTEX</a>)
<a name="l00658"></a>00658                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a138575d6a5576674487ccde7a8bf52da">loc</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3], translate);
<a name="l00659"></a>00659             <span class="keywordflow">else</span> <span class="comment">/* normally efd-&gt;loc is closest point on effector xy-plane */</span>
<a name="l00660"></a>00660                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a138575d6a5576674487ccde7a8bf52da">loc</a>, point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a8275f6f74ab812a1426d2ebc1c0e80ed">loc</a>, translate);
<a name="l00661"></a>00661         }
<a name="l00662"></a>00662         <span class="keywordflow">else</span> {
<a name="l00663"></a>00663             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a138575d6a5576674487ccde7a8bf52da">loc</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3]);
<a name="l00664"></a>00664         }
<a name="l00665"></a>00665 
<a name="l00666"></a>00666         <span class="keywordflow">if</span> (real_velocity)
<a name="l00667"></a>00667             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#aee929cc2925f4fbdd1398a3bbedb7e48">vel</a>, eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a03347969fd91cd6ae18f42978df6cf90">velocity</a>);
<a name="l00668"></a>00668 
<a name="l00669"></a>00669         *eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a> = obcopy;
<a name="l00670"></a>00670 
<a name="l00671"></a>00671         efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#ac34d95405e9473dde56ee105cf6cf2fb">size</a> = 0.0f;
<a name="l00672"></a>00672 
<a name="l00673"></a>00673         ret = 1;
<a name="l00674"></a>00674     }
<a name="l00675"></a>00675 
<a name="l00676"></a>00676     <span class="keywordflow">if</span> (ret) {
<a name="l00677"></a>00677         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a3560debc48a5b9082fde6dd0ecb43670">vec_to_point</a>, point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a8275f6f74ab812a1426d2ebc1c0e80ed">loc</a>, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a138575d6a5576674487ccde7a8bf52da">loc</a>);
<a name="l00678"></a>00678         efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a18029b83ae6f56e10095044119bc32f2">distance</a> = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a3560debc48a5b9082fde6dd0ecb43670">vec_to_point</a>);
<a name="l00679"></a>00679 
<a name="l00680"></a>00680         <span class="comment">/* rest length for harmonic effector, will have to see later if this could be extended to other effectors */</span>
<a name="l00681"></a>00681         <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a> &amp;&amp; eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba7849b998d8b19cf1cbb147e8ec835c58">PFIELD_HARMONIC</a> &amp;&amp; eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a8b8ef2fe2e38b34204ad09fbcd8e7034">f_size</a>)
<a name="l00682"></a>00682             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a3560debc48a5b9082fde6dd0ecb43670">vec_to_point</a>, (efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a18029b83ae6f56e10095044119bc32f2">distance</a>-eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a8b8ef2fe2e38b34204ad09fbcd8e7034">f_size</a>)/efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a18029b83ae6f56e10095044119bc32f2">distance</a>);
<a name="l00683"></a>00683 
<a name="l00684"></a>00684         <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ab0196afe758f721bf48df6de7211677f">flag</a> &amp; <a class="code" href="../../dc/d65/BKE__effect_8h.html#acb1cae64af27946fa736cdaf5f06ff30">PE_USE_NORMAL_DATA</a>) {
<a name="l00685"></a>00685             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a54ddf51bd07be2313283172b98066e69">vec_to_point2</a>, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a3560debc48a5b9082fde6dd0ecb43670">vec_to_point</a>);
<a name="l00686"></a>00686             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#afe42ccedb686f14f0634ee07fe6d6579">nor2</a>, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>);
<a name="l00687"></a>00687         }
<a name="l00688"></a>00688         <span class="keywordflow">else</span> {
<a name="l00689"></a>00689             <span class="comment">/* for some effectors we need the object center every time */</span>
<a name="l00690"></a>00690             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a54ddf51bd07be2313283172b98066e69">vec_to_point2</a>, point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a8275f6f74ab812a1426d2ebc1c0e80ed">loc</a>, eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3]);
<a name="l00691"></a>00691             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#aaa8b4ca59d77eb2612341c608507e087">normalize_v3_v3</a>(efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#afe42ccedb686f14f0634ee07fe6d6579">nor2</a>, eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[2]);
<a name="l00692"></a>00692         }
<a name="l00693"></a>00693     }
<a name="l00694"></a>00694 
<a name="l00695"></a>00695     <span class="keywordflow">return</span> ret;
<a name="l00696"></a>00696 }
<a name="l00697"></a><a class="code" href="../../d7/d50/effect_8c.html#ab5f58c65f8b1284d5185a5295b691f44">00697</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d50/effect_8c.html#ab5f58c65f8b1284d5185a5295b691f44">get_effector_tot</a>(<a class="code" href="../../d6/d53/structEffectorCache.html">EffectorCache</a> *eff, <a class="code" href="../../d8/d38/structEffectorData.html">EffectorData</a> *efd, <a class="code" href="../../db/d29/structEffectedPoint.html">EffectedPoint</a> *<a class="code" href="../../d8/dae/structpoint.html">point</a>, <span class="keywordtype">int</span> *tot, <span class="keywordtype">int</span> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>, <span class="keywordtype">int</span> *<a class="code" href="../../d1/d22/stdosl_8h.html#a8bd9f841cf6ee6c256028a8a544fec3b">step</a>)
<a name="l00698"></a>00698 {
<a name="l00699"></a>00699     <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a44ba6da57ec66074da56f4c50066c198">shape</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a73a452a69b3f0ab1a0862de970d2691f">PFIELD_SHAPE_POINTS</a>) {
<a name="l00700"></a>00700         efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a62bc137175b16c9654e6b44c24b05f96">index</a> = <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l00701"></a>00701 
<a name="l00702"></a>00702         *p = 0;
<a name="l00703"></a>00703         *tot = eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a90f2cb67625caff2124e0675ea32510d">derivedFinal</a> ? eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a90f2cb67625caff2124e0675ea32510d">derivedFinal</a>-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a2edb9ee7af5ff3b26b2615882e2b7dcf">numVertData</a> : 1;
<a name="l00704"></a>00704 
<a name="l00705"></a>00705         <span class="keywordflow">if</span> (*tot &amp;&amp; eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba7849b998d8b19cf1cbb147e8ec835c58">PFIELD_HARMONIC</a> &amp;&amp; point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#ad9d245ed66d8add2d6867927e34334b1">index</a> &gt;= 0) {
<a name="l00706"></a>00706             *p = point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#ad9d245ed66d8add2d6867927e34334b1">index</a> % *tot;
<a name="l00707"></a>00707             *tot = *p+1;
<a name="l00708"></a>00708         }
<a name="l00709"></a>00709     }
<a name="l00710"></a>00710     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a2b8136e4412ed716fabc2f80e00a0d2d">psys</a>) {
<a name="l00711"></a>00711         efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a62bc137175b16c9654e6b44c24b05f96">index</a> = <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l00712"></a>00712 
<a name="l00713"></a>00713         *p = 0;
<a name="l00714"></a>00714         *tot = eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a2b8136e4412ed716fabc2f80e00a0d2d">psys</a>-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ab52fdf06eac31dc7129f874718284014">totpart</a>;
<a name="l00715"></a>00715         
<a name="l00716"></a>00716         <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba62551cc8701c9e2cea1b33c76a3e2a7f">PFIELD_CHARGE</a>) {
<a name="l00717"></a>00717             <span class="comment">/* Only the charge of the effected particle is used for </span>
<a name="l00718"></a>00718 <span class="comment">             * interaction, not fall-offs. If the fall-offs aren&#39;t the  </span>
<a name="l00719"></a>00719 <span class="comment">             * same this will be unphysical, but for animation this     </span>
<a name="l00720"></a>00720 <span class="comment">             * could be the wanted behavior. If you want physical</span>
<a name="l00721"></a>00721 <span class="comment">             * correctness the fall-off should be spherical 2.0 anyways.</span>
<a name="l00722"></a>00722 <span class="comment">             */</span>
<a name="l00723"></a>00723             efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#ab23a3cb3d4cfc9f89576252164afafb6">charge</a> = eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a6cff5078ee6e06da8a0164ba49cf5a7c">f_strength</a>;
<a name="l00724"></a>00724         }
<a name="l00725"></a>00725         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba7849b998d8b19cf1cbb147e8ec835c58">PFIELD_HARMONIC</a> &amp;&amp; (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a774554aca12ac798eb45bcf929f948cf">PFIELD_MULTIPLE_SPRINGS</a>)==0) {
<a name="l00726"></a>00726             <span class="comment">/* every particle is mapped to only one harmonic effector particle */</span>
<a name="l00727"></a>00727             *p= point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#ad9d245ed66d8add2d6867927e34334b1">index</a> % eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a2b8136e4412ed716fabc2f80e00a0d2d">psys</a>-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ab52fdf06eac31dc7129f874718284014">totpart</a>;
<a name="l00728"></a>00728             *tot= *p + 1;
<a name="l00729"></a>00729         }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731         <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a2b8136e4412ed716fabc2f80e00a0d2d">psys</a>-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a21c5245a9c129234f703dd5a9f1b0d47">effector_amount</a>) {
<a name="l00732"></a>00732             <span class="keywordtype">int</span> totpart = eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a2b8136e4412ed716fabc2f80e00a0d2d">psys</a>-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ab52fdf06eac31dc7129f874718284014">totpart</a>;
<a name="l00733"></a>00733             <span class="keywordtype">int</span> amount = eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a2b8136e4412ed716fabc2f80e00a0d2d">psys</a>-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a21c5245a9c129234f703dd5a9f1b0d47">effector_amount</a>;
<a name="l00734"></a>00734 
<a name="l00735"></a>00735             *step = (totpart &gt; amount) ? totpart/amount : 1;
<a name="l00736"></a>00736         }
<a name="l00737"></a>00737     }
<a name="l00738"></a>00738     <span class="keywordflow">else</span> {
<a name="l00739"></a>00739         *p = 0;
<a name="l00740"></a>00740         *tot = 1;
<a name="l00741"></a>00741     }
<a name="l00742"></a>00742 }
<a name="l00743"></a><a class="code" href="../../d7/d50/effect_8c.html#a2a14ee7baa0ba96f51fc4fc28834452e">00743</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d50/effect_8c.html#a2a14ee7baa0ba96f51fc4fc28834452e">do_texture_effector</a>(<a class="code" href="../../d6/d53/structEffectorCache.html">EffectorCache</a> *eff, <a class="code" href="../../d8/d38/structEffectorData.html">EffectorData</a> *efd, <a class="code" href="../../db/d29/structEffectedPoint.html">EffectedPoint</a> *<a class="code" href="../../d8/dae/structpoint.html">point</a>, <span class="keywordtype">float</span> *total_force)
<a name="l00744"></a>00744 {
<a name="l00745"></a>00745     <a class="code" href="../../db/da2/structTexResult.html">TexResult</a> result[4];
<a name="l00746"></a>00746     <span class="keywordtype">float</span> tex_co[3], strength, force[3];
<a name="l00747"></a>00747     <span class="keywordtype">float</span> nabla = eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a23705ac3422b50e01806d5cd1e02169a">tex_nabla</a>;
<a name="l00748"></a>00748     <span class="keywordtype">int</span> hasrgb;
<a name="l00749"></a>00749     <span class="keywordtype">short</span> mode = eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a5a622449aa9fb7a4f78ad75b0d0e74aa">tex_mode</a>;
<a name="l00750"></a>00750 
<a name="l00751"></a>00751     <span class="keywordflow">if</span> (!eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a5d55db7630e361083388cae31bbf36e9">tex</a>)
<a name="l00752"></a>00752         <span class="keywordflow">return</span>;
<a name="l00753"></a>00753 
<a name="l00754"></a>00754     result[0].<a class="code" href="../../db/da2/structTexResult.html#a558eee24ea7940a9af7a55e7ab33b33d">nor</a> = result[1].<a class="code" href="../../db/da2/structTexResult.html#a558eee24ea7940a9af7a55e7ab33b33d">nor</a> = result[2].<a class="code" href="../../db/da2/structTexResult.html#a558eee24ea7940a9af7a55e7ab33b33d">nor</a> = result[3].<a class="code" href="../../db/da2/structTexResult.html#a558eee24ea7940a9af7a55e7ab33b33d">nor</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00755"></a>00755 
<a name="l00756"></a>00756     strength= eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a6cff5078ee6e06da8a0164ba49cf5a7c">f_strength</a> * efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#ab44ae92e1f57a8163426f284491eefa5">falloff</a>;
<a name="l00757"></a>00757 
<a name="l00758"></a>00758     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(tex_co,point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a8275f6f74ab812a1426d2ebc1c0e80ed">loc</a>);
<a name="l00759"></a>00759 
<a name="l00760"></a>00760     <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a9021b49ce68c71e5852bc7123351eec0">PFIELD_TEX_2D</a>) {
<a name="l00761"></a>00761         <span class="keywordtype">float</span> fac=-<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a76629ccfe891bccda30f790ed501e959">dot_v3v3</a>(tex_co, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>);
<a name="l00762"></a>00762         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1b4079b4f57c1eaf908d521b5a0f867e">madd_v3_v3fl</a>(tex_co, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>, fac);
<a name="l00763"></a>00763     }
<a name="l00764"></a>00764 
<a name="l00765"></a>00765     <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#aab0f7d905835824671b6d2efa53141f3">PFIELD_TEX_OBJECT</a>) {
<a name="l00766"></a>00766         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a65d360837f87824d49ed08caf44dccb3">imat</a>, tex_co);
<a name="l00767"></a>00767     }
<a name="l00768"></a>00768 
<a name="l00769"></a>00769     hasrgb = <a class="code" href="../../d9/d49/RE__shader__ext_8h.html#a5a08933d2cffb0132e123669117f04ac">multitex_ext</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a5d55db7630e361083388cae31bbf36e9">tex</a>, tex_co, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, result);
<a name="l00770"></a>00770 
<a name="l00771"></a>00771     <span class="keywordflow">if</span> (hasrgb &amp;&amp; mode==<a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac666a23061fbec03a937eade9b162dfb">PFIELD_TEX_RGB</a>) {
<a name="l00772"></a>00772         force[0] = (0.5f - result-&gt;<a class="code" href="../../db/da2/structTexResult.html#ad58d0c2536547365929a7dfd3bf67e32">tr</a>) * strength;
<a name="l00773"></a>00773         force[1] = (0.5f - result-&gt;<a class="code" href="../../db/da2/structTexResult.html#ad602785f0747bcb3532949d661d8f472">tg</a>) * strength;
<a name="l00774"></a>00774         force[2] = (0.5f - result-&gt;<a class="code" href="../../db/da2/structTexResult.html#a557b38c1d19e8e7a780657ed75b9f975">tb</a>) * strength;
<a name="l00775"></a>00775     }
<a name="l00776"></a>00776     <span class="keywordflow">else</span> {
<a name="l00777"></a>00777         strength/=nabla;
<a name="l00778"></a>00778 
<a name="l00779"></a>00779         tex_co[0] += nabla;
<a name="l00780"></a>00780         <a class="code" href="../../d9/d49/RE__shader__ext_8h.html#a5a08933d2cffb0132e123669117f04ac">multitex_ext</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a5d55db7630e361083388cae31bbf36e9">tex</a>, tex_co, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, result+1);
<a name="l00781"></a>00781 
<a name="l00782"></a>00782         tex_co[0] -= nabla;
<a name="l00783"></a>00783         tex_co[1] += nabla;
<a name="l00784"></a>00784         <a class="code" href="../../d9/d49/RE__shader__ext_8h.html#a5a08933d2cffb0132e123669117f04ac">multitex_ext</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a5d55db7630e361083388cae31bbf36e9">tex</a>, tex_co, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, result+2);
<a name="l00785"></a>00785 
<a name="l00786"></a>00786         tex_co[1] -= nabla;
<a name="l00787"></a>00787         tex_co[2] += nabla;
<a name="l00788"></a>00788         <a class="code" href="../../d9/d49/RE__shader__ext_8h.html#a5a08933d2cffb0132e123669117f04ac">multitex_ext</a>(eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a5d55db7630e361083388cae31bbf36e9">tex</a>, tex_co, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, result+3);
<a name="l00789"></a>00789 
<a name="l00790"></a>00790         <span class="keywordflow">if</span> (mode == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a75c2071589e63508f1120a506de7dc58">PFIELD_TEX_GRAD</a> || !hasrgb) { <span class="comment">/* if we don&#39;t have rgb fall back to grad */</span>
<a name="l00791"></a>00791             force[0] = (result[0].<a class="code" href="../../db/da2/structTexResult.html#a71a093242845c4eefe0455b2dd925d1e">tin</a> - result[1].<a class="code" href="../../db/da2/structTexResult.html#a71a093242845c4eefe0455b2dd925d1e">tin</a>) * strength;
<a name="l00792"></a>00792             force[1] = (result[0].<a class="code" href="../../db/da2/structTexResult.html#a71a093242845c4eefe0455b2dd925d1e">tin</a> - result[2].<a class="code" href="../../db/da2/structTexResult.html#a71a093242845c4eefe0455b2dd925d1e">tin</a>) * strength;
<a name="l00793"></a>00793             force[2] = (result[0].<a class="code" href="../../db/da2/structTexResult.html#a71a093242845c4eefe0455b2dd925d1e">tin</a> - result[3].<a class="code" href="../../db/da2/structTexResult.html#a71a093242845c4eefe0455b2dd925d1e">tin</a>) * strength;
<a name="l00794"></a>00794         }
<a name="l00795"></a>00795         <span class="keywordflow">else</span> { <span class="comment">/*PFIELD_TEX_CURL*/</span>
<a name="l00796"></a>00796             <span class="keywordtype">float</span> dbdy, dgdz, drdz, dbdx, dgdx, drdy;
<a name="l00797"></a>00797 
<a name="l00798"></a>00798             dbdy = result[2].<a class="code" href="../../db/da2/structTexResult.html#a557b38c1d19e8e7a780657ed75b9f975">tb</a> - result[0].<a class="code" href="../../db/da2/structTexResult.html#a557b38c1d19e8e7a780657ed75b9f975">tb</a>;
<a name="l00799"></a>00799             dgdz = result[3].<a class="code" href="../../db/da2/structTexResult.html#ad602785f0747bcb3532949d661d8f472">tg</a> - result[0].<a class="code" href="../../db/da2/structTexResult.html#ad602785f0747bcb3532949d661d8f472">tg</a>;
<a name="l00800"></a>00800             drdz = result[3].<a class="code" href="../../db/da2/structTexResult.html#ad58d0c2536547365929a7dfd3bf67e32">tr</a> - result[0].<a class="code" href="../../db/da2/structTexResult.html#ad58d0c2536547365929a7dfd3bf67e32">tr</a>;
<a name="l00801"></a>00801             dbdx = result[1].<a class="code" href="../../db/da2/structTexResult.html#a557b38c1d19e8e7a780657ed75b9f975">tb</a> - result[0].<a class="code" href="../../db/da2/structTexResult.html#a557b38c1d19e8e7a780657ed75b9f975">tb</a>;
<a name="l00802"></a>00802             dgdx = result[1].<a class="code" href="../../db/da2/structTexResult.html#ad602785f0747bcb3532949d661d8f472">tg</a> - result[0].<a class="code" href="../../db/da2/structTexResult.html#ad602785f0747bcb3532949d661d8f472">tg</a>;
<a name="l00803"></a>00803             drdy = result[2].<a class="code" href="../../db/da2/structTexResult.html#ad58d0c2536547365929a7dfd3bf67e32">tr</a> - result[0].<a class="code" href="../../db/da2/structTexResult.html#ad58d0c2536547365929a7dfd3bf67e32">tr</a>;
<a name="l00804"></a>00804 
<a name="l00805"></a>00805             force[0] = (dbdy - dgdz) * strength;
<a name="l00806"></a>00806             force[1] = (drdz - dbdx) * strength;
<a name="l00807"></a>00807             force[2] = (dgdx - drdy) * strength;
<a name="l00808"></a>00808         }
<a name="l00809"></a>00809     }
<a name="l00810"></a>00810 
<a name="l00811"></a>00811     <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a9021b49ce68c71e5852bc7123351eec0">PFIELD_TEX_2D</a>) {
<a name="l00812"></a>00812         <span class="keywordtype">float</span> fac = -<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a76629ccfe891bccda30f790ed501e959">dot_v3v3</a>(force, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>);
<a name="l00813"></a>00813         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1b4079b4f57c1eaf908d521b5a0f867e">madd_v3_v3fl</a>(force, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>, fac);
<a name="l00814"></a>00814     }
<a name="l00815"></a>00815 
<a name="l00816"></a>00816     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(total_force, force);
<a name="l00817"></a>00817 }
<a name="l00818"></a><a class="code" href="../../d7/d50/effect_8c.html#a700edf4ee3558b3e0198f33f3965f936">00818</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d50/effect_8c.html#a700edf4ee3558b3e0198f33f3965f936">do_physical_effector</a>(<a class="code" href="../../d6/d53/structEffectorCache.html">EffectorCache</a> *eff, <a class="code" href="../../d8/d38/structEffectorData.html">EffectorData</a> *efd, <a class="code" href="../../db/d29/structEffectedPoint.html">EffectedPoint</a> *<a class="code" href="../../d8/dae/structpoint.html">point</a>, <span class="keywordtype">float</span> *total_force)
<a name="l00819"></a>00819 {
<a name="l00820"></a>00820     <a class="code" href="../../d3/d76/structPartDeflect.html">PartDeflect</a> *pd = eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>;
<a name="l00821"></a>00821     <a class="code" href="../../d0/d3e/structRNG.html">RNG</a> *rng = pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a1a9b02c0ce6e796e05bca15bdc5776c0">rng</a>;
<a name="l00822"></a>00822     <span class="keywordtype">float</span> force[3]={0,0,0};
<a name="l00823"></a>00823     <span class="keywordtype">float</span> temp[3];
<a name="l00824"></a>00824     <span class="keywordtype">float</span> fac;
<a name="l00825"></a>00825     <span class="keywordtype">float</span> strength = pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a6cff5078ee6e06da8a0164ba49cf5a7c">f_strength</a>;
<a name="l00826"></a>00826     <span class="keywordtype">float</span> damp = pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#ab4be0fda5a3555ae6c29750c37090a54">f_damp</a>;
<a name="l00827"></a>00827     <span class="keywordtype">float</span> noise_factor = pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a51d118ee833b9c75e26410f145fc3ee8">f_noise</a>;
<a name="l00828"></a>00828 
<a name="l00829"></a>00829     <span class="keywordflow">if</span> (noise_factor &gt; 0.0f) {
<a name="l00830"></a>00830         strength += <a class="code" href="../../d7/d50/effect_8c.html#a198538be4d1d5ff8e3e922e0bf7f06f2">wind_func</a>(rng, noise_factor);
<a name="l00831"></a>00831 
<a name="l00832"></a>00832         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a>, <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba7849b998d8b19cf1cbb147e8ec835c58">PFIELD_HARMONIC</a>, <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba991516e08649c0752cd690246c5a43da">PFIELD_DRAG</a>))
<a name="l00833"></a>00833             damp += <a class="code" href="../../d7/d50/effect_8c.html#a198538be4d1d5ff8e3e922e0bf7f06f2">wind_func</a>(rng, noise_factor);
<a name="l00834"></a>00834     }
<a name="l00835"></a>00835 
<a name="l00836"></a>00836     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(force, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a3560debc48a5b9082fde6dd0ecb43670">vec_to_point</a>);
<a name="l00837"></a>00837 
<a name="l00838"></a>00838     <span class="keywordflow">switch</span>(pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a>) {
<a name="l00839"></a>00839         <span class="keywordflow">case</span> <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba22fb65898d213ba25a4a89bbe5c50fc0">PFIELD_WIND</a>:
<a name="l00840"></a>00840             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(force, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>);
<a name="l00841"></a>00841             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(force, strength * efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#ab44ae92e1f57a8163426f284491eefa5">falloff</a>);
<a name="l00842"></a>00842             <span class="keywordflow">break</span>;
<a name="l00843"></a>00843         <span class="keywordflow">case</span> <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba4cec14f5eac6fcea81c188de2fbf81ed">PFIELD_FORCE</a>:
<a name="l00844"></a>00844             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(force);
<a name="l00845"></a>00845             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(force, strength * efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#ab44ae92e1f57a8163426f284491eefa5">falloff</a>);
<a name="l00846"></a>00846             <span class="keywordflow">break</span>;
<a name="l00847"></a>00847         <span class="keywordflow">case</span> <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1bab1e0e1326ceb8b34f025660dd2399a02">PFIELD_VORTEX</a>:
<a name="l00848"></a>00848             <span class="comment">/* old vortex force */</span>
<a name="l00849"></a>00849             <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a44ba6da57ec66074da56f4c50066c198">shape</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a472789dc75541a86e306c5ff632c8d44">PFIELD_SHAPE_POINT</a>) {
<a name="l00850"></a>00850                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(force, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a3560debc48a5b9082fde6dd0ecb43670">vec_to_point</a>);
<a name="l00851"></a>00851                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(force);
<a name="l00852"></a>00852                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(force, strength * efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a18029b83ae6f56e10095044119bc32f2">distance</a> * efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#ab44ae92e1f57a8163426f284491eefa5">falloff</a>);
<a name="l00853"></a>00853             }
<a name="l00854"></a>00854             <span class="keywordflow">else</span> {
<a name="l00855"></a>00855                 <span class="comment">/* new vortex force */</span>
<a name="l00856"></a>00856                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(temp, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#afe42ccedb686f14f0634ee07fe6d6579">nor2</a>, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a54ddf51bd07be2313283172b98066e69">vec_to_point2</a>);
<a name="l00857"></a>00857                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(temp, strength * efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#ab44ae92e1f57a8163426f284491eefa5">falloff</a>);
<a name="l00858"></a>00858                 
<a name="l00859"></a>00859                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(force, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#afe42ccedb686f14f0634ee07fe6d6579">nor2</a>, temp);
<a name="l00860"></a>00860                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(force, strength * efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#ab44ae92e1f57a8163426f284491eefa5">falloff</a>);
<a name="l00861"></a>00861                 
<a name="l00862"></a>00862                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1b4079b4f57c1eaf908d521b5a0f867e">madd_v3_v3fl</a>(temp, point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a341b7512601d963e4f0458ecf036b2ac">vel</a>, -point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a046d9c160ba8dab8dfcb696a586f1674">vel_to_sec</a>);
<a name="l00863"></a>00863                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(force, temp);
<a name="l00864"></a>00864             }
<a name="l00865"></a>00865             <span class="keywordflow">break</span>;
<a name="l00866"></a>00866         <span class="keywordflow">case</span> <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba0969b4f4b34f451db007c199337d3896">PFIELD_MAGNET</a>:
<a name="l00867"></a>00867             <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a44ba6da57ec66074da56f4c50066c198">shape</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a472789dc75541a86e306c5ff632c8d44">PFIELD_SHAPE_POINT</a>)
<a name="l00868"></a>00868                 <span class="comment">/* magnetic field of a moving charge */</span>
<a name="l00869"></a>00869                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(temp, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a3560debc48a5b9082fde6dd0ecb43670">vec_to_point</a>);
<a name="l00870"></a>00870             <span class="keywordflow">else</span>
<a name="l00871"></a>00871                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(temp, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a7b13f60249cdda74478b9ed3b1c11904">nor</a>);
<a name="l00872"></a>00872 
<a name="l00873"></a>00873             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(temp);
<a name="l00874"></a>00874             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(temp, strength * efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#ab44ae92e1f57a8163426f284491eefa5">falloff</a>);
<a name="l00875"></a>00875             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(force, point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a341b7512601d963e4f0458ecf036b2ac">vel</a>, temp);
<a name="l00876"></a>00876             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(force, point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a046d9c160ba8dab8dfcb696a586f1674">vel_to_sec</a>);
<a name="l00877"></a>00877             <span class="keywordflow">break</span>;
<a name="l00878"></a>00878         <span class="keywordflow">case</span> <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba7849b998d8b19cf1cbb147e8ec835c58">PFIELD_HARMONIC</a>:
<a name="l00879"></a>00879             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(force, -strength * efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#ab44ae92e1f57a8163426f284491eefa5">falloff</a>);
<a name="l00880"></a>00880             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(temp, point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a341b7512601d963e4f0458ecf036b2ac">vel</a>);
<a name="l00881"></a>00881             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(temp, -damp * 2.0f * (<span class="keywordtype">float</span>)<a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(strength)) * point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a046d9c160ba8dab8dfcb696a586f1674">vel_to_sec</a>);
<a name="l00882"></a>00882             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(force, temp);
<a name="l00883"></a>00883             <span class="keywordflow">break</span>;
<a name="l00884"></a>00884         <span class="keywordflow">case</span> <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba62551cc8701c9e2cea1b33c76a3e2a7f">PFIELD_CHARGE</a>:
<a name="l00885"></a>00885             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(force, point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#ab889cdc12c65133bb406548554a99365">charge</a> * strength * efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#ab44ae92e1f57a8163426f284491eefa5">falloff</a>);
<a name="l00886"></a>00886             <span class="keywordflow">break</span>;
<a name="l00887"></a>00887         <span class="keywordflow">case</span> <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba9c153dcd55877cf857c911a9c46d91b1">PFIELD_LENNARDJ</a>:
<a name="l00888"></a>00888             fac = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#af46040b4ed6734ce0bcafe3e53d46dd3">pow</a>((efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#ac34d95405e9473dde56ee105cf6cf2fb">size</a> + point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a6274eee752f583626ac2cd725395127f">size</a>) / efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a18029b83ae6f56e10095044119bc32f2">distance</a>, 6.0);
<a name="l00889"></a>00889             
<a name="l00890"></a>00890             fac = - fac * (1.0f - fac) / efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a18029b83ae6f56e10095044119bc32f2">distance</a>;
<a name="l00891"></a>00891 
<a name="l00892"></a>00892             <span class="comment">/* limit the repulsive term drastically to avoid huge forces */</span>
<a name="l00893"></a>00893             fac = ((fac&gt;2.0f) ? 2.0f : fac);
<a name="l00894"></a>00894 
<a name="l00895"></a>00895             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(force, strength * fac);
<a name="l00896"></a>00896             <span class="keywordflow">break</span>;
<a name="l00897"></a>00897         <span class="keywordflow">case</span> <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba6ca6c794b1e0bab70f1dabe3b547d50b">PFIELD_BOID</a>:
<a name="l00898"></a>00898             <span class="comment">/* Boid field is handled completely in boids code. */</span>
<a name="l00899"></a>00899             <span class="keywordflow">return</span>;
<a name="l00900"></a>00900         <span class="keywordflow">case</span> <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba8c1f182cd2d35329bc39a66621385eb1">PFIELD_TURBULENCE</a>:
<a name="l00901"></a>00901             <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a9428d114a95300805cba612907a9e68f">PFIELD_GLOBAL_CO</a>) {
<a name="l00902"></a>00902                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(temp, point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a8275f6f74ab812a1426d2ebc1c0e80ed">loc</a>);
<a name="l00903"></a>00903             }
<a name="l00904"></a>00904             <span class="keywordflow">else</span> {
<a name="l00905"></a>00905                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(temp, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#a54ddf51bd07be2313283172b98066e69">vec_to_point2</a>, efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#afe42ccedb686f14f0634ee07fe6d6579">nor2</a>);
<a name="l00906"></a>00906             }
<a name="l00907"></a>00907             force[0] = -1.0f + 2.0f * <a class="code" href="../../d1/d65/BLI__noise_8h.html#acb26a2b54ce9797d6038163af64e362d">BLI_gTurbulence</a>(pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a8b8ef2fe2e38b34204ad09fbcd8e7034">f_size</a>, temp[0], temp[1], temp[2], 2,0,2);
<a name="l00908"></a>00908             force[1] = -1.0f + 2.0f * <a class="code" href="../../d1/d65/BLI__noise_8h.html#acb26a2b54ce9797d6038163af64e362d">BLI_gTurbulence</a>(pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a8b8ef2fe2e38b34204ad09fbcd8e7034">f_size</a>, temp[1], temp[2], temp[0], 2,0,2);
<a name="l00909"></a>00909             force[2] = -1.0f + 2.0f * <a class="code" href="../../d1/d65/BLI__noise_8h.html#acb26a2b54ce9797d6038163af64e362d">BLI_gTurbulence</a>(pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a8b8ef2fe2e38b34204ad09fbcd8e7034">f_size</a>, temp[2], temp[0], temp[1], 2,0,2);
<a name="l00910"></a>00910             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(force, strength * efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#ab44ae92e1f57a8163426f284491eefa5">falloff</a>);
<a name="l00911"></a>00911             <span class="keywordflow">break</span>;
<a name="l00912"></a>00912         <span class="keywordflow">case</span> <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba991516e08649c0752cd690246c5a43da">PFIELD_DRAG</a>:
<a name="l00913"></a>00913             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(force, point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a341b7512601d963e4f0458ecf036b2ac">vel</a>);
<a name="l00914"></a>00914             fac = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(force) * point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a046d9c160ba8dab8dfcb696a586f1674">vel_to_sec</a>;
<a name="l00915"></a>00915 
<a name="l00916"></a>00916             strength = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(strength, 2.0f);
<a name="l00917"></a>00917             damp = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(damp, 2.0f);
<a name="l00918"></a>00918 
<a name="l00919"></a>00919             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(force, -efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#ab44ae92e1f57a8163426f284491eefa5">falloff</a> * fac * (strength * fac + damp));
<a name="l00920"></a>00920             <span class="keywordflow">break</span>;
<a name="l00921"></a>00921     }
<a name="l00922"></a>00922 
<a name="l00923"></a>00923     <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#a7d6e9762b62db2b3edfbe874453d6204">PFIELD_DO_LOCATION</a>) {
<a name="l00924"></a>00924         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1b4079b4f57c1eaf908d521b5a0f867e">madd_v3_v3fl</a>(total_force, force, 1.0f/point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a046d9c160ba8dab8dfcb696a586f1674">vel_to_sec</a>);
<a name="l00925"></a>00925 
<a name="l00926"></a>00926         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a>, <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba7849b998d8b19cf1cbb147e8ec835c58">PFIELD_HARMONIC</a>, <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1ba991516e08649c0752cd690246c5a43da">PFIELD_DRAG</a>)==0 &amp;&amp; pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a2436a09ffb8e272f433bea87d584ffc3">f_flow</a> != 0.0f) {
<a name="l00927"></a>00927             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1b4079b4f57c1eaf908d521b5a0f867e">madd_v3_v3fl</a>(total_force, point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a341b7512601d963e4f0458ecf036b2ac">vel</a>, -pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a2436a09ffb8e272f433bea87d584ffc3">f_flow</a> * efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#ab44ae92e1f57a8163426f284491eefa5">falloff</a>);
<a name="l00928"></a>00928         }
<a name="l00929"></a>00929     }
<a name="l00930"></a>00930 
<a name="l00931"></a>00931     <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a08a03fcfb909ede71b162d30462fed29">flag</a> &amp; <a class="code" href="../../d2/d60/DNA__object__force_8h.html#aad7b941552bd426573226b82e0f37ce1">PFIELD_DO_ROTATION</a> &amp;&amp; point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#ab1794e8b56a3784f00b1253742d8a2e8">ave</a> &amp;&amp; point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a995f245118e3370de559e8658f6d83d2">rot</a>) {
<a name="l00932"></a>00932         <span class="keywordtype">float</span> xvec[3] = {1.0f, 0.0f, 0.0f};
<a name="l00933"></a>00933         <span class="keywordtype">float</span> dave[3];
<a name="l00934"></a>00934         <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a654dd0df4df6f960e592032f276f2c68">mul_qt_v3</a>(point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a995f245118e3370de559e8658f6d83d2">rot</a>, xvec);
<a name="l00935"></a>00935         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(dave, xvec, force);
<a name="l00936"></a>00936         <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a2436a09ffb8e272f433bea87d584ffc3">f_flow</a> != 0.0f) {
<a name="l00937"></a>00937             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1b4079b4f57c1eaf908d521b5a0f867e">madd_v3_v3fl</a>(dave, point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#ab1794e8b56a3784f00b1253742d8a2e8">ave</a>, -pd-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a2436a09ffb8e272f433bea87d584ffc3">f_flow</a> * efd-&gt;<a class="code" href="../../d8/d38/structEffectorData.html#ab44ae92e1f57a8163426f284491eefa5">falloff</a>);
<a name="l00938"></a>00938         }
<a name="l00939"></a>00939         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#ab1794e8b56a3784f00b1253742d8a2e8">ave</a>, dave);
<a name="l00940"></a>00940     }
<a name="l00941"></a>00941 }
<a name="l00942"></a>00942 
<a name="l00943"></a>00943 <span class="comment">/*  -------- pdDoEffectors() --------</span>
<a name="l00944"></a>00944 <span class="comment"> * generic force/speed system, now used for particles and softbodies</span>
<a name="l00945"></a>00945 <span class="comment"> * scene       = scene where it runs in, for time and stuff</span>
<a name="l00946"></a>00946 <span class="comment"> * lb           = listbase with objects that take part in effecting</span>
<a name="l00947"></a>00947 <span class="comment"> * opco     = global coord, as input</span>
<a name="l00948"></a>00948 <span class="comment"> * force        = force accumulator</span>
<a name="l00949"></a>00949 <span class="comment"> * speed        = actual current speed which can be altered</span>
<a name="l00950"></a>00950 <span class="comment"> * cur_time = &quot;external&quot; time in frames, is constant for static particles</span>
<a name="l00951"></a>00951 <span class="comment"> * loc_time = &quot;local&quot; time in frames, range &lt;0-1&gt; for the lifetime of particle</span>
<a name="l00952"></a>00952 <span class="comment"> * par_layer    = layer the caller is in</span>
<a name="l00953"></a>00953 <span class="comment"> * flags        = only used for softbody wind now</span>
<a name="l00954"></a>00954 <span class="comment"> * guide        = old speed of particle</span>
<a name="l00955"></a>00955 <span class="comment"> */</span>
<a name="l00956"></a><a class="code" href="../../d7/d50/effect_8c.html#a2c90692f00b708640e35e4413588d0eb">00956</a> <span class="keywordtype">void</span> <a class="code" href="../../dc/d65/BKE__effect_8h.html#a4099ac2ecd7e48764e8e741bf2aade72">pdDoEffectors</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *effectors, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *colliders, <a class="code" href="../../db/d19/structEffectorWeights.html">EffectorWeights</a> *weights, <a class="code" href="../../db/d29/structEffectedPoint.html">EffectedPoint</a> *<a class="code" href="../../d8/dae/structpoint.html">point</a>, <span class="keywordtype">float</span> *force, <span class="keywordtype">float</span> *impulse)
<a name="l00957"></a>00957 {
<a name="l00958"></a>00958 <span class="comment">/*</span>
<a name="l00959"></a>00959 <span class="comment"> * Modifies the force on a particle according to its</span>
<a name="l00960"></a>00960 <span class="comment"> * relation with the effector object</span>
<a name="l00961"></a>00961 <span class="comment"> * Different kind of effectors include:</span>
<a name="l00962"></a>00962 <span class="comment"> *     Forcefields: Gravity-like attractor</span>
<a name="l00963"></a>00963 <span class="comment"> *     (force power is related to the inverse of distance to the power of a falloff value)</span>
<a name="l00964"></a>00964 <span class="comment"> *     Vortex fields: swirling effectors</span>
<a name="l00965"></a>00965 <span class="comment"> *     (particles rotate around Z-axis of the object. otherwise, same relation as)</span>
<a name="l00966"></a>00966 <span class="comment"> *     (Forcefields, but this is not done through a force/acceleration)</span>
<a name="l00967"></a>00967 <span class="comment"> *     Guide: particles on a path</span>
<a name="l00968"></a>00968 <span class="comment"> *     (particles are guided along a curve bezier or old nurbs)</span>
<a name="l00969"></a>00969 <span class="comment"> *     (is independent of other effectors)</span>
<a name="l00970"></a>00970 <span class="comment"> */</span>
<a name="l00971"></a>00971     <a class="code" href="../../d6/d53/structEffectorCache.html">EffectorCache</a> *eff;
<a name="l00972"></a>00972     <a class="code" href="../../d8/d38/structEffectorData.html">EffectorData</a> efd;
<a name="l00973"></a>00973     <span class="keywordtype">int</span> <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>=0, tot = 1, <a class="code" href="../../d1/d22/stdosl_8h.html#a8bd9f841cf6ee6c256028a8a544fec3b">step</a> = 1;
<a name="l00974"></a>00974 
<a name="l00975"></a>00975     <span class="comment">/* Cycle through collected objects, get total of (1/(gravity_strength * dist^gravity_power)) */</span>
<a name="l00976"></a>00976     <span class="comment">/* Check for min distance here? (yes would be cool to add that, ton) */</span>
<a name="l00977"></a>00977     
<a name="l00978"></a>00978     <span class="keywordflow">if</span> (effectors) <span class="keywordflow">for</span> (eff = effectors-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; eff; eff=eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#adb86179b9e326c4785cc0023860f828b">next</a>) {
<a name="l00979"></a>00979         <span class="comment">/* object effectors were fully checked to be OK to evaluate! */</span>
<a name="l00980"></a>00980 
<a name="l00981"></a>00981         <a class="code" href="../../d7/d50/effect_8c.html#ab5f58c65f8b1284d5185a5295b691f44">get_effector_tot</a>(eff, &amp;efd, point, &amp;tot, &amp;p, &amp;<a class="code" href="../../d1/d22/stdosl_8h.html#a8bd9f841cf6ee6c256028a8a544fec3b">step</a>);
<a name="l00982"></a>00982 
<a name="l00983"></a>00983         <span class="keywordflow">for</span> (; p&lt;tot; p+=<a class="code" href="../../d1/d22/stdosl_8h.html#a8bd9f841cf6ee6c256028a8a544fec3b">step</a>) {
<a name="l00984"></a>00984             <span class="keywordflow">if</span> (<a class="code" href="../../dc/d65/BKE__effect_8h.html#a58303bb299cca9ec440911d2ead4e3fa">get_effector_data</a>(eff, &amp;efd, point, 0)) {
<a name="l00985"></a>00985                 efd.<a class="code" href="../../d8/d38/structEffectorData.html#ab44ae92e1f57a8163426f284491eefa5">falloff</a>= <a class="code" href="../../dc/d65/BKE__effect_8h.html#a405478a1f2b0fd107e25a1494009895e">effector_falloff</a>(eff, &amp;efd, point, weights);
<a name="l00986"></a>00986                 
<a name="l00987"></a>00987                 <span class="keywordflow">if</span> (efd.<a class="code" href="../../d8/d38/structEffectorData.html#ab44ae92e1f57a8163426f284491eefa5">falloff</a> &gt; 0.0f)
<a name="l00988"></a>00988                     efd.<a class="code" href="../../d8/d38/structEffectorData.html#ab44ae92e1f57a8163426f284491eefa5">falloff</a> *= <a class="code" href="../../d7/d50/effect_8c.html#aeb898451d1574dc6bacc24dbc1fa8ca9">eff_calc_visibility</a>(colliders, eff, &amp;efd, point);
<a name="l00989"></a>00989 
<a name="l00990"></a>00990                 <span class="keywordflow">if</span> (efd.<a class="code" href="../../d8/d38/structEffectorData.html#ab44ae92e1f57a8163426f284491eefa5">falloff</a> &lt;= 0.0f)
<a name="l00991"></a>00991                     ;   <span class="comment">/* don&#39;t do anything */</span>
<a name="l00992"></a>00992                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ac9d8a8260cd83ef92cc2c9e835b45886">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1baca7d52fea971450bd4a0333c24005a8b">PFIELD_TEXTURE</a>)
<a name="l00993"></a>00993                     <a class="code" href="../../d7/d50/effect_8c.html#a2a14ee7baa0ba96f51fc4fc28834452e">do_texture_effector</a>(eff, &amp;efd, point, force);
<a name="l00994"></a>00994                 <span class="keywordflow">else</span> {
<a name="l00995"></a>00995                     <span class="keywordtype">float</span> temp1[3]={0,0,0}, temp2[3];
<a name="l00996"></a>00996                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(temp1, force);
<a name="l00997"></a>00997 
<a name="l00998"></a>00998                     <a class="code" href="../../d7/d50/effect_8c.html#a700edf4ee3558b3e0198f33f3965f936">do_physical_effector</a>(eff, &amp;efd, point, force);
<a name="l00999"></a>00999                     
<a name="l01000"></a>01000                     <span class="comment">// for softbody backward compatibility</span>
<a name="l01001"></a>01001                     <span class="keywordflow">if</span> (point-&gt;<a class="code" href="../../db/d29/structEffectedPoint.html#a87ef0021915ff187a80514475d40edb1">flag</a> &amp; <a class="code" href="../../dc/d65/BKE__effect_8h.html#ae3176f609ab517b6be5ec61d3ae1f2b7">PE_WIND_AS_SPEED</a> &amp;&amp; impulse) {
<a name="l01002"></a>01002                         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(temp2, force, temp1);
<a name="l01003"></a>01003                         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(impulse, impulse, temp2);
<a name="l01004"></a>01004                     }
<a name="l01005"></a>01005                 }
<a name="l01006"></a>01006             }
<a name="l01007"></a>01007             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#ab0196afe758f721bf48df6de7211677f">flag</a> &amp; <a class="code" href="../../dc/d65/BKE__effect_8h.html#a4a4c44f3c53b4dab513bf72992fc58e5">PE_VELOCITY_TO_IMPULSE</a> &amp;&amp; impulse) {
<a name="l01008"></a>01008                 <span class="comment">/* special case for harmonic effector */</span>
<a name="l01009"></a>01009                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(impulse, impulse, efd.<a class="code" href="../../d8/d38/structEffectorData.html#aee929cc2925f4fbdd1398a3bbedb7e48">vel</a>);
<a name="l01010"></a>01010             }
<a name="l01011"></a>01011         }
<a name="l01012"></a>01012     }
<a name="l01013"></a>01013 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:16 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: node_composite_tree.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">node_composite_tree.c</div>  </div>
</div>
<div class="contents">
<a href="../../d7/d49/node__composite__tree_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version. </span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2007 Blender Foundation.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s):</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html">DNA_anim_types.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d27/DNA__node__types_8h.html">DNA_node_types.h</a>&quot;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d3e/BLI__listbase_8h.html">BLI_listbase.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dbb/BLI__threads_8h.html">BLI_threads.h</a>&quot;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d61/BLF__translation_8h.html">BLF_translation.h</a>&quot;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d51/BKE__animsys_8h.html">BKE_animsys.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/dca/BKE__colortools_8h.html">BKE_colortools.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dba/BKE__fcurve_8h.html">BKE_fcurve.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d91/BKE__node_8h.html">BKE_node.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d72/BKE__tracking_8h.html">BKE_tracking.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dde/BKE__utildefines_8h.html" title="blender format specific macros">BKE_utildefines.h</a>&quot;</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d99/node__exec_8h.html">node_exec.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d6e/node__util_8h.html">node_util.h</a>&quot;</span>
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d2e/PIL__time_8h.html">PIL_time.h</a>&quot;</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d05/NOD__composite_8h.html">NOD_composite.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d04/node__composite__util_8h.html">node_composite_util.h</a>&quot;</span>
<a name="l00062"></a>00062 
<a name="l00063"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#aa9057438d2c500463a36c32bb29d6754">00063</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d49/node__composite__tree_8c.html#aa9057438d2c500463a36c32bb29d6754">foreach_nodetree</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *<a class="code" href="../../d5/d95/makesdna_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>, <span class="keywordtype">void</span> *calldata, <a class="code" href="../../d4/d91/BKE__node_8h.html#a357b0dd8f3d0e55c65df08ce6d91db9d">bNodeTreeCallback</a> func)
<a name="l00064"></a>00064 {
<a name="l00065"></a>00065     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l00066"></a>00066     <span class="keywordflow">for</span> (sce= main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l00067"></a>00067         <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>) {
<a name="l00068"></a>00068             func(calldata, &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>);
<a name="l00069"></a>00069         }
<a name="l00070"></a>00070     }
<a name="l00071"></a>00071 }
<a name="l00072"></a>00072 
<a name="l00073"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#a00b3d60b2778adb35b96c6a0821ab3ef">00073</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a00b3d60b2778adb35b96c6a0821ab3ef">foreach_nodeclass</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(scene), <span class="keywordtype">void</span> *calldata, <a class="code" href="../../d4/d91/BKE__node_8h.html#a28c34016aebd5015e65ca3b91cea8573">bNodeClassCallback</a> func)
<a name="l00074"></a>00074 {
<a name="l00075"></a>00075     func(calldata, <a class="code" href="../../d4/d91/BKE__node_8h.html#acb9996cce432338c7608f8db542921a7">NODE_CLASS_INPUT</a>, <a class="code" href="../../d6/d61/BLF__translation_8h.html#abb0b47333c78518638888749beab5f55">IFACE_</a>(<span class="stringliteral">&quot;Input&quot;</span>));
<a name="l00076"></a>00076     func(calldata, <a class="code" href="../../d4/d91/BKE__node_8h.html#a0c1dfc239a1caee873fa06628a828b02">NODE_CLASS_OUTPUT</a>, <a class="code" href="../../d6/d61/BLF__translation_8h.html#abb0b47333c78518638888749beab5f55">IFACE_</a>(<span class="stringliteral">&quot;Output&quot;</span>));
<a name="l00077"></a>00077     func(calldata, <a class="code" href="../../d4/d91/BKE__node_8h.html#ac761b7934434e1c3ec14b775245222a7">NODE_CLASS_OP_COLOR</a>, <a class="code" href="../../d6/d61/BLF__translation_8h.html#abb0b47333c78518638888749beab5f55">IFACE_</a>(<span class="stringliteral">&quot;Color&quot;</span>));
<a name="l00078"></a>00078     func(calldata, <a class="code" href="../../d4/d91/BKE__node_8h.html#aac6207c8ff1a01a4ced776f3a98e8ebe">NODE_CLASS_OP_VECTOR</a>, <a class="code" href="../../d6/d61/BLF__translation_8h.html#abb0b47333c78518638888749beab5f55">IFACE_</a>(<span class="stringliteral">&quot;Vector&quot;</span>));
<a name="l00079"></a>00079     func(calldata, <a class="code" href="../../d4/d91/BKE__node_8h.html#ad0e69ae167f6bf3a2d3488a66b2aafd3">NODE_CLASS_OP_FILTER</a>, <a class="code" href="../../d6/d61/BLF__translation_8h.html#abb0b47333c78518638888749beab5f55">IFACE_</a>(<span class="stringliteral">&quot;Filter&quot;</span>));
<a name="l00080"></a>00080     func(calldata, <a class="code" href="../../d4/d91/BKE__node_8h.html#a68aa0af715862ad4bc845e929f7be84c">NODE_CLASS_CONVERTOR</a>, <a class="code" href="../../d6/d61/BLF__translation_8h.html#abb0b47333c78518638888749beab5f55">IFACE_</a>(<span class="stringliteral">&quot;Convertor&quot;</span>));
<a name="l00081"></a>00081     func(calldata, <a class="code" href="../../d4/d91/BKE__node_8h.html#a34d1a0e528062a9d43254871f26e5f6b">NODE_CLASS_MATTE</a>, <a class="code" href="../../d6/d61/BLF__translation_8h.html#abb0b47333c78518638888749beab5f55">IFACE_</a>(<span class="stringliteral">&quot;Matte&quot;</span>));
<a name="l00082"></a>00082     func(calldata, <a class="code" href="../../d4/d91/BKE__node_8h.html#a83a446430d32e6053b61a11bc527d3fd">NODE_CLASS_DISTORT</a>, <a class="code" href="../../d6/d61/BLF__translation_8h.html#abb0b47333c78518638888749beab5f55">IFACE_</a>(<span class="stringliteral">&quot;Distort&quot;</span>));
<a name="l00083"></a>00083     func(calldata, <a class="code" href="../../d4/d91/BKE__node_8h.html#ad761c7dc010f3b8f1079dda3c90d6899">NODE_CLASS_GROUP</a>, <a class="code" href="../../d6/d61/BLF__translation_8h.html#abb0b47333c78518638888749beab5f55">IFACE_</a>(<span class="stringliteral">&quot;Group&quot;</span>));
<a name="l00084"></a>00084     func(calldata, <a class="code" href="../../d4/d91/BKE__node_8h.html#abda5bb0a4f1a3569a4f4f52a09154748">NODE_CLASS_LAYOUT</a>, <a class="code" href="../../d6/d61/BLF__translation_8h.html#abb0b47333c78518638888749beab5f55">IFACE_</a>(<span class="stringliteral">&quot;Layout&quot;</span>));
<a name="l00085"></a>00085 }
<a name="l00086"></a>00086 
<a name="l00087"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#a570ed58b8379cdeb522b907dffa84b8b">00087</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a570ed58b8379cdeb522b907dffa84b8b">free_node_cache</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(ntree), <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00088"></a>00088 {
<a name="l00089"></a>00089     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00090"></a>00090     
<a name="l00091"></a>00091     <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00092"></a>00092         <span class="keywordflow">if</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ada73fe3d1ca89f7e5489ae9803d742a9">cache</a>) {
<a name="l00093"></a>00093             <a class="code" href="../../d1/d38/node__composite__util_8c.html#ac4ff3c9d76cd76ddf861c93b6234cadc">free_compbuf</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ada73fe3d1ca89f7e5489ae9803d742a9">cache</a>);
<a name="l00094"></a>00094             sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ada73fe3d1ca89f7e5489ae9803d742a9">cache</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00095"></a>00095         }
<a name="l00096"></a>00096     }
<a name="l00097"></a>00097 }
<a name="l00098"></a>00098 
<a name="l00099"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#aebc2ec072c5311f222f1f263b93b2997">00099</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d49/node__composite__tree_8c.html#aebc2ec072c5311f222f1f263b93b2997">free_cache</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00100"></a>00100 {
<a name="l00101"></a>00101     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00102"></a>00102     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l00103"></a>00103         <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a570ed58b8379cdeb522b907dffa84b8b">free_node_cache</a>(ntree, node);
<a name="l00104"></a>00104 }
<a name="l00105"></a>00105 
<a name="l00106"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#a956ab0478c74e22db192be9a1dd77cdd">00106</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a956ab0478c74e22db192be9a1dd77cdd">update_node</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00107"></a>00107 {
<a name="l00108"></a>00108     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00109"></a>00109 
<a name="l00110"></a>00110     <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00111"></a>00111         <span class="keywordflow">if</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ada73fe3d1ca89f7e5489ae9803d742a9">cache</a>) {
<a name="l00112"></a>00112             <span class="comment">//free_compbuf(sock-&gt;cache);</span>
<a name="l00113"></a>00113             <span class="comment">//sock-&gt;cache= NULL;</span>
<a name="l00114"></a>00114         }
<a name="l00115"></a>00115     }
<a name="l00116"></a>00116     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a37f3b57849379521514f103da2e8ffe3">need_exec</a>= 1;
<a name="l00117"></a>00117     
<a name="l00118"></a>00118     <span class="comment">/* individual node update call */</span>
<a name="l00119"></a>00119     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a3a5ca8ad893b664e3611ad8f83a46f32" title="Called when the node is updated in the editor.">updatefunc</a>)
<a name="l00120"></a>00120         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a3a5ca8ad893b664e3611ad8f83a46f32" title="Called when the node is updated in the editor.">updatefunc</a>(ntree, node);
<a name="l00121"></a>00121 }
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 <span class="comment">/* local tree then owns all compbufs */</span>
<a name="l00124"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#a72f154f92a004051437b8cae2aa83601">00124</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a72f154f92a004051437b8cae2aa83601">localize</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *localtree, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00125"></a>00125 {
<a name="l00126"></a>00126     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, *node_next;
<a name="l00127"></a>00127     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00128"></a>00128     
<a name="l00129"></a>00129     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00130"></a>00130         <span class="comment">/* ensure new user input gets handled ok */</span>
<a name="l00131"></a>00131         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a37f3b57849379521514f103da2e8ffe3">need_exec</a>= 0;
<a name="l00132"></a>00132         
<a name="l00133"></a>00133         <span class="comment">/* move over the compbufs */</span>
<a name="l00134"></a>00134         <span class="comment">/* right after ntreeCopyTree() oldsock pointers are valid */</span>
<a name="l00135"></a>00135         
<a name="l00136"></a>00136         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a2228c27b390d81a533a4bf66c5c9d5c7">CMP_NODE_VIEWER</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#abc03163f091ee64dc016da0f154af5f2">CMP_NODE_SPLITVIEWER</a>)) {
<a name="l00137"></a>00137             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>) {
<a name="l00138"></a>00138                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5235b68781c15e33df28760c8e43aa84">NODE_DO_OUTPUT</a>)
<a name="l00139"></a>00139                     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)<a class="code" href="../../d2/d77/BKE__image_8h.html#a8b98395ade63f058d251d705c6fc6395">copy_image</a>((<a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>);
<a name="l00140"></a>00140                 <span class="keywordflow">else</span>
<a name="l00141"></a>00141                     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00142"></a>00142             }
<a name="l00143"></a>00143         }
<a name="l00144"></a>00144         
<a name="l00145"></a>00145         <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00146"></a>00146             sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a652e2d25bfb52f5c1fafd99c533b1e45">new_sock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ada73fe3d1ca89f7e5489ae9803d742a9">cache</a>= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ada73fe3d1ca89f7e5489ae9803d742a9">cache</a>;
<a name="l00147"></a>00147             <a class="code" href="../../d1/d38/node__composite__util_8c.html#ab594933f34b9f85b0fb47507631771ba">compbuf_set_node</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a652e2d25bfb52f5c1fafd99c533b1e45">new_sock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ada73fe3d1ca89f7e5489ae9803d742a9">cache</a>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>);
<a name="l00148"></a>00148             
<a name="l00149"></a>00149             sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ada73fe3d1ca89f7e5489ae9803d742a9">cache</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00150"></a>00150             sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a652e2d25bfb52f5c1fafd99c533b1e45">new_sock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a652e2d25bfb52f5c1fafd99c533b1e45">new_sock</a>= sock;
<a name="l00151"></a>00151         }
<a name="l00152"></a>00152     }
<a name="l00153"></a>00153     
<a name="l00154"></a>00154     <span class="comment">/* replace muted nodes by internal links */</span>
<a name="l00155"></a>00155     <span class="keywordflow">for</span> (node= localtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node_next) {
<a name="l00156"></a>00156         node_next = node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>;
<a name="l00157"></a>00157         
<a name="l00158"></a>00158         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5ac24732c48b9f55ca854d76228c0ae5">NODE_MUTED</a>) {
<a name="l00159"></a>00159             <span class="comment">/* make sure the update tag isn&#39;t lost when removing the muted node.</span>
<a name="l00160"></a>00160 <span class="comment">             * propagate this to all downstream nodes.</span>
<a name="l00161"></a>00161 <span class="comment">             */</span>
<a name="l00162"></a>00162             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a37f3b57849379521514f103da2e8ffe3">need_exec</a>) {
<a name="l00163"></a>00163                 <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l00164"></a>00164                 <span class="keywordflow">for</span> (link=localtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link=link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>)
<a name="l00165"></a>00165                     <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>==node &amp;&amp; link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>)
<a name="l00166"></a>00166                         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a37f3b57849379521514f103da2e8ffe3">need_exec</a> = 1;
<a name="l00167"></a>00167             }
<a name="l00168"></a>00168             
<a name="l00169"></a>00169             <a class="code" href="../../d4/d91/BKE__node_8h.html#a28c5a2c4425a5a23de80e2715a6bb816">nodeInternalRelink</a>(localtree, node);
<a name="l00170"></a>00170             <a class="code" href="../../d4/d91/BKE__node_8h.html#a6913c62630bd85b7514bebc6e58c5d51">nodeFreeNode</a>(localtree, node);
<a name="l00171"></a>00171         }
<a name="l00172"></a>00172     }
<a name="l00173"></a>00173 }
<a name="l00174"></a>00174 
<a name="l00175"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#a5df1c43027d25a17266abc66b93ab05e">00175</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a5df1c43027d25a17266abc66b93ab05e">local_sync</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *localtree, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00176"></a>00176 {
<a name="l00177"></a>00177     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *lnode;
<a name="l00178"></a>00178     
<a name="l00179"></a>00179     <span class="comment">/* move over the compbufs and previews */</span>
<a name="l00180"></a>00180     <span class="keywordflow">for</span> (lnode= localtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; lnode; lnode= lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00181"></a>00181         <span class="keywordflow">if</span> ( (lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa630997609916544ff15aaa45a2f639e">exec</a> &amp; <a class="code" href="../../d4/d91/BKE__node_8h.html#a9f3f410a234bbf2553c3615bbc97a511">NODE_READY</a>) &amp;&amp; !(lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa630997609916544ff15aaa45a2f639e">exec</a> &amp; <a class="code" href="../../d4/d91/BKE__node_8h.html#a4d27fab8fb001969f6b6d51853c1af88">NODE_SKIPPED</a>) ) {
<a name="l00182"></a>00182             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/BKE__node_8h.html#af5de1a5b2cf226ea04c989eb8ae32fc8">ntreeNodeExists</a>(ntree, lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>)) {
<a name="l00183"></a>00183                 
<a name="l00184"></a>00184                 <span class="keywordflow">if</span> (lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a> &amp;&amp; lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>-&gt;<a class="code" href="../../de/d14/structbNodePreview.html#a4c5f68d28ed5eda79ec62a92b10dd049">rect</a>) {
<a name="l00185"></a>00185                     <a class="code" href="../../d4/d91/BKE__node_8h.html#afaeddf09fd0ee090b3dc02e6ef1d3dba">nodeFreePreview</a>(lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>);
<a name="l00186"></a>00186                     lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>= lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>;
<a name="l00187"></a>00187                     lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#af64aaac2b20b9aea026e7fa3c32e8918">preview</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00188"></a>00188                 }
<a name="l00189"></a>00189             }
<a name="l00190"></a>00190         }
<a name="l00191"></a>00191     }
<a name="l00192"></a>00192 }
<a name="l00193"></a>00193 
<a name="l00194"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#a20e7cdb7c9374297e128c84b3ce663cc">00194</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a20e7cdb7c9374297e128c84b3ce663cc">local_merge</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *localtree, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00195"></a>00195 {
<a name="l00196"></a>00196     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *lnode;
<a name="l00197"></a>00197     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *lsock;
<a name="l00198"></a>00198     
<a name="l00199"></a>00199     <span class="comment">/* move over the compbufs and previews */</span>
<a name="l00200"></a>00200     <span class="keywordflow">for</span> (lnode= localtree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; lnode; lnode= lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00201"></a>00201         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/BKE__node_8h.html#af5de1a5b2cf226ea04c989eb8ae32fc8">ntreeNodeExists</a>(ntree, lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>)) {
<a name="l00202"></a>00202             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a2228c27b390d81a533a4bf66c5c9d5c7">CMP_NODE_VIEWER</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#abc03163f091ee64dc016da0f154af5f2">CMP_NODE_SPLITVIEWER</a>)) {
<a name="l00203"></a>00203                 <span class="keywordflow">if</span> (lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a> &amp;&amp; (lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5235b68781c15e33df28760c8e43aa84">NODE_DO_OUTPUT</a>)) {
<a name="l00204"></a>00204                     <span class="comment">/* image_merge does sanity check for pointers */</span>
<a name="l00205"></a>00205                     <a class="code" href="../../d2/d77/BKE__image_8h.html#addaa5acc743631fba6cf4ec2eda4efb7">BKE_image_merge</a>((<a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *)lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>, (<a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *)lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>);
<a name="l00206"></a>00206                 }
<a name="l00207"></a>00207             }
<a name="l00208"></a>00208             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a7a7174378c79e98cd046514c9565a7b2">CMP_NODE_MOVIEDISTORTION</a>) {
<a name="l00209"></a>00209                 <span class="comment">/* special case for distortion node: distortion context is allocating in exec function</span>
<a name="l00210"></a>00210 <span class="comment">                   and to achive much better performance on further calls this context should be</span>
<a name="l00211"></a>00211 <span class="comment">                   copied back to original node */</span>
<a name="l00212"></a>00212                 <span class="keywordflow">if</span> (lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>) {
<a name="l00213"></a>00213                     <span class="keywordflow">if</span> (lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>)
<a name="l00214"></a>00214                         <a class="code" href="../../da/d72/BKE__tracking_8h.html#aa7c948cbe0d344d925709216b6fb8132">BKE_tracking_distortion_destroy</a>(lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>);
<a name="l00215"></a>00215 
<a name="l00216"></a>00216                     lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>= <a class="code" href="../../da/d72/BKE__tracking_8h.html#a398224a9861ff5ad8eeae79a17e400ac">BKE_tracking_distortion_copy</a>(lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>);
<a name="l00217"></a>00217                 }
<a name="l00218"></a>00218             }
<a name="l00219"></a>00219             
<a name="l00220"></a>00220             <span class="keywordflow">for</span> (lsock= lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; lsock; lsock= lsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00221"></a>00221                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/BKE__node_8h.html#a785f7f622dd0398a5e1ca3af3ac2187e">ntreeOutputExists</a>(lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>, lsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a652e2d25bfb52f5c1fafd99c533b1e45">new_sock</a>)) {
<a name="l00222"></a>00222                     lsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a652e2d25bfb52f5c1fafd99c533b1e45">new_sock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ada73fe3d1ca89f7e5489ae9803d742a9">cache</a>= lsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ada73fe3d1ca89f7e5489ae9803d742a9">cache</a>;
<a name="l00223"></a>00223                     <a class="code" href="../../d1/d38/node__composite__util_8c.html#ab594933f34b9f85b0fb47507631771ba">compbuf_set_node</a>(lsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a652e2d25bfb52f5c1fafd99c533b1e45">new_sock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ada73fe3d1ca89f7e5489ae9803d742a9">cache</a>, lnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>);
<a name="l00224"></a>00224                     lsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ada73fe3d1ca89f7e5489ae9803d742a9">cache</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00225"></a>00225                     lsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a652e2d25bfb52f5c1fafd99c533b1e45">new_sock</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00226"></a>00226                 }
<a name="l00227"></a>00227             }
<a name="l00228"></a>00228         }
<a name="l00229"></a>00229     }
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 
<a name="l00232"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#a8568effaf95c1efd2e0482ed79dfac4f">00232</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a8568effaf95c1efd2e0482ed79dfac4f">update</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00233"></a>00233 {
<a name="l00234"></a>00234     <a class="code" href="../../d4/d91/BKE__node_8h.html#a9bc46b59ae07500da394cfd467c24b10">ntreeSetOutput</a>(ntree);
<a name="l00235"></a>00235 }
<a name="l00236"></a>00236 
<a name="l00237"></a><a class="code" href="../../d0/d05/NOD__composite_8h.html#a9ee7bb923a21f5a57c06c04482e3788f">00237</a> <a class="code" href="../../d7/d11/structbNodeTreeType.html">bNodeTreeType</a> <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a9ee7bb923a21f5a57c06c04482e3788f">ntreeType_Composite</a> = {
<a name="l00238"></a>00238     <span class="comment">/* type */</span>              <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>,
<a name="l00239"></a>00239     <span class="comment">/* idname */</span>            <span class="stringliteral">&quot;NTCompositing Nodetree&quot;</span>,
<a name="l00240"></a>00240     
<a name="l00241"></a>00241     <span class="comment">/* node_types */</span>        { <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> },
<a name="l00242"></a>00242     
<a name="l00243"></a>00243     <span class="comment">/* free_cache */</span>        <a class="code" href="../../d7/d49/node__composite__tree_8c.html#aebc2ec072c5311f222f1f263b93b2997">free_cache</a>,
<a name="l00244"></a>00244     <span class="comment">/* free_node_cache */</span>   <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a570ed58b8379cdeb522b907dffa84b8b">free_node_cache</a>,
<a name="l00245"></a>00245     <span class="comment">/* foreach_nodetree */</span>  <a class="code" href="../../d7/d49/node__composite__tree_8c.html#aa9057438d2c500463a36c32bb29d6754">foreach_nodetree</a>,
<a name="l00246"></a>00246     <span class="comment">/* foreach_nodeclass */</span> <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a00b3d60b2778adb35b96c6a0821ab3ef">foreach_nodeclass</a>,
<a name="l00247"></a>00247     <span class="comment">/* localize */</span>          <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a72f154f92a004051437b8cae2aa83601">localize</a>,
<a name="l00248"></a>00248     <span class="comment">/* local_sync */</span>        <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a5df1c43027d25a17266abc66b93ab05e">local_sync</a>,
<a name="l00249"></a>00249     <span class="comment">/* local_merge */</span>       <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a20e7cdb7c9374297e128c84b3ce663cc">local_merge</a>,
<a name="l00250"></a>00250     <span class="comment">/* update */</span>            <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a8568effaf95c1efd2e0482ed79dfac4f">update</a>,
<a name="l00251"></a>00251     <span class="comment">/* update_node */</span>       <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a956ab0478c74e22db192be9a1dd77cdd">update_node</a>,
<a name="l00252"></a>00252     <span class="comment">/* validate_link */</span>     <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,
<a name="l00253"></a>00253     <span class="comment">/* internal_connect */</span>  <a class="code" href="../../de/d31/node__util_8c.html#a199c3842c9b9201800e649ae61974f94">node_internal_connect_default</a>
<a name="l00254"></a>00254 };
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 
<a name="l00257"></a>00257 <span class="comment">/* XXX Group nodes must set use_tree_data to false, since their trees can be shared by multiple nodes.</span>
<a name="l00258"></a>00258 <span class="comment"> * If use_tree_data is true, the ntree-&gt;execdata pointer is checked to avoid multiple execution of top-level trees.</span>
<a name="l00259"></a>00259 <span class="comment"> */</span>
<a name="l00260"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#a83842d8eb3668e574c1865c45effb028">00260</a> <span class="keyword">struct </span><a class="code" href="../../d1/d98/structbNodeTreeExec.html">bNodeTreeExec</a> *<a class="code" href="../../d4/d91/BKE__node_8h.html#a27e2e974f13a10824149cbd2c6b6da13">ntreeCompositBeginExecTree</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <span class="keywordtype">int</span> use_tree_data)
<a name="l00261"></a>00261 {
<a name="l00262"></a>00262     <a class="code" href="../../d1/d98/structbNodeTreeExec.html">bNodeTreeExec</a> *<a class="code" href="../../d4/dfa/node__composite__moviedistortion_8c.html#afe18d7947bb74ada6e3bc895141c3d76">exec</a>;
<a name="l00263"></a>00263     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00264"></a>00264     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00265"></a>00265     
<a name="l00266"></a>00266     <span class="keywordflow">if</span> (use_tree_data) {
<a name="l00267"></a>00267         <span class="comment">/* XXX hack: prevent exec data from being generated twice.</span>
<a name="l00268"></a>00268 <span class="comment">         * this should be handled by the renderer!</span>
<a name="l00269"></a>00269 <span class="comment">         */</span>
<a name="l00270"></a>00270         <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae9db87987b712dfeae144221d0e225d4">execdata</a>)
<a name="l00271"></a>00271             <span class="keywordflow">return</span> ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae9db87987b712dfeae144221d0e225d4">execdata</a>;
<a name="l00272"></a>00272     }
<a name="l00273"></a>00273     
<a name="l00274"></a>00274     <span class="comment">/* ensures only a single output node is enabled */</span>
<a name="l00275"></a>00275     <a class="code" href="../../d4/d91/BKE__node_8h.html#a9bc46b59ae07500da394cfd467c24b10">ntreeSetOutput</a>(ntree);
<a name="l00276"></a>00276     
<a name="l00277"></a>00277     exec = <a class="code" href="../../da/d34/node__exec_8c.html#ad0c6c7cf1c63de08a0b73e9967635dba">ntree_exec_begin</a>(ntree);
<a name="l00278"></a>00278     
<a name="l00279"></a>00279     <span class="keywordflow">for</span> (node= exec-&gt;<a class="code" href="../../d1/d98/structbNodeTreeExec.html#aac3432769f2301db0e68571264020788">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00280"></a>00280         <span class="comment">/* initialize needed for groups */</span>
<a name="l00281"></a>00281         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa630997609916544ff15aaa45a2f639e">exec</a>= 0;  
<a name="l00282"></a>00282         
<a name="l00283"></a>00283         <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00284"></a>00284             <a class="code" href="../../de/d8a/structbNodeStack.html">bNodeStack</a> *ns= <a class="code" href="../../da/d34/node__exec_8c.html#af558d65f09672f835208c35f3f9b733d">node_get_socket_stack</a>(exec-&gt;<a class="code" href="../../d1/d98/structbNodeTreeExec.html#aa82249855ebc8968babf72de67f7be3f">stack</a>, sock);
<a name="l00285"></a>00285             <span class="keywordflow">if</span> (ns &amp;&amp; sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ada73fe3d1ca89f7e5489ae9803d742a9">cache</a>) {
<a name="l00286"></a>00286                 ns-&gt;<a class="code" href="../../de/d8a/structbNodeStack.html#a7df6710a4f38c0bf036156c5a6d4fe46">data</a>= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ada73fe3d1ca89f7e5489ae9803d742a9">cache</a>;
<a name="l00287"></a>00287                 sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ada73fe3d1ca89f7e5489ae9803d742a9">cache</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00288"></a>00288             }
<a name="l00289"></a>00289         }
<a name="l00290"></a>00290         <span class="comment">/* cannot initialize them while using in threads */</span>
<a name="l00291"></a>00291         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0388eda1f65113c4a15720e037c11cb4">ELEM4</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a938bbac603bea1f1790cfe6ec45ce121">CMP_NODE_TIME</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a837e7c0b2a241e438be5cbd6dc0d16d0">CMP_NODE_CURVE_VEC</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#aa32ec823eb8b629ad8adcd886553bf49">CMP_NODE_CURVE_RGB</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a6f5bd8f57b461853c73f9c740e254de0">CMP_NODE_HUECORRECT</a>)) {
<a name="l00292"></a>00292             <a class="code" href="../../d4/dca/BKE__colortools_8h.html#a42d6a337419141c095383cdb94a3a413">curvemapping_initialize</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>);
<a name="l00293"></a>00293             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#aa32ec823eb8b629ad8adcd886553bf49">CMP_NODE_CURVE_RGB</a>)
<a name="l00294"></a>00294                 <a class="code" href="../../d4/dca/BKE__colortools_8h.html#ad9d2df14ef13674d8aeecd581ec067f9">curvemapping_premultiply</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>, 0);
<a name="l00295"></a>00295         }
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297     
<a name="l00298"></a>00298     <span class="keywordflow">if</span> (use_tree_data) {
<a name="l00299"></a>00299         <span class="comment">/* XXX this should not be necessary, but is still used for cmp/sha/tex nodes,</span>
<a name="l00300"></a>00300 <span class="comment">         * which only store the ntree pointer. Should be fixed at some point!</span>
<a name="l00301"></a>00301 <span class="comment">         */</span>
<a name="l00302"></a>00302         ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae9db87987b712dfeae144221d0e225d4">execdata</a> = <a class="code" href="../../d4/dfa/node__composite__moviedistortion_8c.html#afe18d7947bb74ada6e3bc895141c3d76">exec</a>;
<a name="l00303"></a>00303     }
<a name="l00304"></a>00304     
<a name="l00305"></a>00305     <span class="keywordflow">return</span> <a class="code" href="../../d4/dfa/node__composite__moviedistortion_8c.html#afe18d7947bb74ada6e3bc895141c3d76">exec</a>;
<a name="l00306"></a>00306 }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 <span class="comment">/* XXX Group nodes must set use_tree_data to false, since their trees can be shared by multiple nodes.</span>
<a name="l00309"></a>00309 <span class="comment"> * If use_tree_data is true, the ntree-&gt;execdata pointer is checked to avoid multiple execution of top-level trees.</span>
<a name="l00310"></a>00310 <span class="comment"> */</span>
<a name="l00311"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#a249f37211882d922b9daaee6fa376af3">00311</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#af898c8382fa74b9785f6489117c36aa4">ntreeCompositEndExecTree</a>(<a class="code" href="../../d1/d98/structbNodeTreeExec.html">bNodeTreeExec</a> *<a class="code" href="../../d4/dfa/node__composite__moviedistortion_8c.html#afe18d7947bb74ada6e3bc895141c3d76">exec</a>, <span class="keywordtype">int</span> use_tree_data)
<a name="l00312"></a>00312 {
<a name="l00313"></a>00313     <span class="keywordflow">if</span> (exec) {
<a name="l00314"></a>00314         <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree= exec-&gt;<a class="code" href="../../d1/d98/structbNodeTreeExec.html#aac3432769f2301db0e68571264020788">nodetree</a>;
<a name="l00315"></a>00315         <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00316"></a>00316         <a class="code" href="../../de/d8a/structbNodeStack.html">bNodeStack</a> *ns;
<a name="l00317"></a>00317         
<a name="l00318"></a>00318         <span class="keywordflow">for</span> (node= exec-&gt;<a class="code" href="../../d1/d98/structbNodeTreeExec.html#aac3432769f2301db0e68571264020788">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00319"></a>00319             <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00320"></a>00320             
<a name="l00321"></a>00321             <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00322"></a>00322                 ns = <a class="code" href="../../da/d34/node__exec_8c.html#af558d65f09672f835208c35f3f9b733d">node_get_socket_stack</a>(exec-&gt;<a class="code" href="../../d1/d98/structbNodeTreeExec.html#aa82249855ebc8968babf72de67f7be3f">stack</a>, sock);
<a name="l00323"></a>00323                 <span class="keywordflow">if</span> (ns &amp;&amp; ns-&gt;<a class="code" href="../../de/d8a/structbNodeStack.html#a7df6710a4f38c0bf036156c5a6d4fe46">data</a>) {
<a name="l00324"></a>00324                     sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ada73fe3d1ca89f7e5489ae9803d742a9">cache</a>= ns-&gt;<a class="code" href="../../de/d8a/structbNodeStack.html#a7df6710a4f38c0bf036156c5a6d4fe46">data</a>;
<a name="l00325"></a>00325                     ns-&gt;<a class="code" href="../../de/d8a/structbNodeStack.html#a7df6710a4f38c0bf036156c5a6d4fe46">data</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00326"></a>00326                 }
<a name="l00327"></a>00327             }
<a name="l00328"></a>00328             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#aa32ec823eb8b629ad8adcd886553bf49">CMP_NODE_CURVE_RGB</a>)
<a name="l00329"></a>00329                 <a class="code" href="../../d4/dca/BKE__colortools_8h.html#ad9d2df14ef13674d8aeecd581ec067f9">curvemapping_premultiply</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa64d6ff9becb0b14722a85e5b337f874">storage</a>, 1);
<a name="l00330"></a>00330             
<a name="l00331"></a>00331             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a37f3b57849379521514f103da2e8ffe3">need_exec</a>= 0;
<a name="l00332"></a>00332         }
<a name="l00333"></a>00333     
<a name="l00334"></a>00334         <a class="code" href="../../da/d34/node__exec_8c.html#ae516fab347d1fe47a5b3464d38e4dc93">ntree_exec_end</a>(exec);
<a name="l00335"></a>00335         
<a name="l00336"></a>00336         <span class="keywordflow">if</span> (use_tree_data) {
<a name="l00337"></a>00337             <span class="comment">/* XXX clear nodetree backpointer to exec data, same problem as noted in ntreeBeginExecTree */</span>
<a name="l00338"></a>00338             ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae9db87987b712dfeae144221d0e225d4">execdata</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00339"></a>00339         }
<a name="l00340"></a>00340     }
<a name="l00341"></a>00341 }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343 <span class="comment">/* ***************************** threaded version for execute composite nodes ************* */</span>
<a name="l00344"></a>00344 <span class="comment">/* these are nodes without input, only giving values */</span>
<a name="l00345"></a>00345 <span class="comment">/* or nodes with only value inputs */</span>
<a name="l00346"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#adea242df40478941a969bf35572a3b26">00346</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/node__composite__tree_8c.html#adea242df40478941a969bf35572a3b26">node_only_value</a>(<a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00347"></a>00347 {
<a name="l00348"></a>00348     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00349"></a>00349     
<a name="l00350"></a>00350     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a938bbac603bea1f1790cfe6ec45ce121">CMP_NODE_TIME</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a8e0a0d67741e4c6e1702e6daf9cd5428">CMP_NODE_VALUE</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a898742de1667efec2578885bc899f6ee">CMP_NODE_RGB</a>))
<a name="l00351"></a>00351         <span class="keywordflow">return</span> 1;
<a name="l00352"></a>00352     
<a name="l00353"></a>00353     <span class="comment">/* doing this for all node types goes wrong. memory free errors */</span>
<a name="l00354"></a>00354     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#a387a7a2f2e695425aff01e5e25a234d8">CMP_NODE_MAP_VALUE</a>) {
<a name="l00355"></a>00355         <span class="keywordtype">int</span> retval= 1;
<a name="l00356"></a>00356         <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00357"></a>00357             <span class="keywordflow">if</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>)
<a name="l00358"></a>00358                 retval &amp;= <a class="code" href="../../d7/d49/node__composite__tree_8c.html#adea242df40478941a969bf35572a3b26">node_only_value</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>);
<a name="l00359"></a>00359         }
<a name="l00360"></a>00360         <span class="keywordflow">return</span> retval;
<a name="l00361"></a>00361     }
<a name="l00362"></a>00362     <span class="keywordflow">return</span> 0;
<a name="l00363"></a>00363 }
<a name="l00364"></a>00364 
<a name="l00365"></a>00365 <span class="comment">/* not changing info, for thread callback */</span>
<a name="l00366"></a><a class="code" href="../../de/d7d/structThreadData.html">00366</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../de/d7d/structThreadData.html">ThreadData</a> {
<a name="l00367"></a><a class="code" href="../../de/d7d/structThreadData.html#a9e4026cc8abd11a1025878b5ce8f7b22">00367</a>     <a class="code" href="../../de/d8a/structbNodeStack.html">bNodeStack</a> *<a class="code" href="../../de/d7d/structThreadData.html#a9e4026cc8abd11a1025878b5ce8f7b22">stack</a>;
<a name="l00368"></a><a class="code" href="../../de/d7d/structThreadData.html#a3018b7de028114a2d44a152e6705e91a">00368</a>     <a class="code" href="../../d3/d27/structRenderData.html">RenderData</a> *<a class="code" href="../../de/d7d/structThreadData.html#a3018b7de028114a2d44a152e6705e91a">rd</a>;
<a name="l00369"></a>00369 } <a class="code" href="../../d7/d49/node__composite__tree_8c.html#ae7578518f689b6a650081728afc4f64d">ThreadData</a>;
<a name="l00370"></a>00370 
<a name="l00371"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#ac5408c29241f78831081bc26044e59c7">00371</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d7/d49/node__composite__tree_8c.html#ac5408c29241f78831081bc26044e59c7">exec_composite_node</a>(<span class="keywordtype">void</span> *nodeexec_v)
<a name="l00372"></a>00372 {
<a name="l00373"></a>00373     <a class="code" href="../../de/d8a/structbNodeStack.html">bNodeStack</a> *nsin[<a class="code" href="../../d4/d91/BKE__node_8h.html#ac0ab6f439d003d912087974e24160b68">MAX_SOCKET</a>];   <span class="comment">/* arbitrary... watch this */</span>
<a name="l00374"></a>00374     <a class="code" href="../../de/d8a/structbNodeStack.html">bNodeStack</a> *nsout[<a class="code" href="../../d4/d91/BKE__node_8h.html#ac0ab6f439d003d912087974e24160b68">MAX_SOCKET</a>];  <span class="comment">/* arbitrary... watch this */</span>
<a name="l00375"></a>00375     <a class="code" href="../../d5/dd4/structbNodeExec.html">bNodeExec</a> *nodeexec= nodeexec_v;
<a name="l00376"></a>00376     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node= nodeexec-&gt;<a class="code" href="../../d5/dd4/structbNodeExec.html#af7f644bf83b46cee6a9b394aef164a27">node</a>;
<a name="l00377"></a>00377     <a class="code" href="../../de/d7d/structThreadData.html">ThreadData</a> *thd= (<a class="code" href="../../de/d7d/structThreadData.html">ThreadData</a> *)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aca309d9958b17c283c63239f8c9beb6a">threaddata</a>;
<a name="l00378"></a>00378     
<a name="l00379"></a>00379     <a class="code" href="../../da/d34/node__exec_8c.html#a2771e35af4dc3cc44d8e3f4f558d9f51">node_get_stack</a>(node, thd-&gt;<a class="code" href="../../de/d7d/structThreadData.html#a9e4026cc8abd11a1025878b5ce8f7b22">stack</a>, nsin, nsout);
<a name="l00380"></a>00380     
<a name="l00381"></a>00381     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ac2ffa2c3ecc9f4553ba458d7859d5777">execfunc</a>)
<a name="l00382"></a>00382         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ac2ffa2c3ecc9f4553ba458d7859d5777">execfunc</a>(thd-&gt;<a class="code" href="../../de/d7d/structThreadData.html#a3018b7de028114a2d44a152e6705e91a">rd</a>, node, nsin, nsout);
<a name="l00383"></a>00383     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a6824f8e31d7923170e49746787393afb">newexecfunc</a>)
<a name="l00384"></a>00384         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a6824f8e31d7923170e49746787393afb">newexecfunc</a>(thd-&gt;<a class="code" href="../../de/d7d/structThreadData.html#a3018b7de028114a2d44a152e6705e91a">rd</a>, 0, node, nodeexec-&gt;<a class="code" href="../../d5/dd4/structbNodeExec.html#a61eea5bd95967ca43167d1e4088f3552">data</a>, nsin, nsout);
<a name="l00385"></a>00385     
<a name="l00386"></a>00386     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa630997609916544ff15aaa45a2f639e">exec</a> |= <a class="code" href="../../d4/d91/BKE__node_8h.html#a9f3f410a234bbf2553c3615bbc97a511">NODE_READY</a>;
<a name="l00387"></a>00387     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00388"></a>00388 }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390 <span class="comment">/* return total of executable nodes, for timecursor */</span>
<a name="l00391"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#a02b82313b257a16a9b7d1d27789c8403">00391</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a02b82313b257a16a9b7d1d27789c8403">setExecutableNodes</a>(<a class="code" href="../../d1/d98/structbNodeTreeExec.html">bNodeTreeExec</a> *<a class="code" href="../../d4/dfa/node__composite__moviedistortion_8c.html#afe18d7947bb74ada6e3bc895141c3d76">exec</a>, <a class="code" href="../../de/d7d/structThreadData.html">ThreadData</a> *thd)
<a name="l00392"></a>00392 {
<a name="l00393"></a>00393     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree = exec-&gt;<a class="code" href="../../d1/d98/structbNodeTreeExec.html#aac3432769f2301db0e68571264020788">nodetree</a>;
<a name="l00394"></a>00394     <a class="code" href="../../de/d8a/structbNodeStack.html">bNodeStack</a> *nsin[<a class="code" href="../../d4/d91/BKE__node_8h.html#ac0ab6f439d003d912087974e24160b68">MAX_SOCKET</a>];   <span class="comment">/* arbitrary... watch this */</span>
<a name="l00395"></a>00395     <a class="code" href="../../de/d8a/structbNodeStack.html">bNodeStack</a> *nsout[<a class="code" href="../../d4/d91/BKE__node_8h.html#ac0ab6f439d003d912087974e24160b68">MAX_SOCKET</a>];  <span class="comment">/* arbitrary... watch this */</span>
<a name="l00396"></a>00396     <a class="code" href="../../d5/dd4/structbNodeExec.html">bNodeExec</a> *nodeexec;
<a name="l00397"></a>00397     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00398"></a>00398     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00399"></a>00399     <span class="keywordtype">int</span> n, totnode= 0, group_edit= 0;
<a name="l00400"></a>00400     
<a name="l00401"></a>00401     <span class="comment">/* if we are in group edit, viewer nodes get skipped when group has viewer */</span>
<a name="l00402"></a>00402     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l00403"></a>00403         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#ab9f16ff5fded11f644b983a041c97edd">NODE_GROUP</a> &amp;&amp; (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a66aa5ce9c1257725d7e16bb53603749b">NODE_GROUP_EDIT</a>))
<a name="l00404"></a>00404             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/BKE__node_8h.html#af8797e56955a10c3cdf51aa7aa6233ca">ntreeHasType</a>((<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a2228c27b390d81a533a4bf66c5c9d5c7">CMP_NODE_VIEWER</a>))
<a name="l00405"></a>00405                 group_edit= 1;
<a name="l00406"></a>00406     
<a name="l00407"></a>00407     <span class="comment">/* NB: using the exec data list here to have valid dependency sort */</span>
<a name="l00408"></a>00408     <span class="keywordflow">for</span> (n=0, nodeexec=exec-&gt;<a class="code" href="../../d1/d98/structbNodeTreeExec.html#a7b9b4217e53aad7e62362c47ae0f4555">nodeexec</a>; n &lt; exec-&gt;totnodes; ++n, ++nodeexec) {
<a name="l00409"></a>00409         <span class="keywordtype">int</span> a;
<a name="l00410"></a>00410         node = nodeexec-&gt;<a class="code" href="../../d5/dd4/structbNodeExec.html#af7f644bf83b46cee6a9b394aef164a27">node</a>;
<a name="l00411"></a>00411         
<a name="l00412"></a>00412         <a class="code" href="../../da/d34/node__exec_8c.html#a2771e35af4dc3cc44d8e3f4f558d9f51">node_get_stack</a>(node, exec-&gt;<a class="code" href="../../d1/d98/structbNodeTreeExec.html#aa82249855ebc8968babf72de67f7be3f">stack</a>, nsin, nsout);
<a name="l00413"></a>00413         
<a name="l00414"></a>00414         <span class="comment">/* test the outputs */</span>
<a name="l00415"></a>00415         <span class="comment">/* skip value-only nodes (should be in type!) */</span>
<a name="l00416"></a>00416         <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d49/node__composite__tree_8c.html#adea242df40478941a969bf35572a3b26">node_only_value</a>(node)) {
<a name="l00417"></a>00417             <span class="keywordflow">for</span> (a=0, sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>, a++) {
<a name="l00418"></a>00418                 <span class="keywordflow">if</span> (nsout[a]-&gt;<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; nsout[a]-&gt;hasoutput) {
<a name="l00419"></a>00419                     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a37f3b57849379521514f103da2e8ffe3">need_exec</a>= 1;
<a name="l00420"></a>00420                     <span class="keywordflow">break</span>;
<a name="l00421"></a>00421                 }
<a name="l00422"></a>00422             }
<a name="l00423"></a>00423         }
<a name="l00424"></a>00424         
<a name="l00425"></a>00425         <span class="comment">/* test the inputs */</span>
<a name="l00426"></a>00426         <span class="keywordflow">for</span> (a=0, sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>, a++) {
<a name="l00427"></a>00427             <span class="comment">/* skip viewer nodes in bg render or group edit */</span>
<a name="l00428"></a>00428             <span class="keywordflow">if</span> ( <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a2228c27b390d81a533a4bf66c5c9d5c7">CMP_NODE_VIEWER</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#abc03163f091ee64dc016da0f154af5f2">CMP_NODE_SPLITVIEWER</a>) &amp;&amp; (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.background || group_edit))
<a name="l00429"></a>00429                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a37f3b57849379521514f103da2e8ffe3">need_exec</a>= 0;
<a name="l00430"></a>00430             <span class="comment">/* is sock in use? */</span>
<a name="l00431"></a>00431             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>) {
<a name="l00432"></a>00432                 <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>;
<a name="l00433"></a>00433                 
<a name="l00434"></a>00434                 <span class="comment">/* this is the test for a cyclic case */</span>
<a name="l00435"></a>00435                 <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00436"></a>00436                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a024f543c615a684a65fc2dd44303ab1c">level</a> &gt;= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a024f543c615a684a65fc2dd44303ab1c">level</a> &amp;&amp; link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a024f543c615a684a65fc2dd44303ab1c">level</a>!=0xFFF) {
<a name="l00437"></a>00437                     <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a37f3b57849379521514f103da2e8ffe3">need_exec</a>) {
<a name="l00438"></a>00438                         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a37f3b57849379521514f103da2e8ffe3">need_exec</a>= 1;
<a name="l00439"></a>00439                         <span class="keywordflow">break</span>;
<a name="l00440"></a>00440                     }
<a name="l00441"></a>00441                 }
<a name="l00442"></a>00442                 <span class="keywordflow">else</span> {
<a name="l00443"></a>00443                     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a37f3b57849379521514f103da2e8ffe3">need_exec</a>= 0;
<a name="l00444"></a>00444                     printf(<span class="stringliteral">&quot;Node %s skipped, cyclic dependency\n&quot;</span>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a5d65cbe1159d2c591a3ba7815817b0c4">name</a>);
<a name="l00445"></a>00445                 }
<a name="l00446"></a>00446             }
<a name="l00447"></a>00447         }
<a name="l00448"></a>00448         
<a name="l00449"></a>00449         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a37f3b57849379521514f103da2e8ffe3">need_exec</a>) {
<a name="l00450"></a>00450             
<a name="l00451"></a>00451             <span class="comment">/* free output buffers */</span>
<a name="l00452"></a>00452             <span class="keywordflow">for</span> (a=0, sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>, a++) {
<a name="l00453"></a>00453                 <span class="keywordflow">if</span> (nsout[a]-&gt;<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>) {
<a name="l00454"></a>00454                     <a class="code" href="../../d1/d38/node__composite__util_8c.html#ac4ff3c9d76cd76ddf861c93b6234cadc">free_compbuf</a>(nsout[a]-&gt;<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>);
<a name="l00455"></a>00455                     nsout[a]-&gt;<a class="code" href="../../de/d8a/structbNodeStack.html#a7df6710a4f38c0bf036156c5a6d4fe46">data</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00456"></a>00456                 }
<a name="l00457"></a>00457             }
<a name="l00458"></a>00458             totnode++;
<a name="l00459"></a>00459             <span class="comment">/* printf(&quot;node needs exec %s\n&quot;, node-&gt;name); */</span>
<a name="l00460"></a>00460             
<a name="l00461"></a>00461             <span class="comment">/* tag for getExecutableNode() */</span>
<a name="l00462"></a>00462             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa630997609916544ff15aaa45a2f639e">exec</a>= 0;
<a name="l00463"></a>00463         }
<a name="l00464"></a>00464         <span class="keywordflow">else</span> {
<a name="l00465"></a>00465             <span class="comment">/* tag for getExecutableNode() */</span>
<a name="l00466"></a>00466             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa630997609916544ff15aaa45a2f639e">exec</a>= <a class="code" href="../../d4/d91/BKE__node_8h.html#a9f3f410a234bbf2553c3615bbc97a511">NODE_READY</a>|<a class="code" href="../../d4/d91/BKE__node_8h.html#a924afbd8067dedd900012d1bed183956">NODE_FINISHED</a>|<a class="code" href="../../d4/d91/BKE__node_8h.html#a4d27fab8fb001969f6b6d51853c1af88">NODE_SKIPPED</a>;
<a name="l00467"></a>00467             
<a name="l00468"></a>00468         }
<a name="l00469"></a>00469     }
<a name="l00470"></a>00470     
<a name="l00471"></a>00471     <span class="comment">/* last step: set the stack values for only-value nodes */</span>
<a name="l00472"></a>00472     <span class="comment">/* just does all now, compared to a full buffer exec this is nothing */</span>
<a name="l00473"></a>00473     <span class="keywordflow">if</span> (totnode) {
<a name="l00474"></a>00474         <span class="keywordflow">for</span> (n=0, nodeexec=exec-&gt;<a class="code" href="../../d1/d98/structbNodeTreeExec.html#a7b9b4217e53aad7e62362c47ae0f4555">nodeexec</a>; n &lt; exec-&gt;totnodes; ++n, ++nodeexec) {
<a name="l00475"></a>00475             node = nodeexec-&gt;<a class="code" href="../../d5/dd4/structbNodeExec.html#af7f644bf83b46cee6a9b394aef164a27">node</a>;
<a name="l00476"></a>00476             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a37f3b57849379521514f103da2e8ffe3">need_exec</a>==0 &amp;&amp; <a class="code" href="../../d7/d49/node__composite__tree_8c.html#adea242df40478941a969bf35572a3b26">node_only_value</a>(node)) {
<a name="l00477"></a>00477                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ac2ffa2c3ecc9f4553ba458d7859d5777">execfunc</a>) {
<a name="l00478"></a>00478                     <a class="code" href="../../da/d34/node__exec_8c.html#a2771e35af4dc3cc44d8e3f4f558d9f51">node_get_stack</a>(node, exec-&gt;<a class="code" href="../../d1/d98/structbNodeTreeExec.html#aa82249855ebc8968babf72de67f7be3f">stack</a>, nsin, nsout);
<a name="l00479"></a>00479                     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ac2ffa2c3ecc9f4553ba458d7859d5777">execfunc</a>(thd-&gt;<a class="code" href="../../de/d7d/structThreadData.html#a3018b7de028114a2d44a152e6705e91a">rd</a>, node, nsin, nsout);
<a name="l00480"></a>00480                 }
<a name="l00481"></a>00481             }
<a name="l00482"></a>00482         }
<a name="l00483"></a>00483     }
<a name="l00484"></a>00484     
<a name="l00485"></a>00485     <span class="keywordflow">return</span> totnode;
<a name="l00486"></a>00486 }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488 <span class="comment">/* while executing tree, free buffers from nodes that are not needed anymore */</span>
<a name="l00489"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#a19a3c221ca0b886a70dc4392e96dd48d">00489</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a19a3c221ca0b886a70dc4392e96dd48d">freeExecutableNode</a>(<a class="code" href="../../d1/d98/structbNodeTreeExec.html">bNodeTreeExec</a> *<a class="code" href="../../d4/dfa/node__composite__moviedistortion_8c.html#afe18d7947bb74ada6e3bc895141c3d76">exec</a>)
<a name="l00490"></a>00490 {
<a name="l00491"></a>00491     <span class="comment">/* node outputs can be freed when:</span>
<a name="l00492"></a>00492 <span class="comment">    - not a render result or image node</span>
<a name="l00493"></a>00493 <span class="comment">    - when node outputs go to nodes all being set NODE_FINISHED</span>
<a name="l00494"></a>00494 <span class="comment">    */</span>
<a name="l00495"></a>00495     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree = exec-&gt;<a class="code" href="../../d1/d98/structbNodeTreeExec.html#aac3432769f2301db0e68571264020788">nodetree</a>;
<a name="l00496"></a>00496     <a class="code" href="../../d5/dd4/structbNodeExec.html">bNodeExec</a> *nodeexec;
<a name="l00497"></a>00497     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00498"></a>00498     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00499"></a>00499     <span class="keywordtype">int</span> n;
<a name="l00500"></a>00500     
<a name="l00501"></a>00501     <span class="comment">/* set exec flag for finished nodes that might need freed */</span>
<a name="l00502"></a>00502     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00503"></a>00503         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>!=<a class="code" href="../../d4/d91/BKE__node_8h.html#ad757ff9a25034f9e939a65aaea8d1cce">CMP_NODE_R_LAYERS</a>)
<a name="l00504"></a>00504             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa630997609916544ff15aaa45a2f639e">exec</a> &amp; <a class="code" href="../../d4/d91/BKE__node_8h.html#a924afbd8067dedd900012d1bed183956">NODE_FINISHED</a>)
<a name="l00505"></a>00505                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa630997609916544ff15aaa45a2f639e">exec</a> |= <a class="code" href="../../d4/d91/BKE__node_8h.html#a658cf0af65cd447edb18cd02fec1c2b6">NODE_FREEBUFS</a>;
<a name="l00506"></a>00506     }
<a name="l00507"></a>00507     <span class="comment">/* clear this flag for input links that are not done yet.</span>
<a name="l00508"></a>00508 <span class="comment">     * Using the exec data for valid dependency sort.</span>
<a name="l00509"></a>00509 <span class="comment">     */</span>
<a name="l00510"></a>00510     <span class="keywordflow">for</span> (n=0, nodeexec=exec-&gt;<a class="code" href="../../d1/d98/structbNodeTreeExec.html#a7b9b4217e53aad7e62362c47ae0f4555">nodeexec</a>; n &lt; exec-&gt;totnodes; ++n, ++nodeexec) {
<a name="l00511"></a>00511         node = nodeexec-&gt;<a class="code" href="../../d5/dd4/structbNodeExec.html#af7f644bf83b46cee6a9b394aef164a27">node</a>;
<a name="l00512"></a>00512         <span class="keywordflow">if</span> ((node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa630997609916544ff15aaa45a2f639e">exec</a> &amp; <a class="code" href="../../d4/d91/BKE__node_8h.html#a924afbd8067dedd900012d1bed183956">NODE_FINISHED</a>)==0) {
<a name="l00513"></a>00513             <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00514"></a>00514                 <span class="keywordflow">if</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>)
<a name="l00515"></a>00515                     sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa630997609916544ff15aaa45a2f639e">exec</a> &amp;= ~<a class="code" href="../../d4/d91/BKE__node_8h.html#a658cf0af65cd447edb18cd02fec1c2b6">NODE_FREEBUFS</a>;
<a name="l00516"></a>00516         }
<a name="l00517"></a>00517     }
<a name="l00518"></a>00518     <span class="comment">/* now we can free buffers */</span>
<a name="l00519"></a>00519     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00520"></a>00520         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa630997609916544ff15aaa45a2f639e">exec</a> &amp; <a class="code" href="../../d4/d91/BKE__node_8h.html#a658cf0af65cd447edb18cd02fec1c2b6">NODE_FREEBUFS</a>) {
<a name="l00521"></a>00521             <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00522"></a>00522                 <a class="code" href="../../de/d8a/structbNodeStack.html">bNodeStack</a> *ns= <a class="code" href="../../da/d34/node__exec_8c.html#af558d65f09672f835208c35f3f9b733d">node_get_socket_stack</a>(exec-&gt;<a class="code" href="../../d1/d98/structbNodeTreeExec.html#aa82249855ebc8968babf72de67f7be3f">stack</a>, sock);
<a name="l00523"></a>00523                 <span class="keywordflow">if</span> (ns &amp;&amp; ns-&gt;<a class="code" href="../../de/d8a/structbNodeStack.html#a7df6710a4f38c0bf036156c5a6d4fe46">data</a>) {
<a name="l00524"></a>00524                     <a class="code" href="../../d1/d38/node__composite__util_8c.html#ac4ff3c9d76cd76ddf861c93b6234cadc">free_compbuf</a>(ns-&gt;<a class="code" href="../../de/d8a/structbNodeStack.html#a7df6710a4f38c0bf036156c5a6d4fe46">data</a>);
<a name="l00525"></a>00525                     ns-&gt;<a class="code" href="../../de/d8a/structbNodeStack.html#a7df6710a4f38c0bf036156c5a6d4fe46">data</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00526"></a>00526                     <span class="comment">// printf(&quot;freed buf node %s\n&quot;, node-&gt;name);</span>
<a name="l00527"></a>00527                 }
<a name="l00528"></a>00528             }
<a name="l00529"></a>00529         }
<a name="l00530"></a>00530     }
<a name="l00531"></a>00531 }
<a name="l00532"></a>00532 
<a name="l00533"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#ad5d8a02aa15855463573807953d127b7">00533</a> <span class="keyword">static</span> <a class="code" href="../../d5/dd4/structbNodeExec.html">bNodeExec</a> *<a class="code" href="../../d7/d49/node__composite__tree_8c.html#ad5d8a02aa15855463573807953d127b7">getExecutableNode</a>(<a class="code" href="../../d1/d98/structbNodeTreeExec.html">bNodeTreeExec</a> *<a class="code" href="../../d4/dfa/node__composite__moviedistortion_8c.html#afe18d7947bb74ada6e3bc895141c3d76">exec</a>)
<a name="l00534"></a>00534 {
<a name="l00535"></a>00535     <a class="code" href="../../d5/dd4/structbNodeExec.html">bNodeExec</a> *nodeexec;
<a name="l00536"></a>00536     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00537"></a>00537     <span class="keywordtype">int</span> n;
<a name="l00538"></a>00538     
<a name="l00539"></a>00539     <span class="keywordflow">for</span> (n=0, nodeexec=exec-&gt;<a class="code" href="../../d1/d98/structbNodeTreeExec.html#a7b9b4217e53aad7e62362c47ae0f4555">nodeexec</a>; n &lt; exec-&gt;totnodes; ++n, ++nodeexec) {
<a name="l00540"></a>00540         <span class="keywordflow">if</span> (nodeexec-&gt;<a class="code" href="../../d5/dd4/structbNodeExec.html#af7f644bf83b46cee6a9b394aef164a27">node</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa630997609916544ff15aaa45a2f639e">exec</a>==0) {
<a name="l00541"></a>00541             <span class="comment">/* input sockets should be ready */</span>
<a name="l00542"></a>00542             <span class="keywordflow">for</span> (sock= nodeexec-&gt;<a class="code" href="../../d5/dd4/structbNodeExec.html#af7f644bf83b46cee6a9b394aef164a27">node</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00543"></a>00543                 <span class="keywordflow">if</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a> &amp;&amp; sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>)
<a name="l00544"></a>00544                     <span class="keywordflow">if</span> ((sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa630997609916544ff15aaa45a2f639e">exec</a> &amp; <a class="code" href="../../d4/d91/BKE__node_8h.html#a9f3f410a234bbf2553c3615bbc97a511">NODE_READY</a>)==0)
<a name="l00545"></a>00545                         <span class="keywordflow">break</span>;
<a name="l00546"></a>00546             }
<a name="l00547"></a>00547             <span class="keywordflow">if</span> (sock==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00548"></a>00548                 <span class="keywordflow">return</span> nodeexec;
<a name="l00549"></a>00549         }
<a name="l00550"></a>00550     }
<a name="l00551"></a>00551     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00552"></a>00552 }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 <span class="comment">/* check if texture nodes need exec or end */</span>
<a name="l00555"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#a5f41a7dd537f7cbb739f08e26817d504">00555</a> <span class="keyword">static</span>  <span class="keywordtype">void</span> <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a5f41a7dd537f7cbb739f08e26817d504">ntree_composite_texnode</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <span class="keywordtype">int</span> <a class="code" href="../../dd/db3/node__composite__movieclip_8c.html#a9e3042c67b9ca0db42c98423ee8f4da9">init</a>)
<a name="l00556"></a>00556 {
<a name="l00557"></a>00557     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00558"></a>00558     
<a name="l00559"></a>00559     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00560"></a>00560         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#ab628da234e4f5a8fb317936680926bfe">CMP_NODE_TEXTURE</a> &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>) {
<a name="l00561"></a>00561             <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex= (<a class="code" href="../../df/d2d/structTex.html">Tex</a> *)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>;
<a name="l00562"></a>00562             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a> &amp;&amp; tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a68462151f8b18293c51d8928f2d3af9c">use_nodes</a>) {
<a name="l00563"></a>00563                 <span class="comment">/* has internal flag to detect it only does it once */</span>
<a name="l00564"></a>00564                 <span class="keywordflow">if</span> (init) {
<a name="l00565"></a>00565                     <span class="keywordflow">if</span> (!tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae9db87987b712dfeae144221d0e225d4">execdata</a>)
<a name="l00566"></a>00566                         tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae9db87987b712dfeae144221d0e225d4">execdata</a> = <a class="code" href="../../d4/d91/BKE__node_8h.html#a9e14a324036d8f90c3f9f09cf35c56f0">ntreeTexBeginExecTree</a>(tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>, 1); 
<a name="l00567"></a>00567                 }
<a name="l00568"></a>00568                 <span class="keywordflow">else</span>
<a name="l00569"></a>00569                     <a class="code" href="../../d4/d91/BKE__node_8h.html#a724a94a118bf6c8c74e2e06464652211">ntreeTexEndExecTree</a>(tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae9db87987b712dfeae144221d0e225d4">execdata</a>, 1);
<a name="l00570"></a>00570                     tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae9db87987b712dfeae144221d0e225d4">execdata</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00571"></a>00571             }
<a name="l00572"></a>00572         }
<a name="l00573"></a>00573     }
<a name="l00574"></a>00574 
<a name="l00575"></a>00575 }
<a name="l00576"></a>00576 
<a name="l00577"></a>00577 <span class="comment">/* optimized tree execute test for compositing */</span>
<a name="l00578"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#af1f675f9fb69f71799d7b0a1ac1b9ce7">00578</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a7a9f8c512b1d325d4c3b06486591d362">ntreeCompositExecTree</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../d3/d27/structRenderData.html">RenderData</a> *rd, <span class="keywordtype">int</span> do_preview)
<a name="l00579"></a>00579 {
<a name="l00580"></a>00580     <a class="code" href="../../d5/dd4/structbNodeExec.html">bNodeExec</a> *nodeexec;
<a name="l00581"></a>00581     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00582"></a>00582     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> <a class="code" href="../../d2/dcd/pipeline_8c.html#a4f987a98d3e1221916748962e45399fe">threads</a>;
<a name="l00583"></a>00583     <a class="code" href="../../de/d7d/structThreadData.html">ThreadData</a> thdata;
<a name="l00584"></a>00584     <span class="keywordtype">int</span> totnode, curnode, rendering= 1, n;
<a name="l00585"></a>00585     <a class="code" href="../../d1/d98/structbNodeTreeExec.html">bNodeTreeExec</a> *<a class="code" href="../../d4/dfa/node__composite__moviedistortion_8c.html#afe18d7947bb74ada6e3bc895141c3d76">exec</a>;
<a name="l00586"></a>00586 
<a name="l00587"></a>00587     <span class="keywordflow">if</span> (ntree==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00588"></a>00588 
<a name="l00589"></a>00589     exec = ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae9db87987b712dfeae144221d0e225d4">execdata</a>;
<a name="l00590"></a>00590 
<a name="l00591"></a>00591     <span class="keywordflow">if</span> (do_preview)
<a name="l00592"></a>00592         <a class="code" href="../../d4/d91/BKE__node_8h.html#ad4c3524fcab7c01db938bac27bad9112">ntreeInitPreview</a>(ntree, 0, 0);
<a name="l00593"></a>00593     
<a name="l00594"></a>00594     <span class="keywordflow">if</span> (!ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae9db87987b712dfeae144221d0e225d4">execdata</a>) {
<a name="l00595"></a>00595         <span class="comment">/* XXX this is the top-level tree, so we use the ntree-&gt;execdata pointer. */</span>
<a name="l00596"></a>00596         exec = <a class="code" href="../../d4/d91/BKE__node_8h.html#a27e2e974f13a10824149cbd2c6b6da13">ntreeCompositBeginExecTree</a>(ntree, 1);
<a name="l00597"></a>00597     }
<a name="l00598"></a>00598     <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a5f41a7dd537f7cbb739f08e26817d504">ntree_composite_texnode</a>(ntree, 1);
<a name="l00599"></a>00599     
<a name="l00600"></a>00600     <span class="comment">/* prevent unlucky accidents */</span>
<a name="l00601"></a>00601     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.background)
<a name="l00602"></a>00602         rd-&gt;<a class="code" href="../../d3/d27/structRenderData.html#ad853a19c13a6c728a07b82fbb9f52bc6">scemode</a> &amp;= ~<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ab5bdb0c37555f39a0a0621ad0d8b5f78">R_COMP_CROP</a>;
<a name="l00603"></a>00603     
<a name="l00604"></a>00604     <span class="comment">/* setup callerdata for thread callback */</span>
<a name="l00605"></a>00605     thdata.<a class="code" href="../../de/d7d/structThreadData.html#a3018b7de028114a2d44a152e6705e91a">rd</a>= rd;
<a name="l00606"></a>00606     thdata.<a class="code" href="../../de/d7d/structThreadData.html#a9e4026cc8abd11a1025878b5ce8f7b22">stack</a>= exec-&gt;<a class="code" href="../../d1/d98/structbNodeTreeExec.html#aa82249855ebc8968babf72de67f7be3f">stack</a>;
<a name="l00607"></a>00607     
<a name="l00608"></a>00608     <span class="comment">/* fixed seed, for example noise texture */</span>
<a name="l00609"></a>00609     <a class="code" href="../../d3/d88/BLI__rand_8h.html#a7ad661de51648e981c003a4d5694911b">BLI_srandom</a>(rd-&gt;<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a>);
<a name="l00610"></a>00610 
<a name="l00611"></a>00611     <span class="comment">/* sets need_exec tags in nodes */</span>
<a name="l00612"></a>00612     curnode = totnode= <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a02b82313b257a16a9b7d1d27789c8403">setExecutableNodes</a>(exec, &amp;thdata);
<a name="l00613"></a>00613 
<a name="l00614"></a>00614     <a class="code" href="../../df/dbb/BLI__threads_8h.html#a71fe304cbc8934d7dce95d5ad1eefa46">BLI_init_threads</a>(&amp;threads, <a class="code" href="../../d7/d49/node__composite__tree_8c.html#ac5408c29241f78831081bc26044e59c7">exec_composite_node</a>, rd-&gt;<a class="code" href="../../d3/d27/structRenderData.html#a9edbf2d157a2d3765e97eba62f07ff68">threads</a>);
<a name="l00615"></a>00615     
<a name="l00616"></a>00616     <span class="keywordflow">while</span> (rendering) {
<a name="l00617"></a>00617         
<a name="l00618"></a>00618         <span class="keywordflow">if</span> (<a class="code" href="../../df/dbb/BLI__threads_8h.html#ac312c055ca9694fa8c9840e23a194e0d">BLI_available_threads</a>(&amp;threads)) {
<a name="l00619"></a>00619             nodeexec= <a class="code" href="../../d7/d49/node__composite__tree_8c.html#ad5d8a02aa15855463573807953d127b7">getExecutableNode</a>(exec);
<a name="l00620"></a>00620             <span class="keywordflow">if</span> (nodeexec) {
<a name="l00621"></a>00621                 node = nodeexec-&gt;<a class="code" href="../../d5/dd4/structbNodeExec.html#af7f644bf83b46cee6a9b394aef164a27">node</a>;
<a name="l00622"></a>00622                 <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac9e0ac3502eccbd86f1b149c9a7669ea">progress</a> &amp;&amp; totnode)
<a name="l00623"></a>00623                     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac9e0ac3502eccbd86f1b149c9a7669ea">progress</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a1a4d80f84e8990a31327c231cf3c4b9d">prh</a>, (1.0f - curnode/(<span class="keywordtype">float</span>)totnode));
<a name="l00624"></a>00624                 <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a47606240b472cca3dcc8c3e5df76ed6b">stats_draw</a>) {
<a name="l00625"></a>00625                     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[128];
<a name="l00626"></a>00626                     <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(str, <span class="keyword">sizeof</span>(str), <span class="stringliteral">&quot;Compositing %d %s&quot;</span>, curnode, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a5d65cbe1159d2c591a3ba7815817b0c4">name</a>);
<a name="l00627"></a>00627                     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a47606240b472cca3dcc8c3e5df76ed6b">stats_draw</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ab3d45911784e71d09002cd77c4ee4309">sdh</a>, str);
<a name="l00628"></a>00628                 }
<a name="l00629"></a>00629                 curnode--;
<a name="l00630"></a>00630                 
<a name="l00631"></a>00631                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aca309d9958b17c283c63239f8c9beb6a">threaddata</a> = &amp;thdata;
<a name="l00632"></a>00632                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa630997609916544ff15aaa45a2f639e">exec</a>= <a class="code" href="../../d4/d91/BKE__node_8h.html#a1a940378fbde2e45c63d893758dbd64a">NODE_PROCESSING</a>;
<a name="l00633"></a>00633                 <a class="code" href="../../df/dbb/BLI__threads_8h.html#a19e3908192f418ed7d20f9060b92e39a">BLI_insert_thread</a>(&amp;threads, nodeexec);
<a name="l00634"></a>00634             }
<a name="l00635"></a>00635             <span class="keywordflow">else</span>
<a name="l00636"></a>00636                 <a class="code" href="../../df/d73/time_8c.html#a43667128024aa660ab9adfbd5df9e88a">PIL_sleep_ms</a>(50);
<a name="l00637"></a>00637         }
<a name="l00638"></a>00638         <span class="keywordflow">else</span>
<a name="l00639"></a>00639             <a class="code" href="../../df/d73/time_8c.html#a43667128024aa660ab9adfbd5df9e88a">PIL_sleep_ms</a>(50);
<a name="l00640"></a>00640         
<a name="l00641"></a>00641         rendering= 0;
<a name="l00642"></a>00642         <span class="comment">/* test for ESC */</span>
<a name="l00643"></a>00643         <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a33028b0ff737c58f606715b49a8bae35">test_break</a> &amp;&amp; ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a33028b0ff737c58f606715b49a8bae35">test_break</a>(ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#aecbba0ec059f553dbb1530e11424c4b3">tbh</a>)) {
<a name="l00644"></a>00644             <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l00645"></a>00645                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa630997609916544ff15aaa45a2f639e">exec</a> |= <a class="code" href="../../d4/d91/BKE__node_8h.html#a9f3f410a234bbf2553c3615bbc97a511">NODE_READY</a>;
<a name="l00646"></a>00646         }
<a name="l00647"></a>00647         
<a name="l00648"></a>00648         <span class="comment">/* check for ready ones, and if we need to continue */</span>
<a name="l00649"></a>00649         <span class="keywordflow">for</span> (n=0, nodeexec=exec-&gt;<a class="code" href="../../d1/d98/structbNodeTreeExec.html#a7b9b4217e53aad7e62362c47ae0f4555">nodeexec</a>; n &lt; exec-&gt;totnodes; ++n, ++nodeexec) {
<a name="l00650"></a>00650             node = nodeexec-&gt;<a class="code" href="../../d5/dd4/structbNodeExec.html#af7f644bf83b46cee6a9b394aef164a27">node</a>;
<a name="l00651"></a>00651             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa630997609916544ff15aaa45a2f639e">exec</a> &amp; <a class="code" href="../../d4/d91/BKE__node_8h.html#a9f3f410a234bbf2553c3615bbc97a511">NODE_READY</a>) {
<a name="l00652"></a>00652                 <span class="keywordflow">if</span> ((node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa630997609916544ff15aaa45a2f639e">exec</a> &amp; <a class="code" href="../../d4/d91/BKE__node_8h.html#a924afbd8067dedd900012d1bed183956">NODE_FINISHED</a>)==0) {
<a name="l00653"></a>00653                     <a class="code" href="../../df/dbb/BLI__threads_8h.html#a57c9620d2ff85886135cf98a6f3b3be1">BLI_remove_thread</a>(&amp;threads, nodeexec); <span class="comment">/* this waits for running thread to finish btw */</span>
<a name="l00654"></a>00654                     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#aa630997609916544ff15aaa45a2f639e">exec</a> |= <a class="code" href="../../d4/d91/BKE__node_8h.html#a924afbd8067dedd900012d1bed183956">NODE_FINISHED</a>;
<a name="l00655"></a>00655                     
<a name="l00656"></a>00656                     <span class="comment">/* freeing unused buffers */</span>
<a name="l00657"></a>00657                     <span class="keywordflow">if</span> (rd-&gt;<a class="code" href="../../d3/d27/structRenderData.html#ad853a19c13a6c728a07b82fbb9f52bc6">scemode</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ac629385c14620f833d064c647d4b1430">R_COMP_FREE</a>)
<a name="l00658"></a>00658                         <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a19a3c221ca0b886a70dc4392e96dd48d">freeExecutableNode</a>(exec);
<a name="l00659"></a>00659                 }
<a name="l00660"></a>00660             }
<a name="l00661"></a>00661             <span class="keywordflow">else</span> rendering= 1;
<a name="l00662"></a>00662         }
<a name="l00663"></a>00663     }
<a name="l00664"></a>00664     
<a name="l00665"></a>00665     <a class="code" href="../../df/dbb/BLI__threads_8h.html#a74091ba5aec8c4deaaed5aa32d0545b2">BLI_end_threads</a>(&amp;threads);
<a name="l00666"></a>00666     
<a name="l00667"></a>00667     <span class="comment">/* XXX top-level tree uses the ntree-&gt;execdata pointer */</span>
<a name="l00668"></a>00668     <a class="code" href="../../d4/d91/BKE__node_8h.html#af898c8382fa74b9785f6489117c36aa4">ntreeCompositEndExecTree</a>(exec, 1);
<a name="l00669"></a>00669 }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671 <span class="comment">/* *********************************************** */</span>
<a name="l00672"></a>00672 
<a name="l00673"></a>00673 <span class="comment">/* clumsy checking... should do dynamic outputs once */</span>
<a name="l00674"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#a306a85f21bf0ec6e3b2b164742f0b73d">00674</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a306a85f21bf0ec6e3b2b164742f0b73d">force_hidden_passes</a>(<a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <span class="keywordtype">int</span> passflag)
<a name="l00675"></a>00675 {
<a name="l00676"></a>00676     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00677"></a>00677     
<a name="l00678"></a>00678     <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l00679"></a>00679         sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00680"></a>00680     
<a name="l00681"></a>00681     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a4e038919a7298d42281bcef6eef0840d">SCE_PASS_COMBINED</a>)) {
<a name="l00682"></a>00682         sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a57083dc4f4c1a6edf247fb97742ce810">RRES_OUT_IMAGE</a>);
<a name="l00683"></a>00683         sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00684"></a>00684         sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a0636a4c7180123b7bd67155b4b5c09c7">RRES_OUT_ALPHA</a>);
<a name="l00685"></a>00685         sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00686"></a>00686     }
<a name="l00687"></a>00687     
<a name="l00688"></a>00688     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#acced542b4ae864a7eacbdf67c46d5a17">RRES_OUT_Z</a>);
<a name="l00689"></a>00689     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a1ae908c61cd1d871b33f30bc2b16c13c">SCE_PASS_Z</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00690"></a>00690     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a236dfb2ae184a56fe287d456471c409e">RRES_OUT_NORMAL</a>);
<a name="l00691"></a>00691     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a53ae1d458dab251ffdcc0ccd5312f603">SCE_PASS_NORMAL</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00692"></a>00692     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#aca29650e8c6687a77bacdc8719ceb09c">RRES_OUT_VEC</a>);
<a name="l00693"></a>00693     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ad9100234bef25bcc5128c00fc612f7ca">SCE_PASS_VECTOR</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00694"></a>00694     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a0fc47f41d5453def943494e2eb172a8d">RRES_OUT_UV</a>);
<a name="l00695"></a>00695     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a30942c1bab1c6e65fdb77b5e226353fc">SCE_PASS_UV</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00696"></a>00696     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#afdb96d4b217022030a1fc653f67e8d46">RRES_OUT_RGBA</a>);
<a name="l00697"></a>00697     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a4b1485f58943e899a42e74b89f33a982">SCE_PASS_RGBA</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00698"></a>00698     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#aad99f912e37ecc83f1531a5908574736">RRES_OUT_DIFF</a>);
<a name="l00699"></a>00699     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a88d3ba13dfd64dda48ec35ad3ba928ab">SCE_PASS_DIFFUSE</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00700"></a>00700     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a744c90aa056fbe33bb10516d5a4cf0b6">RRES_OUT_SPEC</a>);
<a name="l00701"></a>00701     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a02bf21100b24bc0a3d33e0215c6f41d1">SCE_PASS_SPEC</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00702"></a>00702     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#ae25d3055d8fc3ba7cad7adc8a0742a72">RRES_OUT_SHADOW</a>);
<a name="l00703"></a>00703     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#abd6b74153f40d08f810295d1e39eaaa2">SCE_PASS_SHADOW</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00704"></a>00704     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#aeb556214300c55066459572bfd3a0954">RRES_OUT_AO</a>);
<a name="l00705"></a>00705     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a24ace58d0d0d66e045061e0591d7a7c5">SCE_PASS_AO</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00706"></a>00706     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a71e58f0507c93d6dcb6ccbeacf51b317">RRES_OUT_REFLECT</a>);
<a name="l00707"></a>00707     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a4e9639bb6059fca6eb49c9f99065734e">SCE_PASS_REFLECT</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00708"></a>00708     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a3250949ee9e6f0b29b82dc8fb9693b5c">RRES_OUT_REFRACT</a>);
<a name="l00709"></a>00709     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a818d29498d5d603de4a1ec601a4b416f">SCE_PASS_REFRACT</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00710"></a>00710     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a93ad9928581f0e2fc0c00c755056e9df">RRES_OUT_INDIRECT</a>);
<a name="l00711"></a>00711     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3815d3ce741d6756606c70d40a1e2475">SCE_PASS_INDIRECT</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00712"></a>00712     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a5191767a5ff9d01dc9a8ce89b62ab4cf">RRES_OUT_INDEXOB</a>);
<a name="l00713"></a>00713     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a9135312fc6b18fd54613c576c80a4f53">SCE_PASS_INDEXOB</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00714"></a>00714     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#aac15a66b30d78894af3b4e3db416c3b4">RRES_OUT_INDEXMA</a>);
<a name="l00715"></a>00715     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a73753b42780aaf1e360cbc70b23d7dea">SCE_PASS_INDEXMA</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00716"></a>00716     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a906ef4883f7b48ef31a7258e12aea0f2">RRES_OUT_MIST</a>);
<a name="l00717"></a>00717     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a5261e0edfcf5ddc55c459ac175ae55c6">SCE_PASS_MIST</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00718"></a>00718     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#ac46ec205965ec58a975cde6a5a1a6253">RRES_OUT_EMIT</a>);
<a name="l00719"></a>00719     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#aa36483eb50364ade6b32ad7f845be7cf">SCE_PASS_EMIT</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00720"></a>00720     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#af339da7b896b9333dab962122c8d382b">RRES_OUT_ENV</a>);
<a name="l00721"></a>00721     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a1f15c7c41dbf511dd638d5025fd295da">SCE_PASS_ENVIRONMENT</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00722"></a>00722 
<a name="l00723"></a>00723     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a0dc5e45acb53e5e9a80117fe7c455ab6">RRES_OUT_DIFF_DIRECT</a>);
<a name="l00724"></a>00724     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a7c9422f79ea514312fc4d774ab5543cf">SCE_PASS_DIFFUSE_DIRECT</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00725"></a>00725     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a64ba2ab7e6efc75e5e71ed51b444d5a4">RRES_OUT_DIFF_INDIRECT</a>);
<a name="l00726"></a>00726     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ae4226a3968c8040762ece1cd837792ac">SCE_PASS_DIFFUSE_INDIRECT</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00727"></a>00727     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#ac8da5a8504b6cc92337e8a8a42748c37">RRES_OUT_DIFF_COLOR</a>);
<a name="l00728"></a>00728     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a447bf7a1fedfdb74db1b29f1720a5e4d">SCE_PASS_DIFFUSE_COLOR</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00729"></a>00729 
<a name="l00730"></a>00730     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a6e2e738b5eef941ed4b40792b257ddaa">RRES_OUT_GLOSSY_DIRECT</a>);
<a name="l00731"></a>00731     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ac56c3e4f0b329be3ddaa14f51bdd67ee">SCE_PASS_GLOSSY_DIRECT</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00732"></a>00732     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a317b02f8c34612e6d419121b1a6cab03">RRES_OUT_GLOSSY_INDIRECT</a>);
<a name="l00733"></a>00733     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8e10a90d786341e6bf7fb7724e8cc945">SCE_PASS_GLOSSY_INDIRECT</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00734"></a>00734     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a79b1544c72cfd9701a88253cd1596f9b">RRES_OUT_GLOSSY_COLOR</a>);
<a name="l00735"></a>00735     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a354c7166b62f59d4da5ea19df72254e6">SCE_PASS_GLOSSY_COLOR</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00736"></a>00736 
<a name="l00737"></a>00737     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a7f82f8e6e6d3791fbc4f620c68f36138">RRES_OUT_TRANSM_DIRECT</a>);
<a name="l00738"></a>00738     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#af27d99cafae5a3bdfbc77464c0c3208f">SCE_PASS_TRANSM_DIRECT</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00739"></a>00739     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a9c0c8a89449f789f6c07287fcf7ade8c">RRES_OUT_TRANSM_INDIRECT</a>);
<a name="l00740"></a>00740     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a25f8c10672a30e541f0f0a85b880f5ed">SCE_PASS_TRANSM_INDIRECT</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00741"></a>00741     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a83ad792ff4790376e340445d3df8b066">RRES_OUT_TRANSM_COLOR</a>);
<a name="l00742"></a>00742     <span class="keywordflow">if</span> (!(passflag &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8a135474bc44d4ea30d812305d30846a">SCE_PASS_TRANSM_COLOR</a>)) sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa8601cb5fff3ccf4ed9e7cec1e97baf7">SOCK_UNAVAIL</a>;
<a name="l00743"></a>00743     sock= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a83ad792ff4790376e340445d3df8b066">RRES_OUT_TRANSM_COLOR</a>);
<a name="l00744"></a>00744 }
<a name="l00745"></a>00745 
<a name="l00746"></a>00746 <span class="comment">/* based on rules, force sockets hidden always */</span>
<a name="l00747"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#a59acb345bc9a03ab4445b744ab784634">00747</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#adbc74c8525b3597285bdb7e9b42fd016">ntreeCompositForceHidden</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *curscene)
<a name="l00748"></a>00748 {
<a name="l00749"></a>00749     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00750"></a>00750     
<a name="l00751"></a>00751     <span class="keywordflow">if</span> (ntree==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00752"></a>00752     
<a name="l00753"></a>00753     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00754"></a>00754         <span class="keywordflow">if</span> ( node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#ad757ff9a25034f9e939a65aaea8d1cce">CMP_NODE_R_LAYERS</a>) {
<a name="l00755"></a>00755             <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>?(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>:curscene;
<a name="l00756"></a>00756             <a class="code" href="../../d1/d51/structSceneRenderLayer.html">SceneRenderLayer</a> *srl= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a235b7b4bed2d2d73189d3e12c219672a">layers</a>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a55bc501c3ee93e75427b84f309d9b7">custom1</a>);
<a name="l00757"></a>00757             <span class="keywordflow">if</span> (srl)
<a name="l00758"></a>00758                 <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a306a85f21bf0ec6e3b2b164742f0b73d">force_hidden_passes</a>(node, srl-&gt;passflag);
<a name="l00759"></a>00759         }
<a name="l00760"></a>00760         <span class="comment">/* XXX this stuff is called all the time, don&#39;t want that.</span>
<a name="l00761"></a>00761 <span class="comment">         * Updates should only happen when actually necessary.</span>
<a name="l00762"></a>00762 <span class="comment">         */</span>
<a name="l00763"></a>00763 <span class="preprocessor">        #if 0</span>
<a name="l00764"></a>00764 <span class="preprocessor"></span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a3b39f18a88ab67e0d7065d992f6ea1b0">CMP_NODE_IMAGE</a>) {
<a name="l00765"></a>00765             <a class="code" href="../../d4/d91/BKE__node_8h.html#a5899bdebefd986150eaa5bfc95641c5b">nodeUpdate</a>(ntree, node);
<a name="l00766"></a>00766         }
<a name="l00767"></a>00767 <span class="preprocessor">        #endif</span>
<a name="l00768"></a>00768 <span class="preprocessor"></span>    }
<a name="l00769"></a>00769 
<a name="l00770"></a>00770 }
<a name="l00771"></a>00771 
<a name="l00772"></a>00772 <span class="comment">/* called from render pipeline, to tag render input and output */</span>
<a name="l00773"></a>00773 <span class="comment">/* need to do all scenes, to prevent errors when you re-render 1 scene */</span>
<a name="l00774"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#a0e0e251cc77342ac1526ec4f51133b0b">00774</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#ab1865501b049a261fc9ac4ce5e9e9e80">ntreeCompositTagRender</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *curscene)
<a name="l00775"></a>00775 {
<a name="l00776"></a>00776     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l00777"></a>00777     
<a name="l00778"></a>00778     <span class="keywordflow">for</span> (sce= <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;scene.first; sce; sce= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l00779"></a>00779         <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>) {
<a name="l00780"></a>00780             <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00781"></a>00781             
<a name="l00782"></a>00782             <span class="keywordflow">for</span> (node= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00783"></a>00783                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>==(<a class="code" href="../../d8/d7e/structID.html">ID</a> *)curscene || node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#afebb3fe5e904f63ef36f0dce271da9ed">CMP_NODE_COMPOSITE</a>)
<a name="l00784"></a>00784                     <a class="code" href="../../d4/d91/BKE__node_8h.html#a5899bdebefd986150eaa5bfc95641c5b">nodeUpdate</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>, node);
<a name="l00785"></a>00785                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#ab628da234e4f5a8fb317936680926bfe">CMP_NODE_TEXTURE</a>) <span class="comment">/* uses scene sizex/sizey */</span>
<a name="l00786"></a>00786                     <a class="code" href="../../d4/d91/BKE__node_8h.html#a5899bdebefd986150eaa5bfc95641c5b">nodeUpdate</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>, node);
<a name="l00787"></a>00787             }
<a name="l00788"></a>00788         }
<a name="l00789"></a>00789     }
<a name="l00790"></a>00790 }
<a name="l00791"></a>00791 
<a name="l00792"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#a4c5afbd9f59ecc32e232026eb9cf7c04">00792</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a4c5afbd9f59ecc32e232026eb9cf7c04">node_animation_properties</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00793"></a>00793 {
<a name="l00794"></a>00794     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00795"></a>00795     <span class="keyword">const</span> <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb;
<a name="l00796"></a>00796     <a class="code" href="../../df/d0c/structLink.html">Link</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l00797"></a>00797     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> ptr;
<a name="l00798"></a>00798     <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *prop;
<a name="l00799"></a>00799     
<a name="l00800"></a>00800     <span class="comment">/* check to see if any of the node&#39;s properties have fcurves */</span>
<a name="l00801"></a>00801     <a class="code" href="../../d3/d10/rna__access_8c.html#a1f8fb80da9a6450a51ab2e9b97264f01">RNA_pointer_create</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ntree, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#a0b393a65055e74d24d805993ba618d79">RNA_Node</a>, node, &amp;ptr);
<a name="l00802"></a>00802     lb = <a class="code" href="../../d3/d10/rna__access_8c.html#a550698abd6760c36ea4f2a1b9d2eec30">RNA_struct_type_properties</a>(ptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a41f868aea62068fbbfa36c1a5dbe30f9">type</a>);
<a name="l00803"></a>00803     
<a name="l00804"></a>00804     <span class="keywordflow">for</span> (link=lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link=link-&gt;<a class="code" href="../../df/d0c/structLink.html#a4c0511c20c869c43fda58d1eeeed7e73">next</a>) {
<a name="l00805"></a>00805         <span class="keywordtype">int</span> driven, <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>=1, index;
<a name="l00806"></a>00806         prop = (<a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *)link;
<a name="l00807"></a>00807         
<a name="l00808"></a>00808         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a2b969ea1007e1516895f65336025e529">RNA_property_array_check</a>(prop))
<a name="l00809"></a>00809             len = <a class="code" href="../../d3/d10/rna__access_8c.html#aad51db9a31d245dba4ee1f50608f331c">RNA_property_array_length</a>(&amp;ptr, prop);
<a name="l00810"></a>00810         
<a name="l00811"></a>00811         <span class="keywordflow">for</span> (index=0; index&lt;<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>; index++) {
<a name="l00812"></a>00812             <span class="keywordflow">if</span> (<a class="code" href="../../da/dba/BKE__fcurve_8h.html#af9576b956927514758a9a308ce2e0e81">rna_get_fcurve</a>(&amp;ptr, prop, index, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;driven)) {
<a name="l00813"></a>00813                 <a class="code" href="../../d4/d91/BKE__node_8h.html#a5899bdebefd986150eaa5bfc95641c5b">nodeUpdate</a>(ntree, node);
<a name="l00814"></a>00814                 <span class="keywordflow">return</span> 1;
<a name="l00815"></a>00815             }
<a name="l00816"></a>00816         }
<a name="l00817"></a>00817     }
<a name="l00818"></a>00818     
<a name="l00819"></a>00819     <span class="comment">/* now check node sockets */</span>
<a name="l00820"></a>00820     <span class="keywordflow">for</span> (sock = node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l00821"></a>00821         <span class="keywordtype">int</span> driven, <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>=1, index;
<a name="l00822"></a>00822         
<a name="l00823"></a>00823         <a class="code" href="../../d3/d10/rna__access_8c.html#a1f8fb80da9a6450a51ab2e9b97264f01">RNA_pointer_create</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ntree, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#a8021e472995d9172eb0407af053cf50e">RNA_NodeSocket</a>, sock, &amp;ptr);
<a name="l00824"></a>00824         prop = <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(&amp;ptr, <span class="stringliteral">&quot;default_value&quot;</span>);
<a name="l00825"></a>00825         <span class="keywordflow">if</span> (prop) {
<a name="l00826"></a>00826             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a2b969ea1007e1516895f65336025e529">RNA_property_array_check</a>(prop))
<a name="l00827"></a>00827                 len = <a class="code" href="../../d3/d10/rna__access_8c.html#aad51db9a31d245dba4ee1f50608f331c">RNA_property_array_length</a>(&amp;ptr, prop);
<a name="l00828"></a>00828             
<a name="l00829"></a>00829             <span class="keywordflow">for</span> (index=0; index&lt;<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>; index++) {
<a name="l00830"></a>00830                 <span class="keywordflow">if</span> (<a class="code" href="../../da/dba/BKE__fcurve_8h.html#af9576b956927514758a9a308ce2e0e81">rna_get_fcurve</a>(&amp;ptr, prop, index, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;driven)) {
<a name="l00831"></a>00831                     <a class="code" href="../../d4/d91/BKE__node_8h.html#a5899bdebefd986150eaa5bfc95641c5b">nodeUpdate</a>(ntree, node);
<a name="l00832"></a>00832                     <span class="keywordflow">return</span> 1;
<a name="l00833"></a>00833                 }
<a name="l00834"></a>00834             }
<a name="l00835"></a>00835         }
<a name="l00836"></a>00836     }
<a name="l00837"></a>00837 
<a name="l00838"></a>00838     <span class="keywordflow">return</span> 0;
<a name="l00839"></a>00839 }
<a name="l00840"></a>00840 
<a name="l00841"></a>00841 <span class="comment">/* tags nodes that have animation capabilities */</span>
<a name="l00842"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#ab581dcccdb72218d67f9adff11d8aaad">00842</a> <span class="keywordtype">int</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#adb0283118cf57b71b767e17fc1f5a29f">ntreeCompositTagAnimated</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00843"></a>00843 {
<a name="l00844"></a>00844     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00845"></a>00845     <span class="keywordtype">int</span> tagged= 0;
<a name="l00846"></a>00846     
<a name="l00847"></a>00847     <span class="keywordflow">if</span> (ntree==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> 0;
<a name="l00848"></a>00848     
<a name="l00849"></a>00849     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00850"></a>00850         
<a name="l00851"></a>00851         tagged = <a class="code" href="../../d7/d49/node__composite__tree_8c.html#a4c5afbd9f59ecc32e232026eb9cf7c04">node_animation_properties</a>(ntree, node);
<a name="l00852"></a>00852         
<a name="l00853"></a>00853         <span class="comment">/* otherwise always tag these node types */</span>
<a name="l00854"></a>00854         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a3b39f18a88ab67e0d7065d992f6ea1b0">CMP_NODE_IMAGE</a>) {
<a name="l00855"></a>00855             <a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *ima= (<a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>;
<a name="l00856"></a>00856             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (ima &amp;&amp; <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a868d306431889e6c2998ca2184fbe18e">source</a>, <a class="code" href="../../d2/d77/BKE__image_8h.html#ad15772d6b95027902c77c6374ceac47b">IMA_SRC_MOVIE</a>, <a class="code" href="../../d2/d77/BKE__image_8h.html#aeff8879cd961f2dff8c4f31ed55409c4">IMA_SRC_SEQUENCE</a>)) {
<a name="l00857"></a>00857                 <a class="code" href="../../d4/d91/BKE__node_8h.html#a5899bdebefd986150eaa5bfc95641c5b">nodeUpdate</a>(ntree, node);
<a name="l00858"></a>00858                 tagged= 1;
<a name="l00859"></a>00859             }
<a name="l00860"></a>00860         }
<a name="l00861"></a>00861         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a938bbac603bea1f1790cfe6ec45ce121">CMP_NODE_TIME</a>) {
<a name="l00862"></a>00862             <a class="code" href="../../d4/d91/BKE__node_8h.html#a5899bdebefd986150eaa5bfc95641c5b">nodeUpdate</a>(ntree, node);
<a name="l00863"></a>00863             tagged= 1;
<a name="l00864"></a>00864         }
<a name="l00865"></a>00865         <span class="comment">/* here was tag render layer, but this is called after a render, so re-composites fail */</span>
<a name="l00866"></a>00866         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#ab9f16ff5fded11f644b983a041c97edd">NODE_GROUP</a>) {
<a name="l00867"></a>00867             <span class="keywordflow">if</span> ( <a class="code" href="../../d4/d91/BKE__node_8h.html#adb0283118cf57b71b767e17fc1f5a29f">ntreeCompositTagAnimated</a>((<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>) ) {
<a name="l00868"></a>00868                 <a class="code" href="../../d4/d91/BKE__node_8h.html#a5899bdebefd986150eaa5bfc95641c5b">nodeUpdate</a>(ntree, node);
<a name="l00869"></a>00869             }
<a name="l00870"></a>00870         }
<a name="l00871"></a>00871         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a7c1ef39c4f464f1da0e05f5b3f846c85">CMP_NODE_MOVIECLIP</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a247872c7de28040f8aa9e22ee67b9a1d">CMP_NODE_TRANSFORM</a>)) {
<a name="l00872"></a>00872             <a class="code" href="../../d4/d91/BKE__node_8h.html#a5899bdebefd986150eaa5bfc95641c5b">nodeUpdate</a>(ntree, node);
<a name="l00873"></a>00873             tagged= 1;
<a name="l00874"></a>00874         }
<a name="l00875"></a>00875     }
<a name="l00876"></a>00876     
<a name="l00877"></a>00877     <span class="keywordflow">return</span> tagged;
<a name="l00878"></a>00878 }
<a name="l00879"></a>00879 
<a name="l00880"></a>00880 
<a name="l00881"></a>00881 <span class="comment">/* called from image window preview */</span>
<a name="l00882"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#a55efbad81012816ba03ea261906654f2">00882</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#aa695a45061199ff77a6b287fd50f2ee2">ntreeCompositTagGenerators</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00883"></a>00883 {
<a name="l00884"></a>00884     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00885"></a>00885     
<a name="l00886"></a>00886     <span class="keywordflow">if</span> (ntree==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00887"></a>00887     
<a name="l00888"></a>00888     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00889"></a>00889         <span class="keywordflow">if</span> ( <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#ad757ff9a25034f9e939a65aaea8d1cce">CMP_NODE_R_LAYERS</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a3b39f18a88ab67e0d7065d992f6ea1b0">CMP_NODE_IMAGE</a>))
<a name="l00890"></a>00890             <a class="code" href="../../d4/d91/BKE__node_8h.html#a5899bdebefd986150eaa5bfc95641c5b">nodeUpdate</a>(ntree, node);
<a name="l00891"></a>00891     }
<a name="l00892"></a>00892 }
<a name="l00893"></a>00893 
<a name="l00894"></a>00894 <span class="comment">/* XXX after render animation system gets a refresh, this call allows composite to end clean */</span>
<a name="l00895"></a><a class="code" href="../../d7/d49/node__composite__tree_8c.html#acf6f8a5478258b855f349391f847a220">00895</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a85ab5fde0bd7a48b80a459c93f41c3d5">ntreeCompositClearTags</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00896"></a>00896 {
<a name="l00897"></a>00897     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00898"></a>00898     
<a name="l00899"></a>00899     <span class="keywordflow">if</span> (ntree==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00900"></a>00900     
<a name="l00901"></a>00901     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00902"></a>00902         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a37f3b57849379521514f103da2e8ffe3">need_exec</a>= 0;
<a name="l00903"></a>00903         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#ab9f16ff5fded11f644b983a041c97edd">NODE_GROUP</a>)
<a name="l00904"></a>00904             <a class="code" href="../../d4/d91/BKE__node_8h.html#a85ab5fde0bd7a48b80a459c93f41c3d5">ntreeCompositClearTags</a>((<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>);
<a name="l00905"></a>00905     }
<a name="l00906"></a>00906 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:35 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: editcurve.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">editcurve.c</div>  </div>
</div>
<div class="contents">
<a href="../../d7/d55/editcurve_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): none yet.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#ifndef WIN32</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#else</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#include &lt;io.h&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#endif</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d41/DNA__key__types_8h.html">DNA_key_types.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html">DNA_anim_types.h</a>&quot;</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc9/BLI__dynstr_8h.html" title="A dynamically sized string ADT.">BLI_dynstr.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d88/BLI__rand_8h.html" title="Random number functions.">BLI_rand.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc5/BLI__ghash_8h.html" title="A general (pointer -&gt; pointer) hash table ADT.">BLI_ghash.h</a>&quot;</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dfc/BKE__curve_8h.html">BKE_curve.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html">BKE_depsgraph.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dba/BKE__fcurve_8h.html">BKE_fcurve.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d17/BKE__key_8h.html">BKE_key.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/db1/BKE__library_8h.html">BKE_library.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d40/BKE__report_8h.html">BKE_report.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d51/BKE__animsys_8h.html">BKE_animsys.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/df5/BKE__action_8h.html" title="Blender kernel action and pose functionality.">BKE_action.h</a>&quot;</span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html">ED_keyframes_edit.h</a>&quot;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7a/ED__object_8h.html">ED_object.h</a>&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d12/ED__screen_8h.html">ED_screen.h</a>&quot;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/df2/ED__transform_8h.html">ED_transform.h</a>&quot;</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d7d/ED__types_8h.html">ED_types.h</a>&quot;</span>
<a name="l00077"></a>00077 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/df1/ED__util_8h.html">ED_util.h</a>&quot;</span>
<a name="l00078"></a>00078 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d6a/ED__view3d_8h.html">ED_view3d.h</a>&quot;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d71/ED__curve_8h.html">ED_curve.h</a>&quot;</span>
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d11/curve__intern_8h.html">curve_intern.h</a>&quot;</span>
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d1e/UI__interface_8h.html">UI_interface.h</a>&quot;</span>
<a name="l00084"></a>00084 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d96/UI__resources_8h.html">UI_resources.h</a>&quot;</span>
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00087"></a>00087 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d68/RNA__define_8h.html">RNA_define.h</a>&quot;</span>
<a name="l00088"></a>00088 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d68/RNA__enum__types_8h.html">RNA_enum_types.h</a>&quot;</span>
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="comment">/* Undo stuff */</span>
<a name="l00091"></a><a class="code" href="../../df/d53/structUndoCurve.html">00091</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00092"></a><a class="code" href="../../df/d53/structUndoCurve.html#ae2e141f6cc7929f98592304e05942f1b">00092</a>     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> <a class="code" href="../../df/d53/structUndoCurve.html#ae2e141f6cc7929f98592304e05942f1b">nubase</a>;
<a name="l00093"></a><a class="code" href="../../df/d53/structUndoCurve.html#a000900bd8758af2441096824e84e73be">00093</a>     <span class="keywordtype">void</span> *<a class="code" href="../../df/d53/structUndoCurve.html#a000900bd8758af2441096824e84e73be">lastsel</a>;
<a name="l00094"></a><a class="code" href="../../df/d53/structUndoCurve.html#ab5741b258e7ffb727823794f800d3d3d">00094</a>     <a class="code" href="../../df/da0/structGHash.html">GHash</a> *<a class="code" href="../../df/d53/structUndoCurve.html#ab5741b258e7ffb727823794f800d3d3d">undoIndex</a>;
<a name="l00095"></a><a class="code" href="../../df/d53/structUndoCurve.html#ae1257736ae262c1daefce6163f4dd7cc">00095</a>     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> <a class="code" href="../../df/d53/structUndoCurve.html#ae1257736ae262c1daefce6163f4dd7cc">fcurves</a>, drivers;
<a name="l00096"></a><a class="code" href="../../df/d53/structUndoCurve.html#a799fb68d9b85661386a589b2fa91140b">00096</a>     <span class="keywordtype">int</span> <a class="code" href="../../df/d53/structUndoCurve.html#a799fb68d9b85661386a589b2fa91140b">actnu</a>;
<a name="l00097"></a>00097 } <a class="code" href="../../df/d53/structUndoCurve.html">UndoCurve</a>;
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 <span class="comment">/* Definitions needed for shape keys */</span>
<a name="l00100"></a><a class="code" href="../../d7/db4/structCVKeyIndex.html">00100</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00101"></a><a class="code" href="../../d7/db4/structCVKeyIndex.html#a94543b0cfbab1d99debddf743f586f4f">00101</a>     <span class="keywordtype">void</span> *<a class="code" href="../../d7/db4/structCVKeyIndex.html#a94543b0cfbab1d99debddf743f586f4f">orig_cv</a>;
<a name="l00102"></a><a class="code" href="../../d7/db4/structCVKeyIndex.html#a9b470245e6a0f28ecc96512ceae8bdad">00102</a>     <span class="keywordtype">int</span> key_index, nu_index, <a class="code" href="../../d7/db4/structCVKeyIndex.html#a9b470245e6a0f28ecc96512ceae8bdad">pt_index</a>;
<a name="l00103"></a><a class="code" href="../../d7/db4/structCVKeyIndex.html#a437794a3b50641a6718ea1b1c7819df3">00103</a>     <span class="keywordtype">int</span> <a class="code" href="../../d7/db4/structCVKeyIndex.html#a437794a3b50641a6718ea1b1c7819df3">switched</a>;
<a name="l00104"></a><a class="code" href="../../d7/db4/structCVKeyIndex.html#a006732c69188d5854eb77f7ad3c37df6">00104</a>     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d7/db4/structCVKeyIndex.html#a006732c69188d5854eb77f7ad3c37df6">orig_nu</a>;
<a name="l00105"></a>00105 } <a class="code" href="../../d7/db4/structCVKeyIndex.html">CVKeyIndex</a>;
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ab54563da04b3aa1a08bb81b8f4cdd530">selectend_nurb</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *obedit, <span class="keywordtype">short</span> selfirst, <span class="keywordtype">short</span> doswap, <span class="keywordtype">short</span> selstatus);
<a name="l00108"></a>00108 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ac6fd9d82f74ba59d9463cff6c4c0f657">select_adjacent_cp</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb, <span class="keywordtype">short</span> <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>, <span class="keywordtype">short</span> cont, <span class="keywordtype">short</span> selstatus);
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 <span class="comment">/* still need to eradicate a few :( */</span>
<a name="l00111"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a444b040d2e5c83849d98d1d2043025c9">00111</a> <span class="preprocessor">#define callocstructN(x,y,name) (x*)MEM_callocN((y)* sizeof(x),name)</span>
<a name="l00112"></a>00112 <span class="preprocessor"></span>
<a name="l00113"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a5c5be76591ef8a4025c7db4a77f32a02">00113</a> <span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a5c5be76591ef8a4025c7db4a77f32a02">nurbcircle</a>[8][2]= {
<a name="l00114"></a>00114     {0.0, -1.0}, {-1.0, -1.0}, {-1.0, 0.0}, {-1.0,  1.0},
<a name="l00115"></a>00115     {0.0,  1.0}, { 1.0,  1.0}, { 1.0, 0.0}, { 1.0, -1.0}
<a name="l00116"></a>00116 };
<a name="l00117"></a>00117 
<a name="l00118"></a><a class="code" href="../../db/d71/ED__curve_8h.html#a84a58efbca091770506217068984e47c">00118</a> <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *<a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l00119"></a>00119 {
<a name="l00120"></a>00120     <span class="keywordflow">if</span> (ob &amp;&amp; <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>)) {
<a name="l00121"></a>00121         <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00122"></a>00122         <span class="keywordflow">return</span> &amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>;
<a name="l00123"></a>00123     }
<a name="l00124"></a>00124     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 <span class="comment">/* this replaces the active flag used in uv/face mode */</span>
<a name="l00128"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a5898792f9c07dc5a831d3051859cefc5">00128</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a5898792f9c07dc5a831d3051859cefc5">set_actNurb</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *obedit, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l00129"></a>00129 {
<a name="l00130"></a>00130     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00131"></a>00131     
<a name="l00132"></a>00132     <span class="keywordflow">if</span> (nu==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00133"></a>00133         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5fc2001ce6a5bcf7d4f102f15d9edb2f">actnu</a> = -1;
<a name="l00134"></a>00134     <span class="keywordflow">else</span> {
<a name="l00135"></a>00135         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nurbs= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a444d55e9e251234b0c8e22da36a06819">curve_editnurbs</a>(cu);
<a name="l00136"></a>00136         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5fc2001ce6a5bcf7d4f102f15d9edb2f">actnu</a> = <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a0a004822554284f0bb32fdc70cfeee1f">BLI_findindex</a>(nurbs, nu);
<a name="l00137"></a>00137     }
<a name="l00138"></a>00138 }
<a name="l00139"></a>00139 
<a name="l00140"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a47ba25464ce99c5415167967550b78de">00140</a> <span class="keyword">static</span> <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d7/d55/editcurve_8c.html#a47ba25464ce99c5415167967550b78de">get_actNurb</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *obedit)
<a name="l00141"></a>00141 {
<a name="l00142"></a>00142     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00143"></a>00143     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nurbs= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a444d55e9e251234b0c8e22da36a06819">curve_editnurbs</a>(cu);
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     <span class="keywordflow">return</span> <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(nurbs, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5fc2001ce6a5bcf7d4f102f15d9edb2f">actnu</a>);
<a name="l00146"></a>00146 }
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 <span class="comment">/* ******************* SELECTION FUNCTIONS ********************* */</span>
<a name="l00149"></a>00149 
<a name="l00150"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">00150</a> <span class="preprocessor">#define HIDDEN          1</span>
<a name="l00151"></a><a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">00151</a> <span class="preprocessor"></span><span class="preprocessor">#define VISIBLE         0</span>
<a name="l00152"></a>00152 <span class="preprocessor"></span>
<a name="l00153"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a492c6ccf2bde2bebcd32e73e0933ee92">00153</a> <span class="preprocessor">#define FIRST           1</span>
<a name="l00154"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a210af1d04c8870416a556f0e9a5194fd">00154</a> <span class="preprocessor"></span><span class="preprocessor">#define LAST            0</span>
<a name="l00155"></a>00155 <span class="preprocessor"></span>
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 <span class="comment">/* returns 1 in case (de)selection was successful */</span>
<a name="l00158"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">00158</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">select_beztriple</a>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt, <span class="keywordtype">short</span> selstatus, <span class="keywordtype">short</span> flag, <span class="keywordtype">short</span> hidden)
<a name="l00159"></a>00159 {   
<a name="l00160"></a>00160     <span class="keywordflow">if</span> (bezt) {
<a name="l00161"></a>00161         <span class="keywordflow">if</span> ((bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aaac89168848f34909c578acb0d6cca26">hide</a>==0) || (hidden==1)) {
<a name="l00162"></a>00162             <span class="keywordflow">if</span> (selstatus==1) { <span class="comment">/* selects */</span>           
<a name="l00163"></a>00163                 bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> |= flag;
<a name="l00164"></a>00164                 bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> |= flag;
<a name="l00165"></a>00165                 bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> |= flag;
<a name="l00166"></a>00166                 <span class="keywordflow">return</span> 1;           
<a name="l00167"></a>00167             }
<a name="l00168"></a>00168             <span class="keywordflow">else</span> { <span class="comment">/* deselects */</span>  
<a name="l00169"></a>00169                 bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> &amp;= ~flag; 
<a name="l00170"></a>00170                 bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp;= ~flag; 
<a name="l00171"></a>00171                 bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> &amp;= ~flag; 
<a name="l00172"></a>00172                 <span class="keywordflow">return</span> 1;
<a name="l00173"></a>00173             }
<a name="l00174"></a>00174         }
<a name="l00175"></a>00175     }
<a name="l00176"></a>00176     
<a name="l00177"></a>00177     <span class="keywordflow">return</span> 0;
<a name="l00178"></a>00178 }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 <span class="comment">/* returns 1 in case (de)selection was successful */</span>
<a name="l00181"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">00181</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp, <span class="keywordtype">short</span> selstatus, <span class="keywordtype">short</span> flag, <span class="keywordtype">short</span> hidden) 
<a name="l00182"></a>00182 {   
<a name="l00183"></a>00183     <span class="keywordflow">if</span> (bp) {
<a name="l00184"></a>00184         <span class="keywordflow">if</span> ((bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a>==0) || (hidden==1)) {
<a name="l00185"></a>00185             <span class="keywordflow">if</span> (selstatus==1) {
<a name="l00186"></a>00186                 bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> |= flag;
<a name="l00187"></a>00187                 <span class="keywordflow">return</span> 1;
<a name="l00188"></a>00188             }
<a name="l00189"></a>00189             <span class="keywordflow">else</span> {
<a name="l00190"></a>00190                 bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp;= ~flag;
<a name="l00191"></a>00191                 <span class="keywordflow">return</span> 1;
<a name="l00192"></a>00192             }
<a name="l00193"></a>00193         }
<a name="l00194"></a>00194     }
<a name="l00195"></a>00195 
<a name="l00196"></a>00196     <span class="keywordflow">return</span> 0;
<a name="l00197"></a>00197 }
<a name="l00198"></a>00198 
<a name="l00199"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a2264aead9457aff517da41b8b18390c0">00199</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a2264aead9457aff517da41b8b18390c0">swap_selection_beztriple</a>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt)
<a name="l00200"></a>00200 {
<a name="l00201"></a>00201     <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)
<a name="l00202"></a>00202         <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">select_beztriple</a>(bezt, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>);
<a name="l00203"></a>00203     <span class="keywordflow">else</span>
<a name="l00204"></a>00204         <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">select_beztriple</a>(bezt, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>);
<a name="l00205"></a>00205 }
<a name="l00206"></a>00206 
<a name="l00207"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a3c8fa8c7bdb6cb09f926165a1e815622">00207</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a3c8fa8c7bdb6cb09f926165a1e815622">swap_selection_bpoint</a>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp)
<a name="l00208"></a>00208 {
<a name="l00209"></a>00209     <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)
<a name="l00210"></a>00210         <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>);
<a name="l00211"></a>00211     <span class="keywordflow">else</span>
<a name="l00212"></a>00212         <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>);
<a name="l00213"></a>00213 }
<a name="l00214"></a>00214 
<a name="l00215"></a><a class="code" href="../../db/d71/ED__curve_8h.html#a630d70e56ff325da07d17299198d5edf">00215</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a04a97e645bf45a68ecbbfb7a123e9cac">isNurbsel</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l00216"></a>00216 {
<a name="l00217"></a>00217     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l00218"></a>00218     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l00219"></a>00219     <span class="keywordtype">int</span> a;
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l00222"></a>00222         bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l00223"></a>00223         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00224"></a>00224         <span class="keywordflow">while</span> (a--) {
<a name="l00225"></a>00225             <span class="keywordflow">if</span> ( (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) || (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) || (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) ) <span class="keywordflow">return</span> 1;
<a name="l00226"></a>00226             bezt++;
<a name="l00227"></a>00227         }
<a name="l00228"></a>00228     }
<a name="l00229"></a>00229     <span class="keywordflow">else</span> {
<a name="l00230"></a>00230         bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l00231"></a>00231         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l00232"></a>00232         <span class="keywordflow">while</span> (a--) {
<a name="l00233"></a>00233             <span class="keywordflow">if</span> ( (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) ) <span class="keywordflow">return</span> 1;
<a name="l00234"></a>00234             bp++;
<a name="l00235"></a>00235         }
<a name="l00236"></a>00236     }
<a name="l00237"></a>00237     <span class="keywordflow">return</span> 0;
<a name="l00238"></a>00238 }
<a name="l00239"></a>00239 
<a name="l00240"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a564f44c061399358cc0ccd22f13d011a">00240</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a564f44c061399358cc0ccd22f13d011a">isNurbsel_count</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l00241"></a>00241 {
<a name="l00242"></a>00242     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l00243"></a>00243     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l00244"></a>00244     <span class="keywordtype">int</span> a, sel=0;
<a name="l00245"></a>00245 
<a name="l00246"></a>00246     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l00247"></a>00247         bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l00248"></a>00248         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00249"></a>00249         <span class="keywordflow">while</span> (a--) {
<a name="l00250"></a>00250             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abcf63d093f344e298763ce019f0a1cb1">BEZSELECTED_HIDDENHANDLES</a>(cu, bezt)) sel++;
<a name="l00251"></a>00251             bezt++;
<a name="l00252"></a>00252         }
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254     <span class="keywordflow">else</span> {
<a name="l00255"></a>00255         bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l00256"></a>00256         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l00257"></a>00257         <span class="keywordflow">while</span> (a--) {
<a name="l00258"></a>00258             <span class="keywordflow">if</span> ( (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) ) sel++;
<a name="l00259"></a>00259             bp++;
<a name="l00260"></a>00260         }
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262     <span class="keywordflow">return</span> sel;
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 
<a name="l00265"></a>00265 <span class="comment">/* ******************* PRINTS ********************* */</span>
<a name="l00266"></a>00266 
<a name="l00267"></a><a class="code" href="../../db/d71/ED__curve_8h.html#a5d5e82ec9293761598e912d294fd640f">00267</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a7e3c690574b2eb6f24f22e28db9c6a78">printknots</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *obedit)
<a name="l00268"></a>00268 {
<a name="l00269"></a>00269     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l00270"></a>00270     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l00271"></a>00271     <span class="keywordtype">int</span> a, num;
<a name="l00272"></a>00272 
<a name="l00273"></a>00273     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l00274"></a>00274         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a04a97e645bf45a68ecbbfb7a123e9cac">isNurbsel</a>(nu) &amp;&amp;  nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l00275"></a>00275             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>) {
<a name="l00276"></a>00276                 num= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a229d5ec44247fb38940870726ade9077">KNOTSU</a>(nu);
<a name="l00277"></a>00277                 <span class="keywordflow">for</span> (a=0;a&lt;num;a++) printf(<span class="stringliteral">&quot;knotu %d: %f\n&quot;</span>, a, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>[a]);
<a name="l00278"></a>00278             }
<a name="l00279"></a>00279             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>) {
<a name="l00280"></a>00280                 num= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67f5d26ce1431098dc2c1d4282d8d7b0">KNOTSV</a>(nu);
<a name="l00281"></a>00281                 <span class="keywordflow">for</span> (a=0;a&lt;num;a++) printf(<span class="stringliteral">&quot;knotv %d: %f\n&quot;</span>, a, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>[a]);
<a name="l00282"></a>00282             }
<a name="l00283"></a>00283         }
<a name="l00284"></a>00284     }
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 <span class="comment">/* ********************* Shape keys *************** */</span>
<a name="l00288"></a>00288 
<a name="l00289"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a2810a4ba986c85bb3f4e9b8198a64741">00289</a> <span class="keyword">static</span> <a class="code" href="../../d7/db4/structCVKeyIndex.html">CVKeyIndex</a> *<a class="code" href="../../d7/d55/editcurve_8c.html#a2810a4ba986c85bb3f4e9b8198a64741">init_cvKeyIndex</a>(<span class="keywordtype">void</span> *cv, <span class="keywordtype">int</span> key_index, <span class="keywordtype">int</span> nu_index, <span class="keywordtype">int</span> pt_index, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *orig_nu)
<a name="l00290"></a>00290 {
<a name="l00291"></a>00291     <a class="code" href="../../d7/db4/structCVKeyIndex.html">CVKeyIndex</a> *cvIndex = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d7/db4/structCVKeyIndex.html">CVKeyIndex</a>), <span class="stringliteral">&quot;init_cvKeyIndex&quot;</span>);
<a name="l00292"></a>00292 
<a name="l00293"></a>00293     cvIndex-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a94543b0cfbab1d99debddf743f586f4f">orig_cv</a>= cv;
<a name="l00294"></a>00294     cvIndex-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a189b400c2e0da061343379dfee32f102">key_index</a>= key_index;
<a name="l00295"></a>00295     cvIndex-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#ae34daf5f2426f6f2074d7e67559fc40f">nu_index</a>= nu_index;
<a name="l00296"></a>00296     cvIndex-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a9b470245e6a0f28ecc96512ceae8bdad">pt_index</a>= pt_index;
<a name="l00297"></a>00297     cvIndex-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a437794a3b50641a6718ea1b1c7819df3">switched</a>= 0;
<a name="l00298"></a>00298     cvIndex-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a006732c69188d5854eb77f7ad3c37df6">orig_nu</a>= orig_nu;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="keywordflow">return</span> cvIndex;
<a name="l00301"></a>00301 }
<a name="l00302"></a>00302 
<a name="l00303"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ad3ab1aae6e4620a2c4932f9f798d4b5f">00303</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ad3ab1aae6e4620a2c4932f9f798d4b5f">init_editNurb_keyIndex</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *origBase)
<a name="l00304"></a>00304 {
<a name="l00305"></a>00305     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu= editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00306"></a>00306     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *orignu= origBase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00307"></a>00307     <a class="code" href="../../df/da0/structGHash.html">GHash</a> *gh;
<a name="l00308"></a>00308     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt, *origbezt;
<a name="l00309"></a>00309     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp, *origbp;
<a name="l00310"></a>00310     <a class="code" href="../../d7/db4/structCVKeyIndex.html">CVKeyIndex</a> *keyIndex;
<a name="l00311"></a>00311     <span class="keywordtype">int</span> a, key_index= 0, nu_index= 0, pt_index= 0;
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     <span class="keywordflow">if</span> (editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>) <span class="keywordflow">return</span>;
<a name="l00314"></a>00314 
<a name="l00315"></a>00315     gh= <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#af2fb34af7b99547b33a34380451a963d">BLI_ghash_new</a>(<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a371913beecfb01de3d0a8d5f0bb598d4">BLI_ghashutil_ptrhash</a>, <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a51865a4bfcfc2502e01a9369bfb72877">BLI_ghashutil_ptrcmp</a>, <span class="stringliteral">&quot;editNurb keyIndex&quot;</span>);
<a name="l00316"></a>00316 
<a name="l00317"></a>00317     <span class="keywordflow">while</span> (orignu) {
<a name="l00318"></a>00318         <span class="keywordflow">if</span> (orignu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l00319"></a>00319             a= orignu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00320"></a>00320             bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l00321"></a>00321             origbezt= orignu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l00322"></a>00322             pt_index= 0;
<a name="l00323"></a>00323             <span class="keywordflow">while</span> (a--) {
<a name="l00324"></a>00324                 keyIndex= <a class="code" href="../../d7/d55/editcurve_8c.html#a2810a4ba986c85bb3f4e9b8198a64741">init_cvKeyIndex</a>(origbezt, key_index, nu_index, pt_index, orignu);
<a name="l00325"></a>00325                 <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ad72f3a6d9b88bc494c6a279d1b7b9165">BLI_ghash_insert</a>(gh, bezt, keyIndex);
<a name="l00326"></a>00326                 key_index+= 12;
<a name="l00327"></a>00327                 bezt++;
<a name="l00328"></a>00328                 origbezt++;
<a name="l00329"></a>00329                 pt_index++;
<a name="l00330"></a>00330             }
<a name="l00331"></a>00331         }
<a name="l00332"></a>00332         <span class="keywordflow">else</span> {
<a name="l00333"></a>00333             a= orignu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> * orignu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l00334"></a>00334             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l00335"></a>00335             origbp= orignu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l00336"></a>00336             pt_index= 0;
<a name="l00337"></a>00337             <span class="keywordflow">while</span> (a--) {
<a name="l00338"></a>00338                 keyIndex= <a class="code" href="../../d7/d55/editcurve_8c.html#a2810a4ba986c85bb3f4e9b8198a64741">init_cvKeyIndex</a>(origbp, key_index, nu_index, pt_index, orignu);
<a name="l00339"></a>00339                 <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ad72f3a6d9b88bc494c6a279d1b7b9165">BLI_ghash_insert</a>(gh, bp, keyIndex);
<a name="l00340"></a>00340                 key_index+= 4;
<a name="l00341"></a>00341                 bp++;
<a name="l00342"></a>00342                 origbp++;
<a name="l00343"></a>00343                 pt_index++;
<a name="l00344"></a>00344             }
<a name="l00345"></a>00345         }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347         nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l00348"></a>00348         orignu= orignu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l00349"></a>00349         nu_index++;
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351 
<a name="l00352"></a>00352     editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>= gh;
<a name="l00353"></a>00353 }
<a name="l00354"></a>00354 
<a name="l00355"></a><a class="code" href="../../d7/d55/editcurve_8c.html#af9fd49e7bfac2be36a4e7efad54f2845">00355</a> <span class="keyword">static</span> <a class="code" href="../../d7/db4/structCVKeyIndex.html">CVKeyIndex</a> *<a class="code" href="../../d7/d55/editcurve_8c.html#af9fd49e7bfac2be36a4e7efad54f2845">getCVKeyIndex</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb, <span class="keywordtype">void</span> *cv)
<a name="l00356"></a>00356 {
<a name="l00357"></a>00357     <span class="keywordflow">return</span> <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ac3bdece51152c2b9d4deff6771958b69">BLI_ghash_lookup</a>(editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>, cv);
<a name="l00358"></a>00358 }
<a name="l00359"></a>00359 
<a name="l00360"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a11e8113ecfe4c4c3508636f1badd1b14">00360</a> <span class="keyword">static</span> <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *<a class="code" href="../../d7/d55/editcurve_8c.html#a11e8113ecfe4c4c3508636f1badd1b14">getKeyIndexOrig_bezt</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt)
<a name="l00361"></a>00361 {
<a name="l00362"></a>00362     <a class="code" href="../../d7/db4/structCVKeyIndex.html">CVKeyIndex</a> *index= <a class="code" href="../../d7/d55/editcurve_8c.html#af9fd49e7bfac2be36a4e7efad54f2845">getCVKeyIndex</a>(editnurb, bezt);
<a name="l00363"></a>00363 
<a name="l00364"></a>00364     <span class="keywordflow">if</span> (!index) {
<a name="l00365"></a>00365         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00366"></a>00366     }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     <span class="keywordflow">return</span> (<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>*)index-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a94543b0cfbab1d99debddf743f586f4f">orig_cv</a>;
<a name="l00369"></a>00369 }
<a name="l00370"></a>00370 
<a name="l00371"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a132fb8b7ec3120d23f967022176f6fc7">00371</a> <span class="keyword">static</span> <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *<a class="code" href="../../d7/d55/editcurve_8c.html#a132fb8b7ec3120d23f967022176f6fc7">getKeyIndexOrig_bp</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb, <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp)
<a name="l00372"></a>00372 {
<a name="l00373"></a>00373     <a class="code" href="../../d7/db4/structCVKeyIndex.html">CVKeyIndex</a> *index= <a class="code" href="../../d7/d55/editcurve_8c.html#af9fd49e7bfac2be36a4e7efad54f2845">getCVKeyIndex</a>(editnurb, bp);
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     <span class="keywordflow">if</span> (!index) {
<a name="l00376"></a>00376         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00377"></a>00377     }
<a name="l00378"></a>00378 
<a name="l00379"></a>00379     <span class="keywordflow">return</span> (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*)index-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a94543b0cfbab1d99debddf743f586f4f">orig_cv</a>;
<a name="l00380"></a>00380 }
<a name="l00381"></a>00381 
<a name="l00382"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a9191115ce74a289d87ae111f59b11f1e">00382</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a9191115ce74a289d87ae111f59b11f1e">getKeyIndexOrig_keyIndex</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb, <span class="keywordtype">void</span> *cv)
<a name="l00383"></a>00383 {
<a name="l00384"></a>00384     <a class="code" href="../../d7/db4/structCVKeyIndex.html">CVKeyIndex</a> *index= <a class="code" href="../../d7/d55/editcurve_8c.html#af9fd49e7bfac2be36a4e7efad54f2845">getCVKeyIndex</a>(editnurb, cv);
<a name="l00385"></a>00385 
<a name="l00386"></a>00386     <span class="keywordflow">if</span> (!index) {
<a name="l00387"></a>00387         <span class="keywordflow">return</span> -1;
<a name="l00388"></a>00388     }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390     <span class="keywordflow">return</span> index-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a189b400c2e0da061343379dfee32f102">key_index</a>;
<a name="l00391"></a>00391 }
<a name="l00392"></a>00392 
<a name="l00393"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a4b855ef71eb2a6bc445c748ee88ea4b9">00393</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a4b855ef71eb2a6bc445c748ee88ea4b9">keyIndex_delCV</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb, <span class="keywordtype">void</span> *cv)
<a name="l00394"></a>00394 {
<a name="l00395"></a>00395     <span class="keywordflow">if</span> (!editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>) {
<a name="l00396"></a>00396         <span class="keywordflow">return</span>;
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398 
<a name="l00399"></a>00399     <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a8cc41d37f19a6005218c9c061e819d42">BLI_ghash_remove</a>(editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>, cv, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, (<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a53210a0b5c7bd4568f50f16dd85f04a6">GHashValFreeFP</a>)<a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>);
<a name="l00400"></a>00400 }
<a name="l00401"></a>00401 
<a name="l00402"></a><a class="code" href="../../d7/d55/editcurve_8c.html#af827430e63b199c1eef39c94c42acbf6">00402</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#af827430e63b199c1eef39c94c42acbf6">keyIndex_delBezt</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt)
<a name="l00403"></a>00403 {
<a name="l00404"></a>00404     <a class="code" href="../../d7/d55/editcurve_8c.html#a4b855ef71eb2a6bc445c748ee88ea4b9">keyIndex_delCV</a>(editnurb, bezt);
<a name="l00405"></a>00405 }
<a name="l00406"></a>00406 
<a name="l00407"></a><a class="code" href="../../d7/d55/editcurve_8c.html#aec85603d62905f44b470b68e5d6a097e">00407</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#aec85603d62905f44b470b68e5d6a097e">keyIndex_delBP</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb, <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp)
<a name="l00408"></a>00408 {
<a name="l00409"></a>00409     <a class="code" href="../../d7/d55/editcurve_8c.html#a4b855ef71eb2a6bc445c748ee88ea4b9">keyIndex_delCV</a>(editnurb, bp);
<a name="l00410"></a>00410 }
<a name="l00411"></a>00411 
<a name="l00412"></a><a class="code" href="../../d7/d55/editcurve_8c.html#af7adf69fe907e412354b5f0ed2f7f754">00412</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#af7adf69fe907e412354b5f0ed2f7f754">keyIndex_delNurb</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l00413"></a>00413 {
<a name="l00414"></a>00414     <span class="keywordtype">int</span> a;
<a name="l00415"></a>00415 
<a name="l00416"></a>00416     <span class="keywordflow">if</span> (!editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>) {
<a name="l00417"></a>00417         <span class="keywordflow">return</span>;
<a name="l00418"></a>00418     }
<a name="l00419"></a>00419 
<a name="l00420"></a>00420     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l00421"></a>00421         <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l00422"></a>00422         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424         <span class="keywordflow">while</span> (a--) {
<a name="l00425"></a>00425             <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a8cc41d37f19a6005218c9c061e819d42">BLI_ghash_remove</a>(editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>, bezt, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, (<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a53210a0b5c7bd4568f50f16dd85f04a6">GHashValFreeFP</a>)<a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>);
<a name="l00426"></a>00426             ++bezt;
<a name="l00427"></a>00427         }
<a name="l00428"></a>00428     }
<a name="l00429"></a>00429     <span class="keywordflow">else</span> {
<a name="l00430"></a>00430         <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l00431"></a>00431         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> * nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l00432"></a>00432 
<a name="l00433"></a>00433         <span class="keywordflow">while</span> (a--) {
<a name="l00434"></a>00434             <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a8cc41d37f19a6005218c9c061e819d42">BLI_ghash_remove</a>(editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>, bp, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, (<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a53210a0b5c7bd4568f50f16dd85f04a6">GHashValFreeFP</a>)<a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>);
<a name="l00435"></a>00435             ++bp;
<a name="l00436"></a>00436         }
<a name="l00437"></a>00437     }
<a name="l00438"></a>00438 }
<a name="l00439"></a>00439 
<a name="l00440"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ab4cb02a70a93298743ac8b297d4e225d">00440</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ab4cb02a70a93298743ac8b297d4e225d">keyIndex_delNurbList</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nubase)
<a name="l00441"></a>00441 {
<a name="l00442"></a>00442     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu= nubase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00443"></a>00443 
<a name="l00444"></a>00444     <span class="keywordflow">while</span> (nu) {
<a name="l00445"></a>00445         <a class="code" href="../../d7/d55/editcurve_8c.html#af7adf69fe907e412354b5f0ed2f7f754">keyIndex_delNurb</a>(editnurb, nu);
<a name="l00446"></a>00446 
<a name="l00447"></a>00447         nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l00448"></a>00448     }
<a name="l00449"></a>00449 }
<a name="l00450"></a>00450 
<a name="l00451"></a><a class="code" href="../../d7/d55/editcurve_8c.html#aca9a13f99c67298872d6e9aaea783225">00451</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#aca9a13f99c67298872d6e9aaea783225">keyIndex_updateCV</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb, <span class="keywordtype">char</span> *cv,
<a name="l00452"></a>00452     <span class="keywordtype">char</span> *newcv, <span class="keywordtype">int</span> count, <span class="keywordtype">int</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l00453"></a>00453 {
<a name="l00454"></a>00454     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00455"></a>00455     <a class="code" href="../../d7/db4/structCVKeyIndex.html">CVKeyIndex</a> *index;
<a name="l00456"></a>00456 
<a name="l00457"></a>00457     <span class="keywordflow">if</span> (editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00458"></a>00458         <span class="comment">/* No shape keys - updating not needed */</span>
<a name="l00459"></a>00459         <span class="keywordflow">return</span>;
<a name="l00460"></a>00460     }
<a name="l00461"></a>00461 
<a name="l00462"></a>00462     <span class="keywordflow">for</span> (i = 0; i &lt; count; i++) {
<a name="l00463"></a>00463         index= <a class="code" href="../../d7/d55/editcurve_8c.html#af9fd49e7bfac2be36a4e7efad54f2845">getCVKeyIndex</a>(editnurb, cv);
<a name="l00464"></a>00464 
<a name="l00465"></a>00465         <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a8cc41d37f19a6005218c9c061e819d42">BLI_ghash_remove</a>(editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>, cv, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00466"></a>00466 
<a name="l00467"></a>00467         <span class="keywordflow">if</span> (index) {
<a name="l00468"></a>00468             <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ad72f3a6d9b88bc494c6a279d1b7b9165">BLI_ghash_insert</a>(editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>, newcv, index);
<a name="l00469"></a>00469         }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471         newcv += <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l00472"></a>00472         cv += <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l00473"></a>00473     }
<a name="l00474"></a>00474 }
<a name="l00475"></a>00475 
<a name="l00476"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a32de29ccf344b5d4d324c8eb05212925">00476</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a32de29ccf344b5d4d324c8eb05212925">keyIndex_updateBezt</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt,
<a name="l00477"></a>00477     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *newbezt, <span class="keywordtype">int</span> count)
<a name="l00478"></a>00478 {
<a name="l00479"></a>00479     <a class="code" href="../../d7/d55/editcurve_8c.html#aca9a13f99c67298872d6e9aaea783225">keyIndex_updateCV</a>(editnurb, (<span class="keywordtype">char</span>*)bezt, (<span class="keywordtype">char</span>*)newbezt, count, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>));
<a name="l00480"></a>00480 }
<a name="l00481"></a>00481 
<a name="l00482"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a0233d7e5f22fabe021f3902c3127dafc">00482</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a0233d7e5f22fabe021f3902c3127dafc">keyIndex_updateBP</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb, <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp,
<a name="l00483"></a>00483     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *newbp, <span class="keywordtype">int</span> count)
<a name="l00484"></a>00484 {
<a name="l00485"></a>00485     <a class="code" href="../../d7/d55/editcurve_8c.html#aca9a13f99c67298872d6e9aaea783225">keyIndex_updateCV</a>(editnurb, (<span class="keywordtype">char</span>*)bp, (<span class="keywordtype">char</span>*)newbp, count, <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>));
<a name="l00486"></a>00486 }
<a name="l00487"></a>00487 
<a name="l00488"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ad28c5c91c2bc52c176bd62438cace7d9">00488</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ad28c5c91c2bc52c176bd62438cace7d9">keyIndex_updateNurb</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *newnu)
<a name="l00489"></a>00489 {
<a name="l00490"></a>00490     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l00491"></a>00491         <a class="code" href="../../d7/d55/editcurve_8c.html#a32de29ccf344b5d4d324c8eb05212925">keyIndex_updateBezt</a>(editnurb, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>, newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>, newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>);
<a name="l00492"></a>00492     }
<a name="l00493"></a>00493     <span class="keywordflow">else</span> {
<a name="l00494"></a>00494         <a class="code" href="../../d7/d55/editcurve_8c.html#a0233d7e5f22fabe021f3902c3127dafc">keyIndex_updateBP</a>(editnurb, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> * newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>);
<a name="l00495"></a>00495     }
<a name="l00496"></a>00496 }
<a name="l00497"></a>00497 
<a name="l00498"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a0849c144a1c61722f4b4a3d2a60d492b">00498</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a0849c144a1c61722f4b4a3d2a60d492b">keyIndex_swap</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb, <span class="keywordtype">void</span> *a, <span class="keywordtype">void</span> *b)
<a name="l00499"></a>00499 {
<a name="l00500"></a>00500     <a class="code" href="../../d7/db4/structCVKeyIndex.html">CVKeyIndex</a> *index1= <a class="code" href="../../d7/d55/editcurve_8c.html#af9fd49e7bfac2be36a4e7efad54f2845">getCVKeyIndex</a>(editnurb, a);
<a name="l00501"></a>00501     <a class="code" href="../../d7/db4/structCVKeyIndex.html">CVKeyIndex</a> *index2= <a class="code" href="../../d7/d55/editcurve_8c.html#af9fd49e7bfac2be36a4e7efad54f2845">getCVKeyIndex</a>(editnurb, b);
<a name="l00502"></a>00502 
<a name="l00503"></a>00503     <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a8cc41d37f19a6005218c9c061e819d42">BLI_ghash_remove</a>(editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>, a, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00504"></a>00504     <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a8cc41d37f19a6005218c9c061e819d42">BLI_ghash_remove</a>(editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>, b, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00505"></a>00505 
<a name="l00506"></a>00506     <span class="keywordflow">if</span> (index2) <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ad72f3a6d9b88bc494c6a279d1b7b9165">BLI_ghash_insert</a>(editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>, a, index2);
<a name="l00507"></a>00507     <span class="keywordflow">if</span> (index1) <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ad72f3a6d9b88bc494c6a279d1b7b9165">BLI_ghash_insert</a>(editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>, b, index1);
<a name="l00508"></a>00508 }
<a name="l00509"></a>00509 
<a name="l00510"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a3496650042edc217b94d5852f1f613da">00510</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a3496650042edc217b94d5852f1f613da">keyIndex_switchDirection</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l00511"></a>00511 {
<a name="l00512"></a>00512     <span class="keywordtype">int</span> a;
<a name="l00513"></a>00513     <a class="code" href="../../d7/db4/structCVKeyIndex.html">CVKeyIndex</a> *index1, *index2;
<a name="l00514"></a>00514 
<a name="l00515"></a>00515     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l00516"></a>00516         <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt1, *bezt2;
<a name="l00517"></a>00517 
<a name="l00518"></a>00518         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00519"></a>00519 
<a name="l00520"></a>00520         bezt1= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l00521"></a>00521         bezt2= bezt1+(a-1);
<a name="l00522"></a>00522 
<a name="l00523"></a>00523         <span class="keywordflow">if</span> (a &amp; 1) ++a;
<a name="l00524"></a>00524 
<a name="l00525"></a>00525         a/=2;
<a name="l00526"></a>00526 
<a name="l00527"></a>00527         <span class="keywordflow">while</span> (a--) {
<a name="l00528"></a>00528             index1= <a class="code" href="../../d7/d55/editcurve_8c.html#af9fd49e7bfac2be36a4e7efad54f2845">getCVKeyIndex</a>(editnurb, bezt1);
<a name="l00529"></a>00529             index2= <a class="code" href="../../d7/d55/editcurve_8c.html#af9fd49e7bfac2be36a4e7efad54f2845">getCVKeyIndex</a>(editnurb, bezt2);
<a name="l00530"></a>00530 
<a name="l00531"></a>00531             <span class="keywordflow">if</span> (index1) index1-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a437794a3b50641a6718ea1b1c7819df3">switched</a>= !index1-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a437794a3b50641a6718ea1b1c7819df3">switched</a>;
<a name="l00532"></a>00532 
<a name="l00533"></a>00533             <span class="keywordflow">if</span> (bezt1 != bezt2) {
<a name="l00534"></a>00534                 <a class="code" href="../../d7/d55/editcurve_8c.html#a0849c144a1c61722f4b4a3d2a60d492b">keyIndex_swap</a>(editnurb, bezt1, bezt2);
<a name="l00535"></a>00535 
<a name="l00536"></a>00536                 <span class="keywordflow">if</span> (index2) index2-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a437794a3b50641a6718ea1b1c7819df3">switched</a>= !index2-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a437794a3b50641a6718ea1b1c7819df3">switched</a>;
<a name="l00537"></a>00537             }
<a name="l00538"></a>00538 
<a name="l00539"></a>00539             bezt1++;
<a name="l00540"></a>00540             bezt2--;
<a name="l00541"></a>00541         }
<a name="l00542"></a>00542     }
<a name="l00543"></a>00543     <span class="keywordflow">else</span> {
<a name="l00544"></a>00544         <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp1, *bp2;
<a name="l00545"></a>00545 
<a name="l00546"></a>00546         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> == 1) {
<a name="l00547"></a>00547             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00548"></a>00548             bp1= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l00549"></a>00549             bp2= bp1+(a-1);
<a name="l00550"></a>00550             a/= 2;
<a name="l00551"></a>00551             <span class="keywordflow">while</span> (bp1!=bp2 &amp;&amp; a&gt;0) {
<a name="l00552"></a>00552                 index1= <a class="code" href="../../d7/d55/editcurve_8c.html#af9fd49e7bfac2be36a4e7efad54f2845">getCVKeyIndex</a>(editnurb, bp1);
<a name="l00553"></a>00553                 index2= <a class="code" href="../../d7/d55/editcurve_8c.html#af9fd49e7bfac2be36a4e7efad54f2845">getCVKeyIndex</a>(editnurb, bp2);
<a name="l00554"></a>00554 
<a name="l00555"></a>00555                 <span class="keywordflow">if</span> (index1) index1-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a437794a3b50641a6718ea1b1c7819df3">switched</a>= !index1-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a437794a3b50641a6718ea1b1c7819df3">switched</a>;
<a name="l00556"></a>00556 
<a name="l00557"></a>00557                 <span class="keywordflow">if</span> (bp1 != bp2) {
<a name="l00558"></a>00558                     <span class="keywordflow">if</span> (index2) index2-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a437794a3b50641a6718ea1b1c7819df3">switched</a>= !index2-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a437794a3b50641a6718ea1b1c7819df3">switched</a>;
<a name="l00559"></a>00559 
<a name="l00560"></a>00560                     <a class="code" href="../../d7/d55/editcurve_8c.html#a0849c144a1c61722f4b4a3d2a60d492b">keyIndex_swap</a>(editnurb, bp1, bp2);
<a name="l00561"></a>00561                 }
<a name="l00562"></a>00562 
<a name="l00563"></a>00563                 a--;
<a name="l00564"></a>00564                 bp1++;
<a name="l00565"></a>00565                 bp2--;
<a name="l00566"></a>00566             }
<a name="l00567"></a>00567         }
<a name="l00568"></a>00568         <span class="keywordflow">else</span> {
<a name="l00569"></a>00569             <span class="keywordtype">int</span> b;
<a name="l00570"></a>00570 
<a name="l00571"></a>00571             <span class="keywordflow">for</span> (b=0; b&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; b++) {
<a name="l00572"></a>00572 
<a name="l00573"></a>00573                 bp1= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+b*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00574"></a>00574                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00575"></a>00575                 bp2= bp1+(a-1);
<a name="l00576"></a>00576                 a/= 2;
<a name="l00577"></a>00577 
<a name="l00578"></a>00578                 <span class="keywordflow">while</span> (bp1!=bp2 &amp;&amp; a&gt;0) {
<a name="l00579"></a>00579                     index1= <a class="code" href="../../d7/d55/editcurve_8c.html#af9fd49e7bfac2be36a4e7efad54f2845">getCVKeyIndex</a>(editnurb, bp1);
<a name="l00580"></a>00580                     index2= <a class="code" href="../../d7/d55/editcurve_8c.html#af9fd49e7bfac2be36a4e7efad54f2845">getCVKeyIndex</a>(editnurb, bp2);
<a name="l00581"></a>00581 
<a name="l00582"></a>00582                     <span class="keywordflow">if</span> (index1) index1-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a437794a3b50641a6718ea1b1c7819df3">switched</a>= !index1-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a437794a3b50641a6718ea1b1c7819df3">switched</a>;
<a name="l00583"></a>00583 
<a name="l00584"></a>00584                     <span class="keywordflow">if</span> (bp1 != bp2) {
<a name="l00585"></a>00585                         <span class="keywordflow">if</span> (index2) index2-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a437794a3b50641a6718ea1b1c7819df3">switched</a>= !index2-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a437794a3b50641a6718ea1b1c7819df3">switched</a>;
<a name="l00586"></a>00586 
<a name="l00587"></a>00587                         <a class="code" href="../../d7/d55/editcurve_8c.html#a0849c144a1c61722f4b4a3d2a60d492b">keyIndex_swap</a>(editnurb, bp1, bp2);
<a name="l00588"></a>00588                     }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590                     a--;
<a name="l00591"></a>00591                     bp1++;
<a name="l00592"></a>00592                     bp2--;
<a name="l00593"></a>00593                 }
<a name="l00594"></a>00594             }
<a name="l00595"></a>00595 
<a name="l00596"></a>00596         }
<a name="l00597"></a>00597     }
<a name="l00598"></a>00598 }
<a name="l00599"></a>00599 
<a name="l00600"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a95a73eb7e9605a87bc86aece47a26887">00600</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a95a73eb7e9605a87bc86aece47a26887">switch_keys_direction</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *actnu)
<a name="l00601"></a>00601 {
<a name="l00602"></a>00602     <a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a> *currkey;
<a name="l00603"></a>00603     <a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>;
<a name="l00604"></a>00604     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nubase= &amp;editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>;
<a name="l00605"></a>00605     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l00606"></a>00606     <span class="keywordtype">float</span> *fp;
<a name="l00607"></a>00607     <span class="keywordtype">int</span> a;
<a name="l00608"></a>00608 
<a name="l00609"></a>00609     currkey = cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>-&gt;<a class="code" href="../../d1/d9e/structKey.html#ab82a3a504826387b0811d68570496e2a">block</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00610"></a>00610     <span class="keywordflow">while</span> (currkey) {
<a name="l00611"></a>00611         fp= currkey-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#aec4b55f1b0c4c1e0c60a77f7ffb80401">data</a>;
<a name="l00612"></a>00612 
<a name="l00613"></a>00613         nu= nubase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00614"></a>00614         <span class="keywordflow">while</span> (nu) {
<a name="l00615"></a>00615             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l00616"></a>00616                 <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l00617"></a>00617                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00618"></a>00618                 <span class="keywordflow">if</span> (nu == actnu) {
<a name="l00619"></a>00619                     <span class="keywordflow">while</span> (a--) {
<a name="l00620"></a>00620                         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a11e8113ecfe4c4c3508636f1badd1b14">getKeyIndexOrig_bezt</a>(editnurb, bezt)) {
<a name="l00621"></a>00621                             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ac69c047f62ea208bb9f550757b21a9cb">swap_v3_v3</a>(fp, fp + 6);
<a name="l00622"></a>00622                             *(fp+9) = -*(fp+9);
<a name="l00623"></a>00623                             fp += 12;
<a name="l00624"></a>00624                         }
<a name="l00625"></a>00625                         bezt++;
<a name="l00626"></a>00626                     }
<a name="l00627"></a>00627                 }
<a name="l00628"></a>00628                 <span class="keywordflow">else</span> fp += a * 12;
<a name="l00629"></a>00629             }
<a name="l00630"></a>00630             <span class="keywordflow">else</span> {
<a name="l00631"></a>00631                 <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l00632"></a>00632                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> * nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l00633"></a>00633                 <span class="keywordflow">if</span> (nu == actnu) {
<a name="l00634"></a>00634                     <span class="keywordflow">while</span> (a--) {
<a name="l00635"></a>00635                         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a132fb8b7ec3120d23f967022176f6fc7">getKeyIndexOrig_bp</a>(editnurb, bp)) {
<a name="l00636"></a>00636                             *(fp+3) = -*(fp+3);
<a name="l00637"></a>00637                             fp += 4;
<a name="l00638"></a>00638                         }
<a name="l00639"></a>00639                         bp++;
<a name="l00640"></a>00640                     }
<a name="l00641"></a>00641                 }
<a name="l00642"></a>00642                 <span class="keywordflow">else</span> fp += a * 4;
<a name="l00643"></a>00643             }
<a name="l00644"></a>00644 
<a name="l00645"></a>00645             nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l00646"></a>00646         }
<a name="l00647"></a>00647 
<a name="l00648"></a>00648         currkey= currkey-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#ac20a23b2cb5a21986a4c762933f8a95b">next</a>;
<a name="l00649"></a>00649     }
<a name="l00650"></a>00650 }
<a name="l00651"></a>00651 
<a name="l00652"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a7a388a6c30aa6e3b10428e82a6e29615">00652</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a7a388a6c30aa6e3b10428e82a6e29615">keyData_switchDirectionNurb</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l00653"></a>00653 {
<a name="l00654"></a>00654     <a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>;
<a name="l00655"></a>00655 
<a name="l00656"></a>00656     <span class="keywordflow">if</span> (!editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>) {
<a name="l00657"></a>00657         <span class="comment">/* no shape keys - nothing to do */</span>
<a name="l00658"></a>00658         <span class="keywordflow">return</span>;
<a name="l00659"></a>00659     }
<a name="l00660"></a>00660 
<a name="l00661"></a>00661     <a class="code" href="../../d7/d55/editcurve_8c.html#a3496650042edc217b94d5852f1f613da">keyIndex_switchDirection</a>(editnurb, nu);
<a name="l00662"></a>00662     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>)
<a name="l00663"></a>00663         <a class="code" href="../../d7/d55/editcurve_8c.html#a95a73eb7e9605a87bc86aece47a26887">switch_keys_direction</a>(cu, nu);
<a name="l00664"></a>00664 }
<a name="l00665"></a>00665 
<a name="l00666"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a1e5860bf39dbde270dca5d16069ba39e">00666</a> <span class="keyword">static</span> <a class="code" href="../../df/da0/structGHash.html">GHash</a> *<a class="code" href="../../d7/d55/editcurve_8c.html#a1e5860bf39dbde270dca5d16069ba39e">dupli_keyIndexHash</a>(<a class="code" href="../../df/da0/structGHash.html">GHash</a> *keyindex)
<a name="l00667"></a>00667 {
<a name="l00668"></a>00668     <a class="code" href="../../df/da0/structGHash.html">GHash</a> *gh;
<a name="l00669"></a>00669     <a class="code" href="../../d2/d31/structGHashIterator.html">GHashIterator</a> *hashIter;
<a name="l00670"></a>00670 
<a name="l00671"></a>00671     gh= <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#af2fb34af7b99547b33a34380451a963d">BLI_ghash_new</a>(<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a371913beecfb01de3d0a8d5f0bb598d4">BLI_ghashutil_ptrhash</a>, <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a51865a4bfcfc2502e01a9369bfb72877">BLI_ghashutil_ptrcmp</a>, <span class="stringliteral">&quot;dupli_keyIndex gh&quot;</span>);
<a name="l00672"></a>00672 
<a name="l00673"></a>00673     <span class="keywordflow">for</span> (hashIter = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#aab164acbea58512dc40c74238f48e0c0">BLI_ghashIterator_new</a>(keyindex);
<a name="l00674"></a>00674                    !<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a0eff6b7b74d72e06f7c125da5a46a5f1">BLI_ghashIterator_isDone</a>(hashIter);
<a name="l00675"></a>00675                    <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a2d3ebd2fe8ee454695c6387215e3e88a">BLI_ghashIterator_step</a>(hashIter)) {
<a name="l00676"></a>00676         <span class="keywordtype">void</span> *cv = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a61c902d18de9cdd3785ef33e598d360f">BLI_ghashIterator_getKey</a>(hashIter);
<a name="l00677"></a>00677         <a class="code" href="../../d7/db4/structCVKeyIndex.html">CVKeyIndex</a> *index = <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a65c048ac3140f6c2598d94e4276a41f3">BLI_ghashIterator_getValue</a>(hashIter);
<a name="l00678"></a>00678         <a class="code" href="../../d7/db4/structCVKeyIndex.html">CVKeyIndex</a> *newIndex = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d7/db4/structCVKeyIndex.html">CVKeyIndex</a>), <span class="stringliteral">&quot;dupli_keyIndexHash index&quot;</span>);
<a name="l00679"></a>00679 
<a name="l00680"></a>00680         memcpy(newIndex, index, <span class="keyword">sizeof</span>(<a class="code" href="../../d7/db4/structCVKeyIndex.html">CVKeyIndex</a>));
<a name="l00681"></a>00681 
<a name="l00682"></a>00682         <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ad72f3a6d9b88bc494c6a279d1b7b9165">BLI_ghash_insert</a>(gh, cv, newIndex);
<a name="l00683"></a>00683     }
<a name="l00684"></a>00684 
<a name="l00685"></a>00685     <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a3cc839e5e4e00419c6774832687e39c1">BLI_ghashIterator_free</a>(hashIter);
<a name="l00686"></a>00686 
<a name="l00687"></a>00687     <span class="keywordflow">return</span> gh;
<a name="l00688"></a>00688 }
<a name="l00689"></a>00689 
<a name="l00690"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a9a60b27f8f4eb619c3c8a2921f393099">00690</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a9a60b27f8f4eb619c3c8a2921f393099">key_to_bezt</a>(<span class="keywordtype">float</span> *key, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *basebezt, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt)
<a name="l00691"></a>00691 {
<a name="l00692"></a>00692     memcpy(bezt, basebezt, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>));
<a name="l00693"></a>00693     memcpy(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>, key, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * 9);
<a name="l00694"></a>00694     bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a>= key[9];
<a name="l00695"></a>00695 }
<a name="l00696"></a>00696 
<a name="l00697"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a6a24493c0e33e3e240577b5e547d85d8">00697</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a6a24493c0e33e3e240577b5e547d85d8">bezt_to_key</a>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt, <span class="keywordtype">float</span> *key)
<a name="l00698"></a>00698 {
<a name="l00699"></a>00699     memcpy(key, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * 9);
<a name="l00700"></a>00700     key[9] = bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a>;
<a name="l00701"></a>00701 }
<a name="l00702"></a>00702 
<a name="l00703"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a54a01deb2f275b115340446ecf5a3445">00703</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a54a01deb2f275b115340446ecf5a3445">calc_keyHandles</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nurb, <span class="keywordtype">float</span> *key)
<a name="l00704"></a>00704 {
<a name="l00705"></a>00705     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l00706"></a>00706     <span class="keywordtype">int</span> a;
<a name="l00707"></a>00707     <span class="keywordtype">float</span> *fp= key;
<a name="l00708"></a>00708     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l00709"></a>00709 
<a name="l00710"></a>00710     nu= nurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00711"></a>00711     <span class="keywordflow">while</span> (nu) {
<a name="l00712"></a>00712         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l00713"></a>00713             <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *prevp, *nextp;
<a name="l00714"></a>00714             <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> cur, prev, <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l00715"></a>00715             <span class="keywordtype">float</span> *startfp, *prevfp, *nextfp;
<a name="l00716"></a>00716 
<a name="l00717"></a>00717             bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l00718"></a>00718             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00719"></a>00719             startfp= fp;
<a name="l00720"></a>00720 
<a name="l00721"></a>00721             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) {
<a name="l00722"></a>00722                 prevp= bezt+(a-1);
<a name="l00723"></a>00723                 prevfp= fp+(12 * (a-1));
<a name="l00724"></a>00724             }
<a name="l00725"></a>00725             <span class="keywordflow">else</span> {
<a name="l00726"></a>00726                 prevp= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00727"></a>00727                 prevfp= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00728"></a>00728             }
<a name="l00729"></a>00729 
<a name="l00730"></a>00730             nextp= bezt + 1;
<a name="l00731"></a>00731             nextfp= fp + 12;
<a name="l00732"></a>00732 
<a name="l00733"></a>00733             <span class="keywordflow">while</span> (a--) {
<a name="l00734"></a>00734                 <a class="code" href="../../d7/d55/editcurve_8c.html#a9a60b27f8f4eb619c3c8a2921f393099">key_to_bezt</a>(fp, bezt, &amp;cur);
<a name="l00735"></a>00735 
<a name="l00736"></a>00736                 <span class="keywordflow">if</span> (nextp) <a class="code" href="../../d7/d55/editcurve_8c.html#a9a60b27f8f4eb619c3c8a2921f393099">key_to_bezt</a>(nextfp, nextp, &amp;next);
<a name="l00737"></a>00737                 <span class="keywordflow">if</span> (prevp) <a class="code" href="../../d7/d55/editcurve_8c.html#a9a60b27f8f4eb619c3c8a2921f393099">key_to_bezt</a>(prevfp, prevp, &amp;prev);
<a name="l00738"></a>00738 
<a name="l00739"></a>00739                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a1b74ac08e2d1a385a6dd7c1e26e25a5c">calchandleNurb</a>(&amp;cur, prevp ? &amp;prev : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, nextp ? &amp;next : NULL, 0);
<a name="l00740"></a>00740                 <a class="code" href="../../d7/d55/editcurve_8c.html#a6a24493c0e33e3e240577b5e547d85d8">bezt_to_key</a>(&amp;cur, fp);
<a name="l00741"></a>00741 
<a name="l00742"></a>00742                 prevp= bezt;
<a name="l00743"></a>00743                 prevfp= fp;
<a name="l00744"></a>00744                 <span class="keywordflow">if</span> (a==1) {
<a name="l00745"></a>00745                     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) {
<a name="l00746"></a>00746                         nextp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l00747"></a>00747                         nextfp= startfp;
<a name="l00748"></a>00748                     }
<a name="l00749"></a>00749                     <span class="keywordflow">else</span> {
<a name="l00750"></a>00750                         nextp= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00751"></a>00751                         nextfp= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00752"></a>00752                     }
<a name="l00753"></a>00753                 }
<a name="l00754"></a>00754                 <span class="keywordflow">else</span> {
<a name="l00755"></a>00755                     ++nextp;
<a name="l00756"></a>00756                     nextfp += 12;
<a name="l00757"></a>00757                 }
<a name="l00758"></a>00758 
<a name="l00759"></a>00759                 ++bezt;
<a name="l00760"></a>00760                 fp += 12;
<a name="l00761"></a>00761             }
<a name="l00762"></a>00762         }
<a name="l00763"></a>00763         <span class="keywordflow">else</span> {
<a name="l00764"></a>00764             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> * nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l00765"></a>00765             fp += a * 4;
<a name="l00766"></a>00766         }
<a name="l00767"></a>00767 
<a name="l00768"></a>00768         nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l00769"></a>00769     }
<a name="l00770"></a>00770 }
<a name="l00771"></a>00771 
<a name="l00772"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a30b44b5c7b50331a987f2cb45a193785">00772</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a30b44b5c7b50331a987f2cb45a193785">calc_shapeKeys</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *obedit)
<a name="l00773"></a>00773 {
<a name="l00774"></a>00774     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= (<a class="code" href="../../da/d10/structCurve.html">Curve</a>*)obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00775"></a>00775 
<a name="l00776"></a>00776     <span class="comment">/* are there keys? */</span>
<a name="l00777"></a>00777     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>) {
<a name="l00778"></a>00778         <span class="keywordtype">int</span> a, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00779"></a>00779         <a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>;
<a name="l00780"></a>00780         <a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a> *currkey;
<a name="l00781"></a>00781         <a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a> *actkey= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>-&gt;<a class="code" href="../../d1/d9e/structKey.html#ab82a3a504826387b0811d68570496e2a">block</a>, editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#af6aa0e45821b91fb769a78041e070fea">shapenr</a>-1);
<a name="l00782"></a>00782         <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt, *oldbezt;
<a name="l00783"></a>00783         <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp, *oldbp;
<a name="l00784"></a>00784         <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l00785"></a>00785         <span class="keywordtype">int</span> totvert= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#acbc43d8687324817662e3f0e713b514a">count_curveverts</a>(&amp;editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>);
<a name="l00786"></a>00786 
<a name="l00787"></a>00787         float (*ofs)[3] = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00788"></a>00788         <span class="keywordtype">float</span> *oldkey, *newkey, *ofp;
<a name="l00789"></a>00789 
<a name="l00790"></a>00790         <span class="comment">/* editing the base key should update others */</span>
<a name="l00791"></a>00791         <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>-&gt;<a class="code" href="../../d1/d9e/structKey.html#af4673161e52f45eb6c8efc3ea71939fa">type</a>==<a class="code" href="../../de/d41/DNA__key__types_8h.html#a14061dd054afd472999a4f4f6cdf3923a166121abc12de1fb379b9e6956f45c67">KEY_RELATIVE</a>) {
<a name="l00792"></a>00792             <span class="keywordtype">int</span> act_is_basis = 0;
<a name="l00793"></a>00793             <span class="comment">/* find if this key is a basis for any others */</span>
<a name="l00794"></a>00794             <span class="keywordflow">for</span> (currkey = cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>-&gt;<a class="code" href="../../d1/d9e/structKey.html#ab82a3a504826387b0811d68570496e2a">block</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; currkey; currkey= currkey-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#ac20a23b2cb5a21986a4c762933f8a95b">next</a>) {
<a name="l00795"></a>00795                 <span class="keywordflow">if</span> (editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#af6aa0e45821b91fb769a78041e070fea">shapenr</a>-1 == currkey-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#adc3b6e3b0dcc4c2d4c0334b339913508">relative</a>) {
<a name="l00796"></a>00796                     act_is_basis = 1;
<a name="l00797"></a>00797                     <span class="keywordflow">break</span>;
<a name="l00798"></a>00798                 }
<a name="l00799"></a>00799             }
<a name="l00800"></a>00800 
<a name="l00801"></a>00801             <span class="keywordflow">if</span> (act_is_basis) { <span class="comment">/* active key is a base */</span>
<a name="l00802"></a>00802                 <span class="keywordtype">int</span> totvec= 0;
<a name="l00803"></a>00803 
<a name="l00804"></a>00804                 <span class="comment">/* Calculate needed memory to store offset */</span>
<a name="l00805"></a>00805                 nu= editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00806"></a>00806                 <span class="keywordflow">while</span> (nu) {
<a name="l00807"></a>00807                     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l00808"></a>00808                         <span class="comment">/* Three vects to store handles and one for alfa */</span>
<a name="l00809"></a>00809                         totvec+= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> * 4;
<a name="l00810"></a>00810                     }
<a name="l00811"></a>00811                     <span class="keywordflow">else</span> {
<a name="l00812"></a>00812                         totvec+= 2 * nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> * nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l00813"></a>00813                     }
<a name="l00814"></a>00814 
<a name="l00815"></a>00815                     nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l00816"></a>00816                 }
<a name="l00817"></a>00817 
<a name="l00818"></a>00818                 ofs= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * 3 * totvec,  <span class="stringliteral">&quot;currkey-&gt;data&quot;</span>);
<a name="l00819"></a>00819                 nu= editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00820"></a>00820                 i= 0;
<a name="l00821"></a>00821                 <span class="keywordflow">while</span> (nu) {
<a name="l00822"></a>00822                     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l00823"></a>00823                         bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l00824"></a>00824                         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00825"></a>00825                         <span class="keywordflow">while</span> (a--) {
<a name="l00826"></a>00826                             oldbezt= <a class="code" href="../../d7/d55/editcurve_8c.html#a11e8113ecfe4c4c3508636f1badd1b14">getKeyIndexOrig_bezt</a>(editnurb, bezt);
<a name="l00827"></a>00827 
<a name="l00828"></a>00828                             <span class="keywordflow">if</span> (oldbezt) {
<a name="l00829"></a>00829                                 <span class="keywordtype">int</span> j;
<a name="l00830"></a>00830                                 <span class="keywordflow">for</span> (j= 0; j &lt; 3; ++j) {
<a name="l00831"></a>00831                                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(ofs[i], bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[j], oldbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[j]);
<a name="l00832"></a>00832                                     i++;
<a name="l00833"></a>00833                                 }
<a name="l00834"></a>00834                                 ofs[i++][0]= bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a> - oldbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a>;
<a name="l00835"></a>00835                             }
<a name="l00836"></a>00836                             <span class="keywordflow">else</span> {
<a name="l00837"></a>00837                                 i += 4;
<a name="l00838"></a>00838                             }
<a name="l00839"></a>00839                             bezt++;
<a name="l00840"></a>00840                         }
<a name="l00841"></a>00841                     }
<a name="l00842"></a>00842                     <span class="keywordflow">else</span> {
<a name="l00843"></a>00843                         bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l00844"></a>00844                         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l00845"></a>00845                         <span class="keywordflow">while</span> (a--) {
<a name="l00846"></a>00846                             oldbp= <a class="code" href="../../d7/d55/editcurve_8c.html#a132fb8b7ec3120d23f967022176f6fc7">getKeyIndexOrig_bp</a>(editnurb, bp);
<a name="l00847"></a>00847                             <span class="keywordflow">if</span> (oldbp) {
<a name="l00848"></a>00848                                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(ofs[i], bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, oldbp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l00849"></a>00849                                 ofs[i+1][0]= bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a1210ec737d6ced5cf276e22e8ca277f8">alfa</a> - oldbp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a1210ec737d6ced5cf276e22e8ca277f8">alfa</a>;
<a name="l00850"></a>00850                             }
<a name="l00851"></a>00851                             i += 2;
<a name="l00852"></a>00852                             ++bp;
<a name="l00853"></a>00853                         }
<a name="l00854"></a>00854                     }
<a name="l00855"></a>00855 
<a name="l00856"></a>00856                     nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l00857"></a>00857                 }
<a name="l00858"></a>00858             }
<a name="l00859"></a>00859         }
<a name="l00860"></a>00860 
<a name="l00861"></a>00861         currkey = cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>-&gt;<a class="code" href="../../d1/d9e/structKey.html#ab82a3a504826387b0811d68570496e2a">block</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00862"></a>00862         <span class="keywordflow">while</span> (currkey) {
<a name="l00863"></a>00863             <span class="keywordtype">int</span> apply_offset = (ofs &amp;&amp; (currkey != actkey) &amp;&amp; (editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#af6aa0e45821b91fb769a78041e070fea">shapenr</a>-1 == currkey-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#adc3b6e3b0dcc4c2d4c0334b339913508">relative</a>));
<a name="l00864"></a>00864 
<a name="l00865"></a>00865             <span class="keywordtype">float</span> *fp= newkey= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>-&gt;<a class="code" href="../../d1/d9e/structKey.html#a61e6991b6b6a75a8c65470f3b240c193">elemsize</a> * totvert,  <span class="stringliteral">&quot;currkey-&gt;data&quot;</span>);
<a name="l00866"></a>00866             ofp= oldkey = currkey-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#aec4b55f1b0c4c1e0c60a77f7ffb80401">data</a>;
<a name="l00867"></a>00867 
<a name="l00868"></a>00868             nu= editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00869"></a>00869             i = 0;
<a name="l00870"></a>00870             <span class="keywordflow">while</span> (nu) {
<a name="l00871"></a>00871                 <span class="keywordflow">if</span> (currkey == actkey) {
<a name="l00872"></a>00872                     <span class="keywordtype">int</span> restore= actkey != cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>-&gt;<a class="code" href="../../d1/d9e/structKey.html#ac66292f02aa3b6c694a1fcd14e4218e2">refkey</a>;
<a name="l00873"></a>00873 
<a name="l00874"></a>00874                     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l00875"></a>00875                         bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l00876"></a>00876                         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00877"></a>00877                         <span class="keywordflow">while</span> (a--) {
<a name="l00878"></a>00878                             <span class="keywordtype">int</span> j;
<a name="l00879"></a>00879                             oldbezt= <a class="code" href="../../d7/d55/editcurve_8c.html#a11e8113ecfe4c4c3508636f1badd1b14">getKeyIndexOrig_bezt</a>(editnurb, bezt);
<a name="l00880"></a>00880 
<a name="l00881"></a>00881                             <span class="keywordflow">for</span> (j= 0; j &lt; 3; ++j, ++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {
<a name="l00882"></a>00882                                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(fp, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[j]);
<a name="l00883"></a>00883 
<a name="l00884"></a>00884                                 <span class="keywordflow">if</span> (restore &amp;&amp; oldbezt) {
<a name="l00885"></a>00885                                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[j], oldbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[j]);
<a name="l00886"></a>00886                                 }
<a name="l00887"></a>00887 
<a name="l00888"></a>00888                                 fp+= 3;
<a name="l00889"></a>00889                             }
<a name="l00890"></a>00890                             fp[0]= bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a>;
<a name="l00891"></a>00891 
<a name="l00892"></a>00892                             <span class="keywordflow">if</span> (restore &amp;&amp; oldbezt) {
<a name="l00893"></a>00893                                 bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a>= oldbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a>;
<a name="l00894"></a>00894                             }
<a name="l00895"></a>00895 
<a name="l00896"></a>00896                             fp+= 3; ++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;<span class="comment">/* alphas */</span>
<a name="l00897"></a>00897                             ++bezt;
<a name="l00898"></a>00898                         }
<a name="l00899"></a>00899                     }
<a name="l00900"></a>00900                     <span class="keywordflow">else</span> {
<a name="l00901"></a>00901                         bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l00902"></a>00902                         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l00903"></a>00903                         <span class="keywordflow">while</span> (a--) {
<a name="l00904"></a>00904                             oldbp= <a class="code" href="../../d7/d55/editcurve_8c.html#a132fb8b7ec3120d23f967022176f6fc7">getKeyIndexOrig_bp</a>(editnurb, bp);
<a name="l00905"></a>00905 
<a name="l00906"></a>00906                             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(fp, bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l00907"></a>00907 
<a name="l00908"></a>00908                             fp[3]= bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a1210ec737d6ced5cf276e22e8ca277f8">alfa</a>;
<a name="l00909"></a>00909 
<a name="l00910"></a>00910                             <span class="keywordflow">if</span> (restore &amp;&amp; oldbp) {
<a name="l00911"></a>00911                                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, oldbp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l00912"></a>00912                                 bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a1210ec737d6ced5cf276e22e8ca277f8">alfa</a>= oldbp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a1210ec737d6ced5cf276e22e8ca277f8">alfa</a>;
<a name="l00913"></a>00913                             }
<a name="l00914"></a>00914 
<a name="l00915"></a>00915                             fp+= 4;
<a name="l00916"></a>00916                             ++bp;
<a name="l00917"></a>00917                             i+=2;
<a name="l00918"></a>00918                         }
<a name="l00919"></a>00919                     }
<a name="l00920"></a>00920                 }
<a name="l00921"></a>00921                 <span class="keywordflow">else</span> {
<a name="l00922"></a>00922                     <span class="keywordtype">int</span> index;
<a name="l00923"></a>00923                     <span class="keywordtype">float</span> *curofp;
<a name="l00924"></a>00924 
<a name="l00925"></a>00925                     <span class="keywordflow">if</span> (oldkey) {
<a name="l00926"></a>00926                         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l00927"></a>00927                             bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l00928"></a>00928                             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00929"></a>00929 
<a name="l00930"></a>00930                             <span class="keywordflow">while</span> (a--) {
<a name="l00931"></a>00931                                 index= <a class="code" href="../../d7/d55/editcurve_8c.html#a9191115ce74a289d87ae111f59b11f1e">getKeyIndexOrig_keyIndex</a>(editnurb, bezt);
<a name="l00932"></a>00932                                 <span class="keywordflow">if</span> (index &gt;= 0) {
<a name="l00933"></a>00933                                     <span class="keywordtype">int</span> j;
<a name="l00934"></a>00934                                     curofp= ofp + index;
<a name="l00935"></a>00935 
<a name="l00936"></a>00936                                     <span class="keywordflow">for</span> (j= 0; j &lt; 3; ++j, ++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {
<a name="l00937"></a>00937                                         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(fp, curofp);
<a name="l00938"></a>00938 
<a name="l00939"></a>00939                                         <span class="keywordflow">if</span> (apply_offset) {
<a name="l00940"></a>00940                                             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(fp, ofs[i]);
<a name="l00941"></a>00941                                         }
<a name="l00942"></a>00942 
<a name="l00943"></a>00943                                         fp+= 3; curofp+= 3;
<a name="l00944"></a>00944                                     }
<a name="l00945"></a>00945                                     fp[0]= curofp[0];
<a name="l00946"></a>00946 
<a name="l00947"></a>00947                                     <span class="keywordflow">if</span> (apply_offset) {
<a name="l00948"></a>00948                                         <span class="comment">/* apply alfa offsets */</span>
<a name="l00949"></a>00949                                         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(fp, ofs[i]);
<a name="l00950"></a>00950                                         ++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00951"></a>00951                                     }
<a name="l00952"></a>00952 
<a name="l00953"></a>00953                                     fp+= 3; <span class="comment">/* alphas */</span>
<a name="l00954"></a>00954                                 }
<a name="l00955"></a>00955                                 <span class="keywordflow">else</span> {
<a name="l00956"></a>00956                                     <span class="keywordtype">int</span> j;
<a name="l00957"></a>00957                                     <span class="keywordflow">for</span> (j= 0; j &lt; 3; ++j, ++<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {
<a name="l00958"></a>00958                                         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(fp, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[j]);
<a name="l00959"></a>00959                                         fp+= 3;
<a name="l00960"></a>00960                                     }
<a name="l00961"></a>00961                                     fp[0]= bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a>;
<a name="l00962"></a>00962 
<a name="l00963"></a>00963                                     fp+= 3; <span class="comment">/* alphas */</span>
<a name="l00964"></a>00964                                 }
<a name="l00965"></a>00965                                 ++bezt;
<a name="l00966"></a>00966                             }
<a name="l00967"></a>00967                         }
<a name="l00968"></a>00968                         <span class="keywordflow">else</span> {
<a name="l00969"></a>00969                             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l00970"></a>00970                             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l00971"></a>00971                             <span class="keywordflow">while</span> (a--) {
<a name="l00972"></a>00972                                 index= <a class="code" href="../../d7/d55/editcurve_8c.html#a9191115ce74a289d87ae111f59b11f1e">getKeyIndexOrig_keyIndex</a>(editnurb, bp);
<a name="l00973"></a>00973 
<a name="l00974"></a>00974                                 <span class="keywordflow">if</span> (index &gt;= 0) {
<a name="l00975"></a>00975                                     curofp= ofp + index;
<a name="l00976"></a>00976                                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(fp, curofp);
<a name="l00977"></a>00977                                     fp[3]= curofp[3];
<a name="l00978"></a>00978 
<a name="l00979"></a>00979                                     <span class="keywordflow">if</span> (apply_offset) {
<a name="l00980"></a>00980                                         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(fp, ofs[i]);
<a name="l00981"></a>00981                                         fp[3]+=ofs[i+1][0];
<a name="l00982"></a>00982                                     }
<a name="l00983"></a>00983                                 }
<a name="l00984"></a>00984                                 <span class="keywordflow">else</span> {
<a name="l00985"></a>00985                                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(fp, bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l00986"></a>00986                                     fp[3]= bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a1210ec737d6ced5cf276e22e8ca277f8">alfa</a>;
<a name="l00987"></a>00987                                 }
<a name="l00988"></a>00988 
<a name="l00989"></a>00989                                 fp+= 4;
<a name="l00990"></a>00990                                 ++bp;
<a name="l00991"></a>00991                                 i+=2;
<a name="l00992"></a>00992                             }
<a name="l00993"></a>00993                         }
<a name="l00994"></a>00994                     }
<a name="l00995"></a>00995                 }
<a name="l00996"></a>00996 
<a name="l00997"></a>00997                 nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l00998"></a>00998             }
<a name="l00999"></a>00999 
<a name="l01000"></a>01000             <span class="keywordflow">if</span> (apply_offset) {
<a name="l01001"></a>01001                 <span class="comment">/* handles could become malicious after offsets applying */</span>
<a name="l01002"></a>01002                 <a class="code" href="../../d7/d55/editcurve_8c.html#a54a01deb2f275b115340446ecf5a3445">calc_keyHandles</a>(&amp;editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>, newkey);
<a name="l01003"></a>01003             }
<a name="l01004"></a>01004 
<a name="l01005"></a>01005             currkey-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#a48866fbfcc064f4777e2d2841ce42fe4">totelem</a>= totvert;
<a name="l01006"></a>01006             <span class="keywordflow">if</span> (currkey-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#aec4b55f1b0c4c1e0c60a77f7ffb80401">data</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(currkey-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#aec4b55f1b0c4c1e0c60a77f7ffb80401">data</a>);
<a name="l01007"></a>01007             currkey-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#aec4b55f1b0c4c1e0c60a77f7ffb80401">data</a> = newkey;
<a name="l01008"></a>01008 
<a name="l01009"></a>01009             currkey= currkey-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#ac20a23b2cb5a21986a4c762933f8a95b">next</a>;
<a name="l01010"></a>01010         }
<a name="l01011"></a>01011 
<a name="l01012"></a>01012         <span class="keywordflow">if</span> (ofs) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ofs);
<a name="l01013"></a>01013     }
<a name="l01014"></a>01014 }
<a name="l01015"></a>01015 
<a name="l01016"></a>01016 <span class="comment">/* ********************* Amimation data *************** */</span>
<a name="l01017"></a>01017 
<a name="l01018"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a25f623beacaa9664fe6292bff21ab6c9">01018</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a25f623beacaa9664fe6292bff21ab6c9">curve_is_animated</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu)
<a name="l01019"></a>01019 {
<a name="l01020"></a>01020     <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *ad= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(&amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>);
<a name="l01021"></a>01021 
<a name="l01022"></a>01022     <span class="keywordflow">return</span> ad &amp;&amp; (ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a> || ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#aaca565f031ee1209087422d8a5d77769">drivers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>);
<a name="l01023"></a>01023 }
<a name="l01024"></a>01024 
<a name="l01025"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a82697cabcaef8113ab409373f919a980">01025</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a82697cabcaef8113ab409373f919a980">fcurve_path_rename</a>(<a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *ad, <span class="keywordtype">char</span> *orig_rna_path, <span class="keywordtype">char</span> *rna_path, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *orig_curves, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *curves)
<a name="l01026"></a>01026 {
<a name="l01027"></a>01027     <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu, *nfcu, *nextfcu;
<a name="l01028"></a>01028     <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>= <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(orig_rna_path);
<a name="l01029"></a>01029 
<a name="l01030"></a>01030     fcu= orig_curves-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01031"></a>01031     <span class="keywordflow">while</span> (fcu) {
<a name="l01032"></a>01032         nextfcu= fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a381b65464374cad861b80c44b9ae0759">next</a>;
<a name="l01033"></a>01033         <span class="keywordflow">if</span> (!strncmp(fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>, orig_rna_path, len)) {
<a name="l01034"></a>01034             <span class="keywordtype">char</span> *spath, *suffix= fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a> + <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l01035"></a>01035             nfcu= <a class="code" href="../../da/dba/BKE__fcurve_8h.html#ae2aca464f2e35470877917876a933472">copy_fcurve</a>(fcu);
<a name="l01036"></a>01036             spath= nfcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>;
<a name="l01037"></a>01037             nfcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>= <a class="code" href="../../d3/db3/BLI__string_8h.html#a17694667060f4df89dab999b472e42c7">BLI_sprintfN</a>(<span class="stringliteral">&quot;%s%s&quot;</span>, rna_path, suffix);
<a name="l01038"></a>01038             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(curves, nfcu);
<a name="l01039"></a>01039 
<a name="l01040"></a>01040             <span class="keywordflow">if</span> (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a3e312bcc15bdf7b83ce03a842044350a">grp</a>) {
<a name="l01041"></a>01041                 <a class="code" href="../../d8/df5/BKE__action_8h.html#a570c3d0a1f3bb2344916f094339d181e">action_groups_remove_channel</a>(ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>, fcu);
<a name="l01042"></a>01042                 <a class="code" href="../../d8/df5/BKE__action_8h.html#ae14baf4ad9762b4f19df690a2496ce53">action_groups_add_channel</a>(ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>, fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a3e312bcc15bdf7b83ce03a842044350a">grp</a>, nfcu);
<a name="l01043"></a>01043             }
<a name="l01044"></a>01044             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a> &amp;&amp; &amp;ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>-&gt;<a class="code" href="../../d1/d48/structbAction.html#a17c9f9250f377305171640e7a4aa7666">curves</a> == orig_curves)
<a name="l01045"></a>01045                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>-&gt;<a class="code" href="../../d1/d48/structbAction.html#a17c9f9250f377305171640e7a4aa7666">curves</a>, fcu);
<a name="l01046"></a>01046             <span class="keywordflow">else</span>
<a name="l01047"></a>01047                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#aaca565f031ee1209087422d8a5d77769">drivers</a>, fcu);
<a name="l01048"></a>01048 
<a name="l01049"></a>01049             <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a0d147bf242aadd56249b4da00fdb19d8">free_fcurve</a>(fcu);
<a name="l01050"></a>01050 
<a name="l01051"></a>01051             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(spath);
<a name="l01052"></a>01052         }
<a name="l01053"></a>01053         fcu= nextfcu;
<a name="l01054"></a>01054     }
<a name="l01055"></a>01055 }
<a name="l01056"></a>01056 
<a name="l01057"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a4daf74b5ab393073e35ac9cf3e77f794">01057</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a4daf74b5ab393073e35ac9cf3e77f794">fcurve_remove</a>(<a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *ad, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *orig_curves, <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu)
<a name="l01058"></a>01058 {
<a name="l01059"></a>01059     <span class="keywordflow">if</span> (orig_curves==&amp;ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#aaca565f031ee1209087422d8a5d77769">drivers</a>) <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#aaca565f031ee1209087422d8a5d77769">drivers</a>, fcu);
<a name="l01060"></a>01060     <span class="keywordflow">else</span> <a class="code" href="../../d8/df5/BKE__action_8h.html#a570c3d0a1f3bb2344916f094339d181e">action_groups_remove_channel</a>(ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>, fcu);
<a name="l01061"></a>01061 
<a name="l01062"></a>01062     <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a0d147bf242aadd56249b4da00fdb19d8">free_fcurve</a>(fcu);
<a name="l01063"></a>01063 }
<a name="l01064"></a>01064 
<a name="l01065"></a><a class="code" href="../../d7/d55/editcurve_8c.html#adcbf914ff9eccc1d30e52cf26cf90f38">01065</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#adcbf914ff9eccc1d30e52cf26cf90f38">curve_rename_fcurves</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *orig_curves)
<a name="l01066"></a>01066 {
<a name="l01067"></a>01067     <span class="keywordtype">int</span> nu_index= 0, a, pt_index;
<a name="l01068"></a>01068     <a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>;
<a name="l01069"></a>01069     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu= editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01070"></a>01070     <a class="code" href="../../d7/db4/structCVKeyIndex.html">CVKeyIndex</a> *keyIndex;
<a name="l01071"></a>01071     <span class="keywordtype">char</span> rna_path[64], orig_rna_path[64];
<a name="l01072"></a>01072     <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *ad= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(&amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>);
<a name="l01073"></a>01073     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> curves= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01074"></a>01074     <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l01075"></a>01075 
<a name="l01076"></a>01076     <span class="keywordflow">while</span> (nu) {
<a name="l01077"></a>01077         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l01078"></a>01078             <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l01079"></a>01079             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l01080"></a>01080             pt_index= 0;
<a name="l01081"></a>01081 
<a name="l01082"></a>01082             <span class="keywordflow">while</span> (a--) {
<a name="l01083"></a>01083                 keyIndex= <a class="code" href="../../d7/d55/editcurve_8c.html#af9fd49e7bfac2be36a4e7efad54f2845">getCVKeyIndex</a>(editnurb, bezt);
<a name="l01084"></a>01084                 <span class="keywordflow">if</span> (keyIndex) {
<a name="l01085"></a>01085                     <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(rna_path, <span class="keyword">sizeof</span>(rna_path), <span class="stringliteral">&quot;splines[%d].bezier_points[%d]&quot;</span>, nu_index, pt_index);
<a name="l01086"></a>01086                     <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(orig_rna_path, <span class="keyword">sizeof</span>(orig_rna_path), <span class="stringliteral">&quot;splines[%d].bezier_points[%d]&quot;</span>, keyIndex-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#ae34daf5f2426f6f2074d7e67559fc40f">nu_index</a>, keyIndex-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a9b470245e6a0f28ecc96512ceae8bdad">pt_index</a>);
<a name="l01087"></a>01087 
<a name="l01088"></a>01088                     <span class="keywordflow">if</span> (keyIndex-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a437794a3b50641a6718ea1b1c7819df3">switched</a>) {
<a name="l01089"></a>01089                         <span class="keywordtype">char</span> handle_path[64], orig_handle_path[64];
<a name="l01090"></a>01090                         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(orig_handle_path, <span class="keyword">sizeof</span>(orig_rna_path), <span class="stringliteral">&quot;%s.handle_left&quot;</span>, orig_rna_path);
<a name="l01091"></a>01091                         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(handle_path, <span class="keyword">sizeof</span>(rna_path), <span class="stringliteral">&quot;%s.handle_right&quot;</span>, rna_path);
<a name="l01092"></a>01092                         <a class="code" href="../../d7/d55/editcurve_8c.html#a82697cabcaef8113ab409373f919a980">fcurve_path_rename</a>(ad, orig_handle_path, handle_path, orig_curves, &amp;curves);
<a name="l01093"></a>01093 
<a name="l01094"></a>01094                         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(orig_handle_path, <span class="keyword">sizeof</span>(orig_rna_path), <span class="stringliteral">&quot;%s.handle_right&quot;</span>, orig_rna_path);
<a name="l01095"></a>01095                         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(handle_path, <span class="keyword">sizeof</span>(rna_path), <span class="stringliteral">&quot;%s.handle_left&quot;</span>, rna_path);
<a name="l01096"></a>01096                         <a class="code" href="../../d7/d55/editcurve_8c.html#a82697cabcaef8113ab409373f919a980">fcurve_path_rename</a>(ad, orig_handle_path, handle_path, orig_curves, &amp;curves);
<a name="l01097"></a>01097                     }
<a name="l01098"></a>01098 
<a name="l01099"></a>01099                     <a class="code" href="../../d7/d55/editcurve_8c.html#a82697cabcaef8113ab409373f919a980">fcurve_path_rename</a>(ad, orig_rna_path, rna_path, orig_curves, &amp;curves);
<a name="l01100"></a>01100 
<a name="l01101"></a>01101                     keyIndex-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#ae34daf5f2426f6f2074d7e67559fc40f">nu_index</a>= nu_index;
<a name="l01102"></a>01102                     keyIndex-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a9b470245e6a0f28ecc96512ceae8bdad">pt_index</a>= pt_index;
<a name="l01103"></a>01103                 }
<a name="l01104"></a>01104 
<a name="l01105"></a>01105                 bezt++;
<a name="l01106"></a>01106                 pt_index++;
<a name="l01107"></a>01107             }
<a name="l01108"></a>01108         }
<a name="l01109"></a>01109         <span class="keywordflow">else</span> {
<a name="l01110"></a>01110             <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l01111"></a>01111             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> * nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l01112"></a>01112             pt_index= 0;
<a name="l01113"></a>01113 
<a name="l01114"></a>01114             <span class="keywordflow">while</span> (a--) {
<a name="l01115"></a>01115                 keyIndex= <a class="code" href="../../d7/d55/editcurve_8c.html#af9fd49e7bfac2be36a4e7efad54f2845">getCVKeyIndex</a>(editnurb, bp);
<a name="l01116"></a>01116                 <span class="keywordflow">if</span> (keyIndex) {
<a name="l01117"></a>01117                     <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(rna_path, <span class="keyword">sizeof</span>(rna_path), <span class="stringliteral">&quot;splines[%d].points[%d]&quot;</span>, nu_index, pt_index);
<a name="l01118"></a>01118                     <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(orig_rna_path, <span class="keyword">sizeof</span>(orig_rna_path), <span class="stringliteral">&quot;splines[%d].points[%d]&quot;</span>, keyIndex-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#ae34daf5f2426f6f2074d7e67559fc40f">nu_index</a>, keyIndex-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a9b470245e6a0f28ecc96512ceae8bdad">pt_index</a>);
<a name="l01119"></a>01119                     <a class="code" href="../../d7/d55/editcurve_8c.html#a82697cabcaef8113ab409373f919a980">fcurve_path_rename</a>(ad, orig_rna_path, rna_path, orig_curves, &amp;curves);
<a name="l01120"></a>01120 
<a name="l01121"></a>01121                     keyIndex-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#ae34daf5f2426f6f2074d7e67559fc40f">nu_index</a>= nu_index;
<a name="l01122"></a>01122                     keyIndex-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#a9b470245e6a0f28ecc96512ceae8bdad">pt_index</a>= pt_index;
<a name="l01123"></a>01123                 }
<a name="l01124"></a>01124 
<a name="l01125"></a>01125                 bp++;
<a name="l01126"></a>01126                 pt_index++;
<a name="l01127"></a>01127             }
<a name="l01128"></a>01128         }
<a name="l01129"></a>01129         nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l01130"></a>01130         nu_index++;
<a name="l01131"></a>01131     }
<a name="l01132"></a>01132 
<a name="l01133"></a>01133     <span class="comment">/* remove paths for removed control points</span>
<a name="l01134"></a>01134 <span class="comment">     * need this to make further step with copying non-cv related curves copying</span>
<a name="l01135"></a>01135 <span class="comment">     * not touching cv&#39;s f-curves */</span>
<a name="l01136"></a>01136     <span class="keywordflow">for</span> (fcu= orig_curves-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; fcu; fcu= next) {
<a name="l01137"></a>01137         next= fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a381b65464374cad861b80c44b9ae0759">next</a>;
<a name="l01138"></a>01138 
<a name="l01139"></a>01139         <span class="keywordflow">if</span> (!strncmp(fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>, <span class="stringliteral">&quot;splines&quot;</span>, 7)) {
<a name="l01140"></a>01140             <span class="keywordtype">char</span> *ch= strchr(fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>, <span class="charliteral">&#39;.&#39;</span>);
<a name="l01141"></a>01141 
<a name="l01142"></a>01142             <span class="keywordflow">if</span> (ch &amp;&amp; (!strncmp(ch, <span class="stringliteral">&quot;.bezier_points&quot;</span>, 14) || !strncmp(ch, <span class="stringliteral">&quot;.points&quot;</span>, 7)))
<a name="l01143"></a>01143                 <a class="code" href="../../d7/d55/editcurve_8c.html#a4daf74b5ab393073e35ac9cf3e77f794">fcurve_remove</a>(ad, orig_curves, fcu);
<a name="l01144"></a>01144         }
<a name="l01145"></a>01145     }
<a name="l01146"></a>01146 
<a name="l01147"></a>01147     nu_index= 0;
<a name="l01148"></a>01148     nu= editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01149"></a>01149     <span class="keywordflow">while</span> (nu) {
<a name="l01150"></a>01150         keyIndex= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01151"></a>01151         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) {
<a name="l01152"></a>01152             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) keyIndex= <a class="code" href="../../d7/d55/editcurve_8c.html#af9fd49e7bfac2be36a4e7efad54f2845">getCVKeyIndex</a>(editnurb, &amp;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>[0]);
<a name="l01153"></a>01153             <span class="keywordflow">else</span> keyIndex= <a class="code" href="../../d7/d55/editcurve_8c.html#af9fd49e7bfac2be36a4e7efad54f2845">getCVKeyIndex</a>(editnurb, &amp;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>[0]);
<a name="l01154"></a>01154         }
<a name="l01155"></a>01155 
<a name="l01156"></a>01156         <span class="keywordflow">if</span> (keyIndex) {
<a name="l01157"></a>01157             <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(rna_path, <span class="keyword">sizeof</span>(rna_path), <span class="stringliteral">&quot;splines[%d]&quot;</span>, nu_index);
<a name="l01158"></a>01158             <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(orig_rna_path, <span class="keyword">sizeof</span>(orig_rna_path), <span class="stringliteral">&quot;splines[%d]&quot;</span>, keyIndex-&gt;<a class="code" href="../../d7/db4/structCVKeyIndex.html#ae34daf5f2426f6f2074d7e67559fc40f">nu_index</a>);
<a name="l01159"></a>01159             <a class="code" href="../../d7/d55/editcurve_8c.html#a82697cabcaef8113ab409373f919a980">fcurve_path_rename</a>(ad, orig_rna_path, rna_path, orig_curves, &amp;curves);
<a name="l01160"></a>01160         }
<a name="l01161"></a>01161 
<a name="l01162"></a>01162         nu_index++;
<a name="l01163"></a>01163         nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l01164"></a>01164     }
<a name="l01165"></a>01165 
<a name="l01166"></a>01166     <span class="comment">/* the remainders in orig_curves can be copied back (like follow path) */</span>
<a name="l01167"></a>01167     <span class="comment">/* (if it&#39;s not path to spline) */</span>
<a name="l01168"></a>01168     <span class="keywordflow">for</span> (fcu= orig_curves-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; fcu; fcu= next) {
<a name="l01169"></a>01169         next= fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a381b65464374cad861b80c44b9ae0759">next</a>;
<a name="l01170"></a>01170 
<a name="l01171"></a>01171         <span class="keywordflow">if</span> (!strncmp(fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>, <span class="stringliteral">&quot;splines&quot;</span>, 7)) <a class="code" href="../../d7/d55/editcurve_8c.html#a4daf74b5ab393073e35ac9cf3e77f794">fcurve_remove</a>(ad, orig_curves, fcu);
<a name="l01172"></a>01172         <span class="keywordflow">else</span> <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;curves, fcu);
<a name="l01173"></a>01173     }
<a name="l01174"></a>01174 
<a name="l01175"></a>01175     *orig_curves= curves;
<a name="l01176"></a>01176 }
<a name="l01177"></a>01177 
<a name="l01178"></a>01178 <span class="comment">/* return 0 if animation data wasn&#39;t changed, 1 otherwise */</span>
<a name="l01179"></a><a class="code" href="../../db/d71/ED__curve_8h.html#a5b94da0912bdb5fbd6f3e3806aaf9c17">01179</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a1a79334fb2fbb2d4951b7196c64a9edb">ED_curve_updateAnimPaths</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu)
<a name="l01180"></a>01180 {
<a name="l01181"></a>01181     <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *ad= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(&amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>);
<a name="l01182"></a>01182 
<a name="l01183"></a>01183     <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d55/editcurve_8c.html#a25f623beacaa9664fe6292bff21ab6c9">curve_is_animated</a>(cu)) <span class="keywordflow">return</span> 0;
<a name="l01184"></a>01184 
<a name="l01185"></a>01185     <span class="keywordflow">if</span> (ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>)
<a name="l01186"></a>01186         <a class="code" href="../../d7/d55/editcurve_8c.html#adcbf914ff9eccc1d30e52cf26cf90f38">curve_rename_fcurves</a>(cu, &amp;ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>-&gt;<a class="code" href="../../d1/d48/structbAction.html#a17c9f9250f377305171640e7a4aa7666">curves</a>);
<a name="l01187"></a>01187 
<a name="l01188"></a>01188     <a class="code" href="../../d7/d55/editcurve_8c.html#adcbf914ff9eccc1d30e52cf26cf90f38">curve_rename_fcurves</a>(cu, &amp;ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#aaca565f031ee1209087422d8a5d77769">drivers</a>);
<a name="l01189"></a>01189 
<a name="l01190"></a>01190     <span class="keywordflow">return</span> 1;
<a name="l01191"></a>01191 }
<a name="l01192"></a>01192 
<a name="l01193"></a>01193 <span class="comment">/* ********************* LOAD and MAKE *************** */</span>
<a name="l01194"></a>01194 
<a name="l01195"></a>01195 <span class="comment">/* load editNurb in object */</span>
<a name="l01196"></a><a class="code" href="../../db/d71/ED__curve_8h.html#a6bfbb6e25fed060cad9c5a5e0eadcd49">01196</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#abb76c0b3449541b753c8d3dff5bab511">load_editNurb</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *obedit)
<a name="l01197"></a>01197 {
<a name="l01198"></a>01198     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l01199"></a>01199 
<a name="l01200"></a>01200     <span class="keywordflow">if</span> (obedit==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l01201"></a>01201 
<a name="l01202"></a>01202     <a class="code" href="../../d7/d55/editcurve_8c.html#a5898792f9c07dc5a831d3051859cefc5">set_actNurb</a>(obedit, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01203"></a>01203 
<a name="l01204"></a>01204     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>)) {
<a name="l01205"></a>01205         <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01206"></a>01206         <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, *newnu;
<a name="l01207"></a>01207         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> newnurb= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}, oldnurb= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>;
<a name="l01208"></a>01208 
<a name="l01209"></a>01209         <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l01210"></a>01210             newnu= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a0fde69c2411c891708933b3d79c97c34">duplicateNurb</a>(nu);
<a name="l01211"></a>01211             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;newnurb, newnu);
<a name="l01212"></a>01212 
<a name="l01213"></a>01213             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l01214"></a>01214                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a4a1a66ab8e36c2a154f603635120f975">clamp_nurb_order_u</a>(nu);
<a name="l01215"></a>01215             }
<a name="l01216"></a>01216         }
<a name="l01217"></a>01217 
<a name="l01218"></a>01218         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>= newnurb;
<a name="l01219"></a>01219 
<a name="l01220"></a>01220         <a class="code" href="../../d7/d55/editcurve_8c.html#a30b44b5c7b50331a987f2cb45a193785">calc_shapeKeys</a>(obedit);
<a name="l01221"></a>01221         <a class="code" href="../../d7/d55/editcurve_8c.html#a1a79334fb2fbb2d4951b7196c64a9edb">ED_curve_updateAnimPaths</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l01222"></a>01222 
<a name="l01223"></a>01223         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aa7e3a2bafad6c23e082515885ae5294a">freeNurblist</a>(&amp;oldnurb);
<a name="l01224"></a>01224     }
<a name="l01225"></a>01225 
<a name="l01226"></a>01226     <a class="code" href="../../d7/d55/editcurve_8c.html#a5898792f9c07dc5a831d3051859cefc5">set_actNurb</a>(obedit, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01227"></a>01227 }
<a name="l01228"></a>01228 
<a name="l01229"></a>01229 <span class="comment">/* make copy in cu-&gt;editnurb */</span>
<a name="l01230"></a><a class="code" href="../../db/d71/ED__curve_8h.html#ad35eda287261a0e89e1932ce13f3bf5f">01230</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ae19e1b4a1381892b6d47c7f45c651cb4">make_editNurb</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *obedit)
<a name="l01231"></a>01231 {
<a name="l01232"></a>01232     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= (<a class="code" href="../../da/d10/structCurve.html">Curve</a>*)obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01233"></a>01233     <a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>;
<a name="l01234"></a>01234     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, *newnu, *nu_act= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01235"></a>01235     <a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a> *actkey;
<a name="l01236"></a>01236 
<a name="l01237"></a>01237 
<a name="l01238"></a>01238     <a class="code" href="../../d7/d55/editcurve_8c.html#a5898792f9c07dc5a831d3051859cefc5">set_actNurb</a>(obedit, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01239"></a>01239 
<a name="l01240"></a>01240     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>)) {
<a name="l01241"></a>01241         actkey= <a class="code" href="../../d5/d17/BKE__key_8h.html#a26244a6d5d7d9e93fd37f59e56fd075d">ob_get_keyblock</a>(obedit);
<a name="l01242"></a>01242 
<a name="l01243"></a>01243         <span class="keywordflow">if</span> (actkey) {
<a name="l01244"></a>01244             <span class="comment">// XXX strcpy(G.editModeTitleExtra, &quot;(Key) &quot;);</span>
<a name="l01245"></a>01245             <a class="code" href="../../d6/df1/ED__util_8h.html#a35ee91d4667bb7e1af76ab3f66dbd6e8">undo_editmode_clear</a>();
<a name="l01246"></a>01246             <a class="code" href="../../d5/d17/BKE__key_8h.html#ad7a0f070f892507a7feacf533d1bcb82">key_to_curve</a>(actkey, cu, &amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>);
<a name="l01247"></a>01247         }
<a name="l01248"></a>01248 
<a name="l01249"></a>01249         <span class="keywordflow">if</span> (editnurb) {
<a name="l01250"></a>01250             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aa7e3a2bafad6c23e082515885ae5294a">freeNurblist</a>(&amp;editnurb-&gt;nurbs);
<a name="l01251"></a>01251             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a1077cd2f12f95687bb546db66165e4e3">free_curve_editNurb_keyIndex</a>(editnurb);
<a name="l01252"></a>01252             editnurb-&gt;keyindex= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01253"></a>01253         }
<a name="l01254"></a>01254         <span class="keywordflow">else</span> {
<a name="l01255"></a>01255             editnurb= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a>), <span class="stringliteral">&quot;editnurb&quot;</span>);
<a name="l01256"></a>01256             cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>= editnurb;
<a name="l01257"></a>01257         }
<a name="l01258"></a>01258 
<a name="l01259"></a>01259         nu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01260"></a>01260         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;   <span class="comment">/* for select row */</span>
<a name="l01261"></a>01261 
<a name="l01262"></a>01262         <span class="keywordflow">while</span> (nu) {
<a name="l01263"></a>01263             newnu= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a0fde69c2411c891708933b3d79c97c34">duplicateNurb</a>(nu);
<a name="l01264"></a>01264             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aae5669b490cbbe44c59fba3239f4223a">test2DNurb</a>(newnu);  <span class="comment">// after join, or any other creation of curve</span>
<a name="l01265"></a>01265             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;editnurb-&gt;nurbs, newnu);
<a name="l01266"></a>01266 
<a name="l01267"></a>01267             <span class="keywordflow">if</span> (nu_act == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; <a class="code" href="../../d7/d55/editcurve_8c.html#a04a97e645bf45a68ecbbfb7a123e9cac">isNurbsel</a>(nu)) {
<a name="l01268"></a>01268                 nu_act= newnu;
<a name="l01269"></a>01269                 <a class="code" href="../../d7/d55/editcurve_8c.html#a5898792f9c07dc5a831d3051859cefc5">set_actNurb</a>(obedit, newnu);
<a name="l01270"></a>01270             }
<a name="l01271"></a>01271 
<a name="l01272"></a>01272             nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l01273"></a>01273         }
<a name="l01274"></a>01274 
<a name="l01275"></a>01275         <span class="keywordflow">if</span> (actkey)
<a name="l01276"></a>01276             editnurb-&gt;shapenr= obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a749993da86326a6394781cf252d8e903">shapenr</a>;
<a name="l01277"></a>01277 
<a name="l01278"></a>01278         <span class="comment">/* animation could be added in editmode even if there was no animdata i</span>
<a name="l01279"></a>01279 <span class="comment">         * object mode hence we always need CVs index be created */</span>
<a name="l01280"></a>01280         <a class="code" href="../../d7/d55/editcurve_8c.html#ad3ab1aae6e4620a2c4932f9f798d4b5f">init_editNurb_keyIndex</a>(editnurb, &amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>);
<a name="l01281"></a>01281     }
<a name="l01282"></a>01282 }
<a name="l01283"></a>01283 
<a name="l01284"></a><a class="code" href="../../db/d71/ED__curve_8h.html#a2e23eb2773edf628e1bc993ad2742ac7">01284</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#af7995beec2696e8253f01ea892eb4bdc">free_editNurb</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *obedit)
<a name="l01285"></a>01285 {
<a name="l01286"></a>01286     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01287"></a>01287 
<a name="l01288"></a>01288     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a29b5e8af8260aa0e00dcb87781f68e1f">free_curve_editNurb</a>(cu);
<a name="l01289"></a>01289 }
<a name="l01290"></a>01290 
<a name="l01291"></a><a class="code" href="../../db/d71/ED__curve_8h.html#a869ba3fea13b5bbf760026512a3c80bb">01291</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a7472517908a5b478e86461d147d169e9">CU_deselect_all</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *obedit)
<a name="l01292"></a>01292 {
<a name="l01293"></a>01293     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l01294"></a>01294 
<a name="l01295"></a>01295     <span class="keywordflow">if</span> (editnurb) {
<a name="l01296"></a>01296         <a class="code" href="../../d7/d55/editcurve_8c.html#ab54563da04b3aa1a08bb81b8f4cdd530">selectend_nurb</a>(obedit, <a class="code" href="../../d7/d55/editcurve_8c.html#a492c6ccf2bde2bebcd32e73e0933ee92">FIRST</a>, 0, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>); <span class="comment">/* set first control points as unselected */</span>
<a name="l01297"></a>01297         <a class="code" href="../../d7/d55/editcurve_8c.html#ac6fd9d82f74ba59d9463cff6c4c0f657">select_adjacent_cp</a>(editnurb, 1, 1, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>); <span class="comment">/* cascade selection */</span>
<a name="l01298"></a>01298     }
<a name="l01299"></a>01299 }
<a name="l01300"></a>01300 
<a name="l01301"></a><a class="code" href="../../db/d71/ED__curve_8h.html#aca6a6f12270e755523b6b57a4037134d">01301</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#adb224e37642ea6bb6d3a5a66aef9a3db">CU_select_all</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *obedit)
<a name="l01302"></a>01302 {
<a name="l01303"></a>01303     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l01304"></a>01304 
<a name="l01305"></a>01305     <span class="keywordflow">if</span> (editnurb) {
<a name="l01306"></a>01306         <a class="code" href="../../d7/d55/editcurve_8c.html#ab54563da04b3aa1a08bb81b8f4cdd530">selectend_nurb</a>(obedit, <a class="code" href="../../d7/d55/editcurve_8c.html#a492c6ccf2bde2bebcd32e73e0933ee92">FIRST</a>, 0, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>); <span class="comment">/* set first control points as unselected */</span>
<a name="l01307"></a>01307         <a class="code" href="../../d7/d55/editcurve_8c.html#ac6fd9d82f74ba59d9463cff6c4c0f657">select_adjacent_cp</a>(editnurb, 1, 1, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>); <span class="comment">/* cascade selection */</span>
<a name="l01308"></a>01308     }
<a name="l01309"></a>01309 }
<a name="l01310"></a>01310 
<a name="l01311"></a><a class="code" href="../../db/d71/ED__curve_8h.html#a9b9c88c493eafe8fd9a5959174a9d5ae">01311</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ac097caaf174024f3782be1d41cb83b3a">CU_select_swap</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *obedit)
<a name="l01312"></a>01312 {
<a name="l01313"></a>01313     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l01314"></a>01314 
<a name="l01315"></a>01315     <span class="keywordflow">if</span> (editnurb) {
<a name="l01316"></a>01316         <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01317"></a>01317         <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l01318"></a>01318         <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l01319"></a>01319         <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l01320"></a>01320         <span class="keywordtype">int</span> a;
<a name="l01321"></a>01321 
<a name="l01322"></a>01322         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01323"></a>01323 
<a name="l01324"></a>01324         <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l01325"></a>01325             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l01326"></a>01326                 bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l01327"></a>01327                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l01328"></a>01328                 <span class="keywordflow">while</span> (a--) {
<a name="l01329"></a>01329                     <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aaac89168848f34909c578acb0d6cca26">hide</a>==0) {
<a name="l01330"></a>01330                         bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> ^= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>; <span class="comment">/* always do the center point */</span>
<a name="l01331"></a>01331                         <span class="keywordflow">if</span> ((cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a7c8120ba8f3b7624fdd42f9d5be7b56d">drawflag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ac8abd02e52a2a9d5f305be68c732923b">CU_HIDE_HANDLES</a>)==0) {
<a name="l01332"></a>01332                             bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> ^= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l01333"></a>01333                             bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> ^= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l01334"></a>01334                         }
<a name="l01335"></a>01335                     }
<a name="l01336"></a>01336                     bezt++;
<a name="l01337"></a>01337                 }
<a name="l01338"></a>01338             }
<a name="l01339"></a>01339             <span class="keywordflow">else</span> {
<a name="l01340"></a>01340                 bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l01341"></a>01341                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l01342"></a>01342                 <span class="keywordflow">while</span> (a--) {
<a name="l01343"></a>01343                     <a class="code" href="../../d7/d55/editcurve_8c.html#a3c8fa8c7bdb6cb09f926165a1e815622">swap_selection_bpoint</a>(bp);
<a name="l01344"></a>01344                     bp++;
<a name="l01345"></a>01345                 }
<a name="l01346"></a>01346             }
<a name="l01347"></a>01347         }
<a name="l01348"></a>01348     }
<a name="l01349"></a>01349 }
<a name="l01350"></a>01350 
<a name="l01351"></a>01351 <span class="comment">/******************** separate operator ***********************/</span>
<a name="l01352"></a>01352 
<a name="l01353"></a><a class="code" href="../../d7/d55/editcurve_8c.html#adecddefbe83aeb64578cb5775a1df56a">01353</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#adecddefbe83aeb64578cb5775a1df56a">separate_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01354"></a>01354 {
<a name="l01355"></a>01355     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C);
<a name="l01356"></a>01356     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l01357"></a>01357     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, *nu1;
<a name="l01358"></a>01358     <a class="code" href="../../de/de7/structObject.html">Object</a> *oldob, *newob;
<a name="l01359"></a>01359     <a class="code" href="../../d3/da9/structBase.html">Base</a> *oldbase, *newbase;
<a name="l01360"></a>01360     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *oldcu, *newcu;
<a name="l01361"></a>01361     <a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *oldedit, *newedit;
<a name="l01362"></a>01362 
<a name="l01363"></a>01363     oldbase= <a class="code" href="../../df/d01/BKE__context_8h.html#a4f87fdb14b102e8da3f6ce0cfd5db7b4">CTX_data_active_base</a>(C);
<a name="l01364"></a>01364     oldob= oldbase-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l01365"></a>01365     oldcu= oldob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01366"></a>01366     oldedit= oldcu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>;
<a name="l01367"></a>01367 
<a name="l01368"></a>01368     <span class="keywordflow">if</span> (oldcu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>) {
<a name="l01369"></a>01369         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Can&#39;t separate a curve with vertex keys&quot;</span>);
<a name="l01370"></a>01370         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01371"></a>01371     }
<a name="l01372"></a>01372 
<a name="l01373"></a>01373     <a class="code" href="../../de/d3c/wm__cursors_8c.html#ae5b57427153f1f60f6638a537465c805">WM_cursor_wait</a>(1);
<a name="l01374"></a>01374     
<a name="l01375"></a>01375     <span class="comment">/* 1. duplicate the object and data */</span>
<a name="l01376"></a>01376     newbase= <a class="code" href="../../da/d7a/ED__object_8h.html#aa93e8afe3780f669ae8fe17af3ebcfe6">ED_object_add_duplicate</a>(bmain, scene, oldbase, 0); <span class="comment">/* 0 = fully linked */</span>
<a name="l01377"></a>01377     <a class="code" href="../../da/d7a/ED__object_8h.html#a01ac0829970381f4f64f23ca405f8ab1">ED_base_object_select</a>(newbase, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a4df561d775f9f3c0df70f202f357eabb">BA_DESELECT</a>);
<a name="l01378"></a>01378     newob= newbase-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l01379"></a>01379 
<a name="l01380"></a>01380     newcu= newob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a605671c47326150aac1fe3158c925781">copy_curve</a>(oldcu);
<a name="l01381"></a>01381     newcu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01382"></a>01382     oldcu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--; <span class="comment">/* because new curve is a copy: reduce user count */</span>
<a name="l01383"></a>01383 
<a name="l01384"></a>01384     <span class="comment">/* 2. put new object in editmode and clear it */</span>
<a name="l01385"></a>01385     <a class="code" href="../../d7/d55/editcurve_8c.html#ae19e1b4a1381892b6d47c7f45c651cb4">make_editNurb</a>(newob);
<a name="l01386"></a>01386     newedit= newcu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>;
<a name="l01387"></a>01387     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aa7e3a2bafad6c23e082515885ae5294a">freeNurblist</a>(&amp;newedit-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>);
<a name="l01388"></a>01388     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a1077cd2f12f95687bb546db66165e4e3">free_curve_editNurb_keyIndex</a>(newedit);
<a name="l01389"></a>01389 
<a name="l01390"></a>01390     <span class="comment">/* 3. move over parts from old object */</span>
<a name="l01391"></a>01391     <span class="keywordflow">for</span> (nu= oldedit-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu=nu1) {
<a name="l01392"></a>01392         nu1= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l01393"></a>01393 
<a name="l01394"></a>01394         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a04a97e645bf45a68ecbbfb7a123e9cac">isNurbsel</a>(nu)) {
<a name="l01395"></a>01395             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;oldedit-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>, nu);
<a name="l01396"></a>01396             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;newedit-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>, nu);
<a name="l01397"></a>01397         }
<a name="l01398"></a>01398     }
<a name="l01399"></a>01399 
<a name="l01400"></a>01400     <span class="comment">/* 4. put old object out of editmode */</span>
<a name="l01401"></a>01401     <a class="code" href="../../d7/d55/editcurve_8c.html#abb76c0b3449541b753c8d3dff5bab511">load_editNurb</a>(newob);
<a name="l01402"></a>01402     <a class="code" href="../../d7/d55/editcurve_8c.html#af7995beec2696e8253f01ea892eb4bdc">free_editNurb</a>(newob);
<a name="l01403"></a>01403 
<a name="l01404"></a>01404     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(&amp;oldob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>);  <span class="comment">/* this is the original one */</span>
<a name="l01405"></a>01405     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(&amp;newob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>);  <span class="comment">/* this is the separated one */</span>
<a name="l01406"></a>01406 
<a name="l01407"></a>01407     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, oldob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l01408"></a>01408 
<a name="l01409"></a>01409     <a class="code" href="../../de/d3c/wm__cursors_8c.html#ae5b57427153f1f60f6638a537465c805">WM_cursor_wait</a>(0);
<a name="l01410"></a>01410 
<a name="l01411"></a>01411     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01412"></a>01412 }
<a name="l01413"></a>01413 
<a name="l01414"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ab3f2f3ceb03807af1fce5162fa144f67">01414</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a877bd8496d585e6abe9754f29e674a24">CURVE_OT_separate</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01415"></a>01415 {
<a name="l01416"></a>01416     <span class="comment">/* identifiers */</span>
<a name="l01417"></a>01417     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Separate&quot;</span>;
<a name="l01418"></a>01418     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_separate&quot;</span>;
<a name="l01419"></a>01419     
<a name="l01420"></a>01420     <span class="comment">/* api callbacks */</span>
<a name="l01421"></a>01421     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#adecddefbe83aeb64578cb5775a1df56a">separate_exec</a>;
<a name="l01422"></a>01422     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l01423"></a>01423     
<a name="l01424"></a>01424     <span class="comment">/* flags */</span>
<a name="l01425"></a>01425     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01426"></a>01426 }
<a name="l01427"></a>01427 
<a name="l01428"></a>01428 <span class="comment">/* ******************* FLAGS ********************* */</span>
<a name="l01429"></a>01429 
<a name="l01430"></a><a class="code" href="../../d7/d55/editcurve_8c.html#adc0c5d1b38c5f011c72794c5a3d88bb4">01430</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../d7/d55/editcurve_8c.html#adc0c5d1b38c5f011c72794c5a3d88bb4">isNurbselUV</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, <span class="keywordtype">int</span> *u, <span class="keywordtype">int</span> *v, <span class="keywordtype">int</span> flag)
<a name="l01431"></a>01431 {
<a name="l01432"></a>01432     <span class="comment">/* return u!=-1:     1 row in u-direction selected. U has value between 0-pntsv </span>
<a name="l01433"></a>01433 <span class="comment">     * return v!=-1: 1 column in v-direction selected. V has value between 0-pntsu</span>
<a name="l01434"></a>01434 <span class="comment">     */</span>
<a name="l01435"></a>01435     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l01436"></a>01436     <span class="keywordtype">int</span> a, b, sel;
<a name="l01437"></a>01437 
<a name="l01438"></a>01438     *u= *v= -1;
<a name="l01439"></a>01439 
<a name="l01440"></a>01440     bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l01441"></a>01441     <span class="keywordflow">for</span> (b=0; b&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; b++) {
<a name="l01442"></a>01442         sel= 0;
<a name="l01443"></a>01443         <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; a++, bp++) {
<a name="l01444"></a>01444             <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; flag) sel++;
<a name="l01445"></a>01445         }
<a name="l01446"></a>01446         <span class="keywordflow">if</span> (sel==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) {
<a name="l01447"></a>01447             <span class="keywordflow">if</span> (*u== -1) *u= b;
<a name="l01448"></a>01448             <span class="keywordflow">else</span> <span class="keywordflow">return</span> 0;
<a name="l01449"></a>01449         }
<a name="l01450"></a>01450         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sel&gt;1) <span class="keywordflow">return</span> 0;    <span class="comment">/* because sel==1 is still ok */</span>
<a name="l01451"></a>01451     }
<a name="l01452"></a>01452 
<a name="l01453"></a>01453     <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; a++) {
<a name="l01454"></a>01454         sel= 0;
<a name="l01455"></a>01455         bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+a;
<a name="l01456"></a>01456         <span class="keywordflow">for</span> (b=0; b&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; b++, bp+=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) {
<a name="l01457"></a>01457             <span class="keywordflow">if</span> (bp-&gt;f1 &amp; flag) sel++;
<a name="l01458"></a>01458         }
<a name="l01459"></a>01459         <span class="keywordflow">if</span> (sel==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>) {
<a name="l01460"></a>01460             <span class="keywordflow">if</span> (*v== -1) *v= a;
<a name="l01461"></a>01461             <span class="keywordflow">else</span> <span class="keywordflow">return</span> 0;
<a name="l01462"></a>01462         }
<a name="l01463"></a>01463         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sel&gt;1) <span class="keywordflow">return</span> 0;
<a name="l01464"></a>01464     }
<a name="l01465"></a>01465 
<a name="l01466"></a>01466     <span class="keywordflow">if</span> (*u==-1 &amp;&amp; *v&gt;-1) <span class="keywordflow">return</span> 1;
<a name="l01467"></a>01467     <span class="keywordflow">if</span> (*v==-1 &amp;&amp; *u&gt;-1) <span class="keywordflow">return</span> 1;
<a name="l01468"></a>01468     <span class="keywordflow">return</span> 0;
<a name="l01469"></a>01469 }
<a name="l01470"></a>01470 
<a name="l01471"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a9d92d24c42cc1db29dcac1a5fe4d0e5e">01471</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a9d92d24c42cc1db29dcac1a5fe4d0e5e">setflagsNurb</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb, <span class="keywordtype">short</span> flag)
<a name="l01472"></a>01472 {
<a name="l01473"></a>01473     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l01474"></a>01474     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l01475"></a>01475     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l01476"></a>01476     <span class="keywordtype">int</span> a;
<a name="l01477"></a>01477 
<a name="l01478"></a>01478     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l01479"></a>01479         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l01480"></a>01480             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l01481"></a>01481             bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l01482"></a>01482             <span class="keywordflow">while</span> (a--) {
<a name="l01483"></a>01483                 bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a>= bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a>= bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a>= flag;
<a name="l01484"></a>01484                 bezt++;
<a name="l01485"></a>01485             }
<a name="l01486"></a>01486         }
<a name="l01487"></a>01487         <span class="keywordflow">else</span> {
<a name="l01488"></a>01488             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l01489"></a>01489             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l01490"></a>01490             <span class="keywordflow">while</span> (a--) {
<a name="l01491"></a>01491                 bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a>= flag;
<a name="l01492"></a>01492                 bp++;
<a name="l01493"></a>01493             }
<a name="l01494"></a>01494         }
<a name="l01495"></a>01495     }
<a name="l01496"></a>01496 }
<a name="l01497"></a>01497 
<a name="l01498"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a796180ab9fd26032fb9999c3b9159dc6">01498</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a796180ab9fd26032fb9999c3b9159dc6">rotateflagNurb</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb, <span class="keywordtype">short</span> flag, <span class="keywordtype">float</span> *cent, <span class="keywordtype">float</span> rotmat[][3])
<a name="l01499"></a>01499 {
<a name="l01500"></a>01500     <span class="comment">/* all verts with (flag &amp; &#39;flag&#39;) rotate */</span>
<a name="l01501"></a>01501     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l01502"></a>01502     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l01503"></a>01503     <span class="keywordtype">int</span> a;
<a name="l01504"></a>01504 
<a name="l01505"></a>01505     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l01506"></a>01506         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l01507"></a>01507             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l01508"></a>01508             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l01509"></a>01509 
<a name="l01510"></a>01510             <span class="keywordflow">while</span> (a--) {
<a name="l01511"></a>01511                 <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; flag) {
<a name="l01512"></a>01512                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3d305087815afcd193f1d6e561537c34">sub_v3_v3</a>(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, cent);
<a name="l01513"></a>01513                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(rotmat, bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l01514"></a>01514                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, cent);
<a name="l01515"></a>01515                 }
<a name="l01516"></a>01516                 bp++;
<a name="l01517"></a>01517             }
<a name="l01518"></a>01518         }
<a name="l01519"></a>01519     }
<a name="l01520"></a>01520 }
<a name="l01521"></a>01521 
<a name="l01522"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a48a612e2dee791d95090cf59ef1c8cc0">01522</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a48a612e2dee791d95090cf59ef1c8cc0">translateflagNurb</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb, <span class="keywordtype">short</span> flag, <span class="keyword">const</span> <span class="keywordtype">float</span> vec[3])
<a name="l01523"></a>01523 {
<a name="l01524"></a>01524     <span class="comment">/* all verts with (&#39;flag&#39; &amp; flag) translate */</span>
<a name="l01525"></a>01525     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l01526"></a>01526     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l01527"></a>01527     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l01528"></a>01528     <span class="keywordtype">int</span> a;
<a name="l01529"></a>01529 
<a name="l01530"></a>01530     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l01531"></a>01531         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l01532"></a>01532             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l01533"></a>01533             bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l01534"></a>01534             <span class="keywordflow">while</span> (a--) {
<a name="l01535"></a>01535                 <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> &amp; flag) <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0], vec);
<a name="l01536"></a>01536                 <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; flag) <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1], vec);
<a name="l01537"></a>01537                 <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> &amp; flag) <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2], vec);
<a name="l01538"></a>01538                 bezt++;
<a name="l01539"></a>01539             }
<a name="l01540"></a>01540         }
<a name="l01541"></a>01541         <span class="keywordflow">else</span> {
<a name="l01542"></a>01542             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l01543"></a>01543             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l01544"></a>01544             <span class="keywordflow">while</span> (a--) {
<a name="l01545"></a>01545                 <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; flag) <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, vec);
<a name="l01546"></a>01546                 bp++;
<a name="l01547"></a>01547             }
<a name="l01548"></a>01548         }
<a name="l01549"></a>01549 
<a name="l01550"></a>01550         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aae5669b490cbbe44c59fba3239f4223a">test2DNurb</a>(nu);
<a name="l01551"></a>01551     }
<a name="l01552"></a>01552 }
<a name="l01553"></a>01553 
<a name="l01554"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a1aac20087c95194cfb0ca65e23676d2d">01554</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a1aac20087c95194cfb0ca65e23676d2d">weightflagNurb</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb, <span class="keywordtype">short</span> flag, <span class="keywordtype">float</span> w)
<a name="l01555"></a>01555 {
<a name="l01556"></a>01556     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l01557"></a>01557     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l01558"></a>01558     <span class="keywordtype">int</span> a;
<a name="l01559"></a>01559 
<a name="l01560"></a>01560     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l01561"></a>01561         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l01562"></a>01562             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l01563"></a>01563             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l01564"></a>01564             <span class="keywordflow">while</span> (a--) {
<a name="l01565"></a>01565                 <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; flag) {
<a name="l01566"></a>01566                     <span class="comment">/* a mode used to exist for replace/multiple but is was unused */</span>
<a name="l01567"></a>01567                     bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[3]*= w;
<a name="l01568"></a>01568                 }
<a name="l01569"></a>01569                 bp++;
<a name="l01570"></a>01570             }
<a name="l01571"></a>01571         }
<a name="l01572"></a>01572     }
<a name="l01573"></a>01573 }
<a name="l01574"></a>01574 
<a name="l01575"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a623d8d8399666a4e5f06ab4cdbc30662">01575</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a623d8d8399666a4e5f06ab4cdbc30662">deleteflagNurb</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op), <span class="keywordtype">int</span> flag)
<a name="l01576"></a>01576 {
<a name="l01577"></a>01577     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l01578"></a>01578     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01579"></a>01579     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l01580"></a>01580     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l01581"></a>01581     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp, *bpn, *newbp;
<a name="l01582"></a>01582     <span class="keywordtype">int</span> a, b, newu, newv, sel;
<a name="l01583"></a>01583 
<a name="l01584"></a>01584     <span class="keywordflow">if</span> (obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>);
<a name="l01585"></a>01585     <span class="keywordflow">else</span> <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01586"></a>01586 
<a name="l01587"></a>01587     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01588"></a>01588 
<a name="l01589"></a>01589     nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01590"></a>01590     <span class="keywordflow">while</span> (nu) {
<a name="l01591"></a>01591         next= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l01592"></a>01592 
<a name="l01593"></a>01593         <span class="comment">/* is entire nurb selected */</span>
<a name="l01594"></a>01594         bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l01595"></a>01595         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l01596"></a>01596         <span class="keywordflow">while</span> (a) {
<a name="l01597"></a>01597             a--;
<a name="l01598"></a>01598             <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; flag);
<a name="l01599"></a>01599             <span class="keywordflow">else</span> <span class="keywordflow">break</span>;
<a name="l01600"></a>01600             bp++;
<a name="l01601"></a>01601         }
<a name="l01602"></a>01602         <span class="keywordflow">if</span> (a==0) {
<a name="l01603"></a>01603             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(editnurb, nu);
<a name="l01604"></a>01604             <a class="code" href="../../d7/d55/editcurve_8c.html#af7adf69fe907e412354b5f0ed2f7f754">keyIndex_delNurb</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>, nu);
<a name="l01605"></a>01605             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a612d0057fcc6d1a836444e79a539a749">freeNurb</a>(nu); nu=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01606"></a>01606         }
<a name="l01607"></a>01607         <span class="keywordflow">else</span> {
<a name="l01608"></a>01608             <span class="comment">/* is nurb in U direction selected */</span>
<a name="l01609"></a>01609             newv= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l01610"></a>01610             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l01611"></a>01611             <span class="keywordflow">for</span> (b=0; b&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; b++) {
<a name="l01612"></a>01612                 sel= 0;
<a name="l01613"></a>01613                 <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; a++, bp++) {
<a name="l01614"></a>01614                     <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; flag) sel++;
<a name="l01615"></a>01615                 }
<a name="l01616"></a>01616                 <span class="keywordflow">if</span> (sel==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) {
<a name="l01617"></a>01617                     newv--;
<a name="l01618"></a>01618                 }
<a name="l01619"></a>01619                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sel&gt;=1) {
<a name="l01620"></a>01620                     <span class="comment">/* don&#39;t delete */</span>
<a name="l01621"></a>01621                     <span class="keywordflow">break</span>;
<a name="l01622"></a>01622                 }
<a name="l01623"></a>01623             }
<a name="l01624"></a>01624             <span class="keywordflow">if</span> (newv!=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> &amp;&amp; b==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>)    {
<a name="l01625"></a>01625                 <span class="comment">/* delete */</span>
<a name="l01626"></a>01626                 bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l01627"></a>01627                 bpn = newbp =
<a name="l01628"></a>01628                     (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*) <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(newv * nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>), <span class="stringliteral">&quot;deleteNurb&quot;</span>);
<a name="l01629"></a>01629                 <span class="keywordflow">for</span> (b=0; b&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; b++) {
<a name="l01630"></a>01630                     <span class="keywordflow">if</span> ((bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; flag)==0) {
<a name="l01631"></a>01631                         memcpy(bpn, bp, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>));
<a name="l01632"></a>01632                         <a class="code" href="../../d7/d55/editcurve_8c.html#a0233d7e5f22fabe021f3902c3127dafc">keyIndex_updateBP</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>, bp, bpn, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>);
<a name="l01633"></a>01633                         bpn+= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l01634"></a>01634                     }
<a name="l01635"></a>01635                     <span class="keywordflow">else</span> {
<a name="l01636"></a>01636                         <a class="code" href="../../d7/d55/editcurve_8c.html#aec85603d62905f44b470b68e5d6a097e">keyIndex_delBP</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>, bp);
<a name="l01637"></a>01637                     }
<a name="l01638"></a>01638                     bp+= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l01639"></a>01639                 }
<a name="l01640"></a>01640                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>= newv;
<a name="l01641"></a>01641                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l01642"></a>01642                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= newbp;
<a name="l01643"></a>01643                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aab66d7747f889ce8c05f6c0bc8d0a375">clamp_nurb_order_v</a>(nu);
<a name="l01644"></a>01644 
<a name="l01645"></a>01645                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67a9890171625dedc07c1b7566703ddb">nurbs_knot_calc_v</a>(nu);
<a name="l01646"></a>01646             }
<a name="l01647"></a>01647             <span class="keywordflow">else</span> {
<a name="l01648"></a>01648                 <span class="comment">/* is the nurb in V direction selected */</span>
<a name="l01649"></a>01649                 newu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l01650"></a>01650                 <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; a++) {
<a name="l01651"></a>01651                     bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+a;
<a name="l01652"></a>01652                     sel= 0;
<a name="l01653"></a>01653                     <span class="keywordflow">for</span> (b=0; b&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; b++, bp+=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) {
<a name="l01654"></a>01654                         <span class="keywordflow">if</span> (bp-&gt;f1 &amp; flag) sel++;
<a name="l01655"></a>01655                     }
<a name="l01656"></a>01656                     <span class="keywordflow">if</span> (sel==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>) {
<a name="l01657"></a>01657                         newu--;
<a name="l01658"></a>01658                     }
<a name="l01659"></a>01659                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sel&gt;=1) {
<a name="l01660"></a>01660                         <span class="comment">/* don&#39;t delete */</span>
<a name="l01661"></a>01661                         <span class="keywordflow">break</span>;
<a name="l01662"></a>01662                     }
<a name="l01663"></a>01663                 }
<a name="l01664"></a>01664                 <span class="keywordflow">if</span> (newu!=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> &amp;&amp; a==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>)    {
<a name="l01665"></a>01665                     <span class="comment">/* delete */</span>
<a name="l01666"></a>01666                     bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l01667"></a>01667                     bpn = newbp =
<a name="l01668"></a>01668                         (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*) <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(newu * nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>), <span class="stringliteral">&quot;deleteNurb&quot;</span>);
<a name="l01669"></a>01669                     <span class="keywordflow">for</span> (b=0; b&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; b++) {
<a name="l01670"></a>01670                         <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; a++, bp++) {
<a name="l01671"></a>01671                             <span class="keywordflow">if</span> ((bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; flag)==0) {
<a name="l01672"></a>01672                                 *bpn= *bp;
<a name="l01673"></a>01673                                 <a class="code" href="../../d7/d55/editcurve_8c.html#a0233d7e5f22fabe021f3902c3127dafc">keyIndex_updateBP</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>, bp, bpn, 1);
<a name="l01674"></a>01674                                 bpn++;
<a name="l01675"></a>01675                             }
<a name="l01676"></a>01676                             <span class="keywordflow">else</span> {
<a name="l01677"></a>01677                                 <a class="code" href="../../d7/d55/editcurve_8c.html#aec85603d62905f44b470b68e5d6a097e">keyIndex_delBP</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>, bp);
<a name="l01678"></a>01678                             }
<a name="l01679"></a>01679                         }
<a name="l01680"></a>01680                     }
<a name="l01681"></a>01681                     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l01682"></a>01682                     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= newbp;
<a name="l01683"></a>01683                     <span class="keywordflow">if</span> (newu==1 &amp;&amp; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>&gt;1) {    <span class="comment">/* make a U spline */</span>
<a name="l01684"></a>01684                         nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l01685"></a>01685                         nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>= 1;
<a name="l01686"></a>01686                         <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<span class="keywordtype">short</span>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>);
<a name="l01687"></a>01687                         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a4a1a66ab8e36c2a154f603635120f975">clamp_nurb_order_u</a>(nu);
<a name="l01688"></a>01688                         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>);
<a name="l01689"></a>01689                         nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01690"></a>01690                     }
<a name="l01691"></a>01691                     <span class="keywordflow">else</span> {
<a name="l01692"></a>01692                         nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= newu;
<a name="l01693"></a>01693                         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a4a1a66ab8e36c2a154f603635120f975">clamp_nurb_order_u</a>(nu);
<a name="l01694"></a>01694                     }
<a name="l01695"></a>01695                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(nu);
<a name="l01696"></a>01696                 }
<a name="l01697"></a>01697             }
<a name="l01698"></a>01698         }
<a name="l01699"></a>01699         nu= <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l01700"></a>01700     }
<a name="l01701"></a>01701 
<a name="l01702"></a>01702     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a1a79334fb2fbb2d4951b7196c64a9edb">ED_curve_updateAnimPaths</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>))
<a name="l01703"></a>01703         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ab2ab88214d816c47ebee1a985b0e68b3">ND_KEYS</a>, obedit);
<a name="l01704"></a>01704 
<a name="l01705"></a>01705     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01706"></a>01706 }
<a name="l01707"></a>01707 
<a name="l01708"></a>01708 <span class="comment">/* only for OB_SURF */</span>
<a name="l01709"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a0140a436787b2f39ff2a2313ff47a796">01709</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a0140a436787b2f39ff2a2313ff47a796">extrudeflagNurb</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb, <span class="keywordtype">int</span> flag)
<a name="l01710"></a>01710 {
<a name="l01711"></a>01711     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l01712"></a>01712     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp, *bpn, *newbp;
<a name="l01713"></a>01713     <span class="keywordtype">int</span> ok= 0, a, u, v, <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l01714"></a>01714 
<a name="l01715"></a>01715     nu= editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01716"></a>01716     <span class="keywordflow">while</span> (nu) {
<a name="l01717"></a>01717 
<a name="l01718"></a>01718         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>==1) {
<a name="l01719"></a>01719             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l01720"></a>01720             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l01721"></a>01721             <span class="keywordflow">while</span> (a) {
<a name="l01722"></a>01722                 <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; flag);
<a name="l01723"></a>01723                 <span class="keywordflow">else</span> <span class="keywordflow">break</span>;
<a name="l01724"></a>01724                 bp++;
<a name="l01725"></a>01725                 a--;
<a name="l01726"></a>01726             }
<a name="l01727"></a>01727             <span class="keywordflow">if</span> (a==0) {
<a name="l01728"></a>01728                 ok= 1;
<a name="l01729"></a>01729                 newbp =
<a name="l01730"></a>01730                     (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(2 * nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>), <span class="stringliteral">&quot;extrudeNurb1&quot;</span>);
<a name="l01731"></a>01731                 <a class="code" href="../../d7/d55/editcurve_8c.html#acc934a7779bd2eee63200ad5c7bdd0d4">ED_curve_bpcpy</a>(editnurb, newbp, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>);
<a name="l01732"></a>01732                 bp= newbp+ nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l01733"></a>01733                 <a class="code" href="../../d7/d55/editcurve_8c.html#acc934a7779bd2eee63200ad5c7bdd0d4">ED_curve_bpcpy</a>(editnurb, bp, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>);
<a name="l01734"></a>01734                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l01735"></a>01735                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= newbp;
<a name="l01736"></a>01736                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l01737"></a>01737                 <span class="keywordflow">while</span> (a--) {
<a name="l01738"></a>01738                     <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, flag, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l01739"></a>01739                     <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(newbp, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, flag, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l01740"></a>01740                     bp++; 
<a name="l01741"></a>01741                     newbp++;
<a name="l01742"></a>01742                 }
<a name="l01743"></a>01743 
<a name="l01744"></a>01744                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>= 2;
<a name="l01745"></a>01745                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>= 2;
<a name="l01746"></a>01746                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67a9890171625dedc07c1b7566703ddb">nurbs_knot_calc_v</a>(nu);
<a name="l01747"></a>01747             }
<a name="l01748"></a>01748         }
<a name="l01749"></a>01749         <span class="keywordflow">else</span> {
<a name="l01750"></a>01750             <span class="comment">/* which row or column is selected */</span>
<a name="l01751"></a>01751 
<a name="l01752"></a>01752             <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d55/editcurve_8c.html#adc0c5d1b38c5f011c72794c5a3d88bb4">isNurbselUV</a>(nu, &amp;u, &amp;v, flag) ) {
<a name="l01753"></a>01753 
<a name="l01754"></a>01754                 <span class="comment">/* deselect all */</span>
<a name="l01755"></a>01755                 bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l01756"></a>01756                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l01757"></a>01757                 <span class="keywordflow">while</span> (a--) {
<a name="l01758"></a>01758                     <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, flag, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l01759"></a>01759                     bp++;
<a name="l01760"></a>01760                 }
<a name="l01761"></a>01761 
<a name="l01762"></a>01762                 <span class="keywordflow">if</span> (u==0 || u== nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>-1) {      <span class="comment">/* row in u-direction selected */</span>
<a name="l01763"></a>01763                     ok= 1;
<a name="l01764"></a>01764                     newbp =
<a name="l01765"></a>01765                         (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*) <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> + 1)
<a name="l01766"></a>01766                                           * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af73d40f9d8f8b10f64359a0704799ac9">BPoint</a>), <span class="stringliteral">&quot;extrudeNurb1&quot;</span>);
<a name="l01767"></a>01767                     <span class="keywordflow">if</span> (u==0) {
<a name="l01768"></a>01768                         len= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l01769"></a>01769                         <a class="code" href="../../d7/d55/editcurve_8c.html#acc934a7779bd2eee63200ad5c7bdd0d4">ED_curve_bpcpy</a>(editnurb, newbp+nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, len);
<a name="l01770"></a>01770                         <a class="code" href="../../d7/d55/editcurve_8c.html#acc934a7779bd2eee63200ad5c7bdd0d4">ED_curve_bpcpy</a>(editnurb, newbp, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>);
<a name="l01771"></a>01771                         bp= newbp;
<a name="l01772"></a>01772                     }
<a name="l01773"></a>01773                     <span class="keywordflow">else</span> {
<a name="l01774"></a>01774                         len= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l01775"></a>01775                         <a class="code" href="../../d7/d55/editcurve_8c.html#acc934a7779bd2eee63200ad5c7bdd0d4">ED_curve_bpcpy</a>(editnurb, newbp, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, len);
<a name="l01776"></a>01776                         <a class="code" href="../../d7/d55/editcurve_8c.html#acc934a7779bd2eee63200ad5c7bdd0d4">ED_curve_bpcpy</a>(editnurb, newbp+len, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+len-nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>);
<a name="l01777"></a>01777                         bp= newbp+<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l01778"></a>01778                     }
<a name="l01779"></a>01779 
<a name="l01780"></a>01780                     a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l01781"></a>01781                     <span class="keywordflow">while</span> (a--) {
<a name="l01782"></a>01782                         <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, flag, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l01783"></a>01783                         bp++;
<a name="l01784"></a>01784                     }
<a name="l01785"></a>01785 
<a name="l01786"></a>01786                     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l01787"></a>01787                     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= newbp;
<a name="l01788"></a>01788                     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>++;
<a name="l01789"></a>01789                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67a9890171625dedc07c1b7566703ddb">nurbs_knot_calc_v</a>(nu);
<a name="l01790"></a>01790                 }
<a name="l01791"></a>01791                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (v==0 || v== nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1) {     <span class="comment">/* column in v-direction selected */</span>
<a name="l01792"></a>01792                     ok= 1;
<a name="l01793"></a>01793                     bpn = newbp =
<a name="l01794"></a>01794                         (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*) <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>((nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> + 1) * nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af73d40f9d8f8b10f64359a0704799ac9">BPoint</a>), <span class="stringliteral">&quot;extrudeNurb1&quot;</span>);
<a name="l01795"></a>01795                     bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l01796"></a>01796 
<a name="l01797"></a>01797                     <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; a++) {
<a name="l01798"></a>01798                         <span class="keywordflow">if</span> (v==0) {
<a name="l01799"></a>01799                             *bpn= *bp;
<a name="l01800"></a>01800                             bpn-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> |= flag;
<a name="l01801"></a>01801                             bpn++;
<a name="l01802"></a>01802                         }
<a name="l01803"></a>01803                         <a class="code" href="../../d7/d55/editcurve_8c.html#acc934a7779bd2eee63200ad5c7bdd0d4">ED_curve_bpcpy</a>(editnurb, bpn, bp, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>);
<a name="l01804"></a>01804                         bp+= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l01805"></a>01805                         bpn+= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l01806"></a>01806                         <span class="keywordflow">if</span> (v== nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1) {
<a name="l01807"></a>01807                             *bpn= *(bp-1);
<a name="l01808"></a>01808                             bpn-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> |= flag;
<a name="l01809"></a>01809                             bpn++;
<a name="l01810"></a>01810                         }
<a name="l01811"></a>01811                     }
<a name="l01812"></a>01812 
<a name="l01813"></a>01813                     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l01814"></a>01814                     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= newbp;
<a name="l01815"></a>01815                     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>++;
<a name="l01816"></a>01816                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(nu);
<a name="l01817"></a>01817                 }
<a name="l01818"></a>01818             }
<a name="l01819"></a>01819         }
<a name="l01820"></a>01820         nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l01821"></a>01821     }
<a name="l01822"></a>01822 
<a name="l01823"></a>01823     <span class="keywordflow">return</span> ok;
<a name="l01824"></a>01824 }
<a name="l01825"></a>01825 
<a name="l01826"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a5bae7805aef4ea3a09d29afb0a300b93">01826</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a5bae7805aef4ea3a09d29afb0a300b93">adduplicateflagNurb</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *obedit, <span class="keywordtype">short</span> flag)
<a name="l01827"></a>01827 {
<a name="l01828"></a>01828     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l01829"></a>01829     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, *newnu;
<a name="l01830"></a>01830     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt, *bezt1;
<a name="l01831"></a>01831     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp, *bp1;
<a name="l01832"></a>01832     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= (<a class="code" href="../../da/d10/structCurve.html">Curve</a>*)obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01833"></a>01833     <span class="keywordtype">int</span> a, b, starta, enda, newu, newv;
<a name="l01834"></a>01834     <span class="keywordtype">char</span> *usel;
<a name="l01835"></a>01835 
<a name="l01836"></a>01836     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01837"></a>01837 
<a name="l01838"></a>01838     nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>;
<a name="l01839"></a>01839     while (nu) {
<a name="l01840"></a>01840         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l01841"></a>01841             bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l01842"></a>01842             <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; a++) {
<a name="l01843"></a>01843                 enda= -1;
<a name="l01844"></a>01844                 starta= a;
<a name="l01845"></a>01845                 <span class="keywordflow">while</span> ( (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> &amp; flag) || (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; flag) || (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> &amp; flag) ) {
<a name="l01846"></a>01846                     <a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">select_beztriple</a>(bezt, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, flag, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l01847"></a>01847                     enda=a;
<a name="l01848"></a>01848                     <span class="keywordflow">if</span> (a&gt;=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1) <span class="keywordflow">break</span>;
<a name="l01849"></a>01849                     a++;
<a name="l01850"></a>01850                     bezt++;
<a name="l01851"></a>01851                 }
<a name="l01852"></a>01852                 <span class="keywordflow">if</span> (enda&gt;=starta) {
<a name="l01853"></a>01853                     newnu = (<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>), <span class="stringliteral">&quot;adduplicateN&quot;</span>);  
<a name="l01854"></a>01854                     memcpy(newnu, nu, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>));
<a name="l01855"></a>01855                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(editnurb, newnu);
<a name="l01856"></a>01856                     <a class="code" href="../../d7/d55/editcurve_8c.html#a5898792f9c07dc5a831d3051859cefc5">set_actNurb</a>(obedit, newnu);
<a name="l01857"></a>01857                     newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= enda-starta+1;
<a name="l01858"></a>01858                     newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>=
<a name="l01859"></a>01859                         (<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>((enda - starta + 1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aafa4ace0bba7528ab007eabe81cbfc10">BezTriple</a>), <span class="stringliteral">&quot;adduplicateN&quot;</span>);  
<a name="l01860"></a>01860                     memcpy(newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+starta, newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*<span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>));
<a name="l01861"></a>01861 
<a name="l01862"></a>01862                     b= newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l01863"></a>01863                     bezt1= newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l01864"></a>01864                     <span class="keywordflow">while</span> (b--) {
<a name="l01865"></a>01865                         <a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">select_beztriple</a>(bezt1, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, flag, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l01866"></a>01866                         bezt1++;
<a name="l01867"></a>01867                     }
<a name="l01868"></a>01868 
<a name="l01869"></a>01869                     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) {
<a name="l01870"></a>01870                         <span class="keywordflow">if</span> (starta!=0 || enda!=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1) {
<a name="l01871"></a>01871                             newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp;= ~<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>;
<a name="l01872"></a>01872                         }
<a name="l01873"></a>01873                     }
<a name="l01874"></a>01874                 }
<a name="l01875"></a>01875                 bezt++;
<a name="l01876"></a>01876             }
<a name="l01877"></a>01877         }
<a name="l01878"></a>01878         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>==1) {    <span class="comment">/* because UV Nurb has a different method for dupli */</span>
<a name="l01879"></a>01879             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l01880"></a>01880             <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; a++) {
<a name="l01881"></a>01881                 enda= -1;
<a name="l01882"></a>01882                 starta= a;
<a name="l01883"></a>01883                 <span class="keywordflow">while</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; flag) {
<a name="l01884"></a>01884                     <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, flag, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l01885"></a>01885                     enda= a;
<a name="l01886"></a>01886                     <span class="keywordflow">if</span> (a&gt;=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1) <span class="keywordflow">break</span>;
<a name="l01887"></a>01887                     a++;
<a name="l01888"></a>01888                     bp++;
<a name="l01889"></a>01889                 }
<a name="l01890"></a>01890                 <span class="keywordflow">if</span> (enda&gt;=starta) {
<a name="l01891"></a>01891                     newnu = (<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>), <span class="stringliteral">&quot;adduplicateN3&quot;</span>);  
<a name="l01892"></a>01892                     memcpy(newnu, nu, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>));
<a name="l01893"></a>01893                     <a class="code" href="../../d7/d55/editcurve_8c.html#a5898792f9c07dc5a831d3051859cefc5">set_actNurb</a>(obedit, newnu);
<a name="l01894"></a>01894                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(editnurb, newnu);
<a name="l01895"></a>01895                     newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= enda-starta+1;
<a name="l01896"></a>01896                     newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> = (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>((enda-starta+1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af73d40f9d8f8b10f64359a0704799ac9">BPoint</a>), <span class="stringliteral">&quot;adduplicateN4&quot;</span>);
<a name="l01897"></a>01897                     memcpy(newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+starta, newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>));
<a name="l01898"></a>01898 
<a name="l01899"></a>01899                     b= newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l01900"></a>01900                     bp1= newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l01901"></a>01901                     <span class="keywordflow">while</span> (b--) {
<a name="l01902"></a>01902                         <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp1, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, flag, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l01903"></a>01903                         bp1++;
<a name="l01904"></a>01904                     }
<a name="l01905"></a>01905 
<a name="l01906"></a>01906                     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) {
<a name="l01907"></a>01907                         <span class="keywordflow">if</span> (starta!=0 || enda!=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1) {
<a name="l01908"></a>01908                             newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp;= ~<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>;
<a name="l01909"></a>01909                         }
<a name="l01910"></a>01910                     }
<a name="l01911"></a>01911 
<a name="l01912"></a>01912                     <span class="comment">/* knots */</span>
<a name="l01913"></a>01913                     newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01914"></a>01914                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(newnu);
<a name="l01915"></a>01915                 }
<a name="l01916"></a>01916                 bp++;
<a name="l01917"></a>01917             }
<a name="l01918"></a>01918         }
<a name="l01919"></a>01919         <span class="keywordflow">else</span> {
<a name="l01920"></a>01920             <span class="comment">/* a rectangular area in nurb has to be selected */</span>
<a name="l01921"></a>01921             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a04a97e645bf45a68ecbbfb7a123e9cac">isNurbsel</a>(nu)) {
<a name="l01922"></a>01922                 usel= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>, <span class="stringliteral">&quot;adduplicateN4&quot;</span>);
<a name="l01923"></a>01923                 bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l01924"></a>01924                 <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; a++) {
<a name="l01925"></a>01925                     <span class="keywordflow">for</span> (b=0; b&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; b++, bp++) {
<a name="l01926"></a>01926                         <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; flag) usel[b]++;
<a name="l01927"></a>01927                     }
<a name="l01928"></a>01928                 }
<a name="l01929"></a>01929                 newu= 0;
<a name="l01930"></a>01930                 newv= 0;
<a name="l01931"></a>01931                 <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; a++) {
<a name="l01932"></a>01932                     <span class="keywordflow">if</span> (usel[a]) {
<a name="l01933"></a>01933                         <span class="keywordflow">if</span> (newv==0 || usel[a]==newv) {
<a name="l01934"></a>01934                             newv= usel[a];
<a name="l01935"></a>01935                             newu++;
<a name="l01936"></a>01936                         }
<a name="l01937"></a>01937                         <span class="keywordflow">else</span> {
<a name="l01938"></a>01938                             newv= 0;
<a name="l01939"></a>01939                             <span class="keywordflow">break</span>;
<a name="l01940"></a>01940                         }
<a name="l01941"></a>01941                     }
<a name="l01942"></a>01942                 }
<a name="l01943"></a>01943                 <span class="keywordflow">if</span> (newu==0 || newv==0) {
<a name="l01944"></a>01944                     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635a1207ca157c84a6be5a8a36c691c4aa72">G_DEBUG</a>)
<a name="l01945"></a>01945                         printf(<span class="stringliteral">&quot;Can&#39;t duplicate Nurb\n&quot;</span>);
<a name="l01946"></a>01946                 }
<a name="l01947"></a>01947                 <span class="keywordflow">else</span> {
<a name="l01948"></a>01948 
<a name="l01949"></a>01949                     <span class="keywordflow">if</span> (newu==1) <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<span class="keywordtype">short</span>, newu, newv);
<a name="l01950"></a>01950 
<a name="l01951"></a>01951                     newnu = (<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>), <span class="stringliteral">&quot;adduplicateN5&quot;</span>);
<a name="l01952"></a>01952                     memcpy(newnu, nu, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>));
<a name="l01953"></a>01953                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(editnurb, newnu);
<a name="l01954"></a>01954                     <a class="code" href="../../d7/d55/editcurve_8c.html#a5898792f9c07dc5a831d3051859cefc5">set_actNurb</a>(obedit, newnu);
<a name="l01955"></a>01955                     newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= newu;
<a name="l01956"></a>01956                     newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>= newv;
<a name="l01957"></a>01957                     newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> =
<a name="l01958"></a>01958                         (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(newu * newv * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>), <span class="stringliteral">&quot;adduplicateN6&quot;</span>);
<a name="l01959"></a>01959                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a4a1a66ab8e36c2a154f603635120f975">clamp_nurb_order_u</a>(newnu);
<a name="l01960"></a>01960                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aab66d7747f889ce8c05f6c0bc8d0a375">clamp_nurb_order_v</a>(newnu);
<a name="l01961"></a>01961                     
<a name="l01962"></a>01962                     newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>= newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01963"></a>01963                     
<a name="l01964"></a>01964                     bp= newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l01965"></a>01965                     bp1= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l01966"></a>01966                     <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; a++) {
<a name="l01967"></a>01967                         <span class="keywordflow">for</span> (b=0; b&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; b++, bp1++) {
<a name="l01968"></a>01968                             <span class="keywordflow">if</span> (bp1-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; flag) {
<a name="l01969"></a>01969                                 memcpy(bp, bp1, <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>));
<a name="l01970"></a>01970                                 <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp1, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, flag, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l01971"></a>01971                                 bp++;
<a name="l01972"></a>01972                             }
<a name="l01973"></a>01973                         }
<a name="l01974"></a>01974                     }
<a name="l01975"></a>01975                     <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfc/BKE__curve_8h.html#afcb8fc1bb7820c4260d027f5b7a011e3">check_valid_nurb_u</a>(newnu)) {
<a name="l01976"></a>01976                         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>==newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> &amp;&amp; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>) {
<a name="l01977"></a>01977                             newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>( nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a> );
<a name="l01978"></a>01978                         }
<a name="l01979"></a>01979                         <span class="keywordflow">else</span> {
<a name="l01980"></a>01980                             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(newnu);
<a name="l01981"></a>01981                         }
<a name="l01982"></a>01982                     }
<a name="l01983"></a>01983                     <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfc/BKE__curve_8h.html#a58b3e106cf926fda72a45e414be77d2e">check_valid_nurb_v</a>(newnu)) {
<a name="l01984"></a>01984                         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>==newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> &amp;&amp; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>) {
<a name="l01985"></a>01985                             newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>( nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a> );
<a name="l01986"></a>01986                         }
<a name="l01987"></a>01987                         <span class="keywordflow">else</span> {
<a name="l01988"></a>01988                             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67a9890171625dedc07c1b7566703ddb">nurbs_knot_calc_v</a>(newnu);
<a name="l01989"></a>01989                         }
<a name="l01990"></a>01990                     }
<a name="l01991"></a>01991                 }
<a name="l01992"></a>01992                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(usel);
<a name="l01993"></a>01993             }
<a name="l01994"></a>01994         }
<a name="l01995"></a>01995 
<a name="l01996"></a>01996         nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#aa5c79f1575e45d45f588bc7df2e37a6d">prev</a>;
<a name="l01997"></a>01997     }
<a name="l01998"></a>01998     
<a name="l01999"></a>01999     <span class="comment">/* actnu changed */</span>
<a name="l02000"></a>02000 }
<a name="l02001"></a>02001 
<a name="l02002"></a>02002 <span class="comment">/**************** switch direction operator ***************/</span>
<a name="l02003"></a>02003 
<a name="l02004"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ae48410d0f9b82c9e49301e0a8d220685">02004</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ae48410d0f9b82c9e49301e0a8d220685">switch_direction_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l02005"></a>02005 {
<a name="l02006"></a>02006     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l02007"></a>02007     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= (<a class="code" href="../../da/d10/structCurve.html">Curve</a>*)obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l02008"></a>02008     <a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>;
<a name="l02009"></a>02009     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l02010"></a>02010 
<a name="l02011"></a>02011     for (nu= editnurb-&gt;nurbs.first; nu; nu= nu-&gt;next)
<a name="l02012"></a>02012         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a04a97e645bf45a68ecbbfb7a123e9cac">isNurbsel</a>(nu)) {
<a name="l02013"></a>02013             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a93948a41f393b373ddd267796c058b81">switchdirectionNurb</a>(nu);
<a name="l02014"></a>02014             <a class="code" href="../../d7/d55/editcurve_8c.html#a7a388a6c30aa6e3b10428e82a6e29615">keyData_switchDirectionNurb</a>(cu, nu);
<a name="l02015"></a>02015         }
<a name="l02016"></a>02016 
<a name="l02017"></a>02017     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a1a79334fb2fbb2d4951b7196c64a9edb">ED_curve_updateAnimPaths</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>))
<a name="l02018"></a>02018         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ab2ab88214d816c47ebee1a985b0e68b3">ND_KEYS</a>, obedit);
<a name="l02019"></a>02019 
<a name="l02020"></a>02020     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l02021"></a>02021     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l02022"></a>02022 
<a name="l02023"></a>02023     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02024"></a>02024 }
<a name="l02025"></a>02025 
<a name="l02026"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a1fce7dfd33492853a26c5fa9ea671b7a">02026</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a54811768f630dc9fe7ec2c29dcca2540">CURVE_OT_switch_direction</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02027"></a>02027 {
<a name="l02028"></a>02028     <span class="comment">/* identifiers */</span>
<a name="l02029"></a>02029     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Switch Direction&quot;</span>;
<a name="l02030"></a>02030     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Switch direction of selected splines&quot;</span>;
<a name="l02031"></a>02031     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_switch_direction&quot;</span>;
<a name="l02032"></a>02032     
<a name="l02033"></a>02033     <span class="comment">/* api callbacks */</span>
<a name="l02034"></a>02034     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#ae48410d0f9b82c9e49301e0a8d220685">switch_direction_exec</a>;
<a name="l02035"></a>02035     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l02036"></a>02036 
<a name="l02037"></a>02037     <span class="comment">/* flags */</span>
<a name="l02038"></a>02038     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l02039"></a>02039 }
<a name="l02040"></a>02040 
<a name="l02041"></a>02041 <span class="comment">/****************** set weight operator *******************/</span>
<a name="l02042"></a>02042 
<a name="l02043"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ad25ac733749104939288240da482e3a1">02043</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ad25ac733749104939288240da482e3a1">set_goal_weight_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l02044"></a>02044 {
<a name="l02045"></a>02045     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l02046"></a>02046     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l02047"></a>02047     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l02048"></a>02048     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l02049"></a>02049     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l02050"></a>02050     <span class="keywordtype">float</span> weight= <a class="code" href="../../d3/d10/rna__access_8c.html#a99bfb3295a4df6fef29f16924fd24c79">RNA_float_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;weight&quot;</span>);
<a name="l02051"></a>02051     <span class="keywordtype">int</span> a;
<a name="l02052"></a>02052                 
<a name="l02053"></a>02053     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l02054"></a>02054         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l02055"></a>02055             <span class="keywordflow">for</span> (bezt=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>, a=0; a&lt;nu-&gt;pntsu; a++, bezt++) {
<a name="l02056"></a>02056                 <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)
<a name="l02057"></a>02057                     bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad23314941e5bb9f62166fb79d623d2c3">weight</a>= weight;
<a name="l02058"></a>02058             }
<a name="l02059"></a>02059         }
<a name="l02060"></a>02060         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>) {
<a name="l02061"></a>02061             <span class="keywordflow">for</span> (bp=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, a=0; a&lt;nu-&gt;pntsu*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; a++, bp++) {
<a name="l02062"></a>02062                 <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)
<a name="l02063"></a>02063                     bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a35879465825fbbab506bf4ccf2bbd8c2">weight</a>= weight;
<a name="l02064"></a>02064             }
<a name="l02065"></a>02065         }
<a name="l02066"></a>02066     }   
<a name="l02067"></a>02067 
<a name="l02068"></a>02068     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l02069"></a>02069     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l02070"></a>02070 
<a name="l02071"></a>02071     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02072"></a>02072 }
<a name="l02073"></a>02073 
<a name="l02074"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a2bb932a6883d76decbf85afeb9db78ce">02074</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#ae8416b49917a1fa90c69c72d8ee1fd25">CURVE_OT_spline_weight_set</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02075"></a>02075 {
<a name="l02076"></a>02076     <span class="comment">/* identifiers */</span>
<a name="l02077"></a>02077     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Set Goal Weight&quot;</span>;
<a name="l02078"></a>02078     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Set softbody goal weight for selected points&quot;</span>;
<a name="l02079"></a>02079     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_spline_weight_set&quot;</span>;
<a name="l02080"></a>02080     
<a name="l02081"></a>02081     <span class="comment">/* api callbacks */</span>
<a name="l02082"></a>02082     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#ad25ac733749104939288240da482e3a1">set_goal_weight_exec</a>;
<a name="l02083"></a>02083     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a26031163e8a1a0edac5b55f2ecdf115d">WM_operator_props_popup</a>;
<a name="l02084"></a>02084     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l02085"></a>02085 
<a name="l02086"></a>02086     <span class="comment">/* flags */</span>
<a name="l02087"></a>02087     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l02088"></a>02088 
<a name="l02089"></a>02089     <span class="comment">/* properties */</span>
<a name="l02090"></a>02090     <a class="code" href="../../dc/d7e/rna__define_8c.html#a7c03544250eafc42691e8c921a8c4005">RNA_def_float_factor</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;weight&quot;</span>, 1.0f, 0.0f, 1.0f, <span class="stringliteral">&quot;Weight&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 0.0f, 1.0f);
<a name="l02091"></a>02091 }
<a name="l02092"></a>02092 
<a name="l02093"></a>02093 <span class="comment">/******************* set radius operator ******************/</span>
<a name="l02094"></a>02094 
<a name="l02095"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ae4e8b23b58daf409b38e95cac5925efe">02095</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ae4e8b23b58daf409b38e95cac5925efe">set_radius_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l02096"></a>02096 {
<a name="l02097"></a>02097     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l02098"></a>02098     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l02099"></a>02099     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l02100"></a>02100     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l02101"></a>02101     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l02102"></a>02102     <span class="keywordtype">float</span> radius= <a class="code" href="../../d3/d10/rna__access_8c.html#a99bfb3295a4df6fef29f16924fd24c79">RNA_float_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;radius&quot;</span>);
<a name="l02103"></a>02103     <span class="keywordtype">int</span> a;
<a name="l02104"></a>02104     
<a name="l02105"></a>02105     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l02106"></a>02106         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l02107"></a>02107             <span class="keywordflow">for</span> (bezt=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>, a=0; a&lt;nu-&gt;pntsu; a++, bezt++) {
<a name="l02108"></a>02108                 <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)
<a name="l02109"></a>02109                     bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a>= radius;
<a name="l02110"></a>02110             }
<a name="l02111"></a>02111         }
<a name="l02112"></a>02112         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>) {
<a name="l02113"></a>02113             <span class="keywordflow">for</span> (bp=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, a=0; a&lt;nu-&gt;pntsu*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; a++, bp++) {
<a name="l02114"></a>02114                 <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)
<a name="l02115"></a>02115                     bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aa3142e8e1888fbd226cbe1d5ca47b4ac">radius</a>= radius;
<a name="l02116"></a>02116             }
<a name="l02117"></a>02117         }
<a name="l02118"></a>02118     }   
<a name="l02119"></a>02119 
<a name="l02120"></a>02120     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l02121"></a>02121     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l02122"></a>02122 
<a name="l02123"></a>02123     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02124"></a>02124 }
<a name="l02125"></a>02125 
<a name="l02126"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ae669bd055d82753dda90dae502dfa7c2">02126</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a15188323995bf464df176ac20c5974c0">CURVE_OT_radius_set</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02127"></a>02127 {
<a name="l02128"></a>02128     <span class="comment">/* identifiers */</span>
<a name="l02129"></a>02129     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Set Curve Radius&quot;</span>;
<a name="l02130"></a>02130     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Set per-point radius which is used for bevel tapering&quot;</span>;
<a name="l02131"></a>02131     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_radius_set&quot;</span>;
<a name="l02132"></a>02132     
<a name="l02133"></a>02133     <span class="comment">/* api callbacks */</span>
<a name="l02134"></a>02134     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#ae4e8b23b58daf409b38e95cac5925efe">set_radius_exec</a>;
<a name="l02135"></a>02135     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a26031163e8a1a0edac5b55f2ecdf115d">WM_operator_props_popup</a>;
<a name="l02136"></a>02136     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l02137"></a>02137 
<a name="l02138"></a>02138     <span class="comment">/* flags */</span>
<a name="l02139"></a>02139     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l02140"></a>02140 
<a name="l02141"></a>02141     <span class="comment">/* properties */</span>
<a name="l02142"></a>02142     <a class="code" href="../../dc/d7e/rna__define_8c.html#a040f4b08fc87a45a90e2291382e27f75">RNA_def_float</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;radius&quot;</span>, 1.0f, 0.0f, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <span class="stringliteral">&quot;Radius&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 0.0001f, 10.0f);
<a name="l02143"></a>02143 }
<a name="l02144"></a>02144 
<a name="l02145"></a>02145 <span class="comment">/********************* smooth operator ********************/</span>
<a name="l02146"></a>02146 
<a name="l02147"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a3cd5dfdac4c7a2330076b5d4ae5c99a9">02147</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a3cd5dfdac4c7a2330076b5d4ae5c99a9">smooth_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l02148"></a>02148 {
<a name="l02149"></a>02149     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l02150"></a>02150     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l02151"></a>02151     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l02152"></a>02152     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt, *beztOrig;
<a name="l02153"></a>02153     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp, *bpOrig;
<a name="l02154"></a>02154     <span class="keywordtype">float</span> val, newval, offset;
<a name="l02155"></a>02155     <span class="keywordtype">int</span> a, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, change = 0;
<a name="l02156"></a>02156     
<a name="l02157"></a>02157     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l02158"></a>02158         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l02159"></a>02159             change = 0;
<a name="l02160"></a>02160             beztOrig = <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>( nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a> );
<a name="l02161"></a>02161             <span class="keywordflow">for</span> (bezt=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+1, a=1; a&lt;nu-&gt;pntsu-1; a++, bezt++) {
<a name="l02162"></a>02162                 <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l02163"></a>02163                     <span class="keywordflow">for</span> (i=0; i&lt;3; i++) {
<a name="l02164"></a>02164                         val = bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02165"></a>02165                         newval = ((beztOrig+(a-1))-&gt;vec[1][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] * 0.5f) + ((beztOrig+(a+1))-&gt;vec[1][i] * 0.5f);
<a name="l02166"></a>02166                         offset = (val*((1.0f/6.0f)*5.0f)) + (newval*(1.0f/6.0f)) - val;
<a name="l02167"></a>02167                         <span class="comment">/* offset handles */</span>
<a name="l02168"></a>02168                         bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] += offset;
<a name="l02169"></a>02169                         bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] += offset;
<a name="l02170"></a>02170                         bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] += offset;
<a name="l02171"></a>02171                     }
<a name="l02172"></a>02172                     change = 1;
<a name="l02173"></a>02173                 }
<a name="l02174"></a>02174             }
<a name="l02175"></a>02175             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(beztOrig);
<a name="l02176"></a>02176             <span class="keywordflow">if</span> (change)
<a name="l02177"></a>02177                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(nu);
<a name="l02178"></a>02178         }
<a name="l02179"></a>02179         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>) {
<a name="l02180"></a>02180             bpOrig = <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>( nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> );
<a name="l02181"></a>02181             <span class="comment">/* Same as above, keep these the same! */</span>
<a name="l02182"></a>02182             <span class="keywordflow">for</span> (bp=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+1, a=1; a&lt;nu-&gt;pntsu-1; a++, bp++) {
<a name="l02183"></a>02183                 <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l02184"></a>02184                     <span class="keywordflow">for</span> (i=0; i&lt;3; i++) {
<a name="l02185"></a>02185                         val = bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l02186"></a>02186                         newval = ((bpOrig+(a-1))-&gt;vec[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] * 0.5f) + ((bpOrig+(a+1))-&gt;vec[i] * 0.5f);
<a name="l02187"></a>02187                         offset = (val*((1.0f/6.0f)*5.0f)) + (newval*(1.0f/6.0f)) - val;
<a name="l02188"></a>02188                     
<a name="l02189"></a>02189                         bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] += offset;
<a name="l02190"></a>02190                     }
<a name="l02191"></a>02191                 }
<a name="l02192"></a>02192             }
<a name="l02193"></a>02193             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(bpOrig);
<a name="l02194"></a>02194         }
<a name="l02195"></a>02195     }
<a name="l02196"></a>02196 
<a name="l02197"></a>02197     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l02198"></a>02198     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l02199"></a>02199 
<a name="l02200"></a>02200     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02201"></a>02201 }
<a name="l02202"></a>02202 
<a name="l02203"></a><a class="code" href="../../d7/d55/editcurve_8c.html#adac5146929f700b056e080adf5dad83d">02203</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#ac711f7ce67f22ade7b559a265ae4ed8a">CURVE_OT_smooth</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02204"></a>02204 {
<a name="l02205"></a>02205     <span class="comment">/* identifiers */</span>
<a name="l02206"></a>02206     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Smooth&quot;</span>;
<a name="l02207"></a>02207     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Flatten angles of selected points&quot;</span>;
<a name="l02208"></a>02208     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_smooth&quot;</span>;
<a name="l02209"></a>02209     
<a name="l02210"></a>02210     <span class="comment">/* api callbacks */</span>
<a name="l02211"></a>02211     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a3cd5dfdac4c7a2330076b5d4ae5c99a9">smooth_exec</a>;
<a name="l02212"></a>02212     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l02213"></a>02213 
<a name="l02214"></a>02214     <span class="comment">/* flags */</span>
<a name="l02215"></a>02215     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l02216"></a>02216 }
<a name="l02217"></a>02217 
<a name="l02218"></a>02218 <span class="comment">/**************** smooth curve radius operator *************/</span>
<a name="l02219"></a>02219 
<a name="l02220"></a>02220 <span class="comment">/* TODO, make smoothing distance based */</span>
<a name="l02221"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ae06a1109428d0dadea07e18dd9d6ffac">02221</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ae06a1109428d0dadea07e18dd9d6ffac">smooth_radius_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l02222"></a>02222 {
<a name="l02223"></a>02223     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l02224"></a>02224     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l02225"></a>02225     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l02226"></a>02226     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l02227"></a>02227     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l02228"></a>02228     <span class="keywordtype">int</span> a;
<a name="l02229"></a>02229     
<a name="l02230"></a>02230     <span class="comment">/* use for smoothing */</span>
<a name="l02231"></a>02231     <span class="keywordtype">int</span> last_sel;
<a name="l02232"></a>02232     <span class="keywordtype">int</span> start_sel, end_sel; <span class="comment">/* selection indices, inclusive */</span>
<a name="l02233"></a>02233     <span class="keywordtype">float</span> start_rad, end_rad, fac, range;
<a name="l02234"></a>02234     
<a name="l02235"></a>02235     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l02236"></a>02236         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l02237"></a>02237             
<a name="l02238"></a>02238             <span class="keywordflow">for</span> (last_sel=0; last_sel &lt; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; last_sel++) {
<a name="l02239"></a>02239                 <span class="comment">/* loop over selection segments of a curve, smooth each */</span>
<a name="l02240"></a>02240                 
<a name="l02241"></a>02241                 <span class="comment">/* Start BezTriple code, this is duplicated below for points, make sure these functions stay in sync */</span>
<a name="l02242"></a>02242                 start_sel = -1;
<a name="l02243"></a>02243                 <span class="keywordflow">for</span> (bezt=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+last_sel, a=last_sel; a&lt;nu-&gt;pntsu; a++, bezt++) {
<a name="l02244"></a>02244                     <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l02245"></a>02245                         start_sel = a;
<a name="l02246"></a>02246                         <span class="keywordflow">break</span>;
<a name="l02247"></a>02247                     }
<a name="l02248"></a>02248                 }
<a name="l02249"></a>02249                 <span class="comment">/* in case there are no other selected verts */</span>
<a name="l02250"></a>02250                 end_sel = start_sel;
<a name="l02251"></a>02251                 <span class="keywordflow">for</span> (bezt=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+(start_sel+1), a=start_sel+1; a&lt;nu-&gt;pntsu; a++, bezt++) {
<a name="l02252"></a>02252                     <span class="keywordflow">if</span> ((bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)==0) {
<a name="l02253"></a>02253                         <span class="keywordflow">break</span>;
<a name="l02254"></a>02254                     }
<a name="l02255"></a>02255                     end_sel = a;
<a name="l02256"></a>02256                 }
<a name="l02257"></a>02257                 
<a name="l02258"></a>02258                 <span class="keywordflow">if</span> (start_sel == -1) {
<a name="l02259"></a>02259                     last_sel = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; <span class="comment">/* next... */</span>
<a name="l02260"></a>02260                 }
<a name="l02261"></a>02261                 <span class="keywordflow">else</span> {
<a name="l02262"></a>02262                     last_sel = end_sel; <span class="comment">/* before we modify it */</span>
<a name="l02263"></a>02263                     
<a name="l02264"></a>02264                     <span class="comment">/* now blend between start and end sel */</span>
<a name="l02265"></a>02265                     start_rad = end_rad = -1.0;
<a name="l02266"></a>02266                     
<a name="l02267"></a>02267                     <span class="keywordflow">if</span> (start_sel == end_sel) {
<a name="l02268"></a>02268                         <span class="comment">/* simple, only 1 point selected */</span>
<a name="l02269"></a>02269                         <span class="keywordflow">if</span> (start_sel&gt;0)                        start_rad = (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+start_sel-1)-&gt;radius;
<a name="l02270"></a>02270                         <span class="keywordflow">if</span> (end_sel!=-1 &amp;&amp; end_sel &lt; nu-&gt;pntsu) end_rad = (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+start_sel+1)-&gt;radius;
<a name="l02271"></a>02271                         
<a name="l02272"></a>02272                         <span class="keywordflow">if</span> (start_rad &gt;= 0.0f &amp;&amp; end_rad &gt;= 0.0f)   (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+start_sel)-&gt;radius = (start_rad + end_rad)/2;
<a name="l02273"></a>02273                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (start_rad &gt;= 0.0f)             (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+start_sel)-&gt;radius = start_rad;
<a name="l02274"></a>02274                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (end_rad &gt;= 0.0f)               (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+start_sel)-&gt;radius = end_rad;
<a name="l02275"></a>02275                     }
<a name="l02276"></a>02276                     <span class="keywordflow">else</span> {
<a name="l02277"></a>02277                         <span class="comment">/* if endpoints selected, then use them */</span>
<a name="l02278"></a>02278                         <span class="keywordflow">if</span> (start_sel==0) {
<a name="l02279"></a>02279                             start_rad = (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+start_sel)-&gt;radius;
<a name="l02280"></a>02280                             start_sel++; <span class="comment">/* we don&#39;t want to edit the selected endpoint */</span>
<a name="l02281"></a>02281                         }
<a name="l02282"></a>02282                         <span class="keywordflow">else</span> {
<a name="l02283"></a>02283                             start_rad = (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+start_sel-1)-&gt;radius;
<a name="l02284"></a>02284                         }
<a name="l02285"></a>02285                         <span class="keywordflow">if</span> (end_sel==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1) {
<a name="l02286"></a>02286                             end_rad = (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+end_sel)-&gt;radius;
<a name="l02287"></a>02287                             end_sel--; <span class="comment">/* we don&#39;t want to edit the selected endpoint */</span>
<a name="l02288"></a>02288                         }
<a name="l02289"></a>02289                         <span class="keywordflow">else</span> {
<a name="l02290"></a>02290                             end_rad = (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+end_sel+1)-&gt;radius;
<a name="l02291"></a>02291                         }
<a name="l02292"></a>02292                         
<a name="l02293"></a>02293                         <span class="comment">/* Now Blend between the points */</span>
<a name="l02294"></a>02294                         range = (float)(end_sel - start_sel) + 2.0f;
<a name="l02295"></a>02295                         <span class="keywordflow">for</span> (bezt=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+start_sel, a=start_sel; a&lt;=end_sel; a++, bezt++) {
<a name="l02296"></a>02296                             fac = (float)(1+a-start_sel) / range;
<a name="l02297"></a>02297                             bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a> = start_rad*(1.0f-fac) + end_rad*fac;
<a name="l02298"></a>02298                         }
<a name="l02299"></a>02299                     }
<a name="l02300"></a>02300                 }
<a name="l02301"></a>02301             }
<a name="l02302"></a>02302         }
<a name="l02303"></a>02303         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>) {
<a name="l02304"></a>02304             <span class="comment">/* Same as above, keep these the same! */</span>
<a name="l02305"></a>02305             <span class="keywordflow">for</span> (last_sel=0; last_sel &lt; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; last_sel++) {
<a name="l02306"></a>02306                 <span class="comment">/* loop over selection segments of a curve, smooth each */</span>
<a name="l02307"></a>02307                 
<a name="l02308"></a>02308                 <span class="comment">/* Start BezTriple code, this is duplicated below for points, make sure these functions stay in sync */</span>
<a name="l02309"></a>02309                 start_sel = -1;
<a name="l02310"></a>02310                 <span class="keywordflow">for</span> (bp=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+last_sel, a=last_sel; a&lt;nu-&gt;pntsu; a++, bp++) {
<a name="l02311"></a>02311                     <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l02312"></a>02312                         start_sel = a;
<a name="l02313"></a>02313                         <span class="keywordflow">break</span>;
<a name="l02314"></a>02314                     }
<a name="l02315"></a>02315                 }
<a name="l02316"></a>02316                 <span class="comment">/* in case there are no other selected verts */</span>
<a name="l02317"></a>02317                 end_sel = start_sel;
<a name="l02318"></a>02318                 <span class="keywordflow">for</span> (bp=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+(start_sel+1), a=start_sel+1; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; a++, bp++) {
<a name="l02319"></a>02319                     <span class="keywordflow">if</span> ((bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)==0) {
<a name="l02320"></a>02320                         <span class="keywordflow">break</span>;
<a name="l02321"></a>02321                     }
<a name="l02322"></a>02322                     end_sel = a;
<a name="l02323"></a>02323                 }
<a name="l02324"></a>02324                 
<a name="l02325"></a>02325                 <span class="keywordflow">if</span> (start_sel == -1) {
<a name="l02326"></a>02326                     last_sel = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; <span class="comment">/* next... */</span>
<a name="l02327"></a>02327                 }
<a name="l02328"></a>02328                 <span class="keywordflow">else</span> {
<a name="l02329"></a>02329                     last_sel = end_sel; <span class="comment">/* before we modify it */</span>
<a name="l02330"></a>02330                     
<a name="l02331"></a>02331                     <span class="comment">/* now blend between start and end sel */</span>
<a name="l02332"></a>02332                     start_rad = end_rad = -1.0;
<a name="l02333"></a>02333                     
<a name="l02334"></a>02334                     <span class="keywordflow">if</span> (start_sel == end_sel) {
<a name="l02335"></a>02335                         <span class="comment">/* simple, only 1 point selected */</span>
<a name="l02336"></a>02336                         <span class="keywordflow">if</span> (start_sel&gt;0)                        start_rad = (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+start_sel-1)-&gt;radius;
<a name="l02337"></a>02337                         <span class="keywordflow">if</span> (end_sel!=-1 &amp;&amp; end_sel &lt; nu-&gt;pntsu) end_rad = (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+start_sel+1)-&gt;radius;
<a name="l02338"></a>02338                         
<a name="l02339"></a>02339                         <span class="keywordflow">if</span> (start_rad &gt;= 0.0f &amp;&amp; end_rad &gt;= 0.0f)   (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+start_sel)-&gt;radius = (start_rad + end_rad)/2;
<a name="l02340"></a>02340                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (start_rad &gt;= 0.0f)                 (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+start_sel)-&gt;radius = start_rad;
<a name="l02341"></a>02341                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (end_rad &gt;= 0.0f)                   (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+start_sel)-&gt;radius = end_rad;
<a name="l02342"></a>02342                     }
<a name="l02343"></a>02343                     <span class="keywordflow">else</span> {
<a name="l02344"></a>02344                         <span class="comment">/* if endpoints selected, then use them */</span>
<a name="l02345"></a>02345                         <span class="keywordflow">if</span> (start_sel==0) {
<a name="l02346"></a>02346                             start_rad = (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+start_sel)-&gt;radius;
<a name="l02347"></a>02347                             start_sel++; <span class="comment">/* we don&#39;t want to edit the selected endpoint */</span>
<a name="l02348"></a>02348                         }
<a name="l02349"></a>02349                         <span class="keywordflow">else</span> {
<a name="l02350"></a>02350                             start_rad = (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+start_sel-1)-&gt;radius;
<a name="l02351"></a>02351                         }
<a name="l02352"></a>02352                         <span class="keywordflow">if</span> (end_sel==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1) {
<a name="l02353"></a>02353                             end_rad = (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+end_sel)-&gt;radius;
<a name="l02354"></a>02354                             end_sel--; <span class="comment">/* we don&#39;t want to edit the selected endpoint */</span>
<a name="l02355"></a>02355                         }
<a name="l02356"></a>02356                         <span class="keywordflow">else</span> {
<a name="l02357"></a>02357                             end_rad = (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+end_sel+1)-&gt;radius;
<a name="l02358"></a>02358                         }
<a name="l02359"></a>02359                         
<a name="l02360"></a>02360                         <span class="comment">/* Now Blend between the points */</span>
<a name="l02361"></a>02361                         range = (float)(end_sel - start_sel) + 2.0f;
<a name="l02362"></a>02362                         <span class="keywordflow">for</span> (bp=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+start_sel, a=start_sel; a&lt;=end_sel; a++, bp++) {
<a name="l02363"></a>02363                             fac = (float)(1+a-start_sel) / range;
<a name="l02364"></a>02364                             bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aa3142e8e1888fbd226cbe1d5ca47b4ac">radius</a> = start_rad*(1.0f-fac) + end_rad*fac;
<a name="l02365"></a>02365                         }
<a name="l02366"></a>02366                     }
<a name="l02367"></a>02367                 }
<a name="l02368"></a>02368             }
<a name="l02369"></a>02369         }
<a name="l02370"></a>02370     }
<a name="l02371"></a>02371 
<a name="l02372"></a>02372     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l02373"></a>02373     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l02374"></a>02374 
<a name="l02375"></a>02375     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02376"></a>02376 }
<a name="l02377"></a>02377 
<a name="l02378"></a><a class="code" href="../../d7/d55/editcurve_8c.html#acbbf76d310f88e5f734236e56156ce24">02378</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a7e638af7a10d1fff21ebd747a0f048b9">CURVE_OT_smooth_radius</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02379"></a>02379 {
<a name="l02380"></a>02380     <span class="comment">/* identifiers */</span>
<a name="l02381"></a>02381     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Smooth Curve Radius&quot;</span>;
<a name="l02382"></a>02382     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Flatten radiuses of selected points&quot;</span>;
<a name="l02383"></a>02383     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_smooth_radius&quot;</span>;
<a name="l02384"></a>02384     
<a name="l02385"></a>02385     <span class="comment">/* api clastbacks */</span>
<a name="l02386"></a>02386     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#ae06a1109428d0dadea07e18dd9d6ffac">smooth_radius_exec</a>;
<a name="l02387"></a>02387     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l02388"></a>02388     
<a name="l02389"></a>02389     <span class="comment">/* flags */</span>
<a name="l02390"></a>02390     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l02391"></a>02391 }
<a name="l02392"></a>02392 
<a name="l02393"></a>02393 <span class="comment">/***************** selection utility *************************/</span>
<a name="l02394"></a>02394 
<a name="l02395"></a>02395 <span class="comment">/* next == 1 -&gt; select next         */</span>
<a name="l02396"></a>02396 <span class="comment">/* next == -1 -&gt; select previous    */</span>
<a name="l02397"></a>02397 <span class="comment">/* cont == 1 -&gt; select continuously     */</span>
<a name="l02398"></a>02398 <span class="comment">/* selstatus, inverts behavior      */</span>
<a name="l02399"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ac6fd9d82f74ba59d9463cff6c4c0f657">02399</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ac6fd9d82f74ba59d9463cff6c4c0f657">select_adjacent_cp</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb, <span class="keywordtype">short</span> <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>, <span class="keywordtype">short</span> cont, <span class="keywordtype">short</span> selstatus)
<a name="l02400"></a>02400 {
<a name="l02401"></a>02401     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l02402"></a>02402     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l02403"></a>02403     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l02404"></a>02404     <span class="keywordtype">int</span> a;
<a name="l02405"></a>02405     <span class="keywordtype">short</span> lastsel= 0;
<a name="l02406"></a>02406     
<a name="l02407"></a>02407     <span class="keywordflow">if</span> (next==0) <span class="keywordflow">return</span>;
<a name="l02408"></a>02408     
<a name="l02409"></a>02409     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l02410"></a>02410         lastsel=0;
<a name="l02411"></a>02411         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {            
<a name="l02412"></a>02412             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l02413"></a>02413             bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l02414"></a>02414             <span class="keywordflow">if</span> (next &lt; 0) bezt= (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a> + (a-1));
<a name="l02415"></a>02415             <span class="keywordflow">while</span> (a--) {
<a name="l02416"></a>02416                 <span class="keywordflow">if</span> (a-<a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>(next) &lt; 0) <span class="keywordflow">break</span>;
<a name="l02417"></a>02417                 <span class="keywordflow">if</span> ((lastsel==0) &amp;&amp; (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aaac89168848f34909c578acb0d6cca26">hide</a>==0) &amp;&amp; ((bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) || (selstatus==0))) {
<a name="l02418"></a>02418                     bezt+=<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l02419"></a>02419                     <span class="keywordflow">if</span> (!(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) || (selstatus==0)) {
<a name="l02420"></a>02420                         <span class="keywordtype">short</span> sel= <a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">select_beztriple</a>(bezt, selstatus, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>);
<a name="l02421"></a>02421                         <span class="keywordflow">if</span> ((sel==1) &amp;&amp; (cont==0)) lastsel= 1;
<a name="l02422"></a>02422                     }
<a name="l02423"></a>02423                 }
<a name="l02424"></a>02424                 <span class="keywordflow">else</span> {
<a name="l02425"></a>02425                     bezt+=<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l02426"></a>02426                     lastsel= 0;
<a name="l02427"></a>02427                 }
<a name="l02428"></a>02428                 <span class="comment">/* move around in zigzag way so that we go through each */</span>              
<a name="l02429"></a>02429                 bezt-=(next-next/<a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>(next));                
<a name="l02430"></a>02430             }
<a name="l02431"></a>02431         }
<a name="l02432"></a>02432         <span class="keywordflow">else</span> {
<a name="l02433"></a>02433             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l02434"></a>02434             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l02435"></a>02435             <span class="keywordflow">if</span> (next &lt; 0) bp= (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> + (a-1));
<a name="l02436"></a>02436             <span class="keywordflow">while</span> (a--) {
<a name="l02437"></a>02437                 <span class="keywordflow">if</span> (a-<a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>(next) &lt; 0) <span class="keywordflow">break</span>;
<a name="l02438"></a>02438                 <span class="keywordflow">if</span> ((lastsel==0) &amp;&amp; (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a>==0) &amp;&amp; ((bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) || (selstatus==0))) {
<a name="l02439"></a>02439                     bp+=<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l02440"></a>02440                     <span class="keywordflow">if</span> (!(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) || (selstatus==0)) {
<a name="l02441"></a>02441                         <span class="keywordtype">short</span> sel= <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, selstatus, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>);
<a name="l02442"></a>02442                         <span class="keywordflow">if</span> ((sel==1) &amp;&amp; (cont==0)) lastsel= 1;
<a name="l02443"></a>02443                     }           
<a name="l02444"></a>02444                 }
<a name="l02445"></a>02445                 <span class="keywordflow">else</span> {
<a name="l02446"></a>02446                     bp+=<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l02447"></a>02447                     lastsel= 0;
<a name="l02448"></a>02448                 }
<a name="l02449"></a>02449                 <span class="comment">/* move around in zigzag way so that we go through each */</span>
<a name="l02450"></a>02450                 bp-=(next-next/<a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>(next));              
<a name="l02451"></a>02451             }
<a name="l02452"></a>02452         }
<a name="l02453"></a>02453     }
<a name="l02454"></a>02454 }
<a name="l02455"></a>02455 
<a name="l02456"></a>02456 <span class="comment">/**************** select start/end operators **************/</span>
<a name="l02457"></a>02457 
<a name="l02458"></a>02458 <span class="comment">/* (de)selects first or last of visible part of each Nurb depending on selFirst     */</span>
<a name="l02459"></a>02459 <span class="comment">/* selFirst: defines the end of which to select                     */</span>
<a name="l02460"></a>02460 <span class="comment">/* doswap: defines if selection state of each first/last control point is swapped   */</span>
<a name="l02461"></a>02461 <span class="comment">/* selstatus: selection status in case doswap is false                  */</span>
<a name="l02462"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ab54563da04b3aa1a08bb81b8f4cdd530">02462</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ab54563da04b3aa1a08bb81b8f4cdd530">selectend_nurb</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *obedit, <span class="keywordtype">short</span> selfirst, <span class="keywordtype">short</span> doswap, <span class="keywordtype">short</span> selstatus)
<a name="l02463"></a>02463 {
<a name="l02464"></a>02464     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l02465"></a>02465     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l02466"></a>02466     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l02467"></a>02467     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l02468"></a>02468     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu;
<a name="l02469"></a>02469     <span class="keywordtype">int</span> a;
<a name="l02470"></a>02470 
<a name="l02471"></a>02471     <span class="keywordflow">if</span> (obedit==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l02472"></a>02472 
<a name="l02473"></a>02473     cu= (<a class="code" href="../../da/d10/structCurve.html">Curve</a>*)obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l02474"></a>02474     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02475"></a>02475 
<a name="l02476"></a>02476     for (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l02477"></a>02477         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l02478"></a>02478             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l02479"></a>02479             
<a name="l02480"></a>02480             <span class="comment">/* which point? */</span>
<a name="l02481"></a>02481             <span class="keywordflow">if</span> (selfirst==0) { <span class="comment">/* select last */</span> 
<a name="l02482"></a>02482                 bezt= (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a> + (a-1));
<a name="l02483"></a>02483             }
<a name="l02484"></a>02484             <span class="keywordflow">else</span> { <span class="comment">/* select first */</span>
<a name="l02485"></a>02485                 bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l02486"></a>02486             }
<a name="l02487"></a>02487             
<a name="l02488"></a>02488             <span class="keywordflow">while</span> (a--) {
<a name="l02489"></a>02489                 <span class="keywordtype">short</span> sel;
<a name="l02490"></a>02490                 <span class="keywordflow">if</span> (doswap) sel= <a class="code" href="../../d7/d55/editcurve_8c.html#a2264aead9457aff517da41b8b18390c0">swap_selection_beztriple</a>(bezt);
<a name="l02491"></a>02491                 <span class="keywordflow">else</span> sel= <a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">select_beztriple</a>(bezt, selstatus, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>);
<a name="l02492"></a>02492                 
<a name="l02493"></a>02493                 <span class="keywordflow">if</span> (sel==1) <span class="keywordflow">break</span>;
<a name="l02494"></a>02494             }
<a name="l02495"></a>02495         }
<a name="l02496"></a>02496         <span class="keywordflow">else</span> {
<a name="l02497"></a>02497             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l02498"></a>02498             
<a name="l02499"></a>02499             <span class="comment">/* which point? */</span>
<a name="l02500"></a>02500             <span class="keywordflow">if</span> (selfirst==0) { <span class="comment">/* select last */</span>
<a name="l02501"></a>02501                 bp= (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> + (a-1));
<a name="l02502"></a>02502             }
<a name="l02503"></a>02503             <span class="keywordflow">else</span> { <span class="comment">/* select first */</span>
<a name="l02504"></a>02504                 bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l02505"></a>02505             }
<a name="l02506"></a>02506 
<a name="l02507"></a>02507             <span class="keywordflow">while</span> (a--) {
<a name="l02508"></a>02508                 <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a> == 0) {
<a name="l02509"></a>02509                     <span class="keywordtype">short</span> sel;
<a name="l02510"></a>02510                     <span class="keywordflow">if</span> (doswap) sel= <a class="code" href="../../d7/d55/editcurve_8c.html#a3c8fa8c7bdb6cb09f926165a1e815622">swap_selection_bpoint</a>(bp);
<a name="l02511"></a>02511                     <span class="keywordflow">else</span> sel= <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, selstatus, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>);
<a name="l02512"></a>02512                     
<a name="l02513"></a>02513                     <span class="keywordflow">if</span> (sel==1) <span class="keywordflow">break</span>;
<a name="l02514"></a>02514                 }
<a name="l02515"></a>02515             }
<a name="l02516"></a>02516         }
<a name="l02517"></a>02517     }
<a name="l02518"></a>02518 }
<a name="l02519"></a>02519 
<a name="l02520"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a8fb9234f42343a8a74df85b2cb317d17">02520</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a8fb9234f42343a8a74df85b2cb317d17">de_select_first_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l02521"></a>02521 {
<a name="l02522"></a>02522     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l02523"></a>02523 
<a name="l02524"></a>02524     <a class="code" href="../../d7/d55/editcurve_8c.html#ab54563da04b3aa1a08bb81b8f4cdd530">selectend_nurb</a>(obedit, <a class="code" href="../../d7/d55/editcurve_8c.html#a492c6ccf2bde2bebcd32e73e0933ee92">FIRST</a>, 1, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>);
<a name="l02525"></a>02525     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa1eaeb409fe6a81df91467aaeb289a07">ND_SELECT</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l02526"></a>02526 
<a name="l02527"></a>02527     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02528"></a>02528 }
<a name="l02529"></a>02529 
<a name="l02530"></a><a class="code" href="../../d7/d55/editcurve_8c.html#aaa04bc6dbfc99314ce970895d82906e3">02530</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a46d61c02ea7adaa92389999985d39520">CURVE_OT_de_select_first</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02531"></a>02531 {
<a name="l02532"></a>02532     <span class="comment">/* identifiers */</span>
<a name="l02533"></a>02533     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;(De)select First&quot;</span>;
<a name="l02534"></a>02534     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_de_select_first&quot;</span>;
<a name="l02535"></a>02535     
<a name="l02536"></a>02536     <span class="comment">/* api cfirstbacks */</span>
<a name="l02537"></a>02537     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a8fb9234f42343a8a74df85b2cb317d17">de_select_first_exec</a>;
<a name="l02538"></a>02538     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a443591620f4deea4cac8a4098f66d2f7">ED_operator_editcurve</a>;
<a name="l02539"></a>02539     
<a name="l02540"></a>02540     <span class="comment">/* flags */</span>
<a name="l02541"></a>02541     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l02542"></a>02542 }
<a name="l02543"></a>02543 
<a name="l02544"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a84b15fa5af8b103625158b8581575a58">02544</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a84b15fa5af8b103625158b8581575a58">de_select_last_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l02545"></a>02545 {
<a name="l02546"></a>02546     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l02547"></a>02547 
<a name="l02548"></a>02548     <a class="code" href="../../d7/d55/editcurve_8c.html#ab54563da04b3aa1a08bb81b8f4cdd530">selectend_nurb</a>(obedit, <a class="code" href="../../d7/d55/editcurve_8c.html#a210af1d04c8870416a556f0e9a5194fd">LAST</a>, 1, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>);
<a name="l02549"></a>02549     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa1eaeb409fe6a81df91467aaeb289a07">ND_SELECT</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l02550"></a>02550 
<a name="l02551"></a>02551     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02552"></a>02552 }
<a name="l02553"></a>02553 
<a name="l02554"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ac892691c33638b22972f7c5596816b9e">02554</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a6a58e492307169f0a3a14d190614b5b0">CURVE_OT_de_select_last</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02555"></a>02555 {
<a name="l02556"></a>02556     <span class="comment">/* identifiers */</span>
<a name="l02557"></a>02557     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;(De)select Last&quot;</span>;
<a name="l02558"></a>02558     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_de_select_last&quot;</span>;
<a name="l02559"></a>02559     
<a name="l02560"></a>02560     <span class="comment">/* api clastbacks */</span>
<a name="l02561"></a>02561     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a84b15fa5af8b103625158b8581575a58">de_select_last_exec</a>;
<a name="l02562"></a>02562     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a443591620f4deea4cac8a4098f66d2f7">ED_operator_editcurve</a>;
<a name="l02563"></a>02563     
<a name="l02564"></a>02564     <span class="comment">/* flags */</span>
<a name="l02565"></a>02565     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l02566"></a>02566 }
<a name="l02567"></a>02567 
<a name="l02568"></a>02568 <span class="comment">/******************* de select all operator ***************/</span>
<a name="l02569"></a>02569 
<a name="l02570"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a30a82c75b985d8899685dc9e763710a5">02570</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a30a82c75b985d8899685dc9e763710a5">nurb_has_selected_cps</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb)
<a name="l02571"></a>02571 {
<a name="l02572"></a>02572     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l02573"></a>02573     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l02574"></a>02574     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l02575"></a>02575     <span class="keywordtype">int</span> a;
<a name="l02576"></a>02576 
<a name="l02577"></a>02577     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l02578"></a>02578         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l02579"></a>02579             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l02580"></a>02580             bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l02581"></a>02581             <span class="keywordflow">while</span> (a--) {
<a name="l02582"></a>02582                 <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aaac89168848f34909c578acb0d6cca26">hide</a>==0) {
<a name="l02583"></a>02583                     <span class="keywordflow">if</span> ((bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) ||
<a name="l02584"></a>02584                         (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) ||
<a name="l02585"></a>02585                         (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>))
<a name="l02586"></a>02586                     {
<a name="l02587"></a>02587                         <span class="keywordflow">return</span> 1;
<a name="l02588"></a>02588                     }
<a name="l02589"></a>02589                 }
<a name="l02590"></a>02590                 bezt++;
<a name="l02591"></a>02591             }
<a name="l02592"></a>02592         }
<a name="l02593"></a>02593         <span class="keywordflow">else</span> {
<a name="l02594"></a>02594             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l02595"></a>02595             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l02596"></a>02596             <span class="keywordflow">while</span> (a--) {
<a name="l02597"></a>02597                 <span class="keywordflow">if</span> ((bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a>==0) &amp;&amp; (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) <span class="keywordflow">return</span> 1;
<a name="l02598"></a>02598                 bp++;
<a name="l02599"></a>02599             }
<a name="l02600"></a>02600         }
<a name="l02601"></a>02601     }
<a name="l02602"></a>02602     
<a name="l02603"></a>02603     <span class="keywordflow">return</span> 0;
<a name="l02604"></a>02604 }
<a name="l02605"></a>02605 
<a name="l02606"></a><a class="code" href="../../d7/d55/editcurve_8c.html#afe13f2635a692eaf38b8aee599a64800">02606</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#afe13f2635a692eaf38b8aee599a64800">de_select_all_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l02607"></a>02607 {
<a name="l02608"></a>02608     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l02609"></a>02609     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l02610"></a>02610     <span class="keywordtype">int</span> action = <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;action&quot;</span>);
<a name="l02611"></a>02611 
<a name="l02612"></a>02612     <span class="keywordflow">if</span> (action == <a class="code" href="../../d4/d7f/WM__api_8h.html#a070b8f09bd544f3d0bd5786ca00cda02">SEL_TOGGLE</a>) {
<a name="l02613"></a>02613         action = <a class="code" href="../../d4/d7f/WM__api_8h.html#af76323cc5b70d4cbeca6b3887e166fb8">SEL_SELECT</a>;
<a name="l02614"></a>02614         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a30a82c75b985d8899685dc9e763710a5">nurb_has_selected_cps</a>(editnurb))
<a name="l02615"></a>02615             action = <a class="code" href="../../d4/d7f/WM__api_8h.html#a94dcbe0e237e6d615cad805221261370">SEL_DESELECT</a>;
<a name="l02616"></a>02616     }
<a name="l02617"></a>02617 
<a name="l02618"></a>02618     <span class="keywordflow">switch</span> (action) {
<a name="l02619"></a>02619         <span class="keywordflow">case</span> <a class="code" href="../../d4/d7f/WM__api_8h.html#af76323cc5b70d4cbeca6b3887e166fb8">SEL_SELECT</a>:
<a name="l02620"></a>02620             <a class="code" href="../../d7/d55/editcurve_8c.html#adb224e37642ea6bb6d3a5a66aef9a3db">CU_select_all</a>(obedit);
<a name="l02621"></a>02621             <span class="keywordflow">break</span>;
<a name="l02622"></a>02622         <span class="keywordflow">case</span> <a class="code" href="../../d4/d7f/WM__api_8h.html#a94dcbe0e237e6d615cad805221261370">SEL_DESELECT</a>:
<a name="l02623"></a>02623             <a class="code" href="../../d7/d55/editcurve_8c.html#a7472517908a5b478e86461d147d169e9">CU_deselect_all</a>(obedit);
<a name="l02624"></a>02624             <span class="keywordflow">break</span>;
<a name="l02625"></a>02625         <span class="keywordflow">case</span> <a class="code" href="../../d4/d7f/WM__api_8h.html#ac906797cc9a2787004c6ad16b8151913">SEL_INVERT</a>:
<a name="l02626"></a>02626             <a class="code" href="../../d7/d55/editcurve_8c.html#ac097caaf174024f3782be1d41cb83b3a">CU_select_swap</a>(obedit);
<a name="l02627"></a>02627             <span class="keywordflow">break</span>;
<a name="l02628"></a>02628     }
<a name="l02629"></a>02629     
<a name="l02630"></a>02630     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa1eaeb409fe6a81df91467aaeb289a07">ND_SELECT</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l02631"></a>02631 
<a name="l02632"></a>02632     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02633"></a>02633 }
<a name="l02634"></a>02634 
<a name="l02635"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a85a811bcd9f2d32a0b7d208a36def128">02635</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a52c80050e5e5c72f83636cb67f6dff91">CURVE_OT_select_all</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02636"></a>02636 {
<a name="l02637"></a>02637     <span class="comment">/* identifiers */</span>
<a name="l02638"></a>02638     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;(De)select All&quot;</span>;
<a name="l02639"></a>02639     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_select_all&quot;</span>;
<a name="l02640"></a>02640     
<a name="l02641"></a>02641     <span class="comment">/* api callbacks */</span>
<a name="l02642"></a>02642     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#afe13f2635a692eaf38b8aee599a64800">de_select_all_exec</a>;
<a name="l02643"></a>02643     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l02644"></a>02644     
<a name="l02645"></a>02645     <span class="comment">/* flags */</span>
<a name="l02646"></a>02646     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l02647"></a>02647 
<a name="l02648"></a>02648     <span class="comment">/* properties */</span>
<a name="l02649"></a>02649     <a class="code" href="../../d6/dae/wm__operators_8c.html#ab59cd94616324bb4f3668be8f64bdcd8">WM_operator_properties_select_all</a>(ot);
<a name="l02650"></a>02650 }
<a name="l02651"></a>02651 
<a name="l02652"></a>02652 <span class="comment">/********************** hide operator *********************/</span>
<a name="l02653"></a>02653 
<a name="l02654"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a0335bed24fe940d786adbfd53fb47162">02654</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a0335bed24fe940d786adbfd53fb47162">hide_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l02655"></a>02655 {
<a name="l02656"></a>02656     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l02657"></a>02657     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l02658"></a>02658     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l02659"></a>02659     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l02660"></a>02660     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l02661"></a>02661     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l02662"></a>02662     <span class="keywordtype">int</span> a, sel, <a class="code" href="../../d6/d26/svm__invert_8h.html#a68699e276b6fc0d0278f5c6936c7e23d">invert</a>= <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;unselected&quot;</span>);
<a name="l02663"></a>02663 
<a name="l02664"></a>02664     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l02665"></a>02665         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l02666"></a>02666             bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l02667"></a>02667             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l02668"></a>02668             sel= 0;
<a name="l02669"></a>02669             <span class="keywordflow">while</span> (a--) {
<a name="l02670"></a>02670                 <span class="keywordflow">if</span> (invert == 0 &amp;&amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abcf63d093f344e298763ce019f0a1cb1">BEZSELECTED_HIDDENHANDLES</a>(cu, bezt)) {
<a name="l02671"></a>02671                     <a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">select_beztriple</a>(bezt, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l02672"></a>02672                     bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aaac89168848f34909c578acb0d6cca26">hide</a>= 1;
<a name="l02673"></a>02673                 }
<a name="l02674"></a>02674                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (invert &amp;&amp; !<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abcf63d093f344e298763ce019f0a1cb1">BEZSELECTED_HIDDENHANDLES</a>(cu, bezt)) {
<a name="l02675"></a>02675                     <a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">select_beztriple</a>(bezt, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l02676"></a>02676                     bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aaac89168848f34909c578acb0d6cca26">hide</a>= 1;
<a name="l02677"></a>02677                 }
<a name="l02678"></a>02678                 <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aaac89168848f34909c578acb0d6cca26">hide</a>) sel++;
<a name="l02679"></a>02679                 bezt++;
<a name="l02680"></a>02680             }
<a name="l02681"></a>02681             <span class="keywordflow">if</span> (sel==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ac50bf4fd67b2b09d82909961cd25da2f">hide</a>= 1;
<a name="l02682"></a>02682         }
<a name="l02683"></a>02683         <span class="keywordflow">else</span> {
<a name="l02684"></a>02684             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l02685"></a>02685             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l02686"></a>02686             sel= 0;
<a name="l02687"></a>02687             <span class="keywordflow">while</span> (a--) {
<a name="l02688"></a>02688                 <span class="keywordflow">if</span> (invert==0 &amp;&amp; (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) {
<a name="l02689"></a>02689                     <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l02690"></a>02690                     bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a>= 1;
<a name="l02691"></a>02691                 }
<a name="l02692"></a>02692                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (invert &amp;&amp; (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)==0) {
<a name="l02693"></a>02693                     <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l02694"></a>02694                     bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a>= 1;
<a name="l02695"></a>02695                 }
<a name="l02696"></a>02696                 <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a>) sel++;
<a name="l02697"></a>02697                 bp++;
<a name="l02698"></a>02698             }
<a name="l02699"></a>02699             <span class="keywordflow">if</span> (sel==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>) nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ac50bf4fd67b2b09d82909961cd25da2f">hide</a>= 1;
<a name="l02700"></a>02700         }
<a name="l02701"></a>02701     }
<a name="l02702"></a>02702 
<a name="l02703"></a>02703     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l02704"></a>02704     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa1eaeb409fe6a81df91467aaeb289a07">ND_SELECT</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l02705"></a>02705 
<a name="l02706"></a>02706     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;   
<a name="l02707"></a>02707 }
<a name="l02708"></a>02708 
<a name="l02709"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a40b8d7360532861ff46922a54442e0c6">02709</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a2cd214e5dfc095fc0a22936b2c6eb86e">CURVE_OT_hide</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02710"></a>02710 {
<a name="l02711"></a>02711     <span class="comment">/* identifiers */</span>
<a name="l02712"></a>02712     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Hide Selected&quot;</span>;
<a name="l02713"></a>02713     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_hide&quot;</span>;
<a name="l02714"></a>02714     
<a name="l02715"></a>02715     <span class="comment">/* api callbacks */</span>
<a name="l02716"></a>02716     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a0335bed24fe940d786adbfd53fb47162">hide_exec</a>;
<a name="l02717"></a>02717     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l02718"></a>02718     
<a name="l02719"></a>02719     <span class="comment">/* flags */</span>
<a name="l02720"></a>02720     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l02721"></a>02721     
<a name="l02722"></a>02722     <span class="comment">/* props */</span>
<a name="l02723"></a>02723     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;unselected&quot;</span>, 0, <span class="stringliteral">&quot;Unselected&quot;</span>, <span class="stringliteral">&quot;Hide unselected rather than selected&quot;</span>);
<a name="l02724"></a>02724 }
<a name="l02725"></a>02725 
<a name="l02726"></a>02726 <span class="comment">/********************** reveal operator *********************/</span>
<a name="l02727"></a>02727 
<a name="l02728"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a8ac33f9dbdefaec5c7729bc8f9924401">02728</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a8ac33f9dbdefaec5c7729bc8f9924401">reveal_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l02729"></a>02729 {
<a name="l02730"></a>02730     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l02731"></a>02731     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l02732"></a>02732     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l02733"></a>02733     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l02734"></a>02734     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l02735"></a>02735     <span class="keywordtype">int</span> a;
<a name="l02736"></a>02736 
<a name="l02737"></a>02737     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l02738"></a>02738         nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ac50bf4fd67b2b09d82909961cd25da2f">hide</a>= 0;
<a name="l02739"></a>02739         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l02740"></a>02740             bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l02741"></a>02741             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l02742"></a>02742             <span class="keywordflow">while</span> (a--) {
<a name="l02743"></a>02743                 <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aaac89168848f34909c578acb0d6cca26">hide</a>) {
<a name="l02744"></a>02744                     <a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">select_beztriple</a>(bezt, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l02745"></a>02745                     bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aaac89168848f34909c578acb0d6cca26">hide</a>= 0;
<a name="l02746"></a>02746                 }
<a name="l02747"></a>02747                 bezt++;
<a name="l02748"></a>02748             }
<a name="l02749"></a>02749         }
<a name="l02750"></a>02750         <span class="keywordflow">else</span> {
<a name="l02751"></a>02751             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l02752"></a>02752             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l02753"></a>02753             <span class="keywordflow">while</span> (a--) {
<a name="l02754"></a>02754                 <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a>) {
<a name="l02755"></a>02755                     <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l02756"></a>02756                     bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a>= 0;
<a name="l02757"></a>02757                 }
<a name="l02758"></a>02758                 bp++;
<a name="l02759"></a>02759             }
<a name="l02760"></a>02760         }
<a name="l02761"></a>02761     }
<a name="l02762"></a>02762 
<a name="l02763"></a>02763     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l02764"></a>02764     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa1eaeb409fe6a81df91467aaeb289a07">ND_SELECT</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l02765"></a>02765 
<a name="l02766"></a>02766     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;   
<a name="l02767"></a>02767 }
<a name="l02768"></a>02768 
<a name="l02769"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ab4e949f273f91f27b4b63db2470de471">02769</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#af36a5b018b39760e6eab42c3494407f4">CURVE_OT_reveal</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02770"></a>02770 {
<a name="l02771"></a>02771     <span class="comment">/* identifiers */</span>
<a name="l02772"></a>02772     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Reveal Hidden&quot;</span>;
<a name="l02773"></a>02773     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_reveal&quot;</span>;
<a name="l02774"></a>02774     
<a name="l02775"></a>02775     <span class="comment">/* api callbacks */</span>
<a name="l02776"></a>02776     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a8ac33f9dbdefaec5c7729bc8f9924401">reveal_exec</a>;
<a name="l02777"></a>02777     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l02778"></a>02778     
<a name="l02779"></a>02779     <span class="comment">/* flags */</span>
<a name="l02780"></a>02780     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l02781"></a>02781 }
<a name="l02782"></a>02782 
<a name="l02783"></a>02783 <span class="comment">/********************** subdivide operator *********************/</span>
<a name="l02784"></a>02784 
<a name="l02789"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ade3e6af6236bcaa7621d2a7fcb20d60f">02789</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ade3e6af6236bcaa7621d2a7fcb20d60f">subdividenurb</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *obedit, <span class="keywordtype">int</span> number_cuts)
<a name="l02790"></a>02790 {
<a name="l02791"></a>02791     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l02792"></a>02792     <a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>;
<a name="l02793"></a>02793     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l02794"></a>02794     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *prevbezt, *bezt, *beztnew, *beztn;
<a name="l02795"></a>02795     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp, *prevbp, *bpnew, *bpn;
<a name="l02796"></a>02796     <span class="keywordtype">float</span> vec[15];
<a name="l02797"></a>02797     <span class="keywordtype">int</span> a, b, sel, amount, *usel, *vsel, <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l02798"></a>02798     <span class="keywordtype">float</span> factor;
<a name="l02799"></a>02799 
<a name="l02800"></a>02800     <span class="comment">// printf(&quot;*** subdivideNurb: entering subdivide\n&quot;);</span>
<a name="l02801"></a>02801 
<a name="l02802"></a>02802     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l02803"></a>02803         amount= 0;
<a name="l02804"></a>02804         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l02805"></a>02805         <span class="comment">/* </span>
<a name="l02806"></a>02806 <span class="comment">         * Insert a point into a 2D Bezier curve. </span>
<a name="l02807"></a>02807 <span class="comment">         * Endpoints are preserved. Otherwise, all selected and inserted points are </span>
<a name="l02808"></a>02808 <span class="comment">         * newly created. Old points are discarded.</span>
<a name="l02809"></a>02809 <span class="comment">         */</span>
<a name="l02810"></a>02810             <span class="comment">/* count */</span>
<a name="l02811"></a>02811             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) {
<a name="l02812"></a>02812                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l02813"></a>02813                 bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l02814"></a>02814                 prevbezt= bezt+(a-1);
<a name="l02815"></a>02815             }
<a name="l02816"></a>02816             <span class="keywordflow">else</span> {
<a name="l02817"></a>02817                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1;
<a name="l02818"></a>02818                 prevbezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l02819"></a>02819                 bezt= prevbezt+1;
<a name="l02820"></a>02820             }
<a name="l02821"></a>02821             <span class="keywordflow">while</span> (a--) {
<a name="l02822"></a>02822                 <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abcf63d093f344e298763ce019f0a1cb1">BEZSELECTED_HIDDENHANDLES</a>(cu, prevbezt) &amp;&amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abcf63d093f344e298763ce019f0a1cb1">BEZSELECTED_HIDDENHANDLES</a>(cu, bezt) ) amount+=number_cuts;
<a name="l02823"></a>02823                 prevbezt= bezt;
<a name="l02824"></a>02824                 bezt++;
<a name="l02825"></a>02825             }
<a name="l02826"></a>02826 
<a name="l02827"></a>02827             <span class="keywordflow">if</span> (amount) {
<a name="l02828"></a>02828                 <span class="comment">/* insert */</span>
<a name="l02829"></a>02829                 beztnew =
<a name="l02830"></a>02830                     (<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>((amount + nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aafa4ace0bba7528ab007eabe81cbfc10">BezTriple</a>), <span class="stringliteral">&quot;subdivNurb&quot;</span>);
<a name="l02831"></a>02831                 beztn= beztnew;
<a name="l02832"></a>02832                 <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) {
<a name="l02833"></a>02833                     a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l02834"></a>02834                     bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l02835"></a>02835                     prevbezt= bezt+(a-1);
<a name="l02836"></a>02836                 }
<a name="l02837"></a>02837                 <span class="keywordflow">else</span> {
<a name="l02838"></a>02838                     a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1;
<a name="l02839"></a>02839                     prevbezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l02840"></a>02840                     bezt= prevbezt+1;
<a name="l02841"></a>02841                 }
<a name="l02842"></a>02842                 <span class="keywordflow">while</span> (a--) {
<a name="l02843"></a>02843                     memcpy(beztn, prevbezt, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>));
<a name="l02844"></a>02844                     <a class="code" href="../../d7/d55/editcurve_8c.html#a32de29ccf344b5d4d324c8eb05212925">keyIndex_updateBezt</a>(editnurb, prevbezt, beztn, 1);
<a name="l02845"></a>02845                     beztn++;
<a name="l02846"></a>02846 
<a name="l02847"></a>02847                     <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abcf63d093f344e298763ce019f0a1cb1">BEZSELECTED_HIDDENHANDLES</a>(cu, prevbezt) &amp;&amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abcf63d093f344e298763ce019f0a1cb1">BEZSELECTED_HIDDENHANDLES</a>(cu, bezt) ) {
<a name="l02848"></a>02848                         <span class="keywordtype">float</span> prevvec[3][3];
<a name="l02849"></a>02849 
<a name="l02850"></a>02850                         memcpy(prevvec, prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * 9);
<a name="l02851"></a>02851 
<a name="l02852"></a>02852                         <span class="keywordflow">for</span> (i = 0; i &lt; number_cuts; i++) {
<a name="l02853"></a>02853                             factor = 1.0f / (number_cuts + 1 - <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>);
<a name="l02854"></a>02854 
<a name="l02855"></a>02855                             memcpy(beztn, bezt, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>));
<a name="l02856"></a>02856 
<a name="l02857"></a>02857                             <span class="comment">/* midpoint subdividing */</span>
<a name="l02858"></a>02858                             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1527309f09525ae91ed04692da13ba98">interp_v3_v3v3</a>(vec, prevvec[1], prevvec[2], factor);
<a name="l02859"></a>02859                             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1527309f09525ae91ed04692da13ba98">interp_v3_v3v3</a>(vec+3, prevvec[2], bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0], factor);
<a name="l02860"></a>02860                             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1527309f09525ae91ed04692da13ba98">interp_v3_v3v3</a>(vec+6, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0], bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1], factor);
<a name="l02861"></a>02861 
<a name="l02862"></a>02862                             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1527309f09525ae91ed04692da13ba98">interp_v3_v3v3</a>(vec+9, vec, vec+3, factor);
<a name="l02863"></a>02863                             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1527309f09525ae91ed04692da13ba98">interp_v3_v3v3</a>(vec+12, vec+3, vec+6, factor);
<a name="l02864"></a>02864 
<a name="l02865"></a>02865                             <span class="comment">/* change handle of prev beztn */</span>
<a name="l02866"></a>02866                             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>((beztn-1)-&gt;vec[2], vec);
<a name="l02867"></a>02867                             <span class="comment">/* new point */</span>
<a name="l02868"></a>02868                             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(beztn-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0], vec+9);
<a name="l02869"></a>02869                             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1527309f09525ae91ed04692da13ba98">interp_v3_v3v3</a>(beztn-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1], vec+9, vec+12, factor);
<a name="l02870"></a>02870                             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(beztn-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2], vec+12);
<a name="l02871"></a>02871                             <span class="comment">/* handle of next bezt */</span>
<a name="l02872"></a>02872                             <span class="keywordflow">if</span> (a==0 &amp;&amp; i == number_cuts - 1 &amp;&amp; (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>)) {<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(beztnew-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0], vec+6);}
<a name="l02873"></a>02873                             <span class="keywordflow">else</span> {<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0], vec+6);}
<a name="l02874"></a>02874 
<a name="l02875"></a>02875                             beztn-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a> = (prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a> + bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a>)/2;
<a name="l02876"></a>02876                             beztn-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad23314941e5bb9f62166fb79d623d2c3">weight</a> = (prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad23314941e5bb9f62166fb79d623d2c3">weight</a> + bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad23314941e5bb9f62166fb79d623d2c3">weight</a>)/2;
<a name="l02877"></a>02877 
<a name="l02878"></a>02878                             memcpy(prevvec, beztn-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * 9);
<a name="l02879"></a>02879                             beztn++;
<a name="l02880"></a>02880                         }
<a name="l02881"></a>02881                     }
<a name="l02882"></a>02882 
<a name="l02883"></a>02883                     prevbezt= bezt;
<a name="l02884"></a>02884                     bezt++;
<a name="l02885"></a>02885                 }
<a name="l02886"></a>02886                 <span class="comment">/* last point */</span>
<a name="l02887"></a>02887                 <span class="keywordflow">if</span> ((nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>)==0) {
<a name="l02888"></a>02888                     memcpy(beztn, prevbezt, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>));
<a name="l02889"></a>02889                     <a class="code" href="../../d7/d55/editcurve_8c.html#a32de29ccf344b5d4d324c8eb05212925">keyIndex_updateBezt</a>(editnurb, prevbezt, beztn, 1);
<a name="l02890"></a>02890                 }
<a name="l02891"></a>02891 
<a name="l02892"></a>02892                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>);
<a name="l02893"></a>02893                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>= beztnew;
<a name="l02894"></a>02894                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>+= amount;
<a name="l02895"></a>02895 
<a name="l02896"></a>02896                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(nu);
<a name="l02897"></a>02897             }
<a name="l02898"></a>02898         } <span class="comment">/* End of &#39;if (nu-&gt;type == CU_BEZIER)&#39; */</span>
<a name="l02899"></a>02899         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>==1) {
<a name="l02900"></a>02900         <span class="comment">/* </span>
<a name="l02901"></a>02901 <span class="comment">         * All flat lines (ie. co-planar), except flat Nurbs. Flat NURB curves </span>
<a name="l02902"></a>02902 <span class="comment">         * are handled together with the regular NURB plane division, as it </span>
<a name="l02903"></a>02903 <span class="comment">         * should be. I split it off just now, let&#39;s see if it is</span>
<a name="l02904"></a>02904 <span class="comment">         * stable... nzc 30-5-&#39;00</span>
<a name="l02905"></a>02905 <span class="comment">         */</span>
<a name="l02906"></a>02906             <span class="comment">/* count */</span>
<a name="l02907"></a>02907             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) {
<a name="l02908"></a>02908                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l02909"></a>02909                 bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l02910"></a>02910                 prevbp= bp+(a-1);
<a name="l02911"></a>02911             }
<a name="l02912"></a>02912             <span class="keywordflow">else</span> {
<a name="l02913"></a>02913                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1;
<a name="l02914"></a>02914                 prevbp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l02915"></a>02915                 bp= prevbp+1;
<a name="l02916"></a>02916             }
<a name="l02917"></a>02917             <span class="keywordflow">while</span> (a--) {
<a name="l02918"></a>02918                 <span class="keywordflow">if</span> ( (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) &amp;&amp; (prevbp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) ) amount+=number_cuts;
<a name="l02919"></a>02919                 prevbp= bp;
<a name="l02920"></a>02920                 bp++;
<a name="l02921"></a>02921             }
<a name="l02922"></a>02922 
<a name="l02923"></a>02923             <span class="keywordflow">if</span> (amount) {
<a name="l02924"></a>02924                 <span class="comment">/* insert */</span>
<a name="l02925"></a>02925                 bpnew =
<a name="l02926"></a>02926                     (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>((amount + nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af73d40f9d8f8b10f64359a0704799ac9">BPoint</a>), <span class="stringliteral">&quot;subdivNurb2&quot;</span>);
<a name="l02927"></a>02927                 bpn= bpnew;
<a name="l02928"></a>02928 
<a name="l02929"></a>02929                 <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) {
<a name="l02930"></a>02930                     a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l02931"></a>02931                     bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l02932"></a>02932                     prevbp= bp+(a-1);
<a name="l02933"></a>02933                 }
<a name="l02934"></a>02934                 <span class="keywordflow">else</span> {
<a name="l02935"></a>02935                     a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1;
<a name="l02936"></a>02936                     prevbp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l02937"></a>02937                     bp= prevbp+1;
<a name="l02938"></a>02938                 }
<a name="l02939"></a>02939                 <span class="keywordflow">while</span> (a--) {
<a name="l02940"></a>02940                     memcpy(bpn, prevbp, <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>));
<a name="l02941"></a>02941                     <a class="code" href="../../d7/d55/editcurve_8c.html#a0233d7e5f22fabe021f3902c3127dafc">keyIndex_updateBP</a>(editnurb, prevbp, bpn, 1);
<a name="l02942"></a>02942                     bpn++;
<a name="l02943"></a>02943 
<a name="l02944"></a>02944                     <span class="keywordflow">if</span> ( (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) &amp;&amp; (prevbp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) ) {
<a name="l02945"></a>02945                  <span class="comment">// printf(&quot;*** subdivideNurb: insert &#39;linear&#39; point\n&quot;);</span>
<a name="l02946"></a>02946                         <span class="keywordflow">for</span> (i = 0; i &lt; number_cuts; i++) {
<a name="l02947"></a>02947                             factor = (float)(i + 1) / (number_cuts + 1);
<a name="l02948"></a>02948 
<a name="l02949"></a>02949                             memcpy(bpn, bp, <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>));
<a name="l02950"></a>02950                             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5d96900cbf6d1bc0c8a6c02ea0836564">interp_v4_v4v4</a>(bpn-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, prevbp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, factor);
<a name="l02951"></a>02951                             bpn++;
<a name="l02952"></a>02952                         }
<a name="l02953"></a>02953 
<a name="l02954"></a>02954                     }
<a name="l02955"></a>02955                     prevbp= bp;
<a name="l02956"></a>02956                     bp++;
<a name="l02957"></a>02957                 }
<a name="l02958"></a>02958                 <span class="keywordflow">if</span> ((nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>)==0) { <span class="comment">/* last point */</span>
<a name="l02959"></a>02959                     memcpy(bpn, prevbp, <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>));
<a name="l02960"></a>02960                     <a class="code" href="../../d7/d55/editcurve_8c.html#a0233d7e5f22fabe021f3902c3127dafc">keyIndex_updateBP</a>(editnurb, prevbp, bpn, 1);
<a name="l02961"></a>02961                 }
<a name="l02962"></a>02962 
<a name="l02963"></a>02963                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l02964"></a>02964                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= bpnew;
<a name="l02965"></a>02965                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>+= amount;
<a name="l02966"></a>02966 
<a name="l02967"></a>02967                 <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l02968"></a>02968                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(nu);
<a name="l02969"></a>02969                 }
<a name="l02970"></a>02970             }
<a name="l02971"></a>02971         } <span class="comment">/* End of &#39;else if (nu-&gt;pntsv==1)&#39; */</span>
<a name="l02972"></a>02972         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l02973"></a>02973         <span class="comment">/* This is a very strange test ... */</span>
<a name="l03015"></a>03015             <span class="comment">/* selection-arrays */</span>
<a name="l03016"></a>03016             usel= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>, <span class="stringliteral">&quot;subivideNurb3&quot;</span>);
<a name="l03017"></a>03017             vsel= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>, <span class="stringliteral">&quot;subivideNurb3&quot;</span>);
<a name="l03018"></a>03018             sel= 0;
<a name="l03019"></a>03019 
<a name="l03020"></a>03020          <span class="comment">/* Count the number of selected points. */</span>
<a name="l03021"></a>03021             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l03022"></a>03022             <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; a++) {
<a name="l03023"></a>03023                 <span class="keywordflow">for</span> (b=0; b&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; b++) {
<a name="l03024"></a>03024                     <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l03025"></a>03025                         usel[b]++;
<a name="l03026"></a>03026                         vsel[a]++;
<a name="l03027"></a>03027                         sel++;
<a name="l03028"></a>03028                     }
<a name="l03029"></a>03029                     bp++;
<a name="l03030"></a>03030                 }
<a name="l03031"></a>03031             }
<a name="l03032"></a>03032             <span class="keywordflow">if</span> ( sel == (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>) ) {  <span class="comment">/* subdivide entire nurb */</span>
<a name="l03033"></a>03033                 <span class="comment">/* Global subdivision is a special case of partial</span>
<a name="l03034"></a>03034 <span class="comment">                 * subdivision. Strange it is considered separately... */</span>
<a name="l03035"></a>03035 
<a name="l03036"></a>03036                 <span class="comment">/* count of nodes (after subdivision) along U axis */</span>
<a name="l03037"></a>03037                 <span class="keywordtype">int</span> countu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> + (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> - 1) * number_cuts;
<a name="l03038"></a>03038 
<a name="l03039"></a>03039                 <span class="comment">/* total count of nodes after subdivision */</span>
<a name="l03040"></a>03040                 <span class="keywordtype">int</span> tot= ((number_cuts+1)*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-number_cuts)*((number_cuts+1)*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>-number_cuts);
<a name="l03041"></a>03041 
<a name="l03042"></a>03042                 bpn=bpnew= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>( tot*<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>), <span class="stringliteral">&quot;subdivideNurb4&quot;</span>);
<a name="l03043"></a>03043                 bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l03044"></a>03044                 <span class="comment">/* first subdivide rows */</span>
<a name="l03045"></a>03045                 <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; a++) {
<a name="l03046"></a>03046                     <span class="keywordflow">for</span> (b=0; b&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; b++) {
<a name="l03047"></a>03047                         *bpn= *bp;
<a name="l03048"></a>03048                         <a class="code" href="../../d7/d55/editcurve_8c.html#a0233d7e5f22fabe021f3902c3127dafc">keyIndex_updateBP</a>(editnurb, bp, bpn, 1);
<a name="l03049"></a>03049                         bpn++; 
<a name="l03050"></a>03050                         bp++;
<a name="l03051"></a>03051                         <span class="keywordflow">if</span> (b&lt;nu-&gt;pntsu-1) {
<a name="l03052"></a>03052                             prevbp= bp-1;
<a name="l03053"></a>03053                             <span class="keywordflow">for</span> (i = 0; i &lt; number_cuts; i++) {
<a name="l03054"></a>03054                                 factor = (float)(i + 1) / (number_cuts + 1);
<a name="l03055"></a>03055                                 *bpn= *bp;
<a name="l03056"></a>03056                                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5d96900cbf6d1bc0c8a6c02ea0836564">interp_v4_v4v4</a>(bpn-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, prevbp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, factor);
<a name="l03057"></a>03057                                 bpn++;
<a name="l03058"></a>03058                             }
<a name="l03059"></a>03059                         }
<a name="l03060"></a>03060                     }
<a name="l03061"></a>03061                     bpn+= number_cuts * countu;
<a name="l03062"></a>03062                 }
<a name="l03063"></a>03063                 <span class="comment">/* now insert new */</span>
<a name="l03064"></a>03064                 bpn= bpnew+((number_cuts+1)*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> - number_cuts);
<a name="l03065"></a>03065                 bp= bpnew+(number_cuts+1)*((number_cuts+1)*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-number_cuts);
<a name="l03066"></a>03066                 prevbp= bpnew;
<a name="l03067"></a>03067                 <span class="keywordflow">for</span> (a=1; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; a++) {
<a name="l03068"></a>03068 
<a name="l03069"></a>03069                     <span class="keywordflow">for</span> (b=0; b&lt;(number_cuts+1)*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-number_cuts; b++) {
<a name="l03070"></a>03070                         <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *tmp= bpn;
<a name="l03071"></a>03071                         <span class="keywordflow">for</span> (i = 0; i &lt; number_cuts; i++) {
<a name="l03072"></a>03072                             factor = (float)(i + 1) / (number_cuts + 1);
<a name="l03073"></a>03073                             *tmp= *bp;
<a name="l03074"></a>03074                             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5d96900cbf6d1bc0c8a6c02ea0836564">interp_v4_v4v4</a>(tmp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, prevbp-&gt;vec, bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, factor);
<a name="l03075"></a>03075                             tmp += countu;
<a name="l03076"></a>03076                         }
<a name="l03077"></a>03077                         bp++; 
<a name="l03078"></a>03078                         prevbp++;
<a name="l03079"></a>03079                         bpn++;
<a name="l03080"></a>03080                     }
<a name="l03081"></a>03081                     bp+= number_cuts * countu;
<a name="l03082"></a>03082                     bpn+= number_cuts * countu;
<a name="l03083"></a>03083                     prevbp+= number_cuts * countu;
<a name="l03084"></a>03084                 }
<a name="l03085"></a>03085                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l03086"></a>03086                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= bpnew;
<a name="l03087"></a>03087                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= (number_cuts+1)*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-number_cuts;
<a name="l03088"></a>03088                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>= (number_cuts+1)*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>-number_cuts;
<a name="l03089"></a>03089                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(nu);
<a name="l03090"></a>03090                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67a9890171625dedc07c1b7566703ddb">nurbs_knot_calc_v</a>(nu);
<a name="l03091"></a>03091             } <span class="comment">/* End of &#39;if (sel== nu-&gt;pntsu*nu-&gt;pntsv)&#39; (subdivide entire NURB) */</span>
<a name="l03092"></a>03092             <span class="keywordflow">else</span> {
<a name="l03093"></a>03093                 <span class="comment">/* subdivide in v direction? */</span>
<a name="l03094"></a>03094                 sel= 0;
<a name="l03095"></a>03095                 <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>-1; a++) {
<a name="l03096"></a>03096                     <span class="keywordflow">if</span> (vsel[a]==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> &amp;&amp; vsel[a+1]==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) sel+=number_cuts;
<a name="l03097"></a>03097                 }
<a name="l03098"></a>03098 
<a name="l03099"></a>03099                 <span class="keywordflow">if</span> (sel) {   <span class="comment">/* V ! */</span>
<a name="l03100"></a>03100                     bpn=bpnew= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>( (sel+nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>)*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>), <span class="stringliteral">&quot;subdivideNurb4&quot;</span>);
<a name="l03101"></a>03101                     bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l03102"></a>03102                     <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; a++) {
<a name="l03103"></a>03103                         <span class="keywordflow">for</span> (b=0; b&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; b++) {
<a name="l03104"></a>03104                             *bpn= *bp;
<a name="l03105"></a>03105                             <a class="code" href="../../d7/d55/editcurve_8c.html#a0233d7e5f22fabe021f3902c3127dafc">keyIndex_updateBP</a>(editnurb, bp, bpn, 1);
<a name="l03106"></a>03106                             bpn++;
<a name="l03107"></a>03107                             bp++;
<a name="l03108"></a>03108                         }
<a name="l03109"></a>03109                         <span class="keywordflow">if</span> ( (a&lt;nu-&gt;pntsv-1) &amp;&amp; vsel[a]==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> &amp;&amp; vsel[a+1]==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> ) {
<a name="l03110"></a>03110                             <span class="keywordflow">for</span> (i = 0; i &lt; number_cuts; i++) {
<a name="l03111"></a>03111                                 factor = (float)(i + 1) / (number_cuts + 1);
<a name="l03112"></a>03112                                 prevbp= bp- nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l03113"></a>03113                                 <span class="keywordflow">for</span> (b=0; b&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; b++) {
<a name="l03114"></a>03114                                         <span class="comment">/*</span>
<a name="l03115"></a>03115 <span class="comment">                                         * This simple bisection must be replaces by a</span>
<a name="l03116"></a>03116 <span class="comment">                                         * subtle resampling of a number of points. Our</span>
<a name="l03117"></a>03117 <span class="comment">                                         * task is made slightly easier because each</span>
<a name="l03118"></a>03118 <span class="comment">                                         * point in our curve is a separate data</span>
<a name="l03119"></a>03119 <span class="comment">                                         * node. (is it?)</span>
<a name="l03120"></a>03120 <span class="comment">                                         */</span>
<a name="l03121"></a>03121                                         *bpn= *prevbp;
<a name="l03122"></a>03122                                         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5d96900cbf6d1bc0c8a6c02ea0836564">interp_v4_v4v4</a>(bpn-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, prevbp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, factor);
<a name="l03123"></a>03123                                         bpn++;
<a name="l03124"></a>03124 
<a name="l03125"></a>03125                                     prevbp++;
<a name="l03126"></a>03126                                     bp++;
<a name="l03127"></a>03127                                 }
<a name="l03128"></a>03128                                 bp-= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l03129"></a>03129                             }
<a name="l03130"></a>03130                         }
<a name="l03131"></a>03131                     }
<a name="l03132"></a>03132                     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l03133"></a>03133                     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= bpnew;
<a name="l03134"></a>03134                     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>+= sel;
<a name="l03135"></a>03135                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67a9890171625dedc07c1b7566703ddb">nurbs_knot_calc_v</a>(nu);
<a name="l03136"></a>03136                 }
<a name="l03137"></a>03137                 <span class="keywordflow">else</span> {
<a name="l03138"></a>03138                     <span class="comment">/* or in u direction? */</span>
<a name="l03139"></a>03139                     sel= 0;
<a name="l03140"></a>03140                     <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1; a++) {
<a name="l03141"></a>03141                         <span class="keywordflow">if</span> (usel[a]==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> &amp;&amp; usel[a+1]==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>) sel+=number_cuts;
<a name="l03142"></a>03142                     }
<a name="l03143"></a>03143 
<a name="l03144"></a>03144                     <span class="keywordflow">if</span> (sel) {  <span class="comment">/* U ! */</span>
<a name="l03145"></a>03145                  <span class="comment">/* Inserting U points is sort of &#39;default&#39; Flat curves only get */</span>
<a name="l03146"></a>03146                  <span class="comment">/* U points inserted in them.                                   */</span>
<a name="l03147"></a>03147                         bpn=bpnew= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>( (sel+nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>)*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>*<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>), <span class="stringliteral">&quot;subdivideNurb4&quot;</span>);
<a name="l03148"></a>03148                         bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l03149"></a>03149                         <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; a++) {
<a name="l03150"></a>03150                             <span class="keywordflow">for</span> (b=0; b&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; b++) {
<a name="l03151"></a>03151                                 *bpn= *bp;
<a name="l03152"></a>03152                                 <a class="code" href="../../d7/d55/editcurve_8c.html#a0233d7e5f22fabe021f3902c3127dafc">keyIndex_updateBP</a>(editnurb, bp, bpn, 1);
<a name="l03153"></a>03153                                 bpn++; 
<a name="l03154"></a>03154                                 bp++;
<a name="l03155"></a>03155                                 <span class="keywordflow">if</span> ( (b&lt;nu-&gt;pntsu-1) &amp;&amp; usel[b]==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> &amp;&amp; usel[b+1]==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> ) {
<a name="l03156"></a>03156                                     <span class="comment">/*</span>
<a name="l03157"></a>03157 <span class="comment">                                     * One thing that bugs me here is that the</span>
<a name="l03158"></a>03158 <span class="comment">                                     * orders of things are not the same as in</span>
<a name="l03159"></a>03159 <span class="comment">                                     * the JW piece. Also, this implies that we</span>
<a name="l03160"></a>03160 <span class="comment">                                     * handle at most 3rd order curves? I miss</span>
<a name="l03161"></a>03161 <span class="comment">                                     * some symmetry here...</span>
<a name="l03162"></a>03162 <span class="comment">                                     */</span>
<a name="l03163"></a>03163                                     <span class="keywordflow">for</span> (i = 0; i &lt; number_cuts; i++) {
<a name="l03164"></a>03164                                         factor = (float)(i + 1) / (number_cuts + 1);
<a name="l03165"></a>03165                                     prevbp= bp- 1;
<a name="l03166"></a>03166                                     *bpn= *prevbp;
<a name="l03167"></a>03167                                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5d96900cbf6d1bc0c8a6c02ea0836564">interp_v4_v4v4</a>(bpn-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, prevbp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, factor);
<a name="l03168"></a>03168                                     bpn++;
<a name="l03169"></a>03169                                     }
<a name="l03170"></a>03170                                 }
<a name="l03171"></a>03171                             }
<a name="l03172"></a>03172                         }
<a name="l03173"></a>03173                         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l03174"></a>03174                         nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= bpnew;
<a name="l03175"></a>03175                         nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>+= sel;
<a name="l03176"></a>03176                         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(nu); <span class="comment">/* shift knots forward */</span>
<a name="l03177"></a>03177                     }
<a name="l03178"></a>03178                 }
<a name="l03179"></a>03179             }
<a name="l03180"></a>03180             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(usel); 
<a name="l03181"></a>03181             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(vsel);
<a name="l03182"></a>03182 
<a name="l03183"></a>03183         } <span class="comment">/* End of &#39;if (nu-&gt;type == CU_NURBS)&#39;  */</span>
<a name="l03184"></a>03184     }
<a name="l03185"></a>03185 }
<a name="l03186"></a>03186 
<a name="l03187"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ab8595c19b41915db91c74aaf20198798">03187</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ab8595c19b41915db91c74aaf20198798">subdivide_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l03188"></a>03188 {
<a name="l03189"></a>03189     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l03190"></a>03190     <span class="keywordtype">int</span> number_cuts= <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;number_cuts&quot;</span>);
<a name="l03191"></a>03191 
<a name="l03192"></a>03192     <a class="code" href="../../d7/d55/editcurve_8c.html#ade3e6af6236bcaa7621d2a7fcb20d60f">subdividenurb</a>(obedit, number_cuts);
<a name="l03193"></a>03193 
<a name="l03194"></a>03194     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a1a79334fb2fbb2d4951b7196c64a9edb">ED_curve_updateAnimPaths</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>))
<a name="l03195"></a>03195         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ab2ab88214d816c47ebee1a985b0e68b3">ND_KEYS</a>, obedit);
<a name="l03196"></a>03196 
<a name="l03197"></a>03197     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l03198"></a>03198     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l03199"></a>03199 
<a name="l03200"></a>03200     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;   
<a name="l03201"></a>03201 }
<a name="l03202"></a>03202 
<a name="l03203"></a><a class="code" href="../../d7/d55/editcurve_8c.html#af73700f9a6b6b1da62540e21d940476b">03203</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a4f60da5f371ad3dd173c3602a03388af">CURVE_OT_subdivide</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l03204"></a>03204 {
<a name="l03205"></a>03205     <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *prop;
<a name="l03206"></a>03206 
<a name="l03207"></a>03207     <span class="comment">/* identifiers */</span>
<a name="l03208"></a>03208     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Subdivide&quot;</span>;
<a name="l03209"></a>03209     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Subdivide selected segments&quot;</span>;
<a name="l03210"></a>03210     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_subdivide&quot;</span>;
<a name="l03211"></a>03211     
<a name="l03212"></a>03212     <span class="comment">/* api callbacks */</span>
<a name="l03213"></a>03213     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#ab8595c19b41915db91c74aaf20198798">subdivide_exec</a>;
<a name="l03214"></a>03214     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l03215"></a>03215     
<a name="l03216"></a>03216     <span class="comment">/* flags */</span>
<a name="l03217"></a>03217     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l03218"></a>03218 
<a name="l03219"></a>03219     prop = <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;number_cuts&quot;</span>, 1, 1, INT_MAX, <span class="stringliteral">&quot;Number of cuts&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 1, 10);
<a name="l03220"></a>03220     <span class="comment">/* avoid re-using last var because it can cause _very_ high poly meshes and annoy users (or worse crash) */</span>
<a name="l03221"></a>03221     <a class="code" href="../../dc/d7e/rna__define_8c.html#a97e75cad8daa0d94523c8df118947191">RNA_def_property_flag</a>(prop, <a class="code" href="../../de/d7e/RNA__types_8h.html#ae770cf51782953d602fb7ec23d3f2411ac49bd36c069e337f7ee269c672ef1332">PROP_SKIP_SAVE</a>);
<a name="l03222"></a>03222 }
<a name="l03223"></a>03223 
<a name="l03224"></a>03224 <span class="comment">/******************** find nearest ************************/</span>
<a name="l03225"></a>03225 
<a name="l03226"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a92acba6f239731bf1da4434f2e27a379">03226</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a92acba6f239731bf1da4434f2e27a379">findnearestNurbvert__doClosest</a>(<span class="keywordtype">void</span> *userData, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt, <span class="keywordtype">int</span> beztindex, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)
<a name="l03227"></a>03227 {
<a name="l03228"></a>03228     <span class="keyword">struct </span>{ <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp; <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt; <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nurb; <span class="keywordtype">int</span> dist, hpoint, select, mval[2]; } *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = userData;
<a name="l03229"></a>03229 
<a name="l03230"></a>03230     <span class="keywordtype">short</span> flag;
<a name="l03231"></a>03231     <span class="keywordtype">short</span> temp;
<a name="l03232"></a>03232 
<a name="l03233"></a>03233     <span class="keywordflow">if</span> (bp) {
<a name="l03234"></a>03234         flag = bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a>;
<a name="l03235"></a>03235     }
<a name="l03236"></a>03236     <span class="keywordflow">else</span> {
<a name="l03237"></a>03237         <span class="keywordflow">if</span> (beztindex==0) {
<a name="l03238"></a>03238             flag = bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a>;
<a name="l03239"></a>03239         }
<a name="l03240"></a>03240         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (beztindex==1) {
<a name="l03241"></a>03241             flag = bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a>;
<a name="l03242"></a>03242         }
<a name="l03243"></a>03243         <span class="keywordflow">else</span> {
<a name="l03244"></a>03244             flag = bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a>;
<a name="l03245"></a>03245         }
<a name="l03246"></a>03246     }
<a name="l03247"></a>03247 
<a name="l03248"></a>03248     temp = <a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>(<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>-&gt;mval[0]-x) + <a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>(<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>-&gt;mval[1]-y);
<a name="l03249"></a>03249     <span class="keywordflow">if</span> ((flag&amp;1)==<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>-&gt;select) temp += 5;
<a name="l03250"></a>03250     <span class="keywordflow">if</span> (bezt &amp;&amp; beztindex==1) temp += 3; <span class="comment">/* middle points get a small disadvantage */</span>
<a name="l03251"></a>03251 
<a name="l03252"></a>03252     <span class="keywordflow">if</span> (temp&lt;data-&gt;dist) {
<a name="l03253"></a>03253         <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>-&gt;dist = temp;
<a name="l03254"></a>03254 
<a name="l03255"></a>03255         <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>-&gt;bp = bp;
<a name="l03256"></a>03256         <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>-&gt;bezt = bezt;
<a name="l03257"></a>03257         <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>-&gt;nurb = nu;
<a name="l03258"></a>03258         <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>-&gt;hpoint = bezt?beztindex:0;
<a name="l03259"></a>03259     }
<a name="l03260"></a>03260 }
<a name="l03261"></a>03261 
<a name="l03262"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a019e7552a307cad4df99d528d5d5249f">03262</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a019e7552a307cad4df99d528d5d5249f">findnearestNurbvert</a>(<a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> *vc, <span class="keywordtype">short</span> sel, <span class="keyword">const</span> <span class="keywordtype">int</span> mval[2], <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> **nurb, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> **bezt, <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> **bp)
<a name="l03263"></a>03263 {
<a name="l03264"></a>03264         <span class="comment">/* sel==1: selected gets a disadvantage */</span>
<a name="l03265"></a>03265         <span class="comment">/* in nurb and bezt or bp the nearest is written */</span>
<a name="l03266"></a>03266         <span class="comment">/* return 0 1 2: handlepunt */</span>
<a name="l03267"></a>03267     <span class="keyword">struct </span>{ <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp; <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt; <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nurb; <span class="keywordtype">int</span> dist, hpoint, select, mval[2]; } <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l03268"></a>03268 
<a name="l03269"></a>03269     <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>.dist = 100;
<a name="l03270"></a>03270     <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>.hpoint = 0;
<a name="l03271"></a>03271     <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>.select = sel;
<a name="l03272"></a>03272     <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>.mval[0] = mval[0];
<a name="l03273"></a>03273     <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>.mval[1] = mval[1];
<a name="l03274"></a>03274 
<a name="l03275"></a>03275     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a24e3af8e001ec247ef564377a403c05a">ED_view3d_init_mats_rv3d</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#aa802aba424149fb5c03e34795a836810">obedit</a>, vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#ae849219034a130d5a58b5164ab8fc960">rv3d</a>);
<a name="l03276"></a>03276     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a74cc4c276a67e166dcdb5056d8a45cef">nurbs_foreachScreenVert</a>(vc, <a class="code" href="../../d7/d55/editcurve_8c.html#a92acba6f239731bf1da4434f2e27a379">findnearestNurbvert__doClosest</a>, &amp;<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>);
<a name="l03277"></a>03277 
<a name="l03278"></a>03278     *nurb = <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>.nurb;
<a name="l03279"></a>03279     *bezt = <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>.bezt;
<a name="l03280"></a>03280     *bp = <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>.bp;
<a name="l03281"></a>03281 
<a name="l03282"></a>03282     <span class="keywordflow">return</span> <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>.hpoint;
<a name="l03283"></a>03283 }
<a name="l03284"></a>03284 
<a name="l03285"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a290ad9774c86dd69c224950eb7ae6712">03285</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a290ad9774c86dd69c224950eb7ae6712">findselectedNurbvert</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> **nu, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> **bezt, <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> **bp)
<a name="l03286"></a>03286 {
<a name="l03287"></a>03287     <span class="comment">/* in nu and (bezt or bp) selected are written if there&#39;s 1 sel.  */</span>
<a name="l03288"></a>03288     <span class="comment">/* if more points selected in 1 spline: return only nu, bezt and bp are 0 */</span>
<a name="l03289"></a>03289     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu1;
<a name="l03290"></a>03290     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt1;
<a name="l03291"></a>03291     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp1;
<a name="l03292"></a>03292     <span class="keywordtype">int</span> a;
<a name="l03293"></a>03293 
<a name="l03294"></a>03294     *nu= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03295"></a>03295     *bezt= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03296"></a>03296     *bp= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03297"></a>03297     <span class="keywordflow">for</span> (nu1= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu1; nu1= nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l03298"></a>03298         <span class="keywordflow">if</span> (nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l03299"></a>03299             bezt1= nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l03300"></a>03300             a= nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l03301"></a>03301             <span class="keywordflow">while</span> (a--) {
<a name="l03302"></a>03302                 <span class="keywordflow">if</span> ( (bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) || (bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) || (bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) ) {
<a name="l03303"></a>03303                     <span class="keywordflow">if</span> (*nu != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; *nu != nu1) {
<a name="l03304"></a>03304                         *nu= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03305"></a>03305                         *bp= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03306"></a>03306                         *bezt= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03307"></a>03307                         <span class="keywordflow">return</span>;
<a name="l03308"></a>03308                     }
<a name="l03309"></a>03309                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*bezt || *bp) {
<a name="l03310"></a>03310                         *bp= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03311"></a>03311                         *bezt= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03312"></a>03312                     }
<a name="l03313"></a>03313                     <span class="keywordflow">else</span> {
<a name="l03314"></a>03314                         *bezt= bezt1;
<a name="l03315"></a>03315                         *nu= nu1;
<a name="l03316"></a>03316                     }
<a name="l03317"></a>03317                 }
<a name="l03318"></a>03318                 bezt1++;
<a name="l03319"></a>03319             }
<a name="l03320"></a>03320         }
<a name="l03321"></a>03321         <span class="keywordflow">else</span> {
<a name="l03322"></a>03322             bp1= nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l03323"></a>03323             a= nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l03324"></a>03324             <span class="keywordflow">while</span> (a--) {
<a name="l03325"></a>03325                 <span class="keywordflow">if</span> ( bp1-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; 1 ) {
<a name="l03326"></a>03326                     <span class="keywordflow">if</span> (*nu != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; *nu != nu1) {
<a name="l03327"></a>03327                         *bp= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03328"></a>03328                         *bezt= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03329"></a>03329                         *nu= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03330"></a>03330                         <span class="keywordflow">return</span>;
<a name="l03331"></a>03331                     }
<a name="l03332"></a>03332                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*bezt || *bp) {
<a name="l03333"></a>03333                         *bp= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03334"></a>03334                         *bezt= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03335"></a>03335                     }
<a name="l03336"></a>03336                     <span class="keywordflow">else</span> {
<a name="l03337"></a>03337                         *bp= bp1;
<a name="l03338"></a>03338                         *nu= nu1;
<a name="l03339"></a>03339                     }
<a name="l03340"></a>03340                 }
<a name="l03341"></a>03341                 bp1++;
<a name="l03342"></a>03342             }
<a name="l03343"></a>03343         }
<a name="l03344"></a>03344     }
<a name="l03345"></a>03345 }
<a name="l03346"></a>03346 
<a name="l03347"></a>03347 <span class="comment">/***************** set spline type operator *******************/</span>
<a name="l03348"></a>03348 
<a name="l03349"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ae10beb717a0dfbf2d710e4191716fe9d">03349</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ae10beb717a0dfbf2d710e4191716fe9d">convertspline</a>(<span class="keywordtype">short</span> type, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l03350"></a>03350 {
<a name="l03351"></a>03351     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l03352"></a>03352     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l03353"></a>03353     <span class="keywordtype">int</span> a, c, nr;
<a name="l03354"></a>03354 
<a name="l03355"></a>03355     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af3fcb97faad660091cefad29858eec77">CU_POLY</a>) {
<a name="l03356"></a>03356         <span class="keywordflow">if</span> (type==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {              <span class="comment">/* to Bezier with vecthandles  */</span>
<a name="l03357"></a>03357             nr= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l03358"></a>03358             bezt =
<a name="l03359"></a>03359                 (<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(nr * <span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>), <span class="stringliteral">&quot;setsplinetype2&quot;</span>);
<a name="l03360"></a>03360             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>= bezt;
<a name="l03361"></a>03361             a= nr;
<a name="l03362"></a>03362             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l03363"></a>03363             <span class="keywordflow">while</span> (a--) {
<a name="l03364"></a>03364                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1], bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l03365"></a>03365                 bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a>=bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a>=bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a>= bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a>;
<a name="l03366"></a>03366                 bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>= bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>;
<a name="l03367"></a>03367                 bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad23314941e5bb9f62166fb79d623d2c3">weight</a>= bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a35879465825fbbab506bf4ccf2bbd8c2">weight</a>;
<a name="l03368"></a>03368                 bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a>= bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aa3142e8e1888fbd226cbe1d5ca47b4ac">radius</a>;
<a name="l03369"></a>03369                 bp++;
<a name="l03370"></a>03370                 bezt++;
<a name="l03371"></a>03371             }
<a name="l03372"></a>03372             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l03373"></a>03373             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03374"></a>03374             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= nr;
<a name="l03375"></a>03375             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> = <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>;
<a name="l03376"></a>03376             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(nu);
<a name="l03377"></a>03377         }
<a name="l03378"></a>03378         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l03379"></a>03379             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> = <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>;
<a name="l03380"></a>03380             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>= 4;
<a name="l03381"></a>03381             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp;= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>; <span class="comment">/* disable all flags except for cyclic */</span>
<a name="l03382"></a>03382             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(nu);
<a name="l03383"></a>03383             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l03384"></a>03384             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l03385"></a>03385             <span class="keywordflow">while</span> (a--) {
<a name="l03386"></a>03386                 bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[3]= 1.0;
<a name="l03387"></a>03387                 bp++;
<a name="l03388"></a>03388             }
<a name="l03389"></a>03389         }
<a name="l03390"></a>03390     }
<a name="l03391"></a>03391     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {   <span class="comment">/* Bezier */</span>
<a name="l03392"></a>03392         <span class="keywordflow">if</span> (type==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af3fcb97faad660091cefad29858eec77">CU_POLY</a> || type==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l03393"></a>03393             nr= 3*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l03394"></a>03394             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(nr * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>), <span class="stringliteral">&quot;setsplinetype&quot;</span>);
<a name="l03395"></a>03395             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l03396"></a>03396             bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l03397"></a>03397             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l03398"></a>03398             <span class="keywordflow">while</span> (a--) {
<a name="l03399"></a>03399                 <span class="keywordflow">if</span> (type==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af3fcb97faad660091cefad29858eec77">CU_POLY</a> &amp;&amp; bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a> &amp;&amp; bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>) {
<a name="l03400"></a>03400                     <span class="comment">/* vector handle becomes 1 poly vertice */</span>
<a name="l03401"></a>03401                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1]);
<a name="l03402"></a>03402                     bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[3]= 1.0;
<a name="l03403"></a>03403                     bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a>= bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a>;
<a name="l03404"></a>03404                     nr-= 2;
<a name="l03405"></a>03405                     bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aa3142e8e1888fbd226cbe1d5ca47b4ac">radius</a>= bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a>;
<a name="l03406"></a>03406                     bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a35879465825fbbab506bf4ccf2bbd8c2">weight</a>= bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad23314941e5bb9f62166fb79d623d2c3">weight</a>;
<a name="l03407"></a>03407                     bp++;
<a name="l03408"></a>03408                 }
<a name="l03409"></a>03409                 <span class="keywordflow">else</span> {
<a name="l03410"></a>03410                     <span class="keywordflow">for</span> (c=0;c&lt;3;c++) {
<a name="l03411"></a>03411                         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[c]);
<a name="l03412"></a>03412                         bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[3]= 1.0;
<a name="l03413"></a>03413                         <span class="keywordflow">if</span> (c==0) bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a>= bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a>;
<a name="l03414"></a>03414                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c==1) bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a>= bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a>;
<a name="l03415"></a>03415                         <span class="keywordflow">else</span> bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a>= bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a>;
<a name="l03416"></a>03416                         bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aa3142e8e1888fbd226cbe1d5ca47b4ac">radius</a>= bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a>;
<a name="l03417"></a>03417                         bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a35879465825fbbab506bf4ccf2bbd8c2">weight</a>= bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad23314941e5bb9f62166fb79d623d2c3">weight</a>;
<a name="l03418"></a>03418                         bp++;
<a name="l03419"></a>03419                     }
<a name="l03420"></a>03420                 }
<a name="l03421"></a>03421                 bezt++;
<a name="l03422"></a>03422             }
<a name="l03423"></a>03423             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>); 
<a name="l03424"></a>03424             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03425"></a>03425             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= nr;
<a name="l03426"></a>03426             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>= 1;
<a name="l03427"></a>03427             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>= 4;
<a name="l03428"></a>03428             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>= 1;
<a name="l03429"></a>03429             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> = type;
<a name="l03430"></a>03430 
<a name="l03431"></a>03431 <span class="preprocessor">#if 0       </span><span class="comment">/* UNUSED */</span>
<a name="l03432"></a>03432             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) c= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>-1; 
<a name="l03433"></a>03433             <span class="keywordflow">else</span> c= 0;
<a name="l03434"></a>03434 <span class="preprocessor">#endif</span>
<a name="l03435"></a>03435 <span class="preprocessor"></span>
<a name="l03436"></a>03436             <span class="keywordflow">if</span> (type== <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l03437"></a>03437                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp;= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>; <span class="comment">/* disable all flags except for cyclic */</span>
<a name="l03438"></a>03438                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> |= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a644364540eb9666e65a7039995b0fef8">CU_NURB_BEZIER</a>;
<a name="l03439"></a>03439                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(nu);
<a name="l03440"></a>03440             }
<a name="l03441"></a>03441         }
<a name="l03442"></a>03442     }
<a name="l03443"></a>03443     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l03444"></a>03444         <span class="keywordflow">if</span> (type==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af3fcb97faad660091cefad29858eec77">CU_POLY</a>) {
<a name="l03445"></a>03445             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> = <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af3fcb97faad660091cefad29858eec77">CU_POLY</a>;
<a name="l03446"></a>03446             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>); <span class="comment">/* python created nurbs have a knotsu of zero */</span>
<a name="l03447"></a>03447             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03448"></a>03448             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>);
<a name="l03449"></a>03449             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03450"></a>03450         }
<a name="l03451"></a>03451         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {     <span class="comment">/* to Bezier */</span>
<a name="l03452"></a>03452             nr= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>/3;
<a name="l03453"></a>03453 
<a name="l03454"></a>03454             <span class="keywordflow">if</span> (nr&lt;2) 
<a name="l03455"></a>03455                 <span class="keywordflow">return</span> 1;   <span class="comment">/* conversion impossible */</span>
<a name="l03456"></a>03456             <span class="keywordflow">else</span> {
<a name="l03457"></a>03457                 bezt = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(nr * <span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>), <span class="stringliteral">&quot;setsplinetype2&quot;</span>);
<a name="l03458"></a>03458                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>= bezt;
<a name="l03459"></a>03459                 a= nr;
<a name="l03460"></a>03460                 bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l03461"></a>03461                 <span class="keywordflow">while</span> (a--) {
<a name="l03462"></a>03462                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0], bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l03463"></a>03463                     bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a>= bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a>;
<a name="l03464"></a>03464                     bp++;
<a name="l03465"></a>03465                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1], bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l03466"></a>03466                     bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a>= bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a>;
<a name="l03467"></a>03467                     bp++;
<a name="l03468"></a>03468                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2], bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l03469"></a>03469                     bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a>= bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a>;
<a name="l03470"></a>03470                     bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a>= bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aa3142e8e1888fbd226cbe1d5ca47b4ac">radius</a>;
<a name="l03471"></a>03471                     bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad23314941e5bb9f62166fb79d623d2c3">weight</a>= bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a35879465825fbbab506bf4ccf2bbd8c2">weight</a>;
<a name="l03472"></a>03472                     bp++;
<a name="l03473"></a>03473                     bezt++;
<a name="l03474"></a>03474                 }
<a name="l03475"></a>03475                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l03476"></a>03476                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03477"></a>03477                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>);
<a name="l03478"></a>03478                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03479"></a>03479                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= nr;
<a name="l03480"></a>03480                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> = <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>;
<a name="l03481"></a>03481             }
<a name="l03482"></a>03482         }
<a name="l03483"></a>03483     }
<a name="l03484"></a>03484 
<a name="l03485"></a>03485     <span class="keywordflow">return</span> 0;
<a name="l03486"></a>03486 }
<a name="l03487"></a>03487 
<a name="l03488"></a><a class="code" href="../../db/d71/ED__curve_8h.html#afef4a53ebdf02dc599c8e640df79f2d6">03488</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ae4489b9ac4c414e14e442b66c557a6fd">ED_nurb_set_spline_type</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, <span class="keywordtype">int</span> type)
<a name="l03489"></a>03489 {
<a name="l03490"></a>03490     <a class="code" href="../../d7/d55/editcurve_8c.html#ae10beb717a0dfbf2d710e4191716fe9d">convertspline</a>(type, nu);
<a name="l03491"></a>03491 }
<a name="l03492"></a>03492 
<a name="l03493"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a301e2307fb757a333e9e87505c380a38">03493</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a301e2307fb757a333e9e87505c380a38">set_spline_type_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l03494"></a>03494 {
<a name="l03495"></a>03495     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l03496"></a>03496     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l03497"></a>03497     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l03498"></a>03498     <span class="keywordtype">int</span> changed=0, type= <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;type&quot;</span>);
<a name="l03499"></a>03499 
<a name="l03500"></a>03500     <span class="keywordflow">if</span> (type==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a2764e1184b446f060617da2d60ac4de8">CU_CARDINAL</a> || type==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ad916e2bf8c94ac7bdfb5a36422173ba8">CU_BSPLINE</a>) {
<a name="l03501"></a>03501         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Not implemented yet&quot;</span>);
<a name="l03502"></a>03502         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03503"></a>03503     }
<a name="l03504"></a>03504     
<a name="l03505"></a>03505     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l03506"></a>03506         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a04a97e645bf45a68ecbbfb7a123e9cac">isNurbsel</a>(nu)) {
<a name="l03507"></a>03507             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#ae10beb717a0dfbf2d710e4191716fe9d">convertspline</a>(type, nu))
<a name="l03508"></a>03508                 <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;No conversion possible&quot;</span>);
<a name="l03509"></a>03509             <span class="keywordflow">else</span>
<a name="l03510"></a>03510                 changed= 1;
<a name="l03511"></a>03511         }
<a name="l03512"></a>03512     }
<a name="l03513"></a>03513 
<a name="l03514"></a>03514     <span class="keywordflow">if</span> (changed) {
<a name="l03515"></a>03515         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a1a79334fb2fbb2d4951b7196c64a9edb">ED_curve_updateAnimPaths</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>))
<a name="l03516"></a>03516             <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ab2ab88214d816c47ebee1a985b0e68b3">ND_KEYS</a>, obedit);
<a name="l03517"></a>03517 
<a name="l03518"></a>03518         <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l03519"></a>03519         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l03520"></a>03520 
<a name="l03521"></a>03521         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l03522"></a>03522     }
<a name="l03523"></a>03523     <span class="keywordflow">else</span> {
<a name="l03524"></a>03524         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03525"></a>03525     }
<a name="l03526"></a>03526 }
<a name="l03527"></a>03527 
<a name="l03528"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a7328f3bf1f1901dc45ec0d8037ae6981">03528</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a86faa39b4c6008be8d792a2b9274fd3c">CURVE_OT_spline_type_set</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l03529"></a>03529 {
<a name="l03530"></a>03530     <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> type_items[]= {
<a name="l03531"></a>03531         {<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af3fcb97faad660091cefad29858eec77">CU_POLY</a>, <span class="stringliteral">&quot;POLY&quot;</span>, 0, <span class="stringliteral">&quot;Poly&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l03532"></a>03532         {<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>, <span class="stringliteral">&quot;BEZIER&quot;</span>, 0, <span class="stringliteral">&quot;Bezier&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l03533"></a>03533 <span class="comment">//      {CU_CARDINAL, &quot;CARDINAL&quot;, 0, &quot;Cardinal&quot;, &quot;&quot;},</span>
<a name="l03534"></a>03534 <span class="comment">//      {CU_BSPLINE, &quot;B_SPLINE&quot;, 0, &quot;B-Spline&quot;, &quot;&quot;},</span>
<a name="l03535"></a>03535         {<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>, <span class="stringliteral">&quot;NURBS&quot;</span>, 0, <span class="stringliteral">&quot;NURBS&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l03536"></a>03536         {0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL}};
<a name="l03537"></a>03537 
<a name="l03538"></a>03538     <span class="comment">/* identifiers */</span>
<a name="l03539"></a>03539     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Set Spline Type&quot;</span>;
<a name="l03540"></a>03540     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Set type of active spline&quot;</span>;
<a name="l03541"></a>03541     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_spline_type_set&quot;</span>;
<a name="l03542"></a>03542     
<a name="l03543"></a>03543     <span class="comment">/* api callbacks */</span>
<a name="l03544"></a>03544     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a301e2307fb757a333e9e87505c380a38">set_spline_type_exec</a>;
<a name="l03545"></a>03545     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a926375c583166540cfa96299e433e071">WM_menu_invoke</a>;
<a name="l03546"></a>03546     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a443591620f4deea4cac8a4098f66d2f7">ED_operator_editcurve</a>;
<a name="l03547"></a>03547     
<a name="l03548"></a>03548     <span class="comment">/* flags */</span>
<a name="l03549"></a>03549     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l03550"></a>03550 
<a name="l03551"></a>03551     <span class="comment">/* properties */</span>
<a name="l03552"></a>03552     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;type&quot;</span>, type_items, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af3fcb97faad660091cefad29858eec77">CU_POLY</a>, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;Spline type&quot;</span>);
<a name="l03553"></a>03553 }
<a name="l03554"></a>03554 
<a name="l03555"></a>03555 <span class="comment">/***************** set handle type operator *******************/</span>
<a name="l03556"></a>03556 
<a name="l03557"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a6d71a598d7004c1c209babd34e992f75">03557</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a6d71a598d7004c1c209babd34e992f75">set_handle_type_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l03558"></a>03558 {
<a name="l03559"></a>03559     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l03560"></a>03560     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l03561"></a>03561 
<a name="l03562"></a>03562     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a8efb4331f56b299e9ef090b6e0957933">sethandlesNurb</a>(editnurb, <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;type&quot;</span>));
<a name="l03563"></a>03563 
<a name="l03564"></a>03564     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l03565"></a>03565     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l03566"></a>03566 
<a name="l03567"></a>03567     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l03568"></a>03568 }
<a name="l03569"></a>03569 
<a name="l03570"></a><a class="code" href="../../d7/d55/editcurve_8c.html#af469fe95f5bfee7a8d2b83b8815202f9">03570</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#afb5af788b65e3eca467062cf835e2620">CURVE_OT_handle_type_set</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l03571"></a>03571 {
<a name="l03572"></a>03572     <span class="comment">/* keep in sync with graphkeys_handle_type_items */</span>
<a name="l03573"></a>03573     <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> editcurve_handle_type_items[]= {
<a name="l03574"></a>03574         {<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>, <span class="stringliteral">&quot;AUTOMATIC&quot;</span>, 0, <span class="stringliteral">&quot;Automatic&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l03575"></a>03575         {<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>, <span class="stringliteral">&quot;VECTOR&quot;</span>, 0, <span class="stringliteral">&quot;Vector&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l03576"></a>03576         {5, <span class="stringliteral">&quot;ALIGNED&quot;</span>, 0, <span class="stringliteral">&quot;Aligned&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l03577"></a>03577         {6, <span class="stringliteral">&quot;FREE_ALIGN&quot;</span>, 0, <span class="stringliteral">&quot;Free&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l03578"></a>03578         {3, <span class="stringliteral">&quot;TOGGLE_FREE_ALIGN&quot;</span>, 0, <span class="stringliteral">&quot;Toggle Free/Align&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l03579"></a>03579         {0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL}};
<a name="l03580"></a>03580 
<a name="l03581"></a>03581     <span class="comment">/* identifiers */</span>
<a name="l03582"></a>03582     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Set Handle Type&quot;</span>;
<a name="l03583"></a>03583     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Set type of handles for selected control points&quot;</span>;
<a name="l03584"></a>03584     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_handle_type_set&quot;</span>;
<a name="l03585"></a>03585     
<a name="l03586"></a>03586     <span class="comment">/* api callbacks */</span>
<a name="l03587"></a>03587     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a926375c583166540cfa96299e433e071">WM_menu_invoke</a>;
<a name="l03588"></a>03588     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a6d71a598d7004c1c209babd34e992f75">set_handle_type_exec</a>;
<a name="l03589"></a>03589     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a443591620f4deea4cac8a4098f66d2f7">ED_operator_editcurve</a>;
<a name="l03590"></a>03590     
<a name="l03591"></a>03591     <span class="comment">/* flags */</span>
<a name="l03592"></a>03592     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l03593"></a>03593 
<a name="l03594"></a>03594     <span class="comment">/* properties */</span>
<a name="l03595"></a>03595     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;type&quot;</span>, editcurve_handle_type_items, 1, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;Spline type&quot;</span>);
<a name="l03596"></a>03596 }
<a name="l03597"></a>03597 
<a name="l03598"></a>03598 <span class="comment">/***************** make segment operator **********************/</span>
<a name="l03599"></a>03599 
<a name="l03600"></a>03600 <span class="comment">/* ******************** SKINNING LOFTING!!! ******************** */</span>
<a name="l03601"></a>03601 
<a name="l03602"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ab0a1f3412748bfc242ee14c4df872cd5">03602</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ab0a1f3412748bfc242ee14c4df872cd5">switchdirection_knots</a>(<span class="keywordtype">float</span> *base, <span class="keywordtype">int</span> tot)
<a name="l03603"></a>03603 {
<a name="l03604"></a>03604     <span class="keywordtype">float</span> *fp1, *fp2, *tempf;
<a name="l03605"></a>03605     <span class="keywordtype">int</span> a;
<a name="l03606"></a>03606     
<a name="l03607"></a>03607     <span class="keywordflow">if</span> (base==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || tot==0) <span class="keywordflow">return</span>;
<a name="l03608"></a>03608     
<a name="l03609"></a>03609     <span class="comment">/* reverse knots */</span>
<a name="l03610"></a>03610     a= tot;
<a name="l03611"></a>03611     fp1= base;
<a name="l03612"></a>03612     fp2= fp1+(a-1);
<a name="l03613"></a>03613     a/= 2;
<a name="l03614"></a>03614     <span class="keywordflow">while</span> (fp1!=fp2 &amp;&amp; a&gt;0) {
<a name="l03615"></a>03615         <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<span class="keywordtype">float</span>, *fp1, *fp2);
<a name="l03616"></a>03616         a--;
<a name="l03617"></a>03617         fp1++; 
<a name="l03618"></a>03618         fp2--;
<a name="l03619"></a>03619     }
<a name="l03620"></a>03620     <span class="comment">/* and make in increasing order again */</span>
<a name="l03621"></a>03621     a= tot;
<a name="l03622"></a>03622     fp1= base;
<a name="l03623"></a>03623     fp2=tempf= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*a, <span class="stringliteral">&quot;switchdirect&quot;</span>);
<a name="l03624"></a>03624     <span class="keywordflow">while</span> (a--) {
<a name="l03625"></a>03625         fp2[0]= <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(fp1[1]-fp1[0]);
<a name="l03626"></a>03626         fp1++;
<a name="l03627"></a>03627         fp2++;
<a name="l03628"></a>03628     }
<a name="l03629"></a>03629 
<a name="l03630"></a>03630     a= tot-1;
<a name="l03631"></a>03631     fp1= base;
<a name="l03632"></a>03632     fp2= tempf;
<a name="l03633"></a>03633     fp1[0]= 0.0;
<a name="l03634"></a>03634     fp1++;
<a name="l03635"></a>03635     <span class="keywordflow">while</span> (a--) {
<a name="l03636"></a>03636         fp1[0]= fp1[-1]+fp2[0];
<a name="l03637"></a>03637         fp1++;
<a name="l03638"></a>03638         fp2++;
<a name="l03639"></a>03639     }
<a name="l03640"></a>03640     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(tempf);
<a name="l03641"></a>03641 }
<a name="l03642"></a>03642 
<a name="l03643"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ade183807e4ef2ef5356807344aa7ff79">03643</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ade183807e4ef2ef5356807344aa7ff79">rotate_direction_nurb</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l03644"></a>03644 {
<a name="l03645"></a>03645     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp1, *bp2, *temp;
<a name="l03646"></a>03646     <span class="keywordtype">int</span> u, v;
<a name="l03647"></a>03647     
<a name="l03648"></a>03648     <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<span class="keywordtype">short</span>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>);
<a name="l03649"></a>03649     <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<span class="keywordtype">short</span>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>);
<a name="l03650"></a>03650     <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<span class="keywordtype">short</span>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#aa4d5f2ef5e32e94dcbe14a1a7d946a30">resolu</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ab9ca5b497098466d579b0343cbe62ae7">resolv</a>);
<a name="l03651"></a>03651     <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<span class="keywordtype">short</span>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ae1c344a45c028d3c2067864f5280854e">flagv</a>);
<a name="l03652"></a>03652     
<a name="l03653"></a>03653     <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<span class="keywordtype">float</span> *, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>);
<a name="l03654"></a>03654     <a class="code" href="../../d7/d55/editcurve_8c.html#ab0a1f3412748bfc242ee14c4df872cd5">switchdirection_knots</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>, <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67f5d26ce1431098dc2c1d4282d8d7b0">KNOTSV</a>(nu) );
<a name="l03655"></a>03655     
<a name="l03656"></a>03656     temp= <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l03657"></a>03657     bp1= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l03658"></a>03658     <span class="keywordflow">for</span> (v=0; v&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; v++) {
<a name="l03659"></a>03659         <span class="keywordflow">for</span> (u=0; u&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; u++, bp1++) {
<a name="l03660"></a>03660             bp2= temp + (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-u-1)*(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>) + v;
<a name="l03661"></a>03661             *bp1= *bp2;
<a name="l03662"></a>03662         }
<a name="l03663"></a>03663     }
<a name="l03664"></a>03664 
<a name="l03665"></a>03665     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(temp);
<a name="l03666"></a>03666 }
<a name="l03667"></a>03667 
<a name="l03668"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a826378a4a7d9447f9a502844319c00de">03668</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a826378a4a7d9447f9a502844319c00de">is_u_selected</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, <span class="keywordtype">int</span> u)
<a name="l03669"></a>03669 {
<a name="l03670"></a>03670     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l03671"></a>03671     <span class="keywordtype">int</span> v;
<a name="l03672"></a>03672     
<a name="l03673"></a>03673     <span class="comment">/* what about resolu == 2? */</span>
<a name="l03674"></a>03674     bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+u;
<a name="l03675"></a>03675     <span class="keywordflow">for</span> (v=0; v&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>-1; v++, bp+=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) {
<a name="l03676"></a>03676         <span class="keywordflow">if</span> (v) <span class="keywordflow">if</span> (bp-&gt;f1 &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) <span class="keywordflow">return</span> 1;
<a name="l03677"></a>03677     }
<a name="l03678"></a>03678     
<a name="l03679"></a>03679     <span class="keywordflow">return</span> 0;
<a name="l03680"></a>03680 }
<a name="l03681"></a>03681 
<a name="l03682"></a><a class="code" href="../../d2/d83/structNurbSort.html">03682</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d83/structNurbSort.html">NurbSort</a> {
<a name="l03683"></a><a class="code" href="../../d2/d83/structNurbSort.html#a86f9e5a689bd8c69602a8c84e6d700d8">03683</a>     <span class="keyword">struct </span><a class="code" href="../../d2/d83/structNurbSort.html">NurbSort</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a4ba9737a3e91d3b0d71d6d59591d1df8">next</a>, *<a class="code" href="../../d2/d83/structNurbSort.html#a86f9e5a689bd8c69602a8c84e6d700d8">prev</a>;
<a name="l03684"></a><a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">03684</a>     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l03685"></a><a class="code" href="../../d2/d83/structNurbSort.html#a5bbbd50dea6dc44f8cd1214e1ac87fe4">03685</a>     <span class="keywordtype">float</span> <a class="code" href="../../d2/d83/structNurbSort.html#a5bbbd50dea6dc44f8cd1214e1ac87fe4">vec</a>[3];
<a name="l03686"></a>03686 } <a class="code" href="../../d7/d55/editcurve_8c.html#ad43bcc75106c89b33489a3c7e98399d2">NurbSort</a>;
<a name="l03687"></a>03687 
<a name="l03688"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ad18619df1d6dbb0a7ca33601af023cf3">03688</a> <span class="keyword">static</span> <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> <a class="code" href="../../d7/d55/editcurve_8c.html#ad18619df1d6dbb0a7ca33601af023cf3">nsortbase</a>= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l03689"></a>03689 <span class="comment">/*  static NurbSort *nusmain; */</span> <span class="comment">/* this var seems to go unused... at least in this file */</span>
<a name="l03690"></a>03690 
<a name="l03691"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a9cdb8ac92e97a238ed6314f54da6453c">03691</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a9cdb8ac92e97a238ed6314f54da6453c">make_selection_list_nurb</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb)
<a name="l03692"></a>03692 {
<a name="l03693"></a>03693     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> nbase= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l03694"></a>03694     <a class="code" href="../../d2/d83/structNurbSort.html">NurbSort</a> *nus, *nustest, *headdo, *taildo;
<a name="l03695"></a>03695     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l03696"></a>03696     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l03697"></a>03697     <span class="keywordtype">float</span> dist, headdist, taildist;
<a name="l03698"></a>03698     <span class="keywordtype">int</span> a;
<a name="l03699"></a>03699     
<a name="l03700"></a>03700     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l03701"></a>03701         <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d55/editcurve_8c.html#a04a97e645bf45a68ecbbfb7a123e9cac">isNurbsel</a>(nu) ) {
<a name="l03702"></a>03702             
<a name="l03703"></a>03703             nus = (<a class="code" href="../../d2/d83/structNurbSort.html">NurbSort</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d2/d83/structNurbSort.html">NurbSort</a>), <span class="stringliteral">&quot;sort&quot;</span>);
<a name="l03704"></a>03704             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#ab5b5ec121d2522c0e8e74e01d6517feb">BLI_addhead</a>(&amp;nbase, nus);
<a name="l03705"></a>03705             nus-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l03706"></a>03706             
<a name="l03707"></a>03707             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l03708"></a>03708             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l03709"></a>03709             <span class="keywordflow">while</span> (a--) {
<a name="l03710"></a>03710                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(nus-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a5bbbd50dea6dc44f8cd1214e1ac87fe4">vec</a>, bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l03711"></a>03711                 bp++;
<a name="l03712"></a>03712             }
<a name="l03713"></a>03713             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(nus-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a5bbbd50dea6dc44f8cd1214e1ac87fe4">vec</a>, 1.0f/(<span class="keywordtype">float</span>)nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>);
<a name="l03714"></a>03714             
<a name="l03715"></a>03715             
<a name="l03716"></a>03716         }
<a name="l03717"></a>03717     }
<a name="l03718"></a>03718 
<a name="l03719"></a>03719     <span class="comment">/* just add the first one */</span>
<a name="l03720"></a>03720     nus= nbase.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03721"></a>03721     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;nbase, nus);
<a name="l03722"></a>03722     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>( &amp;nsortbase, nus);
<a name="l03723"></a>03723     
<a name="l03724"></a>03724     <span class="comment">/* now add, either at head or tail, the closest one */</span>
<a name="l03725"></a>03725     <span class="keywordflow">while</span> (nbase.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l03726"></a>03726     
<a name="l03727"></a>03727         headdist= taildist= 1.0e30;
<a name="l03728"></a>03728         headdo= taildo= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03729"></a>03729 
<a name="l03730"></a>03730         nustest= nbase.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03731"></a>03731         <span class="keywordflow">while</span> (nustest) {
<a name="l03732"></a>03732             dist= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a97ecadbef10e5cc3decc2c02c3b96824">len_v3v3</a>(nustest-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a5bbbd50dea6dc44f8cd1214e1ac87fe4">vec</a>, ((<a class="code" href="../../d2/d83/structNurbSort.html">NurbSort</a> *)nsortbase.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)-&gt;vec);
<a name="l03733"></a>03733 
<a name="l03734"></a>03734             <span class="keywordflow">if</span> (dist&lt;headdist) {
<a name="l03735"></a>03735                 headdist= dist;
<a name="l03736"></a>03736                 headdo= nustest;
<a name="l03737"></a>03737             }
<a name="l03738"></a>03738             dist= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a97ecadbef10e5cc3decc2c02c3b96824">len_v3v3</a>(nustest-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a5bbbd50dea6dc44f8cd1214e1ac87fe4">vec</a>, ((<a class="code" href="../../d2/d83/structNurbSort.html">NurbSort</a> *)nsortbase.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>)-&gt;vec);
<a name="l03739"></a>03739 
<a name="l03740"></a>03740             <span class="keywordflow">if</span> (dist&lt;taildist) {
<a name="l03741"></a>03741                 taildist= dist;
<a name="l03742"></a>03742                 taildo= nustest;
<a name="l03743"></a>03743             }
<a name="l03744"></a>03744             nustest= nustest-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a4ba9737a3e91d3b0d71d6d59591d1df8">next</a>;
<a name="l03745"></a>03745         }
<a name="l03746"></a>03746         
<a name="l03747"></a>03747         <span class="keywordflow">if</span> (headdist&lt;taildist) {
<a name="l03748"></a>03748             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;nbase, headdo);
<a name="l03749"></a>03749             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#ab5b5ec121d2522c0e8e74e01d6517feb">BLI_addhead</a>(&amp;nsortbase, headdo);
<a name="l03750"></a>03750         }
<a name="l03751"></a>03751         <span class="keywordflow">else</span> {
<a name="l03752"></a>03752             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;nbase, taildo);
<a name="l03753"></a>03753             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;nsortbase, taildo);
<a name="l03754"></a>03754         }
<a name="l03755"></a>03755     }
<a name="l03756"></a>03756 }
<a name="l03757"></a>03757 
<a name="l03758"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a73f43c0c7c902fbdb37413cb5184f1b1">03758</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a73f43c0c7c902fbdb37413cb5184f1b1">merge_2_nurb</a>(<a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu1, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu2)
<a name="l03759"></a>03759 {
<a name="l03760"></a>03760     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp, *bp1, *bp2, *temp;
<a name="l03761"></a>03761     <span class="keywordtype">float</span>  len1, len2;
<a name="l03762"></a>03762     <span class="keywordtype">int</span>    origu, u, v;
<a name="l03763"></a>03763     
<a name="l03764"></a>03764     <span class="comment">/* first nurbs will be changed to make u = resolu-1 selected */</span>
<a name="l03765"></a>03765     <span class="comment">/* 2nd nurbs will be changed to make u = 0 selected */</span>
<a name="l03766"></a>03766 
<a name="l03767"></a>03767     <span class="comment">/* first nurbs: u = resolu-1 selected */</span>
<a name="l03768"></a>03768     
<a name="l03769"></a>03769     <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d55/editcurve_8c.html#a826378a4a7d9447f9a502844319c00de">is_u_selected</a>(nu1, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1) );
<a name="l03770"></a>03770     <span class="keywordflow">else</span> {
<a name="l03771"></a>03771         <span class="comment">/* For 2D curves blender uses orderv=0. It doesn&#39;t make any sense mathematically. */</span>
<a name="l03772"></a>03772         <span class="comment">/* but after rotating orderu=0 will be confusing. */</span>
<a name="l03773"></a>03773         <span class="keywordflow">if</span> (nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a> == 0) nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>= 1;
<a name="l03774"></a>03774 
<a name="l03775"></a>03775         <a class="code" href="../../d7/d55/editcurve_8c.html#ade183807e4ef2ef5356807344aa7ff79">rotate_direction_nurb</a>(nu1);
<a name="l03776"></a>03776         <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d55/editcurve_8c.html#a826378a4a7d9447f9a502844319c00de">is_u_selected</a>(nu1, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1) );
<a name="l03777"></a>03777         <span class="keywordflow">else</span> {
<a name="l03778"></a>03778             <a class="code" href="../../d7/d55/editcurve_8c.html#ade183807e4ef2ef5356807344aa7ff79">rotate_direction_nurb</a>(nu1);
<a name="l03779"></a>03779             <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d55/editcurve_8c.html#a826378a4a7d9447f9a502844319c00de">is_u_selected</a>(nu1, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1) );
<a name="l03780"></a>03780             <span class="keywordflow">else</span> {
<a name="l03781"></a>03781                 <a class="code" href="../../d7/d55/editcurve_8c.html#ade183807e4ef2ef5356807344aa7ff79">rotate_direction_nurb</a>(nu1);
<a name="l03782"></a>03782                 <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d55/editcurve_8c.html#a826378a4a7d9447f9a502844319c00de">is_u_selected</a>(nu1, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1) );
<a name="l03783"></a>03783                 <span class="keywordflow">else</span> {
<a name="l03784"></a>03784                     <span class="comment">/* rotate again, now its OK! */</span>
<a name="l03785"></a>03785                     <span class="keywordflow">if</span> (nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>!=1) <a class="code" href="../../d7/d55/editcurve_8c.html#ade183807e4ef2ef5356807344aa7ff79">rotate_direction_nurb</a>(nu1);
<a name="l03786"></a>03786                     <span class="keywordflow">return</span>;
<a name="l03787"></a>03787                 }
<a name="l03788"></a>03788             }
<a name="l03789"></a>03789         }
<a name="l03790"></a>03790     }
<a name="l03791"></a>03791     
<a name="l03792"></a>03792     <span class="comment">/* 2nd nurbs: u = 0 selected */</span>
<a name="l03793"></a>03793     <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d55/editcurve_8c.html#a826378a4a7d9447f9a502844319c00de">is_u_selected</a>(nu2, 0) );
<a name="l03794"></a>03794     <span class="keywordflow">else</span> {
<a name="l03795"></a>03795         <span class="keywordflow">if</span> (nu2-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a> == 0) nu2-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>= 1;
<a name="l03796"></a>03796         <a class="code" href="../../d7/d55/editcurve_8c.html#ade183807e4ef2ef5356807344aa7ff79">rotate_direction_nurb</a>(nu2);
<a name="l03797"></a>03797         <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d55/editcurve_8c.html#a826378a4a7d9447f9a502844319c00de">is_u_selected</a>(nu2, 0) );
<a name="l03798"></a>03798         <span class="keywordflow">else</span> {
<a name="l03799"></a>03799             <a class="code" href="../../d7/d55/editcurve_8c.html#ade183807e4ef2ef5356807344aa7ff79">rotate_direction_nurb</a>(nu2);
<a name="l03800"></a>03800             <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d55/editcurve_8c.html#a826378a4a7d9447f9a502844319c00de">is_u_selected</a>(nu2, 0) );
<a name="l03801"></a>03801             <span class="keywordflow">else</span> {
<a name="l03802"></a>03802                 <a class="code" href="../../d7/d55/editcurve_8c.html#ade183807e4ef2ef5356807344aa7ff79">rotate_direction_nurb</a>(nu2);
<a name="l03803"></a>03803                 <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d55/editcurve_8c.html#a826378a4a7d9447f9a502844319c00de">is_u_selected</a>(nu2, 0) );
<a name="l03804"></a>03804                 <span class="keywordflow">else</span> {
<a name="l03805"></a>03805                     <span class="comment">/* rotate again, now its OK! */</span>
<a name="l03806"></a>03806                     <span class="keywordflow">if</span> (nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>==1) <a class="code" href="../../d7/d55/editcurve_8c.html#ade183807e4ef2ef5356807344aa7ff79">rotate_direction_nurb</a>(nu1);
<a name="l03807"></a>03807                     <span class="keywordflow">if</span> (nu2-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>!=1) <a class="code" href="../../d7/d55/editcurve_8c.html#ade183807e4ef2ef5356807344aa7ff79">rotate_direction_nurb</a>(nu2);
<a name="l03808"></a>03808                     <span class="keywordflow">return</span>;
<a name="l03809"></a>03809                 }
<a name="l03810"></a>03810             }
<a name="l03811"></a>03811         }
<a name="l03812"></a>03812     }
<a name="l03813"></a>03813     
<a name="l03814"></a>03814     <span class="keywordflow">if</span> ( nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> != nu2-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> ) {
<a name="l03815"></a>03815         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Resolution doesn&#39;t match&quot;</span>);
<a name="l03816"></a>03816         <span class="keywordflow">return</span>;
<a name="l03817"></a>03817     }
<a name="l03818"></a>03818     
<a name="l03819"></a>03819     <span class="comment">/* ok, now nu1 has the rightmost column and nu2 the leftmost column selected */</span>
<a name="l03820"></a>03820     <span class="comment">/* maybe we need a &#39;v&#39; flip of nu2? */</span>
<a name="l03821"></a>03821     
<a name="l03822"></a>03822     bp1= nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1;
<a name="l03823"></a>03823     bp2= nu2-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l03824"></a>03824     len1= 0.0;
<a name="l03825"></a>03825     
<a name="l03826"></a>03826     <span class="keywordflow">for</span> (v=0; v&lt;nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; v++, bp1+=nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>, bp2+=nu2-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) {
<a name="l03827"></a>03827         len1+= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a97ecadbef10e5cc3decc2c02c3b96824">len_v3v3</a>(bp1-&gt;vec, bp2-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l03828"></a>03828     }
<a name="l03829"></a>03829 
<a name="l03830"></a>03830     bp1= nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> + nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1;
<a name="l03831"></a>03831     bp2= nu2-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> + nu2-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*(nu2-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>-1);
<a name="l03832"></a>03832     len2= 0.0;
<a name="l03833"></a>03833     
<a name="l03834"></a>03834     <span class="keywordflow">for</span> (v=0; v&lt;nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; v++, bp1+=nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>, bp2-=nu2-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) {
<a name="l03835"></a>03835         len2+= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a97ecadbef10e5cc3decc2c02c3b96824">len_v3v3</a>(bp1-&gt;vec, bp2-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l03836"></a>03836     }
<a name="l03837"></a>03837 
<a name="l03838"></a>03838     <span class="comment">/* merge */</span>
<a name="l03839"></a>03839     origu= nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l03840"></a>03840     nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>+= nu2-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l03841"></a>03841     <span class="keywordflow">if</span> (nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>&lt;3 &amp;&amp; nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>&lt;nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>++;
<a name="l03842"></a>03842     <span class="keywordflow">if</span> (nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>&lt;3 &amp;&amp; nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>&lt;nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>) nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>++;
<a name="l03843"></a>03843     temp= nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l03844"></a>03844     nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>*<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>), <span class="stringliteral">&quot;mergeBP&quot;</span>);
<a name="l03845"></a>03845     
<a name="l03846"></a>03846     bp= nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l03847"></a>03847     bp1= temp;
<a name="l03848"></a>03848     
<a name="l03849"></a>03849     <span class="keywordflow">for</span> (v=0; v&lt;nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; v++) {
<a name="l03850"></a>03850         
<a name="l03851"></a>03851         <span class="comment">/* switch direction? */</span>
<a name="l03852"></a>03852         <span class="keywordflow">if</span> (len1&lt;len2) bp2= nu2-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> + v*nu2-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l03853"></a>03853         <span class="keywordflow">else</span> bp2= nu2-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> + (nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>-v-1)*nu2-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l03854"></a>03854 
<a name="l03855"></a>03855         for (u=0; u&lt;nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; u++, bp++) {
<a name="l03856"></a>03856             <span class="keywordflow">if</span> (u&lt;origu) {
<a name="l03857"></a>03857                 *bp= *bp1; bp1++;
<a name="l03858"></a>03858                 <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l03859"></a>03859             }
<a name="l03860"></a>03860             <span class="keywordflow">else</span> {
<a name="l03861"></a>03861                 *bp= *bp2; bp2++;
<a name="l03862"></a>03862             }
<a name="l03863"></a>03863         }
<a name="l03864"></a>03864     }
<a name="l03865"></a>03865 
<a name="l03866"></a>03866     <span class="keywordflow">if</span> (nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l03867"></a>03867         <span class="comment">/* merge knots */</span>
<a name="l03868"></a>03868         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(nu1);
<a name="l03869"></a>03869     
<a name="l03870"></a>03870         <span class="comment">/* make knots, for merged curved for example */</span>
<a name="l03871"></a>03871         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67a9890171625dedc07c1b7566703ddb">nurbs_knot_calc_v</a>(nu1);
<a name="l03872"></a>03872     }
<a name="l03873"></a>03873     
<a name="l03874"></a>03874     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(temp);
<a name="l03875"></a>03875     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(editnurb, nu2);
<a name="l03876"></a>03876     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a612d0057fcc6d1a836444e79a539a749">freeNurb</a>(nu2);
<a name="l03877"></a>03877 }
<a name="l03878"></a>03878 
<a name="l03879"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a9988551a0d2892cef6c1208239f3d807">03879</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a9988551a0d2892cef6c1208239f3d807">merge_nurb</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l03880"></a>03880 {
<a name="l03881"></a>03881     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l03882"></a>03882     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l03883"></a>03883     <a class="code" href="../../d2/d83/structNurbSort.html">NurbSort</a> *nus1, *nus2;
<a name="l03884"></a>03884     <span class="keywordtype">int</span> ok= 1;
<a name="l03885"></a>03885     
<a name="l03886"></a>03886     <a class="code" href="../../d7/d55/editcurve_8c.html#a9cdb8ac92e97a238ed6314f54da6453c">make_selection_list_nurb</a>(editnurb);
<a name="l03887"></a>03887     
<a name="l03888"></a>03888     <span class="keywordflow">if</span> (nsortbase.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == nsortbase.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>) {
<a name="l03889"></a>03889         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;nsortbase);
<a name="l03890"></a>03890         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Too few selections to merge&quot;</span>);
<a name="l03891"></a>03891         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03892"></a>03892     }
<a name="l03893"></a>03893     
<a name="l03894"></a>03894     nus1= nsortbase.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03895"></a>03895     nus2= nus1-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a4ba9737a3e91d3b0d71d6d59591d1df8">next</a>;
<a name="l03896"></a>03896 
<a name="l03897"></a>03897     <span class="comment">/* resolution match, to avoid uv rotations */</span>
<a name="l03898"></a>03898     <span class="keywordflow">if</span> (nus1-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>==1) {
<a name="l03899"></a>03899         <span class="keywordflow">if</span> (nus1-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>==nus2-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> || nus1-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>==nus2-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>);
<a name="l03900"></a>03900         <span class="keywordflow">else</span> ok= 0;
<a name="l03901"></a>03901     }
<a name="l03902"></a>03902     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nus2-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>==1) {
<a name="l03903"></a>03903         <span class="keywordflow">if</span> (nus2-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>==nus1-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> || nus2-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>==nus1-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>);
<a name="l03904"></a>03904         <span class="keywordflow">else</span> ok= 0;
<a name="l03905"></a>03905     }
<a name="l03906"></a>03906     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( nus1-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>==nus2-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> || nus1-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>==nus2-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>);
<a name="l03907"></a>03907     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( nus1-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>==nus2-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> || nus1-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>==nus2-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>);
<a name="l03908"></a>03908     <span class="keywordflow">else</span> {
<a name="l03909"></a>03909         ok= 0;
<a name="l03910"></a>03910     }
<a name="l03911"></a>03911     
<a name="l03912"></a>03912     <span class="keywordflow">if</span> (ok==0) {
<a name="l03913"></a>03913         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Resolution doesn&#39;t match&quot;</span>);
<a name="l03914"></a>03914         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;nsortbase);
<a name="l03915"></a>03915         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03916"></a>03916     }
<a name="l03917"></a>03917 
<a name="l03918"></a>03918     <span class="keywordflow">while</span> (nus2) {
<a name="l03919"></a>03919         <a class="code" href="../../d7/d55/editcurve_8c.html#a73f43c0c7c902fbdb37413cb5184f1b1">merge_2_nurb</a>(op, editnurb, nus1-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>, nus2-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>);
<a name="l03920"></a>03920         nus2= nus2-&gt;<a class="code" href="../../d2/d83/structNurbSort.html#a4ba9737a3e91d3b0d71d6d59591d1df8">next</a>;
<a name="l03921"></a>03921     }
<a name="l03922"></a>03922     
<a name="l03923"></a>03923     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;nsortbase);
<a name="l03924"></a>03924     
<a name="l03925"></a>03925     <a class="code" href="../../d7/d55/editcurve_8c.html#a5898792f9c07dc5a831d3051859cefc5">set_actNurb</a>(obedit, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03926"></a>03926 
<a name="l03927"></a>03927     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l03928"></a>03928     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l03929"></a>03929     
<a name="l03930"></a>03930     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l03931"></a>03931 }
<a name="l03932"></a>03932 
<a name="l03933"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a9f902890c5f27c9687be31334c20f5e3">03933</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a9f902890c5f27c9687be31334c20f5e3">make_segment_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l03934"></a>03934 {
<a name="l03935"></a>03935     <span class="comment">/* joins 2 curves */</span>
<a name="l03936"></a>03936     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l03937"></a>03937     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l03938"></a>03938     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nubase= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l03939"></a>03939     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>, *nu1=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *nu2=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03940"></a>03940     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l03941"></a>03941     <span class="keywordtype">float</span> *fp, offset;
<a name="l03942"></a>03942     <span class="keywordtype">int</span> a, ok= 0;
<a name="l03943"></a>03943 
<a name="l03944"></a>03944     <span class="comment">/* first decide if this is a surface merge! */</span>
<a name="l03945"></a>03945     <span class="keywordflow">if</span> (obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>) nu= nubase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l03946"></a>03946     <span class="keywordflow">else</span> nu= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03947"></a>03947     
<a name="l03948"></a>03948     <span class="keywordflow">while</span> (nu) {
<a name="l03949"></a>03949         <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d55/editcurve_8c.html#a04a97e645bf45a68ecbbfb7a123e9cac">isNurbsel</a>(nu) ) {
<a name="l03950"></a>03950         
<a name="l03951"></a>03951             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>&gt;1 &amp;&amp; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>&gt;1) <span class="keywordflow">break</span>;
<a name="l03952"></a>03952             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a564f44c061399358cc0ccd22f13d011a">isNurbsel_count</a>(cu, nu)&gt;1) <span class="keywordflow">break</span>;
<a name="l03953"></a>03953             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a564f44c061399358cc0ccd22f13d011a">isNurbsel_count</a>(cu, nu)==1) {
<a name="l03954"></a>03954                 <span class="comment">/* only 1 selected, not first or last, a little complex, but intuitive */</span>
<a name="l03955"></a>03955                 <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>==1) {
<a name="l03956"></a>03956                     <span class="keywordflow">if</span> ( (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) || ((nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1)-&gt;f1 &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>));
<a name="l03957"></a>03957                     <span class="keywordflow">else</span> <span class="keywordflow">break</span>;
<a name="l03958"></a>03958                 }
<a name="l03959"></a>03959             }
<a name="l03960"></a>03960         }
<a name="l03961"></a>03961         nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l03962"></a>03962     }
<a name="l03963"></a>03963 
<a name="l03964"></a>03964     <span class="keywordflow">if</span> (nu)
<a name="l03965"></a>03965         <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a9988551a0d2892cef6c1208239f3d807">merge_nurb</a>(C, op);
<a name="l03966"></a>03966     
<a name="l03967"></a>03967     <span class="comment">/* find both nurbs and points, nu1 will be put behind nu2 */</span>
<a name="l03968"></a>03968     <span class="keywordflow">for</span> (nu= nubase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l03969"></a>03969         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> == 1)
<a name="l03970"></a>03970             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a>&amp;= ~<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>;
<a name="l03971"></a>03971 
<a name="l03972"></a>03972         <span class="keywordflow">if</span> ((nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>)==0) {    <span class="comment">/* not cyclic */</span>
<a name="l03973"></a>03973             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l03974"></a>03974                 <span class="keywordflow">if</span> (nu1==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l03975"></a>03975                     <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abcf63d093f344e298763ce019f0a1cb1">BEZSELECTED_HIDDENHANDLES</a>(cu, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) ) nu1= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l03976"></a>03976                     <span class="keywordflow">else</span> {
<a name="l03977"></a>03977                         <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abcf63d093f344e298763ce019f0a1cb1">BEZSELECTED_HIDDENHANDLES</a>(cu, &amp;(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>[nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1])) ) {
<a name="l03978"></a>03978                             nu1= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l03979"></a>03979                             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a93948a41f393b373ddd267796c058b81">switchdirectionNurb</a>(nu);
<a name="l03980"></a>03980                             <a class="code" href="../../d7/d55/editcurve_8c.html#a7a388a6c30aa6e3b10428e82a6e29615">keyData_switchDirectionNurb</a>(cu, nu);
<a name="l03981"></a>03981                         }
<a name="l03982"></a>03982                     }
<a name="l03983"></a>03983                 }
<a name="l03984"></a>03984                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu2==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l03985"></a>03985                     <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abcf63d093f344e298763ce019f0a1cb1">BEZSELECTED_HIDDENHANDLES</a>(cu, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) ) {
<a name="l03986"></a>03986                         nu2= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l03987"></a>03987                         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a93948a41f393b373ddd267796c058b81">switchdirectionNurb</a>(nu);
<a name="l03988"></a>03988                         <a class="code" href="../../d7/d55/editcurve_8c.html#a7a388a6c30aa6e3b10428e82a6e29615">keyData_switchDirectionNurb</a>(cu, nu);
<a name="l03989"></a>03989                     }
<a name="l03990"></a>03990                     <span class="keywordflow">else</span> {
<a name="l03991"></a>03991                         <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abcf63d093f344e298763ce019f0a1cb1">BEZSELECTED_HIDDENHANDLES</a>(cu, &amp;(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>[nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1])) ) {
<a name="l03992"></a>03992                             nu2= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l03993"></a>03993                         }
<a name="l03994"></a>03994                     }
<a name="l03995"></a>03995                 }
<a name="l03996"></a>03996                 <span class="keywordflow">else</span> <span class="keywordflow">break</span>;
<a name="l03997"></a>03997             }
<a name="l03998"></a>03998             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>==1) {
<a name="l03999"></a>03999                 bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l04000"></a>04000                 <span class="keywordflow">if</span> (nu1==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l04001"></a>04001                     <span class="keywordflow">if</span> ( bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) nu1= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l04002"></a>04002                     <span class="keywordflow">else</span> {
<a name="l04003"></a>04003                         bp= bp+(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1);
<a name="l04004"></a>04004                         <span class="keywordflow">if</span> ( bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a> ) {
<a name="l04005"></a>04005                             nu1= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l04006"></a>04006                             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a93948a41f393b373ddd267796c058b81">switchdirectionNurb</a>(nu);
<a name="l04007"></a>04007                             <a class="code" href="../../d7/d55/editcurve_8c.html#a7a388a6c30aa6e3b10428e82a6e29615">keyData_switchDirectionNurb</a>(cu, nu);
<a name="l04008"></a>04008                         }
<a name="l04009"></a>04009                     }
<a name="l04010"></a>04010                 }
<a name="l04011"></a>04011                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu2==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l04012"></a>04012                     <span class="keywordflow">if</span> ( bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a> ) {
<a name="l04013"></a>04013                         nu2= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l04014"></a>04014                         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a93948a41f393b373ddd267796c058b81">switchdirectionNurb</a>(nu);
<a name="l04015"></a>04015                         <a class="code" href="../../d7/d55/editcurve_8c.html#a7a388a6c30aa6e3b10428e82a6e29615">keyData_switchDirectionNurb</a>(cu, nu);
<a name="l04016"></a>04016                     }
<a name="l04017"></a>04017                     <span class="keywordflow">else</span> {
<a name="l04018"></a>04018                         bp= bp+(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1);
<a name="l04019"></a>04019                         <span class="keywordflow">if</span> ( bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a> ) {
<a name="l04020"></a>04020                             nu2= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l04021"></a>04021                         }
<a name="l04022"></a>04022                     }
<a name="l04023"></a>04023                 }
<a name="l04024"></a>04024                 <span class="keywordflow">else</span> <span class="keywordflow">break</span>;
<a name="l04025"></a>04025             }
<a name="l04026"></a>04026         }
<a name="l04027"></a>04027     }
<a name="l04028"></a>04028 
<a name="l04029"></a>04029     <span class="keywordflow">if</span> ((nu1 &amp;&amp; nu2) &amp;&amp; (nu1!=nu2)) {
<a name="l04030"></a>04030         <span class="keywordflow">if</span> ( nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a>==nu2-&gt;type) {
<a name="l04031"></a>04031             <span class="keywordflow">if</span> (nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l04032"></a>04032                 <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt =
<a name="l04033"></a>04033                     (<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>((nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>+nu2-&gt;pntsu) * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aafa4ace0bba7528ab007eabe81cbfc10">BezTriple</a>), <span class="stringliteral">&quot;addsegmentN&quot;</span>);
<a name="l04034"></a>04034                 <a class="code" href="../../d7/d55/editcurve_8c.html#a5863deb4d104d1c79f9212cbe93affd5">ED_curve_beztcpy</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>, bezt, nu2-&gt;bezt, nu2-&gt;pntsu);
<a name="l04035"></a>04035                 <a class="code" href="../../d7/d55/editcurve_8c.html#a5863deb4d104d1c79f9212cbe93affd5">ED_curve_beztcpy</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>, bezt+nu2-&gt;pntsu, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>);
<a name="l04036"></a>04036 
<a name="l04037"></a>04037                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>);
<a name="l04038"></a>04038                 nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>= bezt;
<a name="l04039"></a>04039                 nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>+= nu2-&gt;pntsu;
<a name="l04040"></a>04040                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(nubase, nu2);
<a name="l04041"></a>04041                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a612d0057fcc6d1a836444e79a539a749">freeNurb</a>(nu2); nu2= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04042"></a>04042                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(nu1);
<a name="l04043"></a>04043             }
<a name="l04044"></a>04044             <span class="keywordflow">else</span> {
<a name="l04045"></a>04045                 bp =
<a name="l04046"></a>04046                     (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>((nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>+nu2-&gt;pntsu) * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af73d40f9d8f8b10f64359a0704799ac9">BPoint</a>), <span class="stringliteral">&quot;addsegmentN2&quot;</span>);
<a name="l04047"></a>04047                 <a class="code" href="../../d7/d55/editcurve_8c.html#acc934a7779bd2eee63200ad5c7bdd0d4">ED_curve_bpcpy</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>, bp, nu2-&gt;bp, nu2-&gt;pntsu);
<a name="l04048"></a>04048                 <a class="code" href="../../d7/d55/editcurve_8c.html#acc934a7779bd2eee63200ad5c7bdd0d4">ED_curve_bpcpy</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>, bp+nu2-&gt;pntsu, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>);
<a name="l04049"></a>04049                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l04050"></a>04050                 nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= bp;
<a name="l04051"></a>04051 
<a name="l04052"></a>04052                 a= nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>+nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>;
<a name="l04053"></a>04053 
<a name="l04054"></a>04054                 nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>+= nu2-&gt;pntsu;
<a name="l04055"></a>04055                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(nubase, nu2);
<a name="l04056"></a>04056 
<a name="l04057"></a>04057                 <span class="comment">/* now join the knots */</span>
<a name="l04058"></a>04058                 <span class="keywordflow">if</span> (nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l04059"></a>04059                     <span class="keywordflow">if</span> (nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l04060"></a>04060                         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(nu1);
<a name="l04061"></a>04061                     }
<a name="l04062"></a>04062                     <span class="keywordflow">else</span> {
<a name="l04063"></a>04063                         fp= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*<a class="code" href="../../d7/dfc/BKE__curve_8h.html#a229d5ec44247fb38940870726ade9077">KNOTSU</a>(nu1), <span class="stringliteral">&quot;addsegment3&quot;</span>);
<a name="l04064"></a>04064                         memcpy(fp, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*a);
<a name="l04065"></a>04065                         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>);
<a name="l04066"></a>04066                         nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>= fp;
<a name="l04067"></a>04067                         
<a name="l04068"></a>04068                         
<a name="l04069"></a>04069                         offset= nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>[a-1] + 1.0f;
<a name="l04070"></a>04070                         fp= nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>+a;
<a name="l04071"></a>04071                         <span class="keywordflow">for</span> (a=0; a&lt;nu2-&gt;pntsu; a++, fp++) {
<a name="l04072"></a>04072                             <span class="keywordflow">if</span> (nu2-&gt;knotsu) 
<a name="l04073"></a>04073                                 *fp= offset+nu2-&gt;knotsu[a+1];
<a name="l04074"></a>04074                             <span class="keywordflow">else</span> 
<a name="l04075"></a>04075                                 *fp = offset;
<a name="l04076"></a>04076                         }
<a name="l04077"></a>04077                     }
<a name="l04078"></a>04078                 }
<a name="l04079"></a>04079                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a612d0057fcc6d1a836444e79a539a749">freeNurb</a>(nu2); nu2= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04080"></a>04080             }
<a name="l04081"></a>04081 
<a name="l04082"></a>04082             <a class="code" href="../../d7/d55/editcurve_8c.html#a5898792f9c07dc5a831d3051859cefc5">set_actNurb</a>(obedit, nu1);   <span class="comment">/* for selected */</span>
<a name="l04083"></a>04083             ok= 1;
<a name="l04084"></a>04084         }
<a name="l04085"></a>04085     }
<a name="l04086"></a>04086     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu1 &amp;&amp; !nu2) {
<a name="l04087"></a>04087         <span class="keywordflow">if</span> (!(nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) &amp;&amp; nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>&gt;1) {
<a name="l04088"></a>04088             <span class="keywordflow">if</span> (nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a> &amp;&amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abcf63d093f344e298763ce019f0a1cb1">BEZSELECTED_HIDDENHANDLES</a>(cu, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) &amp;&amp;
<a name="l04089"></a>04089                 <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abcf63d093f344e298763ce019f0a1cb1">BEZSELECTED_HIDDENHANDLES</a>(cu, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+(nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1))) {
<a name="l04090"></a>04090                 nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a>|= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>;
<a name="l04091"></a>04091                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(nu1);
<a name="l04092"></a>04092                 ok= 1;
<a name="l04093"></a>04093             }
<a name="l04094"></a>04094             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a> &amp;&amp; nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a>&amp;<a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a> &amp;&amp; (nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+(nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1))-&gt;f1&amp;<a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l04095"></a>04095                 nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a>|= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>;
<a name="l04096"></a>04096                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(nu1);
<a name="l04097"></a>04097                 ok= 1;
<a name="l04098"></a>04098             }
<a name="l04099"></a>04099         }
<a name="l04100"></a>04100     }
<a name="l04101"></a>04101 
<a name="l04102"></a>04102     <span class="keywordflow">if</span> (!ok) {
<a name="l04103"></a>04103         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Can&#39;t make segment&quot;</span>);
<a name="l04104"></a>04104         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l04105"></a>04105     }
<a name="l04106"></a>04106 
<a name="l04107"></a>04107     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a1a79334fb2fbb2d4951b7196c64a9edb">ED_curve_updateAnimPaths</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>))
<a name="l04108"></a>04108         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ab2ab88214d816c47ebee1a985b0e68b3">ND_KEYS</a>, obedit);
<a name="l04109"></a>04109 
<a name="l04110"></a>04110     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l04111"></a>04111     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l04112"></a>04112 
<a name="l04113"></a>04113     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l04114"></a>04114 }
<a name="l04115"></a>04115 
<a name="l04116"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a35f20a8edaa0885088f4e5cc1c9ee1c0">04116</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a36485414a4ffbfce2330b670ce463df6">CURVE_OT_make_segment</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l04117"></a>04117 {
<a name="l04118"></a>04118     <span class="comment">/* identifiers */</span>
<a name="l04119"></a>04119     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Make Segment&quot;</span>;
<a name="l04120"></a>04120     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_make_segment&quot;</span>;
<a name="l04121"></a>04121     
<a name="l04122"></a>04122     <span class="comment">/* api callbacks */</span>
<a name="l04123"></a>04123     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a9f902890c5f27c9687be31334c20f5e3">make_segment_exec</a>;
<a name="l04124"></a>04124     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l04125"></a>04125 
<a name="l04126"></a>04126     <span class="comment">/* flags */</span>
<a name="l04127"></a>04127     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l04128"></a>04128 }
<a name="l04129"></a>04129 
<a name="l04130"></a>04130 <span class="comment">/***************** pick select from 3d view **********************/</span>
<a name="l04131"></a>04131 
<a name="l04132"></a><a class="code" href="../../db/d71/ED__curve_8h.html#af454102d1cff9b9b8883e710be3ee98a">04132</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a4d94beb14b207eeea13e212749375a9d">mouse_nurb</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keyword">const</span> <span class="keywordtype">int</span> mval[2], <span class="keywordtype">int</span> extend)
<a name="l04133"></a>04133 {
<a name="l04134"></a>04134     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C); 
<a name="l04135"></a>04135     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l04136"></a>04136     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l04137"></a>04137     <a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> vc;
<a name="l04138"></a>04138     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l04139"></a>04139     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04140"></a>04140     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04141"></a>04141     <span class="keywordtype">int</span> location[2];
<a name="l04142"></a>04142     <span class="keywordtype">short</span> hand;
<a name="l04143"></a>04143     
<a name="l04144"></a>04144     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#ad4e74149dc97fd5cdb1c124ecafd8eec">view3d_operator_needs_opengl</a>(C);
<a name="l04145"></a>04145     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#aa18efc327ab12e74064a2c1129237431">view3d_set_viewcontext</a>(C, &amp;vc);
<a name="l04146"></a>04146     
<a name="l04147"></a>04147     location[0]= mval[0];
<a name="l04148"></a>04148     location[1]= mval[1];
<a name="l04149"></a>04149     hand= <a class="code" href="../../d7/d55/editcurve_8c.html#a019e7552a307cad4df99d528d5d5249f">findnearestNurbvert</a>(&amp;vc, 1, location, &amp;nu, &amp;bezt, &amp;bp);
<a name="l04150"></a>04150 
<a name="l04151"></a>04151     <span class="keywordflow">if</span> (bezt || bp) {
<a name="l04152"></a>04152         <span class="keywordflow">if</span> (extend==0) {
<a name="l04153"></a>04153         
<a name="l04154"></a>04154             <a class="code" href="../../d7/d55/editcurve_8c.html#a9d92d24c42cc1db29dcac1a5fe4d0e5e">setflagsNurb</a>(editnurb, 0);
<a name="l04155"></a>04155 
<a name="l04156"></a>04156             <span class="keywordflow">if</span> (bezt) {
<a name="l04157"></a>04157 
<a name="l04158"></a>04158                 <span class="keywordflow">if</span> (hand==1) {
<a name="l04159"></a>04159                     <a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">select_beztriple</a>(bezt, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l04160"></a>04160                     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>= bezt;
<a name="l04161"></a>04161                 }
<a name="l04162"></a>04162                 <span class="keywordflow">else</span> {
<a name="l04163"></a>04163                     <span class="keywordflow">if</span> (hand==0) bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a>|= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l04164"></a>04164                     <span class="keywordflow">else</span> bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a>|= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l04165"></a>04165 
<a name="l04166"></a>04166                     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04167"></a>04167                 }
<a name="l04168"></a>04168             }
<a name="l04169"></a>04169             <span class="keywordflow">else</span> {
<a name="l04170"></a>04170                 cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>= bp;
<a name="l04171"></a>04171                 <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l04172"></a>04172             }
<a name="l04173"></a>04173 
<a name="l04174"></a>04174         }
<a name="l04175"></a>04175         <span class="keywordflow">else</span> {
<a name="l04176"></a>04176             <span class="keywordflow">if</span> (bezt) {
<a name="l04177"></a>04177                 <span class="keywordflow">if</span> (hand==1) {
<a name="l04178"></a>04178                     <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l04179"></a>04179                         <a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">select_beztriple</a>(bezt, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l04180"></a>04180                         <span class="keywordflow">if</span> (bezt == cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04181"></a>04181                     }
<a name="l04182"></a>04182                     <span class="keywordflow">else</span> {
<a name="l04183"></a>04183                         <a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">select_beztriple</a>(bezt, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l04184"></a>04184                         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>= bezt;
<a name="l04185"></a>04185                     }
<a name="l04186"></a>04186                 }
<a name="l04187"></a>04187                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hand==0) {
<a name="l04188"></a>04188                     bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> ^= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l04189"></a>04189                 }
<a name="l04190"></a>04190                 <span class="keywordflow">else</span> {
<a name="l04191"></a>04191                     bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> ^= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l04192"></a>04192                 }
<a name="l04193"></a>04193             }
<a name="l04194"></a>04194             <span class="keywordflow">else</span> {
<a name="l04195"></a>04195                 <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l04196"></a>04196                     <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l04197"></a>04197                     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a> == bp) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04198"></a>04198                 }
<a name="l04199"></a>04199                 <span class="keywordflow">else</span> {
<a name="l04200"></a>04200                     <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l04201"></a>04201                     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>= bp;
<a name="l04202"></a>04202                 }
<a name="l04203"></a>04203             }
<a name="l04204"></a>04204 
<a name="l04205"></a>04205         }
<a name="l04206"></a>04206 
<a name="l04207"></a>04207         <span class="keywordflow">if</span> (nu!=<a class="code" href="../../d7/d55/editcurve_8c.html#a47ba25464ce99c5415167967550b78de">get_actNurb</a>(obedit))
<a name="l04208"></a>04208             <a class="code" href="../../d7/d55/editcurve_8c.html#a5898792f9c07dc5a831d3051859cefc5">set_actNurb</a>(obedit, nu);
<a name="l04209"></a>04209 
<a name="l04210"></a>04210         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa1eaeb409fe6a81df91467aaeb289a07">ND_SELECT</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l04211"></a>04211 
<a name="l04212"></a>04212         <span class="keywordflow">return</span> 1;
<a name="l04213"></a>04213     }
<a name="l04214"></a>04214     
<a name="l04215"></a>04215     <span class="keywordflow">return</span> 0;
<a name="l04216"></a>04216 }
<a name="l04217"></a>04217 
<a name="l04218"></a>04218 <span class="comment">/******************** spin operator ***********************/</span>
<a name="l04219"></a>04219 
<a name="l04220"></a>04220 <span class="comment">/* &#39;cent&#39; is in object space and &#39;dvec&#39; in worldspace.</span>
<a name="l04221"></a>04221 <span class="comment"> */</span>
<a name="l04222"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a5ab5e106f5ec6e8b982239cfef46c168">04222</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a5ab5e106f5ec6e8b982239cfef46c168">spin_nurb</a>(<span class="keywordtype">float</span> viewmat[][4], <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit, <span class="keywordtype">float</span> *axis, <span class="keywordtype">float</span> *cent)
<a name="l04223"></a>04223 {
<a name="l04224"></a>04224     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= (<a class="code" href="../../da/d10/structCurve.html">Curve</a>*)obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l04225"></a>04225     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l04226"></a>04226     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l04227"></a>04227     <span class="keywordtype">float</span> <a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>,phi,n[3],q[4],cmat[3][3],tmat[3][3],imat[3][3];
<a name="l04228"></a>04228     <span class="keywordtype">float</span> bmat[3][3], rotmat[3][3], scalemat1[3][3], scalemat2[3][3];
<a name="l04229"></a>04229     <span class="keywordtype">float</span> persmat[3][3], persinv[3][3];
<a name="l04230"></a>04230     <span class="keywordtype">short</span> a,ok, changed= 0;
<a name="l04231"></a>04231 
<a name="l04232"></a>04232     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a36f8fd23b3f7785d0396ea7a93683d09">copy_m3_m4</a>(persmat, viewmat);
<a name="l04233"></a>04233     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#acc9f8cab0ea2c5993f2c9bdeaca6b788">invert_m3_m3</a>(persinv, persmat);
<a name="l04234"></a>04234 
<a name="l04235"></a>04235     <span class="comment">/* imat and center and size */</span>
<a name="l04236"></a>04236     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a36f8fd23b3f7785d0396ea7a93683d09">copy_m3_m4</a>(bmat, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l04237"></a>04237     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#acc9f8cab0ea2c5993f2c9bdeaca6b788">invert_m3_m3</a>(imat, bmat);
<a name="l04238"></a>04238     
<a name="l04239"></a>04239     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#aaa8b4ca59d77eb2612341c608507e087">normalize_v3_v3</a>(n, axis);
<a name="l04240"></a>04240     
<a name="l04241"></a>04241     phi= <a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/8.0;
<a name="l04242"></a>04242     q[0]= <a class="code" href="../../d7/d47/NM__Scalar_8h.html#a684cb050006be28e36ea9a9817af4a91">cos</a>(phi);
<a name="l04243"></a>04243     si= <a class="code" href="../../d7/d47/NM__Scalar_8h.html#a4f15dff8a58e8abe0c0cf2c249ffa842">sin</a>(phi);
<a name="l04244"></a>04244     q[1]= n[0]*<a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>;
<a name="l04245"></a>04245     q[2]= n[1]*<a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>;
<a name="l04246"></a>04246     q[3]= n[2]*<a class="code" href="../../d4/dd4/drawarmature_8c.html#a888fe8f555278142e1b388ec6592dc0d">si</a>;
<a name="l04247"></a>04247     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#ae0343d0ff2af81f054d3916277409507">quat_to_mat3</a>( cmat,q);
<a name="l04248"></a>04248     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(tmat, cmat, bmat);
<a name="l04249"></a>04249     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(rotmat, imat, tmat);
<a name="l04250"></a>04250 
<a name="l04251"></a>04251     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ac2ec10af660a2f1d912816c842f37bfb">unit_m3</a>(scalemat1);
<a name="l04252"></a>04252     scalemat1[0][0]= <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a66b3ab30f1332874326ed93969e496e0">M_SQRT2</a>;
<a name="l04253"></a>04253     scalemat1[1][1]= <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a66b3ab30f1332874326ed93969e496e0">M_SQRT2</a>;
<a name="l04254"></a>04254 
<a name="l04255"></a>04255     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(tmat,persmat,bmat);
<a name="l04256"></a>04256     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(cmat,scalemat1,tmat);
<a name="l04257"></a>04257     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(tmat,persinv,cmat);
<a name="l04258"></a>04258     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(scalemat1,imat,tmat);
<a name="l04259"></a>04259 
<a name="l04260"></a>04260     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ac2ec10af660a2f1d912816c842f37bfb">unit_m3</a>(scalemat2);
<a name="l04261"></a>04261     scalemat2[0][0]/= (float)<a class="code" href="../../dd/d06/BLI__math__base_8h.html#a66b3ab30f1332874326ed93969e496e0">M_SQRT2</a>;
<a name="l04262"></a>04262     scalemat2[1][1]/= (float)<a class="code" href="../../dd/d06/BLI__math__base_8h.html#a66b3ab30f1332874326ed93969e496e0">M_SQRT2</a>;
<a name="l04263"></a>04263 
<a name="l04264"></a>04264     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(tmat,persmat,bmat);
<a name="l04265"></a>04265     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(cmat,scalemat2,tmat);
<a name="l04266"></a>04266     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(tmat,persinv,cmat);
<a name="l04267"></a>04267     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a6879ca084fea564be44fbdd816781f74">mul_m3_m3m3</a>(scalemat2,imat,tmat);
<a name="l04268"></a>04268 
<a name="l04269"></a>04269     ok= 1;
<a name="l04270"></a>04270 
<a name="l04271"></a>04271     <span class="keywordflow">for</span> (a=0;a&lt;7;a++) {
<a name="l04272"></a>04272         ok= <a class="code" href="../../d7/d55/editcurve_8c.html#a0140a436787b2f39ff2a2313ff47a796">extrudeflagNurb</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>, 1);
<a name="l04273"></a>04273 
<a name="l04274"></a>04274         <span class="keywordflow">if</span> (ok==0)
<a name="l04275"></a>04275             <span class="keywordflow">return</span> changed;
<a name="l04276"></a>04276 
<a name="l04277"></a>04277         changed= 1;
<a name="l04278"></a>04278 
<a name="l04279"></a>04279         <a class="code" href="../../d7/d55/editcurve_8c.html#a796180ab9fd26032fb9999c3b9159dc6">rotateflagNurb</a>(editnurb, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, cent, rotmat);
<a name="l04280"></a>04280 
<a name="l04281"></a>04281         <span class="keywordflow">if</span> ( (a &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)==0 ) {
<a name="l04282"></a>04282             <a class="code" href="../../d7/d55/editcurve_8c.html#a796180ab9fd26032fb9999c3b9159dc6">rotateflagNurb</a>(editnurb, SELECT, cent, scalemat1);
<a name="l04283"></a>04283             <a class="code" href="../../d7/d55/editcurve_8c.html#a1aac20087c95194cfb0ca65e23676d2d">weightflagNurb</a>(editnurb, SELECT, 0.25*<a class="code" href="../../dd/d06/BLI__math__base_8h.html#a66b3ab30f1332874326ed93969e496e0">M_SQRT2</a>);
<a name="l04284"></a>04284         }
<a name="l04285"></a>04285         <span class="keywordflow">else</span> {
<a name="l04286"></a>04286             <a class="code" href="../../d7/d55/editcurve_8c.html#a796180ab9fd26032fb9999c3b9159dc6">rotateflagNurb</a>(editnurb, SELECT, cent, scalemat2);
<a name="l04287"></a>04287             <a class="code" href="../../d7/d55/editcurve_8c.html#a1aac20087c95194cfb0ca65e23676d2d">weightflagNurb</a>(editnurb, SELECT, 4.0/<a class="code" href="../../dd/d06/BLI__math__base_8h.html#a66b3ab30f1332874326ed93969e496e0">M_SQRT2</a>);
<a name="l04288"></a>04288         }
<a name="l04289"></a>04289     }
<a name="l04290"></a>04290 
<a name="l04291"></a>04291     <span class="keywordflow">if</span> (ok) {
<a name="l04292"></a>04292         <span class="keywordflow">for</span> (nu= editnurb-&gt;first; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l04293"></a>04293             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a04a97e645bf45a68ecbbfb7a123e9cac">isNurbsel</a>(nu)) {
<a name="l04294"></a>04294                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>= 4;
<a name="l04295"></a>04295                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ae1c344a45c028d3c2067864f5280854e">flagv</a> |= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>;
<a name="l04296"></a>04296                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67a9890171625dedc07c1b7566703ddb">nurbs_knot_calc_v</a>(nu);
<a name="l04297"></a>04297             }
<a name="l04298"></a>04298         }
<a name="l04299"></a>04299     }
<a name="l04300"></a>04300 
<a name="l04301"></a>04301     <span class="keywordflow">return</span> changed;
<a name="l04302"></a>04302 }
<a name="l04303"></a>04303 
<a name="l04304"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ab68e8c38cfcafa70f7d6e24012faa62e">04304</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ab68e8c38cfcafa70f7d6e24012faa62e">spin_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l04305"></a>04305 {
<a name="l04306"></a>04306     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l04307"></a>04307     <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d= <a class="code" href="../../d8/d6a/ED__view3d_8h.html#ad7a31725b14f8332b355403058e71019">ED_view3d_context_rv3d</a>(C);
<a name="l04308"></a>04308     <span class="keywordtype">float</span> cent[3], axis[3], viewmat[4][4];
<a name="l04309"></a>04309     
<a name="l04310"></a>04310     <a class="code" href="../../d3/d10/rna__access_8c.html#a5d95f86ccce314676ae750034fb56709">RNA_float_get_array</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;center&quot;</span>, cent);
<a name="l04311"></a>04311     <a class="code" href="../../d3/d10/rna__access_8c.html#a5d95f86ccce314676ae750034fb56709">RNA_float_get_array</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;axis&quot;</span>, axis);
<a name="l04312"></a>04312     
<a name="l04313"></a>04313     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a65d360837f87824d49ed08caf44dccb3">imat</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l04314"></a>04314     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a65d360837f87824d49ed08caf44dccb3">imat</a>, cent);
<a name="l04315"></a>04315     
<a name="l04316"></a>04316     <span class="keywordflow">if</span> (rv3d)
<a name="l04317"></a>04317         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(viewmat, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ad04178a1375cc4ef5c59a76b723f822f">viewmat</a>);
<a name="l04318"></a>04318     <span class="keywordflow">else</span>
<a name="l04319"></a>04319         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(viewmat);
<a name="l04320"></a>04320     
<a name="l04321"></a>04321     <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d55/editcurve_8c.html#a5ab5e106f5ec6e8b982239cfef46c168">spin_nurb</a>(viewmat, obedit, axis, cent)) {
<a name="l04322"></a>04322         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Can&#39;t spin&quot;</span>);
<a name="l04323"></a>04323         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l04324"></a>04324     }
<a name="l04325"></a>04325 
<a name="l04326"></a>04326     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a1a79334fb2fbb2d4951b7196c64a9edb">ED_curve_updateAnimPaths</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>))
<a name="l04327"></a>04327         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ab2ab88214d816c47ebee1a985b0e68b3">ND_KEYS</a>, obedit);
<a name="l04328"></a>04328 
<a name="l04329"></a>04329     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l04330"></a>04330     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l04331"></a>04331 
<a name="l04332"></a>04332     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l04333"></a>04333 }
<a name="l04334"></a>04334 
<a name="l04335"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a08d04e10583991cbb6f1f15825135174">04335</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a08d04e10583991cbb6f1f15825135174">spin_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l04336"></a>04336 {
<a name="l04337"></a>04337     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l04338"></a>04338     <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d = <a class="code" href="../../df/d01/BKE__context_8h.html#a88ab4a564441708766a6b4ace3b17908">CTX_wm_view3d</a>(C);
<a name="l04339"></a>04339     <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d= <a class="code" href="../../d8/d6a/ED__view3d_8h.html#ad7a31725b14f8332b355403058e71019">ED_view3d_context_rv3d</a>(C);
<a name="l04340"></a>04340     <span class="keywordtype">float</span> axis[3]= {0.0f, 0.0f, 1.0f};
<a name="l04341"></a>04341     
<a name="l04342"></a>04342     <span class="keywordflow">if</span> (rv3d)
<a name="l04343"></a>04343         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(axis, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#aef4739e48c5265fc0185283cd9f92303">viewinv</a>[2]);
<a name="l04344"></a>04344     
<a name="l04345"></a>04345     <a class="code" href="../../d3/d10/rna__access_8c.html#ad8067a3fc34e361ac2283352ff2f906c">RNA_float_set_array</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;center&quot;</span>, <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a56c6dfa9088d0f90552a67074a359c97">give_cursor</a>(scene, v3d));
<a name="l04346"></a>04346     <a class="code" href="../../d3/d10/rna__access_8c.html#ad8067a3fc34e361ac2283352ff2f906c">RNA_float_set_array</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;axis&quot;</span>, axis);
<a name="l04347"></a>04347     
<a name="l04348"></a>04348     <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ab68e8c38cfcafa70f7d6e24012faa62e">spin_exec</a>(C, op);
<a name="l04349"></a>04349 }
<a name="l04350"></a>04350 
<a name="l04351"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a6a9ac9b4146e5507d5857fe61e1f5995">04351</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a8fa221aa15beec1042028b5bdc0b9d89">CURVE_OT_spin</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l04352"></a>04352 {
<a name="l04353"></a>04353     <span class="comment">/* identifiers */</span>
<a name="l04354"></a>04354     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Spin&quot;</span>;
<a name="l04355"></a>04355     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_spin&quot;</span>;
<a name="l04356"></a>04356     
<a name="l04357"></a>04357     <span class="comment">/* api callbacks */</span>
<a name="l04358"></a>04358     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#ab68e8c38cfcafa70f7d6e24012faa62e">spin_exec</a>;
<a name="l04359"></a>04359     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a08d04e10583991cbb6f1f15825135174">spin_invoke</a>;
<a name="l04360"></a>04360     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac37a158e5a982429de39cdc24503a94d">ED_operator_editsurf</a>;
<a name="l04361"></a>04361 
<a name="l04362"></a>04362     <span class="comment">/* flags */</span>
<a name="l04363"></a>04363     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l04364"></a>04364     
<a name="l04365"></a>04365     <a class="code" href="../../dc/d7e/rna__define_8c.html#acb6ba2575b8f80440763c340482fee11">RNA_def_float_vector_xyz</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;center&quot;</span>, 3, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <span class="stringliteral">&quot;Center&quot;</span>, <span class="stringliteral">&quot;Center in global view space&quot;</span>, -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>);
<a name="l04366"></a>04366     <a class="code" href="../../dc/d7e/rna__define_8c.html#a60e910dcfdccf2a1ede6471837912011">RNA_def_float_vector</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;axis&quot;</span>, 3, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -1.0f, 1.0f, <span class="stringliteral">&quot;Axis&quot;</span>, <span class="stringliteral">&quot;Axis in global view space&quot;</span>, -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>);
<a name="l04367"></a>04367 }
<a name="l04368"></a>04368 
<a name="l04369"></a>04369 <span class="comment">/***************** add vertex operator **********************/</span>
<a name="l04370"></a>04370 
<a name="l04371"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ac16c244f26aff0703ea164821ba36aa5">04371</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ac16c244f26aff0703ea164821ba36aa5">addvert_Nurb</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keywordtype">short</span> mode, <span class="keywordtype">float</span> location[3])
<a name="l04372"></a>04372 {
<a name="l04373"></a>04373     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l04374"></a>04374     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= (<a class="code" href="../../da/d10/structCurve.html">Curve</a>*)obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l04375"></a>04375     <a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>;
<a name="l04376"></a>04376     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>, *newnu= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04377"></a>04377     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt, *newbezt = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04378"></a>04378     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp, *newbp = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04379"></a>04379     <span class="keywordtype">float</span> imat[4][4], temp[3];
<a name="l04380"></a>04380     <span class="keywordtype">int</span> ok= 0;
<a name="l04381"></a>04381     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt_recalc[3] = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l04382"></a>04382 
<a name="l04383"></a>04383     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(imat, obedit-&gt;obmat);
<a name="l04384"></a>04384 
<a name="l04385"></a>04385     <a class="code" href="../../d7/d55/editcurve_8c.html#a290ad9774c86dd69c224950eb7ae6712">findselectedNurbvert</a>(&amp;editnurb-&gt;nurbs, &amp;<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>, &amp;bezt, &amp;bp);
<a name="l04386"></a>04386 
<a name="l04387"></a>04387     <span class="keywordflow">if</span> ((<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a> &amp;&amp; bezt==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a>!=<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a> &amp;&amp; bp==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {
<a name="l04388"></a>04388         <span class="keywordflow">if</span> (mode!=<span class="charliteral">&#39;e&#39;</span>) {
<a name="l04389"></a>04389             <span class="keywordflow">if</span> (cu-&gt;actnu &gt;= 0)
<a name="l04390"></a>04390                 <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;editnurb-&gt;nurbs, cu-&gt;actnu);
<a name="l04391"></a>04391 
<a name="l04392"></a>04392             <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a> || <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l04393"></a>04393                 newbezt= (<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>), <span class="stringliteral">&quot;addvert_Nurb&quot;</span>);
<a name="l04394"></a>04394                 newbezt-&gt;radius= 1;
<a name="l04395"></a>04395                 newbezt-&gt;alfa= 0;
<a name="l04396"></a>04396                 <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a243e99ba94633b9581fb4a6e7b6375d0">BEZ_SEL</a>(newbezt);
<a name="l04397"></a>04397                 newbezt-&gt;h2= newbezt-&gt;h1= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>;
<a name="l04398"></a>04398 
<a name="l04399"></a>04399                 newnu= (<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>), <span class="stringliteral">&quot;addvert_Nurb newnu&quot;</span>);
<a name="l04400"></a>04400                 <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>) {
<a name="l04401"></a>04401                     <span class="comment">/* no selected segment -- create new one which is BEZIER type</span>
<a name="l04402"></a>04402 <span class="comment">                     * type couldn&#39;t be determined from Curve bt could be changed</span>
<a name="l04403"></a>04403 <span class="comment">                     * in the future, so shouldn&#39;t make much headache */</span>
<a name="l04404"></a>04404                     newnu-&gt;type= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>;
<a name="l04405"></a>04405                     newnu-&gt;resolu= cu-&gt;resolu;
<a name="l04406"></a>04406                     newnu-&gt;flag |= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a52776b893e7d78f3276b98e0b9f56cc1">CU_SMOOTH</a>;
<a name="l04407"></a>04407                 }
<a name="l04408"></a>04408                 <span class="keywordflow">else</span> memcpy(newnu, <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>));
<a name="l04409"></a>04409 
<a name="l04410"></a>04410                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;editnurb-&gt;nurbs, newnu);
<a name="l04411"></a>04411                 <a class="code" href="../../d7/d55/editcurve_8c.html#a5898792f9c07dc5a831d3051859cefc5">set_actNurb</a>(obedit, newnu);
<a name="l04412"></a>04412                 newnu-&gt;bezt= newbezt;
<a name="l04413"></a>04413                 newnu-&gt;pntsu= 1;
<a name="l04414"></a>04414 
<a name="l04415"></a>04415                 temp[0] = 1;
<a name="l04416"></a>04416                 temp[1] = 0;
<a name="l04417"></a>04417                 temp[2] = 0;
<a name="l04418"></a>04418 
<a name="l04419"></a>04419                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(newbezt-&gt;vec[1], location);
<a name="l04420"></a>04420                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(newbezt-&gt;vec[0], newbezt-&gt;vec[1], temp);
<a name="l04421"></a>04421                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(newbezt-&gt;vec[2], newbezt-&gt;vec[1], temp);
<a name="l04422"></a>04422 
<a name="l04423"></a>04423                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(imat, newbezt-&gt;vec[0]);
<a name="l04424"></a>04424                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(imat, newbezt-&gt;vec[1]);
<a name="l04425"></a>04425                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(imat, newbezt-&gt;vec[2]);
<a name="l04426"></a>04426 
<a name="l04427"></a>04427                 ok= 1;
<a name="l04428"></a>04428                 <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>= newnu;
<a name="l04429"></a>04429             }
<a name="l04430"></a>04430             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> == 1) {
<a name="l04431"></a>04431                 newbp= (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>), <span class="stringliteral">&quot;addvert_Nurb5&quot;</span>);
<a name="l04432"></a>04432                 newbp-&gt;radius= 1;
<a name="l04433"></a>04433                 newbp-&gt;alfa= 0;
<a name="l04434"></a>04434                 newbp-&gt;f1|= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l04435"></a>04435                 cu-&gt;lastsel= newbp;
<a name="l04436"></a>04436 
<a name="l04437"></a>04437                 newnu= (<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>), <span class="stringliteral">&quot;addvert_Nurb newnu&quot;</span>);
<a name="l04438"></a>04438                 memcpy(newnu, <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>));
<a name="l04439"></a>04439                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;editnurb-&gt;nurbs, newnu);
<a name="l04440"></a>04440                 <a class="code" href="../../d7/d55/editcurve_8c.html#a5898792f9c07dc5a831d3051859cefc5">set_actNurb</a>(obedit, newnu);
<a name="l04441"></a>04441                 newnu-&gt;bp= newbp;
<a name="l04442"></a>04442                 newnu-&gt;orderu= 2;
<a name="l04443"></a>04443                 newnu-&gt;pntsu= 1;
<a name="l04444"></a>04444 
<a name="l04445"></a>04445                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad7be0179ee8a128512e2c7f0ad11c8d8">mul_v3_m4v3</a>(newbp-&gt;vec, imat, location);
<a name="l04446"></a>04446                 newbp-&gt;vec[3]= 1.0;
<a name="l04447"></a>04447 
<a name="l04448"></a>04448                 newnu-&gt;knotsu= newnu-&gt;knotsv= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04449"></a>04449                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(newnu);
<a name="l04450"></a>04450 
<a name="l04451"></a>04451                 ok= 1;
<a name="l04452"></a>04452                 <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>= newnu;
<a name="l04453"></a>04453             }
<a name="l04454"></a>04454 
<a name="l04455"></a>04455         }
<a name="l04456"></a>04456 
<a name="l04457"></a>04457         <span class="keywordflow">if</span> (!ok)
<a name="l04458"></a>04458             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l04459"></a>04459     }
<a name="l04460"></a>04460 
<a name="l04461"></a>04461     <span class="keywordflow">if</span> (!ok &amp;&amp; <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l04462"></a>04462         <span class="comment">/* which bezpoint? */</span>
<a name="l04463"></a>04463         <span class="keywordflow">if</span> (bezt== (<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1)) {  <span class="comment">/* last */</span>
<a name="l04464"></a>04464             <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a93dcc657832994a8d1c2768bc2e19fa6">BEZ_DESEL</a>(bezt);
<a name="l04465"></a>04465             newbezt =
<a name="l04466"></a>04466                 (<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>((<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>+1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aafa4ace0bba7528ab007eabe81cbfc10">BezTriple</a>), <span class="stringliteral">&quot;addvert_Nurb&quot;</span>);
<a name="l04467"></a>04467             <a class="code" href="../../d7/d55/editcurve_8c.html#a5863deb4d104d1c79f9212cbe93affd5">ED_curve_beztcpy</a>(editnurb, newbezt, <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>, <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>);
<a name="l04468"></a>04468             *(newbezt+<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>)= *bezt;
<a name="l04469"></a>04469             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(temp, bezt-&gt;vec[1]);
<a name="l04470"></a>04470             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>);
<a name="l04471"></a>04471             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>= newbezt;
<a name="l04472"></a>04472             newbezt+= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l04473"></a>04473             <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a243e99ba94633b9581fb4a6e7b6375d0">BEZ_SEL</a>(newbezt);
<a name="l04474"></a>04474             cu-&gt;lastsel= newbezt;
<a name="l04475"></a>04475             newbezt-&gt;h1 = newbezt-&gt;h2;
<a name="l04476"></a>04476             bezt= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1;
<a name="l04477"></a>04477             ok= 1;
<a name="l04478"></a>04478 
<a name="l04479"></a>04479             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> &gt; 1) {
<a name="l04480"></a>04480                 bezt_recalc[1] = newbezt;
<a name="l04481"></a>04481                 bezt_recalc[0] = newbezt - 1;
<a name="l04482"></a>04482             }
<a name="l04483"></a>04483         }
<a name="l04484"></a>04484         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bezt== <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {   <span class="comment">/* first */</span>
<a name="l04485"></a>04485             <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a93dcc657832994a8d1c2768bc2e19fa6">BEZ_DESEL</a>(bezt);
<a name="l04486"></a>04486             newbezt =
<a name="l04487"></a>04487                 (<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>((<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>+1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aafa4ace0bba7528ab007eabe81cbfc10">BezTriple</a>), <span class="stringliteral">&quot;addvert_Nurb&quot;</span>);
<a name="l04488"></a>04488             <a class="code" href="../../d7/d55/editcurve_8c.html#a5863deb4d104d1c79f9212cbe93affd5">ED_curve_beztcpy</a>(editnurb, newbezt+1, bezt, <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>);
<a name="l04489"></a>04489             *newbezt= *bezt;
<a name="l04490"></a>04490             <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a243e99ba94633b9581fb4a6e7b6375d0">BEZ_SEL</a>(newbezt);
<a name="l04491"></a>04491             cu-&gt;lastsel= newbezt;
<a name="l04492"></a>04492             newbezt-&gt;h2= newbezt-&gt;h1;
<a name="l04493"></a>04493             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(temp, bezt-&gt;vec[1]);
<a name="l04494"></a>04494             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>);
<a name="l04495"></a>04495             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>= newbezt;
<a name="l04496"></a>04496             bezt= newbezt+1;
<a name="l04497"></a>04497             ok= 1;
<a name="l04498"></a>04498 
<a name="l04499"></a>04499             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> &gt; 1) {
<a name="l04500"></a>04500                 bezt_recalc[1] = newbezt;
<a name="l04501"></a>04501                 bezt_recalc[2] = newbezt + 1;
<a name="l04502"></a>04502             }
<a name="l04503"></a>04503         }
<a name="l04504"></a>04504         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode!=<span class="charliteral">&#39;e&#39;</span>) {
<a name="l04505"></a>04505             <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a93dcc657832994a8d1c2768bc2e19fa6">BEZ_DESEL</a>(bezt);
<a name="l04506"></a>04506             newbezt= (<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>), <span class="stringliteral">&quot;addvert_Nurb&quot;</span>);
<a name="l04507"></a>04507             *newbezt= *bezt;
<a name="l04508"></a>04508             <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a243e99ba94633b9581fb4a6e7b6375d0">BEZ_SEL</a>(newbezt);
<a name="l04509"></a>04509             newbezt-&gt;h2= newbezt-&gt;h1;
<a name="l04510"></a>04510             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(temp, bezt-&gt;vec[1]);
<a name="l04511"></a>04511 
<a name="l04512"></a>04512             newnu= (<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>), <span class="stringliteral">&quot;addvert_Nurb newnu&quot;</span>);
<a name="l04513"></a>04513             memcpy(newnu, <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>));
<a name="l04514"></a>04514             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;editnurb-&gt;nurbs, newnu);
<a name="l04515"></a>04515             <a class="code" href="../../d7/d55/editcurve_8c.html#a5898792f9c07dc5a831d3051859cefc5">set_actNurb</a>(obedit, newnu);
<a name="l04516"></a>04516             newnu-&gt;bezt= newbezt;
<a name="l04517"></a>04517             newnu-&gt;pntsu= 1;
<a name="l04518"></a>04518 
<a name="l04519"></a>04519             cu-&gt;lastsel= newbezt;
<a name="l04520"></a>04520 
<a name="l04521"></a>04521             bezt= newbezt;
<a name="l04522"></a>04522             ok= 1;
<a name="l04523"></a>04523         }
<a name="l04524"></a>04524         <span class="keywordflow">else</span> bezt= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04525"></a>04525 
<a name="l04526"></a>04526         <span class="keywordflow">if</span> (bezt) {
<a name="l04527"></a>04527             <span class="keywordflow">if</span> (!newnu) <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>++;
<a name="l04528"></a>04528 
<a name="l04529"></a>04529             <span class="keywordflow">if</span> (mode==<span class="charliteral">&#39;e&#39;</span>) {
<a name="l04530"></a>04530                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(newbezt-&gt;vec[0], bezt-&gt;vec[0]);
<a name="l04531"></a>04531                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(newbezt-&gt;vec[1], bezt-&gt;vec[1]);
<a name="l04532"></a>04532                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(newbezt-&gt;vec[2], bezt-&gt;vec[2]);
<a name="l04533"></a>04533             }
<a name="l04534"></a>04534             <span class="keywordflow">else</span> {
<a name="l04535"></a>04535                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad7be0179ee8a128512e2c7f0ad11c8d8">mul_v3_m4v3</a>(newbezt-&gt;vec[1], imat, location);
<a name="l04536"></a>04536                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(temp, newbezt-&gt;vec[1],temp);
<a name="l04537"></a>04537 
<a name="l04538"></a>04538                 <span class="keywordflow">if</span> (bezt_recalc[1]) {
<a name="l04539"></a>04539                     <span class="keyword">const</span> <span class="keywordtype">char</span> h1 = bezt_recalc[1]-&gt;h1, h2 = bezt_recalc[1]-&gt;h2;
<a name="l04540"></a>04540                     bezt_recalc[1]-&gt;h1 = bezt_recalc[1]-&gt;h2 = <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>;
<a name="l04541"></a>04541                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a1b74ac08e2d1a385a6dd7c1e26e25a5c">calchandleNurb</a>(bezt_recalc[1], bezt_recalc[0], bezt_recalc[2], 0);
<a name="l04542"></a>04542                     bezt_recalc[1]-&gt;h1 = h1;
<a name="l04543"></a>04543                     bezt_recalc[1]-&gt;h2 = h2;
<a name="l04544"></a>04544                 }
<a name="l04545"></a>04545                 <span class="keywordflow">else</span> {
<a name="l04546"></a>04546                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(newbezt-&gt;vec[0], bezt-&gt;vec[0],temp);
<a name="l04547"></a>04547                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(newbezt-&gt;vec[2], bezt-&gt;vec[2],temp);
<a name="l04548"></a>04548                 }
<a name="l04549"></a>04549                 
<a name="l04550"></a>04550 
<a name="l04551"></a>04551                 <span class="keywordflow">if</span> (newnu) <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(newnu);
<a name="l04552"></a>04552                 <span class="keywordflow">else</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>);
<a name="l04553"></a>04553             }
<a name="l04554"></a>04554         }
<a name="l04555"></a>04555     }
<a name="l04556"></a>04556     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!ok &amp;&amp; <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>==1) {
<a name="l04557"></a>04557         <span class="comment">/* which b-point? */</span>
<a name="l04558"></a>04558         <span class="keywordflow">if</span> (bp== (<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1)) {  <span class="comment">/* last */</span>
<a name="l04559"></a>04559             bp-&gt;f1= 0;
<a name="l04560"></a>04560             newbp =
<a name="l04561"></a>04561                 (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>((<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>+1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af73d40f9d8f8b10f64359a0704799ac9">BPoint</a>), <span class="stringliteral">&quot;addvert_Nurb4&quot;</span>);
<a name="l04562"></a>04562             <a class="code" href="../../d7/d55/editcurve_8c.html#acc934a7779bd2eee63200ad5c7bdd0d4">ED_curve_bpcpy</a>(editnurb, newbp, <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>);
<a name="l04563"></a>04563             *(newbp+<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>)= *bp;
<a name="l04564"></a>04564             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l04565"></a>04565             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= newbp;
<a name="l04566"></a>04566             newbp+= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l04567"></a>04567             newbp-&gt;f1|= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l04568"></a>04568             cu-&gt;lastsel= newbp;
<a name="l04569"></a>04569             bp= newbp - 1;
<a name="l04570"></a>04570             ok= 1;
<a name="l04571"></a>04571         }
<a name="l04572"></a>04572         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bp== <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>) {   <span class="comment">/* first */</span>
<a name="l04573"></a>04573             bp-&gt;f1= 0;
<a name="l04574"></a>04574             newbp =
<a name="l04575"></a>04575                 (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>((<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>+1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af73d40f9d8f8b10f64359a0704799ac9">BPoint</a>), <span class="stringliteral">&quot;addvert_Nurb3&quot;</span>);
<a name="l04576"></a>04576             <a class="code" href="../../d7/d55/editcurve_8c.html#acc934a7779bd2eee63200ad5c7bdd0d4">ED_curve_bpcpy</a>(editnurb, newbp+1, bp, <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>);
<a name="l04577"></a>04577             *newbp= *bp;
<a name="l04578"></a>04578             newbp-&gt;f1|= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l04579"></a>04579             cu-&gt;lastsel= newbp;
<a name="l04580"></a>04580             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l04581"></a>04581             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= newbp;
<a name="l04582"></a>04582             bp= newbp + 1;
<a name="l04583"></a>04583             ok= 1;
<a name="l04584"></a>04584         }
<a name="l04585"></a>04585         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode!=<span class="charliteral">&#39;e&#39;</span>) {
<a name="l04586"></a>04586             bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a>= 0;
<a name="l04587"></a>04587             newbp= (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>), <span class="stringliteral">&quot;addvert_Nurb5&quot;</span>);
<a name="l04588"></a>04588             *newbp= *bp;
<a name="l04589"></a>04589             newbp-&gt;f1|= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l04590"></a>04590             cu-&gt;lastsel= newbp;
<a name="l04591"></a>04591 
<a name="l04592"></a>04592             newnu= (<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>), <span class="stringliteral">&quot;addvert_Nurb newnu&quot;</span>);
<a name="l04593"></a>04593             memcpy(newnu, <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>));
<a name="l04594"></a>04594             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;editnurb-&gt;nurbs, newnu);
<a name="l04595"></a>04595             <a class="code" href="../../d7/d55/editcurve_8c.html#a5898792f9c07dc5a831d3051859cefc5">set_actNurb</a>(obedit, newnu);
<a name="l04596"></a>04596             newnu-&gt;bp= newbp;
<a name="l04597"></a>04597             newnu-&gt;orderu= 2;
<a name="l04598"></a>04598             newnu-&gt;pntsu= 1;
<a name="l04599"></a>04599             newnu-&gt;knotsu= newnu-&gt;knotsv= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04600"></a>04600 
<a name="l04601"></a>04601             bp= newbp;
<a name="l04602"></a>04602             ok= 1;
<a name="l04603"></a>04603         }
<a name="l04604"></a>04604         <span class="keywordflow">else</span> bp= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04605"></a>04605 
<a name="l04606"></a>04606         <span class="keywordflow">if</span> (bp) {
<a name="l04607"></a>04607             <span class="keywordflow">if</span> (mode==<span class="charliteral">&#39;e&#39;</span>) {
<a name="l04608"></a>04608                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(newbp-&gt;vec, bp-&gt;vec);
<a name="l04609"></a>04609             }
<a name="l04610"></a>04610             <span class="keywordflow">else</span> {
<a name="l04611"></a>04611                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad7be0179ee8a128512e2c7f0ad11c8d8">mul_v3_m4v3</a>(newbp-&gt;vec, imat, location);
<a name="l04612"></a>04612                 newbp-&gt;vec[3]= 1.0;
<a name="l04613"></a>04613 
<a name="l04614"></a>04614                 <span class="keywordflow">if</span> (!newnu &amp;&amp; <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>&lt;4 &amp;&amp; <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>&lt;=<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>)
<a name="l04615"></a>04615                     <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>++;
<a name="l04616"></a>04616             }
<a name="l04617"></a>04617 
<a name="l04618"></a>04618             <span class="keywordflow">if</span> (!newnu) {
<a name="l04619"></a>04619                 <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>++;
<a name="l04620"></a>04620                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>);
<a name="l04621"></a>04621             }
<a name="l04622"></a>04622             <span class="keywordflow">else</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(newnu);
<a name="l04623"></a>04623         }
<a name="l04624"></a>04624     }
<a name="l04625"></a>04625 
<a name="l04626"></a>04626     <span class="keywordflow">if</span> (ok) {
<a name="l04627"></a>04627         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aae5669b490cbbe44c59fba3239f4223a">test2DNurb</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>);
<a name="l04628"></a>04628 
<a name="l04629"></a>04629         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a1a79334fb2fbb2d4951b7196c64a9edb">ED_curve_updateAnimPaths</a>(obedit-&gt;data))
<a name="l04630"></a>04630             <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ab2ab88214d816c47ebee1a985b0e68b3">ND_KEYS</a>, obedit);
<a name="l04631"></a>04631 
<a name="l04632"></a>04632         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;data);
<a name="l04633"></a>04633         <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;data, 0);
<a name="l04634"></a>04634 
<a name="l04635"></a>04635         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l04636"></a>04636     }
<a name="l04637"></a>04637 
<a name="l04638"></a>04638     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l04639"></a>04639 }
<a name="l04640"></a>04640 
<a name="l04641"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a0fd4e405e3e5984ede472e904646619e">04641</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a0fd4e405e3e5984ede472e904646619e">add_vertex_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l04642"></a>04642 {
<a name="l04643"></a>04643     <span class="keywordtype">float</span> location[3];
<a name="l04644"></a>04644 
<a name="l04645"></a>04645     <a class="code" href="../../d3/d10/rna__access_8c.html#a5d95f86ccce314676ae750034fb56709">RNA_float_get_array</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;location&quot;</span>, location);
<a name="l04646"></a>04646     <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ac16c244f26aff0703ea164821ba36aa5">addvert_Nurb</a>(C, 0, location);
<a name="l04647"></a>04647 }
<a name="l04648"></a>04648 
<a name="l04649"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a25afde5585ddf7e7bbee578ad37c225a">04649</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a25afde5585ddf7e7bbee578ad37c225a">add_vertex_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l04650"></a>04650 {
<a name="l04651"></a>04651     <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d= <a class="code" href="../../df/d01/BKE__context_8h.html#af03543cb8e3fa2c39bb777962a6eae13">CTX_wm_region_view3d</a>(C);
<a name="l04652"></a>04652 
<a name="l04653"></a>04653     <span class="keywordflow">if</span> (rv3d &amp;&amp; !<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;location&quot;</span>)) {
<a name="l04654"></a>04654         <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu;
<a name="l04655"></a>04655         <a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> vc;
<a name="l04656"></a>04656         <span class="keywordtype">float</span> location[3];
<a name="l04657"></a>04657 
<a name="l04658"></a>04658         <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l04659"></a>04659         <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l04660"></a>04660         <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l04661"></a>04661 
<a name="l04662"></a>04662         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#aa18efc327ab12e74064a2c1129237431">view3d_set_viewcontext</a>(C, &amp;vc);
<a name="l04663"></a>04663 
<a name="l04664"></a>04664         cu= vc.<a class="code" href="../../d8/d30/structViewContext.html#aa802aba424149fb5c03e34795a836810">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l04665"></a>04665 
<a name="l04666"></a>04666         <a class="code" href="../../d7/d55/editcurve_8c.html#a290ad9774c86dd69c224950eb7ae6712">findselectedNurbvert</a>(&amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>, &amp;nu, &amp;bezt, &amp;bp);
<a name="l04667"></a>04667 
<a name="l04668"></a>04668         <span class="keywordflow">if</span> (bezt) {
<a name="l04669"></a>04669             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad7be0179ee8a128512e2c7f0ad11c8d8">mul_v3_m4v3</a>(location, vc.<a class="code" href="../../d8/d30/structViewContext.html#aa802aba424149fb5c03e34795a836810">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1]);
<a name="l04670"></a>04670         }
<a name="l04671"></a>04671         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bp) {
<a name="l04672"></a>04672             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad7be0179ee8a128512e2c7f0ad11c8d8">mul_v3_m4v3</a>(location, vc.<a class="code" href="../../d8/d30/structViewContext.html#aa802aba424149fb5c03e34795a836810">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l04673"></a>04673         }
<a name="l04674"></a>04674         <span class="keywordflow">else</span> {
<a name="l04675"></a>04675             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(location, <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a56c6dfa9088d0f90552a67074a359c97">give_cursor</a>(vc.<a class="code" href="../../d8/d30/structViewContext.html#a318ac2fefa5f4e6ad6faa0a7249d7e73">scene</a>, vc.<a class="code" href="../../d8/d30/structViewContext.html#ac33fdbda0e0b759a8f12a889216d6945">v3d</a>));
<a name="l04676"></a>04676         }
<a name="l04677"></a>04677 
<a name="l04678"></a>04678         <a class="code" href="../../d8/d6a/ED__view3d_8h.html#abd95d019b4c65c5fa61f12f4c665c455">view3d_get_view_aligned_coordinate</a>(&amp;vc, location, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l04679"></a>04679         <a class="code" href="../../d3/d10/rna__access_8c.html#ad8067a3fc34e361ac2283352ff2f906c">RNA_float_set_array</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;location&quot;</span>, location);
<a name="l04680"></a>04680     }
<a name="l04681"></a>04681 
<a name="l04682"></a>04682     <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a0fd4e405e3e5984ede472e904646619e">add_vertex_exec</a>(C, op);
<a name="l04683"></a>04683 }
<a name="l04684"></a>04684 
<a name="l04685"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a7f5f2f237c96e94eee6506dc5c398822">04685</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a69cc2b8f88dd53ba6b1391b4713bbed3">CURVE_OT_vertex_add</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l04686"></a>04686 {
<a name="l04687"></a>04687     <span class="comment">/* identifiers */</span>
<a name="l04688"></a>04688     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Vertex&quot;</span>;
<a name="l04689"></a>04689     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_vertex_add&quot;</span>;
<a name="l04690"></a>04690     
<a name="l04691"></a>04691     <span class="comment">/* api callbacks */</span>
<a name="l04692"></a>04692     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a0fd4e405e3e5984ede472e904646619e">add_vertex_exec</a>;
<a name="l04693"></a>04693     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a25afde5585ddf7e7bbee578ad37c225a">add_vertex_invoke</a>;
<a name="l04694"></a>04694     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a443591620f4deea4cac8a4098f66d2f7">ED_operator_editcurve</a>;
<a name="l04695"></a>04695 
<a name="l04696"></a>04696     <span class="comment">/* flags */</span>
<a name="l04697"></a>04697     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l04698"></a>04698 
<a name="l04699"></a>04699     <span class="comment">/* properties */</span>
<a name="l04700"></a>04700     <a class="code" href="../../dc/d7e/rna__define_8c.html#acb6ba2575b8f80440763c340482fee11">RNA_def_float_vector_xyz</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;location&quot;</span>, 3, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <span class="stringliteral">&quot;Location&quot;</span>, <span class="stringliteral">&quot;Location to add new vertex at&quot;</span>, -1e4, 1e4);
<a name="l04701"></a>04701 }
<a name="l04702"></a>04702 
<a name="l04703"></a>04703 <span class="comment">/***************** extrude operator **********************/</span>
<a name="l04704"></a>04704 
<a name="l04705"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ae654c008d2913c2b6895c6f06085d6da">04705</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ae654c008d2913c2b6895c6f06085d6da">extrude_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l04706"></a>04706 {
<a name="l04707"></a>04707     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l04708"></a>04708     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l04709"></a>04709     <a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>;
<a name="l04710"></a>04710     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l04711"></a>04711     
<a name="l04712"></a>04712     <span class="comment">/* first test: curve? */</span>
<a name="l04713"></a>04713     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>)
<a name="l04714"></a>04714         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>==1 &amp;&amp; <a class="code" href="../../d7/d55/editcurve_8c.html#a564f44c061399358cc0ccd22f13d011a">isNurbsel_count</a>(cu, nu)==1)
<a name="l04715"></a>04715             <span class="keywordflow">break</span>;
<a name="l04716"></a>04716 
<a name="l04717"></a>04717     <span class="keywordflow">if</span> (obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a> || nu) {
<a name="l04718"></a>04718         <a class="code" href="../../d7/d55/editcurve_8c.html#ac16c244f26aff0703ea164821ba36aa5">addvert_Nurb</a>(C, <span class="charliteral">&#39;e&#39;</span>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l04719"></a>04719     }
<a name="l04720"></a>04720     <span class="keywordflow">else</span> {
<a name="l04721"></a>04721         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a0140a436787b2f39ff2a2313ff47a796">extrudeflagNurb</a>(editnurb, 1)) { <span class="comment">/* &#39;1&#39;= flag */</span>
<a name="l04722"></a>04722             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a1a79334fb2fbb2d4951b7196c64a9edb">ED_curve_updateAnimPaths</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>))
<a name="l04723"></a>04723                 <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ab2ab88214d816c47ebee1a985b0e68b3">ND_KEYS</a>, obedit);
<a name="l04724"></a>04724 
<a name="l04725"></a>04725             <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l04726"></a>04726             <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l04727"></a>04727         }
<a name="l04728"></a>04728     }
<a name="l04729"></a>04729 
<a name="l04730"></a>04730     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l04731"></a>04731 }
<a name="l04732"></a>04732 
<a name="l04733"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a34cc49dae9b757eb7c105a9562f9d01b">04733</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a09d31fb574f914a634e8fb01c35af77e">CURVE_OT_extrude</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l04734"></a>04734 {
<a name="l04735"></a>04735     <span class="comment">/* identifiers */</span>
<a name="l04736"></a>04736     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Extrude&quot;</span>;
<a name="l04737"></a>04737     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Extrude selected control point(s) and move&quot;</span>;
<a name="l04738"></a>04738     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_extrude&quot;</span>;
<a name="l04739"></a>04739     
<a name="l04740"></a>04740     <span class="comment">/* api callbacks */</span>
<a name="l04741"></a>04741     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#ae654c008d2913c2b6895c6f06085d6da">extrude_exec</a>;
<a name="l04742"></a>04742     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l04743"></a>04743 
<a name="l04744"></a>04744     <span class="comment">/* flags */</span>
<a name="l04745"></a>04745     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l04746"></a>04746 
<a name="l04747"></a>04747     <span class="comment">/* to give to transform */</span>
<a name="l04748"></a>04748     <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;mode&quot;</span>, <a class="code" href="../../d3/d0f/transform__ops_8c.html#a0cc49fe43d3d0f938a1fc45c4cae96af">transform_mode_types</a>, <a class="code" href="../../d8/df2/ED__transform_8h.html#aa57e16cd48de3b9a989056ff8df26f84ac6708d3325ae542bd46d599286c1cf90">TFM_TRANSLATION</a>, <span class="stringliteral">&quot;Mode&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l04749"></a>04749 }
<a name="l04750"></a>04750 
<a name="l04751"></a>04751 <span class="comment">/***************** make cyclic operator **********************/</span>
<a name="l04752"></a>04752 
<a name="l04753"></a><a class="code" href="../../d7/d55/editcurve_8c.html#aba0895f9761f410126257ef8d266a87b">04753</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#aba0895f9761f410126257ef8d266a87b">toggle_cyclic_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l04754"></a>04754 {
<a name="l04755"></a>04755     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l04756"></a>04756     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l04757"></a>04757     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l04758"></a>04758     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l04759"></a>04759     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l04760"></a>04760     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l04761"></a>04761     <span class="keywordtype">int</span> a, direction= <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;direction&quot;</span>);
<a name="l04762"></a>04762 
<a name="l04763"></a>04763     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l04764"></a>04764         <span class="keywordflow">if</span> ( nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>&gt;1 || nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>&gt;1) {
<a name="l04765"></a>04765             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af3fcb97faad660091cefad29858eec77">CU_POLY</a>) {
<a name="l04766"></a>04766                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l04767"></a>04767                 bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l04768"></a>04768                 <span class="keywordflow">while</span> (a--) {
<a name="l04769"></a>04769                     <span class="keywordflow">if</span> ( bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a> ) {
<a name="l04770"></a>04770                         nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> ^= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>;
<a name="l04771"></a>04771                         <span class="keywordflow">break</span>;
<a name="l04772"></a>04772                     }
<a name="l04773"></a>04773                     bp++;
<a name="l04774"></a>04774                 }
<a name="l04775"></a>04775             }
<a name="l04776"></a>04776             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l04777"></a>04777                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l04778"></a>04778                 bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l04779"></a>04779                 <span class="keywordflow">while</span> (a--) {
<a name="l04780"></a>04780                     <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abcf63d093f344e298763ce019f0a1cb1">BEZSELECTED_HIDDENHANDLES</a>(cu, bezt) ) {
<a name="l04781"></a>04781                         nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> ^= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>;
<a name="l04782"></a>04782                         <span class="keywordflow">break</span>;
<a name="l04783"></a>04783                     }
<a name="l04784"></a>04784                     bezt++;
<a name="l04785"></a>04785                 }
<a name="l04786"></a>04786                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(nu);
<a name="l04787"></a>04787             }
<a name="l04788"></a>04788             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>==1 &amp;&amp; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l04789"></a>04789                 <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>) { <span class="comment">/* if check_valid_nurb_u fails the knotsu can be NULL */</span>
<a name="l04790"></a>04790                     a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l04791"></a>04791                     bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l04792"></a>04792                     <span class="keywordflow">while</span> (a--) {
<a name="l04793"></a>04793                         <span class="keywordflow">if</span> ( bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a> ) {
<a name="l04794"></a>04794                             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> ^= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>;
<a name="l04795"></a>04795                             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(nu);  <span class="comment">/* 1==u  type is ignored for cyclic curves */</span>
<a name="l04796"></a>04796                             <span class="keywordflow">break</span>;
<a name="l04797"></a>04797                         }
<a name="l04798"></a>04798                         bp++;
<a name="l04799"></a>04799                     }
<a name="l04800"></a>04800                 }
<a name="l04801"></a>04801             }
<a name="l04802"></a>04802             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l04803"></a>04803                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l04804"></a>04804                 bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l04805"></a>04805                 <span class="keywordflow">while</span> (a--) {
<a name="l04806"></a>04806     
<a name="l04807"></a>04807                     <span class="keywordflow">if</span> ( bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l04808"></a>04808                         <span class="keywordflow">if</span> (direction==0 &amp;&amp; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>&gt;1) {
<a name="l04809"></a>04809                             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> ^= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>;
<a name="l04810"></a>04810                             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(nu);   <span class="comment">/* 1==u  type is ignored for cyclic curves */</span>
<a name="l04811"></a>04811                         }
<a name="l04812"></a>04812                         <span class="keywordflow">if</span> (direction==1 &amp;&amp; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>&gt;1) {
<a name="l04813"></a>04813                             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ae1c344a45c028d3c2067864f5280854e">flagv</a> ^= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>;
<a name="l04814"></a>04814                             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67a9890171625dedc07c1b7566703ddb">nurbs_knot_calc_v</a>(nu);   <span class="comment">/* 2==v  type is ignored for cyclic curves */</span>
<a name="l04815"></a>04815                         }
<a name="l04816"></a>04816                         <span class="keywordflow">break</span>;
<a name="l04817"></a>04817                     }
<a name="l04818"></a>04818                     bp++;
<a name="l04819"></a>04819                 }
<a name="l04820"></a>04820     
<a name="l04821"></a>04821             }
<a name="l04822"></a>04822         }
<a name="l04823"></a>04823     }
<a name="l04824"></a>04824 
<a name="l04825"></a>04825     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l04826"></a>04826     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l04827"></a>04827 
<a name="l04828"></a>04828     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l04829"></a>04829 }
<a name="l04830"></a>04830 
<a name="l04831"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ae668270d39fa41393f8f0b9a5e70cb08">04831</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ae668270d39fa41393f8f0b9a5e70cb08">toggle_cyclic_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l04832"></a>04832 {
<a name="l04833"></a>04833     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l04834"></a>04834     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l04835"></a>04835     <a class="code" href="../../d9/d4b/structuiPopupMenu.html">uiPopupMenu</a> *pup;
<a name="l04836"></a>04836     <a class="code" href="../../d4/d94/structuiLayout.html">uiLayout</a> *layout;
<a name="l04837"></a>04837     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l04838"></a>04838 
<a name="l04839"></a>04839     <span class="keywordflow">if</span> (obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>) {
<a name="l04840"></a>04840         <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l04841"></a>04841             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>&gt;1 || nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>&gt;1) {
<a name="l04842"></a>04842                 <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l04843"></a>04843                     pup= <a class="code" href="../../d8/d1e/UI__interface_8h.html#a402c012d9cde0ff0f0808c25c4213d43">uiPupMenuBegin</a>(C, <span class="stringliteral">&quot;Direction&quot;</span>, ICON_NONE);
<a name="l04844"></a>04844                     layout= <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8c1b07b81987cdc2168a7417f9104cca">uiPupMenuLayout</a>(pup);
<a name="l04845"></a>04845                     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a978da8810d3910b8b9057e80e1817de4">uiItemsEnumO</a>(layout, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>, <span class="stringliteral">&quot;direction&quot;</span>);
<a name="l04846"></a>04846                     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3ab0b4d9de253d473a16d4f329d8b50f">uiPupMenuEnd</a>(C, pup);
<a name="l04847"></a>04847                     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l04848"></a>04848                 }
<a name="l04849"></a>04849             }
<a name="l04850"></a>04850         }
<a name="l04851"></a>04851     }
<a name="l04852"></a>04852 
<a name="l04853"></a>04853     <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#aba0895f9761f410126257ef8d266a87b">toggle_cyclic_exec</a>(C, op);
<a name="l04854"></a>04854 }
<a name="l04855"></a>04855 
<a name="l04856"></a><a class="code" href="../../d7/d55/editcurve_8c.html#abad9cdae765f2a5a63db663c182ee3c4">04856</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a2742fd19e49f9f8eed35411c6ae35ada">CURVE_OT_cyclic_toggle</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l04857"></a>04857 {
<a name="l04858"></a>04858     <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> <a class="code" href="../../d0/d85/editmesh__tools_8c.html#acc0ca7eba6ad393abd6ef1d4592a738c">direction_items</a>[]= {
<a name="l04859"></a>04859         {0, <span class="stringliteral">&quot;CYCLIC_U&quot;</span>, 0, <span class="stringliteral">&quot;Cyclic U&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l04860"></a>04860         {1, <span class="stringliteral">&quot;CYCLIC_V&quot;</span>, 0, <span class="stringliteral">&quot;Cyclic V&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l04861"></a>04861         {0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL}};
<a name="l04862"></a>04862 
<a name="l04863"></a>04863     <span class="comment">/* identifiers */</span>
<a name="l04864"></a>04864     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Toggle Cyclic&quot;</span>;
<a name="l04865"></a>04865     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Make active spline closed/opened loop&quot;</span>;
<a name="l04866"></a>04866     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_cyclic_toggle&quot;</span>;
<a name="l04867"></a>04867     
<a name="l04868"></a>04868     <span class="comment">/* api callbacks */</span>
<a name="l04869"></a>04869     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#aba0895f9761f410126257ef8d266a87b">toggle_cyclic_exec</a>;
<a name="l04870"></a>04870     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#ae668270d39fa41393f8f0b9a5e70cb08">toggle_cyclic_invoke</a>;
<a name="l04871"></a>04871     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l04872"></a>04872 
<a name="l04873"></a>04873     <span class="comment">/* flags */</span>
<a name="l04874"></a>04874     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l04875"></a>04875 
<a name="l04876"></a>04876     <span class="comment">/* properties */</span>
<a name="l04877"></a>04877     <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;direction&quot;</span>, direction_items, 0, <span class="stringliteral">&quot;Direction&quot;</span>, <span class="stringliteral">&quot;Direction to make surface cyclic in&quot;</span>);
<a name="l04878"></a>04878 }
<a name="l04879"></a>04879 
<a name="l04880"></a>04880 <span class="comment">/***************** select linked operator ******************/</span>
<a name="l04881"></a>04881 
<a name="l04882"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ad5776f117426cbd4f8655dcff1175f86">04882</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ad5776f117426cbd4f8655dcff1175f86">select_linked_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l04883"></a>04883 {
<a name="l04884"></a>04884     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l04885"></a>04885     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= (<a class="code" href="../../da/d10/structCurve.html">Curve</a>*)obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l04886"></a>04886     <a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>;
<a name="l04887"></a>04887     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nurbs= &amp;editnurb-&gt;nurbs;
<a name="l04888"></a>04888     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l04889"></a>04889     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l04890"></a>04890     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l04891"></a>04891     <span class="keywordtype">int</span> a;
<a name="l04892"></a>04892 
<a name="l04893"></a>04893     for (<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>= nurbs-&gt;first; <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>; <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l04894"></a>04894         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l04895"></a>04895             bezt= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l04896"></a>04896             a= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l04897"></a>04897             <span class="keywordflow">while</span> (a--) {
<a name="l04898"></a>04898                 <span class="keywordflow">if</span> ( (bezt-&gt;f1 &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) || (bezt-&gt;f2 &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) || (bezt-&gt;f3 &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) ) {
<a name="l04899"></a>04899                     a= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l04900"></a>04900                     bezt= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l04901"></a>04901                     <span class="keywordflow">while</span> (a--) {
<a name="l04902"></a>04902                         <a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">select_beztriple</a>(bezt, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>);
<a name="l04903"></a>04903                         bezt++;
<a name="l04904"></a>04904                     }
<a name="l04905"></a>04905                     <span class="keywordflow">break</span>;
<a name="l04906"></a>04906                 }
<a name="l04907"></a>04907                 bezt++;
<a name="l04908"></a>04908             }
<a name="l04909"></a>04909         }
<a name="l04910"></a>04910         <span class="keywordflow">else</span> {
<a name="l04911"></a>04911             bp= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l04912"></a>04912             a= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l04913"></a>04913             <span class="keywordflow">while</span> (a--) {
<a name="l04914"></a>04914                 <span class="keywordflow">if</span> ( bp-&gt;f1 &amp; 1 ) {
<a name="l04915"></a>04915                     a= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l04916"></a>04916                     bp= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l04917"></a>04917                     <span class="keywordflow">while</span> (a--) {
<a name="l04918"></a>04918                         <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>);
<a name="l04919"></a>04919                         bp++;
<a name="l04920"></a>04920                     }
<a name="l04921"></a>04921                     <span class="keywordflow">break</span>;
<a name="l04922"></a>04922                 }
<a name="l04923"></a>04923                 bp++;
<a name="l04924"></a>04924             }
<a name="l04925"></a>04925         }
<a name="l04926"></a>04926     }
<a name="l04927"></a>04927 
<a name="l04928"></a>04928     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa1eaeb409fe6a81df91467aaeb289a07">ND_SELECT</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l04929"></a>04929 
<a name="l04930"></a>04930     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l04931"></a>04931 }
<a name="l04932"></a>04932 
<a name="l04933"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a6b8385edb706da74b5334a1942d0b5c5">04933</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a6b8385edb706da74b5334a1942d0b5c5">select_linked_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l04934"></a>04934 {
<a name="l04935"></a>04935     <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ad5776f117426cbd4f8655dcff1175f86">select_linked_exec</a>(C, op);
<a name="l04936"></a>04936 }
<a name="l04937"></a>04937 
<a name="l04938"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a2e0951c50ef2e2c9c8e2e1908accc978">04938</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a4763584b1a3f6ad0d4efb2765d93744f">CURVE_OT_select_linked</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l04939"></a>04939 {
<a name="l04940"></a>04940     <span class="comment">/* identifiers */</span>
<a name="l04941"></a>04941     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select Linked All&quot;</span>;
<a name="l04942"></a>04942     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_select_linked&quot;</span>;
<a name="l04943"></a>04943 
<a name="l04944"></a>04944     <span class="comment">/* api callbacks */</span>
<a name="l04945"></a>04945     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#ad5776f117426cbd4f8655dcff1175f86">select_linked_exec</a>;
<a name="l04946"></a>04946     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a6b8385edb706da74b5334a1942d0b5c5">select_linked_invoke</a>;
<a name="l04947"></a>04947     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l04948"></a>04948 
<a name="l04949"></a>04949     <span class="comment">/* flags */</span>
<a name="l04950"></a>04950     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l04951"></a>04951 
<a name="l04952"></a>04952     <span class="comment">/* properties */</span>
<a name="l04953"></a>04953 }
<a name="l04954"></a>04954 
<a name="l04955"></a>04955 
<a name="l04956"></a>04956 <span class="comment">/***************** select linked pick operator ******************/</span>
<a name="l04957"></a>04957 
<a name="l04958"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a70e2da5e86c98444f43dc9221d8e25a2">04958</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a70e2da5e86c98444f43dc9221d8e25a2">select_linked_pick_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l04959"></a>04959 {
<a name="l04960"></a>04960     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l04961"></a>04961     <a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> vc;
<a name="l04962"></a>04962     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l04963"></a>04963     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l04964"></a>04964     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l04965"></a>04965     <span class="keywordtype">int</span> a, deselect;
<a name="l04966"></a>04966 
<a name="l04967"></a>04967     deselect= <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;deselect&quot;</span>);
<a name="l04968"></a>04968 
<a name="l04969"></a>04969     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#ad4e74149dc97fd5cdb1c124ecafd8eec">view3d_operator_needs_opengl</a>(C);
<a name="l04970"></a>04970     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#aa18efc327ab12e74064a2c1129237431">view3d_set_viewcontext</a>(C, &amp;vc);
<a name="l04971"></a>04971 
<a name="l04972"></a>04972     <a class="code" href="../../d7/d55/editcurve_8c.html#a019e7552a307cad4df99d528d5d5249f">findnearestNurbvert</a>(&amp;vc, 1, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>, &amp;nu, &amp;bezt, &amp;bp);
<a name="l04973"></a>04973 
<a name="l04974"></a>04974     <span class="keywordflow">if</span> (bezt) {
<a name="l04975"></a>04975         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l04976"></a>04976         bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l04977"></a>04977         <span class="keywordflow">while</span> (a--) {
<a name="l04978"></a>04978             <span class="keywordflow">if</span> (deselect) <a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">select_beztriple</a>(bezt, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>);
<a name="l04979"></a>04979             <span class="keywordflow">else</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">select_beztriple</a>(bezt, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>);
<a name="l04980"></a>04980             bezt++;
<a name="l04981"></a>04981         }
<a name="l04982"></a>04982     }
<a name="l04983"></a>04983     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bp) {
<a name="l04984"></a>04984         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l04985"></a>04985         bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l04986"></a>04986         <span class="keywordflow">while</span> (a--) {
<a name="l04987"></a>04987             <span class="keywordflow">if</span> (deselect) <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>);
<a name="l04988"></a>04988             <span class="keywordflow">else</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>);
<a name="l04989"></a>04989             bp++;
<a name="l04990"></a>04990         }
<a name="l04991"></a>04991     }
<a name="l04992"></a>04992 
<a name="l04993"></a>04993     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa1eaeb409fe6a81df91467aaeb289a07">ND_SELECT</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l04994"></a>04994 
<a name="l04995"></a>04995     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l04996"></a>04996 }
<a name="l04997"></a>04997 
<a name="l04998"></a><a class="code" href="../../d7/d55/editcurve_8c.html#adaa2fbb37d61d28278d4f7082d477f06">04998</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#af8ea87ce2c3f0fa605c7766fd63fde74">CURVE_OT_select_linked_pick</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l04999"></a>04999 {
<a name="l05000"></a>05000     <span class="comment">/* identifiers */</span>
<a name="l05001"></a>05001     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select Linked&quot;</span>;
<a name="l05002"></a>05002     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_select_linked_pick&quot;</span>;
<a name="l05003"></a>05003 
<a name="l05004"></a>05004     <span class="comment">/* api callbacks */</span>
<a name="l05005"></a>05005     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a70e2da5e86c98444f43dc9221d8e25a2">select_linked_pick_invoke</a>;
<a name="l05006"></a>05006     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a33075b32cbf326623c280ef23d67ed65">ED_operator_editsurfcurve_region_view3d</a>;
<a name="l05007"></a>05007 
<a name="l05008"></a>05008     <span class="comment">/* flags */</span>
<a name="l05009"></a>05009     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l05010"></a>05010 
<a name="l05011"></a>05011     <span class="comment">/* properties */</span>
<a name="l05012"></a>05012     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;deselect&quot;</span>, 0, <span class="stringliteral">&quot;Deselect&quot;</span>, <span class="stringliteral">&quot;Deselect linked control points rather than selecting them&quot;</span>);
<a name="l05013"></a>05013 }
<a name="l05014"></a>05014 
<a name="l05015"></a>05015 <span class="comment">/***************** select row operator **********************/</span>
<a name="l05016"></a>05016 
<a name="l05017"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a64147a218212efee1dc0175b2d82cc55">05017</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a64147a218212efee1dc0175b2d82cc55">select_row_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l05018"></a>05018 {
<a name="l05019"></a>05019     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l05020"></a>05020     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l05021"></a>05021     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l05022"></a>05022     <span class="keyword">static</span> <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *last= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05023"></a>05023     <span class="keyword">static</span> <span class="keywordtype">int</span> direction=0;
<a name="l05024"></a>05024     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l05025"></a>05025     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l05026"></a>05026     <span class="keywordtype">int</span> u = 0, v = 0, a, b, ok=0;
<a name="l05027"></a>05027 
<a name="l05028"></a>05028     <span class="keywordflow">if</span> (editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05029"></a>05029         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l05030"></a>05030     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l05031"></a>05031         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l05032"></a>05032 
<a name="l05033"></a>05033     <span class="comment">/* find the correct nurb and toggle with u of v */</span>
<a name="l05034"></a>05034     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l05035"></a>05035         bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l05036"></a>05036         <span class="keywordflow">for</span> (v=0; v&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; v++) {
<a name="l05037"></a>05037             <span class="keywordflow">for</span> (u=0; u&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; u++, bp++) {
<a name="l05038"></a>05038                 <span class="keywordflow">if</span> (bp==cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>) {
<a name="l05039"></a>05039                     <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l05040"></a>05040                         ok= 1;
<a name="l05041"></a>05041                         <span class="keywordflow">break</span>;
<a name="l05042"></a>05042                     }
<a name="l05043"></a>05043                 }
<a name="l05044"></a>05044             }
<a name="l05045"></a>05045             <span class="keywordflow">if</span> (ok) <span class="keywordflow">break</span>;
<a name="l05046"></a>05046         }
<a name="l05047"></a>05047 
<a name="l05048"></a>05048         <span class="keywordflow">if</span> (ok) {
<a name="l05049"></a>05049             <span class="keywordflow">if</span> (last==cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>) {
<a name="l05050"></a>05050                 direction= 1-direction;
<a name="l05051"></a>05051                 <a class="code" href="../../d7/d55/editcurve_8c.html#a9d92d24c42cc1db29dcac1a5fe4d0e5e">setflagsNurb</a>(editnurb, 0);
<a name="l05052"></a>05052             }
<a name="l05053"></a>05053             last= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>;
<a name="l05054"></a>05054 
<a name="l05055"></a>05055             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l05056"></a>05056             <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; a++) {
<a name="l05057"></a>05057                 <span class="keywordflow">for</span> (b=0; b&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; b++, bp++) {
<a name="l05058"></a>05058                     <span class="keywordflow">if</span> (direction) {
<a name="l05059"></a>05059                         <span class="keywordflow">if</span> (a==v) <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>);
<a name="l05060"></a>05060                     }
<a name="l05061"></a>05061                     <span class="keywordflow">else</span> {
<a name="l05062"></a>05062                         <span class="keywordflow">if</span> (b==u) <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>);
<a name="l05063"></a>05063                     }
<a name="l05064"></a>05064                 }
<a name="l05065"></a>05065             }
<a name="l05066"></a>05066 
<a name="l05067"></a>05067             <span class="keywordflow">break</span>;
<a name="l05068"></a>05068         }
<a name="l05069"></a>05069     }
<a name="l05070"></a>05070     
<a name="l05071"></a>05071     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa1eaeb409fe6a81df91467aaeb289a07">ND_SELECT</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l05072"></a>05072 
<a name="l05073"></a>05073     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l05074"></a>05074 }
<a name="l05075"></a>05075 
<a name="l05076"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ac42a411d63b84cc921bbd30f256d993c">05076</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a06d6908393d1cde027282bb06c51b338">CURVE_OT_select_row</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l05077"></a>05077 {
<a name="l05078"></a>05078     <span class="comment">/* identifiers */</span>
<a name="l05079"></a>05079     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select Control Point Row&quot;</span>;
<a name="l05080"></a>05080     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_select_row&quot;</span>;
<a name="l05081"></a>05081     
<a name="l05082"></a>05082     <span class="comment">/* api callbacks */</span>
<a name="l05083"></a>05083     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a64147a218212efee1dc0175b2d82cc55">select_row_exec</a>;
<a name="l05084"></a>05084     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac37a158e5a982429de39cdc24503a94d">ED_operator_editsurf</a>;
<a name="l05085"></a>05085 
<a name="l05086"></a>05086     <span class="comment">/* flags */</span>
<a name="l05087"></a>05087     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l05088"></a>05088 }
<a name="l05089"></a>05089 
<a name="l05090"></a>05090 <span class="comment">/***************** select next operator **********************/</span>
<a name="l05091"></a>05091 
<a name="l05092"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a3c561356acbac44fe175e2e78d62bac6">05092</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a3c561356acbac44fe175e2e78d62bac6">select_next_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l05093"></a>05093 {
<a name="l05094"></a>05094     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l05095"></a>05095     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l05096"></a>05096     
<a name="l05097"></a>05097     <a class="code" href="../../d7/d55/editcurve_8c.html#ac6fd9d82f74ba59d9463cff6c4c0f657">select_adjacent_cp</a>(editnurb, 1, 0, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>);
<a name="l05098"></a>05098     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa1eaeb409fe6a81df91467aaeb289a07">ND_SELECT</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l05099"></a>05099 
<a name="l05100"></a>05100     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l05101"></a>05101 }
<a name="l05102"></a>05102 
<a name="l05103"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a4863db43972e8247d0bbc1535c4a74ba">05103</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#aa4e57a95a6d6a7a53444100854e2dfba">CURVE_OT_select_next</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l05104"></a>05104 {
<a name="l05105"></a>05105     <span class="comment">/* identifiers */</span>
<a name="l05106"></a>05106     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select Next&quot;</span>;
<a name="l05107"></a>05107     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_select_next&quot;</span>;
<a name="l05108"></a>05108     
<a name="l05109"></a>05109     <span class="comment">/* api callbacks */</span>
<a name="l05110"></a>05110     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a3c561356acbac44fe175e2e78d62bac6">select_next_exec</a>;
<a name="l05111"></a>05111     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a443591620f4deea4cac8a4098f66d2f7">ED_operator_editcurve</a>;
<a name="l05112"></a>05112 
<a name="l05113"></a>05113     <span class="comment">/* flags */</span>
<a name="l05114"></a>05114     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l05115"></a>05115 }
<a name="l05116"></a>05116 
<a name="l05117"></a>05117 <span class="comment">/***************** select previous operator **********************/</span>
<a name="l05118"></a>05118 
<a name="l05119"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ad47da349280fd9627128073625361d24">05119</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ad47da349280fd9627128073625361d24">select_previous_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l05120"></a>05120 {
<a name="l05121"></a>05121     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l05122"></a>05122     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l05123"></a>05123     
<a name="l05124"></a>05124     <a class="code" href="../../d7/d55/editcurve_8c.html#ac6fd9d82f74ba59d9463cff6c4c0f657">select_adjacent_cp</a>(editnurb, -1, 0, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>);
<a name="l05125"></a>05125     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa1eaeb409fe6a81df91467aaeb289a07">ND_SELECT</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l05126"></a>05126 
<a name="l05127"></a>05127     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l05128"></a>05128 }
<a name="l05129"></a>05129 
<a name="l05130"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a1c862379e9b4e5cb440e554da07c1bac">05130</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a68fd123a2a615de12b6a6c53be6c2f1a">CURVE_OT_select_previous</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l05131"></a>05131 {
<a name="l05132"></a>05132     <span class="comment">/* identifiers */</span>
<a name="l05133"></a>05133     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select Previous&quot;</span>;
<a name="l05134"></a>05134     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_select_previous&quot;</span>;
<a name="l05135"></a>05135     
<a name="l05136"></a>05136     <span class="comment">/* api callbacks */</span>
<a name="l05137"></a>05137     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#ad47da349280fd9627128073625361d24">select_previous_exec</a>;
<a name="l05138"></a>05138     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a443591620f4deea4cac8a4098f66d2f7">ED_operator_editcurve</a>;
<a name="l05139"></a>05139 
<a name="l05140"></a>05140     <span class="comment">/* flags */</span>
<a name="l05141"></a>05141     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l05142"></a>05142 }
<a name="l05143"></a>05143 
<a name="l05144"></a>05144 <span class="comment">/***************** select more operator **********************/</span>
<a name="l05145"></a>05145 
<a name="l05146"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a83b98a65267c1977c62a8ec411ad53ff">05146</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a83b98a65267c1977c62a8ec411ad53ff">select_more_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l05147"></a>05147 {
<a name="l05148"></a>05148     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l05149"></a>05149     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l05150"></a>05150     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l05151"></a>05151     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp, *tempbp;
<a name="l05152"></a>05152     <span class="keywordtype">int</span> a;
<a name="l05153"></a>05153     <span class="keywordtype">short</span> sel= 0;
<a name="l05154"></a>05154     <span class="keywordtype">short</span> *selbpoints;
<a name="l05155"></a>05155     
<a name="l05156"></a>05156     <span class="comment">/* note that NURBS surface is a special case because we mimic */</span>
<a name="l05157"></a>05157     <span class="comment">/* the behavior of &quot;select more&quot; of mesh tools.       */</span>
<a name="l05158"></a>05158     <span class="comment">/* The algorithm is designed to work in planar cases so it    */</span>
<a name="l05159"></a>05159     <span class="comment">/* may not be optimal always (example: end of NURBS sphere)   */</span>
<a name="l05160"></a>05160     <span class="keywordflow">if</span> (obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>) {
<a name="l05161"></a>05161         <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l05162"></a>05162             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l05163"></a>05163             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l05164"></a>05164             selbpoints= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">short</span>)*a-nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>, <span class="stringliteral">&quot;selectlist&quot;</span>);
<a name="l05165"></a>05165             <span class="keywordflow">while</span> (a &gt; 0) {
<a name="l05166"></a>05166                 <span class="keywordflow">if</span> ((selbpoints[a]!=1) &amp;&amp; (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a>==0) &amp;&amp; (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) {
<a name="l05167"></a>05167                     <span class="comment">/* upper control point */</span>
<a name="l05168"></a>05168                     <span class="keywordflow">if</span> (a%nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> != 0) {
<a name="l05169"></a>05169                         tempbp= bp-1;
<a name="l05170"></a>05170                         <span class="keywordflow">if</span> (!(tempbp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(tempbp, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>); 
<a name="l05171"></a>05171                     }
<a name="l05172"></a>05172 
<a name="l05173"></a>05173                     <span class="comment">/* left control point. select only if it is not selected already */</span>
<a name="l05174"></a>05174                     <span class="keywordflow">if</span> (a-nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> &gt; 0) {
<a name="l05175"></a>05175                         sel= 0;
<a name="l05176"></a>05176                         tempbp= bp+nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l05177"></a>05177                         <span class="keywordflow">if</span> (!(tempbp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) sel= <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(tempbp, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>); 
<a name="l05178"></a>05178                         <span class="comment">/* make sure selected bpoint is discarded */</span>
<a name="l05179"></a>05179                         <span class="keywordflow">if</span> (sel == 1) selbpoints[a-nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>]= 1;
<a name="l05180"></a>05180                     }
<a name="l05181"></a>05181                     
<a name="l05182"></a>05182                     <span class="comment">/* right control point */</span>
<a name="l05183"></a>05183                     <span class="keywordflow">if</span> (a+nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> &lt; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>) {
<a name="l05184"></a>05184                         tempbp= bp-nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l05185"></a>05185                         <span class="keywordflow">if</span> (!(tempbp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(tempbp, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>); 
<a name="l05186"></a>05186                     }
<a name="l05187"></a>05187                 
<a name="l05188"></a>05188                     <span class="comment">/* lower control point. skip next bp in case selection was made */</span>
<a name="l05189"></a>05189                     <span class="keywordflow">if</span> (a%nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> != 1) {
<a name="l05190"></a>05190                         sel= 0;
<a name="l05191"></a>05191                         tempbp= bp+1;
<a name="l05192"></a>05192                         <span class="keywordflow">if</span> (!(tempbp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; 1)) sel= <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(tempbp, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>); 
<a name="l05193"></a>05193                         <span class="keywordflow">if</span> (sel) {
<a name="l05194"></a>05194                             bp++;   
<a name="l05195"></a>05195                             a--;
<a name="l05196"></a>05196                         }
<a name="l05197"></a>05197                     }               
<a name="l05198"></a>05198                 }
<a name="l05199"></a>05199 
<a name="l05200"></a>05200                 bp++;
<a name="l05201"></a>05201                 a--;
<a name="l05202"></a>05202             }
<a name="l05203"></a>05203             
<a name="l05204"></a>05204             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(selbpoints);
<a name="l05205"></a>05205         }
<a name="l05206"></a>05206     }
<a name="l05207"></a>05207     <span class="keywordflow">else</span> {
<a name="l05208"></a>05208         <a class="code" href="../../d7/d55/editcurve_8c.html#ac6fd9d82f74ba59d9463cff6c4c0f657">select_adjacent_cp</a>(editnurb, 1, 0, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>);
<a name="l05209"></a>05209         <a class="code" href="../../d7/d55/editcurve_8c.html#ac6fd9d82f74ba59d9463cff6c4c0f657">select_adjacent_cp</a>(editnurb, -1, 0, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>);
<a name="l05210"></a>05210     }
<a name="l05211"></a>05211         
<a name="l05212"></a>05212     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa1eaeb409fe6a81df91467aaeb289a07">ND_SELECT</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l05213"></a>05213 
<a name="l05214"></a>05214     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l05215"></a>05215 }
<a name="l05216"></a>05216 
<a name="l05217"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ab3386df3f85be18cf05597f39ce683ff">05217</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a364a599d3b6897cd68eeb3c90f2781f9">CURVE_OT_select_more</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l05218"></a>05218 {
<a name="l05219"></a>05219     <span class="comment">/* identifiers */</span>
<a name="l05220"></a>05220     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select More&quot;</span>;
<a name="l05221"></a>05221     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_select_more&quot;</span>;
<a name="l05222"></a>05222     
<a name="l05223"></a>05223     <span class="comment">/* api callbacks */</span>
<a name="l05224"></a>05224     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a83b98a65267c1977c62a8ec411ad53ff">select_more_exec</a>;
<a name="l05225"></a>05225     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l05226"></a>05226 
<a name="l05227"></a>05227     <span class="comment">/* flags */</span>
<a name="l05228"></a>05228     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l05229"></a>05229 }
<a name="l05230"></a>05230 
<a name="l05231"></a>05231 <span class="comment">/******************** select less operator *****************/</span>
<a name="l05232"></a>05232 
<a name="l05233"></a>05233 <span class="comment">/* basic method: deselect if control point doesn&#39;t have all neighbors selected */</span>
<a name="l05234"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a3b26e3477dfac76c31b10c6c06e1d6e6">05234</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a3b26e3477dfac76c31b10c6c06e1d6e6">select_less_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l05235"></a>05235 {
<a name="l05236"></a>05236     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l05237"></a>05237     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l05238"></a>05238     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l05239"></a>05239     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l05240"></a>05240     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l05241"></a>05241     <span class="keywordtype">int</span> a;
<a name="l05242"></a>05242     <span class="keywordtype">short</span> sel= 0, lastsel= 0;
<a name="l05243"></a>05243     <span class="keywordtype">short</span> *selbpoints;
<a name="l05244"></a>05244     
<a name="l05245"></a>05245     <span class="keywordflow">if</span> (obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>) {        
<a name="l05246"></a>05246         <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l05247"></a>05247             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l05248"></a>05248             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l05249"></a>05249             selbpoints= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">short</span>)*a, <span class="stringliteral">&quot;selectlist&quot;</span>);
<a name="l05250"></a>05250             <span class="keywordflow">while</span> (a--) {
<a name="l05251"></a>05251                 <span class="keywordflow">if</span> ((bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a>==0) &amp;&amp; (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) {
<a name="l05252"></a>05252                     sel= 0;
<a name="l05253"></a>05253                                     
<a name="l05254"></a>05254                     <span class="comment">/* check if neighbors have been selected */</span> 
<a name="l05255"></a>05255                     <span class="comment">/* edges of surface are an exception */</span> 
<a name="l05256"></a>05256                     <span class="keywordflow">if</span> ((a+1)%nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>==0) sel++;  
<a name="l05257"></a>05257                     <span class="keywordflow">else</span> {
<a name="l05258"></a>05258                         bp--;
<a name="l05259"></a>05259                         <span class="keywordflow">if</span> ((selbpoints[a+1]==1) || ((bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a>==0) &amp;&amp; (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>))) sel++;
<a name="l05260"></a>05260                         bp++;
<a name="l05261"></a>05261                     }
<a name="l05262"></a>05262                     
<a name="l05263"></a>05263                     <span class="keywordflow">if</span> ((a+1)%nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>==1) sel++;
<a name="l05264"></a>05264                     <span class="keywordflow">else</span> {
<a name="l05265"></a>05265                         bp++;
<a name="l05266"></a>05266                         <span class="keywordflow">if</span> ((bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a>==0) &amp;&amp; (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) sel++;
<a name="l05267"></a>05267                         bp--;
<a name="l05268"></a>05268                     }
<a name="l05269"></a>05269                     
<a name="l05270"></a>05270                     <span class="keywordflow">if</span> (a+1 &gt; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>-nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) sel++;
<a name="l05271"></a>05271                     <span class="keywordflow">else</span> {
<a name="l05272"></a>05272                         bp-=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l05273"></a>05273                         <span class="keywordflow">if</span> ((selbpoints[a+nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>]==1) || ((bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a>==0) &amp;&amp; (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>))) sel++;
<a name="l05274"></a>05274                         bp+=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l05275"></a>05275                     }
<a name="l05276"></a>05276                                     
<a name="l05277"></a>05277                     <span class="keywordflow">if</span> (a &lt; nu-&gt;pntsu) sel++;
<a name="l05278"></a>05278                     <span class="keywordflow">else</span> {
<a name="l05279"></a>05279                         bp+=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l05280"></a>05280                         <span class="keywordflow">if</span> ((bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a>==0) &amp;&amp; (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) sel++;
<a name="l05281"></a>05281                         bp-=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l05282"></a>05282                     }
<a name="l05283"></a>05283                                                     
<a name="l05284"></a>05284                     <span class="keywordflow">if</span> (sel!=4) {
<a name="l05285"></a>05285                         <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>); 
<a name="l05286"></a>05286                         selbpoints[a]= 1;                                               
<a name="l05287"></a>05287                     }                                   
<a name="l05288"></a>05288                 }
<a name="l05289"></a>05289                 <span class="keywordflow">else</span> lastsel= 0;
<a name="l05290"></a>05290                     
<a name="l05291"></a>05291                 bp++;
<a name="l05292"></a>05292             }
<a name="l05293"></a>05293             
<a name="l05294"></a>05294             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(selbpoints);
<a name="l05295"></a>05295         }
<a name="l05296"></a>05296     }
<a name="l05297"></a>05297     <span class="keywordflow">else</span> {
<a name="l05298"></a>05298         <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l05299"></a>05299             lastsel=0;
<a name="l05300"></a>05300             <span class="comment">/* check what type of curve/nurb it is */</span>
<a name="l05301"></a>05301             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {            
<a name="l05302"></a>05302                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l05303"></a>05303                 bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l05304"></a>05304                 <span class="keywordflow">while</span> (a--) {
<a name="l05305"></a>05305                     <span class="keywordflow">if</span> ((bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aaac89168848f34909c578acb0d6cca26">hide</a>==0) &amp;&amp; (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) {
<a name="l05306"></a>05306                         <span class="keywordflow">if</span> (lastsel==1) sel= 1;
<a name="l05307"></a>05307                         <span class="keywordflow">else</span> sel= 0;
<a name="l05308"></a>05308                                                 
<a name="l05309"></a>05309                         <span class="comment">/* check if neighbors have been selected */</span>                     
<a name="l05310"></a>05310                         <span class="comment">/* first and last are exceptions */</span>                 
<a name="l05311"></a>05311                         <span class="keywordflow">if</span> (a==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1) sel++; 
<a name="l05312"></a>05312                         <span class="keywordflow">else</span> { 
<a name="l05313"></a>05313                             bezt--;
<a name="l05314"></a>05314                             <span class="keywordflow">if</span> ((bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aaac89168848f34909c578acb0d6cca26">hide</a>==0) &amp;&amp; (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) sel++;
<a name="l05315"></a>05315                             bezt++;
<a name="l05316"></a>05316                         }
<a name="l05317"></a>05317                         
<a name="l05318"></a>05318                         <span class="keywordflow">if</span> (a==0) sel++;
<a name="l05319"></a>05319                         <span class="keywordflow">else</span> {
<a name="l05320"></a>05320                             bezt++;
<a name="l05321"></a>05321                             <span class="keywordflow">if</span> ((bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aaac89168848f34909c578acb0d6cca26">hide</a>==0) &amp;&amp; (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) sel++;
<a name="l05322"></a>05322                             bezt--;
<a name="l05323"></a>05323                         }
<a name="l05324"></a>05324 
<a name="l05325"></a>05325                         <span class="keywordflow">if</span> (sel!=2) {
<a name="l05326"></a>05326                             <a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">select_beztriple</a>(bezt, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>);   
<a name="l05327"></a>05327                             lastsel= 1;
<a name="l05328"></a>05328                         }
<a name="l05329"></a>05329                         <span class="keywordflow">else</span> lastsel= 0;
<a name="l05330"></a>05330                     }
<a name="l05331"></a>05331                     <span class="keywordflow">else</span> lastsel= 0;
<a name="l05332"></a>05332                         
<a name="l05333"></a>05333                     bezt++; 
<a name="l05334"></a>05334                 }
<a name="l05335"></a>05335             }
<a name="l05336"></a>05336             <span class="keywordflow">else</span> {
<a name="l05337"></a>05337                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l05338"></a>05338                 bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l05339"></a>05339                 <span class="keywordflow">while</span> (a--) {
<a name="l05340"></a>05340                     <span class="keywordflow">if</span> ((lastsel==0) &amp;&amp; (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a>==0) &amp;&amp; (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) {
<a name="l05341"></a>05341                         <span class="keywordflow">if</span> (lastsel!=0) sel= 1;
<a name="l05342"></a>05342                         <span class="keywordflow">else</span> sel= 0;
<a name="l05343"></a>05343                         
<a name="l05344"></a>05344                         <span class="comment">/* first and last are exceptions */</span>                 
<a name="l05345"></a>05345                         <span class="keywordflow">if</span> (a==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>-1) sel++; 
<a name="l05346"></a>05346                         <span class="keywordflow">else</span> { 
<a name="l05347"></a>05347                             bp--;
<a name="l05348"></a>05348                             <span class="keywordflow">if</span> ((bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a>==0) &amp;&amp; (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) sel++;
<a name="l05349"></a>05349                             bp++;
<a name="l05350"></a>05350                         }
<a name="l05351"></a>05351                         
<a name="l05352"></a>05352                         <span class="keywordflow">if</span> (a==0) sel++;
<a name="l05353"></a>05353                         <span class="keywordflow">else</span> {
<a name="l05354"></a>05354                             bp++;
<a name="l05355"></a>05355                             <span class="keywordflow">if</span> ((bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a0ddb96e887d692d112fb415e00666318">hide</a>==0) &amp;&amp; (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) sel++;
<a name="l05356"></a>05356                             bp--;
<a name="l05357"></a>05357                         }
<a name="l05358"></a>05358                                             
<a name="l05359"></a>05359                         <span class="keywordflow">if</span> (sel!=2) {
<a name="l05360"></a>05360                             <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>);    
<a name="l05361"></a>05361                             lastsel= 1;                     
<a name="l05362"></a>05362                         }               
<a name="l05363"></a>05363                         <span class="keywordflow">else</span> lastsel= 0;                    
<a name="l05364"></a>05364                     }
<a name="l05365"></a>05365                     <span class="keywordflow">else</span> lastsel= 0;
<a name="l05366"></a>05366                         
<a name="l05367"></a>05367                     bp++;
<a name="l05368"></a>05368                 }
<a name="l05369"></a>05369             }
<a name="l05370"></a>05370         }
<a name="l05371"></a>05371     }
<a name="l05372"></a>05372     
<a name="l05373"></a>05373     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa1eaeb409fe6a81df91467aaeb289a07">ND_SELECT</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l05374"></a>05374 
<a name="l05375"></a>05375     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l05376"></a>05376 }
<a name="l05377"></a>05377 
<a name="l05378"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a0a2c262e1b6257bced21766dd305ed3c">05378</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#ab5cd33f19169b1f608ad1ad5332a46b9">CURVE_OT_select_less</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l05379"></a>05379 {
<a name="l05380"></a>05380     <span class="comment">/* identifiers */</span>
<a name="l05381"></a>05381     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select Less&quot;</span>;
<a name="l05382"></a>05382     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_select_less&quot;</span>;
<a name="l05383"></a>05383     
<a name="l05384"></a>05384     <span class="comment">/* api callbacks */</span>
<a name="l05385"></a>05385     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a3b26e3477dfac76c31b10c6c06e1d6e6">select_less_exec</a>;
<a name="l05386"></a>05386     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l05387"></a>05387 
<a name="l05388"></a>05388     <span class="comment">/* flags */</span>
<a name="l05389"></a>05389     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l05390"></a>05390 }
<a name="l05391"></a>05391 
<a name="l05392"></a>05392 <span class="comment">/********************** select random *********************/</span>
<a name="l05393"></a>05393 
<a name="l05394"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a5644bc483c891b6fa1b34c9306bfe4ad">05394</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a5644bc483c891b6fa1b34c9306bfe4ad">selectrandom_curve</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb, <span class="keywordtype">float</span> randfac)
<a name="l05395"></a>05395 {
<a name="l05396"></a>05396     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l05397"></a>05397     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l05398"></a>05398     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l05399"></a>05399     <span class="keywordtype">int</span> a;
<a name="l05400"></a>05400     
<a name="l05401"></a>05401     <a class="code" href="../../d3/d88/BLI__rand_8h.html#a60a4a9e4b37c435f7f7a122c001f7e74">BLI_srand</a>( <a class="code" href="../../d3/d88/BLI__rand_8h.html#aed3a0fd477063acc5f19de297b4c4bec">BLI_rand</a>() ); <span class="comment">/* random seed */</span>
<a name="l05402"></a>05402     
<a name="l05403"></a>05403     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {   
<a name="l05404"></a>05404         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l05405"></a>05405             bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l05406"></a>05406             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l05407"></a>05407             <span class="keywordflow">while</span> (a--) {
<a name="l05408"></a>05408                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d88/BLI__rand_8h.html#a28a49a5f3f27a0875de8142fdcab7bd2">BLI_frand</a>() &lt; randfac)
<a name="l05409"></a>05409                     <a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">select_beztriple</a>(bezt, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>);
<a name="l05410"></a>05410                 bezt++;
<a name="l05411"></a>05411             }
<a name="l05412"></a>05412         }
<a name="l05413"></a>05413         <span class="keywordflow">else</span> {
<a name="l05414"></a>05414             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l05415"></a>05415             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l05416"></a>05416             
<a name="l05417"></a>05417             <span class="keywordflow">while</span> (a--) {
<a name="l05418"></a>05418                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d88/BLI__rand_8h.html#a28a49a5f3f27a0875de8142fdcab7bd2">BLI_frand</a>() &lt; randfac)
<a name="l05419"></a>05419                     <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#aff75e2cc4508bdd299a60047eda5888e">VISIBLE</a>); 
<a name="l05420"></a>05420                 bp++;
<a name="l05421"></a>05421             }
<a name="l05422"></a>05422         }       
<a name="l05423"></a>05423     }
<a name="l05424"></a>05424 }
<a name="l05425"></a>05425 
<a name="l05426"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a0ad3dad58c251112be7033f0b02423dc">05426</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a0ad3dad58c251112be7033f0b02423dc">select_random_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l05427"></a>05427 {
<a name="l05428"></a>05428     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l05429"></a>05429     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l05430"></a>05430 
<a name="l05431"></a>05431     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;extend&quot;</span>))
<a name="l05432"></a>05432         <a class="code" href="../../d7/d55/editcurve_8c.html#a7472517908a5b478e86461d147d169e9">CU_deselect_all</a>(obedit);
<a name="l05433"></a>05433     
<a name="l05434"></a>05434     <a class="code" href="../../d7/d55/editcurve_8c.html#a5644bc483c891b6fa1b34c9306bfe4ad">selectrandom_curve</a>(editnurb, <a class="code" href="../../d3/d10/rna__access_8c.html#a99bfb3295a4df6fef29f16924fd24c79">RNA_float_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;percent&quot;</span>)/100.0f);
<a name="l05435"></a>05435     
<a name="l05436"></a>05436     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa1eaeb409fe6a81df91467aaeb289a07">ND_SELECT</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l05437"></a>05437     
<a name="l05438"></a>05438     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l05439"></a>05439 }
<a name="l05440"></a>05440 
<a name="l05441"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a0083183bc742d2e31f4190641044872a">05441</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a201c283a6b724838c33742b917de0ab1">CURVE_OT_select_random</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l05442"></a>05442 {
<a name="l05443"></a>05443     <span class="comment">/* identifiers */</span>
<a name="l05444"></a>05444     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select Random&quot;</span>;
<a name="l05445"></a>05445     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_select_random&quot;</span>;
<a name="l05446"></a>05446     
<a name="l05447"></a>05447     <span class="comment">/* api callbacks */</span>
<a name="l05448"></a>05448     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a0ad3dad58c251112be7033f0b02423dc">select_random_exec</a>;
<a name="l05449"></a>05449     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l05450"></a>05450 
<a name="l05451"></a>05451     <span class="comment">/* flags */</span>
<a name="l05452"></a>05452     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l05453"></a>05453 
<a name="l05454"></a>05454     <span class="comment">/* properties */</span>
<a name="l05455"></a>05455     <a class="code" href="../../dc/d7e/rna__define_8c.html#a8e5fcbcf969e10621649d1c563ef0b9e">RNA_def_float_percentage</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;percent&quot;</span>, 50.f, 0.0f, 100.0f, <span class="stringliteral">&quot;Percent&quot;</span>, <span class="stringliteral">&quot;Percentage of elements to select randomly&quot;</span>, 0.f, 100.0f);
<a name="l05456"></a>05456     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;extend&quot;</span>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <span class="stringliteral">&quot;Extend Selection&quot;</span>, <span class="stringliteral">&quot;Extend selection instead of deselecting everything first&quot;</span>);
<a name="l05457"></a>05457 }
<a name="l05458"></a>05458 
<a name="l05459"></a>05459 <span class="comment">/********************* every nth number of point *******************/</span>
<a name="l05460"></a>05460 
<a name="l05461"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ab0d92a9cdd1561834779dfe414f3c4d9">05461</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ab0d92a9cdd1561834779dfe414f3c4d9">point_on_nurb</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>, <span class="keywordtype">void</span> *<a class="code" href="../../d8/dae/structpoint.html">point</a>)
<a name="l05462"></a>05462 {
<a name="l05463"></a>05463     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l05464"></a>05464         <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt= (<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>*)point;
<a name="l05465"></a>05465         <span class="keywordflow">return</span> bezt &gt;= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a> &amp;&amp; bezt &lt; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a> + nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l05466"></a>05466     }
<a name="l05467"></a>05467     <span class="keywordflow">else</span> {
<a name="l05468"></a>05468         <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp= (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*)point;
<a name="l05469"></a>05469         <span class="keywordflow">return</span> bp &gt;= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> &amp;&amp; bp &lt; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> + nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> * nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l05470"></a>05470     }
<a name="l05471"></a>05471 }
<a name="l05472"></a>05472 
<a name="l05473"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a4d53eaf84cb17e7bc0ae8030e11d9cd7">05473</a> <span class="keyword">static</span> <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d7/d55/editcurve_8c.html#a4d53eaf84cb17e7bc0ae8030e11d9cd7">get_lastsel_nurb</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu)
<a name="l05474"></a>05474 {
<a name="l05475"></a>05475     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nubase= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a444d55e9e251234b0c8e22da36a06819">curve_editnurbs</a>(cu);
<a name="l05476"></a>05476     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>= nubase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05477"></a>05477 
<a name="l05478"></a>05478     <span class="keywordflow">if</span> (!cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>)
<a name="l05479"></a>05479         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05480"></a>05480 
<a name="l05481"></a>05481     <span class="keywordflow">while</span> (nu) {
<a name="l05482"></a>05482         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#ab0d92a9cdd1561834779dfe414f3c4d9">point_on_nurb</a>(nu, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>))
<a name="l05483"></a>05483             <span class="keywordflow">return</span> <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l05484"></a>05484 
<a name="l05485"></a>05485         nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l05486"></a>05486     }
<a name="l05487"></a>05487 
<a name="l05488"></a>05488     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05489"></a>05489 }
<a name="l05490"></a>05490 
<a name="l05491"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ac68c600251000968cb02117d1edf8808">05491</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ac68c600251000968cb02117d1edf8808">select_nth_bezt</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt, <span class="keywordtype">int</span> nth)
<a name="l05492"></a>05492 {
<a name="l05493"></a>05493     <span class="keywordtype">int</span> a, start;
<a name="l05494"></a>05494 
<a name="l05495"></a>05495     start= bezt - nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l05496"></a>05496     a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l05497"></a>05497     bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a> + a - 1;
<a name="l05498"></a>05498 
<a name="l05499"></a>05499     <span class="keywordflow">while</span> (a--) {
<a name="l05500"></a>05500         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>(start - a) % nth) {
<a name="l05501"></a>05501             <a class="code" href="../../d7/d55/editcurve_8c.html#a92b66b82c31b3d6523aa757de52ff8a7">select_beztriple</a>(bezt, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l05502"></a>05502         }
<a name="l05503"></a>05503 
<a name="l05504"></a>05504         bezt--;
<a name="l05505"></a>05505     }
<a name="l05506"></a>05506 }
<a name="l05507"></a>05507 
<a name="l05508"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a8a07f13774cb2c23e8d82228ebde077d">05508</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a8a07f13774cb2c23e8d82228ebde077d">select_nth_bp</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>, <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp, <span class="keywordtype">int</span> nth)
<a name="l05509"></a>05509 {
<a name="l05510"></a>05510     <span class="keywordtype">int</span> a, startrow, startpnt;
<a name="l05511"></a>05511     <span class="keywordtype">int</span> dist, row, pnt;
<a name="l05512"></a>05512 
<a name="l05513"></a>05513     startrow= (bp - nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>) / nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l05514"></a>05514     startpnt= (bp - nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>) % nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l05515"></a>05515 
<a name="l05516"></a>05516     a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> * nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l05517"></a>05517     bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> + a - 1;
<a name="l05518"></a>05518     row = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> - 1;
<a name="l05519"></a>05519     pnt = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> - 1;
<a name="l05520"></a>05520 
<a name="l05521"></a>05521     <span class="keywordflow">while</span> (a--) {
<a name="l05522"></a>05522         dist= <a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>(pnt - startpnt) + <a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>(row - startrow);
<a name="l05523"></a>05523         <span class="keywordflow">if</span> (dist % nth) {
<a name="l05524"></a>05524             <a class="code" href="../../d7/d55/editcurve_8c.html#a0f946d63c94cfa6e6dc3420afde0f4eb">select_bpoint</a>(bp, <a class="code" href="../../d2/d7d/ED__types_8h.html#a03af10a53bc23eafac982c5ff650184e">DESELECT</a>, 1, <a class="code" href="../../d7/d55/editcurve_8c.html#ab42ef41116f8f2fe447484e2844cf0df">HIDDEN</a>);
<a name="l05525"></a>05525         }
<a name="l05526"></a>05526 
<a name="l05527"></a>05527         pnt--;
<a name="l05528"></a>05528         <span class="keywordflow">if</span> (pnt &lt; 0) {
<a name="l05529"></a>05529             pnt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> - 1;
<a name="l05530"></a>05530             row--;
<a name="l05531"></a>05531         }
<a name="l05532"></a>05532 
<a name="l05533"></a>05533         bp--;
<a name="l05534"></a>05534     }
<a name="l05535"></a>05535 }
<a name="l05536"></a>05536 
<a name="l05537"></a><a class="code" href="../../db/d71/ED__curve_8h.html#a373a3056135f099b5d26bf943b7b2af4">05537</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#adf1f18a5c1db5e3cf5c949bc5da7355a">CU_select_nth</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *obedit, <span class="keywordtype">int</span> nth)
<a name="l05538"></a>05538 {
<a name="l05539"></a>05539     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= (<a class="code" href="../../da/d10/structCurve.html">Curve</a>*)obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l05540"></a>05540     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l05541"></a>05541 
<a name="l05542"></a>05542     <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>= <a class="code" href="../../d7/d55/editcurve_8c.html#a4d53eaf84cb17e7bc0ae8030e11d9cd7">get_lastsel_nurb</a>(cu);
<a name="l05543"></a>05543     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>)
<a name="l05544"></a>05544         <span class="keywordflow">return</span> 0;
<a name="l05545"></a>05545 
<a name="l05546"></a>05546     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l05547"></a>05547         <a class="code" href="../../d7/d55/editcurve_8c.html#ac68c600251000968cb02117d1edf8808">select_nth_bezt</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>, nth);
<a name="l05548"></a>05548     }
<a name="l05549"></a>05549     <span class="keywordflow">else</span> {
<a name="l05550"></a>05550         <a class="code" href="../../d7/d55/editcurve_8c.html#a8a07f13774cb2c23e8d82228ebde077d">select_nth_bp</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>, nth);
<a name="l05551"></a>05551     }
<a name="l05552"></a>05552 
<a name="l05553"></a>05553     <span class="keywordflow">return</span> 1;
<a name="l05554"></a>05554 }
<a name="l05555"></a>05555 
<a name="l05556"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a7f0aa67e0f3aeb8a8a582e2f190f5397">05556</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a7f0aa67e0f3aeb8a8a582e2f190f5397">select_nth_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l05557"></a>05557 {
<a name="l05558"></a>05558     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l05559"></a>05559     <span class="keywordtype">int</span> nth= <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;nth&quot;</span>);
<a name="l05560"></a>05560 
<a name="l05561"></a>05561     <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d55/editcurve_8c.html#adf1f18a5c1db5e3cf5c949bc5da7355a">CU_select_nth</a>(obedit, nth)) {
<a name="l05562"></a>05562         <span class="keywordflow">if</span> (obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>) {
<a name="l05563"></a>05563             <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Surface hasn&#39;t got active point&quot;</span>);
<a name="l05564"></a>05564         }
<a name="l05565"></a>05565         <span class="keywordflow">else</span> {
<a name="l05566"></a>05566             <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Curve hasn&#39;t got active point&quot;</span>);
<a name="l05567"></a>05567         }
<a name="l05568"></a>05568 
<a name="l05569"></a>05569         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l05570"></a>05570     }
<a name="l05571"></a>05571 
<a name="l05572"></a>05572     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa1eaeb409fe6a81df91467aaeb289a07">ND_SELECT</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l05573"></a>05573 
<a name="l05574"></a>05574     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l05575"></a>05575 }
<a name="l05576"></a>05576 
<a name="l05577"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a99876333bc420a8f4afe92585349ca26">05577</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a058b4259448ba4eee20f11abc37fed6a">CURVE_OT_select_nth</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l05578"></a>05578 {
<a name="l05579"></a>05579     <span class="comment">/* identifiers */</span>
<a name="l05580"></a>05580     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Select Nth&quot;</span>;
<a name="l05581"></a>05581     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l05582"></a>05582     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_select_nth&quot;</span>;
<a name="l05583"></a>05583 
<a name="l05584"></a>05584     <span class="comment">/* api callbacks */</span>
<a name="l05585"></a>05585     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a7f0aa67e0f3aeb8a8a582e2f190f5397">select_nth_exec</a>;
<a name="l05586"></a>05586     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l05587"></a>05587 
<a name="l05588"></a>05588     <span class="comment">/* flags */</span>
<a name="l05589"></a>05589     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l05590"></a>05590 
<a name="l05591"></a>05591     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;nth&quot;</span>, 2, 2, 100, <span class="stringliteral">&quot;Nth Selection&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 1, INT_MAX);
<a name="l05592"></a>05592 }
<a name="l05593"></a>05593 
<a name="l05594"></a>05594 <span class="comment">/********************** add duplicate operator *********************/</span>
<a name="l05595"></a>05595 
<a name="l05596"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a87d0ebd12fbc7d0ce16107b8d914f541">05596</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a87d0ebd12fbc7d0ce16107b8d914f541">duplicate_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l05597"></a>05597 {
<a name="l05598"></a>05598     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l05599"></a>05599 
<a name="l05600"></a>05600     <a class="code" href="../../d7/d55/editcurve_8c.html#a5bae7805aef4ea3a09d29afb0a300b93">adduplicateflagNurb</a>(obedit, 1);
<a name="l05601"></a>05601     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aa1eaeb409fe6a81df91467aaeb289a07">ND_SELECT</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l05602"></a>05602 
<a name="l05603"></a>05603     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l05604"></a>05604 }
<a name="l05605"></a>05605 
<a name="l05606"></a><a class="code" href="../../d7/d55/editcurve_8c.html#abf0f4736d822163285ca4949de5b4733">05606</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#ab72704305a447beb831628ebe89d8d4f">CURVE_OT_duplicate</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l05607"></a>05607 {
<a name="l05608"></a>05608     <span class="comment">/* identifiers */</span>
<a name="l05609"></a>05609     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Duplicate Curve&quot;</span>;
<a name="l05610"></a>05610     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Duplicate selected control points and segments between them&quot;</span>;
<a name="l05611"></a>05611     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_duplicate&quot;</span>;
<a name="l05612"></a>05612     
<a name="l05613"></a>05613     <span class="comment">/* api callbacks */</span>
<a name="l05614"></a>05614     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a87d0ebd12fbc7d0ce16107b8d914f541">duplicate_exec</a>;
<a name="l05615"></a>05615     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l05616"></a>05616     
<a name="l05617"></a>05617     <span class="comment">/* flags */</span>
<a name="l05618"></a>05618     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l05619"></a>05619 }
<a name="l05620"></a>05620 
<a name="l05621"></a>05621 <span class="comment">/********************** delete operator *********************/</span>
<a name="l05622"></a>05622 
<a name="l05623"></a><a class="code" href="../../d7/d55/editcurve_8c.html#abd29fe9367d0898d28992c9dd72aec91">05623</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#abd29fe9367d0898d28992c9dd72aec91">delete_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l05624"></a>05624 {
<a name="l05625"></a>05625     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l05626"></a>05626     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l05627"></a>05627     <a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>;
<a name="l05628"></a>05628     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nubase= &amp;editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>;
<a name="l05629"></a>05629     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>, *nu1;
<a name="l05630"></a>05630     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt, *bezt1, *bezt2;
<a name="l05631"></a>05631     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp, *bp1, *bp2;
<a name="l05632"></a>05632     <span class="keywordtype">int</span> a, cut= 0, type= <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;type&quot;</span>);
<a name="l05633"></a>05633     <span class="keywordtype">int</span> nuindex= 0;
<a name="l05634"></a>05634 
<a name="l05635"></a>05635     <span class="keywordflow">if</span> (obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>) {
<a name="l05636"></a>05636         <span class="keywordflow">if</span> (type==0) {
<a name="l05637"></a>05637             <a class="code" href="../../d7/d55/editcurve_8c.html#a623d8d8399666a4e5f06ab4cdbc30662">deleteflagNurb</a>(C, op, 1);
<a name="l05638"></a>05638         }
<a name="l05639"></a>05639         <span class="keywordflow">else</span> {
<a name="l05640"></a>05640             <a class="code" href="../../d7/d55/editcurve_8c.html#ab4cb02a70a93298743ac8b297d4e225d">keyIndex_delNurbList</a>(editnurb, nubase);
<a name="l05641"></a>05641             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aa7e3a2bafad6c23e082515885ae5294a">freeNurblist</a>(nubase);
<a name="l05642"></a>05642 
<a name="l05643"></a>05643             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a1a79334fb2fbb2d4951b7196c64a9edb">ED_curve_updateAnimPaths</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>))
<a name="l05644"></a>05644                 <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ab2ab88214d816c47ebee1a985b0e68b3">ND_KEYS</a>, obedit);
<a name="l05645"></a>05645         }
<a name="l05646"></a>05646 
<a name="l05647"></a>05647         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l05648"></a>05648         <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l05649"></a>05649     
<a name="l05650"></a>05650         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l05651"></a>05651     }
<a name="l05652"></a>05652 
<a name="l05653"></a>05653     <span class="keywordflow">if</span> (type==0) {
<a name="l05654"></a>05654         <span class="comment">/* first loop, can we remove entire pieces? */</span>
<a name="l05655"></a>05655         <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l05656"></a>05656         nu= nubase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05657"></a>05657         <span class="keywordflow">while</span> (nu) {
<a name="l05658"></a>05658             next= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l05659"></a>05659             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l05660"></a>05660                 bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l05661"></a>05661                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l05662"></a>05662                 <span class="keywordflow">if</span> (a) {
<a name="l05663"></a>05663                     <span class="keywordflow">while</span> (a) {
<a name="l05664"></a>05664                         <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abcf63d093f344e298763ce019f0a1cb1">BEZSELECTED_HIDDENHANDLES</a>(cu, bezt) );
<a name="l05665"></a>05665                         <span class="keywordflow">else</span> <span class="keywordflow">break</span>;
<a name="l05666"></a>05666                         a--;
<a name="l05667"></a>05667                         bezt++;
<a name="l05668"></a>05668                     }
<a name="l05669"></a>05669                     <span class="keywordflow">if</span> (a==0) {
<a name="l05670"></a>05670                         <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5fc2001ce6a5bcf7d4f102f15d9edb2f">actnu</a> == nuindex)
<a name="l05671"></a>05671                             cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5fc2001ce6a5bcf7d4f102f15d9edb2f">actnu</a>= -1;
<a name="l05672"></a>05672 
<a name="l05673"></a>05673                         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(nubase, nu);
<a name="l05674"></a>05674                         <a class="code" href="../../d7/d55/editcurve_8c.html#af7adf69fe907e412354b5f0ed2f7f754">keyIndex_delNurb</a>(editnurb, nu);
<a name="l05675"></a>05675                         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a612d0057fcc6d1a836444e79a539a749">freeNurb</a>(nu); nu= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05676"></a>05676                     }
<a name="l05677"></a>05677                 }
<a name="l05678"></a>05678             }
<a name="l05679"></a>05679             <span class="keywordflow">else</span> {
<a name="l05680"></a>05680                 bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l05681"></a>05681                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l05682"></a>05682                 <span class="keywordflow">if</span> (a) {
<a name="l05683"></a>05683                     <span class="keywordflow">while</span> (a) {
<a name="l05684"></a>05684                         <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>);
<a name="l05685"></a>05685                         <span class="keywordflow">else</span> <span class="keywordflow">break</span>;
<a name="l05686"></a>05686                         a--;
<a name="l05687"></a>05687                         bp++;
<a name="l05688"></a>05688                     }
<a name="l05689"></a>05689                     <span class="keywordflow">if</span> (a==0) {
<a name="l05690"></a>05690                         <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5fc2001ce6a5bcf7d4f102f15d9edb2f">actnu</a> == nuindex)
<a name="l05691"></a>05691                             cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5fc2001ce6a5bcf7d4f102f15d9edb2f">actnu</a>= -1;
<a name="l05692"></a>05692 
<a name="l05693"></a>05693                         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(nubase, nu);
<a name="l05694"></a>05694                         <a class="code" href="../../d7/d55/editcurve_8c.html#af7adf69fe907e412354b5f0ed2f7f754">keyIndex_delNurb</a>(editnurb, nu);
<a name="l05695"></a>05695                         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a612d0057fcc6d1a836444e79a539a749">freeNurb</a>(nu); nu= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05696"></a>05696                     }
<a name="l05697"></a>05697                 }
<a name="l05698"></a>05698             }
<a name="l05699"></a>05699             
<a name="l05700"></a>05700             <span class="comment">/* Never allow the order to exceed the number of points</span>
<a name="l05701"></a>05701 <span class="comment">             * - note, this is ok but changes unselected nurbs, disable for now */</span>
<a name="l05702"></a>05702 <span class="preprocessor">#if 0</span>
<a name="l05703"></a>05703 <span class="preprocessor"></span>            <span class="keywordflow">if</span> ((nu!= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>)) {
<a name="l05704"></a>05704                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a4a1a66ab8e36c2a154f603635120f975">clamp_nurb_order_u</a>(nu);
<a name="l05705"></a>05705             }
<a name="l05706"></a>05706 <span class="preprocessor">#endif</span>
<a name="l05707"></a>05707 <span class="preprocessor"></span>            nu= <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l05708"></a>05708             nuindex++;
<a name="l05709"></a>05709         }
<a name="l05710"></a>05710         <span class="comment">/* 2nd loop, delete small pieces: just for curves */</span>
<a name="l05711"></a>05711         nu= nubase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l05712"></a>05712         <span class="keywordflow">while</span> (nu) {
<a name="l05713"></a>05713             next= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l05714"></a>05714             type= 0;
<a name="l05715"></a>05715             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l05716"></a>05716                 <span class="keywordtype">int</span> delta= 0;
<a name="l05717"></a>05717                 bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l05718"></a>05718                 <span class="keywordflow">for</span> (a=0;a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;a++) {
<a name="l05719"></a>05719                     <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abcf63d093f344e298763ce019f0a1cb1">BEZSELECTED_HIDDENHANDLES</a>(cu, bezt) ) {
<a name="l05720"></a>05720                         memmove(bezt, bezt+1, (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-a-1)*<span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>));
<a name="l05721"></a>05721                         <a class="code" href="../../d7/d55/editcurve_8c.html#af827430e63b199c1eef39c94c42acbf6">keyIndex_delBezt</a>(editnurb, bezt + delta);
<a name="l05722"></a>05722                         <a class="code" href="../../d7/d55/editcurve_8c.html#a32de29ccf344b5d4d324c8eb05212925">keyIndex_updateBezt</a>(editnurb, bezt + 1, bezt, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-a-1);
<a name="l05723"></a>05723                         nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>--;
<a name="l05724"></a>05724                         a--;
<a name="l05725"></a>05725                         type= 1;
<a name="l05726"></a>05726                         delta++;
<a name="l05727"></a>05727                     }
<a name="l05728"></a>05728                     <span class="keywordflow">else</span> bezt++;
<a name="l05729"></a>05729                 }
<a name="l05730"></a>05730                 <span class="keywordflow">if</span> (type) {
<a name="l05731"></a>05731                     bezt1 =
<a name="l05732"></a>05732                         (<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>((nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aafa4ace0bba7528ab007eabe81cbfc10">BezTriple</a>), <span class="stringliteral">&quot;delNurb&quot;</span>);
<a name="l05733"></a>05733                     memcpy(bezt1, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>, (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>)*<span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>) );
<a name="l05734"></a>05734                     <a class="code" href="../../d7/d55/editcurve_8c.html#a32de29ccf344b5d4d324c8eb05212925">keyIndex_updateBezt</a>(editnurb, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>, bezt1, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>);
<a name="l05735"></a>05735                     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>);
<a name="l05736"></a>05736                     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>= bezt1;
<a name="l05737"></a>05737                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(nu);
<a name="l05738"></a>05738                 }
<a name="l05739"></a>05739             }
<a name="l05740"></a>05740             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>==1) {
<a name="l05741"></a>05741                 <span class="keywordtype">int</span> delta= 0;
<a name="l05742"></a>05742                 bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l05743"></a>05743                 
<a name="l05744"></a>05744                 <span class="keywordflow">for</span> (a=0;a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;a++) {
<a name="l05745"></a>05745                     <span class="keywordflow">if</span> ( bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a> ) {
<a name="l05746"></a>05746                         memmove(bp, bp+1, (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-a-1)*<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>));
<a name="l05747"></a>05747                         <a class="code" href="../../d7/d55/editcurve_8c.html#aec85603d62905f44b470b68e5d6a097e">keyIndex_delBP</a>(editnurb, bp + delta);
<a name="l05748"></a>05748                         <a class="code" href="../../d7/d55/editcurve_8c.html#a0233d7e5f22fabe021f3902c3127dafc">keyIndex_updateBP</a>(editnurb, bp+1, bp, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-a-1);
<a name="l05749"></a>05749                         nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>--;
<a name="l05750"></a>05750                         a--;
<a name="l05751"></a>05751                         type= 1;
<a name="l05752"></a>05752                         delta++;
<a name="l05753"></a>05753                     }
<a name="l05754"></a>05754                     <span class="keywordflow">else</span> {
<a name="l05755"></a>05755                         bp++;
<a name="l05756"></a>05756                     }
<a name="l05757"></a>05757                 }
<a name="l05758"></a>05758                 <span class="keywordflow">if</span> (type) {
<a name="l05759"></a>05759                     bp1 = (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>), <span class="stringliteral">&quot;delNurb2&quot;</span>);
<a name="l05760"></a>05760                     memcpy(bp1, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>)*<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>) );
<a name="l05761"></a>05761                     <a class="code" href="../../d7/d55/editcurve_8c.html#a0233d7e5f22fabe021f3902c3127dafc">keyIndex_updateBP</a>(editnurb, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, bp1, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>);
<a name="l05762"></a>05762                     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l05763"></a>05763                     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= bp1;
<a name="l05764"></a>05764                     
<a name="l05765"></a>05765                     <span class="comment">/* Never allow the order to exceed the number of points</span>
<a name="l05766"></a>05766 <span class="comment">                     * - note, this is ok but changes unselected nurbs, disable for now */</span>
<a name="l05767"></a>05767 <span class="preprocessor">#if 0</span>
<a name="l05768"></a>05768 <span class="preprocessor"></span>                    <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l05769"></a>05769                         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a4a1a66ab8e36c2a154f603635120f975">clamp_nurb_order_u</a>(nu);
<a name="l05770"></a>05770                     }
<a name="l05771"></a>05771 <span class="preprocessor">#endif</span>
<a name="l05772"></a>05772 <span class="preprocessor"></span>                }
<a name="l05773"></a>05773                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a4a1a66ab8e36c2a154f603635120f975">clamp_nurb_order_u</a>(nu);
<a name="l05774"></a>05774                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(nu);
<a name="l05775"></a>05775             }
<a name="l05776"></a>05776             nu= <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l05777"></a>05777         }
<a name="l05778"></a>05778     }
<a name="l05779"></a>05779     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type==1) { <span class="comment">/* erase segment */</span>
<a name="l05780"></a>05780         <span class="comment">/* find the 2 selected points */</span>
<a name="l05781"></a>05781         bezt1= bezt2= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05782"></a>05782         bp1= bp2= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05783"></a>05783         nu1= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05784"></a>05784         nuindex= 0;
<a name="l05785"></a>05785         <span class="keywordflow">for</span> (nu= nubase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l05786"></a>05786             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l05787"></a>05787                 bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l05788"></a>05788                 <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1; a++) {
<a name="l05789"></a>05789                     <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abcf63d093f344e298763ce019f0a1cb1">BEZSELECTED_HIDDENHANDLES</a>(cu, bezt) ) {
<a name="l05790"></a>05790                         bezt1= bezt;
<a name="l05791"></a>05791                         bezt2= bezt+1;
<a name="l05792"></a>05792                         <span class="keywordflow">if</span> ((bezt2-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) || (bezt2-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) || (bezt2-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) {
<a name="l05793"></a>05793                             <span class="comment">/* pass */</span>
<a name="l05794"></a>05794                         }
<a name="l05795"></a>05795                         <span class="keywordflow">else</span> {  <span class="comment">/* maybe do not make cyclic */</span>
<a name="l05796"></a>05796                             <span class="keywordflow">if</span> (a==0 &amp;&amp; (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) ) {
<a name="l05797"></a>05797                                 bezt2= bezt+(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1);
<a name="l05798"></a>05798                                 <span class="keywordflow">if</span> ( (bezt2-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) || (bezt2-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) || (bezt2-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) ) {
<a name="l05799"></a>05799                                     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp;= ~<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>;
<a name="l05800"></a>05800                                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(nu);
<a name="l05801"></a>05801                                     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l05802"></a>05802                                     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l05803"></a>05803                                 }
<a name="l05804"></a>05804                             }
<a name="l05805"></a>05805 
<a name="l05806"></a>05806                             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l05807"></a>05807                         }
<a name="l05808"></a>05808                         cut= a;
<a name="l05809"></a>05809                         nu1= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l05810"></a>05810                         <span class="keywordflow">break</span>;
<a name="l05811"></a>05811                     }
<a name="l05812"></a>05812                     bezt++;
<a name="l05813"></a>05813                 }
<a name="l05814"></a>05814             }
<a name="l05815"></a>05815             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>==1) {
<a name="l05816"></a>05816                 bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l05817"></a>05817                 <span class="keywordflow">for</span> (a=0; a&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1; a++) {
<a name="l05818"></a>05818                     <span class="keywordflow">if</span> ( bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a> ) {
<a name="l05819"></a>05819                         bp1= bp;
<a name="l05820"></a>05820                         bp2= bp+1;
<a name="l05821"></a>05821                         <span class="keywordflow">if</span> (bp2-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; 1) {
<a name="l05822"></a>05822                             <span class="comment">/* pass */</span>
<a name="l05823"></a>05823                         }
<a name="l05824"></a>05824                         <span class="keywordflow">else</span> {  <span class="comment">/* maybe do not make cyclic */</span>
<a name="l05825"></a>05825                             <span class="keywordflow">if</span> (a==0 &amp;&amp; (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) ) {
<a name="l05826"></a>05826                                 bp2= bp+(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1);
<a name="l05827"></a>05827                                 <span class="keywordflow">if</span> ( bp2-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a> ) {
<a name="l05828"></a>05828                                     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp;= ~<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>;
<a name="l05829"></a>05829                                     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l05830"></a>05830                                     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l05831"></a>05831                                 }
<a name="l05832"></a>05832                             }
<a name="l05833"></a>05833 
<a name="l05834"></a>05834                             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l05835"></a>05835                         }
<a name="l05836"></a>05836                         cut= a;
<a name="l05837"></a>05837                         nu1= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l05838"></a>05838                         <span class="keywordflow">break</span>;
<a name="l05839"></a>05839                     }
<a name="l05840"></a>05840                     bp++;
<a name="l05841"></a>05841                 }
<a name="l05842"></a>05842             }
<a name="l05843"></a>05843             <span class="keywordflow">if</span> (nu1) <span class="keywordflow">break</span>;
<a name="l05844"></a>05844             nuindex++;
<a name="l05845"></a>05845         }
<a name="l05846"></a>05846         <span class="keywordflow">if</span> (nu1) {
<a name="l05847"></a>05847             <span class="keywordflow">if</span> (bezt1) {
<a name="l05848"></a>05848                 <span class="keywordflow">if</span> (nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>==2) {    <span class="comment">/* remove completely */</span>
<a name="l05849"></a>05849                     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5fc2001ce6a5bcf7d4f102f15d9edb2f">actnu</a> == nuindex)
<a name="l05850"></a>05850                         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5fc2001ce6a5bcf7d4f102f15d9edb2f">actnu</a>= -1;
<a name="l05851"></a>05851 
<a name="l05852"></a>05852                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(nubase, nu);
<a name="l05853"></a>05853                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a612d0057fcc6d1a836444e79a539a749">freeNurb</a>(nu); nu = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05854"></a>05854                 }
<a name="l05855"></a>05855                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) { <span class="comment">/* cyclic */</span>
<a name="l05856"></a>05856                     bezt =
<a name="l05857"></a>05857                         (<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>((cut+1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aafa4ace0bba7528ab007eabe81cbfc10">BezTriple</a>), <span class="stringliteral">&quot;delNurb1&quot;</span>);
<a name="l05858"></a>05858                     <a class="code" href="../../d7/d55/editcurve_8c.html#a5863deb4d104d1c79f9212cbe93affd5">ED_curve_beztcpy</a>(editnurb, bezt, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>, cut+1);
<a name="l05859"></a>05859                     a= nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-cut-1;
<a name="l05860"></a>05860                     <a class="code" href="../../d7/d55/editcurve_8c.html#a5863deb4d104d1c79f9212cbe93affd5">ED_curve_beztcpy</a>(editnurb, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>, bezt2, a);
<a name="l05861"></a>05861                     <a class="code" href="../../d7/d55/editcurve_8c.html#a5863deb4d104d1c79f9212cbe93affd5">ED_curve_beztcpy</a>(editnurb, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+a, bezt, cut+1);
<a name="l05862"></a>05862 
<a name="l05863"></a>05863                     nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp;= ~<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>;
<a name="l05864"></a>05864                     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(bezt);
<a name="l05865"></a>05865                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(nu);
<a name="l05866"></a>05866                 }
<a name="l05867"></a>05867                 <span class="keywordflow">else</span> {          <span class="comment">/* add new curve */</span>
<a name="l05868"></a>05868 
<a name="l05869"></a>05869 <span class="comment">/* seems to be an error here... but where? (a can become zero) */</span>
<a name="l05870"></a>05870 
<a name="l05871"></a>05871                     nu =
<a name="l05872"></a>05872                         (<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>), <span class="stringliteral">&quot;delNurb2&quot;</span>);
<a name="l05873"></a>05873                     memcpy(nu, nu1, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>));
<a name="l05874"></a>05874                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(nubase, nu);
<a name="l05875"></a>05875                     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a> =
<a name="l05876"></a>05876                         (<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>((cut+1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aafa4ace0bba7528ab007eabe81cbfc10">BezTriple</a>), <span class="stringliteral">&quot;delNurb3&quot;</span>);
<a name="l05877"></a>05877                     <a class="code" href="../../d7/d55/editcurve_8c.html#a5863deb4d104d1c79f9212cbe93affd5">ED_curve_beztcpy</a>(editnurb, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>, cut+1);
<a name="l05878"></a>05878                     a= nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-cut-1;
<a name="l05879"></a>05879                     
<a name="l05880"></a>05880                     bezt =
<a name="l05881"></a>05881                         (<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(a * <span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>), <span class="stringliteral">&quot;delNurb4&quot;</span>);
<a name="l05882"></a>05882                     <a class="code" href="../../d7/d55/editcurve_8c.html#a5863deb4d104d1c79f9212cbe93affd5">ED_curve_beztcpy</a>(editnurb, bezt, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+cut+1, a);
<a name="l05883"></a>05883                     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>);
<a name="l05884"></a>05884                     nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>= bezt;
<a name="l05885"></a>05885                     nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= a;
<a name="l05886"></a>05886                     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= cut+1;
<a name="l05887"></a>05887                     
<a name="l05888"></a>05888                     
<a name="l05889"></a>05889                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(nu);
<a name="l05890"></a>05890                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(nu1);
<a name="l05891"></a>05891                 }
<a name="l05892"></a>05892             }
<a name="l05893"></a>05893             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bp1) {
<a name="l05894"></a>05894                 <span class="keywordflow">if</span> (nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>==2) {    <span class="comment">/* remove completely */</span>
<a name="l05895"></a>05895                     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5fc2001ce6a5bcf7d4f102f15d9edb2f">actnu</a> == nuindex)
<a name="l05896"></a>05896                         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5fc2001ce6a5bcf7d4f102f15d9edb2f">actnu</a>= -1;
<a name="l05897"></a>05897 
<a name="l05898"></a>05898                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(nubase, nu);
<a name="l05899"></a>05899                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a612d0057fcc6d1a836444e79a539a749">freeNurb</a>(nu); nu= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05900"></a>05900                 }
<a name="l05901"></a>05901                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) { <span class="comment">/* cyclic */</span>
<a name="l05902"></a>05902                     bp =
<a name="l05903"></a>05903                         (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>((cut+1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af73d40f9d8f8b10f64359a0704799ac9">BPoint</a>), <span class="stringliteral">&quot;delNurb5&quot;</span>);
<a name="l05904"></a>05904                     <a class="code" href="../../d7/d55/editcurve_8c.html#acc934a7779bd2eee63200ad5c7bdd0d4">ED_curve_bpcpy</a>(editnurb, bp, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, cut+1);
<a name="l05905"></a>05905                     a= nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-cut-1;
<a name="l05906"></a>05906                     <a class="code" href="../../d7/d55/editcurve_8c.html#acc934a7779bd2eee63200ad5c7bdd0d4">ED_curve_bpcpy</a>(editnurb, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, bp2, a);
<a name="l05907"></a>05907                     <a class="code" href="../../d7/d55/editcurve_8c.html#acc934a7779bd2eee63200ad5c7bdd0d4">ED_curve_bpcpy</a>(editnurb, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+a, bp, cut+1);
<a name="l05908"></a>05908 
<a name="l05909"></a>05909                     nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp;= ~<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>;
<a name="l05910"></a>05910                     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(bp);
<a name="l05911"></a>05911                 }
<a name="l05912"></a>05912                 <span class="keywordflow">else</span> {          <span class="comment">/* add new curve */</span>
<a name="l05913"></a>05913                     nu = (<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>), <span class="stringliteral">&quot;delNurb6&quot;</span>);
<a name="l05914"></a>05914                     memcpy(nu, nu1, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>));
<a name="l05915"></a>05915                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(nubase, nu);
<a name="l05916"></a>05916                     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> =
<a name="l05917"></a>05917                         (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>((cut+1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af73d40f9d8f8b10f64359a0704799ac9">BPoint</a>), <span class="stringliteral">&quot;delNurb7&quot;</span>);
<a name="l05918"></a>05918                     <a class="code" href="../../d7/d55/editcurve_8c.html#acc934a7779bd2eee63200ad5c7bdd0d4">ED_curve_bpcpy</a>(editnurb, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, cut+1);
<a name="l05919"></a>05919                     a= nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-cut-1;
<a name="l05920"></a>05920                     bp =
<a name="l05921"></a>05921                         (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(a * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>), <span class="stringliteral">&quot;delNurb8&quot;</span>);
<a name="l05922"></a>05922                     <a class="code" href="../../d7/d55/editcurve_8c.html#acc934a7779bd2eee63200ad5c7bdd0d4">ED_curve_bpcpy</a>(editnurb, bp, nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+cut+1, a);
<a name="l05923"></a>05923                     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l05924"></a>05924                     nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= bp;
<a name="l05925"></a>05925                     nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= a;
<a name="l05926"></a>05926                     nu1-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05927"></a>05927                     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= cut+1;
<a name="l05928"></a>05928 
<a name="l05929"></a>05929                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a4a1a66ab8e36c2a154f603635120f975">clamp_nurb_order_u</a>(nu);
<a name="l05930"></a>05930                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(nu);
<a name="l05931"></a>05931 
<a name="l05932"></a>05932                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a4a1a66ab8e36c2a154f603635120f975">clamp_nurb_order_u</a>(nu1);
<a name="l05933"></a>05933                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(nu1);
<a name="l05934"></a>05934                 }
<a name="l05935"></a>05935             }
<a name="l05936"></a>05936         }
<a name="l05937"></a>05937     }
<a name="l05938"></a>05938     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type==2) {
<a name="l05939"></a>05939         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5fc2001ce6a5bcf7d4f102f15d9edb2f">actnu</a>= -1;
<a name="l05940"></a>05940         <a class="code" href="../../d7/d55/editcurve_8c.html#ab4cb02a70a93298743ac8b297d4e225d">keyIndex_delNurbList</a>(editnurb, nubase);
<a name="l05941"></a>05941         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aa7e3a2bafad6c23e082515885ae5294a">freeNurblist</a>(nubase);
<a name="l05942"></a>05942     }
<a name="l05943"></a>05943 
<a name="l05944"></a>05944     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a1a79334fb2fbb2d4951b7196c64a9edb">ED_curve_updateAnimPaths</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>))
<a name="l05945"></a>05945         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ab2ab88214d816c47ebee1a985b0e68b3">ND_KEYS</a>, obedit);
<a name="l05946"></a>05946 
<a name="l05947"></a>05947     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l05948"></a>05948     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l05949"></a>05949     
<a name="l05950"></a>05950     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l05951"></a>05951 }
<a name="l05952"></a>05952 
<a name="l05953"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a40a6b8fd0f9e4e985a5394ba7a0a76b5">05953</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a40a6b8fd0f9e4e985a5394ba7a0a76b5">delete_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l05954"></a>05954 {
<a name="l05955"></a>05955     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l05956"></a>05956     <a class="code" href="../../d9/d4b/structuiPopupMenu.html">uiPopupMenu</a> *pup;
<a name="l05957"></a>05957     <a class="code" href="../../d4/d94/structuiLayout.html">uiLayout</a> *layout;
<a name="l05958"></a>05958 
<a name="l05959"></a>05959     <span class="keywordflow">if</span> (obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>) {
<a name="l05960"></a>05960         pup= <a class="code" href="../../d8/d1e/UI__interface_8h.html#a402c012d9cde0ff0f0808c25c4213d43">uiPupMenuBegin</a>(C, <span class="stringliteral">&quot;Delete&quot;</span>, ICON_NONE);
<a name="l05961"></a>05961         layout= <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8c1b07b81987cdc2168a7417f9104cca">uiPupMenuLayout</a>(pup);
<a name="l05962"></a>05962         <a class="code" href="../../d8/d1e/UI__interface_8h.html#aefeaf68d5fa2a83b9d314bc23d0cc336">uiItemEnumO_ptr</a>(layout, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <span class="stringliteral">&quot;type&quot;</span>, 0);
<a name="l05963"></a>05963         <a class="code" href="../../d8/d1e/UI__interface_8h.html#aefeaf68d5fa2a83b9d314bc23d0cc336">uiItemEnumO_ptr</a>(layout, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <span class="stringliteral">&quot;type&quot;</span>, 2);
<a name="l05964"></a>05964         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3ab0b4d9de253d473a16d4f329d8b50f">uiPupMenuEnd</a>(C, pup);
<a name="l05965"></a>05965     }
<a name="l05966"></a>05966     <span class="keywordflow">else</span> {
<a name="l05967"></a>05967         pup= <a class="code" href="../../d8/d1e/UI__interface_8h.html#a402c012d9cde0ff0f0808c25c4213d43">uiPupMenuBegin</a>(C, <span class="stringliteral">&quot;Delete&quot;</span>, ICON_NONE);
<a name="l05968"></a>05968         layout= <a class="code" href="../../d8/d1e/UI__interface_8h.html#a8c1b07b81987cdc2168a7417f9104cca">uiPupMenuLayout</a>(pup);
<a name="l05969"></a>05969         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a978da8810d3910b8b9057e80e1817de4">uiItemsEnumO</a>(layout, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>, <span class="stringliteral">&quot;type&quot;</span>);
<a name="l05970"></a>05970         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3ab0b4d9de253d473a16d4f329d8b50f">uiPupMenuEnd</a>(C, pup);
<a name="l05971"></a>05971     }
<a name="l05972"></a>05972 
<a name="l05973"></a>05973     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l05974"></a>05974 }
<a name="l05975"></a>05975 
<a name="l05976"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a61f31d436871cd1628fc9b8ce2f208f3">05976</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#adbec6ea88949caabeddf22c9e800204f">CURVE_OT_delete</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l05977"></a>05977 {
<a name="l05978"></a>05978     <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> type_items[] = {
<a name="l05979"></a>05979         {0, <span class="stringliteral">&quot;SELECTED&quot;</span>, 0, <span class="stringliteral">&quot;Select&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l05980"></a>05980         {1, <span class="stringliteral">&quot;SEGMENT&quot;</span>, 0, <span class="stringliteral">&quot;Segment&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l05981"></a>05981         {2, <span class="stringliteral">&quot;ALL&quot;</span>, 0, <span class="stringliteral">&quot;All&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l05982"></a>05982         {0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL}};
<a name="l05983"></a>05983 
<a name="l05984"></a>05984     <span class="comment">/* identifiers */</span>
<a name="l05985"></a>05985     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Delete&quot;</span>;
<a name="l05986"></a>05986     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Delete selected control points or segments&quot;</span>;
<a name="l05987"></a>05987     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_delete&quot;</span>;
<a name="l05988"></a>05988     
<a name="l05989"></a>05989     <span class="comment">/* api callbacks */</span>
<a name="l05990"></a>05990     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#abd29fe9367d0898d28992c9dd72aec91">delete_exec</a>;
<a name="l05991"></a>05991     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a40a6b8fd0f9e4e985a5394ba7a0a76b5">delete_invoke</a>;
<a name="l05992"></a>05992     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l05993"></a>05993     
<a name="l05994"></a>05994     <span class="comment">/* flags */</span>
<a name="l05995"></a>05995     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l05996"></a>05996 
<a name="l05997"></a>05997     <span class="comment">/* properties */</span>
<a name="l05998"></a>05998     <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;type&quot;</span>, type_items, 0, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;Which elements to delete&quot;</span>);
<a name="l05999"></a>05999 }
<a name="l06000"></a>06000 
<a name="l06001"></a>06001 <span class="comment">/********************** shade smooth/flat operator *********************/</span>
<a name="l06002"></a>06002 
<a name="l06003"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a152280a0436cbf96cc0d3d476bccbb1f">06003</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a152280a0436cbf96cc0d3d476bccbb1f">shade_smooth_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l06004"></a>06004 {
<a name="l06005"></a>06005     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l06006"></a>06006     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l06007"></a>06007     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l06008"></a>06008     <span class="keywordtype">int</span> <a class="code" href="../../d1/d79/btDbvtBroadphase_8cpp.html#a19b1dda96df6332570b535a0683d8076">clear</a>= (strcmp(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a42b15acb4df45b846c38202a208c0c32">idname</a>, <span class="stringliteral">&quot;CURVE_OT_shade_flat&quot;</span>) == 0);
<a name="l06009"></a>06009     
<a name="l06010"></a>06010     <span class="keywordflow">if</span> (obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> != <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>)
<a name="l06011"></a>06011         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l06012"></a>06012     
<a name="l06013"></a>06013     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l06014"></a>06014         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d55/editcurve_8c.html#a04a97e645bf45a68ecbbfb7a123e9cac">isNurbsel</a>(nu)) {
<a name="l06015"></a>06015             <span class="keywordflow">if</span> (!clear) nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a3cf1c2dec47235e64740549f9bb2b5ff">flag</a> |= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a52776b893e7d78f3276b98e0b9f56cc1">CU_SMOOTH</a>;
<a name="l06016"></a>06016             <span class="keywordflow">else</span> nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a3cf1c2dec47235e64740549f9bb2b5ff">flag</a> &amp;= ~<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a52776b893e7d78f3276b98e0b9f56cc1">CU_SMOOTH</a>;
<a name="l06017"></a>06017         }
<a name="l06018"></a>06018     }
<a name="l06019"></a>06019     
<a name="l06020"></a>06020     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l06021"></a>06021     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l06022"></a>06022 
<a name="l06023"></a>06023     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l06024"></a>06024 }
<a name="l06025"></a>06025 
<a name="l06026"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a51f2fe2cd2cfaaceab7a1ef412d52000">06026</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#afad11192ff6666acbd475fd62335d5bb">CURVE_OT_shade_smooth</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l06027"></a>06027 {
<a name="l06028"></a>06028     <span class="comment">/* identifiers */</span>
<a name="l06029"></a>06029     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Shade Smooth&quot;</span>;
<a name="l06030"></a>06030     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_shade_smooth&quot;</span>;
<a name="l06031"></a>06031     
<a name="l06032"></a>06032     <span class="comment">/* api callbacks */</span>
<a name="l06033"></a>06033     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a152280a0436cbf96cc0d3d476bccbb1f">shade_smooth_exec</a>;
<a name="l06034"></a>06034     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l06035"></a>06035     
<a name="l06036"></a>06036     <span class="comment">/* flags */</span>
<a name="l06037"></a>06037     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l06038"></a>06038 }
<a name="l06039"></a>06039 
<a name="l06040"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a74c1bd0bddf691c5af6cfcd220841306">06040</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a04a39bd5195e7b1d850e053a8c966624">CURVE_OT_shade_flat</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l06041"></a>06041 {
<a name="l06042"></a>06042     <span class="comment">/* identifiers */</span>
<a name="l06043"></a>06043     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Shade Flat&quot;</span>;
<a name="l06044"></a>06044     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_shade_flat&quot;</span>;
<a name="l06045"></a>06045     
<a name="l06046"></a>06046     <span class="comment">/* api callbacks */</span>
<a name="l06047"></a>06047     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a152280a0436cbf96cc0d3d476bccbb1f">shade_smooth_exec</a>;
<a name="l06048"></a>06048     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac2c4e21e03626439912647631d1d034f">ED_operator_editsurfcurve</a>;
<a name="l06049"></a>06049     
<a name="l06050"></a>06050     <span class="comment">/* flags */</span>
<a name="l06051"></a>06051     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l06052"></a>06052 }
<a name="l06053"></a>06053 
<a name="l06054"></a>06054 <span class="comment">/************** join operator, to be used externally? ****************/</span>
<a name="l06055"></a>06055 
<a name="l06056"></a><a class="code" href="../../d7/d55/editcurve_8c.html#af2af23ce8667638a7e95d162460de6a3">06056</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#af2af23ce8667638a7e95d162460de6a3">join_curve_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l06057"></a>06057 {
<a name="l06058"></a>06058     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C);
<a name="l06059"></a>06059     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l06060"></a>06060     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= <a class="code" href="../../df/d01/BKE__context_8h.html#a86fd97bb1e59c64106c001ab29db25c7">CTX_data_active_object</a>(C);
<a name="l06061"></a>06061     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu;
<a name="l06062"></a>06062     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>, *newnu;
<a name="l06063"></a>06063     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l06064"></a>06064     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l06065"></a>06065     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> tempbase;
<a name="l06066"></a>06066     <span class="keywordtype">float</span> imat[4][4], cmat[4][4];
<a name="l06067"></a>06067     <span class="keywordtype">int</span> a;
<a name="l06068"></a>06068 
<a name="l06069"></a>06069     tempbase.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= tempbase.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06070"></a>06070     
<a name="l06071"></a>06071     <span class="comment">/* trasnform all selected curves inverse in obact */</span>
<a name="l06072"></a>06072     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(imat, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l06073"></a>06073     
<a name="l06074"></a>06074     <a class="code" href="../../df/d01/BKE__context_8h.html#a63ffcaf5af72270fb66c773139bdedb2">CTX_DATA_BEGIN</a>(C, <a class="code" href="../../d3/da9/structBase.html">Base</a>*, base, selected_editable_bases) {
<a name="l06075"></a>06075         <span class="keywordflow">if</span> (base-&gt;object-&gt;type==ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>) {
<a name="l06076"></a>06076             <span class="keywordflow">if</span> (base-&gt;object != ob) {
<a name="l06077"></a>06077             
<a name="l06078"></a>06078                 cu= base-&gt;object-&gt;data;
<a name="l06079"></a>06079             
<a name="l06080"></a>06080                 <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l06081"></a>06081                     <span class="comment">/* watch it: switch order here really goes wrong */</span>
<a name="l06082"></a>06082                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ae41a59d6db4a10a85f8fbf1e3842ba81">mult_m4_m4m4</a>(cmat, imat, base-&gt;object-&gt;obmat);
<a name="l06083"></a>06083                     
<a name="l06084"></a>06084                     nu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l06085"></a>06085                     <span class="keywordflow">while</span> (nu) {
<a name="l06086"></a>06086                         newnu= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a0fde69c2411c891708933b3d79c97c34">duplicateNurb</a>(nu);
<a name="l06087"></a>06087                         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad3bbabfca98cb47923254dd04d6961ac">totcol</a>) { <span class="comment">/* TODO, merge material lists */</span>
<a name="l06088"></a>06088                             <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#aec3c171f54634d9a772bbf8000bc2bb6">mat_nr</a>, 0, ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad3bbabfca98cb47923254dd04d6961ac">totcol</a>-1);
<a name="l06089"></a>06089                         }
<a name="l06090"></a>06090                         <span class="keywordflow">else</span> newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#aec3c171f54634d9a772bbf8000bc2bb6">mat_nr</a>= 0;
<a name="l06091"></a>06091                         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;tempbase, newnu);
<a name="l06092"></a>06092                         
<a name="l06093"></a>06093                         <span class="keywordflow">if</span> ( (bezt= newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) ) {
<a name="l06094"></a>06094                             a= newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l06095"></a>06095                             <span class="keywordflow">while</span> (a--) {
<a name="l06096"></a>06096                                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(cmat, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0]);
<a name="l06097"></a>06097                                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(cmat, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1]);
<a name="l06098"></a>06098                                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(cmat, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2]);
<a name="l06099"></a>06099                                 bezt++;
<a name="l06100"></a>06100                             }
<a name="l06101"></a>06101                             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(newnu);
<a name="l06102"></a>06102                         }
<a name="l06103"></a>06103                         <span class="keywordflow">if</span> ( (bp= newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>) ) {
<a name="l06104"></a>06104                             a= newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l06105"></a>06105                             <span class="keywordflow">while</span> (a--) {
<a name="l06106"></a>06106                                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(cmat, bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l06107"></a>06107                                 bp++;
<a name="l06108"></a>06108                             }
<a name="l06109"></a>06109                         }
<a name="l06110"></a>06110                         nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l06111"></a>06111                     }
<a name="l06112"></a>06112                 }
<a name="l06113"></a>06113             
<a name="l06114"></a>06114                 <a class="code" href="../../da/d7a/ED__object_8h.html#af606d9df3349e6cc4267296011bf4f12">ED_base_object_free_and_unlink</a>(bmain, scene, base);
<a name="l06115"></a>06115             }
<a name="l06116"></a>06116         }
<a name="l06117"></a>06117     }
<a name="l06118"></a>06118     <a class="code" href="../../df/d01/BKE__context_8h.html#af19e54c354c69aacc4c6f2e2fcafde0f">CTX_DATA_END</a>;
<a name="l06119"></a>06119     
<a name="l06120"></a>06120     cu= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l06121"></a>06121     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aea47205fbf4fc9965bc2b06e7e3ca75a">BLI_movelisttolist</a>(&amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>, &amp;tempbase);
<a name="l06122"></a>06122     
<a name="l06123"></a>06123     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a1916587a9ec19eb3543b1c1bc54a8ded">DAG_scene_sort</a>(bmain, scene);   <span class="comment">// because we removed object(s), call before editmode!</span>
<a name="l06124"></a>06124     
<a name="l06125"></a>06125     <a class="code" href="../../da/d7a/ED__object_8h.html#abf5a8346ea6543e8d977bfe1358c5c35">ED_object_enter_editmode</a>(C, <a class="code" href="../../da/d7a/ED__object_8h.html#a660a08f2196e720360e276ccf8125171">EM_WAITCURSOR</a>);
<a name="l06126"></a>06126     <a class="code" href="../../da/d7a/ED__object_8h.html#a3dc41f10c2da040464140768d2898865">ED_object_exit_editmode</a>(C, <a class="code" href="../../da/d7a/ED__object_8h.html#a56f58f037f42277d234426571ee2de12">EM_FREEDATA</a>|<a class="code" href="../../da/d7a/ED__object_8h.html#a660a08f2196e720360e276ccf8125171">EM_WAITCURSOR</a>|<a class="code" href="../../da/d7a/ED__object_8h.html#a58e84e1ebbb3942ca4d7722b6c19c61d">EM_DO_UNDO</a>);
<a name="l06127"></a>06127 
<a name="l06128"></a>06128     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a61261a6b5ea948eee6d42c7e7ee18166">NC_SCENE</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a2072407a0c536bf373bd0b6b7c159c5c">ND_OB_ACTIVE</a>, scene);
<a name="l06129"></a>06129 
<a name="l06130"></a>06130     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l06131"></a>06131 }
<a name="l06132"></a>06132 
<a name="l06133"></a>06133 <span class="comment">/************ add primitive, used by object/ module ****************/</span>
<a name="l06134"></a>06134 
<a name="l06135"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a8aa222044d9a553c0be58e6fd06300c8">06135</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d55/editcurve_8c.html#a8aa222044d9a553c0be58e6fd06300c8">get_curve_defname</a>(<span class="keywordtype">int</span> type)
<a name="l06136"></a>06136 {
<a name="l06137"></a>06137     <span class="keywordtype">int</span> stype= type &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a5eda492ae4f5e2afb674917d13e512c6">CU_PRIMITIVE</a>;
<a name="l06138"></a>06138 
<a name="l06139"></a>06139     <span class="keywordflow">if</span> ((type &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a899c94b9a6caab6a3987326c0604c31f">CU_TYPE</a>)==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l06140"></a>06140         <span class="keywordflow">switch</span> (stype) {
<a name="l06141"></a>06141             <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#acf94590379616d11f84d3388d418f804">CU_PRIM_CURVE</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;BezierCurve&quot;</span>;
<a name="l06142"></a>06142             <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#acd4cbed727dddb2664c7b31abc781006">CU_PRIM_CIRCLE</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;BezierCircle&quot;</span>;
<a name="l06143"></a>06143             <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a9889cf561b07057c7f4ee9984f9c2aec">CU_PRIM_PATH</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;CurvePath&quot;</span>;
<a name="l06144"></a>06144             <span class="keywordflow">default</span>:
<a name="l06145"></a>06145                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;Curve&quot;</span>;
<a name="l06146"></a>06146         }
<a name="l06147"></a>06147     }
<a name="l06148"></a>06148     <span class="keywordflow">else</span> {
<a name="l06149"></a>06149         <span class="keywordflow">switch</span> (stype) {
<a name="l06150"></a>06150             <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#acf94590379616d11f84d3388d418f804">CU_PRIM_CURVE</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;NurbsCurve&quot;</span>;
<a name="l06151"></a>06151             <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#acd4cbed727dddb2664c7b31abc781006">CU_PRIM_CIRCLE</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;NurbsCircle&quot;</span>;
<a name="l06152"></a>06152             <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a9889cf561b07057c7f4ee9984f9c2aec">CU_PRIM_PATH</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;NurbsPath&quot;</span>;
<a name="l06153"></a>06153             <span class="keywordflow">default</span>:
<a name="l06154"></a>06154                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;Curve&quot;</span>;
<a name="l06155"></a>06155         }
<a name="l06156"></a>06156     }
<a name="l06157"></a>06157 }
<a name="l06158"></a>06158 
<a name="l06159"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a935125b7c024fc65e459ce91ac034b06">06159</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d55/editcurve_8c.html#a935125b7c024fc65e459ce91ac034b06">get_surf_defname</a>(<span class="keywordtype">int</span> type)
<a name="l06160"></a>06160 {
<a name="l06161"></a>06161     <span class="keywordtype">int</span> stype= type &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a5eda492ae4f5e2afb674917d13e512c6">CU_PRIMITIVE</a>;
<a name="l06162"></a>06162 
<a name="l06163"></a>06163     <span class="keywordflow">switch</span> (stype) {
<a name="l06164"></a>06164         <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#acf94590379616d11f84d3388d418f804">CU_PRIM_CURVE</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;SurfCurve&quot;</span>;
<a name="l06165"></a>06165         <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#acd4cbed727dddb2664c7b31abc781006">CU_PRIM_CIRCLE</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;SurfCircle&quot;</span>;
<a name="l06166"></a>06166         <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ab5f0278c9cafe45d4b65098cfa8caee7">CU_PRIM_PATCH</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;SurfPatch&quot;</span>;
<a name="l06167"></a>06167         <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aa61bc3448d205c5a86b8d26c2ca1d071">CU_PRIM_SPHERE</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;SurfSphere&quot;</span>;
<a name="l06168"></a>06168         <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abd3166a83b593327c1dc1c3ad091a638">CU_PRIM_DONUT</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;SurfTorus&quot;</span>;
<a name="l06169"></a>06169         <span class="keywordflow">default</span>:
<a name="l06170"></a>06170             <span class="keywordflow">return</span> <span class="stringliteral">&quot;Surface&quot;</span>;
<a name="l06171"></a>06171     }
<a name="l06172"></a>06172 }
<a name="l06173"></a>06173 
<a name="l06174"></a>06174 
<a name="l06175"></a><a class="code" href="../../db/d71/ED__curve_8h.html#abe208026594b8ed3d6f5ace6c8946f8a">06175</a> <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d7/d55/editcurve_8c.html#affa215ec8eb52b390a6801429601dc09">add_nurbs_primitive</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keywordtype">float</span> mat[4][4], <span class="keywordtype">int</span> type, <span class="keywordtype">int</span> newob)
<a name="l06176"></a>06176 {
<a name="l06177"></a>06177     <span class="keyword">static</span> <span class="keywordtype">int</span> xzproj= 0;   <span class="comment">/* this function calls itself... */</span>
<a name="l06178"></a>06178     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l06179"></a>06179     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l06180"></a>06180     <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d= <a class="code" href="../../df/d01/BKE__context_8h.html#a88ab4a564441708766a6b4ace3b17908">CTX_wm_view3d</a>(C);
<a name="l06181"></a>06181     <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d= <a class="code" href="../../d8/d6a/ED__view3d_8h.html#ad7a31725b14f8332b355403058e71019">ED_view3d_context_rv3d</a>(C);
<a name="l06182"></a>06182     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06183"></a>06183     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l06184"></a>06184     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l06185"></a>06185     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= (<a class="code" href="../../da/d10/structCurve.html">Curve</a>*)obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l06186"></a>06186     <span class="keywordtype">float</span> <a class="code" href="../../d2/d83/structNurbSort.html#a5bbbd50dea6dc44f8cd1214e1ac87fe4">vec</a>[3], zvec[3]= {0.0f, 0.0f, 1.0f};
<a name="l06187"></a>06187     <span class="keywordtype">float</span> umat[4][4]= <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a0e2ef61ffa876947da5d7dfb15d79230">MAT4_UNITY</a>, viewmat[4][4]= <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a0e2ef61ffa876947da5d7dfb15d79230">MAT4_UNITY</a>;
<a name="l06188"></a>06188     <span class="keywordtype">float</span> fac;
<a name="l06189"></a>06189     <span class="keywordtype">int</span> a, b;
<a name="l06190"></a>06190     <span class="keyword">const</span> <span class="keywordtype">float</span> grid= v3d ? v3d-&gt;grid : 1.0f;
<a name="l06191"></a>06191     <span class="keyword">const</span> <span class="keywordtype">int</span> cutype= (type &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a899c94b9a6caab6a3987326c0604c31f">CU_TYPE</a>); <span class="comment">// poly, bezier, nurbs, etc</span>
<a name="l06192"></a>06192     <span class="keyword">const</span> <span class="keywordtype">int</span> stype= (type &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a5eda492ae4f5e2afb674917d13e512c6">CU_PRIMITIVE</a>);
<a name="l06193"></a>06193     <span class="keyword">const</span> <span class="keywordtype">int</span> force_3d = ((<a class="code" href="../../da/d10/structCurve.html">Curve</a> *)obedit-&gt;data)-&gt;flag &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae2e952bfa23ce6735422c9e7bae27dac">CU_3D</a>; <span class="comment">/* could be adding to an existing 3D curve */</span>
<a name="l06194"></a>06194 
<a name="l06195"></a>06195     <span class="keywordflow">if</span> (rv3d) {
<a name="l06196"></a>06196         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(viewmat, rv3d-&gt;viewmat);
<a name="l06197"></a>06197         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(zvec, rv3d-&gt;viewinv[2]);
<a name="l06198"></a>06198     }
<a name="l06199"></a>06199 
<a name="l06200"></a>06200     <a class="code" href="../../d7/d55/editcurve_8c.html#a9d92d24c42cc1db29dcac1a5fe4d0e5e">setflagsNurb</a>(editnurb, 0);
<a name="l06201"></a>06201     
<a name="l06202"></a>06202     <span class="comment">/* these types call this function to return a Nurb */</span>
<a name="l06203"></a>06203     <span class="keywordflow">if</span> (stype!=<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a584e021f14e88bffc223599430553a8d">CU_PRIM_TUBE</a> &amp;&amp; stype!=<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abd3166a83b593327c1dc1c3ad091a638">CU_PRIM_DONUT</a>) {
<a name="l06204"></a>06204         <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a> = (<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>), <span class="stringliteral">&quot;addNurbprim&quot;</span>);
<a name="l06205"></a>06205         <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a>= cutype;
<a name="l06206"></a>06206         <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#aa4d5f2ef5e32e94dcbe14a1a7d946a30">resolu</a>= cu-&gt;resolu;
<a name="l06207"></a>06207         <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#ab9ca5b497098466d579b0343cbe62ae7">resolv</a>= cu-&gt;resolv;
<a name="l06208"></a>06208     }
<a name="l06209"></a>06209 
<a name="l06210"></a>06210     <span class="keywordflow">switch</span>(stype) {
<a name="l06211"></a>06211     <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#acf94590379616d11f84d3388d418f804">CU_PRIM_CURVE</a>: <span class="comment">/* curve */</span>
<a name="l06212"></a>06212         <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#aa4d5f2ef5e32e94dcbe14a1a7d946a30">resolu</a>= cu-&gt;resolu;
<a name="l06213"></a>06213         <span class="keywordflow">if</span> (cutype==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l06214"></a>06214             <span class="keywordflow">if</span> (!force_3d) <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a3cf1c2dec47235e64740549f9bb2b5ff">flag</a> |= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aaff7c75290c54fa64f73a97718c2faf8">CU_2D</a>;
<a name="l06215"></a>06215             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= 2;
<a name="l06216"></a>06216             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a> =
<a name="l06217"></a>06217                 (<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(2 * <span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>), <span class="stringliteral">&quot;addNurbprim1&quot;</span>);
<a name="l06218"></a>06218             bezt= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l06219"></a>06219             bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>= bezt-&gt;h2= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45ecacf967643ac26269318a51fe281992051">HD_ALIGN</a>;
<a name="l06220"></a>06220             bezt-&gt;f1= bezt-&gt;f2= bezt-&gt;f3= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l06221"></a>06221             bezt-&gt;radius = 1.0;
<a name="l06222"></a>06222 
<a name="l06223"></a>06223             bezt-&gt;vec[1][0]+= -grid;
<a name="l06224"></a>06224             bezt-&gt;vec[0][0]+= -1.5f*grid;
<a name="l06225"></a>06225             bezt-&gt;vec[0][1]+= -0.5f*grid;
<a name="l06226"></a>06226             bezt-&gt;vec[2][0]+= -0.5f*grid;
<a name="l06227"></a>06227             bezt-&gt;vec[2][1]+=  0.5f*grid;
<a name="l06228"></a>06228             <span class="keywordflow">for</span> (a=0;a&lt;3;a++) <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(mat, bezt-&gt;vec[a]);
<a name="l06229"></a>06229 
<a name="l06230"></a>06230             bezt++;
<a name="l06231"></a>06231             bezt-&gt;h1= bezt-&gt;h2= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45ecacf967643ac26269318a51fe281992051">HD_ALIGN</a>;
<a name="l06232"></a>06232             bezt-&gt;f1= bezt-&gt;f2= bezt-&gt;f3= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l06233"></a>06233             bezt-&gt;radius = bezt-&gt;weight = 1.0;
<a name="l06234"></a>06234 
<a name="l06235"></a>06235             bezt-&gt;vec[0][0] = 0;
<a name="l06236"></a>06236             bezt-&gt;vec[0][1] = 0;
<a name="l06237"></a>06237             bezt-&gt;vec[1][0] = grid;
<a name="l06238"></a>06238             bezt-&gt;vec[1][1] = 0;
<a name="l06239"></a>06239             bezt-&gt;vec[2][0] = grid*2;
<a name="l06240"></a>06240             bezt-&gt;vec[2][1] = 0;
<a name="l06241"></a>06241             <span class="keywordflow">for</span> (a=0;a&lt;3;a++) <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(mat, bezt-&gt;vec[a]);
<a name="l06242"></a>06242 
<a name="l06243"></a>06243             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>);
<a name="l06244"></a>06244         }
<a name="l06245"></a>06245         <span class="keywordflow">else</span> {
<a name="l06246"></a>06246             
<a name="l06247"></a>06247             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= 4;
<a name="l06248"></a>06248             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>= 1;
<a name="l06249"></a>06249             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>= 4;
<a name="l06250"></a>06250             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= <a class="code" href="../../d7/d55/editcurve_8c.html#a444b040d2e5c83849d98d1d2043025c9">callocstructN</a>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>, 4, <span class="stringliteral">&quot;addNurbprim3&quot;</span>);
<a name="l06251"></a>06251 
<a name="l06252"></a>06252             bp= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l06253"></a>06253             <span class="keywordflow">for</span> (a=0;a&lt;4;a++, bp++) {
<a name="l06254"></a>06254                 bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[3]= 1.0;
<a name="l06255"></a>06255                 bp-&gt;f1= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l06256"></a>06256                 bp-&gt;radius = bp-&gt;weight = 1.0;
<a name="l06257"></a>06257             }
<a name="l06258"></a>06258 
<a name="l06259"></a>06259             bp= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l06260"></a>06260             bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[0]+= -1.5f*grid;
<a name="l06261"></a>06261             bp++;
<a name="l06262"></a>06262             bp-&gt;vec[0]+= -grid;
<a name="l06263"></a>06263             bp-&gt;vec[1]+=  grid; 
<a name="l06264"></a>06264             bp++;
<a name="l06265"></a>06265             bp-&gt;vec[0]+= grid;
<a name="l06266"></a>06266             bp-&gt;vec[1]+= grid; 
<a name="l06267"></a>06267             bp++;
<a name="l06268"></a>06268             bp-&gt;vec[0]+= 1.5f*grid;
<a name="l06269"></a>06269 
<a name="l06270"></a>06270             bp= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l06271"></a>06271             <span class="keywordflow">for</span> (a=0;a&lt;4;a++, bp++) <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(mat,bp-&gt;vec);
<a name="l06272"></a>06272 
<a name="l06273"></a>06273             <span class="keywordflow">if</span> (cutype==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l06274"></a>06274                 <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;   <span class="comment">/* nurbs_knot_calc_u allocates */</span>
<a name="l06275"></a>06275                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>);
<a name="l06276"></a>06276             }
<a name="l06277"></a>06277 
<a name="l06278"></a>06278         }
<a name="l06279"></a>06279         <span class="keywordflow">break</span>;
<a name="l06280"></a>06280     <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a9889cf561b07057c7f4ee9984f9c2aec">CU_PRIM_PATH</a>:  <span class="comment">/* 5 point path */</span>
<a name="l06281"></a>06281         <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= 5;
<a name="l06282"></a>06282         <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>= 1;
<a name="l06283"></a>06283         <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>= 5;
<a name="l06284"></a>06284         <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a08714812d678ab6691f493c99a970286">CU_NURB_ENDPOINT</a>;    <span class="comment">/* endpoint */</span>
<a name="l06285"></a>06285         <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#aa4d5f2ef5e32e94dcbe14a1a7d946a30">resolu</a>= cu-&gt;resolu;
<a name="l06286"></a>06286         <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= <a class="code" href="../../d7/d55/editcurve_8c.html#a444b040d2e5c83849d98d1d2043025c9">callocstructN</a>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>, 5, <span class="stringliteral">&quot;addNurbprim3&quot;</span>);
<a name="l06287"></a>06287 
<a name="l06288"></a>06288         bp= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l06289"></a>06289         <span class="keywordflow">for</span> (a=0;a&lt;5;a++, bp++) {
<a name="l06290"></a>06290             bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[3]= 1.0;
<a name="l06291"></a>06291             bp-&gt;f1= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l06292"></a>06292             bp-&gt;radius = bp-&gt;weight = 1.0;
<a name="l06293"></a>06293         }
<a name="l06294"></a>06294 
<a name="l06295"></a>06295         bp= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l06296"></a>06296         bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[0]+= -2.0f*grid;
<a name="l06297"></a>06297         bp++;
<a name="l06298"></a>06298         bp-&gt;vec[0]+= -grid;
<a name="l06299"></a>06299         bp++; bp++;
<a name="l06300"></a>06300         bp-&gt;vec[0]+= grid;
<a name="l06301"></a>06301         bp++;
<a name="l06302"></a>06302         bp-&gt;vec[0]+= 2.0f*grid;
<a name="l06303"></a>06303 
<a name="l06304"></a>06304         bp= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l06305"></a>06305         <span class="keywordflow">for</span> (a=0;a&lt;5;a++, bp++) <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(mat,bp-&gt;vec);
<a name="l06306"></a>06306 
<a name="l06307"></a>06307         <span class="keywordflow">if</span> (cutype==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l06308"></a>06308             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;   <span class="comment">/* nurbs_knot_calc_u allocates */</span>
<a name="l06309"></a>06309             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>);
<a name="l06310"></a>06310         }
<a name="l06311"></a>06311 
<a name="l06312"></a>06312         <span class="keywordflow">break</span>;
<a name="l06313"></a>06313     <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#acd4cbed727dddb2664c7b31abc781006">CU_PRIM_CIRCLE</a>:    <span class="comment">/* circle */</span>
<a name="l06314"></a>06314         <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#aa4d5f2ef5e32e94dcbe14a1a7d946a30">resolu</a>= cu-&gt;resolu;
<a name="l06315"></a>06315 
<a name="l06316"></a>06316         <span class="keywordflow">if</span> (cutype==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l06317"></a>06317             <span class="keywordflow">if</span> (!force_3d) <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a3cf1c2dec47235e64740549f9bb2b5ff">flag</a> |= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aaff7c75290c54fa64f73a97718c2faf8">CU_2D</a>;
<a name="l06318"></a>06318             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= 4;
<a name="l06319"></a>06319             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>= <a class="code" href="../../d7/d55/editcurve_8c.html#a444b040d2e5c83849d98d1d2043025c9">callocstructN</a>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>, 4, <span class="stringliteral">&quot;addNurbprim1&quot;</span>);
<a name="l06320"></a>06320             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>;
<a name="l06321"></a>06321             bezt= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l06322"></a>06322 
<a name="l06323"></a>06323             bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>= bezt-&gt;h2= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>;
<a name="l06324"></a>06324             bezt-&gt;f1= bezt-&gt;f2= bezt-&gt;f3= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l06325"></a>06325             bezt-&gt;vec[1][0]+= -grid;
<a name="l06326"></a>06326             <span class="keywordflow">for</span> (a=0;a&lt;3;a++) <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(mat,bezt-&gt;vec[a]);
<a name="l06327"></a>06327             bezt-&gt;radius = bezt-&gt;weight = 1.0;
<a name="l06328"></a>06328             
<a name="l06329"></a>06329             bezt++;
<a name="l06330"></a>06330             bezt-&gt;h1= bezt-&gt;h2= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>;
<a name="l06331"></a>06331             bezt-&gt;f1= bezt-&gt;f2= bezt-&gt;f3= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l06332"></a>06332             bezt-&gt;vec[1][1]+= grid;
<a name="l06333"></a>06333             <span class="keywordflow">for</span> (a=0;a&lt;3;a++) <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(mat,bezt-&gt;vec[a]);
<a name="l06334"></a>06334             bezt-&gt;radius = bezt-&gt;weight = 1.0;
<a name="l06335"></a>06335 
<a name="l06336"></a>06336             bezt++;
<a name="l06337"></a>06337             bezt-&gt;h1= bezt-&gt;h2= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>;
<a name="l06338"></a>06338             bezt-&gt;f1= bezt-&gt;f2= bezt-&gt;f3= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l06339"></a>06339             bezt-&gt;vec[1][0]+= grid;
<a name="l06340"></a>06340             <span class="keywordflow">for</span> (a=0;a&lt;3;a++) <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(mat,bezt-&gt;vec[a]);
<a name="l06341"></a>06341             bezt-&gt;radius = bezt-&gt;weight = 1.0;
<a name="l06342"></a>06342 
<a name="l06343"></a>06343             bezt++;
<a name="l06344"></a>06344             bezt-&gt;h1= bezt-&gt;h2= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>;
<a name="l06345"></a>06345             bezt-&gt;f1= bezt-&gt;f2= bezt-&gt;f3= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l06346"></a>06346             bezt-&gt;vec[1][1]+= -grid;
<a name="l06347"></a>06347             <span class="keywordflow">for</span> (a=0;a&lt;3;a++) <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(mat,bezt-&gt;vec[a]);
<a name="l06348"></a>06348             bezt-&gt;radius = bezt-&gt;weight = 1.0;
<a name="l06349"></a>06349 
<a name="l06350"></a>06350             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>);
<a name="l06351"></a>06351         }
<a name="l06352"></a>06352         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( cutype==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a> ) {  <span class="comment">/* nurb */</span>
<a name="l06353"></a>06353             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= 8;
<a name="l06354"></a>06354             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>= 1;
<a name="l06355"></a>06355             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>= 4;
<a name="l06356"></a>06356             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= <a class="code" href="../../d7/d55/editcurve_8c.html#a444b040d2e5c83849d98d1d2043025c9">callocstructN</a>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>, 8, <span class="stringliteral">&quot;addNurbprim6&quot;</span>);
<a name="l06357"></a>06357             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>;
<a name="l06358"></a>06358             bp= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l06359"></a>06359 
<a name="l06360"></a>06360             <span class="keywordflow">for</span> (a=0; a&lt;8; a++) {
<a name="l06361"></a>06361                 bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a>= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l06362"></a>06362                 <span class="keywordflow">if</span> (xzproj==0) {
<a name="l06363"></a>06363                     bp-&gt;vec[0]+= <a class="code" href="../../d7/d55/editcurve_8c.html#a5c5be76591ef8a4025c7db4a77f32a02">nurbcircle</a>[a][0]*grid;
<a name="l06364"></a>06364                     bp-&gt;vec[1]+= <a class="code" href="../../d7/d55/editcurve_8c.html#a5c5be76591ef8a4025c7db4a77f32a02">nurbcircle</a>[a][1]*grid;
<a name="l06365"></a>06365                 }
<a name="l06366"></a>06366                 <span class="keywordflow">else</span> {
<a name="l06367"></a>06367                     bp-&gt;vec[0]+= 0.25f*<a class="code" href="../../d7/d55/editcurve_8c.html#a5c5be76591ef8a4025c7db4a77f32a02">nurbcircle</a>[a][0]*grid-0.75f*grid;
<a name="l06368"></a>06368                     bp-&gt;vec[2]+= 0.25f*<a class="code" href="../../d7/d55/editcurve_8c.html#a5c5be76591ef8a4025c7db4a77f32a02">nurbcircle</a>[a][1]*grid;
<a name="l06369"></a>06369                 }
<a name="l06370"></a>06370                 <span class="keywordflow">if</span> (a &amp; 1) bp-&gt;vec[3]= 0.25*<a class="code" href="../../dd/d06/BLI__math__base_8h.html#a66b3ab30f1332874326ed93969e496e0">M_SQRT2</a>;
<a name="l06371"></a>06371                 <span class="keywordflow">else</span> bp-&gt;vec[3]= 1.0;
<a name="l06372"></a>06372                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(mat,bp-&gt;vec);
<a name="l06373"></a>06373                 bp-&gt;radius = bp-&gt;weight = 1.0;
<a name="l06374"></a>06374                 
<a name="l06375"></a>06375                 bp++;
<a name="l06376"></a>06376             }
<a name="l06377"></a>06377 
<a name="l06378"></a>06378             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>);
<a name="l06379"></a>06379         }
<a name="l06380"></a>06380         <span class="keywordflow">break</span>;
<a name="l06381"></a>06381     <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ab5f0278c9cafe45d4b65098cfa8caee7">CU_PRIM_PATCH</a>: <span class="comment">/* 4x4 patch */</span>
<a name="l06382"></a>06382         <span class="keywordflow">if</span> ( cutype==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a> ) {  <span class="comment">/* nurb */</span>
<a name="l06383"></a>06383 
<a name="l06384"></a>06384             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= 4;
<a name="l06385"></a>06385             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>= 4;
<a name="l06386"></a>06386             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>= 4;
<a name="l06387"></a>06387             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>= 4;
<a name="l06388"></a>06388             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a3cf1c2dec47235e64740549f9bb2b5ff">flag</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a52776b893e7d78f3276b98e0b9f56cc1">CU_SMOOTH</a>;
<a name="l06389"></a>06389             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= <a class="code" href="../../d7/d55/editcurve_8c.html#a444b040d2e5c83849d98d1d2043025c9">callocstructN</a>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>, 4*4, <span class="stringliteral">&quot;addNurbprim6&quot;</span>);
<a name="l06390"></a>06390             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a>= 0;
<a name="l06391"></a>06391             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#ae1c344a45c028d3c2067864f5280854e">flagv</a>= 0;
<a name="l06392"></a>06392             bp= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l06393"></a>06393 
<a name="l06394"></a>06394             <span class="keywordflow">for</span> (a=0; a&lt;4; a++) {
<a name="l06395"></a>06395                 <span class="keywordflow">for</span> (b=0; b&lt;4; b++) {
<a name="l06396"></a>06396                     bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a>= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l06397"></a>06397                     fac= (float)a -1.5f;
<a name="l06398"></a>06398                     bp-&gt;vec[0]+= fac*grid;
<a name="l06399"></a>06399                     fac= (float)b -1.5f;
<a name="l06400"></a>06400                     bp-&gt;vec[1]+= fac*grid;
<a name="l06401"></a>06401                     <span class="keywordflow">if</span> (a==1 || a==2) <span class="keywordflow">if</span> (b==1 || b==2) {
<a name="l06402"></a>06402                         bp-&gt;vec[2]+= grid;
<a name="l06403"></a>06403                     }
<a name="l06404"></a>06404                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(mat,bp-&gt;vec);
<a name="l06405"></a>06405                     bp-&gt;vec[3]= 1.0;
<a name="l06406"></a>06406                     bp++;
<a name="l06407"></a>06407                 }
<a name="l06408"></a>06408             }
<a name="l06409"></a>06409 
<a name="l06410"></a>06410             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>);
<a name="l06411"></a>06411             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67a9890171625dedc07c1b7566703ddb">nurbs_knot_calc_v</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>);
<a name="l06412"></a>06412         }
<a name="l06413"></a>06413         <span class="keywordflow">break</span>;
<a name="l06414"></a>06414     <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a584e021f14e88bffc223599430553a8d">CU_PRIM_TUBE</a>:  <span class="comment">/* Cylinder */</span>
<a name="l06415"></a>06415         <span class="keywordflow">if</span> ( cutype==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a> ) {
<a name="l06416"></a>06416             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>= <a class="code" href="../../d7/d55/editcurve_8c.html#affa215ec8eb52b390a6801429601dc09">add_nurbs_primitive</a>(C, mat, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#acd4cbed727dddb2664c7b31abc781006">CU_PRIM_CIRCLE</a>, 0);  <span class="comment">/* circle */</span>
<a name="l06417"></a>06417             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#aa4d5f2ef5e32e94dcbe14a1a7d946a30">resolu</a>= cu-&gt;resolu;
<a name="l06418"></a>06418             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a3cf1c2dec47235e64740549f9bb2b5ff">flag</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a52776b893e7d78f3276b98e0b9f56cc1">CU_SMOOTH</a>;
<a name="l06419"></a>06419             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(editnurb, <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>); <span class="comment">/* temporal for extrude and translate */</span>
<a name="l06420"></a>06420             <a class="code" href="../../d2/d83/structNurbSort.html#a5bbbd50dea6dc44f8cd1214e1ac87fe4">vec</a>[0]=<a class="code" href="../../d2/d83/structNurbSort.html#a5bbbd50dea6dc44f8cd1214e1ac87fe4">vec</a>[1]= 0.0;
<a name="l06421"></a>06421             <a class="code" href="../../d2/d83/structNurbSort.html#a5bbbd50dea6dc44f8cd1214e1ac87fe4">vec</a>[2]= -grid;
<a name="l06422"></a>06422             
<a name="l06423"></a>06423             <span class="keywordflow">if</span> (newob &amp;&amp; (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.flag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a77b2559064358b40097c406230b89576">USER_ADD_VIEWALIGNED</a>) == 0) {
<a name="l06424"></a>06424                 <span class="comment">/* pass */</span>
<a name="l06425"></a>06425             }
<a name="l06426"></a>06426             <span class="keywordflow">else</span> {
<a name="l06427"></a>06427                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad5cae73de10c30273f8c0fdc00fa648c">mul_mat3_m4_v3</a>(mat, <a class="code" href="../../d2/d83/structNurbSort.html#a5bbbd50dea6dc44f8cd1214e1ac87fe4">vec</a>);
<a name="l06428"></a>06428             }
<a name="l06429"></a>06429 
<a name="l06430"></a>06430             <a class="code" href="../../d7/d55/editcurve_8c.html#a48a612e2dee791d95090cf59ef1c8cc0">translateflagNurb</a>(editnurb, 1, <a class="code" href="../../d2/d83/structNurbSort.html#a5bbbd50dea6dc44f8cd1214e1ac87fe4">vec</a>);
<a name="l06431"></a>06431             <a class="code" href="../../d7/d55/editcurve_8c.html#a0140a436787b2f39ff2a2313ff47a796">extrudeflagNurb</a>(cu-&gt;editnurb, 1);
<a name="l06432"></a>06432             <a class="code" href="../../d2/d83/structNurbSort.html#a5bbbd50dea6dc44f8cd1214e1ac87fe4">vec</a>[0]= -2*<a class="code" href="../../d2/d83/structNurbSort.html#a5bbbd50dea6dc44f8cd1214e1ac87fe4">vec</a>[0]; 
<a name="l06433"></a>06433             <a class="code" href="../../d2/d83/structNurbSort.html#a5bbbd50dea6dc44f8cd1214e1ac87fe4">vec</a>[1]= -2*<a class="code" href="../../d2/d83/structNurbSort.html#a5bbbd50dea6dc44f8cd1214e1ac87fe4">vec</a>[1]; 
<a name="l06434"></a>06434             <a class="code" href="../../d2/d83/structNurbSort.html#a5bbbd50dea6dc44f8cd1214e1ac87fe4">vec</a>[2]= -2*<a class="code" href="../../d2/d83/structNurbSort.html#a5bbbd50dea6dc44f8cd1214e1ac87fe4">vec</a>[2];
<a name="l06435"></a>06435             <a class="code" href="../../d7/d55/editcurve_8c.html#a48a612e2dee791d95090cf59ef1c8cc0">translateflagNurb</a>(editnurb, 1, <a class="code" href="../../d2/d83/structNurbSort.html#a5bbbd50dea6dc44f8cd1214e1ac87fe4">vec</a>);
<a name="l06436"></a>06436 
<a name="l06437"></a>06437             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(editnurb, <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>);
<a name="l06438"></a>06438 
<a name="l06439"></a>06439             a= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l06440"></a>06440             bp= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l06441"></a>06441             <span class="keywordflow">while</span> (a-- &gt;0) {
<a name="l06442"></a>06442                 bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> |= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l06443"></a>06443                 bp++;
<a name="l06444"></a>06444             }
<a name="l06445"></a>06445         }
<a name="l06446"></a>06446         <span class="keywordflow">break</span>;
<a name="l06447"></a>06447     <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aa61bc3448d205c5a86b8d26c2ca1d071">CU_PRIM_SPHERE</a>:    <span class="comment">/* sphere */</span>
<a name="l06448"></a>06448         <span class="keywordflow">if</span> ( cutype==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a> ) {
<a name="l06449"></a>06449             <span class="keywordtype">float</span> tmp_cent[3] = {0.f, 0.f, 0.f};
<a name="l06450"></a>06450             <span class="keywordtype">float</span> tmp_vec[3] = {0.f, 0.f, 1.f};
<a name="l06451"></a>06451             
<a name="l06452"></a>06452             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>= 5;
<a name="l06453"></a>06453             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>= 1;
<a name="l06454"></a>06454             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>= 3;
<a name="l06455"></a>06455             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#aa4d5f2ef5e32e94dcbe14a1a7d946a30">resolu</a>= cu-&gt;resolu;
<a name="l06456"></a>06456             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#ab9ca5b497098466d579b0343cbe62ae7">resolv</a>= cu-&gt;resolv;
<a name="l06457"></a>06457             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a3cf1c2dec47235e64740549f9bb2b5ff">flag</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a52776b893e7d78f3276b98e0b9f56cc1">CU_SMOOTH</a>;
<a name="l06458"></a>06458             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= <a class="code" href="../../d7/d55/editcurve_8c.html#a444b040d2e5c83849d98d1d2043025c9">callocstructN</a>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>, 5, <span class="stringliteral">&quot;addNurbprim6&quot;</span>);
<a name="l06459"></a>06459             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a>= 0;
<a name="l06460"></a>06460             bp= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l06461"></a>06461 
<a name="l06462"></a>06462             <span class="keywordflow">for</span> (a=0; a&lt;5; a++) {
<a name="l06463"></a>06463                 bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a>= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l06464"></a>06464                 bp-&gt;vec[0]+= <a class="code" href="../../d7/d55/editcurve_8c.html#a5c5be76591ef8a4025c7db4a77f32a02">nurbcircle</a>[a][0]*grid;
<a name="l06465"></a>06465                 bp-&gt;vec[2]+= <a class="code" href="../../d7/d55/editcurve_8c.html#a5c5be76591ef8a4025c7db4a77f32a02">nurbcircle</a>[a][1]*grid;
<a name="l06466"></a>06466                 <span class="keywordflow">if</span> (a &amp; 1) bp-&gt;vec[3]= 0.5*<a class="code" href="../../dd/d06/BLI__math__base_8h.html#a66b3ab30f1332874326ed93969e496e0">M_SQRT2</a>;
<a name="l06467"></a>06467                 <span class="keywordflow">else</span> bp-&gt;vec[3]= 1.0;
<a name="l06468"></a>06468                 <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(mat,bp-&gt;vec);
<a name="l06469"></a>06469                 bp++;
<a name="l06470"></a>06470             }
<a name="l06471"></a>06471             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a644364540eb9666e65a7039995b0fef8">CU_NURB_BEZIER</a>;
<a name="l06472"></a>06472             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>);
<a name="l06473"></a>06473 
<a name="l06474"></a>06474             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(editnurb, <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>); <span class="comment">/* temporal for spin */</span>
<a name="l06475"></a>06475 
<a name="l06476"></a>06476             <span class="keywordflow">if</span> (newob &amp;&amp; (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.flag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a77b2559064358b40097c406230b89576">USER_ADD_VIEWALIGNED</a>) == 0)  <a class="code" href="../../d7/d55/editcurve_8c.html#a5ab5e106f5ec6e8b982239cfef46c168">spin_nurb</a>(umat, obedit, tmp_vec, tmp_cent);
<a name="l06477"></a>06477             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.flag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a77b2559064358b40097c406230b89576">USER_ADD_VIEWALIGNED</a>))           <a class="code" href="../../d7/d55/editcurve_8c.html#a5ab5e106f5ec6e8b982239cfef46c168">spin_nurb</a>(viewmat, obedit, zvec, mat[3]);
<a name="l06478"></a>06478             <span class="keywordflow">else</span>                                                <a class="code" href="../../d7/d55/editcurve_8c.html#a5ab5e106f5ec6e8b982239cfef46c168">spin_nurb</a>(umat, obedit, tmp_vec, mat[3]);
<a name="l06479"></a>06479 
<a name="l06480"></a>06480             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67a9890171625dedc07c1b7566703ddb">nurbs_knot_calc_v</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>);
<a name="l06481"></a>06481 
<a name="l06482"></a>06482             a= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l06483"></a>06483             bp= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l06484"></a>06484             <span class="keywordflow">while</span> (a-- &gt;0) {
<a name="l06485"></a>06485                 bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> |= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l06486"></a>06486                 bp++;
<a name="l06487"></a>06487             }
<a name="l06488"></a>06488             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(editnurb, <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>);
<a name="l06489"></a>06489         }
<a name="l06490"></a>06490         <span class="keywordflow">break</span>;
<a name="l06491"></a>06491     <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abd3166a83b593327c1dc1c3ad091a638">CU_PRIM_DONUT</a>: <span class="comment">/* torus */</span>
<a name="l06492"></a>06492         <span class="keywordflow">if</span> ( cutype==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a> ) {
<a name="l06493"></a>06493             <span class="keywordtype">float</span> tmp_cent[3] = {0.f, 0.f, 0.f};
<a name="l06494"></a>06494             <span class="keywordtype">float</span> tmp_vec[3] = {0.f, 0.f, 1.f};
<a name="l06495"></a>06495             
<a name="l06496"></a>06496             xzproj= 1;
<a name="l06497"></a>06497             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>= <a class="code" href="../../d7/d55/editcurve_8c.html#affa215ec8eb52b390a6801429601dc09">add_nurbs_primitive</a>(C, mat, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#acd4cbed727dddb2664c7b31abc781006">CU_PRIM_CIRCLE</a>, 0);  <span class="comment">/* circle */</span>
<a name="l06498"></a>06498             xzproj= 0;
<a name="l06499"></a>06499             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#aa4d5f2ef5e32e94dcbe14a1a7d946a30">resolu</a>= cu-&gt;resolu;
<a name="l06500"></a>06500             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#ab9ca5b497098466d579b0343cbe62ae7">resolv</a>= cu-&gt;resolv;
<a name="l06501"></a>06501             <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a3cf1c2dec47235e64740549f9bb2b5ff">flag</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a52776b893e7d78f3276b98e0b9f56cc1">CU_SMOOTH</a>;
<a name="l06502"></a>06502             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(editnurb, <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>); <span class="comment">/* temporal for spin */</span>
<a name="l06503"></a>06503 
<a name="l06504"></a>06504             <span class="comment">/* same as above */</span>
<a name="l06505"></a>06505             <span class="keywordflow">if</span> (newob &amp;&amp; (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.flag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a77b2559064358b40097c406230b89576">USER_ADD_VIEWALIGNED</a>) == 0)  <a class="code" href="../../d7/d55/editcurve_8c.html#a5ab5e106f5ec6e8b982239cfef46c168">spin_nurb</a>(umat, obedit, tmp_vec, tmp_cent);
<a name="l06506"></a>06506             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.flag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a77b2559064358b40097c406230b89576">USER_ADD_VIEWALIGNED</a>))           <a class="code" href="../../d7/d55/editcurve_8c.html#a5ab5e106f5ec6e8b982239cfef46c168">spin_nurb</a>(viewmat, obedit, zvec, mat[3]);
<a name="l06507"></a>06507             <span class="keywordflow">else</span>                                                <a class="code" href="../../d7/d55/editcurve_8c.html#a5ab5e106f5ec6e8b982239cfef46c168">spin_nurb</a>(umat, obedit, tmp_vec, mat[3]);
<a name="l06508"></a>06508 
<a name="l06509"></a>06509 
<a name="l06510"></a>06510             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(editnurb, <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>);
<a name="l06511"></a>06511 
<a name="l06512"></a>06512             a= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l06513"></a>06513             bp= <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l06514"></a>06514             <span class="keywordflow">while</span> (a-- &gt;0) {
<a name="l06515"></a>06515                 bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> |= <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>;
<a name="l06516"></a>06516                 bp++;
<a name="l06517"></a>06517             }
<a name="l06518"></a>06518 
<a name="l06519"></a>06519         }
<a name="l06520"></a>06520         <span class="keywordflow">break</span>;
<a name="l06521"></a>06521 
<a name="l06522"></a>06522     <span class="keywordflow">default</span>: <span class="comment">/* should never happen */</span>
<a name="l06523"></a>06523         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>(!<span class="stringliteral">&quot;invalid nurbs type&quot;</span>);
<a name="l06524"></a>06524         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06525"></a>06525     }
<a name="l06526"></a>06526 
<a name="l06527"></a>06527     <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l06528"></a>06528 
<a name="l06529"></a>06529     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>) { <span class="comment">/* should always be set */</span>
<a name="l06530"></a>06530         <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>-&gt;<a class="code" href="../../d5/d47/structNurb.html#a3cf1c2dec47235e64740549f9bb2b5ff">flag</a> |= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a52776b893e7d78f3276b98e0b9f56cc1">CU_SMOOTH</a>;
<a name="l06531"></a>06531 
<a name="l06532"></a>06532         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aae5669b490cbbe44c59fba3239f4223a">test2DNurb</a>(<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>);
<a name="l06533"></a>06533     }
<a name="l06534"></a>06534 
<a name="l06535"></a>06535     <span class="keywordflow">return</span> <a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l06536"></a>06536 }
<a name="l06537"></a>06537 
<a name="l06538"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a3861add30c7d1d9fae80630f210c48af">06538</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a3861add30c7d1d9fae80630f210c48af">curvesurf_prim_add</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <span class="keywordtype">int</span> type, <span class="keywordtype">int</span> isSurf)
<a name="l06539"></a>06539 {
<a name="l06540"></a>06540     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l06541"></a>06541     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb;
<a name="l06542"></a>06542     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l06543"></a>06543     <span class="keywordtype">int</span> newob= 0;
<a name="l06544"></a>06544     <span class="keywordtype">int</span> enter_editmode, is_aligned;
<a name="l06545"></a>06545     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> layer;
<a name="l06546"></a>06546     <span class="keywordtype">float</span> loc[3], <a class="code" href="../../df/d5a/svm__noise_8h.html#aae44e21ada356d9d84450d5440fbb0c4">rot</a>[3];
<a name="l06547"></a>06547     <span class="keywordtype">float</span> mat[4][4];
<a name="l06548"></a>06548 
<a name="l06549"></a>06549     <span class="keywordflow">if</span> (!<a class="code" href="../../da/d7a/ED__object_8h.html#a217019d5cf10a4ca2e957404e169814e">ED_object_add_generic_get_opts</a>(C, op, loc, rot, &amp;enter_editmode, &amp;layer, &amp;is_aligned))
<a name="l06550"></a>06550         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l06551"></a>06551 
<a name="l06552"></a>06552     <span class="keywordflow">if</span> (!isSurf) { <span class="comment">/* adding curve */</span>
<a name="l06553"></a>06553         <span class="keywordflow">if</span> (obedit==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>!=<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>) {
<a name="l06554"></a>06554             <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu;
<a name="l06555"></a>06555             
<a name="l06556"></a>06556             obedit= <a class="code" href="../../da/d7a/ED__object_8h.html#a5484e768b70ed4364e788908129145fa">ED_object_add_type</a>(C, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>, loc, rot, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, layer);
<a name="l06557"></a>06557             newob = 1;
<a name="l06558"></a>06558 
<a name="l06559"></a>06559             cu= (<a class="code" href="../../da/d10/structCurve.html">Curve</a>*)obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l06560"></a>06560             cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> |= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ad3795c4dcfb3b98c3c98bc6abd9389c8">CU_DEFORM_FILL</a>;
<a name="l06561"></a>06561             
<a name="l06562"></a>06562             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (type &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a9889cf561b07057c7f4ee9984f9c2aec">CU_PRIM_PATH</a>)
<a name="l06563"></a>06563                 cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> |= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae59d98d3a2c7e6fddf4aa7fff72bcf88">CU_PATH</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae2e952bfa23ce6735422c9e7bae27dac">CU_3D</a>;
<a name="l06564"></a>06564         } 
<a name="l06565"></a>06565         <span class="keywordflow">else</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(&amp;obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>);
<a name="l06566"></a>06566     } 
<a name="l06567"></a>06567     <span class="keywordflow">else</span> { <span class="comment">/* adding surface */</span>
<a name="l06568"></a>06568         <span class="keywordflow">if</span> (obedit==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>!=<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>) {
<a name="l06569"></a>06569             obedit= <a class="code" href="../../da/d7a/ED__object_8h.html#a5484e768b70ed4364e788908129145fa">ED_object_add_type</a>(C, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>, loc, rot, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, layer);
<a name="l06570"></a>06570             newob = 1;
<a name="l06571"></a>06571         } 
<a name="l06572"></a>06572         <span class="keywordflow">else</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(&amp;obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>);
<a name="l06573"></a>06573     }
<a name="l06574"></a>06574 
<a name="l06575"></a>06575     <span class="comment">/* rename here, the undo stack checks name for valid undo pushes */</span>
<a name="l06576"></a>06576     <span class="keywordflow">if</span> (newob) {
<a name="l06577"></a>06577 
<a name="l06578"></a>06578         <span class="keywordflow">if</span> (obedit-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>) {
<a name="l06579"></a>06579             <a class="code" href="../../d8/db1/BKE__library_8h.html#a16cc53dc9c28e8f37500f0f255009876">rename_id</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)obedit, <a class="code" href="../../d7/d55/editcurve_8c.html#a8aa222044d9a553c0be58e6fd06300c8">get_curve_defname</a>(type));
<a name="l06580"></a>06580             <a class="code" href="../../d8/db1/BKE__library_8h.html#a16cc53dc9c28e8f37500f0f255009876">rename_id</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)obedit-&gt;data, <a class="code" href="../../d7/d55/editcurve_8c.html#a8aa222044d9a553c0be58e6fd06300c8">get_curve_defname</a>(type));
<a name="l06581"></a>06581         }
<a name="l06582"></a>06582         <span class="keywordflow">else</span> {
<a name="l06583"></a>06583             <a class="code" href="../../d8/db1/BKE__library_8h.html#a16cc53dc9c28e8f37500f0f255009876">rename_id</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)obedit, <a class="code" href="../../d7/d55/editcurve_8c.html#a935125b7c024fc65e459ce91ac034b06">get_surf_defname</a>(type));
<a name="l06584"></a>06584             <a class="code" href="../../d8/db1/BKE__library_8h.html#a16cc53dc9c28e8f37500f0f255009876">rename_id</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)obedit-&gt;data, <a class="code" href="../../d7/d55/editcurve_8c.html#a935125b7c024fc65e459ce91ac034b06">get_surf_defname</a>(type));
<a name="l06585"></a>06585         }
<a name="l06586"></a>06586     }
<a name="l06587"></a>06587     
<a name="l06588"></a>06588     <span class="comment">/* ED_object_add_type doesnt do an undo, is needed for redo operator on primitive */</span>
<a name="l06589"></a>06589     <span class="keywordflow">if</span> (newob &amp;&amp; enter_editmode)
<a name="l06590"></a>06590         <a class="code" href="../../d6/df1/ED__util_8h.html#aa768644f80c2e60cce352dcc11970d1f">ED_undo_push</a>(C, <span class="stringliteral">&quot;Enter Editmode&quot;</span>);
<a name="l06591"></a>06591     
<a name="l06592"></a>06592     <a class="code" href="../../da/d7a/ED__object_8h.html#a95acc59df06ca14710eed22e27532a89">ED_object_new_primitive_matrix</a>(C, obedit, loc, rot, mat);
<a name="l06593"></a>06593 
<a name="l06594"></a>06594     nu= <a class="code" href="../../d7/d55/editcurve_8c.html#affa215ec8eb52b390a6801429601dc09">add_nurbs_primitive</a>(C, mat, type, newob);
<a name="l06595"></a>06595     editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l06596"></a>06596     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(editnurb, nu);
<a name="l06597"></a>06597 
<a name="l06598"></a>06598     <span class="comment">/* userdef */</span>
<a name="l06599"></a>06599     <span class="keywordflow">if</span> (newob &amp;&amp; !enter_editmode) {
<a name="l06600"></a>06600         <a class="code" href="../../da/d7a/ED__object_8h.html#a3dc41f10c2da040464140768d2898865">ED_object_exit_editmode</a>(C, <a class="code" href="../../da/d7a/ED__object_8h.html#a56f58f037f42277d234426571ee2de12">EM_FREEDATA</a>);
<a name="l06601"></a>06601     }
<a name="l06602"></a>06602 
<a name="l06603"></a>06603     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#ad7623342a2e6e2b7e66123bbdf2975da">NC_OBJECT</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a1f2c5ee380a0a55abaf43b7bceeb7688">ND_DRAW</a>, obedit);
<a name="l06604"></a>06604 
<a name="l06605"></a>06605     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l06606"></a>06606 }
<a name="l06607"></a>06607 
<a name="l06608"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a8f548ddc0b1a62a7cace211a79d31232">06608</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a8f548ddc0b1a62a7cace211a79d31232">curve_prim_add</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <span class="keywordtype">int</span> type)
<a name="l06609"></a>06609 {
<a name="l06610"></a>06610     <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a3861add30c7d1d9fae80630f210c48af">curvesurf_prim_add</a>(C, op, type, 0);
<a name="l06611"></a>06611 }
<a name="l06612"></a>06612 
<a name="l06613"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ab2271ccb76c8b442d94a84bab0a6f820">06613</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ab2271ccb76c8b442d94a84bab0a6f820">surf_prim_add</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <span class="keywordtype">int</span> type)
<a name="l06614"></a>06614 {
<a name="l06615"></a>06615     <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a3861add30c7d1d9fae80630f210c48af">curvesurf_prim_add</a>(C, op, type, 1);
<a name="l06616"></a>06616 }
<a name="l06617"></a>06617 
<a name="l06618"></a>06618 <span class="comment">/* ******************** Curves ******************* */</span>
<a name="l06619"></a>06619 
<a name="l06620"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a327590eb6369e608030588c947ac99ae">06620</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a327590eb6369e608030588c947ac99ae">add_primitive_bezier_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l06621"></a>06621 {
<a name="l06622"></a>06622     <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a8f548ddc0b1a62a7cace211a79d31232">curve_prim_add</a>(C, op, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#acf94590379616d11f84d3388d418f804">CU_PRIM_CURVE</a>);
<a name="l06623"></a>06623 }
<a name="l06624"></a>06624 
<a name="l06625"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a3b593739e90a98c259a565f26fe5a042">06625</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#ad7e5db1e8cca2e6161bb975401c00ca5">CURVE_OT_primitive_bezier_curve_add</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l06626"></a>06626 {
<a name="l06627"></a>06627     <span class="comment">/* identifiers */</span>
<a name="l06628"></a>06628     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Bezier&quot;</span>;
<a name="l06629"></a>06629     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Construct a Bezier Curve&quot;</span>;
<a name="l06630"></a>06630     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_primitive_bezier_curve_add&quot;</span>;
<a name="l06631"></a>06631     
<a name="l06632"></a>06632     <span class="comment">/* api callbacks */</span>
<a name="l06633"></a>06633     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../da/d7a/ED__object_8h.html#a22b89ae8583444f7e94c1459753b99c0">ED_object_add_generic_invoke</a>;
<a name="l06634"></a>06634     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a327590eb6369e608030588c947ac99ae">add_primitive_bezier_exec</a>;
<a name="l06635"></a>06635     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac89d9d0a801fbd0ea575600395b5caca">ED_operator_scene_editable</a>;
<a name="l06636"></a>06636     
<a name="l06637"></a>06637     <span class="comment">/* flags */</span>
<a name="l06638"></a>06638     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l06639"></a>06639 
<a name="l06640"></a>06640     <a class="code" href="../../da/d7a/ED__object_8h.html#acf991fb931df6eadc3e1965180027cf1">ED_object_add_generic_props</a>(ot, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06641"></a>06641 }
<a name="l06642"></a>06642 
<a name="l06643"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a33c2b0c0bbfc909090c53ae6ad3fca77">06643</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a33c2b0c0bbfc909090c53ae6ad3fca77">add_primitive_bezier_circle_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l06644"></a>06644 {
<a name="l06645"></a>06645     <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a8f548ddc0b1a62a7cace211a79d31232">curve_prim_add</a>(C, op, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#acd4cbed727dddb2664c7b31abc781006">CU_PRIM_CIRCLE</a>);
<a name="l06646"></a>06646 }
<a name="l06647"></a>06647 
<a name="l06648"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a5f522f9a8bc05c551a7abbc0afc0c1d4">06648</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#afdf93a77d7ca0cb6c782a23dbe431a34">CURVE_OT_primitive_bezier_circle_add</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l06649"></a>06649 {
<a name="l06650"></a>06650     <span class="comment">/* identifiers */</span>
<a name="l06651"></a>06651     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Bezier Circle&quot;</span>;
<a name="l06652"></a>06652     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Construct a Bezier Circle&quot;</span>;
<a name="l06653"></a>06653     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_primitive_bezier_circle_add&quot;</span>;
<a name="l06654"></a>06654     
<a name="l06655"></a>06655     <span class="comment">/* api callbacks */</span>
<a name="l06656"></a>06656     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../da/d7a/ED__object_8h.html#a22b89ae8583444f7e94c1459753b99c0">ED_object_add_generic_invoke</a>;
<a name="l06657"></a>06657     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a33c2b0c0bbfc909090c53ae6ad3fca77">add_primitive_bezier_circle_exec</a>;
<a name="l06658"></a>06658     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac89d9d0a801fbd0ea575600395b5caca">ED_operator_scene_editable</a>;
<a name="l06659"></a>06659     
<a name="l06660"></a>06660     <span class="comment">/* flags */</span>
<a name="l06661"></a>06661     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l06662"></a>06662 
<a name="l06663"></a>06663     <a class="code" href="../../da/d7a/ED__object_8h.html#acf991fb931df6eadc3e1965180027cf1">ED_object_add_generic_props</a>(ot, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06664"></a>06664 }
<a name="l06665"></a>06665 
<a name="l06666"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a58ecb011e9d436bb157aaf2303dad02c">06666</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a58ecb011e9d436bb157aaf2303dad02c">add_primitive_nurbs_curve_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l06667"></a>06667 {
<a name="l06668"></a>06668     <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a8f548ddc0b1a62a7cace211a79d31232">curve_prim_add</a>(C, op, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#acf94590379616d11f84d3388d418f804">CU_PRIM_CURVE</a>);
<a name="l06669"></a>06669 }
<a name="l06670"></a>06670 
<a name="l06671"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a8c897820419ba13dcb788d4e1a0eb038">06671</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a3e87272ece4ea9200049667a8ae09b4c">CURVE_OT_primitive_nurbs_curve_add</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l06672"></a>06672 {
<a name="l06673"></a>06673     <span class="comment">/* identifiers */</span>
<a name="l06674"></a>06674     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Nurbs Curve&quot;</span>;
<a name="l06675"></a>06675     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Construct a Nurbs Curve&quot;</span>;
<a name="l06676"></a>06676     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_primitive_nurbs_curve_add&quot;</span>;
<a name="l06677"></a>06677     
<a name="l06678"></a>06678     <span class="comment">/* api callbacks */</span>
<a name="l06679"></a>06679     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../da/d7a/ED__object_8h.html#a22b89ae8583444f7e94c1459753b99c0">ED_object_add_generic_invoke</a>;
<a name="l06680"></a>06680     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a58ecb011e9d436bb157aaf2303dad02c">add_primitive_nurbs_curve_exec</a>;
<a name="l06681"></a>06681     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac89d9d0a801fbd0ea575600395b5caca">ED_operator_scene_editable</a>;
<a name="l06682"></a>06682     
<a name="l06683"></a>06683     <span class="comment">/* flags */</span>
<a name="l06684"></a>06684     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l06685"></a>06685 
<a name="l06686"></a>06686     <a class="code" href="../../da/d7a/ED__object_8h.html#acf991fb931df6eadc3e1965180027cf1">ED_object_add_generic_props</a>(ot, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06687"></a>06687 }
<a name="l06688"></a>06688 
<a name="l06689"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a505e77313dba3a2a8fe373f3a1c86dd3">06689</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a505e77313dba3a2a8fe373f3a1c86dd3">add_primitive_nurbs_circle_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l06690"></a>06690 {
<a name="l06691"></a>06691     <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a8f548ddc0b1a62a7cace211a79d31232">curve_prim_add</a>(C, op, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#acd4cbed727dddb2664c7b31abc781006">CU_PRIM_CIRCLE</a>);
<a name="l06692"></a>06692 }
<a name="l06693"></a>06693 
<a name="l06694"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a667a0c7857dd1b49d7a96e00984d60e6">06694</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a10a28b79734a41b581c8054ed0f50bb0">CURVE_OT_primitive_nurbs_circle_add</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l06695"></a>06695 {
<a name="l06696"></a>06696     <span class="comment">/* identifiers */</span>
<a name="l06697"></a>06697     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Nurbs Circle&quot;</span>;
<a name="l06698"></a>06698     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Construct a Nurbs Circle&quot;</span>;
<a name="l06699"></a>06699     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_primitive_nurbs_circle_add&quot;</span>;
<a name="l06700"></a>06700     
<a name="l06701"></a>06701     <span class="comment">/* api callbacks */</span>
<a name="l06702"></a>06702     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../da/d7a/ED__object_8h.html#a22b89ae8583444f7e94c1459753b99c0">ED_object_add_generic_invoke</a>;
<a name="l06703"></a>06703     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a505e77313dba3a2a8fe373f3a1c86dd3">add_primitive_nurbs_circle_exec</a>;
<a name="l06704"></a>06704     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac89d9d0a801fbd0ea575600395b5caca">ED_operator_scene_editable</a>;
<a name="l06705"></a>06705     
<a name="l06706"></a>06706     <span class="comment">/* flags */</span>
<a name="l06707"></a>06707     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l06708"></a>06708 
<a name="l06709"></a>06709     <a class="code" href="../../da/d7a/ED__object_8h.html#acf991fb931df6eadc3e1965180027cf1">ED_object_add_generic_props</a>(ot, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06710"></a>06710 }
<a name="l06711"></a>06711 
<a name="l06712"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a6532b572025bdbf49c06a8da1c629611">06712</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a6532b572025bdbf49c06a8da1c629611">add_primitive_curve_path_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l06713"></a>06713 {
<a name="l06714"></a>06714     <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a8f548ddc0b1a62a7cace211a79d31232">curve_prim_add</a>(C, op, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a9889cf561b07057c7f4ee9984f9c2aec">CU_PRIM_PATH</a>);
<a name="l06715"></a>06715 }
<a name="l06716"></a>06716 
<a name="l06717"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a2b0add940cd0f57a901ca6924fbd2507">06717</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#ace4554a83e57e008778b270a9c503fba">CURVE_OT_primitive_nurbs_path_add</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l06718"></a>06718 {
<a name="l06719"></a>06719     <span class="comment">/* identifiers */</span>
<a name="l06720"></a>06720     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Path&quot;</span>;
<a name="l06721"></a>06721     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Construct a Path&quot;</span>;
<a name="l06722"></a>06722     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_primitive_nurbs_path_add&quot;</span>;
<a name="l06723"></a>06723     
<a name="l06724"></a>06724     <span class="comment">/* api callbacks */</span>
<a name="l06725"></a>06725     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../da/d7a/ED__object_8h.html#a22b89ae8583444f7e94c1459753b99c0">ED_object_add_generic_invoke</a>;
<a name="l06726"></a>06726     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a6532b572025bdbf49c06a8da1c629611">add_primitive_curve_path_exec</a>;
<a name="l06727"></a>06727     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac89d9d0a801fbd0ea575600395b5caca">ED_operator_scene_editable</a>;
<a name="l06728"></a>06728     
<a name="l06729"></a>06729     <span class="comment">/* flags */</span>
<a name="l06730"></a>06730     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l06731"></a>06731 
<a name="l06732"></a>06732     <a class="code" href="../../da/d7a/ED__object_8h.html#acf991fb931df6eadc3e1965180027cf1">ED_object_add_generic_props</a>(ot, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06733"></a>06733 }
<a name="l06734"></a>06734 
<a name="l06735"></a>06735 <span class="comment">/* **************** NURBS surfaces ********************** */</span>
<a name="l06736"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a6cf1358edd4f9b5cbdaf172d89496d50">06736</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a6cf1358edd4f9b5cbdaf172d89496d50">add_primitive_nurbs_surface_curve_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l06737"></a>06737 {
<a name="l06738"></a>06738     <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ab2271ccb76c8b442d94a84bab0a6f820">surf_prim_add</a>(C, op, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#acf94590379616d11f84d3388d418f804">CU_PRIM_CURVE</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>);
<a name="l06739"></a>06739 }
<a name="l06740"></a>06740 
<a name="l06741"></a><a class="code" href="../../d7/d55/editcurve_8c.html#adccd5c3ccb63266bb92b1d1f2c1c607a">06741</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a4c1dba59881038de3416bce3846d9a3d">SURFACE_OT_primitive_nurbs_surface_curve_add</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l06742"></a>06742 {
<a name="l06743"></a>06743     <span class="comment">/* identifiers */</span>
<a name="l06744"></a>06744     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Surface Curve&quot;</span>;
<a name="l06745"></a>06745     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Construct a Nurbs surface Curve&quot;</span>;
<a name="l06746"></a>06746     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;SURFACE_OT_primitive_nurbs_surface_curve_add&quot;</span>;
<a name="l06747"></a>06747     
<a name="l06748"></a>06748     <span class="comment">/* api callbacks */</span>
<a name="l06749"></a>06749     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../da/d7a/ED__object_8h.html#a22b89ae8583444f7e94c1459753b99c0">ED_object_add_generic_invoke</a>;
<a name="l06750"></a>06750     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a6cf1358edd4f9b5cbdaf172d89496d50">add_primitive_nurbs_surface_curve_exec</a>;
<a name="l06751"></a>06751     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac89d9d0a801fbd0ea575600395b5caca">ED_operator_scene_editable</a>;
<a name="l06752"></a>06752     
<a name="l06753"></a>06753     <span class="comment">/* flags */</span>
<a name="l06754"></a>06754     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l06755"></a>06755 
<a name="l06756"></a>06756     <a class="code" href="../../da/d7a/ED__object_8h.html#acf991fb931df6eadc3e1965180027cf1">ED_object_add_generic_props</a>(ot, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06757"></a>06757 }
<a name="l06758"></a>06758 
<a name="l06759"></a><a class="code" href="../../d7/d55/editcurve_8c.html#afaeae5352eeea013e2713299a045b114">06759</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#afaeae5352eeea013e2713299a045b114">add_primitive_nurbs_surface_circle_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l06760"></a>06760 {
<a name="l06761"></a>06761     <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ab2271ccb76c8b442d94a84bab0a6f820">surf_prim_add</a>(C, op, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#acd4cbed727dddb2664c7b31abc781006">CU_PRIM_CIRCLE</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>);
<a name="l06762"></a>06762 }
<a name="l06763"></a>06763 
<a name="l06764"></a><a class="code" href="../../d7/d55/editcurve_8c.html#aff85d58d94930e681ec8822ba7c0388b">06764</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a97fc41780dd2fdc748dcb59393301137">SURFACE_OT_primitive_nurbs_surface_circle_add</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l06765"></a>06765 {
<a name="l06766"></a>06766     <span class="comment">/* identifiers */</span>
<a name="l06767"></a>06767     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Surface Circle&quot;</span>;
<a name="l06768"></a>06768     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Construct a Nurbs surface Circle&quot;</span>;
<a name="l06769"></a>06769     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;SURFACE_OT_primitive_nurbs_surface_circle_add&quot;</span>;
<a name="l06770"></a>06770     
<a name="l06771"></a>06771     <span class="comment">/* api callbacks */</span>
<a name="l06772"></a>06772     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../da/d7a/ED__object_8h.html#a22b89ae8583444f7e94c1459753b99c0">ED_object_add_generic_invoke</a>;
<a name="l06773"></a>06773     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#afaeae5352eeea013e2713299a045b114">add_primitive_nurbs_surface_circle_exec</a>;
<a name="l06774"></a>06774     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac89d9d0a801fbd0ea575600395b5caca">ED_operator_scene_editable</a>;
<a name="l06775"></a>06775     
<a name="l06776"></a>06776     <span class="comment">/* flags */</span>
<a name="l06777"></a>06777     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l06778"></a>06778 
<a name="l06779"></a>06779     <a class="code" href="../../da/d7a/ED__object_8h.html#acf991fb931df6eadc3e1965180027cf1">ED_object_add_generic_props</a>(ot, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06780"></a>06780 }
<a name="l06781"></a>06781 
<a name="l06782"></a><a class="code" href="../../d7/d55/editcurve_8c.html#abb9dcdf4202755b16e3b74add22ec656">06782</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#abb9dcdf4202755b16e3b74add22ec656">add_primitive_nurbs_surface_surface_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l06783"></a>06783 {
<a name="l06784"></a>06784     <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ab2271ccb76c8b442d94a84bab0a6f820">surf_prim_add</a>(C, op, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ab5f0278c9cafe45d4b65098cfa8caee7">CU_PRIM_PATCH</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>);
<a name="l06785"></a>06785 }
<a name="l06786"></a>06786 
<a name="l06787"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a766aaf6784ef40d16b74801b547970ff">06787</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#ae9387737aaf77d4b8226c5732e56786f">SURFACE_OT_primitive_nurbs_surface_surface_add</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l06788"></a>06788 {
<a name="l06789"></a>06789     <span class="comment">/* identifiers */</span>
<a name="l06790"></a>06790     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Surface Patch&quot;</span>;
<a name="l06791"></a>06791     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Construct a Nurbs surface Patch&quot;</span>;
<a name="l06792"></a>06792     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;SURFACE_OT_primitive_nurbs_surface_surface_add&quot;</span>;
<a name="l06793"></a>06793     
<a name="l06794"></a>06794     <span class="comment">/* api callbacks */</span>
<a name="l06795"></a>06795     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../da/d7a/ED__object_8h.html#a22b89ae8583444f7e94c1459753b99c0">ED_object_add_generic_invoke</a>;
<a name="l06796"></a>06796     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#abb9dcdf4202755b16e3b74add22ec656">add_primitive_nurbs_surface_surface_exec</a>;
<a name="l06797"></a>06797     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac89d9d0a801fbd0ea575600395b5caca">ED_operator_scene_editable</a>;
<a name="l06798"></a>06798     
<a name="l06799"></a>06799     <span class="comment">/* flags */</span>
<a name="l06800"></a>06800     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l06801"></a>06801 
<a name="l06802"></a>06802     <a class="code" href="../../da/d7a/ED__object_8h.html#acf991fb931df6eadc3e1965180027cf1">ED_object_add_generic_props</a>(ot, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06803"></a>06803 }
<a name="l06804"></a>06804 
<a name="l06805"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a598e5d5d3c117ee6ee8f1e29cd40baa2">06805</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a598e5d5d3c117ee6ee8f1e29cd40baa2">add_primitive_nurbs_surface_cylinder_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l06806"></a>06806 {
<a name="l06807"></a>06807     <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ab2271ccb76c8b442d94a84bab0a6f820">surf_prim_add</a>(C, op, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a584e021f14e88bffc223599430553a8d">CU_PRIM_TUBE</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>);
<a name="l06808"></a>06808 }
<a name="l06809"></a>06809 
<a name="l06810"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a9e1d439240c99053eef2b083eb6d9e91">06810</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#adf0d1119aec70831689f98a2bd039560">SURFACE_OT_primitive_nurbs_surface_cylinder_add</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l06811"></a>06811 {
<a name="l06812"></a>06812     <span class="comment">/* identifiers */</span>
<a name="l06813"></a>06813     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Surface Cylinder&quot;</span>;
<a name="l06814"></a>06814     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Construct a Nurbs surface Cylinder&quot;</span>;
<a name="l06815"></a>06815     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;SURFACE_OT_primitive_nurbs_surface_cylinder_add&quot;</span>;
<a name="l06816"></a>06816     
<a name="l06817"></a>06817     <span class="comment">/* api callbacks */</span>
<a name="l06818"></a>06818     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../da/d7a/ED__object_8h.html#a22b89ae8583444f7e94c1459753b99c0">ED_object_add_generic_invoke</a>;
<a name="l06819"></a>06819     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a598e5d5d3c117ee6ee8f1e29cd40baa2">add_primitive_nurbs_surface_cylinder_exec</a>;
<a name="l06820"></a>06820     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac89d9d0a801fbd0ea575600395b5caca">ED_operator_scene_editable</a>;
<a name="l06821"></a>06821     
<a name="l06822"></a>06822     <span class="comment">/* flags */</span>
<a name="l06823"></a>06823     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l06824"></a>06824 
<a name="l06825"></a>06825     <a class="code" href="../../da/d7a/ED__object_8h.html#acf991fb931df6eadc3e1965180027cf1">ED_object_add_generic_props</a>(ot, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06826"></a>06826 }
<a name="l06827"></a>06827 
<a name="l06828"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a27f93eccf8b112f169bbb02505bf094b">06828</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a27f93eccf8b112f169bbb02505bf094b">add_primitive_nurbs_surface_sphere_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l06829"></a>06829 {
<a name="l06830"></a>06830     <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ab2271ccb76c8b442d94a84bab0a6f820">surf_prim_add</a>(C, op, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aa61bc3448d205c5a86b8d26c2ca1d071">CU_PRIM_SPHERE</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>);
<a name="l06831"></a>06831 }
<a name="l06832"></a>06832 
<a name="l06833"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a2d1cd8a802526c5e2565b80d73d3e3af">06833</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#ace0266e44c2f48f68ab45e2d5ab8151d">SURFACE_OT_primitive_nurbs_surface_sphere_add</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l06834"></a>06834 {
<a name="l06835"></a>06835     <span class="comment">/* identifiers */</span>
<a name="l06836"></a>06836     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Surface Sphere&quot;</span>;
<a name="l06837"></a>06837     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Construct a Nurbs surface Sphere&quot;</span>;
<a name="l06838"></a>06838     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;SURFACE_OT_primitive_nurbs_surface_sphere_add&quot;</span>;
<a name="l06839"></a>06839     
<a name="l06840"></a>06840     <span class="comment">/* api callbacks */</span>
<a name="l06841"></a>06841     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../da/d7a/ED__object_8h.html#a22b89ae8583444f7e94c1459753b99c0">ED_object_add_generic_invoke</a>;
<a name="l06842"></a>06842     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#a27f93eccf8b112f169bbb02505bf094b">add_primitive_nurbs_surface_sphere_exec</a>;
<a name="l06843"></a>06843     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac89d9d0a801fbd0ea575600395b5caca">ED_operator_scene_editable</a>;
<a name="l06844"></a>06844     
<a name="l06845"></a>06845     <span class="comment">/* flags */</span>
<a name="l06846"></a>06846     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l06847"></a>06847 
<a name="l06848"></a>06848     <a class="code" href="../../da/d7a/ED__object_8h.html#acf991fb931df6eadc3e1965180027cf1">ED_object_add_generic_props</a>(ot, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06849"></a>06849 }
<a name="l06850"></a>06850 
<a name="l06851"></a><a class="code" href="../../d7/d55/editcurve_8c.html#abb83e5055700d049317853e03b66dbc1">06851</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#abb83e5055700d049317853e03b66dbc1">add_primitive_nurbs_surface_torus_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l06852"></a>06852 {
<a name="l06853"></a>06853     <span class="keywordflow">return</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ab2271ccb76c8b442d94a84bab0a6f820">surf_prim_add</a>(C, op, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abd3166a83b593327c1dc1c3ad091a638">CU_PRIM_DONUT</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>);
<a name="l06854"></a>06854 }
<a name="l06855"></a>06855 
<a name="l06856"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a60d65a2362bf3e4a74a9f9cb38aaf7f4">06856</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#afc6b7502c64e8316b373e37d1c2b6659">SURFACE_OT_primitive_nurbs_surface_torus_add</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l06857"></a>06857 {
<a name="l06858"></a>06858     <span class="comment">/* identifiers */</span>
<a name="l06859"></a>06859     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Surface Torus&quot;</span>;
<a name="l06860"></a>06860     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Construct a Nurbs surface Torus&quot;</span>;
<a name="l06861"></a>06861     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;SURFACE_OT_primitive_nurbs_surface_torus_add&quot;</span>;
<a name="l06862"></a>06862     
<a name="l06863"></a>06863     <span class="comment">/* api callbacks */</span>
<a name="l06864"></a>06864     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../da/d7a/ED__object_8h.html#a22b89ae8583444f7e94c1459753b99c0">ED_object_add_generic_invoke</a>;
<a name="l06865"></a>06865     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#abb83e5055700d049317853e03b66dbc1">add_primitive_nurbs_surface_torus_exec</a>;
<a name="l06866"></a>06866     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ac89d9d0a801fbd0ea575600395b5caca">ED_operator_scene_editable</a>;
<a name="l06867"></a>06867     
<a name="l06868"></a>06868     <span class="comment">/* flags */</span>
<a name="l06869"></a>06869     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l06870"></a>06870 
<a name="l06871"></a>06871     <a class="code" href="../../da/d7a/ED__object_8h.html#acf991fb931df6eadc3e1965180027cf1">ED_object_add_generic_props</a>(ot, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06872"></a>06872 }
<a name="l06873"></a>06873 
<a name="l06874"></a>06874 <span class="comment">/***************** clear tilt operator ********************/</span>
<a name="l06875"></a>06875 
<a name="l06876"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ae100dee559b311383fe31eddbe5f172b">06876</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ae100dee559b311383fe31eddbe5f172b">clear_tilt_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l06877"></a>06877 {
<a name="l06878"></a>06878     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l06879"></a>06879     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l06880"></a>06880     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb= <a class="code" href="../../d7/d55/editcurve_8c.html#a1c1df66281795def36aed8b5d1e996d0">object_editcurve_get</a>(obedit);
<a name="l06881"></a>06881     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>;
<a name="l06882"></a>06882     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l06883"></a>06883     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l06884"></a>06884     <span class="keywordtype">int</span> a;
<a name="l06885"></a>06885 
<a name="l06886"></a>06886     <span class="keywordflow">for</span> (nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l06887"></a>06887         <span class="keywordflow">if</span> ( nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a> ) {
<a name="l06888"></a>06888             bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l06889"></a>06889             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l06890"></a>06890             <span class="keywordflow">while</span> (a--) {
<a name="l06891"></a>06891                 <span class="keywordflow">if</span> (<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#abcf63d093f344e298763ce019f0a1cb1">BEZSELECTED_HIDDENHANDLES</a>(cu, bezt)) bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a>= 0.0;
<a name="l06892"></a>06892                 bezt++;
<a name="l06893"></a>06893             }
<a name="l06894"></a>06894         }
<a name="l06895"></a>06895         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>) {
<a name="l06896"></a>06896             bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l06897"></a>06897             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l06898"></a>06898             <span class="keywordflow">while</span> (a--) {
<a name="l06899"></a>06899                 <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aafe158be7befa08cebb7440997204cff">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a1210ec737d6ced5cf276e22e8ca277f8">alfa</a>= 0.0;
<a name="l06900"></a>06900                 bp++;
<a name="l06901"></a>06901             }
<a name="l06902"></a>06902         }
<a name="l06903"></a>06903     }
<a name="l06904"></a>06904 
<a name="l06905"></a>06905     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l06906"></a>06906     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l06907"></a>06907 
<a name="l06908"></a>06908     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l06909"></a>06909 }
<a name="l06910"></a>06910 
<a name="l06911"></a><a class="code" href="../../d7/d55/editcurve_8c.html#afc84c6f418a93f4d95ee0b44469c1ecd">06911</a> <span class="keywordtype">void</span> <a class="code" href="../../da/d11/curve__intern_8h.html#a46dd557e68cbb59227c5b32e36ab9def">CURVE_OT_tilt_clear</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l06912"></a>06912 {
<a name="l06913"></a>06913     <span class="comment">/* identifiers */</span>
<a name="l06914"></a>06914     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Clear Tilt&quot;</span>;
<a name="l06915"></a>06915     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;CURVE_OT_tilt_clear&quot;</span>;
<a name="l06916"></a>06916     
<a name="l06917"></a>06917     <span class="comment">/* api callbacks */</span>
<a name="l06918"></a>06918     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d7/d55/editcurve_8c.html#ae100dee559b311383fe31eddbe5f172b">clear_tilt_exec</a>;
<a name="l06919"></a>06919     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a443591620f4deea4cac8a4098f66d2f7">ED_operator_editcurve</a>;
<a name="l06920"></a>06920     
<a name="l06921"></a>06921     <span class="comment">/* flags */</span>
<a name="l06922"></a>06922     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l06923"></a>06923 }
<a name="l06924"></a>06924 
<a name="l06925"></a>06925 <span class="comment">/****************** undo for curves ****************/</span>
<a name="l06926"></a>06926 
<a name="l06927"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a9854940c5c00e84064e9784a3e590520">06927</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d7/d55/editcurve_8c.html#a9854940c5c00e84064e9784a3e590520">undo_check_lastsel</a>(<span class="keywordtype">void</span> *lastsel, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *newnu)
<a name="l06928"></a>06928 {
<a name="l06929"></a>06929     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l06930"></a>06930         <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *lastbezt= (<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>*)lastsel;
<a name="l06931"></a>06931         <span class="keywordflow">if</span> (lastbezt &gt;= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a> &amp;&amp; lastbezt &lt; nu-&gt;bezt + nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) {
<a name="l06932"></a>06932             <span class="keywordflow">return</span> newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a> + (lastbezt - nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>);
<a name="l06933"></a>06933         }
<a name="l06934"></a>06934     }
<a name="l06935"></a>06935     <span class="keywordflow">else</span> {
<a name="l06936"></a>06936         <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *lastbp= (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*)lastsel;
<a name="l06937"></a>06937         <span class="keywordflow">if</span> (lastbp &gt;= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> &amp;&amp; lastbp &lt; nu-&gt;bp + nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>) {
<a name="l06938"></a>06938             <span class="keywordflow">return</span> newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> + (lastbp - nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l06939"></a>06939         }
<a name="l06940"></a>06940     }
<a name="l06941"></a>06941 
<a name="l06942"></a>06942     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06943"></a>06943 }
<a name="l06944"></a>06944 
<a name="l06945"></a><a class="code" href="../../d7/d55/editcurve_8c.html#a500633ca356ad11b70914200463a060d">06945</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a500633ca356ad11b70914200463a060d">undoCurve_to_editCurve</a>(<span class="keywordtype">void</span> *ucu, <span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(edata), <span class="keywordtype">void</span> *cu_v)
<a name="l06946"></a>06946 {
<a name="l06947"></a>06947     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= cu_v;
<a name="l06948"></a>06948     <a class="code" href="../../df/d53/structUndoCurve.html">UndoCurve</a> *undoCurve= ucu;
<a name="l06949"></a>06949     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *<a class="code" href="../../d3/dcb/blender_8c.html#ad0ecd4b4b07265c1137cbb98833e4763">undobase</a>= &amp;undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#ae2e141f6cc7929f98592304e05942f1b">nubase</a>;
<a name="l06950"></a>06950     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editbase= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a444d55e9e251234b0c8e22da36a06819">curve_editnurbs</a>(cu);
<a name="l06951"></a>06951     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>, *newnu;
<a name="l06952"></a>06952     <a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>;
<a name="l06953"></a>06953     <span class="keywordtype">void</span> *lastsel= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l06954"></a>06954     <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *ad= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(&amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>);
<a name="l06955"></a>06955 
<a name="l06956"></a>06956     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aa7e3a2bafad6c23e082515885ae5294a">freeNurblist</a>(editbase);
<a name="l06957"></a>06957 
<a name="l06958"></a>06958     <span class="keywordflow">if</span> (undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#ab5741b258e7ffb727823794f800d3d3d">undoIndex</a>) {
<a name="l06959"></a>06959         <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#adc20ede3cd08276d25c11f2d02768119">BLI_ghash_free</a>(editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, (<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a53210a0b5c7bd4568f50f16dd85f04a6">GHashValFreeFP</a>)<a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>);
<a name="l06960"></a>06960         editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>= <a class="code" href="../../d7/d55/editcurve_8c.html#a1e5860bf39dbde270dca5d16069ba39e">dupli_keyIndexHash</a>(undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#ab5741b258e7ffb727823794f800d3d3d">undoIndex</a>);
<a name="l06961"></a>06961     }
<a name="l06962"></a>06962 
<a name="l06963"></a>06963     <span class="keywordflow">if</span> (ad) {
<a name="l06964"></a>06964         <span class="keywordflow">if</span> (ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>) {
<a name="l06965"></a>06965             <a class="code" href="../../da/dba/BKE__fcurve_8h.html#ab62d82f0242ead6ce4d83cf4e5d26774">free_fcurves</a>(&amp;ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>-&gt;<a class="code" href="../../d1/d48/structbAction.html#a17c9f9250f377305171640e7a4aa7666">curves</a>);
<a name="l06966"></a>06966             <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a73ae7909c6fa074a6ac39cf13cfa27c5">copy_fcurves</a>(&amp;ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>-&gt;<a class="code" href="../../d1/d48/structbAction.html#a17c9f9250f377305171640e7a4aa7666">curves</a>, &amp;undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#ae1257736ae262c1daefce6163f4dd7cc">fcurves</a>);
<a name="l06967"></a>06967         }
<a name="l06968"></a>06968 
<a name="l06969"></a>06969         <a class="code" href="../../da/dba/BKE__fcurve_8h.html#ab62d82f0242ead6ce4d83cf4e5d26774">free_fcurves</a>(&amp;ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#aaca565f031ee1209087422d8a5d77769">drivers</a>);
<a name="l06970"></a>06970         <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a73ae7909c6fa074a6ac39cf13cfa27c5">copy_fcurves</a>(&amp;ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#aaca565f031ee1209087422d8a5d77769">drivers</a>, &amp;undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#ab31bab0e99670e3166e472a1717eab9b">drivers</a>);
<a name="l06971"></a>06971     }
<a name="l06972"></a>06972 
<a name="l06973"></a>06973     <span class="comment">/* copy  */</span>
<a name="l06974"></a>06974     <span class="keywordflow">for</span> (nu= undobase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l06975"></a>06975         newnu= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a0fde69c2411c891708933b3d79c97c34">duplicateNurb</a>(nu);
<a name="l06976"></a>06976 
<a name="l06977"></a>06977         <span class="keywordflow">if</span> (lastsel == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l06978"></a>06978             lastsel= <a class="code" href="../../d7/d55/editcurve_8c.html#a9854940c5c00e84064e9784a3e590520">undo_check_lastsel</a>(undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#a000900bd8758af2441096824e84e73be">lastsel</a>, nu, newnu);
<a name="l06979"></a>06979         }
<a name="l06980"></a>06980 
<a name="l06981"></a>06981         <span class="keywordflow">if</span> (editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>) {
<a name="l06982"></a>06982             <a class="code" href="../../d7/d55/editcurve_8c.html#ad28c5c91c2bc52c176bd62438cace7d9">keyIndex_updateNurb</a>(editnurb, nu, newnu);
<a name="l06983"></a>06983         }
<a name="l06984"></a>06984 
<a name="l06985"></a>06985         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(editbase, newnu);
<a name="l06986"></a>06986     }
<a name="l06987"></a>06987 
<a name="l06988"></a>06988     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>= lastsel;
<a name="l06989"></a>06989     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5fc2001ce6a5bcf7d4f102f15d9edb2f">actnu</a>= undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#a799fb68d9b85661386a589b2fa91140b">actnu</a>;
<a name="l06990"></a>06990     <a class="code" href="../../d7/d55/editcurve_8c.html#a1a79334fb2fbb2d4951b7196c64a9edb">ED_curve_updateAnimPaths</a>(cu);
<a name="l06991"></a>06991 }
<a name="l06992"></a>06992 
<a name="l06993"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ad20064c7abdffa966324fae7a00dcb75">06993</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d7/d55/editcurve_8c.html#ad20064c7abdffa966324fae7a00dcb75">editCurve_to_undoCurve</a>(<span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(edata), <span class="keywordtype">void</span> *cu_v)
<a name="l06994"></a>06994 {
<a name="l06995"></a>06995     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= cu_v;
<a name="l06996"></a>06996     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nubase= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a444d55e9e251234b0c8e22da36a06819">curve_editnurbs</a>(cu);
<a name="l06997"></a>06997     <a class="code" href="../../df/d53/structUndoCurve.html">UndoCurve</a> *undoCurve;
<a name="l06998"></a>06998     <a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>, tmpEditnurb;
<a name="l06999"></a>06999     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>, *newnu;
<a name="l07000"></a>07000     <span class="keywordtype">void</span> *lastsel= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l07001"></a>07001     <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *ad= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(&amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>);
<a name="l07002"></a>07002 
<a name="l07003"></a>07003     undoCurve= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../df/d53/structUndoCurve.html">UndoCurve</a>), <span class="stringliteral">&quot;undoCurve&quot;</span>);
<a name="l07004"></a>07004 
<a name="l07005"></a>07005     <span class="keywordflow">if</span> (editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>) {
<a name="l07006"></a>07006         undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#ab5741b258e7ffb727823794f800d3d3d">undoIndex</a>= <a class="code" href="../../d7/d55/editcurve_8c.html#a1e5860bf39dbde270dca5d16069ba39e">dupli_keyIndexHash</a>(editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>);
<a name="l07007"></a>07007         tmpEditnurb.keyindex= undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#ab5741b258e7ffb727823794f800d3d3d">undoIndex</a>;
<a name="l07008"></a>07008     }
<a name="l07009"></a>07009 
<a name="l07010"></a>07010     <span class="keywordflow">if</span> (ad) {
<a name="l07011"></a>07011         <span class="keywordflow">if</span> (ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>)
<a name="l07012"></a>07012             <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a73ae7909c6fa074a6ac39cf13cfa27c5">copy_fcurves</a>(&amp;undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#ae1257736ae262c1daefce6163f4dd7cc">fcurves</a>, &amp;ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>-&gt;<a class="code" href="../../d1/d48/structbAction.html#a17c9f9250f377305171640e7a4aa7666">curves</a>);
<a name="l07013"></a>07013 
<a name="l07014"></a>07014         <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a73ae7909c6fa074a6ac39cf13cfa27c5">copy_fcurves</a>(&amp;undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#ab31bab0e99670e3166e472a1717eab9b">drivers</a>, &amp;ad-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#aaca565f031ee1209087422d8a5d77769">drivers</a>);
<a name="l07015"></a>07015     }
<a name="l07016"></a>07016 
<a name="l07017"></a>07017     <span class="comment">/* copy  */</span>
<a name="l07018"></a>07018     <span class="keywordflow">for</span> (nu= nubase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l07019"></a>07019         newnu= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a0fde69c2411c891708933b3d79c97c34">duplicateNurb</a>(nu);
<a name="l07020"></a>07020 
<a name="l07021"></a>07021         <span class="keywordflow">if</span> (lastsel == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l07022"></a>07022             lastsel= <a class="code" href="../../d7/d55/editcurve_8c.html#a9854940c5c00e84064e9784a3e590520">undo_check_lastsel</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>, nu, newnu);
<a name="l07023"></a>07023         }
<a name="l07024"></a>07024 
<a name="l07025"></a>07025         <span class="keywordflow">if</span> (undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#ab5741b258e7ffb727823794f800d3d3d">undoIndex</a>) {
<a name="l07026"></a>07026             <a class="code" href="../../d7/d55/editcurve_8c.html#ad28c5c91c2bc52c176bd62438cace7d9">keyIndex_updateNurb</a>(&amp;tmpEditnurb, nu, newnu);
<a name="l07027"></a>07027         }
<a name="l07028"></a>07028 
<a name="l07029"></a>07029         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#ae2e141f6cc7929f98592304e05942f1b">nubase</a>, newnu);
<a name="l07030"></a>07030     }
<a name="l07031"></a>07031 
<a name="l07032"></a>07032     undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#a000900bd8758af2441096824e84e73be">lastsel</a>= lastsel;
<a name="l07033"></a>07033     undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#a799fb68d9b85661386a589b2fa91140b">actnu</a>= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5fc2001ce6a5bcf7d4f102f15d9edb2f">actnu</a>;
<a name="l07034"></a>07034 
<a name="l07035"></a>07035     <span class="keywordflow">return</span> undoCurve;
<a name="l07036"></a>07036 }
<a name="l07037"></a>07037 
<a name="l07038"></a><a class="code" href="../../d7/d55/editcurve_8c.html#aa6724a730e396d652da0c67468b42ede">07038</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#aa6724a730e396d652da0c67468b42ede">free_undoCurve</a>(<span class="keywordtype">void</span> *ucv)
<a name="l07039"></a>07039 {
<a name="l07040"></a>07040     <a class="code" href="../../df/d53/structUndoCurve.html">UndoCurve</a> *undoCurve= ucv;
<a name="l07041"></a>07041 
<a name="l07042"></a>07042     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aa7e3a2bafad6c23e082515885ae5294a">freeNurblist</a>(&amp;undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#ae2e141f6cc7929f98592304e05942f1b">nubase</a>);
<a name="l07043"></a>07043 
<a name="l07044"></a>07044     <span class="keywordflow">if</span> (undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#ab5741b258e7ffb727823794f800d3d3d">undoIndex</a>)
<a name="l07045"></a>07045         <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#adc20ede3cd08276d25c11f2d02768119">BLI_ghash_free</a>(undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#ab5741b258e7ffb727823794f800d3d3d">undoIndex</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, (<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a53210a0b5c7bd4568f50f16dd85f04a6">GHashValFreeFP</a>)<a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>);
<a name="l07046"></a>07046 
<a name="l07047"></a>07047     <a class="code" href="../../da/dba/BKE__fcurve_8h.html#ab62d82f0242ead6ce4d83cf4e5d26774">free_fcurves</a>(&amp;undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#ae1257736ae262c1daefce6163f4dd7cc">fcurves</a>);
<a name="l07048"></a>07048     <a class="code" href="../../da/dba/BKE__fcurve_8h.html#ab62d82f0242ead6ce4d83cf4e5d26774">free_fcurves</a>(&amp;undoCurve-&gt;<a class="code" href="../../df/d53/structUndoCurve.html#ab31bab0e99670e3166e472a1717eab9b">drivers</a>);
<a name="l07049"></a>07049 
<a name="l07050"></a>07050     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(undoCurve);
<a name="l07051"></a>07051 }
<a name="l07052"></a>07052 
<a name="l07053"></a><a class="code" href="../../d7/d55/editcurve_8c.html#ab43fd0ea7d096635ee9e17b4c69a7b98">07053</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d7/d55/editcurve_8c.html#ab43fd0ea7d096635ee9e17b4c69a7b98">get_data</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l07054"></a>07054 {
<a name="l07055"></a>07055     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit= <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l07056"></a>07056     <span class="keywordflow">return</span> obedit;
<a name="l07057"></a>07057 }
<a name="l07058"></a>07058 
<a name="l07059"></a>07059 <span class="comment">/* and this is all the undo system needs to know */</span>
<a name="l07060"></a><a class="code" href="../../db/d71/ED__curve_8h.html#af5b2f81852b80ff5965e840af2c36883">07060</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a97dfdd3c8123e7c5192a4ad51296f8f8">undo_push_curve</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l07061"></a>07061 {
<a name="l07062"></a>07062     <a class="code" href="../../d6/df1/ED__util_8h.html#ab72acb872843c87ffaa182ae19ac4b67">undo_editmode_push</a>(C, name, <a class="code" href="../../d7/d55/editcurve_8c.html#ab43fd0ea7d096635ee9e17b4c69a7b98">get_data</a>, <a class="code" href="../../d7/d55/editcurve_8c.html#aa6724a730e396d652da0c67468b42ede">free_undoCurve</a>, <a class="code" href="../../d7/d55/editcurve_8c.html#a500633ca356ad11b70914200463a060d">undoCurve_to_editCurve</a>, <a class="code" href="../../d7/d55/editcurve_8c.html#ad20064c7abdffa966324fae7a00dcb75">editCurve_to_undoCurve</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l07063"></a>07063 }
<a name="l07064"></a>07064 
<a name="l07065"></a><a class="code" href="../../db/d71/ED__curve_8h.html#a8d4ad9b914bd5b566077fa410a9da07d">07065</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#a5863deb4d104d1c79f9212cbe93affd5">ED_curve_beztcpy</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *dst, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *src, <span class="keywordtype">int</span> count)
<a name="l07066"></a>07066 {
<a name="l07067"></a>07067     memcpy(dst, src, count*<span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>));
<a name="l07068"></a>07068     <a class="code" href="../../d7/d55/editcurve_8c.html#a32de29ccf344b5d4d324c8eb05212925">keyIndex_updateBezt</a>(editnurb, src, dst, count);
<a name="l07069"></a>07069 }
<a name="l07070"></a>07070 
<a name="l07071"></a><a class="code" href="../../db/d71/ED__curve_8h.html#a1373473f4eff149d2ffbb5324ca38cb2">07071</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d55/editcurve_8c.html#acc934a7779bd2eee63200ad5c7bdd0d4">ED_curve_bpcpy</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb, <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *dst, <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *src, <span class="keywordtype">int</span> count)
<a name="l07072"></a>07072 {
<a name="l07073"></a>07073     memcpy(dst, src, count*<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>));
<a name="l07074"></a>07074     <a class="code" href="../../d7/d55/editcurve_8c.html#a0233d7e5f22fabe021f3902c3127dafc">keyIndex_updateBP</a>(editnurb, src, dst, count);
<a name="l07075"></a>07075 }
<a name="l07076"></a>07076 
<a name="l07077"></a><a class="code" href="../../db/d71/ED__curve_8h.html#ad349410902a9b82a89f8cf76d5ddba76">07077</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/d55/editcurve_8c.html#ab2947bd5e3d67fbb23af87d2475c70cb">ED_curve_actSelection</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu, <span class="keywordtype">float</span> center[3])
<a name="l07078"></a>07078 {
<a name="l07079"></a>07079     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d2/d83/structNurbSort.html#a3ba8a8e7b570b3c3fc86b78f76fac1ef">nu</a>= <a class="code" href="../../d7/d55/editcurve_8c.html#a4d53eaf84cb17e7bc0ae8030e11d9cd7">get_lastsel_nurb</a>(cu);
<a name="l07080"></a>07080 
<a name="l07081"></a>07081     <span class="keywordflow">if</span> (!nu)
<a name="l07082"></a>07082         <span class="keywordflow">return</span> 0;
<a name="l07083"></a>07083 
<a name="l07084"></a>07084     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l07085"></a>07085         <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>;
<a name="l07086"></a>07086 
<a name="l07087"></a>07087         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(center, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1]);
<a name="l07088"></a>07088     }
<a name="l07089"></a>07089     <span class="keywordflow">else</span> {
<a name="l07090"></a>07090         <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a418ee6b0c4936bfb69e55dcef4045008">lastsel</a>;
<a name="l07091"></a>07091 
<a name="l07092"></a>07092         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(center, bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l07093"></a>07093     }
<a name="l07094"></a>07094 
<a name="l07095"></a>07095     <span class="keywordflow">return</span> 1;
<a name="l07096"></a>07096 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:16 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

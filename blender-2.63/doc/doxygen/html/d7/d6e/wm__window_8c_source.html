<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: wm_window.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">wm_window.c</div>  </div>
</div>
<div class="contents">
<a href="../../d7/d6e/wm__window_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version. </span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2007 Blender Foundation but based </span>
<a name="l00019"></a>00019 <span class="comment"> * on ghostwinlay.c (C) 2001-2002 by NaN Holding BV</span>
<a name="l00020"></a>00020 <span class="comment"> * All rights reserved.</span>
<a name="l00021"></a>00021 <span class="comment"> *</span>
<a name="l00022"></a>00022 <span class="comment"> * Contributor(s): Blender Foundation, 2008</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00025"></a>00025 <span class="comment"> */</span>
<a name="l00026"></a>00026 
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d43/DNA__listBase_8h.html" title="These structs are the foundation for all linked lists in the library system.">DNA_listBase.h</a>&quot;</span>   
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/da4/DNA__screen__types_8h.html">DNA_screen_types.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html">DNA_windowmanager_types.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d51/GHOST__C-api_8h.html" title="GHOST C-API function and type declarations.">GHOST_C-api.h</a>&quot;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d61/BLF__translation_8h.html">BLF_translation.h</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/ddf/BKE__blender_8h.html" title="Blender util stuff.">BKE_blender.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/db1/BKE__library_8h.html">BKE_library.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d44/BIF__gl_8h.html">BIF_gl.h</a>&quot;</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/dd6/wm_8h.html">wm.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/dfb/wm__draw_8h.html">wm_draw.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d6b/wm__window_8h.html">wm_window.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d6f/wm__subwindow_8h.html">wm_subwindow.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d44/wm__event__system_8h.html">wm_event_system.h</a>&quot;</span>
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d12/ED__screen_8h.html">ED_screen.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../db/db9/ED__fileselect_8h.html">ED_fileselect.h</a>&quot;</span>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d2e/PIL__time_8h.html">PIL_time.h</a>&quot;</span>
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/df0/GPU__draw_8h.html">GPU_draw.h</a>&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;<a class="code" href="../../da/deb/GPU__extensions_8h.html">GPU_extensions.h</a>&quot;</span>
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d1e/UI__interface_8h.html">UI_interface.h</a>&quot;</span>
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="comment">/* the global to talk to ghost */</span>
<a name="l00079"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">00079</a> <span class="keyword">static</span> GHOST_SystemHandle <a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00080"></a>00080 
<a name="l00081"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#a3ee5a57e4d05602f20642e0d45b95a2e">00081</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a3ee5a57e4d05602f20642e0d45b95a2e">WinOverrideFlag</a> {
<a name="l00082"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#a3ee5a57e4d05602f20642e0d45b95a2eaf9ba44795a5311ef93f432a3807c5550">00082</a>     <a class="code" href="../../d7/d6e/wm__window_8c.html#a3ee5a57e4d05602f20642e0d45b95a2eaf9ba44795a5311ef93f432a3807c5550">WIN_OVERRIDE_GEOM</a>     = (1 &lt;&lt; 0),
<a name="l00083"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#a3ee5a57e4d05602f20642e0d45b95a2ea3971fc61cd181c5dc28444488185c90d">00083</a>     <a class="code" href="../../d7/d6e/wm__window_8c.html#a3ee5a57e4d05602f20642e0d45b95a2ea3971fc61cd181c5dc28444488185c90d">WIN_OVERRIDE_WINSTATE</a> = (1 &lt;&lt; 1)
<a name="l00084"></a>00084 } <a class="code" href="../../d7/d6e/wm__window_8c.html#a3ee5a57e4d05602f20642e0d45b95a2e">WinOverrideFlag</a>;
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="comment">/* set by commandline */</span>
<a name="l00087"></a><a class="code" href="../../d2/d69/structWMInitStruct.html">00087</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d2/d69/structWMInitStruct.html">WMInitStruct</a> {
<a name="l00088"></a>00088     <span class="comment">/* window geometry */</span>
<a name="l00089"></a><a class="code" href="../../d2/d69/structWMInitStruct.html#aeefda7a40b4a5fb3f7878cc933ba5f71">00089</a>     <span class="keywordtype">int</span> <a class="code" href="../../d2/d69/structWMInitStruct.html#a14551253b5d67da753fb03c2369be66b">size_x</a>, <a class="code" href="../../d2/d69/structWMInitStruct.html#aeefda7a40b4a5fb3f7878cc933ba5f71">size_y</a>;
<a name="l00090"></a><a class="code" href="../../d2/d69/structWMInitStruct.html#a30681a301d1947075eaca03c35ea8a9f">00090</a>     <span class="keywordtype">int</span> <a class="code" href="../../d2/d69/structWMInitStruct.html#a9c513dfc69663c4265c4eb21d82c2ffa">start_x</a>, <a class="code" href="../../d2/d69/structWMInitStruct.html#a30681a301d1947075eaca03c35ea8a9f">start_y</a>;
<a name="l00091"></a>00091 
<a name="l00092"></a><a class="code" href="../../d2/d69/structWMInitStruct.html#aa8e13c49b4152a72a7c12552aeb43ddb">00092</a>     <span class="keywordtype">int</span> <a class="code" href="../../d2/d69/structWMInitStruct.html#aa8e13c49b4152a72a7c12552aeb43ddb">windowstate</a>;
<a name="l00093"></a><a class="code" href="../../d2/d69/structWMInitStruct.html#a4e8e702aad7310baa28916a99e922db8">00093</a>     <a class="code" href="../../d7/d6e/wm__window_8c.html#a3ee5a57e4d05602f20642e0d45b95a2e">WinOverrideFlag</a> <a class="code" href="../../d2/d69/structWMInitStruct.html#a4e8e702aad7310baa28916a99e922db8">override_flag</a>;
<a name="l00094"></a>00094 } <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a> = {0, 0, 0, 0, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ad2bf9ca21ca8bce907d58cd71e8067c6">GHOST_kWindowStateNormal</a>, 0};
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 <span class="comment">/* ******** win open &amp; close ************ */</span>
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="comment">/* XXX this one should correctly check for apple top header...</span>
<a name="l00099"></a>00099 <span class="comment"> * done for Cocoa : returns window contents (and not frame) max size*/</span>
<a name="l00100"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#ad0fb72ddeb11c4b83c096a71e78da2de">00100</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#ad0fb72ddeb11c4b83c096a71e78da2de">wm_get_screensize</a>(<span class="keywordtype">int</span> *width_r, <span class="keywordtype">int</span> *height_r)
<a name="l00101"></a>00101 {
<a name="l00102"></a>00102     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uiwidth;
<a name="l00103"></a>00103     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uiheight;
<a name="l00104"></a>00104     
<a name="l00105"></a>00105     <a class="code" href="../../db/d51/GHOST__C-api_8h.html#ae1606b74c4d73dbab2c1f45edf949a34">GHOST_GetMainDisplayDimensions</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>, &amp;uiwidth, &amp;uiheight);
<a name="l00106"></a>00106     *width_r = uiwidth;
<a name="l00107"></a>00107     *height_r = uiheight;
<a name="l00108"></a>00108 }
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 <span class="comment">/* keeps offset and size within monitor bounds */</span>
<a name="l00111"></a>00111 <span class="comment">/* XXX solve dual screen... */</span>
<a name="l00112"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#a0f42cd51208a73f0eebee1c27089f4f7">00112</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a0f42cd51208a73f0eebee1c27089f4f7">wm_window_check_position</a>(<a class="code" href="../../d0/d28/structrcti.html">rcti</a> *rect)
<a name="l00113"></a>00113 {
<a name="l00114"></a>00114     <span class="keywordtype">int</span> width, height, d;
<a name="l00115"></a>00115     
<a name="l00116"></a>00116     <a class="code" href="../../d7/d6e/wm__window_8c.html#ad0fb72ddeb11c4b83c096a71e78da2de">wm_get_screensize</a>(&amp;width, &amp;height);
<a name="l00117"></a>00117     
<a name="l00118"></a>00118 <span class="preprocessor">#if defined(__APPLE__) &amp;&amp; !defined(GHOST_COCOA)</span>
<a name="l00119"></a>00119 <span class="preprocessor"></span>    height -= 70;
<a name="l00120"></a>00120 <span class="preprocessor">#endif</span>
<a name="l00121"></a>00121 <span class="preprocessor"></span>    
<a name="l00122"></a>00122     <span class="keywordflow">if</span> (rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> &lt; 0) {
<a name="l00123"></a>00123         rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> -= rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>;
<a name="l00124"></a>00124         rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>  = 0;
<a name="l00125"></a>00125     }
<a name="l00126"></a>00126     <span class="keywordflow">if</span> (rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> &lt; 0) {
<a name="l00127"></a>00127         rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> -= rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>;
<a name="l00128"></a>00128         rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>  = 0;
<a name="l00129"></a>00129     }
<a name="l00130"></a>00130     <span class="keywordflow">if</span> (rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> &gt; width) {
<a name="l00131"></a>00131         d = rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> - width;
<a name="l00132"></a>00132         rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> -= d;
<a name="l00133"></a>00133         rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> -= d;
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135     <span class="keywordflow">if</span> (rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> &gt; height) {
<a name="l00136"></a>00136         d = rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> - height;
<a name="l00137"></a>00137         rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> -= d;
<a name="l00138"></a>00138         rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> -= d;
<a name="l00139"></a>00139     }
<a name="l00140"></a>00140     
<a name="l00141"></a>00141     <span class="keywordflow">if</span> (rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> &lt; 0) rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> = 0;
<a name="l00142"></a>00142     <span class="keywordflow">if</span> (rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> &lt; 0) rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> = 0;
<a name="l00143"></a>00143 }
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 
<a name="l00146"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#a75e76de104f8a148fa8f98db17a9ae9a">00146</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a75e76de104f8a148fa8f98db17a9ae9a">wm_ghostwindow_destroy</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win) 
<a name="l00147"></a>00147 {
<a name="l00148"></a>00148     <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>) {
<a name="l00149"></a>00149         <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a7e423b2898e3eb65ed134c117c85eabd">GHOST_DisposeWindow</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>);
<a name="l00150"></a>00150         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 <span class="comment">/* including window itself, C can be NULL. </span>
<a name="l00155"></a>00155 <span class="comment"> * ED_screen_exit should have been called */</span>
<a name="l00156"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#ada089391701235b5a2fc3d1f80ba5a8a">00156</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#ada089391701235b5a2fc3d1f80ba5a8a">wm_window_free</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm, <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win)
<a name="l00157"></a>00157 {
<a name="l00158"></a>00158     <a class="code" href="../../d9/d33/structwmTimer.html">wmTimer</a> *wt, *wtnext;
<a name="l00159"></a>00159     
<a name="l00160"></a>00160     <span class="comment">/* update context */</span>
<a name="l00161"></a>00161     <span class="keywordflow">if</span> (C) {
<a name="l00162"></a>00162         <a class="code" href="../../df/db0/wm__event__system_8c.html#afd7ef52cacacb354c1ad99d47b57855b">WM_event_remove_handlers</a>(C, &amp;win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ac05161bf3e5508b9414c5835376851b6">handlers</a>);
<a name="l00163"></a>00163         <a class="code" href="../../df/db0/wm__event__system_8c.html#afd7ef52cacacb354c1ad99d47b57855b">WM_event_remove_handlers</a>(C, &amp;win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1ea8c9176e46638bd4cd9648c7f9fae2">modalhandlers</a>);
<a name="l00164"></a>00164 
<a name="l00165"></a>00165         <span class="keywordflow">if</span> (<a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C) == win)
<a name="l00166"></a>00166             <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00167"></a>00167     }   
<a name="l00168"></a>00168 
<a name="l00169"></a>00169     <span class="comment">/* always set drawable and active to NULL,</span>
<a name="l00170"></a>00170 <span class="comment">     * prevents non-drawable state of main windows (bugs #22967 and #25071, possibly #22477 too) */</span>
<a name="l00171"></a>00171     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a977740478a98e70e33e1053cdd16dcb4">windrawable</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00172"></a>00172     wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#af6c533cdbd4dc456794e6a89d0f1fe71">winactive</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00173"></a>00173 
<a name="l00174"></a>00174     <span class="comment">/* end running jobs, a job end also removes its timer */</span>
<a name="l00175"></a>00175     <span class="keywordflow">for</span> (wt = wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a09c073df6c2cddfff3f03994c3546699">timers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; wt; wt = wtnext) {
<a name="l00176"></a>00176         wtnext = wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#aec52c7e06c39656951a111bbf66e6839">next</a>;
<a name="l00177"></a>00177         <span class="keywordflow">if</span> (wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#aed706a3554face884388138e1b949376">win</a> == win &amp;&amp; wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a103a7495ca81c7f81c0edc2eb9d98bdc">event_type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6328dc09134f736a0b95d8848b25447e">TIMERJOBS</a>)
<a name="l00178"></a>00178             <a class="code" href="../../d6/ddf/wm__jobs_8c.html#a6d8bbb5640d153d8bdfca5a3915c1db8">wm_jobs_timer_ended</a>(wm, wt);
<a name="l00179"></a>00179     }
<a name="l00180"></a>00180     
<a name="l00181"></a>00181     <span class="comment">/* timer removing, need to call this api function */</span>
<a name="l00182"></a>00182     <span class="keywordflow">for</span> (wt = wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a09c073df6c2cddfff3f03994c3546699">timers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; wt; wt = wtnext) {
<a name="l00183"></a>00183         wtnext = wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#aec52c7e06c39656951a111bbf66e6839">next</a>;
<a name="l00184"></a>00184         <span class="keywordflow">if</span> (wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#aed706a3554face884388138e1b949376">win</a> == win)
<a name="l00185"></a>00185             <a class="code" href="../../d7/d6e/wm__window_8c.html#a1a9f31ba88dd1dd3982b3d8f02de2e75">WM_event_remove_timer</a>(wm, win, wt);
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>);
<a name="l00189"></a>00189     
<a name="l00190"></a>00190     <a class="code" href="../../df/db0/wm__event__system_8c.html#a673c41499d28d22984dbd15dc605229f">wm_event_free_all</a>(win);
<a name="l00191"></a>00191     <a class="code" href="../../df/d4d/wm__subwindow_8c.html#a2634db932aeab23ccf88556cb4106393">wm_subwindows_free</a>(win);
<a name="l00192"></a>00192     
<a name="l00193"></a>00193     <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#aa43cc5770f7a2cd2e9e480f6f812fe71">drawdata</a>)
<a name="l00194"></a>00194         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#aa43cc5770f7a2cd2e9e480f6f812fe71">drawdata</a>);
<a name="l00195"></a>00195     
<a name="l00196"></a>00196     <a class="code" href="../../d7/d6e/wm__window_8c.html#a75e76de104f8a148fa8f98db17a9ae9a">wm_ghostwindow_destroy</a>(win);
<a name="l00197"></a>00197     
<a name="l00198"></a>00198     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(win);
<a name="l00199"></a>00199 }
<a name="l00200"></a>00200 
<a name="l00201"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#a9e34866049b6727a03f59753464cd446">00201</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a9e34866049b6727a03f59753464cd446">find_free_winid</a>(<a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm)
<a name="l00202"></a>00202 {
<a name="l00203"></a>00203     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win;
<a name="l00204"></a>00204     <span class="keywordtype">int</span> <span class="keywordtype">id</span> = 1;
<a name="l00205"></a>00205     
<a name="l00206"></a>00206     <span class="keywordflow">for</span> (win = wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; win; win = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#accffa1b62f114b1781206c921fc92be1">next</a>)
<a name="l00207"></a>00207         <span class="keywordflow">if</span> (id &lt;= win-&gt;winid)
<a name="l00208"></a>00208             <span class="keywordtype">id</span> = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a479ce2e14de90b31094c8415d0427f06">winid</a> + 1;
<a name="l00209"></a>00209     
<a name="l00210"></a>00210     <span class="keywordflow">return</span> id;
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 <span class="comment">/* don&#39;t change context itself */</span>
<a name="l00214"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#a4f2c73e9dab3b238e9542b7e909517aa">00214</a> <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *<a class="code" href="../../d7/d6e/wm__window_8c.html#a4f2c73e9dab3b238e9542b7e909517aa">wm_window_new</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l00215"></a>00215 {
<a name="l00216"></a>00216     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l00217"></a>00217     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a>), <span class="stringliteral">&quot;window&quot;</span>);
<a name="l00218"></a>00218     
<a name="l00219"></a>00219     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>, win);
<a name="l00220"></a>00220     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a479ce2e14de90b31094c8415d0427f06">winid</a> = <a class="code" href="../../d7/d6e/wm__window_8c.html#a9e34866049b6727a03f59753464cd446">find_free_winid</a>(wm);
<a name="l00221"></a>00221 
<a name="l00222"></a>00222     <span class="keywordflow">return</span> win;
<a name="l00223"></a>00223 }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 <span class="comment">/* part of wm_window.c api */</span>
<a name="l00227"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#af095c419bcba99a437ee212ee751d5df">00227</a> <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *<a class="code" href="../../d7/d6e/wm__window_8c.html#af095c419bcba99a437ee212ee751d5df">wm_window_copy</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *winorig)
<a name="l00228"></a>00228 {
<a name="l00229"></a>00229     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win = <a class="code" href="../../d7/d6e/wm__window_8c.html#a4f2c73e9dab3b238e9542b7e909517aa">wm_window_new</a>(C);
<a name="l00230"></a>00230     
<a name="l00231"></a>00231     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a226ce379ebcc0b691d3278c6d20e313b">posx</a> = winorig-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a226ce379ebcc0b691d3278c6d20e313b">posx</a> + 10;
<a name="l00232"></a>00232     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae754b68a91f58a8541c1226b760ac9bb">posy</a> = winorig-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae754b68a91f58a8541c1226b760ac9bb">posy</a>;
<a name="l00233"></a>00233     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a> = winorig-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a>;
<a name="l00234"></a>00234     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a> = winorig-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a>;
<a name="l00235"></a>00235     
<a name="l00236"></a>00236     <span class="comment">/* duplicate assigns to window */</span>
<a name="l00237"></a>00237     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a606f34557f83e1d3c9eeda016a3d624b">ED_screen_duplicate</a>(win, winorig-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>);
<a name="l00238"></a>00238     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a4afa0754ba536ad4f2877e448a257dac">screenname</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a> + 2, <span class="keyword">sizeof</span>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a4afa0754ba536ad4f2877e448a257dac">screenname</a>));
<a name="l00239"></a>00239     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#a022929944b7229e3652332ef1fcf30ab">winid</a> = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a479ce2e14de90b31094c8415d0427f06">winid</a>;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac46694a5caf4c4eaefea6cf9b8d77f81">do_refresh</a> = 1;
<a name="l00242"></a>00242     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#af42ea7fb025800a97c3a1fe3e5f24c5e">do_draw</a> = 1;
<a name="l00243"></a>00243 
<a name="l00244"></a>00244     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a6b5dd98c6208a6594d8183e4dc0f06dd">drawmethod</a> = -1;
<a name="l00245"></a>00245     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#aa43cc5770f7a2cd2e9e480f6f812fe71">drawdata</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00246"></a>00246     
<a name="l00247"></a>00247     <span class="keywordflow">return</span> win;
<a name="l00248"></a>00248 }
<a name="l00249"></a>00249 
<a name="l00250"></a>00250 <span class="comment">/* this is event from ghost, or exit-blender op */</span>
<a name="l00251"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#a695d80c0e7fc7b96b7cdc9705d6378ac">00251</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a695d80c0e7fc7b96b7cdc9705d6378ac">wm_window_close</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm, <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win)
<a name="l00252"></a>00252 {
<a name="l00253"></a>00253     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *tmpwin;
<a name="l00254"></a>00254     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>;
<a name="l00255"></a>00255     
<a name="l00256"></a>00256     <span class="comment">/* first check if we have any non-temp remaining windows */</span>
<a name="l00257"></a>00257     <span class="keywordflow">if</span> ((<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.uiflag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a3878c93c49f881e671c2bceeb24f342e">USER_QUIT_PROMPT</a>) &amp;&amp; !wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a3d768f736d940df5ad6b3f95f28c3de0">file_saved</a>) {
<a name="l00258"></a>00258         <span class="keywordflow">if</span> (wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l00259"></a>00259             <span class="keywordflow">for</span> (tmpwin = wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tmpwin; tmpwin = tmpwin-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#accffa1b62f114b1781206c921fc92be1">next</a>) {
<a name="l00260"></a>00260                 <span class="keywordflow">if</span> (tmpwin == win)
<a name="l00261"></a>00261                     <span class="keywordflow">continue</span>;
<a name="l00262"></a>00262                 <span class="keywordflow">if</span> (tmpwin-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae4c1fae9fb86f1ad80ae280be436cb75">temp</a> == 0)
<a name="l00263"></a>00263                     <span class="keywordflow">break</span>;
<a name="l00264"></a>00264             }
<a name="l00265"></a>00265             <span class="keywordflow">if</span> (tmpwin == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00266"></a>00266                 <span class="keywordflow">if</span> (!<a class="code" href="../../db/d51/GHOST__C-api_8h.html#afd0b8ca901c1fc6c25d2b95815ccc995">GHOST_confirmQuit</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>))
<a name="l00267"></a>00267                     <span class="keywordflow">return</span>;
<a name="l00268"></a>00268             }
<a name="l00269"></a>00269         }
<a name="l00270"></a>00270     }
<a name="l00271"></a>00271 
<a name="l00272"></a>00272     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>, win);
<a name="l00273"></a>00273     
<a name="l00274"></a>00274     <a class="code" href="../../db/dc4/wm__draw_8c.html#a5ac2ea8890c7395f454484d23ad1e8ee">wm_draw_window_clear</a>(win);
<a name="l00275"></a>00275     <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, win);  <span class="comment">/* needed by handlers */</span>
<a name="l00276"></a>00276     <a class="code" href="../../df/db0/wm__event__system_8c.html#afd7ef52cacacb354c1ad99d47b57855b">WM_event_remove_handlers</a>(C, &amp;win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ac05161bf3e5508b9414c5835376851b6">handlers</a>);
<a name="l00277"></a>00277     <a class="code" href="../../df/db0/wm__event__system_8c.html#afd7ef52cacacb354c1ad99d47b57855b">WM_event_remove_handlers</a>(C, &amp;win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1ea8c9176e46638bd4cd9648c7f9fae2">modalhandlers</a>);
<a name="l00278"></a>00278     <a class="code" href="../../d1/d12/ED__screen_8h.html#a2604af7c1ea0cec7fdcace930add202a">ED_screen_exit</a>(C, win, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>); 
<a name="l00279"></a>00279     
<a name="l00280"></a>00280     <a class="code" href="../../d7/d6e/wm__window_8c.html#ada089391701235b5a2fc3d1f80ba5a8a">wm_window_free</a>(C, wm, win);
<a name="l00281"></a>00281     
<a name="l00282"></a>00282     <span class="comment">/* if temp screen, delete it after window free (it stops jobs that can access it) */</span>
<a name="l00283"></a>00283     <span class="keywordflow">if</span> (screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae4c1fae9fb86f1ad80ae280be436cb75">temp</a>) {
<a name="l00284"></a>00284         <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain = <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C);
<a name="l00285"></a>00285         <a class="code" href="../../d8/db1/BKE__library_8h.html#abdc66d0c4d8e9f6594809313b34d2843">free_libblock</a>(&amp;bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>, screen);
<a name="l00286"></a>00286     }
<a name="l00287"></a>00287     
<a name="l00288"></a>00288     <span class="comment">/* check remaining windows */</span>
<a name="l00289"></a>00289     <span class="keywordflow">if</span> (wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l00290"></a>00290         <span class="keywordflow">for</span> (win = wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; win; win = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#accffa1b62f114b1781206c921fc92be1">next</a>)
<a name="l00291"></a>00291             <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae4c1fae9fb86f1ad80ae280be436cb75">temp</a> == 0)
<a name="l00292"></a>00292                 <span class="keywordflow">break</span>;
<a name="l00293"></a>00293         <span class="comment">/* in this case we close all */</span>
<a name="l00294"></a>00294         <span class="keywordflow">if</span> (win == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00295"></a>00295             <a class="code" href="../../df/d04/wm__init__exit_8c.html#a70afca00a010cbbb54700113a3a1db9c">WM_exit</a>(C);
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297     <span class="keywordflow">else</span>
<a name="l00298"></a>00298         <a class="code" href="../../df/d04/wm__init__exit_8c.html#a70afca00a010cbbb54700113a3a1db9c">WM_exit</a>(C);
<a name="l00299"></a>00299 }
<a name="l00300"></a>00300 
<a name="l00301"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#a499f04b3bfe24b1ffe383ccdd1ae9e5f">00301</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a499f04b3bfe24b1ffe383ccdd1ae9e5f">wm_window_title</a>(<a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm, <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win)
<a name="l00302"></a>00302 {
<a name="l00303"></a>00303     <span class="comment">/* handle the &#39;temp&#39; window, only set title when not set before */</span>
<a name="l00304"></a>00304     <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a> &amp;&amp; win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae4c1fae9fb86f1ad80ae280be436cb75">temp</a>) {
<a name="l00305"></a>00305         <span class="keywordtype">char</span> *title = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a0e3a013e35a105539865995622f6434b">GHOST_GetTitle</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>);
<a name="l00306"></a>00306         <span class="keywordflow">if</span> (title == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || title[0] == 0)
<a name="l00307"></a>00307             <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a4bfa07619981619fee9f8a6af901d143">GHOST_SetTitle</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, <span class="stringliteral">&quot;Blender&quot;</span>);
<a name="l00308"></a>00308     }
<a name="l00309"></a>00309     <span class="keywordflow">else</span> {
<a name="l00310"></a>00310         
<a name="l00311"></a>00311         <span class="comment">/* this is set to 1 if you don&#39;t have startup.blend open */</span>
<a name="l00312"></a>00312         <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.save_over &amp;&amp; <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name[0]) {
<a name="l00313"></a>00313             <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[<span class="keyword">sizeof</span>(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name) + 12];
<a name="l00314"></a>00314             <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>), <span class="stringliteral">&quot;Blender%s [%s]&quot;</span>, wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a3d768f736d940df5ad6b3f95f28c3de0">file_saved</a> ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;*&quot;</span>, <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name);
<a name="l00315"></a>00315             <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a4bfa07619981619fee9f8a6af901d143">GHOST_SetTitle</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>);
<a name="l00316"></a>00316         }
<a name="l00317"></a>00317         <span class="keywordflow">else</span>
<a name="l00318"></a>00318             <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a4bfa07619981619fee9f8a6af901d143">GHOST_SetTitle</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, <span class="stringliteral">&quot;Blender&quot;</span>);
<a name="l00319"></a>00319 
<a name="l00320"></a>00320         <span class="comment">/* Informs GHOST of unsaved changes, to set window modified visual indicator (MAC OS X)</span>
<a name="l00321"></a>00321 <span class="comment">         * and to give hint of unsaved changes for a user warning mechanism</span>
<a name="l00322"></a>00322 <span class="comment">         * in case of OS application terminate request (e.g. OS Shortcut Alt+F4, Cmd+Q, (...), or session end) */</span>
<a name="l00323"></a>00323         <a class="code" href="../../db/d51/GHOST__C-api_8h.html#ae62868cd4ce8492e04248a9bc11d25c0">GHOST_SetWindowModifiedState</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, (<a class="code" href="../../d2/d43/GHOST__Types_8h.html#ac899f59b362ca3798de49aef2fb24fff">GHOST_TUns8</a>) !wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a3d768f736d940df5ad6b3f95f28c3de0">file_saved</a>);
<a name="l00324"></a>00324         
<a name="l00325"></a>00325 <span class="preprocessor">#if defined(__APPLE__) &amp;&amp; !defined(GHOST_COCOA)</span>
<a name="l00326"></a>00326 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a3d768f736d940df5ad6b3f95f28c3de0">file_saved</a>)
<a name="l00327"></a>00327             <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a8bf16fb2369a36471613f66cdd31334a">GHOST_SetWindowState</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ab35290a9069edddbe0ecd0ea694bac8c">GHOST_kWindowStateUnModified</a>);
<a name="l00328"></a>00328         <span class="keywordflow">else</span>
<a name="l00329"></a>00329             <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a8bf16fb2369a36471613f66cdd31334a">GHOST_SetWindowState</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546aa131864bb2992308107bf96af8a7737f">GHOST_kWindowStateModified</a>);
<a name="l00330"></a>00330 <span class="preprocessor">#endif</span>
<a name="l00331"></a>00331 <span class="preprocessor"></span>    }
<a name="l00332"></a>00332 }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 <span class="comment">/* belongs to below */</span>
<a name="l00335"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#a41ca89c53fa34ef518f321afbe42325f">00335</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a41ca89c53fa34ef518f321afbe42325f">wm_window_add_ghostwindow</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *title, <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win)
<a name="l00336"></a>00336 {
<a name="l00337"></a>00337     GHOST_WindowHandle ghostwin;
<a name="l00338"></a>00338     <span class="keywordtype">int</span> scr_w, scr_h, posy;
<a name="l00339"></a>00339     
<a name="l00340"></a>00340     <a class="code" href="../../d7/d6e/wm__window_8c.html#ad0fb72ddeb11c4b83c096a71e78da2de">wm_get_screensize</a>(&amp;scr_w, &amp;scr_h);
<a name="l00341"></a>00341     posy = (scr_h - win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae754b68a91f58a8541c1226b760ac9bb">posy</a> - win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a>);
<a name="l00342"></a>00342     
<a name="l00343"></a>00343 <span class="preprocessor">#if defined(__APPLE__) &amp;&amp; !defined(GHOST_COCOA)</span>
<a name="l00344"></a>00344 <span class="preprocessor"></span>    {
<a name="l00345"></a>00345         <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d6c/wm__apple_8c.html#aff3319eb3d5c631bfbd5c7c9893aeb58">macPrefState</a>; <span class="comment">/* creator.c */</span>
<a name="l00346"></a>00346         initial_state += <a class="code" href="../../db/d6c/wm__apple_8c.html#aff3319eb3d5c631bfbd5c7c9893aeb58">macPrefState</a>;
<a name="l00347"></a>00347     }
<a name="l00348"></a>00348 <span class="preprocessor">#endif</span>
<a name="l00349"></a>00349 <span class="preprocessor"></span>    <span class="comment">/* Disable AA for now, as GL_SELECT (used for border, lasso, ... select)</span>
<a name="l00350"></a>00350 <span class="comment">     * doesn&#39;t work well when AA is initialized, even if not used. */</span>
<a name="l00351"></a>00351     ghostwin = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#af4e9c42180e8ec56debeb24c19222600">GHOST_CreateWindow</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>, title,
<a name="l00352"></a>00352                                   win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a226ce379ebcc0b691d3278c6d20e313b">posx</a>, posy, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a>,
<a name="l00353"></a>00353                                   (<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546">GHOST_TWindowState</a>)win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#abaf75b42a572acd4c5b8338bb194458a">windowstate</a>,
<a name="l00354"></a>00354                                   <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a8f446557ad991fa1e6b68d248d886b02a39843d48a48ae74cfdc80cf8e880995d">GHOST_kDrawingContextTypeOpenGL</a>,
<a name="l00355"></a>00355                                   0 <span class="comment">/* no stereo */</span>,
<a name="l00356"></a>00356                                   0 <span class="comment">/* no AA */</span>);
<a name="l00357"></a>00357     
<a name="l00358"></a>00358     <span class="keywordflow">if</span> (ghostwin) {
<a name="l00359"></a>00359         <span class="comment">/* needed so we can detect the graphics card below */</span>
<a name="l00360"></a>00360         <a class="code" href="../../da/deb/GPU__extensions_8h.html#a3b6169888993058b7ce5dfaadddeba48">GPU_extensions_init</a>();
<a name="l00361"></a>00361         
<a name="l00362"></a>00362         <span class="comment">/* set the state*/</span>
<a name="l00363"></a>00363         <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a8bf16fb2369a36471613f66cdd31334a">GHOST_SetWindowState</a>(ghostwin, (<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546">GHOST_TWindowState</a>)win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#abaf75b42a572acd4c5b8338bb194458a">windowstate</a>);
<a name="l00364"></a>00364 
<a name="l00365"></a>00365         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a> = ghostwin;
<a name="l00366"></a>00366         <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a39cd762b61a5280e408d32e50a1e9764">GHOST_SetWindowUserData</a>(ghostwin, win); <span class="comment">/* pointer back */</span>
<a name="l00367"></a>00367         
<a name="l00368"></a>00368         <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00369"></a>00369             win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a>), <span class="stringliteral">&quot;window event state&quot;</span>);
<a name="l00370"></a>00370         
<a name="l00371"></a>00371         <span class="comment">/* until screens get drawn, make it nice grey */</span>
<a name="l00372"></a>00372         glClearColor(.55, .55, .55, 0.0);
<a name="l00373"></a>00373         <span class="comment">/* Crash on OSS ATI: bugs.launchpad.net/ubuntu/+source/mesa/+bug/656100 */</span>
<a name="l00374"></a>00374         <span class="keywordflow">if</span> (!<a class="code" href="../../da/deb/GPU__extensions_8h.html#ae78767599d29606b3e057efcc49bd4cf">GPU_type_matches</a>(<a class="code" href="../../da/deb/GPU__extensions_8h.html#a12b9fd71cda4a745d2d3827d683ce216a96e470cc754aed1d3905c058ff3f2533">GPU_DEVICE_ATI</a>, <a class="code" href="../../da/deb/GPU__extensions_8h.html#aedec04f3a9f354fa106abec258925f00a723bf91c194c1336e513a5b5330f237a">GPU_OS_UNIX</a>, <a class="code" href="../../da/deb/GPU__extensions_8h.html#acadc4e20c2241c3619487ee2ecf907bcab6c2e1b7844397f0a0d382b8f87b0af7">GPU_DRIVER_OPENSOURCE</a>)) {
<a name="l00375"></a>00375             glClear(GL_COLOR_BUFFER_BIT);
<a name="l00376"></a>00376         }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378         <a class="code" href="../../d7/d6e/wm__window_8c.html#a271f5e4d69d585d92bcd9f03e4027dcf">wm_window_swap_buffers</a>(win);
<a name="l00379"></a>00379         
<a name="l00380"></a>00380         <span class="comment">//GHOST_SetWindowState(ghostwin, GHOST_kWindowStateModified);</span>
<a name="l00381"></a>00381         
<a name="l00382"></a>00382         <span class="comment">/* standard state vars for window */</span>
<a name="l00383"></a>00383         glEnable(GL_SCISSOR_TEST);
<a name="l00384"></a>00384         
<a name="l00385"></a>00385         <a class="code" href="../../d3/df0/GPU__draw_8h.html#a5c5831cf1b6896465867fa3df3bdd064">GPU_state_init</a>();
<a name="l00386"></a>00386     }
<a name="l00387"></a>00387 }
<a name="l00388"></a>00388 
<a name="l00389"></a>00389 <span class="comment">/* for wmWindows without ghostwin, open these and clear */</span>
<a name="l00390"></a>00390 <span class="comment">/* window size is read from window, if 0 it uses prefsize */</span>
<a name="l00391"></a>00391 <span class="comment">/* called in WM_check, also inits stuff after file read */</span>
<a name="l00392"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#a2fb5effad1e2df1f4dbc6ed5148db9d4">00392</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a2fb5effad1e2df1f4dbc6ed5148db9d4">wm_window_add_ghostwindows</a>(<a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm)
<a name="l00393"></a>00393 {
<a name="l00394"></a>00394     <a class="code" href="../../d3/d90/structwmKeyMap.html">wmKeyMap</a> *keymap;
<a name="l00395"></a>00395     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win;
<a name="l00396"></a>00396     
<a name="l00397"></a>00397     <span class="comment">/* no commandline prefsize? then we set this.</span>
<a name="l00398"></a>00398 <span class="comment">     * Note that these values will be used only</span>
<a name="l00399"></a>00399 <span class="comment">     * when there is no startup.blend yet.</span>
<a name="l00400"></a>00400 <span class="comment">     */</span>
<a name="l00401"></a>00401     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#a14551253b5d67da753fb03c2369be66b">size_x</a> == 0) {
<a name="l00402"></a>00402         <a class="code" href="../../d7/d6e/wm__window_8c.html#ad0fb72ddeb11c4b83c096a71e78da2de">wm_get_screensize</a>(&amp;<a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#a14551253b5d67da753fb03c2369be66b">size_x</a>, &amp;<a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#aeefda7a40b4a5fb3f7878cc933ba5f71">size_y</a>);
<a name="l00403"></a>00403         
<a name="l00404"></a>00404 <span class="preprocessor">#if defined(__APPLE__) &amp;&amp; !defined(GHOST_COCOA)</span>
<a name="l00405"></a>00405 <span class="preprocessor"></span><span class="comment">//Cocoa provides functions to get correct max window size</span>
<a name="l00406"></a>00406         {
<a name="l00407"></a>00407             <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="../../db/d6c/wm__apple_8c.html#a379d26f670f85b449fe654cd734256d2">wm_set_apple_prefsize</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>);    <span class="comment">/* wm_apple.c */</span>
<a name="l00408"></a>00408             
<a name="l00409"></a>00409             <a class="code" href="../../db/d6c/wm__apple_8c.html#a379d26f670f85b449fe654cd734256d2">wm_set_apple_prefsize</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#a14551253b5d67da753fb03c2369be66b">size_x</a>, <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#aeefda7a40b4a5fb3f7878cc933ba5f71">size_y</a>);
<a name="l00410"></a>00410         }
<a name="l00411"></a>00411 <span class="preprocessor">#else</span>
<a name="l00412"></a>00412 <span class="preprocessor"></span>        <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#a9c513dfc69663c4265c4eb21d82c2ffa">start_x</a> = 0;
<a name="l00413"></a>00413         <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#a30681a301d1947075eaca03c35ea8a9f">start_y</a> = 0;
<a name="l00414"></a>00414         
<a name="l00415"></a>00415 <span class="preprocessor">#endif</span>
<a name="l00416"></a>00416 <span class="preprocessor"></span>    }
<a name="l00417"></a>00417     
<a name="l00418"></a>00418     <span class="keywordflow">for</span> (win = wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; win; win = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#accffa1b62f114b1781206c921fc92be1">next</a>) {
<a name="l00419"></a>00419         <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00420"></a>00420             <span class="keywordflow">if</span> ((win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a> == 0) || (<a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#a4e8e702aad7310baa28916a99e922db8">override_flag</a> &amp; <a class="code" href="../../d7/d6e/wm__window_8c.html#a3ee5a57e4d05602f20642e0d45b95a2eaf9ba44795a5311ef93f432a3807c5550">WIN_OVERRIDE_GEOM</a>)) {
<a name="l00421"></a>00421                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a226ce379ebcc0b691d3278c6d20e313b">posx</a> = <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#a9c513dfc69663c4265c4eb21d82c2ffa">start_x</a>;
<a name="l00422"></a>00422                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae754b68a91f58a8541c1226b760ac9bb">posy</a> = <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#a30681a301d1947075eaca03c35ea8a9f">start_y</a>;
<a name="l00423"></a>00423                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a> = <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#a14551253b5d67da753fb03c2369be66b">size_x</a>;
<a name="l00424"></a>00424                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a> = <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#aeefda7a40b4a5fb3f7878cc933ba5f71">size_y</a>;
<a name="l00425"></a>00425                 <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#a4e8e702aad7310baa28916a99e922db8">override_flag</a> &amp;= ~<a class="code" href="../../d7/d6e/wm__window_8c.html#a3ee5a57e4d05602f20642e0d45b95a2eaf9ba44795a5311ef93f432a3807c5550">WIN_OVERRIDE_GEOM</a>;
<a name="l00426"></a>00426             }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#a4e8e702aad7310baa28916a99e922db8">override_flag</a> &amp; <a class="code" href="../../d7/d6e/wm__window_8c.html#a3ee5a57e4d05602f20642e0d45b95a2ea3971fc61cd181c5dc28444488185c90d">WIN_OVERRIDE_WINSTATE</a>) {
<a name="l00429"></a>00429                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#abaf75b42a572acd4c5b8338bb194458a">windowstate</a> = <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#aa8e13c49b4152a72a7c12552aeb43ddb">windowstate</a>;
<a name="l00430"></a>00430                 <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#a4e8e702aad7310baa28916a99e922db8">override_flag</a> &amp;= ~<a class="code" href="../../d7/d6e/wm__window_8c.html#a3ee5a57e4d05602f20642e0d45b95a2ea3971fc61cd181c5dc28444488185c90d">WIN_OVERRIDE_WINSTATE</a>;
<a name="l00431"></a>00431             }
<a name="l00432"></a>00432 
<a name="l00433"></a>00433             <a class="code" href="../../d7/d6e/wm__window_8c.html#a41ca89c53fa34ef518f321afbe42325f">wm_window_add_ghostwindow</a>(<span class="stringliteral">&quot;Blender&quot;</span>, win);
<a name="l00434"></a>00434         }
<a name="l00435"></a>00435         <span class="comment">/* happens after fileread */</span>
<a name="l00436"></a>00436         <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00437"></a>00437             win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a>), <span class="stringliteral">&quot;window event state&quot;</span>);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439         <span class="comment">/* add keymap handlers (1 handler for all keys in map!) */</span>
<a name="l00440"></a>00440         keymap = <a class="code" href="../../d7/d78/wm__keymap_8c.html#a92bcf8f3f041915f81ad660495dc30cd">WM_keymap_find</a>(wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a17c7e8a6747f168e3b9266314ba2534e">defaultconf</a>, <span class="stringliteral">&quot;Window&quot;</span>, 0, 0);
<a name="l00441"></a>00441         <a class="code" href="../../df/db0/wm__event__system_8c.html#a966bbb5f2ccdc15546e0725efa379595">WM_event_add_keymap_handler</a>(&amp;win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ac05161bf3e5508b9414c5835376851b6">handlers</a>, keymap);
<a name="l00442"></a>00442         
<a name="l00443"></a>00443         keymap = <a class="code" href="../../d7/d78/wm__keymap_8c.html#a92bcf8f3f041915f81ad660495dc30cd">WM_keymap_find</a>(wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a17c7e8a6747f168e3b9266314ba2534e">defaultconf</a>, <span class="stringliteral">&quot;Screen&quot;</span>, 0, 0);
<a name="l00444"></a>00444         <a class="code" href="../../df/db0/wm__event__system_8c.html#a966bbb5f2ccdc15546e0725efa379595">WM_event_add_keymap_handler</a>(&amp;win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ac05161bf3e5508b9414c5835376851b6">handlers</a>, keymap);
<a name="l00445"></a>00445 
<a name="l00446"></a>00446         keymap = <a class="code" href="../../d7/d78/wm__keymap_8c.html#a92bcf8f3f041915f81ad660495dc30cd">WM_keymap_find</a>(wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a17c7e8a6747f168e3b9266314ba2534e">defaultconf</a>, <span class="stringliteral">&quot;Screen Editing&quot;</span>, 0, 0);
<a name="l00447"></a>00447         <a class="code" href="../../df/db0/wm__event__system_8c.html#a966bbb5f2ccdc15546e0725efa379595">WM_event_add_keymap_handler</a>(&amp;win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1ea8c9176e46638bd4cd9648c7f9fae2">modalhandlers</a>, keymap);
<a name="l00448"></a>00448         
<a name="l00449"></a>00449         <span class="comment">/* add drop boxes */</span>
<a name="l00450"></a>00450         {
<a name="l00451"></a>00451             <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb = <a class="code" href="../../db/df3/wm__dragdrop_8c.html#a9bdfefde719d427581820fde9975e46c">WM_dropboxmap_find</a>(<span class="stringliteral">&quot;Window&quot;</span>, 0, 0);
<a name="l00452"></a>00452             <a class="code" href="../../df/db0/wm__event__system_8c.html#a1c0385af2587f3e0ce0f4bf38ed49c47">WM_event_add_dropbox_handler</a>(&amp;win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ac05161bf3e5508b9414c5835376851b6">handlers</a>, lb);
<a name="l00453"></a>00453         }
<a name="l00454"></a>00454         <a class="code" href="../../d7/d6e/wm__window_8c.html#a499f04b3bfe24b1ffe383ccdd1ae9e5f">wm_window_title</a>(wm, win);
<a name="l00455"></a>00455     }
<a name="l00456"></a>00456 }
<a name="l00457"></a>00457 
<a name="l00458"></a>00458 <span class="comment">/* new window, no screen yet, but we open ghostwindow for it */</span>
<a name="l00459"></a>00459 <span class="comment">/* also gets the window level handlers */</span>
<a name="l00460"></a>00460 <span class="comment">/* area-rip calls this */</span>
<a name="l00461"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#aa3e29fd78a220004151789537b675541">00461</a> <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *<a class="code" href="../../d7/d6e/wm__window_8c.html#a885d955105fff6afd5374556977f46c3">WM_window_open</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d0/d28/structrcti.html">rcti</a> *rect)
<a name="l00462"></a>00462 {
<a name="l00463"></a>00463     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win = <a class="code" href="../../d7/d6e/wm__window_8c.html#a4f2c73e9dab3b238e9542b7e909517aa">wm_window_new</a>(C);
<a name="l00464"></a>00464     
<a name="l00465"></a>00465     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a226ce379ebcc0b691d3278c6d20e313b">posx</a> = rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>;
<a name="l00466"></a>00466     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae754b68a91f58a8541c1226b760ac9bb">posy</a> = rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>;
<a name="l00467"></a>00467     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a> = rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> - rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>;
<a name="l00468"></a>00468     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a> = rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> - rect-&gt;<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>;
<a name="l00469"></a>00469 
<a name="l00470"></a>00470     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a6b5dd98c6208a6594d8183e4dc0f06dd">drawmethod</a> = -1;
<a name="l00471"></a>00471     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#aa43cc5770f7a2cd2e9e480f6f812fe71">drawdata</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00472"></a>00472     
<a name="l00473"></a>00473     <a class="code" href="../../d6/d0e/wm_8c.html#a834336767fbafd6d766759fd140d1532">WM_check</a>(C);
<a name="l00474"></a>00474     
<a name="l00475"></a>00475     <span class="keywordflow">return</span> win;
<a name="l00476"></a>00476 }
<a name="l00477"></a>00477 
<a name="l00478"></a>00478 <span class="comment">/* uses screen-&gt;temp tag to define what to do, currently it limits</span>
<a name="l00479"></a>00479 <span class="comment"> * to only one &quot;temp&quot; window for render out, preferences, filewindow, etc */</span>
<a name="l00480"></a>00480 <span class="comment">/* type is #define in WM_api.h */</span>
<a name="l00481"></a>00481 
<a name="l00482"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a056382500f87d97c043a336d05e484cb">00482</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a889e541c2f993d4f3cfeea0485efcfd4">WM_window_open_temp</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d0/d28/structrcti.html">rcti</a> *position, <span class="keywordtype">int</span> type)
<a name="l00483"></a>00483 {
<a name="l00484"></a>00484     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win;
<a name="l00485"></a>00485     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l00486"></a>00486     
<a name="l00487"></a>00487     <span class="comment">/* changes rect to fit within desktop */</span>
<a name="l00488"></a>00488     <a class="code" href="../../d7/d6e/wm__window_8c.html#a0f42cd51208a73f0eebee1c27089f4f7">wm_window_check_position</a>(position);
<a name="l00489"></a>00489     
<a name="l00490"></a>00490     <span class="comment">/* test if we have a temp screen already */</span>
<a name="l00491"></a>00491     <span class="keywordflow">for</span> (win = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C)-&gt;windows.first; win; win = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#accffa1b62f114b1781206c921fc92be1">next</a>)
<a name="l00492"></a>00492         <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae4c1fae9fb86f1ad80ae280be436cb75">temp</a>)
<a name="l00493"></a>00493             <span class="keywordflow">break</span>;
<a name="l00494"></a>00494     
<a name="l00495"></a>00495     <span class="comment">/* add new window? */</span>
<a name="l00496"></a>00496     <span class="keywordflow">if</span> (win == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00497"></a>00497         win = <a class="code" href="../../d7/d6e/wm__window_8c.html#a4f2c73e9dab3b238e9542b7e909517aa">wm_window_new</a>(C);
<a name="l00498"></a>00498         
<a name="l00499"></a>00499         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a226ce379ebcc0b691d3278c6d20e313b">posx</a> = position-&gt;<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>;
<a name="l00500"></a>00500         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae754b68a91f58a8541c1226b760ac9bb">posy</a> = position-&gt;<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>;
<a name="l00501"></a>00501     }
<a name="l00502"></a>00502     
<a name="l00503"></a>00503     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a> = position-&gt;<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> - position-&gt;<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>;
<a name="l00504"></a>00504     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a> = position-&gt;<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> - position-&gt;<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>;
<a name="l00505"></a>00505     
<a name="l00506"></a>00506     <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>) {
<a name="l00507"></a>00507         <a class="code" href="../../d7/d6e/wm__window_8c.html#a7767eb3f0fe79eebe978e2e878ca5de5">wm_window_set_size</a>(win, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a>);
<a name="l00508"></a>00508         <a class="code" href="../../d7/d6e/wm__window_8c.html#a1efb5a20c4d9ce7e67e572f7baf6040e">wm_window_raise</a>(win);
<a name="l00509"></a>00509     }
<a name="l00510"></a>00510     
<a name="l00511"></a>00511     <span class="comment">/* add new screen? */</span>
<a name="l00512"></a>00512     <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00513"></a>00513         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a9379b3ffb23e6992684baeba61ab2e76">ED_screen_add</a>(win, <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C), <span class="stringliteral">&quot;temp&quot;</span>);
<a name="l00514"></a>00514     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae4c1fae9fb86f1ad80ae280be436cb75">temp</a> = 1; 
<a name="l00515"></a>00515     
<a name="l00516"></a>00516     <span class="comment">/* make window active, and validate/resize */</span>
<a name="l00517"></a>00517     <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, win);
<a name="l00518"></a>00518     <a class="code" href="../../d6/d0e/wm_8c.html#a834336767fbafd6d766759fd140d1532">WM_check</a>(C);
<a name="l00519"></a>00519     
<a name="l00520"></a>00520     <span class="comment">/* ensure it shows the right spacetype editor */</span>
<a name="l00521"></a>00521     sa = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00522"></a>00522     <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, sa);
<a name="l00523"></a>00523     
<a name="l00524"></a>00524     <span class="keywordflow">if</span> (type == <a class="code" href="../../d4/d7f/WM__api_8h.html#a44565ec83146db5dea99f7a6a0a37cac">WM_WINDOW_RENDER</a>) {
<a name="l00525"></a>00525         <a class="code" href="../../d1/d12/ED__screen_8h.html#a1768c9e14c6c8f09f1b8175ca1d7f3cf">ED_area_newspace</a>(C, sa, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>);
<a name="l00526"></a>00526     }
<a name="l00527"></a>00527     <span class="keywordflow">else</span> {
<a name="l00528"></a>00528         <a class="code" href="../../d1/d12/ED__screen_8h.html#a1768c9e14c6c8f09f1b8175ca1d7f3cf">ED_area_newspace</a>(C, sa, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca448e29d9aaf96960c8bf83b631b4079d">SPACE_USERPREF</a>);
<a name="l00529"></a>00529     }
<a name="l00530"></a>00530     
<a name="l00531"></a>00531     <a class="code" href="../../d1/d12/ED__screen_8h.html#a5055a39580a193e017808b6f51a0c8a3">ED_screen_set</a>(C, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>);
<a name="l00532"></a>00532     
<a name="l00533"></a>00533     <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a124203529b9ea4c84ca8f8ae4efff3e3">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>)
<a name="l00534"></a>00534         <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a4bfa07619981619fee9f8a6af901d143">GHOST_SetTitle</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, <a class="code" href="../../d6/d61/BLF__translation_8h.html#abb0b47333c78518638888749beab5f55">IFACE_</a>(<span class="stringliteral">&quot;Blender Render&quot;</span>));
<a name="l00535"></a>00535     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a124203529b9ea4c84ca8f8ae4efff3e3">spacetype</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca1806179a239521ed61051b9e46b71818">SPACE_OUTLINER</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca448e29d9aaf96960c8bf83b631b4079d">SPACE_USERPREF</a>))
<a name="l00536"></a>00536         <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a4bfa07619981619fee9f8a6af901d143">GHOST_SetTitle</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, <a class="code" href="../../d6/d61/BLF__translation_8h.html#abb0b47333c78518638888749beab5f55">IFACE_</a>(<span class="stringliteral">&quot;Blender User Preferences&quot;</span>));
<a name="l00537"></a>00537     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a124203529b9ea4c84ca8f8ae4efff3e3">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca5f4c324d2af06c247780942931169c7c">SPACE_FILE</a>)
<a name="l00538"></a>00538         <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a4bfa07619981619fee9f8a6af901d143">GHOST_SetTitle</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, <a class="code" href="../../d6/d61/BLF__translation_8h.html#abb0b47333c78518638888749beab5f55">IFACE_</a>(<span class="stringliteral">&quot;Blender File View&quot;</span>));
<a name="l00539"></a>00539     <span class="keywordflow">else</span>
<a name="l00540"></a>00540         <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a4bfa07619981619fee9f8a6af901d143">GHOST_SetTitle</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, <span class="stringliteral">&quot;Blender&quot;</span>);
<a name="l00541"></a>00541 }
<a name="l00542"></a>00542 
<a name="l00543"></a>00543 
<a name="l00544"></a>00544 <span class="comment">/* ****************** Operators ****************** */</span>
<a name="l00545"></a>00545 
<a name="l00546"></a>00546 <span class="comment">/* operator callback */</span>
<a name="l00547"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#a7297d52e68897bad527e9493bcd33e7c">00547</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a7297d52e68897bad527e9493bcd33e7c">wm_window_duplicate_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00548"></a>00548 {
<a name="l00549"></a>00549     <a class="code" href="../../d7/d6e/wm__window_8c.html#af095c419bcba99a437ee212ee751d5df">wm_window_copy</a>(C, <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C));
<a name="l00550"></a>00550     <a class="code" href="../../d6/d0e/wm_8c.html#a834336767fbafd6d766759fd140d1532">WM_check</a>(C);
<a name="l00551"></a>00551     
<a name="l00552"></a>00552     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a0dce5c73d06bfc518c4c6b2189df325d">NC_WINDOW</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a66ee93621fb1e26b8b9bb49dc3c2c2af">NA_ADDED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00553"></a>00553     
<a name="l00554"></a>00554     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00555"></a>00555 }
<a name="l00556"></a>00556 
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 <span class="comment">/* fullscreen operator callback */</span>
<a name="l00559"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#ab1cd6e835063e8ea37c4cce04e833395">00559</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#ab1cd6e835063e8ea37c4cce04e833395">wm_window_fullscreen_toggle_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00560"></a>00560 {
<a name="l00561"></a>00561     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *window = <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l00562"></a>00562     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546">GHOST_TWindowState</a> <a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>;
<a name="l00563"></a>00563 
<a name="l00564"></a>00564     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.background)
<a name="l00565"></a>00565         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00566"></a>00566 
<a name="l00567"></a>00567     state = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a09870e0df287e0ac42e54732784056ec">GHOST_GetWindowState</a>(window-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>);
<a name="l00568"></a>00568     <span class="keywordflow">if</span> (state != <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ae9acbbe33f8f0c750787ce5b7485d766">GHOST_kWindowStateFullScreen</a>)
<a name="l00569"></a>00569         <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a8bf16fb2369a36471613f66cdd31334a">GHOST_SetWindowState</a>(window-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ae9acbbe33f8f0c750787ce5b7485d766">GHOST_kWindowStateFullScreen</a>);
<a name="l00570"></a>00570     <span class="keywordflow">else</span>
<a name="l00571"></a>00571         <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a8bf16fb2369a36471613f66cdd31334a">GHOST_SetWindowState</a>(window-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ad2bf9ca21ca8bce907d58cd71e8067c6">GHOST_kWindowStateNormal</a>);
<a name="l00572"></a>00572 
<a name="l00573"></a>00573     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00574"></a>00574     
<a name="l00575"></a>00575 }
<a name="l00576"></a>00576 
<a name="l00577"></a>00577 
<a name="l00578"></a>00578 <span class="comment">/* ************ events *************** */</span>
<a name="l00579"></a>00579 
<a name="l00580"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#a0050b23c995941a343b4738e1756c9c5">00580</a> <span class="keyword">typedef</span> <span class="keyword">enum</span>
<a name="l00581"></a>00581 {
<a name="l00582"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#a0050b23c995941a343b4738e1756c9c5a1ce4ab037343ee04fbf20ceb2ebc5081">00582</a>     <a class="code" href="../../d7/d6e/wm__window_8c.html#a0050b23c995941a343b4738e1756c9c5a1ce4ab037343ee04fbf20ceb2ebc5081">SHIFT</a> = <span class="charliteral">&#39;s&#39;</span>,
<a name="l00583"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#a0050b23c995941a343b4738e1756c9c5af722a5faa36087c914da53ebe4711f08">00583</a>     <a class="code" href="../../d7/d6e/wm__window_8c.html#a0050b23c995941a343b4738e1756c9c5af722a5faa36087c914da53ebe4711f08">CONTROL</a> = <span class="charliteral">&#39;c&#39;</span>,
<a name="l00584"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#a0050b23c995941a343b4738e1756c9c5ab1d948a93e387798ef60b07c24a7c337">00584</a>     <a class="code" href="../../d7/d6e/wm__window_8c.html#a0050b23c995941a343b4738e1756c9c5ab1d948a93e387798ef60b07c24a7c337">ALT</a> = <span class="charliteral">&#39;a&#39;</span>,
<a name="l00585"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#a0050b23c995941a343b4738e1756c9c5a48654532ac8a1eee6c255d77e3e1c406">00585</a>     <a class="code" href="../../d7/d6e/wm__window_8c.html#a0050b23c995941a343b4738e1756c9c5a48654532ac8a1eee6c255d77e3e1c406">OS</a> = <span class="charliteral">&#39;C&#39;</span>
<a name="l00586"></a>00586 } <a class="code" href="../../d7/d6e/wm__window_8c.html#a0050b23c995941a343b4738e1756c9c5">modifierKeyType</a>;
<a name="l00587"></a>00587 
<a name="l00588"></a>00588 <span class="comment">/* check if specified modifier key type is pressed */</span>
<a name="l00589"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#a3d3a1077e4c4b9299bbf98f692a8e05e">00589</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a3d3a1077e4c4b9299bbf98f692a8e05e">query_qual</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a0050b23c995941a343b4738e1756c9c5">modifierKeyType</a> qual) 
<a name="l00590"></a>00590 {
<a name="l00591"></a>00591     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aad759f87d56861f098b2151083b4d7ea">GHOST_TModifierKeyMask</a> <a class="code" href="../../db/d0f/navmesh__conversion_8c.html#a4d78fdbccaa4d42dc8599d58cdf0de96">left</a>, right;
<a name="l00592"></a>00592     <span class="keywordtype">int</span> val = 0;
<a name="l00593"></a>00593     
<a name="l00594"></a>00594     <span class="keywordflow">switch</span> (qual) {
<a name="l00595"></a>00595         <span class="keywordflow">case</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a0050b23c995941a343b4738e1756c9c5a1ce4ab037343ee04fbf20ceb2ebc5081">SHIFT</a>:
<a name="l00596"></a>00596             left = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aad759f87d56861f098b2151083b4d7eaa82d52de3890f450e16d55b59d1883e55">GHOST_kModifierKeyLeftShift</a>;
<a name="l00597"></a>00597             right = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aad759f87d56861f098b2151083b4d7eaa70dd21e98220ab00957da656232abb08">GHOST_kModifierKeyRightShift</a>;
<a name="l00598"></a>00598             <span class="keywordflow">break</span>;
<a name="l00599"></a>00599         <span class="keywordflow">case</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a0050b23c995941a343b4738e1756c9c5af722a5faa36087c914da53ebe4711f08">CONTROL</a>:
<a name="l00600"></a>00600             left = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aad759f87d56861f098b2151083b4d7eaa2623408ce351079b505a04f68c25fe2f">GHOST_kModifierKeyLeftControl</a>;
<a name="l00601"></a>00601             right = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aad759f87d56861f098b2151083b4d7eaa03c2e8c8498ed1593f6f250aaa33678b">GHOST_kModifierKeyRightControl</a>;
<a name="l00602"></a>00602             <span class="keywordflow">break</span>;
<a name="l00603"></a>00603         <span class="keywordflow">case</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a0050b23c995941a343b4738e1756c9c5a48654532ac8a1eee6c255d77e3e1c406">OS</a>:
<a name="l00604"></a>00604             left = right = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aad759f87d56861f098b2151083b4d7eaa538303062d2d5126b2a0c1dab506c3aa">GHOST_kModifierKeyOS</a>;
<a name="l00605"></a>00605             <span class="keywordflow">break</span>;
<a name="l00606"></a>00606         <span class="keywordflow">case</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a0050b23c995941a343b4738e1756c9c5ab1d948a93e387798ef60b07c24a7c337">ALT</a>:
<a name="l00607"></a>00607         <span class="keywordflow">default</span>:
<a name="l00608"></a>00608             left = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aad759f87d56861f098b2151083b4d7eaa761a2d54ce6f3f9689c61cef8c2e543d">GHOST_kModifierKeyLeftAlt</a>;
<a name="l00609"></a>00609             right = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#aad759f87d56861f098b2151083b4d7eaa44cc07f2e663b38052c0b7b9b4f8a737">GHOST_kModifierKeyRightAlt</a>;
<a name="l00610"></a>00610             <span class="keywordflow">break</span>;
<a name="l00611"></a>00611     }
<a name="l00612"></a>00612     
<a name="l00613"></a>00613     <a class="code" href="../../db/d51/GHOST__C-api_8h.html#ab0576472624030ffb5ed0aff424c76b9">GHOST_GetModifierKeyState</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>, left, &amp;val);
<a name="l00614"></a>00614     <span class="keywordflow">if</span> (!val)
<a name="l00615"></a>00615         <a class="code" href="../../db/d51/GHOST__C-api_8h.html#ab0576472624030ffb5ed0aff424c76b9">GHOST_GetModifierKeyState</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>, right, &amp;val);
<a name="l00616"></a>00616     
<a name="l00617"></a>00617     <span class="keywordflow">return</span> val;
<a name="l00618"></a>00618 }
<a name="l00619"></a>00619 
<a name="l00620"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#ab9efa312329cc56778c1dc48d782341c">00620</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#ab9efa312329cc56778c1dc48d782341c">wm_window_make_drawable</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win) 
<a name="l00621"></a>00621 {
<a name="l00622"></a>00622     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l00623"></a>00623 
<a name="l00624"></a>00624     <span class="keywordflow">if</span> (win != wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a977740478a98e70e33e1053cdd16dcb4">windrawable</a> &amp;&amp; win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>) {
<a name="l00625"></a>00625 <span class="comment">//      win-&gt;lmbut= 0;  /* keeps hanging when mousepressed while other window opened */</span>
<a name="l00626"></a>00626         
<a name="l00627"></a>00627         wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a977740478a98e70e33e1053cdd16dcb4">windrawable</a> = win;
<a name="l00628"></a>00628         <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635acf1dc96ed63676564982ffda5a0f5ac1">G_DEBUG_EVENTS</a>) {
<a name="l00629"></a>00629             printf(<span class="stringliteral">&quot;%s: set drawable %d\n&quot;</span>, __func__, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a479ce2e14de90b31094c8415d0427f06">winid</a>);
<a name="l00630"></a>00630         }
<a name="l00631"></a>00631         <a class="code" href="../../db/d51/GHOST__C-api_8h.html#aad70b4b39b408a87f2242bd1d55871bd">GHOST_ActivateWindowDrawingContext</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>);
<a name="l00632"></a>00632     }
<a name="l00633"></a>00633 }
<a name="l00634"></a>00634 
<a name="l00635"></a>00635 <span class="comment">/* called by ghost, here we handle events for windows themselves or send to event system */</span>
<a name="l00636"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#afe1594886ba9aecc1b7b1131858bbb28">00636</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#afe1594886ba9aecc1b7b1131858bbb28">ghost_event_proc</a>(GHOST_EventHandle evt, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a1cdc6e449250bd3dfdb7575f9726ce0f">GHOST_TUserDataPtr</a> <span class="keyword">private</span>) 
<a name="l00637"></a>00637 {
<a name="l00638"></a>00638     <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C = <span class="keyword">private</span>;
<a name="l00639"></a>00639     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l00640"></a>00640     <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044">GHOST_TEventType</a> type = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#ab17cdd74a5492050c25305757af0aad8">GHOST_GetEventType</a>(evt);
<a name="l00641"></a>00641     <span class="keywordtype">int</span> time = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#aee43ea2c6a1645bda307fe17f18392ce">GHOST_GetEventTime</a>(evt);
<a name="l00642"></a>00642     
<a name="l00643"></a>00643     <span class="keywordflow">if</span> (type == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044a34f4e99e8cfece543126b34626fcc78c">GHOST_kEventQuit</a>) {
<a name="l00644"></a>00644         <a class="code" href="../../df/d04/wm__init__exit_8c.html#a70afca00a010cbbb54700113a3a1db9c">WM_exit</a>(C);
<a name="l00645"></a>00645     }
<a name="l00646"></a>00646     <span class="keywordflow">else</span> {
<a name="l00647"></a>00647         GHOST_WindowHandle ghostwin = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#abaa7284dd576167593519917c37db207">GHOST_GetEventWindow</a>(evt);
<a name="l00648"></a>00648         <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a8029e7130be71615b87eeee3439ae245">GHOST_TEventDataPtr</a> <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#aa6941d4540f00c95f33b23d3518d56c3">GHOST_GetEventData</a>(evt);
<a name="l00649"></a>00649         <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win;
<a name="l00650"></a>00650         
<a name="l00651"></a>00651         <span class="keywordflow">if</span> (!ghostwin) {
<a name="l00652"></a>00652             <span class="comment">// XXX - should be checked, why are we getting an event here, and</span>
<a name="l00653"></a>00653             <span class="comment">//  what is it?</span>
<a name="l00654"></a>00654             puts(<span class="stringliteral">&quot;&lt;!&gt; event has no window&quot;</span>);
<a name="l00655"></a>00655             <span class="keywordflow">return</span> 1;
<a name="l00656"></a>00656         }
<a name="l00657"></a>00657         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../db/d51/GHOST__C-api_8h.html#afd67d207fa124374f4b2c4419ffc2ce9">GHOST_ValidWindow</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>, ghostwin)) {
<a name="l00658"></a>00658             <span class="comment">// XXX - should be checked, why are we getting an event here, and</span>
<a name="l00659"></a>00659             <span class="comment">//  what is it?</span>
<a name="l00660"></a>00660             puts(<span class="stringliteral">&quot;&lt;!&gt; event has invalid window&quot;</span>);           
<a name="l00661"></a>00661             <span class="keywordflow">return</span> 1;
<a name="l00662"></a>00662         }
<a name="l00663"></a>00663         <span class="keywordflow">else</span> {
<a name="l00664"></a>00664             win = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a1e18299ea48a05b3248c33072a3418bc">GHOST_GetWindowUserData</a>(ghostwin);
<a name="l00665"></a>00665         }
<a name="l00666"></a>00666         
<a name="l00667"></a>00667         <span class="keywordflow">switch</span> (type) {
<a name="l00668"></a>00668             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044ab191770e1a2ec5901296f0c41c699aff">GHOST_kEventWindowDeactivate</a>:
<a name="l00669"></a>00669                 <a class="code" href="../../df/db0/wm__event__system_8c.html#a7aa6eb88f7d4cec56d5935171ffb6831">wm_event_add_ghostevent</a>(wm, win, type, time, data);
<a name="l00670"></a>00670                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ac3a700141c9a861934cce09d66af62cf">active</a> = 0; <span class="comment">/* XXX */</span>
<a name="l00671"></a>00671                 <span class="keywordflow">break</span>;
<a name="l00672"></a>00672             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044a790819c28fcf5a4b800c6b663736ed4b">GHOST_kEventWindowActivate</a>: 
<a name="l00673"></a>00673             {
<a name="l00674"></a>00674                 <a class="code" href="../../de/d5a/structGHOST__TEventKeyData.html">GHOST_TEventKeyData</a> kdata;
<a name="l00675"></a>00675                 <span class="keywordtype">int</span> cx, cy, wx, wy;
<a name="l00676"></a>00676                 
<a name="l00677"></a>00677                 wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#af6c533cdbd4dc456794e6a89d0f1fe71">winactive</a> = win; <span class="comment">/* no context change! c-&gt;wm-&gt;windrawable is drawable, or for area queues */</span>
<a name="l00678"></a>00678                 
<a name="l00679"></a>00679                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ac3a700141c9a861934cce09d66af62cf">active</a> = 1;
<a name="l00680"></a>00680 <span class="comment">//              window_handle(win, INPUTCHANGE, win-&gt;active);</span>
<a name="l00681"></a>00681                 
<a name="l00682"></a>00682                 <span class="comment">/* bad ghost support for modifier keys... so on activate we set the modifiers again */</span>
<a name="l00683"></a>00683                 kdata.<a class="code" href="../../de/d5a/structGHOST__TEventKeyData.html#ae3a4ca394c8e8170a8e13195e8b274f7">ascii</a> = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00684"></a>00684                 kdata.<a class="code" href="../../de/d5a/structGHOST__TEventKeyData.html#a8eb1160214f6258efe304412adf04afb">utf8_buf</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00685"></a>00685                 <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a284c581e97d510de46fd27af4557c7d9">shift</a> &amp;&amp; !<a class="code" href="../../d7/d6e/wm__window_8c.html#a3d3a1077e4c4b9299bbf98f692a8e05e">query_qual</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a0050b23c995941a343b4738e1756c9c5a1ce4ab037343ee04fbf20ceb2ebc5081">SHIFT</a>)) {
<a name="l00686"></a>00686                     kdata.<a class="code" href="../../de/d5a/structGHOST__TEventKeyData.html#a307b62b2a190392a7274e7a5357fc051">key</a> = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7aef2c01413fb34ea291b1786b3073cfe2">GHOST_kKeyLeftShift</a>;
<a name="l00687"></a>00687                     <a class="code" href="../../df/db0/wm__event__system_8c.html#a7aa6eb88f7d4cec56d5935171ffb6831">wm_event_add_ghostevent</a>(wm, win, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044ae6b90f2387a4b1a1906924872f9b4344">GHOST_kEventKeyUp</a>, time, &amp;kdata);
<a name="l00688"></a>00688                 }
<a name="l00689"></a>00689                 <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a33d6218f29f56356d785f017a26c9e13">ctrl</a> &amp;&amp; !<a class="code" href="../../d7/d6e/wm__window_8c.html#a3d3a1077e4c4b9299bbf98f692a8e05e">query_qual</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a0050b23c995941a343b4738e1756c9c5af722a5faa36087c914da53ebe4711f08">CONTROL</a>)) {
<a name="l00690"></a>00690                     kdata.<a class="code" href="../../de/d5a/structGHOST__TEventKeyData.html#a307b62b2a190392a7274e7a5357fc051">key</a> = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a6c1164e35e71efead55cb6d113ad664f">GHOST_kKeyLeftControl</a>;
<a name="l00691"></a>00691                     <a class="code" href="../../df/db0/wm__event__system_8c.html#a7aa6eb88f7d4cec56d5935171ffb6831">wm_event_add_ghostevent</a>(wm, win, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044ae6b90f2387a4b1a1906924872f9b4344">GHOST_kEventKeyUp</a>, time, &amp;kdata);
<a name="l00692"></a>00692                 }
<a name="l00693"></a>00693                 <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#abde95a7991f1889a525840f33ea6f0dc">alt</a> &amp;&amp; !<a class="code" href="../../d7/d6e/wm__window_8c.html#a3d3a1077e4c4b9299bbf98f692a8e05e">query_qual</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a0050b23c995941a343b4738e1756c9c5ab1d948a93e387798ef60b07c24a7c337">ALT</a>)) {
<a name="l00694"></a>00694                     kdata.<a class="code" href="../../de/d5a/structGHOST__TEventKeyData.html#a307b62b2a190392a7274e7a5357fc051">key</a> = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a1ef1177814e1aed94435442820848278">GHOST_kKeyLeftAlt</a>;
<a name="l00695"></a>00695                     <a class="code" href="../../df/db0/wm__event__system_8c.html#a7aa6eb88f7d4cec56d5935171ffb6831">wm_event_add_ghostevent</a>(wm, win, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044ae6b90f2387a4b1a1906924872f9b4344">GHOST_kEventKeyUp</a>, time, &amp;kdata);
<a name="l00696"></a>00696                 }
<a name="l00697"></a>00697                 <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7dc2b3fa9f4563111cb1a461a1117192">oskey</a> &amp;&amp; !<a class="code" href="../../d7/d6e/wm__window_8c.html#a3d3a1077e4c4b9299bbf98f692a8e05e">query_qual</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a0050b23c995941a343b4738e1756c9c5a48654532ac8a1eee6c255d77e3e1c406">OS</a>)) {
<a name="l00698"></a>00698                     kdata.<a class="code" href="../../de/d5a/structGHOST__TEventKeyData.html#a307b62b2a190392a7274e7a5357fc051">key</a> = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a88d55849c15c1c64b4ff762e40b36fc7a7d8c22a7083c0cdad6e957882937b39f">GHOST_kKeyOS</a>;
<a name="l00699"></a>00699                     <a class="code" href="../../df/db0/wm__event__system_8c.html#a7aa6eb88f7d4cec56d5935171ffb6831">wm_event_add_ghostevent</a>(wm, win, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044ae6b90f2387a4b1a1906924872f9b4344">GHOST_kEventKeyUp</a>, time, &amp;kdata);
<a name="l00700"></a>00700                 }
<a name="l00701"></a>00701                 <span class="comment">/* keymodifier zero, it hangs on hotkeys that open windows otherwise */</span>
<a name="l00702"></a>00702                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a88321b6fa3a5dad8d9b7194627ecc2b3">keymodifier</a> = 0;
<a name="l00703"></a>00703                 
<a name="l00704"></a>00704                 <span class="comment">/* entering window, update mouse pos. but no event */</span>
<a name="l00705"></a>00705                 <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a9d2a58b894ab5fea4e5bca61142b017e">GHOST_GetCursorPosition</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>, &amp;wx, &amp;wy);
<a name="l00706"></a>00706                 
<a name="l00707"></a>00707                 <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a255a7b25314a51c88026db1418d52eed">GHOST_ScreenToClient</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, wx, wy, &amp;cx, &amp;cy);
<a name="l00708"></a>00708                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> = cx;
<a name="l00709"></a>00709                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a> = (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a> - 1) - cy;
<a name="l00710"></a>00710                 
<a name="l00711"></a>00711                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a3fedf480c7474b10dbb03ac1c1376cf7">addmousemove</a> = 1;   <span class="comment">/* enables highlighted buttons */</span>
<a name="l00712"></a>00712                 
<a name="l00713"></a>00713                 <a class="code" href="../../d7/d6e/wm__window_8c.html#ab9efa312329cc56778c1dc48d782341c">wm_window_make_drawable</a>(C, win);
<a name="l00714"></a>00714                 <span class="keywordflow">break</span>;
<a name="l00715"></a>00715             }
<a name="l00716"></a>00716             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044a023b8d7867aed530d17fc10062e7812c">GHOST_kEventWindowClose</a>: {
<a name="l00717"></a>00717                 <a class="code" href="../../d7/d6e/wm__window_8c.html#a695d80c0e7fc7b96b7cdc9705d6378ac">wm_window_close</a>(C, wm, win);
<a name="l00718"></a>00718                 <span class="keywordflow">break</span>;
<a name="l00719"></a>00719             }
<a name="l00720"></a>00720             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044a9760fbf53b9738b1853932f4c9442fff">GHOST_kEventWindowUpdate</a>: {
<a name="l00721"></a>00721                 <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635acf1dc96ed63676564982ffda5a0f5ac1">G_DEBUG_EVENTS</a>) {
<a name="l00722"></a>00722                     printf(<span class="stringliteral">&quot;%s: ghost redraw %d\n&quot;</span>, __func__, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a479ce2e14de90b31094c8415d0427f06">winid</a>);
<a name="l00723"></a>00723                 }
<a name="l00724"></a>00724                 
<a name="l00725"></a>00725                 <a class="code" href="../../d7/d6e/wm__window_8c.html#ab9efa312329cc56778c1dc48d782341c">wm_window_make_drawable</a>(C, win);
<a name="l00726"></a>00726                 <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a0dce5c73d06bfc518c4c6b2189df325d">NC_WINDOW</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00727"></a>00727 
<a name="l00728"></a>00728                 <span class="keywordflow">break</span>;
<a name="l00729"></a>00729             }
<a name="l00730"></a>00730             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044a212393b39085dcac4c7f404becb547bd">GHOST_kEventWindowSize</a>:
<a name="l00731"></a>00731             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044a122242252725946aa5627dd8c27719ae">GHOST_kEventWindowMove</a>: {
<a name="l00732"></a>00732                 <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546">GHOST_TWindowState</a> <a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>;
<a name="l00733"></a>00733                 state = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a09870e0df287e0ac42e54732784056ec">GHOST_GetWindowState</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>);
<a name="l00734"></a>00734                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#abaf75b42a572acd4c5b8338bb194458a">windowstate</a> = <a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a>;
<a name="l00735"></a>00735 
<a name="l00736"></a>00736                 <span class="comment">/* win32: gives undefined window size when minimized */</span>
<a name="l00737"></a>00737                 <span class="keywordflow">if</span> (state != <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546a88de0b7d5b7d4843d7d4133255817078">GHOST_kWindowStateMinimized</a>) {
<a name="l00738"></a>00738                     GHOST_RectangleHandle client_rect;
<a name="l00739"></a>00739                     <span class="keywordtype">int</span> l, t, r, b, scr_w, scr_h;
<a name="l00740"></a>00740                     <span class="keywordtype">int</span> sizex, sizey, posx, posy;
<a name="l00741"></a>00741                     
<a name="l00742"></a>00742                     client_rect = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#af05e86b7a8b03fd862a395373c52761b">GHOST_GetClientBounds</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>);
<a name="l00743"></a>00743                     <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a7d7919dd7ded219f2355c8385ffa1682">GHOST_GetRectangle</a>(client_rect, &amp;l, &amp;t, &amp;r, &amp;b);
<a name="l00744"></a>00744                     
<a name="l00745"></a>00745                     <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a4836dae91eca24cf51f24ab04ab75326">GHOST_DisposeRectangle</a>(client_rect);
<a name="l00746"></a>00746                     
<a name="l00747"></a>00747                     <a class="code" href="../../d7/d6e/wm__window_8c.html#ad0fb72ddeb11c4b83c096a71e78da2de">wm_get_screensize</a>(&amp;scr_w, &amp;scr_h);
<a name="l00748"></a>00748                     sizex = r - l;
<a name="l00749"></a>00749                     sizey = b - t;
<a name="l00750"></a>00750                     posx = l;
<a name="l00751"></a>00751                     posy = scr_h - t - win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a>;
<a name="l00752"></a>00752 
<a name="l00753"></a>00753                     <span class="comment">/*</span>
<a name="l00754"></a>00754 <span class="comment">                     * Ghost sometimes send size or move events when the window hasn&#39;t changed.</span>
<a name="l00755"></a>00755 <span class="comment">                     * One case of this is using compiz on linux. To alleviate the problem</span>
<a name="l00756"></a>00756 <span class="comment">                     * we ignore all such event here.</span>
<a name="l00757"></a>00757 <span class="comment">                     * </span>
<a name="l00758"></a>00758 <span class="comment">                     * It might be good to eventually do that at Ghost level, but that is for </span>
<a name="l00759"></a>00759 <span class="comment">                     * another time.</span>
<a name="l00760"></a>00760 <span class="comment">                     */</span>
<a name="l00761"></a>00761                     <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a> != sizex ||
<a name="l00762"></a>00762                         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a> != sizey ||
<a name="l00763"></a>00763                         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a226ce379ebcc0b691d3278c6d20e313b">posx</a> != posx ||
<a name="l00764"></a>00764                         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae754b68a91f58a8541c1226b760ac9bb">posy</a> != posy)
<a name="l00765"></a>00765                     {
<a name="l00766"></a>00766                         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a> = sizex;
<a name="l00767"></a>00767                         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a> = sizey;
<a name="l00768"></a>00768                         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a226ce379ebcc0b691d3278c6d20e313b">posx</a> = posx;
<a name="l00769"></a>00769                         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae754b68a91f58a8541c1226b760ac9bb">posy</a> = posy;
<a name="l00770"></a>00770 
<a name="l00771"></a>00771                         <span class="comment">/* debug prints */</span>
<a name="l00772"></a>00772                         <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635acf1dc96ed63676564982ffda5a0f5ac1">G_DEBUG_EVENTS</a>) {
<a name="l00773"></a>00773                             <span class="keyword">const</span> <span class="keywordtype">char</span> *state_str;
<a name="l00774"></a>00774                             state = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a09870e0df287e0ac42e54732784056ec">GHOST_GetWindowState</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>);
<a name="l00775"></a>00775 
<a name="l00776"></a>00776                             <span class="keywordflow">if</span> (state == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ad2bf9ca21ca8bce907d58cd71e8067c6">GHOST_kWindowStateNormal</a>) {
<a name="l00777"></a>00777                                 state_str = <span class="stringliteral">&quot;normal&quot;</span>;
<a name="l00778"></a>00778                             }
<a name="l00779"></a>00779                             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546a88de0b7d5b7d4843d7d4133255817078">GHOST_kWindowStateMinimized</a>) {
<a name="l00780"></a>00780                                 state_str = <span class="stringliteral">&quot;minimized&quot;</span>;
<a name="l00781"></a>00781                             }
<a name="l00782"></a>00782                             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546aa1d6a669a409edc14aabbebddac07aac">GHOST_kWindowStateMaximized</a>) {
<a name="l00783"></a>00783                                 state_str = <span class="stringliteral">&quot;maximized&quot;</span>;
<a name="l00784"></a>00784                             }
<a name="l00785"></a>00785                             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ae9acbbe33f8f0c750787ce5b7485d766">GHOST_kWindowStateFullScreen</a>) {
<a name="l00786"></a>00786                                 state_str = <span class="stringliteral">&quot;fullscreen&quot;</span>;
<a name="l00787"></a>00787                             }
<a name="l00788"></a>00788                             <span class="keywordflow">else</span> {
<a name="l00789"></a>00789                                 state_str = <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>;
<a name="l00790"></a>00790                             }
<a name="l00791"></a>00791 
<a name="l00792"></a>00792                             printf(<span class="stringliteral">&quot;%s: window %d state = %s\n&quot;</span>, __func__, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a479ce2e14de90b31094c8415d0427f06">winid</a>, state_str);
<a name="l00793"></a>00793 
<a name="l00794"></a>00794                             <span class="keywordflow">if</span> (type != <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044a212393b39085dcac4c7f404becb547bd">GHOST_kEventWindowSize</a>) {
<a name="l00795"></a>00795                                 printf(<span class="stringliteral">&quot;win move event pos %d %d size %d %d\n&quot;</span>,
<a name="l00796"></a>00796                                        win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a226ce379ebcc0b691d3278c6d20e313b">posx</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae754b68a91f58a8541c1226b760ac9bb">posy</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a>);
<a name="l00797"></a>00797                             }
<a name="l00798"></a>00798                         }
<a name="l00799"></a>00799                     
<a name="l00800"></a>00800                         <a class="code" href="../../d7/d6e/wm__window_8c.html#ab9efa312329cc56778c1dc48d782341c">wm_window_make_drawable</a>(C, win);
<a name="l00801"></a>00801                         <a class="code" href="../../db/dc4/wm__draw_8c.html#a5ac2ea8890c7395f454484d23ad1e8ee">wm_draw_window_clear</a>(win);
<a name="l00802"></a>00802                         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a4d138b3b2f069a9db1d8cc28c7ed071d">NC_SCREEN</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00803"></a>00803                         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a0dce5c73d06bfc518c4c6b2189df325d">NC_WINDOW</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00804"></a>00804                     }
<a name="l00805"></a>00805                 }
<a name="l00806"></a>00806                 <span class="keywordflow">break</span>;
<a name="l00807"></a>00807             }
<a name="l00808"></a>00808                 
<a name="l00809"></a>00809             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044a606b98b013260989e9eaf6f3f84f3c55">GHOST_kEventOpenMainFile</a>:
<a name="l00810"></a>00810             {
<a name="l00811"></a>00811                 <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> props_ptr;
<a name="l00812"></a>00812                 <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *oldWindow;
<a name="l00813"></a>00813                 <span class="keywordtype">char</span> *path = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#aa6941d4540f00c95f33b23d3518d56c3">GHOST_GetEventData</a>(evt);
<a name="l00814"></a>00814                 
<a name="l00815"></a>00815                 <span class="keywordflow">if</span> (path) {
<a name="l00816"></a>00816                     <span class="comment">/* operator needs a valid window in context, ensures</span>
<a name="l00817"></a>00817 <span class="comment">                     * it is correctly set */</span>
<a name="l00818"></a>00818                     oldWindow = <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l00819"></a>00819                     <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, win);
<a name="l00820"></a>00820                     
<a name="l00821"></a>00821                     <a class="code" href="../../d6/dae/wm__operators_8c.html#ad61b3bbf58d8c110a878750c1b4731a6">WM_operator_properties_create</a>(&amp;props_ptr, <span class="stringliteral">&quot;WM_OT_open_mainfile&quot;</span>);
<a name="l00822"></a>00822                     <a class="code" href="../../d3/d10/rna__access_8c.html#a229b9421e0a1d2e5fd079ec933a2d6f5">RNA_string_set</a>(&amp;props_ptr, <span class="stringliteral">&quot;filepath&quot;</span>, path);
<a name="l00823"></a>00823                     <a class="code" href="../../df/db0/wm__event__system_8c.html#a0208cd65e2ce6a150f2653214cfc57dd">WM_operator_name_call</a>(C, <span class="stringliteral">&quot;WM_OT_open_mainfile&quot;</span>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39ad2fa38d3cd3b0844e4a1b33bbf5f918c">WM_OP_EXEC_DEFAULT</a>, &amp;props_ptr);
<a name="l00824"></a>00824                     <a class="code" href="../../d6/dae/wm__operators_8c.html#ae26f29609662ec248827ff991fe8c5cb">WM_operator_properties_free</a>(&amp;props_ptr);
<a name="l00825"></a>00825                     
<a name="l00826"></a>00826                     <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, oldWindow);
<a name="l00827"></a>00827                 }
<a name="l00828"></a>00828                 <span class="keywordflow">break</span>;
<a name="l00829"></a>00829             }
<a name="l00830"></a>00830             <span class="keywordflow">case</span> <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a316a048a989aa5ecc30cf4356f25d044a266db0bd27e72701af46d02be92787ea">GHOST_kEventDraggingDropDone</a>:
<a name="l00831"></a>00831             {
<a name="l00832"></a>00832                 <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> event;
<a name="l00833"></a>00833                 <a class="code" href="../../dc/dae/structGHOST__TEventDragnDropData.html">GHOST_TEventDragnDropData</a> *ddd = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#aa6941d4540f00c95f33b23d3518d56c3">GHOST_GetEventData</a>(evt);
<a name="l00834"></a>00834                 <span class="keywordtype">int</span> cx, cy, wx, wy;
<a name="l00835"></a>00835                 
<a name="l00836"></a>00836                 <span class="comment">/* entering window, update mouse pos */</span>
<a name="l00837"></a>00837                 <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a9d2a58b894ab5fea4e5bca61142b017e">GHOST_GetCursorPosition</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>, &amp;wx, &amp;wy);
<a name="l00838"></a>00838                 
<a name="l00839"></a>00839                 <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a255a7b25314a51c88026db1418d52eed">GHOST_ScreenToClient</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, wx, wy, &amp;cx, &amp;cy);
<a name="l00840"></a>00840                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> = cx;
<a name="l00841"></a>00841                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a> = (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a> - 1) - cy;
<a name="l00842"></a>00842                 
<a name="l00843"></a>00843                 <span class="keyword">event</span> = *(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>);  <span class="comment">/* copy last state, like mouse coords */</span>
<a name="l00844"></a>00844                 
<a name="l00845"></a>00845                 <span class="comment">// activate region</span>
<a name="l00846"></a>00846                 <span class="keyword">event</span>.type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>;
<a name="l00847"></a>00847                 <span class="keyword">event</span>.prevx = <span class="keyword">event</span>.x;
<a name="l00848"></a>00848                 <span class="keyword">event</span>.prevy = <span class="keyword">event</span>.y;
<a name="l00849"></a>00849                 
<a name="l00850"></a>00850                 wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#af6c533cdbd4dc456794e6a89d0f1fe71">winactive</a> = win; <span class="comment">/* no context change! c-&gt;wm-&gt;windrawable is drawable, or for area queues */</span>
<a name="l00851"></a>00851                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ac3a700141c9a861934cce09d66af62cf">active</a> = 1;
<a name="l00852"></a>00852                 
<a name="l00853"></a>00853                 <a class="code" href="../../df/db0/wm__event__system_8c.html#abfe9bdb8f6493c4a571052e7270eca37">wm_event_add</a>(win, &amp;event);
<a name="l00854"></a>00854                 
<a name="l00855"></a>00855                 
<a name="l00856"></a>00856                 <span class="comment">/* make blender drop event with custom data pointing to wm drags */</span>
<a name="l00857"></a>00857                 <span class="keyword">event</span>.type = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a36a2a96ac408860328476aeefa4f81c4">EVT_DROP</a>;
<a name="l00858"></a>00858                 <span class="keyword">event</span>.val = <a class="code" href="../../d4/ddc/WM__types_8h.html#afe9c69ca34c3a8d6c0b38daf64ab24b6">KM_RELEASE</a>;
<a name="l00859"></a>00859                 <span class="keyword">event</span>.custom = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a3a1b2b37da9cfd337ee6eed0a8d27f11">EVT_DATA_LISTBASE</a>;
<a name="l00860"></a>00860                 <span class="keyword">event</span>.customdata = &amp;wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a79b9d69dc9bdb8b0b49095c11d05e4f5">drags</a>;
<a name="l00861"></a>00861                 <span class="keyword">event</span>.customdatafree = 1;
<a name="l00862"></a>00862                 
<a name="l00863"></a>00863                 <a class="code" href="../../df/db0/wm__event__system_8c.html#abfe9bdb8f6493c4a571052e7270eca37">wm_event_add</a>(win, &amp;event);
<a name="l00864"></a>00864                 
<a name="l00865"></a>00865                 <span class="comment">/* printf(&quot;Drop detected\n&quot;); */</span>
<a name="l00866"></a>00866                 
<a name="l00867"></a>00867                 <span class="comment">/* add drag data to wm for paths: */</span>
<a name="l00868"></a>00868                 
<a name="l00869"></a>00869                 <span class="keywordflow">if</span> (ddd-&gt;<a class="code" href="../../dc/dae/structGHOST__TEventDragnDropData.html#a85e3424eadd9ba3e4d86fd0d67f3a042">dataType</a> == <a class="code" href="../../d2/d43/GHOST__Types_8h.html#ac332d891d6f369071197870874d0ed40a3d54cdcdee16b522db2159d47232b67b">GHOST_kDragnDropTypeFilenames</a>) {
<a name="l00870"></a>00870                     <a class="code" href="../../d4/d12/structGHOST__TStringArray.html">GHOST_TStringArray</a> *stra = ddd-&gt;<a class="code" href="../../dc/dae/structGHOST__TEventDragnDropData.html#a569bbc4916f23c12676936b4db501817">data</a>;
<a name="l00871"></a>00871                     <span class="keywordtype">int</span> a, icon;
<a name="l00872"></a>00872                     
<a name="l00873"></a>00873                     <span class="keywordflow">for</span> (a = 0; a &lt; stra-&gt;<a class="code" href="../../d4/d12/structGHOST__TStringArray.html#afd2c1217f6c0922a446ce626ef75d339">count</a>; a++) {
<a name="l00874"></a>00874                         printf(<span class="stringliteral">&quot;drop file %s\n&quot;</span>, stra-&gt;<a class="code" href="../../d4/d12/structGHOST__TStringArray.html#a737dcf498abefcea7d8d58d75253721b">strings</a>[a]);
<a name="l00875"></a>00875                         <span class="comment">/* try to get icon type from extension */</span>
<a name="l00876"></a>00876                         icon = <a class="code" href="../../db/db9/ED__fileselect_8h.html#ac3a5a3e4de5374598baacb77e81b1e60">ED_file_extension_icon</a>((<span class="keywordtype">char</span> *)stra-&gt;<a class="code" href="../../d4/d12/structGHOST__TStringArray.html#a737dcf498abefcea7d8d58d75253721b">strings</a>[a]);
<a name="l00877"></a>00877                         
<a name="l00878"></a>00878                         <a class="code" href="../../db/df3/wm__dragdrop_8c.html#ad6ca693156e46102f73b678943a76a94">WM_event_start_drag</a>(C, icon, <a class="code" href="../../d4/ddc/WM__types_8h.html#a2905a35599b97e9022a7af7d86e9aa06">WM_DRAG_PATH</a>, stra-&gt;<a class="code" href="../../d4/d12/structGHOST__TStringArray.html#a737dcf498abefcea7d8d58d75253721b">strings</a>[a], 0.0);
<a name="l00879"></a>00879                         <span class="comment">/* void poin should point to string, it makes a copy */</span>
<a name="l00880"></a>00880                         <span class="keywordflow">break</span>; <span class="comment">// only one drop element supported now </span>
<a name="l00881"></a>00881                     }
<a name="l00882"></a>00882                 }
<a name="l00883"></a>00883                 
<a name="l00884"></a>00884                 
<a name="l00885"></a>00885                 
<a name="l00886"></a>00886                 <span class="keywordflow">break</span>;
<a name="l00887"></a>00887             }
<a name="l00888"></a>00888             
<a name="l00889"></a>00889             <span class="keywordflow">default</span>:
<a name="l00890"></a>00890                 <a class="code" href="../../df/db0/wm__event__system_8c.html#a7aa6eb88f7d4cec56d5935171ffb6831">wm_event_add_ghostevent</a>(wm, win, type, time, data);
<a name="l00891"></a>00891                 <span class="keywordflow">break</span>;
<a name="l00892"></a>00892         }
<a name="l00893"></a>00893 
<a name="l00894"></a>00894     }
<a name="l00895"></a>00895     <span class="keywordflow">return</span> 1;
<a name="l00896"></a>00896 }
<a name="l00897"></a>00897 
<a name="l00898"></a>00898 
<a name="l00899"></a>00899 <span class="comment">/* This timer system only gives maximum 1 timer event per redraw cycle,</span>
<a name="l00900"></a>00900 <span class="comment"> * to prevent queues to get overloaded.</span>
<a name="l00901"></a>00901 <span class="comment"> * Timer handlers should check for delta to decide if they just</span>
<a name="l00902"></a>00902 <span class="comment"> * update, or follow real time.</span>
<a name="l00903"></a>00903 <span class="comment"> * Timer handlers can also set duration to match frames passed</span>
<a name="l00904"></a>00904 <span class="comment"> */</span>
<a name="l00905"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#a767c3fb763c5644eda9c7b3cbaf7affe">00905</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a767c3fb763c5644eda9c7b3cbaf7affe">wm_window_timer</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l00906"></a>00906 {
<a name="l00907"></a>00907     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm = <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l00908"></a>00908     <a class="code" href="../../d9/d33/structwmTimer.html">wmTimer</a> *wt, *wtnext;
<a name="l00909"></a>00909     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win;
<a name="l00910"></a>00910     <span class="keywordtype">double</span> time = <a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>();
<a name="l00911"></a>00911     <span class="keywordtype">int</span> retval = 0;
<a name="l00912"></a>00912     
<a name="l00913"></a>00913     <span class="keywordflow">for</span> (wt = wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a09c073df6c2cddfff3f03994c3546699">timers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; wt; wt = wtnext) {
<a name="l00914"></a>00914         wtnext = wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#aec52c7e06c39656951a111bbf66e6839">next</a>; <span class="comment">/* in case timer gets removed */</span>
<a name="l00915"></a>00915         win = wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#aed706a3554face884388138e1b949376">win</a>;
<a name="l00916"></a>00916 
<a name="l00917"></a>00917         <span class="keywordflow">if</span> (wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a4b7009b4a5482217bcc86247f0747293">sleep</a>== 0) {
<a name="l00918"></a>00918             <span class="keywordflow">if</span> (time &gt; wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#af6d1aeac6783986705befdaabba2bd02">ntime</a>) {
<a name="l00919"></a>00919                 wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#af29a514f678007fee773c7218c69d88f">delta</a> = time - wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a199d75caf175e15a8256a7552bada95a">ltime</a>;
<a name="l00920"></a>00920                 wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#afccd0baaa4b4d59df1529233fba5aa20">duration</a> += wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#af29a514f678007fee773c7218c69d88f">delta</a>;
<a name="l00921"></a>00921                 wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a199d75caf175e15a8256a7552bada95a">ltime</a> = time;
<a name="l00922"></a>00922                 wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#af6d1aeac6783986705befdaabba2bd02">ntime</a> = wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a0c275c8fe71840c6b6b6cfe4a7741c7d">stime</a> + wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a0ae23d40ac2b2a3bf2c9e9b7a3f5f0d0">timestep</a> *ceil(wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#afccd0baaa4b4d59df1529233fba5aa20">duration</a> / wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a0ae23d40ac2b2a3bf2c9e9b7a3f5f0d0">timestep</a>);
<a name="l00923"></a>00923 
<a name="l00924"></a>00924                 <span class="keywordflow">if</span> (wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a103a7495ca81c7f81c0edc2eb9d98bdc">event_type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6328dc09134f736a0b95d8848b25447e">TIMERJOBS</a>)
<a name="l00925"></a>00925                     <a class="code" href="../../d6/ddf/wm__jobs_8c.html#a11a5557d2ec25de4d5db7cfe5679cc46">wm_jobs_timer</a>(C, wm, wt);
<a name="l00926"></a>00926                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a103a7495ca81c7f81c0edc2eb9d98bdc">event_type</a> == <a class="code" href="../../d1/d40/wm__event__types_8h.html#adf500ab0ca3baf07c875ca57db8038d6">TIMERAUTOSAVE</a>)
<a name="l00927"></a>00927                     <a class="code" href="../../dc/d8b/wm__files_8c.html#a5b59062ab91c4c457a9be3513f6333c9">wm_autosave_timer</a>(C, wm, wt);
<a name="l00928"></a>00928                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (win) {
<a name="l00929"></a>00929                     <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> <span class="keyword">event</span> = *(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>);
<a name="l00930"></a>00930                     
<a name="l00931"></a>00931                     <span class="keyword">event</span>.<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a> = wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a103a7495ca81c7f81c0edc2eb9d98bdc">event_type</a>;
<a name="l00932"></a>00932                     <span class="keyword">event</span>.custom = <a class="code" href="../../d1/d40/wm__event__types_8h.html#a72ea9959a22a0ce665e6130c8e0f7815">EVT_DATA_TIMER</a>;
<a name="l00933"></a>00933                     <span class="keyword">event</span>.customdata = wt;
<a name="l00934"></a>00934                     <a class="code" href="../../df/db0/wm__event__system_8c.html#abfe9bdb8f6493c4a571052e7270eca37">wm_event_add</a>(win, &amp;event);
<a name="l00935"></a>00935 
<a name="l00936"></a>00936                     retval = 1;
<a name="l00937"></a>00937                 }
<a name="l00938"></a>00938             }
<a name="l00939"></a>00939         }
<a name="l00940"></a>00940     }
<a name="l00941"></a>00941     <span class="keywordflow">return</span> retval;
<a name="l00942"></a>00942 }
<a name="l00943"></a>00943 
<a name="l00944"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#a9868202f1d1d4be672e8d9dbcffad994">00944</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a9868202f1d1d4be672e8d9dbcffad994">wm_window_process_events</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C) 
<a name="l00945"></a>00945 {
<a name="l00946"></a>00946     <span class="keywordtype">int</span> hasevent = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a06ee557d44fed19e6a938833639fa521">GHOST_ProcessEvents</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>, 0); <span class="comment">/* 0 is no wait */</span>
<a name="l00947"></a>00947     
<a name="l00948"></a>00948     <span class="keywordflow">if</span> (hasevent)
<a name="l00949"></a>00949         <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a661bacb17c90b508789d662fcf2526c0">GHOST_DispatchEvents</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>);
<a name="l00950"></a>00950     
<a name="l00951"></a>00951     hasevent |= <a class="code" href="../../d7/d6e/wm__window_8c.html#a767c3fb763c5644eda9c7b3cbaf7affe">wm_window_timer</a>(C);
<a name="l00952"></a>00952 
<a name="l00953"></a>00953     <span class="comment">/* no event, we sleep 5 milliseconds */</span>
<a name="l00954"></a>00954     <span class="keywordflow">if</span> (hasevent == 0)
<a name="l00955"></a>00955         <a class="code" href="../../df/d73/time_8c.html#a43667128024aa660ab9adfbd5df9e88a">PIL_sleep_ms</a>(5);
<a name="l00956"></a>00956 }
<a name="l00957"></a>00957 
<a name="l00958"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#a9f47df4134fc0a4a009014a2626543b5">00958</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a9f47df4134fc0a4a009014a2626543b5">wm_window_process_events_nosleep</a>(<span class="keywordtype">void</span>) 
<a name="l00959"></a>00959 {
<a name="l00960"></a>00960     <span class="keywordflow">if</span> (<a class="code" href="../../db/d51/GHOST__C-api_8h.html#a06ee557d44fed19e6a938833639fa521">GHOST_ProcessEvents</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>, 0))
<a name="l00961"></a>00961         <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a661bacb17c90b508789d662fcf2526c0">GHOST_DispatchEvents</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>);
<a name="l00962"></a>00962 }
<a name="l00963"></a>00963 
<a name="l00964"></a>00964 <span class="comment">/* exported as handle callback to bke blender.c */</span>
<a name="l00965"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#a00300ed0c2c1963179fd3aaa1c1f94b6">00965</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a00300ed0c2c1963179fd3aaa1c1f94b6">wm_window_testbreak</a>(<span class="keywordtype">void</span>)
<a name="l00966"></a>00966 {
<a name="l00967"></a>00967     <span class="keyword">static</span> <span class="keywordtype">double</span> ltime = 0;
<a name="l00968"></a>00968     <span class="keywordtype">double</span> curtime = <a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>();
<a name="l00969"></a>00969     
<a name="l00970"></a>00970     <span class="comment">/* only check for breaks every 50 milliseconds</span>
<a name="l00971"></a>00971 <span class="comment">     * if we get called more often.</span>
<a name="l00972"></a>00972 <span class="comment">     */</span>
<a name="l00973"></a>00973     <span class="keywordflow">if</span> ((curtime - ltime) &gt; .05) {
<a name="l00974"></a>00974         <span class="keywordtype">int</span> hasevent = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a06ee557d44fed19e6a938833639fa521">GHOST_ProcessEvents</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>, 0); <span class="comment">/* 0 is no wait */</span>
<a name="l00975"></a>00975         
<a name="l00976"></a>00976         <span class="keywordflow">if</span> (hasevent)
<a name="l00977"></a>00977             <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a661bacb17c90b508789d662fcf2526c0">GHOST_DispatchEvents</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>);
<a name="l00978"></a>00978         
<a name="l00979"></a>00979         ltime = curtime;
<a name="l00980"></a>00980     }
<a name="l00981"></a>00981 }
<a name="l00982"></a>00982 
<a name="l00983"></a>00983 <span class="comment">/* **************** init ********************** */</span>
<a name="l00984"></a>00984 
<a name="l00985"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#ae423dfb57f02ce6cc259776af6f3586b">00985</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#ae423dfb57f02ce6cc259776af6f3586b">wm_ghost_init</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l00986"></a>00986 {
<a name="l00987"></a>00987     <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>) {
<a name="l00988"></a>00988         GHOST_EventConsumerHandle consumer = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#aebfaf9468f07498ae9510812b1b8beef">GHOST_CreateEventConsumer</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#afe1594886ba9aecc1b7b1131858bbb28">ghost_event_proc</a>, C);
<a name="l00989"></a>00989         
<a name="l00990"></a>00990         <a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a> = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a32adc6384079f58e94de347390bd8bca">GHOST_CreateSystem</a>();
<a name="l00991"></a>00991         <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a33b474608df11aa472ceb03acfb08646">GHOST_AddEventConsumer</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>, consumer);
<a name="l00992"></a>00992     }   
<a name="l00993"></a>00993 }
<a name="l00994"></a>00994 
<a name="l00995"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#a22078d0816252dca45794445642506ee">00995</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a22078d0816252dca45794445642506ee">wm_ghost_exit</a>(<span class="keywordtype">void</span>)
<a name="l00996"></a>00996 {
<a name="l00997"></a>00997     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>)
<a name="l00998"></a>00998         <a class="code" href="../../db/d51/GHOST__C-api_8h.html#af413de74f188006444ab9e358a4931c3">GHOST_DisposeSystem</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>);
<a name="l00999"></a>00999 
<a name="l01000"></a>01000     <a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01001"></a>01001 }
<a name="l01002"></a>01002 
<a name="l01003"></a>01003 <span class="comment">/* **************** timer ********************** */</span>
<a name="l01004"></a>01004 
<a name="l01005"></a>01005 <span class="comment">/* to (de)activate running timers temporary */</span>
<a name="l01006"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#aac640b2e0eec094b25ab707702fae91a">01006</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#aac640b2e0eec094b25ab707702fae91a">WM_event_timer_sleep</a>(<a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm, <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(win), <a class="code" href="../../d9/d33/structwmTimer.html">wmTimer</a> *timer, <span class="keywordtype">int</span> dosleep)
<a name="l01007"></a>01007 {
<a name="l01008"></a>01008     <a class="code" href="../../d9/d33/structwmTimer.html">wmTimer</a> *wt;
<a name="l01009"></a>01009     
<a name="l01010"></a>01010     <span class="keywordflow">for</span> (wt = wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a09c073df6c2cddfff3f03994c3546699">timers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; wt; wt = wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#aec52c7e06c39656951a111bbf66e6839">next</a>)
<a name="l01011"></a>01011         <span class="keywordflow">if</span> (wt == timer)
<a name="l01012"></a>01012             <span class="keywordflow">break</span>;
<a name="l01013"></a>01013 
<a name="l01014"></a>01014     <span class="keywordflow">if</span> (wt)
<a name="l01015"></a>01015         wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a4b7009b4a5482217bcc86247f0747293">sleep</a> = dosleep;
<a name="l01016"></a>01016 }
<a name="l01017"></a>01017 
<a name="l01018"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#aef8ea58d8780e90ecbedf5f12f2e50c5">01018</a> <a class="code" href="../../d9/d33/structwmTimer.html">wmTimer</a> *<a class="code" href="../../d7/d6e/wm__window_8c.html#af5bdd7109c7ea81c77a89d9f41585f3a">WM_event_add_timer</a>(<a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm, <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win, <span class="keywordtype">int</span> event_type, <span class="keywordtype">double</span> timestep)
<a name="l01019"></a>01019 {
<a name="l01020"></a>01020     <a class="code" href="../../d9/d33/structwmTimer.html">wmTimer</a> *wt = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d33/structwmTimer.html">wmTimer</a>), <span class="stringliteral">&quot;window timer&quot;</span>);
<a name="l01021"></a>01021     
<a name="l01022"></a>01022     wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a103a7495ca81c7f81c0edc2eb9d98bdc">event_type</a> = event_type;
<a name="l01023"></a>01023     wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a199d75caf175e15a8256a7552bada95a">ltime</a> = <a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>();
<a name="l01024"></a>01024     wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#af6d1aeac6783986705befdaabba2bd02">ntime</a> = wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a199d75caf175e15a8256a7552bada95a">ltime</a> + timestep;
<a name="l01025"></a>01025     wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a0c275c8fe71840c6b6b6cfe4a7741c7d">stime</a> = wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a199d75caf175e15a8256a7552bada95a">ltime</a>;
<a name="l01026"></a>01026     wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a0ae23d40ac2b2a3bf2c9e9b7a3f5f0d0">timestep</a> = timestep;
<a name="l01027"></a>01027     wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#aed706a3554face884388138e1b949376">win</a> = win;
<a name="l01028"></a>01028     
<a name="l01029"></a>01029     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a09c073df6c2cddfff3f03994c3546699">timers</a>, wt);
<a name="l01030"></a>01030     
<a name="l01031"></a>01031     <span class="keywordflow">return</span> wt;
<a name="l01032"></a>01032 }
<a name="l01033"></a>01033 
<a name="l01034"></a><a class="code" href="../../d7/d6e/wm__window_8c.html#a1a9f31ba88dd1dd3982b3d8f02de2e75">01034</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a1a9f31ba88dd1dd3982b3d8f02de2e75">WM_event_remove_timer</a>(<a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm, <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(win), <a class="code" href="../../d9/d33/structwmTimer.html">wmTimer</a> *timer)
<a name="l01035"></a>01035 {
<a name="l01036"></a>01036     <a class="code" href="../../d9/d33/structwmTimer.html">wmTimer</a> *wt;
<a name="l01037"></a>01037     
<a name="l01038"></a>01038     <span class="comment">/* extra security check */</span>
<a name="l01039"></a>01039     <span class="keywordflow">for</span> (wt = wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a09c073df6c2cddfff3f03994c3546699">timers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; wt; wt = wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#aec52c7e06c39656951a111bbf66e6839">next</a>)
<a name="l01040"></a>01040         <span class="keywordflow">if</span> (wt == timer)
<a name="l01041"></a>01041             <span class="keywordflow">break</span>;
<a name="l01042"></a>01042     <span class="keywordflow">if</span> (wt) {
<a name="l01043"></a>01043         <span class="keywordflow">if</span> (wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a4721c4ea8fa38a2c2f4ed3b569a4966b">reports</a>.<a class="code" href="../../df/df0/structReportList.html#ac65127a29493297881520cb6a06be0fd">reporttimer</a> == wt)
<a name="l01044"></a>01044             wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a4721c4ea8fa38a2c2f4ed3b569a4966b">reports</a>.<a class="code" href="../../df/df0/structReportList.html#ac65127a29493297881520cb6a06be0fd">reporttimer</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01045"></a>01045         
<a name="l01046"></a>01046         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a09c073df6c2cddfff3f03994c3546699">timers</a>, wt);
<a name="l01047"></a>01047         <span class="keywordflow">if</span> (wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a7e5850b6474f3948cb59cbd188ce68a6">customdata</a>)
<a name="l01048"></a>01048             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a7e5850b6474f3948cb59cbd188ce68a6">customdata</a>);
<a name="l01049"></a>01049         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(wt);
<a name="l01050"></a>01050     }
<a name="l01051"></a>01051 }
<a name="l01052"></a>01052 
<a name="l01053"></a>01053 <span class="comment">/* ******************* clipboard **************** */</span>
<a name="l01054"></a>01054 
<a name="l01055"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#ad2a3ffd172f243ff5201bf82cf79c532">01055</a> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d6e/wm__window_8c.html#ad2a3ffd172f243ff5201bf82cf79c532">WM_clipboard_text_get</a>(<span class="keywordtype">int</span> selection)
<a name="l01056"></a>01056 {
<a name="l01057"></a>01057     <span class="keywordtype">char</span> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>, *p2, *buf, *newbuf;
<a name="l01058"></a>01058 
<a name="l01059"></a>01059     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.background)
<a name="l01060"></a>01060         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01061"></a>01061 
<a name="l01062"></a>01062     buf = (<span class="keywordtype">char</span> *)<a class="code" href="../../db/d51/GHOST__C-api_8h.html#a93fdb9d436a287072be0bba92efd091d">GHOST_getClipboard</a>(selection);
<a name="l01063"></a>01063     <span class="keywordflow">if</span> (!buf)
<a name="l01064"></a>01064         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01065"></a>01065     
<a name="l01066"></a>01066     <span class="comment">/* always convert from \r\n to \n */</span>
<a name="l01067"></a>01067     newbuf = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(buf) + 1, <span class="stringliteral">&quot;WM_clipboard_text_get&quot;</span>);
<a name="l01068"></a>01068 
<a name="l01069"></a>01069     <span class="keywordflow">for</span> (p = buf, p2 = newbuf; *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>; p++) {
<a name="l01070"></a>01070         <span class="keywordflow">if</span> (*p != <span class="charliteral">&#39;\r&#39;</span>)
<a name="l01071"></a>01071             *(p2++) = *p;
<a name="l01072"></a>01072     }
<a name="l01073"></a>01073     *p2 = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01074"></a>01074 
<a name="l01075"></a>01075     free(buf); <span class="comment">/* ghost uses regular malloc */</span>
<a name="l01076"></a>01076     
<a name="l01077"></a>01077     <span class="keywordflow">return</span> newbuf;
<a name="l01078"></a>01078 }
<a name="l01079"></a>01079 
<a name="l01080"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#ad79c37fb28818628077bdb8cbfd1bc53">01080</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#ad79c37fb28818628077bdb8cbfd1bc53">WM_clipboard_text_set</a>(<span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> selection)
<a name="l01081"></a>01081 {
<a name="l01082"></a>01082     <span class="keywordflow">if</span> (!<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.background) {
<a name="l01083"></a>01083 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l01084"></a>01084 <span class="preprocessor"></span>        <span class="comment">/* do conversion from \n to \r\n on Windows */</span>
<a name="l01085"></a>01085         <span class="keywordtype">char</span> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>, *p2, *newbuf;
<a name="l01086"></a>01086         <span class="keywordtype">int</span> newlen = 0;
<a name="l01087"></a>01087         
<a name="l01088"></a>01088         <span class="keywordflow">for</span> (p = buf; *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>; p++) {
<a name="l01089"></a>01089             <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;\n&#39;</span>)
<a name="l01090"></a>01090                 newlen += 2;
<a name="l01091"></a>01091             <span class="keywordflow">else</span>
<a name="l01092"></a>01092                 newlen++;
<a name="l01093"></a>01093         }
<a name="l01094"></a>01094         
<a name="l01095"></a>01095         newbuf = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(newlen + 1, <span class="stringliteral">&quot;WM_clipboard_text_set&quot;</span>);
<a name="l01096"></a>01096     
<a name="l01097"></a>01097         <span class="keywordflow">for</span> (p = buf, p2 = newbuf; *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>; p++, p2++) {
<a name="l01098"></a>01098             <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;\n&#39;</span>) {
<a name="l01099"></a>01099                 *(p2++) = <span class="charliteral">&#39;\r&#39;</span>; *p2 = <span class="charliteral">&#39;\n&#39;</span>;
<a name="l01100"></a>01100             }
<a name="l01101"></a>01101             <span class="keywordflow">else</span> *p2 = *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l01102"></a>01102         }
<a name="l01103"></a>01103         *p2 = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01104"></a>01104     
<a name="l01105"></a>01105         <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a2ecaa4d4643941afd6112403e5540c91">GHOST_putClipboard</a>((<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a91ce42cdaaa11ecbbf44bbd683c14c00">GHOST_TInt8</a> *)newbuf, selection);
<a name="l01106"></a>01106         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(newbuf);
<a name="l01107"></a>01107 <span class="preprocessor">#else</span>
<a name="l01108"></a>01108 <span class="preprocessor"></span>        <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a2ecaa4d4643941afd6112403e5540c91">GHOST_putClipboard</a>((<a class="code" href="../../d2/d43/GHOST__Types_8h.html#a91ce42cdaaa11ecbbf44bbd683c14c00">GHOST_TInt8</a> *)buf, selection);
<a name="l01109"></a>01109 <span class="preprocessor">#endif</span>
<a name="l01110"></a>01110 <span class="preprocessor"></span>    }
<a name="l01111"></a>01111 }
<a name="l01112"></a>01112 
<a name="l01113"></a>01113 <span class="comment">/* ******************* progress bar **************** */</span>
<a name="l01114"></a>01114 
<a name="l01115"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a45fe60edaa6aef245db37c550134888c">01115</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#aac338f958a14067e265f32b0825a6c15">WM_progress_set</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win, <span class="keywordtype">float</span> progress)
<a name="l01116"></a>01116 {
<a name="l01117"></a>01117     <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a705eaadaa13dd2e92f7c25f06d903bfe">GHOST_SetProgressBar</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, progress);
<a name="l01118"></a>01118 }
<a name="l01119"></a>01119 
<a name="l01120"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#ade218b992976da3ec4eebc8f175a72a1">01120</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#aa66df224c369a270fbfa4338c44a51e6">WM_progress_clear</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win)
<a name="l01121"></a>01121 {
<a name="l01122"></a>01122     <a class="code" href="../../db/d51/GHOST__C-api_8h.html#ae94f5aa485921a8ada47d8cbe878b490">GHOST_EndProgressBar</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>);
<a name="l01123"></a>01123 }
<a name="l01124"></a>01124 
<a name="l01125"></a>01125 <span class="comment">/* ************************************ */</span>
<a name="l01126"></a>01126 
<a name="l01127"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#a0fe54b7845bc077c13b211afa0f167a6">01127</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a0fe54b7845bc077c13b211afa0f167a6">wm_window_get_position</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win, <span class="keywordtype">int</span> *posx_r, <span class="keywordtype">int</span> *posy_r) 
<a name="l01128"></a>01128 {
<a name="l01129"></a>01129     *posx_r = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a226ce379ebcc0b691d3278c6d20e313b">posx</a>;
<a name="l01130"></a>01130     *posy_r = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#ae754b68a91f58a8541c1226b760ac9bb">posy</a>;
<a name="l01131"></a>01131 }
<a name="l01132"></a>01132 
<a name="l01133"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#a06bcc0cceefb275c24b9362a4ec60e88">01133</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a06bcc0cceefb275c24b9362a4ec60e88">wm_window_get_size</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win, <span class="keywordtype">int</span> *width_r, <span class="keywordtype">int</span> *height_r) 
<a name="l01134"></a>01134 {
<a name="l01135"></a>01135     *width_r = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a>;
<a name="l01136"></a>01136     *height_r = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a>;
<a name="l01137"></a>01137 }
<a name="l01138"></a>01138 
<a name="l01139"></a>01139 <span class="comment">/* exceptional case: - splash is called before events are processed</span>
<a name="l01140"></a>01140 <span class="comment"> * this means we don&#39;t actually know the window size so get this from GHOST */</span>
<a name="l01141"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#ad6fe301a9334ad7b1d7cb58e1ae017fc">01141</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#ad6fe301a9334ad7b1d7cb58e1ae017fc">wm_window_get_size_ghost</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win, <span class="keywordtype">int</span> *width_r, <span class="keywordtype">int</span> *height_r)
<a name="l01142"></a>01142 {
<a name="l01143"></a>01143     GHOST_RectangleHandle <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a42f734331cf10fc65cd1c80c5d764ebc">bounds</a> = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#af05e86b7a8b03fd862a395373c52761b">GHOST_GetClientBounds</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>);
<a name="l01144"></a>01144     *width_r = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a9a4acd792d6fe7f2e4ef3fcd360d3152">GHOST_GetWidthRectangle</a>(bounds);
<a name="l01145"></a>01145     *height_r = <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a20be1ab149ec7955197fb9d82a3fc15e">GHOST_GetHeightRectangle</a>(bounds);
<a name="l01146"></a>01146     
<a name="l01147"></a>01147     <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a4836dae91eca24cf51f24ab04ab75326">GHOST_DisposeRectangle</a>(bounds);
<a name="l01148"></a>01148 }
<a name="l01149"></a>01149 
<a name="l01150"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#a7767eb3f0fe79eebe978e2e878ca5de5">01150</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a7767eb3f0fe79eebe978e2e878ca5de5">wm_window_set_size</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win, <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height) 
<a name="l01151"></a>01151 {
<a name="l01152"></a>01152     <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a4149f60d402cbe9a42194ece9f291a88">GHOST_SetClientSize</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, width, height);
<a name="l01153"></a>01153 }
<a name="l01154"></a>01154 
<a name="l01155"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#af926ea80479c51a0c6ceeea3ac0f030c">01155</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#af926ea80479c51a0c6ceeea3ac0f030c">wm_window_lower</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win) 
<a name="l01156"></a>01156 {
<a name="l01157"></a>01157     <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a1ce4c15b47f1e9524b60b66a96d73613">GHOST_SetWindowOrder</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a98e2ea9151fa7e56d5fec53484d83069ac2cf836ec7436be975af681e889351b7">GHOST_kWindowOrderBottom</a>);
<a name="l01158"></a>01158 }
<a name="l01159"></a>01159 
<a name="l01160"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#a1efb5a20c4d9ce7e67e572f7baf6040e">01160</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a1efb5a20c4d9ce7e67e572f7baf6040e">wm_window_raise</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win) 
<a name="l01161"></a>01161 {
<a name="l01162"></a>01162     <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a1ce4c15b47f1e9524b60b66a96d73613">GHOST_SetWindowOrder</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a98e2ea9151fa7e56d5fec53484d83069a54095e8130beaf2a5bfbb3c175bad889">GHOST_kWindowOrderTop</a>);
<a name="l01163"></a>01163 }
<a name="l01164"></a>01164 
<a name="l01165"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#a271f5e4d69d585d92bcd9f03e4027dcf">01165</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a271f5e4d69d585d92bcd9f03e4027dcf">wm_window_swap_buffers</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win)
<a name="l01166"></a>01166 {
<a name="l01167"></a>01167     
<a name="l01168"></a>01168 <span class="preprocessor">#ifdef WIN32</span>
<a name="l01169"></a>01169 <span class="preprocessor"></span>    glDisable(GL_SCISSOR_TEST);
<a name="l01170"></a>01170     <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a9a7adeef59cac5a7b3a1cb38f0ac85cf">GHOST_SwapWindowBuffers</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>);
<a name="l01171"></a>01171     glEnable(GL_SCISSOR_TEST);
<a name="l01172"></a>01172 <span class="preprocessor">#else</span>
<a name="l01173"></a>01173 <span class="preprocessor"></span>    <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a9a7adeef59cac5a7b3a1cb38f0ac85cf">GHOST_SwapWindowBuffers</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>);
<a name="l01174"></a>01174 <span class="preprocessor">#endif</span>
<a name="l01175"></a>01175 <span class="preprocessor"></span>}
<a name="l01176"></a>01176 
<a name="l01177"></a><a class="code" href="../../d0/d6b/wm__window_8h.html#ac47afd8f0d85eea4732713413efa0011">01177</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#ac47afd8f0d85eea4732713413efa0011">wm_get_cursor_position</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win, <span class="keywordtype">int</span> *x, <span class="keywordtype">int</span> *y)
<a name="l01178"></a>01178 {
<a name="l01179"></a>01179     <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a9d2a58b894ab5fea4e5bca61142b017e">GHOST_GetCursorPosition</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>, x, y);
<a name="l01180"></a>01180     <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a255a7b25314a51c88026db1418d52eed">GHOST_ScreenToClient</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, *x, *y, x, y);
<a name="l01181"></a>01181     *y = (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a> - 1) - *y;
<a name="l01182"></a>01182 }
<a name="l01183"></a>01183 
<a name="l01184"></a>01184 <span class="comment">/* ******************* exported api ***************** */</span>
<a name="l01185"></a>01185 
<a name="l01186"></a>01186 
<a name="l01187"></a>01187 <span class="comment">/* called whem no ghost system was initialized */</span>
<a name="l01188"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#acca14c0836b23501cd1651627eecb9dd">01188</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#acca14c0836b23501cd1651627eecb9dd">WM_setprefsize</a>(<span class="keywordtype">int</span> stax, <span class="keywordtype">int</span> stay, <span class="keywordtype">int</span> sizx, <span class="keywordtype">int</span> sizy)
<a name="l01189"></a>01189 {
<a name="l01190"></a>01190     <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#a9c513dfc69663c4265c4eb21d82c2ffa">start_x</a> = stax; <span class="comment">/* left hand pos */</span>
<a name="l01191"></a>01191     <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#a30681a301d1947075eaca03c35ea8a9f">start_y</a> = stay; <span class="comment">/* bottom pos */</span>
<a name="l01192"></a>01192     <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#a14551253b5d67da753fb03c2369be66b">size_x</a> = sizx;
<a name="l01193"></a>01193     <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#aeefda7a40b4a5fb3f7878cc933ba5f71">size_y</a> = sizy;
<a name="l01194"></a>01194     <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#a4e8e702aad7310baa28916a99e922db8">override_flag</a> |= <a class="code" href="../../d7/d6e/wm__window_8c.html#a3ee5a57e4d05602f20642e0d45b95a2eaf9ba44795a5311ef93f432a3807c5550">WIN_OVERRIDE_GEOM</a>;
<a name="l01195"></a>01195 }
<a name="l01196"></a>01196 
<a name="l01197"></a>01197 <span class="comment">/* for borderless and border windows set from command-line */</span>
<a name="l01198"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#a64f2ba3c62a5c869cdb1cb6474ab2ea2">01198</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a64f2ba3c62a5c869cdb1cb6474ab2ea2">WM_setinitialstate_fullscreen</a>(<span class="keywordtype">void</span>)
<a name="l01199"></a>01199 {
<a name="l01200"></a>01200     <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#aa8e13c49b4152a72a7c12552aeb43ddb">windowstate</a> = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ae9acbbe33f8f0c750787ce5b7485d766">GHOST_kWindowStateFullScreen</a>;
<a name="l01201"></a>01201     <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#a4e8e702aad7310baa28916a99e922db8">override_flag</a> |= <a class="code" href="../../d7/d6e/wm__window_8c.html#a3ee5a57e4d05602f20642e0d45b95a2ea3971fc61cd181c5dc28444488185c90d">WIN_OVERRIDE_WINSTATE</a>;
<a name="l01202"></a>01202 }
<a name="l01203"></a>01203 
<a name="l01204"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#aa3d07cf458b8afea536d8d000f6fbe24">01204</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#aa3d07cf458b8afea536d8d000f6fbe24">WM_setinitialstate_normal</a>(<span class="keywordtype">void</span>)
<a name="l01205"></a>01205 {
<a name="l01206"></a>01206     <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#aa8e13c49b4152a72a7c12552aeb43ddb">windowstate</a> = <a class="code" href="../../d2/d43/GHOST__Types_8h.html#a18a06d65ad2eecfbde897c30070ff546ad2bf9ca21ca8bce907d58cd71e8067c6">GHOST_kWindowStateNormal</a>;
<a name="l01207"></a>01207     <a class="code" href="../../d7/d6e/wm__window_8c.html#a203c1ef93def14be2ac28722a38180b8">wm_init_state</a>.<a class="code" href="../../d2/d69/structWMInitStruct.html#a4e8e702aad7310baa28916a99e922db8">override_flag</a> |= <a class="code" href="../../d7/d6e/wm__window_8c.html#a3ee5a57e4d05602f20642e0d45b95a2ea3971fc61cd181c5dc28444488185c90d">WIN_OVERRIDE_WINSTATE</a>;
<a name="l01208"></a>01208 }
<a name="l01209"></a>01209 
<a name="l01210"></a>01210 <span class="comment">/* This function requires access to the GHOST_SystemHandle (g_system) */</span>
<a name="l01211"></a><a class="code" href="../../d4/d7f/WM__api_8h.html#aca70cab34de46f70801a6426b0c2d16c">01211</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d6e/wm__window_8c.html#a4ca489e1880d818dc7c927e73c4899dc">WM_cursor_warp</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)
<a name="l01212"></a>01212 {
<a name="l01213"></a>01213     <span class="keywordflow">if</span> (win &amp;&amp; win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>) {
<a name="l01214"></a>01214         <span class="keywordtype">int</span> oldx = x, oldy = y;
<a name="l01215"></a>01215 
<a name="l01216"></a>01216         y = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a> - y - 1;
<a name="l01217"></a>01217 
<a name="l01218"></a>01218         <a class="code" href="../../db/d51/GHOST__C-api_8h.html#ab61a5744a1d6c665ac13ef3bdf2d8a04">GHOST_ClientToScreen</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a0b18385d651b9080f878622295f93b43">ghostwin</a>, x, y, &amp;x, &amp;y);
<a name="l01219"></a>01219         <a class="code" href="../../db/d51/GHOST__C-api_8h.html#a99eaeac143e2ed71004ba028949fabe0">GHOST_SetCursorPosition</a>(<a class="code" href="../../d7/d6e/wm__window_8c.html#a1032b5874a6a919777cc99a82508b4ee">g_system</a>, x, y);
<a name="l01220"></a>01220 
<a name="l01221"></a>01221         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#ae82a74a8a8f426501aab0b260aeb9189">prevx</a> = oldx;
<a name="l01222"></a>01222         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa3a33c2ca6525fb33d25b67e50bea0eb">prevy</a> = oldy;
<a name="l01223"></a>01223     }
<a name="l01224"></a>01224 }
<a name="l01225"></a>01225 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:55:05 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

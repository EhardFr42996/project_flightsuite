<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: Texture.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">Texture.cpp</div>  </div>
</div>
<div class="contents">
<a href="../../d5/d87/Texture_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">-----------------------------------------------------------------------------</span>
<a name="l00003"></a>00003 <span class="comment">This source file is part of VideoTexture library</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">Copyright (c) 2007 The Zdeno Ash Miklas</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">This program is free software; you can redistribute it and/or modify it under</span>
<a name="l00008"></a>00008 <span class="comment">the terms of the GNU Lesser General Public License as published by the Free Software</span>
<a name="l00009"></a>00009 <span class="comment">Foundation; either version 2 of the License, or (at your option) any later</span>
<a name="l00010"></a>00010 <span class="comment">version.</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</span>
<a name="l00013"></a>00013 <span class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span>
<a name="l00014"></a>00014 <span class="comment">FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.</span>
<a name="l00015"></a>00015 <span class="comment"></span>
<a name="l00016"></a>00016 <span class="comment">You should have received a copy of the GNU Lesser General Public License along with</span>
<a name="l00017"></a>00017 <span class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</span>
<a name="l00018"></a>00018 <span class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</span>
<a name="l00019"></a>00019 <span class="comment">http://www.gnu.org/copyleft/lesser.txt.</span>
<a name="l00020"></a>00020 <span class="comment">-----------------------------------------------------------------------------</span>
<a name="l00021"></a>00021 <span class="comment">*/</span>
<a name="l00022"></a>00022 
<a name="l00027"></a>00027 <span class="comment">// implementation</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="../../d7/db2/PyObjectPlus_8h.html">PyObjectPlus.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;structmember.h&gt;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="../../d8/dc5/KX__GameObject_8h.html" title="General KX game object.">KX_GameObject.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="../../d5/d62/RAS__MeshObject_8h.html">RAS_MeshObject.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="../../df/d96/DNA__mesh__types_8h.html">DNA_mesh_types.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html">DNA_meshdata_types.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="../../d2/d94/DNA__image__types_8h.html">DNA_image_types.h</a>&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;<a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html" title="Contains defines and structs used throughout the imbuf module.">IMB_imbuf_types.h</a>&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;<a class="code" href="../../da/da5/KX__PolygonMaterial_8h.html">KX_PolygonMaterial.h</a>&gt;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&gt;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;<a class="code" href="../../da/d9b/KX__BlenderMaterial_8h.html">KX_BlenderMaterial.h</a>&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;<a class="code" href="../../df/dbb/BL__Texture_8h.html">BL_Texture.h</a>&gt;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/de7/KX__KetsjiEngine_8h.html">KX_KetsjiEngine.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/de4/KX__PythonInit_8h.html">KX_PythonInit.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dbf/Texture_8h.html">Texture.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/dc8/ImageBase_8h.html">ImageBase.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d8a/Exception_8h.html">Exception.h</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;memory.h&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;GL/glew.h&quot;</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="comment">// macro for exception handling and logging</span>
<a name="l00056"></a><a class="code" href="../../d5/d87/Texture_8cpp.html#a75be82333a6ebdec765186bd567e9026">00056</a> <span class="preprocessor">#define CATCH_EXCP catch (Exception &amp; exp) \</span>
<a name="l00057"></a>00057 <span class="preprocessor">{ exp.report(); return NULL; }</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="comment">// Blender GameObject type</span>
<a name="l00061"></a>00061 <a class="code" href="../../d0/d37/classBlendType.html">BlendType&lt;KX_GameObject&gt;</a> <a class="code" href="../../d5/d87/Texture_8cpp.html#a94d1af7e49da7404a7adf3d9fbc3f3c5">gameObjectType</a> (<span class="stringliteral">&quot;KX_GameObject&quot;</span>);
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="comment">// load texture</span>
<a name="l00065"></a><a class="code" href="../../d9/dbf/Texture_8h.html#a5dffd54d186b81e5a024f40b18e605bb">00065</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/d87/Texture_8cpp.html#a5aa523889ad93bce9f67aa1d4200e061">loadTexture</a> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> texId, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> * <a class="code" href="../../dd/db6/structtexture.html">texture</a>, <span class="keywordtype">short</span> * <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>,
<a name="l00066"></a>00066                   <span class="keywordtype">bool</span> mipmap)
<a name="l00067"></a>00067 {
<a name="l00068"></a>00068     <span class="comment">// load texture for rendering</span>
<a name="l00069"></a>00069     glBindTexture(GL_TEXTURE_2D, texId);
<a name="l00070"></a>00070     <span class="keywordflow">if</span> (mipmap)
<a name="l00071"></a>00071     {
<a name="l00072"></a>00072         glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);
<a name="l00073"></a>00073         glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
<a name="l00074"></a>00074         gluBuild2DMipmaps(GL_TEXTURE_2D, GL_RGBA, size[0], size[1], GL_RGBA, GL_UNSIGNED_BYTE, texture);
<a name="l00075"></a>00075     } 
<a name="l00076"></a>00076     <span class="keywordflow">else</span>
<a name="l00077"></a>00077     {
<a name="l00078"></a>00078         glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
<a name="l00079"></a>00079         glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
<a name="l00080"></a>00080         glTexImage2D( GL_TEXTURE_2D, 0, GL_RGBA, size[0], size[1], 0, GL_RGBA, GL_UNSIGNED_BYTE, texture);
<a name="l00081"></a>00081     }
<a name="l00082"></a>00082     glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
<a name="l00083"></a>00083 }
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="comment">// get pointer to material</span>
<a name="l00087"></a><a class="code" href="../../d9/dbf/Texture_8h.html#aa6e608fd88b7356f2636b6136e10feca">00087</a> <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html">RAS_IPolyMaterial</a> * <a class="code" href="../../d5/d87/Texture_8cpp.html#aa6e608fd88b7356f2636b6136e10feca">getMaterial</a> (PyObject *obj, <span class="keywordtype">short</span> matID)
<a name="l00088"></a>00088 {
<a name="l00089"></a>00089     <span class="comment">// if object is available</span>
<a name="l00090"></a>00090     <span class="keywordflow">if</span> (obj != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00091"></a>00091     {
<a name="l00092"></a>00092         <span class="comment">// get pointer to texture image</span>
<a name="l00093"></a>00093         <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a> * gameObj = <a class="code" href="../../d5/d87/Texture_8cpp.html#a94d1af7e49da7404a7adf3d9fbc3f3c5">gameObjectType</a>.checkType(obj);
<a name="l00094"></a>00094         <span class="keywordflow">if</span> (gameObj != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; gameObj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0380469d233ad08592b6a49819db066d">GetMeshCount</a>() &gt; 0)
<a name="l00095"></a>00095         {
<a name="l00096"></a>00096             <span class="comment">// get material from mesh</span>
<a name="l00097"></a>00097             <a class="code" href="../../d5/d85/classRAS__MeshObject.html">RAS_MeshObject</a> * mesh = gameObj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0a71e1e10264a686d4bce3ec2733fe86">GetMesh</a>(0);
<a name="l00098"></a>00098             <a class="code" href="../../d6/d02/classRAS__MeshMaterial.html">RAS_MeshMaterial</a> *meshMat = mesh-&gt;<a class="code" href="../../d5/d85/classRAS__MeshObject.html#ae2c210599485a3ff5af6dd96b19d99b9">GetMeshMaterial</a>(matID);
<a name="l00099"></a>00099             <span class="keywordflow">if</span> (meshMat != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; meshMat-&gt;<a class="code" href="../../d6/d02/classRAS__MeshMaterial.html#af25f607c2c69fe9b678b698098f8a191">m_bucket</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00100"></a>00100                 <span class="comment">// return pointer to polygon or blender material</span>
<a name="l00101"></a>00101                 <span class="keywordflow">return</span> meshMat-&gt;<a class="code" href="../../d6/d02/classRAS__MeshMaterial.html#af25f607c2c69fe9b678b698098f8a191">m_bucket</a>-&gt;<a class="code" href="../../de/dc6/classRAS__MaterialBucket.html#acc588ec1f42649b68ce44a4b1dd02711">GetPolyMaterial</a>();
<a name="l00102"></a>00102         }
<a name="l00103"></a>00103     }
<a name="l00104"></a>00104     <span class="comment">// otherwise material was not found</span>
<a name="l00105"></a>00105     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 <span class="comment">// get material ID</span>
<a name="l00110"></a><a class="code" href="../../d9/dbf/Texture_8h.html#a7ace6bc525f0673ae096dce5d192bf72">00110</a> <span class="keywordtype">short</span> <a class="code" href="../../d3/dbe/blendVideoTex_8cpp.html#ab1d35a06959256f1fa868a4c53af72ed">getMaterialID</a>(PyObject * obj, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l00111"></a>00111 {
<a name="l00112"></a>00112     <span class="comment">// search for material</span>
<a name="l00113"></a>00113     <span class="keywordflow">for</span> (<span class="keywordtype">short</span> matID = 0;; ++matID)
<a name="l00114"></a>00114     {
<a name="l00115"></a>00115         <span class="comment">// get material</span>
<a name="l00116"></a>00116         <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html">RAS_IPolyMaterial</a> * mat = <a class="code" href="../../d5/d87/Texture_8cpp.html#aa6e608fd88b7356f2636b6136e10feca">getMaterial</a>(obj, matID);
<a name="l00117"></a>00117         <span class="comment">// if material is not available, report that no material was found</span>
<a name="l00118"></a>00118         <span class="keywordflow">if</span> (mat == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) 
<a name="l00119"></a>00119             <span class="keywordflow">break</span>;
<a name="l00120"></a>00120         <span class="comment">// name is a material name if it starts with MA and a UV texture name if it starts with IM</span>
<a name="l00121"></a>00121         <span class="keywordflow">if</span> (name[0] == <span class="charliteral">&#39;I&#39;</span> &amp;&amp; name[1] == <span class="charliteral">&#39;M&#39;</span>)
<a name="l00122"></a>00122         {
<a name="l00123"></a>00123             <span class="comment">// if texture name matches</span>
<a name="l00124"></a>00124             <span class="keywordflow">if</span> (strcmp(mat-&gt;<a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#a048b0c2603bd433b083c50feb70b09bf">GetTextureName</a>().<a class="code" href="../../d6/dce/classSTR__String.html#a946cab5eea587bf86a388f826fd7e26c">ReadPtr</a>(), name) == 0)
<a name="l00125"></a>00125                 <span class="keywordflow">return</span> matID;
<a name="l00126"></a>00126         } <span class="keywordflow">else</span> 
<a name="l00127"></a>00127         {
<a name="l00128"></a>00128             <span class="comment">// if material name matches</span>
<a name="l00129"></a>00129             <span class="keywordflow">if</span> (strcmp(mat-&gt;<a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#ae169afec2f9ab150d9735d3edf4e8111">GetMaterialName</a>().<a class="code" href="../../d6/dce/classSTR__String.html#a946cab5eea587bf86a388f826fd7e26c">ReadPtr</a>(), name) == 0)
<a name="l00130"></a>00130                 <span class="keywordflow">return</span> matID;
<a name="l00131"></a>00131         }
<a name="l00132"></a>00132     }
<a name="l00133"></a>00133     <span class="comment">// material was not found</span>
<a name="l00134"></a>00134     <span class="keywordflow">return</span> -1;
<a name="l00135"></a>00135 }
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <span class="comment">// Texture object allocation</span>
<a name="l00139"></a><a class="code" href="../../d5/d87/Texture_8cpp.html#a776fc92e80feaf4238e960b37702bed9">00139</a> PyObject * <a class="code" href="../../d5/d87/Texture_8cpp.html#a776fc92e80feaf4238e960b37702bed9">Texture_new</a> (PyTypeObject *type, PyObject *args, PyObject *kwds)
<a name="l00140"></a>00140 {
<a name="l00141"></a>00141     <span class="comment">// allocate object</span>
<a name="l00142"></a>00142     <a class="code" href="../../df/dda/structTexture.html">Texture</a> * <span class="keyword">self</span> = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="../../df/dda/structTexture.html">Texture</a>*<span class="keyword">&gt;</span>(type-&gt;tp_alloc(type, 0));
<a name="l00143"></a>00143     <span class="comment">// initialize object structure</span>
<a name="l00144"></a>00144     <span class="keyword">self</span>-&gt;<a class="code" href="../../df/dda/structTexture.html#aaca4696be521d75d32ffb8adb52abf41">m_actTex</a> = 0;
<a name="l00145"></a>00145     <span class="keyword">self</span>-&gt;m_orgSaved = <span class="keyword">false</span>;
<a name="l00146"></a>00146     <span class="keyword">self</span>-&gt;m_imgTexture = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00147"></a>00147     <span class="keyword">self</span>-&gt;m_matTexture = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00148"></a>00148     <span class="keyword">self</span>-&gt;m_mipmap = <span class="keyword">false</span>;
<a name="l00149"></a>00149     <span class="keyword">self</span>-&gt;m_scaledImg = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00150"></a>00150     <span class="keyword">self</span>-&gt;m_scaledImgSize = 0;
<a name="l00151"></a>00151     <span class="keyword">self</span>-&gt;m_source = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00152"></a>00152     <span class="keyword">self</span>-&gt;m_lastClock = 0.0;
<a name="l00153"></a>00153     <span class="comment">// return allocated object</span>
<a name="l00154"></a>00154     <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span>PyObject*<span class="keyword">&gt;</span>(<span class="keyword">self</span>);
<a name="l00155"></a>00155 }
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 <span class="comment">// forward declaration</span>
<a name="l00159"></a>00159 PyObject * <a class="code" href="../../d5/d87/Texture_8cpp.html#a51458c74875f0df49a8ea4125e34abc0">Texture_close</a>(<a class="code" href="../../df/dda/structTexture.html">Texture</a> * <span class="keyword">self</span>);
<a name="l00160"></a>00160 <span class="keywordtype">int</span> <a class="code" href="../../d5/d87/Texture_8cpp.html#a7a03d3e08d595ae32411cdda9391f82f">Texture_setSource</a> (<a class="code" href="../../df/dda/structTexture.html">Texture</a> * <span class="keyword">self</span>, PyObject * value, <span class="keywordtype">void</span> * closure);
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="comment">// Texture object deallocation</span>
<a name="l00164"></a><a class="code" href="../../d5/d87/Texture_8cpp.html#a0cddca22bff2c6fa3e34b9e6a407d48e">00164</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/d87/Texture_8cpp.html#a0cddca22bff2c6fa3e34b9e6a407d48e">Texture_dealloc</a> (<a class="code" href="../../df/dda/structTexture.html">Texture</a> * <span class="keyword">self</span>)
<a name="l00165"></a>00165 {
<a name="l00166"></a>00166     <span class="comment">// release renderer</span>
<a name="l00167"></a>00167     Py_XDECREF(self-&gt;m_source);
<a name="l00168"></a>00168     <span class="comment">// close texture</span>
<a name="l00169"></a>00169     PyObject* ret = <a class="code" href="../../d5/d87/Texture_8cpp.html#a51458c74875f0df49a8ea4125e34abc0">Texture_close</a>(<span class="keyword">self</span>);
<a name="l00170"></a>00170     Py_DECREF(ret);
<a name="l00171"></a>00171     <span class="comment">// release scaled image buffer</span>
<a name="l00172"></a>00172     <span class="keyword">delete</span> [] <span class="keyword">self</span>-&gt;m_scaledImg;
<a name="l00173"></a>00173     <span class="comment">// release object</span>
<a name="l00174"></a>00174     Py_TYPE((PyObject *)<span class="keyword">self</span>)-&gt;tp_free((PyObject*)<span class="keyword">self</span>);
<a name="l00175"></a>00175 }
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 
<a name="l00178"></a><a class="code" href="../../d9/dbf/Texture_8h.html#a7d71596ca546fad3c30964ff983df0a8">00178</a> <a class="code" href="../../d5/d67/classExceptionID.html">ExceptionID</a> <a class="code" href="../../d5/d87/Texture_8cpp.html#a7d71596ca546fad3c30964ff983df0a8">MaterialNotAvail</a>;
<a name="l00179"></a>00179 <a class="code" href="../../d6/d6b/classExpDesc.html">ExpDesc</a> <a class="code" href="../../d8/d8a/Exception_8h.html#a2c47ee3bf21490801d710c93209c662d">MaterialNotAvailDesc</a> (MaterialNotAvail, <span class="stringliteral">&quot;Texture material is not available&quot;</span>);
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 <span class="comment">// Texture object initialization</span>
<a name="l00182"></a><a class="code" href="../../d5/d87/Texture_8cpp.html#abfb4546a18087cbbb00df690744a8bf3">00182</a> <span class="keywordtype">int</span> <a class="code" href="../../d5/d87/Texture_8cpp.html#abfb4546a18087cbbb00df690744a8bf3">Texture_init</a> (<a class="code" href="../../df/dda/structTexture.html">Texture</a> *<span class="keyword">self</span>, PyObject *args, PyObject *kwds)
<a name="l00183"></a>00183 {
<a name="l00184"></a>00184     <span class="comment">// parameters - game object with video texture</span>
<a name="l00185"></a>00185     PyObject * obj = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00186"></a>00186     <span class="comment">// material ID</span>
<a name="l00187"></a>00187     <span class="keywordtype">short</span> matID = 0;
<a name="l00188"></a>00188     <span class="comment">// texture ID</span>
<a name="l00189"></a>00189     <span class="keywordtype">short</span> texID = 0;
<a name="l00190"></a>00190     <span class="comment">// texture object with shared texture ID</span>
<a name="l00191"></a>00191     <a class="code" href="../../df/dda/structTexture.html">Texture</a> * texObj = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *kwlist[] = {<span class="stringliteral">&quot;gameObj&quot;</span>, <span class="stringliteral">&quot;materialID&quot;</span>, <span class="stringliteral">&quot;textureID&quot;</span>, <span class="stringliteral">&quot;textureObj&quot;</span>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <span class="comment">// get parameters</span>
<a name="l00196"></a>00196     <span class="keywordflow">if</span> (!PyArg_ParseTupleAndKeywords(args, kwds, <span class="stringliteral">&quot;O|hhO!&quot;</span>,
<a name="l00197"></a>00197         const_cast&lt;char**&gt;(kwlist), &amp;obj, &amp;matID, &amp;texID, &amp;<a class="code" href="../../d5/d87/Texture_8cpp.html#a261f03768041bbb80dd6302589412f87">TextureType</a>,
<a name="l00198"></a>00198         &amp;texObj))
<a name="l00199"></a>00199         <span class="keywordflow">return</span> -1; 
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     <span class="comment">// if parameters are available</span>
<a name="l00202"></a>00202     <span class="keywordflow">if</span> (obj != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00203"></a>00203     {
<a name="l00204"></a>00204         <span class="comment">// process polygon material or blender material</span>
<a name="l00205"></a>00205         <span class="keywordflow">try</span>
<a name="l00206"></a>00206         {
<a name="l00207"></a>00207             <span class="comment">// get pointer to texture image</span>
<a name="l00208"></a>00208             <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html">RAS_IPolyMaterial</a> * mat = <a class="code" href="../../d5/d87/Texture_8cpp.html#aa6e608fd88b7356f2636b6136e10feca">getMaterial</a>(obj, matID);
<a name="l00209"></a>00209             <span class="keywordflow">if</span> (mat != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00210"></a>00210             {
<a name="l00211"></a>00211                 <span class="comment">// is it blender material or polygon material</span>
<a name="l00212"></a>00212                 <span class="keywordflow">if</span> (mat-&gt;<a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#a7bd4304a59852b7735385966fc4d6092">GetFlag</a>() &amp; <a class="code" href="../../dc/da4/RAS__IPolygonMaterial_8h.html#ad7eead3344431dbbe01a27f3df2eb14fadab579ec79c6a9b673048d6303b85a88">RAS_BLENDERGLSL</a>) 
<a name="l00213"></a>00213                 {
<a name="l00214"></a>00214                     <span class="keyword">self</span>-&gt;m_imgTexture = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>*<span class="keyword">&gt;</span>(mat)-&gt;getImage(texID);
<a name="l00215"></a>00215                     <span class="keyword">self</span>-&gt;m_useMatTexture = <span class="keyword">false</span>;
<a name="l00216"></a>00216                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mat-&gt;<a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#a7bd4304a59852b7735385966fc4d6092">GetFlag</a>() &amp; <a class="code" href="../../dc/da4/RAS__IPolygonMaterial_8h.html#ad7eead3344431dbbe01a27f3df2eb14fa7f731696da676a0b2f7bb0dec1210248">RAS_BLENDERMAT</a>)
<a name="l00217"></a>00217                 {
<a name="l00218"></a>00218                     <span class="comment">// get blender material texture</span>
<a name="l00219"></a>00219                     <span class="keyword">self</span>-&gt;m_matTexture = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>*<span class="keyword">&gt;</span>(mat)-&gt;getTex(texID);
<a name="l00220"></a>00220                     <span class="keyword">self</span>-&gt;m_useMatTexture = <span class="keyword">true</span>;
<a name="l00221"></a>00221                 }
<a name="l00222"></a>00222                 <span class="keywordflow">else</span>
<a name="l00223"></a>00223                 {
<a name="l00224"></a>00224                     <span class="comment">// get texture pointer from polygon material</span>
<a name="l00225"></a>00225                     <a class="code" href="../../da/d7f/structMTFace.html">MTFace</a> * tface = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d9/d1f/classKX__PolygonMaterial.html">KX_PolygonMaterial</a>*<span class="keyword">&gt;</span>(mat)-&gt;GetMTFace();
<a name="l00226"></a>00226                     <span class="keyword">self</span>-&gt;m_imgTexture = (<a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a>*)tface-&gt;<a class="code" href="../../da/d7f/structMTFace.html#a94b886f25499ad61afed79c6362451ef">tpage</a>;
<a name="l00227"></a>00227                     self-&gt;m_useMatTexture = <span class="keyword">false</span>;
<a name="l00228"></a>00228                 }
<a name="l00229"></a>00229             }
<a name="l00230"></a>00230             <span class="comment">// check if texture is available, if not, initialization failed</span>
<a name="l00231"></a>00231             <span class="keywordflow">if</span> (self-&gt;m_imgTexture == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; self-&gt;m_matTexture == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00232"></a>00232                 <span class="comment">// throw exception if initialization failed</span>
<a name="l00233"></a>00233                 <a class="code" href="../../d8/d8a/Exception_8h.html#ac3b2bffb453f4e8e369013659070c6f8">THRWEXCP</a>(MaterialNotAvail, <a class="code" href="../../d6/d5c/gameengine_2VideoTexture_2Common_8h.html#a14bc2dfa42241600d567369cd25ddc70">S_OK</a>);
<a name="l00234"></a>00234 
<a name="l00235"></a>00235             <span class="comment">// if texture object is provided</span>
<a name="l00236"></a>00236             <span class="keywordflow">if</span> (texObj != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00237"></a>00237             {
<a name="l00238"></a>00238                 <span class="comment">// copy texture code</span>
<a name="l00239"></a>00239                 <span class="keyword">self</span>-&gt;m_actTex = texObj-&gt;<a class="code" href="../../df/dda/structTexture.html#aaca4696be521d75d32ffb8adb52abf41">m_actTex</a>;
<a name="l00240"></a>00240                 <span class="keyword">self</span>-&gt;m_mipmap = texObj-&gt;<a class="code" href="../../df/dda/structTexture.html#a7a9546f20dbb7acbf4150f9b322a8a2d">m_mipmap</a>;
<a name="l00241"></a>00241                 <span class="keywordflow">if</span> (texObj-&gt;<a class="code" href="../../df/dda/structTexture.html#ac3793feb94678bb630c532121814f15c">m_source</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00242"></a>00242                     <a class="code" href="../../d5/d87/Texture_8cpp.html#a7a03d3e08d595ae32411cdda9391f82f">Texture_setSource</a>(<span class="keyword">self</span>, reinterpret_cast&lt;PyObject*&gt;(texObj-&gt;<a class="code" href="../../df/dda/structTexture.html#ac3793feb94678bb630c532121814f15c">m_source</a>), <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00243"></a>00243             }
<a name="l00244"></a>00244             <span class="keywordflow">else</span>
<a name="l00245"></a>00245                 <span class="comment">// otherwise generate texture code</span>
<a name="l00246"></a>00246                 glGenTextures(1, (GLuint*)&amp;self-&gt;m_actTex);
<a name="l00247"></a>00247         }
<a name="l00248"></a>00248         <span class="keywordflow">catch</span> (<a class="code" href="../../d4/d67/classException.html">Exception</a> &amp; <a class="code" href="../../d0/dbc/namespaceKDL.html#a82c1904677c13464d30566d25edc9034">exp</a>)
<a name="l00249"></a>00249         {
<a name="l00250"></a>00250             exp.<a class="code" href="../../d4/d67/classException.html#a23fbb421ab3e1a05de04890fd2d86c7c">report</a>();
<a name="l00251"></a>00251             <span class="keywordflow">return</span> -1;
<a name="l00252"></a>00252         }
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254     <span class="comment">// initialization succeded</span>
<a name="l00255"></a>00255     <span class="keywordflow">return</span> 0;
<a name="l00256"></a>00256 }
<a name="l00257"></a>00257 
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 <span class="comment">// close added texture</span>
<a name="l00260"></a><a class="code" href="../../d5/d87/Texture_8cpp.html#a51458c74875f0df49a8ea4125e34abc0">00260</a> PyObject * <a class="code" href="../../d5/d87/Texture_8cpp.html#a51458c74875f0df49a8ea4125e34abc0">Texture_close</a>(<a class="code" href="../../df/dda/structTexture.html">Texture</a> * <span class="keyword">self</span>)
<a name="l00261"></a>00261 {
<a name="l00262"></a>00262     <span class="comment">// restore texture</span>
<a name="l00263"></a>00263     <span class="keywordflow">if</span> (self-&gt;m_orgSaved)
<a name="l00264"></a>00264     {
<a name="l00265"></a>00265         <span class="keyword">self</span>-&gt;m_orgSaved = <span class="keyword">false</span>;
<a name="l00266"></a>00266         <span class="comment">// restore original texture code</span>
<a name="l00267"></a>00267         <span class="keywordflow">if</span> (self-&gt;m_useMatTexture)
<a name="l00268"></a>00268             <span class="keyword">self</span>-&gt;m_matTexture-&gt;swapTexture(self-&gt;m_orgTex);
<a name="l00269"></a>00269         <span class="keywordflow">else</span>
<a name="l00270"></a>00270             <span class="keyword">self</span>-&gt;m_imgTexture-&gt;bindcode = <span class="keyword">self</span>-&gt;m_orgTex;
<a name="l00271"></a>00271         <span class="comment">// drop actual texture</span>
<a name="l00272"></a>00272         <span class="keywordflow">if</span> (self-&gt;m_actTex != 0)
<a name="l00273"></a>00273         {
<a name="l00274"></a>00274             glDeleteTextures(1, (GLuint *)&amp;self-&gt;m_actTex);
<a name="l00275"></a>00275             <span class="keyword">self</span>-&gt;m_actTex = 0;
<a name="l00276"></a>00276         }
<a name="l00277"></a>00277     }
<a name="l00278"></a>00278     Py_RETURN_NONE;
<a name="l00279"></a>00279 }
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 <span class="comment">// refresh texture</span>
<a name="l00283"></a><a class="code" href="../../d5/d87/Texture_8cpp.html#ad060c32f95aa402047dd9c63e547cb24">00283</a> PyObject * <a class="code" href="../../d5/d87/Texture_8cpp.html#ad060c32f95aa402047dd9c63e547cb24">Texture_refresh</a> (<a class="code" href="../../df/dda/structTexture.html">Texture</a> * <span class="keyword">self</span>, PyObject * args)
<a name="l00284"></a>00284 {
<a name="l00285"></a>00285     <span class="comment">// get parameter - refresh source</span>
<a name="l00286"></a>00286     PyObject * param;
<a name="l00287"></a>00287     <span class="keywordtype">double</span> ts = -1.0;
<a name="l00288"></a>00288 
<a name="l00289"></a>00289     <span class="keywordflow">if</span> (!PyArg_ParseTuple(args, <span class="stringliteral">&quot;O|d:refresh&quot;</span>, &amp;param, &amp;ts) || !PyBool_Check(param))
<a name="l00290"></a>00290     {
<a name="l00291"></a>00291         <span class="comment">// report error</span>
<a name="l00292"></a>00292         PyErr_SetString(PyExc_TypeError, <span class="stringliteral">&quot;The value must be a bool&quot;</span>);
<a name="l00293"></a>00293         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00294"></a>00294     }
<a name="l00295"></a>00295     <span class="comment">// some trick here: we are in the business of loading a texture,</span>
<a name="l00296"></a>00296     <span class="comment">// no use to do it if we are still in the same rendering frame.</span>
<a name="l00297"></a>00297     <span class="comment">// We find this out by looking at the engine current clock time</span>
<a name="l00298"></a>00298     <a class="code" href="../../db/dcd/classKX__KetsjiEngine.html">KX_KetsjiEngine</a>* engine = <a class="code" href="../../d6/dc2/KX__PythonInit_8cpp.html#a73270876d4beab375ee4cbc78e597251">KX_GetActiveEngine</a>();
<a name="l00299"></a>00299     <span class="keywordflow">if</span> (engine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a74e367e3f14c5eab971b301278482ac8">GetClockTime</a>() != <span class="keyword">self</span>-&gt;m_lastClock) 
<a name="l00300"></a>00300     {
<a name="l00301"></a>00301         <span class="keyword">self</span>-&gt;m_lastClock = engine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a74e367e3f14c5eab971b301278482ac8">GetClockTime</a>();
<a name="l00302"></a>00302         <span class="comment">// set source refresh</span>
<a name="l00303"></a>00303         <span class="keywordtype">bool</span> refreshSource = (param == Py_True);
<a name="l00304"></a>00304         <span class="comment">// try to proces texture from source</span>
<a name="l00305"></a>00305         <span class="keywordflow">try</span>
<a name="l00306"></a>00306         {
<a name="l00307"></a>00307             <span class="comment">// if source is available</span>
<a name="l00308"></a>00308             <span class="keywordflow">if</span> (self-&gt;m_source != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00309"></a>00309             {
<a name="l00310"></a>00310                 <span class="comment">// check texture code</span>
<a name="l00311"></a>00311                 <span class="keywordflow">if</span> (!self-&gt;m_orgSaved)
<a name="l00312"></a>00312                 {
<a name="l00313"></a>00313                     <span class="keyword">self</span>-&gt;m_orgSaved = <span class="keyword">true</span>;
<a name="l00314"></a>00314                     <span class="comment">// save original image code</span>
<a name="l00315"></a>00315                     <span class="keywordflow">if</span> (self-&gt;m_useMatTexture)
<a name="l00316"></a>00316                         <span class="keyword">self</span>-&gt;m_orgTex = <span class="keyword">self</span>-&gt;m_matTexture-&gt;swapTexture(self-&gt;m_actTex);
<a name="l00317"></a>00317                     <span class="keywordflow">else</span>
<a name="l00318"></a>00318                     {
<a name="l00319"></a>00319                         <span class="keyword">self</span>-&gt;m_orgTex = <span class="keyword">self</span>-&gt;m_imgTexture-&gt;bindcode;
<a name="l00320"></a>00320                         <span class="keyword">self</span>-&gt;m_imgTexture-&gt;bindcode = <span class="keyword">self</span>-&gt;m_actTex;
<a name="l00321"></a>00321                     }
<a name="l00322"></a>00322                 }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324                 <span class="comment">// get texture</span>
<a name="l00325"></a>00325                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> * <a class="code" href="../../dd/db6/structtexture.html">texture</a> = <span class="keyword">self</span>-&gt;m_source-&gt;m_image-&gt;getImage(self-&gt;m_actTex, ts);
<a name="l00326"></a>00326                 <span class="comment">// if texture is available</span>
<a name="l00327"></a>00327                 <span class="keywordflow">if</span> (texture != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00328"></a>00328                 {
<a name="l00329"></a>00329                     <span class="comment">// get texture size</span>
<a name="l00330"></a>00330                     <span class="keywordtype">short</span> * orgSize = <span class="keyword">self</span>-&gt;m_source-&gt;m_image-&gt;getSize();
<a name="l00331"></a>00331                     <span class="comment">// calc scaled sizes</span>
<a name="l00332"></a>00332                     <span class="keywordtype">short</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>[2];
<a name="l00333"></a>00333                     <span class="keywordflow">if</span> (GLEW_ARB_texture_non_power_of_two)
<a name="l00334"></a>00334                     {
<a name="l00335"></a>00335                         size[0] = orgSize[0];
<a name="l00336"></a>00336                         size[1] = orgSize[1];
<a name="l00337"></a>00337                     }
<a name="l00338"></a>00338                     <span class="keywordflow">else</span>
<a name="l00339"></a>00339                     {
<a name="l00340"></a>00340                         size[0] = <a class="code" href="../../d7/d1e/classImageBase.html#a52a7d3f17e49f7ce5947a564484dc39c" title="calculate size (nearest power of 2)">ImageBase::calcSize</a>(orgSize[0]);
<a name="l00341"></a>00341                         size[1] = <a class="code" href="../../d7/d1e/classImageBase.html#a52a7d3f17e49f7ce5947a564484dc39c" title="calculate size (nearest power of 2)">ImageBase::calcSize</a>(orgSize[1]);
<a name="l00342"></a>00342                     }
<a name="l00343"></a>00343                     <span class="comment">// scale texture if needed</span>
<a name="l00344"></a>00344                     <span class="keywordflow">if</span> (size[0] != orgSize[0] || size[1] != orgSize[1])
<a name="l00345"></a>00345                     {
<a name="l00346"></a>00346                         <span class="comment">// if scaled image buffer is smaller than needed</span>
<a name="l00347"></a>00347                         <span class="keywordflow">if</span> (self-&gt;m_scaledImgSize &lt; (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(size[0] * size[1]))
<a name="l00348"></a>00348                         {
<a name="l00349"></a>00349                             <span class="comment">// new size</span>
<a name="l00350"></a>00350                             <span class="keyword">self</span>-&gt;m_scaledImgSize = size[0] * size[1];
<a name="l00351"></a>00351                             <span class="comment">// allocate scaling image</span>
<a name="l00352"></a>00352                             <span class="keyword">delete</span> [] <span class="keyword">self</span>-&gt;m_scaledImg;
<a name="l00353"></a>00353                             <span class="keyword">self</span>-&gt;m_scaledImg = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>[<span class="keyword">self</span>-&gt;m_scaledImgSize];
<a name="l00354"></a>00354                         }
<a name="l00355"></a>00355                         <span class="comment">// scale texture</span>
<a name="l00356"></a>00356                         gluScaleImage(GL_RGBA, orgSize[0], orgSize[1], GL_UNSIGNED_BYTE, texture,
<a name="l00357"></a>00357                             size[0], size[1], GL_UNSIGNED_BYTE, self-&gt;m_scaledImg);
<a name="l00358"></a>00358                         <span class="comment">// use scaled image instead original</span>
<a name="l00359"></a>00359                         texture = <span class="keyword">self</span>-&gt;m_scaledImg;
<a name="l00360"></a>00360                     }
<a name="l00361"></a>00361                     <span class="comment">// load texture for rendering</span>
<a name="l00362"></a>00362                     <a class="code" href="../../d5/d87/Texture_8cpp.html#a5aa523889ad93bce9f67aa1d4200e061">loadTexture</a> (self-&gt;m_actTex, texture, size, self-&gt;m_mipmap);
<a name="l00363"></a>00363 
<a name="l00364"></a>00364                     <span class="comment">// refresh texture source, if required</span>
<a name="l00365"></a>00365                     <span class="keywordflow">if</span> (refreshSource) <span class="keyword">self</span>-&gt;m_source-&gt;m_image-&gt;refresh();
<a name="l00366"></a>00366                 }
<a name="l00367"></a>00367             }
<a name="l00368"></a>00368         }
<a name="l00369"></a>00369         <a class="code" href="../../d5/d87/Texture_8cpp.html#a75be82333a6ebdec765186bd567e9026">CATCH_EXCP</a>;
<a name="l00370"></a>00370     }
<a name="l00371"></a>00371     Py_RETURN_NONE;
<a name="l00372"></a>00372 }
<a name="l00373"></a>00373 
<a name="l00374"></a>00374 <span class="comment">// get OpenGL Bind Id</span>
<a name="l00375"></a><a class="code" href="../../d5/d87/Texture_8cpp.html#ae1b7f3c4de38a9ce5e75d7d29e107083">00375</a> PyObject * <a class="code" href="../../d5/d87/Texture_8cpp.html#ae1b7f3c4de38a9ce5e75d7d29e107083">Texture_getBindId</a> (<a class="code" href="../../df/dda/structTexture.html">Texture</a> * <span class="keyword">self</span>, <span class="keywordtype">void</span> * closure)
<a name="l00376"></a>00376 {
<a name="l00377"></a>00377     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keywordtype">id</span> = <span class="keyword">self</span>-&gt;m_actTex;
<a name="l00378"></a>00378     <span class="keywordflow">return</span> Py_BuildValue(<span class="stringliteral">&quot;h&quot;</span>, <span class="keywordtype">id</span>);
<a name="l00379"></a>00379 }
<a name="l00380"></a>00380 
<a name="l00381"></a>00381 <span class="comment">// get mipmap value</span>
<a name="l00382"></a><a class="code" href="../../d5/d87/Texture_8cpp.html#a231afd77a91dbf7dd5b4a4b5a5058401">00382</a> PyObject * <a class="code" href="../../d5/d87/Texture_8cpp.html#a231afd77a91dbf7dd5b4a4b5a5058401">Texture_getMipmap</a> (<a class="code" href="../../df/dda/structTexture.html">Texture</a> * <span class="keyword">self</span>, <span class="keywordtype">void</span> * closure)
<a name="l00383"></a>00383 {
<a name="l00384"></a>00384     <span class="comment">// return true if flag is set, otherwise false</span>
<a name="l00385"></a>00385     <span class="keywordflow">if</span> (self-&gt;m_mipmap) Py_RETURN_TRUE;
<a name="l00386"></a>00386     <span class="keywordflow">else</span> Py_RETURN_FALSE;
<a name="l00387"></a>00387 }
<a name="l00388"></a>00388 
<a name="l00389"></a>00389 <span class="comment">// set mipmap value</span>
<a name="l00390"></a><a class="code" href="../../d5/d87/Texture_8cpp.html#a2bcab9c3252c1f4ab9d2a4dfc3bf3053">00390</a> <span class="keywordtype">int</span> <a class="code" href="../../d5/d87/Texture_8cpp.html#a2bcab9c3252c1f4ab9d2a4dfc3bf3053">Texture_setMipmap</a> (<a class="code" href="../../df/dda/structTexture.html">Texture</a> * <span class="keyword">self</span>, PyObject * value, <span class="keywordtype">void</span> * closure)
<a name="l00391"></a>00391 {
<a name="l00392"></a>00392     <span class="comment">// check parameter, report failure</span>
<a name="l00393"></a>00393     <span class="keywordflow">if</span> (value == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || !PyBool_Check(value))
<a name="l00394"></a>00394     {
<a name="l00395"></a>00395         PyErr_SetString(PyExc_TypeError, <span class="stringliteral">&quot;The value must be a bool&quot;</span>);
<a name="l00396"></a>00396         <span class="keywordflow">return</span> -1;
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398     <span class="comment">// set mipmap</span>
<a name="l00399"></a>00399     <span class="keyword">self</span>-&gt;m_mipmap = value == Py_True;
<a name="l00400"></a>00400     <span class="comment">// success</span>
<a name="l00401"></a>00401     <span class="keywordflow">return</span> 0;
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 
<a name="l00405"></a>00405 <span class="comment">// get source object</span>
<a name="l00406"></a><a class="code" href="../../d5/d87/Texture_8cpp.html#adda56879026eec22bf28b0c5c73bc0e3">00406</a> PyObject * <a class="code" href="../../d5/d87/Texture_8cpp.html#adda56879026eec22bf28b0c5c73bc0e3">Texture_getSource</a> (<a class="code" href="../../df/dda/structTexture.html">Texture</a> * <span class="keyword">self</span>, PyObject * value, <span class="keywordtype">void</span> * closure)
<a name="l00407"></a>00407 {
<a name="l00408"></a>00408     <span class="comment">// if source exists</span>
<a name="l00409"></a>00409     <span class="keywordflow">if</span> (self-&gt;m_source != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00410"></a>00410     {
<a name="l00411"></a>00411         Py_INCREF(self-&gt;m_source);
<a name="l00412"></a>00412         <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span>PyObject*<span class="keyword">&gt;</span>(<span class="keyword">self</span>-&gt;m_source);
<a name="l00413"></a>00413     }
<a name="l00414"></a>00414     <span class="comment">// otherwise return None</span>
<a name="l00415"></a>00415     Py_RETURN_NONE;
<a name="l00416"></a>00416 }
<a name="l00417"></a>00417 
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 <span class="comment">// set source object</span>
<a name="l00420"></a><a class="code" href="../../d5/d87/Texture_8cpp.html#a7a03d3e08d595ae32411cdda9391f82f">00420</a> <span class="keywordtype">int</span> <a class="code" href="../../d5/d87/Texture_8cpp.html#a7a03d3e08d595ae32411cdda9391f82f">Texture_setSource</a> (<a class="code" href="../../df/dda/structTexture.html">Texture</a> * <span class="keyword">self</span>, PyObject * value, <span class="keywordtype">void</span> * closure)
<a name="l00421"></a>00421 {
<a name="l00422"></a>00422     <span class="comment">// check new value</span>
<a name="l00423"></a>00423     <span class="keywordflow">if</span> (value == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || !<a class="code" href="../../db/d8e/ImageBase_8cpp.html#a6a338beb90c29b3e6253e445fb7baf4b">pyImageTypes</a>.<a class="code" href="../../df/dc7/classPyTypeList.html#a759bddeb29c6f066a2d723cf14208155" title="check, if type is in list">in</a>(Py_TYPE(value)))
<a name="l00424"></a>00424     {
<a name="l00425"></a>00425         <span class="comment">// report value error</span>
<a name="l00426"></a>00426         PyErr_SetString(PyExc_TypeError, <span class="stringliteral">&quot;Invalid type of value&quot;</span>);
<a name="l00427"></a>00427         <span class="keywordflow">return</span> -1;
<a name="l00428"></a>00428     }
<a name="l00429"></a>00429     <span class="comment">// increase ref count for new value</span>
<a name="l00430"></a>00430     Py_INCREF(value);
<a name="l00431"></a>00431     <span class="comment">// release previous</span>
<a name="l00432"></a>00432     Py_XDECREF(self-&gt;m_source);
<a name="l00433"></a>00433     <span class="comment">// set new value</span>
<a name="l00434"></a>00434     <span class="keyword">self</span>-&gt;m_source = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="../../db/d22/structPyImage.html">PyImage</a>*<span class="keyword">&gt;</span>(value);
<a name="l00435"></a>00435     <span class="comment">// return success</span>
<a name="l00436"></a>00436     <span class="keywordflow">return</span> 0;
<a name="l00437"></a>00437 }
<a name="l00438"></a>00438 
<a name="l00439"></a>00439 
<a name="l00440"></a>00440 <span class="comment">// class Texture methods</span>
<a name="l00441"></a><a class="code" href="../../d5/d87/Texture_8cpp.html#a076019983daaae2f6790ad9de28d5ec8">00441</a> <span class="keyword">static</span> PyMethodDef <a class="code" href="../../d5/d87/Texture_8cpp.html#a076019983daaae2f6790ad9de28d5ec8">textureMethods</a>[] =
<a name="l00442"></a>00442 {
<a name="l00443"></a>00443     { <span class="stringliteral">&quot;close&quot;</span>, (PyCFunction)<a class="code" href="../../d5/d87/Texture_8cpp.html#a51458c74875f0df49a8ea4125e34abc0">Texture_close</a>, METH_NOARGS, <span class="stringliteral">&quot;Close dynamic texture and restore original&quot;</span>},
<a name="l00444"></a>00444     { <span class="stringliteral">&quot;refresh&quot;</span>, (PyCFunction)<a class="code" href="../../d5/d87/Texture_8cpp.html#ad060c32f95aa402047dd9c63e547cb24">Texture_refresh</a>, METH_VARARGS, <span class="stringliteral">&quot;Refresh texture from source&quot;</span>},
<a name="l00445"></a>00445     {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}  <span class="comment">/* Sentinel */</span>
<a name="l00446"></a>00446 };
<a name="l00447"></a>00447 
<a name="l00448"></a>00448 <span class="comment">// class Texture attributes</span>
<a name="l00449"></a><a class="code" href="../../d5/d87/Texture_8cpp.html#a2c85226885f42a78f11e3a93fb8071a9">00449</a> <span class="keyword">static</span> PyGetSetDef <a class="code" href="../../d5/d87/Texture_8cpp.html#a2c85226885f42a78f11e3a93fb8071a9">textureGetSets</a>[] =
<a name="l00450"></a>00450 { 
<a name="l00451"></a>00451     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;source&quot;</span>, (getter)<a class="code" href="../../d5/d87/Texture_8cpp.html#adda56879026eec22bf28b0c5c73bc0e3">Texture_getSource</a>, (setter)<a class="code" href="../../d5/d87/Texture_8cpp.html#a7a03d3e08d595ae32411cdda9391f82f">Texture_setSource</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;source of texture&quot;</span>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},
<a name="l00452"></a>00452     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;mipmap&quot;</span>, (getter)<a class="code" href="../../d5/d87/Texture_8cpp.html#a231afd77a91dbf7dd5b4a4b5a5058401">Texture_getMipmap</a>, (setter)<a class="code" href="../../d5/d87/Texture_8cpp.html#a2bcab9c3252c1f4ab9d2a4dfc3bf3053">Texture_setMipmap</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;mipmap texture&quot;</span>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},
<a name="l00453"></a>00453     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;bindId&quot;</span>, (getter)<a class="code" href="../../d5/d87/Texture_8cpp.html#ae1b7f3c4de38a9ce5e75d7d29e107083">Texture_getBindId</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;OpenGL Bind Name&quot;</span>, NULL},
<a name="l00454"></a>00454     {NULL}
<a name="l00455"></a>00455 };
<a name="l00456"></a>00456 
<a name="l00457"></a>00457 
<a name="l00458"></a>00458 <span class="comment">// class Texture declaration</span>
<a name="l00459"></a><a class="code" href="../../d9/dbf/Texture_8h.html#a261f03768041bbb80dd6302589412f87">00459</a> PyTypeObject <a class="code" href="../../d5/d87/Texture_8cpp.html#a261f03768041bbb80dd6302589412f87">TextureType</a> =
<a name="l00460"></a>00460 {
<a name="l00461"></a>00461     PyVarObject_HEAD_INIT(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0)
<a name="l00462"></a>00462     <span class="stringliteral">&quot;VideoTexture.Texture&quot;</span>,   <span class="comment">/*tp_name*/</span>
<a name="l00463"></a>00463     <span class="keyword">sizeof</span>(<a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a25c4c13aab28a922a4cc60faaf3a6d83">Texture</a>),           <span class="comment">/*tp_basicsize*/</span>
<a name="l00464"></a>00464     0,                         <span class="comment">/*tp_itemsize*/</span>
<a name="l00465"></a>00465     (destructor)<a class="code" href="../../d5/d87/Texture_8cpp.html#a0cddca22bff2c6fa3e34b9e6a407d48e">Texture_dealloc</a>,<span class="comment">/*tp_dealloc*/</span>
<a name="l00466"></a>00466     0,                         <span class="comment">/*tp_print*/</span>
<a name="l00467"></a>00467     0,                         <span class="comment">/*tp_getattr*/</span>
<a name="l00468"></a>00468     0,                         <span class="comment">/*tp_setattr*/</span>
<a name="l00469"></a>00469     0,                         <span class="comment">/*tp_compare*/</span>
<a name="l00470"></a>00470     0,                         <span class="comment">/*tp_repr*/</span>
<a name="l00471"></a>00471     0,                         <span class="comment">/*tp_as_number*/</span>
<a name="l00472"></a>00472     0,                         <span class="comment">/*tp_as_sequence*/</span>
<a name="l00473"></a>00473     0,                         <span class="comment">/*tp_as_mapping*/</span>
<a name="l00474"></a>00474     0,                         <span class="comment">/*tp_hash */</span>
<a name="l00475"></a>00475     0,                         <span class="comment">/*tp_call*/</span>
<a name="l00476"></a>00476     0,                         <span class="comment">/*tp_str*/</span>
<a name="l00477"></a>00477     0,                         <span class="comment">/*tp_getattro*/</span>
<a name="l00478"></a>00478     0,                         <span class="comment">/*tp_setattro*/</span>
<a name="l00479"></a>00479     &amp;<a class="code" href="../../db/d8e/ImageBase_8cpp.html#ab77040fc062c59fed8cfc59f057e3271">imageBufferProcs</a>,         <span class="comment">/*tp_as_buffer*/</span>
<a name="l00480"></a>00480     Py_TPFLAGS_DEFAULT,        <span class="comment">/*tp_flags*/</span>
<a name="l00481"></a>00481     <span class="stringliteral">&quot;Texture objects&quot;</span>,       <span class="comment">/* tp_doc */</span>
<a name="l00482"></a>00482     0,                     <span class="comment">/* tp_traverse */</span>
<a name="l00483"></a>00483     0,                     <span class="comment">/* tp_clear */</span>
<a name="l00484"></a>00484     0,                     <span class="comment">/* tp_richcompare */</span>
<a name="l00485"></a>00485     0,                     <span class="comment">/* tp_weaklistoffset */</span>
<a name="l00486"></a>00486     0,                     <span class="comment">/* tp_iter */</span>
<a name="l00487"></a>00487     0,                     <span class="comment">/* tp_iternext */</span>
<a name="l00488"></a>00488     <a class="code" href="../../d5/d87/Texture_8cpp.html#a076019983daaae2f6790ad9de28d5ec8">textureMethods</a>,      <span class="comment">/* tp_methods */</span>
<a name="l00489"></a>00489     0,                   <span class="comment">/* tp_members */</span>
<a name="l00490"></a>00490     <a class="code" href="../../d5/d87/Texture_8cpp.html#a2c85226885f42a78f11e3a93fb8071a9">textureGetSets</a>,            <span class="comment">/* tp_getset */</span>
<a name="l00491"></a>00491     0,                         <span class="comment">/* tp_base */</span>
<a name="l00492"></a>00492     0,                         <span class="comment">/* tp_dict */</span>
<a name="l00493"></a>00493     0,                         <span class="comment">/* tp_descr_get */</span>
<a name="l00494"></a>00494     0,                         <span class="comment">/* tp_descr_set */</span>
<a name="l00495"></a>00495     0,                         <span class="comment">/* tp_dictoffset */</span>
<a name="l00496"></a>00496     (initproc)<a class="code" href="../../d5/d87/Texture_8cpp.html#abfb4546a18087cbbb00df690744a8bf3">Texture_init</a>,    <span class="comment">/* tp_init */</span>
<a name="l00497"></a>00497     0,                         <span class="comment">/* tp_alloc */</span>
<a name="l00498"></a>00498     <a class="code" href="../../d5/d87/Texture_8cpp.html#a776fc92e80feaf4238e960b37702bed9">Texture_new</a>,               <span class="comment">/* tp_new */</span>
<a name="l00499"></a>00499 };
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:59 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

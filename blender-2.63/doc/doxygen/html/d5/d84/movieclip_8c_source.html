<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: movieclip.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">movieclip.c</div>  </div>
</div>
<div class="contents">
<a href="../../d5/d84/movieclip_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2011 Blender Foundation.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * Contributor(s): Blender Foundation,</span>
<a name="l00022"></a>00022 <span class="comment"> *                 Sergey Sharybin</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00025"></a>00025 <span class="comment"> */</span>
<a name="l00026"></a>00026 
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#ifndef WIN32</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#else</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#include &lt;io.h&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#endif</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;time.h&gt;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span><span class="preprocessor">#define open _open</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span><span class="preprocessor">#define close _close</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d03/DNA__constraint__types_8h.html">DNA_constraint_types.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/da4/DNA__screen__types_8h.html">DNA_screen_types.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d5d/DNA__space__types_8h.html">DNA_space_types.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html">DNA_movieclip_types.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d06/DNA__view3d__types_8h.html">DNA_view3d_types.h</a>&quot;</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc5/BLI__ghash_8h.html" title="A general (pointer -&gt; pointer) hash table ADT.">BLI_ghash.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d06/BLI__mempool_8h.html" title="Simple fast memory allocator.">BLI_mempool.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dbb/BLI__threads_8h.html">BLI_threads.h</a>&quot;</span>
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d51/BKE__animsys_8h.html">BKE_animsys.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddd/BKE__constraint_8h.html">BKE_constraint.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/db1/BKE__library_8h.html">BKE_library.h</a>&quot;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dde/BKE__utildefines_8h.html" title="blender format specific macros">BKE_utildefines.h</a>&quot;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd4/BKE__movieclip_8h.html">BKE_movieclip.h</a>&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d77/BKE__image_8h.html">BKE_image.h</a>&quot;</span>  <span class="comment">/* openanim */</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d72/BKE__tracking_8h.html">BKE_tracking.h</a>&quot;</span>
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html" title="Contains defines and structs used throughout the imbuf module.">IMB_imbuf_types.h</a>&quot;</span>
<a name="l00078"></a>00078 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d49/IMB__imbuf_8h.html">IMB_imbuf.h</a>&quot;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/dc9/IMB__moviecache_8h.html">IMB_moviecache.h</a>&quot;</span>
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 <span class="comment">/*********************** movieclip buffer loaders *************************/</span>
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="../../d5/d84/movieclip_8c.html#abdb4644643f02cb2b5f493b86f3d8e9d">00083</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d84/movieclip_8c.html#abdb4644643f02cb2b5f493b86f3d8e9d">sequence_guess_offset</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *full_name, <span class="keywordtype">int</span> head_len, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> numlen)
<a name="l00084"></a>00084 {
<a name="l00085"></a>00085     <span class="keywordtype">char</span> num[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>] = {0};
<a name="l00086"></a>00086 
<a name="l00087"></a>00087     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(num, full_name + head_len, numlen + 1);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089     <span class="keywordflow">return</span> atoi(num);
<a name="l00090"></a>00090 }
<a name="l00091"></a>00091 
<a name="l00092"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a43246249db5f56a6ebd0d317af3f41f5">00092</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d84/movieclip_8c.html#a43246249db5f56a6ebd0d317af3f41f5">rendersize_to_proxy</a>(<a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user, <span class="keywordtype">int</span> flag)
<a name="l00093"></a>00093 {
<a name="l00094"></a>00094     <span class="keywordflow">if</span> ((flag &amp; <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#afd859cc0303cbebcad0108bd3004ef1e">MCLIP_USE_PROXY</a>) == 0)
<a name="l00095"></a>00095         <span class="keywordflow">return</span> <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40bf8eb133a4eebf0b19a25cf1cd68b9aed5cd6acdce80ab41093059cede0c494">IMB_PROXY_NONE</a>;
<a name="l00096"></a>00096 
<a name="l00097"></a>00097     <span class="keywordflow">switch</span> (user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#ae9aa9cc593facc98db4d5759e46cb754">render_size</a>) {
<a name="l00098"></a>00098         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a6c02e6b5d98bba2f17b36df03cc6b009">MCLIP_PROXY_RENDER_SIZE_25</a>:
<a name="l00099"></a>00099             <span class="keywordflow">return</span> <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40bf8eb133a4eebf0b19a25cf1cd68b9ae37bc65ce8665eb2ed8b7c4c7f62a5c1">IMB_PROXY_25</a>;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#ab5b3c9043d84e45912e05cd0042addbb">MCLIP_PROXY_RENDER_SIZE_50</a>:
<a name="l00102"></a>00102             <span class="keywordflow">return</span> <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40bf8eb133a4eebf0b19a25cf1cd68b9ac6caaec6f67dec8b68ade5588804abb0">IMB_PROXY_50</a>;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a4d7851fa4dfffef1c22afe21a1ad85ab">MCLIP_PROXY_RENDER_SIZE_75</a>:
<a name="l00105"></a>00105             <span class="keywordflow">return</span> <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40bf8eb133a4eebf0b19a25cf1cd68b9a3e531104166d55cf31ecccce59fb677a">IMB_PROXY_75</a>;
<a name="l00106"></a>00106 
<a name="l00107"></a>00107         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#ac363598bc3ff891a206bffbcf631cbe9">MCLIP_PROXY_RENDER_SIZE_100</a>:
<a name="l00108"></a>00108             <span class="keywordflow">return</span> <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40bf8eb133a4eebf0b19a25cf1cd68b9a15dec2577f14ef17933852649bb8bd8e">IMB_PROXY_100</a>;
<a name="l00109"></a>00109 
<a name="l00110"></a>00110         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a7aa419b2dcb03674e1546ff88882e320">MCLIP_PROXY_RENDER_SIZE_FULL</a>:
<a name="l00111"></a>00111             <span class="keywordflow">return</span> <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40bf8eb133a4eebf0b19a25cf1cd68b9aed5cd6acdce80ab41093059cede0c494">IMB_PROXY_NONE</a>;
<a name="l00112"></a>00112     }
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     <span class="keywordflow">return</span> <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40bf8eb133a4eebf0b19a25cf1cd68b9aed5cd6acdce80ab41093059cede0c494">IMB_PROXY_NONE</a>;
<a name="l00115"></a>00115 }
<a name="l00116"></a>00116 
<a name="l00117"></a><a class="code" href="../../d5/d84/movieclip_8c.html#aca0bce307900633b028ac9adf3ee8e80">00117</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d84/movieclip_8c.html#aca0bce307900633b028ac9adf3ee8e80">rendersize_to_number</a>(<span class="keywordtype">int</span> render_size)
<a name="l00118"></a>00118 {
<a name="l00119"></a>00119     <span class="keywordflow">switch</span> (render_size) {
<a name="l00120"></a>00120         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a6c02e6b5d98bba2f17b36df03cc6b009">MCLIP_PROXY_RENDER_SIZE_25</a>:
<a name="l00121"></a>00121             <span class="keywordflow">return</span> 25;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#ab5b3c9043d84e45912e05cd0042addbb">MCLIP_PROXY_RENDER_SIZE_50</a>:
<a name="l00124"></a>00124             <span class="keywordflow">return</span> 50;
<a name="l00125"></a>00125 
<a name="l00126"></a>00126         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a4d7851fa4dfffef1c22afe21a1ad85ab">MCLIP_PROXY_RENDER_SIZE_75</a>:
<a name="l00127"></a>00127             <span class="keywordflow">return</span> 75;
<a name="l00128"></a>00128 
<a name="l00129"></a>00129         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#ac363598bc3ff891a206bffbcf631cbe9">MCLIP_PROXY_RENDER_SIZE_100</a>:
<a name="l00130"></a>00130             <span class="keywordflow">return</span> 100;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a7aa419b2dcb03674e1546ff88882e320">MCLIP_PROXY_RENDER_SIZE_FULL</a>:
<a name="l00133"></a>00133             <span class="keywordflow">return</span> 100;
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135 
<a name="l00136"></a>00136     <span class="keywordflow">return</span> 100;
<a name="l00137"></a>00137 }
<a name="l00138"></a>00138 
<a name="l00139"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a89ef7657f73eaf219dc52c2d24cd8150">00139</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d84/movieclip_8c.html#a89ef7657f73eaf219dc52c2d24cd8150">get_timecode</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <span class="keywordtype">int</span> flag)
<a name="l00140"></a>00140 {
<a name="l00141"></a>00141     <span class="keywordflow">if</span> ((flag &amp; <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#afd859cc0303cbebcad0108bd3004ef1e">MCLIP_USE_PROXY</a>) == 0)
<a name="l00142"></a>00142         <span class="keywordflow">return</span> <a class="code" href="../../db/d49/IMB__imbuf_8h.html#aff5caa59b0951e087034606a3c6e9f1ca5b974c2275e784c1f24a3fe025379343">IMB_TC_NONE</a>;
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <span class="keywordflow">return</span> clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a93ac999acdd83124032266a3128d8adc">proxy</a>.<a class="code" href="../../d6/dc8/structMovieClipProxy.html#a512e49102ebf33ef40ea6a9d38783487">tc</a>;
<a name="l00145"></a>00145 }
<a name="l00146"></a>00146 
<a name="l00147"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a2d387e01dab5b4699b94e679ed0b6911">00147</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d84/movieclip_8c.html#a2d387e01dab5b4699b94e679ed0b6911">get_sequence_fname</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <span class="keywordtype">int</span> framenr, <span class="keywordtype">char</span> *name)
<a name="l00148"></a>00148 {
<a name="l00149"></a>00149     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> numlen;
<a name="l00150"></a>00150     <span class="keywordtype">char</span> head[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>], tail[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00151"></a>00151     <span class="keywordtype">int</span> offset;
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(name, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a4d5df220f2acc5ba922f6395cb8ef72e">name</a>, <span class="keyword">sizeof</span>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a4d5df220f2acc5ba922f6395cb8ef72e">name</a>));
<a name="l00154"></a>00154     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ad1455f1d2df23ea66d7b1bf46adff870">BLI_stringdec</a>(name, head, tail, &amp;numlen);
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     <span class="comment">/* movieclips always points to first image from sequence,</span>
<a name="l00157"></a>00157 <span class="comment">     * autoguess offset for now. could be something smarter in the future */</span>
<a name="l00158"></a>00158     offset= <a class="code" href="../../d5/d84/movieclip_8c.html#abdb4644643f02cb2b5f493b86f3d8e9d">sequence_guess_offset</a>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a4d5df220f2acc5ba922f6395cb8ef72e">name</a>, <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(head), numlen);
<a name="l00159"></a>00159 
<a name="l00160"></a>00160     <span class="keywordflow">if</span> (numlen)
<a name="l00161"></a>00161         <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a9cb5dd722995bcaf96c1fabef98be6bc">BLI_stringenc</a>(name, head, tail, numlen, offset + framenr - 1);
<a name="l00162"></a>00162     <span class="keywordflow">else</span>
<a name="l00163"></a>00163         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(name, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a4d5df220f2acc5ba922f6395cb8ef72e">name</a>, <span class="keyword">sizeof</span>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a4d5df220f2acc5ba922f6395cb8ef72e">name</a>));
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a779fd31715eb05e3322500e3426b03a2">BLI_path_abs</a>(name, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a8a52d8cb8dde5bcf01c0f20254860d71">ID_BLEND_PATH</a>(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main, &amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a51cceb766b47f21cbe774967b1d73b8f">id</a>));
<a name="l00166"></a>00166 }
<a name="l00167"></a>00167 
<a name="l00168"></a>00168 <span class="comment">/* supposed to work with sequences only */</span>
<a name="l00169"></a><a class="code" href="../../d5/d84/movieclip_8c.html#aa06f33251bf8ca100f2d803d5b7c9f93">00169</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d84/movieclip_8c.html#aa06f33251bf8ca100f2d803d5b7c9f93">get_proxy_fname</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <span class="keywordtype">int</span> proxy_render_size, <span class="keywordtype">int</span> undistorted, <span class="keywordtype">int</span> framenr, <span class="keywordtype">char</span> *name)
<a name="l00170"></a>00170 {
<a name="l00171"></a>00171     <span class="keywordtype">int</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a> = <a class="code" href="../../d5/d84/movieclip_8c.html#aca0bce307900633b028ac9adf3ee8e80">rendersize_to_number</a>(proxy_render_size);
<a name="l00172"></a>00172     <span class="keywordtype">char</span> dir[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>], clipdir[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>], clipfile[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00173"></a>00173 
<a name="l00174"></a>00174     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ae9bf85f6bb0df0bb8fcc352e870e32b8">BLI_split_dirfile</a>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a4d5df220f2acc5ba922f6395cb8ef72e">name</a>, clipdir, clipfile, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>);
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ac4b1eba68ec74a5715d7d15d57357190">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a71ed39ac1ab39f839c13f6cce04e6fd6">MCLIP_USE_PROXY_CUSTOM_DIR</a>) {
<a name="l00177"></a>00177         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(dir, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a93ac999acdd83124032266a3128d8adc">proxy</a>.<a class="code" href="../../d6/dc8/structMovieClipProxy.html#af2209cf50de4374dc0d2bedc2ee73aa8">dir</a>, <span class="keyword">sizeof</span>(dir));
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179     <span class="keywordflow">else</span> {
<a name="l00180"></a>00180         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(dir, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>, <span class="stringliteral">&quot;%s/BL_proxy&quot;</span>, clipdir);
<a name="l00181"></a>00181     }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183     <span class="keywordflow">if</span> (undistorted)
<a name="l00184"></a>00184         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(name, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>, <span class="stringliteral">&quot;%s/%s/proxy_%d_undistorted/%08d&quot;</span>, dir, clipfile, size, framenr);
<a name="l00185"></a>00185     <span class="keywordflow">else</span>
<a name="l00186"></a>00186         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(name, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>, <span class="stringliteral">&quot;%s/%s/proxy_%d/%08d&quot;</span>, dir, clipfile, size, framenr);
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a779fd31715eb05e3322500e3426b03a2">BLI_path_abs</a>(name, <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name);
<a name="l00189"></a>00189     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a57e90c5ab9a8c42672bb881833b4bde0">BLI_path_frame</a>(name, 1, 0);
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     strcat(name, <span class="stringliteral">&quot;.jpg&quot;</span>);
<a name="l00192"></a>00192 }
<a name="l00193"></a>00193 
<a name="l00194"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a3748c7b3dc8ceb8f2e66e95c6961fc14">00194</a> <span class="keyword">static</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../d5/d84/movieclip_8c.html#a3748c7b3dc8ceb8f2e66e95c6961fc14">movieclip_load_sequence_file</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user, <span class="keywordtype">int</span> framenr, <span class="keywordtype">int</span> flag)
<a name="l00195"></a>00195 {
<a name="l00196"></a>00196     <span class="keyword">struct </span><a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf;
<a name="l00197"></a>00197     <span class="keywordtype">char</span> <a class="code" href="../../d3/dd9/structImBuf.html#a19aecd6c1f8855b0bb40f877fa01633f">name</a>[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00198"></a>00198     <span class="keywordtype">int</span> loadflag, use_proxy= 0;
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     use_proxy = (flag &amp; <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#afd859cc0303cbebcad0108bd3004ef1e">MCLIP_USE_PROXY</a>) &amp;&amp; user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#ae9aa9cc593facc98db4d5759e46cb754">render_size</a> != <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a7aa419b2dcb03674e1546ff88882e320">MCLIP_PROXY_RENDER_SIZE_FULL</a>;
<a name="l00201"></a>00201     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (use_proxy) {
<a name="l00202"></a>00202         <span class="keywordtype">int</span> undistort = user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a55a5c7cefa1d8e69de06bca5b9dc8ed2">render_flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#aa67ed8fbe261bdc20282c168cbea692d">MCLIP_PROXY_RENDER_UNDISTORT</a>;
<a name="l00203"></a>00203         <a class="code" href="../../d5/d84/movieclip_8c.html#aa06f33251bf8ca100f2d803d5b7c9f93">get_proxy_fname</a>(clip, user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#ae9aa9cc593facc98db4d5759e46cb754">render_size</a>, undistort, framenr, name);
<a name="l00204"></a>00204     }
<a name="l00205"></a>00205     <span class="keywordflow">else</span>
<a name="l00206"></a>00206         <a class="code" href="../../d5/d84/movieclip_8c.html#a2d387e01dab5b4699b94e679ed0b6911">get_sequence_fname</a>(clip, framenr, name);
<a name="l00207"></a>00207 
<a name="l00208"></a>00208     loadflag = <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#aa49c3338a20e388ce6ade7af88a93d40" title="Flag defining the components of the ImBuf struct.">IB_rect</a>|<a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#ab86521a39a5155a4f87545b41d35a18b" title="Flag defining the components of the ImBuf struct.">IB_multilayer</a>;
<a name="l00209"></a>00209 
<a name="l00210"></a>00210     <span class="comment">/* read ibuf */</span>
<a name="l00211"></a>00211     ibuf = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#ad9841de487be5fa3a88602b144ad9c2d">IMB_loadiffname</a>(name, loadflag);
<a name="l00212"></a>00212 
<a name="l00213"></a>00213     <span class="keywordflow">return</span> ibuf;
<a name="l00214"></a>00214 }
<a name="l00215"></a>00215 
<a name="l00216"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a99f00a6f1d4ef2846e07571c6fe49573">00216</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d84/movieclip_8c.html#a99f00a6f1d4ef2846e07571c6fe49573">movieclip_open_anim_file</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip)
<a name="l00217"></a>00217 {
<a name="l00218"></a>00218     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <span class="keywordflow">if</span> (!clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a8f8a62b9b886e5442655c193ff1c9dfa">anim</a>) {
<a name="l00221"></a>00221         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(str, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a4d5df220f2acc5ba922f6395cb8ef72e">name</a>, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>);
<a name="l00222"></a>00222         <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a779fd31715eb05e3322500e3426b03a2">BLI_path_abs</a>(str, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a8a52d8cb8dde5bcf01c0f20254860d71">ID_BLEND_PATH</a>(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main, &amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a51cceb766b47f21cbe774967b1d73b8f">id</a>));
<a name="l00223"></a>00223 
<a name="l00224"></a>00224         <span class="comment">/* FIXME: make several stream accessible in image editor, too */</span>
<a name="l00225"></a>00225         clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a8f8a62b9b886e5442655c193ff1c9dfa">anim</a> = <a class="code" href="../../d2/d77/BKE__image_8h.html#a5bcb7aaaa54ec946022e07510eddbcaa">openanim</a>(str, <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#aa49c3338a20e388ce6ade7af88a93d40" title="Flag defining the components of the ImBuf struct.">IB_rect</a>, 0);
<a name="l00226"></a>00226 
<a name="l00227"></a>00227         <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a8f8a62b9b886e5442655c193ff1c9dfa">anim</a>) {
<a name="l00228"></a>00228             <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ac4b1eba68ec74a5715d7d15d57357190">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a71ed39ac1ab39f839c13f6cce04e6fd6">MCLIP_USE_PROXY_CUSTOM_DIR</a>) {
<a name="l00229"></a>00229                 <span class="keywordtype">char</span> dir[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00230"></a>00230                 <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(dir, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a93ac999acdd83124032266a3128d8adc">proxy</a>.<a class="code" href="../../d6/dc8/structMovieClipProxy.html#af2209cf50de4374dc0d2bedc2ee73aa8">dir</a>, <span class="keyword">sizeof</span>(dir));
<a name="l00231"></a>00231                 <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a779fd31715eb05e3322500e3426b03a2">BLI_path_abs</a>(dir, <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name);
<a name="l00232"></a>00232                 <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a4813cc0775283d51ab6396f6c5117ea8">IMB_anim_set_index_dir</a>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a8f8a62b9b886e5442655c193ff1c9dfa">anim</a>, dir);
<a name="l00233"></a>00233             }
<a name="l00234"></a>00234         }
<a name="l00235"></a>00235     }
<a name="l00236"></a>00236 }
<a name="l00237"></a>00237 
<a name="l00238"></a><a class="code" href="../../d5/d84/movieclip_8c.html#aba6d56e0f21f4a6d8c1fccb385e6906b">00238</a> <span class="keyword">static</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../d5/d84/movieclip_8c.html#aba6d56e0f21f4a6d8c1fccb385e6906b">movieclip_load_movie_file</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user, <span class="keywordtype">int</span> framenr, <span class="keywordtype">int</span> flag)
<a name="l00239"></a>00239 {
<a name="l00240"></a>00240     <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00241"></a>00241     <span class="keywordtype">int</span> tc = <a class="code" href="../../d5/d84/movieclip_8c.html#a89ef7657f73eaf219dc52c2d24cd8150">get_timecode</a>(clip, flag);
<a name="l00242"></a>00242     <span class="keywordtype">int</span> proxy = <a class="code" href="../../d5/d84/movieclip_8c.html#a43246249db5f56a6ebd0d317af3f41f5">rendersize_to_proxy</a>(user, flag);
<a name="l00243"></a>00243 
<a name="l00244"></a>00244     <a class="code" href="../../d5/d84/movieclip_8c.html#a99f00a6f1d4ef2846e07571c6fe49573">movieclip_open_anim_file</a>(clip);
<a name="l00245"></a>00245 
<a name="l00246"></a>00246     <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a8f8a62b9b886e5442655c193ff1c9dfa">anim</a>) {
<a name="l00247"></a>00247         <span class="keywordtype">int</span> dur;
<a name="l00248"></a>00248         <span class="keywordtype">int</span> fra;
<a name="l00249"></a>00249 
<a name="l00250"></a>00250         dur = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#af8d8929cb1ab6eaff45f50de696752b6">IMB_anim_get_duration</a>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a8f8a62b9b886e5442655c193ff1c9dfa">anim</a>, tc);
<a name="l00251"></a>00251         fra = framenr - 1;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253         <span class="keywordflow">if</span> (fra&lt;0)
<a name="l00254"></a>00254             fra = 0;
<a name="l00255"></a>00255 
<a name="l00256"></a>00256         <span class="keywordflow">if</span> (fra &gt; (dur - 1))
<a name="l00257"></a>00257             fra = dur - 1;
<a name="l00258"></a>00258 
<a name="l00259"></a>00259         ibuf = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#aea47315b3c671962f07d937509eeb38e">IMB_anim_absolute</a>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a8f8a62b9b886e5442655c193ff1c9dfa">anim</a>, fra, tc, proxy);
<a name="l00260"></a>00260     }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     <span class="keywordflow">return</span> ibuf;
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 
<a name="l00265"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a05bd99378ee9f28c74368e0740f96f9f">00265</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d84/movieclip_8c.html#a05bd99378ee9f28c74368e0740f96f9f">movieclip_calc_length</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip)
<a name="l00266"></a>00266 {
<a name="l00267"></a>00267     <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a47c5d571a621c7cd81b374300f7b5dbb">source</a> == <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a37e46946680b151be78269381b3fbe21">MCLIP_SRC_MOVIE</a>) {
<a name="l00268"></a>00268         <a class="code" href="../../d5/d84/movieclip_8c.html#a99f00a6f1d4ef2846e07571c6fe49573">movieclip_open_anim_file</a>(clip);
<a name="l00269"></a>00269 
<a name="l00270"></a>00270         <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a8f8a62b9b886e5442655c193ff1c9dfa">anim</a>) {
<a name="l00271"></a>00271             clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#aee81e17befb0ce63b5c8b7d1f18b49e6">len</a> = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#af8d8929cb1ab6eaff45f50de696752b6">IMB_anim_get_duration</a>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a8f8a62b9b886e5442655c193ff1c9dfa">anim</a>, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a93ac999acdd83124032266a3128d8adc">proxy</a>.<a class="code" href="../../d6/dc8/structMovieClipProxy.html#a512e49102ebf33ef40ea6a9d38783487">tc</a>);
<a name="l00272"></a>00272         }
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a47c5d571a621c7cd81b374300f7b5dbb">source</a> == <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a2f619ea33ee5a6afa9b4b160a16f84aa">MCLIP_SRC_SEQUENCE</a>) {
<a name="l00275"></a>00275         <span class="keywordtype">int</span> framenr = 1;
<a name="l00276"></a>00276         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> numlen;
<a name="l00277"></a>00277         <span class="keywordtype">char</span> <a class="code" href="../../d3/dd9/structImBuf.html#a19aecd6c1f8855b0bb40f877fa01633f">name</a>[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>], head[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>], tail[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00278"></a>00278 
<a name="l00279"></a>00279         <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ad1455f1d2df23ea66d7b1bf46adff870">BLI_stringdec</a>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a4d5df220f2acc5ba922f6395cb8ef72e">name</a>, head, tail, &amp;numlen);
<a name="l00280"></a>00280 
<a name="l00281"></a>00281         <span class="keywordflow">if</span> (numlen == 0) {
<a name="l00282"></a>00282             <span class="comment">/* there&#39;s no number group in file name, assume it&#39;s single framed sequence */</span>
<a name="l00283"></a>00283             clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#aee81e17befb0ce63b5c8b7d1f18b49e6">len</a> = framenr + 1;
<a name="l00284"></a>00284         }
<a name="l00285"></a>00285         <span class="keywordflow">else</span> {
<a name="l00286"></a>00286             <span class="keywordflow">for</span> (;;) {
<a name="l00287"></a>00287                 <a class="code" href="../../d5/d84/movieclip_8c.html#a2d387e01dab5b4699b94e679ed0b6911">get_sequence_fname</a>(clip, framenr, name);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289                 <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d63/BLI__fileops_8h.html#a0bf59749f87b0f283c37e27e72029591">BLI_exists</a>(name)) {
<a name="l00290"></a>00290                     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#aee81e17befb0ce63b5c8b7d1f18b49e6">len</a> = framenr + 1;
<a name="l00291"></a>00291                     <span class="keywordflow">break</span>;
<a name="l00292"></a>00292                 }
<a name="l00293"></a>00293 
<a name="l00294"></a>00294                 framenr++;
<a name="l00295"></a>00295             }
<a name="l00296"></a>00296         }
<a name="l00297"></a>00297     }
<a name="l00298"></a>00298 }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 <span class="comment">/*********************** image buffer cache *************************/</span>
<a name="l00301"></a>00301 
<a name="l00302"></a><a class="code" href="../../d0/dc5/structMovieClipCache.html">00302</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/dc5/structMovieClipCache.html">MovieClipCache</a> {
<a name="l00303"></a>00303     <span class="comment">/* regular movie cache */</span>
<a name="l00304"></a><a class="code" href="../../d0/dc5/structMovieClipCache.html#aedb09ce841aa4995afe94dec6a9da9ce">00304</a>     <span class="keyword">struct </span><a class="code" href="../../d5/def/structMovieCache.html">MovieCache</a> *<a class="code" href="../../d0/dc5/structMovieClipCache.html#aedb09ce841aa4995afe94dec6a9da9ce">moviecache</a>;
<a name="l00305"></a>00305 
<a name="l00306"></a>00306     <span class="comment">/* cached postprocessed shot */</span>
<a name="l00307"></a>00307     <span class="keyword">struct </span>{
<a name="l00308"></a><a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">00308</a>         <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a>;
<a name="l00309"></a><a class="code" href="../../d0/dc5/structMovieClipCache.html#acc7a4732513b3f98c86b74ac89d1d26d">00309</a>         <span class="keywordtype">int</span> <a class="code" href="../../d0/dc5/structMovieClipCache.html#acc7a4732513b3f98c86b74ac89d1d26d">framenr</a>;
<a name="l00310"></a><a class="code" href="../../d0/dc5/structMovieClipCache.html#a7a95602a52715a7bff252fd9a2935399">00310</a>         <span class="keywordtype">int</span> <a class="code" href="../../d0/dc5/structMovieClipCache.html#a7a95602a52715a7bff252fd9a2935399">flag</a>;
<a name="l00311"></a>00311 
<a name="l00312"></a>00312         <span class="comment">/* cache for undistorted shot */</span>
<a name="l00313"></a><a class="code" href="../../d0/dc5/structMovieClipCache.html#a4e5587353737842abfe830776796693b">00313</a>         <span class="keywordtype">float</span> <a class="code" href="../../d0/dc5/structMovieClipCache.html#a4e5587353737842abfe830776796693b">principal</a>[2];
<a name="l00314"></a><a class="code" href="../../d0/dc5/structMovieClipCache.html#afb27b0595b68084a5f804de5b0282d10">00314</a>         <span class="keywordtype">float</span> <a class="code" href="../../d0/dc5/structMovieClipCache.html#a07d65be4f1f23ed9179a67a991f64ba9">k1</a>, <a class="code" href="../../d0/dc5/structMovieClipCache.html#aa5776a92e7958c0a819311c26fdd3104">k2</a>, <a class="code" href="../../d0/dc5/structMovieClipCache.html#afb27b0595b68084a5f804de5b0282d10">k3</a>;
<a name="l00315"></a><a class="code" href="../../d0/dc5/structMovieClipCache.html#a69755fe7c8906fc187e1b38d6c7e110a">00315</a>         <span class="keywordtype">short</span> <a class="code" href="../../d0/dc5/structMovieClipCache.html#a69755fe7c8906fc187e1b38d6c7e110a">undistoriton_used</a>;
<a name="l00316"></a>00316 
<a name="l00317"></a><a class="code" href="../../d0/dc5/structMovieClipCache.html#ad96a9a8f33852a29f150618ea6a72f36">00317</a>         <span class="keywordtype">int</span> <a class="code" href="../../d0/dc5/structMovieClipCache.html#ad96a9a8f33852a29f150618ea6a72f36">proxy</a>;
<a name="l00318"></a><a class="code" href="../../d0/dc5/structMovieClipCache.html#a37e429784bc6fb2fc4c0bfca7800160d">00318</a>         <span class="keywordtype">short</span> <a class="code" href="../../d0/dc5/structMovieClipCache.html#a37e429784bc6fb2fc4c0bfca7800160d">render_flag</a>;
<a name="l00319"></a>00319     } <a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>;
<a name="l00320"></a>00320 
<a name="l00321"></a>00321     <span class="comment">/* cache for stable shot */</span>
<a name="l00322"></a>00322     <span class="keyword">struct </span>{
<a name="l00323"></a>00323         <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a>;
<a name="l00324"></a>00324         <span class="keywordtype">int</span> <a class="code" href="../../d0/dc5/structMovieClipCache.html#acc7a4732513b3f98c86b74ac89d1d26d">framenr</a>;
<a name="l00325"></a><a class="code" href="../../d0/dc5/structMovieClipCache.html#a39d1f55676c5ab85acb83fc444e8479b">00325</a>         <span class="keywordtype">int</span> <a class="code" href="../../d0/dc5/structMovieClipCache.html#a39d1f55676c5ab85acb83fc444e8479b">postprocess_flag</a>;
<a name="l00326"></a>00326 
<a name="l00327"></a><a class="code" href="../../d0/dc5/structMovieClipCache.html#a47b4963ef164a6f52ec8ae2eb5d547d3">00327</a>         <span class="keywordtype">float</span> <a class="code" href="../../d0/dc5/structMovieClipCache.html#a210747decf802ef24cd9ce01b98d6e17">loc</a>[2], <a class="code" href="../../d0/dc5/structMovieClipCache.html#a47b4963ef164a6f52ec8ae2eb5d547d3">scale</a>, <a class="code" href="../../d0/dc5/structMovieClipCache.html#ad3b25895f495e28bb453d8e6aaa74629">angle</a>, <a class="code" href="../../d0/dc5/structMovieClipCache.html#aaeeef3d4a9b37e2511bb6b3c6a86d2ea">aspect</a>;
<a name="l00328"></a><a class="code" href="../../d0/dc5/structMovieClipCache.html#a95ce1999fe557daad637f678322daa55">00328</a>         <span class="keywordtype">int</span> <a class="code" href="../../d0/dc5/structMovieClipCache.html#ad96a9a8f33852a29f150618ea6a72f36">proxy</a>, <a class="code" href="../../d0/dc5/structMovieClipCache.html#a95ce1999fe557daad637f678322daa55">filter</a>;
<a name="l00329"></a>00329         <span class="keywordtype">short</span> <a class="code" href="../../d0/dc5/structMovieClipCache.html#a37e429784bc6fb2fc4c0bfca7800160d">render_flag</a>;
<a name="l00330"></a>00330     } <a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>;
<a name="l00331"></a>00331 } <a class="code" href="../../d5/d84/movieclip_8c.html#a2f1c2cf2031c6e26d59cacb6669d2e07">MovieClipCache</a>;
<a name="l00332"></a>00332 
<a name="l00333"></a><a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html">00333</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html">MovieClipImBufCacheKey</a> {
<a name="l00334"></a><a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a0e389a691ddc4e7bc68e9e570f46bfd7">00334</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a0e389a691ddc4e7bc68e9e570f46bfd7">framenr</a>;
<a name="l00335"></a><a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a61c10a051cfbdc8047e8ebef4ecd34fb">00335</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a61c10a051cfbdc8047e8ebef4ecd34fb">proxy</a>;
<a name="l00336"></a><a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a48c690a8be456218139db243dd85897d">00336</a>     <span class="keywordtype">short</span> <a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a48c690a8be456218139db243dd85897d">render_flag</a>;
<a name="l00337"></a>00337 } <a class="code" href="../../d5/d84/movieclip_8c.html#a30915367e03a5d98bc255f0df3d26f34">MovieClipImBufCacheKey</a>;
<a name="l00338"></a>00338 
<a name="l00339"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a62be5ad8e349d90addf30c802be5f651">00339</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d84/movieclip_8c.html#a62be5ad8e349d90addf30c802be5f651">moviecache_keydata</a>(<span class="keywordtype">void</span> *userkey, <span class="keywordtype">int</span> *framenr, <span class="keywordtype">int</span> *proxy, <span class="keywordtype">int</span> *render_flags)
<a name="l00340"></a>00340 {
<a name="l00341"></a>00341     <a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html">MovieClipImBufCacheKey</a> *key = (<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html">MovieClipImBufCacheKey</a>*)userkey;
<a name="l00342"></a>00342 
<a name="l00343"></a>00343     *framenr = key-&gt;<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a0e389a691ddc4e7bc68e9e570f46bfd7">framenr</a>;
<a name="l00344"></a>00344     *proxy = key-&gt;<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a61c10a051cfbdc8047e8ebef4ecd34fb">proxy</a>;
<a name="l00345"></a>00345     *render_flags = key-&gt;<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a48c690a8be456218139db243dd85897d">render_flag</a>;
<a name="l00346"></a>00346 }
<a name="l00347"></a>00347 
<a name="l00348"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a6651eab7cfcf8f0cce042f2fb48df897">00348</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d84/movieclip_8c.html#a6651eab7cfcf8f0cce042f2fb48df897">moviecache_hashhash</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *keyv)
<a name="l00349"></a>00349 {
<a name="l00350"></a>00350     <a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html">MovieClipImBufCacheKey</a> *key = (<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html">MovieClipImBufCacheKey</a>*)keyv;
<a name="l00351"></a>00351     <span class="keywordtype">int</span> rval = key-&gt;<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a0e389a691ddc4e7bc68e9e570f46bfd7">framenr</a>;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353     <span class="keywordflow">return</span> rval;
<a name="l00354"></a>00354 }
<a name="l00355"></a>00355 
<a name="l00356"></a><a class="code" href="../../d5/d84/movieclip_8c.html#abe31ccea571bfad6a237d19e5dd13f9d">00356</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d84/movieclip_8c.html#abe31ccea571bfad6a237d19e5dd13f9d">moviecache_hashcmp</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *av, <span class="keyword">const</span> <span class="keywordtype">void</span> *bv)
<a name="l00357"></a>00357 {
<a name="l00358"></a>00358     <span class="keyword">const</span> <a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html">MovieClipImBufCacheKey</a> *a = (<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html">MovieClipImBufCacheKey</a>*)av;
<a name="l00359"></a>00359     <span class="keyword">const</span> <a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html">MovieClipImBufCacheKey</a> *b = (<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html">MovieClipImBufCacheKey</a>*)bv;
<a name="l00360"></a>00360 
<a name="l00361"></a>00361     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a0e389a691ddc4e7bc68e9e570f46bfd7">framenr</a> &lt; b-&gt;<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a0e389a691ddc4e7bc68e9e570f46bfd7">framenr</a>)
<a name="l00362"></a>00362         <span class="keywordflow">return</span> -1;
<a name="l00363"></a>00363     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a0e389a691ddc4e7bc68e9e570f46bfd7">framenr</a> &gt; b-&gt;<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a0e389a691ddc4e7bc68e9e570f46bfd7">framenr</a>)
<a name="l00364"></a>00364         <span class="keywordflow">return</span> 1;
<a name="l00365"></a>00365 
<a name="l00366"></a>00366     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a61c10a051cfbdc8047e8ebef4ecd34fb">proxy</a> &lt; b-&gt;<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a61c10a051cfbdc8047e8ebef4ecd34fb">proxy</a>)
<a name="l00367"></a>00367         <span class="keywordflow">return</span> -1;
<a name="l00368"></a>00368     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a61c10a051cfbdc8047e8ebef4ecd34fb">proxy</a> &gt; b-&gt;<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a61c10a051cfbdc8047e8ebef4ecd34fb">proxy</a>)
<a name="l00369"></a>00369         <span class="keywordflow">return</span> 1;
<a name="l00370"></a>00370 
<a name="l00371"></a>00371     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a48c690a8be456218139db243dd85897d">render_flag</a> &lt; b-&gt;<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a48c690a8be456218139db243dd85897d">render_flag</a>)
<a name="l00372"></a>00372         <span class="keywordflow">return</span> -1;
<a name="l00373"></a>00373     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a48c690a8be456218139db243dd85897d">render_flag</a> &gt; b-&gt;<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a48c690a8be456218139db243dd85897d">render_flag</a>)
<a name="l00374"></a>00374         <span class="keywordflow">return</span> 1;
<a name="l00375"></a>00375 
<a name="l00376"></a>00376     <span class="keywordflow">return</span> 0;
<a name="l00377"></a>00377 }
<a name="l00378"></a>00378 
<a name="l00379"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a5b3e48383eb4e4941a4612a91d65bc9f">00379</a> <span class="keyword">static</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../d5/d84/movieclip_8c.html#a5b3e48383eb4e4941a4612a91d65bc9f">get_imbuf_cache</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user, <span class="keywordtype">int</span> flag)
<a name="l00380"></a>00380 {
<a name="l00381"></a>00381     <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>) {
<a name="l00382"></a>00382         <a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html">MovieClipImBufCacheKey</a> key;
<a name="l00383"></a>00383 
<a name="l00384"></a>00384         key.<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a0e389a691ddc4e7bc68e9e570f46bfd7">framenr</a> = user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a645bba5909762a5df052e903bfb00afb">framenr</a>;
<a name="l00385"></a>00385 
<a name="l00386"></a>00386         <span class="keywordflow">if</span> (flag &amp; <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#afd859cc0303cbebcad0108bd3004ef1e">MCLIP_USE_PROXY</a>) {
<a name="l00387"></a>00387             key.<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a61c10a051cfbdc8047e8ebef4ecd34fb">proxy</a> = <a class="code" href="../../d5/d84/movieclip_8c.html#a43246249db5f56a6ebd0d317af3f41f5">rendersize_to_proxy</a>(user, flag);
<a name="l00388"></a>00388             key.<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a48c690a8be456218139db243dd85897d">render_flag</a> = user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a55a5c7cefa1d8e69de06bca5b9dc8ed2">render_flag</a>;
<a name="l00389"></a>00389         }
<a name="l00390"></a>00390         <span class="keywordflow">else</span> {
<a name="l00391"></a>00391             key.<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a61c10a051cfbdc8047e8ebef4ecd34fb">proxy</a> = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40bf8eb133a4eebf0b19a25cf1cd68b9aed5cd6acdce80ab41093059cede0c494">IMB_PROXY_NONE</a>;
<a name="l00392"></a>00392             key.<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a48c690a8be456218139db243dd85897d">render_flag</a> = 0;
<a name="l00393"></a>00393         }
<a name="l00394"></a>00394 
<a name="l00395"></a>00395         <span class="keywordflow">return</span> <a class="code" href="../../d0/dc9/IMB__moviecache_8h.html#a56a146b0dd84313e033efd8486458e7f">IMB_moviecache_get</a>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#aedb09ce841aa4995afe94dec6a9da9ce">moviecache</a>, &amp;key);
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397 
<a name="l00398"></a>00398     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00399"></a>00399 }
<a name="l00400"></a>00400 
<a name="l00401"></a><a class="code" href="../../d5/d84/movieclip_8c.html#af09bf6efa7b3f0adf11d55e41866fa09">00401</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d84/movieclip_8c.html#af09bf6efa7b3f0adf11d55e41866fa09">put_imbuf_cache</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user, <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf, <span class="keywordtype">int</span> flag)
<a name="l00402"></a>00402 {
<a name="l00403"></a>00403     <a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html">MovieClipImBufCacheKey</a> key;
<a name="l00404"></a>00404 
<a name="l00405"></a>00405     <span class="keywordflow">if</span> (!clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>) {
<a name="l00406"></a>00406         clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/dc5/structMovieClipCache.html">MovieClipCache</a>), <span class="stringliteral">&quot;movieClipCache&quot;</span>);
<a name="l00407"></a>00407 
<a name="l00408"></a>00408         clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#aedb09ce841aa4995afe94dec6a9da9ce">moviecache</a> = <a class="code" href="../../d0/dc9/IMB__moviecache_8h.html#a05278b3a723379895b74c084f2361cb6">IMB_moviecache_create</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html">MovieClipImBufCacheKey</a>), <a class="code" href="../../d5/d84/movieclip_8c.html#a6651eab7cfcf8f0cce042f2fb48df897">moviecache_hashhash</a>,
<a name="l00409"></a>00409                 <a class="code" href="../../d5/d84/movieclip_8c.html#abe31ccea571bfad6a237d19e5dd13f9d">moviecache_hashcmp</a>, <a class="code" href="../../d5/d84/movieclip_8c.html#a62be5ad8e349d90addf30c802be5f651">moviecache_keydata</a>);
<a name="l00410"></a>00410     }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412     key.<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a0e389a691ddc4e7bc68e9e570f46bfd7">framenr</a> = user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a645bba5909762a5df052e903bfb00afb">framenr</a>;
<a name="l00413"></a>00413 
<a name="l00414"></a>00414     <span class="keywordflow">if</span> (flag &amp; <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#afd859cc0303cbebcad0108bd3004ef1e">MCLIP_USE_PROXY</a>) {
<a name="l00415"></a>00415         key.<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a61c10a051cfbdc8047e8ebef4ecd34fb">proxy</a> = <a class="code" href="../../d5/d84/movieclip_8c.html#a43246249db5f56a6ebd0d317af3f41f5">rendersize_to_proxy</a>(user, flag);
<a name="l00416"></a>00416         key.<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a48c690a8be456218139db243dd85897d">render_flag</a> = user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a55a5c7cefa1d8e69de06bca5b9dc8ed2">render_flag</a>;
<a name="l00417"></a>00417     }
<a name="l00418"></a>00418     <span class="keywordflow">else</span> {
<a name="l00419"></a>00419         key.<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a61c10a051cfbdc8047e8ebef4ecd34fb">proxy</a> = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40bf8eb133a4eebf0b19a25cf1cd68b9aed5cd6acdce80ab41093059cede0c494">IMB_PROXY_NONE</a>;
<a name="l00420"></a>00420         key.<a class="code" href="../../d1/d30/structMovieClipImBufCacheKey.html#a48c690a8be456218139db243dd85897d">render_flag</a> = 0;
<a name="l00421"></a>00421     }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     <a class="code" href="../../d0/dc9/IMB__moviecache_8h.html#a7452bedb9b43b5c38288bb99509ccb2c">IMB_moviecache_put</a>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#aedb09ce841aa4995afe94dec6a9da9ce">moviecache</a>, &amp;key, ibuf);
<a name="l00424"></a>00424 }
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 <span class="comment">/*********************** common functions *************************/</span>
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 <span class="comment">/* only image block itself */</span>
<a name="l00429"></a><a class="code" href="../../d5/d84/movieclip_8c.html#aa878ed896eb2dfb52b62bbe1372a14aa">00429</a> <span class="keyword">static</span> <a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *<a class="code" href="../../d5/d84/movieclip_8c.html#aa878ed896eb2dfb52b62bbe1372a14aa">movieclip_alloc</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l00430"></a>00430 {
<a name="l00431"></a>00431     <a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip;
<a name="l00432"></a>00432 
<a name="l00433"></a>00433     clip = <a class="code" href="../../d8/db1/BKE__library_8h.html#a0856c5e10e28cbe0b45eb00363bf8fb5">alloc_libblock</a>(&amp;<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;movieclip, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a7f8c4173f43796897d92d5c2ac8ec697">ID_MC</a>, name);
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ac71a4ef10a1ee3891dfb6bf6efbd38d7">aspx</a> = clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a5ed433e9da49af20b98b40d6d460b03a">aspy</a>= 1.0f;
<a name="l00436"></a>00436 
<a name="l00437"></a>00437     <a class="code" href="../../da/d72/BKE__tracking_8h.html#ae91b779bb4cf677956978ee8f5280751">BKE_tracking_init_settings</a>(&amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a93ac999acdd83124032266a3128d8adc">proxy</a>.<a class="code" href="../../d6/dc8/structMovieClipProxy.html#acf763c2af49e997d3cbca94ac29413a1">build_size_flag</a> = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40bf8eb133a4eebf0b19a25cf1cd68b9ae37bc65ce8665eb2ed8b7c4c7f62a5c1">IMB_PROXY_25</a>;
<a name="l00440"></a>00440     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a93ac999acdd83124032266a3128d8adc">proxy</a>.<a class="code" href="../../d6/dc8/structMovieClipProxy.html#a344b52a7078bcb6d5efb3638dcad54d1">build_tc_flag</a> = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#aff5caa59b0951e087034606a3c6e9f1cafd4bc8417b7f6bce9b94c63008b268bd">IMB_TC_RECORD_RUN</a> |
<a name="l00441"></a>00441                                 <a class="code" href="../../db/d49/IMB__imbuf_8h.html#aff5caa59b0951e087034606a3c6e9f1caf970abe0aba31c001a91573f180e86ac">IMB_TC_FREE_RUN</a> |
<a name="l00442"></a>00442                                 <a class="code" href="../../db/d49/IMB__imbuf_8h.html#aff5caa59b0951e087034606a3c6e9f1ca08fdea61b9e1cf9f3aafb06e4e990637">IMB_TC_INTERPOLATED_REC_DATE_FREE_RUN</a> |
<a name="l00443"></a>00443                                 <a class="code" href="../../db/d49/IMB__imbuf_8h.html#aff5caa59b0951e087034606a3c6e9f1ca1dffbb864c697c616e1e8c5508fa7b7a">IMB_TC_RECORD_RUN_NO_GAPS</a>;
<a name="l00444"></a>00444     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a93ac999acdd83124032266a3128d8adc">proxy</a>.<a class="code" href="../../d6/dc8/structMovieClipProxy.html#aae85a2ae52d33d27191e78b88ea10544">quality</a> = 90;
<a name="l00445"></a>00445 
<a name="l00446"></a>00446     <span class="keywordflow">return</span> clip;
<a name="l00447"></a>00447 }
<a name="l00448"></a>00448 
<a name="l00449"></a>00449 <span class="comment">/* checks if image was already loaded, then returns same image</span>
<a name="l00450"></a>00450 <span class="comment"> * otherwise creates new.</span>
<a name="l00451"></a>00451 <span class="comment"> * does not load ibuf itself</span>
<a name="l00452"></a>00452 <span class="comment"> * pass on optional frame for #name images */</span>
<a name="l00453"></a><a class="code" href="../../d5/d84/movieclip_8c.html#ae297bc13fee6ffd98ba58eaca050a811">00453</a> <a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *<a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#ac1613bf8f825b55d89a5d66c329fc2fe">BKE_add_movieclip_file</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l00454"></a>00454 {
<a name="l00455"></a>00455     <a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip;
<a name="l00456"></a>00456     <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> user;
<a name="l00457"></a>00457     <span class="keywordtype">int</span> file, <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>, width, height;
<a name="l00458"></a>00458     <span class="keyword">const</span> <span class="keywordtype">char</span> *libname;
<a name="l00459"></a>00459     <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>], strtest[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l00460"></a>00460 
<a name="l00461"></a>00461     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(str, name, <span class="keyword">sizeof</span>(str));
<a name="l00462"></a>00462     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a779fd31715eb05e3322500e3426b03a2">BLI_path_abs</a>(str, <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name);
<a name="l00463"></a>00463 
<a name="l00464"></a>00464     <span class="comment">/* exists? */</span>
<a name="l00465"></a>00465     file = <a class="code" href="../../d2/d63/BLI__fileops_8h.html#a33346823641e2323fcf408264ceacaf2">BLI_open</a>(str, <a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a36fa9b2e726512bc17a7a6d3e39002be">O_BINARY</a>|O_RDONLY,0);
<a name="l00466"></a>00466     <span class="keywordflow">if</span> (file == -1)
<a name="l00467"></a>00467         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00468"></a>00468     close(file);
<a name="l00469"></a>00469 
<a name="l00470"></a>00470     <span class="comment">/* ** first search an identical clip ** */</span>
<a name="l00471"></a>00471     <span class="keywordflow">for</span> (clip = <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;movieclip.first; clip; clip = clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a51cceb766b47f21cbe774967b1d73b8f">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l00472"></a>00472         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(strtest, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a4d5df220f2acc5ba922f6395cb8ef72e">name</a>, <span class="keyword">sizeof</span>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a4d5df220f2acc5ba922f6395cb8ef72e">name</a>));
<a name="l00473"></a>00473         <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a779fd31715eb05e3322500e3426b03a2">BLI_path_abs</a>(strtest, <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;name);
<a name="l00474"></a>00474 
<a name="l00475"></a>00475         <span class="keywordflow">if</span> (strcmp(strtest, str) == 0) {
<a name="l00476"></a>00476             <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a4d5df220f2acc5ba922f6395cb8ef72e">name</a>, name, <span class="keyword">sizeof</span>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a4d5df220f2acc5ba922f6395cb8ef72e">name</a>));  <span class="comment">/* for stringcode */</span>
<a name="l00477"></a>00477             clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a51cceb766b47f21cbe774967b1d73b8f">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>++;  <span class="comment">/* officially should not, it doesn&#39;t link here! */</span>
<a name="l00478"></a>00478 
<a name="l00479"></a>00479             <span class="keywordflow">return</span> clip;
<a name="l00480"></a>00480         }
<a name="l00481"></a>00481     }
<a name="l00482"></a>00482 
<a name="l00483"></a>00483     <span class="comment">/* ** add new movieclip ** */</span>
<a name="l00484"></a>00484 
<a name="l00485"></a>00485     <span class="comment">/* create a short library name */</span>
<a name="l00486"></a>00486     len = <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(name);
<a name="l00487"></a>00487 
<a name="l00488"></a>00488     <span class="keywordflow">while</span> (len &gt; 0 &amp;&amp; name[len - 1] != <span class="charliteral">&#39;/&#39;</span> &amp;&amp; name[len - 1] != <span class="charliteral">&#39;\\&#39;</span>)
<a name="l00489"></a>00489         len--;
<a name="l00490"></a>00490     libname = name + <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l00491"></a>00491 
<a name="l00492"></a>00492     clip = <a class="code" href="../../d5/d84/movieclip_8c.html#aa878ed896eb2dfb52b62bbe1372a14aa">movieclip_alloc</a>(libname);
<a name="l00493"></a>00493     <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a4d5df220f2acc5ba922f6395cb8ef72e">name</a>, name, <span class="keyword">sizeof</span>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a4d5df220f2acc5ba922f6395cb8ef72e">name</a>));
<a name="l00494"></a>00494 
<a name="l00495"></a>00495     <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#aeeedac7b0ad04a708eb449dc6b7373c0">BLI_testextensie_array</a>(name, <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#a7c222800805dd4afcbc1691f38c66918">imb_ext_movie</a>))
<a name="l00496"></a>00496         clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a47c5d571a621c7cd81b374300f7b5dbb">source</a> = <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a37e46946680b151be78269381b3fbe21">MCLIP_SRC_MOVIE</a>;
<a name="l00497"></a>00497     <span class="keywordflow">else</span>
<a name="l00498"></a>00498         clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a47c5d571a621c7cd81b374300f7b5dbb">source</a> = <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a2f619ea33ee5a6afa9b4b160a16f84aa">MCLIP_SRC_SEQUENCE</a>;
<a name="l00499"></a>00499 
<a name="l00500"></a>00500     user.<a class="code" href="../../d8/dac/structMovieClipUser.html#a645bba5909762a5df052e903bfb00afb">framenr</a> = 1;
<a name="l00501"></a>00501     <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#a8a4175f34b2cac47fd4b35d530220a01">BKE_movieclip_get_size</a>(clip, &amp;user, &amp;width, &amp;height);
<a name="l00502"></a>00502     <span class="keywordflow">if</span> (width &amp;&amp; height) {
<a name="l00503"></a>00503         clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>.<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#a1ca8a041769c4d8eb6d2931470322941">principal</a>[0] = ((float)width) / 2.0f;
<a name="l00504"></a>00504         clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>.<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#a1ca8a041769c4d8eb6d2931470322941">principal</a>[1] = ((float)height) / 2.0f;
<a name="l00505"></a>00505 
<a name="l00506"></a>00506         clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>.<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#a7dedc9ab5a26cd7892460eea17b8fb8f">focal</a> = 24.0f * width / clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>.<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#a65ba33a89879f2c22a2876610d393d69">sensor_width</a>;
<a name="l00507"></a>00507     }
<a name="l00508"></a>00508 
<a name="l00509"></a>00509     <a class="code" href="../../d5/d84/movieclip_8c.html#a05bd99378ee9f28c74368e0740f96f9f">movieclip_calc_length</a>(clip);
<a name="l00510"></a>00510 
<a name="l00511"></a>00511     <span class="keywordflow">return</span> clip;
<a name="l00512"></a>00512 }
<a name="l00513"></a>00513 
<a name="l00514"></a><a class="code" href="../../d5/d84/movieclip_8c.html#adbd4781f6fa260f6ea779ab2307ed6ce">00514</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d84/movieclip_8c.html#adbd4781f6fa260f6ea779ab2307ed6ce">real_ibuf_size</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user, <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf, <span class="keywordtype">int</span> *width, <span class="keywordtype">int</span> *height)
<a name="l00515"></a>00515 {
<a name="l00516"></a>00516     *width = ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>;
<a name="l00517"></a>00517     *height = ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>;
<a name="l00518"></a>00518 
<a name="l00519"></a>00519     <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ac4b1eba68ec74a5715d7d15d57357190">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#afd859cc0303cbebcad0108bd3004ef1e">MCLIP_USE_PROXY</a>) {
<a name="l00520"></a>00520         <span class="keywordflow">switch</span>(user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#ae9aa9cc593facc98db4d5759e46cb754">render_size</a>) {
<a name="l00521"></a>00521             <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a6c02e6b5d98bba2f17b36df03cc6b009">MCLIP_PROXY_RENDER_SIZE_25</a>:
<a name="l00522"></a>00522                 (*width) *= 4;
<a name="l00523"></a>00523                 (*height) *= 4;
<a name="l00524"></a>00524                 <span class="keywordflow">break</span>;
<a name="l00525"></a>00525 
<a name="l00526"></a>00526             <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#ab5b3c9043d84e45912e05cd0042addbb">MCLIP_PROXY_RENDER_SIZE_50</a>:
<a name="l00527"></a>00527                 (*width) *= 2.0f;
<a name="l00528"></a>00528                 (*height) *= 2.0f;
<a name="l00529"></a>00529                 <span class="keywordflow">break</span>;
<a name="l00530"></a>00530 
<a name="l00531"></a>00531             <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a4d7851fa4dfffef1c22afe21a1ad85ab">MCLIP_PROXY_RENDER_SIZE_75</a>:
<a name="l00532"></a>00532                 *width = ((float)*width)*4.0f/3.0f;
<a name="l00533"></a>00533                 *height = ((float)*height)*4.0f/3.0f;
<a name="l00534"></a>00534                 <span class="keywordflow">break</span>;
<a name="l00535"></a>00535         }
<a name="l00536"></a>00536     }
<a name="l00537"></a>00537 }
<a name="l00538"></a>00538 
<a name="l00539"></a><a class="code" href="../../d5/d84/movieclip_8c.html#ab73af5517f6f27f7756c1ebbe8796a87">00539</a> <span class="keyword">static</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../d5/d84/movieclip_8c.html#ab73af5517f6f27f7756c1ebbe8796a87">get_undistorted_ibuf</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <span class="keyword">struct</span> <a class="code" href="../../d6/da4/structMovieDistortion.html">MovieDistortion</a> *distortion, <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf)
<a name="l00540"></a>00540 {
<a name="l00541"></a>00541     <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *undistibuf;
<a name="l00542"></a>00542 
<a name="l00543"></a>00543     <span class="comment">/* XXX: because of #27997 do not use float buffers to undistort,</span>
<a name="l00544"></a>00544 <span class="comment">     *      otherwise, undistorted proxy can be darker than it should */</span>
<a name="l00545"></a>00545     <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a0d2ec7ce9e9b8e094f31e6a4535ce8d3">imb_freerectfloatImBuf</a>(ibuf);
<a name="l00546"></a>00546 
<a name="l00547"></a>00547     <span class="keywordflow">if</span> (distortion)
<a name="l00548"></a>00548         undistibuf = <a class="code" href="../../da/d72/BKE__tracking_8h.html#a8c1d43b5c590e6bda3d7a025a18da357">BKE_tracking_distortion_exec</a>(distortion, &amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>, ibuf, ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>, ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>, 0.0f, 1);
<a name="l00549"></a>00549     <span class="keywordflow">else</span>
<a name="l00550"></a>00550         undistibuf = <a class="code" href="../../da/d72/BKE__tracking_8h.html#abd423fae3a6341d57339ceefe9256bc3">BKE_tracking_undistort</a>(&amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>, ibuf, ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>, ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>, 0.0f);
<a name="l00551"></a>00551 
<a name="l00552"></a>00552     <span class="keywordflow">if</span> (undistibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a6d4eb5ccd281567cfe05d561fbb6a833">userflags</a> &amp; <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#a92a02dd4555f75018da42d96eb8d150f">IB_RECT_INVALID</a>) {
<a name="l00553"></a>00553         ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a6d4eb5ccd281567cfe05d561fbb6a833">userflags</a> &amp;= ~<a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#a92a02dd4555f75018da42d96eb8d150f">IB_RECT_INVALID</a>;
<a name="l00554"></a>00554         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a3af34b4b5c6b91ddf5b872fcb9e2d66c">IMB_rect_from_float</a>(undistibuf);
<a name="l00555"></a>00555     }
<a name="l00556"></a>00556 
<a name="l00557"></a>00557     <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a226fb5e14b1905126cf30a6e7cba2498">IMB_scaleImBuf</a>(undistibuf, ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>, ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>);
<a name="l00558"></a>00558 
<a name="l00559"></a>00559     <span class="keywordflow">return</span> undistibuf;
<a name="l00560"></a>00560 }
<a name="l00561"></a>00561 
<a name="l00562"></a><a class="code" href="../../d5/d84/movieclip_8c.html#ab4349eadfe2f945e7aa5430eb08f660f">00562</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d84/movieclip_8c.html#ab4349eadfe2f945e7aa5430eb08f660f">need_undistortion_postprocess</a>(<a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user, <span class="keywordtype">int</span> flag)
<a name="l00563"></a>00563 {
<a name="l00564"></a>00564     <span class="keywordtype">int</span> result = 0;
<a name="l00565"></a>00565 
<a name="l00566"></a>00566     <span class="comment">/* only full undistorted render can be used as on-fly undistorting image */</span>
<a name="l00567"></a>00567     <span class="keywordflow">if</span> (flag &amp; <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#afd859cc0303cbebcad0108bd3004ef1e">MCLIP_USE_PROXY</a>) {
<a name="l00568"></a>00568         result |= (user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#ae9aa9cc593facc98db4d5759e46cb754">render_size</a> == <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a7aa419b2dcb03674e1546ff88882e320">MCLIP_PROXY_RENDER_SIZE_FULL</a>) &amp;&amp;
<a name="l00569"></a>00569                   (user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a55a5c7cefa1d8e69de06bca5b9dc8ed2">render_flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#aa67ed8fbe261bdc20282c168cbea692d">MCLIP_PROXY_RENDER_UNDISTORT</a>) != 0;
<a name="l00570"></a>00570     }
<a name="l00571"></a>00571 
<a name="l00572"></a>00572     <span class="keywordflow">return</span> result;
<a name="l00573"></a>00573 }
<a name="l00574"></a>00574 
<a name="l00575"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a4f564421aecfc87dd0487845452d2221">00575</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d84/movieclip_8c.html#a4f564421aecfc87dd0487845452d2221">need_postprocessed_frame</a>(<a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user, <span class="keywordtype">int</span> flag, <span class="keywordtype">int</span> postprocess_flag)
<a name="l00576"></a>00576 {
<a name="l00577"></a>00577     <span class="keywordtype">int</span> result = postprocess_flag;
<a name="l00578"></a>00578 
<a name="l00579"></a>00579     result |= <a class="code" href="../../d5/d84/movieclip_8c.html#ab4349eadfe2f945e7aa5430eb08f660f">need_undistortion_postprocess</a>(user, flag);
<a name="l00580"></a>00580 
<a name="l00581"></a>00581     <span class="keywordflow">return</span> result;
<a name="l00582"></a>00582 }
<a name="l00583"></a>00583 
<a name="l00584"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a76eae665a5b84de53d5cb883be4db812">00584</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d84/movieclip_8c.html#a76eae665a5b84de53d5cb883be4db812">check_undistortion_cache_flags</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip)
<a name="l00585"></a>00585 {
<a name="l00586"></a>00586     <a class="code" href="../../d0/dc5/structMovieClipCache.html">MovieClipCache</a> *cache = clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>;
<a name="l00587"></a>00587     <a class="code" href="../../df/d7b/structMovieTrackingCamera.html">MovieTrackingCamera</a> *camera = &amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>;
<a name="l00588"></a>00588 
<a name="l00589"></a>00589     <span class="comment">/* check for distortion model changes */</span>
<a name="l00590"></a>00590     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a9b1c3fb8b00d40f6dffea903069fd94a">equals_v2v2</a>(camera-&gt;<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#a1ca8a041769c4d8eb6d2931470322941">principal</a>, cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a4e5587353737842abfe830776796693b">principal</a>))
<a name="l00591"></a>00591         <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00592"></a>00592 
<a name="l00593"></a>00593     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a9dc4c60131bb140808b9c356ac956756">equals_v3v3</a>(&amp;camera-&gt;<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#a5548d214fc9a37738dff5cba61a2493c">k1</a>, &amp;cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a07d65be4f1f23ed9179a67a991f64ba9">k1</a>))
<a name="l00594"></a>00594         <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00595"></a>00595 
<a name="l00596"></a>00596     <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00597"></a>00597 }
<a name="l00598"></a>00598 
<a name="l00599"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a72f9acf8d63e0c0f308f8cc981f361ee">00599</a> <span class="keyword">static</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../d5/d84/movieclip_8c.html#a72f9acf8d63e0c0f308f8cc981f361ee">get_postprocessed_cached_frame</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user, <span class="keywordtype">int</span> flag, <span class="keywordtype">int</span> postprocess_flag)
<a name="l00600"></a>00600 {
<a name="l00601"></a>00601     <a class="code" href="../../d0/dc5/structMovieClipCache.html">MovieClipCache</a> *cache = clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>;
<a name="l00602"></a>00602     <span class="keywordtype">int</span> framenr = user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a645bba5909762a5df052e903bfb00afb">framenr</a>;
<a name="l00603"></a>00603     <span class="keywordtype">short</span> proxy = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40bf8eb133a4eebf0b19a25cf1cd68b9aed5cd6acdce80ab41093059cede0c494">IMB_PROXY_NONE</a>;
<a name="l00604"></a>00604     <span class="keywordtype">int</span> render_flag = 0;
<a name="l00605"></a>00605 
<a name="l00606"></a>00606     <span class="keywordflow">if</span> (flag &amp; <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#afd859cc0303cbebcad0108bd3004ef1e">MCLIP_USE_PROXY</a>) {
<a name="l00607"></a>00607         proxy = <a class="code" href="../../d5/d84/movieclip_8c.html#a43246249db5f56a6ebd0d317af3f41f5">rendersize_to_proxy</a>(user, flag);
<a name="l00608"></a>00608         render_flag = user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a55a5c7cefa1d8e69de06bca5b9dc8ed2">render_flag</a>;
<a name="l00609"></a>00609     }
<a name="l00610"></a>00610 
<a name="l00611"></a>00611     <span class="comment">/* no cache or no cached postprocessed image */</span>
<a name="l00612"></a>00612     <span class="keywordflow">if</span> (!clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a> || !clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a>)
<a name="l00613"></a>00613         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00614"></a>00614 
<a name="l00615"></a>00615     <span class="comment">/* postprocessing happened for other frame */</span>
<a name="l00616"></a>00616     <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#acc7a4732513b3f98c86b74ac89d1d26d">framenr</a> != framenr)
<a name="l00617"></a>00617         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00618"></a>00618 
<a name="l00619"></a>00619     <span class="comment">/* cached ibuf used different proxy settings */</span>
<a name="l00620"></a>00620     <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a37e429784bc6fb2fc4c0bfca7800160d">render_flag</a> != render_flag || cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#ad96a9a8f33852a29f150618ea6a72f36">proxy</a> != proxy)
<a name="l00621"></a>00621         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00622"></a>00622 
<a name="l00623"></a>00623     <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a7a95602a52715a7bff252fd9a2935399">flag</a> != postprocess_flag)
<a name="l00624"></a>00624         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00625"></a>00625 
<a name="l00626"></a>00626     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d84/movieclip_8c.html#ab4349eadfe2f945e7aa5430eb08f660f">need_undistortion_postprocess</a>(user, flag)) {
<a name="l00627"></a>00627         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d84/movieclip_8c.html#a76eae665a5b84de53d5cb883be4db812">check_undistortion_cache_flags</a>(clip))
<a name="l00628"></a>00628             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00629"></a>00629     }
<a name="l00630"></a>00630     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a69755fe7c8906fc187e1b38d6c7e110a">undistoriton_used</a>)
<a name="l00631"></a>00631         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00632"></a>00632 
<a name="l00633"></a>00633     <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a614be8e49bc3d0fdebca514258ac5dec">IMB_refImBuf</a>(cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a>);
<a name="l00634"></a>00634 
<a name="l00635"></a>00635     <span class="keywordflow">return</span> cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a>;
<a name="l00636"></a>00636 }
<a name="l00637"></a>00637 
<a name="l00638"></a><a class="code" href="../../d5/d84/movieclip_8c.html#afbad06abb89bb96f8df7de5601187903">00638</a> <span class="keyword">static</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../d5/d84/movieclip_8c.html#afbad06abb89bb96f8df7de5601187903">put_postprocessed_frame_to_cache</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user, <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf, <span class="keywordtype">int</span> flag, <span class="keywordtype">int</span> postprocess_flag)
<a name="l00639"></a>00639 {
<a name="l00640"></a>00640     <a class="code" href="../../d0/dc5/structMovieClipCache.html">MovieClipCache</a> *cache = clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>;
<a name="l00641"></a>00641     <a class="code" href="../../df/d7b/structMovieTrackingCamera.html">MovieTrackingCamera</a> *camera = &amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>;
<a name="l00642"></a>00642     <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *postproc_ibuf = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00643"></a>00643 
<a name="l00644"></a>00644     <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a>)
<a name="l00645"></a>00645         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40eceec0075863e55997a3fb210a18ae">IMB_freeImBuf</a>(cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a>);
<a name="l00646"></a>00646 
<a name="l00647"></a>00647     cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#acc7a4732513b3f98c86b74ac89d1d26d">framenr</a> = user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a645bba5909762a5df052e903bfb00afb">framenr</a>;
<a name="l00648"></a>00648     cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a7a95602a52715a7bff252fd9a2935399">flag</a> = postprocess_flag;
<a name="l00649"></a>00649 
<a name="l00650"></a>00650     <span class="keywordflow">if</span> (flag &amp; <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#afd859cc0303cbebcad0108bd3004ef1e">MCLIP_USE_PROXY</a>) {
<a name="l00651"></a>00651         cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#ad96a9a8f33852a29f150618ea6a72f36">proxy</a> = <a class="code" href="../../d5/d84/movieclip_8c.html#a43246249db5f56a6ebd0d317af3f41f5">rendersize_to_proxy</a>(user, flag);
<a name="l00652"></a>00652         cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a37e429784bc6fb2fc4c0bfca7800160d">render_flag</a> = user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a55a5c7cefa1d8e69de06bca5b9dc8ed2">render_flag</a>;
<a name="l00653"></a>00653     }
<a name="l00654"></a>00654     <span class="keywordflow">else</span> {
<a name="l00655"></a>00655         cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#ad96a9a8f33852a29f150618ea6a72f36">proxy</a> = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40bf8eb133a4eebf0b19a25cf1cd68b9aed5cd6acdce80ab41093059cede0c494">IMB_PROXY_NONE</a>;
<a name="l00656"></a>00656         cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a37e429784bc6fb2fc4c0bfca7800160d">render_flag</a> = 0;
<a name="l00657"></a>00657     }
<a name="l00658"></a>00658 
<a name="l00659"></a>00659     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d84/movieclip_8c.html#ab4349eadfe2f945e7aa5430eb08f660f">need_undistortion_postprocess</a>(user, flag)) {
<a name="l00660"></a>00660         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5e7a11335014e249bd70cea058cc22ed">copy_v2_v2</a>(cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a4e5587353737842abfe830776796693b">principal</a>, camera-&gt;<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#a1ca8a041769c4d8eb6d2931470322941">principal</a>);
<a name="l00661"></a>00661         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(&amp;cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a07d65be4f1f23ed9179a67a991f64ba9">k1</a>, &amp;camera-&gt;<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#a5548d214fc9a37738dff5cba61a2493c">k1</a>);
<a name="l00662"></a>00662         cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a69755fe7c8906fc187e1b38d6c7e110a">undistoriton_used</a> = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00663"></a>00663         postproc_ibuf= <a class="code" href="../../d5/d84/movieclip_8c.html#ab73af5517f6f27f7756c1ebbe8796a87">get_undistorted_ibuf</a>(clip, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ibuf);
<a name="l00664"></a>00664     }
<a name="l00665"></a>00665     <span class="keywordflow">else</span> {
<a name="l00666"></a>00666         cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a69755fe7c8906fc187e1b38d6c7e110a">undistoriton_used</a> = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00667"></a>00667     }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669     <span class="keywordflow">if</span> (postprocess_flag) {
<a name="l00670"></a>00670         <span class="keywordtype">int</span> disable_red   = postprocess_flag &amp; <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#abe5fb3fe50b84a8b11ebcf70c1b8d38b">MOVIECLIP_DISABLE_RED</a>,
<a name="l00671"></a>00671             disable_green = postprocess_flag &amp; <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#ada45ebafef3bac9974ac4887f084fe19">MOVIECLIP_DISABLE_GREEN</a>,
<a name="l00672"></a>00672             disable_blue  = postprocess_flag &amp; <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#ab8784d4814c95f5f854ae41181cbffc5">MOVIECLIP_DISABLE_BLUE</a>,
<a name="l00673"></a>00673             grayscale     = postprocess_flag &amp; <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#a921089296afb1ff45a417ad4b58385c6">MOVIECLIP_PREVIEW_GRAYSCALE</a>;
<a name="l00674"></a>00674 
<a name="l00675"></a>00675         <span class="keywordflow">if</span> (!postproc_ibuf)
<a name="l00676"></a>00676             postproc_ibuf = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a094bab2aa339f34922893e1d6d617c28">IMB_dupImBuf</a>(ibuf);
<a name="l00677"></a>00677 
<a name="l00678"></a>00678         <span class="keywordflow">if</span> (disable_red || disable_green || disable_blue || grayscale)
<a name="l00679"></a>00679             <a class="code" href="../../da/d72/BKE__tracking_8h.html#aadb1304303ff7e5cc5485c6167eb6c6e">BKE_tracking_disable_imbuf_channels</a>(postproc_ibuf, disable_red, disable_green, disable_blue, 1);
<a name="l00680"></a>00680     }
<a name="l00681"></a>00681 
<a name="l00682"></a>00682     <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a614be8e49bc3d0fdebca514258ac5dec">IMB_refImBuf</a>(postproc_ibuf);
<a name="l00683"></a>00683 
<a name="l00684"></a>00684     cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a> = postproc_ibuf;
<a name="l00685"></a>00685 
<a name="l00686"></a>00686     <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a>) {
<a name="l00687"></a>00687         <span class="comment">/* force stable buffer be re-calculated */</span>
<a name="l00688"></a>00688         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40eceec0075863e55997a3fb210a18ae">IMB_freeImBuf</a>(cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a>);
<a name="l00689"></a>00689         cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00690"></a>00690     }
<a name="l00691"></a>00691 
<a name="l00692"></a>00692     <span class="keywordflow">return</span> postproc_ibuf;
<a name="l00693"></a>00693 }
<a name="l00694"></a>00694 
<a name="l00695"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a76fd1e7d0c1bb149c07bc2d5ce71cbee">00695</a> <span class="keyword">static</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../d5/d84/movieclip_8c.html#a76fd1e7d0c1bb149c07bc2d5ce71cbee">movieclip_get_postprocessed_ibuf</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user, <span class="keywordtype">int</span> flag,
<a name="l00696"></a>00696                                                <span class="keywordtype">int</span> postprocess_flag, <span class="keywordtype">int</span> cache_flag)
<a name="l00697"></a>00697 {
<a name="l00698"></a>00698     <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00699"></a>00699     <span class="keywordtype">int</span> framenr = user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a645bba5909762a5df052e903bfb00afb">framenr</a>, need_postprocess = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00700"></a>00700 
<a name="l00701"></a>00701     <span class="comment">/* cache isn&#39;t threadsafe itself and also loading of movies</span>
<a name="l00702"></a>00702 <span class="comment">     * can&#39;t happen from concurent threads that&#39;s why we use lock here */</span>
<a name="l00703"></a>00703     <a class="code" href="../../df/dbb/BLI__threads_8h.html#aeb7fa826429971a6eb6074249ad39a0b">BLI_lock_thread</a>(<a class="code" href="../../df/dbb/BLI__threads_8h.html#a82b501872ede596ba9ec43030fd46fb8">LOCK_MOVIECLIP</a>);
<a name="l00704"></a>00704 
<a name="l00705"></a>00705     <span class="comment">/* try to obtain cached postprocessed frame first */</span>
<a name="l00706"></a>00706     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d84/movieclip_8c.html#a4f564421aecfc87dd0487845452d2221">need_postprocessed_frame</a>(user, flag, postprocess_flag)) {
<a name="l00707"></a>00707         ibuf= <a class="code" href="../../d5/d84/movieclip_8c.html#a72f9acf8d63e0c0f308f8cc981f361ee">get_postprocessed_cached_frame</a>(clip, user, flag, postprocess_flag);
<a name="l00708"></a>00708 
<a name="l00709"></a>00709         <span class="keywordflow">if</span> (!ibuf)
<a name="l00710"></a>00710             need_postprocess = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00711"></a>00711     }
<a name="l00712"></a>00712 
<a name="l00713"></a>00713     <span class="keywordflow">if</span> (!ibuf)
<a name="l00714"></a>00714         ibuf= <a class="code" href="../../d5/d84/movieclip_8c.html#a5b3e48383eb4e4941a4612a91d65bc9f">get_imbuf_cache</a>(clip, user, flag);
<a name="l00715"></a>00715 
<a name="l00716"></a>00716     <span class="keywordflow">if</span> (!ibuf) {
<a name="l00717"></a>00717         <span class="keywordtype">int</span> use_sequence = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00718"></a>00718 
<a name="l00719"></a>00719         <span class="comment">/* undistorted proxies for movies should be read as image sequence */</span>
<a name="l00720"></a>00720         use_sequence = (user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a55a5c7cefa1d8e69de06bca5b9dc8ed2">render_flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#aa67ed8fbe261bdc20282c168cbea692d">MCLIP_PROXY_RENDER_UNDISTORT</a>) &amp;&amp;
<a name="l00721"></a>00721                        (user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#ae9aa9cc593facc98db4d5759e46cb754">render_size</a> != <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a7aa419b2dcb03674e1546ff88882e320">MCLIP_PROXY_RENDER_SIZE_FULL</a>);
<a name="l00722"></a>00722 
<a name="l00723"></a>00723         <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a47c5d571a621c7cd81b374300f7b5dbb">source</a> == <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a2f619ea33ee5a6afa9b4b160a16f84aa">MCLIP_SRC_SEQUENCE</a> || use_sequence) {
<a name="l00724"></a>00724             ibuf = <a class="code" href="../../d5/d84/movieclip_8c.html#a3748c7b3dc8ceb8f2e66e95c6961fc14">movieclip_load_sequence_file</a>(clip, user, framenr, flag);
<a name="l00725"></a>00725         }
<a name="l00726"></a>00726         <span class="keywordflow">else</span> {
<a name="l00727"></a>00727             ibuf = <a class="code" href="../../d5/d84/movieclip_8c.html#aba6d56e0f21f4a6d8c1fccb385e6906b">movieclip_load_movie_file</a>(clip, user, framenr, flag);
<a name="l00728"></a>00728         }
<a name="l00729"></a>00729 
<a name="l00730"></a>00730         <span class="keywordflow">if</span> (ibuf &amp;&amp; (cache_flag &amp; <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#a3d5c70290d12e83cbb5e606ead6b226f">MOVIECLIP_CACHE_SKIP</a>) == 0)
<a name="l00731"></a>00731             <a class="code" href="../../d5/d84/movieclip_8c.html#af09bf6efa7b3f0adf11d55e41866fa09">put_imbuf_cache</a>(clip, user, ibuf, flag);
<a name="l00732"></a>00732     }
<a name="l00733"></a>00733 
<a name="l00734"></a>00734     <span class="keywordflow">if</span> (ibuf) {
<a name="l00735"></a>00735         clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0068525ec5559aabdfe0743f4b99cf93">lastframe</a> = framenr;
<a name="l00736"></a>00736         <a class="code" href="../../d5/d84/movieclip_8c.html#adbd4781f6fa260f6ea779ab2307ed6ce">real_ibuf_size</a>(clip, user, ibuf, &amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a630c71ebc400d141679428ad837cc1ce">lastsize</a>[0], &amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a630c71ebc400d141679428ad837cc1ce">lastsize</a>[1]);
<a name="l00737"></a>00737 
<a name="l00738"></a>00738         <span class="comment">/* postprocess frame and put to cache */</span>
<a name="l00739"></a>00739         <span class="keywordflow">if</span> (need_postprocess) {
<a name="l00740"></a>00740             <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *tmpibuf = ibuf;
<a name="l00741"></a>00741             ibuf = <a class="code" href="../../d5/d84/movieclip_8c.html#afbad06abb89bb96f8df7de5601187903">put_postprocessed_frame_to_cache</a>(clip, user, tmpibuf, flag, postprocess_flag);
<a name="l00742"></a>00742             <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40eceec0075863e55997a3fb210a18ae">IMB_freeImBuf</a>(tmpibuf);
<a name="l00743"></a>00743         }
<a name="l00744"></a>00744     }
<a name="l00745"></a>00745 
<a name="l00746"></a>00746     <a class="code" href="../../df/dbb/BLI__threads_8h.html#add77b383686cdf9514286b56e3c7939c">BLI_unlock_thread</a>(<a class="code" href="../../df/dbb/BLI__threads_8h.html#a82b501872ede596ba9ec43030fd46fb8">LOCK_MOVIECLIP</a>);
<a name="l00747"></a>00747 
<a name="l00748"></a>00748     <span class="keywordflow">return</span> ibuf;
<a name="l00749"></a>00749 }
<a name="l00750"></a>00750 
<a name="l00751"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a563edf4fddf413ae2abab5d14aa9d93c">00751</a> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#a8f77cec36c003927660d27501ca7f610">BKE_movieclip_get_ibuf</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user)
<a name="l00752"></a>00752 {
<a name="l00753"></a>00753     <span class="keywordflow">return</span> <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#a4720b4bd9ad7e5a66fd4526b7e4fecb1">BKE_movieclip_get_ibuf_flag</a>(clip, user, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ac4b1eba68ec74a5715d7d15d57357190">flag</a>, 0);
<a name="l00754"></a>00754 }
<a name="l00755"></a>00755 
<a name="l00756"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a43edcbc9e7eebdbfc183c909cdae6b17">00756</a> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#a4720b4bd9ad7e5a66fd4526b7e4fecb1">BKE_movieclip_get_ibuf_flag</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user, <span class="keywordtype">int</span> flag, <span class="keywordtype">int</span> cache_flag)
<a name="l00757"></a>00757 {
<a name="l00758"></a>00758     <span class="keywordflow">return</span> <a class="code" href="../../d5/d84/movieclip_8c.html#a76fd1e7d0c1bb149c07bc2d5ce71cbee">movieclip_get_postprocessed_ibuf</a>(clip, user, flag, 0, cache_flag);
<a name="l00759"></a>00759 }
<a name="l00760"></a>00760 
<a name="l00761"></a><a class="code" href="../../d5/d84/movieclip_8c.html#af9bc9b36470bf1c767ef8263cd5b54c2">00761</a> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#ad9380c29a65fd4f7947cacc2923c945f">BKE_movieclip_get_postprocessed_ibuf</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user, <span class="keywordtype">int</span> postprocess_flag)
<a name="l00762"></a>00762 {
<a name="l00763"></a>00763     <span class="keywordflow">return</span> <a class="code" href="../../d5/d84/movieclip_8c.html#a76fd1e7d0c1bb149c07bc2d5ce71cbee">movieclip_get_postprocessed_ibuf</a>(clip, user, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ac4b1eba68ec74a5715d7d15d57357190">flag</a>, postprocess_flag, 0);
<a name="l00764"></a>00764 }
<a name="l00765"></a>00765 
<a name="l00766"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a6a26ed2290487cfa0b807d1d6b89cae7">00766</a> <span class="keyword">static</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../d5/d84/movieclip_8c.html#a6a26ed2290487cfa0b807d1d6b89cae7">get_stable_cached_frame</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user, <span class="keywordtype">int</span> framenr, <span class="keywordtype">int</span> postprocess_flag)
<a name="l00767"></a>00767 {
<a name="l00768"></a>00768     <a class="code" href="../../d0/dc5/structMovieClipCache.html">MovieClipCache</a> *cache = clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>;
<a name="l00769"></a>00769     <a class="code" href="../../d9/ddb/structMovieTracking.html">MovieTracking</a> *tracking = &amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>;
<a name="l00770"></a>00770     <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *stableibuf;
<a name="l00771"></a>00771     <span class="keywordtype">float</span> tloc[2], tscale, tangle;
<a name="l00772"></a>00772     <span class="keywordtype">short</span> proxy = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40bf8eb133a4eebf0b19a25cf1cd68b9aed5cd6acdce80ab41093059cede0c494">IMB_PROXY_NONE</a>;
<a name="l00773"></a>00773     <span class="keywordtype">int</span> render_flag = 0;
<a name="l00774"></a>00774 
<a name="l00775"></a>00775     <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ac4b1eba68ec74a5715d7d15d57357190">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#afd859cc0303cbebcad0108bd3004ef1e">MCLIP_USE_PROXY</a>) {
<a name="l00776"></a>00776         proxy = <a class="code" href="../../d5/d84/movieclip_8c.html#a43246249db5f56a6ebd0d317af3f41f5">rendersize_to_proxy</a>(user, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ac4b1eba68ec74a5715d7d15d57357190">flag</a>);
<a name="l00777"></a>00777         render_flag = user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a55a5c7cefa1d8e69de06bca5b9dc8ed2">render_flag</a>;
<a name="l00778"></a>00778     }
<a name="l00779"></a>00779 
<a name="l00780"></a>00780     <span class="comment">/* there&#39;s no cached frame or it was calculated for another frame */</span>
<a name="l00781"></a>00781     <span class="keywordflow">if</span> (!cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a> || cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#acc7a4732513b3f98c86b74ac89d1d26d">framenr</a> != framenr)
<a name="l00782"></a>00782         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00783"></a>00783 
<a name="l00784"></a>00784     <span class="comment">/* cached ibuf used different proxy settings */</span>
<a name="l00785"></a>00785     <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a37e429784bc6fb2fc4c0bfca7800160d">render_flag</a> != render_flag || cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#ad96a9a8f33852a29f150618ea6a72f36">proxy</a> != proxy)
<a name="l00786"></a>00786         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00787"></a>00787 
<a name="l00788"></a>00788     <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a39d1f55676c5ab85acb83fc444e8479b">postprocess_flag</a> != postprocess_flag)
<a name="l00789"></a>00789         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00790"></a>00790 
<a name="l00791"></a>00791     <span class="comment">/* stabilization also depends on pixel aspect ratio */</span>
<a name="l00792"></a>00792     <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#aaeeef3d4a9b37e2511bb6b3c6a86d2ea">aspect</a> != tracking-&gt;<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>.<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#aff807f14ebd4dc9c7855d996745ea2eb">pixel_aspect</a>)
<a name="l00793"></a>00793         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00794"></a>00794 
<a name="l00795"></a>00795     <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a95ce1999fe557daad637f678322daa55">filter</a> != tracking-&gt;<a class="code" href="../../d9/ddb/structMovieTracking.html#ab5ac3e5dd2ce804822d65f691f6f114a">stabilization</a>.<a class="code" href="../../db/ddf/structMovieTrackingStabilization.html#aa31453fcd2503a7d435b73136c432bc2">filter</a>)
<a name="l00796"></a>00796         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00797"></a>00797 
<a name="l00798"></a>00798     stableibuf = cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a>;
<a name="l00799"></a>00799 
<a name="l00800"></a>00800     <a class="code" href="../../da/d72/BKE__tracking_8h.html#a5f65c729dff75494592668c3d3de3476">BKE_tracking_stabilization_data</a>(&amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>, framenr, stableibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>, stableibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>, tloc, &amp;tscale, &amp;tangle);
<a name="l00801"></a>00801 
<a name="l00802"></a>00802     <span class="comment">/* check for stabilization parameters */</span>
<a name="l00803"></a>00803     <span class="keywordflow">if</span> (tscale != cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a47b4963ef164a6f52ec8ae2eb5d547d3">scale</a> ||
<a name="l00804"></a>00804        tangle != cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#ad3b25895f495e28bb453d8e6aaa74629">angle</a> ||
<a name="l00805"></a>00805        !<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a9b1c3fb8b00d40f6dffea903069fd94a">equals_v2v2</a>(tloc, cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a210747decf802ef24cd9ce01b98d6e17">loc</a>))
<a name="l00806"></a>00806     {
<a name="l00807"></a>00807         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00808"></a>00808     }
<a name="l00809"></a>00809 
<a name="l00810"></a>00810     <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a614be8e49bc3d0fdebca514258ac5dec">IMB_refImBuf</a>(stableibuf);
<a name="l00811"></a>00811 
<a name="l00812"></a>00812     <span class="keywordflow">return</span> stableibuf;
<a name="l00813"></a>00813 }
<a name="l00814"></a>00814 
<a name="l00815"></a><a class="code" href="../../d5/d84/movieclip_8c.html#aab18e48b077c5d7ac3e46a289cceb0d0">00815</a> <span class="keyword">static</span> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../d5/d84/movieclip_8c.html#aab18e48b077c5d7ac3e46a289cceb0d0">put_stabilized_frame_to_cache</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user, <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf,
<a name="l00816"></a>00816                                             <span class="keywordtype">int</span> framenr, <span class="keywordtype">int</span> postprocess_flag)
<a name="l00817"></a>00817 {
<a name="l00818"></a>00818     <a class="code" href="../../d0/dc5/structMovieClipCache.html">MovieClipCache</a> *cache = clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>;
<a name="l00819"></a>00819     <a class="code" href="../../d9/ddb/structMovieTracking.html">MovieTracking</a> *tracking = &amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>;
<a name="l00820"></a>00820     <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *stableibuf;
<a name="l00821"></a>00821     <span class="keywordtype">float</span> tloc[2], tscale, tangle;
<a name="l00822"></a>00822 
<a name="l00823"></a>00823     <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a>)
<a name="l00824"></a>00824         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40eceec0075863e55997a3fb210a18ae">IMB_freeImBuf</a>(cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a>);
<a name="l00825"></a>00825 
<a name="l00826"></a>00826     stableibuf = <a class="code" href="../../da/d72/BKE__tracking_8h.html#a97aa73d806f6dc53148b7a4429479c33">BKE_tracking_stabilize</a>(&amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>, framenr, ibuf, tloc, &amp;tscale, &amp;tangle);
<a name="l00827"></a>00827 
<a name="l00828"></a>00828     cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a>= stableibuf;
<a name="l00829"></a>00829 
<a name="l00830"></a>00830     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5e7a11335014e249bd70cea058cc22ed">copy_v2_v2</a>(cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a210747decf802ef24cd9ce01b98d6e17">loc</a>, tloc);
<a name="l00831"></a>00831 
<a name="l00832"></a>00832     cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a47b4963ef164a6f52ec8ae2eb5d547d3">scale</a> = tscale;
<a name="l00833"></a>00833     cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#ad3b25895f495e28bb453d8e6aaa74629">angle</a> = tangle;
<a name="l00834"></a>00834     cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#acc7a4732513b3f98c86b74ac89d1d26d">framenr</a> = framenr;
<a name="l00835"></a>00835     cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#aaeeef3d4a9b37e2511bb6b3c6a86d2ea">aspect</a> = tracking-&gt;<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>.<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#aff807f14ebd4dc9c7855d996745ea2eb">pixel_aspect</a>;
<a name="l00836"></a>00836     cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a95ce1999fe557daad637f678322daa55">filter</a> = tracking-&gt;<a class="code" href="../../d9/ddb/structMovieTracking.html#ab5ac3e5dd2ce804822d65f691f6f114a">stabilization</a>.<a class="code" href="../../db/ddf/structMovieTrackingStabilization.html#aa31453fcd2503a7d435b73136c432bc2">filter</a>;
<a name="l00837"></a>00837 
<a name="l00838"></a>00838     <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ac4b1eba68ec74a5715d7d15d57357190">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#afd859cc0303cbebcad0108bd3004ef1e">MCLIP_USE_PROXY</a>) {
<a name="l00839"></a>00839         cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#ad96a9a8f33852a29f150618ea6a72f36">proxy</a> = <a class="code" href="../../d5/d84/movieclip_8c.html#a43246249db5f56a6ebd0d317af3f41f5">rendersize_to_proxy</a>(user, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ac4b1eba68ec74a5715d7d15d57357190">flag</a>);
<a name="l00840"></a>00840         cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a37e429784bc6fb2fc4c0bfca7800160d">render_flag</a> = user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a55a5c7cefa1d8e69de06bca5b9dc8ed2">render_flag</a>;
<a name="l00841"></a>00841     }
<a name="l00842"></a>00842     <span class="keywordflow">else</span> {
<a name="l00843"></a>00843         cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#ad96a9a8f33852a29f150618ea6a72f36">proxy</a> = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40bf8eb133a4eebf0b19a25cf1cd68b9aed5cd6acdce80ab41093059cede0c494">IMB_PROXY_NONE</a>;
<a name="l00844"></a>00844         cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a37e429784bc6fb2fc4c0bfca7800160d">render_flag</a> = 0;
<a name="l00845"></a>00845     }
<a name="l00846"></a>00846 
<a name="l00847"></a>00847     cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a39d1f55676c5ab85acb83fc444e8479b">postprocess_flag</a> = postprocess_flag;
<a name="l00848"></a>00848 
<a name="l00849"></a>00849     <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a614be8e49bc3d0fdebca514258ac5dec">IMB_refImBuf</a>(stableibuf);
<a name="l00850"></a>00850 
<a name="l00851"></a>00851     <span class="keywordflow">return</span> stableibuf;
<a name="l00852"></a>00852 }
<a name="l00853"></a>00853 
<a name="l00854"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a473e67f73d65b81f1a98d19ca093697c">00854</a> <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *<a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#ab70a984da5bdcd2ff938281a7a07334b">BKE_movieclip_get_stable_ibuf</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user, <span class="keywordtype">float</span> loc[2], <span class="keywordtype">float</span> *scale, <span class="keywordtype">float</span> *<a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>, <span class="keywordtype">int</span> postprocess_flag)
<a name="l00855"></a>00855 {
<a name="l00856"></a>00856     <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf, *stableibuf = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00857"></a>00857     <span class="keywordtype">int</span> framenr = user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a645bba5909762a5df052e903bfb00afb">framenr</a>;
<a name="l00858"></a>00858 
<a name="l00859"></a>00859     ibuf = <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#ad9380c29a65fd4f7947cacc2923c945f">BKE_movieclip_get_postprocessed_ibuf</a>(clip, user, postprocess_flag);
<a name="l00860"></a>00860 
<a name="l00861"></a>00861     <span class="keywordflow">if</span> (!ibuf)
<a name="l00862"></a>00862         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00863"></a>00863 
<a name="l00864"></a>00864     <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ab5ac3e5dd2ce804822d65f691f6f114a">stabilization</a>.<a class="code" href="../../db/ddf/structMovieTrackingStabilization.html#a9a717186c7355f33c0a20922fb0a6b4d">flag</a> &amp; <a class="code" href="../../d3/dd4/DNA__tracking__types_8h.html#a1a1e9450813ad36460c7abf720ce45df">TRACKING_2D_STABILIZATION</a>) {
<a name="l00865"></a>00865         <a class="code" href="../../d0/dc5/structMovieClipCache.html">MovieClipCache</a> *cache= clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>;
<a name="l00866"></a>00866 
<a name="l00867"></a>00867         stableibuf = <a class="code" href="../../d5/d84/movieclip_8c.html#a6a26ed2290487cfa0b807d1d6b89cae7">get_stable_cached_frame</a>(clip, user, framenr, postprocess_flag);
<a name="l00868"></a>00868 
<a name="l00869"></a>00869         <span class="keywordflow">if</span> (!stableibuf)
<a name="l00870"></a>00870             stableibuf = <a class="code" href="../../d5/d84/movieclip_8c.html#aab18e48b077c5d7ac3e46a289cceb0d0">put_stabilized_frame_to_cache</a>(clip, user, ibuf, framenr, postprocess_flag);
<a name="l00871"></a>00871 
<a name="l00872"></a>00872         <span class="keywordflow">if</span> (loc)
<a name="l00873"></a>00873             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5e7a11335014e249bd70cea058cc22ed">copy_v2_v2</a>(loc, cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a210747decf802ef24cd9ce01b98d6e17">loc</a>);
<a name="l00874"></a>00874 
<a name="l00875"></a>00875         <span class="keywordflow">if</span> (scale)
<a name="l00876"></a>00876             *scale= cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a47b4963ef164a6f52ec8ae2eb5d547d3">scale</a>;
<a name="l00877"></a>00877 
<a name="l00878"></a>00878         <span class="keywordflow">if</span> (angle)
<a name="l00879"></a>00879             *angle= cache-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#ad3b25895f495e28bb453d8e6aaa74629">angle</a>;
<a name="l00880"></a>00880     }
<a name="l00881"></a>00881     <span class="keywordflow">else</span> {
<a name="l00882"></a>00882         <span class="keywordflow">if</span> (loc)
<a name="l00883"></a>00883             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ab56b423771c4d41aa565151535978954">zero_v2</a>(loc);
<a name="l00884"></a>00884 
<a name="l00885"></a>00885         <span class="keywordflow">if</span> (scale)
<a name="l00886"></a>00886             *scale= 1.0f;
<a name="l00887"></a>00887 
<a name="l00888"></a>00888         <span class="keywordflow">if</span> (angle)
<a name="l00889"></a>00889             *angle= 0.0f;
<a name="l00890"></a>00890 
<a name="l00891"></a>00891         stableibuf = ibuf;
<a name="l00892"></a>00892     }
<a name="l00893"></a>00893 
<a name="l00894"></a>00894     <span class="keywordflow">if</span> (stableibuf != ibuf) {
<a name="l00895"></a>00895         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40eceec0075863e55997a3fb210a18ae">IMB_freeImBuf</a>(ibuf);
<a name="l00896"></a>00896         ibuf = stableibuf;
<a name="l00897"></a>00897     }
<a name="l00898"></a>00898 
<a name="l00899"></a>00899     <span class="keywordflow">return</span> ibuf;
<a name="l00900"></a>00900 
<a name="l00901"></a>00901 }
<a name="l00902"></a>00902 
<a name="l00903"></a><a class="code" href="../../d5/d84/movieclip_8c.html#aeba736b3a298ded9c9721ae998a49011">00903</a> <span class="keywordtype">int</span> <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#aef10acdba2e3f86616fb9c74dd36ab7a">BKE_movieclip_has_frame</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user)
<a name="l00904"></a>00904 {
<a name="l00905"></a>00905     <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf = <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#a8f77cec36c003927660d27501ca7f610">BKE_movieclip_get_ibuf</a>(clip, user);
<a name="l00906"></a>00906 
<a name="l00907"></a>00907     <span class="keywordflow">if</span> (ibuf) {
<a name="l00908"></a>00908         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40eceec0075863e55997a3fb210a18ae">IMB_freeImBuf</a>(ibuf);
<a name="l00909"></a>00909         <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00910"></a>00910     }
<a name="l00911"></a>00911 
<a name="l00912"></a>00912     <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00913"></a>00913 }
<a name="l00914"></a>00914 
<a name="l00915"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a7540c502592997d03b71b1f49d32b4dd">00915</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#a8a4175f34b2cac47fd4b35d530220a01">BKE_movieclip_get_size</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user, <span class="keywordtype">int</span> *width, <span class="keywordtype">int</span> *height)
<a name="l00916"></a>00916 {
<a name="l00917"></a>00917     <span class="keywordflow">if</span> (user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a645bba5909762a5df052e903bfb00afb">framenr</a> == clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0068525ec5559aabdfe0743f4b99cf93">lastframe</a>) {
<a name="l00918"></a>00918         *width = clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a630c71ebc400d141679428ad837cc1ce">lastsize</a>[0];
<a name="l00919"></a>00919         *height = clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a630c71ebc400d141679428ad837cc1ce">lastsize</a>[1];
<a name="l00920"></a>00920     }
<a name="l00921"></a>00921     <span class="keywordflow">else</span> {
<a name="l00922"></a>00922         <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf = <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#a8f77cec36c003927660d27501ca7f610">BKE_movieclip_get_ibuf</a>(clip, user);
<a name="l00923"></a>00923 
<a name="l00924"></a>00924         <span class="keywordflow">if</span> (ibuf &amp;&amp; ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> &amp;&amp; ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>) {
<a name="l00925"></a>00925             <a class="code" href="../../d5/d84/movieclip_8c.html#adbd4781f6fa260f6ea779ab2307ed6ce">real_ibuf_size</a>(clip, user, ibuf, width, height);
<a name="l00926"></a>00926         }
<a name="l00927"></a>00927         <span class="keywordflow">else</span> {
<a name="l00928"></a>00928             *width = 0;
<a name="l00929"></a>00929             *height = 0;
<a name="l00930"></a>00930         }
<a name="l00931"></a>00931 
<a name="l00932"></a>00932         <span class="keywordflow">if</span> (ibuf)
<a name="l00933"></a>00933             <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40eceec0075863e55997a3fb210a18ae">IMB_freeImBuf</a>(ibuf);
<a name="l00934"></a>00934     }
<a name="l00935"></a>00935 }
<a name="l00936"></a>00936 
<a name="l00937"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a9ac04682b5a55d469ea37bb6dd32cb3f">00937</a> <span class="keywordtype">int</span> <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#a7640a97cc5b9f7d16c998ec8f437f5f7">BKE_movieclip_get_duration</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip)
<a name="l00938"></a>00938 {
<a name="l00939"></a>00939     <span class="keywordflow">if</span> (!clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#aee81e17befb0ce63b5c8b7d1f18b49e6">len</a>) {
<a name="l00940"></a>00940         <a class="code" href="../../d5/d84/movieclip_8c.html#a05bd99378ee9f28c74368e0740f96f9f">movieclip_calc_length</a>(clip);
<a name="l00941"></a>00941     }
<a name="l00942"></a>00942 
<a name="l00943"></a>00943     <span class="keywordflow">return</span> clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#aee81e17befb0ce63b5c8b7d1f18b49e6">len</a>;
<a name="l00944"></a>00944 }
<a name="l00945"></a>00945 
<a name="l00946"></a><a class="code" href="../../d5/d84/movieclip_8c.html#aa4af2e5fad91d0cf5dc4f068b515dbdb">00946</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#a3b5f8db283bf030dc1b35861104c87aa">BKE_movieclip_aspect</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <span class="keywordtype">float</span> *aspx, <span class="keywordtype">float</span> *aspy)
<a name="l00947"></a>00947 {
<a name="l00948"></a>00948     *aspx = *aspy = 1.0;
<a name="l00949"></a>00949 
<a name="l00950"></a>00950     <span class="comment">/* x is always 1 */</span>
<a name="l00951"></a>00951     *aspy = clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a5ed433e9da49af20b98b40d6d460b03a">aspy</a> / clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ac71a4ef10a1ee3891dfb6bf6efbd38d7">aspx</a> / clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>.<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#aff807f14ebd4dc9c7855d996745ea2eb">pixel_aspect</a>;
<a name="l00952"></a>00952 }
<a name="l00953"></a>00953 
<a name="l00954"></a>00954 <span class="comment">/* get segments of cached frames. useful for debugging cache policies */</span>
<a name="l00955"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a460bf67444f5aad28efd693ed1d05c3e">00955</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#ac9e9efe4ccdf0a2a265d0c252b98a4dd">BKE_movieclip_get_cache_segments</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user, <span class="keywordtype">int</span> *totseg_r, <span class="keywordtype">int</span> **points_r)
<a name="l00956"></a>00956 {
<a name="l00957"></a>00957     *totseg_r = 0;
<a name="l00958"></a>00958     *points_r = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00959"></a>00959 
<a name="l00960"></a>00960     <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>) {
<a name="l00961"></a>00961         <span class="keywordtype">int</span> proxy = <a class="code" href="../../d5/d84/movieclip_8c.html#a43246249db5f56a6ebd0d317af3f41f5">rendersize_to_proxy</a>(user, clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ac4b1eba68ec74a5715d7d15d57357190">flag</a>);
<a name="l00962"></a>00962 
<a name="l00963"></a>00963         <a class="code" href="../../d0/dc9/IMB__moviecache_8h.html#a35a6f845963a51f0c99fd9c8d5e4c97b">IMB_moviecache_get_cache_segments</a>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#aedb09ce841aa4995afe94dec6a9da9ce">moviecache</a>, proxy, user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a55a5c7cefa1d8e69de06bca5b9dc8ed2">render_flag</a>, totseg_r, points_r);
<a name="l00964"></a>00964     }
<a name="l00965"></a>00965 }
<a name="l00966"></a>00966 
<a name="l00967"></a><a class="code" href="../../d5/d84/movieclip_8c.html#ad95ea52ed1aa6df6fa9f301dfe0e5af0">00967</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#a48e73a7c78eb9b4fe5072c5030ee0b5e">BKE_movieclip_user_set_frame</a>(<a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *iuser, <span class="keywordtype">int</span> framenr)
<a name="l00968"></a>00968 {
<a name="l00969"></a>00969     <span class="comment">/* TODO: clamp framenr here? */</span>
<a name="l00970"></a>00970 
<a name="l00971"></a>00971     iuser-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a645bba5909762a5df052e903bfb00afb">framenr</a> = framenr;
<a name="l00972"></a>00972 }
<a name="l00973"></a>00973 
<a name="l00974"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a3a877b1df54f8e70c495fc4564ba714f">00974</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d84/movieclip_8c.html#a3a877b1df54f8e70c495fc4564ba714f">free_buffers</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip)
<a name="l00975"></a>00975 {
<a name="l00976"></a>00976     <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>) {
<a name="l00977"></a>00977         <a class="code" href="../../d0/dc9/IMB__moviecache_8h.html#a802c08442c3cc15972518bb5428f2430">IMB_moviecache_free</a>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#aedb09ce841aa4995afe94dec6a9da9ce">moviecache</a>);
<a name="l00978"></a>00978 
<a name="l00979"></a>00979         <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a>)
<a name="l00980"></a>00980             <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40eceec0075863e55997a3fb210a18ae">IMB_freeImBuf</a>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a43890362f41ab59df75c63dc6e161e2c">postprocessed</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a>);
<a name="l00981"></a>00981 
<a name="l00982"></a>00982         <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a>)
<a name="l00983"></a>00983             <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40eceec0075863e55997a3fb210a18ae">IMB_freeImBuf</a>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>-&gt;<a class="code" href="../../d0/dc5/structMovieClipCache.html#a253a145ef891fd7f4f89fe428701ca7a">stabilized</a>.<a class="code" href="../../d0/dc5/structMovieClipCache.html#a31684a4f902afd5902c9f92955c93756">ibuf</a>);
<a name="l00984"></a>00984 
<a name="l00985"></a>00985         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a>);
<a name="l00986"></a>00986         clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a0f07ab2f8a9ed6426e8f0c754f82c0ea">cache</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00987"></a>00987     }
<a name="l00988"></a>00988 
<a name="l00989"></a>00989     <span class="keywordflow">if</span> (clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a8f8a62b9b886e5442655c193ff1c9dfa">anim</a>) {
<a name="l00990"></a>00990         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a26badb7e7f07e5f747cfceca2ebbb3c7">IMB_free_anim</a>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a8f8a62b9b886e5442655c193ff1c9dfa">anim</a>);
<a name="l00991"></a>00991         clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a8f8a62b9b886e5442655c193ff1c9dfa">anim</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00992"></a>00992     }
<a name="l00993"></a>00993 
<a name="l00994"></a>00994     <a class="code" href="../../dc/d51/BKE__animsys_8h.html#a186ce67df8bf9873cc945eed480eaa49">BKE_free_animdata</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *) clip);
<a name="l00995"></a>00995 }
<a name="l00996"></a>00996 
<a name="l00997"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a5b8029525f65a9ce3f4f9377df8169aa">00997</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#a580dd6993d5526cb6c409348af5c1b8a">BKE_movieclip_reload</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip)
<a name="l00998"></a>00998 {
<a name="l00999"></a>00999     <span class="comment">/* clear cache */</span>
<a name="l01000"></a>01000     <a class="code" href="../../d5/d84/movieclip_8c.html#a3a877b1df54f8e70c495fc4564ba714f">free_buffers</a>(clip);
<a name="l01001"></a>01001 
<a name="l01002"></a>01002     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ab5ac3e5dd2ce804822d65f691f6f114a">stabilization</a>.<a class="code" href="../../db/ddf/structMovieTrackingStabilization.html#af45dd7955027c6f892e7f1ad15ffdc9a">ok</a> = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01003"></a>01003 
<a name="l01004"></a>01004     <span class="comment">/* update clip source */</span>
<a name="l01005"></a>01005     <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#aeeedac7b0ad04a708eb449dc6b7373c0">BLI_testextensie_array</a>(clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a4d5df220f2acc5ba922f6395cb8ef72e">name</a>, <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#a7c222800805dd4afcbc1691f38c66918">imb_ext_movie</a>))
<a name="l01006"></a>01006         clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a47c5d571a621c7cd81b374300f7b5dbb">source</a> = <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a37e46946680b151be78269381b3fbe21">MCLIP_SRC_MOVIE</a>;
<a name="l01007"></a>01007     <span class="keywordflow">else</span>
<a name="l01008"></a>01008         clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a47c5d571a621c7cd81b374300f7b5dbb">source</a> = <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a2f619ea33ee5a6afa9b4b160a16f84aa">MCLIP_SRC_SEQUENCE</a>;
<a name="l01009"></a>01009 
<a name="l01010"></a>01010     <a class="code" href="../../d5/d84/movieclip_8c.html#a05bd99378ee9f28c74368e0740f96f9f">movieclip_calc_length</a>(clip);
<a name="l01011"></a>01011 }
<a name="l01012"></a>01012 
<a name="l01013"></a><a class="code" href="../../d5/d84/movieclip_8c.html#aa2ec1ea80e1b6f96bbcfea64b4a72550">01013</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#ab4a826763661d37e749e5d6866afd58c">BKE_movieclip_update_scopes</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> *user, <a class="code" href="../../d5/d2c/structMovieClipScopes.html">MovieClipScopes</a> *scopes)
<a name="l01014"></a>01014 {
<a name="l01015"></a>01015     <span class="keywordflow">if</span> (scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#af834ede6aa0952be7e023c2a36cf8b0d">ok</a>)
<a name="l01016"></a>01016         <span class="keywordflow">return</span>;
<a name="l01017"></a>01017 
<a name="l01018"></a>01018     <span class="keywordflow">if</span> (scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#a3b99ae69511066325d03727aa3423c01">track_preview</a>) {
<a name="l01019"></a>01019         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40eceec0075863e55997a3fb210a18ae">IMB_freeImBuf</a>(scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#a3b99ae69511066325d03727aa3423c01">track_preview</a>);
<a name="l01020"></a>01020         scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#a3b99ae69511066325d03727aa3423c01">track_preview</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01021"></a>01021     }
<a name="l01022"></a>01022 
<a name="l01023"></a>01023     scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#ac94cc74981a319792a92d46f627f0fbb">marker</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01024"></a>01024     scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#af476e7cd59b61e8ad7417e407480b6af">track</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01025"></a>01025 
<a name="l01026"></a>01026     <span class="keywordflow">if</span> (clip) {
<a name="l01027"></a>01027         <a class="code" href="../../da/d5f/structMovieTrackingTrack.html">MovieTrackingTrack</a> *act_track = <a class="code" href="../../da/d72/BKE__tracking_8h.html#a8f9e672798114ca61c2b66776bf4a6c8">BKE_tracking_active_track</a>(&amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>);
<a name="l01028"></a>01028 
<a name="l01029"></a>01029         <span class="keywordflow">if</span> (act_track) {
<a name="l01030"></a>01030             <a class="code" href="../../da/d5f/structMovieTrackingTrack.html">MovieTrackingTrack</a> *track = act_track;
<a name="l01031"></a>01031             <a class="code" href="../../d2/d75/structMovieTrackingMarker.html">MovieTrackingMarker</a> *marker = <a class="code" href="../../da/d72/BKE__tracking_8h.html#ad5dea623719f25d453310a97ee138b6f">BKE_tracking_get_marker</a>(track, user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a645bba5909762a5df052e903bfb00afb">framenr</a>);
<a name="l01032"></a>01032 
<a name="l01033"></a>01033             <span class="keywordflow">if</span> (marker-&gt;<a class="code" href="../../d2/d75/structMovieTrackingMarker.html#a6bf7281cddce79f77edb8e48d58a5973">flag</a> &amp; <a class="code" href="../../d3/dd4/DNA__tracking__types_8h.html#a90fb842f2f7efe62795eff3853df39ba">MARKER_DISABLED</a>) {
<a name="l01034"></a>01034                 scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#abda63626f823626fd4c5ddf3068b3507">track_disabled</a> = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01035"></a>01035             }
<a name="l01036"></a>01036             <span class="keywordflow">else</span> {
<a name="l01037"></a>01037                 <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf = <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#a8f77cec36c003927660d27501ca7f610">BKE_movieclip_get_ibuf</a>(clip, user);
<a name="l01038"></a>01038 
<a name="l01039"></a>01039                 scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#abda63626f823626fd4c5ddf3068b3507">track_disabled</a> = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01040"></a>01040 
<a name="l01041"></a>01041                 <span class="keywordflow">if</span> (ibuf &amp;&amp; ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>) {
<a name="l01042"></a>01042                     <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *tmpibuf;
<a name="l01043"></a>01043                     <a class="code" href="../../d2/d75/structMovieTrackingMarker.html">MovieTrackingMarker</a> undist_marker = *marker;
<a name="l01044"></a>01044 
<a name="l01045"></a>01045                     <span class="keywordflow">if</span> (user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a55a5c7cefa1d8e69de06bca5b9dc8ed2">render_flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#aa67ed8fbe261bdc20282c168cbea692d">MCLIP_PROXY_RENDER_UNDISTORT</a>) {
<a name="l01046"></a>01046                         <span class="keywordtype">int</span> width, height;
<a name="l01047"></a>01047                         <span class="keywordtype">float</span> aspy= 1.0f / clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>.<a class="code" href="../../d9/ddb/structMovieTracking.html#ade9814b7982abc95b2e2d63798f7487e">camera</a>.<a class="code" href="../../df/d7b/structMovieTrackingCamera.html#aff807f14ebd4dc9c7855d996745ea2eb">pixel_aspect</a>;
<a name="l01048"></a>01048 
<a name="l01049"></a>01049                         <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#a8a4175f34b2cac47fd4b35d530220a01">BKE_movieclip_get_size</a>(clip, user, &amp;width, &amp;height);
<a name="l01050"></a>01050 
<a name="l01051"></a>01051                         undist_marker.<a class="code" href="../../d2/d75/structMovieTrackingMarker.html#a77909423cde0f8a5b52779c8897bb654">pos</a>[0] *= width;
<a name="l01052"></a>01052                         undist_marker.<a class="code" href="../../d2/d75/structMovieTrackingMarker.html#a77909423cde0f8a5b52779c8897bb654">pos</a>[1] *= height*aspy;
<a name="l01053"></a>01053 
<a name="l01054"></a>01054                         <a class="code" href="../../da/d72/BKE__tracking_8h.html#ae053067dcbc1a132eec77ca007977ce3">BKE_tracking_invert_intrinsics</a>(&amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>, undist_marker.<a class="code" href="../../d2/d75/structMovieTrackingMarker.html#a77909423cde0f8a5b52779c8897bb654">pos</a>, undist_marker.<a class="code" href="../../d2/d75/structMovieTrackingMarker.html#a77909423cde0f8a5b52779c8897bb654">pos</a>);
<a name="l01055"></a>01055 
<a name="l01056"></a>01056                         undist_marker.<a class="code" href="../../d2/d75/structMovieTrackingMarker.html#a77909423cde0f8a5b52779c8897bb654">pos</a>[0] /= width;
<a name="l01057"></a>01057                         undist_marker.<a class="code" href="../../d2/d75/structMovieTrackingMarker.html#a77909423cde0f8a5b52779c8897bb654">pos</a>[1] /= height*aspy;
<a name="l01058"></a>01058                     }
<a name="l01059"></a>01059 
<a name="l01060"></a>01060                     <span class="comment">/* NOTE: margin should be kept in sync with value from ui_draw_but_TRACKPREVIEW */</span>
<a name="l01061"></a>01061                     tmpibuf= <a class="code" href="../../da/d72/BKE__tracking_8h.html#ab826ecac4abe321781b77d1e3c1082d0">BKE_tracking_get_pattern_imbuf</a>(ibuf, track, &amp;undist_marker, 3 <span class="comment">/* margin */</span>,
<a name="l01062"></a>01062                             1 <span class="comment">/* anchor */</span>, scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#a6304e1b891bbdeda1d365004e4c8e129">track_pos</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01063"></a>01063 
<a name="l01064"></a>01064                     <span class="keywordflow">if</span> (tmpibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>)
<a name="l01065"></a>01065                         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a3af34b4b5c6b91ddf5b872fcb9e2d66c">IMB_rect_from_float</a>(tmpibuf);
<a name="l01066"></a>01066 
<a name="l01067"></a>01067                     <span class="keywordflow">if</span> (tmpibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>)
<a name="l01068"></a>01068                         scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#a3b99ae69511066325d03727aa3423c01">track_preview</a>= tmpibuf;
<a name="l01069"></a>01069                     <span class="keywordflow">else</span>
<a name="l01070"></a>01070                         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40eceec0075863e55997a3fb210a18ae">IMB_freeImBuf</a>(tmpibuf);
<a name="l01071"></a>01071                 }
<a name="l01072"></a>01072 
<a name="l01073"></a>01073                 <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40eceec0075863e55997a3fb210a18ae">IMB_freeImBuf</a>(ibuf);
<a name="l01074"></a>01074             }
<a name="l01075"></a>01075 
<a name="l01076"></a>01076             <span class="keywordflow">if</span> ((track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a71bf96554b319d35bd7c5570c261ba9a">flag</a> &amp; <a class="code" href="../../d3/dd4/DNA__tracking__types_8h.html#a49f735da8b3ad3c977403a791df82088">TRACK_LOCKED</a>)==0) {
<a name="l01077"></a>01077                 scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#ac94cc74981a319792a92d46f627f0fbb">marker</a> = marker;
<a name="l01078"></a>01078                 scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#af476e7cd59b61e8ad7417e407480b6af">track</a> = track;
<a name="l01079"></a>01079                 scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#a2bd828a80e1eb7449c10117087d5e1a6">slide_scale</a>[0] = track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#ac1a4d3e8768f8001d6401b113fa87c98">pat_max</a>[0]-track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a75e3bf61886d823eb3f4a5d6971269cb">pat_min</a>[0];
<a name="l01080"></a>01080                 scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#a2bd828a80e1eb7449c10117087d5e1a6">slide_scale</a>[1] = track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#ac1a4d3e8768f8001d6401b113fa87c98">pat_max</a>[1]-track-&gt;<a class="code" href="../../da/d5f/structMovieTrackingTrack.html#a75e3bf61886d823eb3f4a5d6971269cb">pat_min</a>[1];
<a name="l01081"></a>01081             }
<a name="l01082"></a>01082         }
<a name="l01083"></a>01083     }
<a name="l01084"></a>01084 
<a name="l01085"></a>01085     scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#a9babf14cf4d0967c4f5bfda678cd8750">framenr</a> = user-&gt;<a class="code" href="../../d8/dac/structMovieClipUser.html#a645bba5909762a5df052e903bfb00afb">framenr</a>;
<a name="l01086"></a>01086     scopes-&gt;<a class="code" href="../../d5/d2c/structMovieClipScopes.html#af834ede6aa0952be7e023c2a36cf8b0d">ok</a> = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01087"></a>01087 }
<a name="l01088"></a>01088 
<a name="l01089"></a><a class="code" href="../../d5/d84/movieclip_8c.html#adb912256dd1f0f1f9286a858fbb0941a">01089</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d84/movieclip_8c.html#adb912256dd1f0f1f9286a858fbb0941a">movieclip_build_proxy_ibuf</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf, <span class="keywordtype">int</span> cfra, <span class="keywordtype">int</span> proxy_render_size, <span class="keywordtype">int</span> undistorted)
<a name="l01090"></a>01090 {
<a name="l01091"></a>01091     <span class="keywordtype">char</span> name[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l01092"></a>01092     <span class="keywordtype">int</span> quality, rectx, recty;
<a name="l01093"></a>01093     <span class="keywordtype">int</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a> = <a class="code" href="../../d5/d84/movieclip_8c.html#aca0bce307900633b028ac9adf3ee8e80">rendersize_to_number</a>(proxy_render_size);
<a name="l01094"></a>01094     <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *scaleibuf;
<a name="l01095"></a>01095 
<a name="l01096"></a>01096     <a class="code" href="../../d5/d84/movieclip_8c.html#aa06f33251bf8ca100f2d803d5b7c9f93">get_proxy_fname</a>(clip, proxy_render_size, undistorted, cfra, name);
<a name="l01097"></a>01097 
<a name="l01098"></a>01098     rectx = ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> * size / 100.0f;
<a name="l01099"></a>01099     recty = ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> * size / 100.0f;
<a name="l01100"></a>01100 
<a name="l01101"></a>01101     scaleibuf = <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a094bab2aa339f34922893e1d6d617c28">IMB_dupImBuf</a>(ibuf);
<a name="l01102"></a>01102 
<a name="l01103"></a>01103     <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a226fb5e14b1905126cf30a6e7cba2498">IMB_scaleImBuf</a>(scaleibuf, (<span class="keywordtype">short</span>)rectx, (<span class="keywordtype">short</span>)recty);
<a name="l01104"></a>01104 
<a name="l01105"></a>01105     quality = clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a93ac999acdd83124032266a3128d8adc">proxy</a>.<a class="code" href="../../d6/dc8/structMovieClipProxy.html#aae85a2ae52d33d27191e78b88ea10544">quality</a>;
<a name="l01106"></a>01106     scaleibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#afe0c82b3cdc7314bdfc229aeba70f067">ftype</a> = <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#a43488598a405ffcd2a6d435eb9638257" title="Flag defining the components of the ImBuf struct.">JPG</a> | quality;
<a name="l01107"></a>01107 
<a name="l01108"></a>01108     <span class="comment">/* unsupported feature only confuses other s/w */</span>
<a name="l01109"></a>01109     <span class="keywordflow">if</span> (scaleibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a82ce0df1634072ad7ff972bf9d7bacd7">planes</a> == 32)
<a name="l01110"></a>01110         scaleibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a82ce0df1634072ad7ff972bf9d7bacd7">planes</a> = 24;
<a name="l01111"></a>01111 
<a name="l01112"></a>01112     <a class="code" href="../../df/dbb/BLI__threads_8h.html#aeb7fa826429971a6eb6074249ad39a0b">BLI_lock_thread</a>(<a class="code" href="../../df/dbb/BLI__threads_8h.html#a82b501872ede596ba9ec43030fd46fb8">LOCK_MOVIECLIP</a>);
<a name="l01113"></a>01113 
<a name="l01114"></a>01114     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#a050025994d6d5f2183dad14b383d0854">BLI_make_existing_file</a>(name);
<a name="l01115"></a>01115     <span class="keywordflow">if</span> (<a class="code" href="../../db/d49/IMB__imbuf_8h.html#a59c3289b30d140a0032c85110496dbbc">IMB_saveiff</a>(scaleibuf, name, <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#aa49c3338a20e388ce6ade7af88a93d40" title="Flag defining the components of the ImBuf struct.">IB_rect</a>) == 0)
<a name="l01116"></a>01116         perror(name);
<a name="l01117"></a>01117 
<a name="l01118"></a>01118     <a class="code" href="../../df/dbb/BLI__threads_8h.html#add77b383686cdf9514286b56e3c7939c">BLI_unlock_thread</a>(<a class="code" href="../../df/dbb/BLI__threads_8h.html#a82b501872ede596ba9ec43030fd46fb8">LOCK_MOVIECLIP</a>);
<a name="l01119"></a>01119 
<a name="l01120"></a>01120     <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40eceec0075863e55997a3fb210a18ae">IMB_freeImBuf</a>(scaleibuf);
<a name="l01121"></a>01121 }
<a name="l01122"></a>01122 
<a name="l01123"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a8bea96d722bf72c26d33546af3508f68">01123</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#ad5db4b9ff37f993ff1886b31d38c486d">BKE_movieclip_build_proxy_frame</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip, <span class="keywordtype">int</span> clip_flag, <span class="keyword">struct</span> <a class="code" href="../../d6/da4/structMovieDistortion.html">MovieDistortion</a> *distortion,
<a name="l01124"></a>01124                                      <span class="keywordtype">int</span> cfra, <span class="keywordtype">int</span> *build_sizes, <span class="keywordtype">int</span> build_count, <span class="keywordtype">int</span> undistorted)
<a name="l01125"></a>01125 {
<a name="l01126"></a>01126     <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf;
<a name="l01127"></a>01127     <a class="code" href="../../d8/dac/structMovieClipUser.html">MovieClipUser</a> user;
<a name="l01128"></a>01128 
<a name="l01129"></a>01129     user.<a class="code" href="../../d8/dac/structMovieClipUser.html#a645bba5909762a5df052e903bfb00afb">framenr</a> = cfra;
<a name="l01130"></a>01130     user.<a class="code" href="../../d8/dac/structMovieClipUser.html#a55a5c7cefa1d8e69de06bca5b9dc8ed2">render_flag</a> = 0;
<a name="l01131"></a>01131     user.<a class="code" href="../../d8/dac/structMovieClipUser.html#ae9aa9cc593facc98db4d5759e46cb754">render_size</a> = <a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html#a7aa419b2dcb03674e1546ff88882e320">MCLIP_PROXY_RENDER_SIZE_FULL</a>;
<a name="l01132"></a>01132 
<a name="l01133"></a>01133     ibuf = <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#a4720b4bd9ad7e5a66fd4526b7e4fecb1">BKE_movieclip_get_ibuf_flag</a>(clip, &amp;user, clip_flag, <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#a3d5c70290d12e83cbb5e606ead6b226f">MOVIECLIP_CACHE_SKIP</a>);
<a name="l01134"></a>01134 
<a name="l01135"></a>01135     <span class="keywordflow">if</span> (ibuf) {
<a name="l01136"></a>01136         <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *tmpibuf = ibuf;
<a name="l01137"></a>01137         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01138"></a>01138 
<a name="l01139"></a>01139         <span class="keywordflow">if</span> (undistorted)
<a name="l01140"></a>01140             tmpibuf = <a class="code" href="../../d5/d84/movieclip_8c.html#ab73af5517f6f27f7756c1ebbe8796a87">get_undistorted_ibuf</a>(clip, distortion, ibuf);
<a name="l01141"></a>01141 
<a name="l01142"></a>01142         <span class="keywordflow">for</span> (i = 0; i &lt; build_count; i++)
<a name="l01143"></a>01143             <a class="code" href="../../d5/d84/movieclip_8c.html#adb912256dd1f0f1f9286a858fbb0941a">movieclip_build_proxy_ibuf</a>(clip, tmpibuf, cfra, build_sizes[i], undistorted);
<a name="l01144"></a>01144 
<a name="l01145"></a>01145         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40eceec0075863e55997a3fb210a18ae">IMB_freeImBuf</a>(ibuf);
<a name="l01146"></a>01146 
<a name="l01147"></a>01147         <span class="keywordflow">if</span> (tmpibuf != ibuf)
<a name="l01148"></a>01148             <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a40eceec0075863e55997a3fb210a18ae">IMB_freeImBuf</a>(tmpibuf);
<a name="l01149"></a>01149     }
<a name="l01150"></a>01150 }
<a name="l01151"></a>01151 
<a name="l01152"></a><a class="code" href="../../d5/d84/movieclip_8c.html#a67ca4a338fbc5a0ce55495d2aea2fff9">01152</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#af31bb7926d9d767b09157579d6b05c2b">free_movieclip</a>(<a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip)
<a name="l01153"></a>01153 {
<a name="l01154"></a>01154     <a class="code" href="../../d5/d84/movieclip_8c.html#a3a877b1df54f8e70c495fc4564ba714f">free_buffers</a>(clip);
<a name="l01155"></a>01155 
<a name="l01156"></a>01156     <a class="code" href="../../da/d72/BKE__tracking_8h.html#a6d68140a96c26445ba29c802be59e0a5">BKE_tracking_free</a>(&amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#ad152541b1860f6ba2761a16270df8159">tracking</a>);
<a name="l01157"></a>01157 }
<a name="l01158"></a>01158 
<a name="l01159"></a><a class="code" href="../../d5/d84/movieclip_8c.html#aa6c123064b1fa851baa1890c4fe4400d">01159</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/dd4/BKE__movieclip_8h.html#a81e87540a6add7f0e03c521cedacd2c2">unlink_movieclip</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip)
<a name="l01160"></a>01160 {
<a name="l01161"></a>01161     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *scr;
<a name="l01162"></a>01162     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *area;
<a name="l01163"></a>01163     <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl;
<a name="l01164"></a>01164     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l01165"></a>01165     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l01166"></a>01166 
<a name="l01167"></a>01167     <span class="keywordflow">for</span> (scr = bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; scr; scr = scr-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01168"></a>01168         <span class="keywordflow">for</span> (area = scr-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; area; area = area-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l01169"></a>01169             <span class="keywordflow">for</span> (sl = area-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sl; sl = sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l01170"></a>01170                 <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca02bf62758ff66d33c28826738012179d">SPACE_CLIP</a>) {
<a name="l01171"></a>01171                     <a class="code" href="../../dc/dd5/structSpaceClip.html">SpaceClip</a> *sc = (<a class="code" href="../../dc/dd5/structSpaceClip.html">SpaceClip</a> *) sl;
<a name="l01172"></a>01172 
<a name="l01173"></a>01173                     <span class="keywordflow">if</span> (sc-&gt;<a class="code" href="../../dc/dd5/structSpaceClip.html#ab38103375a048c37f80d4621df8186c8">clip</a> == clip)
<a name="l01174"></a>01174                         sc-&gt;<a class="code" href="../../dc/dd5/structSpaceClip.html#ab38103375a048c37f80d4621df8186c8">clip</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01175"></a>01175                 }
<a name="l01176"></a>01176                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l01177"></a>01177                     <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d = (<a class="code" href="../../d6/deb/structView3D.html">View3D</a> *) sl;
<a name="l01178"></a>01178                     <a class="code" href="../../df/da6/structBGpic.html">BGpic</a> *bgpic;
<a name="l01179"></a>01179 
<a name="l01180"></a>01180                     <span class="keywordflow">for</span> (bgpic = v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a3246c1cbdd50c393126180ae4446992e">bgpicbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; bgpic; bgpic = bgpic-&gt;<a class="code" href="../../df/da6/structBGpic.html#a81c485660f1feac2cfa5c5813153c2f0">next</a>) {
<a name="l01181"></a>01181                         <span class="keywordflow">if</span> (bgpic-&gt;<a class="code" href="../../df/da6/structBGpic.html#a91d17a6f72f3226ca9f26dab51697941">clip</a> == clip)
<a name="l01182"></a>01182                             bgpic-&gt;<a class="code" href="../../df/da6/structBGpic.html#a91d17a6f72f3226ca9f26dab51697941">clip</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01183"></a>01183                     }
<a name="l01184"></a>01184                 }
<a name="l01185"></a>01185             }
<a name="l01186"></a>01186         }
<a name="l01187"></a>01187     }
<a name="l01188"></a>01188 
<a name="l01189"></a>01189     <span class="keywordflow">for</span> (sce = bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sce; sce = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01190"></a>01190         <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a5ff6096f2dbaa433889794ded2733521">clip</a> == clip)
<a name="l01191"></a>01191             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a5ff6096f2dbaa433889794ded2733521">clip</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01192"></a>01192     }
<a name="l01193"></a>01193 
<a name="l01194"></a>01194     <span class="keywordflow">for</span> (ob = bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01195"></a>01195         <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l01196"></a>01196 
<a name="l01197"></a>01197         <span class="keywordflow">for</span> (con = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; con; con = con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l01198"></a>01198             <a class="code" href="../../dc/ded/structbConstraintTypeInfo.html">bConstraintTypeInfo</a> *cti = <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#a8eac21e0105e441026a6b7cd7d78030d">constraint_get_typeinfo</a>(con);
<a name="l01199"></a>01199 
<a name="l01200"></a>01200             <span class="keywordflow">if</span> (cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#af4d4e80ea9c413dd7df1b5895ed439f9">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a3119d40b7e938fe99cbc91a9c75bdf9e">CONSTRAINT_TYPE_FOLLOWTRACK</a>) {
<a name="l01201"></a>01201                 <a class="code" href="../../d5/de6/structbFollowTrackConstraint.html">bFollowTrackConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = (<a class="code" href="../../d5/de6/structbFollowTrackConstraint.html">bFollowTrackConstraint</a> *) con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l01202"></a>01202 
<a name="l01203"></a>01203                 <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (data-&gt;<a class="code" href="../../d5/de6/structbFollowTrackConstraint.html#a3eda8a26a14814fca95654254ebda0a7">clip</a> == clip)
<a name="l01204"></a>01204                     data-&gt;<a class="code" href="../../d5/de6/structbFollowTrackConstraint.html#a3eda8a26a14814fca95654254ebda0a7">clip</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01205"></a>01205             }
<a name="l01206"></a>01206             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#af4d4e80ea9c413dd7df1b5895ed439f9">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a6add20c4d241c5a886ce8b6b86f363cd">CONSTRAINT_TYPE_CAMERASOLVER</a>) {
<a name="l01207"></a>01207                 <a class="code" href="../../d3/d2e/structbCameraSolverConstraint.html">bCameraSolverConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = (<a class="code" href="../../d3/d2e/structbCameraSolverConstraint.html">bCameraSolverConstraint</a> *) con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l01208"></a>01208 
<a name="l01209"></a>01209                 <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (data-&gt;<a class="code" href="../../d3/d2e/structbCameraSolverConstraint.html#a0ab3030b369b8e2c63210061c9e0bd1d">clip</a> == clip)
<a name="l01210"></a>01210                     data-&gt;<a class="code" href="../../d3/d2e/structbCameraSolverConstraint.html#a0ab3030b369b8e2c63210061c9e0bd1d">clip</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01211"></a>01211             }
<a name="l01212"></a>01212             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#af4d4e80ea9c413dd7df1b5895ed439f9">type</a> == <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a3321fd3e52140da450d8f6725b3678af">CONSTRAINT_TYPE_OBJECTSOLVER</a>) {
<a name="l01213"></a>01213                 <a class="code" href="../../db/d59/structbObjectSolverConstraint.html">bObjectSolverConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = (<a class="code" href="../../db/d59/structbObjectSolverConstraint.html">bObjectSolverConstraint</a> *) con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l01214"></a>01214 
<a name="l01215"></a>01215                 <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (data-&gt;<a class="code" href="../../db/d59/structbObjectSolverConstraint.html#a5219c2f1918b3f468a05565ec61a00df">clip</a> == clip)
<a name="l01216"></a>01216                     data-&gt;<a class="code" href="../../db/d59/structbObjectSolverConstraint.html#a5219c2f1918b3f468a05565ec61a00df">clip</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01217"></a>01217             }
<a name="l01218"></a>01218         }
<a name="l01219"></a>01219     }
<a name="l01220"></a>01220 
<a name="l01221"></a>01221     clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a51cceb766b47f21cbe774967b1d73b8f">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a> = 0;
<a name="l01222"></a>01222 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:34 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

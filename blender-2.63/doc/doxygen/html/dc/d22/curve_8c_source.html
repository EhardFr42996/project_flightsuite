<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: curve.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">curve.c</div>  </div>
</div>
<div class="contents">
<a href="../../dc/d22/curve_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): none yet.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;math.h&gt;</span>  <span class="comment">// floor</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>  
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/dd1/BLI__bpath_8h.html">BLI_bpath.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc5/BLI__ghash_8h.html" title="A general (pointer -&gt; pointer) hash table ADT.">BLI_ghash.h</a>&quot;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d88/DNA__curve__types_8h.html">DNA_curve_types.h</a>&quot;</span>  
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../de/db2/DNA__material__types_8h.html">DNA_material_types.h</a>&quot;</span>  
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="comment">/* for dereferencing pointers */</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d41/DNA__key__types_8h.html">DNA_key_types.h</a>&quot;</span>  
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>  
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../de/dcc/DNA__vfont__types_8h.html">DNA_vfont_types.h</a>&quot;</span>  
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d51/BKE__animsys_8h.html">BKE_animsys.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dd0/BKE__anim_8h.html">BKE_anim.h</a>&quot;</span>  
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dfc/BKE__curve_8h.html">BKE_curve.h</a>&quot;</span>  
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d12/BKE__displist_8h.html" title="display list (or rather multi purpose list) stuff.">BKE_displist.h</a>&quot;</span>  
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d06/BKE__font_8h.html">BKE_font.h</a>&quot;</span> 
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span> 
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d17/BKE__key_8h.html">BKE_key.h</a>&quot;</span>  
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/db1/BKE__library_8h.html">BKE_library.h</a>&quot;</span>  
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>  
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dac/BKE__object_8h.html" title="General operations, lookup, etc. for blender objects.">BKE_object.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d0f/BKE__material_8h.html" title="General operations, lookup, etc. for materials.">BKE_material.h</a>&quot;</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="comment">/* globals */</span>
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="comment">/* local */</span>
<a name="l00069"></a>00069 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d22/curve_8c.html#a14a175046af13236ec46abfabdf654a0">cu_isectLL</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> v1[3], <span class="keyword">const</span> <span class="keywordtype">float</span> v2[3], <span class="keyword">const</span> <span class="keywordtype">float</span> v3[3], <span class="keyword">const</span> <span class="keywordtype">float</span> v4[3],
<a name="l00070"></a>00070                       <span class="keywordtype">short</span> cox, <span class="keywordtype">short</span> coy,
<a name="l00071"></a>00071                       <span class="keywordtype">float</span> *labda, <span class="keywordtype">float</span> *mu, <span class="keywordtype">float</span> vec[3]);
<a name="l00072"></a>00072 
<a name="l00073"></a><a class="code" href="../../dc/d22/curve_8c.html#a38caa726ffab019cb50cf5bf7b6401a2">00073</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aa2a45909f6607c4865e6196b17534248">unlink_curve</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu)
<a name="l00074"></a>00074 {
<a name="l00075"></a>00075     <span class="keywordtype">int</span> a;
<a name="l00076"></a>00076     
<a name="l00077"></a>00077     <span class="keywordflow">for</span> (a=0; a&lt;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a178aa2fd33adfb5df2b311a7d398ac36">totcol</a>; a++) {
<a name="l00078"></a>00078         <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0ff0285ca29eef8bf650f0746ac9a84a">mat</a>[a]) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0ff0285ca29eef8bf650f0746ac9a84a">mat</a>[a]-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--;
<a name="l00079"></a>00079         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0ff0285ca29eef8bf650f0746ac9a84a">mat</a>[a]= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00080"></a>00080     }
<a name="l00081"></a>00081     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a1735002958cbeb8aaf88094ef6596e78">vfont</a>) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a1735002958cbeb8aaf88094ef6596e78">vfont</a>-&gt;<a class="code" href="../../dc/dbe/structVFont.html#aa6ee47902f7fe209564d555dd4d8969d">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--; 
<a name="l00082"></a>00082     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a1735002958cbeb8aaf88094ef6596e78">vfont</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00083"></a>00083 
<a name="l00084"></a>00084     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a97e02bc14fc71f7a56cf4dfb92c6cc4e">vfontb</a>) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a97e02bc14fc71f7a56cf4dfb92c6cc4e">vfontb</a>-&gt;<a class="code" href="../../dc/dbe/structVFont.html#aa6ee47902f7fe209564d555dd4d8969d">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--; 
<a name="l00085"></a>00085     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a97e02bc14fc71f7a56cf4dfb92c6cc4e">vfontb</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abb6c8efed809e4d4d0a9a8cf6ffe08e0">vfonti</a>) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abb6c8efed809e4d4d0a9a8cf6ffe08e0">vfonti</a>-&gt;<a class="code" href="../../dc/dbe/structVFont.html#aa6ee47902f7fe209564d555dd4d8969d">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--; 
<a name="l00088"></a>00088     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abb6c8efed809e4d4d0a9a8cf6ffe08e0">vfonti</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ad2b3c8b2a7e3439d1257ad170329902f">vfontbi</a>) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ad2b3c8b2a7e3439d1257ad170329902f">vfontbi</a>-&gt;<a class="code" href="../../dc/dbe/structVFont.html#aa6ee47902f7fe209564d555dd4d8969d">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--; 
<a name="l00091"></a>00091     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ad2b3c8b2a7e3439d1257ad170329902f">vfontbi</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00092"></a>00092     
<a name="l00093"></a>00093     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>-&gt;<a class="code" href="../../d1/d9e/structKey.html#a4e5a48e60e8ed39616fdbb90d501fc6c">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--;
<a name="l00094"></a>00094     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00095"></a>00095 }
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="comment">/* frees editcurve entirely */</span>
<a name="l00098"></a><a class="code" href="../../dc/d22/curve_8c.html#adddc727bafd6de46fdc259fed1822da3">00098</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#ae62da8c2c0cc21aa3b600785ba6cf5d3">BKE_free_editfont</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu)
<a name="l00099"></a>00099 {
<a name="l00100"></a>00100     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5cea9d9cf980788715e190c6261cd0a3">editfont</a>) {
<a name="l00101"></a>00101         <a class="code" href="../../d7/d68/structEditFont.html">EditFont</a> *ef= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5cea9d9cf980788715e190c6261cd0a3">editfont</a>;
<a name="l00102"></a>00102         
<a name="l00103"></a>00103         <span class="keywordflow">if</span> (ef-&gt;<a class="code" href="../../d7/d68/structEditFont.html#a06dec7184eac7b031fe0c1d18bf93ab0">oldstr</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ef-&gt;<a class="code" href="../../d7/d68/structEditFont.html#a06dec7184eac7b031fe0c1d18bf93ab0">oldstr</a>);
<a name="l00104"></a>00104         <span class="keywordflow">if</span> (ef-&gt;<a class="code" href="../../d7/d68/structEditFont.html#a39c57d02cef0f54733d3b1a91ed1b5a7">oldstrinfo</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ef-&gt;<a class="code" href="../../d7/d68/structEditFont.html#a39c57d02cef0f54733d3b1a91ed1b5a7">oldstrinfo</a>);
<a name="l00105"></a>00105         <span class="keywordflow">if</span> (ef-&gt;<a class="code" href="../../d7/d68/structEditFont.html#af976972691fcc0acd599372afea1e1aa">textbuf</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ef-&gt;<a class="code" href="../../d7/d68/structEditFont.html#af976972691fcc0acd599372afea1e1aa">textbuf</a>);
<a name="l00106"></a>00106         <span class="keywordflow">if</span> (ef-&gt;<a class="code" href="../../d7/d68/structEditFont.html#ae82ed115de0ddf3db8797d8d87465552">textbufinfo</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ef-&gt;<a class="code" href="../../d7/d68/structEditFont.html#ae82ed115de0ddf3db8797d8d87465552">textbufinfo</a>);
<a name="l00107"></a>00107         <span class="keywordflow">if</span> (ef-&gt;<a class="code" href="../../d7/d68/structEditFont.html#a57188c93f482c5e0d2071a596c91bfbd">copybuf</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ef-&gt;<a class="code" href="../../d7/d68/structEditFont.html#a57188c93f482c5e0d2071a596c91bfbd">copybuf</a>);
<a name="l00108"></a>00108         <span class="keywordflow">if</span> (ef-&gt;<a class="code" href="../../d7/d68/structEditFont.html#afa8111f3f8b80e6a5e478b88c3c2d7d7">copybufinfo</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ef-&gt;<a class="code" href="../../d7/d68/structEditFont.html#afa8111f3f8b80e6a5e478b88c3c2d7d7">copybufinfo</a>);
<a name="l00109"></a>00109         
<a name="l00110"></a>00110         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ef);
<a name="l00111"></a>00111         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a5cea9d9cf980788715e190c6261cd0a3">editfont</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00112"></a>00112     }
<a name="l00113"></a>00113 }
<a name="l00114"></a>00114 
<a name="l00115"></a><a class="code" href="../../dc/d22/curve_8c.html#ade8520712911ef9dfc693ca13cbee26d">00115</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a1077cd2f12f95687bb546db66165e4e3">free_curve_editNurb_keyIndex</a>(<a class="code" href="../../d7/d1d/structEditNurb.html">EditNurb</a> *editnurb)
<a name="l00116"></a>00116 {
<a name="l00117"></a>00117     <span class="keywordflow">if</span> (!editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>) {
<a name="l00118"></a>00118         <span class="keywordflow">return</span>;
<a name="l00119"></a>00119     }
<a name="l00120"></a>00120     <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#adc20ede3cd08276d25c11f2d02768119">BLI_ghash_free</a>(editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, (<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a53210a0b5c7bd4568f50f16dd85f04a6">GHashValFreeFP</a>)<a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>);
<a name="l00121"></a>00121     editnurb-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a504e14402049c29753acbdec8ff11456">keyindex</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00122"></a>00122 }
<a name="l00123"></a>00123 
<a name="l00124"></a><a class="code" href="../../db/d71/ED__curve_8h.html#a29b5e8af8260aa0e00dcb87781f68e1f">00124</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a29b5e8af8260aa0e00dcb87781f68e1f">free_curve_editNurb</a> (<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu)
<a name="l00125"></a>00125 {
<a name="l00126"></a>00126     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>) {
<a name="l00127"></a>00127         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aa7e3a2bafad6c23e082515885ae5294a">freeNurblist</a>(&amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>);
<a name="l00128"></a>00128         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a1077cd2f12f95687bb546db66165e4e3">free_curve_editNurb_keyIndex</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>);
<a name="l00129"></a>00129         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>);
<a name="l00130"></a>00130         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00131"></a>00131     }
<a name="l00132"></a>00132 }
<a name="l00133"></a>00133 
<a name="l00134"></a>00134 <span class="comment">/* don&#39;t free curve itself */</span>
<a name="l00135"></a><a class="code" href="../../dc/d22/curve_8c.html#a01bbdeb565f1f9b69526a46b8349bc99">00135</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a9d28a9f5c77edf97b5a622c764a1f2b1">free_curve</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu)
<a name="l00136"></a>00136 {
<a name="l00137"></a>00137     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aa7e3a2bafad6c23e082515885ae5294a">freeNurblist</a>(&amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>);
<a name="l00138"></a>00138     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a70b76680fbc09de0e26f7eeec36be3f2">bev</a>);
<a name="l00139"></a>00139     <a class="code" href="../../d9/d12/BKE__displist_8h.html#a561c3ea04fd61b48f782bfea0aae53ad">freedisplist</a>(&amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a98794ad486b99d01cc752f9f94e856e5">disp</a>);
<a name="l00140"></a>00140     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#ae62da8c2c0cc21aa3b600785ba6cf5d3">BKE_free_editfont</a>(cu);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a29b5e8af8260aa0e00dcb87781f68e1f">free_curve_editNurb</a>(cu);
<a name="l00143"></a>00143     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aa2a45909f6607c4865e6196b17534248">unlink_curve</a>(cu);
<a name="l00144"></a>00144     <a class="code" href="../../dc/d51/BKE__animsys_8h.html#a186ce67df8bf9873cc945eed480eaa49">BKE_free_animdata</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)cu);
<a name="l00145"></a>00145     
<a name="l00146"></a>00146     <span class="keywordflow">if</span> (cu-&gt;mat) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cu-&gt;mat);
<a name="l00147"></a>00147     <span class="keywordflow">if</span> (cu-&gt;str) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cu-&gt;str);
<a name="l00148"></a>00148     <span class="keywordflow">if</span> (cu-&gt;strinfo) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cu-&gt;strinfo);
<a name="l00149"></a>00149     <span class="keywordflow">if</span> (cu-&gt;bb) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cu-&gt;bb);
<a name="l00150"></a>00150     <span class="keywordflow">if</span> (cu-&gt;path) <a class="code" href="../../df/dd0/BKE__anim_8h.html#a8f0ee41096ed038a1e364cfcb7d5e351">free_path</a>(cu-&gt;path);
<a name="l00151"></a>00151     <span class="keywordflow">if</span> (cu-&gt;tb) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cu-&gt;tb);
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 
<a name="l00154"></a><a class="code" href="../../dc/d22/curve_8c.html#aac8ecf496219dc733e9187dea7aac061">00154</a> <a class="code" href="../../da/d10/structCurve.html">Curve</a> *<a class="code" href="../../d7/dfc/BKE__curve_8h.html#a52987e604c724a42e2db3faf8f03352d">add_curve</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> type)
<a name="l00155"></a>00155 {
<a name="l00156"></a>00156     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu;
<a name="l00157"></a>00157 
<a name="l00158"></a>00158     cu = <a class="code" href="../../d8/db1/BKE__library_8h.html#a0856c5e10e28cbe0b45eb00363bf8fb5">alloc_libblock</a>(&amp;<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;curve, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ace150506eaf644d92a5110cf45978379">ID_CU</a>, name);
<a name="l00159"></a>00159     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ac91c4e2c09412366f3cb04db8a2e5798">copy_v3_fl</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>, 1.0f);
<a name="l00160"></a>00160     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a582ba8cae7a48052e26e3fd58bd0cd6a">CU_FRONT</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a81cf8279edc9b7a31cdc56d0a36e1a87">CU_BACK</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a03d9b5ed3b3d67af17d62b3b5f847e23">CU_DEFORM_BOUNDS_OFF</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a331c460f678f0c0ac8657ece2d2b89c2">CU_PATH_RADIUS</a>;
<a name="l00161"></a>00161     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0c9965770cb42b83eedc78f09d4087ce">pathlen</a>= 100;
<a name="l00162"></a>00162     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a69ba1bcc92e21490b438c065ec972cf6">resolu</a>= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a31f5d4aa5f36e750306db23ccc55e814">resolv</a>= (type == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>) ? 4 : 12;
<a name="l00163"></a>00163     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#aec33e225f723d3068a172028f5e2c22f">width</a>= 1.0;
<a name="l00164"></a>00164     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a7aaf33141afe2cd8eb03e34256fd09db">wordspace</a> = 1.0;
<a name="l00165"></a>00165     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0de9e46069c2ade3242130d71cbf8b8a">spacing</a>= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#acbb034dac5b4158a67bcf9150c9fa630">linedist</a>= 1.0;
<a name="l00166"></a>00166     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ad0e4ea215dcd01147ad06b76e581eb9c">fsize</a>= 1.0;
<a name="l00167"></a>00167     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a4e0212cf92e3b7f1d2c355632c566905">ulheight</a> = 0.05;    
<a name="l00168"></a>00168     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abda1aeabacab0375c8f75cc0d5f0d6c9">texflag</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a7c5329f4f00c80d0b646713d748f11b4">CU_AUTOSPACE</a>;
<a name="l00169"></a>00169     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac5addf9f547e56142edf1936e78608ef">smallcaps_scale</a>= 0.75f;
<a name="l00170"></a>00170     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a7a8d35b0d4aad3cc5c1873e23108bc0c">twist_mode</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a7a91154d152da08afe9a82dc3371cc4b">CU_TWIST_MINIMUM</a>;   <span class="comment">// XXX: this one seems to be the best one in most cases, at least for curve deform...</span>
<a name="l00171"></a>00171     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#afb10d1fffa5cd8a385429dc5f23ff5f5">type</a>= type;
<a name="l00172"></a>00172     
<a name="l00173"></a>00173     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a523cd93ea45778db87896479460cd5d0">bb</a>= <a class="code" href="../../df/dac/BKE__object_8h.html#afee25bdb76fbe4984ea3f933b673b45e">unit_boundbox</a>();
<a name="l00174"></a>00174     
<a name="l00175"></a>00175     <span class="keywordflow">if</span> (type==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1a94162b6fc469957966a01d41ff71d6">OB_FONT</a>) {
<a name="l00176"></a>00176         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a1735002958cbeb8aaf88094ef6596e78">vfont</a>= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a97e02bc14fc71f7a56cf4dfb92c6cc4e">vfontb</a>= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abb6c8efed809e4d4d0a9a8cf6ffe08e0">vfonti</a>= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ad2b3c8b2a7e3439d1257ad170329902f">vfontbi</a>= <a class="code" href="../../d0/d06/BKE__font_8h.html#a6948084f7d8dc1d7a5e4f64db5c88dbe">get_builtin_font</a>();
<a name="l00177"></a>00177         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a1735002958cbeb8aaf88094ef6596e78">vfont</a>-&gt;<a class="code" href="../../dc/dbe/structVFont.html#aa6ee47902f7fe209564d555dd4d8969d">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>+=4;
<a name="l00178"></a>00178         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab0b4dc5959c529381dbc6a954a8a39b6">str</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(12, <span class="stringliteral">&quot;str&quot;</span>);
<a name="l00179"></a>00179         <a class="code" href="../../d3/db3/BLI__string_8h.html#a98d7c9cb4a81dbe506d1972b306300ce">BLI_strncpy</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab0b4dc5959c529381dbc6a954a8a39b6">str</a>, <span class="stringliteral">&quot;Text&quot;</span>, 12);
<a name="l00180"></a>00180         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#adace7d1722758b9ffec9b98f9cf688b2">len</a>= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a4ad18a3ab608a6d776e63e4717553a6d">pos</a>= 4;
<a name="l00181"></a>00181         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a95ab12824ad734ab8bc052cd7fdcc22d">strinfo</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(12*<span class="keyword">sizeof</span>(<a class="code" href="../../dc/d38/structCharInfo.html">CharInfo</a>), <span class="stringliteral">&quot;strinfo new&quot;</span>);
<a name="l00182"></a>00182         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a653d6829b5c84d43744c7939f32b0c3b">totbox</a>= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a59951ed35caba6bc89103679b3a1c7b8">actbox</a>= 1;
<a name="l00183"></a>00183         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a2781f12837323bb5b150f82d0f0ff70e">MAXTEXTBOX</a>*<span class="keyword">sizeof</span>(<a class="code" href="../../de/d25/structTextBox.html">TextBox</a>), <span class="stringliteral">&quot;textbox&quot;</span>);
<a name="l00184"></a>00184         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>[0].<a class="code" href="../../de/d25/structTextBox.html#a3cc521cc3bd6b4ba5592e898e0eaa863">w</a> = cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>[0].<a class="code" href="../../de/d25/structTextBox.html#a1fd41eef9b87497341c61d9e89e5da43">h</a> = 0.0;
<a name="l00185"></a>00185     }
<a name="l00186"></a>00186     
<a name="l00187"></a>00187     <span class="keywordflow">return</span> cu;
<a name="l00188"></a>00188 }
<a name="l00189"></a>00189 
<a name="l00190"></a><a class="code" href="../../dc/d22/curve_8c.html#a0a40ef506376f42f23914f01fad61130">00190</a> <a class="code" href="../../da/d10/structCurve.html">Curve</a> *<a class="code" href="../../d7/dfc/BKE__curve_8h.html#a605671c47326150aac1fe3158c925781">copy_curve</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu)
<a name="l00191"></a>00191 {
<a name="l00192"></a>00192     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cun;
<a name="l00193"></a>00193     <span class="keywordtype">int</span> a;
<a name="l00194"></a>00194     
<a name="l00195"></a>00195     cun= <a class="code" href="../../d8/db1/BKE__library_8h.html#a0c0c1987364874c73cda326eace31efd">copy_libblock</a>(&amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>);
<a name="l00196"></a>00196     cun-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= cun-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00197"></a>00197     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a2d7201d0683bd58b17a190c9ea5ca1e4">duplicateNurblist</a>( &amp;(cun-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>), &amp;(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>));
<a name="l00198"></a>00198 
<a name="l00199"></a>00199     cun-&gt;<a class="code" href="../../da/d10/structCurve.html#a0ff0285ca29eef8bf650f0746ac9a84a">mat</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0ff0285ca29eef8bf650f0746ac9a84a">mat</a>);
<a name="l00200"></a>00200     <span class="keywordflow">for</span> (a=0; a&lt;cun-&gt;<a class="code" href="../../da/d10/structCurve.html#a178aa2fd33adfb5df2b311a7d398ac36">totcol</a>; a++) {
<a name="l00201"></a>00201         <a class="code" href="../../d8/db1/BKE__library_8h.html#a967d1ceef29b2612ef6e03194c512ad6">id_us_plus</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)cun-&gt;<a class="code" href="../../da/d10/structCurve.html#a0ff0285ca29eef8bf650f0746ac9a84a">mat</a>[a]);
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203     
<a name="l00204"></a>00204     cun-&gt;<a class="code" href="../../da/d10/structCurve.html#ab0b4dc5959c529381dbc6a954a8a39b6">str</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab0b4dc5959c529381dbc6a954a8a39b6">str</a>);
<a name="l00205"></a>00205     cun-&gt;<a class="code" href="../../da/d10/structCurve.html#a95ab12824ad734ab8bc052cd7fdcc22d">strinfo</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a95ab12824ad734ab8bc052cd7fdcc22d">strinfo</a>);   
<a name="l00206"></a>00206     cun-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a2d8913e7de716473cc851148c2d2db19">tb</a>);
<a name="l00207"></a>00207     cun-&gt;<a class="code" href="../../da/d10/structCurve.html#a523cd93ea45778db87896479460cd5d0">bb</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a523cd93ea45778db87896479460cd5d0">bb</a>);
<a name="l00208"></a>00208     
<a name="l00209"></a>00209     cun-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>= <a class="code" href="../../d5/d17/BKE__key_8h.html#a8fb643b558a887ed5f9b5020491e54aa">copy_key</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>);
<a name="l00210"></a>00210     <span class="keywordflow">if</span> (cun-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>) cun-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>-&gt;<a class="code" href="../../d1/d9e/structKey.html#a10821be2b17cc3b647d74f40c307e75f">from</a>= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)cun;
<a name="l00211"></a>00211     
<a name="l00212"></a>00212     cun-&gt;<a class="code" href="../../da/d10/structCurve.html#a98794ad486b99d01cc752f9f94e856e5">disp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= cun-&gt;<a class="code" href="../../da/d10/structCurve.html#a98794ad486b99d01cc752f9f94e856e5">disp</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00213"></a>00213     cun-&gt;<a class="code" href="../../da/d10/structCurve.html#a70b76680fbc09de0e26f7eeec36be3f2">bev</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= cun-&gt;<a class="code" href="../../da/d10/structCurve.html#a70b76680fbc09de0e26f7eeec36be3f2">bev</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00214"></a>00214     cun-&gt;<a class="code" href="../../da/d10/structCurve.html#a946ca944a39e912802a59396578e5a1f">path</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00215"></a>00215 
<a name="l00216"></a>00216     cun-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00217"></a>00217     cun-&gt;<a class="code" href="../../da/d10/structCurve.html#a5cea9d9cf980788715e190c6261cd0a3">editfont</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00218"></a>00218     cun-&gt;<a class="code" href="../../da/d10/structCurve.html#ad215e7da46b3f909ff9d9542030f6111">selboxes</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 <span class="preprocessor">#if 0   // XXX old animation system</span>
<a name="l00221"></a>00221 <span class="preprocessor"></span>    <span class="comment">/* single user ipo too */</span>
<a name="l00222"></a>00222     <span class="keywordflow">if</span> (cun-&gt;ipo) cun-&gt;ipo= copy_ipo(cun-&gt;ipo);
<a name="l00223"></a>00223 <span class="preprocessor">#endif // XXX old animation system</span>
<a name="l00224"></a>00224 <span class="preprocessor"></span>
<a name="l00225"></a>00225     <a class="code" href="../../d8/db1/BKE__library_8h.html#a967d1ceef29b2612ef6e03194c512ad6">id_us_plus</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)cun-&gt;<a class="code" href="../../da/d10/structCurve.html#a1735002958cbeb8aaf88094ef6596e78">vfont</a>);
<a name="l00226"></a>00226     <a class="code" href="../../d8/db1/BKE__library_8h.html#a967d1ceef29b2612ef6e03194c512ad6">id_us_plus</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)cun-&gt;<a class="code" href="../../da/d10/structCurve.html#a97e02bc14fc71f7a56cf4dfb92c6cc4e">vfontb</a>);  
<a name="l00227"></a>00227     <a class="code" href="../../d8/db1/BKE__library_8h.html#a967d1ceef29b2612ef6e03194c512ad6">id_us_plus</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)cun-&gt;<a class="code" href="../../da/d10/structCurve.html#abb6c8efed809e4d4d0a9a8cf6ffe08e0">vfonti</a>);
<a name="l00228"></a>00228     <a class="code" href="../../d8/db1/BKE__library_8h.html#a967d1ceef29b2612ef6e03194c512ad6">id_us_plus</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)cun-&gt;<a class="code" href="../../da/d10/structCurve.html#ad2b3c8b2a7e3439d1257ad170329902f">vfontbi</a>);
<a name="l00229"></a>00229     
<a name="l00230"></a>00230     <span class="keywordflow">return</span> cun;
<a name="l00231"></a>00231 }
<a name="l00232"></a>00232 
<a name="l00233"></a><a class="code" href="../../dc/d22/curve_8c.html#a6c6062080f21cc534eaa24472a21b36b">00233</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#a6c6062080f21cc534eaa24472a21b36b">extern_local_curve</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu)
<a name="l00234"></a>00234 {   
<a name="l00235"></a>00235     <a class="code" href="../../d8/db1/BKE__library_8h.html#a43e37bd819b3a44520ff6fbfd9e8962d">id_lib_extern</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a1735002958cbeb8aaf88094ef6596e78">vfont</a>);
<a name="l00236"></a>00236     <a class="code" href="../../d8/db1/BKE__library_8h.html#a43e37bd819b3a44520ff6fbfd9e8962d">id_lib_extern</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a97e02bc14fc71f7a56cf4dfb92c6cc4e">vfontb</a>);    
<a name="l00237"></a>00237     <a class="code" href="../../d8/db1/BKE__library_8h.html#a43e37bd819b3a44520ff6fbfd9e8962d">id_lib_extern</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abb6c8efed809e4d4d0a9a8cf6ffe08e0">vfonti</a>);
<a name="l00238"></a>00238     <a class="code" href="../../d8/db1/BKE__library_8h.html#a43e37bd819b3a44520ff6fbfd9e8962d">id_lib_extern</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ad2b3c8b2a7e3439d1257ad170329902f">vfontbi</a>);
<a name="l00239"></a>00239     
<a name="l00240"></a>00240     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0ff0285ca29eef8bf650f0746ac9a84a">mat</a>) {
<a name="l00241"></a>00241         <a class="code" href="../../d4/d0f/BKE__material_8h.html#ace89d626579263a0cf9c248ede11b42e">extern_local_matarar</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0ff0285ca29eef8bf650f0746ac9a84a">mat</a>, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a178aa2fd33adfb5df2b311a7d398ac36">totcol</a>);
<a name="l00242"></a>00242     }
<a name="l00243"></a>00243 }
<a name="l00244"></a>00244 
<a name="l00245"></a><a class="code" href="../../dc/d22/curve_8c.html#a8b7aba4690889cd1b869f020cc854dd7">00245</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a2cfd159158cbd59f39ba205c3cb9f0d4">make_local_curve</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu)
<a name="l00246"></a>00246 {
<a name="l00247"></a>00247     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main;
<a name="l00248"></a>00248     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l00249"></a>00249     <span class="keywordtype">int</span> is_local= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, is_lib= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00250"></a>00250     
<a name="l00251"></a>00251     <span class="comment">/* - when there are only lib users: don&#39;t do</span>
<a name="l00252"></a>00252 <span class="comment">     * - when there are only local users: set flag</span>
<a name="l00253"></a>00253 <span class="comment">     * - mixed: do a copy</span>
<a name="l00254"></a>00254 <span class="comment">     */</span>
<a name="l00255"></a>00255     
<a name="l00256"></a>00256     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00257"></a>00257 
<a name="l00258"></a>00258     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>==1) {
<a name="l00259"></a>00259         <a class="code" href="../../d8/db1/BKE__library_8h.html#a668f0934d813d85c7920735e681fb2b1">id_clear_lib_data</a>(bmain, &amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>);
<a name="l00260"></a>00260         <a class="code" href="../../dc/d22/curve_8c.html#a6c6062080f21cc534eaa24472a21b36b">extern_local_curve</a>(cu);
<a name="l00261"></a>00261         <span class="keywordflow">return</span>;
<a name="l00262"></a>00262     }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264     <span class="keywordflow">for</span> (ob= bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob &amp;&amp; <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(0, is_lib, is_local); ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l00265"></a>00265         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a> == cu) {
<a name="l00266"></a>00266             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>) is_lib= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00267"></a>00267             <span class="keywordflow">else</span> is_local= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00268"></a>00268         }
<a name="l00269"></a>00269     }
<a name="l00270"></a>00270 
<a name="l00271"></a>00271     <span class="keywordflow">if</span> (is_local &amp;&amp; is_lib == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) {
<a name="l00272"></a>00272         <a class="code" href="../../d8/db1/BKE__library_8h.html#a668f0934d813d85c7920735e681fb2b1">id_clear_lib_data</a>(bmain, &amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>);
<a name="l00273"></a>00273         <a class="code" href="../../dc/d22/curve_8c.html#a6c6062080f21cc534eaa24472a21b36b">extern_local_curve</a>(cu);
<a name="l00274"></a>00274     }
<a name="l00275"></a>00275     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_local &amp;&amp; is_lib) {
<a name="l00276"></a>00276         <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu_new= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a605671c47326150aac1fe3158c925781">copy_curve</a>(cu);
<a name="l00277"></a>00277         cu_new-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>= 0;
<a name="l00278"></a>00278 
<a name="l00279"></a>00279         <a class="code" href="../../d8/db1/BKE__library_8h.html#a28231f1e4d5edb6c8498db449bda4528">BKE_id_lib_local_paths</a>(bmain, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, &amp;cu_new-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>);
<a name="l00280"></a>00280 
<a name="l00281"></a>00281         <span class="keywordflow">for</span> (ob= bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l00282"></a>00282             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>==cu) {
<a name="l00283"></a>00283                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00284"></a>00284                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>= cu_new;
<a name="l00285"></a>00285                     cu_new-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>++;
<a name="l00286"></a>00286                     cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a82e3c1ecb3fc12d5ebb456ec7cdc2a0e">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--;
<a name="l00287"></a>00287                 }
<a name="l00288"></a>00288             }
<a name="l00289"></a>00289         }
<a name="l00290"></a>00290     }
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 <span class="comment">/* Get list of nurbs from editnurbs structure */</span>
<a name="l00294"></a><a class="code" href="../../dc/d22/curve_8c.html#afdc73f23f84efb8451471073957cb02c">00294</a> <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *<a class="code" href="../../d7/dfc/BKE__curve_8h.html#a444d55e9e251234b0c8e22da36a06819">curve_editnurbs</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu)
<a name="l00295"></a>00295 {
<a name="l00296"></a>00296     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>) {
<a name="l00297"></a>00297         <span class="keywordflow">return</span> &amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>-&gt;<a class="code" href="../../d7/d1d/structEditNurb.html#a5fff41daf219b371f9d18c0e38a14e40">nurbs</a>;
<a name="l00298"></a>00298     }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00301"></a>00301 }
<a name="l00302"></a>00302 
<a name="l00303"></a><a class="code" href="../../dc/d22/curve_8c.html#aaa95b550c11cdf182bbb8242834e2e47">00303</a> <span class="keywordtype">short</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#ab0eaa93ca0534495ecaa64345b75e6d3">curve_type</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu)
<a name="l00304"></a>00304 {
<a name="l00305"></a>00305     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l00306"></a>00306     <span class="keywordtype">int</span> type= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#afb10d1fffa5cd8a385429dc5f23ff5f5">type</a>;
<a name="l00307"></a>00307 
<a name="l00308"></a>00308     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a1735002958cbeb8aaf88094ef6596e78">vfont</a>) {
<a name="l00309"></a>00309         <span class="keywordflow">return</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1a94162b6fc469957966a01d41ff71d6">OB_FONT</a>;
<a name="l00310"></a>00310     }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312     <span class="keywordflow">if</span> (!cu-&gt;<a class="code" href="../../da/d10/structCurve.html#afb10d1fffa5cd8a385429dc5f23ff5f5">type</a>) {
<a name="l00313"></a>00313         type= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>;
<a name="l00314"></a>00314 
<a name="l00315"></a>00315         <span class="keywordflow">for</span> (nu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l00316"></a>00316             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>&gt;1) {
<a name="l00317"></a>00317                 type= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>;
<a name="l00318"></a>00318             }
<a name="l00319"></a>00319         }
<a name="l00320"></a>00320     }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322     <span class="keywordflow">return</span> type;
<a name="l00323"></a>00323 }
<a name="l00324"></a>00324 
<a name="l00325"></a><a class="code" href="../../dc/d22/curve_8c.html#a3d4487ef9a869f706e487491116e4b14">00325</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a513b4989ae4a003cc47e292e0843aaaf">update_curve_dimension</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu)
<a name="l00326"></a>00326 {
<a name="l00327"></a>00327     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nurbs= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a72ca081768fa9e5e257b5d6fbc08b0f3">BKE_curve_nurbs</a>(cu);
<a name="l00328"></a>00328     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu= nurbs-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00329"></a>00329 
<a name="l00330"></a>00330     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a>&amp;<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae2e952bfa23ce6735422c9e7bae27dac">CU_3D</a>) {
<a name="l00331"></a>00331         <span class="keywordflow">for</span> ( ; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l00332"></a>00332             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a3cf1c2dec47235e64740549f9bb2b5ff">flag</a> &amp;= ~<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aaff7c75290c54fa64f73a97718c2faf8">CU_2D</a>;
<a name="l00333"></a>00333         }
<a name="l00334"></a>00334     }
<a name="l00335"></a>00335     <span class="keywordflow">else</span> {
<a name="l00336"></a>00336         <span class="keywordflow">for</span> ( ; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l00337"></a>00337             nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a3cf1c2dec47235e64740549f9bb2b5ff">flag</a> |= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aaff7c75290c54fa64f73a97718c2faf8">CU_2D</a>;
<a name="l00338"></a>00338             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aae5669b490cbbe44c59fba3239f4223a">test2DNurb</a>(nu);
<a name="l00339"></a>00339 
<a name="l00340"></a>00340             <span class="comment">/* since the handles are moved they need to be auto-located again */</span>
<a name="l00341"></a>00341             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>)
<a name="l00342"></a>00342                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(nu);
<a name="l00343"></a>00343         }
<a name="l00344"></a>00344     }
<a name="l00345"></a>00345 }
<a name="l00346"></a>00346 
<a name="l00347"></a><a class="code" href="../../dc/d22/curve_8c.html#ae5128740fc06aebdfa947d773cfeedeb">00347</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aa0ab4d61e80f3ff4d2bfd56271ca831c">test_curve_type</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l00348"></a>00348 {
<a name="l00349"></a>00349     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#ab0eaa93ca0534495ecaa64345b75e6d3">curve_type</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l00350"></a>00350 
<a name="l00351"></a>00351     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>)
<a name="l00352"></a>00352         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a513b4989ae4a003cc47e292e0843aaaf">update_curve_dimension</a>((<a class="code" href="../../da/d10/structCurve.html">Curve</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l00353"></a>00353 }
<a name="l00354"></a>00354 
<a name="l00355"></a><a class="code" href="../../dc/d22/curve_8c.html#afe0bc2f02b6881d9dbdd26bcdb5b17a9">00355</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#ac9989f27fff5ac61b86a9e8ec3bf7863">tex_space_curve</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu)
<a name="l00356"></a>00356 {
<a name="l00357"></a>00357     <a class="code" href="../../d5/d2f/structDispList.html">DispList</a> *dl;
<a name="l00358"></a>00358     <a class="code" href="../../d3/d8a/structBoundBox.html">BoundBox</a> *bb;
<a name="l00359"></a>00359     <span class="keywordtype">float</span> *fp, <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>[3], <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>[3];
<a name="l00360"></a>00360     <span class="keywordtype">int</span> tot, doit= 0;
<a name="l00361"></a>00361     
<a name="l00362"></a>00362     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a523cd93ea45778db87896479460cd5d0">bb</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a523cd93ea45778db87896479460cd5d0">bb</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d3/d8a/structBoundBox.html">BoundBox</a>), <span class="stringliteral">&quot;boundbox&quot;</span>);
<a name="l00363"></a>00363     bb= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a523cd93ea45778db87896479460cd5d0">bb</a>;
<a name="l00364"></a>00364     
<a name="l00365"></a>00365     <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a329751705c70a4b2fd8a24744f172bb2">INIT_MINMAX</a>(min, max);
<a name="l00366"></a>00366 
<a name="l00367"></a>00367     dl= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a98794ad486b99d01cc752f9f94e856e5">disp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00368"></a>00368     <span class="keywordflow">while</span> (dl) {
<a name="l00369"></a>00369         
<a name="l00370"></a>00370         tot = <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a14a8a66c424ba6ecb972e49847b61483">type</a>, <a class="code" href="../../d9/d12/BKE__displist_8h.html#a8fdfde765231c4dfbe1df3f263abdd02">DL_INDEX3</a>, <a class="code" href="../../d9/d12/BKE__displist_8h.html#ac31985d3494fb5bb0f23b72f1cc28487">DL_INDEX4</a>) ? dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a> : dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a> * dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>;
<a name="l00371"></a>00371 
<a name="l00372"></a>00372         <span class="keywordflow">if</span> (tot) doit= 1;
<a name="l00373"></a>00373         fp= dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>;
<a name="l00374"></a>00374         <span class="keywordflow">while</span> (tot--) {
<a name="l00375"></a>00375             <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a56471388e0045022014f3a365af6b34a">DO_MINMAX</a>(fp, min, max);
<a name="l00376"></a>00376             fp += 3;
<a name="l00377"></a>00377         }
<a name="l00378"></a>00378         dl= dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a902acb76b3f3a2b20b0c9f755c652bf9">next</a>;
<a name="l00379"></a>00379     }
<a name="l00380"></a>00380 
<a name="l00381"></a>00381     <span class="keywordflow">if</span> (!doit) {
<a name="l00382"></a>00382         min[0] = min[1] = min[2] = -1.0f;
<a name="l00383"></a>00383         max[0] = max[1] = max[2] = 1.0f;
<a name="l00384"></a>00384     }
<a name="l00385"></a>00385 
<a name="l00386"></a>00386     <a class="code" href="../../df/dac/BKE__object_8h.html#af195012a626e055e795867bdb53d2dd3">boundbox_set_from_min_max</a>(bb, min, max);
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abda1aeabacab0375c8f75cc0d5f0d6c9">texflag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a7c5329f4f00c80d0b646713d748f11b4">CU_AUTOSPACE</a>) {
<a name="l00389"></a>00389         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ac3186a97188a3cf15bc5e2f8b0e97ad2">mid_v3_v3v3</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0e1c86cf707b01a2754d17a15df09914">loc</a>, min, max);
<a name="l00390"></a>00390         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[0]= (max[0]-min[0])/2.0f;
<a name="l00391"></a>00391         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[1]= (max[1]-min[1])/2.0f;
<a name="l00392"></a>00392         cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[2]= (max[2]-min[2])/2.0f;
<a name="l00393"></a>00393 
<a name="l00394"></a>00394         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#acd4d89007c860a4c74d459ac72593065">zero_v3</a>(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#aef863fdb79a55e637e50cbe8011a1f20">rot</a>);
<a name="l00395"></a>00395 
<a name="l00396"></a>00396         <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[0]==0.0f) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[0]= 1.0f;
<a name="l00397"></a>00397         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[0]&gt;0.0f &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[0]&lt;0.00001f) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[0]= 0.00001f;
<a name="l00398"></a>00398         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[0]&lt;0.0f &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[0]&gt; -0.00001f) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[0]= -0.00001f;
<a name="l00399"></a>00399     
<a name="l00400"></a>00400         <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[1]==0.0f) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[1]= 1.0f;
<a name="l00401"></a>00401         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[1]&gt;0.0f &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[1]&lt;0.00001f) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[1]= 0.00001f;
<a name="l00402"></a>00402         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[1]&lt;0.0f &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[1]&gt; -0.00001f) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[1]= -0.00001f;
<a name="l00403"></a>00403     
<a name="l00404"></a>00404         <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[2]==0.0f) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[2]= 1.0f;
<a name="l00405"></a>00405         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[2]&gt;0.0f &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[2]&lt;0.00001f) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[2]= 0.00001f;
<a name="l00406"></a>00406         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[2]&lt;0.0f &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[2]&gt; -0.00001f) cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[2]= -0.00001f;
<a name="l00407"></a>00407 
<a name="l00408"></a>00408     }
<a name="l00409"></a>00409 }
<a name="l00410"></a>00410 
<a name="l00411"></a><a class="code" href="../../dc/d22/curve_8c.html#a113249b3fd051cac30eccef0479f3bf4">00411</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#acbc43d8687324817662e3f0e713b514a">count_curveverts</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nurb)
<a name="l00412"></a>00412 {
<a name="l00413"></a>00413     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l00414"></a>00414     <span class="keywordtype">int</span> tot=0;
<a name="l00415"></a>00415     
<a name="l00416"></a>00416     nu= nurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00417"></a>00417     <span class="keywordflow">while</span> (nu) {
<a name="l00418"></a>00418         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) tot+= 3*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00419"></a>00419         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>) tot+= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l00420"></a>00420         
<a name="l00421"></a>00421         nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l00422"></a>00422     }
<a name="l00423"></a>00423     <span class="keywordflow">return</span> tot;
<a name="l00424"></a>00424 }
<a name="l00425"></a>00425 
<a name="l00426"></a><a class="code" href="../../dc/d22/curve_8c.html#af289340201ab1651d38545a5b5079faf">00426</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aa6d507e60623dd6e84920d4474d27b3e">count_curveverts_without_handles</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nurb)
<a name="l00427"></a>00427 {
<a name="l00428"></a>00428     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l00429"></a>00429     <span class="keywordtype">int</span> tot=0;
<a name="l00430"></a>00430     
<a name="l00431"></a>00431     nu= nurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00432"></a>00432     <span class="keywordflow">while</span> (nu) {
<a name="l00433"></a>00433         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) tot+= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00434"></a>00434         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>) tot+= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l00435"></a>00435         
<a name="l00436"></a>00436         nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l00437"></a>00437     }
<a name="l00438"></a>00438     <span class="keywordflow">return</span> tot;
<a name="l00439"></a>00439 }
<a name="l00440"></a>00440 
<a name="l00441"></a>00441 <span class="comment">/* **************** NURBS ROUTINES ******************** */</span>
<a name="l00442"></a>00442 
<a name="l00443"></a><a class="code" href="../../dc/d22/curve_8c.html#ac87888cc14b8c5cde53ec198fb843d29">00443</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a612d0057fcc6d1a836444e79a539a749">freeNurb</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l00444"></a>00444 {
<a name="l00445"></a>00445 
<a name="l00446"></a>00446     <span class="keywordflow">if</span> (nu==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>);
<a name="l00449"></a>00449     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00450"></a>00450     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>);
<a name="l00451"></a>00451     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00452"></a>00452     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>);
<a name="l00453"></a>00453     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00454"></a>00454     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>);
<a name="l00455"></a>00455     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00456"></a>00456     <span class="comment">/* if (nu-&gt;trim.first) freeNurblist(&amp;(nu-&gt;trim)); */</span>
<a name="l00457"></a>00457 
<a name="l00458"></a>00458     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu);
<a name="l00459"></a>00459 
<a name="l00460"></a>00460 }
<a name="l00461"></a>00461 
<a name="l00462"></a>00462 
<a name="l00463"></a><a class="code" href="../../dc/d22/curve_8c.html#aa461db7932899d6792477487f73db9ed">00463</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aa7e3a2bafad6c23e082515885ae5294a">freeNurblist</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb)
<a name="l00464"></a>00464 {
<a name="l00465"></a>00465     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l00466"></a>00466 
<a name="l00467"></a>00467     <span class="keywordflow">if</span> (lb==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00468"></a>00468 
<a name="l00469"></a>00469     nu= lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00470"></a>00470     <span class="keywordflow">while</span> (nu) {
<a name="l00471"></a>00471         next= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l00472"></a>00472         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a612d0057fcc6d1a836444e79a539a749">freeNurb</a>(nu);
<a name="l00473"></a>00473         nu= <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l00474"></a>00474     }
<a name="l00475"></a>00475     lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00476"></a>00476 }
<a name="l00477"></a>00477 
<a name="l00478"></a><a class="code" href="../../dc/d22/curve_8c.html#a6277ae93603d26cfee07eb85e51cbf52">00478</a> <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *<a class="code" href="../../d7/dfc/BKE__curve_8h.html#a0fde69c2411c891708933b3d79c97c34">duplicateNurb</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l00479"></a>00479 {
<a name="l00480"></a>00480     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *newnu;
<a name="l00481"></a>00481     <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l00482"></a>00482 
<a name="l00483"></a>00483     newnu= (<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>),<span class="stringliteral">&quot;duplicateNurb&quot;</span>);
<a name="l00484"></a>00484     <span class="keywordflow">if</span> (newnu==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00485"></a>00485     memcpy(newnu, nu, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a>));
<a name="l00486"></a>00486 
<a name="l00487"></a>00487     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l00488"></a>00488         newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>=
<a name="l00489"></a>00489             (<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>((nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>)* <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aafa4ace0bba7528ab007eabe81cbfc10">BezTriple</a>),<span class="stringliteral">&quot;duplicateNurb2&quot;</span>);
<a name="l00490"></a>00490         memcpy(newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*<span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>));
<a name="l00491"></a>00491     }
<a name="l00492"></a>00492     <span class="keywordflow">else</span> {
<a name="l00493"></a>00493         len= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l00494"></a>00494         newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>=
<a name="l00495"></a>00495             (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>*)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>((len)* <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af73d40f9d8f8b10f64359a0704799ac9">BPoint</a>),<span class="stringliteral">&quot;duplicateNurb3&quot;</span>);
<a name="l00496"></a>00496         memcpy(newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, len*<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>));
<a name="l00497"></a>00497         
<a name="l00498"></a>00498         newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>= newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00499"></a>00499         
<a name="l00500"></a>00500         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>) {
<a name="l00501"></a>00501             len= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a229d5ec44247fb38940870726ade9077">KNOTSU</a>(nu);
<a name="l00502"></a>00502             <span class="keywordflow">if</span> (len) {
<a name="l00503"></a>00503                 newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(len*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), <span class="stringliteral">&quot;duplicateNurb4&quot;</span>);
<a name="l00504"></a>00504                 memcpy(newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*len);
<a name="l00505"></a>00505             }
<a name="l00506"></a>00506         }
<a name="l00507"></a>00507         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>&gt;1 &amp;&amp; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>) {
<a name="l00508"></a>00508             len= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67f5d26ce1431098dc2c1d4282d8d7b0">KNOTSV</a>(nu);
<a name="l00509"></a>00509             <span class="keywordflow">if</span> (len) {
<a name="l00510"></a>00510                 newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(len*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), <span class="stringliteral">&quot;duplicateNurb5&quot;</span>);
<a name="l00511"></a>00511                 memcpy(newnu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*len);
<a name="l00512"></a>00512             }
<a name="l00513"></a>00513         }
<a name="l00514"></a>00514     }
<a name="l00515"></a>00515     <span class="keywordflow">return</span> newnu;
<a name="l00516"></a>00516 }
<a name="l00517"></a>00517 
<a name="l00518"></a><a class="code" href="../../dc/d22/curve_8c.html#a56a538705dbb8c65558d12d79b7ae8c6">00518</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a2d7201d0683bd58b17a190c9ea5ca1e4">duplicateNurblist</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb1, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb2)
<a name="l00519"></a>00519 {
<a name="l00520"></a>00520     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, *nun;
<a name="l00521"></a>00521     
<a name="l00522"></a>00522     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aa7e3a2bafad6c23e082515885ae5294a">freeNurblist</a>(lb1);
<a name="l00523"></a>00523     
<a name="l00524"></a>00524     nu= lb2-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00525"></a>00525     <span class="keywordflow">while</span> (nu) {
<a name="l00526"></a>00526         nun= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a0fde69c2411c891708933b3d79c97c34">duplicateNurb</a>(nu);
<a name="l00527"></a>00527         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(lb1, nun);
<a name="l00528"></a>00528         
<a name="l00529"></a>00529         nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l00530"></a>00530     }
<a name="l00531"></a>00531 }
<a name="l00532"></a>00532 
<a name="l00533"></a><a class="code" href="../../dc/d22/curve_8c.html#ae962bf29408b0fedcc881a7720874ad9">00533</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aae5669b490cbbe44c59fba3239f4223a">test2DNurb</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l00534"></a>00534 {
<a name="l00535"></a>00535     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l00536"></a>00536     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l00537"></a>00537     <span class="keywordtype">int</span> a;
<a name="l00538"></a>00538     
<a name="l00539"></a>00539     <span class="keywordflow">if</span> ((nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a3cf1c2dec47235e64740549f9bb2b5ff">flag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aaff7c75290c54fa64f73a97718c2faf8">CU_2D</a>)==0)
<a name="l00540"></a>00540         <span class="keywordflow">return</span>;
<a name="l00541"></a>00541 
<a name="l00542"></a>00542     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l00543"></a>00543         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00544"></a>00544         bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l00545"></a>00545         <span class="keywordflow">while</span> (a--) {
<a name="l00546"></a>00546             bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0][2]= 0.0; 
<a name="l00547"></a>00547             bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][2]= 0.0; 
<a name="l00548"></a>00548             bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2][2]= 0.0;
<a name="l00549"></a>00549             bezt++;
<a name="l00550"></a>00550         }
<a name="l00551"></a>00551     }
<a name="l00552"></a>00552     <span class="keywordflow">else</span> {
<a name="l00553"></a>00553         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l00554"></a>00554         bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l00555"></a>00555         <span class="keywordflow">while</span> (a--) {
<a name="l00556"></a>00556             bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[2]= 0.0;
<a name="l00557"></a>00557             bp++;
<a name="l00558"></a>00558         }
<a name="l00559"></a>00559     }
<a name="l00560"></a>00560 }
<a name="l00561"></a>00561 
<a name="l00562"></a><a class="code" href="../../dc/d22/curve_8c.html#acbe7ad4de8e8f4ab30388d662f5fef3d">00562</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aa0903caa3a4cfe1ae6c16545a9990fd6">minmaxNurb</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, <span class="keywordtype">float</span> *<a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>, <span class="keywordtype">float</span> *<a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>)
<a name="l00563"></a>00563 {
<a name="l00564"></a>00564     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l00565"></a>00565     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l00566"></a>00566     <span class="keywordtype">int</span> a;
<a name="l00567"></a>00567 
<a name="l00568"></a>00568     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l00569"></a>00569         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00570"></a>00570         bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l00571"></a>00571         <span class="keywordflow">while</span> (a--) {
<a name="l00572"></a>00572             <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a56471388e0045022014f3a365af6b34a">DO_MINMAX</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0], min, max);
<a name="l00573"></a>00573             <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a56471388e0045022014f3a365af6b34a">DO_MINMAX</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1], min, max);
<a name="l00574"></a>00574             <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a56471388e0045022014f3a365af6b34a">DO_MINMAX</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2], min, max);
<a name="l00575"></a>00575             bezt++;
<a name="l00576"></a>00576         }
<a name="l00577"></a>00577     }
<a name="l00578"></a>00578     <span class="keywordflow">else</span> {
<a name="l00579"></a>00579         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l00580"></a>00580         bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l00581"></a>00581         <span class="keywordflow">while</span> (a--) {
<a name="l00582"></a>00582             <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a56471388e0045022014f3a365af6b34a">DO_MINMAX</a>(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, min, max);
<a name="l00583"></a>00583             bp++;
<a name="l00584"></a>00584         }
<a name="l00585"></a>00585     }
<a name="l00586"></a>00586 }
<a name="l00587"></a>00587 
<a name="l00588"></a>00588 <span class="comment">/* be sure to call makeknots after this */</span>
<a name="l00589"></a><a class="code" href="../../dc/d22/curve_8c.html#a5b1e58e6ced275138777cb654873904c">00589</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aa133051ced1288525950505e84c5b6d3">addNurbPoints</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, <span class="keywordtype">int</span> number)
<a name="l00590"></a>00590 {
<a name="l00591"></a>00591     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *tmp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l00592"></a>00592     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00593"></a>00593     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>= (<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>((nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> + number) * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af73d40f9d8f8b10f64359a0704799ac9">BPoint</a>), <span class="stringliteral">&quot;rna_Curve_spline_points_add&quot;</span>);
<a name="l00594"></a>00594 
<a name="l00595"></a>00595     <span class="keywordflow">if</span> (tmp) {
<a name="l00596"></a>00596         memmove(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>, tmp, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>));
<a name="l00597"></a>00597         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(tmp);
<a name="l00598"></a>00598     }
<a name="l00599"></a>00599 
<a name="l00600"></a>00600     memset(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> + nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>, 0, number * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>));
<a name="l00601"></a>00601 
<a name="l00602"></a>00602     <span class="keywordflow">for</span> (i=0, tmp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a> + nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; i &lt; number; i++, tmp++) {
<a name="l00603"></a>00603         tmp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aa3142e8e1888fbd226cbe1d5ca47b4ac">radius</a>= 1.0f;
<a name="l00604"></a>00604     }
<a name="l00605"></a>00605 
<a name="l00606"></a>00606     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> += number;
<a name="l00607"></a>00607 }
<a name="l00608"></a>00608 
<a name="l00609"></a><a class="code" href="../../dc/d22/curve_8c.html#a003afd136196b122df2fc43156be84a7">00609</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#ac47f9c9252fe515d9a41237eb4bc9122">addNurbPointsBezier</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, <span class="keywordtype">int</span> number)
<a name="l00610"></a>00610 {
<a name="l00611"></a>00611     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *tmp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l00612"></a>00612     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00613"></a>00613     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>= (<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>((nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> + number) * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aafa4ace0bba7528ab007eabe81cbfc10">BezTriple</a>), <span class="stringliteral">&quot;rna_Curve_spline_points_add&quot;</span>);
<a name="l00614"></a>00614 
<a name="l00615"></a>00615     <span class="keywordflow">if</span> (tmp) {
<a name="l00616"></a>00616         memmove(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>, tmp, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>));
<a name="l00617"></a>00617         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(tmp);
<a name="l00618"></a>00618     }
<a name="l00619"></a>00619 
<a name="l00620"></a>00620     memset(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a> + nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>, 0, number * <span class="keyword">sizeof</span>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>));
<a name="l00621"></a>00621 
<a name="l00622"></a>00622     <span class="keywordflow">for</span> (i=0, tmp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a> + nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; i &lt; number; i++, tmp++) {
<a name="l00623"></a>00623         tmp-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a>= 1.0f;
<a name="l00624"></a>00624     }
<a name="l00625"></a>00625 
<a name="l00626"></a>00626     nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> += number;
<a name="l00627"></a>00627 }
<a name="l00628"></a>00628 
<a name="l00629"></a>00629 <span class="comment">/* ~~~~~~~~~~~~~~~~~~~~Non Uniform Rational B Spline calculations ~~~~~~~~~~~ */</span>
<a name="l00630"></a>00630 
<a name="l00631"></a>00631 
<a name="l00632"></a><a class="code" href="../../dc/d22/curve_8c.html#a8d87a423a90391145e5bf1bb27f2e5c4">00632</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#a8d87a423a90391145e5bf1bb27f2e5c4">calcknots</a>(<span class="keywordtype">float</span> *knots, <span class="keyword">const</span> <span class="keywordtype">short</span> pnts, <span class="keyword">const</span> <span class="keywordtype">short</span> order, <span class="keyword">const</span> <span class="keywordtype">short</span> flag)
<a name="l00633"></a>00633 {
<a name="l00634"></a>00634     <span class="comment">/* knots: number of pnts NOT corrected for cyclic */</span>
<a name="l00635"></a>00635     <span class="keyword">const</span> <span class="keywordtype">int</span> pnts_order= pnts + order;
<a name="l00636"></a>00636     <span class="keywordtype">float</span> k;
<a name="l00637"></a>00637     <span class="keywordtype">int</span> a;
<a name="l00638"></a>00638 
<a name="l00639"></a>00639     <span class="keywordflow">switch</span>(flag &amp; (<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a08714812d678ab6691f493c99a970286">CU_NURB_ENDPOINT</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a644364540eb9666e65a7039995b0fef8">CU_NURB_BEZIER</a>)) {
<a name="l00640"></a>00640     <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a08714812d678ab6691f493c99a970286">CU_NURB_ENDPOINT</a>:
<a name="l00641"></a>00641         k= 0.0;
<a name="l00642"></a>00642         <span class="keywordflow">for</span> (a=1; a &lt;= pnts_order; a++) {
<a name="l00643"></a>00643             knots[a-1]= k;
<a name="l00644"></a>00644             <span class="keywordflow">if</span> (a &gt;= order &amp;&amp; a &lt;= pnts) k+= 1.0f;
<a name="l00645"></a>00645         }
<a name="l00646"></a>00646         <span class="keywordflow">break</span>;
<a name="l00647"></a>00647     <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a644364540eb9666e65a7039995b0fef8">CU_NURB_BEZIER</a>:
<a name="l00648"></a>00648         <span class="comment">/* Warning, the order MUST be 2 or 4,</span>
<a name="l00649"></a>00649 <span class="comment">         * if this is not enforced, the displist will be corrupt */</span>
<a name="l00650"></a>00650         <span class="keywordflow">if</span> (order==4) {
<a name="l00651"></a>00651             k= 0.34;
<a name="l00652"></a>00652             <span class="keywordflow">for</span> (a=0; a &lt; pnts_order; a++) {
<a name="l00653"></a>00653                 knots[a]= <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(k);
<a name="l00654"></a>00654                 k+= (1.0f/3.0f);
<a name="l00655"></a>00655             }
<a name="l00656"></a>00656         }
<a name="l00657"></a>00657         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (order==3) {
<a name="l00658"></a>00658             k= 0.6f;
<a name="l00659"></a>00659             <span class="keywordflow">for</span> (a=0; a &lt; pnts_order; a++) {
<a name="l00660"></a>00660                 <span class="keywordflow">if</span> (a &gt;= order &amp;&amp; a &lt;= pnts) k+= 0.5f;
<a name="l00661"></a>00661                 knots[a]= <a class="code" href="../../dd/d06/BLI__math__base_8h.html#addfa7d645df6e3c96924f253d8fb9b48">floorf</a>(k);
<a name="l00662"></a>00662             }
<a name="l00663"></a>00663         }
<a name="l00664"></a>00664         <span class="keywordflow">else</span> {
<a name="l00665"></a>00665             printf(<span class="stringliteral">&quot;bez nurb curve order is not 3 or 4, should never happen\n&quot;</span>);
<a name="l00666"></a>00666         }
<a name="l00667"></a>00667         <span class="keywordflow">break</span>;
<a name="l00668"></a>00668     <span class="keywordflow">default</span>:
<a name="l00669"></a>00669         <span class="keywordflow">for</span> (a=0; a &lt; pnts_order; a++) {
<a name="l00670"></a>00670             knots[a]= (float)a;
<a name="l00671"></a>00671         }
<a name="l00672"></a>00672         <span class="keywordflow">break</span>;
<a name="l00673"></a>00673     }
<a name="l00674"></a>00674 }
<a name="l00675"></a>00675 
<a name="l00676"></a><a class="code" href="../../dc/d22/curve_8c.html#a6febeef5175924e04920f76ff8db275e">00676</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#a6febeef5175924e04920f76ff8db275e">makecyclicknots</a>(<span class="keywordtype">float</span> *knots, <span class="keywordtype">short</span> pnts, <span class="keywordtype">short</span> order)
<a name="l00677"></a>00677 <span class="comment">/* pnts, order: number of pnts NOT corrected for cyclic */</span>
<a name="l00678"></a>00678 {
<a name="l00679"></a>00679     <span class="keywordtype">int</span> a, b, order2, c;
<a name="l00680"></a>00680 
<a name="l00681"></a>00681     <span class="keywordflow">if</span> (knots==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00682"></a>00682 
<a name="l00683"></a>00683     order2=order-1;
<a name="l00684"></a>00684 
<a name="l00685"></a>00685     <span class="comment">/* do first long rows (order -1), remove identical knots at endpoints */</span>
<a name="l00686"></a>00686     <span class="keywordflow">if</span> (order&gt;2) {
<a name="l00687"></a>00687         b= pnts+order2;
<a name="l00688"></a>00688         <span class="keywordflow">for</span> (a=1; a&lt;order2; a++) {
<a name="l00689"></a>00689             <span class="keywordflow">if</span> (knots[b]!= knots[b-a]) <span class="keywordflow">break</span>;
<a name="l00690"></a>00690         }
<a name="l00691"></a>00691         <span class="keywordflow">if</span> (a==order2) knots[pnts+order-2]+= 1.0f;
<a name="l00692"></a>00692     }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694     b= order;
<a name="l00695"></a>00695         c=pnts + order + order2;
<a name="l00696"></a>00696     <span class="keywordflow">for</span> (a=pnts+order2; a&lt;c; a++) {
<a name="l00697"></a>00697         knots[a]= knots[a-1]+ (knots[b]-knots[b-1]);
<a name="l00698"></a>00698         b--;
<a name="l00699"></a>00699     }
<a name="l00700"></a>00700 }
<a name="l00701"></a>00701 
<a name="l00702"></a>00702 
<a name="l00703"></a>00703 
<a name="l00704"></a><a class="code" href="../../dc/d22/curve_8c.html#a05d2bf22901e676b2cdb7e68d40bc450">00704</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#a05d2bf22901e676b2cdb7e68d40bc450">makeknots</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, <span class="keywordtype">short</span> uv)
<a name="l00705"></a>00705 {
<a name="l00706"></a>00706     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l00707"></a>00707         <span class="keywordflow">if</span> (uv == 1) {
<a name="l00708"></a>00708             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>);
<a name="l00709"></a>00709             <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfc/BKE__curve_8h.html#afcb8fc1bb7820c4260d027f5b7a011e3">check_valid_nurb_u</a>(nu)) {
<a name="l00710"></a>00710                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(4+<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*<a class="code" href="../../d7/dfc/BKE__curve_8h.html#a229d5ec44247fb38940870726ade9077">KNOTSU</a>(nu), <span class="stringliteral">&quot;makeknots&quot;</span>);
<a name="l00711"></a>00711                 <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) {
<a name="l00712"></a>00712                     <a class="code" href="../../dc/d22/curve_8c.html#a8d87a423a90391145e5bf1bb27f2e5c4">calcknots</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>, 0);  <span class="comment">/* cyclic should be uniform */</span>
<a name="l00713"></a>00713                     <a class="code" href="../../dc/d22/curve_8c.html#a6febeef5175924e04920f76ff8db275e">makecyclicknots</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>);
<a name="l00714"></a>00714                 }
<a name="l00715"></a>00715                 <span class="keywordflow">else</span> {
<a name="l00716"></a>00716                     <a class="code" href="../../dc/d22/curve_8c.html#a8d87a423a90391145e5bf1bb27f2e5c4">calcknots</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a>);
<a name="l00717"></a>00717                 }
<a name="l00718"></a>00718             }
<a name="l00719"></a>00719             <span class="keywordflow">else</span> nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00720"></a>00720         
<a name="l00721"></a>00721         }
<a name="l00722"></a>00722         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (uv == 2) {
<a name="l00723"></a>00723             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>);
<a name="l00724"></a>00724             <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfc/BKE__curve_8h.html#a58b3e106cf926fda72a45e414be77d2e">check_valid_nurb_v</a>(nu)) {
<a name="l00725"></a>00725                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(4+<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*<a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67f5d26ce1431098dc2c1d4282d8d7b0">KNOTSV</a>(nu), <span class="stringliteral">&quot;makeknots&quot;</span>);
<a name="l00726"></a>00726                 <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ae1c344a45c028d3c2067864f5280854e">flagv</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) {
<a name="l00727"></a>00727                     <a class="code" href="../../dc/d22/curve_8c.html#a8d87a423a90391145e5bf1bb27f2e5c4">calcknots</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>, 0);  <span class="comment">/* cyclic should be uniform */</span>
<a name="l00728"></a>00728                     <a class="code" href="../../dc/d22/curve_8c.html#a6febeef5175924e04920f76ff8db275e">makecyclicknots</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>);
<a name="l00729"></a>00729                 }
<a name="l00730"></a>00730                 <span class="keywordflow">else</span> {
<a name="l00731"></a>00731                     <a class="code" href="../../dc/d22/curve_8c.html#a8d87a423a90391145e5bf1bb27f2e5c4">calcknots</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ae1c344a45c028d3c2067864f5280854e">flagv</a>);
<a name="l00732"></a>00732                 }
<a name="l00733"></a>00733             }
<a name="l00734"></a>00734             <span class="keywordflow">else</span> nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00735"></a>00735         }
<a name="l00736"></a>00736     }
<a name="l00737"></a>00737 }
<a name="l00738"></a>00738 
<a name="l00739"></a><a class="code" href="../../dc/d22/curve_8c.html#a080b43d864861e164d498170177416cb">00739</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#af6a7fc11136384bbdf3fab329a025962">nurbs_knot_calc_u</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l00740"></a>00740 {
<a name="l00741"></a>00741     <a class="code" href="../../dc/d22/curve_8c.html#a05d2bf22901e676b2cdb7e68d40bc450">makeknots</a>(nu, 1);
<a name="l00742"></a>00742 }
<a name="l00743"></a>00743 
<a name="l00744"></a><a class="code" href="../../dc/d22/curve_8c.html#af561a456ee614bd1fd1d0e1c4f772f00">00744</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67a9890171625dedc07c1b7566703ddb">nurbs_knot_calc_v</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l00745"></a>00745 {
<a name="l00746"></a>00746     <a class="code" href="../../dc/d22/curve_8c.html#a05d2bf22901e676b2cdb7e68d40bc450">makeknots</a>(nu, 2);
<a name="l00747"></a>00747 }
<a name="l00748"></a>00748 
<a name="l00749"></a><a class="code" href="../../dc/d22/curve_8c.html#a71094a0ced9f779aa5af395501cfabe4">00749</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#a71094a0ced9f779aa5af395501cfabe4">basisNurb</a>(<span class="keywordtype">float</span> t, <span class="keywordtype">short</span> order, <span class="keywordtype">short</span> pnts, <span class="keywordtype">float</span> *knots, <span class="keywordtype">float</span> *basis, <span class="keywordtype">int</span> *start, <span class="keywordtype">int</span> *end)
<a name="l00750"></a>00750 {
<a name="l00751"></a>00751     <span class="keywordtype">float</span> d, e;
<a name="l00752"></a>00752     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, i1 = 0, i2 = 0 ,j, orderpluspnts, opp2, o2;
<a name="l00753"></a>00753 
<a name="l00754"></a>00754     orderpluspnts= order+pnts;
<a name="l00755"></a>00755         opp2 = orderpluspnts-1;
<a name="l00756"></a>00756 
<a name="l00757"></a>00757     <span class="comment">/* this is for float inaccuracy */</span>
<a name="l00758"></a>00758     <span class="keywordflow">if</span> (t &lt; knots[0]) t= knots[0];
<a name="l00759"></a>00759     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t &gt; knots[opp2]) t= knots[opp2];
<a name="l00760"></a>00760 
<a name="l00761"></a>00761     <span class="comment">/* this part is order &#39;1&#39; */</span>
<a name="l00762"></a>00762         o2 = order + 1;
<a name="l00763"></a>00763     <span class="keywordflow">for</span> (i=0;i&lt;opp2;i++) {
<a name="l00764"></a>00764         <span class="keywordflow">if</span> (knots[i]!=knots[i+1] &amp;&amp; t&gt;= knots[i] &amp;&amp; t&lt;=knots[i+1]) {
<a name="l00765"></a>00765             basis[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]= 1.0;
<a name="l00766"></a>00766             i1= i-o2;
<a name="l00767"></a>00767             <span class="keywordflow">if</span> (i1&lt;0) i1= 0;
<a name="l00768"></a>00768             i2= <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00769"></a>00769             i++;
<a name="l00770"></a>00770             <span class="keywordflow">while</span> (i&lt;opp2) {
<a name="l00771"></a>00771                 basis[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]= 0.0;
<a name="l00772"></a>00772                 i++;
<a name="l00773"></a>00773             }
<a name="l00774"></a>00774             <span class="keywordflow">break</span>;
<a name="l00775"></a>00775         }
<a name="l00776"></a>00776         <span class="keywordflow">else</span> basis[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]= 0.0;
<a name="l00777"></a>00777     }
<a name="l00778"></a>00778     basis[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]= 0.0;
<a name="l00779"></a>00779     
<a name="l00780"></a>00780     <span class="comment">/* this is order 2,3,... */</span>
<a name="l00781"></a>00781     <span class="keywordflow">for</span> (j=2; j&lt;=order; j++) {
<a name="l00782"></a>00782 
<a name="l00783"></a>00783         <span class="keywordflow">if</span> (i2+j&gt;= orderpluspnts) i2= opp2-j;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785         <span class="keywordflow">for</span> (i= i1; i&lt;=i2; i++) {
<a name="l00786"></a>00786             <span class="keywordflow">if</span> (basis[i]!=0.0f)
<a name="l00787"></a>00787                 d= ((t-knots[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>])*basis[i]) / (knots[i+j-1]-knots[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);
<a name="l00788"></a>00788             <span class="keywordflow">else</span>
<a name="l00789"></a>00789                 d= 0.0f;
<a name="l00790"></a>00790 
<a name="l00791"></a>00791             <span class="keywordflow">if</span> (basis[i+1] != 0.0f)
<a name="l00792"></a>00792                 e= ((knots[i+j]-t)*basis[i+1]) / (knots[i+j]-knots[i+1]);
<a name="l00793"></a>00793             <span class="keywordflow">else</span>
<a name="l00794"></a>00794                 e= 0.0;
<a name="l00795"></a>00795 
<a name="l00796"></a>00796             basis[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]= d+e;
<a name="l00797"></a>00797         }
<a name="l00798"></a>00798     }
<a name="l00799"></a>00799 
<a name="l00800"></a>00800     *start= 1000;
<a name="l00801"></a>00801     *end= 0;
<a name="l00802"></a>00802 
<a name="l00803"></a>00803     <span class="keywordflow">for</span> (i=i1; i&lt;=i2; i++) {
<a name="l00804"></a>00804         <span class="keywordflow">if</span> (basis[i] &gt; 0.0f) {
<a name="l00805"></a>00805             *end= <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00806"></a>00806             <span class="keywordflow">if</span> (*start==1000) *start= <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00807"></a>00807         }
<a name="l00808"></a>00808     }
<a name="l00809"></a>00809 }
<a name="l00810"></a>00810 
<a name="l00811"></a>00811 
<a name="l00812"></a><a class="code" href="../../dc/d22/curve_8c.html#acad2f901dadf73804dec430e130badd1">00812</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a12ec1dee5fde57a2d6070759dd21a15b">makeNurbfaces</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, <span class="keywordtype">float</span> *coord_array, <span class="keywordtype">int</span> rowstride, <span class="keywordtype">int</span> resolu, <span class="keywordtype">int</span> resolv)
<a name="l00813"></a>00813 <span class="comment">/* coord_array  has to be 3*4*resolu*resolv in size, and zero-ed */</span>
<a name="l00814"></a>00814 {
<a name="l00815"></a>00815     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l00816"></a>00816     <span class="keywordtype">float</span> *basisu, *basis, *basisv, *<a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a746bfa686f2dce5b1cff46bba26ac803">sum</a>, *fp, *in;
<a name="l00817"></a>00817     <span class="keywordtype">float</span> u, v, ustart, uend, ustep, vstart, vend, vstep, sumdiv;
<a name="l00818"></a>00818     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j, iofs, jofs, cycl, <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>, curu, curv;
<a name="l00819"></a>00819     <span class="keywordtype">int</span> istart, iend, jsta, jen, *jstart, *jend, ratcomp;
<a name="l00820"></a>00820     
<a name="l00821"></a>00821     <span class="keywordtype">int</span> totu = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*resolu, totv = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>*resolv;
<a name="l00822"></a>00822     
<a name="l00823"></a>00823     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00824"></a>00824     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>&gt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) <span class="keywordflow">return</span>;
<a name="l00825"></a>00825     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>&gt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>) <span class="keywordflow">return</span>;
<a name="l00826"></a>00826     <span class="keywordflow">if</span> (coord_array==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00827"></a>00827     
<a name="l00828"></a>00828     <span class="comment">/* allocate and initialize */</span>
<a name="l00829"></a>00829     len = totu * totv;
<a name="l00830"></a>00830     <span class="keywordflow">if</span> (len==0) <span class="keywordflow">return</span>;
<a name="l00831"></a>00831     
<a name="l00832"></a>00832 
<a name="l00833"></a>00833     
<a name="l00834"></a>00834     sum= (<span class="keywordtype">float</span> *)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>, <span class="stringliteral">&quot;makeNurbfaces1&quot;</span>);
<a name="l00835"></a>00835     
<a name="l00836"></a>00836     len= totu*totv;
<a name="l00837"></a>00837     <span class="keywordflow">if</span> (len==0) {
<a name="l00838"></a>00838         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(sum);
<a name="l00839"></a>00839         <span class="keywordflow">return</span>;
<a name="l00840"></a>00840     }
<a name="l00841"></a>00841 
<a name="l00842"></a>00842     bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l00843"></a>00843     i= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l00844"></a>00844     ratcomp=0;
<a name="l00845"></a>00845     <span class="keywordflow">while</span> (i--) {
<a name="l00846"></a>00846         <span class="keywordflow">if</span> (bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[3] != 1.0f) {
<a name="l00847"></a>00847             ratcomp= 1;
<a name="l00848"></a>00848             <span class="keywordflow">break</span>;
<a name="l00849"></a>00849         }
<a name="l00850"></a>00850         bp++;
<a name="l00851"></a>00851     }
<a name="l00852"></a>00852     
<a name="l00853"></a>00853     fp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>;
<a name="l00854"></a>00854     ustart= fp[nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>-1];
<a name="l00855"></a>00855     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) uend= fp[nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>+nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>-1];
<a name="l00856"></a>00856     <span class="keywordflow">else</span> uend= fp[nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>];
<a name="l00857"></a>00857     ustep= (uend-ustart)/((nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) ? totu : totu - 1);
<a name="l00858"></a>00858     
<a name="l00859"></a>00859     basisu= (<span class="keywordtype">float</span> *)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*<a class="code" href="../../d7/dfc/BKE__curve_8h.html#a229d5ec44247fb38940870726ade9077">KNOTSU</a>(nu), <span class="stringliteral">&quot;makeNurbfaces3&quot;</span>);
<a name="l00860"></a>00860 
<a name="l00861"></a>00861     fp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>;
<a name="l00862"></a>00862     vstart= fp[nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>-1];
<a name="l00863"></a>00863     
<a name="l00864"></a>00864     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ae1c344a45c028d3c2067864f5280854e">flagv</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) vend= fp[nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>+nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>-1];
<a name="l00865"></a>00865     <span class="keywordflow">else</span> vend= fp[nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>];
<a name="l00866"></a>00866     vstep= (vend-vstart)/((nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ae1c344a45c028d3c2067864f5280854e">flagv</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) ? totv : totv - 1);
<a name="l00867"></a>00867     
<a name="l00868"></a>00868     len= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67f5d26ce1431098dc2c1d4282d8d7b0">KNOTSV</a>(nu);
<a name="l00869"></a>00869     basisv= (<span class="keywordtype">float</span> *)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*len*totv, <span class="stringliteral">&quot;makeNurbfaces3&quot;</span>);
<a name="l00870"></a>00870     jstart= (<span class="keywordtype">int</span> *)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*totv, <span class="stringliteral">&quot;makeNurbfaces4&quot;</span>);
<a name="l00871"></a>00871     jend= (<span class="keywordtype">int</span> *)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*totv, <span class="stringliteral">&quot;makeNurbfaces5&quot;</span>);
<a name="l00872"></a>00872 
<a name="l00873"></a>00873     <span class="comment">/* precalculation of basisv and jstart,jend */</span>
<a name="l00874"></a>00874     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ae1c344a45c028d3c2067864f5280854e">flagv</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) cycl= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>-1; 
<a name="l00875"></a>00875     <span class="keywordflow">else</span> cycl= 0;
<a name="l00876"></a>00876     v= vstart;
<a name="l00877"></a>00877     basis= basisv;
<a name="l00878"></a>00878     curv= totv;
<a name="l00879"></a>00879     <span class="keywordflow">while</span> (curv--) {
<a name="l00880"></a>00880         <a class="code" href="../../dc/d22/curve_8c.html#a71094a0ced9f779aa5af395501cfabe4">basisNurb</a>(v, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>, (<span class="keywordtype">short</span>)(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>+cycl), nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a685aeb6811a4102b617366961f933087">knotsv</a>, basis, jstart+curv, jend+curv);
<a name="l00881"></a>00881         basis+= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67f5d26ce1431098dc2c1d4282d8d7b0">KNOTSV</a>(nu);
<a name="l00882"></a>00882         v+= vstep;
<a name="l00883"></a>00883     }
<a name="l00884"></a>00884 
<a name="l00885"></a>00885     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) cycl= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>-1; 
<a name="l00886"></a>00886     <span class="keywordflow">else</span> cycl= 0;
<a name="l00887"></a>00887     in= coord_array;
<a name="l00888"></a>00888     u= ustart;
<a name="l00889"></a>00889     curu= totu;
<a name="l00890"></a>00890     <span class="keywordflow">while</span> (curu--) {
<a name="l00891"></a>00891 
<a name="l00892"></a>00892         <a class="code" href="../../dc/d22/curve_8c.html#a71094a0ced9f779aa5af395501cfabe4">basisNurb</a>(u, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>, (<span class="keywordtype">short</span>)(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>+cycl), nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>, basisu, &amp;istart, &amp;iend);
<a name="l00893"></a>00893 
<a name="l00894"></a>00894         basis= basisv;
<a name="l00895"></a>00895         curv= totv;
<a name="l00896"></a>00896         <span class="keywordflow">while</span> (curv--) {
<a name="l00897"></a>00897 
<a name="l00898"></a>00898             jsta= jstart[curv];
<a name="l00899"></a>00899             jen= jend[curv];
<a name="l00900"></a>00900 
<a name="l00901"></a>00901             <span class="comment">/* calculate sum */</span>
<a name="l00902"></a>00902             sumdiv= 0.0;
<a name="l00903"></a>00903             fp= <a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a746bfa686f2dce5b1cff46bba26ac803">sum</a>;
<a name="l00904"></a>00904 
<a name="l00905"></a>00905             <span class="keywordflow">for</span> (j= jsta; j&lt;=jen; j++) {
<a name="l00906"></a>00906 
<a name="l00907"></a>00907                 <span class="keywordflow">if</span> (j&gt;=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>) jofs= (j - nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>);
<a name="l00908"></a>00908                 <span class="keywordflow">else</span> jofs= j;
<a name="l00909"></a>00909                 bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+ nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*jofs+istart-1;
<a name="l00910"></a>00910 
<a name="l00911"></a>00911                 <span class="keywordflow">for</span> (i= istart; i&lt;=iend; i++, fp++) {
<a name="l00912"></a>00912 
<a name="l00913"></a>00913                     <span class="keywordflow">if</span> (i&gt;= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) {
<a name="l00914"></a>00914                         iofs= i- nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00915"></a>00915                         bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+ nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*jofs+iofs;
<a name="l00916"></a>00916                     }
<a name="l00917"></a>00917                     <span class="keywordflow">else</span> bp++;
<a name="l00918"></a>00918 
<a name="l00919"></a>00919                     <span class="keywordflow">if</span> (ratcomp) {
<a name="l00920"></a>00920                         *fp= basisu[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]*basis[j]*bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[3];
<a name="l00921"></a>00921                         sumdiv+= *fp;
<a name="l00922"></a>00922                     }
<a name="l00923"></a>00923                     <span class="keywordflow">else</span> *fp= basisu[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]*basis[j];
<a name="l00924"></a>00924                 }
<a name="l00925"></a>00925             }
<a name="l00926"></a>00926         
<a name="l00927"></a>00927             <span class="keywordflow">if</span> (ratcomp) {
<a name="l00928"></a>00928                 fp= <a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a746bfa686f2dce5b1cff46bba26ac803">sum</a>;
<a name="l00929"></a>00929                 <span class="keywordflow">for</span> (j= jsta; j&lt;=jen; j++) {
<a name="l00930"></a>00930                     <span class="keywordflow">for</span> (i= istart; i&lt;=iend; i++, fp++) {
<a name="l00931"></a>00931                         *fp/= sumdiv;
<a name="l00932"></a>00932                     }
<a name="l00933"></a>00933                 }
<a name="l00934"></a>00934             }
<a name="l00935"></a>00935 
<a name="l00936"></a>00936             <span class="comment">/* one! (1.0) real point now */</span>
<a name="l00937"></a>00937             fp= <a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a746bfa686f2dce5b1cff46bba26ac803">sum</a>;
<a name="l00938"></a>00938             <span class="keywordflow">for</span> (j= jsta; j&lt;=jen; j++) {
<a name="l00939"></a>00939 
<a name="l00940"></a>00940                 <span class="keywordflow">if</span> (j&gt;=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>) jofs= (j - nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>);
<a name="l00941"></a>00941                 <span class="keywordflow">else</span> jofs= j;
<a name="l00942"></a>00942                 bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+ nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*jofs+istart-1;
<a name="l00943"></a>00943 
<a name="l00944"></a>00944                 <span class="keywordflow">for</span> (i= istart; i&lt;=iend; i++, fp++) {
<a name="l00945"></a>00945 
<a name="l00946"></a>00946                     <span class="keywordflow">if</span> (i&gt;= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) {
<a name="l00947"></a>00947                         iofs= i- nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00948"></a>00948                         bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+ nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*jofs+iofs;
<a name="l00949"></a>00949                     }
<a name="l00950"></a>00950                     <span class="keywordflow">else</span> bp++;
<a name="l00951"></a>00951 
<a name="l00952"></a>00952                     <span class="keywordflow">if</span> (*fp != 0.0f) {
<a name="l00953"></a>00953                         in[0]+= (*fp) * bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[0];
<a name="l00954"></a>00954                         in[1]+= (*fp) * bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[1];
<a name="l00955"></a>00955                         in[2]+= (*fp) * bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[2];
<a name="l00956"></a>00956                     }
<a name="l00957"></a>00957                 }
<a name="l00958"></a>00958             }
<a name="l00959"></a>00959 
<a name="l00960"></a>00960             in+=3;
<a name="l00961"></a>00961             basis+= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a67f5d26ce1431098dc2c1d4282d8d7b0">KNOTSV</a>(nu);
<a name="l00962"></a>00962         }
<a name="l00963"></a>00963         u+= ustep;
<a name="l00964"></a>00964         <span class="keywordflow">if</span> (rowstride!=0) in = (<span class="keywordtype">float</span>*) (((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) in) + (rowstride - 3*totv*<span class="keyword">sizeof</span>(*in)));
<a name="l00965"></a>00965     }
<a name="l00966"></a>00966 
<a name="l00967"></a>00967     <span class="comment">/* free */</span>
<a name="l00968"></a>00968     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(sum);
<a name="l00969"></a>00969     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(basisu);
<a name="l00970"></a>00970     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(basisv);
<a name="l00971"></a>00971     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(jstart);
<a name="l00972"></a>00972     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(jend);
<a name="l00973"></a>00973 }
<a name="l00974"></a>00974 
<a name="l00975"></a><a class="code" href="../../dc/d22/curve_8c.html#ab4b8983268ad94e5517af1cc84aba7b5">00975</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a356a46488b92435335439582cc4213e5">makeNurbcurve</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, <span class="keywordtype">float</span> *coord_array, <span class="keywordtype">float</span> *tilt_array, <span class="keywordtype">float</span> *radius_array, <span class="keywordtype">float</span> *weight_array, <span class="keywordtype">int</span> resolu, <span class="keywordtype">int</span> stride)
<a name="l00976"></a>00976 <span class="comment">/* coord_array has to be 3*4*pntsu*resolu in size and zero-ed</span>
<a name="l00977"></a>00977 <span class="comment"> * tilt_array and radius_array will be written to if valid */</span>
<a name="l00978"></a>00978 {
<a name="l00979"></a>00979     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l00980"></a>00980     <span class="keywordtype">float</span> u, ustart, uend, ustep, sumdiv;
<a name="l00981"></a>00981     <span class="keywordtype">float</span> *basisu, *<a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a746bfa686f2dce5b1cff46bba26ac803">sum</a>, *fp;
<a name="l00982"></a>00982     <span class="keywordtype">float</span> *coord_fp= coord_array, *tilt_fp= tilt_array, *radius_fp= radius_array, *weight_fp= weight_array;
<a name="l00983"></a>00983     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>, istart, iend, cycl;
<a name="l00984"></a>00984 
<a name="l00985"></a>00985     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00986"></a>00986     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>&gt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) <span class="keywordflow">return</span>;
<a name="l00987"></a>00987     <span class="keywordflow">if</span> (coord_array==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00988"></a>00988 
<a name="l00989"></a>00989     <span class="comment">/* allocate and initialize */</span>
<a name="l00990"></a>00990     len= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l00991"></a>00991     <span class="keywordflow">if</span> (len==0) <span class="keywordflow">return</span>;
<a name="l00992"></a>00992     sum= (<span class="keywordtype">float</span> *)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>, <span class="stringliteral">&quot;makeNurbcurve1&quot;</span>);
<a name="l00993"></a>00993     
<a name="l00994"></a>00994     resolu= (resolu*<a class="code" href="../../d7/dfc/BKE__curve_8h.html#adc36b28f69d2b06891837ba681f6c78e">SEGMENTSU</a>(nu));
<a name="l00995"></a>00995     
<a name="l00996"></a>00996     <span class="keywordflow">if</span> (resolu==0) {
<a name="l00997"></a>00997         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(sum);
<a name="l00998"></a>00998         <span class="keywordflow">return</span>;
<a name="l00999"></a>00999     }
<a name="l01000"></a>01000 
<a name="l01001"></a>01001     fp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>;
<a name="l01002"></a>01002     ustart= fp[nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>-1];
<a name="l01003"></a>01003     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) uend= fp[nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>+nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>-1];
<a name="l01004"></a>01004     <span class="keywordflow">else</span> uend= fp[nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>];
<a name="l01005"></a>01005     ustep= (uend-ustart)/(resolu - ((nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) ? 0 : 1));
<a name="l01006"></a>01006     
<a name="l01007"></a>01007     basisu= (<span class="keywordtype">float</span> *)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*<a class="code" href="../../d7/dfc/BKE__curve_8h.html#a229d5ec44247fb38940870726ade9077">KNOTSU</a>(nu), <span class="stringliteral">&quot;makeNurbcurve3&quot;</span>);
<a name="l01008"></a>01008 
<a name="l01009"></a>01009     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) cycl= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>-1; 
<a name="l01010"></a>01010     <span class="keywordflow">else</span> cycl= 0;
<a name="l01011"></a>01011 
<a name="l01012"></a>01012     u= ustart;
<a name="l01013"></a>01013     <span class="keywordflow">while</span> (resolu--) {
<a name="l01014"></a>01014 
<a name="l01015"></a>01015         <a class="code" href="../../dc/d22/curve_8c.html#a71094a0ced9f779aa5af395501cfabe4">basisNurb</a>(u, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>, (<span class="keywordtype">short</span>)(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>+cycl), nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>, basisu, &amp;istart, &amp;iend);
<a name="l01016"></a>01016         <span class="comment">/* calc sum */</span>
<a name="l01017"></a>01017         sumdiv= 0.0;
<a name="l01018"></a>01018         fp= <a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a746bfa686f2dce5b1cff46bba26ac803">sum</a>;
<a name="l01019"></a>01019         bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+ istart-1;
<a name="l01020"></a>01020         <span class="keywordflow">for</span> (i= istart; i&lt;=iend; i++, fp++) {
<a name="l01021"></a>01021 
<a name="l01022"></a>01022             <span class="keywordflow">if</span> (i&gt;=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+(i - nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>);
<a name="l01023"></a>01023             <span class="keywordflow">else</span> bp++;
<a name="l01024"></a>01024 
<a name="l01025"></a>01025             *fp= basisu[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]*bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[3];
<a name="l01026"></a>01026             sumdiv+= *fp;
<a name="l01027"></a>01027         }
<a name="l01028"></a>01028         <span class="keywordflow">if</span> (sumdiv != 0.0f) <span class="keywordflow">if</span> (sumdiv &lt; 0.999f || sumdiv &gt; 1.001f) {
<a name="l01029"></a>01029             <span class="comment">/* is normalizing needed? */</span>
<a name="l01030"></a>01030             fp= <a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a746bfa686f2dce5b1cff46bba26ac803">sum</a>;
<a name="l01031"></a>01031             <span class="keywordflow">for</span> (i= istart; i&lt;=iend; i++, fp++) {
<a name="l01032"></a>01032                 *fp/= sumdiv;
<a name="l01033"></a>01033             }
<a name="l01034"></a>01034         }
<a name="l01035"></a>01035 
<a name="l01036"></a>01036         <span class="comment">/* one! (1.0) real point */</span>
<a name="l01037"></a>01037         fp= <a class="code" href="../../de/da0/btSoftBodyHelpers_8cpp.html#a746bfa686f2dce5b1cff46bba26ac803">sum</a>;
<a name="l01038"></a>01038         bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+ istart-1;
<a name="l01039"></a>01039         <span class="keywordflow">for</span> (i= istart; i&lt;=iend; i++, fp++) {
<a name="l01040"></a>01040 
<a name="l01041"></a>01041             <span class="keywordflow">if</span> (i&gt;=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>) bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+(i - nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>);
<a name="l01042"></a>01042             <span class="keywordflow">else</span> bp++;
<a name="l01043"></a>01043 
<a name="l01044"></a>01044             <span class="keywordflow">if</span> (*fp != 0.0f) {
<a name="l01045"></a>01045                 
<a name="l01046"></a>01046                 coord_fp[0]+= (*fp) * bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[0];
<a name="l01047"></a>01047                 coord_fp[1]+= (*fp) * bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[1];
<a name="l01048"></a>01048                 coord_fp[2]+= (*fp) * bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>[2];
<a name="l01049"></a>01049                 
<a name="l01050"></a>01050                 <span class="keywordflow">if</span> (tilt_fp)
<a name="l01051"></a>01051                     (*tilt_fp) += (*fp) * bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a1210ec737d6ced5cf276e22e8ca277f8">alfa</a>;
<a name="l01052"></a>01052                 
<a name="l01053"></a>01053                 <span class="keywordflow">if</span> (radius_fp)
<a name="l01054"></a>01054                     (*radius_fp) += (*fp) * bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aa3142e8e1888fbd226cbe1d5ca47b4ac">radius</a>;
<a name="l01055"></a>01055 
<a name="l01056"></a>01056                 <span class="keywordflow">if</span> (weight_fp)
<a name="l01057"></a>01057                     (*weight_fp) += (*fp) * bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a35879465825fbbab506bf4ccf2bbd8c2">weight</a>;
<a name="l01058"></a>01058                 
<a name="l01059"></a>01059             }
<a name="l01060"></a>01060         }
<a name="l01061"></a>01061 
<a name="l01062"></a>01062         coord_fp = (<span class="keywordtype">float</span> *)(((<span class="keywordtype">char</span> *)coord_fp) + stride);
<a name="l01063"></a>01063         
<a name="l01064"></a>01064         <span class="keywordflow">if</span> (tilt_fp)    tilt_fp = (<span class="keywordtype">float</span> *)(((<span class="keywordtype">char</span> *)tilt_fp) + stride);
<a name="l01065"></a>01065         <span class="keywordflow">if</span> (radius_fp)  radius_fp = (<span class="keywordtype">float</span> *)(((<span class="keywordtype">char</span> *)radius_fp) + stride);
<a name="l01066"></a>01066         <span class="keywordflow">if</span> (weight_fp)  weight_fp = (<span class="keywordtype">float</span> *)(((<span class="keywordtype">char</span> *)weight_fp) + stride);
<a name="l01067"></a>01067         
<a name="l01068"></a>01068         u+= ustep;
<a name="l01069"></a>01069     }
<a name="l01070"></a>01070 
<a name="l01071"></a>01071     <span class="comment">/* free */</span>
<a name="l01072"></a>01072     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(sum);
<a name="l01073"></a>01073     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(basisu);
<a name="l01074"></a>01074 }
<a name="l01075"></a>01075 
<a name="l01076"></a>01076 <span class="comment">/* forward differencing method for bezier curve */</span>
<a name="l01077"></a><a class="code" href="../../dc/d22/curve_8c.html#a44c2709924870c4af9d9268f691a63e0">01077</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a44c2709924870c4af9d9268f691a63e0">forward_diff_bezier</a>(<span class="keywordtype">float</span> q0, <span class="keywordtype">float</span> q1, <span class="keywordtype">float</span> q2, <span class="keywordtype">float</span> q3, <span class="keywordtype">float</span> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>, <span class="keywordtype">int</span> it, <span class="keywordtype">int</span> stride)
<a name="l01078"></a>01078 {
<a name="l01079"></a>01079     <span class="keywordtype">float</span> rt0,rt1,rt2,rt3,f;
<a name="l01080"></a>01080     <span class="keywordtype">int</span> a;
<a name="l01081"></a>01081 
<a name="l01082"></a>01082     f= (float)it;
<a name="l01083"></a>01083     rt0= q0;
<a name="l01084"></a>01084     rt1= 3.0f*(q1-q0)/f;
<a name="l01085"></a>01085     f*= f;
<a name="l01086"></a>01086     rt2= 3.0f*(q0-2.0f*q1+q2)/f;
<a name="l01087"></a>01087     f*= it;
<a name="l01088"></a>01088     rt3= (q3-q0+3.0f*(q1-q2))/f;
<a name="l01089"></a>01089 
<a name="l01090"></a>01090     q0= rt0;
<a name="l01091"></a>01091     q1= rt1+rt2+rt3;
<a name="l01092"></a>01092     q2= 2*rt2+6*rt3;
<a name="l01093"></a>01093     q3= 6*rt3;
<a name="l01094"></a>01094 
<a name="l01095"></a>01095     <span class="keywordflow">for</span> (a=0; a&lt;=it; a++) {
<a name="l01096"></a>01096         *p= q0;
<a name="l01097"></a>01097         p = (<span class="keywordtype">float</span> *)(((<span class="keywordtype">char</span> *)<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>)+stride);
<a name="l01098"></a>01098         q0+= q1;
<a name="l01099"></a>01099         q1+= q2;
<a name="l01100"></a>01100         q2+= q3;
<a name="l01101"></a>01101     }
<a name="l01102"></a>01102 }
<a name="l01103"></a>01103 
<a name="l01104"></a><a class="code" href="../../dc/d22/curve_8c.html#a62929b6c48aed7b5705855f2db5cfc93">01104</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#a62929b6c48aed7b5705855f2db5cfc93">forward_diff_bezier_cotangent</a>(<span class="keywordtype">float</span> *p0, <span class="keywordtype">float</span> *p1, <span class="keywordtype">float</span> *p2, <span class="keywordtype">float</span> *p3, <span class="keywordtype">float</span> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>, <span class="keywordtype">int</span> it, <span class="keywordtype">int</span> stride)
<a name="l01105"></a>01105 {
<a name="l01106"></a>01106     <span class="comment">/* note that these are not purpendicular to the curve</span>
<a name="l01107"></a>01107 <span class="comment">     * they need to be rotated for this,</span>
<a name="l01108"></a>01108 <span class="comment">     *</span>
<a name="l01109"></a>01109 <span class="comment">     * This could also be optimized like forward_diff_bezier */</span>
<a name="l01110"></a>01110     <span class="keywordtype">int</span> a;
<a name="l01111"></a>01111     <span class="keywordflow">for</span> (a=0; a&lt;=it; a++) {
<a name="l01112"></a>01112         <span class="keywordtype">float</span> t = (float)a / (<span class="keywordtype">float</span>)it;
<a name="l01113"></a>01113 
<a name="l01114"></a>01114         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01115"></a>01115         <span class="keywordflow">for</span> (i=0; i&lt;3; i++) {
<a name="l01116"></a>01116             p[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]= (-6*t + 6)*p0[i] + (18*t - 12)*p1[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] + (-18*t + 6)*p2[i] + (6*t)*p3[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01117"></a>01117         }
<a name="l01118"></a>01118         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(p);
<a name="l01119"></a>01119         p = (<span class="keywordtype">float</span> *)(((<span class="keywordtype">char</span> *)p)+stride);
<a name="l01120"></a>01120     }
<a name="l01121"></a>01121 }
<a name="l01122"></a>01122 
<a name="l01123"></a>01123 <span class="comment">/* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ */</span>
<a name="l01124"></a>01124 
<a name="l01125"></a><a class="code" href="../../dc/d22/curve_8c.html#a54f98d517c408f4ff5f53cbf3e88a53c">01125</a> <span class="keywordtype">float</span> *<a class="code" href="../../d7/dfc/BKE__curve_8h.html#a9dda72d82c2cedb90cb0085118e3b6b5">make_orco_surf</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l01126"></a>01126 {
<a name="l01127"></a>01127     <span class="comment">/* Note: this function is used in convertblender only atm, so</span>
<a name="l01128"></a>01128 <span class="comment">     * suppose nonzero curve&#39;s render resolution should always be used */</span>
<a name="l01129"></a>01129     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01130"></a>01130     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l01131"></a>01131     <span class="keywordtype">int</span> a, b, tot=0;
<a name="l01132"></a>01132     <span class="keywordtype">int</span> sizeu, sizev;
<a name="l01133"></a>01133     <span class="keywordtype">int</span> resolu, resolv;
<a name="l01134"></a>01134     <span class="keywordtype">float</span> *fp, *coord_array;
<a name="l01135"></a>01135     
<a name="l01136"></a>01136     <span class="comment">/* first calculate the size of the datablock */</span>
<a name="l01137"></a>01137     nu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01138"></a>01138     <span class="keywordflow">while</span> (nu) {
<a name="l01139"></a>01139         <span class="comment">/* as we want to avoid the seam in a cyclic nurbs</span>
<a name="l01140"></a>01140 <span class="comment">         * texture wrapping, reserve extra orco data space to save these extra needed</span>
<a name="l01141"></a>01141 <span class="comment">         * vertex based UV coordinates for the meridian vertices.</span>
<a name="l01142"></a>01142 <span class="comment">         * Vertices on the 0/2pi boundary are not duplicated inside the displist but later in</span>
<a name="l01143"></a>01143 <span class="comment">         * the renderface/vert construction.</span>
<a name="l01144"></a>01144 <span class="comment">         *</span>
<a name="l01145"></a>01145 <span class="comment">         * See also convertblender.c: init_render_surf()</span>
<a name="l01146"></a>01146 <span class="comment">         */</span>
<a name="l01147"></a>01147 
<a name="l01148"></a>01148         resolu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af7040ffbe95c9d62cd327296a1752b5e">resolu_ren</a> ? cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af7040ffbe95c9d62cd327296a1752b5e">resolu_ren</a> : nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#aa4d5f2ef5e32e94dcbe14a1a7d946a30">resolu</a>;
<a name="l01149"></a>01149         resolv= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a639add4859024a9072a0d68836013edc">resolv_ren</a> ? cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a639add4859024a9072a0d68836013edc">resolv_ren</a> : nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ab9ca5b497098466d579b0343cbe62ae7">resolv</a>;
<a name="l01150"></a>01150         
<a name="l01151"></a>01151         sizeu = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*resolu;
<a name="l01152"></a>01152         sizev = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>*resolv;
<a name="l01153"></a>01153         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) sizeu++;
<a name="l01154"></a>01154         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ae1c344a45c028d3c2067864f5280854e">flagv</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) sizev++;
<a name="l01155"></a>01155         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>&gt;1) tot+= sizeu * sizev;
<a name="l01156"></a>01156         
<a name="l01157"></a>01157         nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l01158"></a>01158     }
<a name="l01159"></a>01159     <span class="comment">/* makeNurbfaces wants zeros */</span>
<a name="l01160"></a>01160     fp= coord_array= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(3*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*tot, <span class="stringliteral">&quot;make_orco&quot;</span>);
<a name="l01161"></a>01161     
<a name="l01162"></a>01162     nu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01163"></a>01163     <span class="keywordflow">while</span> (nu) {
<a name="l01164"></a>01164         resolu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af7040ffbe95c9d62cd327296a1752b5e">resolu_ren</a> ? cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af7040ffbe95c9d62cd327296a1752b5e">resolu_ren</a> : nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#aa4d5f2ef5e32e94dcbe14a1a7d946a30">resolu</a>;
<a name="l01165"></a>01165         resolv= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a639add4859024a9072a0d68836013edc">resolv_ren</a> ? cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a639add4859024a9072a0d68836013edc">resolv_ren</a> : nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ab9ca5b497098466d579b0343cbe62ae7">resolv</a>;
<a name="l01166"></a>01166 
<a name="l01167"></a>01167         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>&gt;1) {
<a name="l01168"></a>01168             sizeu = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*resolu;
<a name="l01169"></a>01169             sizev = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>*resolv;
<a name="l01170"></a>01170             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) sizeu++;
<a name="l01171"></a>01171             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ae1c344a45c028d3c2067864f5280854e">flagv</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) sizev++;
<a name="l01172"></a>01172             
<a name="l01173"></a>01173             <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a0d3924cf8507e9810ae3e1c0d65cf770">CU_UV_ORCO</a>) {
<a name="l01174"></a>01174                 <span class="keywordflow">for</span> (b=0; b&lt; sizeu; b++) {
<a name="l01175"></a>01175                     <span class="keywordflow">for</span> (a=0; a&lt; sizev; a++) {
<a name="l01176"></a>01176                         
<a name="l01177"></a>01177                         <span class="keywordflow">if</span> (sizev &lt;2) fp[0]= 0.0f;
<a name="l01178"></a>01178                         <span class="keywordflow">else</span> fp[0]= -1.0f + 2.0f*((float)a)/(sizev - 1);
<a name="l01179"></a>01179                         
<a name="l01180"></a>01180                         <span class="keywordflow">if</span> (sizeu &lt;2) fp[1]= 0.0f;
<a name="l01181"></a>01181                         <span class="keywordflow">else</span> fp[1]= -1.0f + 2.0f*((float)b)/(sizeu - 1);
<a name="l01182"></a>01182                         
<a name="l01183"></a>01183                         fp[2]= 0.0;
<a name="l01184"></a>01184                         
<a name="l01185"></a>01185                         fp+= 3;
<a name="l01186"></a>01186                     }
<a name="l01187"></a>01187                 }
<a name="l01188"></a>01188             }
<a name="l01189"></a>01189             <span class="keywordflow">else</span> {
<a name="l01190"></a>01190                 <span class="keywordtype">float</span> *_tdata= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>((nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*resolu) * (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>*resolv) *3*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), <span class="stringliteral">&quot;temp data&quot;</span>);
<a name="l01191"></a>01191                 <span class="keywordtype">float</span> *tdata= _tdata;
<a name="l01192"></a>01192                 
<a name="l01193"></a>01193                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a12ec1dee5fde57a2d6070759dd21a15b">makeNurbfaces</a>(nu, tdata, 0, resolu, resolv);
<a name="l01194"></a>01194                 
<a name="l01195"></a>01195                 <span class="keywordflow">for</span> (b=0; b&lt;sizeu; b++) {
<a name="l01196"></a>01196                     <span class="keywordtype">int</span> use_b= b;
<a name="l01197"></a>01197                     <span class="keywordflow">if</span> (b==sizeu-1 &amp;&amp; (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>))
<a name="l01198"></a>01198                         use_b= 0;
<a name="l01199"></a>01199                     
<a name="l01200"></a>01200                     <span class="keywordflow">for</span> (a=0; a&lt;sizev; a++) {
<a name="l01201"></a>01201                         <span class="keywordtype">int</span> use_a= a;
<a name="l01202"></a>01202                         <span class="keywordflow">if</span> (a==sizev-1 &amp;&amp; (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ae1c344a45c028d3c2067864f5280854e">flagv</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>))
<a name="l01203"></a>01203                             use_a= 0;
<a name="l01204"></a>01204                         
<a name="l01205"></a>01205                         tdata = _tdata + 3 * (use_b * (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>*resolv) + use_a);
<a name="l01206"></a>01206                         
<a name="l01207"></a>01207                         fp[0]= (tdata[0]-cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0e1c86cf707b01a2754d17a15df09914">loc</a>[0])/cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[0];
<a name="l01208"></a>01208                         fp[1]= (tdata[1]-cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0e1c86cf707b01a2754d17a15df09914">loc</a>[1])/cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[1];
<a name="l01209"></a>01209                         fp[2]= (tdata[2]-cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0e1c86cf707b01a2754d17a15df09914">loc</a>[2])/cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[2];
<a name="l01210"></a>01210                         fp+= 3;
<a name="l01211"></a>01211                     }
<a name="l01212"></a>01212                 }
<a name="l01213"></a>01213                 
<a name="l01214"></a>01214                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(_tdata);
<a name="l01215"></a>01215             }
<a name="l01216"></a>01216         }
<a name="l01217"></a>01217         nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l01218"></a>01218     }
<a name="l01219"></a>01219     
<a name="l01220"></a>01220     <span class="keywordflow">return</span> coord_array;
<a name="l01221"></a>01221 }
<a name="l01222"></a>01222 
<a name="l01223"></a>01223 
<a name="l01224"></a>01224     <span class="comment">/* NOTE: This routine is tied to the order of vertex</span>
<a name="l01225"></a>01225 <span class="comment">     * built by displist and as passed to the renderer.</span>
<a name="l01226"></a>01226 <span class="comment">     */</span>
<a name="l01227"></a><a class="code" href="../../dc/d22/curve_8c.html#aaa274c75bb75f57f9770f316abb80618">01227</a> <span class="keywordtype">float</span> *<a class="code" href="../../d7/dfc/BKE__curve_8h.html#ae880524adbd5635089ac6750409f67ae">make_orco_curve</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l01228"></a>01228 {
<a name="l01229"></a>01229     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu = ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01230"></a>01230     <a class="code" href="../../d5/d2f/structDispList.html">DispList</a> *dl;
<a name="l01231"></a>01231     <span class="keywordtype">int</span> u, v, numVerts;
<a name="l01232"></a>01232     <span class="keywordtype">float</span> *fp, *coord_array;
<a name="l01233"></a>01233     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> disp = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01234"></a>01234 
<a name="l01235"></a>01235     <a class="code" href="../../d9/d12/BKE__displist_8h.html#a3581a6622e791749f682c34db4a08259">makeDispListCurveTypes_forOrco</a>(scene, ob, &amp;disp);
<a name="l01236"></a>01236 
<a name="l01237"></a>01237     numVerts = 0;
<a name="l01238"></a>01238     <span class="keywordflow">for</span> (dl=disp.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; dl; dl=dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a902acb76b3f3a2b20b0c9f755c652bf9">next</a>) {
<a name="l01239"></a>01239         <span class="keywordflow">if</span> (dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a14a8a66c424ba6ecb972e49847b61483">type</a>==<a class="code" href="../../d9/d12/BKE__displist_8h.html#a8fdfde765231c4dfbe1df3f263abdd02">DL_INDEX3</a>) {
<a name="l01240"></a>01240             numVerts += dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>;
<a name="l01241"></a>01241         }
<a name="l01242"></a>01242         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a14a8a66c424ba6ecb972e49847b61483">type</a>==<a class="code" href="../../d9/d12/BKE__displist_8h.html#aa264a2c12f3c058a0b62f7ea6dccbefa">DL_SURF</a>) {
<a name="l01243"></a>01243             <span class="comment">/* convertblender.c uses the Surface code for creating renderfaces when cyclic U only (closed circle beveling) */</span>
<a name="l01244"></a>01244             <span class="keywordflow">if</span> (dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#ab71643e664ff559f5e798fc7fc4cfe55">flag</a> &amp; <a class="code" href="../../d9/d12/BKE__displist_8h.html#aa455c760328fd01bc0e18aa819f4bb10">DL_CYCL_U</a>) {
<a name="l01245"></a>01245                 <span class="keywordflow">if</span> (dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#ab71643e664ff559f5e798fc7fc4cfe55">flag</a> &amp; <a class="code" href="../../d9/d12/BKE__displist_8h.html#ac44be4fcc9a60be5fc4dc0074cee889c">DL_CYCL_V</a>)
<a name="l01246"></a>01246                     numVerts += (dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>+1)*(dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>+1);
<a name="l01247"></a>01247                 <span class="keywordflow">else</span>
<a name="l01248"></a>01248                     numVerts += dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>*(dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>+1);
<a name="l01249"></a>01249             }
<a name="l01250"></a>01250             <span class="keywordflow">else</span>
<a name="l01251"></a>01251                 numVerts += dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>*dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>;
<a name="l01252"></a>01252         }
<a name="l01253"></a>01253     }
<a name="l01254"></a>01254 
<a name="l01255"></a>01255     fp= coord_array= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(3*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*numVerts, <span class="stringliteral">&quot;cu_orco&quot;</span>);
<a name="l01256"></a>01256     <span class="keywordflow">for</span> (dl=disp.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; dl; dl=dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a902acb76b3f3a2b20b0c9f755c652bf9">next</a>) {
<a name="l01257"></a>01257         <span class="keywordflow">if</span> (dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a14a8a66c424ba6ecb972e49847b61483">type</a>==<a class="code" href="../../d9/d12/BKE__displist_8h.html#a8fdfde765231c4dfbe1df3f263abdd02">DL_INDEX3</a>) {
<a name="l01258"></a>01258             <span class="keywordflow">for</span> (u=0; u&lt;dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>; u++, fp+=3) {
<a name="l01259"></a>01259                 <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a0d3924cf8507e9810ae3e1c0d65cf770">CU_UV_ORCO</a>) {
<a name="l01260"></a>01260                     fp[0]= 2.0f*u/(dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>-1) - 1.0f;
<a name="l01261"></a>01261                     fp[1]= 0.0;
<a name="l01262"></a>01262                     fp[2]= 0.0;
<a name="l01263"></a>01263                 }
<a name="l01264"></a>01264                 <span class="keywordflow">else</span> {
<a name="l01265"></a>01265                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(fp, &amp;dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>[u*3]);
<a name="l01266"></a>01266 
<a name="l01267"></a>01267                     fp[0]= (fp[0]-cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0e1c86cf707b01a2754d17a15df09914">loc</a>[0])/cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[0];
<a name="l01268"></a>01268                     fp[1]= (fp[1]-cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0e1c86cf707b01a2754d17a15df09914">loc</a>[1])/cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[1];
<a name="l01269"></a>01269                     fp[2]= (fp[2]-cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0e1c86cf707b01a2754d17a15df09914">loc</a>[2])/cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[2];
<a name="l01270"></a>01270                 }
<a name="l01271"></a>01271             }
<a name="l01272"></a>01272         }
<a name="l01273"></a>01273         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a14a8a66c424ba6ecb972e49847b61483">type</a>==<a class="code" href="../../d9/d12/BKE__displist_8h.html#aa264a2c12f3c058a0b62f7ea6dccbefa">DL_SURF</a>) {
<a name="l01274"></a>01274             <span class="keywordtype">int</span> sizeu= dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>, sizev= dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>;
<a name="l01275"></a>01275             
<a name="l01276"></a>01276             <span class="comment">/* exception as handled in convertblender.c too */</span>
<a name="l01277"></a>01277             <span class="keywordflow">if</span> (dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#ab71643e664ff559f5e798fc7fc4cfe55">flag</a> &amp; <a class="code" href="../../d9/d12/BKE__displist_8h.html#aa455c760328fd01bc0e18aa819f4bb10">DL_CYCL_U</a>) {
<a name="l01278"></a>01278                 sizeu++;
<a name="l01279"></a>01279                 <span class="keywordflow">if</span> (dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#ab71643e664ff559f5e798fc7fc4cfe55">flag</a> &amp; <a class="code" href="../../d9/d12/BKE__displist_8h.html#ac44be4fcc9a60be5fc4dc0074cee889c">DL_CYCL_V</a>)
<a name="l01280"></a>01280                     sizev++;
<a name="l01281"></a>01281             }
<a name="l01282"></a>01282             
<a name="l01283"></a>01283             <span class="keywordflow">for</span> (u=0; u&lt;sizev; u++) {
<a name="l01284"></a>01284                 <span class="keywordflow">for</span> (v=0; v&lt;sizeu; v++,fp+=3) {
<a name="l01285"></a>01285                     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a0d3924cf8507e9810ae3e1c0d65cf770">CU_UV_ORCO</a>) {
<a name="l01286"></a>01286                         fp[0]= 2.0f*u/(sizev - 1) - 1.0f;
<a name="l01287"></a>01287                         fp[1]= 2.0f*v/(sizeu - 1) - 1.0f;
<a name="l01288"></a>01288                         fp[2]= 0.0;
<a name="l01289"></a>01289                     }
<a name="l01290"></a>01290                     <span class="keywordflow">else</span> {
<a name="l01291"></a>01291                         <span class="keywordtype">float</span> *vert;
<a name="l01292"></a>01292                         <span class="keywordtype">int</span> realv= v % dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>;
<a name="l01293"></a>01293                         <span class="keywordtype">int</span> realu= u % dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>;
<a name="l01294"></a>01294                         
<a name="l01295"></a>01295                         vert= dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a> + 3*(dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>*realu + realv);
<a name="l01296"></a>01296                         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(fp, vert);
<a name="l01297"></a>01297 
<a name="l01298"></a>01298                         fp[0]= (fp[0]-cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0e1c86cf707b01a2754d17a15df09914">loc</a>[0])/cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[0];
<a name="l01299"></a>01299                         fp[1]= (fp[1]-cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0e1c86cf707b01a2754d17a15df09914">loc</a>[1])/cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[1];
<a name="l01300"></a>01300                         fp[2]= (fp[2]-cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0e1c86cf707b01a2754d17a15df09914">loc</a>[2])/cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af8034f1be4e7efb108b379efa5f84893">size</a>[2];
<a name="l01301"></a>01301                     }
<a name="l01302"></a>01302                 }
<a name="l01303"></a>01303             }
<a name="l01304"></a>01304         }
<a name="l01305"></a>01305     }
<a name="l01306"></a>01306 
<a name="l01307"></a>01307     <a class="code" href="../../d9/d12/BKE__displist_8h.html#a561c3ea04fd61b48f782bfea0aae53ad">freedisplist</a>(&amp;disp);
<a name="l01308"></a>01308 
<a name="l01309"></a>01309     <span class="keywordflow">return</span> coord_array;
<a name="l01310"></a>01310 }
<a name="l01311"></a>01311 
<a name="l01312"></a>01312 
<a name="l01313"></a>01313 <span class="comment">/* ***************** BEVEL ****************** */</span>
<a name="l01314"></a>01314 
<a name="l01315"></a><a class="code" href="../../dc/d22/curve_8c.html#a8af73a5269326a6c72a604dd948b256b">01315</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#ae74d44688279c6c2a9a90fe1fe9f57b0">makebevelcurve</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *disp, <span class="keywordtype">int</span> forRender)
<a name="l01316"></a>01316 {
<a name="l01317"></a>01317     <a class="code" href="../../d5/d2f/structDispList.html">DispList</a> *dl, *dlnew;
<a name="l01318"></a>01318     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *bevcu, *cu;
<a name="l01319"></a>01319     <span class="keywordtype">float</span> *fp, facx, facy, <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>, dangle;
<a name="l01320"></a>01320     <span class="keywordtype">int</span> nr, a;
<a name="l01321"></a>01321 
<a name="l01322"></a>01322     cu= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01323"></a>01323     disp-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> = disp-&gt;<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01324"></a>01324 
<a name="l01325"></a>01325     <span class="comment">/* if a font object is being edited, then do nothing */</span>
<a name="l01326"></a>01326 <span class="comment">// XXX  if ( ob == obedit &amp;&amp; ob-&gt;type == OB_FONT ) return;</span>
<a name="l01327"></a>01327 
<a name="l01328"></a>01328     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0051539d4e4be6831fed5babb371b19b">bevobj</a>) {
<a name="l01329"></a>01329         <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0051539d4e4be6831fed5babb371b19b">bevobj</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>!=<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>) <span class="keywordflow">return</span>;
<a name="l01330"></a>01330 
<a name="l01331"></a>01331         bevcu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0051539d4e4be6831fed5babb371b19b">bevobj</a>-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01332"></a>01332         <span class="keywordflow">if</span> (bevcu-&gt;<a class="code" href="../../da/d10/structCurve.html#a22c6cd81bc29dbb30accecc67979e587">ext1</a>==0.0f &amp;&amp; bevcu-&gt;<a class="code" href="../../da/d10/structCurve.html#add39d47101587c286cd77e2045bc9129">ext2</a>==0.0f) {
<a name="l01333"></a>01333             <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> bevdisp= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01334"></a>01334             facx= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0051539d4e4be6831fed5babb371b19b">bevobj</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a46e0f5309f8c13d85e16fa6436acf9f8">size</a>[0];
<a name="l01335"></a>01335             facy= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0051539d4e4be6831fed5babb371b19b">bevobj</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a46e0f5309f8c13d85e16fa6436acf9f8">size</a>[1];
<a name="l01336"></a>01336 
<a name="l01337"></a>01337             <span class="keywordflow">if</span> (forRender) {
<a name="l01338"></a>01338                 <a class="code" href="../../d9/d12/BKE__displist_8h.html#ad3c2aea8dfb62e81cb04fdfbfa5a51a3">makeDispListCurveTypes_forRender</a>(scene, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0051539d4e4be6831fed5babb371b19b">bevobj</a>, &amp;bevdisp, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);
<a name="l01339"></a>01339                 dl= bevdisp.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01340"></a>01340             }
<a name="l01341"></a>01341             <span class="keywordflow">else</span> {
<a name="l01342"></a>01342                 dl= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0051539d4e4be6831fed5babb371b19b">bevobj</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a45d11e4826c3a8ba292c91691bb2885d">disp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01343"></a>01343                 <span class="keywordflow">if</span> (dl==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01344"></a>01344                     <a class="code" href="../../d9/d12/BKE__displist_8h.html#a5ca43234b8f9db71b0318b29716b5487">makeDispListCurveTypes</a>(scene, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0051539d4e4be6831fed5babb371b19b">bevobj</a>, 0);
<a name="l01345"></a>01345                     dl= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0051539d4e4be6831fed5babb371b19b">bevobj</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a45d11e4826c3a8ba292c91691bb2885d">disp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01346"></a>01346                 }
<a name="l01347"></a>01347             }
<a name="l01348"></a>01348 
<a name="l01349"></a>01349             <span class="keywordflow">while</span> (dl) {
<a name="l01350"></a>01350                 <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a14a8a66c424ba6ecb972e49847b61483">type</a>, <a class="code" href="../../d9/d12/BKE__displist_8h.html#a0402654c17f3e8795c9d987a25b83c6f">DL_POLY</a>, <a class="code" href="../../d9/d12/BKE__displist_8h.html#ad298e077cdc5f0f6e4d4060fbb08618c">DL_SEGM</a>)) {
<a name="l01351"></a>01351                     dlnew= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d2f/structDispList.html">DispList</a>), <span class="stringliteral">&quot;makebevelcurve1&quot;</span>);
<a name="l01352"></a>01352                     *dlnew= *dl;
<a name="l01353"></a>01353                     dlnew-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(3*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>*dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>, <span class="stringliteral">&quot;makebevelcurve1&quot;</span>);
<a name="l01354"></a>01354                     memcpy(dlnew-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>, dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>, 3*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>*dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>);
<a name="l01355"></a>01355 
<a name="l01356"></a>01356                     <span class="keywordflow">if</span> (dlnew-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a14a8a66c424ba6ecb972e49847b61483">type</a>==<a class="code" href="../../d9/d12/BKE__displist_8h.html#ad298e077cdc5f0f6e4d4060fbb08618c">DL_SEGM</a>) dlnew-&gt;<a class="code" href="../../d5/d2f/structDispList.html#ab71643e664ff559f5e798fc7fc4cfe55">flag</a> |= (<a class="code" href="../../d9/d12/BKE__displist_8h.html#ac4c4dd1a39dc5345704b90bb5176255c">DL_FRONT_CURVE</a>|<a class="code" href="../../d9/d12/BKE__displist_8h.html#a9c8358fc1d2658c9b9425df2c80f4d1a">DL_BACK_CURVE</a>);
<a name="l01357"></a>01357 
<a name="l01358"></a>01358                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(disp, dlnew);
<a name="l01359"></a>01359                     fp= dlnew-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>;
<a name="l01360"></a>01360                     nr= dlnew-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>*dlnew-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>;
<a name="l01361"></a>01361                     <span class="keywordflow">while</span> (nr--) {
<a name="l01362"></a>01362                         fp[2]= fp[1]*facy;
<a name="l01363"></a>01363                         fp[1]= -fp[0]*facx;
<a name="l01364"></a>01364                         fp[0]= 0.0;
<a name="l01365"></a>01365                         fp+= 3;
<a name="l01366"></a>01366                     }
<a name="l01367"></a>01367                 }
<a name="l01368"></a>01368                 dl= dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a902acb76b3f3a2b20b0c9f755c652bf9">next</a>;
<a name="l01369"></a>01369             }
<a name="l01370"></a>01370 
<a name="l01371"></a>01371             <a class="code" href="../../d9/d12/BKE__displist_8h.html#a561c3ea04fd61b48f782bfea0aae53ad">freedisplist</a>(&amp;bevdisp);
<a name="l01372"></a>01372         }
<a name="l01373"></a>01373     }
<a name="l01374"></a>01374     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a22c6cd81bc29dbb30accecc67979e587">ext1</a>==0.0f &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#add39d47101587c286cd77e2045bc9129">ext2</a>==0.0f) {
<a name="l01375"></a>01375         ;
<a name="l01376"></a>01376     }
<a name="l01377"></a>01377     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#add39d47101587c286cd77e2045bc9129">ext2</a>==0.0f) {
<a name="l01378"></a>01378         dl= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d2f/structDispList.html">DispList</a>), <span class="stringliteral">&quot;makebevelcurve2&quot;</span>);
<a name="l01379"></a>01379         dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(2*3*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), <span class="stringliteral">&quot;makebevelcurve2&quot;</span>);
<a name="l01380"></a>01380         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(disp, dl);
<a name="l01381"></a>01381         dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a14a8a66c424ba6ecb972e49847b61483">type</a>= <a class="code" href="../../d9/d12/BKE__displist_8h.html#ad298e077cdc5f0f6e4d4060fbb08618c">DL_SEGM</a>;
<a name="l01382"></a>01382         dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>= 1;
<a name="l01383"></a>01383         dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#ab71643e664ff559f5e798fc7fc4cfe55">flag</a>= <a class="code" href="../../d9/d12/BKE__displist_8h.html#ac4c4dd1a39dc5345704b90bb5176255c">DL_FRONT_CURVE</a>|<a class="code" href="../../d9/d12/BKE__displist_8h.html#a9c8358fc1d2658c9b9425df2c80f4d1a">DL_BACK_CURVE</a>;
<a name="l01384"></a>01384         dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>= 2;
<a name="l01385"></a>01385         
<a name="l01386"></a>01386         fp= dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>;
<a name="l01387"></a>01387         fp[0]= fp[1]= 0.0;
<a name="l01388"></a>01388         fp[2]= -cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a22c6cd81bc29dbb30accecc67979e587">ext1</a>;
<a name="l01389"></a>01389         fp[3]= fp[4]= 0.0;
<a name="l01390"></a>01390         fp[5]= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a22c6cd81bc29dbb30accecc67979e587">ext1</a>;
<a name="l01391"></a>01391     }
<a name="l01392"></a>01392     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> &amp; (<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a582ba8cae7a48052e26e3fd58bd0cd6a">CU_FRONT</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a81cf8279edc9b7a31cdc56d0a36e1a87">CU_BACK</a>))==0 &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a22c6cd81bc29dbb30accecc67979e587">ext1</a>==0.0f) { <span class="comment">// we make a full round bevel in that case</span>
<a name="l01393"></a>01393         
<a name="l01394"></a>01394         nr= 4+ 2*cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a632137c42cceb1370dd865f64daae1d7">bevresol</a>;
<a name="l01395"></a>01395            
<a name="l01396"></a>01396         dl= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d2f/structDispList.html">DispList</a>), <span class="stringliteral">&quot;makebevelcurve p1&quot;</span>);
<a name="l01397"></a>01397         dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(nr*3*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), <span class="stringliteral">&quot;makebevelcurve p1&quot;</span>);
<a name="l01398"></a>01398         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(disp, dl);
<a name="l01399"></a>01399         dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a14a8a66c424ba6ecb972e49847b61483">type</a>= <a class="code" href="../../d9/d12/BKE__displist_8h.html#a0402654c17f3e8795c9d987a25b83c6f">DL_POLY</a>;
<a name="l01400"></a>01400         dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>= 1;
<a name="l01401"></a>01401         dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#ab71643e664ff559f5e798fc7fc4cfe55">flag</a>= <a class="code" href="../../d9/d12/BKE__displist_8h.html#a9c8358fc1d2658c9b9425df2c80f4d1a">DL_BACK_CURVE</a>;
<a name="l01402"></a>01402         dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>= nr;
<a name="l01403"></a>01403 
<a name="l01404"></a>01404         <span class="comment">/* a circle */</span>
<a name="l01405"></a>01405         fp= dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>;
<a name="l01406"></a>01406         dangle= (2.0f*(float)<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/(nr));
<a name="l01407"></a>01407         angle= -(nr-1)*dangle;
<a name="l01408"></a>01408         
<a name="l01409"></a>01409         <span class="keywordflow">for</span> (a=0; a&lt;nr; a++) {
<a name="l01410"></a>01410             fp[0]= 0.0;
<a name="l01411"></a>01411             fp[1]= (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#a2503b77b52ff481a3507a596ae1f3938">cosf</a>(angle)*(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#add39d47101587c286cd77e2045bc9129">ext2</a>));
<a name="l01412"></a>01412             fp[2]= (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#a1a55e3226c270625a4bff1befa977638">sinf</a>(angle)*(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#add39d47101587c286cd77e2045bc9129">ext2</a>)) - cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a22c6cd81bc29dbb30accecc67979e587">ext1</a>;
<a name="l01413"></a>01413             angle+= dangle;
<a name="l01414"></a>01414             fp+= 3;
<a name="l01415"></a>01415         }
<a name="l01416"></a>01416     }
<a name="l01417"></a>01417     <span class="keywordflow">else</span> {
<a name="l01418"></a>01418         <span class="keywordtype">short</span> dnr;
<a name="l01419"></a>01419         
<a name="l01420"></a>01420         <span class="comment">/* bevel now in three parts, for proper vertex normals */</span>
<a name="l01421"></a>01421         <span class="comment">/* part 1, back */</span>
<a name="l01422"></a>01422 
<a name="l01423"></a>01423         <span class="keywordflow">if</span> ((cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a81cf8279edc9b7a31cdc56d0a36e1a87">CU_BACK</a>) || !(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a582ba8cae7a48052e26e3fd58bd0cd6a">CU_FRONT</a>)) {
<a name="l01424"></a>01424             dnr= nr= 2+ cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a632137c42cceb1370dd865f64daae1d7">bevresol</a>;
<a name="l01425"></a>01425             <span class="keywordflow">if</span> ( (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> &amp; (<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a582ba8cae7a48052e26e3fd58bd0cd6a">CU_FRONT</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a81cf8279edc9b7a31cdc56d0a36e1a87">CU_BACK</a>))==0)
<a name="l01426"></a>01426                 nr= 3+ 2*cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a632137c42cceb1370dd865f64daae1d7">bevresol</a>;
<a name="l01427"></a>01427 
<a name="l01428"></a>01428             dl= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d2f/structDispList.html">DispList</a>), <span class="stringliteral">&quot;makebevelcurve p1&quot;</span>);
<a name="l01429"></a>01429             dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(nr*3*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), <span class="stringliteral">&quot;makebevelcurve p1&quot;</span>);
<a name="l01430"></a>01430             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(disp, dl);
<a name="l01431"></a>01431             dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a14a8a66c424ba6ecb972e49847b61483">type</a>= <a class="code" href="../../d9/d12/BKE__displist_8h.html#ad298e077cdc5f0f6e4d4060fbb08618c">DL_SEGM</a>;
<a name="l01432"></a>01432             dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>= 1;
<a name="l01433"></a>01433             dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#ab71643e664ff559f5e798fc7fc4cfe55">flag</a>= <a class="code" href="../../d9/d12/BKE__displist_8h.html#a9c8358fc1d2658c9b9425df2c80f4d1a">DL_BACK_CURVE</a>;
<a name="l01434"></a>01434             dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>= nr;
<a name="l01435"></a>01435 
<a name="l01436"></a>01436             <span class="comment">/* half a circle */</span>
<a name="l01437"></a>01437             fp= dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>;
<a name="l01438"></a>01438             dangle= (0.5*<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/(dnr-1));
<a name="l01439"></a>01439             angle= -(nr-1)*dangle;
<a name="l01440"></a>01440 
<a name="l01441"></a>01441             <span class="keywordflow">for</span> (a=0; a&lt;nr; a++) {
<a name="l01442"></a>01442                 fp[0]= 0.0;
<a name="l01443"></a>01443                 fp[1]= (float)(<a class="code" href="../../dd/d06/BLI__math__base_8h.html#a2503b77b52ff481a3507a596ae1f3938">cosf</a>(angle)*(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#add39d47101587c286cd77e2045bc9129">ext2</a>));
<a name="l01444"></a>01444                 fp[2]= (float)(<a class="code" href="../../dd/d06/BLI__math__base_8h.html#a1a55e3226c270625a4bff1befa977638">sinf</a>(angle)*(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#add39d47101587c286cd77e2045bc9129">ext2</a>)) - cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a22c6cd81bc29dbb30accecc67979e587">ext1</a>;
<a name="l01445"></a>01445                 angle+= dangle;
<a name="l01446"></a>01446                 fp+= 3;
<a name="l01447"></a>01447             }
<a name="l01448"></a>01448         }
<a name="l01449"></a>01449         
<a name="l01450"></a>01450         <span class="comment">/* part 2, sidefaces */</span>
<a name="l01451"></a>01451         <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a22c6cd81bc29dbb30accecc67979e587">ext1</a>!=0.0f) {
<a name="l01452"></a>01452             nr= 2;
<a name="l01453"></a>01453             
<a name="l01454"></a>01454             dl= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d2f/structDispList.html">DispList</a>), <span class="stringliteral">&quot;makebevelcurve p2&quot;</span>);
<a name="l01455"></a>01455             dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(nr*3*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), <span class="stringliteral">&quot;makebevelcurve p2&quot;</span>);
<a name="l01456"></a>01456             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(disp, dl);
<a name="l01457"></a>01457             dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a14a8a66c424ba6ecb972e49847b61483">type</a>= <a class="code" href="../../d9/d12/BKE__displist_8h.html#ad298e077cdc5f0f6e4d4060fbb08618c">DL_SEGM</a>;
<a name="l01458"></a>01458             dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>= 1;
<a name="l01459"></a>01459             dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>= nr;
<a name="l01460"></a>01460             
<a name="l01461"></a>01461             fp= dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>;
<a name="l01462"></a>01462             fp[1]= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#add39d47101587c286cd77e2045bc9129">ext2</a>;
<a name="l01463"></a>01463             fp[2]= -cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a22c6cd81bc29dbb30accecc67979e587">ext1</a>;
<a name="l01464"></a>01464             fp[4]= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#add39d47101587c286cd77e2045bc9129">ext2</a>;
<a name="l01465"></a>01465             fp[5]= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a22c6cd81bc29dbb30accecc67979e587">ext1</a>;
<a name="l01466"></a>01466             
<a name="l01467"></a>01467             <span class="keywordflow">if</span> ( (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> &amp; (<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a582ba8cae7a48052e26e3fd58bd0cd6a">CU_FRONT</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a81cf8279edc9b7a31cdc56d0a36e1a87">CU_BACK</a>))==0) {
<a name="l01468"></a>01468                 dl= <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(dl);
<a name="l01469"></a>01469                 dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>);
<a name="l01470"></a>01470                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(disp, dl);
<a name="l01471"></a>01471                 
<a name="l01472"></a>01472                 fp= dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>;
<a name="l01473"></a>01473                 fp[1]= -fp[1];
<a name="l01474"></a>01474                 fp[2]= -fp[2];
<a name="l01475"></a>01475                 fp[4]= -fp[4];
<a name="l01476"></a>01476                 fp[5]= -fp[5];
<a name="l01477"></a>01477             }
<a name="l01478"></a>01478         }
<a name="l01479"></a>01479         
<a name="l01480"></a>01480         <span class="comment">/* part 3, front */</span>
<a name="l01481"></a>01481         <span class="keywordflow">if</span> ((cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a582ba8cae7a48052e26e3fd58bd0cd6a">CU_FRONT</a>) || !(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a81cf8279edc9b7a31cdc56d0a36e1a87">CU_BACK</a>)) {
<a name="l01482"></a>01482             dnr= nr= 2+ cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a632137c42cceb1370dd865f64daae1d7">bevresol</a>;
<a name="l01483"></a>01483             <span class="keywordflow">if</span> ( (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> &amp; (<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a582ba8cae7a48052e26e3fd58bd0cd6a">CU_FRONT</a>|<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a81cf8279edc9b7a31cdc56d0a36e1a87">CU_BACK</a>))==0)
<a name="l01484"></a>01484                 nr= 3+ 2*cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a632137c42cceb1370dd865f64daae1d7">bevresol</a>;
<a name="l01485"></a>01485 
<a name="l01486"></a>01486             dl= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d2f/structDispList.html">DispList</a>), <span class="stringliteral">&quot;makebevelcurve p3&quot;</span>);
<a name="l01487"></a>01487             dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(nr*3*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), <span class="stringliteral">&quot;makebevelcurve p3&quot;</span>);
<a name="l01488"></a>01488             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(disp, dl);
<a name="l01489"></a>01489             dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a14a8a66c424ba6ecb972e49847b61483">type</a>= <a class="code" href="../../d9/d12/BKE__displist_8h.html#ad298e077cdc5f0f6e4d4060fbb08618c">DL_SEGM</a>;
<a name="l01490"></a>01490             dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#ab71643e664ff559f5e798fc7fc4cfe55">flag</a>= <a class="code" href="../../d9/d12/BKE__displist_8h.html#ac4c4dd1a39dc5345704b90bb5176255c">DL_FRONT_CURVE</a>;
<a name="l01491"></a>01491             dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>= 1;
<a name="l01492"></a>01492             dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>= nr;
<a name="l01493"></a>01493 
<a name="l01494"></a>01494             <span class="comment">/* half a circle */</span>
<a name="l01495"></a>01495             fp= dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>;
<a name="l01496"></a>01496             angle= 0.0;
<a name="l01497"></a>01497             dangle= (0.5*<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/(dnr-1));
<a name="l01498"></a>01498 
<a name="l01499"></a>01499             <span class="keywordflow">for</span> (a=0; a&lt;nr; a++) {
<a name="l01500"></a>01500                 fp[0]= 0.0;
<a name="l01501"></a>01501                 fp[1]= (float)(<a class="code" href="../../dd/d06/BLI__math__base_8h.html#a2503b77b52ff481a3507a596ae1f3938">cosf</a>(angle)*(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#add39d47101587c286cd77e2045bc9129">ext2</a>));
<a name="l01502"></a>01502                 fp[2]= (float)(<a class="code" href="../../dd/d06/BLI__math__base_8h.html#a1a55e3226c270625a4bff1befa977638">sinf</a>(angle)*(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#add39d47101587c286cd77e2045bc9129">ext2</a>)) + cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a22c6cd81bc29dbb30accecc67979e587">ext1</a>;
<a name="l01503"></a>01503                 angle+= dangle;
<a name="l01504"></a>01504                 fp+= 3;
<a name="l01505"></a>01505             }
<a name="l01506"></a>01506         }
<a name="l01507"></a>01507     }
<a name="l01508"></a>01508 }
<a name="l01509"></a>01509 
<a name="l01510"></a><a class="code" href="../../dc/d22/curve_8c.html#a14a175046af13236ec46abfabdf654a0">01510</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d22/curve_8c.html#a14a175046af13236ec46abfabdf654a0">cu_isectLL</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> v1[3], <span class="keyword">const</span> <span class="keywordtype">float</span> v2[3], <span class="keyword">const</span> <span class="keywordtype">float</span> v3[3], <span class="keyword">const</span> <span class="keywordtype">float</span> v4[3],
<a name="l01511"></a>01511                       <span class="keywordtype">short</span> cox, <span class="keywordtype">short</span> coy,
<a name="l01512"></a>01512                       <span class="keywordtype">float</span> *labda, <span class="keywordtype">float</span> *mu, <span class="keywordtype">float</span> vec[3])
<a name="l01513"></a>01513 {
<a name="l01514"></a>01514     <span class="comment">/* return:</span>
<a name="l01515"></a>01515 <span class="comment">     * -1: colliniar</span>
<a name="l01516"></a>01516 <span class="comment">     *  0: no intersection of segments</span>
<a name="l01517"></a>01517 <span class="comment">     *  1: exact intersection of segments</span>
<a name="l01518"></a>01518 <span class="comment">     *  2: cross-intersection of segments</span>
<a name="l01519"></a>01519 <span class="comment">     */</span>
<a name="l01520"></a>01520     <span class="keywordtype">float</span> deler;
<a name="l01521"></a>01521 
<a name="l01522"></a>01522     deler= (v1[cox]-v2[cox])*(v3[coy]-v4[coy])-(v3[cox]-v4[cox])*(v1[coy]-v2[coy]);
<a name="l01523"></a>01523     <span class="keywordflow">if</span> (deler==0.0f) <span class="keywordflow">return</span> -1;
<a name="l01524"></a>01524 
<a name="l01525"></a>01525     *labda= (v1[coy]-v3[coy])*(v3[cox]-v4[cox])-(v1[cox]-v3[cox])*(v3[coy]-v4[coy]);
<a name="l01526"></a>01526     *labda= -(*labda/deler);
<a name="l01527"></a>01527 
<a name="l01528"></a>01528     deler= v3[coy]-v4[coy];
<a name="l01529"></a>01529     <span class="keywordflow">if</span> (deler==0) {
<a name="l01530"></a>01530         deler=v3[cox]-v4[cox];
<a name="l01531"></a>01531         *mu= -(*labda*(v2[cox]-v1[cox])+v1[cox]-v3[cox])/deler;
<a name="l01532"></a>01532     }
<a name="l01533"></a>01533     <span class="keywordflow">else</span> {
<a name="l01534"></a>01534         *mu= -(*labda*(v2[coy]-v1[coy])+v1[coy]-v3[coy])/deler;
<a name="l01535"></a>01535     }
<a name="l01536"></a>01536     vec[cox]= *labda*(v2[cox]-v1[cox])+v1[cox];
<a name="l01537"></a>01537     vec[coy]= *labda*(v2[coy]-v1[coy])+v1[coy];
<a name="l01538"></a>01538 
<a name="l01539"></a>01539     <span class="keywordflow">if</span> (*labda&gt;=0.0f &amp;&amp; *labda&lt;=1.0f &amp;&amp; *mu&gt;=0.0f &amp;&amp; *mu&lt;=1.0f) {
<a name="l01540"></a>01540         <span class="keywordflow">if</span> (*labda==0.0f || *labda==1.0f || *mu==0.0f || *mu==1.0f) <span class="keywordflow">return</span> 1;
<a name="l01541"></a>01541         <span class="keywordflow">return</span> 2;
<a name="l01542"></a>01542     }
<a name="l01543"></a>01543     <span class="keywordflow">return</span> 0;
<a name="l01544"></a>01544 }
<a name="l01545"></a>01545 
<a name="l01546"></a>01546 
<a name="l01547"></a><a class="code" href="../../dc/d22/curve_8c.html#a3f9be9282aee525638da73e2226bb699">01547</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../dc/d22/curve_8c.html#a3f9be9282aee525638da73e2226bb699">bevelinside</a>(<a class="code" href="../../da/d87/structBevList.html">BevList</a> *bl1,<a class="code" href="../../da/d87/structBevList.html">BevList</a> *bl2)
<a name="l01548"></a>01548 {
<a name="l01549"></a>01549     <span class="comment">/* is bl2 INSIDE bl1 ? with left-right method and &quot;labda&#39;s&quot; */</span>
<a name="l01550"></a>01550     <span class="comment">/* returns &#39;1&#39; if correct hole  */</span>
<a name="l01551"></a>01551     <a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *bevp, *prevbevp;
<a name="l01552"></a>01552     <span class="keywordtype">float</span> <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>,<a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>,vec[3],hvec1[3],hvec2[3],lab,mu;
<a name="l01553"></a>01553     <span class="keywordtype">int</span> nr, links=0,rechts=0,mode;
<a name="l01554"></a>01554 
<a name="l01555"></a>01555     <span class="comment">/* take first vertex of possible hole */</span>
<a name="l01556"></a>01556 
<a name="l01557"></a>01557     bevp= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl2+1);
<a name="l01558"></a>01558     hvec1[0]= bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[0]; 
<a name="l01559"></a>01559     hvec1[1]= bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[1]; 
<a name="l01560"></a>01560     hvec1[2]= 0.0;
<a name="l01561"></a>01561     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(hvec2,hvec1);
<a name="l01562"></a>01562     hvec2[0]+=1000;
<a name="l01563"></a>01563 
<a name="l01564"></a>01564     <span class="comment">/* test it with all edges of potential surounding poly */</span>
<a name="l01565"></a>01565     <span class="comment">/* count number of transitions left-right  */</span>
<a name="l01566"></a>01566 
<a name="l01567"></a>01567     bevp= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl1+1);
<a name="l01568"></a>01568     nr= bl1-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>;
<a name="l01569"></a>01569     prevbevp= bevp+(nr-1);
<a name="l01570"></a>01570 
<a name="l01571"></a>01571     <span class="keywordflow">while</span> (nr--) {
<a name="l01572"></a>01572         min= prevbevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[1];
<a name="l01573"></a>01573         max= bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[1];
<a name="l01574"></a>01574         <span class="keywordflow">if</span> (max&lt;min) {
<a name="l01575"></a>01575             min= <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>;
<a name="l01576"></a>01576             max= prevbevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[1];
<a name="l01577"></a>01577         }
<a name="l01578"></a>01578         <span class="keywordflow">if</span> (min!=max) {
<a name="l01579"></a>01579             <span class="keywordflow">if</span> (min&lt;=hvec1[1] &amp;&amp; max&gt;=hvec1[1]) {
<a name="l01580"></a>01580                 <span class="comment">/* there&#39;s a transition, calc intersection point */</span>
<a name="l01581"></a>01581                 mode= <a class="code" href="../../dc/d22/curve_8c.html#a14a175046af13236ec46abfabdf654a0">cu_isectLL</a>(prevbevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>, bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>, hvec1, hvec2, 0, 1, &amp;lab, &amp;mu, vec);
<a name="l01582"></a>01582                 <span class="comment">/* if lab==0.0 or lab==1.0 then the edge intersects exactly a transition</span>
<a name="l01583"></a>01583 <span class="comment">                 * only allow for one situation: we choose lab= 1.0</span>
<a name="l01584"></a>01584 <span class="comment">                 */</span>
<a name="l01585"></a>01585                 <span class="keywordflow">if</span> (mode &gt;= 0 &amp;&amp; lab != 0.0f) {
<a name="l01586"></a>01586                     <span class="keywordflow">if</span> (vec[0]&lt;hvec1[0]) links++;
<a name="l01587"></a>01587                     <span class="keywordflow">else</span> rechts++;
<a name="l01588"></a>01588                 }
<a name="l01589"></a>01589             }
<a name="l01590"></a>01590         }
<a name="l01591"></a>01591         prevbevp= bevp;
<a name="l01592"></a>01592         bevp++;
<a name="l01593"></a>01593     }
<a name="l01594"></a>01594     
<a name="l01595"></a>01595     <span class="keywordflow">if</span> ( (links &amp; 1) &amp;&amp; (rechts &amp; 1) ) <span class="keywordflow">return</span> 1;
<a name="l01596"></a>01596     <span class="keywordflow">return</span> 0;
<a name="l01597"></a>01597 }
<a name="l01598"></a>01598 
<a name="l01599"></a>01599 
<a name="l01600"></a><a class="code" href="../../d6/d3f/structbevelsort.html">01600</a> <span class="keyword">struct </span><a class="code" href="../../d6/d3f/structbevelsort.html">bevelsort</a> {
<a name="l01601"></a><a class="code" href="../../d6/d3f/structbevelsort.html#ad2a6a39dc2086dbfb6dbf6ddbfae68f9">01601</a>     <span class="keywordtype">float</span> <a class="code" href="../../d6/d3f/structbevelsort.html#ad2a6a39dc2086dbfb6dbf6ddbfae68f9">left</a>;
<a name="l01602"></a><a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">01602</a>     <a class="code" href="../../da/d87/structBevList.html">BevList</a> *<a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">bl</a>;
<a name="l01603"></a><a class="code" href="../../d6/d3f/structbevelsort.html#a6035ed5da5e50469a68fc66a40a2e812">01603</a>     <span class="keywordtype">int</span> <a class="code" href="../../d6/d3f/structbevelsort.html#a6035ed5da5e50469a68fc66a40a2e812">dir</a>;
<a name="l01604"></a>01604 };
<a name="l01605"></a>01605 
<a name="l01606"></a><a class="code" href="../../dc/d22/curve_8c.html#a571c05a26b879c3199cf6ddf1c36d7cb">01606</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d22/curve_8c.html#a571c05a26b879c3199cf6ddf1c36d7cb">vergxcobev</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *a1, <span class="keyword">const</span> <span class="keywordtype">void</span> *a2)
<a name="l01607"></a>01607 {
<a name="l01608"></a>01608     <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d6/d3f/structbevelsort.html">bevelsort</a> *x1=a1,*x2=a2;
<a name="l01609"></a>01609 
<a name="l01610"></a>01610     <span class="keywordflow">if</span> ( x1-&gt;<a class="code" href="../../d6/d3f/structbevelsort.html#ad2a6a39dc2086dbfb6dbf6ddbfae68f9">left</a> &gt; x2-&gt;left ) <span class="keywordflow">return</span> 1;
<a name="l01611"></a>01611     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( x1-&gt;<a class="code" href="../../d6/d3f/structbevelsort.html#ad2a6a39dc2086dbfb6dbf6ddbfae68f9">left</a> &lt; x2-&gt;left) <span class="keywordflow">return</span> -1;
<a name="l01612"></a>01612     <span class="keywordflow">return</span> 0;
<a name="l01613"></a>01613 }
<a name="l01614"></a>01614 
<a name="l01615"></a>01615 <span class="comment">/* this function cannot be replaced with atan2, but why? */</span>
<a name="l01616"></a>01616 
<a name="l01617"></a><a class="code" href="../../dc/d22/curve_8c.html#ae741ad320431c2335b68d6cac7d25ccd">01617</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#ae741ad320431c2335b68d6cac7d25ccd">calc_bevel_sin_cos</a>(<span class="keywordtype">float</span> x1, <span class="keywordtype">float</span> y1, <span class="keywordtype">float</span> x2, <span class="keywordtype">float</span> y2, <span class="keywordtype">float</span> *sina, <span class="keywordtype">float</span> *cosa)
<a name="l01618"></a>01618 {
<a name="l01619"></a>01619     <span class="keywordtype">float</span> t01, t02, x3, y3;
<a name="l01620"></a>01620 
<a name="l01621"></a>01621     t01= (float)<a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(x1*x1+y1*y1);
<a name="l01622"></a>01622     t02= (float)<a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(x2*x2+y2*y2);
<a name="l01623"></a>01623     <span class="keywordflow">if</span> (t01==0.0f) t01= 1.0f;
<a name="l01624"></a>01624     <span class="keywordflow">if</span> (t02==0.0f) t02= 1.0f;
<a name="l01625"></a>01625 
<a name="l01626"></a>01626     x1/=t01; 
<a name="l01627"></a>01627     y1/=t01;
<a name="l01628"></a>01628     x2/=t02; 
<a name="l01629"></a>01629     y2/=t02;
<a name="l01630"></a>01630 
<a name="l01631"></a>01631     t02= x1*x2+y1*y2;
<a name="l01632"></a>01632     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(t02)&gt;=1.0) t02= .5*<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>;
<a name="l01633"></a>01633     <span class="keywordflow">else</span> t02= (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#a0b0ac0cef781c9d0eb9e57e3702f76db">saacos</a>(t02))/2.0f;
<a name="l01634"></a>01634 
<a name="l01635"></a>01635     t02= (float)<a class="code" href="../../d7/d47/NM__Scalar_8h.html#a4f15dff8a58e8abe0c0cf2c249ffa842">sin</a>(t02);
<a name="l01636"></a>01636     <span class="keywordflow">if</span> (t02==0.0f) t02= 1.0f;
<a name="l01637"></a>01637 
<a name="l01638"></a>01638     x3= x1-x2;
<a name="l01639"></a>01639     y3= y1-y2;
<a name="l01640"></a>01640     <span class="keywordflow">if</span> (x3==0 &amp;&amp; y3==0) {
<a name="l01641"></a>01641         x3= y1;
<a name="l01642"></a>01642         y3= -x1;
<a name="l01643"></a>01643     }
<a name="l01644"></a>01644     <span class="keywordflow">else</span> {
<a name="l01645"></a>01645         t01= (float)<a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(x3*x3+y3*y3);
<a name="l01646"></a>01646         x3/=t01; 
<a name="l01647"></a>01647         y3/=t01;
<a name="l01648"></a>01648     }
<a name="l01649"></a>01649 
<a name="l01650"></a>01650     *sina= -y3/t02;
<a name="l01651"></a>01651     *cosa= x3/t02;
<a name="l01652"></a>01652 
<a name="l01653"></a>01653 }
<a name="l01654"></a>01654 
<a name="l01655"></a><a class="code" href="../../dc/d22/curve_8c.html#aa9b7cc763743e07d75917d3d3c9e904a">01655</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#aa9b7cc763743e07d75917d3d3c9e904a">alfa_bezpart</a>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *prevbezt, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt, <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, <span class="keywordtype">float</span> *tilt_array, <span class="keywordtype">float</span> *radius_array, <span class="keywordtype">float</span> *weight_array, <span class="keywordtype">int</span> resolu, <span class="keywordtype">int</span> stride)
<a name="l01656"></a>01656 {
<a name="l01657"></a>01657     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *pprev, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>, *last;
<a name="l01658"></a>01658     <span class="keywordtype">float</span> fac, dfac, t[4];
<a name="l01659"></a>01659     <span class="keywordtype">int</span> a;
<a name="l01660"></a>01660     
<a name="l01661"></a>01661     <span class="keywordflow">if</span> (tilt_array==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; radius_array==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01662"></a>01662         <span class="keywordflow">return</span>;
<a name="l01663"></a>01663     
<a name="l01664"></a>01664     last= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1);
<a name="l01665"></a>01665     
<a name="l01666"></a>01666     <span class="comment">/* returns a point */</span>
<a name="l01667"></a>01667     <span class="keywordflow">if</span> (prevbezt==nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>) {
<a name="l01668"></a>01668         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) pprev= last;
<a name="l01669"></a>01669         <span class="keywordflow">else</span> pprev= prevbezt;
<a name="l01670"></a>01670     }
<a name="l01671"></a>01671     <span class="keywordflow">else</span> pprev= prevbezt-1;
<a name="l01672"></a>01672     
<a name="l01673"></a>01673     <span class="comment">/* next point */</span>
<a name="l01674"></a>01674     <span class="keywordflow">if</span> (bezt==last) {
<a name="l01675"></a>01675         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) next= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l01676"></a>01676         <span class="keywordflow">else</span> next= bezt;
<a name="l01677"></a>01677     }
<a name="l01678"></a>01678     <span class="keywordflow">else</span> next= bezt+1;
<a name="l01679"></a>01679     
<a name="l01680"></a>01680     fac= 0.0;
<a name="l01681"></a>01681     dfac= 1.0f/(float)resolu;
<a name="l01682"></a>01682     
<a name="l01683"></a>01683     <span class="keywordflow">for</span> (a=0; a&lt;resolu; a++, fac+= dfac) {
<a name="l01684"></a>01684         <span class="keywordflow">if</span> (tilt_array) {
<a name="l01685"></a>01685             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a534b9349a7b1ce6b15b1aa4b1c92f0c4">tilt_interp</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ab7697a99f1c649fba63f53a7e3c7c7c8">KEY_CU_EASE</a>) { <span class="comment">/* May as well support for tilt also 2.47 ease interp */</span>
<a name="l01686"></a>01686                 *tilt_array = prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a> + (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a> - prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a>)*(3.0f*fac*fac - 2.0f*fac*fac*fac);
<a name="l01687"></a>01687             }
<a name="l01688"></a>01688             <span class="keywordflow">else</span> {
<a name="l01689"></a>01689                 <a class="code" href="../../d5/d17/BKE__key_8h.html#a77a9ae696ecfa7f2645fc4a6b72fe928">key_curve_position_weights</a>(fac, t, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a534b9349a7b1ce6b15b1aa4b1c92f0c4">tilt_interp</a>);
<a name="l01690"></a>01690                 *tilt_array= t[0]*pprev-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a> + t[1]*prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a> + t[2]*bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a> + t[3]*next-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a>;
<a name="l01691"></a>01691             }
<a name="l01692"></a>01692             
<a name="l01693"></a>01693             tilt_array = (<span class="keywordtype">float</span> *)(((<span class="keywordtype">char</span> *)tilt_array) + stride); 
<a name="l01694"></a>01694         }
<a name="l01695"></a>01695         
<a name="l01696"></a>01696         <span class="keywordflow">if</span> (radius_array) {
<a name="l01697"></a>01697             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#abb72597159d8b0d99fa12f07d275ce60">radius_interp</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ab7697a99f1c649fba63f53a7e3c7c7c8">KEY_CU_EASE</a>) {
<a name="l01698"></a>01698                 <span class="comment">/* Support 2.47 ease interp</span>
<a name="l01699"></a>01699 <span class="comment">                 * Note! - this only takes the 2 points into account,</span>
<a name="l01700"></a>01700 <span class="comment">                 * giving much more localized results to changes in radius, sometimes you want that */</span>
<a name="l01701"></a>01701                 *radius_array = prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a> + (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a> - prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a>)*(3.0f*fac*fac - 2.0f*fac*fac*fac);
<a name="l01702"></a>01702             }
<a name="l01703"></a>01703             <span class="keywordflow">else</span> {
<a name="l01704"></a>01704                 
<a name="l01705"></a>01705                 <span class="comment">/* reuse interpolation from tilt if we can */</span>
<a name="l01706"></a>01706                 <span class="keywordflow">if</span> (tilt_array==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a534b9349a7b1ce6b15b1aa4b1c92f0c4">tilt_interp</a> != nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#abb72597159d8b0d99fa12f07d275ce60">radius_interp</a>) {
<a name="l01707"></a>01707                     <a class="code" href="../../d5/d17/BKE__key_8h.html#a77a9ae696ecfa7f2645fc4a6b72fe928">key_curve_position_weights</a>(fac, t, nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#abb72597159d8b0d99fa12f07d275ce60">radius_interp</a>);
<a name="l01708"></a>01708                 }
<a name="l01709"></a>01709                 *radius_array= t[0]*pprev-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a> + t[1]*prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a> + t[2]*bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a> + t[3]*next-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a>;
<a name="l01710"></a>01710             }
<a name="l01711"></a>01711             
<a name="l01712"></a>01712             radius_array = (<span class="keywordtype">float</span> *)(((<span class="keywordtype">char</span> *)radius_array) + stride); 
<a name="l01713"></a>01713         }
<a name="l01714"></a>01714 
<a name="l01715"></a>01715         <span class="keywordflow">if</span> (weight_array) {
<a name="l01716"></a>01716             <span class="comment">/* basic interpolation for now, could copy tilt interp too  */</span>
<a name="l01717"></a>01717             *weight_array = prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad23314941e5bb9f62166fb79d623d2c3">weight</a> + (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad23314941e5bb9f62166fb79d623d2c3">weight</a> - prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad23314941e5bb9f62166fb79d623d2c3">weight</a>)*(3.0f*fac*fac - 2.0f*fac*fac*fac);
<a name="l01718"></a>01718 
<a name="l01719"></a>01719             weight_array = (<span class="keywordtype">float</span> *)(((<span class="keywordtype">char</span> *)weight_array) + stride);
<a name="l01720"></a>01720         }
<a name="l01721"></a>01721     }
<a name="l01722"></a>01722 }
<a name="l01723"></a>01723 
<a name="l01724"></a>01724 <span class="comment">/* make_bevel_list_3D_* funcs, at a minimum these must</span>
<a name="l01725"></a>01725 <span class="comment"> * fill in the bezp-&gt;quat and bezp-&gt;dir values */</span>
<a name="l01726"></a>01726 
<a name="l01727"></a>01727 <span class="comment">/* correct non-cyclic cases by copying direction and rotation</span>
<a name="l01728"></a>01728 <span class="comment"> * values onto the first &amp; last end-points */</span>
<a name="l01729"></a><a class="code" href="../../dc/d22/curve_8c.html#ae77294331c656f3b2c0601963765a64b">01729</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#ae77294331c656f3b2c0601963765a64b">bevel_list_cyclic_fix_3D</a>(<a class="code" href="../../da/d87/structBevList.html">BevList</a> *<a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">bl</a>)
<a name="l01730"></a>01730 {
<a name="l01731"></a>01731     <a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *bevp, *bevp1;
<a name="l01732"></a>01732 
<a name="l01733"></a>01733     bevp= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l01734"></a>01734     bevp1= bevp+1;
<a name="l01735"></a>01735     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#ad474b870b380ee0c83901e9199506078">copy_qt_qt</a>(bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>);
<a name="l01736"></a>01736     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>);
<a name="l01737"></a>01737     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#aa4e7d6adabefc4fc9d88f6e6baea36aa">tan</a>, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#aa4e7d6adabefc4fc9d88f6e6baea36aa">tan</a>);
<a name="l01738"></a>01738     bevp= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l01739"></a>01739     bevp+= (bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>-1);
<a name="l01740"></a>01740     bevp1= bevp-1;
<a name="l01741"></a>01741     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#ad474b870b380ee0c83901e9199506078">copy_qt_qt</a>(bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>);
<a name="l01742"></a>01742     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>);
<a name="l01743"></a>01743     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#aa4e7d6adabefc4fc9d88f6e6baea36aa">tan</a>, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#aa4e7d6adabefc4fc9d88f6e6baea36aa">tan</a>);
<a name="l01744"></a>01744 }
<a name="l01745"></a>01745 <span class="comment">/* utility for make_bevel_list_3D_* funcs */</span>
<a name="l01746"></a><a class="code" href="../../dc/d22/curve_8c.html#a2db1d1efdd0cd1eebf1eb1aff3870131">01746</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#a2db1d1efdd0cd1eebf1eb1aff3870131">bevel_list_calc_bisect</a>(<a class="code" href="../../da/d87/structBevList.html">BevList</a> *<a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">bl</a>)
<a name="l01747"></a>01747 {
<a name="l01748"></a>01748     <a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *bevp2, *bevp1, *bevp0;
<a name="l01749"></a>01749     <span class="keywordtype">int</span> nr;
<a name="l01750"></a>01750 
<a name="l01751"></a>01751     bevp2= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l01752"></a>01752     bevp1= bevp2+(bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>-1);
<a name="l01753"></a>01753     bevp0= bevp1-1;
<a name="l01754"></a>01754 
<a name="l01755"></a>01755     nr= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>;
<a name="l01756"></a>01756     <span class="keywordflow">while</span> (nr--) {
<a name="l01757"></a>01757         <span class="comment">/* totally simple */</span>
<a name="l01758"></a>01758         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#afd385fbdd1744179920c9d11d3bf1921">bisect_v3_v3v3v3</a>(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>, bevp0-&gt;vec, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>, bevp2-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>);
<a name="l01759"></a>01759 
<a name="l01760"></a>01760         bevp0= bevp1;
<a name="l01761"></a>01761         bevp1= bevp2;
<a name="l01762"></a>01762         bevp2++;
<a name="l01763"></a>01763     }
<a name="l01764"></a>01764 }
<a name="l01765"></a><a class="code" href="../../dc/d22/curve_8c.html#a042a07c43e966f4a852ad82fc292304c">01765</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#a042a07c43e966f4a852ad82fc292304c">bevel_list_flip_tangents</a>(<a class="code" href="../../da/d87/structBevList.html">BevList</a> *<a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">bl</a>)
<a name="l01766"></a>01766 {
<a name="l01767"></a>01767     <a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *bevp2, *bevp1, *bevp0;
<a name="l01768"></a>01768     <span class="keywordtype">int</span> nr;
<a name="l01769"></a>01769 
<a name="l01770"></a>01770     bevp2= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l01771"></a>01771     bevp1= bevp2+(bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>-1);
<a name="l01772"></a>01772     bevp0= bevp1-1;
<a name="l01773"></a>01773 
<a name="l01774"></a>01774     nr= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>;
<a name="l01775"></a>01775     <span class="keywordflow">while</span> (nr--) {
<a name="l01776"></a>01776         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a95c550a7b3c9b2628d20aef44bc12b56">RAD2DEGF</a>(<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a927d5473f59c68eed4145d5488288273">angle_v2v2</a>(bevp0-&gt;tan, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#aa4e7d6adabefc4fc9d88f6e6baea36aa">tan</a>)) &gt; 90.0f)
<a name="l01777"></a>01777             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a9ac9a5dd319bfe481c973431de10a815">negate_v3</a>(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#aa4e7d6adabefc4fc9d88f6e6baea36aa">tan</a>);
<a name="l01778"></a>01778 
<a name="l01779"></a>01779         bevp0= bevp1;
<a name="l01780"></a>01780         bevp1= bevp2;
<a name="l01781"></a>01781         bevp2++;
<a name="l01782"></a>01782     }
<a name="l01783"></a>01783 }
<a name="l01784"></a>01784 <span class="comment">/* apply user tilt */</span>
<a name="l01785"></a><a class="code" href="../../dc/d22/curve_8c.html#a806b644eb4a64da766f08ceeb9962bb8">01785</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#a806b644eb4a64da766f08ceeb9962bb8">bevel_list_apply_tilt</a>(<a class="code" href="../../da/d87/structBevList.html">BevList</a> *<a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">bl</a>)
<a name="l01786"></a>01786 {
<a name="l01787"></a>01787     <a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *bevp2, *bevp1;
<a name="l01788"></a>01788     <span class="keywordtype">int</span> nr;
<a name="l01789"></a>01789     <span class="keywordtype">float</span> q[4];
<a name="l01790"></a>01790 
<a name="l01791"></a>01791     bevp2= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l01792"></a>01792     bevp1= bevp2+(bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>-1);
<a name="l01793"></a>01793 
<a name="l01794"></a>01794     nr= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>;
<a name="l01795"></a>01795     <span class="keywordflow">while</span> (nr--) {
<a name="l01796"></a>01796         <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a31e0d088e5faae71dd3e9e4232f7c2a5">axis_angle_to_quat</a>(q, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a34e2426b43a8d30e838fdf17be47e226">alfa</a>);
<a name="l01797"></a>01797         <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a933ad0450d410fc2fae72afe434be287">mul_qt_qtqt</a>(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>, q, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>);
<a name="l01798"></a>01798         <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a58e1ba0822577e22846bd4352f111e81">normalize_qt</a>(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>);
<a name="l01799"></a>01799 
<a name="l01800"></a>01800         bevp1= bevp2;
<a name="l01801"></a>01801         bevp2++;
<a name="l01802"></a>01802     }
<a name="l01803"></a>01803 }
<a name="l01804"></a>01804 <span class="comment">/* smooth quats, this function should be optimized, it can get slow with many iterations. */</span>
<a name="l01805"></a><a class="code" href="../../dc/d22/curve_8c.html#a42b91c60c9fdcf15f71383df4acaae27">01805</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#a42b91c60c9fdcf15f71383df4acaae27">bevel_list_smooth</a>(<a class="code" href="../../da/d87/structBevList.html">BevList</a> *<a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">bl</a>, <span class="keywordtype">int</span> smooth_iter)
<a name="l01806"></a>01806 {
<a name="l01807"></a>01807     <a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *bevp2, *bevp1, *bevp0;
<a name="l01808"></a>01808     <span class="keywordtype">int</span> nr;
<a name="l01809"></a>01809 
<a name="l01810"></a>01810     <span class="keywordtype">float</span> q[4];
<a name="l01811"></a>01811     <span class="keywordtype">float</span> bevp0_quat[4];
<a name="l01812"></a>01812     <span class="keywordtype">int</span> a;
<a name="l01813"></a>01813 
<a name="l01814"></a>01814     <span class="keywordflow">for</span> (a=0; a &lt; smooth_iter; a++) {
<a name="l01815"></a>01815 
<a name="l01816"></a>01816         bevp2= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l01817"></a>01817         bevp1= bevp2+(bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>-1);
<a name="l01818"></a>01818         bevp0= bevp1-1;
<a name="l01819"></a>01819 
<a name="l01820"></a>01820         nr= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>;
<a name="l01821"></a>01821 
<a name="l01822"></a>01822         <span class="keywordflow">if</span> (bl-&gt;<a class="code" href="../../da/d87/structBevList.html#ab59610472c8b021334583bcf123bf1cb">poly</a>== -1) { <span class="comment">/* check its not cyclic */</span>
<a name="l01823"></a>01823             <span class="comment">/* skip the first point */</span>
<a name="l01824"></a>01824             <span class="comment">/* bevp0= bevp1; */</span>
<a name="l01825"></a>01825             bevp1= bevp2;
<a name="l01826"></a>01826             bevp2++;
<a name="l01827"></a>01827             nr--;
<a name="l01828"></a>01828 
<a name="l01829"></a>01829             bevp0= bevp1;
<a name="l01830"></a>01830             bevp1= bevp2;
<a name="l01831"></a>01831             bevp2++;
<a name="l01832"></a>01832             nr--;
<a name="l01833"></a>01833 
<a name="l01834"></a>01834         }
<a name="l01835"></a>01835 
<a name="l01836"></a>01836         <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#ad474b870b380ee0c83901e9199506078">copy_qt_qt</a>(bevp0_quat, bevp0-&gt;quat);
<a name="l01837"></a>01837 
<a name="l01838"></a>01838         <span class="keywordflow">while</span> (nr--) {
<a name="l01839"></a>01839             <span class="comment">/* interpolate quats */</span>
<a name="l01840"></a>01840             <span class="keywordtype">float</span> zaxis[3] = {0,0,1}, <a class="code" href="../../d1/d22/stdosl_8h.html#af89a44efb4de11d737647ee46ef3d304">cross</a>[3], q2[4];
<a name="l01841"></a>01841             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#aabc8b501c8bcfe8a37ecfc39661b07d9">interp_qt_qtqt</a>(q, bevp0_quat, bevp2-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>, 0.5);
<a name="l01842"></a>01842             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a58e1ba0822577e22846bd4352f111e81">normalize_qt</a>(q);
<a name="l01843"></a>01843 
<a name="l01844"></a>01844             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a654dd0df4df6f960e592032f276f2c68">mul_qt_v3</a>(q, zaxis);
<a name="l01845"></a>01845             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(<a class="code" href="../../d1/d22/stdosl_8h.html#af89a44efb4de11d737647ee46ef3d304">cross</a>, zaxis, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>);
<a name="l01846"></a>01846             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a31e0d088e5faae71dd3e9e4232f7c2a5">axis_angle_to_quat</a>(q2, <a class="code" href="../../d1/d22/stdosl_8h.html#af89a44efb4de11d737647ee46ef3d304">cross</a>, <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a4a2003033c639cab3de101b1cfe7a595">angle_normalized_v3v3</a>(zaxis, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>));
<a name="l01847"></a>01847             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a58e1ba0822577e22846bd4352f111e81">normalize_qt</a>(q2);
<a name="l01848"></a>01848 
<a name="l01849"></a>01849             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#ad474b870b380ee0c83901e9199506078">copy_qt_qt</a>(bevp0_quat, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>);
<a name="l01850"></a>01850             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a933ad0450d410fc2fae72afe434be287">mul_qt_qtqt</a>(q, q2, q);
<a name="l01851"></a>01851             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#aabc8b501c8bcfe8a37ecfc39661b07d9">interp_qt_qtqt</a>(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>, q, 0.5);
<a name="l01852"></a>01852             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a58e1ba0822577e22846bd4352f111e81">normalize_qt</a>(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>);
<a name="l01853"></a>01853 
<a name="l01854"></a>01854 
<a name="l01855"></a>01855             <span class="comment">/* bevp0= bevp1; */</span> <span class="comment">/* UNUSED */</span>
<a name="l01856"></a>01856             bevp1= bevp2;
<a name="l01857"></a>01857             bevp2++;
<a name="l01858"></a>01858         }
<a name="l01859"></a>01859     }
<a name="l01860"></a>01860 }
<a name="l01861"></a>01861 
<a name="l01862"></a><a class="code" href="../../dc/d22/curve_8c.html#a725d58121e831a320d6fe1b82a90c7bc">01862</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#a725d58121e831a320d6fe1b82a90c7bc">make_bevel_list_3D_zup</a>(<a class="code" href="../../da/d87/structBevList.html">BevList</a> *<a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">bl</a>)
<a name="l01863"></a>01863 {
<a name="l01864"></a>01864     <a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *bevp2, *bevp1, *bevp0; <span class="comment">/* standard for all make_bevel_list_3D_* funcs */</span>
<a name="l01865"></a>01865     <span class="keywordtype">int</span> nr;
<a name="l01866"></a>01866 
<a name="l01867"></a>01867     bevp2= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l01868"></a>01868     bevp1= bevp2+(bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>-1);
<a name="l01869"></a>01869     bevp0= bevp1-1;
<a name="l01870"></a>01870 
<a name="l01871"></a>01871     nr= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>;
<a name="l01872"></a>01872     <span class="keywordflow">while</span> (nr--) {
<a name="l01873"></a>01873         <span class="comment">/* totally simple */</span>
<a name="l01874"></a>01874         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#afd385fbdd1744179920c9d11d3bf1921">bisect_v3_v3v3v3</a>(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>, bevp0-&gt;vec, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>, bevp2-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>);
<a name="l01875"></a>01875         <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#afb9156556a1562b1debeb6d586859524">vec_to_quat</a>( bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>,bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>, 5, 1);
<a name="l01876"></a>01876 
<a name="l01877"></a>01877         bevp0= bevp1;
<a name="l01878"></a>01878         bevp1= bevp2;
<a name="l01879"></a>01879         bevp2++;
<a name="l01880"></a>01880     }
<a name="l01881"></a>01881 }
<a name="l01882"></a>01882 
<a name="l01883"></a><a class="code" href="../../dc/d22/curve_8c.html#a35e42d11a38a0e74a248e728ad4f9ad2">01883</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#a35e42d11a38a0e74a248e728ad4f9ad2">make_bevel_list_3D_minimum_twist</a>(<a class="code" href="../../da/d87/structBevList.html">BevList</a> *<a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">bl</a>)
<a name="l01884"></a>01884 {
<a name="l01885"></a>01885     <a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *bevp2, *bevp1, *bevp0; <span class="comment">/* standard for all make_bevel_list_3D_* funcs */</span>
<a name="l01886"></a>01886     <span class="keywordtype">int</span> nr;
<a name="l01887"></a>01887     <span class="keywordtype">float</span> q[4];
<a name="l01888"></a>01888 
<a name="l01889"></a>01889     <a class="code" href="../../dc/d22/curve_8c.html#a2db1d1efdd0cd1eebf1eb1aff3870131">bevel_list_calc_bisect</a>(bl);
<a name="l01890"></a>01890 
<a name="l01891"></a>01891     bevp2= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l01892"></a>01892     bevp1= bevp2+(bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>-1);
<a name="l01893"></a>01893     bevp0= bevp1-1;
<a name="l01894"></a>01894 
<a name="l01895"></a>01895     nr= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>;
<a name="l01896"></a>01896     <span class="keywordflow">while</span> (nr--) {
<a name="l01897"></a>01897 
<a name="l01898"></a>01898         <span class="keywordflow">if</span> (nr+4 &gt; bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>) { <span class="comment">/* first time and second time, otherwise first point adjusts last */</span>
<a name="l01899"></a>01899             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#afb9156556a1562b1debeb6d586859524">vec_to_quat</a>( bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>,bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>, 5, 1);
<a name="l01900"></a>01900         }
<a name="l01901"></a>01901         <span class="keywordflow">else</span> {
<a name="l01902"></a>01902             <span class="keywordtype">float</span> <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a4a2003033c639cab3de101b1cfe7a595">angle_normalized_v3v3</a>(bevp0-&gt;dir, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>);
<a name="l01903"></a>01903 
<a name="l01904"></a>01904             <span class="keywordflow">if</span> (angle &gt; 0.0f) { <span class="comment">/* otherwise we can keep as is */</span>
<a name="l01905"></a>01905                 <span class="keywordtype">float</span> cross_tmp[3];
<a name="l01906"></a>01906                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(cross_tmp, bevp0-&gt;dir, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>);
<a name="l01907"></a>01907                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a31e0d088e5faae71dd3e9e4232f7c2a5">axis_angle_to_quat</a>(q, cross_tmp, angle);
<a name="l01908"></a>01908                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a933ad0450d410fc2fae72afe434be287">mul_qt_qtqt</a>(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>, q, bevp0-&gt;quat);
<a name="l01909"></a>01909             }
<a name="l01910"></a>01910             <span class="keywordflow">else</span> {
<a name="l01911"></a>01911                 <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#ad474b870b380ee0c83901e9199506078">copy_qt_qt</a>(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>, bevp0-&gt;quat);
<a name="l01912"></a>01912             }
<a name="l01913"></a>01913         }
<a name="l01914"></a>01914 
<a name="l01915"></a>01915         bevp0= bevp1;
<a name="l01916"></a>01916         bevp1= bevp2;
<a name="l01917"></a>01917         bevp2++;
<a name="l01918"></a>01918     }
<a name="l01919"></a>01919 
<a name="l01920"></a>01920     <span class="keywordflow">if</span> (bl-&gt;<a class="code" href="../../da/d87/structBevList.html#ab59610472c8b021334583bcf123bf1cb">poly</a> != -1) { <span class="comment">/* check for cyclic */</span>
<a name="l01921"></a>01921 
<a name="l01922"></a>01922         <span class="comment">/* Need to correct for the start/end points not matching</span>
<a name="l01923"></a>01923 <span class="comment">         * do this by calculating the tilt angle difference, then apply</span>
<a name="l01924"></a>01924 <span class="comment">         * the rotation gradually over the entire curve</span>
<a name="l01925"></a>01925 <span class="comment">         *</span>
<a name="l01926"></a>01926 <span class="comment">         * note that the split is between last and second last, rather than first/last as youd expect.</span>
<a name="l01927"></a>01927 <span class="comment">         *</span>
<a name="l01928"></a>01928 <span class="comment">         * real order is like this</span>
<a name="l01929"></a>01929 <span class="comment">         * 0,1,2,3,4 --&gt; 1,2,3,4,0</span>
<a name="l01930"></a>01930 <span class="comment">         *</span>
<a name="l01931"></a>01931 <span class="comment">         * this is why we compare last with second last</span>
<a name="l01932"></a>01932 <span class="comment">         * */</span>
<a name="l01933"></a>01933         <span class="keywordtype">float</span> vec_1[3]= {0,1,0}, vec_2[3]= {0,1,0}, <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>, ang_fac, cross_tmp[3];
<a name="l01934"></a>01934 
<a name="l01935"></a>01935         <a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *bevp_first;
<a name="l01936"></a>01936         <a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *bevp_last;
<a name="l01937"></a>01937 
<a name="l01938"></a>01938 
<a name="l01939"></a>01939         bevp_first= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l01940"></a>01940         bevp_first+= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>-1;
<a name="l01941"></a>01941         bevp_last = bevp_first;
<a name="l01942"></a>01942         bevp_last--;
<a name="l01943"></a>01943 
<a name="l01944"></a>01944         <span class="comment">/* quats and vec&#39;s are normalized, should not need to re-normalize */</span>
<a name="l01945"></a>01945         <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a654dd0df4df6f960e592032f276f2c68">mul_qt_v3</a>(bevp_first-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>, vec_1);
<a name="l01946"></a>01946         <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a654dd0df4df6f960e592032f276f2c68">mul_qt_v3</a>(bevp_last-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>, vec_2);
<a name="l01947"></a>01947         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(vec_1);
<a name="l01948"></a>01948         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(vec_2);
<a name="l01949"></a>01949 
<a name="l01950"></a>01950         <span class="comment">/* align the vector, can avoid this and it looks 98% OK but</span>
<a name="l01951"></a>01951 <span class="comment">         * better to align the angle quat roll&#39;s before comparing */</span>
<a name="l01952"></a>01952         {
<a name="l01953"></a>01953             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(cross_tmp, bevp_last-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>, bevp_first-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>);
<a name="l01954"></a>01954             <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a> = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a4a2003033c639cab3de101b1cfe7a595">angle_normalized_v3v3</a>(bevp_first-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>, bevp_last-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>);
<a name="l01955"></a>01955             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a31e0d088e5faae71dd3e9e4232f7c2a5">axis_angle_to_quat</a>(q, cross_tmp, <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>);
<a name="l01956"></a>01956             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a654dd0df4df6f960e592032f276f2c68">mul_qt_v3</a>(q, vec_2);
<a name="l01957"></a>01957         }
<a name="l01958"></a>01958 
<a name="l01959"></a>01959         <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a4a2003033c639cab3de101b1cfe7a595">angle_normalized_v3v3</a>(vec_1, vec_2);
<a name="l01960"></a>01960 
<a name="l01961"></a>01961         <span class="comment">/* flip rotation if needs be */</span>
<a name="l01962"></a>01962         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(cross_tmp, vec_1, vec_2);
<a name="l01963"></a>01963         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(cross_tmp);
<a name="l01964"></a>01964         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a4a2003033c639cab3de101b1cfe7a595">angle_normalized_v3v3</a>(bevp_first-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>, cross_tmp) &lt; <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a5f7516f6821a4fe7671e385b9b01f6cb">DEG2RADF</a>(90.0f))
<a name="l01965"></a>01965             <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a> = -<a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>;
<a name="l01966"></a>01966 
<a name="l01967"></a>01967         bevp2= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l01968"></a>01968         bevp1= bevp2+(bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>-1);
<a name="l01969"></a>01969         bevp0= bevp1-1;
<a name="l01970"></a>01970 
<a name="l01971"></a>01971         nr= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>;
<a name="l01972"></a>01972         <span class="keywordflow">while</span> (nr--) {
<a name="l01973"></a>01973             ang_fac= <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a> * (1.0f-((float)nr/bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>)); <span class="comment">/* also works */</span>
<a name="l01974"></a>01974 
<a name="l01975"></a>01975             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a31e0d088e5faae71dd3e9e4232f7c2a5">axis_angle_to_quat</a>(q, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>, ang_fac);
<a name="l01976"></a>01976             <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a933ad0450d410fc2fae72afe434be287">mul_qt_qtqt</a>(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>, q, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>);
<a name="l01977"></a>01977 
<a name="l01978"></a>01978             bevp0= bevp1;
<a name="l01979"></a>01979             bevp1= bevp2;
<a name="l01980"></a>01980             bevp2++;
<a name="l01981"></a>01981         }
<a name="l01982"></a>01982     }
<a name="l01983"></a>01983 }
<a name="l01984"></a>01984 
<a name="l01985"></a><a class="code" href="../../dc/d22/curve_8c.html#a4c1afa71cfe4ec703e1bb27dcf69136b">01985</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#a4c1afa71cfe4ec703e1bb27dcf69136b">make_bevel_list_3D_tangent</a>(<a class="code" href="../../da/d87/structBevList.html">BevList</a> *<a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">bl</a>)
<a name="l01986"></a>01986 {
<a name="l01987"></a>01987     <a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *bevp2, *bevp1, *bevp0; <span class="comment">/* standard for all make_bevel_list_3D_* funcs */</span>
<a name="l01988"></a>01988     <span class="keywordtype">int</span> nr;
<a name="l01989"></a>01989 
<a name="l01990"></a>01990     <span class="keywordtype">float</span> bevp0_tan[3], cross_tmp[3];
<a name="l01991"></a>01991 
<a name="l01992"></a>01992     <a class="code" href="../../dc/d22/curve_8c.html#a2db1d1efdd0cd1eebf1eb1aff3870131">bevel_list_calc_bisect</a>(bl);
<a name="l01993"></a>01993     <span class="keywordflow">if</span> (bl-&gt;<a class="code" href="../../da/d87/structBevList.html#ab59610472c8b021334583bcf123bf1cb">poly</a>== -1) <span class="comment">/* check its not cyclic */</span>
<a name="l01994"></a>01994         <a class="code" href="../../dc/d22/curve_8c.html#ae77294331c656f3b2c0601963765a64b">bevel_list_cyclic_fix_3D</a>(bl); <span class="comment">// XXX - run this now so tangents will be right before doing the flipping</span>
<a name="l01995"></a>01995     <a class="code" href="../../dc/d22/curve_8c.html#a042a07c43e966f4a852ad82fc292304c">bevel_list_flip_tangents</a>(bl);
<a name="l01996"></a>01996 
<a name="l01997"></a>01997     <span class="comment">/* correct the tangents */</span>
<a name="l01998"></a>01998     bevp2= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l01999"></a>01999     bevp1= bevp2+(bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>-1);
<a name="l02000"></a>02000     bevp0= bevp1-1;
<a name="l02001"></a>02001 
<a name="l02002"></a>02002     nr= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>;
<a name="l02003"></a>02003     <span class="keywordflow">while</span> (nr--) {
<a name="l02004"></a>02004 
<a name="l02005"></a>02005         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(cross_tmp, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#aa4e7d6adabefc4fc9d88f6e6baea36aa">tan</a>, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>);
<a name="l02006"></a>02006         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#aa4e7d6adabefc4fc9d88f6e6baea36aa">tan</a>, cross_tmp, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>);
<a name="l02007"></a>02007         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#aa4e7d6adabefc4fc9d88f6e6baea36aa">tan</a>);
<a name="l02008"></a>02008 
<a name="l02009"></a>02009         bevp0= bevp1;
<a name="l02010"></a>02010         bevp1= bevp2;
<a name="l02011"></a>02011         bevp2++;
<a name="l02012"></a>02012     }
<a name="l02013"></a>02013 
<a name="l02014"></a>02014 
<a name="l02015"></a>02015     <span class="comment">/* now for the real twist calc */</span>
<a name="l02016"></a>02016     bevp2= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l02017"></a>02017     bevp1= bevp2+(bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>-1);
<a name="l02018"></a>02018     bevp0= bevp1-1;
<a name="l02019"></a>02019 
<a name="l02020"></a>02020     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bevp0_tan, bevp0-&gt;tan);
<a name="l02021"></a>02021 
<a name="l02022"></a>02022     nr= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>;
<a name="l02023"></a>02023     <span class="keywordflow">while</span> (nr--) {
<a name="l02024"></a>02024 
<a name="l02025"></a>02025         <span class="comment">/* make perpendicular, modify tan in place, is ok */</span>
<a name="l02026"></a>02026         <span class="keywordtype">float</span> cross_tmp[3];
<a name="l02027"></a>02027         <span class="keywordtype">float</span> zero[3] = {0,0,0};
<a name="l02028"></a>02028 
<a name="l02029"></a>02029         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(cross_tmp, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#aa4e7d6adabefc4fc9d88f6e6baea36aa">tan</a>, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>);
<a name="l02030"></a>02030         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(cross_tmp);
<a name="l02031"></a>02031         <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a4d97d48186cad8cc2e74aac472b76aab">tri_to_quat</a>( bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>,zero, cross_tmp, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#aa4e7d6adabefc4fc9d88f6e6baea36aa">tan</a>); <span class="comment">/* XXX - could be faster */</span>
<a name="l02032"></a>02032 
<a name="l02033"></a>02033         <span class="comment">/* bevp0= bevp1; */</span> <span class="comment">/* UNUSED */</span>
<a name="l02034"></a>02034         bevp1= bevp2;
<a name="l02035"></a>02035         bevp2++;
<a name="l02036"></a>02036     }
<a name="l02037"></a>02037 }
<a name="l02038"></a>02038 
<a name="l02039"></a><a class="code" href="../../dc/d22/curve_8c.html#ab39826c011efd60ec7bded9057e617f0">02039</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#ab39826c011efd60ec7bded9057e617f0">make_bevel_list_3D</a>(<a class="code" href="../../da/d87/structBevList.html">BevList</a> *<a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">bl</a>, <span class="keywordtype">int</span> smooth_iter, <span class="keywordtype">int</span> twist_mode)
<a name="l02040"></a>02040 {
<a name="l02041"></a>02041     <span class="keywordflow">switch</span>(twist_mode) {
<a name="l02042"></a>02042     <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aa6f1d35df52e92c5df17c20b59d08237">CU_TWIST_TANGENT</a>:
<a name="l02043"></a>02043         <a class="code" href="../../dc/d22/curve_8c.html#a4c1afa71cfe4ec703e1bb27dcf69136b">make_bevel_list_3D_tangent</a>(bl);
<a name="l02044"></a>02044         <span class="keywordflow">break</span>;
<a name="l02045"></a>02045     <span class="keywordflow">case</span> <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a7a91154d152da08afe9a82dc3371cc4b">CU_TWIST_MINIMUM</a>:
<a name="l02046"></a>02046         <a class="code" href="../../dc/d22/curve_8c.html#a35e42d11a38a0e74a248e728ad4f9ad2">make_bevel_list_3D_minimum_twist</a>(bl);
<a name="l02047"></a>02047         <span class="keywordflow">break</span>;
<a name="l02048"></a>02048     <span class="keywordflow">default</span>: <span class="comment">/* CU_TWIST_Z_UP default, pre 2.49c */</span>
<a name="l02049"></a>02049         <a class="code" href="../../dc/d22/curve_8c.html#a725d58121e831a320d6fe1b82a90c7bc">make_bevel_list_3D_zup</a>(bl);
<a name="l02050"></a>02050     }
<a name="l02051"></a>02051 
<a name="l02052"></a>02052     <span class="keywordflow">if</span> (bl-&gt;<a class="code" href="../../da/d87/structBevList.html#ab59610472c8b021334583bcf123bf1cb">poly</a>== -1) <span class="comment">/* check its not cyclic */</span>
<a name="l02053"></a>02053         <a class="code" href="../../dc/d22/curve_8c.html#ae77294331c656f3b2c0601963765a64b">bevel_list_cyclic_fix_3D</a>(bl);
<a name="l02054"></a>02054 
<a name="l02055"></a>02055     <span class="keywordflow">if</span> (smooth_iter)
<a name="l02056"></a>02056         <a class="code" href="../../dc/d22/curve_8c.html#a42b91c60c9fdcf15f71383df4acaae27">bevel_list_smooth</a>(bl, smooth_iter);
<a name="l02057"></a>02057 
<a name="l02058"></a>02058     <a class="code" href="../../dc/d22/curve_8c.html#a806b644eb4a64da766f08ceeb9962bb8">bevel_list_apply_tilt</a>(bl);
<a name="l02059"></a>02059 }
<a name="l02060"></a>02060 
<a name="l02061"></a>02061 
<a name="l02062"></a>02062 
<a name="l02063"></a>02063 <span class="comment">/* only for 2 points */</span>
<a name="l02064"></a><a class="code" href="../../dc/d22/curve_8c.html#a4559fd0bc5d6f8c5ffd71869519235f3">02064</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#a4559fd0bc5d6f8c5ffd71869519235f3">make_bevel_list_segment_3D</a>(<a class="code" href="../../da/d87/structBevList.html">BevList</a> *<a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">bl</a>)
<a name="l02065"></a>02065 {
<a name="l02066"></a>02066     <span class="keywordtype">float</span> q[4];
<a name="l02067"></a>02067 
<a name="l02068"></a>02068     <a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *bevp2= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l02069"></a>02069     <a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *bevp1= bevp2+1;
<a name="l02070"></a>02070 
<a name="l02071"></a>02071     <span class="comment">/* simple quat/dir */</span>
<a name="l02072"></a>02072     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>, bevp2-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>);
<a name="l02073"></a>02073     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>);
<a name="l02074"></a>02074 
<a name="l02075"></a>02075     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#afb9156556a1562b1debeb6d586859524">vec_to_quat</a>( bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>,bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>, 5, 1);
<a name="l02076"></a>02076 
<a name="l02077"></a>02077     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a31e0d088e5faae71dd3e9e4232f7c2a5">axis_angle_to_quat</a>(q, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a34e2426b43a8d30e838fdf17be47e226">alfa</a>);
<a name="l02078"></a>02078     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a933ad0450d410fc2fae72afe434be287">mul_qt_qtqt</a>(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>, q, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>);
<a name="l02079"></a>02079     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a58e1ba0822577e22846bd4352f111e81">normalize_qt</a>(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>);
<a name="l02080"></a>02080     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bevp2-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>);
<a name="l02081"></a>02081     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#ad474b870b380ee0c83901e9199506078">copy_qt_qt</a>(bevp2-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>);
<a name="l02082"></a>02082 }
<a name="l02083"></a>02083 
<a name="l02084"></a>02084 
<a name="l02085"></a>02085 
<a name="l02086"></a><a class="code" href="../../dc/d22/curve_8c.html#a1b5c48f1ea632a5a1479c3b84880f0b9">02086</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a89d8d6a33f49f41fd17cec7184e02240">makeBevelList</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l02087"></a>02087 {
<a name="l02088"></a>02088     <span class="comment">/*</span>
<a name="l02089"></a>02089 <span class="comment">     * - convert all curves to polys, with indication of resol and flags for double-vertices</span>
<a name="l02090"></a>02090 <span class="comment">     * - possibly; do a smart vertice removal (in case Nurb)</span>
<a name="l02091"></a>02091 <span class="comment">     * - separate in individual blicks with BoundBox</span>
<a name="l02092"></a>02092 <span class="comment">     * - AutoHole detection</span>
<a name="l02093"></a>02093 <span class="comment">     */</span>
<a name="l02094"></a>02094     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu;
<a name="l02095"></a>02095     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l02096"></a>02096     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt, *prevbezt;
<a name="l02097"></a>02097     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l02098"></a>02098     <a class="code" href="../../da/d87/structBevList.html">BevList</a> *<a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">bl</a>, *blnew, *blnext;
<a name="l02099"></a>02099     <a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *bevp, *bevp2, *bevp1 = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *bevp0;
<a name="l02100"></a>02100     <span class="keywordtype">float</span> <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>, inp, x1, x2, y1, y2;
<a name="l02101"></a>02101     <span class="keyword">struct </span><a class="code" href="../../d6/d3f/structbevelsort.html">bevelsort</a> *sortdata, *sd, *sd1;
<a name="l02102"></a>02102     <span class="keywordtype">int</span> a, b, nr, poly, resolu = 0, <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a> = 0;
<a name="l02103"></a>02103     <span class="keywordtype">int</span> do_tilt, do_radius, do_weight;
<a name="l02104"></a>02104     
<a name="l02105"></a>02105     <span class="comment">/* this function needs an object, because of tflag and upflag */</span>
<a name="l02106"></a>02106     cu= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l02107"></a>02107 
<a name="l02108"></a>02108     <span class="comment">/* do we need to calculate the radius for each point? */</span>
<a name="l02109"></a>02109     <span class="comment">/* do_radius = (cu-&gt;bevobj || cu-&gt;taperobj || (cu-&gt;flag &amp; CU_FRONT) || (cu-&gt;flag &amp; CU_BACK)) ? 0 : 1; */</span>
<a name="l02110"></a>02110     
<a name="l02111"></a>02111     <span class="comment">/* STEP 1: MAKE POLYS  */</span>
<a name="l02112"></a>02112 
<a name="l02113"></a>02113     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a70b76680fbc09de0e26f7eeec36be3f2">bev</a>));
<a name="l02114"></a>02114     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a> &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>!=<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1a94162b6fc469957966a01d41ff71d6">OB_FONT</a>) {
<a name="l02115"></a>02115         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nurbs= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a444d55e9e251234b0c8e22da36a06819">curve_editnurbs</a>(cu);
<a name="l02116"></a>02116         nu = nurbs-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02117"></a>02117     }
<a name="l02118"></a>02118     <span class="keywordflow">else</span> {
<a name="l02119"></a>02119         nu = cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02120"></a>02120     }
<a name="l02121"></a>02121     
<a name="l02122"></a>02122     <span class="keywordflow">while</span> (nu) {
<a name="l02123"></a>02123         
<a name="l02124"></a>02124         <span class="comment">/* check if we will calculate tilt data */</span>
<a name="l02125"></a>02125         do_tilt = <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a3adab323e74fdad113e5a0b4098352d5">CU_DO_TILT</a>(cu, nu);
<a name="l02126"></a>02126         do_radius = <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a25013e6a82df8d3f1017c3a8b6acad57">CU_DO_RADIUS</a>(cu, nu); <span class="comment">/* normal display uses the radius, better just to calculate them */</span>
<a name="l02127"></a>02127         do_weight = 1;
<a name="l02128"></a>02128         
<a name="l02129"></a>02129         <span class="comment">/* check we are a single point? also check we are not a surface and that the orderu is sane,</span>
<a name="l02130"></a>02130 <span class="comment">         * enforced in the UI but can go wrong possibly */</span>
<a name="l02131"></a>02131         <span class="keywordflow">if</span> (!<a class="code" href="../../d7/dfc/BKE__curve_8h.html#afcb8fc1bb7820c4260d027f5b7a011e3">check_valid_nurb_u</a>(nu)) {
<a name="l02132"></a>02132             bl= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d87/structBevList.html">BevList</a>)+1*<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a>), <span class="stringliteral">&quot;makeBevelList1&quot;</span>);
<a name="l02133"></a>02133             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a70b76680fbc09de0e26f7eeec36be3f2">bev</a>), bl);
<a name="l02134"></a>02134             bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>= 0;
<a name="l02135"></a>02135         }
<a name="l02136"></a>02136         <span class="keywordflow">else</span> {
<a name="l02137"></a>02137             <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.rendering &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af7040ffbe95c9d62cd327296a1752b5e">resolu_ren</a>!=0) 
<a name="l02138"></a>02138                 resolu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af7040ffbe95c9d62cd327296a1752b5e">resolu_ren</a>;
<a name="l02139"></a>02139             <span class="keywordflow">else</span>
<a name="l02140"></a>02140                 resolu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#aa4d5f2ef5e32e94dcbe14a1a7d946a30">resolu</a>;
<a name="l02141"></a>02141             
<a name="l02142"></a>02142             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#af3fcb97faad660091cefad29858eec77">CU_POLY</a>) {
<a name="l02143"></a>02143                 <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l02144"></a>02144                 bl= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d87/structBevList.html">BevList</a>)+<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>*<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a>), <span class="stringliteral">&quot;makeBevelList2&quot;</span>);
<a name="l02145"></a>02145                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a70b76680fbc09de0e26f7eeec36be3f2">bev</a>), bl);
<a name="l02146"></a>02146     
<a name="l02147"></a>02147                 <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) bl-&gt;<a class="code" href="../../da/d87/structBevList.html#ab59610472c8b021334583bcf123bf1cb">poly</a>= 0;
<a name="l02148"></a>02148                 <span class="keywordflow">else</span> bl-&gt;<a class="code" href="../../da/d87/structBevList.html#ab59610472c8b021334583bcf123bf1cb">poly</a>= -1;
<a name="l02149"></a>02149                 bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>= <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l02150"></a>02150                 bl-&gt;<a class="code" href="../../da/d87/structBevList.html#a958a652542f59d9325f9899f7fef1e1b">dupe_nr</a>= 0;
<a name="l02151"></a>02151                 bevp= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l02152"></a>02152                 bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l02153"></a>02153     
<a name="l02154"></a>02154                 <span class="keywordflow">while</span> (<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>--) {
<a name="l02155"></a>02155                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>, bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l02156"></a>02156                     bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a34e2426b43a8d30e838fdf17be47e226">alfa</a>= bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a1210ec737d6ced5cf276e22e8ca277f8">alfa</a>;
<a name="l02157"></a>02157                     bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a641e16f06b4291eee7ae6b7f792bda9a">radius</a>= bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#aa3142e8e1888fbd226cbe1d5ca47b4ac">radius</a>;
<a name="l02158"></a>02158                     bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#abc03f80ab58b5267f7c62b7778a194d0">weight</a>= bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a35879465825fbbab506bf4ccf2bbd8c2">weight</a>;
<a name="l02159"></a>02159                     bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a32afd63b41ba1b9f73cfa6f9824d1d21">split_tag</a>= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02160"></a>02160                     bevp++;
<a name="l02161"></a>02161                     bp++;
<a name="l02162"></a>02162                 }
<a name="l02163"></a>02163             }
<a name="l02164"></a>02164             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l02165"></a>02165     
<a name="l02166"></a>02166                 <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>= resolu*(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>+ (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) -1)+1; <span class="comment">/* in case last point is not cyclic */</span>
<a name="l02167"></a>02167                 bl= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d87/structBevList.html">BevList</a>)+<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>*<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a>), <span class="stringliteral">&quot;makeBevelBPoints&quot;</span>);
<a name="l02168"></a>02168                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a70b76680fbc09de0e26f7eeec36be3f2">bev</a>), bl);
<a name="l02169"></a>02169     
<a name="l02170"></a>02170                 <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) bl-&gt;<a class="code" href="../../da/d87/structBevList.html#ab59610472c8b021334583bcf123bf1cb">poly</a>= 0;
<a name="l02171"></a>02171                 <span class="keywordflow">else</span> bl-&gt;<a class="code" href="../../da/d87/structBevList.html#ab59610472c8b021334583bcf123bf1cb">poly</a>= -1;
<a name="l02172"></a>02172                 bevp= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l02173"></a>02173     
<a name="l02174"></a>02174                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1;
<a name="l02175"></a>02175                 bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l02176"></a>02176                 <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) {
<a name="l02177"></a>02177                     a++;
<a name="l02178"></a>02178                     prevbezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>+(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1);
<a name="l02179"></a>02179                 }
<a name="l02180"></a>02180                 <span class="keywordflow">else</span> {
<a name="l02181"></a>02181                     prevbezt= bezt;
<a name="l02182"></a>02182                     bezt++;
<a name="l02183"></a>02183                 }
<a name="l02184"></a>02184                 
<a name="l02185"></a>02185                 <span class="keywordflow">while</span> (a--) {
<a name="l02186"></a>02186                     <span class="keywordflow">if</span> (prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a> &amp;&amp; bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>) {
<a name="l02187"></a>02187 
<a name="l02188"></a>02188                         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>, prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1]);
<a name="l02189"></a>02189                         bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a34e2426b43a8d30e838fdf17be47e226">alfa</a>= prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a>;
<a name="l02190"></a>02190                         bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a641e16f06b4291eee7ae6b7f792bda9a">radius</a>= prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a>;
<a name="l02191"></a>02191                         bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#abc03f80ab58b5267f7c62b7778a194d0">weight</a>= prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad23314941e5bb9f62166fb79d623d2c3">weight</a>;
<a name="l02192"></a>02192                         bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a32afd63b41ba1b9f73cfa6f9824d1d21">split_tag</a>= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02193"></a>02193                         bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a1add478b44f28a19fffd8e04f6cdec22">dupe_tag</a>= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02194"></a>02194                         bevp++;
<a name="l02195"></a>02195                         bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>++;
<a name="l02196"></a>02196                         bl-&gt;<a class="code" href="../../da/d87/structBevList.html#a958a652542f59d9325f9899f7fef1e1b">dupe_nr</a>= 1;
<a name="l02197"></a>02197                     }
<a name="l02198"></a>02198                     <span class="keywordflow">else</span> {
<a name="l02199"></a>02199                         <span class="comment">/* always do all three, to prevent data hanging around */</span>
<a name="l02200"></a>02200                         <span class="keywordtype">int</span> j;
<a name="l02201"></a>02201                         
<a name="l02202"></a>02202                         <span class="comment">/* BevPoint must stay aligned to 4 so sizeof(BevPoint)/sizeof(float) works */</span>
<a name="l02203"></a>02203                         <span class="keywordflow">for</span> (j=0; j&lt;3; j++) {
<a name="l02204"></a>02204                             <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a44c2709924870c4af9d9268f691a63e0">forward_diff_bezier</a>(    prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][j],    prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2][j],
<a name="l02205"></a>02205                                                     bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0][j],        bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][j],
<a name="l02206"></a>02206                                                     &amp;(bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[j]), resolu, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a>));
<a name="l02207"></a>02207                         }
<a name="l02208"></a>02208                         
<a name="l02209"></a>02209                         <span class="comment">/* if both arrays are NULL do nothiong */</span>
<a name="l02210"></a>02210                         <a class="code" href="../../dc/d22/curve_8c.html#aa9b7cc763743e07d75917d3d3c9e904a">alfa_bezpart</a>(   prevbezt, bezt, nu,
<a name="l02211"></a>02211                                          do_tilt    ? &amp;bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a34e2426b43a8d30e838fdf17be47e226">alfa</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,
<a name="l02212"></a>02212                                          do_radius  ? &amp;bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a641e16f06b4291eee7ae6b7f792bda9a">radius</a> : NULL,
<a name="l02213"></a>02213                                          do_weight  ? &amp;bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#abc03f80ab58b5267f7c62b7778a194d0">weight</a> : NULL,
<a name="l02214"></a>02214                                          resolu, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a>));
<a name="l02215"></a>02215 
<a name="l02216"></a>02216                         
<a name="l02217"></a>02217                         <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a7a8d35b0d4aad3cc5c1873e23108bc0c">twist_mode</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aa6f1d35df52e92c5df17c20b59d08237">CU_TWIST_TANGENT</a>) {
<a name="l02218"></a>02218                             <a class="code" href="../../dc/d22/curve_8c.html#a62929b6c48aed7b5705855f2db5cfc93">forward_diff_bezier_cotangent</a>(
<a name="l02219"></a>02219                                                     prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1],   prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2],
<a name="l02220"></a>02220                                                     bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0],       bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1],
<a name="l02221"></a>02221                                                     bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#aa4e7d6adabefc4fc9d88f6e6baea36aa">tan</a>, resolu, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a>));
<a name="l02222"></a>02222                         }
<a name="l02223"></a>02223 
<a name="l02224"></a>02224                         <span class="comment">/* indicate with handlecodes double points */</span>
<a name="l02225"></a>02225                         <span class="keywordflow">if</span> (prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>) {
<a name="l02226"></a>02226                             <span class="keywordflow">if</span> (prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==0 || prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>) bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a32afd63b41ba1b9f73cfa6f9824d1d21">split_tag</a>= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02227"></a>02227                         }
<a name="l02228"></a>02228                         <span class="keywordflow">else</span> {
<a name="l02229"></a>02229                             <span class="keywordflow">if</span> (prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==0 || prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>) bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a32afd63b41ba1b9f73cfa6f9824d1d21">split_tag</a>= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02230"></a>02230                             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>==0 || prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>) bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a32afd63b41ba1b9f73cfa6f9824d1d21">split_tag</a>= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02231"></a>02231                         }
<a name="l02232"></a>02232                         bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>+= resolu;
<a name="l02233"></a>02233                         bevp+= resolu;
<a name="l02234"></a>02234                     }
<a name="l02235"></a>02235                     prevbezt= bezt;
<a name="l02236"></a>02236                     bezt++;
<a name="l02237"></a>02237                 }
<a name="l02238"></a>02238                 
<a name="l02239"></a>02239                 <span class="keywordflow">if</span> ((nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>)==0) {      <span class="comment">/* not cyclic: endpoint */</span>
<a name="l02240"></a>02240                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>, prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1]);
<a name="l02241"></a>02241                     bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a34e2426b43a8d30e838fdf17be47e226">alfa</a>= prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a>;
<a name="l02242"></a>02242                     bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a641e16f06b4291eee7ae6b7f792bda9a">radius</a>= prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#aba476cf5331c83294597e0913c3022c7">radius</a>;
<a name="l02243"></a>02243                     bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#abc03f80ab58b5267f7c62b7778a194d0">weight</a>= prevbezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad23314941e5bb9f62166fb79d623d2c3">weight</a>;
<a name="l02244"></a>02244                     bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>++;
<a name="l02245"></a>02245                 }
<a name="l02246"></a>02246             }
<a name="l02247"></a>02247             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l02248"></a>02248                 <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>==1) {
<a name="l02249"></a>02249                     <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>= (resolu*<a class="code" href="../../d7/dfc/BKE__curve_8h.html#adc36b28f69d2b06891837ba681f6c78e">SEGMENTSU</a>(nu));
<a name="l02250"></a>02250                     
<a name="l02251"></a>02251                     bl= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d87/structBevList.html">BevList</a>)+<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>*<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a>), <span class="stringliteral">&quot;makeBevelList3&quot;</span>);
<a name="l02252"></a>02252                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a70b76680fbc09de0e26f7eeec36be3f2">bev</a>), bl);
<a name="l02253"></a>02253                     bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>= <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l02254"></a>02254                     bl-&gt;<a class="code" href="../../da/d87/structBevList.html#a958a652542f59d9325f9899f7fef1e1b">dupe_nr</a>= 0;
<a name="l02255"></a>02255                     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) bl-&gt;<a class="code" href="../../da/d87/structBevList.html#ab59610472c8b021334583bcf123bf1cb">poly</a>= 0;
<a name="l02256"></a>02256                     <span class="keywordflow">else</span> bl-&gt;<a class="code" href="../../da/d87/structBevList.html#ab59610472c8b021334583bcf123bf1cb">poly</a>= -1;
<a name="l02257"></a>02257                     bevp= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l02258"></a>02258                     
<a name="l02259"></a>02259                     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a356a46488b92435335439582cc4213e5">makeNurbcurve</a>(  nu, &amp;bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[0],
<a name="l02260"></a>02260                                     do_tilt     ? &amp;bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a34e2426b43a8d30e838fdf17be47e226">alfa</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,
<a name="l02261"></a>02261                                     do_radius   ? &amp;bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a641e16f06b4291eee7ae6b7f792bda9a">radius</a> : NULL,
<a name="l02262"></a>02262                                     do_weight   ? &amp;bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#abc03f80ab58b5267f7c62b7778a194d0">weight</a> : NULL,
<a name="l02263"></a>02263                                     resolu, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a>));
<a name="l02264"></a>02264                 }
<a name="l02265"></a>02265             }
<a name="l02266"></a>02266         }
<a name="l02267"></a>02267         nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l02268"></a>02268     }
<a name="l02269"></a>02269 
<a name="l02270"></a>02270     <span class="comment">/* STEP 2: DOUBLE POINTS AND AUTOMATIC RESOLUTION, REDUCE DATABLOCKS */</span>
<a name="l02271"></a>02271     bl= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a70b76680fbc09de0e26f7eeec36be3f2">bev</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02272"></a>02272     <span class="keywordflow">while</span> (bl) {
<a name="l02273"></a>02273         <span class="keywordflow">if</span> (bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>) { <span class="comment">/* null bevel items come from single points */</span>
<a name="l02274"></a>02274             nr= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>;
<a name="l02275"></a>02275             bevp1= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l02276"></a>02276             bevp0= bevp1+(nr-1);
<a name="l02277"></a>02277             nr--;
<a name="l02278"></a>02278             <span class="keywordflow">while</span> (nr--) {
<a name="l02279"></a>02279                 <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(bevp0-&gt;vec[0]-bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[0])&lt;0.00001 ) {
<a name="l02280"></a>02280                     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(bevp0-&gt;vec[1]-bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[1])&lt;0.00001 ) {
<a name="l02281"></a>02281                         <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(bevp0-&gt;vec[2]-bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[2])&lt;0.00001 ) {
<a name="l02282"></a>02282                             bevp0-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a1add478b44f28a19fffd8e04f6cdec22">dupe_tag</a>= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02283"></a>02283                             bl-&gt;<a class="code" href="../../da/d87/structBevList.html#a958a652542f59d9325f9899f7fef1e1b">dupe_nr</a>++;
<a name="l02284"></a>02284                         }
<a name="l02285"></a>02285                     }
<a name="l02286"></a>02286                 }
<a name="l02287"></a>02287                 bevp0= bevp1;
<a name="l02288"></a>02288                 bevp1++;
<a name="l02289"></a>02289             }
<a name="l02290"></a>02290         }
<a name="l02291"></a>02291         bl= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#a68186a5eb7cc0b0aab5620b475f2603f">next</a>;
<a name="l02292"></a>02292     }
<a name="l02293"></a>02293     bl= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a70b76680fbc09de0e26f7eeec36be3f2">bev</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02294"></a>02294     <span class="keywordflow">while</span> (bl) {
<a name="l02295"></a>02295         blnext= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#a68186a5eb7cc0b0aab5620b475f2603f">next</a>;
<a name="l02296"></a>02296         <span class="keywordflow">if</span> (bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a> &amp;&amp; bl-&gt;<a class="code" href="../../da/d87/structBevList.html#a958a652542f59d9325f9899f7fef1e1b">dupe_nr</a>) {
<a name="l02297"></a>02297             nr= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>- bl-&gt;<a class="code" href="../../da/d87/structBevList.html#a958a652542f59d9325f9899f7fef1e1b">dupe_nr</a>+1;  <span class="comment">/* +1 because vectorbezier sets flag too */</span>
<a name="l02298"></a>02298             blnew= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d87/structBevList.html">BevList</a>)+nr*<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a>), <span class="stringliteral">&quot;makeBevelList4&quot;</span>);
<a name="l02299"></a>02299             memcpy(blnew, bl, <span class="keyword">sizeof</span>(<a class="code" href="../../da/d87/structBevList.html">BevList</a>));
<a name="l02300"></a>02300             blnew-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>= 0;
<a name="l02301"></a>02301             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a70b76680fbc09de0e26f7eeec36be3f2">bev</a>), bl);
<a name="l02302"></a>02302             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a168dc4cffe5e3a86086f3cfc4f7b95e6">BLI_insertlinkbefore</a>(&amp;(cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a70b76680fbc09de0e26f7eeec36be3f2">bev</a>),blnext,blnew);  <span class="comment">/* to make sure bevlijst is tuned with nurblist */</span>
<a name="l02303"></a>02303             bevp0= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l02304"></a>02304             bevp1= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(blnew+1);
<a name="l02305"></a>02305             nr= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>;
<a name="l02306"></a>02306             <span class="keywordflow">while</span> (nr--) {
<a name="l02307"></a>02307                 <span class="keywordflow">if</span> (bevp0-&gt;dupe_tag==0) {
<a name="l02308"></a>02308                     memcpy(bevp1, bevp0, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a>));
<a name="l02309"></a>02309                     bevp1++;
<a name="l02310"></a>02310                     blnew-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>++;
<a name="l02311"></a>02311                 }
<a name="l02312"></a>02312                 bevp0++;
<a name="l02313"></a>02313             }
<a name="l02314"></a>02314             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(bl);
<a name="l02315"></a>02315             blnew-&gt;<a class="code" href="../../da/d87/structBevList.html#a958a652542f59d9325f9899f7fef1e1b">dupe_nr</a>= 0;
<a name="l02316"></a>02316         }
<a name="l02317"></a>02317         bl= blnext;
<a name="l02318"></a>02318     }
<a name="l02319"></a>02319 
<a name="l02320"></a>02320     <span class="comment">/* STEP 3: POLYS COUNT AND AUTOHOLE */</span>
<a name="l02321"></a>02321     bl= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a70b76680fbc09de0e26f7eeec36be3f2">bev</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02322"></a>02322     poly= 0;
<a name="l02323"></a>02323     <span class="keywordflow">while</span> (bl) {
<a name="l02324"></a>02324         <span class="keywordflow">if</span> (bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a> &amp;&amp; bl-&gt;<a class="code" href="../../da/d87/structBevList.html#ab59610472c8b021334583bcf123bf1cb">poly</a>&gt;=0) {
<a name="l02325"></a>02325             poly++;
<a name="l02326"></a>02326             bl-&gt;<a class="code" href="../../da/d87/structBevList.html#ab59610472c8b021334583bcf123bf1cb">poly</a>= poly;
<a name="l02327"></a>02327             bl-&gt;<a class="code" href="../../da/d87/structBevList.html#a84bc6611989e69996299530a47d5d6bc">hole</a>= 0;
<a name="l02328"></a>02328         }
<a name="l02329"></a>02329         bl= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#a68186a5eb7cc0b0aab5620b475f2603f">next</a>;
<a name="l02330"></a>02330     }
<a name="l02331"></a>02331     
<a name="l02332"></a>02332 
<a name="l02333"></a>02333     <span class="comment">/* find extreme left points, also test (turning) direction */</span>
<a name="l02334"></a>02334     <span class="keywordflow">if</span> (poly&gt;0) {
<a name="l02335"></a>02335         sd= sortdata= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../d6/d3f/structbevelsort.html">bevelsort</a>)*poly, <span class="stringliteral">&quot;makeBevelList5&quot;</span>);
<a name="l02336"></a>02336         bl= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a70b76680fbc09de0e26f7eeec36be3f2">bev</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02337"></a>02337         <span class="keywordflow">while</span> (bl) {
<a name="l02338"></a>02338             <span class="keywordflow">if</span> (bl-&gt;<a class="code" href="../../da/d87/structBevList.html#ab59610472c8b021334583bcf123bf1cb">poly</a>&gt;0) {
<a name="l02339"></a>02339 
<a name="l02340"></a>02340                 min= 300000.0;
<a name="l02341"></a>02341                 bevp= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l02342"></a>02342                 nr= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>;
<a name="l02343"></a>02343                 <span class="keywordflow">while</span> (nr--) {
<a name="l02344"></a>02344                     <span class="keywordflow">if</span> (min&gt;bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[0]) {
<a name="l02345"></a>02345                         min= bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[0];
<a name="l02346"></a>02346                         bevp1= bevp;
<a name="l02347"></a>02347                     }
<a name="l02348"></a>02348                     bevp++;
<a name="l02349"></a>02349                 }
<a name="l02350"></a>02350                 sd-&gt;<a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">bl</a>= <a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">bl</a>;
<a name="l02351"></a>02351                 sd-&gt;<a class="code" href="../../d6/d3f/structbevelsort.html#ad2a6a39dc2086dbfb6dbf6ddbfae68f9">left</a>= <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>;
<a name="l02352"></a>02352 
<a name="l02353"></a>02353                 bevp= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l02354"></a>02354                 <span class="keywordflow">if</span> (bevp1== bevp) bevp0= bevp+ (bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>-1);
<a name="l02355"></a>02355                 <span class="keywordflow">else</span> bevp0= bevp1-1;
<a name="l02356"></a>02356                 bevp= bevp+ (bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>-1);
<a name="l02357"></a>02357                 <span class="keywordflow">if</span> (bevp1== bevp) bevp2= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l02358"></a>02358                 <span class="keywordflow">else</span> bevp2= bevp1+1;
<a name="l02359"></a>02359 
<a name="l02360"></a>02360                 inp= (bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[0]- bevp0-&gt;vec[0]) * (bevp0-&gt;vec[1]- bevp2-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[1]) + (bevp0-&gt;vec[1]- bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[1]) * (bevp0-&gt;vec[0]- bevp2-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[0]);
<a name="l02361"></a>02361 
<a name="l02362"></a>02362                 <span class="keywordflow">if</span> (inp &gt; 0.0f) sd-&gt;<a class="code" href="../../d6/d3f/structbevelsort.html#a6035ed5da5e50469a68fc66a40a2e812">dir</a>= 1;
<a name="l02363"></a>02363                 <span class="keywordflow">else</span> sd-&gt;<a class="code" href="../../d6/d3f/structbevelsort.html#a6035ed5da5e50469a68fc66a40a2e812">dir</a>= 0;
<a name="l02364"></a>02364 
<a name="l02365"></a>02365                 sd++;
<a name="l02366"></a>02366             }
<a name="l02367"></a>02367 
<a name="l02368"></a>02368             bl= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#a68186a5eb7cc0b0aab5620b475f2603f">next</a>;
<a name="l02369"></a>02369         }
<a name="l02370"></a>02370         qsort(sortdata,poly,<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../d6/d3f/structbevelsort.html">bevelsort</a>), <a class="code" href="../../dc/d22/curve_8c.html#a571c05a26b879c3199cf6ddf1c36d7cb">vergxcobev</a>);
<a name="l02371"></a>02371 
<a name="l02372"></a>02372         sd= sortdata+1;
<a name="l02373"></a>02373         <span class="keywordflow">for</span> (a=1; a&lt;poly; a++, sd++) {
<a name="l02374"></a>02374             bl= sd-&gt;<a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">bl</a>;     <span class="comment">/* is bl a hole? */</span>
<a name="l02375"></a>02375             sd1= sortdata+ (a-1);
<a name="l02376"></a>02376             <span class="keywordflow">for</span> (b=a-1; b&gt;=0; b--, sd1--) { <span class="comment">/* all polys to the left */</span>
<a name="l02377"></a>02377                 <span class="keywordflow">if</span> (<a class="code" href="../../dc/d22/curve_8c.html#a3f9be9282aee525638da73e2226bb699">bevelinside</a>(sd1-&gt;<a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">bl</a>, bl)) {
<a name="l02378"></a>02378                     bl-&gt;<a class="code" href="../../da/d87/structBevList.html#a84bc6611989e69996299530a47d5d6bc">hole</a>= 1- sd1-&gt;<a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">bl</a>-&gt;<a class="code" href="../../da/d87/structBevList.html#a84bc6611989e69996299530a47d5d6bc">hole</a>;
<a name="l02379"></a>02379                     <span class="keywordflow">break</span>;
<a name="l02380"></a>02380                 }
<a name="l02381"></a>02381             }
<a name="l02382"></a>02382         }
<a name="l02383"></a>02383 
<a name="l02384"></a>02384         <span class="comment">/* turning direction */</span>
<a name="l02385"></a>02385         <span class="keywordflow">if</span> ((cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae2e952bfa23ce6735422c9e7bae27dac">CU_3D</a>)==0) {
<a name="l02386"></a>02386             sd= sortdata;
<a name="l02387"></a>02387             <span class="keywordflow">for</span> (a=0; a&lt;poly; a++, sd++) {
<a name="l02388"></a>02388                 <span class="keywordflow">if</span> (sd-&gt;<a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">bl</a>-&gt;<a class="code" href="../../da/d87/structBevList.html#a84bc6611989e69996299530a47d5d6bc">hole</a>==sd-&gt;<a class="code" href="../../d6/d3f/structbevelsort.html#a6035ed5da5e50469a68fc66a40a2e812">dir</a>) {
<a name="l02389"></a>02389                     bl= sd-&gt;<a class="code" href="../../d6/d3f/structbevelsort.html#aa0728868f85f9651780ec8f23647a783">bl</a>;
<a name="l02390"></a>02390                     bevp1= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l02391"></a>02391                     bevp2= bevp1+ (bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>-1);
<a name="l02392"></a>02392                     nr= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>/2;
<a name="l02393"></a>02393                     <span class="keywordflow">while</span> (nr--) {
<a name="l02394"></a>02394                         <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a>, *bevp1, *bevp2);
<a name="l02395"></a>02395                         bevp1++;
<a name="l02396"></a>02396                         bevp2--;
<a name="l02397"></a>02397                     }
<a name="l02398"></a>02398                 }
<a name="l02399"></a>02399             }
<a name="l02400"></a>02400         }
<a name="l02401"></a>02401         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(sortdata);
<a name="l02402"></a>02402     }
<a name="l02403"></a>02403 
<a name="l02404"></a>02404     <span class="comment">/* STEP 4: 2D-COSINES or 3D ORIENTATION */</span>
<a name="l02405"></a>02405     <span class="keywordflow">if</span> ((cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae2e952bfa23ce6735422c9e7bae27dac">CU_3D</a>)==0) {
<a name="l02406"></a>02406         <span class="comment">/* note: bevp-&gt;dir and bevp-&gt;quat are not needed for beveling but are</span>
<a name="l02407"></a>02407 <span class="comment">         * used when making a path from a 2D curve, therefor they need to be set - Campbell */</span>
<a name="l02408"></a>02408         bl= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a70b76680fbc09de0e26f7eeec36be3f2">bev</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02409"></a>02409         <span class="keywordflow">while</span> (bl) {
<a name="l02410"></a>02410 
<a name="l02411"></a>02411             <span class="keywordflow">if</span> (bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a> &lt; 2) {
<a name="l02412"></a>02412                 <span class="comment">/* do nothing */</span>
<a name="l02413"></a>02413             }
<a name="l02414"></a>02414             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>==2) {   <span class="comment">/* 2 pnt, treat separate */</span>
<a name="l02415"></a>02415                 bevp2= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l02416"></a>02416                 bevp1= bevp2+1;
<a name="l02417"></a>02417 
<a name="l02418"></a>02418                 x1= bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[0]- bevp2-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[0];
<a name="l02419"></a>02419                 y1= bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[1]- bevp2-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[1];
<a name="l02420"></a>02420 
<a name="l02421"></a>02421                 <a class="code" href="../../dc/d22/curve_8c.html#ae741ad320431c2335b68d6cac7d25ccd">calc_bevel_sin_cos</a>(x1, y1, -x1, -y1, &amp;(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8ba8745b390e47781b63c738f25a9c5e">sina</a>), &amp;(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#abf3a982400a04b92f893ceae86c61bc8">cosa</a>));
<a name="l02422"></a>02422                 bevp2-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8ba8745b390e47781b63c738f25a9c5e">sina</a>= bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8ba8745b390e47781b63c738f25a9c5e">sina</a>;
<a name="l02423"></a>02423                 bevp2-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#abf3a982400a04b92f893ceae86c61bc8">cosa</a>= bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#abf3a982400a04b92f893ceae86c61bc8">cosa</a>;
<a name="l02424"></a>02424 
<a name="l02425"></a>02425                 <span class="comment">/* fill in dir &amp; quat */</span>
<a name="l02426"></a>02426                 <a class="code" href="../../dc/d22/curve_8c.html#a4559fd0bc5d6f8c5ffd71869519235f3">make_bevel_list_segment_3D</a>(bl);
<a name="l02427"></a>02427             }
<a name="l02428"></a>02428             <span class="keywordflow">else</span> {
<a name="l02429"></a>02429                 bevp2= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l02430"></a>02430                 bevp1= bevp2+(bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>-1);
<a name="l02431"></a>02431                 bevp0= bevp1-1;
<a name="l02432"></a>02432 
<a name="l02433"></a>02433                 nr= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>;
<a name="l02434"></a>02434                 <span class="keywordflow">while</span> (nr--) {
<a name="l02435"></a>02435                     x1= bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[0]- bevp0-&gt;vec[0];
<a name="l02436"></a>02436                     x2= bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[0]- bevp2-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[0];
<a name="l02437"></a>02437                     y1= bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[1]- bevp0-&gt;vec[1];
<a name="l02438"></a>02438                     y2= bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[1]- bevp2-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>[1];
<a name="l02439"></a>02439 
<a name="l02440"></a>02440                     <a class="code" href="../../dc/d22/curve_8c.html#ae741ad320431c2335b68d6cac7d25ccd">calc_bevel_sin_cos</a>(x1, y1, x2, y2, &amp;(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8ba8745b390e47781b63c738f25a9c5e">sina</a>), &amp;(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#abf3a982400a04b92f893ceae86c61bc8">cosa</a>));
<a name="l02441"></a>02441 
<a name="l02442"></a>02442                     <span class="comment">/* from: make_bevel_list_3D_zup, could call but avoid a second loop.</span>
<a name="l02443"></a>02443 <span class="comment">                     * no need for tricky tilt calculation as with 3D curves */</span>
<a name="l02444"></a>02444                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#afd385fbdd1744179920c9d11d3bf1921">bisect_v3_v3v3v3</a>(bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>, bevp0-&gt;vec, bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>, bevp2-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ad2643c295297687f350963481cbafeb8">vec</a>);
<a name="l02445"></a>02445                     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#afb9156556a1562b1debeb6d586859524">vec_to_quat</a>( bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#ab42bf2b0cdeb7336745014f3d97b0854">quat</a>,bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8201290db6335a29a17d10798904e927">dir</a>, 5, 1);
<a name="l02446"></a>02446                     <span class="comment">/* done with inline make_bevel_list_3D_zup */</span>
<a name="l02447"></a>02447 
<a name="l02448"></a>02448                     bevp0= bevp1;
<a name="l02449"></a>02449                     bevp1= bevp2;
<a name="l02450"></a>02450                     bevp2++;
<a name="l02451"></a>02451                 }
<a name="l02452"></a>02452 
<a name="l02453"></a>02453                 <span class="comment">/* correct non-cyclic cases */</span>
<a name="l02454"></a>02454                 <span class="keywordflow">if</span> (bl-&gt;<a class="code" href="../../da/d87/structBevList.html#ab59610472c8b021334583bcf123bf1cb">poly</a>== -1) {
<a name="l02455"></a>02455                     bevp= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l02456"></a>02456                     bevp1= bevp+1;
<a name="l02457"></a>02457                     bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8ba8745b390e47781b63c738f25a9c5e">sina</a>= bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8ba8745b390e47781b63c738f25a9c5e">sina</a>;
<a name="l02458"></a>02458                     bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#abf3a982400a04b92f893ceae86c61bc8">cosa</a>= bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#abf3a982400a04b92f893ceae86c61bc8">cosa</a>;
<a name="l02459"></a>02459                     bevp= (<a class="code" href="../../d1/d37/structBevPoint.html">BevPoint</a> *)(bl+1);
<a name="l02460"></a>02460                     bevp+= (bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>-1);
<a name="l02461"></a>02461                     bevp1= bevp-1;
<a name="l02462"></a>02462                     bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8ba8745b390e47781b63c738f25a9c5e">sina</a>= bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#a8ba8745b390e47781b63c738f25a9c5e">sina</a>;
<a name="l02463"></a>02463                     bevp-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#abf3a982400a04b92f893ceae86c61bc8">cosa</a>= bevp1-&gt;<a class="code" href="../../d1/d37/structBevPoint.html#abf3a982400a04b92f893ceae86c61bc8">cosa</a>;
<a name="l02464"></a>02464 
<a name="l02465"></a>02465                     <span class="comment">/* correct for the dir/quat, see above why its needed */</span>
<a name="l02466"></a>02466                     <a class="code" href="../../dc/d22/curve_8c.html#ae77294331c656f3b2c0601963765a64b">bevel_list_cyclic_fix_3D</a>(bl);
<a name="l02467"></a>02467                 }
<a name="l02468"></a>02468             }
<a name="l02469"></a>02469             bl= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#a68186a5eb7cc0b0aab5620b475f2603f">next</a>;
<a name="l02470"></a>02470         }
<a name="l02471"></a>02471     }
<a name="l02472"></a>02472     <span class="keywordflow">else</span> { <span class="comment">/* 3D Curves */</span>
<a name="l02473"></a>02473         bl= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a70b76680fbc09de0e26f7eeec36be3f2">bev</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02474"></a>02474         <span class="keywordflow">while</span> (bl) {
<a name="l02475"></a>02475 
<a name="l02476"></a>02476             <span class="keywordflow">if</span> (bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a> &lt; 2) {
<a name="l02477"></a>02477                 <span class="comment">/* do nothing */</span>
<a name="l02478"></a>02478             }
<a name="l02479"></a>02479             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bl-&gt;<a class="code" href="../../da/d87/structBevList.html#adff305ce201b2987c8c9cb1eaf9bdfa8">nr</a>==2) {   <span class="comment">/* 2 pnt, treat separate */</span>
<a name="l02480"></a>02480                 <a class="code" href="../../dc/d22/curve_8c.html#a4559fd0bc5d6f8c5ffd71869519235f3">make_bevel_list_segment_3D</a>(bl);
<a name="l02481"></a>02481             }
<a name="l02482"></a>02482             <span class="keywordflow">else</span> {
<a name="l02483"></a>02483                 <a class="code" href="../../dc/d22/curve_8c.html#ab39826c011efd60ec7bded9057e617f0">make_bevel_list_3D</a>(bl, (<span class="keywordtype">int</span>)(resolu*cu-&gt;<a class="code" href="../../da/d10/structCurve.html#af97309511f553d2b96a297bac6f14e4c">twist_smooth</a>), cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a7a8d35b0d4aad3cc5c1873e23108bc0c">twist_mode</a>);
<a name="l02484"></a>02484             }
<a name="l02485"></a>02485             bl= bl-&gt;<a class="code" href="../../da/d87/structBevList.html#a68186a5eb7cc0b0aab5620b475f2603f">next</a>;
<a name="l02486"></a>02486         }
<a name="l02487"></a>02487     }
<a name="l02488"></a>02488 }
<a name="l02489"></a>02489 
<a name="l02490"></a>02490 <span class="comment">/* ****************** HANDLES ************** */</span>
<a name="l02491"></a>02491 
<a name="l02492"></a>02492 <span class="comment">/*</span>
<a name="l02493"></a>02493 <span class="comment"> *   handlecodes:</span>
<a name="l02494"></a>02494 <span class="comment"> *      0: nothing,  1:auto,  2:vector,  3:aligned</span>
<a name="l02495"></a>02495 <span class="comment"> */</span>
<a name="l02496"></a>02496 
<a name="l02497"></a>02497 <span class="comment">/* mode: is not zero when FCurve, is 2 when forced horizontal for autohandles */</span>
<a name="l02498"></a><a class="code" href="../../dc/d22/curve_8c.html#a1285739af9084c34357e413d9dbbde89">02498</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#a1285739af9084c34357e413d9dbbde89">calchandleNurb_intern</a>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *prev, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>, <span class="keywordtype">int</span> mode, <span class="keywordtype">int</span> skip_align)
<a name="l02499"></a>02499 {
<a name="l02500"></a>02500     <span class="keywordtype">float</span> *p1,*p2,*p3, pt[3];
<a name="l02501"></a>02501     <span class="keywordtype">float</span> dvec_a[3], dvec_b[3];
<a name="l02502"></a>02502     <span class="keywordtype">float</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>, len_a, len_b;
<a name="l02503"></a>02503     <span class="keyword">const</span> <span class="keywordtype">float</span> eps= 1e-5;
<a name="l02504"></a>02504 
<a name="l02505"></a>02505     <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==0 &amp;&amp; bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>==0) {
<a name="l02506"></a>02506         <span class="keywordflow">return</span>;
<a name="l02507"></a>02507     }
<a name="l02508"></a>02508 
<a name="l02509"></a>02509     p2= bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1];
<a name="l02510"></a>02510 
<a name="l02511"></a>02511     <span class="keywordflow">if</span> (prev==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02512"></a>02512         p3= next-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1];
<a name="l02513"></a>02513         pt[0]= 2.0f*p2[0] - p3[0];
<a name="l02514"></a>02514         pt[1]= 2.0f*p2[1] - p3[1];
<a name="l02515"></a>02515         pt[2]= 2.0f*p2[2] - p3[2];
<a name="l02516"></a>02516         p1= pt;
<a name="l02517"></a>02517     }
<a name="l02518"></a>02518     <span class="keywordflow">else</span> {
<a name="l02519"></a>02519         p1= prev-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1];
<a name="l02520"></a>02520     }
<a name="l02521"></a>02521 
<a name="l02522"></a>02522     <span class="keywordflow">if</span> (next==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02523"></a>02523         pt[0]= 2.0f*p2[0] - p1[0];
<a name="l02524"></a>02524         pt[1]= 2.0f*p2[1] - p1[1];
<a name="l02525"></a>02525         pt[2]= 2.0f*p2[2] - p1[2];
<a name="l02526"></a>02526         p3= pt;
<a name="l02527"></a>02527     }
<a name="l02528"></a>02528     <span class="keywordflow">else</span> {
<a name="l02529"></a>02529         p3= next-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1];
<a name="l02530"></a>02530     }
<a name="l02531"></a>02531 
<a name="l02532"></a>02532     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(dvec_a, p2, p1);
<a name="l02533"></a>02533     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(dvec_b, p3, p2);
<a name="l02534"></a>02534 
<a name="l02535"></a>02535     <span class="keywordflow">if</span> (mode != 0) {
<a name="l02536"></a>02536         len_a= dvec_a[0];
<a name="l02537"></a>02537         len_b= dvec_b[0];
<a name="l02538"></a>02538     }
<a name="l02539"></a>02539     <span class="keywordflow">else</span> {
<a name="l02540"></a>02540         len_a= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(dvec_a);
<a name="l02541"></a>02541         len_b= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(dvec_b);
<a name="l02542"></a>02542     }
<a name="l02543"></a>02543 
<a name="l02544"></a>02544     <span class="keywordflow">if</span> (len_a==0.0f) len_a=1.0f;
<a name="l02545"></a>02545     <span class="keywordflow">if</span> (len_b==0.0f) len_b=1.0f;
<a name="l02546"></a>02546 
<a name="l02547"></a>02547 
<a name="l02548"></a>02548     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>,<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>,<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca015592fc9e4aa078609a35b5bc00e698">HD_AUTO_ANIM</a>) || <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>,<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>,<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca015592fc9e4aa078609a35b5bc00e698">HD_AUTO_ANIM</a>)) {    <span class="comment">/* auto */</span>
<a name="l02549"></a>02549         <span class="keywordtype">float</span> tvec[3];
<a name="l02550"></a>02550         tvec[0]= dvec_b[0]/len_b + dvec_a[0]/len_a;
<a name="l02551"></a>02551         tvec[1]= dvec_b[1]/len_b + dvec_a[1]/len_a;
<a name="l02552"></a>02552         tvec[2]= dvec_b[2]/len_b + dvec_a[2]/len_a;
<a name="l02553"></a>02553         len= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(tvec) * 2.5614f;
<a name="l02554"></a>02554 
<a name="l02555"></a>02555         <span class="keywordflow">if</span> (len!=0.0f) {
<a name="l02556"></a>02556             <span class="keywordtype">int</span> leftviolate=0, rightviolate=0;  <span class="comment">/* for mode==2 */</span>
<a name="l02557"></a>02557             
<a name="l02558"></a>02558             <span class="keywordflow">if</span> (len_a&gt;5.0f*len_b) len_a= 5.0f*len_b;
<a name="l02559"></a>02559             <span class="keywordflow">if</span> (len_b&gt;5.0f*len_a) len_b= 5.0f*len_a;
<a name="l02560"></a>02560             
<a name="l02561"></a>02561             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>,<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>,<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca015592fc9e4aa078609a35b5bc00e698">HD_AUTO_ANIM</a>)) {
<a name="l02562"></a>02562                 len_a/=<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l02563"></a>02563                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ac993b3c38bb2d5e7de48e57aab03db7f">madd_v3_v3v3fl</a>(p2-3, p2, tvec, -len_a);
<a name="l02564"></a>02564                 
<a name="l02565"></a>02565                 <span class="keywordflow">if</span> ((bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca015592fc9e4aa078609a35b5bc00e698">HD_AUTO_ANIM</a>) &amp;&amp; next &amp;&amp; prev) { <span class="comment">/* keep horizontal if extrema */</span>
<a name="l02566"></a>02566                     <span class="keywordtype">float</span> ydiff1= prev-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1] - bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1];
<a name="l02567"></a>02567                     <span class="keywordtype">float</span> ydiff2= next-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1] - bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1];
<a name="l02568"></a>02568                     <span class="keywordflow">if</span> ( (ydiff1 &lt;= 0.0f &amp;&amp; ydiff2 &lt;= 0.0f) || (ydiff1 &gt;= 0.0f &amp;&amp; ydiff2 &gt;= 0.0f) ) {
<a name="l02569"></a>02569                         bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0][1]= bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1];
<a name="l02570"></a>02570                     }
<a name="l02571"></a>02571                     <span class="keywordflow">else</span> { <span class="comment">/* handles should not be beyond y coord of two others */</span>
<a name="l02572"></a>02572                         <span class="keywordflow">if</span> (ydiff1 &lt;= 0.0f) {
<a name="l02573"></a>02573                             <span class="keywordflow">if</span> (prev-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1] &gt; bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0][1]) {
<a name="l02574"></a>02574                                 bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0][1]= prev-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1]; 
<a name="l02575"></a>02575                                 leftviolate= 1;
<a name="l02576"></a>02576                             }
<a name="l02577"></a>02577                         }
<a name="l02578"></a>02578                         <span class="keywordflow">else</span> {
<a name="l02579"></a>02579                             <span class="keywordflow">if</span> (prev-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1] &lt; bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0][1]) {
<a name="l02580"></a>02580                                 bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0][1]= prev-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1]; 
<a name="l02581"></a>02581                                 leftviolate= 1;
<a name="l02582"></a>02582                             }
<a name="l02583"></a>02583                         }
<a name="l02584"></a>02584                     }
<a name="l02585"></a>02585                 }
<a name="l02586"></a>02586             }
<a name="l02587"></a>02587             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>,<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>,<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca015592fc9e4aa078609a35b5bc00e698">HD_AUTO_ANIM</a>)) {
<a name="l02588"></a>02588                 len_b/=<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l02589"></a>02589                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ac993b3c38bb2d5e7de48e57aab03db7f">madd_v3_v3v3fl</a>(p2+3, p2, tvec,  len_b);
<a name="l02590"></a>02590                 
<a name="l02591"></a>02591                 <span class="keywordflow">if</span> ((bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca015592fc9e4aa078609a35b5bc00e698">HD_AUTO_ANIM</a>) &amp;&amp; next &amp;&amp; prev) { <span class="comment">/* keep horizontal if extrema */</span>
<a name="l02592"></a>02592                     <span class="keywordtype">float</span> ydiff1= prev-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1] - bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1];
<a name="l02593"></a>02593                     <span class="keywordtype">float</span> ydiff2= next-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1] - bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1];
<a name="l02594"></a>02594                     <span class="keywordflow">if</span> ( (ydiff1 &lt;= 0.0f &amp;&amp; ydiff2 &lt;= 0.0f) || (ydiff1 &gt;= 0.0f &amp;&amp; ydiff2 &gt;= 0.0f) ) {
<a name="l02595"></a>02595                         bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2][1]= bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1];
<a name="l02596"></a>02596                     }
<a name="l02597"></a>02597                     <span class="keywordflow">else</span> { <span class="comment">/* andles should not be beyond y coord of two others */</span>
<a name="l02598"></a>02598                         <span class="keywordflow">if</span> (ydiff1 &lt;= 0.0f) {
<a name="l02599"></a>02599                             <span class="keywordflow">if</span> (next-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1] &lt; bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2][1]) {
<a name="l02600"></a>02600                                 bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2][1]= next-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1]; 
<a name="l02601"></a>02601                                 rightviolate= 1;
<a name="l02602"></a>02602                             }
<a name="l02603"></a>02603                         }
<a name="l02604"></a>02604                         <span class="keywordflow">else</span> {
<a name="l02605"></a>02605                             <span class="keywordflow">if</span> (next-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1] &gt; bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2][1]) {
<a name="l02606"></a>02606                                 bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2][1]= next-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1][1]; 
<a name="l02607"></a>02607                                 rightviolate= 1;
<a name="l02608"></a>02608                             }
<a name="l02609"></a>02609                         }
<a name="l02610"></a>02610                     }
<a name="l02611"></a>02611                 }
<a name="l02612"></a>02612             }
<a name="l02613"></a>02613             <span class="keywordflow">if</span> (leftviolate || rightviolate) { <span class="comment">/* align left handle */</span>
<a name="l02614"></a>02614                 <span class="keywordtype">float</span> h1[3], h2[3];
<a name="l02615"></a>02615                 <span class="keywordtype">float</span> <a class="code" href="../../d1/d22/stdosl_8h.html#aedba6e917e11b0571459516317985220">dot</a>;
<a name="l02616"></a>02616                 
<a name="l02617"></a>02617                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(h1, p2-3, p2);
<a name="l02618"></a>02618                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(h2, p2, p2+3);
<a name="l02619"></a>02619 
<a name="l02620"></a>02620                 len_a= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(h1);
<a name="l02621"></a>02621                 len_b= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(h2);
<a name="l02622"></a>02622 
<a name="l02623"></a>02623                 dot= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a76629ccfe891bccda30f790ed501e959">dot_v3v3</a>(h1, h2);
<a name="l02624"></a>02624 
<a name="l02625"></a>02625                 <span class="keywordflow">if</span> (leftviolate) {
<a name="l02626"></a>02626                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(h1, dot * len_b);
<a name="l02627"></a>02627                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(p2+3, p2, h1);
<a name="l02628"></a>02628                 }
<a name="l02629"></a>02629                 <span class="keywordflow">else</span> {
<a name="l02630"></a>02630                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(h2, dot * len_a);
<a name="l02631"></a>02631                     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(p2-3, p2, h2);
<a name="l02632"></a>02632                 }
<a name="l02633"></a>02633             }
<a name="l02634"></a>02634             
<a name="l02635"></a>02635         }
<a name="l02636"></a>02636     }
<a name="l02637"></a>02637 
<a name="l02638"></a>02638     <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>) {    <span class="comment">/* vector */</span>
<a name="l02639"></a>02639         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ac993b3c38bb2d5e7de48e57aab03db7f">madd_v3_v3v3fl</a>(p2-3, p2, dvec_a, -1.0f/3.0f);
<a name="l02640"></a>02640     }
<a name="l02641"></a>02641     <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>) {
<a name="l02642"></a>02642         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ac993b3c38bb2d5e7de48e57aab03db7f">madd_v3_v3v3fl</a>(p2+3, p2, dvec_b,  1.0f/3.0f);
<a name="l02643"></a>02643     }
<a name="l02644"></a>02644 
<a name="l02645"></a>02645     <span class="keywordflow">if</span> (skip_align) {
<a name="l02646"></a>02646         <span class="comment">/* handles need to be updated during animation and applying stuff like hooks,</span>
<a name="l02647"></a>02647 <span class="comment">         * but in such situatios it&#39;s quite difficult to distinguish in which order</span>
<a name="l02648"></a>02648 <span class="comment">         * align handles should be aligned so skip them for now */</span>
<a name="l02649"></a>02649         <span class="keywordflow">return</span>;
<a name="l02650"></a>02650     }
<a name="l02651"></a>02651 
<a name="l02652"></a>02652     len_b= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a97ecadbef10e5cc3decc2c02c3b96824">len_v3v3</a>(p2, p2+3);
<a name="l02653"></a>02653     len_a= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a97ecadbef10e5cc3decc2c02c3b96824">len_v3v3</a>(p2, p2-3);
<a name="l02654"></a>02654     <span class="keywordflow">if</span> (len_a==0.0f) len_a= 1.0f;
<a name="l02655"></a>02655     <span class="keywordflow">if</span> (len_b==0.0f) len_b= 1.0f;
<a name="l02656"></a>02656 
<a name="l02657"></a>02657     <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) { <span class="comment">/* order of calculation */</span>
<a name="l02658"></a>02658         <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45ecacf967643ac26269318a51fe281992051">HD_ALIGN</a>) { <span class="comment">/* aligned */</span>
<a name="l02659"></a>02659             <span class="keywordflow">if</span> (len_a&gt;eps) {
<a name="l02660"></a>02660                 len= len_b/len_a;
<a name="l02661"></a>02661                 p2[3]= p2[0]+len*(p2[0] - p2[-3]);
<a name="l02662"></a>02662                 p2[4]= p2[1]+len*(p2[1] - p2[-2]);
<a name="l02663"></a>02663                 p2[5]= p2[2]+len*(p2[2] - p2[-1]);
<a name="l02664"></a>02664             }
<a name="l02665"></a>02665         }
<a name="l02666"></a>02666         <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45ecacf967643ac26269318a51fe281992051">HD_ALIGN</a>) {
<a name="l02667"></a>02667             <span class="keywordflow">if</span> (len_b&gt;eps) {
<a name="l02668"></a>02668                 len= len_a/len_b;
<a name="l02669"></a>02669                 p2[-3]= p2[0]+len*(p2[0] - p2[3]);
<a name="l02670"></a>02670                 p2[-2]= p2[1]+len*(p2[1] - p2[4]);
<a name="l02671"></a>02671                 p2[-1]= p2[2]+len*(p2[2] - p2[5]);
<a name="l02672"></a>02672             }
<a name="l02673"></a>02673         }
<a name="l02674"></a>02674     }
<a name="l02675"></a>02675     <span class="keywordflow">else</span> {
<a name="l02676"></a>02676         <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45ecacf967643ac26269318a51fe281992051">HD_ALIGN</a>) {
<a name="l02677"></a>02677             <span class="keywordflow">if</span> (len_b&gt;eps) {
<a name="l02678"></a>02678                 len= len_a/len_b;
<a name="l02679"></a>02679                 p2[-3]= p2[0]+len*(p2[0] - p2[3]);
<a name="l02680"></a>02680                 p2[-2]= p2[1]+len*(p2[1] - p2[4]);
<a name="l02681"></a>02681                 p2[-1]= p2[2]+len*(p2[2] - p2[5]);
<a name="l02682"></a>02682             }
<a name="l02683"></a>02683         }
<a name="l02684"></a>02684         <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45ecacf967643ac26269318a51fe281992051">HD_ALIGN</a>) {   <span class="comment">/* aligned */</span>
<a name="l02685"></a>02685             <span class="keywordflow">if</span> (len_a&gt;eps) {
<a name="l02686"></a>02686                 len= len_b/len_a;
<a name="l02687"></a>02687                 p2[3]= p2[0]+len*(p2[0] - p2[-3]);
<a name="l02688"></a>02688                 p2[4]= p2[1]+len*(p2[1] - p2[-2]);
<a name="l02689"></a>02689                 p2[5]= p2[2]+len*(p2[2] - p2[-1]);
<a name="l02690"></a>02690             }
<a name="l02691"></a>02691         }
<a name="l02692"></a>02692     }
<a name="l02693"></a>02693 }
<a name="l02694"></a>02694 
<a name="l02695"></a><a class="code" href="../../dc/d22/curve_8c.html#aa9e714489839c354abcbf83e3c4171fb">02695</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#aa9e714489839c354abcbf83e3c4171fb">calchandlesNurb_intern</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, <span class="keywordtype">int</span> skip_align)
<a name="l02696"></a>02696 {
<a name="l02697"></a>02697     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt, *prev, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l02698"></a>02698     <span class="keywordtype">short</span> a;
<a name="l02699"></a>02699 
<a name="l02700"></a>02700     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> != <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) <span class="keywordflow">return</span>;
<a name="l02701"></a>02701     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>&lt;2) <span class="keywordflow">return</span>;
<a name="l02702"></a>02702     
<a name="l02703"></a>02703     a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l02704"></a>02704     bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l02705"></a>02705     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) prev= bezt+(a-1);
<a name="l02706"></a>02706     <span class="keywordflow">else</span> prev= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02707"></a>02707     next= bezt+1;
<a name="l02708"></a>02708 
<a name="l02709"></a>02709     <span class="keywordflow">while</span> (a--) {
<a name="l02710"></a>02710         <a class="code" href="../../dc/d22/curve_8c.html#a1285739af9084c34357e413d9dbbde89">calchandleNurb_intern</a>(bezt, prev, next, 0, skip_align);
<a name="l02711"></a>02711         prev= bezt;
<a name="l02712"></a>02712         <span class="keywordflow">if</span> (a==1) {
<a name="l02713"></a>02713             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>) next= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l02714"></a>02714             <span class="keywordflow">else</span> next= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02715"></a>02715         }
<a name="l02716"></a>02716         <span class="keywordflow">else</span> next++;
<a name="l02717"></a>02717 
<a name="l02718"></a>02718         bezt++;
<a name="l02719"></a>02719     }
<a name="l02720"></a>02720 }
<a name="l02721"></a>02721 
<a name="l02722"></a><a class="code" href="../../dc/d22/curve_8c.html#aaa7b7e8cf6d31c378d2f081c33d464ee">02722</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a1b74ac08e2d1a385a6dd7c1e26e25a5c">calchandleNurb</a>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *prev, <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>, <span class="keywordtype">int</span> mode)
<a name="l02723"></a>02723 {
<a name="l02724"></a>02724     <a class="code" href="../../dc/d22/curve_8c.html#a1285739af9084c34357e413d9dbbde89">calchandleNurb_intern</a>(bezt, prev, next, mode, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l02725"></a>02725 }
<a name="l02726"></a>02726 
<a name="l02727"></a><a class="code" href="../../dc/d22/curve_8c.html#a0ec9d7c6338989567570cf685c70e297">02727</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu) <span class="comment">/* first, if needed, set handle flags */</span>
<a name="l02728"></a>02728 {
<a name="l02729"></a>02729     <a class="code" href="../../dc/d22/curve_8c.html#aa9e714489839c354abcbf83e3c4171fb">calchandlesNurb_intern</a>(nu, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l02730"></a>02730 }
<a name="l02731"></a>02731 
<a name="l02732"></a>02732 
<a name="l02733"></a><a class="code" href="../../dc/d22/curve_8c.html#a8c9082c97e0eb795e6ad04b3e8899d4f">02733</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a1a5b59f31661982e8eb8107859f0fe45">testhandlesNurb</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l02734"></a>02734 {
<a name="l02735"></a>02735     <span class="comment">/* use when something has changed with handles.</span>
<a name="l02736"></a>02736 <span class="comment">     * it treats all BezTriples with the following rules:</span>
<a name="l02737"></a>02737 <span class="comment">     * PHASE 1: do types have to be altered?</span>
<a name="l02738"></a>02738 <span class="comment">     *    Auto handles: become aligned when selection status is NOT(000 || 111)</span>
<a name="l02739"></a>02739 <span class="comment">     *    Vector handles: become &#39;nothing&#39; when (one half selected AND other not)</span>
<a name="l02740"></a>02740 <span class="comment">     * PHASE 2: recalculate handles</span>
<a name="l02741"></a>02741 <span class="comment">     */</span>
<a name="l02742"></a>02742     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l02743"></a>02743     <span class="keywordtype">short</span> flag, a;
<a name="l02744"></a>02744 
<a name="l02745"></a>02745     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> != <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) <span class="keywordflow">return</span>;
<a name="l02746"></a>02746 
<a name="l02747"></a>02747     bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l02748"></a>02748     a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l02749"></a>02749     <span class="keywordflow">while</span> (a--) {
<a name="l02750"></a>02750         flag= 0;
<a name="l02751"></a>02751         <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) flag++;
<a name="l02752"></a>02752         <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a6589749668d64ba3a1182a17bb0e5d89">f2</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) flag += 2;
<a name="l02753"></a>02753         <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) flag += 4;
<a name="l02754"></a>02754         
<a name="l02755"></a>02755         <span class="keywordflow">if</span> ( !(flag==0 || flag==7) ) {
<a name="l02756"></a>02756             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca015592fc9e4aa078609a35b5bc00e698">HD_AUTO_ANIM</a>)) {   <span class="comment">/* auto */</span>
<a name="l02757"></a>02757                 bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45ecacf967643ac26269318a51fe281992051">HD_ALIGN</a>;
<a name="l02758"></a>02758             }
<a name="l02759"></a>02759             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca015592fc9e4aa078609a35b5bc00e698">HD_AUTO_ANIM</a>)) {   <span class="comment">/* auto */</span>
<a name="l02760"></a>02760                 bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45ecacf967643ac26269318a51fe281992051">HD_ALIGN</a>;
<a name="l02761"></a>02761             }
<a name="l02762"></a>02762             
<a name="l02763"></a>02763             <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>) {   <span class="comment">/* vector */</span>
<a name="l02764"></a>02764                 <span class="keywordflow">if</span> (flag &lt; 4) bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>= 0;
<a name="l02765"></a>02765             }
<a name="l02766"></a>02766             <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>) {   <span class="comment">/* vector */</span>
<a name="l02767"></a>02767                 <span class="keywordflow">if</span> ( flag &gt; 3) bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>= 0;
<a name="l02768"></a>02768             }
<a name="l02769"></a>02769         }
<a name="l02770"></a>02770         bezt++;
<a name="l02771"></a>02771     }
<a name="l02772"></a>02772     
<a name="l02773"></a>02773     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(nu);
<a name="l02774"></a>02774 }
<a name="l02775"></a>02775 
<a name="l02776"></a><a class="code" href="../../dc/d22/curve_8c.html#a4c9b75c72997b23023522d87d0209fad">02776</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#ab1e2652c157f2c8d1a361c16a410c609">autocalchandlesNurb</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu, <span class="keywordtype">int</span> flag)
<a name="l02777"></a>02777 {
<a name="l02778"></a>02778     <span class="comment">/* checks handle coordinates and calculates type */</span>
<a name="l02779"></a>02779     
<a name="l02780"></a>02780     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt2, *bezt1, *bezt0;
<a name="l02781"></a>02781     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, align, leftsmall, rightsmall;
<a name="l02782"></a>02782 
<a name="l02783"></a>02783     <span class="keywordflow">if</span> (nu==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l02784"></a>02784     
<a name="l02785"></a>02785     bezt2 = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l02786"></a>02786     bezt1 = bezt2 + (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>-1);
<a name="l02787"></a>02787     bezt0 = bezt1 - 1;
<a name="l02788"></a>02788     i = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l02789"></a>02789 
<a name="l02790"></a>02790     <span class="keywordflow">while</span> (i--) {
<a name="l02791"></a>02791         
<a name="l02792"></a>02792         align= leftsmall= rightsmall= 0;
<a name="l02793"></a>02793         
<a name="l02794"></a>02794         <span class="comment">/* left handle: */</span>
<a name="l02795"></a>02795         <span class="keywordflow">if</span> (flag==0 || (bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> &amp; flag) ) {
<a name="l02796"></a>02796             bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>= 0;
<a name="l02797"></a>02797             <span class="comment">/* distance too short: vectorhandle */</span>
<a name="l02798"></a>02798             <span class="keywordflow">if</span> ( <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a97ecadbef10e5cc3decc2c02c3b96824">len_v3v3</a>( bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1], bezt0-&gt;vec[1] ) &lt; 0.0001f) {
<a name="l02799"></a>02799                 bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>;
<a name="l02800"></a>02800                 leftsmall= 1;
<a name="l02801"></a>02801             }
<a name="l02802"></a>02802             <span class="keywordflow">else</span> {
<a name="l02803"></a>02803                 <span class="comment">/* aligned handle? */</span>
<a name="l02804"></a>02804                 <span class="keywordflow">if</span> (<a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#aee9e9d32be8def7288500f2eda1512c5">dist_to_line_v2</a>(bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1], bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0], bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2]) &lt; 0.0001f) {
<a name="l02805"></a>02805                     align= 1;
<a name="l02806"></a>02806                     bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45ecacf967643ac26269318a51fe281992051">HD_ALIGN</a>;
<a name="l02807"></a>02807                 }
<a name="l02808"></a>02808                 <span class="comment">/* or vector handle? */</span>
<a name="l02809"></a>02809                 <span class="keywordflow">if</span> (<a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#aee9e9d32be8def7288500f2eda1512c5">dist_to_line_v2</a>(bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0], bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1], bezt0-&gt;vec[1]) &lt; 0.0001f)
<a name="l02810"></a>02810                     bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>;
<a name="l02811"></a>02811                 
<a name="l02812"></a>02812             }
<a name="l02813"></a>02813         }
<a name="l02814"></a>02814         <span class="comment">/* right handle: */</span>
<a name="l02815"></a>02815         <span class="keywordflow">if</span> (flag==0 || (bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> &amp; flag) ) {
<a name="l02816"></a>02816             bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>= 0;
<a name="l02817"></a>02817             <span class="comment">/* distance too short: vectorhandle */</span>
<a name="l02818"></a>02818             <span class="keywordflow">if</span> ( <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a97ecadbef10e5cc3decc2c02c3b96824">len_v3v3</a>( bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1], bezt2-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1] ) &lt; 0.0001f) {
<a name="l02819"></a>02819                 bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>;
<a name="l02820"></a>02820                 rightsmall= 1;
<a name="l02821"></a>02821             }
<a name="l02822"></a>02822             <span class="keywordflow">else</span> {
<a name="l02823"></a>02823                 <span class="comment">/* aligned handle? */</span>
<a name="l02824"></a>02824                 <span class="keywordflow">if</span> (align) bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45ecacf967643ac26269318a51fe281992051">HD_ALIGN</a>;
<a name="l02825"></a>02825 
<a name="l02826"></a>02826                 <span class="comment">/* or vector handle? */</span>
<a name="l02827"></a>02827                 <span class="keywordflow">if</span> (<a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#aee9e9d32be8def7288500f2eda1512c5">dist_to_line_v2</a>(bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2], bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1], bezt2-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1]) &lt; 0.0001f)
<a name="l02828"></a>02828                     bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>;
<a name="l02829"></a>02829                 
<a name="l02830"></a>02830             }
<a name="l02831"></a>02831         }
<a name="l02832"></a>02832         <span class="keywordflow">if</span> (leftsmall &amp;&amp; bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45ecacf967643ac26269318a51fe281992051">HD_ALIGN</a>) bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>= 0;
<a name="l02833"></a>02833         <span class="keywordflow">if</span> (rightsmall &amp;&amp; bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45ecacf967643ac26269318a51fe281992051">HD_ALIGN</a>) bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>= 0;
<a name="l02834"></a>02834         
<a name="l02835"></a>02835         <span class="comment">/* undesired combination: */</span>
<a name="l02836"></a>02836         <span class="keywordflow">if</span> (bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45ecacf967643ac26269318a51fe281992051">HD_ALIGN</a> &amp;&amp; bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>) bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>= 0;
<a name="l02837"></a>02837         <span class="keywordflow">if</span> (bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45ecacf967643ac26269318a51fe281992051">HD_ALIGN</a> &amp;&amp; bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>==<a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca1e9cb5ecc39a3c74be445d1c4d151d04">HD_VECT</a>) bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>= 0;
<a name="l02838"></a>02838         
<a name="l02839"></a>02839         bezt0= bezt1;
<a name="l02840"></a>02840         bezt1= bezt2;
<a name="l02841"></a>02841         bezt2++;
<a name="l02842"></a>02842     }
<a name="l02843"></a>02843 
<a name="l02844"></a>02844     <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(nu);
<a name="l02845"></a>02845 }
<a name="l02846"></a>02846 
<a name="l02847"></a><a class="code" href="../../dc/d22/curve_8c.html#aa9fcf354ae8bfe18261ce27b967c1267">02847</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aa9fcf354ae8bfe18261ce27b967c1267">autocalchandlesNurb_all</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb, <span class="keywordtype">int</span> flag)
<a name="l02848"></a>02848 {
<a name="l02849"></a>02849     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l02850"></a>02850     
<a name="l02851"></a>02851     nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02852"></a>02852     <span class="keywordflow">while</span> (nu) {
<a name="l02853"></a>02853         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#ab1e2652c157f2c8d1a361c16a410c609">autocalchandlesNurb</a>(nu, flag);
<a name="l02854"></a>02854         nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l02855"></a>02855     }
<a name="l02856"></a>02856 }
<a name="l02857"></a>02857 
<a name="l02858"></a><a class="code" href="../../dc/d22/curve_8c.html#a8efb4331f56b299e9ef090b6e0957933">02858</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a8efb4331f56b299e9ef090b6e0957933">sethandlesNurb</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *editnurb, <span class="keywordtype">short</span> code)
<a name="l02859"></a>02859 {
<a name="l02860"></a>02860     <span class="comment">/* code==1: set autohandle */</span>
<a name="l02861"></a>02861     <span class="comment">/* code==2: set vectorhandle */</span>
<a name="l02862"></a>02862     <span class="comment">/* code==3 (HD_ALIGN) it toggle, vectorhandles become HD_FREE */</span>
<a name="l02863"></a>02863     <span class="comment">/* code==4: sets icu flag to become IPO_AUTO_HORIZ, horizontal extremes on auto-handles */</span>
<a name="l02864"></a>02864     <span class="comment">/* code==5: Set align, like 3 but no toggle */</span>
<a name="l02865"></a>02865     <span class="comment">/* code==6: Clear align, like 3 but no toggle */</span>
<a name="l02866"></a>02866     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l02867"></a>02867     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l02868"></a>02868     <span class="keywordtype">short</span> a, ok=0;
<a name="l02869"></a>02869 
<a name="l02870"></a>02870     <span class="keywordflow">if</span> (code==1 || code==2) {
<a name="l02871"></a>02871         nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02872"></a>02872         <span class="keywordflow">while</span> (nu) {
<a name="l02873"></a>02873             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l02874"></a>02874                 bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l02875"></a>02875                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l02876"></a>02876                 <span class="keywordflow">while</span> (a--) {
<a name="l02877"></a>02877                     <span class="keywordflow">if</span> ((bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) || (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)) {
<a name="l02878"></a>02878                         <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>= code;
<a name="l02879"></a>02879                         <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>= code;
<a name="l02880"></a>02880                         <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>!=bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>) {
<a name="l02881"></a>02881                             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45ecacf967643ac26269318a51fe281992051">HD_ALIGN</a>, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>)) bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a> = <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca36fb837b87ff289ecff74a12cc6161ad">HD_FREE</a>;
<a name="l02882"></a>02882                             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45ecacf967643ac26269318a51fe281992051">HD_ALIGN</a>, <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca4030ebec929ea300ba646458062c761b">HD_AUTO</a>)) bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a> = <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca36fb837b87ff289ecff74a12cc6161ad">HD_FREE</a>;
<a name="l02883"></a>02883                         }
<a name="l02884"></a>02884                     }
<a name="l02885"></a>02885                     bezt++;
<a name="l02886"></a>02886                 }
<a name="l02887"></a>02887                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(nu);
<a name="l02888"></a>02888             }
<a name="l02889"></a>02889             nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l02890"></a>02890         }
<a name="l02891"></a>02891     }
<a name="l02892"></a>02892     <span class="keywordflow">else</span> {
<a name="l02893"></a>02893         <span class="comment">/* there is 1 handle not FREE: FREE it all, else make ALIGNED  */</span>
<a name="l02894"></a>02894         
<a name="l02895"></a>02895         nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02896"></a>02896         <span class="keywordflow">if</span> (code == 5) {
<a name="l02897"></a>02897             ok = <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45ecacf967643ac26269318a51fe281992051">HD_ALIGN</a>;
<a name="l02898"></a>02898         }
<a name="l02899"></a>02899         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (code == 6) {
<a name="l02900"></a>02900             ok = <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca36fb837b87ff289ecff74a12cc6161ad">HD_FREE</a>;
<a name="l02901"></a>02901         }
<a name="l02902"></a>02902         <span class="keywordflow">else</span> {
<a name="l02903"></a>02903             <span class="comment">/* Toggle */</span>
<a name="l02904"></a>02904             <span class="keywordflow">while</span> (nu) {
<a name="l02905"></a>02905                 <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l02906"></a>02906                     bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l02907"></a>02907                     a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l02908"></a>02908                     <span class="keywordflow">while</span> (a--) {
<a name="l02909"></a>02909                         <span class="keywordflow">if</span> ((bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) &amp;&amp; bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>) ok= 1;
<a name="l02910"></a>02910                         <span class="keywordflow">if</span> ((bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) &amp;&amp; bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>) ok= 1;
<a name="l02911"></a>02911                         <span class="keywordflow">if</span> (ok) <span class="keywordflow">break</span>;
<a name="l02912"></a>02912                         bezt++;
<a name="l02913"></a>02913                     }
<a name="l02914"></a>02914                 }
<a name="l02915"></a>02915                 nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l02916"></a>02916             }
<a name="l02917"></a>02917             <span class="keywordflow">if</span> (ok) ok= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45eca36fb837b87ff289ecff74a12cc6161ad">HD_FREE</a>;
<a name="l02918"></a>02918             <span class="keywordflow">else</span> ok= <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#aae1919333e2c55cb17830a26b0ce45ecacf967643ac26269318a51fe281992051">HD_ALIGN</a>;
<a name="l02919"></a>02919         }
<a name="l02920"></a>02920         nu= editnurb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02921"></a>02921         <span class="keywordflow">while</span> (nu) {
<a name="l02922"></a>02922             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l02923"></a>02923                 bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l02924"></a>02924                 a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l02925"></a>02925                 <span class="keywordflow">while</span> (a--) {
<a name="l02926"></a>02926                     <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>= ok;
<a name="l02927"></a>02927                     <span class="keywordflow">if</span> (bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>= ok;
<a name="l02928"></a>02928     
<a name="l02929"></a>02929                     bezt++;
<a name="l02930"></a>02930                 }
<a name="l02931"></a>02931                 <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a91c4495902ea4a31812134660b0c8d42">calchandlesNurb</a>(nu);
<a name="l02932"></a>02932             }
<a name="l02933"></a>02933             nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>;
<a name="l02934"></a>02934         }
<a name="l02935"></a>02935     }
<a name="l02936"></a>02936 }
<a name="l02937"></a>02937 
<a name="l02938"></a><a class="code" href="../../dc/d22/curve_8c.html#a7d0aa5995c0f91cc031fcecc29811675">02938</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d22/curve_8c.html#a7d0aa5995c0f91cc031fcecc29811675">swapdata</a>(<span class="keywordtype">void</span> *adr1, <span class="keywordtype">void</span> *adr2, <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>)
<a name="l02939"></a>02939 {
<a name="l02940"></a>02940 
<a name="l02941"></a>02941     <span class="keywordflow">if</span> (len&lt;=0) <span class="keywordflow">return</span>;
<a name="l02942"></a>02942 
<a name="l02943"></a>02943     <span class="keywordflow">if</span> (len&lt;65) {
<a name="l02944"></a>02944         <span class="keywordtype">char</span> adr[64];
<a name="l02945"></a>02945 
<a name="l02946"></a>02946         memcpy(adr, adr1, len);
<a name="l02947"></a>02947         memcpy(adr1, adr2, len);
<a name="l02948"></a>02948         memcpy(adr2, adr, len);
<a name="l02949"></a>02949     }
<a name="l02950"></a>02950     <span class="keywordflow">else</span> {
<a name="l02951"></a>02951         <span class="keywordtype">char</span> *adr;
<a name="l02952"></a>02952 
<a name="l02953"></a>02953         adr= (<span class="keywordtype">char</span> *)<a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(len, <span class="stringliteral">&quot;curve swap&quot;</span>);
<a name="l02954"></a>02954         memcpy(adr, adr1, len);
<a name="l02955"></a>02955         memcpy(adr1, adr2, len);
<a name="l02956"></a>02956         memcpy(adr2, adr, len);
<a name="l02957"></a>02957         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(adr);
<a name="l02958"></a>02958     }
<a name="l02959"></a>02959 }
<a name="l02960"></a>02960 
<a name="l02961"></a><a class="code" href="../../dc/d22/curve_8c.html#a2072bdbf996a797b85decebf54428558">02961</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a93948a41f393b373ddd267796c058b81">switchdirectionNurb</a>(<a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l02962"></a>02962 {
<a name="l02963"></a>02963     <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt1, *bezt2;
<a name="l02964"></a>02964     <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp1, *bp2;
<a name="l02965"></a>02965     <span class="keywordtype">float</span> *fp1, *fp2, *tempf;
<a name="l02966"></a>02966     <span class="keywordtype">int</span> a, b;
<a name="l02967"></a>02967 
<a name="l02968"></a>02968     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>==1 &amp;&amp; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>==1) <span class="keywordflow">return</span>;
<a name="l02969"></a>02969 
<a name="l02970"></a>02970     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l02971"></a>02971         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l02972"></a>02972         bezt1= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l02973"></a>02973         bezt2= bezt1+(a-1);
<a name="l02974"></a>02974         <span class="keywordflow">if</span> (a &amp; 1) a+= 1;   <span class="comment">/* if odd, also swap middle content */</span>
<a name="l02975"></a>02975         a/= 2;
<a name="l02976"></a>02976         <span class="keywordflow">while</span> (a&gt;0) {
<a name="l02977"></a>02977             <span class="keywordflow">if</span> (bezt1!=bezt2) <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a>, *bezt1, *bezt2);
<a name="l02978"></a>02978 
<a name="l02979"></a>02979             <a class="code" href="../../dc/d22/curve_8c.html#a7d0aa5995c0f91cc031fcecc29811675">swapdata</a>(bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0], bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2], 12);
<a name="l02980"></a>02980             <span class="keywordflow">if</span> (bezt1!=bezt2) <a class="code" href="../../dc/d22/curve_8c.html#a7d0aa5995c0f91cc031fcecc29811675">swapdata</a>(bezt2-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0], bezt2-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2], 12);
<a name="l02981"></a>02981 
<a name="l02982"></a>02982             <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<span class="keywordtype">char</span>, bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>, bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>);
<a name="l02983"></a>02983             <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<span class="keywordtype">short</span>, bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a>, bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a>);
<a name="l02984"></a>02984             
<a name="l02985"></a>02985             <span class="keywordflow">if</span> (bezt1!=bezt2) {
<a name="l02986"></a>02986                 <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<span class="keywordtype">char</span>, bezt2-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#af6f1298c6043038ba343b76054feb920">h1</a>, bezt2-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad4c02b7166fdff040ebb931ed1d4bfc0">h2</a>);
<a name="l02987"></a>02987                 <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<span class="keywordtype">short</span>, bezt2-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#ad1188a435612de53bc858987af3c7acd">f1</a>, bezt2-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a426bd73dcd72de3539ed00b02646bac1">f3</a>);
<a name="l02988"></a>02988                 bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a>= -bezt1-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a>;
<a name="l02989"></a>02989                 bezt2-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a>= -bezt2-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a>;
<a name="l02990"></a>02990             }
<a name="l02991"></a>02991             a--;
<a name="l02992"></a>02992             bezt1++; 
<a name="l02993"></a>02993             bezt2--;
<a name="l02994"></a>02994         }
<a name="l02995"></a>02995     }
<a name="l02996"></a>02996     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>==1) {
<a name="l02997"></a>02997         a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l02998"></a>02998         bp1= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l02999"></a>02999         bp2= bp1+(a-1);
<a name="l03000"></a>03000         a/= 2;
<a name="l03001"></a>03001         <span class="keywordflow">while</span> (bp1!=bp2 &amp;&amp; a&gt;0) {
<a name="l03002"></a>03002             <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>, *bp1, *bp2);
<a name="l03003"></a>03003             a--;
<a name="l03004"></a>03004             bp1-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a1210ec737d6ced5cf276e22e8ca277f8">alfa</a>= -bp1-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a1210ec737d6ced5cf276e22e8ca277f8">alfa</a>;
<a name="l03005"></a>03005             bp2-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a1210ec737d6ced5cf276e22e8ca277f8">alfa</a>= -bp2-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a1210ec737d6ced5cf276e22e8ca277f8">alfa</a>;
<a name="l03006"></a>03006             bp1++; 
<a name="l03007"></a>03007             bp2--;
<a name="l03008"></a>03008         }
<a name="l03009"></a>03009         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>) {
<a name="l03010"></a>03010             <span class="comment">/* no knots for too short paths */</span>
<a name="l03011"></a>03011             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>) {
<a name="l03012"></a>03012                 <span class="comment">/* inverse knots */</span>
<a name="l03013"></a>03013                 a= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a229d5ec44247fb38940870726ade9077">KNOTSU</a>(nu);
<a name="l03014"></a>03014                 fp1= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>;
<a name="l03015"></a>03015                 fp2= fp1+(a-1);
<a name="l03016"></a>03016                 a/= 2;
<a name="l03017"></a>03017                 <span class="keywordflow">while</span> (fp1!=fp2 &amp;&amp; a&gt;0) {
<a name="l03018"></a>03018                     <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<span class="keywordtype">float</span>, *fp1, *fp2);
<a name="l03019"></a>03019                     a--;
<a name="l03020"></a>03020                     fp1++; 
<a name="l03021"></a>03021                     fp2--;
<a name="l03022"></a>03022                 }
<a name="l03023"></a>03023                 <span class="comment">/* and make in increasing order again */</span>
<a name="l03024"></a>03024                 a= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a229d5ec44247fb38940870726ade9077">KNOTSU</a>(nu);
<a name="l03025"></a>03025                 fp1= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>;
<a name="l03026"></a>03026                 fp2=tempf= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*a, <span class="stringliteral">&quot;switchdirect&quot;</span>);
<a name="l03027"></a>03027                 <span class="keywordflow">while</span> (a--) {
<a name="l03028"></a>03028                     fp2[0]= <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(fp1[1]-fp1[0]);
<a name="l03029"></a>03029                     fp1++;
<a name="l03030"></a>03030                     fp2++;
<a name="l03031"></a>03031                 }
<a name="l03032"></a>03032         
<a name="l03033"></a>03033                 a= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a229d5ec44247fb38940870726ade9077">KNOTSU</a>(nu)-1;
<a name="l03034"></a>03034                 fp1= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a35b4a7a3cd387bfb655fc5776ac71e14">knotsu</a>;
<a name="l03035"></a>03035                 fp2= tempf;
<a name="l03036"></a>03036                 fp1[0]= 0.0;
<a name="l03037"></a>03037                 fp1++;
<a name="l03038"></a>03038                 <span class="keywordflow">while</span> (a--) {
<a name="l03039"></a>03039                     fp1[0]= fp1[-1]+fp2[0];
<a name="l03040"></a>03040                     fp1++;
<a name="l03041"></a>03041                     fp2++;
<a name="l03042"></a>03042                 }
<a name="l03043"></a>03043                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(tempf);
<a name="l03044"></a>03044             }
<a name="l03045"></a>03045         }
<a name="l03046"></a>03046     }
<a name="l03047"></a>03047     <span class="keywordflow">else</span> {
<a name="l03048"></a>03048         
<a name="l03049"></a>03049         <span class="keywordflow">for</span> (b=0; b&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; b++) {
<a name="l03050"></a>03050         
<a name="l03051"></a>03051             bp1= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>+b*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l03052"></a>03052             a= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l03053"></a>03053             bp2= bp1+(a-1);
<a name="l03054"></a>03054             a/= 2;
<a name="l03055"></a>03055             
<a name="l03056"></a>03056             <span class="keywordflow">while</span> (bp1!=bp2 &amp;&amp; a&gt;0) {
<a name="l03057"></a>03057                 <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a5fe0952e66cbb7dbad512a6fcc91b1b3">SWAP</a>(<a class="code" href="../../d9/d51/structBPoint.html">BPoint</a>, *bp1, *bp2);
<a name="l03058"></a>03058                 a--;
<a name="l03059"></a>03059                 bp1++; 
<a name="l03060"></a>03060                 bp2--;
<a name="l03061"></a>03061             }
<a name="l03062"></a>03062         }
<a name="l03063"></a>03063     }
<a name="l03064"></a>03064 }
<a name="l03065"></a>03065 
<a name="l03066"></a>03066 
<a name="l03067"></a><a class="code" href="../../dc/d22/curve_8c.html#a18ec03f8ec673fc971f42038f52fc0b1">03067</a> float (*<a class="code" href="../../d7/dfc/BKE__curve_8h.html#ad41f5f89f18919c891c4a400dd9db8e7">curve_getVertexCos</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(cu), <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb, <span class="keywordtype">int</span> *numVerts_r))[3]
<a name="l03068"></a>03068 {
<a name="l03069"></a>03069     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, numVerts = *numVerts_r = <a class="code" href="../../d7/dfc/BKE__curve_8h.html#acbc43d8687324817662e3f0e713b514a">count_curveverts</a>(lb);
<a name="l03070"></a>03070     <span class="keywordtype">float</span> *<a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>, (*cos)[3] = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(*cos)*numVerts, <span class="stringliteral">&quot;cu_vcos&quot;</span>);
<a name="l03071"></a>03071     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l03072"></a>03072 
<a name="l03073"></a>03073     co = cos[0];
<a name="l03074"></a>03074     <span class="keywordflow">for</span> (nu=lb-&gt;first; nu; nu=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l03075"></a>03075         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l03076"></a>03076             <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l03077"></a>03077 
<a name="l03078"></a>03078             <span class="keywordflow">for</span> (i=0; i&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; i++,bezt++) {
<a name="l03079"></a>03079                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(co, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0]); co+=3;
<a name="l03080"></a>03080                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(co, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1]); co+=3;
<a name="l03081"></a>03081                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(co, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2]); co+=3;
<a name="l03082"></a>03082             }
<a name="l03083"></a>03083         }
<a name="l03084"></a>03084         <span class="keywordflow">else</span> {
<a name="l03085"></a>03085             <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l03086"></a>03086 
<a name="l03087"></a>03087             <span class="keywordflow">for</span> (i=0; i&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; i++,bp++) {
<a name="l03088"></a>03088                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(co, bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>); co+=3;
<a name="l03089"></a>03089             }
<a name="l03090"></a>03090         }
<a name="l03091"></a>03091     }
<a name="l03092"></a>03092 
<a name="l03093"></a>03093     <span class="keywordflow">return</span> <a class="code" href="../../d7/d47/NM__Scalar_8h.html#a684cb050006be28e36ea9a9817af4a91">cos</a>;
<a name="l03094"></a>03094 }
<a name="l03095"></a>03095 
<a name="l03096"></a><a class="code" href="../../dc/d22/curve_8c.html#a34246ad50620b8d08b563e82fb16aac4">03096</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#ad8446be4fed1ae5d535667cc91d7ee23">curve_applyVertexCos</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(cu), <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb, <span class="keywordtype">float</span> (*vertexCos)[3])
<a name="l03097"></a>03097 {
<a name="l03098"></a>03098     <span class="keywordtype">float</span> *<a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a> = vertexCos[0];
<a name="l03099"></a>03099     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l03100"></a>03100     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03101"></a>03101 
<a name="l03102"></a>03102     <span class="keywordflow">for</span> (nu=lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l03103"></a>03103         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l03104"></a>03104             <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l03105"></a>03105 
<a name="l03106"></a>03106             <span class="keywordflow">for</span> (i=0; i&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; i++,bezt++) {
<a name="l03107"></a>03107                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0], co); co+=3;
<a name="l03108"></a>03108                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1], co); co+=3;
<a name="l03109"></a>03109                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2], co); co+=3;
<a name="l03110"></a>03110             }
<a name="l03111"></a>03111         }
<a name="l03112"></a>03112         <span class="keywordflow">else</span> {
<a name="l03113"></a>03113             <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l03114"></a>03114 
<a name="l03115"></a>03115             <span class="keywordflow">for</span> (i=0; i&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; i++,bp++) {
<a name="l03116"></a>03116                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, co); co+=3;
<a name="l03117"></a>03117             }
<a name="l03118"></a>03118         }
<a name="l03119"></a>03119 
<a name="l03120"></a>03120         <a class="code" href="../../dc/d22/curve_8c.html#aa9e714489839c354abcbf83e3c4171fb">calchandlesNurb_intern</a>(nu, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l03121"></a>03121     }
<a name="l03122"></a>03122 }
<a name="l03123"></a>03123 
<a name="l03124"></a><a class="code" href="../../dc/d22/curve_8c.html#aef4f026ab4912334c9a522d7e1a9f0d5">03124</a> float (*<a class="code" href="../../d7/dfc/BKE__curve_8h.html#aedbca6c70fa89aa14a954efbb1b08126">curve_getKeyVertexCos</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(cu), <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb, <span class="keywordtype">float</span> *key))[3]
<a name="l03125"></a>03125 {
<a name="l03126"></a>03126     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, numVerts = <a class="code" href="../../d7/dfc/BKE__curve_8h.html#acbc43d8687324817662e3f0e713b514a">count_curveverts</a>(lb);
<a name="l03127"></a>03127     <span class="keywordtype">float</span> *<a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>, (*cos)[3] = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(*cos)*numVerts, <span class="stringliteral">&quot;cu_vcos&quot;</span>);
<a name="l03128"></a>03128     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l03129"></a>03129 
<a name="l03130"></a>03130     co = cos[0];
<a name="l03131"></a>03131     <span class="keywordflow">for</span> (nu=lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l03132"></a>03132         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l03133"></a>03133             <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l03134"></a>03134 
<a name="l03135"></a>03135             <span class="keywordflow">for</span> (i=0; i&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; i++,bezt++) {
<a name="l03136"></a>03136                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(co, key); co+=3; key+=3;
<a name="l03137"></a>03137                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(co, key); co+=3; key+=3;
<a name="l03138"></a>03138                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(co, key); co+=3; key+=3;
<a name="l03139"></a>03139                 key+=3; <span class="comment">/* skip tilt */</span>
<a name="l03140"></a>03140             }
<a name="l03141"></a>03141         }
<a name="l03142"></a>03142         <span class="keywordflow">else</span> {
<a name="l03143"></a>03143             <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l03144"></a>03144 
<a name="l03145"></a>03145             <span class="keywordflow">for</span> (i=0; i&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; i++,bp++) {
<a name="l03146"></a>03146                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(co, key); co+=3; key+=3;
<a name="l03147"></a>03147                 key++; <span class="comment">/* skip tilt */</span>
<a name="l03148"></a>03148             }
<a name="l03149"></a>03149         }
<a name="l03150"></a>03150     }
<a name="l03151"></a>03151 
<a name="l03152"></a>03152     <span class="keywordflow">return</span> <a class="code" href="../../d7/d47/NM__Scalar_8h.html#a684cb050006be28e36ea9a9817af4a91">cos</a>;
<a name="l03153"></a>03153 }
<a name="l03154"></a>03154 
<a name="l03155"></a><a class="code" href="../../dc/d22/curve_8c.html#a7cb1958d84d9eb7307251341c704bfb6">03155</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a5671c5119e2e7bc2b207246d95c0fd62">curve_applyKeyVertexTilts</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(cu), <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb, <span class="keywordtype">float</span> *key)
<a name="l03156"></a>03156 {
<a name="l03157"></a>03157     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l03158"></a>03158     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03159"></a>03159 
<a name="l03160"></a>03160     <span class="keywordflow">for</span> (nu=lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu=nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l03161"></a>03161         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l03162"></a>03162             <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>;
<a name="l03163"></a>03163 
<a name="l03164"></a>03164             <span class="keywordflow">for</span> (i=0; i&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>; i++,bezt++) {
<a name="l03165"></a>03165                 key+=3*3;
<a name="l03166"></a>03166                 bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a57809f14651bb33bfe7e564ea864cde6">alfa</a>= *key;
<a name="l03167"></a>03167                 key+=3;
<a name="l03168"></a>03168             }
<a name="l03169"></a>03169         }
<a name="l03170"></a>03170         <span class="keywordflow">else</span> {
<a name="l03171"></a>03171             <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp = nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>;
<a name="l03172"></a>03172 
<a name="l03173"></a>03173             <span class="keywordflow">for</span> (i=0; i&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>; i++,bp++) {
<a name="l03174"></a>03174                 key+=3;
<a name="l03175"></a>03175                 bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a1210ec737d6ced5cf276e22e8ca277f8">alfa</a>= *key;
<a name="l03176"></a>03176                 key++;
<a name="l03177"></a>03177             }
<a name="l03178"></a>03178         }
<a name="l03179"></a>03179     }
<a name="l03180"></a>03180 }
<a name="l03181"></a>03181 
<a name="l03182"></a><a class="code" href="../../dc/d22/curve_8c.html#afcb8fc1bb7820c4260d027f5b7a011e3">03182</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#afcb8fc1bb7820c4260d027f5b7a011e3">check_valid_nurb_u</a>( <span class="keyword">struct</span> <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu )
<a name="l03183"></a>03183 {
<a name="l03184"></a>03184     <span class="keywordflow">if</span> (nu==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)                       <span class="keywordflow">return</span> 0;
<a name="l03185"></a>03185     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> &lt;= 1)                 <span class="keywordflow">return</span> 0;
<a name="l03186"></a>03186     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> != <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>)           <span class="keywordflow">return</span> 1; <span class="comment">/* not a nurb, lets assume its valid */</span>
<a name="l03187"></a>03187     
<a name="l03188"></a>03188     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> &lt; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>)         <span class="keywordflow">return</span> 0;
<a name="l03189"></a>03189     <span class="keywordflow">if</span> (((nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a3cf1c2dec47235e64740549f9bb2b5ff">flag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>)==0) &amp;&amp; (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a644364540eb9666e65a7039995b0fef8">CU_NURB_BEZIER</a>)) { <span class="comment">/* Bezier U Endpoints */</span>
<a name="l03190"></a>03190         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>==4) {
<a name="l03191"></a>03191             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a> &lt; 5)          <span class="keywordflow">return</span> 0; <span class="comment">/* bezier with 4 orderu needs 5 points */</span>
<a name="l03192"></a>03192         }
<a name="l03193"></a>03193         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a> != 3)       <span class="keywordflow">return</span> 0; <span class="comment">/* order must be 3 or 4 */</span>
<a name="l03194"></a>03194     }
<a name="l03195"></a>03195     <span class="keywordflow">return</span> 1;
<a name="l03196"></a>03196 }
<a name="l03197"></a><a class="code" href="../../dc/d22/curve_8c.html#a58b3e106cf926fda72a45e414be77d2e">03197</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a58b3e106cf926fda72a45e414be77d2e">check_valid_nurb_v</a>( <span class="keyword">struct</span> <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l03198"></a>03198 {
<a name="l03199"></a>03199     <span class="keywordflow">if</span> (nu==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)                       <span class="keywordflow">return</span> 0;
<a name="l03200"></a>03200     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> &lt;= 1)                 <span class="keywordflow">return</span> 0;
<a name="l03201"></a>03201     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> != <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae5130607013204d8b04e604ed8c419bc">CU_NURBS</a>)           <span class="keywordflow">return</span> 1; <span class="comment">/* not a nurb, lets assume its valid */</span>
<a name="l03202"></a>03202     
<a name="l03203"></a>03203     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> &lt; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>)         <span class="keywordflow">return</span> 0;
<a name="l03204"></a>03204     <span class="keywordflow">if</span> (((nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a3cf1c2dec47235e64740549f9bb2b5ff">flag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>)==0) &amp;&amp; (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ae1c344a45c028d3c2067864f5280854e">flagv</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a644364540eb9666e65a7039995b0fef8">CU_NURB_BEZIER</a>)) { <span class="comment">/* Bezier V Endpoints */</span>
<a name="l03205"></a>03205         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>==4) {
<a name="l03206"></a>03206             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a> &lt; 5)          <span class="keywordflow">return</span> 0; <span class="comment">/* bezier with 4 orderu needs 5 points */</span>
<a name="l03207"></a>03207         }
<a name="l03208"></a>03208         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a> != 3)       <span class="keywordflow">return</span> 0; <span class="comment">/* order must be 3 or 4 */</span>
<a name="l03209"></a>03209     }
<a name="l03210"></a>03210     <span class="keywordflow">return</span> 1;
<a name="l03211"></a>03211 }
<a name="l03212"></a>03212 
<a name="l03213"></a><a class="code" href="../../dc/d22/curve_8c.html#a4a1a66ab8e36c2a154f603635120f975">03213</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a4a1a66ab8e36c2a154f603635120f975">clamp_nurb_order_u</a>( <span class="keyword">struct</span> <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu )
<a name="l03214"></a>03214 {
<a name="l03215"></a>03215     <span class="keywordtype">int</span> change = 0;
<a name="l03216"></a>03216     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>) {
<a name="l03217"></a>03217         nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l03218"></a>03218         change= 1;
<a name="l03219"></a>03219     }
<a name="l03220"></a>03220     <span class="keywordflow">if</span> (((nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>)==0) &amp;&amp; (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a1eb264d76d62b930aa6759c19934df16">flagu</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a644364540eb9666e65a7039995b0fef8">CU_NURB_BEZIER</a>)) {
<a name="l03221"></a>03221         <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2465eeb3c7bf3d9af99d604cb97fabb2">orderu</a>, 3,4);
<a name="l03222"></a>03222         change= 1;
<a name="l03223"></a>03223     }
<a name="l03224"></a>03224     <span class="keywordflow">return</span> change;
<a name="l03225"></a>03225 }
<a name="l03226"></a>03226 
<a name="l03227"></a><a class="code" href="../../dc/d22/curve_8c.html#aab66d7747f889ce8c05f6c0bc8d0a375">03227</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aab66d7747f889ce8c05f6c0bc8d0a375">clamp_nurb_order_v</a>( <span class="keyword">struct</span> <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu)
<a name="l03228"></a>03228 {
<a name="l03229"></a>03229     <span class="keywordtype">int</span> change = 0;
<a name="l03230"></a>03230     <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>&lt;nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>) {
<a name="l03231"></a>03231         nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l03232"></a>03232         change= 1;
<a name="l03233"></a>03233     }
<a name="l03234"></a>03234     <span class="keywordflow">if</span> (((nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ae1c344a45c028d3c2067864f5280854e">flagv</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a4ec4fe43f3bdfd868e6c620d8df80c88">CU_NURB_CYCLIC</a>)==0) &amp;&amp; (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#ae1c344a45c028d3c2067864f5280854e">flagv</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a644364540eb9666e65a7039995b0fef8">CU_NURB_BEZIER</a>)) {
<a name="l03235"></a>03235         <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2c2a371fce1c6a69220da1c685fc5969">orderv</a>, 3,4);
<a name="l03236"></a>03236         change= 1;
<a name="l03237"></a>03237     }
<a name="l03238"></a>03238     <span class="keywordflow">return</span> change;
<a name="l03239"></a>03239 }
<a name="l03240"></a>03240 
<a name="l03241"></a>03241 <span class="comment">/* Get edit nurbs or normal nurbs list */</span>
<a name="l03242"></a><a class="code" href="../../dc/d22/curve_8c.html#a1ecb4d760f9484fb2e748f8b2357611a">03242</a> <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *<a class="code" href="../../d7/dfc/BKE__curve_8h.html#a72ca081768fa9e5e257b5d6fbc08b0f3">BKE_curve_nurbs</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu)
<a name="l03243"></a>03243 {
<a name="l03244"></a>03244     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab8319d0774eb0b2880dc03db155a87dc">editnurb</a>) {
<a name="l03245"></a>03245         <span class="keywordflow">return</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a444d55e9e251234b0c8e22da36a06819">curve_editnurbs</a>(cu);
<a name="l03246"></a>03246     }
<a name="l03247"></a>03247 
<a name="l03248"></a>03248     <span class="keywordflow">return</span> &amp;cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>;
<a name="l03249"></a>03249 }
<a name="l03250"></a>03250 
<a name="l03251"></a>03251 
<a name="l03252"></a>03252 <span class="comment">/* basic vertex data functions */</span>
<a name="l03253"></a><a class="code" href="../../dc/d22/curve_8c.html#ac91b5688dc1753e36c75fc7ac3079a8e">03253</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a0d2656ae39f3785476a8f91f6fb30c6b">minmax_curve</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu, <span class="keywordtype">float</span> <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>[3], <span class="keywordtype">float</span> <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>[3])
<a name="l03254"></a>03254 {
<a name="l03255"></a>03255     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nurb_lb= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a72ca081768fa9e5e257b5d6fbc08b0f3">BKE_curve_nurbs</a>(cu);
<a name="l03256"></a>03256     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l03257"></a>03257 
<a name="l03258"></a>03258     <span class="keywordflow">for</span> (nu= nurb_lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>)
<a name="l03259"></a>03259         <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aa0903caa3a4cfe1ae6c16545a9990fd6">minmaxNurb</a>(nu, min, max);
<a name="l03260"></a>03260 
<a name="l03261"></a>03261     <span class="keywordflow">return</span> (nurb_lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03262"></a>03262 }
<a name="l03263"></a>03263 
<a name="l03264"></a><a class="code" href="../../dc/d22/curve_8c.html#a906ea87a99d8f0af95532dfe092abf6f">03264</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a61f1bb1ac55a2bd47f2189e734a64c78">curve_center_median</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu, <span class="keywordtype">float</span> cent[3])
<a name="l03265"></a>03265 {
<a name="l03266"></a>03266     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nurb_lb= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a72ca081768fa9e5e257b5d6fbc08b0f3">BKE_curve_nurbs</a>(cu);
<a name="l03267"></a>03267     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l03268"></a>03268     <span class="keywordtype">int</span> total= 0;
<a name="l03269"></a>03269 
<a name="l03270"></a>03270     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#acd4d89007c860a4c74d459ac72593065">zero_v3</a>(cent);
<a name="l03271"></a>03271 
<a name="l03272"></a>03272     <span class="keywordflow">for</span> (nu= nurb_lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l03273"></a>03273         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03274"></a>03274 
<a name="l03275"></a>03275         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l03276"></a>03276             <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l03277"></a>03277             i= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l03278"></a>03278             total += i * 3;
<a name="l03279"></a>03279             <span class="keywordflow">for</span> (bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>; i--; bezt++) {
<a name="l03280"></a>03280                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(cent, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0]);
<a name="l03281"></a>03281                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(cent, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1]);
<a name="l03282"></a>03282                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(cent, bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2]);
<a name="l03283"></a>03283             }
<a name="l03284"></a>03284         }
<a name="l03285"></a>03285         <span class="keywordflow">else</span> {
<a name="l03286"></a>03286             <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l03287"></a>03287             i= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l03288"></a>03288             total += <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03289"></a>03289             <span class="keywordflow">for</span> (bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>; i--; bp++) {
<a name="l03290"></a>03290                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(cent, bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>);
<a name="l03291"></a>03291             }
<a name="l03292"></a>03292         }
<a name="l03293"></a>03293     }
<a name="l03294"></a>03294 
<a name="l03295"></a>03295     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(cent, 1.0f/(<span class="keywordtype">float</span>)total);
<a name="l03296"></a>03296 
<a name="l03297"></a>03297     <span class="keywordflow">return</span> (total != 0);
<a name="l03298"></a>03298 }
<a name="l03299"></a>03299 
<a name="l03300"></a><a class="code" href="../../dc/d22/curve_8c.html#ad862aff9b98459d1c406bbaf8bfa71c9">03300</a> <span class="keywordtype">int</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#aeef63c9cfd1ae46d63b20943671a12c5">curve_center_bounds</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu, <span class="keywordtype">float</span> cent[3])
<a name="l03301"></a>03301 {
<a name="l03302"></a>03302     <span class="keywordtype">float</span> <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>[3], <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>[3];
<a name="l03303"></a>03303     <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a329751705c70a4b2fd8a24744f172bb2">INIT_MINMAX</a>(min, max);
<a name="l03304"></a>03304     <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfc/BKE__curve_8h.html#a0d2656ae39f3785476a8f91f6fb30c6b">minmax_curve</a>(cu, min, max)) {
<a name="l03305"></a>03305         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ac3186a97188a3cf15bc5e2f8b0e97ad2">mid_v3_v3v3</a>(cent, min, max);
<a name="l03306"></a>03306         <span class="keywordflow">return</span> 1;
<a name="l03307"></a>03307     }
<a name="l03308"></a>03308 
<a name="l03309"></a>03309     <span class="keywordflow">return</span> 0;
<a name="l03310"></a>03310 }
<a name="l03311"></a>03311 
<a name="l03312"></a><a class="code" href="../../dc/d22/curve_8c.html#aa406632c5778dd2d00d7e716cd54d60e">03312</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a462714d6f840e1f79ca41409abf5e4c1">curve_translate</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu, <span class="keywordtype">float</span> offset[3], <span class="keywordtype">int</span> do_keys)
<a name="l03313"></a>03313 {
<a name="l03314"></a>03314     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nurb_lb= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a72ca081768fa9e5e257b5d6fbc08b0f3">BKE_curve_nurbs</a>(cu);
<a name="l03315"></a>03315     <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l03316"></a>03316     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03317"></a>03317 
<a name="l03318"></a>03318     <span class="keywordflow">for</span> (nu= nurb_lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l03319"></a>03319         <a class="code" href="../../d5/dd9/structBezTriple.html">BezTriple</a> *bezt;
<a name="l03320"></a>03320         <a class="code" href="../../d9/d51/structBPoint.html">BPoint</a> *bp;
<a name="l03321"></a>03321 
<a name="l03322"></a>03322         <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a65f2622eae97bf8084a15be668f1dfe2">type</a> == <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#a61aeb80b477c979b161e38084b747da1">CU_BEZIER</a>) {
<a name="l03323"></a>03323             i= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>;
<a name="l03324"></a>03324             <span class="keywordflow">for</span> (bezt= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a6d49e0f8d687346a35555e97c0e5e5a0">bezt</a>; i--; bezt++) {
<a name="l03325"></a>03325                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[0], offset);
<a name="l03326"></a>03326                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[1], offset);
<a name="l03327"></a>03327                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(bezt-&gt;<a class="code" href="../../d5/dd9/structBezTriple.html#a65c1569ddc02a36e6d245fa1cdd0f87e">vec</a>[2], offset);
<a name="l03328"></a>03328             }
<a name="l03329"></a>03329         }
<a name="l03330"></a>03330         <span class="keywordflow">else</span> {
<a name="l03331"></a>03331             i= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a18914e4626a3fa51b6cbfa0964d5f747">pntsu</a>*nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a42c8a657d9a11f9601bdf062c5f466b0">pntsv</a>;
<a name="l03332"></a>03332             <span class="keywordflow">for</span> (bp= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a96edaa87395fe64773afc328f50c41aa">bp</a>; i--; bp++) {
<a name="l03333"></a>03333                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(bp-&gt;<a class="code" href="../../d9/d51/structBPoint.html#a87a41cbc4756dd60184d0d32153931e5">vec</a>, offset);
<a name="l03334"></a>03334             }
<a name="l03335"></a>03335         }
<a name="l03336"></a>03336     }
<a name="l03337"></a>03337 
<a name="l03338"></a>03338     <span class="keywordflow">if</span> (do_keys &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>) {
<a name="l03339"></a>03339         <a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a> *kb;
<a name="l03340"></a>03340         <span class="keywordflow">for</span> (kb=cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>-&gt;<a class="code" href="../../d1/d9e/structKey.html#ab82a3a504826387b0811d68570496e2a">block</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; kb; kb=kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#ac20a23b2cb5a21986a4c762933f8a95b">next</a>) {
<a name="l03341"></a>03341             <span class="keywordtype">float</span> *fp= kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#aec4b55f1b0c4c1e0c60a77f7ffb80401">data</a>;
<a name="l03342"></a>03342             <span class="keywordflow">for</span> (i= kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#a48866fbfcc064f4777e2d2841ce42fe4">totelem</a>; i--; fp+=3) {
<a name="l03343"></a>03343                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(fp, offset);
<a name="l03344"></a>03344             }
<a name="l03345"></a>03345         }
<a name="l03346"></a>03346     }
<a name="l03347"></a>03347 }
<a name="l03348"></a>03348 
<a name="l03349"></a><a class="code" href="../../dc/d22/curve_8c.html#ac74389ad4d6f2c9b8d73c48f0779cb96">03349</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/dfc/BKE__curve_8h.html#a65724c25cc770adf36c7cf9f62a9e511">curve_delete_material_index</a>(<a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu, <span class="keywordtype">int</span> index)
<a name="l03350"></a>03350 {
<a name="l03351"></a>03351     <span class="keyword">const</span> <span class="keywordtype">int</span> curvetype= <a class="code" href="../../d7/dfc/BKE__curve_8h.html#ab0eaa93ca0534495ecaa64345b75e6d3">curve_type</a>(cu);
<a name="l03352"></a>03352 
<a name="l03353"></a>03353     <span class="keywordflow">if</span> (curvetype == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1a94162b6fc469957966a01d41ff71d6">OB_FONT</a>) {
<a name="l03354"></a>03354         <span class="keyword">struct </span><a class="code" href="../../dc/d38/structCharInfo.html">CharInfo</a> *info= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a95ab12824ad734ab8bc052cd7fdcc22d">strinfo</a>;
<a name="l03355"></a>03355         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l03356"></a>03356         <span class="keywordflow">for</span> (i= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#adace7d1722758b9ffec9b98f9cf688b2">len</a>-1; i &gt;= 0; i--, info++) {
<a name="l03357"></a>03357             <span class="keywordflow">if</span> (info-&gt;<a class="code" href="../../dc/d38/structCharInfo.html#a7a213df43c06c6c62a579e47cc771353">mat_nr</a> &amp;&amp; info-&gt;<a class="code" href="../../dc/d38/structCharInfo.html#a7a213df43c06c6c62a579e47cc771353">mat_nr</a>&gt;=index) {
<a name="l03358"></a>03358                 info-&gt;<a class="code" href="../../dc/d38/structCharInfo.html#a7a213df43c06c6c62a579e47cc771353">mat_nr</a>--;
<a name="l03359"></a>03359             }
<a name="l03360"></a>03360         }
<a name="l03361"></a>03361     }
<a name="l03362"></a>03362     <span class="keywordflow">else</span> {
<a name="l03363"></a>03363         <a class="code" href="../../d5/d47/structNurb.html">Nurb</a> *nu;
<a name="l03364"></a>03364 
<a name="l03365"></a>03365         <span class="keywordflow">for</span> (nu= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nu; nu= nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a2a65b45cf9d2eb81b3b92d872e777aaa">next</a>) {
<a name="l03366"></a>03366             <span class="keywordflow">if</span> (nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#aec3c171f54634d9a772bbf8000bc2bb6">mat_nr</a> &amp;&amp; nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#aec3c171f54634d9a772bbf8000bc2bb6">mat_nr</a>&gt;=index) {
<a name="l03367"></a>03367                 nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#aec3c171f54634d9a772bbf8000bc2bb6">mat_nr</a>--;
<a name="l03368"></a>03368                 <span class="keywordflow">if</span> (curvetype == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>) nu-&gt;<a class="code" href="../../d5/d47/structNurb.html#a3c5ced990e505c6408917ae50489759f">charidx</a>--;
<a name="l03369"></a>03369             }
<a name="l03370"></a>03370         }
<a name="l03371"></a>03371     }
<a name="l03372"></a>03372 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:12 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: elbeem.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">elbeem.cpp</div>  </div>
</div>
<div class="contents">
<a href="../../dc/d59/elbeem_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00004"></a>00004 <span class="comment">/******************************************************************************</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * El&#39;Beem - Free Surface Fluid Simulation with the Lattice Boltzmann Method</span>
<a name="l00007"></a>00007 <span class="comment"> * All code distributed as part of El&#39;Beem is covered by the version 2 of the </span>
<a name="l00008"></a>00008 <span class="comment"> * GNU General Public License. See the file COPYING for details.</span>
<a name="l00009"></a>00009 <span class="comment"> * Copyright 2003-2006 Nils Thuerey</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * Main program functions</span>
<a name="l00012"></a>00012 <span class="comment"> */</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d00/elbeem_8h.html">elbeem.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dc7/ntl__blenderdumper_8h.html">ntl_blenderdumper.h</a>&quot;</span>
<a name="l00016"></a>00016 <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d59/elbeem_8cpp.html#a01b62064767afcd8b10b27928a594aa6">elbeemCheckDebugEnv</a>(<span class="keywordtype">void</span>);
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d8d/ntl__world_8h.html">ntl_world.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d16/ntl__geometrymodel_8h.html">ntl_geometrymodel.h</a>&quot;</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="comment">/*****************************************************************************/</span>
<a name="l00022"></a>00022 <span class="comment">// region of interest global vars</span>
<a name="l00023"></a>00023 <span class="comment">// currently used by e.g. fsgr solver</span>
<a name="l00024"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#a1bdbe3cd93203c2dfa534b17a7e8253c">00024</a> <span class="keywordtype">double</span> <a class="code" href="../../dc/d59/elbeem_8cpp.html#a1bdbe3cd93203c2dfa534b17a7e8253c">guiRoiSX</a> = 0.0;
<a name="l00025"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#a8a67e3afaa4df5dcfd5f58f0bfaa7e63">00025</a> <span class="keywordtype">double</span> <a class="code" href="../../dc/d59/elbeem_8cpp.html#a8a67e3afaa4df5dcfd5f58f0bfaa7e63">guiRoiSY</a> = 0.0;
<a name="l00026"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#a83d1dc02c62a6076bc710b29d5d9c3fe">00026</a> <span class="keywordtype">double</span> <a class="code" href="../../dc/d59/elbeem_8cpp.html#a83d1dc02c62a6076bc710b29d5d9c3fe">guiRoiSZ</a> = 0.0;
<a name="l00027"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#a78fc1bddd0cabfeba274d93eeed60d38">00027</a> <span class="keywordtype">double</span> <a class="code" href="../../dc/d59/elbeem_8cpp.html#a78fc1bddd0cabfeba274d93eeed60d38">guiRoiEX</a> = 1.0;
<a name="l00028"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#a7106fc57dee959411afcb0ab320ab55e">00028</a> <span class="keywordtype">double</span> <a class="code" href="../../dc/d59/elbeem_8cpp.html#a7106fc57dee959411afcb0ab320ab55e">guiRoiEY</a> = 1.0;
<a name="l00029"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#a43bb3709dde57cf65283129487dd3aa4">00029</a> <span class="keywordtype">double</span> <a class="code" href="../../dc/d59/elbeem_8cpp.html#a43bb3709dde57cf65283129487dd3aa4">guiRoiEZ</a> = 1.0;
<a name="l00030"></a><a class="code" href="../../d9/d63/solver__util_8cpp.html#a5eb5b4a4d0f18074fbe1a96246619802">00030</a> <span class="keywordtype">int</span> <a class="code" href="../../dc/d59/elbeem_8cpp.html#a75fdca2cb22a2ad0c5e594f92a5e7003">guiRoiMaxLev</a>=6, <a class="code" href="../../dc/d59/elbeem_8cpp.html#a5eb5b4a4d0f18074fbe1a96246619802">guiRoiMinLev</a>=0;
<a name="l00031"></a>00031 
<a name="l00033"></a><a class="code" href="../../dc/d59/elbeem_8cpp.html#a9f6bd3a7a73728db94b4048f0bcc2a82">00033</a> <a class="code" href="../../dc/d5b/classntlWorld.html">ntlWorld</a> *<a class="code" href="../../dc/d59/elbeem_8cpp.html#a9f6bd3a7a73728db94b4048f0bcc2a82" title="global raytracer pointer (=world)">gpWorld</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="comment">// API</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="comment">// reset elbeemSimulationSettings struct with defaults</span>
<a name="l00040"></a>00040 <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> 
<a name="l00041"></a><a class="code" href="../../dc/d59/elbeem_8cpp.html#a3bd55728365353169f6f989721c90330">00041</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d00/elbeem_8h.html#a7c16efd67129ffb79d9f4e5de1e95156">elbeemResetSettings</a>(<a class="code" href="../../d3/d14/structelbeemSimulationSettings.html">elbeemSimulationSettings</a> *<span class="keyword">set</span>) {
<a name="l00042"></a>00042     <span class="keywordflow">if</span>(!<span class="keyword">set</span>) <span class="keywordflow">return</span>;
<a name="l00043"></a>00043   <span class="keyword">set</span>-&gt;version = 3;
<a name="l00044"></a>00044   <span class="keyword">set</span>-&gt;domainId = 0;
<a name="l00045"></a>00045     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0 ; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;3; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) set-&gt;geoStart[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0;
<a name="l00046"></a>00046     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0 ; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;3; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) <span class="keyword">set</span>-&gt;geoSize[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 1.0;
<a name="l00047"></a>00047   <span class="keyword">set</span>-&gt;resolutionxyz = 64;
<a name="l00048"></a>00048   <span class="keyword">set</span>-&gt;previewresxyz = 24;
<a name="l00049"></a>00049   <span class="keyword">set</span>-&gt;realsize = 1.0;
<a name="l00050"></a>00050   <span class="keyword">set</span>-&gt;viscosity = 0.000001;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0 ; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;2; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) set-&gt;gravity[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0;
<a name="l00053"></a>00053     set-&gt;gravity[2] = -9.81;
<a name="l00054"></a>00054 
<a name="l00055"></a>00055   set-&gt;animStart = 0; 
<a name="l00056"></a>00056     set-&gt;aniFrameTime = 0.01;
<a name="l00057"></a>00057     set-&gt;noOfFrames = 10;
<a name="l00058"></a>00058   set-&gt;gstar = 0.005;
<a name="l00059"></a>00059   set-&gt;maxRefine = -1;
<a name="l00060"></a>00060   set-&gt;generateParticles = 0.0;
<a name="l00061"></a>00061   set-&gt;numTracerParticles = 0;
<a name="l00062"></a>00062   strcpy(set-&gt;outputPath,<span class="stringliteral">&quot;./elbeemdata_&quot;</span>);
<a name="l00063"></a>00063 
<a name="l00064"></a>00064     <span class="keyword">set</span>-&gt;channelSizeFrameTime=0;
<a name="l00065"></a>00065     <span class="keyword">set</span>-&gt;channelFrameTime=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00066"></a>00066     <span class="keyword">set</span>-&gt;channelSizeViscosity=0;
<a name="l00067"></a>00067     <span class="keyword">set</span>-&gt;channelViscosity=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00068"></a>00068     <span class="keyword">set</span>-&gt;channelSizeGravity=0;
<a name="l00069"></a>00069     <span class="keyword">set</span>-&gt;channelGravity=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; 
<a name="l00070"></a>00070 
<a name="l00071"></a>00071     <span class="keyword">set</span>-&gt;domainobsType= <a class="code" href="../../d8/d00/elbeem_8h.html#ac83976a5929415117a8a8823fe481ff0">FLUIDSIM_OBSTACLE_NOSLIP</a>;
<a name="l00072"></a>00072     <span class="keyword">set</span>-&gt;domainobsPartslip= 0.;
<a name="l00073"></a>00073     <span class="keyword">set</span>-&gt;generateVertexVectors = 0;
<a name="l00074"></a>00074     <span class="keyword">set</span>-&gt;surfaceSmoothing = 1.;
<a name="l00075"></a>00075     <span class="keyword">set</span>-&gt;surfaceSubdivs = 1;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077     <span class="keyword">set</span>-&gt;farFieldSize = 0.;
<a name="l00078"></a>00078     <span class="keyword">set</span>-&gt;runsimCallback = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00079"></a>00079     <span class="keyword">set</span>-&gt;runsimUserData = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00080"></a>00080 
<a name="l00081"></a>00081     <span class="comment">// init identity</span>
<a name="l00082"></a>00082     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;16; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) set-&gt;surfaceTrafo[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0;
<a name="l00083"></a>00083     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;4; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) <span class="keyword">set</span>-&gt;surfaceTrafo[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*4+<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 1.0;
<a name="l00084"></a>00084 }
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="comment">// start fluidsim init</span>
<a name="l00087"></a>00087 <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> 
<a name="l00088"></a><a class="code" href="../../dc/d59/elbeem_8cpp.html#af472f48e71c3d1f0b06bebd3a9c02f72">00088</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d00/elbeem_8h.html#a932391041b25b60e9b3adab20cf21c74">elbeemInit</a>() {
<a name="l00089"></a>00089     <a class="code" href="../../de/da5/utilities_8cpp.html#a4cb779c77c9d3b803fa9076c8f38e945">setElbeemState</a>( <a class="code" href="../../de/df0/utilities_8h.html#a300db3b9b92eb1ac4fea739f3e91c0cb">SIMWORLD_INITIALIZING</a> );
<a name="l00090"></a>00090     <a class="code" href="../../de/da5/utilities_8cpp.html#a3c7d2b77e1ca545a83d3241bcf1595d6">setElbeemErrorString</a>(<span class="stringliteral">&quot;[none]&quot;</span>);
<a name="l00091"></a>00091     <a class="code" href="../../de/da5/utilities_8cpp.html#aaeb8d77a2d2295d01131fe5a8044a208" title="reset color output for elbeem init">resetGlobalColorSetting</a>();
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     <a class="code" href="../../dc/d59/elbeem_8cpp.html#a01b62064767afcd8b10b27928a594aa6">elbeemCheckDebugEnv</a>();
<a name="l00094"></a>00094     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;performElbeemSimulation&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a49b416ae327829b9acf505a5f627a272">DM_NOTIFY</a>,<span class="stringliteral">&quot;El&#39;Beem Simulation Init Start as Plugin, debugLevel:&quot;</span>&lt;&lt;<a class="code" href="../../de/da5/utilities_8cpp.html#a6b70c36875670697426d72ea41e7d904">gDebugLevel</a>&lt;&lt;<span class="stringliteral">&quot; ...\n&quot;</span>, 2);
<a name="l00095"></a>00095     
<a name="l00096"></a>00096     <span class="comment">// create world object with initial settings</span>
<a name="l00097"></a>00097     <a class="code" href="../../d0/d46/classntlBlenderDumper.html">ntlBlenderDumper</a> *elbeem = <span class="keyword">new</span> <a class="code" href="../../d0/d46/classntlBlenderDumper.html">ntlBlenderDumper</a>(); 
<a name="l00098"></a>00098     gpWorld = elbeem;
<a name="l00099"></a>00099     <span class="keywordflow">return</span> 0;
<a name="l00100"></a>00100 }
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 <span class="comment">// fluidsim end</span>
<a name="l00103"></a>00103 <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> 
<a name="l00104"></a><a class="code" href="../../dc/d59/elbeem_8cpp.html#acb9799d509750213cfa842f57cf9b456">00104</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d00/elbeem_8h.html#a89d10d0c15dfe10dcb031e8c8894b503">elbeemFree</a>() {
<a name="l00105"></a>00105     
<a name="l00106"></a>00106     <span class="keywordflow">return</span> 0;
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 <span class="comment">// start fluidsim init</span>
<a name="l00110"></a>00110 <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> 
<a name="l00111"></a><a class="code" href="../../dc/d59/elbeem_8cpp.html#a7ce88be7d6a47a0bc7c6b2dbbab5ae88">00111</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d00/elbeem_8h.html#a208d11c0853c8039e16f49740cc35ca1">elbeemAddDomain</a>(<a class="code" href="../../d3/d14/structelbeemSimulationSettings.html">elbeemSimulationSettings</a> *settings) {
<a name="l00112"></a>00112     <span class="comment">// has to be inited...</span>
<a name="l00113"></a>00113     <span class="keywordflow">if</span>((<a class="code" href="../../de/da5/utilities_8cpp.html#a5703bf80d6c4205e530eb01983bf0ac3">getElbeemState</a>() == <a class="code" href="../../de/df0/utilities_8h.html#a183ff373edaa5c031a591933ff3339ac">SIMWORLD_INVALID</a>) &amp;&amp; (!gpWorld)) { <a class="code" href="../../d8/d00/elbeem_8h.html#a932391041b25b60e9b3adab20cf21c74">elbeemInit</a>(); }
<a name="l00114"></a>00114     <span class="keywordflow">if</span>(<a class="code" href="../../de/da5/utilities_8cpp.html#a5703bf80d6c4205e530eb01983bf0ac3">getElbeemState</a>() != <a class="code" href="../../de/df0/utilities_8h.html#a300db3b9b92eb1ac4fea739f3e91c0cb">SIMWORLD_INITIALIZING</a>) { <a class="code" href="../../de/df0/utilities_8h.html#abbf67626aa468b4301520b9f6f292e1c">errFatal</a>(<span class="stringliteral">&quot;elbeemAddDomain&quot;</span>,<span class="stringliteral">&quot;Unable to init simulation world&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a74894721e682bda2c22d5dacda988cad">SIMWORLD_INITERROR</a>); }
<a name="l00115"></a>00115     <span class="comment">// create domain with given settings</span>
<a name="l00116"></a>00116     gpWorld-&gt;<a class="code" href="../../dc/d5b/classntlWorld.html#a21cf96436b2c72977d1da70868f369fc">addDomain</a>(settings);
<a name="l00117"></a>00117     <span class="keywordflow">return</span> 0;
<a name="l00118"></a>00118 }
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 <span class="comment">// error message access</span>
<a name="l00121"></a>00121 <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> 
<a name="l00122"></a><a class="code" href="../../dc/d59/elbeem_8cpp.html#a8f17e60271b90d94e3700df521410d30">00122</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d00/elbeem_8h.html#a8f17e60271b90d94e3700df521410d30">elbeemGetErrorString</a>(<span class="keywordtype">char</span> *buffer) {
<a name="l00123"></a>00123     <span class="keywordflow">if</span>(!buffer) <span class="keywordflow">return</span>;
<a name="l00124"></a>00124     strncpy(buffer,<a class="code" href="../../de/da5/utilities_8cpp.html#ac03ad9dc1c05144ffb7f0817779a2331">getElbeemErrorString</a>(),256);
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 <span class="comment">// reset elbeemMesh struct with zeroes</span>
<a name="l00128"></a>00128 <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> 
<a name="l00129"></a><a class="code" href="../../dc/d59/elbeem_8cpp.html#a8555e5c31965ed6520fdfc4b3da94f3b">00129</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d00/elbeem_8h.html#a4a59a08ca7e19ca2b268eb6ecf6bd8ee">elbeemResetMesh</a>(<a class="code" href="../../d1/d67/structelbeemMesh.html">elbeemMesh</a> *mesh) {
<a name="l00130"></a>00130     <span class="keywordflow">if</span>(!mesh) <span class="keywordflow">return</span>;
<a name="l00131"></a>00131     <span class="comment">// init typedef struct elbeemMesh</span>
<a name="l00132"></a>00132   mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#ad4f835b46caf8b18e9b18ae2e76b461a">type</a> = 0;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#aefd53c46158627e4a4a83e196426d1e3">parentDomainId</a> = 0;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136     <span class="comment">/* vertices */</span>
<a name="l00137"></a>00137   mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#ad199e2117b87a0c4b56e3dd85d5f94f3">numVertices</a> = 0;
<a name="l00138"></a>00138     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a4d9a1a61f8fdd48cfef692abc55b21b9">vertices</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00139"></a>00139 
<a name="l00140"></a>00140     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a4ef0a836228a344709e2f0d7a9272921">channelSizeVertices</a> = 0;
<a name="l00141"></a>00141     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a89484f22284a7428150a0bacb31ca4de">channelVertices</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00142"></a>00142 
<a name="l00143"></a>00143     <span class="comment">/* triangles */</span>
<a name="l00144"></a>00144     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a772faeac1bac583a737cb896126ba13e">numTriangles</a> = 0;
<a name="l00145"></a>00145   mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a0a3445f338f0b90ece185f52194ddf82">triangles</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     <span class="comment">/* animation channels */</span>
<a name="l00148"></a>00148     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a6c2ac956f0b9adbc33a64d19d103a8ea">channelSizeTranslation</a> = 0;
<a name="l00149"></a>00149     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a68f9423aae5f7a2abc656374314dd01d">channelTranslation</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00150"></a>00150     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a58a9a6d346cb339b69008eb2bb9e1cfb">channelSizeRotation</a> = 0;
<a name="l00151"></a>00151     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a74a4ea85b4e5a4ee581a5b5eff831f3e">channelRotation</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00152"></a>00152     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#aaf310351b6f20cc58f092ffb83e7d805">channelSizeScale</a> = 0;
<a name="l00153"></a>00153     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a05a79d731027ec3ef0bab074c1fc7220">channelScale</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     <span class="comment">/* active channel */</span>
<a name="l00156"></a>00156     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#aaceeaedd31e20e9d44b47b4fcdd0707c">channelSizeActive</a> = 0;
<a name="l00157"></a>00157     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a09586c5e1fe145f7ec8dab4e80f3a04d">channelActive</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00158"></a>00158 
<a name="l00159"></a>00159     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#aa2ab9650dff4cc0aea1c6d9565c8da45">channelSizeInitialVel</a> = 0;
<a name="l00160"></a>00160     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a2cbe9fef37a3a31bd8b2c68ca6164c9e">channelInitialVel</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00161"></a>00161 
<a name="l00162"></a>00162     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a5854a8ef8356991312638af93d2dbb3d">localInivelCoords</a> = 0;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#ae0916b078ea7df5f6e0abf31cff3bba8">obstacleType</a>= <a class="code" href="../../d8/d00/elbeem_8h.html#ac83976a5929415117a8a8823fe481ff0">FLUIDSIM_OBSTACLE_NOSLIP</a>;
<a name="l00165"></a>00165     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#aaf48c5dbeb5822e5c02efd44e1fc60be">obstaclePartslip</a>= 0.;
<a name="l00166"></a>00166     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a1de545f3386753f7bbe45d6739c3e0ee">obstacleImpactFactor</a>= 1.;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a612931a39335abed77661a5fc71aba6c">volumeInitType</a>= <a class="code" href="../../d8/d00/elbeem_8h.html#a0eef3faec1b43ab91e21246658aa051a">OB_VOLUMEINIT_VOLUME</a>;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     <span class="comment">/* name of the mesh, mostly for debugging */</span>
<a name="l00171"></a>00171     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#ad14236d68f9984395f31921aff7cc799">name</a> = <span class="stringliteral">&quot;[unnamed]&quot;</span>;
<a name="l00172"></a>00172     
<a name="l00173"></a>00173     <span class="comment">/* fluid control settings */</span>
<a name="l00174"></a>00174     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a0aa4b327b9884ebccaaf75349f49bbf1">cpsTimeStart</a> = 0;
<a name="l00175"></a>00175     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#aea0d0b5fd96a43813bac675600c70a51">cpsTimeEnd</a> = 0;
<a name="l00176"></a>00176     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#ae9d67eb4b4c95824123c90b9aab84571">cpsQuality</a> = 0;
<a name="l00177"></a>00177     
<a name="l00178"></a>00178     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#aa58de21a375d291f2618928db7034d0b">channelSizeAttractforceStrength</a> = 0;
<a name="l00179"></a>00179     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a4db7613e612c278d2d15d2d152077a63">channelAttractforceStrength</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00180"></a>00180     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#ac2244d65afc60babf4d3e54ad803e771">channelSizeAttractforceRadius</a> = 0;
<a name="l00181"></a>00181     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a16b4fcd9896f3a47ffeba4e3cff4a564">channelAttractforceRadius</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00182"></a>00182     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a0be014b78140d13eef650aaa4231a6c8">channelSizeVelocityforceStrength</a> = 0;
<a name="l00183"></a>00183     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#aee496e0be8be654c9bf74dcf273365bd">channelVelocityforceStrength</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00184"></a>00184     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a29f3778bccfe2d931efe2a5549970e21">channelSizeVelocityforceRadius</a> = 0;
<a name="l00185"></a>00185     mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#ad656ef21e839e84770d04de901f70f11">channelVelocityforceRadius</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 
<a name="l00188"></a><a class="code" href="../../dc/d59/elbeem_8cpp.html#acf743c0fd13a5e2e3de5ad7a33abf7f4">00188</a> <span class="keywordtype">int</span> <a class="code" href="../../dc/d59/elbeem_8cpp.html#acf743c0fd13a5e2e3de5ad7a33abf7f4">globalMeshCounter</a> = 1;
<a name="l00189"></a>00189 <span class="comment">// add mesh as fluidsim object</span>
<a name="l00190"></a>00190 <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> 
<a name="l00191"></a><a class="code" href="../../dc/d59/elbeem_8cpp.html#a7f08ffda951c147c2736421c780b6b76">00191</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d00/elbeem_8h.html#ab1556477f4744dd39d2c5c099b7ab423">elbeemAddMesh</a>(<a class="code" href="../../d1/d67/structelbeemMesh.html">elbeemMesh</a> *mesh) {
<a name="l00192"></a>00192     <span class="keywordtype">int</span> initType;
<a name="l00193"></a>00193     <span class="keywordflow">if</span>(<a class="code" href="../../de/da5/utilities_8cpp.html#a5703bf80d6c4205e530eb01983bf0ac3">getElbeemState</a>() != <a class="code" href="../../de/df0/utilities_8h.html#a300db3b9b92eb1ac4fea739f3e91c0cb">SIMWORLD_INITIALIZING</a>) { <a class="code" href="../../de/df0/utilities_8h.html#abbf67626aa468b4301520b9f6f292e1c">errFatal</a>(<span class="stringliteral">&quot;elbeemAddMesh&quot;</span>,<span class="stringliteral">&quot;World and domain not initialized, call elbeemInit and elbeemAddDomain before...&quot;</span>, <a class="code" href="../../de/df0/utilities_8h.html#a74894721e682bda2c22d5dacda988cad">SIMWORLD_INITERROR</a>); }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <span class="keywordflow">switch</span>(mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#ad4f835b46caf8b18e9b18ae2e76b461a">type</a>) {
<a name="l00196"></a>00196         <span class="keywordflow">case</span> <a class="code" href="../../d8/d92/DNA__object__fluidsim_8h.html#af68436713c0de84f8476d83151d8da1e">OB_FLUIDSIM_OBSTACLE</a>: 
<a name="l00197"></a>00197             <span class="keywordflow">if</span>     (mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#ae0916b078ea7df5f6e0abf31cff3bba8">obstacleType</a>==<a class="code" href="../../d8/d00/elbeem_8h.html#add9f864fbe2637ae205b5d229596a441">FLUIDSIM_OBSTACLE_PARTSLIP</a>) initType = <a class="code" href="../../d8/d00/elbeem_8h.html#adfd63685e07b3a05e15253ac1dd88c53">FGI_BNDPART</a>; 
<a name="l00198"></a>00198             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#ae0916b078ea7df5f6e0abf31cff3bba8">obstacleType</a>==<a class="code" href="../../d8/d00/elbeem_8h.html#a43074590bb0f68b1c6220f578de2758a">FLUIDSIM_OBSTACLE_FREESLIP</a>) initType = <a class="code" href="../../d8/d00/elbeem_8h.html#a26267e2d9b47124e93188bb5e770524b">FGI_BNDFREE</a>; 
<a name="l00199"></a>00199             <span class="keywordflow">else</span> <span class="comment">/*if(mesh-&gt;obstacleType==FLUIDSIM_OBSTACLE_NOSLIP)*/</span> initType = <a class="code" href="../../d8/d00/elbeem_8h.html#ad0e7f1ed7626d8bd0701ec8f2e96aacd">FGI_BNDNO</a>; 
<a name="l00200"></a>00200             <span class="keywordflow">break</span>;
<a name="l00201"></a>00201         <span class="keywordflow">case</span> <a class="code" href="../../d8/d92/DNA__object__fluidsim_8h.html#aeed5182a5a6fb69bebbe4e49c526dfdc">OB_FLUIDSIM_FLUID</a>: initType = <a class="code" href="../../d8/d00/elbeem_8h.html#a51b010da5bd6ef1a80ad3b9a7be00e3a">FGI_FLUID</a>; <span class="keywordflow">break</span>;
<a name="l00202"></a>00202         <span class="keywordflow">case</span> <a class="code" href="../../d8/d92/DNA__object__fluidsim_8h.html#a4f9d1ea47ee6e99ec98632a3b0991f70">OB_FLUIDSIM_INFLOW</a>: initType = <a class="code" href="../../d8/d00/elbeem_8h.html#a981c60c9f2725cfc951630cf070fc646">FGI_MBNDINFLOW</a>; <span class="keywordflow">break</span>;
<a name="l00203"></a>00203         <span class="keywordflow">case</span> <a class="code" href="../../d8/d92/DNA__object__fluidsim_8h.html#a24201a921b09392bb5772ad13bc87fd5">OB_FLUIDSIM_OUTFLOW</a>: initType = <a class="code" href="../../d8/d00/elbeem_8h.html#ae440d9b224ab18a3429b1fcb1dabccc8">FGI_MBNDOUTFLOW</a>; <span class="keywordflow">break</span>;
<a name="l00204"></a>00204         <span class="keywordflow">case</span> <a class="code" href="../../d8/d92/DNA__object__fluidsim_8h.html#a963539c357aa7a18eea7a6e1a9ad44f9">OB_FLUIDSIM_CONTROL</a>: initType = <a class="code" href="../../d8/d00/elbeem_8h.html#a521787d995d4318d27481c812333ed1d">FGI_CONTROL</a>; <span class="keywordflow">break</span>;
<a name="l00205"></a>00205         <span class="keywordflow">default</span>: <span class="keywordflow">return</span> 1; <span class="comment">// invalid type</span>
<a name="l00206"></a>00206     }
<a name="l00207"></a>00207     
<a name="l00208"></a>00208     <a class="code" href="../../d7/d4d/classntlGeometryObjModel.html">ntlGeometryObjModel</a> *obj = <span class="keyword">new</span> <a class="code" href="../../d7/d4d/classntlGeometryObjModel.html">ntlGeometryObjModel</a>( );
<a name="l00209"></a>00209     gpWorld-&gt;<a class="code" href="../../dc/d5b/classntlWorld.html#abd194bdef4dcb227dc34a45eb5fbd496">getRenderGlobals</a>()-&gt;<a class="code" href="../../d0/d95/classntlRenderGlobals.html#ab16c773967908534c9861b39951d11f2" title="Returns the simulation scene manager (static scene with sim objects)">getSimScene</a>()-&gt;<a class="code" href="../../dd/d46/classntlScene.html#aadce3ce2667316f35ac67078c1b050e3">addGeoClass</a>( obj );
<a name="l00210"></a>00210     gpWorld-&gt;<a class="code" href="../../dc/d5b/classntlWorld.html#abd194bdef4dcb227dc34a45eb5fbd496">getRenderGlobals</a>()-&gt;<a class="code" href="../../d0/d95/classntlRenderGlobals.html#af5ebfadac17d6ca6581c9cc1ea147828" title="Returns the renderscene manager (scene changes for each frame)">getRenderScene</a>()-&gt;<a class="code" href="../../dd/d46/classntlScene.html#aadce3ce2667316f35ac67078c1b050e3">addGeoClass</a>(obj);
<a name="l00211"></a>00211     obj-&gt;<a class="code" href="../../d7/d4d/classntlGeometryObjModel.html#afde9cc5539c07a012dd815e37d77665f">initModel</a>(
<a name="l00212"></a>00212             mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#ad199e2117b87a0c4b56e3dd85d5f94f3">numVertices</a>, mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a4d9a1a61f8fdd48cfef692abc55b21b9">vertices</a>, mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a772faeac1bac583a737cb896126ba13e">numTriangles</a>, mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a0a3445f338f0b90ece185f52194ddf82">triangles</a>,
<a name="l00213"></a>00213             mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a4ef0a836228a344709e2f0d7a9272921">channelSizeVertices</a>, mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a89484f22284a7428150a0bacb31ca4de">channelVertices</a> );
<a name="l00214"></a>00214     <span class="keywordflow">if</span>(mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#ad14236d68f9984395f31921aff7cc799">name</a>) obj-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#a444f6bbccaccf40d4ebb882ca9ef5889">setName</a>(<span class="keywordtype">string</span>(mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#ad14236d68f9984395f31921aff7cc799">name</a>));
<a name="l00215"></a>00215     <span class="keywordflow">else</span> {
<a name="l00216"></a>00216         <span class="keywordtype">char</span> meshname[100];
<a name="l00217"></a>00217         <a class="code" href="../../d9/ded/BLI__winstuff_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(meshname,100,<span class="stringliteral">&quot;mesh%04d&quot;</span>,<a class="code" href="../../dc/d59/elbeem_8cpp.html#acf743c0fd13a5e2e3de5ad7a33abf7f4">globalMeshCounter</a>);
<a name="l00218"></a>00218         obj-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#a444f6bbccaccf40d4ebb882ca9ef5889">setName</a>(<span class="keywordtype">string</span>(meshname));
<a name="l00219"></a>00219     }
<a name="l00220"></a>00220     <a class="code" href="../../dc/d59/elbeem_8cpp.html#acf743c0fd13a5e2e3de5ad7a33abf7f4">globalMeshCounter</a>++;
<a name="l00221"></a>00221     obj-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#ae77206e58dc5de375b9c6584c0c9c9f0">setGeoInitId</a>( mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#aefd53c46158627e4a4a83e196426d1e3">parentDomainId</a>+1 );
<a name="l00222"></a>00222     obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ab8d2762887f8f9c7bcbb4b8b74c228fe">setGeoInitIntersect</a>(<span class="keyword">true</span>);
<a name="l00223"></a>00223     obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a5ff42a648fa9a45a5132df79d36a8fb4">setGeoInitType</a>(initType);
<a name="l00224"></a>00224     
<a name="l00225"></a>00225     <span class="comment">// abuse partslip value for control fluid: reverse control keys or not</span>
<a name="l00226"></a>00226     <span class="keywordflow">if</span>(initType == <a class="code" href="../../d8/d00/elbeem_8h.html#a521787d995d4318d27481c812333ed1d">FGI_CONTROL</a>)
<a name="l00227"></a>00227         obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a89c4a46e6a08ce14203dd6bd9d8e8e1e">setGeoPartSlipValue</a>(mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#ae0916b078ea7df5f6e0abf31cff3bba8">obstacleType</a>);
<a name="l00228"></a>00228     <span class="keywordflow">else</span>
<a name="l00229"></a>00229         obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a89c4a46e6a08ce14203dd6bd9d8e8e1e">setGeoPartSlipValue</a>(mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#aaf48c5dbeb5822e5c02efd44e1fc60be">obstaclePartslip</a>);
<a name="l00230"></a>00230     
<a name="l00231"></a>00231     obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a0be28393bc844c46b2fd6285678681a1">setGeoImpactFactor</a>(mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a1de545f3386753f7bbe45d6739c3e0ee">obstacleImpactFactor</a>);
<a name="l00232"></a>00232     
<a name="l00233"></a>00233     <span class="comment">/* fluid control features */</span>
<a name="l00234"></a>00234     obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a5f80eead7646e104191b1dd6e575171e">setCpsTimeStart</a>(mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a0aa4b327b9884ebccaaf75349f49bbf1">cpsTimeStart</a>);
<a name="l00235"></a>00235     obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a834d8e2af529f947b08d7f12b090696e">setCpsTimeEnd</a>(mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#aea0d0b5fd96a43813bac675600c70a51">cpsTimeEnd</a>);
<a name="l00236"></a>00236     obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#aa66b1eb9b0eb03aa34b7579c472ebbeb">setCpsQuality</a>(mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#ae9d67eb4b4c95824123c90b9aab84571">cpsQuality</a>);
<a name="l00237"></a>00237     
<a name="l00238"></a>00238     <span class="keywordflow">if</span>((mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a612931a39335abed77661a5fc71aba6c">volumeInitType</a>&lt;<a class="code" href="../../de/d07/ntl__geometryobject_8h.html#a08b2ac39ec665cdd543fb1b3d739108d">VOLUMEINIT_VOLUME</a>)||(mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a612931a39335abed77661a5fc71aba6c">volumeInitType</a>&gt;<a class="code" href="../../de/d07/ntl__geometryobject_8h.html#a22dea5eede14a7d766084f430bd193a5">VOLUMEINIT_BOTH</a>)) mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a612931a39335abed77661a5fc71aba6c">volumeInitType</a> = <a class="code" href="../../de/d07/ntl__geometryobject_8h.html#a08b2ac39ec665cdd543fb1b3d739108d">VOLUMEINIT_VOLUME</a>;
<a name="l00239"></a>00239     obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a7d311b3786aa2c12c56925d3466e624b">setVolumeInit</a>(mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a612931a39335abed77661a5fc71aba6c">volumeInitType</a>);
<a name="l00240"></a>00240     <span class="comment">// use channel instead, obj-&gt;setInitialVelocity( ntlVec3Gfx(mesh-&gt;iniVelocity[0], mesh-&gt;iniVelocity[1], mesh-&gt;iniVelocity[2]) );</span>
<a name="l00241"></a>00241     
<a name="l00242"></a>00242     obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#a31afe4ffe0cdfb9196e442ad7f734b11">initChannels</a>(
<a name="l00243"></a>00243             mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a6c2ac956f0b9adbc33a64d19d103a8ea">channelSizeTranslation</a>, mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a68f9423aae5f7a2abc656374314dd01d">channelTranslation</a>, 
<a name="l00244"></a>00244             mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a58a9a6d346cb339b69008eb2bb9e1cfb">channelSizeRotation</a>,    mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a74a4ea85b4e5a4ee581a5b5eff831f3e">channelRotation</a>, 
<a name="l00245"></a>00245             mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#aaf310351b6f20cc58f092ffb83e7d805">channelSizeScale</a>,       mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a05a79d731027ec3ef0bab074c1fc7220">channelScale</a>,
<a name="l00246"></a>00246             mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#aaceeaedd31e20e9d44b47b4fcdd0707c">channelSizeActive</a>,      mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a09586c5e1fe145f7ec8dab4e80f3a04d">channelActive</a>,
<a name="l00247"></a>00247             mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#aa2ab9650dff4cc0aea1c6d9565c8da45">channelSizeInitialVel</a>,  mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a2cbe9fef37a3a31bd8b2c68ca6164c9e">channelInitialVel</a>,
<a name="l00248"></a>00248             mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#aa58de21a375d291f2618928db7034d0b">channelSizeAttractforceStrength</a>,  mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a4db7613e612c278d2d15d2d152077a63">channelAttractforceStrength</a>,
<a name="l00249"></a>00249             mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#ac2244d65afc60babf4d3e54ad803e771">channelSizeAttractforceRadius</a>,  mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a16b4fcd9896f3a47ffeba4e3cff4a564">channelAttractforceRadius</a>,
<a name="l00250"></a>00250             mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a0be014b78140d13eef650aaa4231a6c8">channelSizeVelocityforceStrength</a>,  mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#aee496e0be8be654c9bf74dcf273365bd">channelVelocityforceStrength</a>,
<a name="l00251"></a>00251             mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a29f3778bccfe2d931efe2a5549970e21">channelSizeVelocityforceRadius</a>,  mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#ad656ef21e839e84770d04de901f70f11">channelVelocityforceRadius</a>
<a name="l00252"></a>00252         );
<a name="l00253"></a>00253     obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#af78d58ce6f3b2f232d37bcef7fec54ff">setLocalCoordInivel</a>( mesh-&gt;<a class="code" href="../../d1/d67/structelbeemMesh.html#a5854a8ef8356991312638af93d2dbb3d">localInivelCoords</a> );
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;elbeemAddMesh&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a6114b55148a647b2cb346a8f3f4bb938">DM_MSG</a>,<span class="stringliteral">&quot;Added elbeem mesh: &quot;</span>&lt;&lt;obj-&gt;<a class="code" href="../../dd/dcf/classntlGeometryClass.html#aa0433486901f2f913b7ca5c80a0de218">getName</a>()&lt;&lt;<span class="stringliteral">&quot; type=&quot;</span>&lt;&lt;initType&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;obj-&gt;<a class="code" href="../../df/dc9/classntlGeometryObject.html#ac682b9950c4bba83286f1ccac588dd7a">getIsAnimated</a>(), 9 );
<a name="l00256"></a>00256     <span class="keywordflow">return</span> 0;
<a name="l00257"></a>00257 }
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 <span class="comment">// do the actual simulation</span>
<a name="l00260"></a>00260 <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> 
<a name="l00261"></a><a class="code" href="../../dc/d59/elbeem_8cpp.html#a7987742bf9b20fa8d221f7241c1e50b9">00261</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d00/elbeem_8h.html#a7987742bf9b20fa8d221f7241c1e50b9">elbeemSimulate</a>(<span class="keywordtype">void</span>) {
<a name="l00262"></a>00262     <span class="keywordflow">if</span>(!gpWorld) <span class="keywordflow">return</span> 1;
<a name="l00263"></a>00263 
<a name="l00264"></a>00264     gpWorld-&gt;<a class="code" href="../../dc/d5b/classntlWorld.html#ab335265da5674d26cb3ab039120a02b8">finishWorldInit</a>();
<a name="l00265"></a>00265     <span class="keywordflow">if</span>( <a class="code" href="../../de/da5/utilities_8cpp.html#af3e89e0e3df33a7bf12fb4903a18f79b">isSimworldOk</a>() ) {
<a name="l00266"></a>00266         <a class="code" href="../../de/df0/utilities_8h.html#a5e598b8f33d56705cb3c457cb3a663b9">myTime_t</a> timestart = <a class="code" href="../../de/da5/utilities_8cpp.html#a464465f0a983105a4fd29ae7c1604927" title="get the current system time">getTime</a>();
<a name="l00267"></a>00267         gpWorld-&gt;<a class="code" href="../../dc/d5b/classntlWorld.html#a696aa674def2f25b98ace4efc71a354d">renderAnimation</a>();
<a name="l00268"></a>00268         <a class="code" href="../../de/df0/utilities_8h.html#a5e598b8f33d56705cb3c457cb3a663b9">myTime_t</a> timeend = <a class="code" href="../../de/da5/utilities_8cpp.html#a464465f0a983105a4fd29ae7c1604927" title="get the current system time">getTime</a>();
<a name="l00269"></a>00269 
<a name="l00270"></a>00270         <span class="keywordflow">if</span>(<a class="code" href="../../de/da5/utilities_8cpp.html#a5703bf80d6c4205e530eb01983bf0ac3">getElbeemState</a>() != <a class="code" href="../../de/df0/utilities_8h.html#a7e6c8a9b196c6e8ad8c6009c7650ab40">SIMWORLD_STOP</a>) {
<a name="l00271"></a>00271             <span class="comment">// ok, we&#39;re done...</span>
<a name="l00272"></a>00272             <span class="keyword">delete</span> <a class="code" href="../../dc/d59/elbeem_8cpp.html#a9f6bd3a7a73728db94b4048f0bcc2a82" title="global raytracer pointer (=world)">gpWorld</a>;
<a name="l00273"></a>00273             
<a name="l00274"></a>00274             gpWorld = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00275"></a>00275             <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;elbeemSimulate&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a49b416ae327829b9acf505a5f627a272">DM_NOTIFY</a>, <span class="stringliteral">&quot;El&#39;Beem simulation done, time: &quot;</span>&lt;&lt;<a class="code" href="../../de/da5/utilities_8cpp.html#a61ff8ca64f5e508c5142f409047f3600" title="convert time to readable string">getTimeString</a>(timeend-timestart)&lt;&lt;<span class="stringliteral">&quot;.\n&quot;</span>, 2 ); 
<a name="l00276"></a>00276         } <span class="keywordflow">else</span> {
<a name="l00277"></a>00277             <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;elbeemSimulate&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a49b416ae327829b9acf505a5f627a272">DM_NOTIFY</a>, <span class="stringliteral">&quot;El&#39;Beem simulation stopped, time so far: &quot;</span>&lt;&lt;<a class="code" href="../../de/da5/utilities_8cpp.html#a61ff8ca64f5e508c5142f409047f3600" title="convert time to readable string">getTimeString</a>(timeend-timestart)&lt;&lt;<span class="stringliteral">&quot;.&quot;</span>, 2 ); 
<a name="l00278"></a>00278         }
<a name="l00279"></a>00279         <span class="keywordflow">return</span> 0;
<a name="l00280"></a>00280     } 
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     <span class="comment">// failure...</span>
<a name="l00283"></a>00283     <span class="keywordflow">return</span> 1;
<a name="l00284"></a>00284 }
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 <span class="comment">// continue a previously stopped simulation</span>
<a name="l00288"></a>00288 <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> 
<a name="l00289"></a><a class="code" href="../../dc/d59/elbeem_8cpp.html#a071a56b6cb8b8a2e813d7b88fd6bd3eb">00289</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d00/elbeem_8h.html#a071a56b6cb8b8a2e813d7b88fd6bd3eb">elbeemContinueSimulation</a>(<span class="keywordtype">void</span>) {
<a name="l00290"></a>00290 
<a name="l00291"></a>00291     <span class="keywordflow">if</span>(<a class="code" href="../../de/da5/utilities_8cpp.html#a5703bf80d6c4205e530eb01983bf0ac3">getElbeemState</a>() != <a class="code" href="../../de/df0/utilities_8h.html#a7e6c8a9b196c6e8ad8c6009c7650ab40">SIMWORLD_STOP</a>) {
<a name="l00292"></a>00292         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;elbeemContinueSimulation&quot;</span>,<span class="stringliteral">&quot;No running simulation found! Aborting...&quot;</span>);
<a name="l00293"></a>00293         <span class="keywordflow">if</span>(gpWorld) <span class="keyword">delete</span> <a class="code" href="../../dc/d59/elbeem_8cpp.html#a9f6bd3a7a73728db94b4048f0bcc2a82" title="global raytracer pointer (=world)">gpWorld</a>;
<a name="l00294"></a>00294         <span class="keywordflow">return</span> 1;
<a name="l00295"></a>00295     }
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <a class="code" href="../../de/df0/utilities_8h.html#a5e598b8f33d56705cb3c457cb3a663b9">myTime_t</a> timestart = <a class="code" href="../../de/da5/utilities_8cpp.html#a464465f0a983105a4fd29ae7c1604927" title="get the current system time">getTime</a>();
<a name="l00298"></a>00298     gpWorld-&gt;<a class="code" href="../../dc/d5b/classntlWorld.html#a696aa674def2f25b98ace4efc71a354d">renderAnimation</a>();
<a name="l00299"></a>00299     <a class="code" href="../../de/df0/utilities_8h.html#a5e598b8f33d56705cb3c457cb3a663b9">myTime_t</a> timeend = <a class="code" href="../../de/da5/utilities_8cpp.html#a464465f0a983105a4fd29ae7c1604927" title="get the current system time">getTime</a>();
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     <span class="keywordflow">if</span>(<a class="code" href="../../de/da5/utilities_8cpp.html#a5703bf80d6c4205e530eb01983bf0ac3">getElbeemState</a>() != <a class="code" href="../../de/df0/utilities_8h.html#a7e6c8a9b196c6e8ad8c6009c7650ab40">SIMWORLD_STOP</a>) {
<a name="l00302"></a>00302         <span class="comment">// ok, we&#39;re done...</span>
<a name="l00303"></a>00303         <span class="keyword">delete</span> <a class="code" href="../../dc/d59/elbeem_8cpp.html#a9f6bd3a7a73728db94b4048f0bcc2a82" title="global raytracer pointer (=world)">gpWorld</a>;
<a name="l00304"></a>00304         gpWorld = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00305"></a>00305         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;elbeemContinueSimulation&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a49b416ae327829b9acf505a5f627a272">DM_NOTIFY</a>, <span class="stringliteral">&quot;El&#39;Beem simulation done, time: &quot;</span>&lt;&lt;<a class="code" href="../../de/da5/utilities_8cpp.html#a61ff8ca64f5e508c5142f409047f3600" title="convert time to readable string">getTimeString</a>(timeend-timestart)&lt;&lt;<span class="stringliteral">&quot;.\n&quot;</span>, 2 ); 
<a name="l00306"></a>00306     } <span class="keywordflow">else</span> {
<a name="l00307"></a>00307         <a class="code" href="../../de/df0/utilities_8h.html#a37f52a1d684af6dd5f377d6286f09fbd">debMsgStd</a>(<span class="stringliteral">&quot;elbeemContinueSimulation&quot;</span>,<a class="code" href="../../de/df0/utilities_8h.html#a49b416ae327829b9acf505a5f627a272">DM_NOTIFY</a>, <span class="stringliteral">&quot;El&#39;Beem simulation stopped, time so far: &quot;</span>&lt;&lt;<a class="code" href="../../de/da5/utilities_8cpp.html#a61ff8ca64f5e508c5142f409047f3600" title="convert time to readable string">getTimeString</a>(timeend-timestart)&lt;&lt;<span class="stringliteral">&quot;.&quot;</span>, 2 ); 
<a name="l00308"></a>00308     }
<a name="l00309"></a>00309     <span class="keywordflow">return</span> 0;
<a name="l00310"></a>00310 } 
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 <span class="comment">// global vector to flag values to remove</span>
<a name="l00314"></a><a class="code" href="../../dc/d59/elbeem_8cpp.html#a70abe953dac8417c076487422291296f">00314</a> vector&lt;int&gt; <a class="code" href="../../dc/d59/elbeem_8cpp.html#a70abe953dac8417c076487422291296f">gKeepVal</a>;
<a name="l00315"></a>00315 
<a name="l00316"></a><a class="code" href="../../dc/d59/elbeem_8cpp.html#ae309994650c5cb6fbd0fb08ac376ff98">00316</a> <span class="preprocessor">#define SIMPLIFY_FLOAT_EPSILON (1e-6f)</span>
<a name="l00317"></a><a class="code" href="../../dc/d59/elbeem_8cpp.html#a395af5659c9a9a3146ebbc391d793830">00317</a> <span class="preprocessor"></span><span class="preprocessor">#define SIMPLIFY_DOUBLE_EPSILON (1e-12f)</span>
<a name="l00318"></a><a class="code" href="../../dc/d59/elbeem_8cpp.html#a9a102f9b6f5ec19b10cf7dcf6229a67f">00318</a> <span class="preprocessor"></span><span class="preprocessor">#define SFLOATEQ(x,y)  (ABS((x)-(y)) &lt; SIMPLIFY_FLOAT_EPSILON)</span>
<a name="l00319"></a><a class="code" href="../../dc/d59/elbeem_8cpp.html#a9844bf6e1cc4236526dbcdd28c0acccd">00319</a> <span class="preprocessor"></span><span class="preprocessor">#define SDOUBLEEQ(x,y) (ABS((x)-(y)) &lt; SIMPLIFY_DOUBLE_EPSILON)</span>
<a name="l00320"></a><a class="code" href="../../dc/d59/elbeem_8cpp.html#a7ff1e0613312dd6ad6fdfab138fd5159">00320</a> <span class="preprocessor"></span><span class="preprocessor">#define SVECFLOATEQ(x,y)  ( \</span>
<a name="l00321"></a>00321 <span class="preprocessor">    (ABS((x)[0]-(y)[0]) &lt; SIMPLIFY_FLOAT_EPSILON) &amp;&amp; \</span>
<a name="l00322"></a>00322 <span class="preprocessor">    (ABS((x)[1]-(y)[1]) &lt; SIMPLIFY_FLOAT_EPSILON) &amp;&amp; \</span>
<a name="l00323"></a>00323 <span class="preprocessor">    (ABS((x)[2]-(y)[2]) &lt; SIMPLIFY_FLOAT_EPSILON) )</span>
<a name="l00324"></a>00324 <span class="preprocessor"></span>
<a name="l00325"></a>00325 <span class="comment">// helper function - simplify animation channels</span>
<a name="l00326"></a>00326 <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> 
<a name="l00327"></a><a class="code" href="../../dc/d59/elbeem_8cpp.html#a0eb895701aa35491d946684e73e9e39d">00327</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d00/elbeem_8h.html#a0eb895701aa35491d946684e73e9e39d">elbeemSimplifyChannelFloat</a>(<span class="keywordtype">float</span> *channel, <span class="keywordtype">int</span>* <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>) {
<a name="l00328"></a>00328     <span class="keywordtype">bool</span> changed = <span class="keyword">false</span>;
<a name="l00329"></a>00329     <span class="keywordtype">int</span> nsize = *<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l00330"></a>00330     <span class="keywordtype">int</span> orgsize = *<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l00331"></a>00331     <span class="keywordflow">if</span>(orgsize&lt;1) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00332"></a>00332     <a class="code" href="../../dc/d59/elbeem_8cpp.html#a70abe953dac8417c076487422291296f">gKeepVal</a>.resize( orgsize );
<a name="l00333"></a>00333     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;orgsize; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) { <a class="code" href="../../dc/d59/elbeem_8cpp.html#a70abe953dac8417c076487422291296f">gKeepVal</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <span class="keyword">true</span>; }
<a name="l00334"></a>00334     <span class="keyword">const</span> <span class="keywordtype">bool</span> debugSF = <span class="keyword">false</span>;
<a name="l00335"></a>00335 
<a name="l00336"></a>00336     <span class="keywordtype">float</span> last = channel[0 + 0];
<a name="l00337"></a>00337     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=1; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;orgsize; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00338"></a>00338         <span class="keywordtype">float</span> curr = channel[2*<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> + 0];
<a name="l00339"></a>00339         <span class="keywordtype">bool</span> <span class="keyword">remove</span> = <span class="keyword">false</span>;
<a name="l00340"></a>00340         <span class="keywordflow">if</span>(<a class="code" href="../../dc/d59/elbeem_8cpp.html#a9a102f9b6f5ec19b10cf7dcf6229a67f">SFLOATEQ</a>(curr,last)) <span class="keyword">remove</span> = <span class="keyword">true</span>;
<a name="l00341"></a>00341         <span class="comment">// dont remove if next value is different</span>
<a name="l00342"></a>00342         <span class="keywordflow">if</span>((<span class="keyword">remove</span>)&amp;&amp;(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;orgsize-1)) {
<a name="l00343"></a>00343             <span class="keywordtype">float</span> <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a> = channel[2*(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1)+0];
<a name="l00344"></a>00344             <span class="keywordflow">if</span>(!<a class="code" href="../../dc/d59/elbeem_8cpp.html#a9a102f9b6f5ec19b10cf7dcf6229a67f">SFLOATEQ</a>(next,curr)) <span class="keyword">remove</span> = <span class="keyword">false</span>;
<a name="l00345"></a>00345         }
<a name="l00346"></a>00346         <span class="keywordflow">if</span>(<span class="keyword">remove</span>) {
<a name="l00347"></a>00347             changed = <span class="keyword">true</span>;
<a name="l00348"></a>00348             <a class="code" href="../../dc/d59/elbeem_8cpp.html#a70abe953dac8417c076487422291296f">gKeepVal</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <span class="keyword">false</span>;
<a name="l00349"></a>00349             nsize--;
<a name="l00350"></a>00350         }
<a name="l00351"></a>00351         <span class="keywordflow">if</span>(debugSF) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;elbeemSimplifyChannelFloat&quot;</span>,<span class="stringliteral">&quot;i&quot;</span>&lt;&lt;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;&lt;<span class="stringliteral">&quot;/&quot;</span>&lt;&lt;orgsize&lt;&lt;<span class="stringliteral">&quot; v&quot;</span>&lt;&lt;channel[ (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*2) + 0 ]&lt;&lt;<span class="stringliteral">&quot; t&quot;</span>&lt;&lt;channel[ (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*2) + 1 ]&lt;&lt;<span class="stringliteral">&quot;   nsize=&quot;</span>&lt;&lt;nsize&lt;&lt;<span class="stringliteral">&quot; r&quot;</span>&lt;&lt;<span class="keyword">remove</span> );
<a name="l00352"></a>00352         last = curr;
<a name="l00353"></a>00353     }
<a name="l00354"></a>00354 
<a name="l00355"></a>00355     <span class="keywordflow">if</span>(changed) {
<a name="l00356"></a>00356         nsize = 1;
<a name="l00357"></a>00357         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=1; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;orgsize; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00358"></a>00358             <span class="keywordflow">if</span>(<a class="code" href="../../dc/d59/elbeem_8cpp.html#a70abe953dac8417c076487422291296f">gKeepVal</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]) {
<a name="l00359"></a>00359                 channel[ (nsize*2) + 0 ] = channel[ (i*2) + 0 ];
<a name="l00360"></a>00360                 channel[ (nsize*2) + 1 ] = channel[ (i*2) + 1 ];
<a name="l00361"></a>00361                 nsize++;
<a name="l00362"></a>00362             }
<a name="l00363"></a>00363         }
<a name="l00364"></a>00364         *size = nsize;
<a name="l00365"></a>00365     }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367     <span class="keywordflow">if</span>(debugSF) <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=1; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;nsize; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00368"></a>00368         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;elbeemSimplifyChannelFloat&quot;</span>,<span class="stringliteral">&quot;n i&quot;</span>&lt;&lt;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;&lt;<span class="stringliteral">&quot;/&quot;</span>&lt;&lt;nsize&lt;&lt;<span class="stringliteral">&quot; v&quot;</span>&lt;&lt;channel[ (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*2) + 0 ]&lt;&lt;<span class="stringliteral">&quot; t&quot;</span>&lt;&lt;channel[ (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*2) + 1 ] );
<a name="l00369"></a>00369     }
<a name="l00370"></a>00370 
<a name="l00371"></a>00371     <span class="keywordflow">return</span> changed;
<a name="l00372"></a>00372 }
<a name="l00373"></a>00373 
<a name="l00374"></a>00374 <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> 
<a name="l00375"></a><a class="code" href="../../dc/d59/elbeem_8cpp.html#a8649c6f0c49da9baf1b51f4ce885ea97">00375</a> <span class="keywordtype">int</span> <a class="code" href="../../d8/d00/elbeem_8h.html#a8649c6f0c49da9baf1b51f4ce885ea97">elbeemSimplifyChannelVec3</a>(<span class="keywordtype">float</span> *channel, <span class="keywordtype">int</span>* <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>) {
<a name="l00376"></a>00376     <span class="keywordtype">bool</span> changed = <span class="keyword">false</span>;
<a name="l00377"></a>00377     <span class="keywordtype">int</span> nsize = *<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l00378"></a>00378     <span class="keywordtype">int</span> orgsize = *<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l00379"></a>00379     <span class="keywordflow">if</span>(orgsize&lt;1) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00380"></a>00380     <a class="code" href="../../dc/d59/elbeem_8cpp.html#a70abe953dac8417c076487422291296f">gKeepVal</a>.resize( orgsize );
<a name="l00381"></a>00381     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;orgsize; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) { <a class="code" href="../../dc/d59/elbeem_8cpp.html#a70abe953dac8417c076487422291296f">gKeepVal</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <span class="keyword">true</span>; }
<a name="l00382"></a>00382     <span class="keyword">const</span> <span class="keywordtype">bool</span> debugVF = <span class="keyword">false</span>;
<a name="l00383"></a>00383 
<a name="l00384"></a>00384     <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3f</a> last( channel[0 + 0], channel[0 + 1], channel[0 + 2] );
<a name="l00385"></a>00385     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=1; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;orgsize; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00386"></a>00386         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3f</a> curr( channel[4*<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> + 0], channel[4*<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1], channel[4*<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> + 2]);
<a name="l00387"></a>00387         <span class="keywordtype">bool</span> <span class="keyword">remove</span> = <span class="keyword">false</span>;
<a name="l00388"></a>00388         <span class="keywordflow">if</span>(<a class="code" href="../../dc/d59/elbeem_8cpp.html#a7ff1e0613312dd6ad6fdfab138fd5159">SVECFLOATEQ</a>(curr,last)) <span class="keyword">remove</span> = <span class="keyword">true</span>;
<a name="l00389"></a>00389         <span class="comment">// dont remove if next value is different</span>
<a name="l00390"></a>00390         <span class="keywordflow">if</span>((<span class="keyword">remove</span>)&amp;&amp;(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;orgsize-1)) {
<a name="l00391"></a>00391             <a class="code" href="../../dc/d7e/classntlVector3Dim.html">ntlVec3f</a> <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>( channel[4*(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1)+0], channel[4*(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1)+1], channel[4*(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1)+2]);
<a name="l00392"></a>00392             <span class="keywordflow">if</span>(!<a class="code" href="../../dc/d59/elbeem_8cpp.html#a7ff1e0613312dd6ad6fdfab138fd5159">SVECFLOATEQ</a>(next,curr)) <span class="keyword">remove</span> = <span class="keyword">false</span>;
<a name="l00393"></a>00393         }
<a name="l00394"></a>00394         <span class="keywordflow">if</span>(<span class="keyword">remove</span>) {
<a name="l00395"></a>00395             changed = <span class="keyword">true</span>;
<a name="l00396"></a>00396             <a class="code" href="../../dc/d59/elbeem_8cpp.html#a70abe953dac8417c076487422291296f">gKeepVal</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <span class="keyword">false</span>;
<a name="l00397"></a>00397             nsize--;
<a name="l00398"></a>00398         }
<a name="l00399"></a>00399         <span class="keywordflow">if</span>(debugVF) <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;elbeemSimplifyChannelVec3&quot;</span>,<span class="stringliteral">&quot;i&quot;</span>&lt;&lt;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;&lt;<span class="stringliteral">&quot;/&quot;</span>&lt;&lt;orgsize&lt;&lt;<span class="stringliteral">&quot; v&quot;</span>&lt;&lt;
<a name="l00400"></a>00400                 channel[ (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*4) + 0 ]&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt; channel[ (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*4) + 1 ]&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt; channel[ (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*4) + 2 ]&lt;&lt;
<a name="l00401"></a>00401                 <span class="stringliteral">&quot; t&quot;</span>&lt;&lt;channel[ (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*4) + 3 ]&lt;&lt;<span class="stringliteral">&quot;   nsize=&quot;</span>&lt;&lt;nsize&lt;&lt;<span class="stringliteral">&quot; r&quot;</span>&lt;&lt;<span class="keyword">remove</span> );
<a name="l00402"></a>00402         last = curr;
<a name="l00403"></a>00403     }
<a name="l00404"></a>00404 
<a name="l00405"></a>00405     <span class="keywordflow">if</span>(changed) {
<a name="l00406"></a>00406         nsize = 1;
<a name="l00407"></a>00407         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=1; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;orgsize; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00408"></a>00408             <span class="keywordflow">if</span>(<a class="code" href="../../dc/d59/elbeem_8cpp.html#a70abe953dac8417c076487422291296f">gKeepVal</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]) {
<a name="l00409"></a>00409                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;4; j++){ channel[ (nsize*4) + j ] = channel[ (i*4) + j ]; }
<a name="l00410"></a>00410                 nsize++;
<a name="l00411"></a>00411             }
<a name="l00412"></a>00412         }
<a name="l00413"></a>00413         *size = nsize;
<a name="l00414"></a>00414     }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416     <span class="keywordflow">if</span>(debugVF) <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=1; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;nsize; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00417"></a>00417         <a class="code" href="../../de/df0/utilities_8h.html#aad5a3b2a920c31f4f4a4252c949c6c71">errMsg</a>(<span class="stringliteral">&quot;elbeemSimplifyChannelVec3&quot;</span>,<span class="stringliteral">&quot;n i&quot;</span>&lt;&lt;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;&lt;<span class="stringliteral">&quot;/&quot;</span>&lt;&lt;nsize&lt;&lt;<span class="stringliteral">&quot; v&quot;</span>&lt;&lt;
<a name="l00418"></a>00418                 channel[ (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*4) + 0 ]&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt; channel[ (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*4) + 1 ]&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt; channel[ (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*4) + 2 ]&lt;&lt;
<a name="l00419"></a>00419                 <span class="stringliteral">&quot; t&quot;</span>&lt;&lt;channel[ (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>*4) + 3 ] );
<a name="l00420"></a>00420     }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422     <span class="keywordflow">return</span> changed;
<a name="l00423"></a>00423 }
<a name="l00424"></a>00424 
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 <span class="preprocessor">#undef SIMPLIFY_FLOAT_EPSILON</span>
<a name="l00427"></a>00427 <span class="preprocessor"></span><span class="preprocessor">#undef SIMPLIFY_DOUBLE_EPSILON</span>
<a name="l00428"></a>00428 <span class="preprocessor"></span><span class="preprocessor">#undef SFLOATEQ</span>
<a name="l00429"></a>00429 <span class="preprocessor"></span><span class="preprocessor">#undef SDOUBLEEQ</span>
<a name="l00430"></a>00430 <span class="preprocessor"></span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:17 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: depsgraph.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">depsgraph.c</div>  </div>
</div>
<div class="contents">
<a href="../../dc/d2f/depsgraph_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2004 Blender Foundation.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * Contributor(s): none yet.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00024"></a>00024 <span class="comment"> */</span>
<a name="l00025"></a>00025 
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#  include &quot;<a class="code" href="../../d9/ded/BLI__winstuff_8h.html" title="Compatibility-like things for windows.">BLI_winstuff.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#endif</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d3e/BLI__listbase_8h.html">BLI_listbase.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc5/BLI__ghash_8h.html" title="A general (pointer -&gt; pointer) hash table ADT.">BLI_ghash.h</a>&quot;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html">DNA_anim_types.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d3b/DNA__camera__types_8h.html">DNA_camera_types.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d75/DNA__group__types_8h.html">DNA_group_types.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d2f/DNA__lattice__types_8h.html">DNA_lattice_types.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d41/DNA__key__types_8h.html">DNA_key_types.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../de/db2/DNA__material__types_8h.html">DNA_material_types.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d96/DNA__mesh__types_8h.html">DNA_mesh_types.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d27/DNA__node__types_8h.html">DNA_node_types.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/da4/DNA__screen__types_8h.html">DNA_screen_types.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html">DNA_windowmanager_types.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dfb/DNA__movieclip__types_8h.html">DNA_movieclip_types.h</a>&quot;</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d51/BKE__animsys_8h.html">BKE_animsys.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/df5/BKE__action_8h.html" title="Blender kernel action and pose functionality.">BKE_action.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d65/BKE__effect_8h.html">BKE_effect.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dba/BKE__fcurve_8h.html">BKE_fcurve.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/df5/BKE__group_8h.html">BKE_group.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d17/BKE__key_8h.html">BKE_key.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/db1/BKE__library_8h.html">BKE_library.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d91/BKE__node_8h.html">BKE_node.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dae/BKE__mball_8h.html">BKE_mball.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d0f/BKE__modifier_8h.html">BKE_modifier.h</a>&quot;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dac/BKE__object_8h.html" title="General operations, lookup, etc. for blender objects.">BKE_object.h</a>&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dca/BKE__particle_8h.html">BKE_particle.h</a>&quot;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d45/BKE__pointcache_8h.html">BKE_pointcache.h</a>&quot;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d53/BKE__scene_8h.html">BKE_scene.h</a>&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/da3/BKE__screen_8h.html">BKE_screen.h</a>&quot;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dde/BKE__utildefines_8h.html" title="blender format specific macros">BKE_utildefines.h</a>&quot;</span>
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d24/depsgraph__private_8h.html">depsgraph_private.h</a>&quot;</span>
<a name="l00078"></a>00078  
<a name="l00079"></a>00079 <span class="comment">/* Queue and stack operations for dag traversal </span>
<a name="l00080"></a>00080 <span class="comment"> *</span>
<a name="l00081"></a>00081 <span class="comment"> * the queue store a list of freenodes to avoid successive alloc/dealloc</span>
<a name="l00082"></a>00082 <span class="comment"> */</span>
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#ab1df05b5e7c73b0bc403fbb132fe8fba">00084</a> <a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> * <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab1df05b5e7c73b0bc403fbb132fe8fba">queue_create</a> (<span class="keywordtype">int</span> slots) 
<a name="l00085"></a>00085 {
<a name="l00086"></a>00086     <a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> * queue;
<a name="l00087"></a>00087     <a class="code" href="../../d4/d39/structDagNodeQueueElem.html">DagNodeQueueElem</a> * elem;
<a name="l00088"></a>00088     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00089"></a>00089     
<a name="l00090"></a>00090     queue = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a>),<span class="stringliteral">&quot;DAG queue&quot;</span>);
<a name="l00091"></a>00091     queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a>),<span class="stringliteral">&quot;DAG queue&quot;</span>);
<a name="l00092"></a>00092     queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a> = 0;
<a name="l00093"></a>00093     queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a3b2b3e05809ab02a811711c9d379eba6">maxlevel</a> = 0;
<a name="l00094"></a>00094     queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a> = queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00095"></a>00095     elem = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d39/structDagNodeQueueElem.html">DagNodeQueueElem</a>),<span class="stringliteral">&quot;DAG queue elem3&quot;</span>);
<a name="l00096"></a>00096     elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00097"></a>00097     elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00098"></a>00098     queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a> = queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a> = elem;
<a name="l00099"></a>00099     
<a name="l00100"></a>00100     <span class="keywordflow">for</span> (i = 1; i &lt;slots;i++) {
<a name="l00101"></a>00101         elem = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d39/structDagNodeQueueElem.html">DagNodeQueueElem</a>),<span class="stringliteral">&quot;DAG queue elem4&quot;</span>);
<a name="l00102"></a>00102         elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00103"></a>00103         elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00104"></a>00104         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a>-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a> = elem;
<a name="l00105"></a>00105         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a> = elem;
<a name="l00106"></a>00106     }
<a name="l00107"></a>00107     queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a> = slots;
<a name="l00108"></a>00108     <span class="keywordflow">return</span> queue;
<a name="l00109"></a>00109 }
<a name="l00110"></a>00110 
<a name="l00111"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a796062ada26cda4a237c68cd4e7c79d8">00111</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a796062ada26cda4a237c68cd4e7c79d8">queue_raz</a>(<a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *queue)
<a name="l00112"></a>00112 {
<a name="l00113"></a>00113     <a class="code" href="../../d4/d39/structDagNodeQueueElem.html">DagNodeQueueElem</a> * elem;
<a name="l00114"></a>00114     
<a name="l00115"></a>00115     elem = queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a>;
<a name="l00116"></a>00116     <span class="keywordflow">if</span> (queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a>)
<a name="l00117"></a>00117         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a>-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a> = elem;
<a name="l00118"></a>00118     <span class="keywordflow">else</span>
<a name="l00119"></a>00119         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a> = queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a> = elem;
<a name="l00120"></a>00120     
<a name="l00121"></a>00121     elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00122"></a>00122     queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a>++;
<a name="l00123"></a>00123     <span class="keywordflow">while</span> (elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a>) {
<a name="l00124"></a>00124         elem = elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a>;
<a name="l00125"></a>00125         elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00126"></a>00126         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a>++;
<a name="l00127"></a>00127     }
<a name="l00128"></a>00128     queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a> = elem;
<a name="l00129"></a>00129     queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a> = 0;
<a name="l00130"></a>00130 }
<a name="l00131"></a>00131 
<a name="l00132"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#abc04d0228ee82264f117858200dc2fcf">00132</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a4546a39116f46dea548c9e1195be4cca">queue_delete</a>(<a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *queue)
<a name="l00133"></a>00133 {
<a name="l00134"></a>00134     <a class="code" href="../../d4/d39/structDagNodeQueueElem.html">DagNodeQueueElem</a> * elem;
<a name="l00135"></a>00135     <a class="code" href="../../d4/d39/structDagNodeQueueElem.html">DagNodeQueueElem</a> * temp;
<a name="l00136"></a>00136     
<a name="l00137"></a>00137     elem = queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a>;
<a name="l00138"></a>00138     <span class="keywordflow">while</span> (elem) {
<a name="l00139"></a>00139         temp = elem;
<a name="l00140"></a>00140         elem = elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a>;
<a name="l00141"></a>00141         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(temp);
<a name="l00142"></a>00142     }
<a name="l00143"></a>00143     
<a name="l00144"></a>00144     elem = queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a>;
<a name="l00145"></a>00145     <span class="keywordflow">while</span> (elem) {
<a name="l00146"></a>00146         temp = elem;
<a name="l00147"></a>00147         elem = elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a>;
<a name="l00148"></a>00148         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(temp);
<a name="l00149"></a>00149     }
<a name="l00150"></a>00150     
<a name="l00151"></a>00151     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>);            
<a name="l00152"></a>00152     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(queue);           
<a name="l00153"></a>00153 }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 <span class="comment">/* insert in queue, remove in front */</span>
<a name="l00156"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a335f4bbca178af08d1a1a8472aac9027">00156</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a335f4bbca178af08d1a1a8472aac9027">push_queue</a>(<a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *queue, <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node)
<a name="l00157"></a>00157 {
<a name="l00158"></a>00158     <a class="code" href="../../d4/d39/structDagNodeQueueElem.html">DagNodeQueueElem</a> * elem;
<a name="l00159"></a>00159     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161     <span class="keywordflow">if</span> (node == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00162"></a>00162         fprintf(stderr,<span class="stringliteral">&quot;pushing null node\n&quot;</span>);
<a name="l00163"></a>00163         <span class="keywordflow">return</span>;
<a name="l00164"></a>00164     }
<a name="l00165"></a>00165     <span class="comment">/*fprintf(stderr,&quot;BFS push : %s %d\n&quot;,((ID *) node-&gt;ob)-&gt;name, queue-&gt;count);*/</span>
<a name="l00166"></a>00166 
<a name="l00167"></a>00167     elem = queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a>;
<a name="l00168"></a>00168     <span class="keywordflow">if</span> (elem != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00169"></a>00169         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a> = elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a>;
<a name="l00170"></a>00170         <span class="keywordflow">if</span> ( queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a> == elem) {
<a name="l00171"></a>00171             queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00172"></a>00172             queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00173"></a>00173         }
<a name="l00174"></a>00174         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a>--;
<a name="l00175"></a>00175     }
<a name="l00176"></a>00176     <span class="keywordflow">else</span> { <span class="comment">/* alllocating more */</span>
<a name="l00177"></a>00177         elem = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d39/structDagNodeQueueElem.html">DagNodeQueueElem</a>),<span class="stringliteral">&quot;DAG queue elem1&quot;</span>);
<a name="l00178"></a>00178         elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00179"></a>00179         elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00180"></a>00180         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a> = queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a> = elem;
<a name="l00181"></a>00181 
<a name="l00182"></a>00182         <span class="keywordflow">for</span> (i = 1; i &lt;<a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab84f030513d53e1fbd6870d640282a6d">DAGQUEUEALLOC</a>;i++) {
<a name="l00183"></a>00183             elem = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d39/structDagNodeQueueElem.html">DagNodeQueueElem</a>),<span class="stringliteral">&quot;DAG queue elem2&quot;</span>);
<a name="l00184"></a>00184             elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00185"></a>00185             elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00186"></a>00186             queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a>-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a> = elem;
<a name="l00187"></a>00187             queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a> = elem;
<a name="l00188"></a>00188         }
<a name="l00189"></a>00189         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab84f030513d53e1fbd6870d640282a6d">DAGQUEUEALLOC</a>;
<a name="l00190"></a>00190             
<a name="l00191"></a>00191         elem = queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a>; 
<a name="l00192"></a>00192         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a> = elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a>;   
<a name="l00193"></a>00193     }
<a name="l00194"></a>00194     elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00195"></a>00195     elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a> = node;
<a name="l00196"></a>00196     <span class="keywordflow">if</span> (queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00197"></a>00197         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a>-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a> = elem;
<a name="l00198"></a>00198     queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a> = elem;
<a name="l00199"></a>00199     <span class="keywordflow">if</span> (queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00200"></a>00200         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a> = elem;
<a name="l00201"></a>00201     }
<a name="l00202"></a>00202     queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a>++;
<a name="l00203"></a>00203 }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 <span class="comment">/* insert in front, remove in front */</span>
<a name="l00207"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#acf4ce9e88412d2859799d3a2b3d1e09f">00207</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d24/depsgraph__private_8h.html#acf4ce9e88412d2859799d3a2b3d1e09f">push_stack</a>(<a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *queue, <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node)
<a name="l00208"></a>00208 {
<a name="l00209"></a>00209     <a class="code" href="../../d4/d39/structDagNodeQueueElem.html">DagNodeQueueElem</a> * elem;
<a name="l00210"></a>00210     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212     elem = queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a>; 
<a name="l00213"></a>00213     <span class="keywordflow">if</span> (elem != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00214"></a>00214         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a> = elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a>;
<a name="l00215"></a>00215         <span class="keywordflow">if</span> ( queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a> == elem) {
<a name="l00216"></a>00216             queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00217"></a>00217             queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00218"></a>00218         }
<a name="l00219"></a>00219         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a>--;
<a name="l00220"></a>00220     }
<a name="l00221"></a>00221     <span class="keywordflow">else</span> { <span class="comment">/* alllocating more */</span>
<a name="l00222"></a>00222         elem = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d39/structDagNodeQueueElem.html">DagNodeQueueElem</a>),<span class="stringliteral">&quot;DAG queue elem1&quot;</span>);
<a name="l00223"></a>00223         elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00224"></a>00224         elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00225"></a>00225         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a> = queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a> = elem;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227         <span class="keywordflow">for</span> (i = 1; i &lt;<a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab84f030513d53e1fbd6870d640282a6d">DAGQUEUEALLOC</a>;i++) {
<a name="l00228"></a>00228             elem = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d39/structDagNodeQueueElem.html">DagNodeQueueElem</a>),<span class="stringliteral">&quot;DAG queue elem2&quot;</span>);
<a name="l00229"></a>00229             elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00230"></a>00230             elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00231"></a>00231             queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a>-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a> = elem;
<a name="l00232"></a>00232             queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a> = elem;
<a name="l00233"></a>00233         }
<a name="l00234"></a>00234         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab84f030513d53e1fbd6870d640282a6d">DAGQUEUEALLOC</a>;
<a name="l00235"></a>00235             
<a name="l00236"></a>00236         elem = queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a>; 
<a name="l00237"></a>00237         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a> = elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a>;   
<a name="l00238"></a>00238     }
<a name="l00239"></a>00239     elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a> = queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a>;
<a name="l00240"></a>00240     elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a> = node;
<a name="l00241"></a>00241     queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a> = elem;
<a name="l00242"></a>00242     <span class="keywordflow">if</span> (queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00243"></a>00243         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a> = elem;
<a name="l00244"></a>00244     queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a>++;
<a name="l00245"></a>00245 }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 
<a name="l00248"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a235ae8872ca26849c15091928dd95cc6">00248</a> <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> * <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a235ae8872ca26849c15091928dd95cc6">pop_queue</a>(<a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *queue)
<a name="l00249"></a>00249 {
<a name="l00250"></a>00250     <a class="code" href="../../d4/d39/structDagNodeQueueElem.html">DagNodeQueueElem</a> * elem;
<a name="l00251"></a>00251     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253     elem = queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a>;
<a name="l00254"></a>00254     <span class="keywordflow">if</span> (elem) {
<a name="l00255"></a>00255         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a> = elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a>;
<a name="l00256"></a>00256         <span class="keywordflow">if</span> (queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a> == elem) {
<a name="l00257"></a>00257             queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a>=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00258"></a>00258             queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a>=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00259"></a>00259         }
<a name="l00260"></a>00260         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a>--;
<a name="l00261"></a>00261         <span class="keywordflow">if</span> (queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a>)
<a name="l00262"></a>00262             queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a>-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a>=elem;
<a name="l00263"></a>00263         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a829bae723808a23b32871f0cf663af93">last</a>=elem;
<a name="l00264"></a>00264         <span class="keywordflow">if</span> (queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00265"></a>00265             queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a>=elem;
<a name="l00266"></a>00266         node = elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a>;
<a name="l00267"></a>00267         elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00268"></a>00268         elem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00269"></a>00269         queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a410b9a1f10bef97378615de68689eed9">freenodes</a>-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a>++;
<a name="l00270"></a>00270         <span class="keywordflow">return</span> node;
<a name="l00271"></a>00271     }
<a name="l00272"></a>00272     <span class="keywordflow">else</span> {
<a name="l00273"></a>00273         fprintf(stderr,<span class="stringliteral">&quot;return null\n&quot;</span>);
<a name="l00274"></a>00274         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00275"></a>00275     }
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 
<a name="l00278"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#aec13f973f1ee1afebfd9d49ed6266f19">00278</a> <span class="keywordtype">void</span>    *<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aec13f973f1ee1afebfd9d49ed6266f19">pop_ob_queue</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *queue)
<a name="l00279"></a>00279 {
<a name="l00280"></a>00280     <span class="keywordflow">return</span>(<a class="code" href="../../d4/d24/depsgraph__private_8h.html#a235ae8872ca26849c15091928dd95cc6">pop_queue</a>(queue)-&gt;ob);
<a name="l00281"></a>00281 }
<a name="l00282"></a>00282 
<a name="l00283"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#abc5d63c9e9f34a5ab16e4b42a9017886">00283</a> <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> * <a class="code" href="../../d4/d24/depsgraph__private_8h.html#abc5d63c9e9f34a5ab16e4b42a9017886">get_top_node_queue</a>(<a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *queue) 
<a name="l00284"></a>00284 {
<a name="l00285"></a>00285     <span class="keywordflow">return</span> queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a>-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a>;
<a name="l00286"></a>00286 }
<a name="l00287"></a>00287 
<a name="l00288"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#ae2d000424588e8ec69f15d8ac4ae1c11">00288</a> <span class="keywordtype">int</span>     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ae2d000424588e8ec69f15d8ac4ae1c11">queue_count</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *queue)
<a name="l00289"></a>00289 {
<a name="l00290"></a>00290     <span class="keywordflow">return</span> queue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a>;
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 
<a name="l00294"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a95696f03e4d53d9007848383709fe2d3">00294</a> <a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *<a class="code" href="../../d4/d24/depsgraph__private_8h.html#a95696f03e4d53d9007848383709fe2d3">dag_init</a>(<span class="keywordtype">void</span>)
<a name="l00295"></a>00295 {
<a name="l00296"></a>00296     <a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *forest;
<a name="l00297"></a>00297     <span class="comment">/* use callocN to init all zero */</span>
<a name="l00298"></a>00298     forest = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../dc/df7/structDagForest.html">DagForest</a>),<span class="stringliteral">&quot;DAG root&quot;</span>);
<a name="l00299"></a>00299     <span class="keywordflow">return</span> forest;
<a name="l00300"></a>00300 }
<a name="l00301"></a>00301 
<a name="l00302"></a>00302 <span class="comment">/* isdata = object data... */</span>
<a name="l00303"></a>00303 <span class="comment">// XXX this needs to be extended to be more flexible (so that not only objects are evaluated via depsgraph)...</span>
<a name="l00304"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a2e17f471f1e6b0fe86afdd3ddaa9fbcf">00304</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#a2e17f471f1e6b0fe86afdd3ddaa9fbcf">dag_add_driver_relation</a>(<a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt, <a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *dag, <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node, <span class="keywordtype">int</span> isdata)
<a name="l00305"></a>00305 {
<a name="l00306"></a>00306     <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu;
<a name="l00307"></a>00307     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node1;
<a name="l00308"></a>00308     
<a name="l00309"></a>00309     <span class="keywordflow">for</span> (fcu= adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#aaca565f031ee1209087422d8a5d77769">drivers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; fcu; fcu= fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a381b65464374cad861b80c44b9ae0759">next</a>) {
<a name="l00310"></a>00310         <a class="code" href="../../d3/d1e/structChannelDriver.html">ChannelDriver</a> *driver= fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a6c79ab38bad6125a0c63120a5bf4dd3e">driver</a>;
<a name="l00311"></a>00311         <a class="code" href="../../d1/d24/structDriverVar.html">DriverVar</a> *dvar;
<a name="l00312"></a>00312         <span class="keywordtype">int</span> isdata_fcu = isdata || (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a> &amp;&amp; strstr(fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>, <span class="stringliteral">&quot;modifiers[&quot;</span>));
<a name="l00313"></a>00313         
<a name="l00314"></a>00314         <span class="comment">/* loop over variables to get the target relationships */</span>
<a name="l00315"></a>00315         <span class="keywordflow">for</span> (dvar= driver-&gt;<a class="code" href="../../d3/d1e/structChannelDriver.html#a14d54c061db1124addaba9a6a80cce1e">variables</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; dvar; dvar= dvar-&gt;<a class="code" href="../../d1/d24/structDriverVar.html#a6cbe874a49fab44dd2e2ec49b5a35da1">next</a>) {
<a name="l00316"></a>00316             <span class="comment">/* only used targets */</span>
<a name="l00317"></a>00317             <a class="code" href="../../da/dba/BKE__fcurve_8h.html#ab7a010e2c04c7ccc1c70a90f9346d3ef">DRIVER_TARGETS_USED_LOOPER</a>(dvar) 
<a name="l00318"></a>00318             {
<a name="l00319"></a>00319                 <span class="keywordflow">if</span> (dtar-&gt;id) {
<a name="l00320"></a>00320                     <span class="comment">// FIXME: other data types need to be added here so that they can work!</span>
<a name="l00321"></a>00321                     <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(dtar-&gt;id-&gt;name)==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>) {
<a name="l00322"></a>00322                         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= (<a class="code" href="../../de/de7/structObject.html">Object</a> *)dtar-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>;
<a name="l00323"></a>00323                         
<a name="l00324"></a>00324                         <span class="comment">/* normal channel-drives-channel */</span>
<a name="l00325"></a>00325                         node1 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, dtar-&gt;id);
<a name="l00326"></a>00326                         
<a name="l00327"></a>00327                         <span class="comment">/* check if bone... */</span>
<a name="l00328"></a>00328                         <span class="keywordflow">if</span> ((ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>) &amp;&amp; 
<a name="l00329"></a>00329                             ( ((dtar-&gt;rna_path) &amp;&amp; strstr(dtar-&gt;rna_path, <span class="stringliteral">&quot;pose.bones[&quot;</span>)) || 
<a name="l00330"></a>00330                               ((dtar-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a9b0375da90726dfc722f08e00bfe898aa80e084458864700178a95d79b406ecfe">DTAR_FLAG_STRUCT_REF</a>) &amp;&amp; (dtar-&gt;pchan_name[0])) )) 
<a name="l00331"></a>00331                         {
<a name="l00332"></a>00332                             <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node1, node, isdata_fcu?<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac50a2e08e7ef469574148c63cf8cf07c">DAG_RL_DATA_DATA</a>:<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a5e80e3c329f9c5844e8ce3bea32718b5">DAG_RL_DATA_OB</a>, <span class="stringliteral">&quot;Driver&quot;</span>);
<a name="l00333"></a>00333                         }
<a name="l00334"></a>00334                         <span class="comment">/* check if ob data */</span>
<a name="l00335"></a>00335                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dtar-&gt;rna_path &amp;&amp; strstr(dtar-&gt;rna_path, <span class="stringliteral">&quot;data.&quot;</span>))
<a name="l00336"></a>00336                             <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node1, node, isdata_fcu?<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac50a2e08e7ef469574148c63cf8cf07c">DAG_RL_DATA_DATA</a>:<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a5e80e3c329f9c5844e8ce3bea32718b5">DAG_RL_DATA_OB</a>, <span class="stringliteral">&quot;Driver&quot;</span>);
<a name="l00337"></a>00337                         <span class="comment">/* normal */</span>
<a name="l00338"></a>00338                         <span class="keywordflow">else</span>
<a name="l00339"></a>00339                             <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node1, node, isdata_fcu?<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aab7d56d2d4b14b85da29c700d3e4cd1c">DAG_RL_OB_DATA</a>:<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>, <span class="stringliteral">&quot;Driver&quot;</span>);
<a name="l00340"></a>00340                     }
<a name="l00341"></a>00341                 }
<a name="l00342"></a>00342             }
<a name="l00343"></a>00343             <a class="code" href="../../da/dba/BKE__fcurve_8h.html#ae6f978c887bc26c0da1235ccef77444b">DRIVER_TARGETS_LOOPER_END</a>
<a name="l00344"></a>00344         }
<a name="l00345"></a>00345     }
<a name="l00346"></a>00346 }
<a name="l00347"></a>00347 
<a name="l00348"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a27419667ecebc8313f4f2fe948ce4f73">00348</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#a27419667ecebc8313f4f2fe948ce4f73">dag_add_collision_field_relation</a>(<a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *dag, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node)
<a name="l00349"></a>00349 {
<a name="l00350"></a>00350     <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l00351"></a>00351     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node2;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353     <span class="comment">// would be nice to have a list of colliders here</span>
<a name="l00354"></a>00354     <span class="comment">// so for now walk all objects in scene check &#39;same layer rule&#39;</span>
<a name="l00355"></a>00355     <span class="keywordflow">for</span> (base = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; base; base= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a25befa992d0ce8876b7d62176212be68">next</a>) {
<a name="l00356"></a>00356         <span class="keywordflow">if</span> ((base-&gt;<a class="code" href="../../d3/da9/structBase.html#a8c3a6cb18ff56393b617978c497c54aa">lay</a> &amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa9cfa964651e1e2f3044c9c79cf004b3">lay</a>) &amp;&amp; base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>) {
<a name="l00357"></a>00357             <a class="code" href="../../de/de7/structObject.html">Object</a> *ob1= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l00358"></a>00358             <span class="keywordflow">if</span> ((ob1-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#a95751b10530e32549805265908842fa5">deflect</a> || ob1-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a>) &amp;&amp; (ob1 != ob)) {
<a name="l00359"></a>00359                 node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, ob1);                 
<a name="l00360"></a>00360                 <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node2, node, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac50a2e08e7ef469574148c63cf8cf07c">DAG_RL_DATA_DATA</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aab7d56d2d4b14b85da29c700d3e4cd1c">DAG_RL_OB_DATA</a>, <span class="stringliteral">&quot;Field Collision&quot;</span>);
<a name="l00361"></a>00361             }
<a name="l00362"></a>00362         }
<a name="l00363"></a>00363     }
<a name="l00364"></a>00364 }
<a name="l00365"></a>00365 
<a name="l00366"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a01aad0e45a03850fa18ad33d752007fa">00366</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#a01aad0e45a03850fa18ad33d752007fa">build_dag_object</a>(<a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *dag, <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *scenenode, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keywordtype">int</span> mask)
<a name="l00367"></a>00367 {
<a name="l00368"></a>00368     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l00369"></a>00369     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> * node;
<a name="l00370"></a>00370     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> * node2;
<a name="l00371"></a>00371     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> * node3;
<a name="l00372"></a>00372     <a class="code" href="../../d1/d9e/structKey.html">Key</a> *key;
<a name="l00373"></a>00373     <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys;
<a name="l00374"></a>00374     <span class="keywordtype">int</span> addtoroot= 1;
<a name="l00375"></a>00375     
<a name="l00376"></a>00376     node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, ob);
<a name="l00377"></a>00377     
<a name="l00378"></a>00378     <span class="keywordflow">if</span> ((ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>) &amp;&amp; (mask&amp;<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac7629e2e525bda7cccfdc979424a7612">DAG_RL_DATA</a>)) {
<a name="l00379"></a>00379         node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag,ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l00380"></a>00380         <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag,node,node2,DAG_RL_DATA, <span class="stringliteral">&quot;Object-Data Relation&quot;</span>);
<a name="l00381"></a>00381         node2-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a6fb0e21dbd34cacff704821017737a37">first_ancestor</a> = ob;
<a name="l00382"></a>00382         node2-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a168093b2854d5955780e202de15f8950">ancestor_count</a> += 1;
<a name="l00383"></a>00383     }
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     <span class="comment">/* also build a custom data mask for dependencies that need certain layers */</span>
<a name="l00386"></a>00386     node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#abe4b783b5053c701adb7409a53ea85fa">customdata_mask</a>= 0;
<a name="l00387"></a>00387     
<a name="l00388"></a>00388     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>) {
<a name="l00389"></a>00389         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>) {
<a name="l00390"></a>00390             <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan;
<a name="l00391"></a>00391             <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l00392"></a>00392             
<a name="l00393"></a>00393             <span class="keywordflow">for</span> (pchan = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; pchan; pchan=pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a73c14c1cca1a2d1e91778f44578eeca0">next</a>) {
<a name="l00394"></a>00394                 <span class="keywordflow">for</span> (con = pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; con; con=con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l00395"></a>00395                     <a class="code" href="../../dc/ded/structbConstraintTypeInfo.html">bConstraintTypeInfo</a> *cti= <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#a8eac21e0105e441026a6b7cd7d78030d">constraint_get_typeinfo</a>(con);
<a name="l00396"></a>00396                     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> targets = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00397"></a>00397                     <a class="code" href="../../d5/d78/structbConstraintTarget.html">bConstraintTarget</a> *ct;
<a name="l00398"></a>00398                     
<a name="l00399"></a>00399                     <span class="keywordflow">if</span> (cti &amp;&amp; cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a25b05ed0f4c02b26dbbc775b47d0b934">get_constraint_targets</a>) {
<a name="l00400"></a>00400                         cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a25b05ed0f4c02b26dbbc775b47d0b934">get_constraint_targets</a>(con, &amp;targets);
<a name="l00401"></a>00401                         
<a name="l00402"></a>00402                         <span class="keywordflow">for</span> (ct= targets.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ct; ct= ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a5ea4a1b1fa4761a30cb66c75a8ac9054">next</a>) {
<a name="l00403"></a>00403                             <span class="keywordflow">if</span> (ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a0f75cb18129bdb2c0aee21ac528b8f5e">tar</a> &amp;&amp; ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a0f75cb18129bdb2c0aee21ac528b8f5e">tar</a> != ob) {
<a name="l00404"></a>00404                                 <span class="comment">// fprintf(stderr,&quot;armature %s target :%s\n&quot;, ob-&gt;id.name, target-&gt;id.name);</span>
<a name="l00405"></a>00405                                 node3 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a0f75cb18129bdb2c0aee21ac528b8f5e">tar</a>);
<a name="l00406"></a>00406                                 
<a name="l00407"></a>00407                                 <span class="keywordflow">if</span> (ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#ab1f6a09b2a30f6f55449e3e5871fafed">subtarget</a>[0]) {
<a name="l00408"></a>00408                                     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag,node3,node, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aab7d56d2d4b14b85da29c700d3e4cd1c">DAG_RL_OB_DATA</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac50a2e08e7ef469574148c63cf8cf07c">DAG_RL_DATA_DATA</a>, cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#ad399c9fcd89f712d7663a55faeb377dc">name</a>);
<a name="l00409"></a>00409                                     <span class="keywordflow">if</span> (ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a0f75cb18129bdb2c0aee21ac528b8f5e">tar</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>)
<a name="l00410"></a>00410                                         node3-&gt;<a class="code" href="../../d5/d07/structDagNode.html#abe4b783b5053c701adb7409a53ea85fa">customdata_mask</a> |= <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a3e9147e0f8c7f6d5bc8afb9989edee12">CD_MASK_MDEFORMVERT</a>;
<a name="l00411"></a>00411                                 }
<a name="l00412"></a>00412                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5adb7c70567fff24da35d0186e600ee38b">CONSTRAINT_TYPE_FOLLOWPATH</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5ac424899ac5c4e35a6d54f817f5756e5f">CONSTRAINT_TYPE_CLAMPTO</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a71924f8e323782bf927aef8aaab46e97">CONSTRAINT_TYPE_SPLINEIK</a>))   
<a name="l00413"></a>00413                                     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag,node3,node, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac50a2e08e7ef469574148c63cf8cf07c">DAG_RL_DATA_DATA</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aab7d56d2d4b14b85da29c700d3e4cd1c">DAG_RL_OB_DATA</a>, cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#ad399c9fcd89f712d7663a55faeb377dc">name</a>);
<a name="l00414"></a>00414                                 <span class="keywordflow">else</span>
<a name="l00415"></a>00415                                     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag,node3,node, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aab7d56d2d4b14b85da29c700d3e4cd1c">DAG_RL_OB_DATA</a>, cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#ad399c9fcd89f712d7663a55faeb377dc">name</a>);
<a name="l00416"></a>00416                             }
<a name="l00417"></a>00417                         }
<a name="l00418"></a>00418                         
<a name="l00419"></a>00419                         <span class="keywordflow">if</span> (cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a5afd4078d269cd49108678e99cca935f">flush_constraint_targets</a>)
<a name="l00420"></a>00420                             cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a5afd4078d269cd49108678e99cca935f">flush_constraint_targets</a>(con, &amp;targets, 1);
<a name="l00421"></a>00421                     }
<a name="l00422"></a>00422                     
<a name="l00423"></a>00423                 }
<a name="l00424"></a>00424             }
<a name="l00425"></a>00425         }
<a name="l00426"></a>00426     }
<a name="l00427"></a>00427     
<a name="l00428"></a>00428     <span class="comment">/* driver dependencies, nla modifiers */</span>
<a name="l00429"></a>00429 <span class="preprocessor">#if 0 // XXX old animation system</span>
<a name="l00430"></a>00430 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (ob-&gt;nlastrips.first) {
<a name="l00431"></a>00431         <a class="code" href="../../d5/d84/structbActionStrip.html">bActionStrip</a> *strip;
<a name="l00432"></a>00432         <a class="code" href="../../da/d47/structbActionChannel.html">bActionChannel</a> *chan;
<a name="l00433"></a>00433         <span class="keywordflow">for</span> (strip= ob-&gt;nlastrips.first; strip; strip= strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a4db006cf84d35eed981ef557bdd9f126">next</a>) {
<a name="l00434"></a>00434             <span class="keywordflow">if</span> (strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#aa16f01023db7f917b8a9178ee7cf0268">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l00435"></a>00435                 <a class="code" href="../../d6/d55/structbActionModifier.html">bActionModifier</a> *amod;
<a name="l00436"></a>00436                 <span class="keywordflow">for</span> (amod= strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#aa16f01023db7f917b8a9178ee7cf0268">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; amod; amod= amod-&gt;<a class="code" href="../../d6/d55/structbActionModifier.html#aa0e3dcac1921d79fe6c3512b9cc9a762">next</a>) {
<a name="l00437"></a>00437                     <span class="keywordflow">if</span> (amod-&gt;<a class="code" href="../../d6/d55/structbActionModifier.html#a56596d41dbe4b9ba69a7aabd9fcbca31">ob</a>) {
<a name="l00438"></a>00438                         node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, amod-&gt;<a class="code" href="../../d6/d55/structbActionModifier.html#a56596d41dbe4b9ba69a7aabd9fcbca31">ob</a>);
<a name="l00439"></a>00439                         <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node2, node, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac50a2e08e7ef469574148c63cf8cf07c">DAG_RL_DATA_DATA</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aab7d56d2d4b14b85da29c700d3e4cd1c">DAG_RL_OB_DATA</a>, <span class="stringliteral">&quot;NLA Strip Modifier&quot;</span>);
<a name="l00440"></a>00440                     }
<a name="l00441"></a>00441                 }
<a name="l00442"></a>00442             }
<a name="l00443"></a>00443         }
<a name="l00444"></a>00444     }
<a name="l00445"></a>00445 <span class="preprocessor">#endif // XXX old animation system</span>
<a name="l00446"></a>00446 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>)
<a name="l00447"></a>00447         <a class="code" href="../../dc/d2f/depsgraph_8c.html#a2e17f471f1e6b0fe86afdd3ddaa9fbcf">dag_add_driver_relation</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>, dag, node, (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>)); <span class="comment">// XXX isdata arg here doesn&#39;t give an accurate picture of situation</span>
<a name="l00448"></a>00448         
<a name="l00449"></a>00449     key= <a class="code" href="../../d5/d17/BKE__key_8h.html#a8f07b4f039eb391df3c5b429d2f79e62">ob_get_key</a>(ob);
<a name="l00450"></a>00450     <span class="keywordflow">if</span> (key &amp;&amp; key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a9e6219935b7f5b387610055b81705180">adt</a>)
<a name="l00451"></a>00451         <a class="code" href="../../dc/d2f/depsgraph_8c.html#a2e17f471f1e6b0fe86afdd3ddaa9fbcf">dag_add_driver_relation</a>(key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a9e6219935b7f5b387610055b81705180">adt</a>, dag, node, 1);
<a name="l00452"></a>00452 
<a name="l00453"></a>00453     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l00454"></a>00454         <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l00455"></a>00455         
<a name="l00456"></a>00456         <span class="keywordflow">for</span> (md=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md=md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>) {
<a name="l00457"></a>00457             <a class="code" href="../../db/dc5/structModifierTypeInfo.html">ModifierTypeInfo</a> *<a class="code" href="../../d8/d43/MT__random_8cpp.html#a0893639c022032e006e5b13378f7b4b2">mti</a> = <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#a837a63cd144446bec663f3a02e0ad397">modifierType_getInfo</a>(md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a06b3bfe88f9205bc474fa4a267732b8e">type</a>);
<a name="l00458"></a>00458             
<a name="l00459"></a>00459             <span class="keywordflow">if</span> (mti-&gt;<a class="code" href="../../db/dc5/structModifierTypeInfo.html#a3badd058e22f257f622a67d883633a75">updateDepgraph</a>) mti-&gt;<a class="code" href="../../db/dc5/structModifierTypeInfo.html#a3badd058e22f257f622a67d883633a75">updateDepgraph</a>(md, dag, scene, ob, node);
<a name="l00460"></a>00460         }
<a name="l00461"></a>00461     }
<a name="l00462"></a>00462     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>) {
<a name="l00463"></a>00463         node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag,ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>);
<a name="l00464"></a>00464         
<a name="l00465"></a>00465         <span class="keywordflow">switch</span>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0ed2df4a386ce2b22084aaaa701d73ff">partype</a>) {
<a name="l00466"></a>00466             <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#af88b95b0ce3123f10e88d858cbb50f05">PARSKEL</a>:
<a name="l00467"></a>00467                 <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag,node2,node,<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac50a2e08e7ef469574148c63cf8cf07c">DAG_RL_DATA_DATA</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>, <span class="stringliteral">&quot;Parent&quot;</span>);
<a name="l00468"></a>00468                 <span class="keywordflow">break</span>;
<a name="l00469"></a>00469             <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ab5e0afc22712baa43c3b6323b1bcc87d">PARVERT1</a>: <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a3744a723cccf1a08793e8f25603417c3">PARVERT3</a>:
<a name="l00470"></a>00470                 <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag,node2,node,<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a5e80e3c329f9c5844e8ce3bea32718b5">DAG_RL_DATA_OB</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>, <span class="stringliteral">&quot;Vertex Parent&quot;</span>);
<a name="l00471"></a>00471                 node2-&gt;<a class="code" href="../../d5/d07/structDagNode.html#abe4b783b5053c701adb7409a53ea85fa">customdata_mask</a> |= <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a352c6860702ca1aeea5767d7c6368147">CD_MASK_ORIGINDEX</a>;
<a name="l00472"></a>00472                 <span class="keywordflow">break</span>;
<a name="l00473"></a>00473             <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aa660de9e3216076e99f66fac72274ea0">PARBONE</a>:
<a name="l00474"></a>00474                 <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag,node2,node,<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a5e80e3c329f9c5844e8ce3bea32718b5">DAG_RL_DATA_OB</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>, <span class="stringliteral">&quot;Bone Parent&quot;</span>);
<a name="l00475"></a>00475                 <span class="keywordflow">break</span>;
<a name="l00476"></a>00476             <span class="keywordflow">default</span>:
<a name="l00477"></a>00477                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a648672abc238f500c884f10b9416cb27">OB_LATTICE</a>) 
<a name="l00478"></a>00478                     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag,node2,node,<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac50a2e08e7ef469574148c63cf8cf07c">DAG_RL_DATA_DATA</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>, <span class="stringliteral">&quot;Lattice Parent&quot;</span>);
<a name="l00479"></a>00479                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>) {
<a name="l00480"></a>00480                     <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00481"></a>00481                     <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#abd5b5dcd85b78434895b347aea37d841">flag</a> &amp; <a class="code" href="../../d6/d88/DNA__curve__types_8h.html#ae59d98d3a2c7e6fddf4aa7fff72bcf88">CU_PATH</a>) 
<a name="l00482"></a>00482                         <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag,node2,node,<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a5e80e3c329f9c5844e8ce3bea32718b5">DAG_RL_DATA_OB</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>, <span class="stringliteral">&quot;Curve Parent&quot;</span>);
<a name="l00483"></a>00483                     <span class="keywordflow">else</span>
<a name="l00484"></a>00484                         <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag,node2,node,<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>, <span class="stringliteral">&quot;Curve Parent&quot;</span>);
<a name="l00485"></a>00485                 }
<a name="l00486"></a>00486                 <span class="keywordflow">else</span>
<a name="l00487"></a>00487                     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag,node2,node,<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>, <span class="stringliteral">&quot;Parent&quot;</span>);
<a name="l00488"></a>00488         }
<a name="l00489"></a>00489         <span class="comment">/* exception case: parent is duplivert */</span>
<a name="l00490"></a>00490         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a046d883c32490b5c5ca4c5e7b6504e35">OB_MBALL</a> &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a1091cd84d4d7227ab41b167e84be3065">transflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8f68dd8367bd3650458515426ac8f1ff">OB_DUPLIVERTS</a>)) {
<a name="l00491"></a>00491             <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node2, node, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac50a2e08e7ef469574148c63cf8cf07c">DAG_RL_DATA_DATA</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>, <span class="stringliteral">&quot;Duplivert&quot;</span>);
<a name="l00492"></a>00492         }
<a name="l00493"></a>00493         
<a name="l00494"></a>00494         addtoroot = 0;
<a name="l00495"></a>00495     }
<a name="l00496"></a>00496     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a54e05d3611058fa986bd69541f665e23">proxy</a>) {
<a name="l00497"></a>00497         node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a54e05d3611058fa986bd69541f665e23">proxy</a>);
<a name="l00498"></a>00498         <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node, node2, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac50a2e08e7ef469574148c63cf8cf07c">DAG_RL_DATA_DATA</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>, <span class="stringliteral">&quot;Proxy&quot;</span>);
<a name="l00499"></a>00499         <span class="comment">/* inverted relation, so addtoroot shouldn&#39;t be set to zero */</span>
<a name="l00500"></a>00500     }
<a name="l00501"></a>00501     
<a name="l00502"></a>00502     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1091cd84d4d7227ab41b167e84be3065">transflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a09b56b47e42a59a4266c995ded542ea6">OB_DUPLI</a>) {
<a name="l00503"></a>00503         <span class="keywordflow">if</span> ((ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1091cd84d4d7227ab41b167e84be3065">transflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#aa1086c43316c4611714f7e459356873e">OB_DUPLIGROUP</a>) &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a3f0daef111a437533e48f6209429b49f">dup_group</a>) {
<a name="l00504"></a>00504             <a class="code" href="../../d3/d3b/structGroupObject.html">GroupObject</a> *go;
<a name="l00505"></a>00505             <span class="keywordflow">for</span> (go= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a3f0daef111a437533e48f6209429b49f">dup_group</a>-&gt;<a class="code" href="../../d4/d91/structGroup.html#ad757bf69b6fd15b1d4e0980089d13be1">gobject</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; go; go= go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#a81e7437ba90ec95c5fbb96e17e6a203d">next</a>) {
<a name="l00506"></a>00506                 <span class="keywordflow">if</span> (go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>) {
<a name="l00507"></a>00507                     node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>);
<a name="l00508"></a>00508                     <span class="comment">/* node2 changes node1, this keeps animations updated in groups?? not logical? */</span>
<a name="l00509"></a>00509                     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node2, node, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>, <span class="stringliteral">&quot;Dupligroup&quot;</span>);
<a name="l00510"></a>00510                 }
<a name="l00511"></a>00511             }
<a name="l00512"></a>00512         }
<a name="l00513"></a>00513     }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515     <span class="comment">/* softbody collision  */</span>
<a name="l00516"></a>00516     <span class="keywordflow">if</span> ((ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>) || (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>) || (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a648672abc238f500c884f10b9416cb27">OB_LATTICE</a>)) {
<a name="l00517"></a>00517         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d0f/BKE__modifier_8h.html#a8c0e71990267d150a6bcde62e9652312">modifiers_isSoftbodyEnabled</a>(ob) || <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#a7407c8e9967851ed83f5c4b8c4d48e19">modifiers_isClothEnabled</a>(ob) || ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)
<a name="l00518"></a>00518             <a class="code" href="../../dc/d2f/depsgraph_8c.html#a27419667ecebc8313f4f2fe948ce4f73">dag_add_collision_field_relation</a>(dag, scene, ob, node); <span class="comment">/* TODO: use effectorweight-&gt;group */</span>
<a name="l00519"></a>00519     }
<a name="l00520"></a>00520     
<a name="l00521"></a>00521     <span class="comment">/* object data drivers */</span>
<a name="l00522"></a>00522     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>) {
<a name="l00523"></a>00523         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l00524"></a>00524         <span class="keywordflow">if</span> (adt)
<a name="l00525"></a>00525             <a class="code" href="../../dc/d2f/depsgraph_8c.html#a2e17f471f1e6b0fe86afdd3ddaa9fbcf">dag_add_driver_relation</a>(adt, dag, node, 1);
<a name="l00526"></a>00526     }
<a name="l00527"></a>00527     
<a name="l00528"></a>00528     <span class="comment">/* object type/data relationships */</span>
<a name="l00529"></a>00529     <span class="keywordflow">switch</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>) {
<a name="l00530"></a>00530         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#afd7fa4376c670f245aeed7a7116c7005">OB_CAMERA</a>:
<a name="l00531"></a>00531         {
<a name="l00532"></a>00532             <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *cam = (<a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00533"></a>00533             
<a name="l00534"></a>00534             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a93506a794b0a75f3c16e4740c20bb3f5">dof_ob</a>) {
<a name="l00535"></a>00535                 node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a93506a794b0a75f3c16e4740c20bb3f5">dof_ob</a>);
<a name="l00536"></a>00536                 <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag,node2,node,<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>, <span class="stringliteral">&quot;Camera DoF&quot;</span>);
<a name="l00537"></a>00537             }
<a name="l00538"></a>00538         }
<a name="l00539"></a>00539             <span class="keywordflow">break</span>;
<a name="l00540"></a>00540         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a046d883c32490b5c5ca4c5e7b6504e35">OB_MBALL</a>: 
<a name="l00541"></a>00541         {
<a name="l00542"></a>00542             <a class="code" href="../../de/de7/structObject.html">Object</a> *mom= <a class="code" href="../../df/dae/BKE__mball_8h.html#acd6cd7889caaf039ef167e52af35639a" title="This function finds basic MetaBall.">find_basis_mball</a>(scene, ob);
<a name="l00543"></a>00543             
<a name="l00544"></a>00544             <span class="keywordflow">if</span> (mom!=ob) {
<a name="l00545"></a>00545                 node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, mom);
<a name="l00546"></a>00546                 <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag,node,node2,<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac50a2e08e7ef469574148c63cf8cf07c">DAG_RL_DATA_DATA</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aab7d56d2d4b14b85da29c700d3e4cd1c">DAG_RL_OB_DATA</a>, <span class="stringliteral">&quot;Metaball&quot;</span>);  <span class="comment">// mom depends on children!</span>
<a name="l00547"></a>00547             }
<a name="l00548"></a>00548         }
<a name="l00549"></a>00549             <span class="keywordflow">break</span>;
<a name="l00550"></a>00550         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>:
<a name="l00551"></a>00551         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1a94162b6fc469957966a01d41ff71d6">OB_FONT</a>:
<a name="l00552"></a>00552         {
<a name="l00553"></a>00553             <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00554"></a>00554             
<a name="l00555"></a>00555             <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0051539d4e4be6831fed5babb371b19b">bevobj</a>) {
<a name="l00556"></a>00556                 node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a0051539d4e4be6831fed5babb371b19b">bevobj</a>);
<a name="l00557"></a>00557                 <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag,node2,node,<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac50a2e08e7ef469574148c63cf8cf07c">DAG_RL_DATA_DATA</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aab7d56d2d4b14b85da29c700d3e4cd1c">DAG_RL_OB_DATA</a>, <span class="stringliteral">&quot;Curve Bevel&quot;</span>);
<a name="l00558"></a>00558             }
<a name="l00559"></a>00559             <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#aee5423fad7444492028435713c64be0f">taperobj</a>) {
<a name="l00560"></a>00560                 node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#aee5423fad7444492028435713c64be0f">taperobj</a>);
<a name="l00561"></a>00561                 <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag,node2,node,<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac50a2e08e7ef469574148c63cf8cf07c">DAG_RL_DATA_DATA</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aab7d56d2d4b14b85da29c700d3e4cd1c">DAG_RL_OB_DATA</a>, <span class="stringliteral">&quot;Curve Taper&quot;</span>);
<a name="l00562"></a>00562             }
<a name="l00563"></a>00563             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1a94162b6fc469957966a01d41ff71d6">OB_FONT</a>) {
<a name="l00564"></a>00564                 <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#aab9f61871625a95c78c288429b4b6d74">textoncurve</a>) {
<a name="l00565"></a>00565                     node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, cu-&gt;<a class="code" href="../../da/d10/structCurve.html#aab9f61871625a95c78c288429b4b6d74">textoncurve</a>);
<a name="l00566"></a>00566                     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag,node2,node,<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac50a2e08e7ef469574148c63cf8cf07c">DAG_RL_DATA_DATA</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aab7d56d2d4b14b85da29c700d3e4cd1c">DAG_RL_OB_DATA</a>, <span class="stringliteral">&quot;Texture On Curve&quot;</span>);
<a name="l00567"></a>00567                 }
<a name="l00568"></a>00568             }
<a name="l00569"></a>00569         }
<a name="l00570"></a>00570             <span class="keywordflow">break</span>;
<a name="l00571"></a>00571     }
<a name="l00572"></a>00572     
<a name="l00573"></a>00573     <span class="comment">/* particles */</span>
<a name="l00574"></a>00574     psys= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00575"></a>00575     <span class="keywordflow">if</span> (psys) {
<a name="l00576"></a>00576         <a class="code" href="../../d3/d3b/structGroupObject.html">GroupObject</a> *go;
<a name="l00577"></a>00577 
<a name="l00578"></a>00578         <span class="keywordflow">for</span> (; psys; psys=psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a734228c70c56227c6f7a29145a5f5b57">next</a>) {
<a name="l00579"></a>00579             <a class="code" href="../../d5/d08/structBoidRule.html">BoidRule</a> *rule = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00580"></a>00580             <a class="code" href="../../db/dfa/structBoidState.html">BoidState</a> *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#a1ac338c8291400e2f2785ef2cb7a5458">state</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00581"></a>00581             <a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *part= psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>;
<a name="l00582"></a>00582             <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *effectors = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00583"></a>00583             <a class="code" href="../../d6/d53/structEffectorCache.html">EffectorCache</a> *eff;
<a name="l00584"></a>00584 
<a name="l00585"></a>00585             <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node, node, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aab7d56d2d4b14b85da29c700d3e4cd1c">DAG_RL_OB_DATA</a>, <span class="stringliteral">&quot;Particle-Object Relation&quot;</span>);
<a name="l00586"></a>00586 
<a name="l00587"></a>00587             <span class="keywordflow">if</span> (!<a class="code" href="../../db/dca/BKE__particle_8h.html#ae1ec21bf7aea2fdbe47e71514b97d919">psys_check_enabled</a>(ob, psys))
<a name="l00588"></a>00588                 <span class="keywordflow">continue</span>;
<a name="l00589"></a>00589 
<a name="l00590"></a>00590             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a4868871c1c1ba91bd42b97081be0f76a">phystype</a>,<a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a04539ab17dab33b4e345164c2831a4f8">PART_PHYS_KEYED</a>,<a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a632b70a25b43cdad1aad17d2cd9a2c53">PART_PHYS_BOIDS</a>)) {
<a name="l00591"></a>00591                 <a class="code" href="../../df/db9/structParticleTarget.html">ParticleTarget</a> *pt = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a37c37da2c9bb6301d50a6133d00b6b75">targets</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00592"></a>00592 
<a name="l00593"></a>00593                 <span class="keywordflow">for</span> (; pt; pt=pt-&gt;<a class="code" href="../../df/db9/structParticleTarget.html#a6643a6f60f33e21a80a82e6140ddcbcc">next</a>) {
<a name="l00594"></a>00594                     <span class="keywordflow">if</span> (pt-&gt;<a class="code" href="../../df/db9/structParticleTarget.html#a0b60fbd359436e5c221a0f4a719defd4">ob</a> &amp;&amp; <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;pt-&gt;<a class="code" href="../../df/db9/structParticleTarget.html#a0b60fbd359436e5c221a0f4a719defd4">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>, pt-&gt;<a class="code" href="../../df/db9/structParticleTarget.html#a9ca544004c18942653f7d48882ca03f4">psys</a>-1)) {
<a name="l00595"></a>00595                         node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, pt-&gt;<a class="code" href="../../df/db9/structParticleTarget.html#a0b60fbd359436e5c221a0f4a719defd4">ob</a>);
<a name="l00596"></a>00596                         <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node2, node, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac50a2e08e7ef469574148c63cf8cf07c">DAG_RL_DATA_DATA</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aab7d56d2d4b14b85da29c700d3e4cd1c">DAG_RL_OB_DATA</a>, <span class="stringliteral">&quot;Particle Targets&quot;</span>);
<a name="l00597"></a>00597                     }
<a name="l00598"></a>00598                }
<a name="l00599"></a>00599             }
<a name="l00600"></a>00600 
<a name="l00601"></a>00601             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a1a44c6ba58be14e0084b4f71c87d66a2">ren_as</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a2506fdc9f159583f812c900402c5ec54">PART_DRAW_OB</a> &amp;&amp; part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7c2985d43ca884158ee831018e589d36">dup_ob</a>) {
<a name="l00602"></a>00602                 node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7c2985d43ca884158ee831018e589d36">dup_ob</a>);
<a name="l00603"></a>00603                 <span class="comment">/* note that this relation actually runs in the wrong direction, the problem</span>
<a name="l00604"></a>00604 <span class="comment">                 * is that dupli system all have this (due to parenting), and the render</span>
<a name="l00605"></a>00605 <span class="comment">                 * engine instancing assumes particular ordering of objects in list */</span>
<a name="l00606"></a>00606                 <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node, node2, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>, <span class="stringliteral">&quot;Particle Object Visualisation&quot;</span>);
<a name="l00607"></a>00607                 <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7c2985d43ca884158ee831018e589d36">dup_ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a046d883c32490b5c5ca4c5e7b6504e35">OB_MBALL</a>)
<a name="l00608"></a>00608                     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node2, node, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac50a2e08e7ef469574148c63cf8cf07c">DAG_RL_DATA_DATA</a>, <span class="stringliteral">&quot;Particle Object Visualisation&quot;</span>);
<a name="l00609"></a>00609             }
<a name="l00610"></a>00610 
<a name="l00611"></a>00611             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a1a44c6ba58be14e0084b4f71c87d66a2">ren_as</a> == <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ababc8a40b78ea25bfdb9cd7b85c83f19">PART_DRAW_GR</a> &amp;&amp; part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#af148cd19be57f2825db82cb9c453e682">dup_group</a>) {
<a name="l00612"></a>00612                 <span class="keywordflow">for</span> (go=part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#af148cd19be57f2825db82cb9c453e682">dup_group</a>-&gt;<a class="code" href="../../d4/d91/structGroup.html#ad757bf69b6fd15b1d4e0980089d13be1">gobject</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; go; go=go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#a81e7437ba90ec95c5fbb96e17e6a203d">next</a>) {
<a name="l00613"></a>00613                     node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>);
<a name="l00614"></a>00614                     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node2, node, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>, <span class="stringliteral">&quot;Particle Group Visualisation&quot;</span>);
<a name="l00615"></a>00615                 }
<a name="l00616"></a>00616             }
<a name="l00617"></a>00617 
<a name="l00618"></a>00618             effectors = <a class="code" href="../../dc/d65/BKE__effect_8h.html#a6ebcd51628cbb20d3556d779e0b506fe">pdInitEffectors</a>(scene, ob, psys, part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a82846291d135c6395249f60253e2ce9d">effector_weights</a>);
<a name="l00619"></a>00619 
<a name="l00620"></a>00620             <span class="keywordflow">if</span> (effectors) <span class="keywordflow">for</span> (eff = effectors-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; eff; eff=eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#adb86179b9e326c4785cc0023860f828b">next</a>) {
<a name="l00621"></a>00621                 <span class="keywordflow">if</span> (eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#a2b8136e4412ed716fabc2f80e00a0d2d">psys</a>) {
<a name="l00622"></a>00622                     node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, eff-&gt;<a class="code" href="../../d6/d53/structEffectorCache.html#af7ed510020fcd671de2f0492e00f24c8">ob</a>);
<a name="l00623"></a>00623                     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node2, node, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac50a2e08e7ef469574148c63cf8cf07c">DAG_RL_DATA_DATA</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aab7d56d2d4b14b85da29c700d3e4cd1c">DAG_RL_OB_DATA</a>, <span class="stringliteral">&quot;Particle Field&quot;</span>);
<a name="l00624"></a>00624                 }
<a name="l00625"></a>00625             }
<a name="l00626"></a>00626 
<a name="l00627"></a>00627             <a class="code" href="../../dc/d65/BKE__effect_8h.html#a7da5e7ad353e025440f05a9adbd7032d">pdEndEffectors</a>(&amp;effectors);
<a name="l00628"></a>00628 
<a name="l00629"></a>00629             <span class="keywordflow">if</span> (part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7f6ac08c9c2f17012eb0b626b91c040f">boids</a>) {
<a name="l00630"></a>00630                 <span class="keywordflow">for</span> (state = part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a7f6ac08c9c2f17012eb0b626b91c040f">boids</a>-&gt;<a class="code" href="../../dd/d94/structBoidSettings.html#a632b0e4786d070f07183c7659cac4444">states</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; state; state=state-&gt;<a class="code" href="../../db/dfa/structBoidState.html#ae6d686752198cc7b700f9304cd6d3235">next</a>) {
<a name="l00631"></a>00631                     <span class="keywordflow">for</span> (rule = state-&gt;<a class="code" href="../../db/dfa/structBoidState.html#ad8d710f50d63b84e59b358315bc9fa92">rules</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; rule; rule=rule-&gt;<a class="code" href="../../d5/d08/structBoidRule.html#a707cfdd3651380709dfae04c2b06e76d">next</a>) {
<a name="l00632"></a>00632                         <a class="code" href="../../de/de7/structObject.html">Object</a> *ruleob = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00633"></a>00633                         <span class="keywordflow">if</span> (rule-&gt;<a class="code" href="../../d5/d08/structBoidRule.html#a6859c7ccbdf3d1f77e1542a4afa2e1fa">type</a>==<a class="code" href="../../d8/dbb/DNA__boid__types_8h.html#a186fa849c8c3a6efa9ca9d740700efe9ab006cc1f787b3169a73527d00fd64d9d">eBoidRuleType_Avoid</a>)
<a name="l00634"></a>00634                             ruleob = ((<a class="code" href="../../d7/dec/structBoidRuleGoalAvoid.html">BoidRuleGoalAvoid</a>*)rule)-&gt;ob;
<a name="l00635"></a>00635                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rule-&gt;<a class="code" href="../../d5/d08/structBoidRule.html#a6859c7ccbdf3d1f77e1542a4afa2e1fa">type</a>==<a class="code" href="../../d8/dbb/DNA__boid__types_8h.html#a186fa849c8c3a6efa9ca9d740700efe9ad43d583c8f8b59c3bfbed5abcb766d53">eBoidRuleType_FollowLeader</a>)
<a name="l00636"></a>00636                             ruleob = ((<a class="code" href="../../da/d86/structBoidRuleFollowLeader.html">BoidRuleFollowLeader</a>*)rule)-&gt;ob;
<a name="l00637"></a>00637 
<a name="l00638"></a>00638                         <span class="keywordflow">if</span> (ruleob) {
<a name="l00639"></a>00639                             node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, ruleob);
<a name="l00640"></a>00640                             <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node2, node, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aab7d56d2d4b14b85da29c700d3e4cd1c">DAG_RL_OB_DATA</a>, <span class="stringliteral">&quot;Boid Rule&quot;</span>);
<a name="l00641"></a>00641                         }
<a name="l00642"></a>00642                     }
<a name="l00643"></a>00643                 }
<a name="l00644"></a>00644             }
<a name="l00645"></a>00645         }
<a name="l00646"></a>00646     }
<a name="l00647"></a>00647     
<a name="l00648"></a>00648     <span class="comment">/* object constraints */</span>
<a name="l00649"></a>00649     <span class="keywordflow">for</span> (con = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; con; con=con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l00650"></a>00650         <a class="code" href="../../dc/ded/structbConstraintTypeInfo.html">bConstraintTypeInfo</a> *cti= <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#a8eac21e0105e441026a6b7cd7d78030d">constraint_get_typeinfo</a>(con);
<a name="l00651"></a>00651         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> targets = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00652"></a>00652         <a class="code" href="../../d5/d78/structbConstraintTarget.html">bConstraintTarget</a> *ct;
<a name="l00653"></a>00653         
<a name="l00654"></a>00654         <span class="keywordflow">if</span> (!cti)
<a name="l00655"></a>00655             <span class="keywordflow">continue</span>;
<a name="l00656"></a>00656 
<a name="l00657"></a>00657         <span class="comment">/* special case for camera tracking -- it doesn&#39;t use targets to define relations */</span>
<a name="l00658"></a>00658         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#af4d4e80ea9c413dd7df1b5895ed439f9">type</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a3119d40b7e938fe99cbc91a9c75bdf9e">CONSTRAINT_TYPE_FOLLOWTRACK</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a6add20c4d241c5a886ce8b6b86f363cd">CONSTRAINT_TYPE_CAMERASOLVER</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a3321fd3e52140da450d8f6725b3678af">CONSTRAINT_TYPE_OBJECTSOLVER</a>)) {
<a name="l00659"></a>00659             <span class="keywordtype">int</span> depends_on_camera= 0;
<a name="l00660"></a>00660 
<a name="l00661"></a>00661             <span class="keywordflow">if</span> (cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#af4d4e80ea9c413dd7df1b5895ed439f9">type</a>==<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a3119d40b7e938fe99cbc91a9c75bdf9e">CONSTRAINT_TYPE_FOLLOWTRACK</a>) {
<a name="l00662"></a>00662                 <a class="code" href="../../d5/de6/structbFollowTrackConstraint.html">bFollowTrackConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= (<a class="code" href="../../d5/de6/structbFollowTrackConstraint.html">bFollowTrackConstraint</a> *)con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l00663"></a>00663 
<a name="l00664"></a>00664                 <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> ((data-&gt;<a class="code" href="../../d5/de6/structbFollowTrackConstraint.html#a3eda8a26a14814fca95654254ebda0a7">clip</a> || data-&gt;<a class="code" href="../../d5/de6/structbFollowTrackConstraint.html#aa350d31beb147b9d6ecb3dfff9c9c792">flag</a>&amp;<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a37fbe783aeb8386f537b3eee31e0a921abba3a82b913e543255c3867a5d57b2e3">FOLLOWTRACK_ACTIVECLIP</a>) &amp;&amp; data-&gt;<a class="code" href="../../d5/de6/structbFollowTrackConstraint.html#a177eee43aa9a6e0e8c6fda1b1c443f5e">track</a>[0])
<a name="l00665"></a>00665                     depends_on_camera= 1;
<a name="l00666"></a>00666 
<a name="l00667"></a>00667                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d5/de6/structbFollowTrackConstraint.html#a4914052eaf60dd5a38de92aed7aad0a0">depth_ob</a>) {
<a name="l00668"></a>00668                     node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, data-&gt;<a class="code" href="../../d5/de6/structbFollowTrackConstraint.html#a4914052eaf60dd5a38de92aed7aad0a0">depth_ob</a>);
<a name="l00669"></a>00669                     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node2, node, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a5e80e3c329f9c5844e8ce3bea32718b5">DAG_RL_DATA_OB</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>, cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#ad399c9fcd89f712d7663a55faeb377dc">name</a>);
<a name="l00670"></a>00670                 }
<a name="l00671"></a>00671             }
<a name="l00672"></a>00672             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#af4d4e80ea9c413dd7df1b5895ed439f9">type</a>==<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a3321fd3e52140da450d8f6725b3678af">CONSTRAINT_TYPE_OBJECTSOLVER</a>)
<a name="l00673"></a>00673                 depends_on_camera= 1;
<a name="l00674"></a>00674 
<a name="l00675"></a>00675             <span class="keywordflow">if</span> (depends_on_camera &amp;&amp; scene-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>) {
<a name="l00676"></a>00676                 node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>);
<a name="l00677"></a>00677                 <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node2, node, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a5e80e3c329f9c5844e8ce3bea32718b5">DAG_RL_DATA_OB</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>, cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#ad399c9fcd89f712d7663a55faeb377dc">name</a>);
<a name="l00678"></a>00678             }
<a name="l00679"></a>00679 
<a name="l00680"></a>00680             <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag,scenenode,node,<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a1e7024f47851c1885498cfae69f36cae">DAG_RL_SCENE</a>, <span class="stringliteral">&quot;Scene Relation&quot;</span>);
<a name="l00681"></a>00681             addtoroot = 0;
<a name="l00682"></a>00682         }
<a name="l00683"></a>00683         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a25b05ed0f4c02b26dbbc775b47d0b934">get_constraint_targets</a>) {
<a name="l00684"></a>00684             cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a25b05ed0f4c02b26dbbc775b47d0b934">get_constraint_targets</a>(con, &amp;targets);
<a name="l00685"></a>00685             
<a name="l00686"></a>00686             <span class="keywordflow">for</span> (ct= targets.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ct; ct= ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a5ea4a1b1fa4761a30cb66c75a8ac9054">next</a>) {
<a name="l00687"></a>00687                 <a class="code" href="../../de/de7/structObject.html">Object</a> *obt;
<a name="l00688"></a>00688                 
<a name="l00689"></a>00689                 <span class="keywordflow">if</span> (ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a0f75cb18129bdb2c0aee21ac528b8f5e">tar</a>)
<a name="l00690"></a>00690                     obt= ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a0f75cb18129bdb2c0aee21ac528b8f5e">tar</a>;
<a name="l00691"></a>00691                 <span class="keywordflow">else</span>
<a name="l00692"></a>00692                     <span class="keywordflow">continue</span>;
<a name="l00693"></a>00693                 
<a name="l00694"></a>00694                 node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, obt);
<a name="l00695"></a>00695                 <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5adb7c70567fff24da35d0186e600ee38b">CONSTRAINT_TYPE_FOLLOWPATH</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5ac424899ac5c4e35a6d54f817f5756e5f">CONSTRAINT_TYPE_CLAMPTO</a>))
<a name="l00696"></a>00696                     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node2, node, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a5e80e3c329f9c5844e8ce3bea32718b5">DAG_RL_DATA_OB</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>, cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#ad399c9fcd89f712d7663a55faeb377dc">name</a>);
<a name="l00697"></a>00697                 <span class="keywordflow">else</span> {
<a name="l00698"></a>00698                     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(obt-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a648672abc238f500c884f10b9416cb27">OB_LATTICE</a>) &amp;&amp; (ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#ab1f6a09b2a30f6f55449e3e5871fafed">subtarget</a>[0])) {
<a name="l00699"></a>00699                         <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node2, node, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a5e80e3c329f9c5844e8ce3bea32718b5">DAG_RL_DATA_OB</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>, cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#ad399c9fcd89f712d7663a55faeb377dc">name</a>);
<a name="l00700"></a>00700                         <span class="keywordflow">if</span> (obt-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>)
<a name="l00701"></a>00701                             node2-&gt;<a class="code" href="../../d5/d07/structDagNode.html#abe4b783b5053c701adb7409a53ea85fa">customdata_mask</a> |= <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a3e9147e0f8c7f6d5bc8afb9989edee12">CD_MASK_MDEFORMVERT</a>;
<a name="l00702"></a>00702                     }
<a name="l00703"></a>00703                     <span class="keywordflow">else</span>
<a name="l00704"></a>00704                         <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node2, node, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>, cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#ad399c9fcd89f712d7663a55faeb377dc">name</a>);
<a name="l00705"></a>00705                 }
<a name="l00706"></a>00706                 addtoroot = 0;
<a name="l00707"></a>00707             }
<a name="l00708"></a>00708             
<a name="l00709"></a>00709             <span class="keywordflow">if</span> (cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a5afd4078d269cd49108678e99cca935f">flush_constraint_targets</a>)
<a name="l00710"></a>00710                 cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a5afd4078d269cd49108678e99cca935f">flush_constraint_targets</a>(con, &amp;targets, 1);
<a name="l00711"></a>00711         }
<a name="l00712"></a>00712     }
<a name="l00713"></a>00713 
<a name="l00714"></a>00714     <span class="keywordflow">if</span> (addtoroot == 1 )
<a name="l00715"></a>00715         <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag,scenenode,node,<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a1e7024f47851c1885498cfae69f36cae">DAG_RL_SCENE</a>, <span class="stringliteral">&quot;Scene Relation&quot;</span>);
<a name="l00716"></a>00716 }
<a name="l00717"></a>00717 
<a name="l00718"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a1cd505fe4d1bca60a9f5ab4e66c00b4b">00718</a> <span class="keyword">struct </span><a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a4643e7b018947925ab5801bd36a7af34">build_dag</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce, <span class="keywordtype">short</span> mask) 
<a name="l00719"></a>00719 {
<a name="l00720"></a>00720     <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l00721"></a>00721     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l00722"></a>00722     <a class="code" href="../../d4/d91/structGroup.html">Group</a> *group;
<a name="l00723"></a>00723     <a class="code" href="../../d3/d3b/structGroupObject.html">GroupObject</a> *go;
<a name="l00724"></a>00724     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node;
<a name="l00725"></a>00725     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *scenenode;
<a name="l00726"></a>00726     <a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *dag;
<a name="l00727"></a>00727     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l00728"></a>00728 
<a name="l00729"></a>00729     dag = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>;
<a name="l00730"></a>00730     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a60df6215bf46c09e3f85c984731a7669">dagisvalid</a>=1;
<a name="l00731"></a>00731     <span class="keywordflow">if</span> ( dag)
<a name="l00732"></a>00732         <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aef295b921a94ae4818d364194a6769b1">free_forest</a>( dag ); 
<a name="l00733"></a>00733     <span class="keywordflow">else</span> {
<a name="l00734"></a>00734         dag = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a95696f03e4d53d9007848383709fe2d3">dag_init</a>();
<a name="l00735"></a>00735         sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a> = dag;
<a name="l00736"></a>00736     }
<a name="l00737"></a>00737     
<a name="l00738"></a>00738     <span class="comment">/* add base node for scene. scene is always the first node in DAG */</span>
<a name="l00739"></a>00739     scenenode = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ad767ccd7e8be5e1ef7f1cc9a473d4da3">dag_add_node</a>(dag, sce); 
<a name="l00740"></a>00740     
<a name="l00741"></a>00741     <span class="comment">/* add current scene objects */</span>
<a name="l00742"></a>00742     <span class="keywordflow">for</span> (base = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; base; base= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a25befa992d0ce8876b7d62176212be68">next</a>) {
<a name="l00743"></a>00743         ob= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l00744"></a>00744         
<a name="l00745"></a>00745         <a class="code" href="../../dc/d2f/depsgraph_8c.html#a01aad0e45a03850fa18ad33d752007fa">build_dag_object</a>(dag, scenenode, sce, ob, mask);
<a name="l00746"></a>00746         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a54e05d3611058fa986bd69541f665e23">proxy</a>)
<a name="l00747"></a>00747             <a class="code" href="../../dc/d2f/depsgraph_8c.html#a01aad0e45a03850fa18ad33d752007fa">build_dag_object</a>(dag, scenenode, sce, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a54e05d3611058fa986bd69541f665e23">proxy</a>, mask);
<a name="l00748"></a>00748         
<a name="l00749"></a>00749         <span class="comment">/* handled in next loop */</span>
<a name="l00750"></a>00750         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a3f0daef111a437533e48f6209429b49f">dup_group</a>) 
<a name="l00751"></a>00751             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a3f0daef111a437533e48f6209429b49f">dup_group</a>-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> |= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a41fa8f648966e669ab4da5b359bd7d57">LIB_DOIT</a>;
<a name="l00752"></a>00752     }
<a name="l00753"></a>00753     
<a name="l00754"></a>00754     <span class="comment">/* add groups used in current scene objects */</span>
<a name="l00755"></a>00755     <span class="keywordflow">for</span> (group= bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a267e87055868d88574ec121db05cc8c7">group</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; group; group= group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l00756"></a>00756         <span class="keywordflow">if</span> (group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a41fa8f648966e669ab4da5b359bd7d57">LIB_DOIT</a>) {
<a name="l00757"></a>00757             <span class="keywordflow">for</span> (go= group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ad757bf69b6fd15b1d4e0980089d13be1">gobject</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; go; go= go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#a81e7437ba90ec95c5fbb96e17e6a203d">next</a>) {
<a name="l00758"></a>00758                 <a class="code" href="../../dc/d2f/depsgraph_8c.html#a01aad0e45a03850fa18ad33d752007fa">build_dag_object</a>(dag, scenenode, sce, go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>, mask);
<a name="l00759"></a>00759             }
<a name="l00760"></a>00760             group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp;= ~<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a41fa8f648966e669ab4da5b359bd7d57">LIB_DOIT</a>;
<a name="l00761"></a>00761         }
<a name="l00762"></a>00762     }
<a name="l00763"></a>00763     
<a name="l00764"></a>00764     <span class="comment">/* Now all relations were built, but we need to solve 1 exceptional case;</span>
<a name="l00765"></a>00765 <span class="comment">     * When objects have multiple &quot;parents&quot; (for example parent + constraint working on same object)</span>
<a name="l00766"></a>00766 <span class="comment">     * the relation type has to be synced. One of the parents can change, and should give same event to child */</span>
<a name="l00767"></a>00767     
<a name="l00768"></a>00768     <span class="comment">/* nodes were callocced, so we can use node-&gt;color for temporal storage */</span>
<a name="l00769"></a>00769     <span class="keywordflow">for</span> (node = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>) {
<a name="l00770"></a>00770         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a725e3c7b1bf69d904015fb59702be828">type</a>==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>) {
<a name="l00771"></a>00771             <span class="keywordflow">for</span> (itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>; itA; itA= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>) {
<a name="l00772"></a>00772                 <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a725e3c7b1bf69d904015fb59702be828">type</a>==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>) {
<a name="l00773"></a>00773                     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> |= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#ae982b8af4f2faff081dbfada1a26413c">type</a>;
<a name="l00774"></a>00774                 }
<a name="l00775"></a>00775             }
<a name="l00776"></a>00776 
<a name="l00777"></a>00777             <span class="comment">/* also flush custom data mask */</span>
<a name="l00778"></a>00778             ((<a class="code" href="../../de/de7/structObject.html">Object</a>*)node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>)-&gt;customdata_mask= node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#abe4b783b5053c701adb7409a53ea85fa">customdata_mask</a>;
<a name="l00779"></a>00779         }
<a name="l00780"></a>00780     }
<a name="l00781"></a>00781     <span class="comment">/* now set relations equal, so that when only one parent changes, the correct recalcs are found */</span>
<a name="l00782"></a>00782     <span class="keywordflow">for</span> (node = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>) {
<a name="l00783"></a>00783         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a725e3c7b1bf69d904015fb59702be828">type</a>==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>) {
<a name="l00784"></a>00784             <span class="keywordflow">for</span> (itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>; itA; itA= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>) {
<a name="l00785"></a>00785                 <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a725e3c7b1bf69d904015fb59702be828">type</a>==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>) {
<a name="l00786"></a>00786                     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#ae982b8af4f2faff081dbfada1a26413c">type</a> |= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a>;
<a name="l00787"></a>00787                 }
<a name="l00788"></a>00788             }
<a name="l00789"></a>00789         }
<a name="l00790"></a>00790     }
<a name="l00791"></a>00791     
<a name="l00792"></a>00792     <span class="comment">// cycle detection and solving</span>
<a name="l00793"></a>00793     <span class="comment">// solve_cycles(dag);   </span>
<a name="l00794"></a>00794     
<a name="l00795"></a>00795     <span class="keywordflow">return</span> dag;
<a name="l00796"></a>00796 }
<a name="l00797"></a>00797 
<a name="l00798"></a>00798 
<a name="l00799"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a6128d6b363875e318ad82078c4eae516">00799</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aef295b921a94ae4818d364194a6769b1">free_forest</a>(<a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *Dag) 
<a name="l00800"></a>00800 {  <span class="comment">/* remove all nodes and deps */</span>
<a name="l00801"></a>00801     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *tempN;
<a name="l00802"></a>00802     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *tempA;  
<a name="l00803"></a>00803     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l00804"></a>00804     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *itN = Dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00805"></a>00805     
<a name="l00806"></a>00806     <span class="keywordflow">while</span> (itN) {
<a name="l00807"></a>00807         itA = itN-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>;   
<a name="l00808"></a>00808         <span class="keywordflow">while</span> (itA) {
<a name="l00809"></a>00809             tempA = itA;
<a name="l00810"></a>00810             itA = itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>;
<a name="l00811"></a>00811             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(tempA);           
<a name="l00812"></a>00812         }
<a name="l00813"></a>00813         
<a name="l00814"></a>00814         itA = itN-&gt;<a class="code" href="../../d5/d07/structDagNode.html#acd5dbfedffc101370fffcb987414dc79">parent</a>;  
<a name="l00815"></a>00815         <span class="keywordflow">while</span> (itA) {
<a name="l00816"></a>00816             tempA = itA;
<a name="l00817"></a>00817             itA = itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>;
<a name="l00818"></a>00818             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(tempA);           
<a name="l00819"></a>00819         }
<a name="l00820"></a>00820         
<a name="l00821"></a>00821         tempN = itN;
<a name="l00822"></a>00822         itN = itN-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>;
<a name="l00823"></a>00823         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(tempN);
<a name="l00824"></a>00824     }
<a name="l00825"></a>00825 
<a name="l00826"></a>00826     <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#adc20ede3cd08276d25c11f2d02768119">BLI_ghash_free</a>(Dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#a31c574e33e0dfebc6263b8028ef59881">nodeHash</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00827"></a>00827     Dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#a31c574e33e0dfebc6263b8028ef59881">nodeHash</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00828"></a>00828     Dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00829"></a>00829     Dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00830"></a>00830     Dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#a5be425edbfa6fc1b4e1b63b7849b7af6">numNodes</a> = 0;
<a name="l00831"></a>00831 
<a name="l00832"></a>00832 }
<a name="l00833"></a>00833 
<a name="l00834"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a5096e8e653098096670e32c25b13723f">00834</a> <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> * <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a5096e8e653098096670e32c25b13723f">dag_find_node</a> (<a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *forest,<span class="keywordtype">void</span> * fob)
<a name="l00835"></a>00835 {
<a name="l00836"></a>00836     <span class="keywordflow">if</span> (forest-&gt;<a class="code" href="../../dc/df7/structDagForest.html#a31c574e33e0dfebc6263b8028ef59881">nodeHash</a>)
<a name="l00837"></a>00837         <span class="keywordflow">return</span> <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ac3bdece51152c2b9d4deff6771958b69">BLI_ghash_lookup</a>(forest-&gt;<a class="code" href="../../dc/df7/structDagForest.html#a31c574e33e0dfebc6263b8028ef59881">nodeHash</a>, fob);
<a name="l00838"></a>00838 
<a name="l00839"></a>00839     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00840"></a>00840 }
<a name="l00841"></a>00841 
<a name="l00842"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#ab3c6a0fe7397579cf62d31e5c30e9e67">00842</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#ab3c6a0fe7397579cf62d31e5c30e9e67">ugly_hack_sorry</a>= 1;  <span class="comment">// prevent type check</span>
<a name="l00843"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a73fa2494da191bcf6807ea5afb51f134">00843</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#a73fa2494da191bcf6807ea5afb51f134">dag_print_dependencies</a>= 0; <span class="comment">// debugging</span>
<a name="l00844"></a>00844 
<a name="l00845"></a>00845 <span class="comment">/* no checking of existence, use dag_find_node first or dag_get_node */</span>
<a name="l00846"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#ad767ccd7e8be5e1ef7f1cc9a473d4da3">00846</a> <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> * <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ad767ccd7e8be5e1ef7f1cc9a473d4da3">dag_add_node</a> (<a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *forest, <span class="keywordtype">void</span> * fob)
<a name="l00847"></a>00847 {
<a name="l00848"></a>00848     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node;
<a name="l00849"></a>00849         
<a name="l00850"></a>00850     node = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d07/structDagNode.html">DagNode</a>),<span class="stringliteral">&quot;DAG node&quot;</span>);
<a name="l00851"></a>00851     <span class="keywordflow">if</span> (node) {
<a name="l00852"></a>00852         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a> = fob;
<a name="l00853"></a>00853         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>;
<a name="l00854"></a>00854 
<a name="l00855"></a>00855         <span class="keywordflow">if</span> (<a class="code" href="../../dc/d2f/depsgraph_8c.html#ab3c6a0fe7397579cf62d31e5c30e9e67">ugly_hack_sorry</a>) node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a725e3c7b1bf69d904015fb59702be828">type</a> = <a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(((<a class="code" href="../../d8/d7e/structID.html">ID</a> *) fob)-&gt;name);   <span class="comment">// sorry, done for pose sorting</span>
<a name="l00856"></a>00856         <span class="keywordflow">if</span> (forest-&gt;<a class="code" href="../../dc/df7/structDagForest.html#a5be425edbfa6fc1b4e1b63b7849b7af6">numNodes</a>) {
<a name="l00857"></a>00857             ((<a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *) forest-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>)-&gt;next = node;
<a name="l00858"></a>00858             forest-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = node;
<a name="l00859"></a>00859             forest-&gt;<a class="code" href="../../dc/df7/structDagForest.html#a5be425edbfa6fc1b4e1b63b7849b7af6">numNodes</a>++;
<a name="l00860"></a>00860         }
<a name="l00861"></a>00861         <span class="keywordflow">else</span> {
<a name="l00862"></a>00862             forest-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = node;
<a name="l00863"></a>00863             forest-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> = node;
<a name="l00864"></a>00864             forest-&gt;<a class="code" href="../../dc/df7/structDagForest.html#a5be425edbfa6fc1b4e1b63b7849b7af6">numNodes</a> = 1;
<a name="l00865"></a>00865         }
<a name="l00866"></a>00866 
<a name="l00867"></a>00867         <span class="keywordflow">if</span> (!forest-&gt;<a class="code" href="../../dc/df7/structDagForest.html#a31c574e33e0dfebc6263b8028ef59881">nodeHash</a>)
<a name="l00868"></a>00868             forest-&gt;<a class="code" href="../../dc/df7/structDagForest.html#a31c574e33e0dfebc6263b8028ef59881">nodeHash</a>= <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#af2fb34af7b99547b33a34380451a963d">BLI_ghash_new</a>(<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a371913beecfb01de3d0a8d5f0bb598d4">BLI_ghashutil_ptrhash</a>, <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a51865a4bfcfc2502e01a9369bfb72877">BLI_ghashutil_ptrcmp</a>, <span class="stringliteral">&quot;dag_add_node gh&quot;</span>);
<a name="l00869"></a>00869         <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ad72f3a6d9b88bc494c6a279d1b7b9165">BLI_ghash_insert</a>(forest-&gt;<a class="code" href="../../dc/df7/structDagForest.html#a31c574e33e0dfebc6263b8028ef59881">nodeHash</a>, fob, node);
<a name="l00870"></a>00870     }
<a name="l00871"></a>00871 
<a name="l00872"></a>00872     <span class="keywordflow">return</span> node;
<a name="l00873"></a>00873 }
<a name="l00874"></a>00874 
<a name="l00875"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#aedbf331f72cdcc89995322ae0567f1df">00875</a> <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> * <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a> (<a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *forest,<span class="keywordtype">void</span> * fob)
<a name="l00876"></a>00876 {
<a name="l00877"></a>00877     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node;
<a name="l00878"></a>00878     
<a name="l00879"></a>00879     node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a5096e8e653098096670e32c25b13723f">dag_find_node</a> (forest, fob); 
<a name="l00880"></a>00880     <span class="keywordflow">if</span> (!node) 
<a name="l00881"></a>00881         node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ad767ccd7e8be5e1ef7f1cc9a473d4da3">dag_add_node</a>(forest, fob);
<a name="l00882"></a>00882     <span class="keywordflow">return</span> node;
<a name="l00883"></a>00883 }
<a name="l00884"></a>00884 
<a name="l00885"></a>00885 
<a name="l00886"></a>00886 
<a name="l00887"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a2a86592c990620963575a2a4a85359db">00887</a> <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> * <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a2a86592c990620963575a2a4a85359db">dag_get_sub_node</a> (<a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *forest,<span class="keywordtype">void</span> * fob)
<a name="l00888"></a>00888 {
<a name="l00889"></a>00889     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node;
<a name="l00890"></a>00890     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *mainchild, *prev=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00891"></a>00891     
<a name="l00892"></a>00892     mainchild = ((<a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *) forest-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)-&gt;child;
<a name="l00893"></a>00893     <span class="comment">/* remove from first node (scene) adj list if present */</span>
<a name="l00894"></a>00894     <span class="keywordflow">while</span> (mainchild) {
<a name="l00895"></a>00895         <span class="keywordflow">if</span> (mainchild-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a> == fob) {
<a name="l00896"></a>00896             <span class="keywordflow">if</span> (prev) {
<a name="l00897"></a>00897                 prev-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a> = mainchild-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>;
<a name="l00898"></a>00898                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(mainchild);
<a name="l00899"></a>00899                 <span class="keywordflow">break</span>;
<a name="l00900"></a>00900             }
<a name="l00901"></a>00901             <span class="keywordflow">else</span> {
<a name="l00902"></a>00902                 ((<a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *) forest-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)-&gt;child = mainchild-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>;
<a name="l00903"></a>00903                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(mainchild);
<a name="l00904"></a>00904                 <span class="keywordflow">break</span>;
<a name="l00905"></a>00905             }
<a name="l00906"></a>00906         }
<a name="l00907"></a>00907         prev = mainchild;
<a name="l00908"></a>00908         mainchild = mainchild-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>;
<a name="l00909"></a>00909     }
<a name="l00910"></a>00910     node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a5096e8e653098096670e32c25b13723f">dag_find_node</a> (forest, fob); 
<a name="l00911"></a>00911     <span class="keywordflow">if</span> (!node) 
<a name="l00912"></a>00912         node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ad767ccd7e8be5e1ef7f1cc9a473d4da3">dag_add_node</a>(forest, fob);
<a name="l00913"></a>00913     <span class="keywordflow">return</span> node;
<a name="l00914"></a>00914 }
<a name="l00915"></a>00915 
<a name="l00916"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a92a921b1c3b351788d5780cfadf1ff1e">00916</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#a92a921b1c3b351788d5780cfadf1ff1e">dag_add_parent_relation</a>(<a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(forest), <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *fob1, <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *fob2, <span class="keywordtype">short</span> rel, <span class="keyword">const</span> <span class="keywordtype">char</span> *name) 
<a name="l00917"></a>00917 {
<a name="l00918"></a>00918     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA = fob2-&gt;<a class="code" href="../../d5/d07/structDagNode.html#acd5dbfedffc101370fffcb987414dc79">parent</a>;
<a name="l00919"></a>00919     
<a name="l00920"></a>00920     <span class="keywordflow">while</span> (itA) { <span class="comment">/* search if relation exist already */</span>
<a name="l00921"></a>00921         <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a> == fob1) {
<a name="l00922"></a>00922             itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#ae982b8af4f2faff081dbfada1a26413c">type</a> |= rel;
<a name="l00923"></a>00923             itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a6f01434b00294255b68ae834d66c8be2">count</a> += 1;
<a name="l00924"></a>00924             <span class="keywordflow">return</span>;
<a name="l00925"></a>00925         }
<a name="l00926"></a>00926         itA = itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>;
<a name="l00927"></a>00927     }
<a name="l00928"></a>00928     <span class="comment">/* create new relation and insert at head. MALLOC alert! */</span>
<a name="l00929"></a>00929     itA = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a>),<span class="stringliteral">&quot;DAG adj list&quot;</span>);
<a name="l00930"></a>00930     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a> = fob1;
<a name="l00931"></a>00931     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#ae982b8af4f2faff081dbfada1a26413c">type</a> = rel;
<a name="l00932"></a>00932     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a6f01434b00294255b68ae834d66c8be2">count</a> = 1;
<a name="l00933"></a>00933     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a> = fob2-&gt;<a class="code" href="../../d5/d07/structDagNode.html#acd5dbfedffc101370fffcb987414dc79">parent</a>;
<a name="l00934"></a>00934     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a9fd545edd38d26038983e72a834d8c5f">name</a> = name;
<a name="l00935"></a>00935     fob2-&gt;<a class="code" href="../../d5/d07/structDagNode.html#acd5dbfedffc101370fffcb987414dc79">parent</a> = itA;
<a name="l00936"></a>00936 }
<a name="l00937"></a>00937 
<a name="l00938"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#aedb692691c3406661eae56c512685bb8">00938</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(<a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *forest, <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *fob1, <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *fob2, <span class="keywordtype">short</span> rel, <span class="keyword">const</span> <span class="keywordtype">char</span> *name) 
<a name="l00939"></a>00939 {
<a name="l00940"></a>00940     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA = fob1-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>;
<a name="l00941"></a>00941     
<a name="l00942"></a>00942     <span class="comment">/* parent relation is for cycle checking */</span>
<a name="l00943"></a>00943     <a class="code" href="../../dc/d2f/depsgraph_8c.html#a92a921b1c3b351788d5780cfadf1ff1e">dag_add_parent_relation</a>(forest, fob1, fob2, rel, name);
<a name="l00944"></a>00944 
<a name="l00945"></a>00945     <span class="keywordflow">while</span> (itA) { <span class="comment">/* search if relation exist already */</span>
<a name="l00946"></a>00946         <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a> == fob2) {
<a name="l00947"></a>00947             itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#ae982b8af4f2faff081dbfada1a26413c">type</a> |= rel;
<a name="l00948"></a>00948             itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a6f01434b00294255b68ae834d66c8be2">count</a> += 1;
<a name="l00949"></a>00949             <span class="keywordflow">return</span>;
<a name="l00950"></a>00950         }
<a name="l00951"></a>00951         itA = itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>;
<a name="l00952"></a>00952     }
<a name="l00953"></a>00953     <span class="comment">/* create new relation and insert at head. MALLOC alert! */</span>
<a name="l00954"></a>00954     itA = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a>),<span class="stringliteral">&quot;DAG adj list&quot;</span>);
<a name="l00955"></a>00955     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a> = fob2;
<a name="l00956"></a>00956     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#ae982b8af4f2faff081dbfada1a26413c">type</a> = rel;
<a name="l00957"></a>00957     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a6f01434b00294255b68ae834d66c8be2">count</a> = 1;
<a name="l00958"></a>00958     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a> = fob1-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>;
<a name="l00959"></a>00959     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a9fd545edd38d26038983e72a834d8c5f">name</a> = name;
<a name="l00960"></a>00960     fob1-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a> = itA;
<a name="l00961"></a>00961 }
<a name="l00962"></a>00962 
<a name="l00963"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a8f153cc87199a4fc6f284181b5b298a2">00963</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d2f/depsgraph_8c.html#a8f153cc87199a4fc6f284181b5b298a2">dag_node_name</a>(<a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node)
<a name="l00964"></a>00964 {
<a name="l00965"></a>00965     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00966"></a>00966         <span class="keywordflow">return</span> <span class="stringliteral">&quot;null&quot;</span>;
<a name="l00967"></a>00967     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../dc/d2f/depsgraph_8c.html#ab3c6a0fe7397579cf62d31e5c30e9e67">ugly_hack_sorry</a>)
<a name="l00968"></a>00968         <span class="keywordflow">return</span> ((<a class="code" href="../../d8/d7e/structID.html">ID</a>*)(node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>))-&gt;name+2;
<a name="l00969"></a>00969     <span class="keywordflow">else</span>
<a name="l00970"></a>00970         <span class="keywordflow">return</span> ((<a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a>*)(node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>))-&gt;name;
<a name="l00971"></a>00971 }
<a name="l00972"></a>00972 
<a name="l00973"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a2648d90b1ce0842cb686c4f674cbb8d8">00973</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#a2648d90b1ce0842cb686c4f674cbb8d8">dag_node_print_dependencies</a>(<a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node)
<a name="l00974"></a>00974 {
<a name="l00975"></a>00975     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l00976"></a>00976 
<a name="l00977"></a>00977     printf(<span class="stringliteral">&quot;%s depends on:\n&quot;</span>, <a class="code" href="../../dc/d2f/depsgraph_8c.html#a8f153cc87199a4fc6f284181b5b298a2">dag_node_name</a>(node));
<a name="l00978"></a>00978 
<a name="l00979"></a>00979     <span class="keywordflow">for</span> (itA= node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#acd5dbfedffc101370fffcb987414dc79">parent</a>; itA; itA= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>)
<a name="l00980"></a>00980         printf(<span class="stringliteral">&quot;  %s through %s\n&quot;</span>, <a class="code" href="../../dc/d2f/depsgraph_8c.html#a8f153cc87199a4fc6f284181b5b298a2">dag_node_name</a>(itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>), itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a9fd545edd38d26038983e72a834d8c5f">name</a>);
<a name="l00981"></a>00981     printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00982"></a>00982 }
<a name="l00983"></a>00983 
<a name="l00984"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#acdd85eb44078f314670a6633c3b760c7">00984</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#acdd85eb44078f314670a6633c3b760c7">dag_node_print_dependency_recurs</a>(<a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node, <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *endnode)
<a name="l00985"></a>00985 {
<a name="l00986"></a>00986     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l00987"></a>00987 
<a name="l00988"></a>00988     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> == <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa75c80a731857e68384b7459fe3f40f22">DAG_BLACK</a>)
<a name="l00989"></a>00989         <span class="keywordflow">return</span> 0;
<a name="l00990"></a>00990 
<a name="l00991"></a>00991     node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a>= <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa75c80a731857e68384b7459fe3f40f22">DAG_BLACK</a>;
<a name="l00992"></a>00992 
<a name="l00993"></a>00993     <span class="keywordflow">if</span> (node == endnode)
<a name="l00994"></a>00994         <span class="keywordflow">return</span> 1;
<a name="l00995"></a>00995 
<a name="l00996"></a>00996     <span class="keywordflow">for</span> (itA= node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#acd5dbfedffc101370fffcb987414dc79">parent</a>; itA; itA= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>) {
<a name="l00997"></a>00997         <span class="keywordflow">if</span> (<a class="code" href="../../dc/d2f/depsgraph_8c.html#acdd85eb44078f314670a6633c3b760c7">dag_node_print_dependency_recurs</a>(itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>, endnode)) {
<a name="l00998"></a>00998             printf(<span class="stringliteral">&quot;  %s depends on %s through %s.\n&quot;</span>, <a class="code" href="../../dc/d2f/depsgraph_8c.html#a8f153cc87199a4fc6f284181b5b298a2">dag_node_name</a>(node), <a class="code" href="../../dc/d2f/depsgraph_8c.html#a8f153cc87199a4fc6f284181b5b298a2">dag_node_name</a>(itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>), itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a9fd545edd38d26038983e72a834d8c5f">name</a>);
<a name="l00999"></a>00999             <span class="keywordflow">return</span> 1;
<a name="l01000"></a>01000         }
<a name="l01001"></a>01001     }
<a name="l01002"></a>01002 
<a name="l01003"></a>01003     <span class="keywordflow">return</span> 0;
<a name="l01004"></a>01004 }
<a name="l01005"></a>01005 
<a name="l01006"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#abe3b0565aa2ad34b3a78ff5e85f0d546">01006</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#abe3b0565aa2ad34b3a78ff5e85f0d546">dag_node_print_dependency_cycle</a>(<a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *dag, <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *startnode, <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *endnode, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l01007"></a>01007 {
<a name="l01008"></a>01008     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node;
<a name="l01009"></a>01009 
<a name="l01010"></a>01010     <span class="keywordflow">for</span> (node = dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>)
<a name="l01011"></a>01011         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a>= <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>;
<a name="l01012"></a>01012 
<a name="l01013"></a>01013     printf(<span class="stringliteral">&quot;  %s depends on %s through %s.\n&quot;</span>, <a class="code" href="../../dc/d2f/depsgraph_8c.html#a8f153cc87199a4fc6f284181b5b298a2">dag_node_name</a>(endnode), <a class="code" href="../../dc/d2f/depsgraph_8c.html#a8f153cc87199a4fc6f284181b5b298a2">dag_node_name</a>(startnode), name);
<a name="l01014"></a>01014     <a class="code" href="../../dc/d2f/depsgraph_8c.html#acdd85eb44078f314670a6633c3b760c7">dag_node_print_dependency_recurs</a>(startnode, endnode);
<a name="l01015"></a>01015     printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01016"></a>01016 }
<a name="l01017"></a>01017 
<a name="l01018"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a6797fb81d6b8ad1d560869e441eb7240">01018</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#a6797fb81d6b8ad1d560869e441eb7240">dag_node_recurs_level</a>(<a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node, <span class="keywordtype">int</span> level)
<a name="l01019"></a>01019 {
<a name="l01020"></a>01020     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l01021"></a>01021     <span class="keywordtype">int</span> newlevel;
<a name="l01022"></a>01022 
<a name="l01023"></a>01023     node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a>= <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa75c80a731857e68384b7459fe3f40f22">DAG_BLACK</a>; <span class="comment">/* done */</span>
<a name="l01024"></a>01024     newlevel= ++level;
<a name="l01025"></a>01025     
<a name="l01026"></a>01026     <span class="keywordflow">for</span> (itA= node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#acd5dbfedffc101370fffcb987414dc79">parent</a>; itA; itA= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>) {
<a name="l01027"></a>01027         <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a>==<a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>) {
<a name="l01028"></a>01028             itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a168093b2854d5955780e202de15f8950">ancestor_count</a>= <a class="code" href="../../dc/d2f/depsgraph_8c.html#a6797fb81d6b8ad1d560869e441eb7240">dag_node_recurs_level</a>(itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>, level);
<a name="l01029"></a>01029             newlevel= <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(newlevel, level+itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a168093b2854d5955780e202de15f8950">ancestor_count</a>);
<a name="l01030"></a>01030         }
<a name="l01031"></a>01031         <span class="keywordflow">else</span>
<a name="l01032"></a>01032             newlevel= <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(newlevel, level+itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a168093b2854d5955780e202de15f8950">ancestor_count</a>);
<a name="l01033"></a>01033     }
<a name="l01034"></a>01034     
<a name="l01035"></a>01035     <span class="keywordflow">return</span> newlevel;
<a name="l01036"></a>01036 }
<a name="l01037"></a>01037 
<a name="l01038"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a5f3b1c118ce9371f626080ab579a1216">01038</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#a5f3b1c118ce9371f626080ab579a1216">dag_check_cycle</a>(<a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *dag)
<a name="l01039"></a>01039 {
<a name="l01040"></a>01040     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node;
<a name="l01041"></a>01041     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l01042"></a>01042 
<a name="l01043"></a>01043     <span class="comment">/* debugging print */</span>
<a name="l01044"></a>01044     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d2f/depsgraph_8c.html#a73fa2494da191bcf6807ea5afb51f134">dag_print_dependencies</a>)
<a name="l01045"></a>01045         <span class="keywordflow">for</span> (node = dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>)
<a name="l01046"></a>01046             <a class="code" href="../../dc/d2f/depsgraph_8c.html#a2648d90b1ce0842cb686c4f674cbb8d8">dag_node_print_dependencies</a>(node);
<a name="l01047"></a>01047 
<a name="l01048"></a>01048     <span class="comment">/* tag nodes unchecked */</span>
<a name="l01049"></a>01049     <span class="keywordflow">for</span> (node = dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>)
<a name="l01050"></a>01050         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a>= <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>;
<a name="l01051"></a>01051     
<a name="l01052"></a>01052     <span class="keywordflow">for</span> (node = dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>) {
<a name="l01053"></a>01053         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a>==<a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>) {
<a name="l01054"></a>01054             node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a168093b2854d5955780e202de15f8950">ancestor_count</a>= <a class="code" href="../../dc/d2f/depsgraph_8c.html#a6797fb81d6b8ad1d560869e441eb7240">dag_node_recurs_level</a>(node, 0);
<a name="l01055"></a>01055         }
<a name="l01056"></a>01056     }
<a name="l01057"></a>01057     
<a name="l01058"></a>01058     <span class="comment">/* check relations, and print errors */</span>
<a name="l01059"></a>01059     <span class="keywordflow">for</span> (node = dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>) {
<a name="l01060"></a>01060         <span class="keywordflow">for</span> (itA= node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#acd5dbfedffc101370fffcb987414dc79">parent</a>; itA; itA= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>) {
<a name="l01061"></a>01061             <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a168093b2854d5955780e202de15f8950">ancestor_count</a> &gt; node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a168093b2854d5955780e202de15f8950">ancestor_count</a>) {
<a name="l01062"></a>01062                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a> &amp;&amp; itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>) {
<a name="l01063"></a>01063                     printf(<span class="stringliteral">&quot;Dependency cycle detected:\n&quot;</span>);
<a name="l01064"></a>01064                     <a class="code" href="../../dc/d2f/depsgraph_8c.html#abe3b0565aa2ad34b3a78ff5e85f0d546">dag_node_print_dependency_cycle</a>(dag, itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>, node, itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a9fd545edd38d26038983e72a834d8c5f">name</a>);
<a name="l01065"></a>01065                 }
<a name="l01066"></a>01066             }
<a name="l01067"></a>01067         }
<a name="l01068"></a>01068     }
<a name="l01069"></a>01069 
<a name="l01070"></a>01070     <span class="comment">/* parent relations are only needed for cycle checking, so free now */</span>
<a name="l01071"></a>01071     <span class="keywordflow">for</span> (node = dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>) {
<a name="l01072"></a>01072         <span class="keywordflow">while</span> (node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#acd5dbfedffc101370fffcb987414dc79">parent</a>) {
<a name="l01073"></a>01073             itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#acd5dbfedffc101370fffcb987414dc79">parent</a>-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>;
<a name="l01074"></a>01074             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#acd5dbfedffc101370fffcb987414dc79">parent</a>);            
<a name="l01075"></a>01075             node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#acd5dbfedffc101370fffcb987414dc79">parent</a> = itA;
<a name="l01076"></a>01076         }
<a name="l01077"></a>01077     }
<a name="l01078"></a>01078 }
<a name="l01079"></a>01079 
<a name="l01080"></a>01080 <span class="comment">/*</span>
<a name="l01081"></a>01081 <span class="comment"> * MainDAG is the DAG of all objects in current scene</span>
<a name="l01082"></a>01082 <span class="comment"> * used only for drawing there is one also in each scene</span>
<a name="l01083"></a>01083 <span class="comment"> */</span>
<a name="l01084"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a4c3a317a1a303dc44761a34ce3c92d61">01084</a> <span class="keyword">static</span> <a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> * <a class="code" href="../../dc/d2f/depsgraph_8c.html#a4c3a317a1a303dc44761a34ce3c92d61">MainDag</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01085"></a>01085 
<a name="l01086"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#aa6926cc8679f277f945ae3dab784a1be">01086</a> <a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *<a class="code" href="../../d4/d24/depsgraph__private_8h.html#aa6926cc8679f277f945ae3dab784a1be">getMainDag</a>(<span class="keywordtype">void</span>)
<a name="l01087"></a>01087 {
<a name="l01088"></a>01088     <span class="keywordflow">return</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#a4c3a317a1a303dc44761a34ce3c92d61">MainDag</a>;
<a name="l01089"></a>01089 }
<a name="l01090"></a>01090 
<a name="l01091"></a>01091 
<a name="l01092"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#afd272946c2fb531e29ca7f71840da116">01092</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d24/depsgraph__private_8h.html#afd272946c2fb531e29ca7f71840da116">setMainDag</a>(<a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *dag)
<a name="l01093"></a>01093 {
<a name="l01094"></a>01094     MainDag = dag;
<a name="l01095"></a>01095 }
<a name="l01096"></a>01096 
<a name="l01097"></a>01097 
<a name="l01098"></a>01098 <span class="comment">/*</span>
<a name="l01099"></a>01099 <span class="comment"> * note for BFS/DFS</span>
<a name="l01100"></a>01100 <span class="comment"> * in theory we should sweep the whole array</span>
<a name="l01101"></a>01101 <span class="comment"> * but in our case the first node is the scene</span>
<a name="l01102"></a>01102 <span class="comment"> * and is linked to every other object</span>
<a name="l01103"></a>01103 <span class="comment"> *</span>
<a name="l01104"></a>01104 <span class="comment"> * for general case we will need to add outer loop</span>
<a name="l01105"></a>01105 <span class="comment"> */</span>
<a name="l01106"></a>01106 
<a name="l01107"></a>01107 <span class="comment">/*</span>
<a name="l01108"></a>01108 <span class="comment"> * ToDo : change pos kludge</span>
<a name="l01109"></a>01109 <span class="comment"> */</span>
<a name="l01110"></a>01110 
<a name="l01111"></a>01111 <span class="comment">/* adjust levels for drawing in oops space */</span>
<a name="l01112"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a3b72f3d0f31cb49e8752790e9e2fd6dc">01112</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a3b72f3d0f31cb49e8752790e9e2fd6dc">graph_bfs</a>(<span class="keywordtype">void</span>)
<a name="l01113"></a>01113 {
<a name="l01114"></a>01114     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node;
<a name="l01115"></a>01115     <a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *nqueue;
<a name="l01116"></a>01116     <span class="keywordtype">int</span> pos[50];
<a name="l01117"></a>01117     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01118"></a>01118     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l01119"></a>01119     <span class="keywordtype">int</span> minheight;
<a name="l01120"></a>01120     
<a name="l01121"></a>01121     <span class="comment">/* fprintf(stderr,&quot;starting BFS\n ------------\n&quot;); */</span>
<a name="l01122"></a>01122     nqueue = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab1df05b5e7c73b0bc403fbb132fe8fba">queue_create</a>(<a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab84f030513d53e1fbd6870d640282a6d">DAGQUEUEALLOC</a>);
<a name="l01123"></a>01123     <span class="keywordflow">for</span> ( i=0; i&lt;50; i++)
<a name="l01124"></a>01124         pos[i] = 0;
<a name="l01125"></a>01125     
<a name="l01126"></a>01126     <span class="comment">/* Init</span>
<a name="l01127"></a>01127 <span class="comment">     * dagnode.first is always the root (scene)</span>
<a name="l01128"></a>01128 <span class="comment">     */</span>
<a name="l01129"></a>01129     node = MainDag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01130"></a>01130     <span class="keywordflow">while</span> (node) {
<a name="l01131"></a>01131         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>;
<a name="l01132"></a>01132         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aebe9644880578c27292c6067b2ff57c7">BFS_dist</a> = 9999;
<a name="l01133"></a>01133         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a5328dcbcfe952ea457140cebf16aed28">k</a> = 0;
<a name="l01134"></a>01134         node = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>;
<a name="l01135"></a>01135     }
<a name="l01136"></a>01136     
<a name="l01137"></a>01137     node = MainDag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01138"></a>01138     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> == <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>) {
<a name="l01139"></a>01139         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>;
<a name="l01140"></a>01140         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aebe9644880578c27292c6067b2ff57c7">BFS_dist</a> = 1;
<a name="l01141"></a>01141         <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a335f4bbca178af08d1a1a8472aac9027">push_queue</a>(nqueue,node);  
<a name="l01142"></a>01142         <span class="keywordflow">while</span> (nqueue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a>) {
<a name="l01143"></a>01143             node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a235ae8872ca26849c15091928dd95cc6">pop_queue</a>(nqueue);
<a name="l01144"></a>01144             
<a name="l01145"></a>01145             minheight = pos[node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aebe9644880578c27292c6067b2ff57c7">BFS_dist</a>];
<a name="l01146"></a>01146             itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>;
<a name="l01147"></a>01147             <span class="keywordflow">while</span> (itA != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01148"></a>01148                 <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> == <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>) {
<a name="l01149"></a>01149                     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>;
<a name="l01150"></a>01150                     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aebe9644880578c27292c6067b2ff57c7">BFS_dist</a> = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aebe9644880578c27292c6067b2ff57c7">BFS_dist</a> + 1;
<a name="l01151"></a>01151                     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a5328dcbcfe952ea457140cebf16aed28">k</a> = (float) minheight;
<a name="l01152"></a>01152                     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a335f4bbca178af08d1a1a8472aac9027">push_queue</a>(nqueue,itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>);
<a name="l01153"></a>01153                 }
<a name="l01154"></a>01154                 
<a name="l01155"></a>01155                 <span class="keywordflow">else</span> {
<a name="l01156"></a>01156                     fprintf(stderr,<span class="stringliteral">&quot;bfs not dag tree edge color :%i\n&quot;</span>,itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a>);
<a name="l01157"></a>01157                 }
<a name="l01158"></a>01158 
<a name="l01159"></a>01159                 
<a name="l01160"></a>01160                 itA = itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>;
<a name="l01161"></a>01161             }
<a name="l01162"></a>01162             <span class="keywordflow">if</span> (pos[node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aebe9644880578c27292c6067b2ff57c7">BFS_dist</a>] &gt; node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a5328dcbcfe952ea457140cebf16aed28">k</a> ) {
<a name="l01163"></a>01163                 pos[node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aebe9644880578c27292c6067b2ff57c7">BFS_dist</a>] += 1;               
<a name="l01164"></a>01164                 node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a5328dcbcfe952ea457140cebf16aed28">k</a> = (float) pos[node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aebe9644880578c27292c6067b2ff57c7">BFS_dist</a>];
<a name="l01165"></a>01165             }
<a name="l01166"></a>01166             <span class="keywordflow">else</span> {
<a name="l01167"></a>01167                 pos[node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aebe9644880578c27292c6067b2ff57c7">BFS_dist</a>] = (int) node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a5328dcbcfe952ea457140cebf16aed28">k</a> +1;
<a name="l01168"></a>01168             }
<a name="l01169"></a>01169             <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a6a6a2e93bd565675553f8499edbdcead">set_node_xy</a>(node, node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aebe9644880578c27292c6067b2ff57c7">BFS_dist</a>*<a class="code" href="../../d4/d24/depsgraph__private_8h.html#afbdbd1ba721fb7fde95ed3222a593727">DEPSX</a>*2, pos[node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aebe9644880578c27292c6067b2ff57c7">BFS_dist</a>]*<a class="code" href="../../d4/d24/depsgraph__private_8h.html#a14a65754c8b343a7afa22dc2758cd240">DEPSY</a>*2);
<a name="l01170"></a>01170             node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa75c80a731857e68384b7459fe3f40f22">DAG_BLACK</a>;
<a name="l01171"></a>01171 
<a name="l01172"></a>01172             <span class="comment">// fprintf(stderr,&quot;BFS node : %20s %i %5.0f %5.0f\n&quot;,((ID *) node-&gt;ob)-&gt;name,node-&gt;BFS_dist, node-&gt;x, node-&gt;y);</span>
<a name="l01173"></a>01173         }
<a name="l01174"></a>01174     }
<a name="l01175"></a>01175     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a4546a39116f46dea548c9e1195be4cca">queue_delete</a>(nqueue);
<a name="l01176"></a>01176 }
<a name="l01177"></a>01177 
<a name="l01178"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#adab487639bc409f210171aadd3e79903">01178</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a0487d0323404c21c98d3b67d9c69f4cd">pre_and_post_BFS</a>(<a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *dag, <span class="keywordtype">short</span> mask, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#abc877f3bcb3213641ec89c2dbbdb9e4d">graph_action_func</a> pre_func, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#abc877f3bcb3213641ec89c2dbbdb9e4d">graph_action_func</a> post_func, <span class="keywordtype">void</span> **<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l01179"></a>01179 {
<a name="l01180"></a>01180     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node;
<a name="l01181"></a>01181     
<a name="l01182"></a>01182     node = dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01183"></a>01183     <span class="keywordflow">return</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#afd3d0dffc8d4f21199bfcf32bd2c826f">pre_and_post_source_BFS</a>(dag, mask,  node,  pre_func,  post_func, data);
<a name="l01184"></a>01184 }
<a name="l01185"></a>01185 
<a name="l01186"></a>01186 
<a name="l01187"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#aeb8f1f9417655a0579707efd52938439">01187</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#afd3d0dffc8d4f21199bfcf32bd2c826f">pre_and_post_source_BFS</a>(<a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *dag, <span class="keywordtype">short</span> mask, <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *source, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#abc877f3bcb3213641ec89c2dbbdb9e4d">graph_action_func</a> pre_func, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#abc877f3bcb3213641ec89c2dbbdb9e4d">graph_action_func</a> post_func, <span class="keywordtype">void</span> **<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l01188"></a>01188 {
<a name="l01189"></a>01189     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node;
<a name="l01190"></a>01190     <a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *nqueue;
<a name="l01191"></a>01191     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l01192"></a>01192     <span class="keywordtype">int</span> retval = 0;
<a name="l01193"></a>01193     <span class="comment">/* fprintf(stderr,&quot;starting BFS\n ------------\n&quot;); */</span>
<a name="l01194"></a>01194     
<a name="l01195"></a>01195     <span class="comment">/* Init</span>
<a name="l01196"></a>01196 <span class="comment">     * dagnode.first is always the root (scene)</span>
<a name="l01197"></a>01197 <span class="comment">     */</span>
<a name="l01198"></a>01198     node = dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01199"></a>01199     nqueue = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab1df05b5e7c73b0bc403fbb132fe8fba">queue_create</a>(<a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab84f030513d53e1fbd6870d640282a6d">DAGQUEUEALLOC</a>);
<a name="l01200"></a>01200     <span class="keywordflow">while</span> (node) {
<a name="l01201"></a>01201         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>;
<a name="l01202"></a>01202         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aebe9644880578c27292c6067b2ff57c7">BFS_dist</a> = 9999;
<a name="l01203"></a>01203         node = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>;
<a name="l01204"></a>01204     }
<a name="l01205"></a>01205     
<a name="l01206"></a>01206     node = source;
<a name="l01207"></a>01207     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> == <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>) {
<a name="l01208"></a>01208         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>;
<a name="l01209"></a>01209         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aebe9644880578c27292c6067b2ff57c7">BFS_dist</a> = 1;
<a name="l01210"></a>01210         pre_func(node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>,data);
<a name="l01211"></a>01211         
<a name="l01212"></a>01212         <span class="keywordflow">while</span> (nqueue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a>) {
<a name="l01213"></a>01213             node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a235ae8872ca26849c15091928dd95cc6">pop_queue</a>(nqueue);
<a name="l01214"></a>01214             
<a name="l01215"></a>01215             itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>;
<a name="l01216"></a>01216             <span class="keywordflow">while</span> (itA != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01217"></a>01217                 <span class="keywordflow">if</span> ((itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> == <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>) &amp;&amp; (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#ae982b8af4f2faff081dbfada1a26413c">type</a> &amp; mask)) {
<a name="l01218"></a>01218                     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>;
<a name="l01219"></a>01219                     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aebe9644880578c27292c6067b2ff57c7">BFS_dist</a> = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aebe9644880578c27292c6067b2ff57c7">BFS_dist</a> + 1;
<a name="l01220"></a>01220                     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a335f4bbca178af08d1a1a8472aac9027">push_queue</a>(nqueue,itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>);
<a name="l01221"></a>01221                     pre_func(node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>,data);
<a name="l01222"></a>01222                 }
<a name="l01223"></a>01223                 
<a name="l01224"></a>01224                 <span class="keywordflow">else</span> { <span class="comment">// back or cross edge</span>
<a name="l01225"></a>01225                     retval = 1;
<a name="l01226"></a>01226                 }
<a name="l01227"></a>01227                 itA = itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>;
<a name="l01228"></a>01228             }
<a name="l01229"></a>01229             post_func(node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>,data);
<a name="l01230"></a>01230             node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa75c80a731857e68384b7459fe3f40f22">DAG_BLACK</a>;
<a name="l01231"></a>01231 
<a name="l01232"></a>01232             <span class="comment">// fprintf(stderr,&quot;BFS node : %20s %i %5.0f %5.0f\n&quot;,((ID *) node-&gt;ob)-&gt;name,node-&gt;BFS_dist, node-&gt;x, node-&gt;y);</span>
<a name="l01233"></a>01233         }
<a name="l01234"></a>01234     }
<a name="l01235"></a>01235     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a4546a39116f46dea548c9e1195be4cca">queue_delete</a>(nqueue);
<a name="l01236"></a>01236     <span class="keywordflow">return</span> retval;
<a name="l01237"></a>01237 }
<a name="l01238"></a>01238 
<a name="l01239"></a>01239 <span class="comment">/* non recursive version of DFS, return queue -- outer loop present to catch odd cases (first level cycles)*/</span>
<a name="l01240"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a677bc4787e7f8faab5c014d135d0028e">01240</a> <a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> * <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a677bc4787e7f8faab5c014d135d0028e">graph_dfs</a>(<span class="keywordtype">void</span>)
<a name="l01241"></a>01241 {
<a name="l01242"></a>01242     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node;
<a name="l01243"></a>01243     <a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *nqueue;
<a name="l01244"></a>01244     <a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *retqueue;
<a name="l01245"></a>01245     <span class="keywordtype">int</span> pos[50];
<a name="l01246"></a>01246     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01247"></a>01247     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l01248"></a>01248     <span class="keywordtype">int</span> <a class="code" href="../../dc/df7/structDagForest.html#aaaefc447095f622d9ed380e5fc2a9599">time</a>;
<a name="l01249"></a>01249     <span class="keywordtype">int</span> skip = 0;
<a name="l01250"></a>01250     <span class="keywordtype">int</span> minheight;
<a name="l01251"></a>01251     <span class="keywordtype">int</span> maxpos=0;
<a name="l01252"></a>01252     <span class="comment">/* int  is_cycle = 0; */</span> <span class="comment">/* UNUSED */</span>
<a name="l01253"></a>01253     <span class="comment">/*</span>
<a name="l01254"></a>01254 <span class="comment">     *fprintf(stderr,&quot;starting DFS\n ------------\n&quot;);</span>
<a name="l01255"></a>01255 <span class="comment">     */</span> 
<a name="l01256"></a>01256     nqueue = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab1df05b5e7c73b0bc403fbb132fe8fba">queue_create</a>(<a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab84f030513d53e1fbd6870d640282a6d">DAGQUEUEALLOC</a>);
<a name="l01257"></a>01257     retqueue = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab1df05b5e7c73b0bc403fbb132fe8fba">queue_create</a>(MainDag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#a5be425edbfa6fc1b4e1b63b7849b7af6">numNodes</a>);
<a name="l01258"></a>01258     <span class="keywordflow">for</span> ( i=0; i&lt;50; i++)
<a name="l01259"></a>01259         pos[i] = 0;
<a name="l01260"></a>01260     
<a name="l01261"></a>01261     <span class="comment">/* Init</span>
<a name="l01262"></a>01262 <span class="comment">     * dagnode.first is always the root (scene)</span>
<a name="l01263"></a>01263 <span class="comment">     */</span>
<a name="l01264"></a>01264     node = MainDag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01265"></a>01265     <span class="keywordflow">while</span> (node) {
<a name="l01266"></a>01266         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>;
<a name="l01267"></a>01267         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a> = 9999;
<a name="l01268"></a>01268         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aa67fd938cbd7e0bc32752daa411a866f">DFS_dvtm</a> = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#ad5e04aa24ff4e8470ce2ab544ebf7ed8">DFS_fntm</a> = 9999;
<a name="l01269"></a>01269         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a5328dcbcfe952ea457140cebf16aed28">k</a> = 0;
<a name="l01270"></a>01270         node =  node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>;
<a name="l01271"></a>01271     }
<a name="l01272"></a>01272     
<a name="l01273"></a>01273     time = 1;
<a name="l01274"></a>01274     
<a name="l01275"></a>01275     node = MainDag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01276"></a>01276 
<a name="l01277"></a>01277     <span class="keywordflow">do</span> {
<a name="l01278"></a>01278     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> == <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>) {
<a name="l01279"></a>01279         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>;
<a name="l01280"></a>01280         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a> = 1;
<a name="l01281"></a>01281         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aa67fd938cbd7e0bc32752daa411a866f">DFS_dvtm</a> = <a class="code" href="../../dc/df7/structDagForest.html#aaaefc447095f622d9ed380e5fc2a9599">time</a>;
<a name="l01282"></a>01282         time++;
<a name="l01283"></a>01283         <a class="code" href="../../d4/d24/depsgraph__private_8h.html#acf4ce9e88412d2859799d3a2b3d1e09f">push_stack</a>(nqueue,node);  
<a name="l01284"></a>01284             
<a name="l01285"></a>01285         <span class="keywordflow">while</span> (nqueue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a>) {
<a name="l01286"></a>01286             <span class="comment">//graph_print_queue(nqueue);</span>
<a name="l01287"></a>01287 
<a name="l01288"></a>01288             skip = 0;
<a name="l01289"></a>01289             node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#abc5d63c9e9f34a5ab16e4b42a9017886">get_top_node_queue</a>(nqueue);
<a name="l01290"></a>01290             
<a name="l01291"></a>01291             minheight = pos[node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a>];
<a name="l01292"></a>01292 
<a name="l01293"></a>01293             itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>;
<a name="l01294"></a>01294             <span class="keywordflow">while</span> (itA != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01295"></a>01295                 <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> == <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>) {
<a name="l01296"></a>01296                     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aa67fd938cbd7e0bc32752daa411a866f">DFS_dvtm</a> = <a class="code" href="../../dc/df7/structDagForest.html#aaaefc447095f622d9ed380e5fc2a9599">time</a>;
<a name="l01297"></a>01297                     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>;
<a name="l01298"></a>01298 
<a name="l01299"></a>01299                     time++;
<a name="l01300"></a>01300                     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a> = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a> + 1;
<a name="l01301"></a>01301                     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a5328dcbcfe952ea457140cebf16aed28">k</a> = (float) minheight;
<a name="l01302"></a>01302                     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#acf4ce9e88412d2859799d3a2b3d1e09f">push_stack</a>(nqueue,itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>);
<a name="l01303"></a>01303                     skip = 1;
<a name="l01304"></a>01304                     <span class="keywordflow">break</span>;
<a name="l01305"></a>01305                 }
<a name="l01306"></a>01306                 <span class="keywordflow">else</span> {
<a name="l01307"></a>01307                     <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> == <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>) { <span class="comment">// back edge</span>
<a name="l01308"></a>01308                         fprintf(stderr,<span class="stringliteral">&quot;dfs back edge :%15s %15s\n&quot;</span>,((<a class="code" href="../../d8/d7e/structID.html">ID</a> *) node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>)-&gt;name, ((<a class="code" href="../../d8/d7e/structID.html">ID</a> *) itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>)-&gt;name);
<a name="l01309"></a>01309                         <span class="comment">/* is_cycle = 1; */</span> <span class="comment">/* UNUSED */</span>
<a name="l01310"></a>01310                     }
<a name="l01311"></a>01311                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> == <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa75c80a731857e68384b7459fe3f40f22">DAG_BLACK</a>) {
<a name="l01312"></a>01312                         <span class="comment">/* already processed node but we may want later to change distance either to shorter to longer.</span>
<a name="l01313"></a>01313 <span class="comment">                         * DFS_dist is the first encounter  </span>
<a name="l01314"></a>01314 <span class="comment">                         */</span>
<a name="l01315"></a>01315 <span class="preprocessor">#if 0</span>
<a name="l01316"></a>01316 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a> &gt;= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a>)
<a name="l01317"></a>01317                             itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a> = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a> + 1;
<a name="l01318"></a>01318 
<a name="l01319"></a>01319                             fprintf(stderr,<span class="stringliteral">&quot;dfs forward or cross edge :%15s %i-%i %15s %i-%i\n&quot;</span>,
<a name="l01320"></a>01320                                 ((<a class="code" href="../../d8/d7e/structID.html">ID</a> *) node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>)-&gt;name,
<a name="l01321"></a>01321                                 node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aa67fd938cbd7e0bc32752daa411a866f">DFS_dvtm</a>, 
<a name="l01322"></a>01322                                 node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#ad5e04aa24ff4e8470ce2ab544ebf7ed8">DFS_fntm</a>, 
<a name="l01323"></a>01323                                 ((<a class="code" href="../../d8/d7e/structID.html">ID</a> *) itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>)-&gt;name, 
<a name="l01324"></a>01324                                 itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aa67fd938cbd7e0bc32752daa411a866f">DFS_dvtm</a>,
<a name="l01325"></a>01325                                 itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#ad5e04aa24ff4e8470ce2ab544ebf7ed8">DFS_fntm</a>);
<a name="l01326"></a>01326 <span class="preprocessor">#endif</span>
<a name="l01327"></a>01327 <span class="preprocessor"></span>                    }
<a name="l01328"></a>01328                     <span class="keywordflow">else</span>
<a name="l01329"></a>01329                         fprintf(stderr,<span class="stringliteral">&quot;dfs unknown edge\n&quot;</span>);
<a name="l01330"></a>01330                 }
<a name="l01331"></a>01331                 itA = itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>;
<a name="l01332"></a>01332             }           
<a name="l01333"></a>01333 
<a name="l01334"></a>01334             <span class="keywordflow">if</span> (!skip) {
<a name="l01335"></a>01335                 node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a235ae8872ca26849c15091928dd95cc6">pop_queue</a>(nqueue);
<a name="l01336"></a>01336                 node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa75c80a731857e68384b7459fe3f40f22">DAG_BLACK</a>;
<a name="l01337"></a>01337 
<a name="l01338"></a>01338                 node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#ad5e04aa24ff4e8470ce2ab544ebf7ed8">DFS_fntm</a> = <a class="code" href="../../dc/df7/structDagForest.html#aaaefc447095f622d9ed380e5fc2a9599">time</a>;
<a name="l01339"></a>01339                 time++;
<a name="l01340"></a>01340                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a> &gt; maxpos)
<a name="l01341"></a>01341                     maxpos = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a>;
<a name="l01342"></a>01342                 <span class="keywordflow">if</span> (pos[node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a>] &gt; node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a5328dcbcfe952ea457140cebf16aed28">k</a> ) {
<a name="l01343"></a>01343                     pos[node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a>] += 1;               
<a name="l01344"></a>01344                     node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a5328dcbcfe952ea457140cebf16aed28">k</a> = (float) pos[node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a>];
<a name="l01345"></a>01345                 }
<a name="l01346"></a>01346                 <span class="keywordflow">else</span> {
<a name="l01347"></a>01347                     pos[node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a>] = (int) node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a5328dcbcfe952ea457140cebf16aed28">k</a> +1;
<a name="l01348"></a>01348                 }
<a name="l01349"></a>01349                 <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a6a6a2e93bd565675553f8499edbdcead">set_node_xy</a>(node, node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a>*<a class="code" href="../../d4/d24/depsgraph__private_8h.html#afbdbd1ba721fb7fde95ed3222a593727">DEPSX</a>*2, pos[node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a>]*<a class="code" href="../../d4/d24/depsgraph__private_8h.html#a14a65754c8b343a7afa22dc2758cd240">DEPSY</a>*2);
<a name="l01350"></a>01350                 
<a name="l01351"></a>01351                 <span class="comment">// fprintf(stderr,&quot;DFS node : %20s %i %i %i %i\n&quot;,((ID *) node-&gt;ob)-&gt;name,node-&gt;BFS_dist, node-&gt;DFS_dist, node-&gt;DFS_dvtm, node-&gt;DFS_fntm );</span>
<a name="l01352"></a>01352 
<a name="l01353"></a>01353                 <a class="code" href="../../d4/d24/depsgraph__private_8h.html#acf4ce9e88412d2859799d3a2b3d1e09f">push_stack</a>(retqueue,node);
<a name="l01354"></a>01354                 
<a name="l01355"></a>01355             }
<a name="l01356"></a>01356         }
<a name="l01357"></a>01357     }
<a name="l01358"></a>01358         node = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>;
<a name="l01359"></a>01359     } <span class="keywordflow">while</span> (node);
<a name="l01360"></a>01360 <span class="comment">//  fprintf(stderr,&quot;i size : %i\n&quot;, maxpos);</span>
<a name="l01361"></a>01361 
<a name="l01362"></a>01362     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a4546a39116f46dea548c9e1195be4cca">queue_delete</a>(nqueue);
<a name="l01363"></a>01363     <span class="keywordflow">return</span>(retqueue);
<a name="l01364"></a>01364 }
<a name="l01365"></a>01365 
<a name="l01366"></a>01366 <span class="comment">/* unused */</span>
<a name="l01367"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#abe80a7b3205e88baa9bff75bad760a10">01367</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ae8f169915b59c04da8f83747361b9d2a">pre_and_post_DFS</a>(<a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *dag, <span class="keywordtype">short</span> mask, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#abc877f3bcb3213641ec89c2dbbdb9e4d">graph_action_func</a> pre_func, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#abc877f3bcb3213641ec89c2dbbdb9e4d">graph_action_func</a> post_func, <span class="keywordtype">void</span> **<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l01368"></a>01368 {
<a name="l01369"></a>01369     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node;
<a name="l01370"></a>01370 
<a name="l01371"></a>01371     node = dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01372"></a>01372     <span class="keywordflow">return</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a0cabfab05372a5aa7a4d8e2c2eb753da">pre_and_post_source_DFS</a>(dag, mask,  node,  pre_func,  post_func, data);
<a name="l01373"></a>01373 }
<a name="l01374"></a>01374 
<a name="l01375"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a22350235b3eaf57740c3bcb939476c21">01375</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a0cabfab05372a5aa7a4d8e2c2eb753da">pre_and_post_source_DFS</a>(<a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *dag, <span class="keywordtype">short</span> mask, <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *source, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#abc877f3bcb3213641ec89c2dbbdb9e4d">graph_action_func</a> pre_func, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#abc877f3bcb3213641ec89c2dbbdb9e4d">graph_action_func</a> post_func, <span class="keywordtype">void</span> **<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>)
<a name="l01376"></a>01376 {
<a name="l01377"></a>01377     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node;
<a name="l01378"></a>01378     <a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *nqueue;
<a name="l01379"></a>01379     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l01380"></a>01380     <span class="keywordtype">int</span> <a class="code" href="../../dc/df7/structDagForest.html#aaaefc447095f622d9ed380e5fc2a9599">time</a>;
<a name="l01381"></a>01381     <span class="keywordtype">int</span> skip = 0;
<a name="l01382"></a>01382     <span class="keywordtype">int</span> retval = 0;
<a name="l01383"></a>01383     <span class="comment">/*</span>
<a name="l01384"></a>01384 <span class="comment">     *fprintf(stderr,&quot;starting DFS\n ------------\n&quot;);</span>
<a name="l01385"></a>01385 <span class="comment">     */</span> 
<a name="l01386"></a>01386     nqueue = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab1df05b5e7c73b0bc403fbb132fe8fba">queue_create</a>(<a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab84f030513d53e1fbd6870d640282a6d">DAGQUEUEALLOC</a>);
<a name="l01387"></a>01387     
<a name="l01388"></a>01388     <span class="comment">/* Init</span>
<a name="l01389"></a>01389 <span class="comment">     * dagnode.first is always the root (scene)</span>
<a name="l01390"></a>01390 <span class="comment">     */</span>
<a name="l01391"></a>01391     node = dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01392"></a>01392     <span class="keywordflow">while</span> (node) {
<a name="l01393"></a>01393         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>;
<a name="l01394"></a>01394         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a> = 9999;
<a name="l01395"></a>01395         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aa67fd938cbd7e0bc32752daa411a866f">DFS_dvtm</a> = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#ad5e04aa24ff4e8470ce2ab544ebf7ed8">DFS_fntm</a> = 9999;
<a name="l01396"></a>01396         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a5328dcbcfe952ea457140cebf16aed28">k</a> = 0;
<a name="l01397"></a>01397         node =  node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>;
<a name="l01398"></a>01398     }
<a name="l01399"></a>01399     
<a name="l01400"></a>01400     time = 1;
<a name="l01401"></a>01401     
<a name="l01402"></a>01402     node = source;
<a name="l01403"></a>01403     <span class="keywordflow">do</span> {
<a name="l01404"></a>01404         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> == <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>) {
<a name="l01405"></a>01405             node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>;
<a name="l01406"></a>01406             node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a> = 1;
<a name="l01407"></a>01407             node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aa67fd938cbd7e0bc32752daa411a866f">DFS_dvtm</a> = <a class="code" href="../../dc/df7/structDagForest.html#aaaefc447095f622d9ed380e5fc2a9599">time</a>;
<a name="l01408"></a>01408             time++;
<a name="l01409"></a>01409             <a class="code" href="../../d4/d24/depsgraph__private_8h.html#acf4ce9e88412d2859799d3a2b3d1e09f">push_stack</a>(nqueue,node);  
<a name="l01410"></a>01410             pre_func(node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>,data);
<a name="l01411"></a>01411 
<a name="l01412"></a>01412             <span class="keywordflow">while</span> (nqueue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a>) {
<a name="l01413"></a>01413                 skip = 0;
<a name="l01414"></a>01414                 node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#abc5d63c9e9f34a5ab16e4b42a9017886">get_top_node_queue</a>(nqueue);
<a name="l01415"></a>01415                                 
<a name="l01416"></a>01416                 itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>;
<a name="l01417"></a>01417                 <span class="keywordflow">while</span> (itA != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01418"></a>01418                     <span class="keywordflow">if</span> ((itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> == <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>) &amp;&amp; (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#ae982b8af4f2faff081dbfada1a26413c">type</a> &amp; mask) ) {
<a name="l01419"></a>01419                         itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aa67fd938cbd7e0bc32752daa411a866f">DFS_dvtm</a> = <a class="code" href="../../dc/df7/structDagForest.html#aaaefc447095f622d9ed380e5fc2a9599">time</a>;
<a name="l01420"></a>01420                         itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>;
<a name="l01421"></a>01421                         
<a name="l01422"></a>01422                         time++;
<a name="l01423"></a>01423                         itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a> = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a3b8e3525f93334ef38bb27edff040a5d">DFS_dist</a> + 1;
<a name="l01424"></a>01424                         <a class="code" href="../../d4/d24/depsgraph__private_8h.html#acf4ce9e88412d2859799d3a2b3d1e09f">push_stack</a>(nqueue,itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>);
<a name="l01425"></a>01425                         pre_func(node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>,data);
<a name="l01426"></a>01426 
<a name="l01427"></a>01427                         skip = 1;
<a name="l01428"></a>01428                         <span class="keywordflow">break</span>;
<a name="l01429"></a>01429                     }
<a name="l01430"></a>01430                     <span class="keywordflow">else</span> {
<a name="l01431"></a>01431                         <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> == <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>) {<span class="comment">// back edge</span>
<a name="l01432"></a>01432                             retval = 1;
<a name="l01433"></a>01433                         }
<a name="l01434"></a>01434 <span class="comment">//                      else if (itA-&gt;node-&gt;color == DAG_BLACK) { // cross or forward</span>
<a name="l01435"></a>01435 <span class="comment">//</span>
<a name="l01436"></a>01436 <span class="comment">//                      }</span>
<a name="l01437"></a>01437                     }
<a name="l01438"></a>01438                     itA = itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>;
<a name="l01439"></a>01439                 }           
<a name="l01440"></a>01440                 
<a name="l01441"></a>01441                 <span class="keywordflow">if</span> (!skip) {
<a name="l01442"></a>01442                     node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a235ae8872ca26849c15091928dd95cc6">pop_queue</a>(nqueue);
<a name="l01443"></a>01443                     node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa75c80a731857e68384b7459fe3f40f22">DAG_BLACK</a>;
<a name="l01444"></a>01444                     
<a name="l01445"></a>01445                     node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#ad5e04aa24ff4e8470ce2ab544ebf7ed8">DFS_fntm</a> = <a class="code" href="../../dc/df7/structDagForest.html#aaaefc447095f622d9ed380e5fc2a9599">time</a>;
<a name="l01446"></a>01446                     time++;
<a name="l01447"></a>01447                     post_func(node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>,data);
<a name="l01448"></a>01448                 }
<a name="l01449"></a>01449             }
<a name="l01450"></a>01450         }
<a name="l01451"></a>01451         node = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>;
<a name="l01452"></a>01452     } <span class="keywordflow">while</span> (node);
<a name="l01453"></a>01453     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a4546a39116f46dea548c9e1195be4cca">queue_delete</a>(nqueue);
<a name="l01454"></a>01454     <span class="keywordflow">return</span>(retval);
<a name="l01455"></a>01455 }
<a name="l01456"></a>01456 
<a name="l01457"></a>01457 
<a name="l01458"></a>01458 <span class="comment">// used to get the obs owning a datablock</span>
<a name="l01459"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a9e7422ba95a1b7be7d22c398f4c19b6b">01459</a> <span class="keyword">struct </span><a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a9e7422ba95a1b7be7d22c398f4c19b6b">get_obparents</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *dag, <span class="keywordtype">void</span> *ob) 
<a name="l01460"></a>01460 {
<a name="l01461"></a>01461     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> * node, *node1;
<a name="l01462"></a>01462     <a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *nqueue;
<a name="l01463"></a>01463     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l01464"></a>01464 
<a name="l01465"></a>01465     node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a5096e8e653098096670e32c25b13723f">dag_find_node</a>(dag,ob);
<a name="l01466"></a>01466     <span class="keywordflow">if</span> (node==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01467"></a>01467         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01468"></a>01468     }
<a name="l01469"></a>01469     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a168093b2854d5955780e202de15f8950">ancestor_count</a> == 1) { <span class="comment">// simple case</span>
<a name="l01470"></a>01470         nqueue = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab1df05b5e7c73b0bc403fbb132fe8fba">queue_create</a>(1);
<a name="l01471"></a>01471         <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a335f4bbca178af08d1a1a8472aac9027">push_queue</a>(nqueue,node);
<a name="l01472"></a>01472     }
<a name="l01473"></a>01473     <span class="keywordflow">else</span> { <span class="comment">/* need to go over the whole dag for adj list */</span>
<a name="l01474"></a>01474         nqueue = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab1df05b5e7c73b0bc403fbb132fe8fba">queue_create</a>(node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a168093b2854d5955780e202de15f8950">ancestor_count</a>);
<a name="l01475"></a>01475         
<a name="l01476"></a>01476         node1 = dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01477"></a>01477         <span class="keywordflow">do</span> {
<a name="l01478"></a>01478             <span class="keywordflow">if</span> (node1-&gt;<a class="code" href="../../d5/d07/structDagNode.html#ad5e04aa24ff4e8470ce2ab544ebf7ed8">DFS_fntm</a> &gt; node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#ad5e04aa24ff4e8470ce2ab544ebf7ed8">DFS_fntm</a>) { <span class="comment">// a parent is finished after child. must check adj list</span>
<a name="l01479"></a>01479                 itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>;
<a name="l01480"></a>01480                 <span class="keywordflow">while</span> (itA != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01481"></a>01481                     <span class="keywordflow">if</span> ((itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a> == node) &amp;&amp; (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#ae982b8af4f2faff081dbfada1a26413c">type</a> == <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac7629e2e525bda7cccfdc979424a7612">DAG_RL_DATA</a>)) {
<a name="l01482"></a>01482                         <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a335f4bbca178af08d1a1a8472aac9027">push_queue</a>(nqueue,node);
<a name="l01483"></a>01483                     }
<a name="l01484"></a>01484                     itA = itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>;
<a name="l01485"></a>01485                 }
<a name="l01486"></a>01486             }
<a name="l01487"></a>01487             node1 = node1-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>;
<a name="l01488"></a>01488         } <span class="keywordflow">while</span> (node1);
<a name="l01489"></a>01489     }
<a name="l01490"></a>01490     <span class="keywordflow">return</span> nqueue;
<a name="l01491"></a>01491 }
<a name="l01492"></a>01492 
<a name="l01493"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#ac3ccde33ae80d161402e9a04d115e214">01493</a> <span class="keyword">struct </span><a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac3ccde33ae80d161402e9a04d115e214">get_first_ancestors</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/df7/structDagForest.html">DagForest</a>   *dag, <span class="keywordtype">void</span> *ob)
<a name="l01494"></a>01494 {
<a name="l01495"></a>01495     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> * node, *node1;
<a name="l01496"></a>01496     <a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *nqueue;
<a name="l01497"></a>01497     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l01498"></a>01498     
<a name="l01499"></a>01499     node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a5096e8e653098096670e32c25b13723f">dag_find_node</a>(dag,ob);
<a name="l01500"></a>01500     
<a name="l01501"></a>01501     <span class="comment">// need to go over the whole dag for adj list</span>
<a name="l01502"></a>01502     nqueue = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab1df05b5e7c73b0bc403fbb132fe8fba">queue_create</a>(node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a168093b2854d5955780e202de15f8950">ancestor_count</a>);
<a name="l01503"></a>01503     
<a name="l01504"></a>01504     node1 = dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01505"></a>01505     <span class="keywordflow">do</span> {
<a name="l01506"></a>01506         <span class="keywordflow">if</span> (node1-&gt;<a class="code" href="../../d5/d07/structDagNode.html#ad5e04aa24ff4e8470ce2ab544ebf7ed8">DFS_fntm</a> &gt; node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#ad5e04aa24ff4e8470ce2ab544ebf7ed8">DFS_fntm</a>) { 
<a name="l01507"></a>01507             itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>;
<a name="l01508"></a>01508             <span class="keywordflow">while</span> (itA != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01509"></a>01509                 <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a> == node) {
<a name="l01510"></a>01510                     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a335f4bbca178af08d1a1a8472aac9027">push_queue</a>(nqueue,node);
<a name="l01511"></a>01511                 }
<a name="l01512"></a>01512                 itA = itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>;
<a name="l01513"></a>01513             }
<a name="l01514"></a>01514         }
<a name="l01515"></a>01515         node1 = node1-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>;
<a name="l01516"></a>01516     } <span class="keywordflow">while</span> (node1);
<a name="l01517"></a>01517     
<a name="l01518"></a>01518     <span class="keywordflow">return</span> nqueue;  
<a name="l01519"></a>01519 }
<a name="l01520"></a>01520 
<a name="l01521"></a>01521 <span class="comment">// standard DFS list</span>
<a name="l01522"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#afea6f5bf8ca75c2e2a476731d85f42aa">01522</a> <span class="keyword">struct </span><a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#afea6f5bf8ca75c2e2a476731d85f42aa">get_all_childs</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/df7/structDagForest.html">DagForest</a>    *dag, <span class="keywordtype">void</span> *ob)
<a name="l01523"></a>01523 {
<a name="l01524"></a>01524     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node;
<a name="l01525"></a>01525     <a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *nqueue;
<a name="l01526"></a>01526     <a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *retqueue;
<a name="l01527"></a>01527     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l01528"></a>01528     <span class="keywordtype">int</span> time;
<a name="l01529"></a>01529     <span class="keywordtype">int</span> skip = 0;
<a name="l01530"></a>01530 
<a name="l01531"></a>01531     nqueue = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab1df05b5e7c73b0bc403fbb132fe8fba">queue_create</a>(<a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab84f030513d53e1fbd6870d640282a6d">DAGQUEUEALLOC</a>);
<a name="l01532"></a>01532     retqueue = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab1df05b5e7c73b0bc403fbb132fe8fba">queue_create</a>(dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#a5be425edbfa6fc1b4e1b63b7849b7af6">numNodes</a>); <span class="comment">// was MainDag... why? (ton)</span>
<a name="l01533"></a>01533     
<a name="l01534"></a>01534     node = dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01535"></a>01535     <span class="keywordflow">while</span> (node) {
<a name="l01536"></a>01536         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>;
<a name="l01537"></a>01537         node =  node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>;
<a name="l01538"></a>01538     }
<a name="l01539"></a>01539     
<a name="l01540"></a>01540     time = 1;
<a name="l01541"></a>01541     
<a name="l01542"></a>01542     node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a5096e8e653098096670e32c25b13723f">dag_find_node</a>(dag, ob);   <span class="comment">// could be done in loop above (ton)</span>
<a name="l01543"></a>01543     <span class="keywordflow">if</span> (node) { <span class="comment">// can be null for newly added objects</span>
<a name="l01544"></a>01544         
<a name="l01545"></a>01545         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>;
<a name="l01546"></a>01546         time++;
<a name="l01547"></a>01547         <a class="code" href="../../d4/d24/depsgraph__private_8h.html#acf4ce9e88412d2859799d3a2b3d1e09f">push_stack</a>(nqueue,node);  
<a name="l01548"></a>01548         
<a name="l01549"></a>01549         <span class="keywordflow">while</span> (nqueue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a>) {
<a name="l01550"></a>01550             
<a name="l01551"></a>01551             skip = 0;
<a name="l01552"></a>01552             node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#abc5d63c9e9f34a5ab16e4b42a9017886">get_top_node_queue</a>(nqueue);
<a name="l01553"></a>01553                     
<a name="l01554"></a>01554             itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>;
<a name="l01555"></a>01555             <span class="keywordflow">while</span> (itA != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01556"></a>01556                 <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> == <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>) {
<a name="l01557"></a>01557                     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aa67fd938cbd7e0bc32752daa411a866f">DFS_dvtm</a> = time;
<a name="l01558"></a>01558                     itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>;
<a name="l01559"></a>01559                     
<a name="l01560"></a>01560                     time++;
<a name="l01561"></a>01561                     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#acf4ce9e88412d2859799d3a2b3d1e09f">push_stack</a>(nqueue,itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>);
<a name="l01562"></a>01562                     skip = 1;
<a name="l01563"></a>01563                     <span class="keywordflow">break</span>;
<a name="l01564"></a>01564                 } 
<a name="l01565"></a>01565                 itA = itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>;
<a name="l01566"></a>01566             }           
<a name="l01567"></a>01567             
<a name="l01568"></a>01568             <span class="keywordflow">if</span> (!skip) {
<a name="l01569"></a>01569                 node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a235ae8872ca26849c15091928dd95cc6">pop_queue</a>(nqueue);
<a name="l01570"></a>01570                 node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa75c80a731857e68384b7459fe3f40f22">DAG_BLACK</a>;
<a name="l01571"></a>01571                 
<a name="l01572"></a>01572                 time++;
<a name="l01573"></a>01573                 <a class="code" href="../../d4/d24/depsgraph__private_8h.html#acf4ce9e88412d2859799d3a2b3d1e09f">push_stack</a>(retqueue,node);          
<a name="l01574"></a>01574             }
<a name="l01575"></a>01575         }
<a name="l01576"></a>01576     }
<a name="l01577"></a>01577     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a4546a39116f46dea548c9e1195be4cca">queue_delete</a>(nqueue);
<a name="l01578"></a>01578     <span class="keywordflow">return</span>(retqueue);
<a name="l01579"></a>01579 }
<a name="l01580"></a>01580 
<a name="l01581"></a>01581 <span class="comment">/* unused */</span>
<a name="l01582"></a>01582 <span class="preprocessor">#if 0</span>
<a name="l01583"></a>01583 <span class="preprocessor"></span><span class="keywordtype">short</span>   <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a1bb048cd2f3f072b87be3b7799c81d2c">are_obs_related</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/df7/structDagForest.html">DagForest</a>    *dag, <span class="keywordtype">void</span> *ob1, <span class="keywordtype">void</span> *ob2)
<a name="l01584"></a>01584 {
<a name="l01585"></a>01585     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> * node;
<a name="l01586"></a>01586     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l01587"></a>01587     
<a name="l01588"></a>01588     node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a5096e8e653098096670e32c25b13723f">dag_find_node</a>(dag, ob1);
<a name="l01589"></a>01589     
<a name="l01590"></a>01590     itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>;
<a name="l01591"></a>01591     <span class="keywordflow">while</span> (itA != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01592"></a>01592         <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a> == ob2) {
<a name="l01593"></a>01593             <span class="keywordflow">return</span> itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a725e3c7b1bf69d904015fb59702be828">type</a>;
<a name="l01594"></a>01594         } 
<a name="l01595"></a>01595         itA = itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>;
<a name="l01596"></a>01596     }
<a name="l01597"></a>01597     <span class="keywordflow">return</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aa3469d8c3d29a0ce84ce798bca0e56ae">DAG_NO_RELATION</a>;
<a name="l01598"></a>01598 }
<a name="l01599"></a>01599 <span class="preprocessor">#endif</span>
<a name="l01600"></a>01600 <span class="preprocessor"></span>
<a name="l01601"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a74fe3e04eb9c13104ecc03a3b58c5f20">01601</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ae99661d85b7fcf269f5d17149b1907ff">is_acyclic</a>( <a class="code" href="../../dc/df7/structDagForest.html">DagForest</a>   *dag)
<a name="l01602"></a>01602 {
<a name="l01603"></a>01603     <span class="keywordflow">return</span> dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#a82cf6da8b6f2233c0eb9fdad929258b0">is_acyclic</a>;
<a name="l01604"></a>01604 }
<a name="l01605"></a>01605 
<a name="l01606"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a6a6a2e93bd565675553f8499edbdcead">01606</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a6a6a2e93bd565675553f8499edbdcead">set_node_xy</a>(<a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node, <span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y)
<a name="l01607"></a>01607 {
<a name="l01608"></a>01608     node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a1fbda577a60f15347b08e71bc46b847f">x</a> = x;
<a name="l01609"></a>01609     node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a9e8329562a0a3140638ccd134fce30af">y</a> = y;
<a name="l01610"></a>01610 }
<a name="l01611"></a>01611 
<a name="l01612"></a>01612 
<a name="l01613"></a>01613 <span class="comment">/* debug test functions */</span>
<a name="l01614"></a>01614 
<a name="l01615"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a1ff939ccc366192e1eb4c48cddeeb8fd">01615</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a1ff939ccc366192e1eb4c48cddeeb8fd">graph_print_queue</a>(<a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *nqueue)
<a name="l01616"></a>01616 {   
<a name="l01617"></a>01617     <a class="code" href="../../d4/d39/structDagNodeQueueElem.html">DagNodeQueueElem</a> *queueElem;
<a name="l01618"></a>01618     
<a name="l01619"></a>01619     queueElem = nqueue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a>;
<a name="l01620"></a>01620     <span class="keywordflow">while</span> (queueElem) {
<a name="l01621"></a>01621         fprintf(stderr,<span class="stringliteral">&quot;** %s %i %i-%i &quot;</span>,((<a class="code" href="../../d8/d7e/structID.html">ID</a> *) queueElem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>)-&gt;name,queueElem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a>,queueElem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aa67fd938cbd7e0bc32752daa411a866f">DFS_dvtm</a>,queueElem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#ad5e04aa24ff4e8470ce2ab544ebf7ed8">DFS_fntm</a>);
<a name="l01622"></a>01622         queueElem = queueElem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a>;        
<a name="l01623"></a>01623     }
<a name="l01624"></a>01624     fprintf(stderr,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01625"></a>01625 }
<a name="l01626"></a>01626 
<a name="l01627"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#aea07ba14b1942b8036273acbbff5550f">01627</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aea07ba14b1942b8036273acbbff5550f">graph_print_queue_dist</a>(<a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *nqueue)
<a name="l01628"></a>01628 {   
<a name="l01629"></a>01629     <a class="code" href="../../d4/d39/structDagNodeQueueElem.html">DagNodeQueueElem</a> *queueElem;
<a name="l01630"></a>01630     <span class="keywordtype">int</span> <a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a>;
<a name="l01631"></a>01631     
<a name="l01632"></a>01632     queueElem = nqueue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#a6e5fda4706c6a16147af5338318940b6">first</a>;
<a name="l01633"></a>01633     count = 0;
<a name="l01634"></a>01634     <span class="keywordflow">while</span> (queueElem) {
<a name="l01635"></a>01635         fprintf(stderr,<span class="stringliteral">&quot;** %25s %2.2i-%2.2i &quot;</span>,((<a class="code" href="../../d8/d7e/structID.html">ID</a> *) queueElem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>)-&gt;name,queueElem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aa67fd938cbd7e0bc32752daa411a866f">DFS_dvtm</a>,queueElem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#a7f74e555233a3fc221c066f7b51d6d8e">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#ad5e04aa24ff4e8470ce2ab544ebf7ed8">DFS_fntm</a>);
<a name="l01636"></a>01636         <span class="keywordflow">while</span> (count &lt; queueElem-&gt;node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aa67fd938cbd7e0bc32752daa411a866f">DFS_dvtm</a>-1) { fputc(<span class="charliteral">&#39; &#39;</span>,stderr); count++;}
<a name="l01637"></a>01637         fputc(<span class="charliteral">&#39;|&#39;</span>,stderr); 
<a name="l01638"></a>01638         <span class="keywordflow">while</span> (count &lt; queueElem-&gt;node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#ad5e04aa24ff4e8470ce2ab544ebf7ed8">DFS_fntm</a>-2) { fputc(<span class="charliteral">&#39;-&#39;</span>,stderr); count++;}
<a name="l01639"></a>01639         fputc(<span class="charliteral">&#39;|&#39;</span>,stderr);
<a name="l01640"></a>01640         fputc(<span class="charliteral">&#39;\n&#39;</span>,stderr);
<a name="l01641"></a>01641         count = 0;
<a name="l01642"></a>01642         queueElem = queueElem-&gt;<a class="code" href="../../d4/d39/structDagNodeQueueElem.html#ae25ab7f47a5a40b555904e62e3c0abf0">next</a>;        
<a name="l01643"></a>01643     }
<a name="l01644"></a>01644     fprintf(stderr,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01645"></a>01645 }
<a name="l01646"></a>01646 
<a name="l01647"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a049dc051ee6cf9462d4daec85cff5f0a">01647</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a049dc051ee6cf9462d4daec85cff5f0a">graph_print_adj_list</a>(<span class="keywordtype">void</span>)
<a name="l01648"></a>01648 {
<a name="l01649"></a>01649     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node;
<a name="l01650"></a>01650     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l01651"></a>01651     
<a name="l01652"></a>01652     node = (<a class="code" href="../../d4/d24/depsgraph__private_8h.html#aa6926cc8679f277f945ae3dab784a1be">getMainDag</a>())-&gt;<a class="code" href="../../d5/d07/structDagNode.html">DagNode</a>.first;
<a name="l01653"></a>01653     while (node) {
<a name="l01654"></a>01654         fprintf(stderr,<span class="stringliteral">&quot;node : %s col: %i&quot;</span>,((<a class="code" href="../../d8/d7e/structID.html">ID</a> *) node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>)-&gt;name, node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a>);       
<a name="l01655"></a>01655         itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>;
<a name="l01656"></a>01656         <span class="keywordflow">while</span> (itA) {
<a name="l01657"></a>01657             fprintf(stderr,<span class="stringliteral">&quot;-- %s &quot;</span>,((<a class="code" href="../../d8/d7e/structID.html">ID</a> *) itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>)-&gt;name);
<a name="l01658"></a>01658             
<a name="l01659"></a>01659             itA = itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>;
<a name="l01660"></a>01660         }
<a name="l01661"></a>01661         fprintf(stderr,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01662"></a>01662         node = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>;
<a name="l01663"></a>01663     }
<a name="l01664"></a>01664 }
<a name="l01665"></a>01665 
<a name="l01666"></a>01666 <span class="comment">/* ************************ API *********************** */</span>
<a name="l01667"></a>01667 
<a name="l01668"></a>01668 <span class="comment">/* mechanism to allow editors to be informed of depsgraph updates,</span>
<a name="l01669"></a>01669 <span class="comment"> * to do their own updates based on changes... */</span>
<a name="l01670"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a4039652e56fed1de11a25bdd80c087d4">01670</a> <span class="keyword">static</span> void (*<a class="code" href="../../dc/d2f/depsgraph_8c.html#a4039652e56fed1de11a25bdd80c087d4">EditorsUpdateIDCb</a>)(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d8/d7e/structID.html">ID</a> *id)= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01671"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#ae4efe87d55357aa9027685de359d1c24">01671</a> <span class="keyword">static</span> void (*<a class="code" href="../../dc/d2f/depsgraph_8c.html#ae4efe87d55357aa9027685de359d1c24">EditorsUpdateSceneCb</a>)(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <span class="keywordtype">int</span> updated)= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01672"></a>01672 
<a name="l01673"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#ac90daccf7cd833f5dec80b1f62c60240">01673</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aa17eb9fd6e70667c096d71767d637345">DAG_editors_update_cb</a>(<span class="keywordtype">void</span> (*id_func)(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>), <span class="keywordtype">void</span> (*scene_func)(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <span class="keywordtype">int</span> updated))
<a name="l01674"></a>01674 {
<a name="l01675"></a>01675     <a class="code" href="../../dc/d2f/depsgraph_8c.html#a4039652e56fed1de11a25bdd80c087d4">EditorsUpdateIDCb</a>= id_func;
<a name="l01676"></a>01676     <a class="code" href="../../dc/d2f/depsgraph_8c.html#ae4efe87d55357aa9027685de359d1c24">EditorsUpdateSceneCb</a>= scene_func;
<a name="l01677"></a>01677 }
<a name="l01678"></a>01678 
<a name="l01679"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a0cb21a85d58c9b2d44aab8d7037aa92a">01679</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#a0cb21a85d58c9b2d44aab8d7037aa92a">dag_editors_id_update</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>)
<a name="l01680"></a>01680 {
<a name="l01681"></a>01681     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d2f/depsgraph_8c.html#a4039652e56fed1de11a25bdd80c087d4">EditorsUpdateIDCb</a>)
<a name="l01682"></a>01682         <a class="code" href="../../dc/d2f/depsgraph_8c.html#a4039652e56fed1de11a25bdd80c087d4">EditorsUpdateIDCb</a>(bmain, <span class="keywordtype">id</span>);
<a name="l01683"></a>01683 }
<a name="l01684"></a>01684 
<a name="l01685"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a4c6aae9a031976e65f93b39d65219cab">01685</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#a4c6aae9a031976e65f93b39d65219cab">dag_editors_scene_update</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <span class="keywordtype">int</span> updated)
<a name="l01686"></a>01686 {
<a name="l01687"></a>01687     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d2f/depsgraph_8c.html#ae4efe87d55357aa9027685de359d1c24">EditorsUpdateSceneCb</a>)
<a name="l01688"></a>01688         <a class="code" href="../../dc/d2f/depsgraph_8c.html#ae4efe87d55357aa9027685de359d1c24">EditorsUpdateSceneCb</a>(bmain, scene, updated);
<a name="l01689"></a>01689 }
<a name="l01690"></a>01690 
<a name="l01691"></a>01691 <span class="comment">/* groups with objects in this scene need to be put in the right order as well */</span>
<a name="l01692"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a1fec96cb03754389f38b487aa66e4f0f">01692</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#a1fec96cb03754389f38b487aa66e4f0f">scene_sort_groups</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce)
<a name="l01693"></a>01693 {
<a name="l01694"></a>01694     <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l01695"></a>01695     <a class="code" href="../../d4/d91/structGroup.html">Group</a> *group;
<a name="l01696"></a>01696     <a class="code" href="../../d3/d3b/structGroupObject.html">GroupObject</a> *go;
<a name="l01697"></a>01697     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l01698"></a>01698     
<a name="l01699"></a>01699     <span class="comment">/* test; are group objects all in this scene? */</span>
<a name="l01700"></a>01700     <span class="keywordflow">for</span> (ob= bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01701"></a>01701         ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp;= ~<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a41fa8f648966e669ab4da5b359bd7d57">LIB_DOIT</a>;
<a name="l01702"></a>01702         ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a96fb6af141bd029b29a0fe1fc69775d8">newid</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">/* newid abuse for GroupObject */</span>
<a name="l01703"></a>01703     }
<a name="l01704"></a>01704     <span class="keywordflow">for</span> (base = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; base; base= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a25befa992d0ce8876b7d62176212be68">next</a>)
<a name="l01705"></a>01705         base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> |= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a41fa8f648966e669ab4da5b359bd7d57">LIB_DOIT</a>;
<a name="l01706"></a>01706     
<a name="l01707"></a>01707     <span class="keywordflow">for</span> (group= bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a267e87055868d88574ec121db05cc8c7">group</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; group; group= group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01708"></a>01708         <span class="keywordflow">for</span> (go= group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ad757bf69b6fd15b1d4e0980089d13be1">gobject</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; go; go= go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#a81e7437ba90ec95c5fbb96e17e6a203d">next</a>) {
<a name="l01709"></a>01709             <span class="keywordflow">if</span> ((go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a41fa8f648966e669ab4da5b359bd7d57">LIB_DOIT</a>)==0)
<a name="l01710"></a>01710                 <span class="keywordflow">break</span>;
<a name="l01711"></a>01711         }
<a name="l01712"></a>01712         <span class="comment">/* this group is entirely in this scene */</span>
<a name="l01713"></a>01713         <span class="keywordflow">if</span> (go==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01714"></a>01714             <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> listb= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01715"></a>01715             
<a name="l01716"></a>01716             <span class="keywordflow">for</span> (go= group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ad757bf69b6fd15b1d4e0980089d13be1">gobject</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; go; go= go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#a81e7437ba90ec95c5fbb96e17e6a203d">next</a>)
<a name="l01717"></a>01717                 go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a96fb6af141bd029b29a0fe1fc69775d8">newid</a>= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)go;
<a name="l01718"></a>01718             
<a name="l01719"></a>01719             <span class="comment">/* in order of sorted bases we reinsert group objects */</span>
<a name="l01720"></a>01720             <span class="keywordflow">for</span> (base = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; base; base= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a25befa992d0ce8876b7d62176212be68">next</a>) {
<a name="l01721"></a>01721                 
<a name="l01722"></a>01722                 <span class="keywordflow">if</span> (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a96fb6af141bd029b29a0fe1fc69775d8">newid</a>) {
<a name="l01723"></a>01723                     go= (<a class="code" href="../../d3/d3b/structGroupObject.html">GroupObject</a> *)base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a96fb6af141bd029b29a0fe1fc69775d8">newid</a>;
<a name="l01724"></a>01724                     base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a96fb6af141bd029b29a0fe1fc69775d8">newid</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01725"></a>01725                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>( &amp;group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ad757bf69b6fd15b1d4e0980089d13be1">gobject</a>, go);
<a name="l01726"></a>01726                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>( &amp;listb, go);
<a name="l01727"></a>01727                 }
<a name="l01728"></a>01728             }
<a name="l01729"></a>01729             <span class="comment">/* copy the newly sorted listbase */</span>
<a name="l01730"></a>01730             group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ad757bf69b6fd15b1d4e0980089d13be1">gobject</a>= listb;
<a name="l01731"></a>01731         }
<a name="l01732"></a>01732     }
<a name="l01733"></a>01733 }
<a name="l01734"></a>01734 
<a name="l01735"></a>01735 <span class="comment">/* sort the base list on dependency order */</span>
<a name="l01736"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a90b96ce66e16f53b30a9e2d8dc5fb01f">01736</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a1916587a9ec19eb3543b1c1bc54a8ded">DAG_scene_sort</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce)
<a name="l01737"></a>01737 {
<a name="l01738"></a>01738     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node, *rootnode;
<a name="l01739"></a>01739     <a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *nqueue;
<a name="l01740"></a>01740     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l01741"></a>01741     <span class="keywordtype">int</span> time;
<a name="l01742"></a>01742     <span class="keywordtype">int</span> skip = 0;
<a name="l01743"></a>01743     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> tempbase;
<a name="l01744"></a>01744     <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l01745"></a>01745     
<a name="l01746"></a>01746     tempbase.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= tempbase.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01747"></a>01747     
<a name="l01748"></a>01748     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a4643e7b018947925ab5801bd36a7af34">build_dag</a>(bmain, sce, <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ab3c18173b4b8ec607e0fff3390c9f3c6">DAG_RL_ALL_BUT_DATA</a>);
<a name="l01749"></a>01749     
<a name="l01750"></a>01750     <a class="code" href="../../dc/d2f/depsgraph_8c.html#a5f3b1c118ce9371f626080ab579a1216">dag_check_cycle</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>);
<a name="l01751"></a>01751 
<a name="l01752"></a>01752     nqueue = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab1df05b5e7c73b0bc403fbb132fe8fba">queue_create</a>(<a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab84f030513d53e1fbd6870d640282a6d">DAGQUEUEALLOC</a>);
<a name="l01753"></a>01753     
<a name="l01754"></a>01754     <span class="keywordflow">for</span> (node = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>) {
<a name="l01755"></a>01755         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>;
<a name="l01756"></a>01756     }
<a name="l01757"></a>01757     
<a name="l01758"></a>01758     time = 1;
<a name="l01759"></a>01759     
<a name="l01760"></a>01760     rootnode = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01761"></a>01761     rootnode-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>;
<a name="l01762"></a>01762     time++;
<a name="l01763"></a>01763     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#acf4ce9e88412d2859799d3a2b3d1e09f">push_stack</a>(nqueue,rootnode);  
<a name="l01764"></a>01764     
<a name="l01765"></a>01765     <span class="keywordflow">while</span> (nqueue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a>) {
<a name="l01766"></a>01766         
<a name="l01767"></a>01767         skip = 0;
<a name="l01768"></a>01768         node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#abc5d63c9e9f34a5ab16e4b42a9017886">get_top_node_queue</a>(nqueue);
<a name="l01769"></a>01769         
<a name="l01770"></a>01770         itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>;
<a name="l01771"></a>01771         <span class="keywordflow">while</span> (itA != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01772"></a>01772             <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> == <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>) {
<a name="l01773"></a>01773                 itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#aa67fd938cbd7e0bc32752daa411a866f">DFS_dvtm</a> = time;
<a name="l01774"></a>01774                 itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>;
<a name="l01775"></a>01775                 
<a name="l01776"></a>01776                 time++;
<a name="l01777"></a>01777                 <a class="code" href="../../d4/d24/depsgraph__private_8h.html#acf4ce9e88412d2859799d3a2b3d1e09f">push_stack</a>(nqueue,itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>);
<a name="l01778"></a>01778                 skip = 1;
<a name="l01779"></a>01779                 <span class="keywordflow">break</span>;
<a name="l01780"></a>01780             } 
<a name="l01781"></a>01781             itA = itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>;
<a name="l01782"></a>01782         }           
<a name="l01783"></a>01783         
<a name="l01784"></a>01784         <span class="keywordflow">if</span> (!skip) {
<a name="l01785"></a>01785             <span class="keywordflow">if</span> (node) {
<a name="l01786"></a>01786                 node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a235ae8872ca26849c15091928dd95cc6">pop_queue</a>(nqueue);
<a name="l01787"></a>01787                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a> == sce)    <span class="comment">// we are done</span>
<a name="l01788"></a>01788                     <span class="keywordflow">break</span>;
<a name="l01789"></a>01789                 node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa75c80a731857e68384b7459fe3f40f22">DAG_BLACK</a>;
<a name="l01790"></a>01790                 
<a name="l01791"></a>01791                 time++;
<a name="l01792"></a>01792                 base = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01793"></a>01793                 <span class="keywordflow">while</span> (base &amp;&amp; base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a> != node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>)
<a name="l01794"></a>01794                     base = base-&gt;<a class="code" href="../../d3/da9/structBase.html#a25befa992d0ce8876b7d62176212be68">next</a>;
<a name="l01795"></a>01795                 <span class="keywordflow">if</span> (base) {
<a name="l01796"></a>01796                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>,base);
<a name="l01797"></a>01797                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#ab5b5ec121d2522c0e8e74e01d6517feb">BLI_addhead</a>(&amp;tempbase,base);
<a name="l01798"></a>01798                 }
<a name="l01799"></a>01799             }   
<a name="l01800"></a>01800         }
<a name="l01801"></a>01801     }
<a name="l01802"></a>01802     
<a name="l01803"></a>01803     <span class="comment">/* temporal correction for circular dependencies */</span>
<a name="l01804"></a>01804     base = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01805"></a>01805     <span class="keywordflow">while</span> (base) {
<a name="l01806"></a>01806         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>,base);
<a name="l01807"></a>01807         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#ab5b5ec121d2522c0e8e74e01d6517feb">BLI_addhead</a>(&amp;tempbase,base);
<a name="l01808"></a>01808         <span class="comment">//if (G.debug &amp; G_DEBUG)</span>
<a name="l01809"></a>01809             printf(<span class="stringliteral">&quot;cyclic %s\n&quot;</span>, base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>);
<a name="l01810"></a>01810         base = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01811"></a>01811     }
<a name="l01812"></a>01812     
<a name="l01813"></a>01813     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a> = tempbase;
<a name="l01814"></a>01814     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a4546a39116f46dea548c9e1195be4cca">queue_delete</a>(nqueue);
<a name="l01815"></a>01815     
<a name="l01816"></a>01816     <span class="comment">/* all groups with objects in this scene gets resorted too */</span>
<a name="l01817"></a>01817     <a class="code" href="../../dc/d2f/depsgraph_8c.html#a1fec96cb03754389f38b487aa66e4f0f">scene_sort_groups</a>(bmain, sce);
<a name="l01818"></a>01818     
<a name="l01819"></a>01819     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635a1207ca157c84a6be5a8a36c691c4aa72">G_DEBUG</a>) {
<a name="l01820"></a>01820         printf(<span class="stringliteral">&quot;\nordered\n&quot;</span>);
<a name="l01821"></a>01821         <span class="keywordflow">for</span> (base = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; base; base= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a25befa992d0ce8876b7d62176212be68">next</a>) {
<a name="l01822"></a>01822             printf(<span class="stringliteral">&quot; %s\n&quot;</span>, base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>);
<a name="l01823"></a>01823         }
<a name="l01824"></a>01824     }
<a name="l01825"></a>01825     <span class="comment">/* temporal...? */</span>
<a name="l01826"></a>01826     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a457596dd51a105fefcea4a00432125cd">recalc</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a0f6b69dc500f6749afd53774456feba2">SCE_PRV_CHANGED</a>; <span class="comment">/* test for 3d preview */</span>
<a name="l01827"></a>01827 }
<a name="l01828"></a>01828 
<a name="l01829"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#acc4e417eba8ab219b21c546bdbb69847">01829</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#acc4e417eba8ab219b21c546bdbb69847">lib_id_recalc_tag</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>)
<a name="l01830"></a>01830 {
<a name="l01831"></a>01831     <span class="keywordtype">id</span>-&gt;flag |= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6495dd702ce79062ae906f5c158d0680">LIB_ID_RECALC</a>;
<a name="l01832"></a>01832     bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#adae8cc21b90be33148ef1f36357eb4cc">id_tag_update</a>[<span class="keywordtype">id</span>-&gt;name[0]] = 1;
<a name="l01833"></a>01833 }
<a name="l01834"></a>01834 
<a name="l01835"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#ac94278c16f03a771ecb2c275bd2a58d1">01835</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#ac94278c16f03a771ecb2c275bd2a58d1">lib_id_recalc_data_tag</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>)
<a name="l01836"></a>01836 {
<a name="l01837"></a>01837     <span class="keywordtype">id</span>-&gt;flag |= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ab8237ab3584d272d3ae2d70c4ee2b040">LIB_ID_RECALC_DATA</a>;
<a name="l01838"></a>01838     bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#adae8cc21b90be33148ef1f36357eb4cc">id_tag_update</a>[<span class="keywordtype">id</span>-&gt;name[0]] = 1;
<a name="l01839"></a>01839 }
<a name="l01840"></a>01840 
<a name="l01841"></a>01841 <span class="comment">/* node was checked to have lasttime != curtime and is if type ID_OB */</span>
<a name="l01842"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#ac2ca7c9d52677dbb5cb8d3490941e36e">01842</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#ac2ca7c9d52677dbb5cb8d3490941e36e">flush_update_node</a>(<a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> layer, <span class="keywordtype">int</span> curtime)
<a name="l01843"></a>01843 {
<a name="l01844"></a>01844     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main;
<a name="l01845"></a>01845     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l01846"></a>01846     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, *obc;
<a name="l01847"></a>01847     <span class="keywordtype">int</span> oldflag, changed=0;
<a name="l01848"></a>01848     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> all_layer;
<a name="l01849"></a>01849     
<a name="l01850"></a>01850     node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a963ba586cfd029488471bfdfbbe246cd">lasttime</a>= curtime;
<a name="l01851"></a>01851     
<a name="l01852"></a>01852     ob= node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>;
<a name="l01853"></a>01853     <span class="keywordflow">if</span> (ob &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a274ab103200853538f1bb3004f8cefa7">OB_RECALC_ALL</a>)) {
<a name="l01854"></a>01854         all_layer= node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#abe3481903f9c3466ad27e746900ffc09">scelay</a>;
<a name="l01855"></a>01855 
<a name="l01856"></a>01856         <span class="comment">/* got an object node that changes, now check relations */</span>
<a name="l01857"></a>01857         <span class="keywordflow">for</span> (itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>; itA; itA= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>) {
<a name="l01858"></a>01858             all_layer |= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a0297a6aeddc9e9868e491c7abfd10690">lay</a>;
<a name="l01859"></a>01859             <span class="comment">/* the relationship is visible */</span>
<a name="l01860"></a>01860             <span class="keywordflow">if</span> ((itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a0297a6aeddc9e9868e491c7abfd10690">lay</a> &amp; layer)) { <span class="comment">// XXX || (itA-&gt;node-&gt;ob == obedit)</span>
<a name="l01861"></a>01861                 <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a725e3c7b1bf69d904015fb59702be828">type</a>==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>) {
<a name="l01862"></a>01862                     obc= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>;
<a name="l01863"></a>01863                     oldflag= obc-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a>;
<a name="l01864"></a>01864                     
<a name="l01865"></a>01865                     <span class="comment">/* got a ob-&gt;obc relation, now check if flag needs flush */</span>
<a name="l01866"></a>01866                     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>) {
<a name="l01867"></a>01867                         <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#ae982b8af4f2faff081dbfada1a26413c">type</a> &amp; <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aea30b95844ae0ec5d78a5e425737ab86">DAG_RL_OB_OB</a>) {
<a name="l01868"></a>01868                             <span class="comment">//printf(&quot;ob %s changes ob %s\n&quot;, ob-&gt;id.name, obc-&gt;id.name);</span>
<a name="l01869"></a>01869                             obc-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>;
<a name="l01870"></a>01870                             <a class="code" href="../../dc/d2f/depsgraph_8c.html#acc4e417eba8ab219b21c546bdbb69847">lib_id_recalc_tag</a>(bmain, &amp;obc-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>);
<a name="l01871"></a>01871                         }
<a name="l01872"></a>01872                         <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#ae982b8af4f2faff081dbfada1a26413c">type</a> &amp; <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aab7d56d2d4b14b85da29c700d3e4cd1c">DAG_RL_OB_DATA</a>) {
<a name="l01873"></a>01873                             <span class="comment">//printf(&quot;ob %s changes obdata %s\n&quot;, ob-&gt;id.name, obc-&gt;id.name);</span>
<a name="l01874"></a>01874                             obc-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l01875"></a>01875                             <a class="code" href="../../dc/d2f/depsgraph_8c.html#ac94278c16f03a771ecb2c275bd2a58d1">lib_id_recalc_data_tag</a>(bmain, &amp;obc-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>);
<a name="l01876"></a>01876                         }
<a name="l01877"></a>01877                     }
<a name="l01878"></a>01878                     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>) {
<a name="l01879"></a>01879                         <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#ae982b8af4f2faff081dbfada1a26413c">type</a> &amp; <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a5e80e3c329f9c5844e8ce3bea32718b5">DAG_RL_DATA_OB</a>) {
<a name="l01880"></a>01880                             <span class="comment">//printf(&quot;obdata %s changes ob %s\n&quot;, ob-&gt;id.name, obc-&gt;id.name);</span>
<a name="l01881"></a>01881                             obc-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>;
<a name="l01882"></a>01882                             <a class="code" href="../../dc/d2f/depsgraph_8c.html#acc4e417eba8ab219b21c546bdbb69847">lib_id_recalc_tag</a>(bmain, &amp;obc-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>);
<a name="l01883"></a>01883                         }
<a name="l01884"></a>01884                         <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#ae982b8af4f2faff081dbfada1a26413c">type</a> &amp; <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac50a2e08e7ef469574148c63cf8cf07c">DAG_RL_DATA_DATA</a>) {
<a name="l01885"></a>01885                             <span class="comment">//printf(&quot;obdata %s changes obdata %s\n&quot;, ob-&gt;id.name, obc-&gt;id.name);</span>
<a name="l01886"></a>01886                             obc-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l01887"></a>01887                             <a class="code" href="../../dc/d2f/depsgraph_8c.html#ac94278c16f03a771ecb2c275bd2a58d1">lib_id_recalc_data_tag</a>(bmain, &amp;obc-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>);
<a name="l01888"></a>01888                         }
<a name="l01889"></a>01889                     }
<a name="l01890"></a>01890                     <span class="keywordflow">if</span> (oldflag!=obc-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a>) changed= 1;
<a name="l01891"></a>01891                 }
<a name="l01892"></a>01892             }
<a name="l01893"></a>01893         }
<a name="l01894"></a>01894         <span class="comment">/* even nicer, we can clear recalc flags...  */</span>
<a name="l01895"></a>01895         <span class="keywordflow">if</span> ((all_layer &amp; layer)==0) { <span class="comment">// XXX &amp;&amp; (ob != obedit)) {</span>
<a name="l01896"></a>01896             <span class="comment">/* but existing displaylists or derivedmesh should be freed */</span>
<a name="l01897"></a>01897             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>)
<a name="l01898"></a>01898                 <a class="code" href="../../df/dac/BKE__object_8h.html#a69f57c15403a8a28d8e90bac4ac78d28">object_free_display</a>(ob);
<a name="l01899"></a>01899             
<a name="l01900"></a>01900             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> &amp;= ~<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a274ab103200853538f1bb3004f8cefa7">OB_RECALC_ALL</a>;
<a name="l01901"></a>01901         }
<a name="l01902"></a>01902     }
<a name="l01903"></a>01903     
<a name="l01904"></a>01904     <span class="comment">/* check case where child changes and parent forcing obdata to change */</span>
<a name="l01905"></a>01905     <span class="comment">/* should be done regardless if this ob has recalc set */</span>
<a name="l01906"></a>01906     <span class="comment">/* could merge this in with loop above...? (ton) */</span>
<a name="l01907"></a>01907     <span class="keywordflow">for</span> (itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>; itA; itA= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>) {
<a name="l01908"></a>01908         <span class="comment">/* the relationship is visible */</span>
<a name="l01909"></a>01909         <span class="keywordflow">if</span> ((itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a0297a6aeddc9e9868e491c7abfd10690">lay</a> &amp; layer)) {       <span class="comment">// XXX  || (itA-&gt;node-&gt;ob == obedit)</span>
<a name="l01910"></a>01910             <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a725e3c7b1bf69d904015fb59702be828">type</a>==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>) {
<a name="l01911"></a>01911                 obc= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>;
<a name="l01912"></a>01912                 <span class="comment">/* child moves */</span>
<a name="l01913"></a>01913                 <span class="keywordflow">if</span> ((obc-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a274ab103200853538f1bb3004f8cefa7">OB_RECALC_ALL</a>)==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>) {
<a name="l01914"></a>01914                     <span class="comment">/* parent has deforming info */</span>
<a name="l01915"></a>01915                     <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#ae982b8af4f2faff081dbfada1a26413c">type</a> &amp; (<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aab7d56d2d4b14b85da29c700d3e4cd1c">DAG_RL_OB_DATA</a>|<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac50a2e08e7ef469574148c63cf8cf07c">DAG_RL_DATA_DATA</a>)) {
<a name="l01916"></a>01916                         <span class="comment">// printf(&quot;parent %s changes ob %s\n&quot;, ob-&gt;id.name, obc-&gt;id.name);</span>
<a name="l01917"></a>01917                         obc-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l01918"></a>01918                         <a class="code" href="../../dc/d2f/depsgraph_8c.html#ac94278c16f03a771ecb2c275bd2a58d1">lib_id_recalc_data_tag</a>(bmain, &amp;obc-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>);
<a name="l01919"></a>01919                     }
<a name="l01920"></a>01920                 }
<a name="l01921"></a>01921             }
<a name="l01922"></a>01922         }
<a name="l01923"></a>01923     }
<a name="l01924"></a>01924     
<a name="l01925"></a>01925     <span class="comment">/* we only go deeper if node not checked or something changed  */</span>
<a name="l01926"></a>01926     <span class="keywordflow">for</span> (itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>; itA; itA= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>) {
<a name="l01927"></a>01927         <span class="keywordflow">if</span> (changed || itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a963ba586cfd029488471bfdfbbe246cd">lasttime</a>!=curtime) 
<a name="l01928"></a>01928             <a class="code" href="../../dc/d2f/depsgraph_8c.html#ac2ca7c9d52677dbb5cb8d3490941e36e">flush_update_node</a>(itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>, layer, curtime);
<a name="l01929"></a>01929     }
<a name="l01930"></a>01930     
<a name="l01931"></a>01931 }
<a name="l01932"></a>01932 
<a name="l01933"></a>01933 <span class="comment">/* node was checked to have lasttime != curtime , and is of type ID_OB */</span>
<a name="l01934"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a7a06709a0b8c70ab09ad7e3f73f1d6ff">01934</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#a7a06709a0b8c70ab09ad7e3f73f1d6ff">flush_layer_node</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce, <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node, <span class="keywordtype">int</span> curtime)
<a name="l01935"></a>01935 {
<a name="l01936"></a>01936     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l01937"></a>01937     
<a name="l01938"></a>01938     node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a963ba586cfd029488471bfdfbbe246cd">lasttime</a>= curtime;
<a name="l01939"></a>01939     node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a7a7e82d81b45ce502993a05b8509025e">lay</a>= node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#abe3481903f9c3466ad27e746900ffc09">scelay</a>;
<a name="l01940"></a>01940     
<a name="l01941"></a>01941     <span class="keywordflow">for</span> (itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>; itA; itA= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>) {
<a name="l01942"></a>01942         <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a725e3c7b1bf69d904015fb59702be828">type</a>==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>) {
<a name="l01943"></a>01943             <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a963ba586cfd029488471bfdfbbe246cd">lasttime</a>!=curtime) {
<a name="l01944"></a>01944                 itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a0297a6aeddc9e9868e491c7abfd10690">lay</a>= <a class="code" href="../../dc/d2f/depsgraph_8c.html#a7a06709a0b8c70ab09ad7e3f73f1d6ff">flush_layer_node</a>(sce, itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>, curtime);  <span class="comment">// lay is only set once for each relation</span>
<a name="l01945"></a>01945             }
<a name="l01946"></a>01946             <span class="keywordflow">else</span> itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a0297a6aeddc9e9868e491c7abfd10690">lay</a>= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a7a7e82d81b45ce502993a05b8509025e">lay</a>;
<a name="l01947"></a>01947             
<a name="l01948"></a>01948             node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a7a7e82d81b45ce502993a05b8509025e">lay</a> |= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a0297a6aeddc9e9868e491c7abfd10690">lay</a>;
<a name="l01949"></a>01949         }
<a name="l01950"></a>01950     }
<a name="l01951"></a>01951 
<a name="l01952"></a>01952     <span class="keywordflow">return</span> node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a7a7e82d81b45ce502993a05b8509025e">lay</a>;
<a name="l01953"></a>01953 }
<a name="l01954"></a>01954 
<a name="l01955"></a>01955 <span class="comment">/* node was checked to have lasttime != curtime , and is of type ID_OB */</span>
<a name="l01956"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#ab3ff80af6bf9c0cb8f0b7bdcf899aee5">01956</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#ab3ff80af6bf9c0cb8f0b7bdcf899aee5">flush_pointcache_reset</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node, <span class="keywordtype">int</span> curtime, <span class="keywordtype">int</span> reset)
<a name="l01957"></a>01957 {
<a name="l01958"></a>01958     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main;
<a name="l01959"></a>01959     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l01960"></a>01960     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l01961"></a>01961     
<a name="l01962"></a>01962     node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a963ba586cfd029488471bfdfbbe246cd">lasttime</a>= curtime;
<a name="l01963"></a>01963     
<a name="l01964"></a>01964     <span class="keywordflow">for</span> (itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>; itA; itA= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>) {
<a name="l01965"></a>01965         <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a725e3c7b1bf69d904015fb59702be828">type</a>==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>) {
<a name="l01966"></a>01966             <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a963ba586cfd029488471bfdfbbe246cd">lasttime</a>!=curtime) {
<a name="l01967"></a>01967                 ob= (<a class="code" href="../../de/de7/structObject.html">Object</a>*)(itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>);
<a name="l01968"></a>01968 
<a name="l01969"></a>01969                 <span class="keywordflow">if</span> (reset || (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a274ab103200853538f1bb3004f8cefa7">OB_RECALC_ALL</a>)) {
<a name="l01970"></a>01970                     <span class="keywordflow">if</span> (<a class="code" href="../../db/d45/BKE__pointcache_8h.html#ad1036d5ae255fe62240ecef0e2a24a85">BKE_ptcache_object_reset</a>(scene, ob, <a class="code" href="../../db/d45/BKE__pointcache_8h.html#aef800351abca5f08a0d90a742a46bce8">PTCACHE_RESET_DEPSGRAPH</a>)) {
<a name="l01971"></a>01971                         ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l01972"></a>01972                         <a class="code" href="../../dc/d2f/depsgraph_8c.html#ac94278c16f03a771ecb2c275bd2a58d1">lib_id_recalc_data_tag</a>(bmain, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>);
<a name="l01973"></a>01973                     }
<a name="l01974"></a>01974 
<a name="l01975"></a>01975                     <a class="code" href="../../dc/d2f/depsgraph_8c.html#ab3ff80af6bf9c0cb8f0b7bdcf899aee5">flush_pointcache_reset</a>(scene, itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>, curtime, 1);
<a name="l01976"></a>01976                 }
<a name="l01977"></a>01977                 <span class="keywordflow">else</span>
<a name="l01978"></a>01978                     <a class="code" href="../../dc/d2f/depsgraph_8c.html#ab3ff80af6bf9c0cb8f0b7bdcf899aee5">flush_pointcache_reset</a>(scene, itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>, curtime, 0);
<a name="l01979"></a>01979             }
<a name="l01980"></a>01980         }
<a name="l01981"></a>01981     }
<a name="l01982"></a>01982 }
<a name="l01983"></a>01983 
<a name="l01984"></a>01984 <span class="comment">/* flush layer flags to dependencies */</span>
<a name="l01985"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a96cb6883f958f7fcaa47539ca5df95c3">01985</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#a96cb6883f958f7fcaa47539ca5df95c3">dag_scene_flush_layers</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce, <span class="keywordtype">int</span> lay)
<a name="l01986"></a>01986 {
<a name="l01987"></a>01987     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node, *firstnode;
<a name="l01988"></a>01988     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l01989"></a>01989     <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l01990"></a>01990     <span class="keywordtype">int</span> lasttime;
<a name="l01991"></a>01991 
<a name="l01992"></a>01992     firstnode= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;  <span class="comment">// always scene node</span>
<a name="l01993"></a>01993 
<a name="l01994"></a>01994     <span class="keywordflow">for</span> (itA = firstnode-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>; itA; itA= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>)
<a name="l01995"></a>01995         itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a0297a6aeddc9e9868e491c7abfd10690">lay</a>= 0;
<a name="l01996"></a>01996 
<a name="l01997"></a>01997     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>-&gt;<a class="code" href="../../dc/df7/structDagForest.html#aaaefc447095f622d9ed380e5fc2a9599">time</a>++;    <span class="comment">// so we know which nodes were accessed</span>
<a name="l01998"></a>01998     lasttime= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>-&gt;<a class="code" href="../../dc/df7/structDagForest.html#aaaefc447095f622d9ed380e5fc2a9599">time</a>;
<a name="l01999"></a>01999 
<a name="l02000"></a>02000     <span class="comment">/* update layer flags in nodes */</span>
<a name="l02001"></a>02001     <span class="keywordflow">for</span> (base= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; base; base= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a25befa992d0ce8876b7d62176212be68">next</a>) {
<a name="l02002"></a>02002         node= <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>, base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>);
<a name="l02003"></a>02003         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#abe3481903f9c3466ad27e746900ffc09">scelay</a>= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa9cfa964651e1e2f3044c9c79cf004b3">lay</a>;
<a name="l02004"></a>02004     }
<a name="l02005"></a>02005 
<a name="l02006"></a>02006     <span class="comment">/* ensure cameras are set as if they are on a visible layer, because</span>
<a name="l02007"></a>02007 <span class="comment">     * they ared still used for rendering or setting the camera view</span>
<a name="l02008"></a>02008 <span class="comment">     *</span>
<a name="l02009"></a>02009 <span class="comment">     * XXX, this wont work for local view / unlocked camera&#39;s */</span>
<a name="l02010"></a>02010     <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>) {
<a name="l02011"></a>02011         node= <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>);
<a name="l02012"></a>02012         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#abe3481903f9c3466ad27e746900ffc09">scelay</a> |= lay;
<a name="l02013"></a>02013     }
<a name="l02014"></a>02014 
<a name="l02015"></a>02015 <span class="preprocessor">#ifdef DURIAN_CAMERA_SWITCH</span>
<a name="l02016"></a>02016 <span class="preprocessor"></span>    {
<a name="l02017"></a>02017         <a class="code" href="../../d2/d3e/structTimeMarker.html">TimeMarker</a> *m;
<a name="l02018"></a>02018 
<a name="l02019"></a>02019         <span class="keywordflow">for</span> (m= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#ad75df026c409d765b297e18f988b9d93">markers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; m; m= m-&gt;<a class="code" href="../../d2/d3e/structTimeMarker.html#ae24b020d13fed8c505c8c6405e31d6a6">next</a>) {
<a name="l02020"></a>02020             <span class="keywordflow">if</span> (m-&gt;<a class="code" href="../../d2/d3e/structTimeMarker.html#a59288a08cb5faa51652fc302366feeab">camera</a>) {
<a name="l02021"></a>02021                 node= <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>, m-&gt;<a class="code" href="../../d2/d3e/structTimeMarker.html#a59288a08cb5faa51652fc302366feeab">camera</a>);
<a name="l02022"></a>02022                 node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#abe3481903f9c3466ad27e746900ffc09">scelay</a> |= lay;
<a name="l02023"></a>02023             }
<a name="l02024"></a>02024         }
<a name="l02025"></a>02025     }
<a name="l02026"></a>02026 <span class="preprocessor">#endif</span>
<a name="l02027"></a>02027 <span class="preprocessor"></span>
<a name="l02028"></a>02028     <span class="comment">/* flush layer nodes to dependencies */</span>
<a name="l02029"></a>02029     <span class="keywordflow">for</span> (itA = firstnode-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>; itA; itA= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>)
<a name="l02030"></a>02030         <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a963ba586cfd029488471bfdfbbe246cd">lasttime</a>!=lasttime &amp;&amp; itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a725e3c7b1bf69d904015fb59702be828">type</a>==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>) 
<a name="l02031"></a>02031             <a class="code" href="../../dc/d2f/depsgraph_8c.html#a7a06709a0b8c70ab09ad7e3f73f1d6ff">flush_layer_node</a>(sce, itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>, lasttime);
<a name="l02032"></a>02032 }
<a name="l02033"></a>02033 
<a name="l02034"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a775565c25c7b6b26f352c3f5e851e307">02034</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#a775565c25c7b6b26f352c3f5e851e307">dag_tag_renderlayers</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lay)
<a name="l02035"></a>02035 {
<a name="l02036"></a>02036     <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>) {
<a name="l02037"></a>02037         <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l02038"></a>02038         <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l02039"></a>02039         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lay_changed= 0;
<a name="l02040"></a>02040         
<a name="l02041"></a>02041         <span class="keywordflow">for</span> (base= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; base; base= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a25befa992d0ce8876b7d62176212be68">next</a>)
<a name="l02042"></a>02042             <span class="keywordflow">if</span> (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a8c3a6cb18ff56393b617978c497c54aa">lay</a> &amp; lay)
<a name="l02043"></a>02043                 <span class="keywordflow">if</span> (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a>)
<a name="l02044"></a>02044                     lay_changed |= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a8c3a6cb18ff56393b617978c497c54aa">lay</a>;
<a name="l02045"></a>02045             
<a name="l02046"></a>02046         <span class="keywordflow">for</span> (node= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l02047"></a>02047             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>==(<a class="code" href="../../d8/d7e/structID.html">ID</a> *)sce) {
<a name="l02048"></a>02048                 <a class="code" href="../../d1/d51/structSceneRenderLayer.html">SceneRenderLayer</a> *srl= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;sce-&gt;r.layers, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a55bc501c3ee93e75427b84f309d9b7">custom1</a>);
<a name="l02049"></a>02049                 <span class="keywordflow">if</span> (srl &amp;&amp; (srl-&gt;<a class="code" href="../../d1/d51/structSceneRenderLayer.html#add5911ed3ed1caae5224b8c063be6939">lay</a> &amp; lay_changed))
<a name="l02050"></a>02050                     <a class="code" href="../../d4/d91/BKE__node_8h.html#a5899bdebefd986150eaa5bfc95641c5b">nodeUpdate</a>(sce-&gt;nodetree, node);
<a name="l02051"></a>02051             }
<a name="l02052"></a>02052         }
<a name="l02053"></a>02053     }
<a name="l02054"></a>02054 }
<a name="l02055"></a>02055 
<a name="l02056"></a>02056 <span class="comment">/* flushes all recalc flags in objects down the dependency tree */</span>
<a name="l02057"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#aad8f7263add65d35615adfa3914bbb4b">02057</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a88902b7d5a72a25969070648a916a053">DAG_scene_flush_update</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lay, <span class="keyword">const</span> <span class="keywordtype">short</span> time)
<a name="l02058"></a>02058 {
<a name="l02059"></a>02059     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *firstnode;
<a name="l02060"></a>02060     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l02061"></a>02061     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l02062"></a>02062     <span class="keywordtype">int</span> lasttime;
<a name="l02063"></a>02063     
<a name="l02064"></a>02064     <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02065"></a>02065         printf(<span class="stringliteral">&quot;DAG zero... not allowed to happen!\n&quot;</span>);
<a name="l02066"></a>02066         <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a1916587a9ec19eb3543b1c1bc54a8ded">DAG_scene_sort</a>(bmain, sce);
<a name="l02067"></a>02067     }
<a name="l02068"></a>02068     
<a name="l02069"></a>02069     firstnode= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;  <span class="comment">// always scene node</span>
<a name="l02070"></a>02070 
<a name="l02071"></a>02071     <span class="comment">/* first we flush the layer flags */</span>
<a name="l02072"></a>02072     <a class="code" href="../../dc/d2f/depsgraph_8c.html#a96cb6883f958f7fcaa47539ca5df95c3">dag_scene_flush_layers</a>(sce, lay);
<a name="l02073"></a>02073 
<a name="l02074"></a>02074     <span class="comment">/* then we use the relationships + layer info to flush update events */</span>
<a name="l02075"></a>02075     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>-&gt;<a class="code" href="../../dc/df7/structDagForest.html#aaaefc447095f622d9ed380e5fc2a9599">time</a>++;    <span class="comment">// so we know which nodes were accessed</span>
<a name="l02076"></a>02076     lasttime= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>-&gt;<a class="code" href="../../dc/df7/structDagForest.html#aaaefc447095f622d9ed380e5fc2a9599">time</a>;
<a name="l02077"></a>02077     <span class="keywordflow">for</span> (itA = firstnode-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>; itA; itA= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>)
<a name="l02078"></a>02078         <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a963ba586cfd029488471bfdfbbe246cd">lasttime</a>!=lasttime &amp;&amp; itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a725e3c7b1bf69d904015fb59702be828">type</a>==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>)
<a name="l02079"></a>02079             <a class="code" href="../../dc/d2f/depsgraph_8c.html#ac2ca7c9d52677dbb5cb8d3490941e36e">flush_update_node</a>(itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>, lay, lasttime);
<a name="l02080"></a>02080 
<a name="l02081"></a>02081     <span class="comment">/* if update is not due to time change, do pointcache clears */</span>
<a name="l02082"></a>02082     <span class="keywordflow">if</span> (!time) {
<a name="l02083"></a>02083         sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>-&gt;<a class="code" href="../../dc/df7/structDagForest.html#aaaefc447095f622d9ed380e5fc2a9599">time</a>++;    <span class="comment">// so we know which nodes were accessed</span>
<a name="l02084"></a>02084         lasttime= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>-&gt;<a class="code" href="../../dc/df7/structDagForest.html#aaaefc447095f622d9ed380e5fc2a9599">time</a>;
<a name="l02085"></a>02085         <span class="keywordflow">for</span> (itA = firstnode-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>; itA; itA= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>) {
<a name="l02086"></a>02086             <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a963ba586cfd029488471bfdfbbe246cd">lasttime</a>!=lasttime &amp;&amp; itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a725e3c7b1bf69d904015fb59702be828">type</a>==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>) {
<a name="l02087"></a>02087                 ob= (<a class="code" href="../../de/de7/structObject.html">Object</a>*)(itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>);
<a name="l02088"></a>02088 
<a name="l02089"></a>02089                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a274ab103200853538f1bb3004f8cefa7">OB_RECALC_ALL</a>) {
<a name="l02090"></a>02090                     <span class="keywordflow">if</span> (<a class="code" href="../../db/d45/BKE__pointcache_8h.html#ad1036d5ae255fe62240ecef0e2a24a85">BKE_ptcache_object_reset</a>(sce, ob, <a class="code" href="../../db/d45/BKE__pointcache_8h.html#aef800351abca5f08a0d90a742a46bce8">PTCACHE_RESET_DEPSGRAPH</a>)) {
<a name="l02091"></a>02091                         ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l02092"></a>02092                         <a class="code" href="../../dc/d2f/depsgraph_8c.html#ac94278c16f03a771ecb2c275bd2a58d1">lib_id_recalc_data_tag</a>(bmain, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>);
<a name="l02093"></a>02093                     }
<a name="l02094"></a>02094 
<a name="l02095"></a>02095                     <a class="code" href="../../dc/d2f/depsgraph_8c.html#ab3ff80af6bf9c0cb8f0b7bdcf899aee5">flush_pointcache_reset</a>(sce, itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>, lasttime, 1);
<a name="l02096"></a>02096                 }
<a name="l02097"></a>02097                 <span class="keywordflow">else</span>
<a name="l02098"></a>02098                     <a class="code" href="../../dc/d2f/depsgraph_8c.html#ab3ff80af6bf9c0cb8f0b7bdcf899aee5">flush_pointcache_reset</a>(sce, itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>, lasttime, 0);
<a name="l02099"></a>02099             }
<a name="l02100"></a>02100         }
<a name="l02101"></a>02101     }
<a name="l02102"></a>02102     
<a name="l02103"></a>02103     <a class="code" href="../../dc/d2f/depsgraph_8c.html#a775565c25c7b6b26f352c3f5e851e307">dag_tag_renderlayers</a>(sce, lay);
<a name="l02104"></a>02104 }
<a name="l02105"></a>02105 
<a name="l02106"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a95308edb97c30bf5104efe70a870fbb2">02106</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#a95308edb97c30bf5104efe70a870fbb2">object_modifiers_use_time</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l02107"></a>02107 {
<a name="l02108"></a>02108     <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md;
<a name="l02109"></a>02109     
<a name="l02110"></a>02110     <span class="comment">/* check if a modifier in modifier stack needs time input */</span>
<a name="l02111"></a>02111     <span class="keywordflow">for</span> (md=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a31fdd585d66951dfd084a8e8ee624a8d">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; md; md=md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a3021bdd74b5a4d99e4ea5ee3a19f8560">next</a>)
<a name="l02112"></a>02112         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d0f/BKE__modifier_8h.html#ac1e3a3078efe625d045fae54b96994df">modifier_dependsOnTime</a>(md))
<a name="l02113"></a>02113             <span class="keywordflow">return</span> 1;
<a name="l02114"></a>02114     
<a name="l02115"></a>02115     <span class="comment">/* check whether any modifiers are animated */</span>
<a name="l02116"></a>02116     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>) {
<a name="l02117"></a>02117         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt = ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>;
<a name="l02118"></a>02118         <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu;
<a name="l02119"></a>02119         
<a name="l02120"></a>02120         <span class="comment">/* action - check for F-Curves with paths containing &#39;modifiers[&#39; */</span>
<a name="l02121"></a>02121         <span class="keywordflow">if</span> (adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>) {
<a name="l02122"></a>02122             <span class="keywordflow">for</span> (fcu = adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>-&gt;<a class="code" href="../../d1/d48/structbAction.html#a17c9f9250f377305171640e7a4aa7666">curves</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; fcu; fcu = fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a381b65464374cad861b80c44b9ae0759">next</a>) {
<a name="l02123"></a>02123                 <span class="keywordflow">if</span> (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a> &amp;&amp; strstr(fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>, <span class="stringliteral">&quot;modifiers[&quot;</span>))
<a name="l02124"></a>02124                     <span class="keywordflow">return</span> 1;
<a name="l02125"></a>02125             }
<a name="l02126"></a>02126         }
<a name="l02127"></a>02127         
<a name="l02128"></a>02128         <span class="comment">/* This here allows modifier properties to get driven and still update properly</span>
<a name="l02129"></a>02129 <span class="comment">         *</span>
<a name="l02130"></a>02130 <span class="comment">         * Workaround to get [#26764] (e.g. subsurf levels not updating when animated/driven)</span>
<a name="l02131"></a>02131 <span class="comment">         * working, without the updating problems ([#28525] [#28690] [#28774] [#28777]) caused</span>
<a name="l02132"></a>02132 <span class="comment">         * by the RNA updates cache introduced in r.38649</span>
<a name="l02133"></a>02133 <span class="comment">         */</span>
<a name="l02134"></a>02134         <span class="keywordflow">for</span> (fcu = adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#aaca565f031ee1209087422d8a5d77769">drivers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; fcu; fcu = fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a381b65464374cad861b80c44b9ae0759">next</a>) {
<a name="l02135"></a>02135             <span class="keywordflow">if</span> (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a> &amp;&amp; strstr(fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>, <span class="stringliteral">&quot;modifiers[&quot;</span>))
<a name="l02136"></a>02136                 <span class="keywordflow">return</span> 1;
<a name="l02137"></a>02137         }
<a name="l02138"></a>02138         
<a name="l02139"></a>02139         <span class="comment">// XXX: also, should check NLA strips, though for now assume that nobody uses</span>
<a name="l02140"></a>02140         <span class="comment">// that and we can omit that for performance reasons...</span>
<a name="l02141"></a>02141     }
<a name="l02142"></a>02142     
<a name="l02143"></a>02143     <span class="keywordflow">return</span> 0;
<a name="l02144"></a>02144 }
<a name="l02145"></a>02145 
<a name="l02146"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#ae321083c1b6461da1ce40040442cb16c">02146</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#ae321083c1b6461da1ce40040442cb16c">animdata_use_time</a>(<a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt)
<a name="l02147"></a>02147 {
<a name="l02148"></a>02148     <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt;
<a name="l02149"></a>02149     
<a name="l02150"></a>02150     <span class="keywordflow">if</span> (adt==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> 0;
<a name="l02151"></a>02151     
<a name="l02152"></a>02152     <span class="comment">/* check action - only if assigned, and it has anim curves */</span>
<a name="l02153"></a>02153     <span class="keywordflow">if</span> (adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a> &amp;&amp; adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>-&gt;<a class="code" href="../../d1/d48/structbAction.html#a17c9f9250f377305171640e7a4aa7666">curves</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)
<a name="l02154"></a>02154         <span class="keywordflow">return</span> 1;
<a name="l02155"></a>02155     
<a name="l02156"></a>02156     <span class="comment">/* check NLA tracks + strips */</span>
<a name="l02157"></a>02157     <span class="keywordflow">for</span> (nlt= adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#ad6e27784ea3b52a7914bc9b00a47b5c1">nla_tracks</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nlt; nlt= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a66180948e7084122081dfb79b212764c">next</a>) {
<a name="l02158"></a>02158         <span class="keywordflow">if</span> (nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)
<a name="l02159"></a>02159             <span class="keywordflow">return</span> 1;
<a name="l02160"></a>02160     }
<a name="l02161"></a>02161     
<a name="l02162"></a>02162     <span class="comment">/* If we have drivers, more likely than not, on a frame change</span>
<a name="l02163"></a>02163 <span class="comment">     * they&#39;ll need updating because their owner changed</span>
<a name="l02164"></a>02164 <span class="comment">     * </span>
<a name="l02165"></a>02165 <span class="comment">     * This is kindof a hack to get around a whole host of problems</span>
<a name="l02166"></a>02166 <span class="comment">     * involving drivers using non-object datablock data (which the </span>
<a name="l02167"></a>02167 <span class="comment">     * depsgraph currently has no way of representing let alone correctly</span>
<a name="l02168"></a>02168 <span class="comment">     * dependency sort+tagging). By doing this, at least we ensure that </span>
<a name="l02169"></a>02169 <span class="comment">     * some commonly attempted drivers (such as scene -&gt; current frame;</span>
<a name="l02170"></a>02170 <span class="comment">     * see &quot;Driver updates fail&quot; thread on Bf-committers dated July 2)</span>
<a name="l02171"></a>02171 <span class="comment">     * will work correctly, and that other non-object datablocks will have</span>
<a name="l02172"></a>02172 <span class="comment">     * their drivers update at least on frame change.</span>
<a name="l02173"></a>02173 <span class="comment">     *</span>
<a name="l02174"></a>02174 <span class="comment">     * -- Aligorith, July 4 2011</span>
<a name="l02175"></a>02175 <span class="comment">     */</span>
<a name="l02176"></a>02176     <span class="keywordflow">if</span> (adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#aaca565f031ee1209087422d8a5d77769">drivers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)
<a name="l02177"></a>02177         <span class="keywordflow">return</span> 1;
<a name="l02178"></a>02178     
<a name="l02179"></a>02179     <span class="keywordflow">return</span> 0;
<a name="l02180"></a>02180 }
<a name="l02181"></a>02181 
<a name="l02182"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a71d5a743995527048c2bd933a6b5a112">02182</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#a71d5a743995527048c2bd933a6b5a112">dag_object_time_update_flags</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l02183"></a>02183 {
<a name="l02184"></a>02184     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l02185"></a>02185         <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l02186"></a>02186         <span class="keywordflow">for</span> (con = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; con; con=con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l02187"></a>02187             <a class="code" href="../../dc/ded/structbConstraintTypeInfo.html">bConstraintTypeInfo</a> *cti= <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#a8eac21e0105e441026a6b7cd7d78030d">constraint_get_typeinfo</a>(con);
<a name="l02188"></a>02188             <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> targets = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l02189"></a>02189             <a class="code" href="../../d5/d78/structbConstraintTarget.html">bConstraintTarget</a> *ct;
<a name="l02190"></a>02190             
<a name="l02191"></a>02191             <span class="keywordflow">if</span> (cti) {
<a name="l02192"></a>02192                 <span class="comment">/* special case for camera tracking -- it doesn&#39;t use targets to define relations */</span>
<a name="l02193"></a>02193                 <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#af4d4e80ea9c413dd7df1b5895ed439f9">type</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a3119d40b7e938fe99cbc91a9c75bdf9e">CONSTRAINT_TYPE_FOLLOWTRACK</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a6add20c4d241c5a886ce8b6b86f363cd">CONSTRAINT_TYPE_CAMERASOLVER</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a3321fd3e52140da450d8f6725b3678af">CONSTRAINT_TYPE_OBJECTSOLVER</a>)) {
<a name="l02194"></a>02194                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>;
<a name="l02195"></a>02195                 }
<a name="l02196"></a>02196                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a25b05ed0f4c02b26dbbc775b47d0b934">get_constraint_targets</a>) {
<a name="l02197"></a>02197                     cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a25b05ed0f4c02b26dbbc775b47d0b934">get_constraint_targets</a>(con, &amp;targets);
<a name="l02198"></a>02198                     
<a name="l02199"></a>02199                     <span class="keywordflow">for</span> (ct= targets.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ct; ct= ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a5ea4a1b1fa4761a30cb66c75a8ac9054">next</a>) {
<a name="l02200"></a>02200                         <span class="keywordflow">if</span> (ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a0f75cb18129bdb2c0aee21ac528b8f5e">tar</a>) {
<a name="l02201"></a>02201                             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>;
<a name="l02202"></a>02202                             <span class="keywordflow">break</span>;
<a name="l02203"></a>02203                         }
<a name="l02204"></a>02204                     }
<a name="l02205"></a>02205                     
<a name="l02206"></a>02206                     <span class="keywordflow">if</span> (cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a5afd4078d269cd49108678e99cca935f">flush_constraint_targets</a>)
<a name="l02207"></a>02207                         cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a5afd4078d269cd49108678e99cca935f">flush_constraint_targets</a>(con, &amp;targets, 1);
<a name="l02208"></a>02208                 }
<a name="l02209"></a>02209                 
<a name="l02210"></a>02210             }
<a name="l02211"></a>02211         }
<a name="l02212"></a>02212     }
<a name="l02213"></a>02213     
<a name="l02214"></a>02214     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>) {
<a name="l02215"></a>02215         <span class="comment">/* motion path or bone child */</span>
<a name="l02216"></a>02216         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a> || ob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>) ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>;
<a name="l02217"></a>02217     }
<a name="l02218"></a>02218     
<a name="l02219"></a>02219 <span class="preprocessor">#if 0 // XXX old animation system</span>
<a name="l02220"></a>02220 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (ob-&gt;nlastrips.first) {
<a name="l02221"></a>02221         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a3f0daef111a437533e48f6209429b49f">dup_group</a>) {
<a name="l02222"></a>02222             <a class="code" href="../../d5/d84/structbActionStrip.html">bActionStrip</a> *strip;
<a name="l02223"></a>02223             <span class="comment">/* this case is for groups with nla, whilst nla target has no action or nla */</span>
<a name="l02224"></a>02224             <span class="keywordflow">for</span> (strip= ob-&gt;nlastrips.first; strip; strip= strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a4db006cf84d35eed981ef557bdd9f126">next</a>) {
<a name="l02225"></a>02225                 <span class="keywordflow">if</span> (strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a1c637ba51a26e1cfe1f946a75043d95e">object</a>)
<a name="l02226"></a>02226                     strip-&gt;<a class="code" href="../../d5/d84/structbActionStrip.html#a1c637ba51a26e1cfe1f946a75043d95e">object</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a274ab103200853538f1bb3004f8cefa7">OB_RECALC_ALL</a>;
<a name="l02227"></a>02227             }
<a name="l02228"></a>02228         }
<a name="l02229"></a>02229     }
<a name="l02230"></a>02230 <span class="preprocessor">#endif // XXX old animation system</span>
<a name="l02231"></a>02231 <span class="preprocessor"></span>    
<a name="l02232"></a>02232     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d2f/depsgraph_8c.html#ae321083c1b6461da1ce40040442cb16c">animdata_use_time</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>)) {
<a name="l02233"></a>02233         ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>;
<a name="l02234"></a>02234         ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a5d3b8f8deeacc6da23fd6adc05ad60e3">recalc</a> |= <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a7cc2212e3e0823a3ce68c0ada63fdca8a1bce4262e3f1016c7b92e1ac709e4bec">ADT_RECALC_ANIM</a>;
<a name="l02235"></a>02235     }
<a name="l02236"></a>02236     
<a name="l02237"></a>02237     <span class="keywordflow">if</span> ((ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>) &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>)) ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l02238"></a>02238     
<a name="l02239"></a>02239     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d2f/depsgraph_8c.html#a95308edb97c30bf5104efe70a870fbb2">object_modifiers_use_time</a>(ob)) ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l02240"></a>02240     <span class="keywordflow">if</span> ((ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>) &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>-&gt;<a class="code" href="../../d3/de4/structbPose.html#a64ec87fedfe2de572e1c5418d9eac677">flag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#adcdc440dbd940088a1e1af80558e483dabc1aed6303fdffb7be9c05c25d5cecf1">POSE_CONSTRAINTS_TIMEDEPEND</a>)) ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l02241"></a>02241     
<a name="l02242"></a>02242     {
<a name="l02243"></a>02243         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l02244"></a>02244         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me;
<a name="l02245"></a>02245         <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu;
<a name="l02246"></a>02246         <a class="code" href="../../dd/d40/structLattice.html">Lattice</a> *lt;
<a name="l02247"></a>02247         
<a name="l02248"></a>02248         <span class="keywordflow">switch</span>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>) {
<a name="l02249"></a>02249             <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>:
<a name="l02250"></a>02250                 me= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l02251"></a>02251                 <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../da/d29/structMesh.html#ad5e8f2b7e52cbc5caf836c656db83589">key</a>) {
<a name="l02252"></a>02252                     <span class="keywordflow">if</span> (!(ob-&gt;<a class="code" href="../../de/de7/structObject.html#af406445af536997110fc334c24854005">shapeflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ad1667fc11fcfbed9a6bef142eeae94ee">OB_SHAPE_LOCK</a>)) {
<a name="l02253"></a>02253                         ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l02254"></a>02254                     }
<a name="l02255"></a>02255                 }
<a name="l02256"></a>02256                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)
<a name="l02257"></a>02257                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l02258"></a>02258                 <span class="keywordflow">break</span>;
<a name="l02259"></a>02259             <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>:
<a name="l02260"></a>02260             <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>:
<a name="l02261"></a>02261                 cu= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l02262"></a>02262                 <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a8d1d301aab8386698526ed56362ff284">key</a>) {
<a name="l02263"></a>02263                     <span class="keywordflow">if</span> (!(ob-&gt;<a class="code" href="../../de/de7/structObject.html#af406445af536997110fc334c24854005">shapeflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ad1667fc11fcfbed9a6bef142eeae94ee">OB_SHAPE_LOCK</a>)) {
<a name="l02264"></a>02264                         ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l02265"></a>02265                     }
<a name="l02266"></a>02266                 }
<a name="l02267"></a>02267                 <span class="keywordflow">break</span>;
<a name="l02268"></a>02268             <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1a94162b6fc469957966a01d41ff71d6">OB_FONT</a>:
<a name="l02269"></a>02269                 cu= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l02270"></a>02270                 <span class="keywordflow">if</span> (cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ac93326a4cc67ccb5d9725bf0ed3432d1">nurb</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#ab0b4dc5959c529381dbc6a954a8a39b6">str</a> &amp;&amp; cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a1735002958cbeb8aaf88094ef6596e78">vfont</a>)
<a name="l02271"></a>02271                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l02272"></a>02272                 <span class="keywordflow">break</span>;
<a name="l02273"></a>02273             <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a648672abc238f500c884f10b9416cb27">OB_LATTICE</a>:
<a name="l02274"></a>02274                 lt= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l02275"></a>02275                 <span class="keywordflow">if</span> (lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#a17c6975adcc7144ed734252d6038b7d5">key</a>) {
<a name="l02276"></a>02276                     <span class="keywordflow">if</span> (!(ob-&gt;<a class="code" href="../../de/de7/structObject.html#af406445af536997110fc334c24854005">shapeflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ad1667fc11fcfbed9a6bef142eeae94ee">OB_SHAPE_LOCK</a>)) {
<a name="l02277"></a>02277                         ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l02278"></a>02278                     }
<a name="l02279"></a>02279                 }
<a name="l02280"></a>02280                     <span class="keywordflow">break</span>;
<a name="l02281"></a>02281             <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a046d883c32490b5c5ca4c5e7b6504e35">OB_MBALL</a>:
<a name="l02282"></a>02282                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1091cd84d4d7227ab41b167e84be3065">transflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a09b56b47e42a59a4266c995ded542ea6">OB_DUPLI</a>) ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l02283"></a>02283                 <span class="keywordflow">break</span>;
<a name="l02284"></a>02284         }
<a name="l02285"></a>02285         
<a name="l02286"></a>02286         <span class="keywordflow">if</span> (<a class="code" href="../../dc/d2f/depsgraph_8c.html#ae321083c1b6461da1ce40040442cb16c">animdata_use_time</a>(adt)) {
<a name="l02287"></a>02287             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l02288"></a>02288             adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a5d3b8f8deeacc6da23fd6adc05ad60e3">recalc</a> |= <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a7cc2212e3e0823a3ce68c0ada63fdca8a1bce4262e3f1016c7b92e1ac709e4bec">ADT_RECALC_ANIM</a>;
<a name="l02289"></a>02289         }
<a name="l02290"></a>02290 
<a name="l02291"></a>02291         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l02292"></a>02292             <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02293"></a>02293 
<a name="l02294"></a>02294             <span class="keywordflow">for</span> (; psys; psys=psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a734228c70c56227c6f7a29145a5f5b57">next</a>) {
<a name="l02295"></a>02295                 <span class="keywordflow">if</span> (<a class="code" href="../../db/dca/BKE__particle_8h.html#ae1ec21bf7aea2fdbe47e71514b97d919">psys_check_enabled</a>(ob, psys)) {
<a name="l02296"></a>02296                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l02297"></a>02297                     <span class="keywordflow">break</span>;
<a name="l02298"></a>02298                 }
<a name="l02299"></a>02299             }
<a name="l02300"></a>02300         }
<a name="l02301"></a>02301     }       
<a name="l02302"></a>02302 
<a name="l02303"></a>02303     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>)
<a name="l02304"></a>02304         <a class="code" href="../../dc/d2f/depsgraph_8c.html#acc4e417eba8ab219b21c546bdbb69847">lib_id_recalc_tag</a>(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>);
<a name="l02305"></a>02305     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>)
<a name="l02306"></a>02306         <a class="code" href="../../dc/d2f/depsgraph_8c.html#ac94278c16f03a771ecb2c275bd2a58d1">lib_id_recalc_data_tag</a>(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>);
<a name="l02307"></a>02307 
<a name="l02308"></a>02308 }
<a name="l02309"></a>02309 <span class="comment">/* flag all objects that need recalc, for changes in time for example */</span>
<a name="l02310"></a>02310 <span class="comment">/* do_time: make this optional because undo resets objects to their animated locations without this */</span>
<a name="l02311"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#abf6e532cbff0e4e7db9930d0b4b136c4">02311</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a876c6c937800c0e665b8e781abbaa65c">DAG_scene_update_flags</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lay, <span class="keyword">const</span> <span class="keywordtype">short</span> do_time)
<a name="l02312"></a>02312 {
<a name="l02313"></a>02313     <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l02314"></a>02314     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l02315"></a>02315     <a class="code" href="../../d4/d91/structGroup.html">Group</a> *group;
<a name="l02316"></a>02316     <a class="code" href="../../d3/d3b/structGroupObject.html">GroupObject</a> *go;
<a name="l02317"></a>02317     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce_iter;
<a name="l02318"></a>02318 
<a name="l02319"></a>02319     <span class="comment">/* set ob flags where animated systems are */</span>
<a name="l02320"></a>02320     <span class="keywordflow">for</span> (<a class="code" href="../../d8/d53/BKE__scene_8h.html#a2ea2c0ff1c9b5bb29c3add65bbaadf2d">SETLOOPER</a>(scene, sce_iter, base)) {
<a name="l02321"></a>02321         ob= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l02322"></a>02322 
<a name="l02323"></a>02323         <span class="keywordflow">if</span> (do_time) {
<a name="l02324"></a>02324             <span class="comment">/* now if DagNode were part of base, the node-&gt;lay could be checked... */</span>
<a name="l02325"></a>02325             <span class="comment">/* we do all now, since the scene_flush checks layers and clears recalc flags even */</span>
<a name="l02326"></a>02326             <a class="code" href="../../dc/d2f/depsgraph_8c.html#a71d5a743995527048c2bd933a6b5a112">dag_object_time_update_flags</a>(ob);
<a name="l02327"></a>02327         }
<a name="l02328"></a>02328 
<a name="l02329"></a>02329         <span class="comment">/* handled in next loop */</span>
<a name="l02330"></a>02330         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a3f0daef111a437533e48f6209429b49f">dup_group</a>)
<a name="l02331"></a>02331             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a3f0daef111a437533e48f6209429b49f">dup_group</a>-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> |= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a41fa8f648966e669ab4da5b359bd7d57">LIB_DOIT</a>;
<a name="l02332"></a>02332     }
<a name="l02333"></a>02333 
<a name="l02334"></a>02334     <span class="keywordflow">if</span> (do_time) {
<a name="l02335"></a>02335         <span class="comment">/* we do groups each once */</span>
<a name="l02336"></a>02336         <span class="keywordflow">for</span> (group= bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a267e87055868d88574ec121db05cc8c7">group</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; group; group= group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02337"></a>02337             <span class="keywordflow">if</span> (group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a41fa8f648966e669ab4da5b359bd7d57">LIB_DOIT</a>) {
<a name="l02338"></a>02338                 <span class="keywordflow">for</span> (go= group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ad757bf69b6fd15b1d4e0980089d13be1">gobject</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; go; go= go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#a81e7437ba90ec95c5fbb96e17e6a203d">next</a>) {
<a name="l02339"></a>02339                     <a class="code" href="../../dc/d2f/depsgraph_8c.html#a71d5a743995527048c2bd933a6b5a112">dag_object_time_update_flags</a>(go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>);
<a name="l02340"></a>02340                 }
<a name="l02341"></a>02341             }
<a name="l02342"></a>02342         }
<a name="l02343"></a>02343     }
<a name="l02344"></a>02344 
<a name="l02345"></a>02345     <span class="keywordflow">for</span> (sce_iter= scene; sce_iter; sce_iter= sce_iter-&gt;<a class="code" href="../../d9/d27/structScene.html#af89a023123108ed72002144681d7621b">set</a>)
<a name="l02346"></a>02346         <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a88902b7d5a72a25969070648a916a053">DAG_scene_flush_update</a>(bmain, sce_iter, lay, 1);
<a name="l02347"></a>02347     
<a name="l02348"></a>02348     <span class="keywordflow">if</span> (do_time) {
<a name="l02349"></a>02349         <span class="comment">/* test: set time flag, to disable baked systems to update */</span>
<a name="l02350"></a>02350         <span class="keywordflow">for</span> (<a class="code" href="../../d8/d53/BKE__scene_8h.html#a2ea2c0ff1c9b5bb29c3add65bbaadf2d">SETLOOPER</a>(scene, sce_iter, base)) {
<a name="l02351"></a>02351             ob= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l02352"></a>02352             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a>)
<a name="l02353"></a>02353                 ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#acd3a68b1b095992c7f50c74a480549bd">OB_RECALC_TIME</a>;
<a name="l02354"></a>02354         }
<a name="l02355"></a>02355 
<a name="l02356"></a>02356         <span class="comment">/* hrmf... an exception to look at once, for invisible camera object we do it over */</span>
<a name="l02357"></a>02357         <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>)
<a name="l02358"></a>02358             <a class="code" href="../../dc/d2f/depsgraph_8c.html#a71d5a743995527048c2bd933a6b5a112">dag_object_time_update_flags</a>(scene-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>);
<a name="l02359"></a>02359     }
<a name="l02360"></a>02360 
<a name="l02361"></a>02361     <span class="comment">/* and store the info in groupobject */</span>
<a name="l02362"></a>02362     <span class="keywordflow">for</span> (group= bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a267e87055868d88574ec121db05cc8c7">group</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; group; group= group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02363"></a>02363         <span class="keywordflow">if</span> (group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a41fa8f648966e669ab4da5b359bd7d57">LIB_DOIT</a>) {
<a name="l02364"></a>02364             <span class="keywordflow">for</span> (go= group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ad757bf69b6fd15b1d4e0980089d13be1">gobject</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; go; go= go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#a81e7437ba90ec95c5fbb96e17e6a203d">next</a>) {
<a name="l02365"></a>02365                 go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#a3a8e40457eb0d9fe128754998eeb8947">recalc</a>= go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a>;
<a name="l02366"></a>02366                 <span class="comment">// printf(&quot;ob %s recalc %d\n&quot;, go-&gt;ob-&gt;id.name, go-&gt;recalc);</span>
<a name="l02367"></a>02367             }
<a name="l02368"></a>02368             group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp;= ~<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a41fa8f648966e669ab4da5b359bd7d57">LIB_DOIT</a>;
<a name="l02369"></a>02369         }
<a name="l02370"></a>02370     }
<a name="l02371"></a>02371     
<a name="l02372"></a>02372 }
<a name="l02373"></a>02373 
<a name="l02374"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#ae685489cfc80a89d81cadcf3f8096040">02374</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#ae685489cfc80a89d81cadcf3f8096040">dag_current_scene_layers</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d9/d27/structScene.html">Scene</a> **sce, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *lay)
<a name="l02375"></a>02375 {
<a name="l02376"></a>02376     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm;
<a name="l02377"></a>02377     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win;
<a name="l02378"></a>02378 
<a name="l02379"></a>02379     <span class="comment">/* only one scene supported currently, making more scenes work</span>
<a name="l02380"></a>02380 <span class="comment">     * correctly requires changes beyond just the dependency graph */</span>
<a name="l02381"></a>02381 
<a name="l02382"></a>02382     *sce= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02383"></a>02383     *lay= 0;
<a name="l02384"></a>02384 
<a name="l02385"></a>02385     <span class="keywordflow">if</span> ((wm= bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a1c415972a9fb2c7ce05e14d83affa0d8">wm</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)) {
<a name="l02386"></a>02386         <span class="comment">/* if we have a windowmanager, look into windows */</span>
<a name="l02387"></a>02387         <span class="keywordflow">for</span> (win=wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; win; win=win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#accffa1b62f114b1781206c921fc92be1">next</a>) {
<a name="l02388"></a>02388             <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>) {
<a name="l02389"></a>02389                 <span class="keywordflow">if</span> (!*sce) *sce= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>;
<a name="l02390"></a>02390                 *lay |= <a class="code" href="../../d7/da3/BKE__screen_8h.html#aa01d3cce8b25da5eacfabe216561211e">BKE_screen_visible_layers</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>);
<a name="l02391"></a>02391             }
<a name="l02392"></a>02392         }
<a name="l02393"></a>02393     }
<a name="l02394"></a>02394     <span class="keywordflow">else</span> {
<a name="l02395"></a>02395         <span class="comment">/* if not, use the first sce */</span>
<a name="l02396"></a>02396         *sce= bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02397"></a>02397         <span class="keywordflow">if</span> (*sce) *lay= (*sce)-&gt;lay;
<a name="l02398"></a>02398 
<a name="l02399"></a>02399         <span class="comment">/* XXX for background mode, we should get the scene</span>
<a name="l02400"></a>02400 <span class="comment">         * from somewhere, for the -S option, but it&#39;s in</span>
<a name="l02401"></a>02401 <span class="comment">         * the context, how to get it here? */</span>
<a name="l02402"></a>02402     }
<a name="l02403"></a>02403 }
<a name="l02404"></a>02404 
<a name="l02405"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a6b925cc3111d312b431b4bed98fc7f63">02405</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac7bea022d30913f94c94aff54e0fc186">DAG_ids_flush_update</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <span class="keywordtype">int</span> time)
<a name="l02406"></a>02406 {
<a name="l02407"></a>02407     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l02408"></a>02408     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lay;
<a name="l02409"></a>02409 
<a name="l02410"></a>02410     <a class="code" href="../../dc/d2f/depsgraph_8c.html#ae685489cfc80a89d81cadcf3f8096040">dag_current_scene_layers</a>(bmain, &amp;sce, &amp;lay);
<a name="l02411"></a>02411 
<a name="l02412"></a>02412     <span class="keywordflow">if</span> (sce)
<a name="l02413"></a>02413         <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a88902b7d5a72a25969070648a916a053">DAG_scene_flush_update</a>(bmain, sce, lay, time);
<a name="l02414"></a>02414 }
<a name="l02415"></a>02415 
<a name="l02416"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#aa8b01fdae0255f6d38420ed4d3486f6a">02416</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a0dc07bc7e606045d217961fce6565efb">DAG_on_visible_update</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <span class="keyword">const</span> <span class="keywordtype">short</span> do_time)
<a name="l02417"></a>02417 {
<a name="l02418"></a>02418     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene;
<a name="l02419"></a>02419     <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l02420"></a>02420     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l02421"></a>02421     <a class="code" href="../../d4/d91/structGroup.html">Group</a> *group;
<a name="l02422"></a>02422     <a class="code" href="../../d3/d3b/structGroupObject.html">GroupObject</a> *go;
<a name="l02423"></a>02423     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node;
<a name="l02424"></a>02424     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lay, oblay;
<a name="l02425"></a>02425 
<a name="l02426"></a>02426     <a class="code" href="../../dc/d2f/depsgraph_8c.html#ae685489cfc80a89d81cadcf3f8096040">dag_current_scene_layers</a>(bmain, &amp;scene, &amp;lay);
<a name="l02427"></a>02427 
<a name="l02428"></a>02428     <span class="keywordflow">if</span> (scene &amp;&amp; scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>) {
<a name="l02429"></a>02429         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce_iter;
<a name="l02430"></a>02430         <span class="comment">/* derivedmeshes and displists are not saved to file so need to be</span>
<a name="l02431"></a>02431 <span class="comment">         * remade, tag them so they get remade in the scene update loop,</span>
<a name="l02432"></a>02432 <span class="comment">         * note armature poses or object matrices are preserved and do not</span>
<a name="l02433"></a>02433 <span class="comment">         * require updates, so we skip those */</span>
<a name="l02434"></a>02434         <a class="code" href="../../dc/d2f/depsgraph_8c.html#a96cb6883f958f7fcaa47539ca5df95c3">dag_scene_flush_layers</a>(scene, lay);
<a name="l02435"></a>02435 
<a name="l02436"></a>02436         <span class="keywordflow">for</span> (<a class="code" href="../../d8/d53/BKE__scene_8h.html#a2ea2c0ff1c9b5bb29c3add65bbaadf2d">SETLOOPER</a>(scene, sce_iter, base)) {
<a name="l02437"></a>02437             ob= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l02438"></a>02438             node= (sce_iter-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>)? <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(sce_iter-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>, ob): <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02439"></a>02439             oblay= (node)? node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a7a7e82d81b45ce502993a05b8509025e">lay</a>: ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa9cfa964651e1e2f3044c9c79cf004b3">lay</a>;
<a name="l02440"></a>02440 
<a name="l02441"></a>02441             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> ((oblay &amp; lay) &amp; ~scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a65b906a7684131113d6b138e3cd57d3e">lay_updated</a>) {
<a name="l02442"></a>02442                 <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af6e74e8b44bfc993fdfb379311137874">ELEM6</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1a94162b6fc469957966a01d41ff71d6">OB_FONT</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a046d883c32490b5c5ca4c5e7b6504e35">OB_MBALL</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a648672abc238f500c884f10b9416cb27">OB_LATTICE</a>))
<a name="l02443"></a>02443                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l02444"></a>02444                 <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a3f0daef111a437533e48f6209429b49f">dup_group</a>) 
<a name="l02445"></a>02445                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#a3f0daef111a437533e48f6209429b49f">dup_group</a>-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> |= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a41fa8f648966e669ab4da5b359bd7d57">LIB_DOIT</a>;
<a name="l02446"></a>02446             }
<a name="l02447"></a>02447         }
<a name="l02448"></a>02448 
<a name="l02449"></a>02449         <span class="keywordflow">for</span> (group= bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a267e87055868d88574ec121db05cc8c7">group</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; group; group= group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02450"></a>02450             <span class="keywordflow">if</span> (group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a41fa8f648966e669ab4da5b359bd7d57">LIB_DOIT</a>) {
<a name="l02451"></a>02451                 <span class="keywordflow">for</span> (go= group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ad757bf69b6fd15b1d4e0980089d13be1">gobject</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; go; go= go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#a81e7437ba90ec95c5fbb96e17e6a203d">next</a>) {
<a name="l02452"></a>02452                     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af6e74e8b44bfc993fdfb379311137874">ELEM6</a>(go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1a94162b6fc469957966a01d41ff71d6">OB_FONT</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a046d883c32490b5c5ca4c5e7b6504e35">OB_MBALL</a>, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a648672abc238f500c884f10b9416cb27">OB_LATTICE</a>))
<a name="l02453"></a>02453                         go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l02454"></a>02454                     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a3d2c2164b03db46f65597e44ac6f9a06">proxy_from</a>)
<a name="l02455"></a>02455                         go-&gt;<a class="code" href="../../d3/d3b/structGroupObject.html#aeafe134dbf1980f42045d1fc191f2967">ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>;
<a name="l02456"></a>02456                 }
<a name="l02457"></a>02457                 
<a name="l02458"></a>02458                 group-&gt;<a class="code" href="../../d4/d91/structGroup.html#ab7e17dc53d15eeb5f6c4c7789d92b969">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp;= ~<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a41fa8f648966e669ab4da5b359bd7d57">LIB_DOIT</a>;
<a name="l02459"></a>02459             }
<a name="l02460"></a>02460         }
<a name="l02461"></a>02461 
<a name="l02462"></a>02462         <span class="comment">/* now tag update flags, to ensure deformers get calculated on redraw */</span>
<a name="l02463"></a>02463         <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a876c6c937800c0e665b8e781abbaa65c">DAG_scene_update_flags</a>(bmain, scene, lay, do_time);
<a name="l02464"></a>02464         scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a65b906a7684131113d6b138e3cd57d3e">lay_updated</a> |= lay;
<a name="l02465"></a>02465     }
<a name="l02466"></a>02466 
<a name="l02467"></a>02467     <span class="comment">/* hack to get objects updating on layer changes */</span>
<a name="l02468"></a>02468     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a719c20d89827ac9351f0d2b5e55e54a8">DAG_id_type_tag</a>(bmain, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>);
<a name="l02469"></a>02469 }
<a name="l02470"></a>02470 
<a name="l02471"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a79c94719e8c7d868950468fecf528044">02471</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#a79c94719e8c7d868950468fecf528044">dag_id_flush_update__isDependentTexture</a>(<span class="keywordtype">void</span> *userData, <a class="code" href="../../de/de7/structObject.html">Object</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(ob), <a class="code" href="../../d8/d7e/structID.html">ID</a> **idpoin)
<a name="l02472"></a>02472 {
<a name="l02473"></a>02473     <span class="keyword">struct </span>{ <a class="code" href="../../d8/d7e/structID.html">ID</a> *id; <span class="keywordtype">int</span> is_dependent; } *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = userData;
<a name="l02474"></a>02474     
<a name="l02475"></a>02475     <span class="keywordflow">if</span> (*idpoin &amp;&amp; <a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>((*idpoin)-&gt;name)==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac850344bf7854d7860b43adb1e65e228">ID_TE</a>) {
<a name="l02476"></a>02476         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>-&gt;id == (*idpoin))
<a name="l02477"></a>02477             <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>-&gt;is_dependent = 1;
<a name="l02478"></a>02478     }
<a name="l02479"></a>02479 }
<a name="l02480"></a>02480 
<a name="l02481"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a19e8da7b38a14f7b567379cfaea92247">02481</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d2f/depsgraph_8c.html#a19e8da7b38a14f7b567379cfaea92247">dag_id_flush_update</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>)
<a name="l02482"></a>02482 {
<a name="l02483"></a>02483     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main;
<a name="l02484"></a>02484     <a class="code" href="../../de/de7/structObject.html">Object</a> *obt, *ob= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02485"></a>02485     <span class="keywordtype">short</span> idtype;
<a name="l02486"></a>02486 
<a name="l02487"></a>02487     <span class="comment">/* here we flush a few things before actual scene wide flush, mostly</span>
<a name="l02488"></a>02488 <span class="comment">     * due to only objects and not other datablocks being in the depsgraph */</span>
<a name="l02489"></a>02489 
<a name="l02490"></a>02490     <span class="comment">/* set flags &amp; pointcache for object */</span>
<a name="l02491"></a>02491     <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>) == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>) {
<a name="l02492"></a>02492         ob= (<a class="code" href="../../de/de7/structObject.html">Object</a>*)<span class="keywordtype">id</span>;
<a name="l02493"></a>02493         <a class="code" href="../../db/d45/BKE__pointcache_8h.html#ad1036d5ae255fe62240ecef0e2a24a85">BKE_ptcache_object_reset</a>(sce, ob, <a class="code" href="../../db/d45/BKE__pointcache_8h.html#aef800351abca5f08a0d90a742a46bce8">PTCACHE_RESET_DEPSGRAPH</a>);
<a name="l02494"></a>02494 
<a name="l02495"></a>02495         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>) {
<a name="l02496"></a>02496             <span class="comment">/* all users of this ob-&gt;data should be checked */</span>
<a name="l02497"></a>02497             <span class="keywordtype">id</span>= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l02498"></a>02498 
<a name="l02499"></a>02499             <span class="comment">/* no point in trying in this cases */</span>
<a name="l02500"></a>02500             <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &amp;&amp; id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a> &lt;= 1) {
<a name="l02501"></a>02501                 <a class="code" href="../../dc/d2f/depsgraph_8c.html#a0cb21a85d58c9b2d44aab8d7037aa92a">dag_editors_id_update</a>(bmain, <span class="keywordtype">id</span>);
<a name="l02502"></a>02502                 <span class="keywordtype">id</span>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02503"></a>02503             }
<a name="l02504"></a>02504         }
<a name="l02505"></a>02505     }
<a name="l02506"></a>02506 
<a name="l02507"></a>02507     <span class="comment">/* set flags &amp; pointcache for object data */</span>
<a name="l02508"></a>02508     <span class="keywordflow">if</span> (<span class="keywordtype">id</span>) {
<a name="l02509"></a>02509         idtype= <a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>);
<a name="l02510"></a>02510 
<a name="l02511"></a>02511         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aec360f57a7e318a62283a2619b824fe8">ELEM8</a>(idtype, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a2e6c796d1f9370e5fd552166098cdd27">ID_ME</a>, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ace150506eaf644d92a5110cf45978379">ID_CU</a>, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a3e4005eef9876a2cb9d799bdb2a43998">ID_MB</a>, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82e259dda95124fd771a23f105f52810">ID_LA</a>, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ad058b07954b2795eadc855a7a354578b">ID_LT</a>, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82bdb2fdea7abee55d993c0210101273">ID_CA</a>, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ae4ba19f70b08895557ef00b489e7d255">ID_AR</a>, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a0cd81e8a0b1724426ed2d1e36218cdf6">ID_SPK</a>)) {
<a name="l02512"></a>02512             <span class="keywordflow">for</span> (obt=bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; obt; obt= obt-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02513"></a>02513                 <span class="keywordflow">if</span> (!(ob &amp;&amp; obt == ob) &amp;&amp; obt-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a> == <span class="keywordtype">id</span>) {
<a name="l02514"></a>02514                     obt-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l02515"></a>02515                     <a class="code" href="../../dc/d2f/depsgraph_8c.html#ac94278c16f03a771ecb2c275bd2a58d1">lib_id_recalc_data_tag</a>(bmain, &amp;obt-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>);
<a name="l02516"></a>02516                     <a class="code" href="../../db/d45/BKE__pointcache_8h.html#ad1036d5ae255fe62240ecef0e2a24a85">BKE_ptcache_object_reset</a>(sce, obt, <a class="code" href="../../db/d45/BKE__pointcache_8h.html#aef800351abca5f08a0d90a742a46bce8">PTCACHE_RESET_DEPSGRAPH</a>);
<a name="l02517"></a>02517                 }
<a name="l02518"></a>02518             }
<a name="l02519"></a>02519         }
<a name="l02520"></a>02520         
<a name="l02521"></a>02521         <span class="comment">/* set flags based on textures - can influence depgraph via modifiers */</span>
<a name="l02522"></a>02522         <span class="keywordflow">if</span> (idtype == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac850344bf7854d7860b43adb1e65e228">ID_TE</a>) {
<a name="l02523"></a>02523             <span class="keywordflow">for</span> (obt=bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; obt; obt= obt-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02524"></a>02524                 <span class="keyword">struct </span>{ <a class="code" href="../../d8/d7e/structID.html">ID</a> *id; <span class="keywordtype">int</span> is_dependent; } <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l02525"></a>02525                 <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>.id= id;
<a name="l02526"></a>02526                 <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>.is_dependent= 0;
<a name="l02527"></a>02527 
<a name="l02528"></a>02528                 <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#af58b09917325823d100856df77548492">modifiers_foreachIDLink</a>(obt, <a class="code" href="../../dc/d2f/depsgraph_8c.html#a79c94719e8c7d868950468fecf528044">dag_id_flush_update__isDependentTexture</a>, &amp;<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>);
<a name="l02529"></a>02529                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>.is_dependent) {
<a name="l02530"></a>02530                     obt-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l02531"></a>02531                     <a class="code" href="../../dc/d2f/depsgraph_8c.html#ac94278c16f03a771ecb2c275bd2a58d1">lib_id_recalc_data_tag</a>(bmain, &amp;obt-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>);
<a name="l02532"></a>02532                 }
<a name="l02533"></a>02533 
<a name="l02534"></a>02534                 <span class="comment">/* particle settings can use the texture as well */</span>
<a name="l02535"></a>02535                 <span class="keywordflow">if</span> (obt-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l02536"></a>02536                     <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys = obt-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02537"></a>02537                     <a class="code" href="../../dc/ddd/structMTex.html">MTex</a> **mtexp, *mtex;
<a name="l02538"></a>02538                     <span class="keywordtype">int</span> a;
<a name="l02539"></a>02539                     <span class="keywordflow">for</span> (; psys; psys=psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a734228c70c56227c6f7a29145a5f5b57">next</a>) {
<a name="l02540"></a>02540                         mtexp = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a92d6a0f7010711f045efc7d9b4b8478b">mtex</a>;
<a name="l02541"></a>02541                         <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++, mtexp++) {
<a name="l02542"></a>02542                             mtex = *mtexp;
<a name="l02543"></a>02543                             <span class="keywordflow">if</span> (mtex &amp;&amp; mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a> == (<a class="code" href="../../df/d2d/structTex.html">Tex</a>*)<span class="keywordtype">id</span>) {
<a name="l02544"></a>02544                                 obt-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>;
<a name="l02545"></a>02545                                 <a class="code" href="../../dc/d2f/depsgraph_8c.html#ac94278c16f03a771ecb2c275bd2a58d1">lib_id_recalc_data_tag</a>(bmain, &amp;obt-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>);
<a name="l02546"></a>02546 
<a name="l02547"></a>02547                                 <span class="keywordflow">if</span> (mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aa28e86f4cbc4330e5e8518b11dcfbc61">mapto</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a062f12754b4471c3cba41200a3407e85">PAMAP_INIT</a>)
<a name="l02548"></a>02548                                     psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#af8bbacb64e6295f8799570f41e00868d">recalc</a> |= <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#ada872fb06234b9dd53d430a894ce02f0">PSYS_RECALC_RESET</a>;
<a name="l02549"></a>02549                                 <span class="keywordflow">if</span> (mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aa28e86f4cbc4330e5e8518b11dcfbc61">mapto</a> &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a316c122df41b1c660d5da354b9cb24ab">PAMAP_CHILD</a>)
<a name="l02550"></a>02550                                     psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#af8bbacb64e6295f8799570f41e00868d">recalc</a> |= <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a682502f586515a24a8148c421db2877b">PSYS_RECALC_CHILD</a>;
<a name="l02551"></a>02551 
<a name="l02552"></a>02552                                 <a class="code" href="../../db/d45/BKE__pointcache_8h.html#ad1036d5ae255fe62240ecef0e2a24a85">BKE_ptcache_object_reset</a>(sce, obt, <a class="code" href="../../db/d45/BKE__pointcache_8h.html#aef800351abca5f08a0d90a742a46bce8">PTCACHE_RESET_DEPSGRAPH</a>);
<a name="l02553"></a>02553                             }
<a name="l02554"></a>02554                         }
<a name="l02555"></a>02555                     }
<a name="l02556"></a>02556                 }
<a name="l02557"></a>02557             }
<a name="l02558"></a>02558         }
<a name="l02559"></a>02559         
<a name="l02560"></a>02560         <span class="comment">/* set flags based on ShapeKey */</span>
<a name="l02561"></a>02561         <span class="keywordflow">if</span> (idtype == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a46c0b029a6e8fc3d7ebb18311b83397d">ID_KE</a>) {
<a name="l02562"></a>02562             <span class="keywordflow">for</span> (obt=bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; obt; obt= obt-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02563"></a>02563                 <a class="code" href="../../d1/d9e/structKey.html">Key</a> *key= <a class="code" href="../../d5/d17/BKE__key_8h.html#a8f07b4f039eb391df3c5b429d2f79e62">ob_get_key</a>(obt);
<a name="l02564"></a>02564                 <span class="keywordflow">if</span> (!(ob &amp;&amp; obt == ob) &amp;&amp; ((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)key == <span class="keywordtype">id</span>)) {
<a name="l02565"></a>02565                     obt-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> |= (<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>|<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>);
<a name="l02566"></a>02566                     <a class="code" href="../../dc/d2f/depsgraph_8c.html#acc4e417eba8ab219b21c546bdbb69847">lib_id_recalc_tag</a>(bmain, &amp;obt-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>);
<a name="l02567"></a>02567                     <a class="code" href="../../dc/d2f/depsgraph_8c.html#ac94278c16f03a771ecb2c275bd2a58d1">lib_id_recalc_data_tag</a>(bmain, &amp;obt-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>);
<a name="l02568"></a>02568                     <a class="code" href="../../db/d45/BKE__pointcache_8h.html#ad1036d5ae255fe62240ecef0e2a24a85">BKE_ptcache_object_reset</a>(sce, obt, <a class="code" href="../../db/d45/BKE__pointcache_8h.html#aef800351abca5f08a0d90a742a46bce8">PTCACHE_RESET_DEPSGRAPH</a>);
<a name="l02569"></a>02569                 }
<a name="l02570"></a>02570             }
<a name="l02571"></a>02571         }
<a name="l02572"></a>02572         
<a name="l02573"></a>02573         <span class="comment">/* set flags based on particle settings */</span>
<a name="l02574"></a>02574         <span class="keywordflow">if</span> (idtype == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa64d54c8b860f4a2c7cabc743f60512e">ID_PA</a>) {
<a name="l02575"></a>02575             <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys;
<a name="l02576"></a>02576             <span class="keywordflow">for</span> (obt=bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; obt; obt= obt-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l02577"></a>02577                 <span class="keywordflow">for</span> (psys=obt-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; psys; psys=psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a734228c70c56227c6f7a29145a5f5b57">next</a>)
<a name="l02578"></a>02578                     <span class="keywordflow">if</span> (&amp;psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a> == <span class="keywordtype">id</span>)
<a name="l02579"></a>02579                         <a class="code" href="../../db/d45/BKE__pointcache_8h.html#ad1036d5ae255fe62240ecef0e2a24a85">BKE_ptcache_object_reset</a>(sce, obt, <a class="code" href="../../db/d45/BKE__pointcache_8h.html#aef800351abca5f08a0d90a742a46bce8">PTCACHE_RESET_DEPSGRAPH</a>);
<a name="l02580"></a>02580         }
<a name="l02581"></a>02581 
<a name="l02582"></a>02582         <span class="keywordflow">if</span> (idtype == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a7f8c4173f43796897d92d5c2ac8ec697">ID_MC</a>) {
<a name="l02583"></a>02583             <span class="keywordflow">for</span> (obt=bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; obt; obt= obt-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02584"></a>02584                 <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l02585"></a>02585                 <span class="keywordflow">for</span> (con = obt-&gt;<a class="code" href="../../de/de7/structObject.html#a15cd252985e63b0a4b12a07297a7aa8b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; con; con=con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l02586"></a>02586                     <a class="code" href="../../dc/ded/structbConstraintTypeInfo.html">bConstraintTypeInfo</a> *cti= <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#a8eac21e0105e441026a6b7cd7d78030d">constraint_get_typeinfo</a>(con);
<a name="l02587"></a>02587                     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#af4d4e80ea9c413dd7df1b5895ed439f9">type</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a3119d40b7e938fe99cbc91a9c75bdf9e">CONSTRAINT_TYPE_FOLLOWTRACK</a>, <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a6add20c4d241c5a886ce8b6b86f363cd">CONSTRAINT_TYPE_CAMERASOLVER</a>,
<a name="l02588"></a>02588                              <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a3321fd3e52140da450d8f6725b3678af">CONSTRAINT_TYPE_OBJECTSOLVER</a>))
<a name="l02589"></a>02589                     {
<a name="l02590"></a>02590                         obt-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>;
<a name="l02591"></a>02591                         <span class="keywordflow">break</span>;
<a name="l02592"></a>02592                     }
<a name="l02593"></a>02593                 }
<a name="l02594"></a>02594             }
<a name="l02595"></a>02595 
<a name="l02596"></a>02596             <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>) {
<a name="l02597"></a>02597                 <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l02598"></a>02598 
<a name="l02599"></a>02599                 <span class="keywordflow">for</span> (node= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l02600"></a>02600                     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>==<span class="keywordtype">id</span>) {
<a name="l02601"></a>02601                         <a class="code" href="../../d4/d91/BKE__node_8h.html#a5899bdebefd986150eaa5bfc95641c5b">nodeUpdate</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>, node);
<a name="l02602"></a>02602                     }
<a name="l02603"></a>02603                 }
<a name="l02604"></a>02604             }
<a name="l02605"></a>02605         }
<a name="l02606"></a>02606 
<a name="l02607"></a>02607         <span class="comment">/* camera&#39;s matrix is used to orient reconstructed stuff,</span>
<a name="l02608"></a>02608 <span class="comment">         * so it should happen tracking-related constraints recalculation</span>
<a name="l02609"></a>02609 <span class="comment">         * when camera is changing (sergey) */</span>
<a name="l02610"></a>02610         <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a> &amp;&amp; &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a> == <span class="keywordtype">id</span>) {
<a name="l02611"></a>02611             <a class="code" href="../../d0/d44/structMovieClip.html">MovieClip</a> *clip = <a class="code" href="../../df/dac/BKE__object_8h.html#ae5d85ba23fc1190fb741a7f16b0bbf0f">object_get_movieclip</a>(sce, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>, 1);
<a name="l02612"></a>02612 
<a name="l02613"></a>02613             <span class="keywordflow">if</span> (clip)
<a name="l02614"></a>02614                 <a class="code" href="../../dc/d2f/depsgraph_8c.html#a19e8da7b38a14f7b567379cfaea92247">dag_id_flush_update</a>(sce, &amp;clip-&gt;<a class="code" href="../../d0/d44/structMovieClip.html#a51cceb766b47f21cbe774967b1d73b8f">id</a>);
<a name="l02615"></a>02615         }
<a name="l02616"></a>02616 
<a name="l02617"></a>02617         <span class="comment">/* update editors */</span>
<a name="l02618"></a>02618         <a class="code" href="../../dc/d2f/depsgraph_8c.html#a0cb21a85d58c9b2d44aab8d7037aa92a">dag_editors_id_update</a>(bmain, <span class="keywordtype">id</span>);
<a name="l02619"></a>02619     }
<a name="l02620"></a>02620 }
<a name="l02621"></a>02621 
<a name="l02622"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a1420aa6a88441c333135ce8ef59c583d">02622</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ab873d6a825b9fbed4bceea816820c614">DAG_ids_flush_tagged</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain)
<a name="l02623"></a>02623 {
<a name="l02624"></a>02624     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lbarray[<a class="code" href="../../d8/db1/BKE__library_8h.html#a509c3a883c4af775d87a47a3007189da">MAX_LIBARRAY</a>];
<a name="l02625"></a>02625     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l02626"></a>02626     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lay;
<a name="l02627"></a>02627     <span class="keywordtype">int</span> a, do_flush = 0;
<a name="l02628"></a>02628 
<a name="l02629"></a>02629     <a class="code" href="../../dc/d2f/depsgraph_8c.html#ae685489cfc80a89d81cadcf3f8096040">dag_current_scene_layers</a>(bmain, &amp;sce, &amp;lay);
<a name="l02630"></a>02630 
<a name="l02631"></a>02631     <span class="keywordflow">if</span> (!sce || !sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa36a32a59b8c372076d113a5b532f6e4">theDag</a>)
<a name="l02632"></a>02632         <span class="keywordflow">return</span>;
<a name="l02633"></a>02633 
<a name="l02634"></a>02634     <span class="comment">/* loop over all ID types */</span>
<a name="l02635"></a>02635     a  = <a class="code" href="../../d8/db1/BKE__library_8h.html#ab83f638a06099438e181b7d635f3239c">set_listbasepointers</a>(bmain, lbarray);
<a name="l02636"></a>02636 
<a name="l02637"></a>02637     <span class="keywordflow">while</span> (a--) {
<a name="l02638"></a>02638         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb = lbarray[a];
<a name="l02639"></a>02639         <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span> = lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02640"></a>02640 
<a name="l02641"></a>02641         <span class="comment">/* we tag based on first ID type character to avoid </span>
<a name="l02642"></a>02642 <span class="comment">         * looping over all ID&#39;s in case there are no tags */</span>
<a name="l02643"></a>02643         <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &amp;&amp; bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#adae8cc21b90be33148ef1f36357eb4cc">id_tag_update</a>[id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>[0]]) {
<a name="l02644"></a>02644             <span class="keywordflow">for</span> (; id; <span class="keywordtype">id</span>=<span class="keywordtype">id</span>-&gt;<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02645"></a>02645                 <span class="keywordflow">if</span> (id-&gt;<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; (<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6495dd702ce79062ae906f5c158d0680">LIB_ID_RECALC</a>|<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ab8237ab3584d272d3ae2d70c4ee2b040">LIB_ID_RECALC_DATA</a>)) {
<a name="l02646"></a>02646                     <a class="code" href="../../dc/d2f/depsgraph_8c.html#a19e8da7b38a14f7b567379cfaea92247">dag_id_flush_update</a>(sce, <span class="keywordtype">id</span>);
<a name="l02647"></a>02647                     do_flush = 1;
<a name="l02648"></a>02648                 }
<a name="l02649"></a>02649             }
<a name="l02650"></a>02650         }
<a name="l02651"></a>02651     }
<a name="l02652"></a>02652 
<a name="l02653"></a>02653     <span class="comment">/* flush changes to other objects */</span>
<a name="l02654"></a>02654     <span class="keywordflow">if</span> (do_flush)
<a name="l02655"></a>02655         <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a88902b7d5a72a25969070648a916a053">DAG_scene_flush_update</a>(bmain, sce, lay, 0);
<a name="l02656"></a>02656 }
<a name="l02657"></a>02657 
<a name="l02658"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a371a0fb14e8eab87b0a3049174866e2b">02658</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ab86848fbbcd34a5d9ab59c882b6a91f9">DAG_ids_check_recalc</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <span class="keywordtype">int</span> time)
<a name="l02659"></a>02659 {
<a name="l02660"></a>02660     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lbarray[<a class="code" href="../../d8/db1/BKE__library_8h.html#a509c3a883c4af775d87a47a3007189da">MAX_LIBARRAY</a>];
<a name="l02661"></a>02661     <span class="keywordtype">int</span> a, updated = 0;
<a name="l02662"></a>02662 
<a name="l02663"></a>02663     <span class="comment">/* loop over all ID types */</span>
<a name="l02664"></a>02664     a  = <a class="code" href="../../d8/db1/BKE__library_8h.html#ab83f638a06099438e181b7d635f3239c">set_listbasepointers</a>(bmain, lbarray);
<a name="l02665"></a>02665 
<a name="l02666"></a>02666     <span class="keywordflow">while</span> (a--) {
<a name="l02667"></a>02667         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb = lbarray[a];
<a name="l02668"></a>02668         <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span> = lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02669"></a>02669 
<a name="l02670"></a>02670         <span class="comment">/* we tag based on first ID type character to avoid </span>
<a name="l02671"></a>02671 <span class="comment">         * looping over all ID&#39;s in case there are no tags */</span>
<a name="l02672"></a>02672         <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &amp;&amp; bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#adae8cc21b90be33148ef1f36357eb4cc">id_tag_update</a>[id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>[0]]) {
<a name="l02673"></a>02673             updated= 1;
<a name="l02674"></a>02674             <span class="keywordflow">break</span>;
<a name="l02675"></a>02675         }
<a name="l02676"></a>02676     }
<a name="l02677"></a>02677 
<a name="l02678"></a>02678     <a class="code" href="../../dc/d2f/depsgraph_8c.html#a4c6aae9a031976e65f93b39d65219cab">dag_editors_scene_update</a>(bmain, scene, (updated || time));
<a name="l02679"></a>02679 }
<a name="l02680"></a>02680 
<a name="l02681"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a5beb192d21eb85e9ec0743e8dd69fcc6">02681</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac9ece2ba2eac6aed8692e01dcee28d58">DAG_ids_clear_recalc</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain)
<a name="l02682"></a>02682 {
<a name="l02683"></a>02683     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lbarray[<a class="code" href="../../d8/db1/BKE__library_8h.html#a509c3a883c4af775d87a47a3007189da">MAX_LIBARRAY</a>];
<a name="l02684"></a>02684     <span class="keywordtype">int</span> a;
<a name="l02685"></a>02685 
<a name="l02686"></a>02686     <span class="comment">/* loop over all ID types */</span>
<a name="l02687"></a>02687     a  = <a class="code" href="../../d8/db1/BKE__library_8h.html#ab83f638a06099438e181b7d635f3239c">set_listbasepointers</a>(bmain, lbarray);
<a name="l02688"></a>02688 
<a name="l02689"></a>02689     <span class="keywordflow">while</span> (a--) {
<a name="l02690"></a>02690         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb = lbarray[a];
<a name="l02691"></a>02691         <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span> = lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02692"></a>02692 
<a name="l02693"></a>02693         <span class="comment">/* we tag based on first ID type character to avoid </span>
<a name="l02694"></a>02694 <span class="comment">         * looping over all ID&#39;s in case there are no tags */</span>
<a name="l02695"></a>02695         <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &amp;&amp; bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#adae8cc21b90be33148ef1f36357eb4cc">id_tag_update</a>[id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>[0]]) {
<a name="l02696"></a>02696             <span class="keywordflow">for</span> (; id; <span class="keywordtype">id</span>=<span class="keywordtype">id</span>-&gt;<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l02697"></a>02697                 <span class="keywordflow">if</span> (id-&gt;<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; (<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6495dd702ce79062ae906f5c158d0680">LIB_ID_RECALC</a>|<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ab8237ab3584d272d3ae2d70c4ee2b040">LIB_ID_RECALC_DATA</a>))
<a name="l02698"></a>02698                     <span class="keywordtype">id</span>-&gt;flag &amp;= ~(<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6495dd702ce79062ae906f5c158d0680">LIB_ID_RECALC</a>|<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ab8237ab3584d272d3ae2d70c4ee2b040">LIB_ID_RECALC_DATA</a>);
<a name="l02699"></a>02699         }
<a name="l02700"></a>02700     }
<a name="l02701"></a>02701 
<a name="l02702"></a>02702     memset(bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#adae8cc21b90be33148ef1f36357eb4cc">id_tag_update</a>, 0, <span class="keyword">sizeof</span>(bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#adae8cc21b90be33148ef1f36357eb4cc">id_tag_update</a>));
<a name="l02703"></a>02703 }
<a name="l02704"></a>02704 
<a name="l02705"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#acae7a54c9f1b18494a907ae91d06d4ba">02705</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(<a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <span class="keywordtype">short</span> flag)
<a name="l02706"></a>02706 {
<a name="l02707"></a>02707     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main;
<a name="l02708"></a>02708 
<a name="l02709"></a>02709     <span class="keywordflow">if</span> (<span class="keywordtype">id</span>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l02710"></a>02710     
<a name="l02711"></a>02711     <span class="comment">/* tag ID for update */</span>
<a name="l02712"></a>02712     <span class="keywordflow">if</span> (flag) {
<a name="l02713"></a>02713         <span class="keywordflow">if</span> (flag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a189b3a96923b2425ee7c0990c0b3fd20">OB_RECALC_OB</a>)
<a name="l02714"></a>02714             <a class="code" href="../../dc/d2f/depsgraph_8c.html#acc4e417eba8ab219b21c546bdbb69847">lib_id_recalc_tag</a>(bmain, <span class="keywordtype">id</span>);
<a name="l02715"></a>02715         <span class="keywordflow">if</span> (flag &amp; (<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a5753f311c53d8a8f72b1937f33ebb527">OB_RECALC_DATA</a>|<a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a7bdc52ac529562d05cc6795b6a81afe8">PSYS_RECALC</a>))
<a name="l02716"></a>02716             <a class="code" href="../../dc/d2f/depsgraph_8c.html#ac94278c16f03a771ecb2c275bd2a58d1">lib_id_recalc_data_tag</a>(bmain, <span class="keywordtype">id</span>);
<a name="l02717"></a>02717     }
<a name="l02718"></a>02718     <span class="keywordflow">else</span>
<a name="l02719"></a>02719         <a class="code" href="../../dc/d2f/depsgraph_8c.html#acc4e417eba8ab219b21c546bdbb69847">lib_id_recalc_tag</a>(bmain, <span class="keywordtype">id</span>);
<a name="l02720"></a>02720 
<a name="l02721"></a>02721     <span class="comment">/* flag is for objects and particle systems */</span>
<a name="l02722"></a>02722     <span class="keywordflow">if</span> (flag) {
<a name="l02723"></a>02723         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l02724"></a>02724         <span class="keywordtype">short</span> idtype = <a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>);
<a name="l02725"></a>02725 
<a name="l02726"></a>02726         <span class="keywordflow">if</span> (idtype == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>) {
<a name="l02727"></a>02727             <span class="comment">/* only quick tag */</span>
<a name="l02728"></a>02728             ob = (<a class="code" href="../../de/de7/structObject.html">Object</a>*)<span class="keywordtype">id</span>;
<a name="l02729"></a>02729             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= (flag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a274ab103200853538f1bb3004f8cefa7">OB_RECALC_ALL</a>);
<a name="l02730"></a>02730         }
<a name="l02731"></a>02731         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idtype == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa64d54c8b860f4a2c7cabc743f60512e">ID_PA</a>) {
<a name="l02732"></a>02732             <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys;
<a name="l02733"></a>02733             <span class="comment">/* this is weak still, should be done delayed as well */</span>
<a name="l02734"></a>02734             <span class="keywordflow">for</span> (ob=bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l02735"></a>02735                 <span class="keywordflow">for</span> (psys=ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; psys; psys=psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a734228c70c56227c6f7a29145a5f5b57">next</a>) {
<a name="l02736"></a>02736                     <span class="keywordflow">if</span> (&amp;psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a> == <span class="keywordtype">id</span>) {
<a name="l02737"></a>02737                         ob-&gt;<a class="code" href="../../de/de7/structObject.html#a1bed6d05de7a141e9271fd0985b25a9c">recalc</a> |= (flag &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a274ab103200853538f1bb3004f8cefa7">OB_RECALC_ALL</a>);
<a name="l02738"></a>02738                         psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#af8bbacb64e6295f8799570f41e00868d">recalc</a> |= (flag &amp; <a class="code" href="../../de/d5a/DNA__particle__types_8h.html#a7bdc52ac529562d05cc6795b6a81afe8">PSYS_RECALC</a>);
<a name="l02739"></a>02739                         <a class="code" href="../../dc/d2f/depsgraph_8c.html#acc4e417eba8ab219b21c546bdbb69847">lib_id_recalc_tag</a>(bmain, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>);
<a name="l02740"></a>02740                         <a class="code" href="../../dc/d2f/depsgraph_8c.html#ac94278c16f03a771ecb2c275bd2a58d1">lib_id_recalc_data_tag</a>(bmain, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>);
<a name="l02741"></a>02741                     }
<a name="l02742"></a>02742                 }
<a name="l02743"></a>02743             }
<a name="l02744"></a>02744         }
<a name="l02745"></a>02745         <span class="keywordflow">else</span> {
<a name="l02746"></a>02746             <span class="comment">/* disable because this is called on various ID types automatically.</span>
<a name="l02747"></a>02747 <span class="comment">             * where printing warning is not useful. for now just ignore */</span>
<a name="l02748"></a>02748             <span class="comment">/* BLI_assert(!&quot;invalid flag for this &#39;idtype&#39;&quot;); */</span>
<a name="l02749"></a>02749         }
<a name="l02750"></a>02750     }
<a name="l02751"></a>02751 }
<a name="l02752"></a>02752 
<a name="l02753"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a719c20d89827ac9351f0d2b5e55e54a8">02753</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a719c20d89827ac9351f0d2b5e55e54a8">DAG_id_type_tag</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <span class="keywordtype">short</span> idtype)
<a name="l02754"></a>02754 {
<a name="l02755"></a>02755     bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#adae8cc21b90be33148ef1f36357eb4cc">id_tag_update</a>[((<span class="keywordtype">char</span>*)&amp;idtype)[0]] = 1;
<a name="l02756"></a>02756 }
<a name="l02757"></a>02757 
<a name="l02758"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#a3be60f47be9f800efe87c2384265081c">02758</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ac8534d15a2049eb3cd6a71f8f9c928ae">DAG_id_type_tagged</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <span class="keywordtype">short</span> idtype)
<a name="l02759"></a>02759 {
<a name="l02760"></a>02760     <span class="keywordflow">return</span> bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#adae8cc21b90be33148ef1f36357eb4cc">id_tag_update</a>[((<span class="keywordtype">char</span>*)&amp;idtype)[0]];
<a name="l02761"></a>02761 }
<a name="l02762"></a>02762 
<a name="l02763"></a>02763 <span class="preprocessor">#if 0 // UNUSED</span>
<a name="l02764"></a>02764 <span class="preprocessor"></span><span class="comment">/* recursively descends tree, each node only checked once */</span>
<a name="l02765"></a>02765 <span class="comment">/* node is checked to be of type object */</span>
<a name="l02766"></a>02766 <span class="keyword">static</span> <span class="keywordtype">int</span> parent_check_node(<a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node, <span class="keywordtype">int</span> curtime)
<a name="l02767"></a>02767 {
<a name="l02768"></a>02768     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l02769"></a>02769     
<a name="l02770"></a>02770     node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a963ba586cfd029488471bfdfbbe246cd">lasttime</a>= curtime;
<a name="l02771"></a>02771     
<a name="l02772"></a>02772     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a>==<a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>)
<a name="l02773"></a>02773         <span class="keywordflow">return</span> <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>;
<a name="l02774"></a>02774     
<a name="l02775"></a>02775     <span class="keywordflow">for</span> (itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>; itA; itA= itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>) {
<a name="l02776"></a>02776         <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a725e3c7b1bf69d904015fb59702be828">type</a>==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>) {
<a name="l02777"></a>02777             
<a name="l02778"></a>02778             <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a>==<a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>)
<a name="l02779"></a>02779                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>;
<a name="l02780"></a>02780 
<a name="l02781"></a>02781             <span class="comment">/* descend if not done */</span>
<a name="l02782"></a>02782             <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a963ba586cfd029488471bfdfbbe246cd">lasttime</a>!=curtime) {
<a name="l02783"></a>02783                 itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a>= parent_check_node(itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>, curtime);
<a name="l02784"></a>02784             
<a name="l02785"></a>02785                 <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a>==<a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>)
<a name="l02786"></a>02786                     <span class="keywordflow">return</span> <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>;
<a name="l02787"></a>02787             }
<a name="l02788"></a>02788         }
<a name="l02789"></a>02789     }
<a name="l02790"></a>02790     
<a name="l02791"></a>02791     <span class="keywordflow">return</span> <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>;
<a name="l02792"></a>02792 }
<a name="l02793"></a>02793 <span class="preprocessor">#endif</span>
<a name="l02794"></a>02794 <span class="preprocessor"></span>
<a name="l02795"></a>02795 <span class="comment">/* ******************* DAG FOR ARMATURE POSE ***************** */</span>
<a name="l02796"></a>02796 
<a name="l02797"></a>02797 <span class="comment">/* we assume its an armature with pose */</span>
<a name="l02798"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#ae51ce6675083b23c2ae5495ba1d17b7e">02798</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aefd9304dddbd2a29813d6ebd178f2a30">DAG_pose_sort</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l02799"></a>02799 {
<a name="l02800"></a>02800     <a class="code" href="../../d3/de4/structbPose.html">bPose</a> *pose= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>;
<a name="l02801"></a>02801     <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan;
<a name="l02802"></a>02802     <a class="code" href="../../d8/d41/structbConstraint.html">bConstraint</a> *con;
<a name="l02803"></a>02803     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node;
<a name="l02804"></a>02804     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *node2, *node3;
<a name="l02805"></a>02805     <a class="code" href="../../d5/d07/structDagNode.html">DagNode</a> *rootnode;
<a name="l02806"></a>02806     <a class="code" href="../../dc/df7/structDagForest.html">DagForest</a> *dag;
<a name="l02807"></a>02807     <a class="code" href="../../d4/dce/structDagNodeQueue.html">DagNodeQueue</a> *nqueue;
<a name="l02808"></a>02808     <a class="code" href="../../d9/d45/structDagAdjList.html">DagAdjList</a> *itA;
<a name="l02809"></a>02809     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> tempbase;
<a name="l02810"></a>02810     <span class="keywordtype">int</span> skip = 0;
<a name="l02811"></a>02811     
<a name="l02812"></a>02812     dag = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a95696f03e4d53d9007848383709fe2d3">dag_init</a>();
<a name="l02813"></a>02813     <a class="code" href="../../dc/d2f/depsgraph_8c.html#ab3c6a0fe7397579cf62d31e5c30e9e67">ugly_hack_sorry</a>= 0; <span class="comment">// no ID structs</span>
<a name="l02814"></a>02814 
<a name="l02815"></a>02815     rootnode = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ad767ccd7e8be5e1ef7f1cc9a473d4da3">dag_add_node</a>(dag, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>); <span class="comment">// node-&gt;ob becomes NULL</span>
<a name="l02816"></a>02816     
<a name="l02817"></a>02817     <span class="comment">/* we add the hierarchy and the constraints */</span>
<a name="l02818"></a>02818     <span class="keywordflow">for</span> (pchan = pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; pchan; pchan= pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a73c14c1cca1a2d1e91778f44578eeca0">next</a>) {
<a name="l02819"></a>02819         <span class="keywordtype">int</span> addtoroot = 1;
<a name="l02820"></a>02820         
<a name="l02821"></a>02821         node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, pchan);
<a name="l02822"></a>02822         
<a name="l02823"></a>02823         <span class="keywordflow">if</span> (pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a331eee45a012f6f42d5a52acbf484547">parent</a>) {
<a name="l02824"></a>02824             node2 = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a331eee45a012f6f42d5a52acbf484547">parent</a>);
<a name="l02825"></a>02825             <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node2, node, 0, <span class="stringliteral">&quot;Parent Relation&quot;</span>);
<a name="l02826"></a>02826             addtoroot = 0;
<a name="l02827"></a>02827         }
<a name="l02828"></a>02828         <span class="keywordflow">for</span> (con = pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a0374b80987b804af0b60a4930f3b5e0b">constraints</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; con; con=con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a463805fc5e4f3bfb3f0bf92913808c88">next</a>) {
<a name="l02829"></a>02829             <a class="code" href="../../dc/ded/structbConstraintTypeInfo.html">bConstraintTypeInfo</a> *cti= <a class="code" href="../../d4/ddd/BKE__constraint_8h.html#a8eac21e0105e441026a6b7cd7d78030d">constraint_get_typeinfo</a>(con);
<a name="l02830"></a>02830             <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> targets = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l02831"></a>02831             <a class="code" href="../../d5/d78/structbConstraintTarget.html">bConstraintTarget</a> *ct;
<a name="l02832"></a>02832             
<a name="l02833"></a>02833             <span class="keywordflow">if</span> (cti &amp;&amp; cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a25b05ed0f4c02b26dbbc775b47d0b934">get_constraint_targets</a>) {
<a name="l02834"></a>02834                 cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a25b05ed0f4c02b26dbbc775b47d0b934">get_constraint_targets</a>(con, &amp;targets);
<a name="l02835"></a>02835                 
<a name="l02836"></a>02836                 <span class="keywordflow">for</span> (ct= targets.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ct; ct= ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a5ea4a1b1fa4761a30cb66c75a8ac9054">next</a>) {
<a name="l02837"></a>02837                     <span class="keywordflow">if</span> (ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#a0f75cb18129bdb2c0aee21ac528b8f5e">tar</a>==ob &amp;&amp; ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#ab1f6a09b2a30f6f55449e3e5871fafed">subtarget</a>[0]) {
<a name="l02838"></a>02838                         <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *target= <a class="code" href="../../d8/df5/BKE__action_8h.html#a18bfaf2fd4139dd5efbf0c5ea657a1aa">get_pose_channel</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>, ct-&gt;<a class="code" href="../../d5/d78/structbConstraintTarget.html#ab1f6a09b2a30f6f55449e3e5871fafed">subtarget</a>);
<a name="l02839"></a>02839                         <span class="keywordflow">if</span> (target) {
<a name="l02840"></a>02840                             node2= <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, target);
<a name="l02841"></a>02841                             <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node2, node, 0, <span class="stringliteral">&quot;Pose Constraint&quot;</span>);
<a name="l02842"></a>02842                             
<a name="l02843"></a>02843                             <span class="keywordflow">if</span> (con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#a63187d597452da3bb2bd3b52054167cc">type</a>==<a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a22745fe3cf64fc34759408bb74cd18f5a8061c31c9da4a7351ce57037615d2c16">CONSTRAINT_TYPE_KINEMATIC</a>) {
<a name="l02844"></a>02844                                 <a class="code" href="../../d4/d5b/structbKinematicConstraint.html">bKinematicConstraint</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a> = (<a class="code" href="../../d4/d5b/structbKinematicConstraint.html">bKinematicConstraint</a> *)con-&gt;<a class="code" href="../../d8/d41/structbConstraint.html#adfe30f55cbdd3ae1ae79948b63d3063e">data</a>;
<a name="l02845"></a>02845                                 <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *parchan;
<a name="l02846"></a>02846                                 <span class="keywordtype">int</span> segcount= 0;
<a name="l02847"></a>02847                                 
<a name="l02848"></a>02848                                 <span class="comment">/* exclude tip from chain? */</span>
<a name="l02849"></a>02849                                 <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (!(data-&gt;<a class="code" href="../../d4/d5b/structbKinematicConstraint.html#ad7b9c9e543f98e483728044e9627fb14">flag</a> &amp; <a class="code" href="../../db/d03/DNA__constraint__types_8h.html#a151d60aa5af580c422f4b8a2f855af5dae3a865a72db654ff3b3a0528179d699a">CONSTRAINT_IK_TIP</a>))
<a name="l02850"></a>02850                                     parchan= pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a331eee45a012f6f42d5a52acbf484547">parent</a>;
<a name="l02851"></a>02851                                 <span class="keywordflow">else</span>
<a name="l02852"></a>02852                                     parchan= pchan;
<a name="l02853"></a>02853                                 
<a name="l02854"></a>02854                                 <span class="comment">/* Walk to the chain&#39;s root */</span>
<a name="l02855"></a>02855                                 while (parchan) {
<a name="l02856"></a>02856                                     node3= <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedbf331f72cdcc89995322ae0567f1df">dag_get_node</a>(dag, parchan);
<a name="l02857"></a>02857                                     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, node2, node3, 0, <span class="stringliteral">&quot;IK Constraint&quot;</span>);
<a name="l02858"></a>02858                                     
<a name="l02859"></a>02859                                     segcount++;
<a name="l02860"></a>02860                                     <span class="keywordflow">if</span> (segcount==data-&gt;<a class="code" href="../../d4/d5b/structbKinematicConstraint.html#afb10d502fbc8bf3fce8f2994e355be56">rootbone</a> || segcount&gt;255) <span class="keywordflow">break</span>; <span class="comment">// 255 is weak</span>
<a name="l02861"></a>02861                                     parchan= parchan-&gt;parent;
<a name="l02862"></a>02862                                 }
<a name="l02863"></a>02863                             }
<a name="l02864"></a>02864                         }
<a name="l02865"></a>02865                     }
<a name="l02866"></a>02866                 }
<a name="l02867"></a>02867                 
<a name="l02868"></a>02868                 <span class="keywordflow">if</span> (cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a5afd4078d269cd49108678e99cca935f">flush_constraint_targets</a>)
<a name="l02869"></a>02869                     cti-&gt;<a class="code" href="../../dc/ded/structbConstraintTypeInfo.html#a5afd4078d269cd49108678e99cca935f">flush_constraint_targets</a>(con, &amp;targets, 1);
<a name="l02870"></a>02870             }
<a name="l02871"></a>02871         }
<a name="l02872"></a>02872         <span class="keywordflow">if</span> (addtoroot == 1 ) {
<a name="l02873"></a>02873             <a class="code" href="../../d4/d24/depsgraph__private_8h.html#aedb692691c3406661eae56c512685bb8">dag_add_relation</a>(dag, rootnode, node, 0, <span class="stringliteral">&quot;Root Bone Relation&quot;</span>);
<a name="l02874"></a>02874         }
<a name="l02875"></a>02875     }
<a name="l02876"></a>02876 
<a name="l02877"></a>02877     <a class="code" href="../../dc/d2f/depsgraph_8c.html#a5f3b1c118ce9371f626080ab579a1216">dag_check_cycle</a>(dag);
<a name="l02878"></a>02878     
<a name="l02879"></a>02879     <span class="comment">/* now we try to sort... */</span>
<a name="l02880"></a>02880     tempbase.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= tempbase.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02881"></a>02881 
<a name="l02882"></a>02882     nqueue = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab1df05b5e7c73b0bc403fbb132fe8fba">queue_create</a>(<a class="code" href="../../d4/d24/depsgraph__private_8h.html#ab84f030513d53e1fbd6870d640282a6d">DAGQUEUEALLOC</a>);
<a name="l02883"></a>02883     
<a name="l02884"></a>02884     <span class="comment">/* tag nodes unchecked */</span>
<a name="l02885"></a>02885     <span class="keywordflow">for</span> (node = dag-&gt;<a class="code" href="../../dc/df7/structDagForest.html#ad9aaa3ece54b37f50ceab2034750b3cc">DagNode</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#af9dfbfc5e2c56504995bd8a6ebebc6f1">next</a>) 
<a name="l02886"></a>02886         node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>;
<a name="l02887"></a>02887     
<a name="l02888"></a>02888     rootnode-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>;
<a name="l02889"></a>02889     <a class="code" href="../../d4/d24/depsgraph__private_8h.html#acf4ce9e88412d2859799d3a2b3d1e09f">push_stack</a>(nqueue, rootnode);  
<a name="l02890"></a>02890     
<a name="l02891"></a>02891     <span class="keywordflow">while</span> (nqueue-&gt;<a class="code" href="../../d4/dce/structDagNodeQueue.html#ad9e32201852514225b2a06af35241586">count</a>) {
<a name="l02892"></a>02892         
<a name="l02893"></a>02893         skip = 0;
<a name="l02894"></a>02894         node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#abc5d63c9e9f34a5ab16e4b42a9017886">get_top_node_queue</a>(nqueue);
<a name="l02895"></a>02895         
<a name="l02896"></a>02896         itA = node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a68e1b11a1539ab4987cbc77a32db89a7">child</a>;
<a name="l02897"></a>02897         <span class="keywordflow">while</span> (itA != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02898"></a>02898             <span class="keywordflow">if</span> (itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> == <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa5af413af1d91c9e60b1323ab54ca236a">DAG_WHITE</a>) {
<a name="l02899"></a>02899                 itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaaeaac6caadee28e6655e6719ef2a9a7ad">DAG_GRAY</a>;
<a name="l02900"></a>02900                 <a class="code" href="../../d4/d24/depsgraph__private_8h.html#acf4ce9e88412d2859799d3a2b3d1e09f">push_stack</a>(nqueue,itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#a921723948108db5402b9c955a4d51c3a">node</a>);
<a name="l02901"></a>02901                 skip = 1;
<a name="l02902"></a>02902                 <span class="keywordflow">break</span>;
<a name="l02903"></a>02903             } 
<a name="l02904"></a>02904             itA = itA-&gt;<a class="code" href="../../d9/d45/structDagAdjList.html#aa4abbb2ff3083de3d607b76a03ba3966">next</a>;
<a name="l02905"></a>02905         }           
<a name="l02906"></a>02906         
<a name="l02907"></a>02907         <span class="keywordflow">if</span> (!skip) {
<a name="l02908"></a>02908             <span class="keywordflow">if</span> (node) {
<a name="l02909"></a>02909                 node = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a235ae8872ca26849c15091928dd95cc6">pop_queue</a>(nqueue);
<a name="l02910"></a>02910                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)   <span class="comment">// we are done</span>
<a name="l02911"></a>02911                     <span class="keywordflow">break</span>;
<a name="l02912"></a>02912                 node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a37abed390e4e0250007ae3c37217b2b6">color</a> = <a class="code" href="../../d4/d24/depsgraph__private_8h.html#a80155586fa275b28773c9b203f52cabaa75c80a731857e68384b7459fe3f40f22">DAG_BLACK</a>;
<a name="l02913"></a>02913                 
<a name="l02914"></a>02914                 <span class="comment">/* put node in new list */</span>
<a name="l02915"></a>02915                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>, node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>);
<a name="l02916"></a>02916                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#ab5b5ec121d2522c0e8e74e01d6517feb">BLI_addhead</a>(&amp;tempbase, node-&gt;<a class="code" href="../../d5/d07/structDagNode.html#a4a4e70502ebcb43c8df8e0f84074fa85">ob</a>);
<a name="l02917"></a>02917             }   
<a name="l02918"></a>02918         }
<a name="l02919"></a>02919     }
<a name="l02920"></a>02920     
<a name="l02921"></a>02921     <span class="comment">/* temporal correction for circular dependencies */</span>
<a name="l02922"></a>02922     <span class="keywordflow">while</span> (pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l02923"></a>02923         pchan= pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l02924"></a>02924         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a>, pchan);
<a name="l02925"></a>02925         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#ab5b5ec121d2522c0e8e74e01d6517feb">BLI_addhead</a>(&amp;tempbase, pchan);
<a name="l02926"></a>02926 
<a name="l02927"></a>02927         printf(<span class="stringliteral">&quot;cyclic %s\n&quot;</span>, pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a8e947cbe29071a1c347abe644fe9c0c1">name</a>);
<a name="l02928"></a>02928     }
<a name="l02929"></a>02929     
<a name="l02930"></a>02930     pose-&gt;<a class="code" href="../../d3/de4/structbPose.html#a0bcc485e14443c3542a761284fa36b81">chanbase</a> = tempbase;
<a name="l02931"></a>02931     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a4546a39116f46dea548c9e1195be4cca">queue_delete</a>(nqueue);
<a name="l02932"></a>02932     
<a name="l02933"></a>02933 <span class="comment">//  printf(&quot;\nordered\n&quot;);</span>
<a name="l02934"></a>02934 <span class="comment">//  for (pchan = pose-&gt;chanbase.first; pchan; pchan= pchan-&gt;next) {</span>
<a name="l02935"></a>02935 <span class="comment">//      printf(&quot; %s\n&quot;, pchan-&gt;name);</span>
<a name="l02936"></a>02936 <span class="comment">//  }</span>
<a name="l02937"></a>02937     
<a name="l02938"></a>02938     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aef295b921a94ae4818d364194a6769b1">free_forest</a>( dag );
<a name="l02939"></a>02939     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>( dag );
<a name="l02940"></a>02940     
<a name="l02941"></a>02941     <a class="code" href="../../dc/d2f/depsgraph_8c.html#ab3c6a0fe7397579cf62d31e5c30e9e67">ugly_hack_sorry</a>= 1;
<a name="l02942"></a>02942 }
<a name="l02943"></a>02943 
<a name="l02944"></a>02944 <span class="comment">/* ************************ DAG DEBUGGING ********************* */</span>
<a name="l02945"></a>02945 
<a name="l02946"></a><a class="code" href="../../dc/d2f/depsgraph_8c.html#af112d6afd08d4fbbc83acb702bb01e2e">02946</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#ad08c33ad92c98df267269d5d126ab2d0">DAG_print_dependencies</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l02947"></a>02947 {
<a name="l02948"></a>02948     <span class="comment">/* utility for debugging dependencies */</span>
<a name="l02949"></a>02949     <a class="code" href="../../dc/d2f/depsgraph_8c.html#a73fa2494da191bcf6807ea5afb51f134">dag_print_dependencies</a>= 1;
<a name="l02950"></a>02950 
<a name="l02951"></a>02951     <span class="keywordflow">if</span> (ob &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550acfed9b4bf4a7e2d3c5ae0b3571e38950">OB_MODE_POSE</a>)) {
<a name="l02952"></a>02952         printf(<span class="stringliteral">&quot;\nDEPENDENCY RELATIONS for %s\n\n&quot;</span>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2);
<a name="l02953"></a>02953         <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#aefd9304dddbd2a29813d6ebd178f2a30">DAG_pose_sort</a>(ob);
<a name="l02954"></a>02954     }
<a name="l02955"></a>02955     <span class="keywordflow">else</span> {
<a name="l02956"></a>02956         printf(<span class="stringliteral">&quot;\nDEPENDENCY RELATIONS for %s\n\n&quot;</span>, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2);
<a name="l02957"></a>02957         <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a1916587a9ec19eb3543b1c1bc54a8ded">DAG_scene_sort</a>(bmain, scene);
<a name="l02958"></a>02958     }
<a name="l02959"></a>02959     
<a name="l02960"></a>02960     <a class="code" href="../../dc/d2f/depsgraph_8c.html#a73fa2494da191bcf6807ea5afb51f134">dag_print_dependencies</a>= 0;
<a name="l02961"></a>02961 }
<a name="l02962"></a>02962 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:12 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

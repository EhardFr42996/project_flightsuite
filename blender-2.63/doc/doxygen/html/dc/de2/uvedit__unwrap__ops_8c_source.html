<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: uvedit_unwrap_ops.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">uvedit_unwrap_ops.c</div>  </div>
</div>
<div class="contents">
<a href="../../dc/de2/uvedit__unwrap__ops_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): none yet.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d3b/DNA__camera__types_8h.html">DNA_camera_types.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d96/DNA__mesh__types_8h.html">DNA_mesh_types.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html">DNA_meshdata_types.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../da/df0/DNA__modifier__types_8h.html">DNA_modifier_types.h</a>&quot;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/dfb/BLI__edgehash_8h.html" title="A general unordered 2-int pair hash table ADT.">BLI_edgehash.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d0c/BLI__uvproject_8h.html">BLI_uvproject.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d88/BLI__rand_8h.html" title="Random number functions.">BLI_rand.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/db3/BLI__string_8h.html">BLI_string.h</a>&quot;</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d15/BKE__cdderivedmesh_8h.html">BKE_cdderivedmesh.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d35/BKE__subsurf_8h.html">BKE_subsurf.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d5e/BKE__customdata_8h.html" title="CustomData interface, see also DNA_customdata_types.h.">BKE_customdata.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html">BKE_depsgraph.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d77/BKE__image_8h.html">BKE_image.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d7f/BKE__mesh_8h.html">BKE_mesh.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d40/BKE__report_8h.html">BKE_report.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html">BKE_tessmesh.h</a>&quot;</span>
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/dfb/BLI__edgehash_8h.html" title="A general unordered 2-int pair hash table ADT.">BLI_edgehash.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/de9/BLI__scanfill_8h.html" title="Filling meshes.">BLI_scanfill.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d6c/BLI__array_8h.html">BLI_array.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d0c/BLI__uvproject_8h.html">BLI_uvproject.h</a>&quot;</span>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d2e/PIL__time_8h.html">PIL_time.h</a>&quot;</span>
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d53/ED__image_8h.html">ED_image.h</a>&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/dd6/ED__mesh_8h.html">ED_mesh.h</a>&quot;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d12/ED__screen_8h.html">ED_screen.h</a>&quot;</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d25/ED__uvedit_8h.html">ED_uvedit.h</a>&quot;</span>
<a name="l00077"></a>00077 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d6a/ED__view3d_8h.html">ED_view3d.h</a>&quot;</span>
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00080"></a>00080 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d68/RNA__define_8h.html">RNA_define.h</a>&quot;</span>
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00084"></a>00084 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d48/uvedit__intern_8h.html">uvedit_intern.h</a>&quot;</span>
<a name="l00087"></a>00087 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html">uvedit_parametrizer.h</a>&quot;</span>
<a name="l00088"></a>00088 
<a name="l00089"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a7efca9520bb62d682f07d20f0d8a1fbf">00089</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a7efca9520bb62d682f07d20f0d8a1fbf">ED_uvedit_ensure_uvs</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit)
<a name="l00090"></a>00090 {
<a name="l00091"></a>00091     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain = <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C);
<a name="l00092"></a>00092     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a4d9806c4d2c9d7777ae1619839d6baed" title="Return the BMEditMesh for a given object.">BMEdit_FromObject</a>(obedit);
<a name="l00093"></a>00093     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa;
<a name="l00094"></a>00094     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter;
<a name="l00095"></a>00095     <a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *ima;
<a name="l00096"></a>00096     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l00097"></a>00097     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l00098"></a>00098     <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *slink;
<a name="l00099"></a>00099     <a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *sima;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101     <span class="keywordflow">if</span> (<a class="code" href="../../dd/d25/ED__uvedit_8h.html#aac26d389d8e65b5cbcb9fe57ba504aaf">ED_uvedit_test</a>(obedit)) {
<a name="l00102"></a>00102         <span class="keywordflow">return</span> 1;
<a name="l00103"></a>00103     }
<a name="l00104"></a>00104 
<a name="l00105"></a>00105     <span class="keywordflow">if</span> (em &amp;&amp; em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#ae4e0288302780574590bab5f8ff43fa4">totface</a> &amp;&amp; !<a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a6474531880fa81739ccdb10fdffd1866">CustomData_has_layer</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abda690b32c834c8ee41e225cfd2d9e49">pdata</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a05731a08cef6d81e74c221963ae25712">CD_MTEXPOLY</a>)) {
<a name="l00106"></a>00106         <a class="code" href="../../de/d02/bmesh__interp_8c.html#a7f95f944761c33d4e381c67798ce1bd4">BM_data_layer_add</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, &amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abda690b32c834c8ee41e225cfd2d9e49">pdata</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a05731a08cef6d81e74c221963ae25712">CD_MTEXPOLY</a>);
<a name="l00107"></a>00107         <a class="code" href="../../de/d02/bmesh__interp_8c.html#a7f95f944761c33d4e381c67798ce1bd4">BM_data_layer_add</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, &amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l00108"></a>00108         <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a389313fa03e3090f10d3d10fe06c287a">ED_mesh_uv_loop_reset_ex</a>(C, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l00109"></a>00109     }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111     <span class="keywordflow">if</span> (!<a class="code" href="../../dd/d25/ED__uvedit_8h.html#aac26d389d8e65b5cbcb9fe57ba504aaf">ED_uvedit_test</a>(obedit)) {
<a name="l00112"></a>00112         <span class="keywordflow">return</span> 0;
<a name="l00113"></a>00113     }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115     ima = <a class="code" href="../../df/d01/BKE__context_8h.html#aa4730d536a7c5b2bb40d3dd4f0048807">CTX_data_edit_image</a>(C);
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     <span class="keywordflow">if</span> (!ima) {
<a name="l00118"></a>00118         <span class="comment">/* no image in context in the 3d view, we find first image window .. */</span>
<a name="l00119"></a>00119         sc = <a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C);
<a name="l00120"></a>00120 
<a name="l00121"></a>00121         <span class="keywordflow">for</span> (sa = sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l00122"></a>00122             slink = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00123"></a>00123             <span class="keywordflow">if</span> (slink-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>) {
<a name="l00124"></a>00124                 sima = (<a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *)slink;
<a name="l00125"></a>00125 
<a name="l00126"></a>00126                 ima = sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#abcf13b6f77c9da7cf19c58a26c9a6006">image</a>;
<a name="l00127"></a>00127                 <span class="keywordflow">if</span> (ima) {
<a name="l00128"></a>00128                     <span class="keywordflow">if</span> (ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a80acd1ed9bc66fb3a9d45e146f6039f0">type</a> == <a class="code" href="../../d2/d77/BKE__image_8h.html#af8eec9b55a49c67ca1effbc2ccf43501">IMA_TYPE_R_RESULT</a> || ima-&gt;<a class="code" href="../../d8/d00/classImage.html#a80acd1ed9bc66fb3a9d45e146f6039f0">type</a> == <a class="code" href="../../d2/d77/BKE__image_8h.html#a922dc453e6b157a2da1dc7ffb5fb19f6">IMA_TYPE_COMPOSITE</a>)
<a name="l00129"></a>00129                         ima = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00130"></a>00130                     <span class="keywordflow">else</span>
<a name="l00131"></a>00131                         <span class="keywordflow">break</span>;
<a name="l00132"></a>00132                 }
<a name="l00133"></a>00133             }
<a name="l00134"></a>00134         }
<a name="l00135"></a>00135     }
<a name="l00136"></a>00136     
<a name="l00137"></a>00137     <span class="keywordflow">if</span> (ima)
<a name="l00138"></a>00138         <a class="code" href="../../dd/d25/ED__uvedit_8h.html#a93212098ef8abe337aaa4419ba14a1ab">ED_uvedit_assign_image</a>(bmain, scene, obedit, ima, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00139"></a>00139     
<a name="l00140"></a>00140     <span class="comment">/* select new UV&#39;s */</span>
<a name="l00141"></a>00141     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l00142"></a>00142         <a class="code" href="../../dd/d25/ED__uvedit_8h.html#a43eb9c0683ffa10268167c916fe69bbe">uvedit_face_select_enable</a>(scene, em, efa, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     <span class="keywordflow">return</span> 1;
<a name="l00146"></a>00146 }
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 <span class="comment">/****************** Parametrizer Conversion ***************/</span>
<a name="l00149"></a>00149 
<a name="l00150"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a0b81eb2dd6abd09ec43b600388f37d69">00150</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a0b81eb2dd6abd09ec43b600388f37d69">uvedit_have_selection</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <span class="keywordtype">short</span> implicit)
<a name="l00151"></a>00151 {
<a name="l00152"></a>00152     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa;
<a name="l00153"></a>00153     <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l00154"></a>00154     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter, liter;
<a name="l00155"></a>00155     <a class="code" href="../../d6/d90/structMLoopUV.html">MLoopUV</a> *luv;
<a name="l00156"></a>00156     
<a name="l00157"></a>00157     <span class="comment">/* verify if we have any selected uv&#39;s before unwrapping,</span>
<a name="l00158"></a>00158 <span class="comment">     * so we can cancel the operator early */</span>
<a name="l00159"></a>00159     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l00160"></a>00160         <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a13290558e3abc572fcfb0c4f66a8c95f">uv_flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8db57005d53c7c86557cdfd7915b76e5">UV_SYNC_SELECTION</a>) {
<a name="l00161"></a>00161             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>))
<a name="l00162"></a>00162                 <span class="keywordflow">continue</span>;
<a name="l00163"></a>00163         }
<a name="l00164"></a>00164         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>) || !<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>))
<a name="l00165"></a>00165             <span class="keywordflow">continue</span>;
<a name="l00166"></a>00166     
<a name="l00167"></a>00167         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l00168"></a>00168             luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l00169"></a>00169             <span class="keywordflow">if</span> (!luv)
<a name="l00170"></a>00170                 <span class="keywordflow">return</span> 1;
<a name="l00171"></a>00171             
<a name="l00172"></a>00172             <span class="keywordflow">if</span> (<a class="code" href="../../dd/d25/ED__uvedit_8h.html#a795735e902ba1cffbdc1b398695dd93e">uvedit_uv_select_test</a>(em, scene, l))
<a name="l00173"></a>00173                 <span class="keywordflow">break</span>;
<a name="l00174"></a>00174         }
<a name="l00175"></a>00175         
<a name="l00176"></a>00176         <span class="keywordflow">if</span> (implicit &amp;&amp; !l)
<a name="l00177"></a>00177             <span class="keywordflow">continue</span>;
<a name="l00178"></a>00178         
<a name="l00179"></a>00179         <span class="keywordflow">return</span> 1;
<a name="l00180"></a>00180     }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182     <span class="keywordflow">return</span> 0;
<a name="l00183"></a>00183 }
<a name="l00184"></a>00184 
<a name="l00185"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ad947fa49a395babf2804f4fea900dca4">00185</a> <span class="keyword">static</span> <a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#ac78969cb448fed335a47b69eac4f3a7d">ParamHandle</a> *<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ad947fa49a395babf2804f4fea900dca4">construct_param_handle</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, 
<a name="l00186"></a>00186                                            <span class="keywordtype">short</span> implicit, <span class="keywordtype">short</span> fill, <span class="keywordtype">short</span> sel,
<a name="l00187"></a>00187                                            <span class="keywordtype">short</span> correct_aspect)
<a name="l00188"></a>00188 {
<a name="l00189"></a>00189     <a class="code" href="../../d7/d8b/structScanFillContext.html">ScanFillContext</a> sf_ctx;
<a name="l00190"></a>00190     <a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#ac78969cb448fed335a47b69eac4f3a7d">ParamHandle</a> *handle;
<a name="l00191"></a>00191     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa;
<a name="l00192"></a>00192     <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l00193"></a>00193     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *eed;
<a name="l00194"></a>00194     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter, liter;
<a name="l00195"></a>00195     <a class="code" href="../../de/d88/structMTexPoly.html">MTexPoly</a> *tf;
<a name="l00196"></a>00196     
<a name="l00197"></a>00197     handle = <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a46731e2bf2118bfa6a4b361117003490">param_construct_begin</a>();
<a name="l00198"></a>00198 
<a name="l00199"></a>00199     <span class="keywordflow">if</span> (correct_aspect) {
<a name="l00200"></a>00200         efa = <a class="code" href="../../d5/def/bmesh__marking_8c.html#a6e02febedf269e86d8f9cb8efedd9500">BM_active_face_get</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00201"></a>00201 
<a name="l00202"></a>00202         <span class="keywordflow">if</span> (efa) {
<a name="l00203"></a>00203             <span class="keywordtype">float</span> aspx, aspy;
<a name="l00204"></a>00204             tf = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abda690b32c834c8ee41e225cfd2d9e49">pdata</a>, efa-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a80c8c910b6b28425ea8544e07741092c">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a05731a08cef6d81e74c221963ae25712">CD_MTEXPOLY</a>);
<a name="l00205"></a>00205 
<a name="l00206"></a>00206             <a class="code" href="../../de/d53/ED__image_8h.html#a49b8b52958866f98ae23a75c01d9243a">ED_image_uv_aspect</a>(tf-&gt;<a class="code" href="../../de/d88/structMTexPoly.html#acd90db38c741566c1f6adcdf59799b46">tpage</a>, &amp;aspx, &amp;aspy);
<a name="l00207"></a>00207         
<a name="l00208"></a>00208             <span class="keywordflow">if</span> (aspx != aspy)
<a name="l00209"></a>00209                 <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a333c242f547628e22a7e5c3dccee7720">param_aspect_ratio</a>(handle, aspx, aspy);
<a name="l00210"></a>00210         }
<a name="l00211"></a>00211     }
<a name="l00212"></a>00212     
<a name="l00213"></a>00213     <span class="comment">/* we need the vert indices */</span>
<a name="l00214"></a>00214     <a class="code" href="../../d5/db9/bmesh__mesh_8c.html#af3c1d0fa5b86a3ce17293fff3d2d0fcd">BM_mesh_elem_index_ensure</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a77867ab4129f63159b37bca3b652a798a69729bc1555e82d32291f917fcb7350c">BM_VERT</a>);
<a name="l00215"></a>00215 
<a name="l00216"></a>00216     <a class="code" href="../../d3/d88/BLI__rand_8h.html#a60a4a9e4b37c435f7f7a122c001f7e74">BLI_srand</a>(0);
<a name="l00217"></a>00217     
<a name="l00218"></a>00218     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l00219"></a>00219         <a class="code" href="../../df/d03/structScanFillVert.html">ScanFillVert</a> *v, *lastv, *firstv;
<a name="l00220"></a>00220         <a class="code" href="../../dd/de1/structScanFillFace.html">ScanFillFace</a> *sefa;
<a name="l00221"></a>00221         <a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#acd54a96b4bb576ad2d58315493769107">ParamKey</a> key, vkeys[4];
<a name="l00222"></a>00222         <a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#ab645b9a87161a6e3b9db6e755c977239">ParamBool</a> pin[4], select[4];
<a name="l00223"></a>00223         <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *ls[3];
<a name="l00224"></a>00224         <span class="keywordtype">float</span> *<a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>[4];
<a name="l00225"></a>00225         <span class="keywordtype">float</span> *uv[4];
<a name="l00226"></a>00226         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, lsel;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228         <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>)) || (sel &amp;&amp; <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>) == 0))
<a name="l00229"></a>00229             <span class="keywordflow">continue</span>;
<a name="l00230"></a>00230 
<a name="l00231"></a>00231         lsel = 0;
<a name="l00232"></a>00232 
<a name="l00233"></a>00233         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l00234"></a>00234             <span class="keywordflow">if</span> (<a class="code" href="../../dd/d25/ED__uvedit_8h.html#a795735e902ba1cffbdc1b398695dd93e">uvedit_uv_select_test</a>(em, scene, l)) {
<a name="l00235"></a>00235                 lsel = 1;
<a name="l00236"></a>00236                 <span class="keywordflow">break</span>;
<a name="l00237"></a>00237             }
<a name="l00238"></a>00238         }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240         <span class="keywordflow">if</span> (implicit &amp;&amp; !lsel)
<a name="l00241"></a>00241             <span class="keywordflow">continue</span>;
<a name="l00242"></a>00242 
<a name="l00243"></a>00243         key = (<a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#acd54a96b4bb576ad2d58315493769107">ParamKey</a>)efa;
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 
<a name="l00246"></a>00246         <span class="keywordflow">if</span> (efa-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a221be6c99989ead8ee0e1bba1eb0272e">len</a> == 3 || efa-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a221be6c99989ead8ee0e1bba1eb0272e">len</a> == 4) {
<a name="l00247"></a>00247             <span class="comment">/* for quads let parametrize split, it can make better decisions</span>
<a name="l00248"></a>00248 <span class="comment">             * about which split is best for unwrapping than scanfill */</span>
<a name="l00249"></a>00249             i = 0;
<a name="l00250"></a>00250             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l00251"></a>00251                 <a class="code" href="../../d6/d90/structMLoopUV.html">MLoopUV</a> *luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l00252"></a>00252                 vkeys[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = (<a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#acd54a96b4bb576ad2d58315493769107">ParamKey</a>)<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>);
<a name="l00253"></a>00253                 co[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>;
<a name="l00254"></a>00254                 uv[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>;
<a name="l00255"></a>00255                 pin[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = (luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac1a1ab0e7a809b060bffdac923f90954">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a6dbbe60b339c02e5c22d57f5151b2af8">MLOOPUV_PINNED</a>) != 0;
<a name="l00256"></a>00256                 select[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../dd/d25/ED__uvedit_8h.html#a795735e902ba1cffbdc1b398695dd93e">uvedit_uv_select_test</a>(em, scene, l) != 0;
<a name="l00257"></a>00257 
<a name="l00258"></a>00258                 i++;
<a name="l00259"></a>00259             }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261             <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#ab1d32764948d9b889b29541261cfc6a5">param_face_add</a>(handle, key, i, vkeys, co, uv, pin, select);
<a name="l00262"></a>00262         }
<a name="l00263"></a>00263         <span class="keywordflow">else</span> {
<a name="l00264"></a>00264             <span class="comment">/* ngon - scanfill time! */</span>
<a name="l00265"></a>00265             <a class="code" href="../../d3/de9/BLI__scanfill_8h.html#a64c925152a9e7e42969364bb1a46c521">BLI_begin_edgefill</a>(&amp;sf_ctx);
<a name="l00266"></a>00266             
<a name="l00267"></a>00267             firstv = lastv = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00268"></a>00268             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l00269"></a>00269                 <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00270"></a>00270                 
<a name="l00271"></a>00271                 v = <a class="code" href="../../d3/de9/BLI__scanfill_8h.html#ab364a42b3220a3b718e204469cb9cbd8">BLI_addfillvert</a>(&amp;sf_ctx, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>);
<a name="l00272"></a>00272                 
<a name="l00273"></a>00273                 <span class="comment">/* add small random offset */</span>
<a name="l00274"></a>00274                 <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++) {
<a name="l00275"></a>00275                     v-&gt;<a class="code" href="../../df/d03/structScanFillVert.html#a687a7dca43c6b6a011eda8eb44b035ad">co</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] += (<a class="code" href="../../d3/d88/BLI__rand_8h.html#a28a49a5f3f27a0875de8142fdcab7bd2">BLI_frand</a>() - 0.5f) * FLT_EPSILON * 50;
<a name="l00276"></a>00276                 }
<a name="l00277"></a>00277                 
<a name="l00278"></a>00278                 v-&gt;<a class="code" href="../../df/d03/structScanFillVert.html#a620ec0fbee5c94829936c45ef67dd260">tmp</a>.<a class="code" href="../../df/d03/structScanFillVert.html#a1f99d17c83f3f84cbd66edd53877833a">p</a> = l;
<a name="l00279"></a>00279 
<a name="l00280"></a>00280                 <span class="keywordflow">if</span> (lastv) {
<a name="l00281"></a>00281                     <a class="code" href="../../d3/de9/BLI__scanfill_8h.html#a7c332f93c7a18692fbbaec4c2d746fb7">BLI_addfilledge</a>(&amp;sf_ctx, lastv, v);
<a name="l00282"></a>00282                 }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284                 lastv = v;
<a name="l00285"></a>00285                 <span class="keywordflow">if</span> (!firstv) 
<a name="l00286"></a>00286                     firstv = v;
<a name="l00287"></a>00287             }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289             <a class="code" href="../../d3/de9/BLI__scanfill_8h.html#a7c332f93c7a18692fbbaec4c2d746fb7">BLI_addfilledge</a>(&amp;sf_ctx, firstv, v);
<a name="l00290"></a>00290 
<a name="l00291"></a>00291             <a class="code" href="../../d3/de9/BLI__scanfill_8h.html#a9ec667301ea0dc25b1912d7c92970888">BLI_edgefill_ex</a>(&amp;sf_ctx, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, efa-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a9401deff8be300468964ca48850ff702">no</a>);
<a name="l00292"></a>00292             <span class="keywordflow">for</span> (sefa = sf_ctx.<a class="code" href="../../d7/d8b/structScanFillContext.html#af37dfce6ca0313ee19dca2127a220b89">fillfacebase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sefa; sefa = sefa-&gt;<a class="code" href="../../dd/de1/structScanFillFace.html#a137e2d6ea8dc525ac9dddda3026b7096">next</a>) {
<a name="l00293"></a>00293                 ls[0] = sefa-&gt;<a class="code" href="../../dd/de1/structScanFillFace.html#acf303db938d2c32343c3c9bdf3455f9b">v1</a>-&gt;<a class="code" href="../../df/d03/structScanFillVert.html#a620ec0fbee5c94829936c45ef67dd260">tmp</a>.<a class="code" href="../../df/d03/structScanFillVert.html#a1f99d17c83f3f84cbd66edd53877833a">p</a>;
<a name="l00294"></a>00294                 ls[1] = sefa-&gt;<a class="code" href="../../dd/de1/structScanFillFace.html#a6a144de71d8f45e67e6358887f248b38">v2</a>-&gt;<a class="code" href="../../df/d03/structScanFillVert.html#a620ec0fbee5c94829936c45ef67dd260">tmp</a>.<a class="code" href="../../df/d03/structScanFillVert.html#a1f99d17c83f3f84cbd66edd53877833a">p</a>;
<a name="l00295"></a>00295                 ls[2] = sefa-&gt;<a class="code" href="../../dd/de1/structScanFillFace.html#a8aef6cbbee62717747057d4a0f71db2b">v3</a>-&gt;<a class="code" href="../../df/d03/structScanFillVert.html#a620ec0fbee5c94829936c45ef67dd260">tmp</a>.<a class="code" href="../../df/d03/structScanFillVert.html#a1f99d17c83f3f84cbd66edd53877833a">p</a>;
<a name="l00296"></a>00296 
<a name="l00297"></a>00297                 <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++) {
<a name="l00298"></a>00298                     <a class="code" href="../../d6/d90/structMLoopUV.html">MLoopUV</a> *luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, ls[i]-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l00299"></a>00299                     vkeys[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = (<a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#acd54a96b4bb576ad2d58315493769107">ParamKey</a>)<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(ls[i]-&gt;v);
<a name="l00300"></a>00300                     co[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = ls[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>;
<a name="l00301"></a>00301                     uv[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>;
<a name="l00302"></a>00302                     pin[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = (luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac1a1ab0e7a809b060bffdac923f90954">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a6dbbe60b339c02e5c22d57f5151b2af8">MLOOPUV_PINNED</a>) != 0;
<a name="l00303"></a>00303                     select[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../dd/d25/ED__uvedit_8h.html#a795735e902ba1cffbdc1b398695dd93e">uvedit_uv_select_test</a>(em, scene, ls[i]) != 0;
<a name="l00304"></a>00304                 }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306                 <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#ab1d32764948d9b889b29541261cfc6a5">param_face_add</a>(handle, key, 3, vkeys, co, uv, pin, select);
<a name="l00307"></a>00307             }
<a name="l00308"></a>00308 
<a name="l00309"></a>00309             <a class="code" href="../../d3/de9/BLI__scanfill_8h.html#a1e46e63b4decf290c8f78dbbabd94304">BLI_end_edgefill</a>(&amp;sf_ctx);
<a name="l00310"></a>00310         }
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     <span class="keywordflow">if</span> (!implicit) {
<a name="l00314"></a>00314         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (eed, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fa38e0ad1c62821fba188c45ddd39d6723">BM_EDGES_OF_MESH</a>) {
<a name="l00315"></a>00315             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(eed, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a2cc0b5f9695e7e38ce7b0bed337e55d2">BM_ELEM_SEAM</a>)) {
<a name="l00316"></a>00316                 <a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#acd54a96b4bb576ad2d58315493769107">ParamKey</a> vkeys[2];
<a name="l00317"></a>00317                 vkeys[0] = (<a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#acd54a96b4bb576ad2d58315493769107">ParamKey</a>)<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(eed-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#ab6378c5ea7e85917c389a1dfdff790ea">v1</a>);
<a name="l00318"></a>00318                 vkeys[1] = (<a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#acd54a96b4bb576ad2d58315493769107">ParamKey</a>)<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(eed-&gt;<a class="code" href="../../de/d6e/structBMEdge.html#a00090f09abd0ef12bcf279cb0c41c0ca">v2</a>);
<a name="l00319"></a>00319                 <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a9ce9338668a712d712d00e6939e64268">param_edge_set_seam</a>(handle, vkeys);
<a name="l00320"></a>00320             }
<a name="l00321"></a>00321         }
<a name="l00322"></a>00322     }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a3b2b7d16aea76b752d797b030bdc954a">param_construct_end</a>(handle, fill, implicit);
<a name="l00325"></a>00325 
<a name="l00326"></a>00326     <span class="keywordflow">return</span> handle;
<a name="l00327"></a>00327 }
<a name="l00328"></a>00328 
<a name="l00329"></a>00329 
<a name="l00330"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a94d9ee94c509e08a2e323df75eace2fe">00330</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a94d9ee94c509e08a2e323df75eace2fe">texface_from_original_index</a>(<a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa, <span class="keywordtype">int</span> index, <span class="keywordtype">float</span> **uv, <a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#ab645b9a87161a6e3b9db6e755c977239">ParamBool</a> *pin, <a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#ab645b9a87161a6e3b9db6e755c977239">ParamBool</a> *select, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em)
<a name="l00331"></a>00331 {
<a name="l00332"></a>00332     <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l00333"></a>00333     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> liter;
<a name="l00334"></a>00334     <a class="code" href="../../d6/d90/structMLoopUV.html">MLoopUV</a> *luv;
<a name="l00335"></a>00335 
<a name="l00336"></a>00336     *uv = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00337"></a>00337     *pin = 0;
<a name="l00338"></a>00338     *select = 1;
<a name="l00339"></a>00339 
<a name="l00340"></a>00340     <span class="keywordflow">if</span> (index == <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a9c45061d42a9d82ed1a425e2b997c200">ORIGINDEX_NONE</a>)
<a name="l00341"></a>00341         <span class="keywordflow">return</span>;
<a name="l00342"></a>00342 
<a name="l00343"></a>00343     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l00344"></a>00344         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a0ad5b2de8c733401a8c223f0509422c9">BM_elem_index_get</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>) == index) {
<a name="l00345"></a>00345             luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l00346"></a>00346             *uv = luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>;
<a name="l00347"></a>00347             *pin = (luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac1a1ab0e7a809b060bffdac923f90954">flag</a> &amp; <a class="code" href="../../d4/d36/DNA__meshdata__types_8h.html#a6dbbe60b339c02e5c22d57f5151b2af8">MLOOPUV_PINNED</a>) ? 1 : 0;
<a name="l00348"></a>00348             *select = (<a class="code" href="../../dd/d25/ED__uvedit_8h.html#a795735e902ba1cffbdc1b398695dd93e">uvedit_uv_select_test</a>(em, scene, l) != 0);
<a name="l00349"></a>00349         }
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351 }
<a name="l00352"></a>00352 
<a name="l00353"></a>00353 <span class="comment">/* unwrap handle initialization for subsurf aware-unwrapper. The many modifications required to make the original function(see above)</span>
<a name="l00354"></a>00354 <span class="comment"> * work justified the existence of a new function. */</span>
<a name="l00355"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#aa1612cbbfba2ac50d21a4b3578d52590">00355</a> <span class="keyword">static</span> <a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#ac78969cb448fed335a47b69eac4f3a7d">ParamHandle</a> *<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#aa1612cbbfba2ac50d21a4b3578d52590">construct_param_handle_subsurfed</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <span class="keywordtype">short</span> fill, <span class="keywordtype">short</span> sel, <span class="keywordtype">short</span> correct_aspect)
<a name="l00356"></a>00356 {
<a name="l00357"></a>00357     <a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#ac78969cb448fed335a47b69eac4f3a7d">ParamHandle</a> *handle;
<a name="l00358"></a>00358     <span class="comment">/* index pointers */</span>
<a name="l00359"></a>00359     <a class="code" href="../../d6/da0/structMFace.html">MFace</a> *face;
<a name="l00360"></a>00360     <a class="code" href="../../d6/ded/structMEdge.html">MEdge</a> *edge;
<a name="l00361"></a>00361     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *editFace;
<a name="l00362"></a>00362     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00363"></a>00363 
<a name="l00364"></a>00364     <span class="comment">/* modifier initialization data, will  control what type of subdivision will happen*/</span>
<a name="l00365"></a>00365     <a class="code" href="../../dd/d1e/structSubsurfModifierData.html">SubsurfModifierData</a> smd = {{0}};
<a name="l00366"></a>00366     <span class="comment">/* Used to hold subsurfed Mesh */</span>
<a name="l00367"></a>00367     <a class="code" href="../../d5/d6c/structDerivedMesh.html">DerivedMesh</a> *derivedMesh, *initialDerived;
<a name="l00368"></a>00368     <span class="comment">/* holds original indices for subsurfed mesh */</span>
<a name="l00369"></a>00369     <span class="keywordtype">int</span> *origVertIndices, *origFaceIndices, *origEdgeIndices;
<a name="l00370"></a>00370     <span class="comment">/* Holds vertices of subsurfed mesh */</span>
<a name="l00371"></a>00371     <a class="code" href="../../d8/de5/structMVert.html">MVert</a> *subsurfedVerts;
<a name="l00372"></a>00372     <a class="code" href="../../d6/ded/structMEdge.html">MEdge</a> *subsurfedEdges;
<a name="l00373"></a>00373     <a class="code" href="../../d6/da0/structMFace.html">MFace</a> *subsurfedFaces;
<a name="l00374"></a>00374     <span class="comment">/* number of vertices and faces for subsurfed mesh*/</span>
<a name="l00375"></a>00375     <span class="keywordtype">int</span> numOfEdges, numOfFaces;
<a name="l00376"></a>00376 
<a name="l00377"></a>00377     <span class="comment">/* holds a map to editfaces for every subsurfed MFace. These will be used to get hidden/ selected flags etc. */</span>
<a name="l00378"></a>00378     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> **<a class="code" href="../../d0/d4f/octree_8cpp.html#a838db152c5970bd3a313e1cd2ed7a5fd">faceMap</a>;
<a name="l00379"></a>00379     <span class="comment">/* similar to the above, we need a way to map edges to their original ones */</span>
<a name="l00380"></a>00380     <a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> **edgeMap;
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     handle = <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a46731e2bf2118bfa6a4b361117003490">param_construct_begin</a>();
<a name="l00383"></a>00383 
<a name="l00384"></a>00384     <span class="keywordflow">if</span> (correct_aspect) {
<a name="l00385"></a>00385         editFace = <a class="code" href="../../d5/def/bmesh__marking_8c.html#a6e02febedf269e86d8f9cb8efedd9500">BM_active_face_get</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00386"></a>00386 
<a name="l00387"></a>00387         <span class="keywordflow">if</span> (editFace) {
<a name="l00388"></a>00388             <a class="code" href="../../de/d88/structMTexPoly.html">MTexPoly</a> *tf;
<a name="l00389"></a>00389             <span class="keywordtype">float</span> aspx, aspy;
<a name="l00390"></a>00390             tf = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abda690b32c834c8ee41e225cfd2d9e49">pdata</a>, editFace-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a80c8c910b6b28425ea8544e07741092c">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a05731a08cef6d81e74c221963ae25712">CD_MTEXPOLY</a>);
<a name="l00391"></a>00391 
<a name="l00392"></a>00392             <a class="code" href="../../de/d53/ED__image_8h.html#a49b8b52958866f98ae23a75c01d9243a">ED_image_uv_aspect</a>(tf-&gt;<a class="code" href="../../de/d88/structMTexPoly.html#acd90db38c741566c1f6adcdf59799b46">tpage</a>, &amp;aspx, &amp;aspy);
<a name="l00393"></a>00393 
<a name="l00394"></a>00394             <span class="keywordflow">if</span> (aspx != aspy)
<a name="l00395"></a>00395                 <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a333c242f547628e22a7e5c3dccee7720">param_aspect_ratio</a>(handle, aspx, aspy);
<a name="l00396"></a>00396         }
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398 
<a name="l00399"></a>00399     <span class="comment">/* number of subdivisions to perform */</span>
<a name="l00400"></a>00400     smd.<a class="code" href="../../dd/d1e/structSubsurfModifierData.html#a64dfc0dbc8ce587b1e52733070241363">levels</a> = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#aa0392513d48a193ed720f309e2824ec0">uv_subsurf_level</a>;
<a name="l00401"></a>00401     smd.<a class="code" href="../../dd/d1e/structSubsurfModifierData.html#ac73fe5bff5b1eb4f16b894077e7cd074">subdivType</a> = <a class="code" href="../../df/d96/DNA__mesh__types_8h.html#a80f6c06037b3877e7c7971b0228e519a">ME_CC_SUBSURF</a>;
<a name="l00402"></a>00402         
<a name="l00403"></a>00403     initialDerived = <a class="code" href="../../dd/d15/BKE__cdderivedmesh_8h.html#a76ccb905297ec18a26c8187f551a7e34">CDDM_from_BMEditMesh</a>(em, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0);
<a name="l00404"></a>00404     derivedMesh = <a class="code" href="../../d9/d35/BKE__subsurf_8h.html#a57ccebcc6ff96fae9584945985e6d916">subsurf_make_derived_from_derived</a>(initialDerived, &amp;smd,
<a name="l00405"></a>00405                                                     0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0, 1);
<a name="l00406"></a>00406 
<a name="l00407"></a>00407     initialDerived-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a36c159344a023f5fbe64f12006c8647f">release</a>(initialDerived);
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     <span class="comment">/* get the derived data */</span>
<a name="l00410"></a>00410     subsurfedVerts = derivedMesh-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#adf25b9f9aee2bb3846fe2d0c4a2ab1d4">getVertArray</a>(derivedMesh);
<a name="l00411"></a>00411     subsurfedEdges = derivedMesh-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#ae5b98f2e9b75d92be2854b7ab25e5521">getEdgeArray</a>(derivedMesh);
<a name="l00412"></a>00412     subsurfedFaces = derivedMesh-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#aebdc3d5680e822d40c479530c23a56a1">getTessFaceArray</a>(derivedMesh);
<a name="l00413"></a>00413 
<a name="l00414"></a>00414     origVertIndices = derivedMesh-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#aac2f1d3ce8a7a1a66926e1d295707e67">getVertDataArray</a>(derivedMesh, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a5e2cdbe47f447a68d43a9410d8c42100">CD_ORIGINDEX</a>);
<a name="l00415"></a>00415     origEdgeIndices = derivedMesh-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a9afc810992214e6dac919ab7a522bd0a">getEdgeDataArray</a>(derivedMesh, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a5e2cdbe47f447a68d43a9410d8c42100">CD_ORIGINDEX</a>);
<a name="l00416"></a>00416     origFaceIndices = derivedMesh-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#ab62c496219df5c1429b6cb0ec051bfac">getTessFaceDataArray</a>(derivedMesh, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a5e2cdbe47f447a68d43a9410d8c42100">CD_ORIGINDEX</a>);
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     numOfEdges = derivedMesh-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a3b3f4272750d320851296b91df489952">getNumEdges</a>(derivedMesh);
<a name="l00419"></a>00419     numOfFaces = derivedMesh-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a3481fefe300b7d6b456071320be70c56">getNumTessFaces</a>(derivedMesh);
<a name="l00420"></a>00420 
<a name="l00421"></a>00421     faceMap = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(numOfFaces * <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *), <span class="stringliteral">&quot;unwrap_edit_face_map&quot;</span>);
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     <a class="code" href="../../d5/db9/bmesh__mesh_8c.html#af3c1d0fa5b86a3ce17293fff3d2d0fcd">BM_mesh_elem_index_ensure</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a77867ab4129f63159b37bca3b652a798a69729bc1555e82d32291f917fcb7350c">BM_VERT</a>);
<a name="l00424"></a>00424     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#aa97a3443500c36b7a92a1e2970370561">EDBM_index_arrays_init</a>(em, 0, 1, 1);
<a name="l00425"></a>00425 
<a name="l00426"></a>00426     <span class="comment">/* map subsurfed faces to original editFaces */</span>
<a name="l00427"></a>00427     <span class="keywordflow">for</span> (i = 0; i &lt; numOfFaces; i++)
<a name="l00428"></a>00428         faceMap[i] = <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a79834f648f43a4b01046a46de38fbcec">EDBM_face_at_index</a>(em, origFaceIndices[i]);
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     edgeMap = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(numOfEdges * <span class="keyword">sizeof</span>(<a class="code" href="../../de/d6e/structBMEdge.html">BMEdge</a> *), <span class="stringliteral">&quot;unwrap_edit_edge_map&quot;</span>);
<a name="l00431"></a>00431 
<a name="l00432"></a>00432     <span class="comment">/* map subsurfed edges to original editEdges */</span>
<a name="l00433"></a>00433     <span class="keywordflow">for</span> (i = 0; i &lt; numOfEdges; i++) {
<a name="l00434"></a>00434         <span class="comment">/* not all edges correspond to an old edge */</span>
<a name="l00435"></a>00435         edgeMap[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = (origEdgeIndices[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] != -1) ?
<a name="l00436"></a>00436                      <a class="code" href="../../d5/dd6/ED__mesh_8h.html#a84b498997c52686a55d7ea755d1e6bc3">EDBM_edge_at_index</a>(em, origEdgeIndices[i]) : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00437"></a>00437     }
<a name="l00438"></a>00438 
<a name="l00439"></a>00439     <a class="code" href="../../d5/dd6/ED__mesh_8h.html#ade6a9b6920d5141b0102b60995a5b91f">EDBM_index_arrays_free</a>(em);
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     <span class="comment">/* Prepare and feed faces to the solver */</span>
<a name="l00442"></a>00442     <span class="keywordflow">for</span> (i = 0; i &lt; numOfFaces; i++) {
<a name="l00443"></a>00443         <a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#acd54a96b4bb576ad2d58315493769107">ParamKey</a> key, vkeys[4];
<a name="l00444"></a>00444         <a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#ab645b9a87161a6e3b9db6e755c977239">ParamBool</a> pin[4], select[4];
<a name="l00445"></a>00445         <span class="keywordtype">float</span> *<a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>[4];
<a name="l00446"></a>00446         <span class="keywordtype">float</span> *uv[4];
<a name="l00447"></a>00447         <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *origFace = faceMap[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00448"></a>00448         
<a name="l00449"></a>00449         face = subsurfedFaces + <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00450"></a>00450 
<a name="l00451"></a>00451         <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a13290558e3abc572fcfb0c4f66a8c95f">uv_flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8db57005d53c7c86557cdfd7915b76e5">UV_SYNC_SELECTION</a>) {
<a name="l00452"></a>00452             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(origFace, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>))
<a name="l00453"></a>00453                 <span class="keywordflow">continue</span>;
<a name="l00454"></a>00454         }
<a name="l00455"></a>00455         <span class="keywordflow">else</span> {
<a name="l00456"></a>00456             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(origFace, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>) || (sel &amp;&amp; !<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(origFace, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)))
<a name="l00457"></a>00457                 <span class="keywordflow">continue</span>;
<a name="l00458"></a>00458         }
<a name="l00459"></a>00459 
<a name="l00460"></a>00460         <span class="comment">/* We will not check for v4 here. Subsurfed mfaces always have 4 vertices. */</span>
<a name="l00461"></a>00461         key = (<a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#acd54a96b4bb576ad2d58315493769107">ParamKey</a>)face;
<a name="l00462"></a>00462         vkeys[0] = (<a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#acd54a96b4bb576ad2d58315493769107">ParamKey</a>)face-&gt;<a class="code" href="../../d6/da0/structMFace.html#a7bbd2d1ca59c1ed8edd859c0a869081d">v1</a>;
<a name="l00463"></a>00463         vkeys[1] = (<a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#acd54a96b4bb576ad2d58315493769107">ParamKey</a>)face-&gt;<a class="code" href="../../d6/da0/structMFace.html#a3e56f10b57b97167b3db97024920f693">v2</a>;
<a name="l00464"></a>00464         vkeys[2] = (<a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#acd54a96b4bb576ad2d58315493769107">ParamKey</a>)face-&gt;<a class="code" href="../../d6/da0/structMFace.html#ac3bd1c8c8cb82e73685b9bfead2b30da">v3</a>;
<a name="l00465"></a>00465         vkeys[3] = (<a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#acd54a96b4bb576ad2d58315493769107">ParamKey</a>)face-&gt;<a class="code" href="../../d6/da0/structMFace.html#ab3fb5a76f4c838226244c710af79e3fc">v4</a>;
<a name="l00466"></a>00466 
<a name="l00467"></a>00467         co[0] = subsurfedVerts[face-&gt;<a class="code" href="../../d6/da0/structMFace.html#a7bbd2d1ca59c1ed8edd859c0a869081d">v1</a>].<a class="code" href="../../d8/de5/structMVert.html#a7682e4afa4b2ff47a3e17a4a3f670f1f">co</a>;
<a name="l00468"></a>00468         co[1] = subsurfedVerts[face-&gt;<a class="code" href="../../d6/da0/structMFace.html#a3e56f10b57b97167b3db97024920f693">v2</a>].<a class="code" href="../../d8/de5/structMVert.html#a7682e4afa4b2ff47a3e17a4a3f670f1f">co</a>;
<a name="l00469"></a>00469         co[2] = subsurfedVerts[face-&gt;<a class="code" href="../../d6/da0/structMFace.html#ac3bd1c8c8cb82e73685b9bfead2b30da">v3</a>].<a class="code" href="../../d8/de5/structMVert.html#a7682e4afa4b2ff47a3e17a4a3f670f1f">co</a>;
<a name="l00470"></a>00470         co[3] = subsurfedVerts[face-&gt;<a class="code" href="../../d6/da0/structMFace.html#ab3fb5a76f4c838226244c710af79e3fc">v4</a>].<a class="code" href="../../d8/de5/structMVert.html#a7682e4afa4b2ff47a3e17a4a3f670f1f">co</a>;
<a name="l00471"></a>00471         
<a name="l00472"></a>00472         <span class="comment">/* This is where all the magic is done. If the vertex exists in the, we pass the original uv pointer to the solver, thus</span>
<a name="l00473"></a>00473 <span class="comment">         * flushing the solution to the edit mesh. */</span>
<a name="l00474"></a>00474         <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a94d9ee94c509e08a2e323df75eace2fe">texface_from_original_index</a>(origFace, origVertIndices[face-&gt;<a class="code" href="../../d6/da0/structMFace.html#a7bbd2d1ca59c1ed8edd859c0a869081d">v1</a>], &amp;uv[0], &amp;pin[0], &amp;select[0], scene, em);
<a name="l00475"></a>00475         <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a94d9ee94c509e08a2e323df75eace2fe">texface_from_original_index</a>(origFace, origVertIndices[face-&gt;<a class="code" href="../../d6/da0/structMFace.html#a3e56f10b57b97167b3db97024920f693">v2</a>], &amp;uv[1], &amp;pin[1], &amp;select[1], scene, em);
<a name="l00476"></a>00476         <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a94d9ee94c509e08a2e323df75eace2fe">texface_from_original_index</a>(origFace, origVertIndices[face-&gt;<a class="code" href="../../d6/da0/structMFace.html#ac3bd1c8c8cb82e73685b9bfead2b30da">v3</a>], &amp;uv[2], &amp;pin[2], &amp;select[2], scene, em);
<a name="l00477"></a>00477         <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a94d9ee94c509e08a2e323df75eace2fe">texface_from_original_index</a>(origFace, origVertIndices[face-&gt;<a class="code" href="../../d6/da0/structMFace.html#ab3fb5a76f4c838226244c710af79e3fc">v4</a>], &amp;uv[3], &amp;pin[3], &amp;select[3], scene, em);
<a name="l00478"></a>00478 
<a name="l00479"></a>00479         <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#ab1d32764948d9b889b29541261cfc6a5">param_face_add</a>(handle, key, 4, vkeys, co, uv, pin, select);
<a name="l00480"></a>00480     }
<a name="l00481"></a>00481 
<a name="l00482"></a>00482     <span class="comment">/* these are calculated from original mesh too */</span>
<a name="l00483"></a>00483     <span class="keywordflow">for</span> (edge = subsurfedEdges, i = 0; i &lt; numOfEdges; i++, edge++) {
<a name="l00484"></a>00484         <span class="keywordflow">if</span> ((edgeMap[i] != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(edgeMap[i], <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a2cc0b5f9695e7e38ce7b0bed337e55d2">BM_ELEM_SEAM</a>)) {
<a name="l00485"></a>00485             <a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#acd54a96b4bb576ad2d58315493769107">ParamKey</a> vkeys[2];
<a name="l00486"></a>00486             vkeys[0] = (<a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#acd54a96b4bb576ad2d58315493769107">ParamKey</a>)edge-&gt;<a class="code" href="../../d6/ded/structMEdge.html#a42030809efbf6c6d2b3fe156966075fd">v1</a>;
<a name="l00487"></a>00487             vkeys[1] = (<a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#acd54a96b4bb576ad2d58315493769107">ParamKey</a>)edge-&gt;<a class="code" href="../../d6/ded/structMEdge.html#a62ddab48309048adbaea38a5d4f5ebaa">v2</a>;
<a name="l00488"></a>00488             <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a9ce9338668a712d712d00e6939e64268">param_edge_set_seam</a>(handle, vkeys);
<a name="l00489"></a>00489         }
<a name="l00490"></a>00490     }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a3b2b7d16aea76b752d797b030bdc954a">param_construct_end</a>(handle, fill, 0);
<a name="l00493"></a>00493 
<a name="l00494"></a>00494     <span class="comment">/* cleanup */</span>
<a name="l00495"></a>00495     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(faceMap);
<a name="l00496"></a>00496     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(edgeMap);
<a name="l00497"></a>00497     derivedMesh-&gt;<a class="code" href="../../d5/d6c/structDerivedMesh.html#a36c159344a023f5fbe64f12006c8647f">release</a>(derivedMesh);
<a name="l00498"></a>00498 
<a name="l00499"></a>00499     <span class="keywordflow">return</span> handle;
<a name="l00500"></a>00500 }
<a name="l00501"></a>00501 
<a name="l00502"></a>00502 <span class="comment">/* ******************** Minimize Stretch operator **************** */</span>
<a name="l00503"></a>00503 
<a name="l00504"></a><a class="code" href="../../d6/d8b/structMinStretch.html">00504</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d8b/structMinStretch.html">MinStretch</a> {
<a name="l00505"></a><a class="code" href="../../d6/d8b/structMinStretch.html#a27f091ed218793c93dd8ac11d7225066">00505</a>     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *<a class="code" href="../../d6/d8b/structMinStretch.html#a27f091ed218793c93dd8ac11d7225066">scene</a>;
<a name="l00506"></a><a class="code" href="../../d6/d8b/structMinStretch.html#a684f957ebad69bbe9a8757d852c59df6">00506</a>     <a class="code" href="../../de/de7/structObject.html">Object</a> *<a class="code" href="../../d6/d8b/structMinStretch.html#a684f957ebad69bbe9a8757d852c59df6">obedit</a>;
<a name="l00507"></a><a class="code" href="../../d6/d8b/structMinStretch.html#a974a5023f16d1c4b50888f9e751237e3">00507</a>     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *<a class="code" href="../../d6/d8b/structMinStretch.html#a974a5023f16d1c4b50888f9e751237e3">em</a>;
<a name="l00508"></a><a class="code" href="../../d6/d8b/structMinStretch.html#afd536498645ca5bbf7772854e84cf3cb">00508</a>     <a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#ac78969cb448fed335a47b69eac4f3a7d">ParamHandle</a> *<a class="code" href="../../d6/d8b/structMinStretch.html#afd536498645ca5bbf7772854e84cf3cb">handle</a>;
<a name="l00509"></a><a class="code" href="../../d6/d8b/structMinStretch.html#a910638512e2ed486b8d8c4bb91170a7c">00509</a>     <span class="keywordtype">float</span> <a class="code" href="../../d6/d8b/structMinStretch.html#a910638512e2ed486b8d8c4bb91170a7c">blend</a>;
<a name="l00510"></a><a class="code" href="../../d6/d8b/structMinStretch.html#a9f075ece115c17632ff7603309af2ec6">00510</a>     <span class="keywordtype">double</span> <a class="code" href="../../d6/d8b/structMinStretch.html#a9f075ece115c17632ff7603309af2ec6">lasttime</a>;
<a name="l00511"></a><a class="code" href="../../d6/d8b/structMinStretch.html#a7c500b377493b1960b473d1509c984e5">00511</a>     <span class="keywordtype">int</span> <a class="code" href="../../d6/d8b/structMinStretch.html#adb3d1ccd2482323392b30b69263eebf5">i</a>, <a class="code" href="../../d6/d8b/structMinStretch.html#a7c500b377493b1960b473d1509c984e5">iterations</a>;
<a name="l00512"></a><a class="code" href="../../d6/d8b/structMinStretch.html#a21185a10c4ad35d79f7c766a32f32126">00512</a>     <a class="code" href="../../d9/d33/structwmTimer.html">wmTimer</a> *<a class="code" href="../../d6/d8b/structMinStretch.html#a21185a10c4ad35d79f7c766a32f32126">timer</a>;
<a name="l00513"></a>00513 } <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a477175ce659a0a9f760a08fad787de6e">MinStretch</a>;
<a name="l00514"></a>00514 
<a name="l00515"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a79bfdc60a5230d394433c56b08bc924a">00515</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a79bfdc60a5230d394433c56b08bc924a">minimize_stretch_init</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00516"></a>00516 {
<a name="l00517"></a>00517     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00518"></a>00518     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l00519"></a>00519     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a4d9806c4d2c9d7777ae1619839d6baed" title="Return the BMEditMesh for a given object.">BMEdit_FromObject</a>(obedit);
<a name="l00520"></a>00520     <a class="code" href="../../d6/d8b/structMinStretch.html">MinStretch</a> *ms;
<a name="l00521"></a>00521     <span class="keywordtype">int</span> fill_holes = <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;fill_holes&quot;</span>);
<a name="l00522"></a>00522     <span class="keywordtype">short</span> implicit = 1;
<a name="l00523"></a>00523 
<a name="l00524"></a>00524     <span class="keywordflow">if</span> (!<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a0b81eb2dd6abd09ec43b600388f37d69">uvedit_have_selection</a>(scene, em, implicit)) {
<a name="l00525"></a>00525         <span class="keywordflow">return</span> 0;
<a name="l00526"></a>00526     }
<a name="l00527"></a>00527 
<a name="l00528"></a>00528     ms = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d8b/structMinStretch.html">MinStretch</a>), <span class="stringliteral">&quot;MinStretch&quot;</span>);
<a name="l00529"></a>00529     ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a27f091ed218793c93dd8ac11d7225066">scene</a> = scene;
<a name="l00530"></a>00530     ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a684f957ebad69bbe9a8757d852c59df6">obedit</a> = obedit;
<a name="l00531"></a>00531     ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a974a5023f16d1c4b50888f9e751237e3">em</a> = em;
<a name="l00532"></a>00532     ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a910638512e2ed486b8d8c4bb91170a7c">blend</a> = <a class="code" href="../../d3/d10/rna__access_8c.html#a99bfb3295a4df6fef29f16924fd24c79">RNA_float_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;blend&quot;</span>);
<a name="l00533"></a>00533     ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a7c500b377493b1960b473d1509c984e5">iterations</a> = <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;iterations&quot;</span>);
<a name="l00534"></a>00534     ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#adb3d1ccd2482323392b30b69263eebf5">i</a> = 0;
<a name="l00535"></a>00535     ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#afd536498645ca5bbf7772854e84cf3cb">handle</a> = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ad947fa49a395babf2804f4fea900dca4">construct_param_handle</a>(scene, em, implicit, fill_holes, 1, 1);
<a name="l00536"></a>00536     ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a9f075ece115c17632ff7603309af2ec6">lasttime</a> = <a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>();
<a name="l00537"></a>00537 
<a name="l00538"></a>00538     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a052d84f473c8de8108c654fc25723b26">param_stretch_begin</a>(ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#afd536498645ca5bbf7772854e84cf3cb">handle</a>);
<a name="l00539"></a>00539     <span class="keywordflow">if</span> (ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a910638512e2ed486b8d8c4bb91170a7c">blend</a> != 0.0f)
<a name="l00540"></a>00540         <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#aeb4f4be3d9f6cb25c47d99617f2836b5">param_stretch_blend</a>(ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#afd536498645ca5bbf7772854e84cf3cb">handle</a>, ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a910638512e2ed486b8d8c4bb91170a7c">blend</a>);
<a name="l00541"></a>00541 
<a name="l00542"></a>00542     op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a> = ms;
<a name="l00543"></a>00543 
<a name="l00544"></a>00544     <span class="keywordflow">return</span> 1;
<a name="l00545"></a>00545 }
<a name="l00546"></a>00546 
<a name="l00547"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#aae4175beeae918e736066c29392cfcb5">00547</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#aae4175beeae918e736066c29392cfcb5">minimize_stretch_iteration</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <span class="keywordtype">int</span> interactive)
<a name="l00548"></a>00548 {
<a name="l00549"></a>00549     <a class="code" href="../../d6/d8b/structMinStretch.html">MinStretch</a> *ms = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00550"></a>00550     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa = <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l00551"></a>00551 
<a name="l00552"></a>00552     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#aeb4f4be3d9f6cb25c47d99617f2836b5">param_stretch_blend</a>(ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#afd536498645ca5bbf7772854e84cf3cb">handle</a>, ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a910638512e2ed486b8d8c4bb91170a7c">blend</a>);
<a name="l00553"></a>00553     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a13cc0aa87c3d2c88132c7c507d9a6990">param_stretch_iter</a>(ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#afd536498645ca5bbf7772854e84cf3cb">handle</a>);
<a name="l00554"></a>00554 
<a name="l00555"></a>00555     ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#adb3d1ccd2482323392b30b69263eebf5">i</a>++;
<a name="l00556"></a>00556     <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;iterations&quot;</span>, ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#adb3d1ccd2482323392b30b69263eebf5">i</a>);
<a name="l00557"></a>00557 
<a name="l00558"></a>00558     <span class="keywordflow">if</span> (interactive &amp;&amp; (<a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>() - ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a9f075ece115c17632ff7603309af2ec6">lasttime</a> &gt; 0.5)) {
<a name="l00559"></a>00559         <span class="keywordtype">char</span> <a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>[100];
<a name="l00560"></a>00560 
<a name="l00561"></a>00561         <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a3b1e9a9a5716bd641322bf0643fdcd4e">param_flush</a>(ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#afd536498645ca5bbf7772854e84cf3cb">handle</a>);
<a name="l00562"></a>00562 
<a name="l00563"></a>00563         <span class="keywordflow">if</span> (sa) {
<a name="l00564"></a>00564             <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(str, <span class="keyword">sizeof</span>(str), <span class="stringliteral">&quot;Minimize Stretch. Blend %.2f&quot;</span>, ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a910638512e2ed486b8d8c4bb91170a7c">blend</a>);
<a name="l00565"></a>00565             <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(sa, str);
<a name="l00566"></a>00566         }
<a name="l00567"></a>00567 
<a name="l00568"></a>00568         ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a9f075ece115c17632ff7603309af2ec6">lasttime</a> = <a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>();
<a name="l00569"></a>00569 
<a name="l00570"></a>00570         <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a684f957ebad69bbe9a8757d852c59df6">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l00571"></a>00571         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a684f957ebad69bbe9a8757d852c59df6">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l00572"></a>00572     }
<a name="l00573"></a>00573 }
<a name="l00574"></a>00574 
<a name="l00575"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a067a1df2691bb511454d427a71b37840">00575</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a067a1df2691bb511454d427a71b37840">minimize_stretch_exit</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <span class="keywordtype">int</span> cancel)
<a name="l00576"></a>00576 {
<a name="l00577"></a>00577     <a class="code" href="../../d6/d8b/structMinStretch.html">MinStretch</a> *ms = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00578"></a>00578     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa = <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l00579"></a>00579 
<a name="l00580"></a>00580     <span class="keywordflow">if</span> (sa)
<a name="l00581"></a>00581         <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(sa, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00582"></a>00582     <span class="keywordflow">if</span> (ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a21185a10c4ad35d79f7c766a32f32126">timer</a>)
<a name="l00583"></a>00583         <a class="code" href="../../d7/d6e/wm__window_8c.html#a1a9f31ba88dd1dd3982b3d8f02de2e75">WM_event_remove_timer</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C), <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C), ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a21185a10c4ad35d79f7c766a32f32126">timer</a>);
<a name="l00584"></a>00584 
<a name="l00585"></a>00585     <span class="keywordflow">if</span> (cancel)
<a name="l00586"></a>00586         <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a3297e77150dc2dd7ac4902de6dcc3e6c">param_flush_restore</a>(ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#afd536498645ca5bbf7772854e84cf3cb">handle</a>);
<a name="l00587"></a>00587     <span class="keywordflow">else</span>
<a name="l00588"></a>00588         <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a3b1e9a9a5716bd641322bf0643fdcd4e">param_flush</a>(ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#afd536498645ca5bbf7772854e84cf3cb">handle</a>);
<a name="l00589"></a>00589 
<a name="l00590"></a>00590     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a16bcf37b180e25754c55bc06f08bce63">param_stretch_end</a>(ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#afd536498645ca5bbf7772854e84cf3cb">handle</a>);
<a name="l00591"></a>00591     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a1eafb7091fead43a10e072402271d81b">param_delete</a>(ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#afd536498645ca5bbf7772854e84cf3cb">handle</a>);
<a name="l00592"></a>00592 
<a name="l00593"></a>00593     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a684f957ebad69bbe9a8757d852c59df6">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l00594"></a>00594     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a684f957ebad69bbe9a8757d852c59df6">obedit</a>-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l00595"></a>00595 
<a name="l00596"></a>00596     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ms);
<a name="l00597"></a>00597     op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00598"></a>00598 }
<a name="l00599"></a>00599 
<a name="l00600"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a594d7512de2443aee96933c74945f2ab">00600</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a594d7512de2443aee96933c74945f2ab">minimize_stretch_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00601"></a>00601 {
<a name="l00602"></a>00602     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, iterations;
<a name="l00603"></a>00603 
<a name="l00604"></a>00604     <span class="keywordflow">if</span> (!<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a79bfdc60a5230d394433c56b08bc924a">minimize_stretch_init</a>(C, op))
<a name="l00605"></a>00605         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     iterations = <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;iterations&quot;</span>);
<a name="l00608"></a>00608     <span class="keywordflow">for</span> (i = 0; i &lt; iterations; i++)
<a name="l00609"></a>00609         <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#aae4175beeae918e736066c29392cfcb5">minimize_stretch_iteration</a>(C, op, 0);
<a name="l00610"></a>00610     <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a067a1df2691bb511454d427a71b37840">minimize_stretch_exit</a>(C, op, 0);
<a name="l00611"></a>00611 
<a name="l00612"></a>00612     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00613"></a>00613 }
<a name="l00614"></a>00614 
<a name="l00615"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ac4828c96399952314d43ce8e8ab64f75">00615</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ac4828c96399952314d43ce8e8ab64f75">minimize_stretch_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l00616"></a>00616 {
<a name="l00617"></a>00617     <a class="code" href="../../d6/d8b/structMinStretch.html">MinStretch</a> *ms;
<a name="l00618"></a>00618 
<a name="l00619"></a>00619     <span class="keywordflow">if</span> (!<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a79bfdc60a5230d394433c56b08bc924a">minimize_stretch_init</a>(C, op))
<a name="l00620"></a>00620         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00621"></a>00621 
<a name="l00622"></a>00622     <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#aae4175beeae918e736066c29392cfcb5">minimize_stretch_iteration</a>(C, op, 1);
<a name="l00623"></a>00623 
<a name="l00624"></a>00624     ms = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00625"></a>00625     <a class="code" href="../../df/db0/wm__event__system_8c.html#ab89ad80681bbec4a06930903ea043251">WM_event_add_modal_handler</a>(C, op);
<a name="l00626"></a>00626     ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a21185a10c4ad35d79f7c766a32f32126">timer</a> = <a class="code" href="../../d7/d6e/wm__window_8c.html#af5bdd7109c7ea81c77a89d9f41585f3a">WM_event_add_timer</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C), <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C), <a class="code" href="../../d1/d40/wm__event__types_8h.html#a599217205dc3092c26567a2bd868ef3a">TIMER</a>, 0.01f);
<a name="l00627"></a>00627 
<a name="l00628"></a>00628     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l00629"></a>00629 }
<a name="l00630"></a>00630 
<a name="l00631"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a5b3a86369530a77498713ff902a3c8bc">00631</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a5b3a86369530a77498713ff902a3c8bc">minimize_stretch_modal</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l00632"></a>00632 {
<a name="l00633"></a>00633     <a class="code" href="../../d6/d8b/structMinStretch.html">MinStretch</a> *ms = op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l00634"></a>00634 
<a name="l00635"></a>00635     <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l00636"></a>00636         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#abe3de76b73fb856d283d4da41ad109e8">ESCKEY</a>:
<a name="l00637"></a>00637         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#adc87b609a6285a24e23172a90734044c">RIGHTMOUSE</a>:
<a name="l00638"></a>00638             <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a067a1df2691bb511454d427a71b37840">minimize_stretch_exit</a>(C, op, 1);
<a name="l00639"></a>00639             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00640"></a>00640         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a6c861c5ebabe8fe076ed84a2aaa7a1a0">RETKEY</a>:
<a name="l00641"></a>00641         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aafdc675e684c8485e8e27c7f2bafcbef">PADENTER</a>:
<a name="l00642"></a>00642         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>:
<a name="l00643"></a>00643             <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a067a1df2691bb511454d427a71b37840">minimize_stretch_exit</a>(C, op, 0);
<a name="l00644"></a>00644             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00645"></a>00645         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a58d161b0d7f338f7c6083654a83100d0">PADPLUSKEY</a>:
<a name="l00646"></a>00646         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae58fa49252a1cf05799ab21592491a30">WHEELUPMOUSE</a>:
<a name="l00647"></a>00647             <span class="keywordflow">if</span> (ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a910638512e2ed486b8d8c4bb91170a7c">blend</a> &lt; 0.95f) {
<a name="l00648"></a>00648                 ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a910638512e2ed486b8d8c4bb91170a7c">blend</a> += 0.1f;
<a name="l00649"></a>00649                 ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a9f075ece115c17632ff7603309af2ec6">lasttime</a> = 0.0f;
<a name="l00650"></a>00650                 <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;blend&quot;</span>, ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a910638512e2ed486b8d8c4bb91170a7c">blend</a>);
<a name="l00651"></a>00651                 <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#aae4175beeae918e736066c29392cfcb5">minimize_stretch_iteration</a>(C, op, 1);
<a name="l00652"></a>00652             }
<a name="l00653"></a>00653             <span class="keywordflow">break</span>;
<a name="l00654"></a>00654         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#af3feb147cfa2676ff6c909a61af4405b">PADMINUS</a>:
<a name="l00655"></a>00655         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a2ffb32901b9678d9b738e618330f60c0">WHEELDOWNMOUSE</a>:
<a name="l00656"></a>00656             <span class="keywordflow">if</span> (ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a910638512e2ed486b8d8c4bb91170a7c">blend</a> &gt; 0.05f) {
<a name="l00657"></a>00657                 ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a910638512e2ed486b8d8c4bb91170a7c">blend</a> -= 0.1f;
<a name="l00658"></a>00658                 ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a9f075ece115c17632ff7603309af2ec6">lasttime</a> = 0.0f;
<a name="l00659"></a>00659                 <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;blend&quot;</span>, ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a910638512e2ed486b8d8c4bb91170a7c">blend</a>);
<a name="l00660"></a>00660                 <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#aae4175beeae918e736066c29392cfcb5">minimize_stretch_iteration</a>(C, op, 1);
<a name="l00661"></a>00661             }
<a name="l00662"></a>00662             <span class="keywordflow">break</span>;
<a name="l00663"></a>00663         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a599217205dc3092c26567a2bd868ef3a">TIMER</a>:
<a name="l00664"></a>00664             <span class="keywordflow">if</span> (ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a21185a10c4ad35d79f7c766a32f32126">timer</a> == event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#afe8f2bc4e7e67063e0e2a92b08056c17">customdata</a>) {
<a name="l00665"></a>00665                 <span class="keywordtype">double</span> start = <a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>();
<a name="l00666"></a>00666 
<a name="l00667"></a>00667                 <span class="keywordflow">do</span> {
<a name="l00668"></a>00668                     <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#aae4175beeae918e736066c29392cfcb5">minimize_stretch_iteration</a>(C, op, 1);
<a name="l00669"></a>00669                 } <span class="keywordflow">while</span> (<a class="code" href="../../df/d73/time_8c.html#a4e990821a5feb6784e02c3f34642cc17">PIL_check_seconds_timer</a>() - start &lt; 0.01);
<a name="l00670"></a>00670             }
<a name="l00671"></a>00671             <span class="keywordflow">break</span>;
<a name="l00672"></a>00672     }
<a name="l00673"></a>00673 
<a name="l00674"></a>00674     <span class="keywordflow">if</span> (ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a7c500b377493b1960b473d1509c984e5">iterations</a> &amp;&amp; ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#adb3d1ccd2482323392b30b69263eebf5">i</a> &gt;= ms-&gt;<a class="code" href="../../d6/d8b/structMinStretch.html#a7c500b377493b1960b473d1509c984e5">iterations</a>) {
<a name="l00675"></a>00675         <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a067a1df2691bb511454d427a71b37840">minimize_stretch_exit</a>(C, op, 0);
<a name="l00676"></a>00676         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00677"></a>00677     }
<a name="l00678"></a>00678 
<a name="l00679"></a>00679     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l00680"></a>00680 }
<a name="l00681"></a>00681 
<a name="l00682"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a9db9e356a451edb63c3937530b7d6466">00682</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a9db9e356a451edb63c3937530b7d6466">minimize_stretch_cancel</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00683"></a>00683 {
<a name="l00684"></a>00684     <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a067a1df2691bb511454d427a71b37840">minimize_stretch_exit</a>(C, op, 1);
<a name="l00685"></a>00685 
<a name="l00686"></a>00686     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00687"></a>00687 }
<a name="l00688"></a>00688 
<a name="l00689"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#acaad8fdd140a666d49d107d9ae892e9d">00689</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d48/uvedit__intern_8h.html#af6e13d4e55f9d2fd2215ae2420a161cc">UV_OT_minimize_stretch</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00690"></a>00690 {
<a name="l00691"></a>00691     <span class="comment">/* identifiers */</span>
<a name="l00692"></a>00692     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Minimize Stretch&quot;</span>;
<a name="l00693"></a>00693     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;UV_OT_minimize_stretch&quot;</span>;
<a name="l00694"></a>00694     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#ac9470de8419174a032e9097a5ec317fd">OPTYPE_GRAB_POINTER</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a2458c730dbcabf67cc8917d8de127bab">OPTYPE_BLOCKING</a>;
<a name="l00695"></a>00695     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Reduce UV stretching by relaxing angles&quot;</span>;
<a name="l00696"></a>00696     
<a name="l00697"></a>00697     <span class="comment">/* api callbacks */</span>
<a name="l00698"></a>00698     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a594d7512de2443aee96933c74945f2ab">minimize_stretch_exec</a>;
<a name="l00699"></a>00699     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ac4828c96399952314d43ce8e8ab64f75">minimize_stretch_invoke</a>;
<a name="l00700"></a>00700     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a> = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a5b3a86369530a77498713ff902a3c8bc">minimize_stretch_modal</a>;
<a name="l00701"></a>00701     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a> = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a9db9e356a451edb63c3937530b7d6466">minimize_stretch_cancel</a>;
<a name="l00702"></a>00702     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a93d6c73a0c87af45aaa6d41e2b3cba34">ED_operator_uvedit</a>;
<a name="l00703"></a>00703 
<a name="l00704"></a>00704     <span class="comment">/* properties */</span>
<a name="l00705"></a>00705     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;fill_holes&quot;</span>, 1, <span class="stringliteral">&quot;Fill Holes&quot;</span>, <span class="stringliteral">&quot;Virtual fill holes in mesh before unwrapping, to better avoid overlaps and preserve symmetry&quot;</span>);
<a name="l00706"></a>00706     <a class="code" href="../../dc/d7e/rna__define_8c.html#a7c03544250eafc42691e8c921a8c4005">RNA_def_float_factor</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;blend&quot;</span>, 0.0f, 0.0f, 1.0f, <span class="stringliteral">&quot;Blend&quot;</span>, <span class="stringliteral">&quot;Blend factor between stretch minimized and original&quot;</span>, 0.0f, 1.0f);
<a name="l00707"></a>00707     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;iterations&quot;</span>, 0, 0, INT_MAX, <span class="stringliteral">&quot;Iterations&quot;</span>, <span class="stringliteral">&quot;Number of iterations to run, 0 is unlimited when run interactively&quot;</span>, 0, 100);
<a name="l00708"></a>00708 }
<a name="l00709"></a>00709 
<a name="l00710"></a>00710 <span class="comment">/* ******************** Pack Islands operator **************** */</span>
<a name="l00711"></a>00711 
<a name="l00712"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a7d8b76460b911ea1021d5dd4353b5fd7">00712</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a7d8b76460b911ea1021d5dd4353b5fd7">pack_islands_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00713"></a>00713 {
<a name="l00714"></a>00714     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00715"></a>00715     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l00716"></a>00716     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a4d9806c4d2c9d7777ae1619839d6baed" title="Return the BMEditMesh for a given object.">BMEdit_FromObject</a>(obedit);
<a name="l00717"></a>00717     <a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#ac78969cb448fed335a47b69eac4f3a7d">ParamHandle</a> *handle;
<a name="l00718"></a>00718     <span class="keywordtype">short</span> implicit = 1;
<a name="l00719"></a>00719 
<a name="l00720"></a>00720     <span class="keywordflow">if</span> (!<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a0b81eb2dd6abd09ec43b600388f37d69">uvedit_have_selection</a>(scene, em, implicit)) {
<a name="l00721"></a>00721         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00722"></a>00722     }
<a name="l00723"></a>00723 
<a name="l00724"></a>00724     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;margin&quot;</span>)) {
<a name="l00725"></a>00725         scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#ad7d9701f9f74bb16c13a2b6181ed3cde">uvcalc_margin</a> = <a class="code" href="../../d3/d10/rna__access_8c.html#a99bfb3295a4df6fef29f16924fd24c79">RNA_float_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;margin&quot;</span>);
<a name="l00726"></a>00726     }
<a name="l00727"></a>00727     <span class="keywordflow">else</span> {
<a name="l00728"></a>00728         <a class="code" href="../../d3/d10/rna__access_8c.html#aa36f2cf0133a312c322490ba0bff9b72">RNA_float_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;margin&quot;</span>, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#ad7d9701f9f74bb16c13a2b6181ed3cde">uvcalc_margin</a>);
<a name="l00729"></a>00729     }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731     handle = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ad947fa49a395babf2804f4fea900dca4">construct_param_handle</a>(scene, em, implicit, 0, 1, 1);
<a name="l00732"></a>00732     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a483e17314e8d665715b6c3cf55a5b1c7">param_pack</a>(handle, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#ad7d9701f9f74bb16c13a2b6181ed3cde">uvcalc_margin</a>);
<a name="l00733"></a>00733     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a3b1e9a9a5716bd641322bf0643fdcd4e">param_flush</a>(handle);
<a name="l00734"></a>00734     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a1eafb7091fead43a10e072402271d81b">param_delete</a>(handle);
<a name="l00735"></a>00735     
<a name="l00736"></a>00736     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l00737"></a>00737     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l00738"></a>00738 
<a name="l00739"></a>00739     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00740"></a>00740 }
<a name="l00741"></a>00741 
<a name="l00742"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#aeaf5b8bbf23bba510c5ca0d4c4fe56f2">00742</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d48/uvedit__intern_8h.html#af0a117a19f58c67ff37db423831f99d7">UV_OT_pack_islands</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00743"></a>00743 {
<a name="l00744"></a>00744     <span class="comment">/* identifiers */</span>
<a name="l00745"></a>00745     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Pack Islands&quot;</span>;
<a name="l00746"></a>00746     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;UV_OT_pack_islands&quot;</span>;
<a name="l00747"></a>00747     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00748"></a>00748     
<a name="l00749"></a>00749     <span class="comment">/* api callbacks */</span>
<a name="l00750"></a>00750     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a7d8b76460b911ea1021d5dd4353b5fd7">pack_islands_exec</a>;
<a name="l00751"></a>00751     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a93d6c73a0c87af45aaa6d41e2b3cba34">ED_operator_uvedit</a>;
<a name="l00752"></a>00752 
<a name="l00753"></a>00753     <span class="comment">/* properties */</span>
<a name="l00754"></a>00754     <a class="code" href="../../dc/d7e/rna__define_8c.html#a7c03544250eafc42691e8c921a8c4005">RNA_def_float_factor</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;margin&quot;</span>, 0.0f, 0.0f, 1.0f, <span class="stringliteral">&quot;Margin&quot;</span>, <span class="stringliteral">&quot;Space between islands&quot;</span>, 0.0f, 1.0f);
<a name="l00755"></a>00755 }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757 <span class="comment">/* ******************** Average Islands Scale operator **************** */</span>
<a name="l00758"></a>00758 
<a name="l00759"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ac9875b1bf39a10f655df25fa551e90d7">00759</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ac9875b1bf39a10f655df25fa551e90d7">average_islands_scale_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00760"></a>00760 {
<a name="l00761"></a>00761     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00762"></a>00762     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l00763"></a>00763     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a4d9806c4d2c9d7777ae1619839d6baed" title="Return the BMEditMesh for a given object.">BMEdit_FromObject</a>(obedit);
<a name="l00764"></a>00764     <a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#ac78969cb448fed335a47b69eac4f3a7d">ParamHandle</a> *handle;
<a name="l00765"></a>00765     <span class="keywordtype">short</span> implicit = 1;
<a name="l00766"></a>00766 
<a name="l00767"></a>00767     <span class="keywordflow">if</span> (!<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a0b81eb2dd6abd09ec43b600388f37d69">uvedit_have_selection</a>(scene, em, implicit)) {
<a name="l00768"></a>00768         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00769"></a>00769     }
<a name="l00770"></a>00770 
<a name="l00771"></a>00771     handle = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ad947fa49a395babf2804f4fea900dca4">construct_param_handle</a>(scene, em, implicit, 0, 1, 1);
<a name="l00772"></a>00772     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a09d2c9246b3205b9e906f8ad301b9efc">param_average</a>(handle);
<a name="l00773"></a>00773     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a3b1e9a9a5716bd641322bf0643fdcd4e">param_flush</a>(handle);
<a name="l00774"></a>00774     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a1eafb7091fead43a10e072402271d81b">param_delete</a>(handle);
<a name="l00775"></a>00775     
<a name="l00776"></a>00776     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l00777"></a>00777     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l00778"></a>00778 
<a name="l00779"></a>00779     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00780"></a>00780 }
<a name="l00781"></a>00781 
<a name="l00782"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#abf3f90787845e307ffdfefbfdeed908c">00782</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d48/uvedit__intern_8h.html#ad207c9cc30e11eed7b49ced456fa2f83">UV_OT_average_islands_scale</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00783"></a>00783 {
<a name="l00784"></a>00784     <span class="comment">/* identifiers */</span>
<a name="l00785"></a>00785     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Average Islands Scale&quot;</span>;
<a name="l00786"></a>00786     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;UV_OT_average_islands_scale&quot;</span>;
<a name="l00787"></a>00787     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00788"></a>00788     
<a name="l00789"></a>00789     <span class="comment">/* api callbacks */</span>
<a name="l00790"></a>00790     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ac9875b1bf39a10f655df25fa551e90d7">average_islands_scale_exec</a>;
<a name="l00791"></a>00791     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a93d6c73a0c87af45aaa6d41e2b3cba34">ED_operator_uvedit</a>;
<a name="l00792"></a>00792 }
<a name="l00793"></a>00793 
<a name="l00794"></a>00794 <span class="comment">/**************** Live Unwrap *****************/</span>
<a name="l00795"></a>00795 
<a name="l00796"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a8094e707d1287576ee5a0ed24a469270">00796</a> <span class="keyword">static</span> <a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#ac78969cb448fed335a47b69eac4f3a7d">ParamHandle</a> *<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a8094e707d1287576ee5a0ed24a469270">liveHandle</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00797"></a>00797 
<a name="l00798"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#af403c6a7775ae2d97824590aa0819b61">00798</a> <span class="keywordtype">void</span> <a class="code" href="../../dd/d25/ED__uvedit_8h.html#a0b866d14002dbcd80d5a0e8f2ee9e218">ED_uvedit_live_unwrap_begin</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit)
<a name="l00799"></a>00799 {
<a name="l00800"></a>00800     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a4d9806c4d2c9d7777ae1619839d6baed" title="Return the BMEditMesh for a given object.">BMEdit_FromObject</a>(obedit);
<a name="l00801"></a>00801     <span class="keywordtype">short</span> abf = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a91e80769ccac6cd72e63a8d5e04d7539">unwrapper</a> == 0;
<a name="l00802"></a>00802     <span class="keywordtype">short</span> fillholes = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#aa5955c1b159f3e38c416e326b492eade">uvcalc_flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ae22831456ed7c2054a228b320f9d886a">UVCALC_FILLHOLES</a>;
<a name="l00803"></a>00803     <span class="keywordtype">short</span> use_subsurf = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#aa5955c1b159f3e38c416e326b492eade">uvcalc_flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a44161569d946944ab9d4540baee420ba">UVCALC_USESUBSURF</a>;
<a name="l00804"></a>00804 
<a name="l00805"></a>00805     <span class="keywordflow">if</span> (!<a class="code" href="../../dd/d25/ED__uvedit_8h.html#aac26d389d8e65b5cbcb9fe57ba504aaf">ED_uvedit_test</a>(obedit)) {
<a name="l00806"></a>00806         <span class="keywordflow">return</span>;
<a name="l00807"></a>00807     }
<a name="l00808"></a>00808 
<a name="l00809"></a>00809     <span class="keywordflow">if</span> (use_subsurf)
<a name="l00810"></a>00810         liveHandle = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#aa1612cbbfba2ac50d21a4b3578d52590">construct_param_handle_subsurfed</a>(scene, em, fillholes, 0, 1);
<a name="l00811"></a>00811     <span class="keywordflow">else</span>
<a name="l00812"></a>00812         liveHandle = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ad947fa49a395babf2804f4fea900dca4">construct_param_handle</a>(scene, em, 0, fillholes, 0, 1);
<a name="l00813"></a>00813 
<a name="l00814"></a>00814     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a8fd6024670dc23ac4ffe0f824d56723b">param_lscm_begin</a>(liveHandle, <a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#ab645b9a87161a6e3b9db6e755c977239a14de8113b7f033da475a54d851edbac7">PARAM_TRUE</a>, abf);
<a name="l00815"></a>00815 }
<a name="l00816"></a>00816 
<a name="l00817"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a7f128b7ca2421f00e72154628513ebf5">00817</a> <span class="keywordtype">void</span> <a class="code" href="../../dd/d25/ED__uvedit_8h.html#a7f128b7ca2421f00e72154628513ebf5">ED_uvedit_live_unwrap_re_solve</a>(<span class="keywordtype">void</span>)
<a name="l00818"></a>00818 {
<a name="l00819"></a>00819     <span class="keywordflow">if</span> (liveHandle) {
<a name="l00820"></a>00820         <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#ac627bd7a7c16ebff829f1a9ec70b3624">param_lscm_solve</a>(liveHandle);
<a name="l00821"></a>00821         <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a3b1e9a9a5716bd641322bf0643fdcd4e">param_flush</a>(liveHandle);
<a name="l00822"></a>00822     }
<a name="l00823"></a>00823 }
<a name="l00824"></a>00824     
<a name="l00825"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#af076eb0329ad781e4b03ebec3da84811">00825</a> <span class="keywordtype">void</span> <a class="code" href="../../dd/d25/ED__uvedit_8h.html#af076eb0329ad781e4b03ebec3da84811">ED_uvedit_live_unwrap_end</a>(<span class="keywordtype">short</span> cancel)
<a name="l00826"></a>00826 {
<a name="l00827"></a>00827     <span class="keywordflow">if</span> (liveHandle) {
<a name="l00828"></a>00828         <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#ad760de306da61aee95bb24c6047d5749">param_lscm_end</a>(liveHandle);
<a name="l00829"></a>00829         <span class="keywordflow">if</span> (cancel)
<a name="l00830"></a>00830             <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a3297e77150dc2dd7ac4902de6dcc3e6c">param_flush_restore</a>(liveHandle);
<a name="l00831"></a>00831         <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a1eafb7091fead43a10e072402271d81b">param_delete</a>(liveHandle);
<a name="l00832"></a>00832         liveHandle = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00833"></a>00833     }
<a name="l00834"></a>00834 }
<a name="l00835"></a>00835 
<a name="l00836"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a74d0cbb0fd4f6c4bdd2ecad7dfdc6886">00836</a> <span class="keywordtype">void</span> <a class="code" href="../../dd/d25/ED__uvedit_8h.html#a1e7ede371a9da505ba14c4570e7950d4">ED_uvedit_live_unwrap</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit)
<a name="l00837"></a>00837 {
<a name="l00838"></a>00838     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a4d9806c4d2c9d7777ae1619839d6baed" title="Return the BMEditMesh for a given object.">BMEdit_FromObject</a>(obedit);
<a name="l00839"></a>00839 
<a name="l00840"></a>00840     <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#ac8fa8ab222b8c457310f36916cd91a7b">edge_mode_live_unwrap</a> &amp;&amp;
<a name="l00841"></a>00841         <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#a6474531880fa81739ccdb10fdffd1866">CustomData_has_layer</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>)) {
<a name="l00842"></a>00842         <a class="code" href="../../dd/d25/ED__uvedit_8h.html#a78ff4821545f590ce840d70bda6fe50e">ED_unwrap_lscm</a>(scene, obedit, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>); <span class="comment">/* unwrap all not just sel */</span>
<a name="l00843"></a>00843     }
<a name="l00844"></a>00844 }
<a name="l00845"></a>00845 
<a name="l00846"></a>00846 <span class="comment">/*************** UV Map Common Transforms *****************/</span>
<a name="l00847"></a>00847 
<a name="l00848"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ae8193ea426f4eceac742c4f879b0802a">00848</a> <span class="preprocessor">#define VIEW_ON_EQUATOR 0</span>
<a name="l00849"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a93296356e1897da3e5af950673ec8386">00849</a> <span class="preprocessor"></span><span class="preprocessor">#define VIEW_ON_POLES   1</span>
<a name="l00850"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ae12bb0cc392b2fc7c6bc2d9e296645f8">00850</a> <span class="preprocessor"></span><span class="preprocessor">#define ALIGN_TO_OBJECT 2</span>
<a name="l00851"></a>00851 <span class="preprocessor"></span>
<a name="l00852"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a3b8aa860fec7ab12b54c371247bf0ca0">00852</a> <span class="preprocessor">#define POLAR_ZX    0</span>
<a name="l00853"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ae1eb01f964952fc2442e0c906480d39d">00853</a> <span class="preprocessor"></span><span class="preprocessor">#define POLAR_ZY    1</span>
<a name="l00854"></a>00854 <span class="preprocessor"></span>
<a name="l00855"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ada47649619809860e36dcbaf3a1217c7">00855</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ada47649619809860e36dcbaf3a1217c7">uv_map_transform_center</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <span class="keywordtype">float</span> *result, 
<a name="l00856"></a>00856                                     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em)
<a name="l00857"></a>00857 {
<a name="l00858"></a>00858     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa;
<a name="l00859"></a>00859     <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l00860"></a>00860     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter, liter;
<a name="l00861"></a>00861     <span class="keywordtype">float</span> <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>[3], <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>[3], *cursx;
<a name="l00862"></a>00862     <span class="keywordtype">int</span> around = (v3d) ? v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a78a9cea7025be4f40ba5e11de798e4b3">around</a> : <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a6bc40b935a543823a0b0e8d0038e8d28">V3D_CENTER</a>;
<a name="l00863"></a>00863 
<a name="l00864"></a>00864     <span class="comment">/* only operates on the edit object - this is all that&#39;s needed now */</span>
<a name="l00865"></a>00865 
<a name="l00866"></a>00866     switch (around) {
<a name="l00867"></a>00867         <span class="keywordflow">case</span> <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a6bc40b935a543823a0b0e8d0038e8d28">V3D_CENTER</a>: <span class="comment">/* bounding box center */</span>
<a name="l00868"></a>00868             min[0] = min[1] = min[2] = 1e20f;
<a name="l00869"></a>00869             max[0] = max[1] = max[2] = -1e20f;
<a name="l00870"></a>00870             
<a name="l00871"></a>00871             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l00872"></a>00872                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>)) {
<a name="l00873"></a>00873                     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l00874"></a>00874                         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a56471388e0045022014f3a365af6b34a">DO_MINMAX</a>(l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>, min, max);
<a name="l00875"></a>00875                     }
<a name="l00876"></a>00876                 }
<a name="l00877"></a>00877             }
<a name="l00878"></a>00878             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ac3186a97188a3cf15bc5e2f8b0e97ad2">mid_v3_v3v3</a>(result, min, max);
<a name="l00879"></a>00879             <span class="keywordflow">break</span>;
<a name="l00880"></a>00880 
<a name="l00881"></a>00881         <span class="keywordflow">case</span> <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a64ce5a6dd902200478226507e7c0bd88">V3D_CURSOR</a>: <span class="comment">/*cursor center*/</span> 
<a name="l00882"></a>00882             cursx = <a class="code" href="../../d8/d6a/ED__view3d_8h.html#a56c6dfa9088d0f90552a67074a359c97">give_cursor</a>(scene, v3d);
<a name="l00883"></a>00883             <span class="comment">/* shift to objects world */</span>
<a name="l00884"></a>00884             result[0] = cursx[0] - ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3][0];
<a name="l00885"></a>00885             result[1] = cursx[1] - ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3][1];
<a name="l00886"></a>00886             result[2] = cursx[2] - ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3][2];
<a name="l00887"></a>00887             <span class="keywordflow">break</span>;
<a name="l00888"></a>00888 
<a name="l00889"></a>00889         <span class="keywordflow">case</span> <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a5e37cb5cb6e4bc87eaffb8a738f79c91">V3D_LOCAL</a>: <span class="comment">/*object center*/</span>
<a name="l00890"></a>00890         <span class="keywordflow">case</span> <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#afd8c47e8e264b1f878a625b2d9d72858">V3D_CENTROID</a>: <span class="comment">/* multiple objects centers, only one object here*/</span>
<a name="l00891"></a>00891         <span class="keywordflow">default</span>:
<a name="l00892"></a>00892             result[0] = result[1] = result[2] = 0.0;
<a name="l00893"></a>00893             <span class="keywordflow">break</span>;
<a name="l00894"></a>00894     }
<a name="l00895"></a>00895 }
<a name="l00896"></a>00896 
<a name="l00897"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a8a771d58af2a01789acec643778ce4f9">00897</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a8a771d58af2a01789acec643778ce4f9">uv_map_rotation_matrix</a>(<span class="keywordtype">float</span> result[][4], <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob,
<a name="l00898"></a>00898                                    <span class="keywordtype">float</span> upangledeg, <span class="keywordtype">float</span> sideangledeg, <span class="keywordtype">float</span> radius)
<a name="l00899"></a>00899 {
<a name="l00900"></a>00900     <span class="keywordtype">float</span> rotup[4][4], rotside[4][4], viewmatrix[4][4], rotobj[4][4];
<a name="l00901"></a>00901     <span class="keywordtype">float</span> sideangle = 0.0f, upangle = 0.0f;
<a name="l00902"></a>00902     <span class="keywordtype">int</span> k;
<a name="l00903"></a>00903 
<a name="l00904"></a>00904     <span class="comment">/* get rotation of the current view matrix */</span>
<a name="l00905"></a>00905     <span class="keywordflow">if</span> (rv3d)
<a name="l00906"></a>00906         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(viewmatrix, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#ad04178a1375cc4ef5c59a76b723f822f">viewmat</a>);
<a name="l00907"></a>00907     <span class="keywordflow">else</span>
<a name="l00908"></a>00908         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(viewmatrix);
<a name="l00909"></a>00909 
<a name="l00910"></a>00910     <span class="comment">/* but shifting */</span>
<a name="l00911"></a>00911     <span class="keywordflow">for</span> (k = 0; k &lt; 4; k++)
<a name="l00912"></a>00912         viewmatrix[3][k] = 0.0f;
<a name="l00913"></a>00913 
<a name="l00914"></a>00914     <span class="comment">/* get rotation of the current object matrix */</span>
<a name="l00915"></a>00915     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(rotobj, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l00916"></a>00916 
<a name="l00917"></a>00917     <span class="comment">/* but shifting */</span>
<a name="l00918"></a>00918     <span class="keywordflow">for</span> (k = 0; k &lt; 4; k++)
<a name="l00919"></a>00919         rotobj[3][k] = 0.0f;
<a name="l00920"></a>00920 
<a name="l00921"></a>00921     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a0aab9e03d9308b6e8bb1b7a0d5099589">zero_m4</a>(rotup);
<a name="l00922"></a>00922     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a0aab9e03d9308b6e8bb1b7a0d5099589">zero_m4</a>(rotside);
<a name="l00923"></a>00923 
<a name="l00924"></a>00924     <span class="comment">/* compensate front/side.. against opengl x,y,z world definition */</span>
<a name="l00925"></a>00925     <span class="comment">/* this is &quot;kanonen gegen spatzen&quot;, a few plus minus 1 will do here */</span>
<a name="l00926"></a>00926     <span class="comment">/* i wanted to keep the reason here, so we&#39;re rotating*/</span>
<a name="l00927"></a>00927     sideangle = (float)<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> * (sideangledeg + 180.0f) / 180.0f;
<a name="l00928"></a>00928     rotside[0][0] = (float)<a class="code" href="../../d7/d47/NM__Scalar_8h.html#a684cb050006be28e36ea9a9817af4a91">cos</a>(sideangle);
<a name="l00929"></a>00929     rotside[0][1] = -(float)<a class="code" href="../../d7/d47/NM__Scalar_8h.html#a4f15dff8a58e8abe0c0cf2c249ffa842">sin</a>(sideangle);
<a name="l00930"></a>00930     rotside[1][0] = (float)<a class="code" href="../../d7/d47/NM__Scalar_8h.html#a4f15dff8a58e8abe0c0cf2c249ffa842">sin</a>(sideangle);
<a name="l00931"></a>00931     rotside[1][1] = (float)<a class="code" href="../../d7/d47/NM__Scalar_8h.html#a684cb050006be28e36ea9a9817af4a91">cos</a>(sideangle);
<a name="l00932"></a>00932     rotside[2][2] = 1.0f;
<a name="l00933"></a>00933 
<a name="l00934"></a>00934     upangle = (float)<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> * upangledeg / 180.0f;
<a name="l00935"></a>00935     rotup[1][1] = (float)<a class="code" href="../../d7/d47/NM__Scalar_8h.html#a684cb050006be28e36ea9a9817af4a91">cos</a>(upangle) / radius;
<a name="l00936"></a>00936     rotup[1][2] = -(float)<a class="code" href="../../d7/d47/NM__Scalar_8h.html#a4f15dff8a58e8abe0c0cf2c249ffa842">sin</a>(upangle) / radius;
<a name="l00937"></a>00937     rotup[2][1] = (float)<a class="code" href="../../d7/d47/NM__Scalar_8h.html#a4f15dff8a58e8abe0c0cf2c249ffa842">sin</a>(upangle) / radius;
<a name="l00938"></a>00938     rotup[2][2] = (float)<a class="code" href="../../d7/d47/NM__Scalar_8h.html#a684cb050006be28e36ea9a9817af4a91">cos</a>(upangle) / radius;
<a name="l00939"></a>00939     rotup[0][0] = (float)1.0f / radius;
<a name="l00940"></a>00940 
<a name="l00941"></a>00941     <span class="comment">/* calculate transforms*/</span>
<a name="l00942"></a>00942     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a9d41e7b216b06f815fb05ed4cb8474e6">mul_serie_m4</a>(result, rotup, rotside, viewmatrix, rotobj, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00943"></a>00943 }
<a name="l00944"></a>00944 
<a name="l00945"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ad70cbf704846ee00c40701a3d7c87e8c">00945</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ad70cbf704846ee00c40701a3d7c87e8c">uv_map_transform</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <span class="keywordtype">float</span> center[3], <span class="keywordtype">float</span> rotmat[4][4])
<a name="l00946"></a>00946 {
<a name="l00947"></a>00947     <span class="comment">/* context checks are messy here, making it work in both 3d view and uv editor */</span>
<a name="l00948"></a>00948     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00949"></a>00949     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l00950"></a>00950     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a4d9806c4d2c9d7777ae1619839d6baed" title="Return the BMEditMesh for a given object.">BMEdit_FromObject</a>(obedit);
<a name="l00951"></a>00951     <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d = <a class="code" href="../../df/d01/BKE__context_8h.html#a88ab4a564441708766a6b4ace3b17908">CTX_wm_view3d</a>(C);
<a name="l00952"></a>00952     <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d = <a class="code" href="../../df/d01/BKE__context_8h.html#af03543cb8e3fa2c39bb777962a6eae13">CTX_wm_region_view3d</a>(C);
<a name="l00953"></a>00953     <span class="comment">/* common operator properties */</span>
<a name="l00954"></a>00954     <span class="keywordtype">int</span> align = <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;align&quot;</span>);
<a name="l00955"></a>00955     <span class="keywordtype">int</span> direction = <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;direction&quot;</span>);
<a name="l00956"></a>00956     <span class="keywordtype">float</span> radius = <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;radius&quot;</span>) ? <a class="code" href="../../d3/d10/rna__access_8c.html#a99bfb3295a4df6fef29f16924fd24c79">RNA_float_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;radius&quot;</span>) : 1.0f;
<a name="l00957"></a>00957     <span class="keywordtype">float</span> upangledeg, sideangledeg;
<a name="l00958"></a>00958 
<a name="l00959"></a>00959     <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ada47649619809860e36dcbaf3a1217c7">uv_map_transform_center</a>(scene, v3d, center, obedit, em);
<a name="l00960"></a>00960 
<a name="l00961"></a>00961     <span class="keywordflow">if</span> (direction == <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ae8193ea426f4eceac742c4f879b0802a">VIEW_ON_EQUATOR</a>) {
<a name="l00962"></a>00962         upangledeg = 90.0f;
<a name="l00963"></a>00963         sideangledeg = 0.0f;
<a name="l00964"></a>00964     }
<a name="l00965"></a>00965     <span class="keywordflow">else</span> {
<a name="l00966"></a>00966         upangledeg = 0.0f;
<a name="l00967"></a>00967         <span class="keywordflow">if</span> (align == <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ae1eb01f964952fc2442e0c906480d39d">POLAR_ZY</a>) sideangledeg = 0.0f;
<a name="l00968"></a>00968         <span class="keywordflow">else</span> sideangledeg = 90.0f;
<a name="l00969"></a>00969     }
<a name="l00970"></a>00970 
<a name="l00971"></a>00971     <span class="comment">/* be compatible to the &quot;old&quot; sphere/cylinder mode */</span>
<a name="l00972"></a>00972     <span class="keywordflow">if</span> (direction == <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ae12bb0cc392b2fc7c6bc2d9e296645f8">ALIGN_TO_OBJECT</a>)
<a name="l00973"></a>00973         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(rotmat);
<a name="l00974"></a>00974     <span class="keywordflow">else</span> 
<a name="l00975"></a>00975         <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a8a771d58af2a01789acec643778ce4f9">uv_map_rotation_matrix</a>(rotmat, rv3d, obedit, upangledeg, sideangledeg, radius);
<a name="l00976"></a>00976 
<a name="l00977"></a>00977 }
<a name="l00978"></a>00978 
<a name="l00979"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a4523e492d5804ca09bfd45c31a821c5d">00979</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a4523e492d5804ca09bfd45c31a821c5d">uv_transform_properties</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot, <span class="keywordtype">int</span> radius)
<a name="l00980"></a>00980 {
<a name="l00981"></a>00981     <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> <a class="code" href="../../d0/d85/editmesh__tools_8c.html#acc0ca7eba6ad393abd6ef1d4592a738c">direction_items</a>[] = {
<a name="l00982"></a>00982         {<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ae8193ea426f4eceac742c4f879b0802a">VIEW_ON_EQUATOR</a>, <span class="stringliteral">&quot;VIEW_ON_EQUATOR&quot;</span>, 0, <span class="stringliteral">&quot;View on Equator&quot;</span>, <span class="stringliteral">&quot;3D view is on the equator&quot;</span>},
<a name="l00983"></a>00983         {<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a93296356e1897da3e5af950673ec8386">VIEW_ON_POLES</a>, <span class="stringliteral">&quot;VIEW_ON_POLES&quot;</span>, 0, <span class="stringliteral">&quot;View on Poles&quot;</span>, <span class="stringliteral">&quot;3D view is on the poles&quot;</span>},
<a name="l00984"></a>00984         {<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ae12bb0cc392b2fc7c6bc2d9e296645f8">ALIGN_TO_OBJECT</a>, <span class="stringliteral">&quot;ALIGN_TO_OBJECT&quot;</span>, 0, <span class="stringliteral">&quot;Align to Object&quot;</span>, <span class="stringliteral">&quot;Align according to object transform&quot;</span>},
<a name="l00985"></a>00985         {0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL}
<a name="l00986"></a>00986     };
<a name="l00987"></a>00987     <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> align_items[] = {
<a name="l00988"></a>00988         {<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a3b8aa860fec7ab12b54c371247bf0ca0">POLAR_ZX</a>, <span class="stringliteral">&quot;POLAR_ZX&quot;</span>, 0, <span class="stringliteral">&quot;Polar ZX&quot;</span>, <span class="stringliteral">&quot;Polar 0 is X&quot;</span>},
<a name="l00989"></a>00989         {<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ae1eb01f964952fc2442e0c906480d39d">POLAR_ZY</a>, <span class="stringliteral">&quot;POLAR_ZY&quot;</span>, 0, <span class="stringliteral">&quot;Polar ZY&quot;</span>, <span class="stringliteral">&quot;Polar 0 is Y&quot;</span>},
<a name="l00990"></a>00990         {0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL}
<a name="l00991"></a>00991     };
<a name="l00992"></a>00992 
<a name="l00993"></a>00993     <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;direction&quot;</span>, direction_items, <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ae8193ea426f4eceac742c4f879b0802a">VIEW_ON_EQUATOR</a>, <span class="stringliteral">&quot;Direction&quot;</span>,
<a name="l00994"></a>00994                  <span class="stringliteral">&quot;Direction of the sphere or cylinder&quot;</span>);
<a name="l00995"></a>00995     <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;align&quot;</span>, align_items, <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ae8193ea426f4eceac742c4f879b0802a">VIEW_ON_EQUATOR</a>, <span class="stringliteral">&quot;Align&quot;</span>,
<a name="l00996"></a>00996                  <span class="stringliteral">&quot;How to determine rotation around the pole&quot;</span>);
<a name="l00997"></a>00997     <span class="keywordflow">if</span> (radius)
<a name="l00998"></a>00998         <a class="code" href="../../dc/d7e/rna__define_8c.html#a040f4b08fc87a45a90e2291382e27f75">RNA_def_float</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;radius&quot;</span>, 1.0f, 0.0f, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <span class="stringliteral">&quot;Radius&quot;</span>,
<a name="l00999"></a>00999                       <span class="stringliteral">&quot;Radius of the sphere or cylinder&quot;</span>, 0.0001f, 100.0f);
<a name="l01000"></a>01000 }
<a name="l01001"></a>01001 
<a name="l01002"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a2e7bcdb3690571619f174bdf16211148">01002</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a2e7bcdb3690571619f174bdf16211148">correct_uv_aspect</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em)
<a name="l01003"></a>01003 {
<a name="l01004"></a>01004     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa = <a class="code" href="../../d5/def/bmesh__marking_8c.html#a6e02febedf269e86d8f9cb8efedd9500">BM_active_face_get</a>(em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01005"></a>01005     <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l01006"></a>01006     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter, liter;
<a name="l01007"></a>01007     <a class="code" href="../../d6/d90/structMLoopUV.html">MLoopUV</a> *luv;
<a name="l01008"></a>01008     <span class="keywordtype">float</span> scale, aspx = 1.0f, aspy = 1.0f;
<a name="l01009"></a>01009     
<a name="l01010"></a>01010     <span class="keywordflow">if</span> (efa) {
<a name="l01011"></a>01011         <a class="code" href="../../de/d88/structMTexPoly.html">MTexPoly</a> *tf;
<a name="l01012"></a>01012 
<a name="l01013"></a>01013         tf = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abda690b32c834c8ee41e225cfd2d9e49">pdata</a>, efa-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a80c8c910b6b28425ea8544e07741092c">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a05731a08cef6d81e74c221963ae25712">CD_MTEXPOLY</a>);
<a name="l01014"></a>01014         <a class="code" href="../../de/d53/ED__image_8h.html#a49b8b52958866f98ae23a75c01d9243a">ED_image_uv_aspect</a>(tf-&gt;<a class="code" href="../../de/d88/structMTexPoly.html#acd90db38c741566c1f6adcdf59799b46">tpage</a>, &amp;aspx, &amp;aspy);
<a name="l01015"></a>01015     }
<a name="l01016"></a>01016     
<a name="l01017"></a>01017     <span class="keywordflow">if</span> (aspx == aspy)
<a name="l01018"></a>01018         <span class="keywordflow">return</span>;
<a name="l01019"></a>01019         
<a name="l01020"></a>01020     <span class="keywordflow">if</span> (aspx &gt; aspy) {
<a name="l01021"></a>01021         scale = aspy / aspx;
<a name="l01022"></a>01022 
<a name="l01023"></a>01023         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l01024"></a>01024             <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>) || <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>))
<a name="l01025"></a>01025                 <span class="keywordflow">continue</span>;
<a name="l01026"></a>01026             
<a name="l01027"></a>01027             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l01028"></a>01028                 luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l01029"></a>01029                 luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>[0] = ((luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>[0] - 0.5) * scale) + 0.5;
<a name="l01030"></a>01030             }
<a name="l01031"></a>01031         }
<a name="l01032"></a>01032     }
<a name="l01033"></a>01033     <span class="keywordflow">else</span> {
<a name="l01034"></a>01034         scale = aspx / aspy;
<a name="l01035"></a>01035 
<a name="l01036"></a>01036         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l01037"></a>01037             <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>) || <a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a0f4942a13726e12780bb5a0c07219953">BM_ELEM_HIDDEN</a>))
<a name="l01038"></a>01038                 <span class="keywordflow">continue</span>;
<a name="l01039"></a>01039             
<a name="l01040"></a>01040             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l01041"></a>01041                 luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l01042"></a>01042                 luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>[1] = ((luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>[1] - 0.5) * scale) + 0.5;
<a name="l01043"></a>01043             }
<a name="l01044"></a>01044         }
<a name="l01045"></a>01045     }
<a name="l01046"></a>01046 }
<a name="l01047"></a>01047 
<a name="l01048"></a>01048 <span class="comment">/******************** Map Clip &amp; Correct ******************/</span>
<a name="l01049"></a>01049 
<a name="l01050"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a8270021eae0ebf754bb6fb4332ce25a2">01050</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a8270021eae0ebf754bb6fb4332ce25a2">uv_map_clip_correct_properties</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01051"></a>01051 {
<a name="l01052"></a>01052     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;correct_aspect&quot;</span>, 1, <span class="stringliteral">&quot;Correct Aspect&quot;</span>,
<a name="l01053"></a>01053                     <span class="stringliteral">&quot;Map UVs taking image aspect ratio into account&quot;</span>);
<a name="l01054"></a>01054     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;clip_to_bounds&quot;</span>, 0, <span class="stringliteral">&quot;Clip to Bounds&quot;</span>,
<a name="l01055"></a>01055                     <span class="stringliteral">&quot;Clip UV coordinates to bounds after unwrapping&quot;</span>);
<a name="l01056"></a>01056     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;scale_to_bounds&quot;</span>, 0, <span class="stringliteral">&quot;Scale to Bounds&quot;</span>,
<a name="l01057"></a>01057                     <span class="stringliteral">&quot;Scale UV coordinates to bounds after unwrapping&quot;</span>);
<a name="l01058"></a>01058 }
<a name="l01059"></a>01059 
<a name="l01060"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a00f8f3188e02352d1df01fea35c9bbe1">01060</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a00f8f3188e02352d1df01fea35c9bbe1">uv_map_clip_correct</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01061"></a>01061 {
<a name="l01062"></a>01062     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa;
<a name="l01063"></a>01063     <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l01064"></a>01064     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter, liter;
<a name="l01065"></a>01065     <a class="code" href="../../d6/d90/structMLoopUV.html">MLoopUV</a> *luv;
<a name="l01066"></a>01066     <span class="keywordtype">float</span> dx, dy, <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>[2], <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>[2];
<a name="l01067"></a>01067     <span class="keywordtype">int</span> correct_aspect = <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;correct_aspect&quot;</span>);
<a name="l01068"></a>01068     <span class="keywordtype">int</span> clip_to_bounds = <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;clip_to_bounds&quot;</span>);
<a name="l01069"></a>01069     <span class="keywordtype">int</span> scale_to_bounds = <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;scale_to_bounds&quot;</span>);
<a name="l01070"></a>01070 
<a name="l01071"></a>01071     <span class="comment">/* correct for image aspect ratio */</span>
<a name="l01072"></a>01072     <span class="keywordflow">if</span> (correct_aspect)
<a name="l01073"></a>01073         <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a2e7bcdb3690571619f174bdf16211148">correct_uv_aspect</a>(em);
<a name="l01074"></a>01074 
<a name="l01075"></a>01075     <span class="keywordflow">if</span> (scale_to_bounds) {
<a name="l01076"></a>01076         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a1a74cc7bfb4a5b9eda1fb38c3fbb51c1">INIT_MINMAX2</a>(min, max);
<a name="l01077"></a>01077         
<a name="l01078"></a>01078         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l01079"></a>01079             <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>))
<a name="l01080"></a>01080                 <span class="keywordflow">continue</span>;
<a name="l01081"></a>01081 
<a name="l01082"></a>01082             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l01083"></a>01083                 luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l01084"></a>01084                 <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a1b61fa5351fa5319daed9bf7cab6f331">DO_MINMAX2</a>(luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>, min, max);
<a name="l01085"></a>01085             }
<a name="l01086"></a>01086         }
<a name="l01087"></a>01087         
<a name="l01088"></a>01088         <span class="comment">/* rescale UV to be in 1/1 */</span>
<a name="l01089"></a>01089         dx = (max[0] - min[0]);
<a name="l01090"></a>01090         dy = (max[1] - min[1]);
<a name="l01091"></a>01091 
<a name="l01092"></a>01092         <span class="keywordflow">if</span> (dx &gt; 0.0f)
<a name="l01093"></a>01093             dx = 1.0f / dx;
<a name="l01094"></a>01094         <span class="keywordflow">if</span> (dy &gt; 0.0f)
<a name="l01095"></a>01095             dy = 1.0f / dy;
<a name="l01096"></a>01096 
<a name="l01097"></a>01097         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l01098"></a>01098             <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>))
<a name="l01099"></a>01099                 <span class="keywordflow">continue</span>;
<a name="l01100"></a>01100 
<a name="l01101"></a>01101             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l01102"></a>01102                 luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l01103"></a>01103                 
<a name="l01104"></a>01104                 luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>[0] = (luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>[0] - min[0]) * dx;
<a name="l01105"></a>01105                 luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>[1] = (luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>[1] - min[1]) * dy;
<a name="l01106"></a>01106             }
<a name="l01107"></a>01107         }
<a name="l01108"></a>01108     }
<a name="l01109"></a>01109     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (clip_to_bounds) {
<a name="l01110"></a>01110         <span class="comment">/* clipping and wrapping */</span>
<a name="l01111"></a>01111         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l01112"></a>01112             <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>))
<a name="l01113"></a>01113                 <span class="keywordflow">continue</span>;
<a name="l01114"></a>01114 
<a name="l01115"></a>01115             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l01116"></a>01116                 luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l01117"></a>01117                 <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>[0], 0.0f, 1.0f);
<a name="l01118"></a>01118                 <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>[1], 0.0f, 1.0f);
<a name="l01119"></a>01119             }
<a name="l01120"></a>01120         }
<a name="l01121"></a>01121     }
<a name="l01122"></a>01122 }
<a name="l01123"></a>01123 
<a name="l01124"></a>01124 <span class="comment">/* ******************** Unwrap operator **************** */</span>
<a name="l01125"></a>01125 
<a name="l01126"></a>01126 <span class="comment">/* assumes UV Map is checked, doesn&#39;t run update funcs */</span>
<a name="l01127"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ad05cdb3e320f0c6aeb495c17a80b68b3">01127</a> <span class="keywordtype">void</span> <a class="code" href="../../dd/d25/ED__uvedit_8h.html#a78ff4821545f590ce840d70bda6fe50e">ED_unwrap_lscm</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit, <span class="keyword">const</span> <span class="keywordtype">short</span> sel)
<a name="l01128"></a>01128 {
<a name="l01129"></a>01129     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a4d9806c4d2c9d7777ae1619839d6baed" title="Return the BMEditMesh for a given object.">BMEdit_FromObject</a>(obedit);
<a name="l01130"></a>01130     <a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#ac78969cb448fed335a47b69eac4f3a7d">ParamHandle</a> *handle;
<a name="l01131"></a>01131 
<a name="l01132"></a>01132     <span class="keyword">const</span> <span class="keywordtype">short</span> fill_holes = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#aa5955c1b159f3e38c416e326b492eade">uvcalc_flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ae22831456ed7c2054a228b320f9d886a">UVCALC_FILLHOLES</a>;
<a name="l01133"></a>01133     <span class="keyword">const</span> <span class="keywordtype">short</span> correct_aspect = !(scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#aa5955c1b159f3e38c416e326b492eade">uvcalc_flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#aa7ca84a24d90bcda60a1783020f3c1ee">UVCALC_NO_ASPECT_CORRECT</a>);
<a name="l01134"></a>01134     <span class="keyword">const</span> <span class="keywordtype">short</span> use_subsurf = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#aa5955c1b159f3e38c416e326b492eade">uvcalc_flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a44161569d946944ab9d4540baee420ba">UVCALC_USESUBSURF</a>;
<a name="l01135"></a>01135 
<a name="l01136"></a>01136     <span class="keywordflow">if</span> (use_subsurf)
<a name="l01137"></a>01137         handle = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#aa1612cbbfba2ac50d21a4b3578d52590">construct_param_handle_subsurfed</a>(scene, em, fill_holes, sel, correct_aspect);
<a name="l01138"></a>01138     <span class="keywordflow">else</span>
<a name="l01139"></a>01139         handle = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ad947fa49a395babf2804f4fea900dca4">construct_param_handle</a>(scene, em, 0, fill_holes, sel, correct_aspect);
<a name="l01140"></a>01140 
<a name="l01141"></a>01141     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a8fd6024670dc23ac4ffe0f824d56723b">param_lscm_begin</a>(handle, <a class="code" href="../../d8/d4f/uvedit__parametrizer_8h.html#ab645b9a87161a6e3b9db6e755c977239aeab78a4b3b7b20f49151b8675ab6dc78">PARAM_FALSE</a>, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a91e80769ccac6cd72e63a8d5e04d7539">unwrapper</a> == 0);
<a name="l01142"></a>01142     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#ac627bd7a7c16ebff829f1a9ec70b3624">param_lscm_solve</a>(handle);
<a name="l01143"></a>01143     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#ad760de306da61aee95bb24c6047d5749">param_lscm_end</a>(handle);
<a name="l01144"></a>01144 
<a name="l01145"></a>01145     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a483e17314e8d665715b6c3cf55a5b1c7">param_pack</a>(handle, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#ad7d9701f9f74bb16c13a2b6181ed3cde">uvcalc_margin</a>);
<a name="l01146"></a>01146 
<a name="l01147"></a>01147     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a3b1e9a9a5716bd641322bf0643fdcd4e">param_flush</a>(handle);
<a name="l01148"></a>01148 
<a name="l01149"></a>01149     <a class="code" href="../../d5/dd9/uvedit__parametrizer_8c.html#a1eafb7091fead43a10e072402271d81b">param_delete</a>(handle);
<a name="l01150"></a>01150 }
<a name="l01151"></a>01151 
<a name="l01152"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a67a3a387832b20efc94f82b902abb75f">01152</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a67a3a387832b20efc94f82b902abb75f">unwrap_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01153"></a>01153 {
<a name="l01154"></a>01154     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l01155"></a>01155     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l01156"></a>01156     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a4d9806c4d2c9d7777ae1619839d6baed" title="Return the BMEditMesh for a given object.">BMEdit_FromObject</a>(obedit);
<a name="l01157"></a>01157     <span class="keywordtype">int</span> method = <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;method&quot;</span>);
<a name="l01158"></a>01158     <span class="keywordtype">int</span> fill_holes = <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;fill_holes&quot;</span>);
<a name="l01159"></a>01159     <span class="keywordtype">int</span> correct_aspect = <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;correct_aspect&quot;</span>);
<a name="l01160"></a>01160     <span class="keywordtype">int</span> use_subsurf = <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;use_subsurf_data&quot;</span>);
<a name="l01161"></a>01161     <span class="keywordtype">int</span> subsurf_level = <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;uv_subsurf_level&quot;</span>);
<a name="l01162"></a>01162     <span class="keywordtype">float</span> obsize[3], unitsize[3] = {1.0f, 1.0f, 1.0f};
<a name="l01163"></a>01163     <span class="keywordtype">short</span> implicit = 0;
<a name="l01164"></a>01164 
<a name="l01165"></a>01165     <span class="keywordflow">if</span> (!<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a0b81eb2dd6abd09ec43b600388f37d69">uvedit_have_selection</a>(scene, em, implicit)) {
<a name="l01166"></a>01166         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01167"></a>01167     }
<a name="l01168"></a>01168     
<a name="l01169"></a>01169     <span class="comment">/* add uvs if they don&#39;t exist yet */</span>
<a name="l01170"></a>01170     <span class="keywordflow">if</span> (!<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a7efca9520bb62d682f07d20f0d8a1fbf">ED_uvedit_ensure_uvs</a>(C, scene, obedit)) {
<a name="l01171"></a>01171         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01172"></a>01172     }
<a name="l01173"></a>01173 
<a name="l01174"></a>01174     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a245c1bf7630bef5c065994ea56751d21">mat4_to_size</a>(obsize, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l01175"></a>01175     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a38c22cf1e33ef0dd26cb0317cf341c73">compare_v3v3</a>(obsize, unitsize, 1e-4f))
<a name="l01176"></a>01176         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a1c418509aad2eb64fd806b8a99d29f7d">RPT_INFO</a>, <span class="stringliteral">&quot;Object scale is not 1.0. Unwrap will operate on a non-scaled version of the mesh.&quot;</span>);
<a name="l01177"></a>01177 
<a name="l01178"></a>01178     <span class="comment">/* remember last method for live unwrap */</span>
<a name="l01179"></a>01179     scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a91e80769ccac6cd72e63a8d5e04d7539">unwrapper</a> = method;
<a name="l01180"></a>01180     
<a name="l01181"></a>01181     scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#aa0392513d48a193ed720f309e2824ec0">uv_subsurf_level</a> = subsurf_level;
<a name="l01182"></a>01182 
<a name="l01183"></a>01183     <span class="keywordflow">if</span> (fill_holes) scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#aa5955c1b159f3e38c416e326b492eade">uvcalc_flag</a> |=  <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ae22831456ed7c2054a228b320f9d886a">UVCALC_FILLHOLES</a>;
<a name="l01184"></a>01184     <span class="keywordflow">else</span> scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#aa5955c1b159f3e38c416e326b492eade">uvcalc_flag</a> &amp;= ~<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ae22831456ed7c2054a228b320f9d886a">UVCALC_FILLHOLES</a>;
<a name="l01185"></a>01185 
<a name="l01186"></a>01186     <span class="keywordflow">if</span> (correct_aspect) scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#aa5955c1b159f3e38c416e326b492eade">uvcalc_flag</a> &amp;= ~<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#aa7ca84a24d90bcda60a1783020f3c1ee">UVCALC_NO_ASPECT_CORRECT</a>;
<a name="l01187"></a>01187     <span class="keywordflow">else</span> scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#aa5955c1b159f3e38c416e326b492eade">uvcalc_flag</a> |=  <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#aa7ca84a24d90bcda60a1783020f3c1ee">UVCALC_NO_ASPECT_CORRECT</a>;
<a name="l01188"></a>01188 
<a name="l01189"></a>01189     <span class="keywordflow">if</span> (use_subsurf) scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#aa5955c1b159f3e38c416e326b492eade">uvcalc_flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a44161569d946944ab9d4540baee420ba">UVCALC_USESUBSURF</a>;
<a name="l01190"></a>01190     <span class="keywordflow">else</span> scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#aa5955c1b159f3e38c416e326b492eade">uvcalc_flag</a> &amp;= ~<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a44161569d946944ab9d4540baee420ba">UVCALC_USESUBSURF</a>;
<a name="l01191"></a>01191 
<a name="l01192"></a>01192     <span class="comment">/* execute unwrap */</span>
<a name="l01193"></a>01193     <a class="code" href="../../dd/d25/ED__uvedit_8h.html#a78ff4821545f590ce840d70bda6fe50e">ED_unwrap_lscm</a>(scene, obedit, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01194"></a>01194 
<a name="l01195"></a>01195     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l01196"></a>01196     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l01197"></a>01197 
<a name="l01198"></a>01198     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01199"></a>01199 }
<a name="l01200"></a>01200 
<a name="l01201"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a511a44c695cd3e022222680eb17163b0">01201</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d48/uvedit__intern_8h.html#a6bfb658c8bd3232c4388866cebe2a824">UV_OT_unwrap</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01202"></a>01202 {
<a name="l01203"></a>01203     <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> method_items[] = {
<a name="l01204"></a>01204         {0, <span class="stringliteral">&quot;ANGLE_BASED&quot;</span>, 0, <span class="stringliteral">&quot;Angle Based&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l01205"></a>01205         {1, <span class="stringliteral">&quot;CONFORMAL&quot;</span>, 0, <span class="stringliteral">&quot;Conformal&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l01206"></a>01206         {0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL}};
<a name="l01207"></a>01207 
<a name="l01208"></a>01208     <span class="comment">/* identifiers */</span>
<a name="l01209"></a>01209     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Unwrap&quot;</span>;
<a name="l01210"></a>01210     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Unwrap the mesh of the object being edited&quot;</span>;
<a name="l01211"></a>01211     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;UV_OT_unwrap&quot;</span>;
<a name="l01212"></a>01212     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01213"></a>01213     
<a name="l01214"></a>01214     <span class="comment">/* api callbacks */</span>
<a name="l01215"></a>01215     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a67a3a387832b20efc94f82b902abb75f">unwrap_exec</a>;
<a name="l01216"></a>01216     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ad3a7453660a3411394c666022f899c16">ED_operator_uvmap</a>;
<a name="l01217"></a>01217 
<a name="l01218"></a>01218     <span class="comment">/* properties */</span>
<a name="l01219"></a>01219     <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;method&quot;</span>, method_items, 0, <span class="stringliteral">&quot;Method&quot;</span>,
<a name="l01220"></a>01220                  <span class="stringliteral">&quot;Unwrapping method (Angle Based usually gives better results than Conformal, while being somewhat slower)&quot;</span>);
<a name="l01221"></a>01221     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;fill_holes&quot;</span>, 1, <span class="stringliteral">&quot;Fill Holes&quot;</span>,
<a name="l01222"></a>01222                     <span class="stringliteral">&quot;Virtual fill holes in mesh before unwrapping, to better avoid overlaps and preserve symmetry&quot;</span>);
<a name="l01223"></a>01223     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;correct_aspect&quot;</span>, 1, <span class="stringliteral">&quot;Correct Aspect&quot;</span>,
<a name="l01224"></a>01224                     <span class="stringliteral">&quot;Map UVs taking image aspect ratio into account&quot;</span>);
<a name="l01225"></a>01225     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;use_subsurf_data&quot;</span>, 0, <span class="stringliteral">&quot;Use Subsurf Data&quot;</span>,
<a name="l01226"></a>01226                     <span class="stringliteral">&quot;Map UVs taking vertex position after subsurf into account&quot;</span>);
<a name="l01227"></a>01227     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;uv_subsurf_level&quot;</span>, 1, 1, 6, <span class="stringliteral">&quot;SubSurf Target&quot;</span>,
<a name="l01228"></a>01228                 <span class="stringliteral">&quot;Number of times to subdivide before calculating UVs&quot;</span>, 1, 6);
<a name="l01229"></a>01229 }
<a name="l01230"></a>01230 
<a name="l01231"></a>01231 <span class="comment">/**************** Project From View operator **************/</span>
<a name="l01232"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a01f7e0a7f29ef6c3c54d832179fd2b20">01232</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a01f7e0a7f29ef6c3c54d832179fd2b20">uv_from_view_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01233"></a>01233 {
<a name="l01234"></a>01234     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l01235"></a>01235     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l01236"></a>01236     <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *camera = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01237"></a>01237     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a4d9806c4d2c9d7777ae1619839d6baed" title="Return the BMEditMesh for a given object.">BMEdit_FromObject</a>(obedit);
<a name="l01238"></a>01238     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar = <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01239"></a>01239     <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d = <a class="code" href="../../df/d01/BKE__context_8h.html#a88ab4a564441708766a6b4ace3b17908">CTX_wm_view3d</a>(C);
<a name="l01240"></a>01240     <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d = <a class="code" href="../../df/d01/BKE__context_8h.html#af03543cb8e3fa2c39bb777962a6eae13">CTX_wm_region_view3d</a>(C);
<a name="l01241"></a>01241     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa;
<a name="l01242"></a>01242     <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l01243"></a>01243     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter, liter;
<a name="l01244"></a>01244     <a class="code" href="../../d6/d90/structMLoopUV.html">MLoopUV</a> *luv;
<a name="l01245"></a>01245     <span class="keywordtype">float</span> rotmat[4][4];
<a name="l01246"></a>01246 
<a name="l01247"></a>01247     <span class="comment">/* add uvs if they don&#39;t exist yet */</span>
<a name="l01248"></a>01248     <span class="keywordflow">if</span> (!<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a7efca9520bb62d682f07d20f0d8a1fbf">ED_uvedit_ensure_uvs</a>(C, scene, obedit)) {
<a name="l01249"></a>01249         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01250"></a>01250     }
<a name="l01251"></a>01251 
<a name="l01252"></a>01252     <span class="comment">/* establish the camera object, so we can default to view mapping if anything is wrong with it */</span>
<a name="l01253"></a>01253     <span class="keywordflow">if</span> ((rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8f435c152f17185773a21cd8b7067ebb">persp</a> == <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a4c869f8f07a58e54e43d35474bbe4757">RV3D_CAMOB</a>) &amp;&amp; (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>) &amp;&amp; (v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#afd7fa4376c670f245aeed7a7116c7005">OB_CAMERA</a>)) {
<a name="l01254"></a>01254         camera = v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01255"></a>01255     }
<a name="l01256"></a>01256 
<a name="l01257"></a>01257     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;orthographic&quot;</span>)) {
<a name="l01258"></a>01258         <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a8a771d58af2a01789acec643778ce4f9">uv_map_rotation_matrix</a>(rotmat, rv3d, obedit, 90.0f, 0.0f, 1.0f);
<a name="l01259"></a>01259         
<a name="l01260"></a>01260         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l01261"></a>01261             <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>))
<a name="l01262"></a>01262                 <span class="keywordflow">continue</span>;
<a name="l01263"></a>01263 
<a name="l01264"></a>01264             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l01265"></a>01265                 luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l01266"></a>01266                 <a class="code" href="../../d9/d0c/BLI__uvproject_8h.html#a918298b4b425a1e33e2f4d23bb5c8e0f">project_from_view_ortho</a>(luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>, rotmat);
<a name="l01267"></a>01267             }
<a name="l01268"></a>01268         }
<a name="l01269"></a>01269     }
<a name="l01270"></a>01270     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (camera) {
<a name="l01271"></a>01271         <span class="keyword">struct </span><a class="code" href="../../dc/dca/structUvCameraInfo.html">UvCameraInfo</a> *uci = <a class="code" href="../../d9/d0c/BLI__uvproject_8h.html#a8d81ee39c6502a048907d0547fd21d5b">project_camera_info</a>(v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#afac89783028ff848f111de04e0c29fbe">xsch</a>, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aca3c1ebdf50a6c74730e19e24983217d">ysch</a>);
<a name="l01272"></a>01272         
<a name="l01273"></a>01273         <span class="keywordflow">if</span> (uci) {
<a name="l01274"></a>01274             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l01275"></a>01275                 <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>))
<a name="l01276"></a>01276                     <span class="keywordflow">continue</span>;
<a name="l01277"></a>01277 
<a name="l01278"></a>01278                 <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l01279"></a>01279                     luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l01280"></a>01280                     <a class="code" href="../../d9/d0c/BLI__uvproject_8h.html#aa0e0ea7d1c900c6ef135554d3317f380">project_from_camera</a>(luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>, uci);
<a name="l01281"></a>01281                 }
<a name="l01282"></a>01282             }
<a name="l01283"></a>01283             
<a name="l01284"></a>01284             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(uci);
<a name="l01285"></a>01285         }
<a name="l01286"></a>01286     }
<a name="l01287"></a>01287     <span class="keywordflow">else</span> {
<a name="l01288"></a>01288         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(rotmat, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l01289"></a>01289 
<a name="l01290"></a>01290         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l01291"></a>01291             <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>))
<a name="l01292"></a>01292                 <span class="keywordflow">continue</span>;
<a name="l01293"></a>01293 
<a name="l01294"></a>01294             <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l01295"></a>01295                 luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l01296"></a>01296                 <a class="code" href="../../d9/d0c/BLI__uvproject_8h.html#a2e7336af0afa99804b813a647bef9737">project_from_view</a>(luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>, rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8ab36b8b8caeec087fd9595c33e90775">persmat</a>, rotmat, ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a32e37003215c0dc7f77e12e4fc9db3f4">winx</a>, ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a908d20a23657ef143d2de1496be69f42">winy</a>);
<a name="l01297"></a>01297             }
<a name="l01298"></a>01298         }
<a name="l01299"></a>01299     }
<a name="l01300"></a>01300 
<a name="l01301"></a>01301     <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a00f8f3188e02352d1df01fea35c9bbe1">uv_map_clip_correct</a>(em, op);
<a name="l01302"></a>01302 
<a name="l01303"></a>01303     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l01304"></a>01304     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l01305"></a>01305 
<a name="l01306"></a>01306     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01307"></a>01307 }
<a name="l01308"></a>01308 
<a name="l01309"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a0b728006bea74d8db7cca913cc1c1dc6">01309</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a0b728006bea74d8db7cca913cc1c1dc6">uv_from_view_poll</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l01310"></a>01310 {
<a name="l01311"></a>01311     <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d = <a class="code" href="../../df/d01/BKE__context_8h.html#af03543cb8e3fa2c39bb777962a6eae13">CTX_wm_region_view3d</a>(C);
<a name="l01312"></a>01312 
<a name="l01313"></a>01313     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d12/ED__screen_8h.html#ad3a7453660a3411394c666022f899c16">ED_operator_uvmap</a>(C))
<a name="l01314"></a>01314         <span class="keywordflow">return</span> 0;
<a name="l01315"></a>01315 
<a name="l01316"></a>01316     <span class="keywordflow">return</span> (rv3d != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01317"></a>01317 }
<a name="l01318"></a>01318 
<a name="l01319"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ad95641778870b43a98c5634a3e63c7d2">01319</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d48/uvedit__intern_8h.html#a916bb229078bbc0992cf2302769f7e42">UV_OT_from_view</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01320"></a>01320 {
<a name="l01321"></a>01321     <span class="comment">/* identifiers */</span>
<a name="l01322"></a>01322     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Project From View&quot;</span>;
<a name="l01323"></a>01323     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;UV_OT_project_from_view&quot;</span>;
<a name="l01324"></a>01324     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01325"></a>01325     
<a name="l01326"></a>01326     <span class="comment">/* api callbacks */</span>
<a name="l01327"></a>01327     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a01f7e0a7f29ef6c3c54d832179fd2b20">uv_from_view_exec</a>;
<a name="l01328"></a>01328     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a0b728006bea74d8db7cca913cc1c1dc6">uv_from_view_poll</a>;
<a name="l01329"></a>01329 
<a name="l01330"></a>01330     <span class="comment">/* properties */</span>
<a name="l01331"></a>01331     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;orthographic&quot;</span>, 0, <span class="stringliteral">&quot;Orthographic&quot;</span>, <span class="stringliteral">&quot;Use orthographic projection&quot;</span>);
<a name="l01332"></a>01332     <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a8270021eae0ebf754bb6fb4332ce25a2">uv_map_clip_correct_properties</a>(ot);
<a name="l01333"></a>01333 }
<a name="l01334"></a>01334 
<a name="l01335"></a>01335 <span class="comment">/********************** Reset operator ********************/</span>
<a name="l01336"></a>01336 
<a name="l01337"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#af2e345ddc7d2f6dafdef14c9b559f73e">01337</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#af2e345ddc7d2f6dafdef14c9b559f73e">reset_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l01338"></a>01338 {
<a name="l01339"></a>01339     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l01340"></a>01340     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l01341"></a>01341     <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me = (<a class="code" href="../../da/d29/structMesh.html">Mesh</a> *)obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01342"></a>01342 
<a name="l01343"></a>01343     <span class="comment">/* add uvs if they don&#39;t exist yet */</span>
<a name="l01344"></a>01344     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (!<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a7efca9520bb62d682f07d20f0d8a1fbf">ED_uvedit_ensure_uvs</a>(C, scene, obedit)) {
<a name="l01345"></a>01345         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01346"></a>01346     }
<a name="l01347"></a>01347 
<a name="l01348"></a>01348     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/dd6/ED__mesh_8h.html#a84b11d3dea9a5e302c5ca10e53154eca">ED_mesh_uv_loop_reset</a>(C, me)) {
<a name="l01349"></a>01349         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01350"></a>01350     }
<a name="l01351"></a>01351 
<a name="l01352"></a>01352     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l01353"></a>01353     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l01354"></a>01354     
<a name="l01355"></a>01355     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01356"></a>01356 }
<a name="l01357"></a>01357 
<a name="l01358"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#aca2750740d6eecb6f39ba28ac42fe828">01358</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d48/uvedit__intern_8h.html#ac37947ed9f43a3c58544e25cd6f3be21">UV_OT_reset</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01359"></a>01359 {
<a name="l01360"></a>01360     <span class="comment">/* identifiers */</span>
<a name="l01361"></a>01361     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Reset&quot;</span>;
<a name="l01362"></a>01362     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;UV_OT_reset&quot;</span>;
<a name="l01363"></a>01363     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01364"></a>01364     
<a name="l01365"></a>01365     <span class="comment">/* api callbacks */</span>
<a name="l01366"></a>01366     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#af2e345ddc7d2f6dafdef14c9b559f73e">reset_exec</a>;
<a name="l01367"></a>01367     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ad3a7453660a3411394c666022f899c16">ED_operator_uvmap</a>;
<a name="l01368"></a>01368 }
<a name="l01369"></a>01369 
<a name="l01370"></a>01370 <span class="comment">/****************** Sphere Project operator ***************/</span>
<a name="l01371"></a>01371 
<a name="l01372"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#aa907f8eb7a521e53c03ba0f012ad4870">01372</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#aa907f8eb7a521e53c03ba0f012ad4870">uv_sphere_project</a>(<span class="keywordtype">float</span> target[2], <span class="keywordtype">float</span> source[3], <span class="keywordtype">float</span> center[3], <span class="keywordtype">float</span> <a class="code" href="../../dc/dca/structUvCameraInfo.html#ae5633d166c17eb9a384b25d22e73db69">rotmat</a>[4][4])
<a name="l01373"></a>01373 {
<a name="l01374"></a>01374     <span class="keywordtype">float</span> pv[3];
<a name="l01375"></a>01375 
<a name="l01376"></a>01376     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(pv, source, center);
<a name="l01377"></a>01377     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(rotmat, pv);
<a name="l01378"></a>01378 
<a name="l01379"></a>01379     <a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#a00008dde1f5ee691cb22fc21757c920e">map_to_sphere</a>(&amp;target[0], &amp;target[1], pv[0], pv[1], pv[2]);
<a name="l01380"></a>01380 
<a name="l01381"></a>01381     <span class="comment">/* split line is always zero */</span>
<a name="l01382"></a>01382     <span class="keywordflow">if</span> (target[0] &gt;= 1.0f)
<a name="l01383"></a>01383         target[0] -= 1.0f;  
<a name="l01384"></a>01384 }
<a name="l01385"></a>01385 
<a name="l01386"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a811abe31558d4c6de6cf71f947d791f9">01386</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a811abe31558d4c6de6cf71f947d791f9">uv_map_mirror</a>(<a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em, <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa, <a class="code" href="../../de/d88/structMTexPoly.html">MTexPoly</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(tf))
<a name="l01387"></a>01387 {
<a name="l01388"></a>01388     <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l01389"></a>01389     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> liter;
<a name="l01390"></a>01390     <a class="code" href="../../d6/d90/structMLoopUV.html">MLoopUV</a> *luv;
<a name="l01391"></a>01391     <span class="keywordtype">float</span> **uvs = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01392"></a>01392     <a class="code" href="../../da/d6c/BLI__array_8h.html#ae183fbd726d868f27ba45f717e8e883e">BLI_array_fixedstack_declare</a>(uvs, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a2ec7f0d9fdc36328119ba93b8064a560">BM_NGON_STACK_SIZE</a>, efa-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a221be6c99989ead8ee0e1bba1eb0272e">len</a>, __func__);
<a name="l01393"></a>01393     <span class="keywordtype">float</span> dx;
<a name="l01394"></a>01394     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, mi;
<a name="l01395"></a>01395 
<a name="l01396"></a>01396     i = 0;
<a name="l01397"></a>01397     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l01398"></a>01398         luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l01399"></a>01399         uvs[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>;
<a name="l01400"></a>01400         i++;
<a name="l01401"></a>01401     }
<a name="l01402"></a>01402 
<a name="l01403"></a>01403     mi = 0;
<a name="l01404"></a>01404     <span class="keywordflow">for</span> (i = 1; i &lt; efa-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a221be6c99989ead8ee0e1bba1eb0272e">len</a>; i++)
<a name="l01405"></a>01405         <span class="keywordflow">if</span> (uvs[i][0] &gt; uvs[mi][0])
<a name="l01406"></a>01406             mi = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01407"></a>01407 
<a name="l01408"></a>01408     <span class="keywordflow">for</span> (i = 0; i &lt; efa-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a221be6c99989ead8ee0e1bba1eb0272e">len</a>; i++) {
<a name="l01409"></a>01409         <span class="keywordflow">if</span> (i != mi) {
<a name="l01410"></a>01410             dx = uvs[mi][0] - uvs[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][0];
<a name="l01411"></a>01411             <span class="keywordflow">if</span> (dx &gt; 0.5f) uvs[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][0] += 1.0f;
<a name="l01412"></a>01412         } 
<a name="l01413"></a>01413     } 
<a name="l01414"></a>01414 
<a name="l01415"></a>01415     <a class="code" href="../../da/d6c/BLI__array_8h.html#ae2c777546c0aae29f65f25b0ece92248">BLI_array_fixedstack_free</a>(uvs);
<a name="l01416"></a>01416 }
<a name="l01417"></a>01417 
<a name="l01418"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#aa5e4dd9a3402b865bf84517d785ad7c0">01418</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#aa5e4dd9a3402b865bf84517d785ad7c0">sphere_project_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01419"></a>01419 {
<a name="l01420"></a>01420     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l01421"></a>01421     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l01422"></a>01422     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a4d9806c4d2c9d7777ae1619839d6baed" title="Return the BMEditMesh for a given object.">BMEdit_FromObject</a>(obedit);
<a name="l01423"></a>01423     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa;
<a name="l01424"></a>01424     <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l01425"></a>01425     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter, liter;
<a name="l01426"></a>01426     <a class="code" href="../../de/d88/structMTexPoly.html">MTexPoly</a> *tf;
<a name="l01427"></a>01427     <a class="code" href="../../d6/d90/structMLoopUV.html">MLoopUV</a> *luv;
<a name="l01428"></a>01428     <span class="keywordtype">float</span> center[3], <a class="code" href="../../dc/dca/structUvCameraInfo.html#ae5633d166c17eb9a384b25d22e73db69">rotmat</a>[4][4];
<a name="l01429"></a>01429 
<a name="l01430"></a>01430     <span class="comment">/* add uvs if they don&#39;t exist yet */</span>
<a name="l01431"></a>01431     <span class="keywordflow">if</span> (!<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a7efca9520bb62d682f07d20f0d8a1fbf">ED_uvedit_ensure_uvs</a>(C, scene, obedit)) {
<a name="l01432"></a>01432         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01433"></a>01433     }
<a name="l01434"></a>01434 
<a name="l01435"></a>01435     <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ad70cbf704846ee00c40701a3d7c87e8c">uv_map_transform</a>(C, op, center, rotmat);
<a name="l01436"></a>01436 
<a name="l01437"></a>01437     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l01438"></a>01438         <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>))
<a name="l01439"></a>01439             <span class="keywordflow">continue</span>;
<a name="l01440"></a>01440 
<a name="l01441"></a>01441         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l01442"></a>01442             luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l01443"></a>01443 
<a name="l01444"></a>01444             <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#aa907f8eb7a521e53c03ba0f012ad4870">uv_sphere_project</a>(luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>, center, rotmat);
<a name="l01445"></a>01445         }
<a name="l01446"></a>01446 
<a name="l01447"></a>01447         tf = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abda690b32c834c8ee41e225cfd2d9e49">pdata</a>, efa-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a80c8c910b6b28425ea8544e07741092c">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a05731a08cef6d81e74c221963ae25712">CD_MTEXPOLY</a>);
<a name="l01448"></a>01448         <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a811abe31558d4c6de6cf71f947d791f9">uv_map_mirror</a>(em, efa, tf);
<a name="l01449"></a>01449     }
<a name="l01450"></a>01450 
<a name="l01451"></a>01451     <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a00f8f3188e02352d1df01fea35c9bbe1">uv_map_clip_correct</a>(em, op);
<a name="l01452"></a>01452 
<a name="l01453"></a>01453     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l01454"></a>01454     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l01455"></a>01455 
<a name="l01456"></a>01456     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01457"></a>01457 }
<a name="l01458"></a>01458 
<a name="l01459"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a6e15b4e768f0ba951371f67ac5faead1">01459</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d48/uvedit__intern_8h.html#a765d74107186b3cc4b2778105da0a9c8">UV_OT_sphere_project</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01460"></a>01460 {
<a name="l01461"></a>01461     <span class="comment">/* identifiers */</span>
<a name="l01462"></a>01462     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Sphere Projection&quot;</span>;
<a name="l01463"></a>01463     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;UV_OT_sphere_project&quot;</span>;
<a name="l01464"></a>01464     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01465"></a>01465     
<a name="l01466"></a>01466     <span class="comment">/* api callbacks */</span>
<a name="l01467"></a>01467     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#aa5e4dd9a3402b865bf84517d785ad7c0">sphere_project_exec</a>;
<a name="l01468"></a>01468     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ad3a7453660a3411394c666022f899c16">ED_operator_uvmap</a>;
<a name="l01469"></a>01469 
<a name="l01470"></a>01470     <span class="comment">/* properties */</span>
<a name="l01471"></a>01471     <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a4523e492d5804ca09bfd45c31a821c5d">uv_transform_properties</a>(ot, 0);
<a name="l01472"></a>01472     <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a8270021eae0ebf754bb6fb4332ce25a2">uv_map_clip_correct_properties</a>(ot);
<a name="l01473"></a>01473 }
<a name="l01474"></a>01474 
<a name="l01475"></a>01475 <span class="comment">/***************** Cylinder Project operator **************/</span>
<a name="l01476"></a>01476 
<a name="l01477"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#abca79441adc28f8942f20a49745743a6">01477</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#abca79441adc28f8942f20a49745743a6">uv_cylinder_project</a>(<span class="keywordtype">float</span> target[2], <span class="keywordtype">float</span> source[3], <span class="keywordtype">float</span> center[3], <span class="keywordtype">float</span> <a class="code" href="../../dc/dca/structUvCameraInfo.html#ae5633d166c17eb9a384b25d22e73db69">rotmat</a>[4][4])
<a name="l01478"></a>01478 {
<a name="l01479"></a>01479     <span class="keywordtype">float</span> pv[3];
<a name="l01480"></a>01480 
<a name="l01481"></a>01481     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(pv, source, center);
<a name="l01482"></a>01482     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(rotmat, pv);
<a name="l01483"></a>01483 
<a name="l01484"></a>01484     <a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#acc7abfd5b890347fa45e5f710448a6b5">map_to_tube</a>(&amp;target[0], &amp;target[1], pv[0], pv[1], pv[2]);
<a name="l01485"></a>01485 
<a name="l01486"></a>01486     <span class="comment">/* split line is always zero */</span>
<a name="l01487"></a>01487     <span class="keywordflow">if</span> (target[0] &gt;= 1.0f)
<a name="l01488"></a>01488         target[0] -= 1.0f;  
<a name="l01489"></a>01489 }
<a name="l01490"></a>01490 
<a name="l01491"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a0f33b09432471f5a65a8169a37a03513">01491</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a0f33b09432471f5a65a8169a37a03513">cylinder_project_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01492"></a>01492 {
<a name="l01493"></a>01493     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l01494"></a>01494     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l01495"></a>01495     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a4d9806c4d2c9d7777ae1619839d6baed" title="Return the BMEditMesh for a given object.">BMEdit_FromObject</a>(obedit);
<a name="l01496"></a>01496     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa;
<a name="l01497"></a>01497     <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l01498"></a>01498     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter, liter;
<a name="l01499"></a>01499     <a class="code" href="../../de/d88/structMTexPoly.html">MTexPoly</a> *tf;
<a name="l01500"></a>01500     <a class="code" href="../../d6/d90/structMLoopUV.html">MLoopUV</a> *luv;
<a name="l01501"></a>01501     <span class="keywordtype">float</span> center[3], <a class="code" href="../../dc/dca/structUvCameraInfo.html#ae5633d166c17eb9a384b25d22e73db69">rotmat</a>[4][4];
<a name="l01502"></a>01502 
<a name="l01503"></a>01503     <span class="comment">/* add uvs if they don&#39;t exist yet */</span>
<a name="l01504"></a>01504     <span class="keywordflow">if</span> (!<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a7efca9520bb62d682f07d20f0d8a1fbf">ED_uvedit_ensure_uvs</a>(C, scene, obedit)) {
<a name="l01505"></a>01505         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01506"></a>01506     }
<a name="l01507"></a>01507 
<a name="l01508"></a>01508     <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#ad70cbf704846ee00c40701a3d7c87e8c">uv_map_transform</a>(C, op, center, rotmat);
<a name="l01509"></a>01509 
<a name="l01510"></a>01510     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l01511"></a>01511         tf = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abda690b32c834c8ee41e225cfd2d9e49">pdata</a>, efa-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a80c8c910b6b28425ea8544e07741092c">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#a05731a08cef6d81e74c221963ae25712">CD_MTEXPOLY</a>);
<a name="l01512"></a>01512         <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>))
<a name="l01513"></a>01513             <span class="keywordflow">continue</span>;
<a name="l01514"></a>01514         
<a name="l01515"></a>01515         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l01516"></a>01516             luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l01517"></a>01517 
<a name="l01518"></a>01518             <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#abca79441adc28f8942f20a49745743a6">uv_cylinder_project</a>(luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>, center, rotmat);
<a name="l01519"></a>01519         }
<a name="l01520"></a>01520 
<a name="l01521"></a>01521         <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a811abe31558d4c6de6cf71f947d791f9">uv_map_mirror</a>(em, efa, tf);
<a name="l01522"></a>01522     }
<a name="l01523"></a>01523 
<a name="l01524"></a>01524     <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a00f8f3188e02352d1df01fea35c9bbe1">uv_map_clip_correct</a>(em, op);
<a name="l01525"></a>01525 
<a name="l01526"></a>01526     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l01527"></a>01527     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l01528"></a>01528 
<a name="l01529"></a>01529     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01530"></a>01530 }
<a name="l01531"></a>01531 
<a name="l01532"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a49e2953d8e7dfe0f581b2949ee6904c1">01532</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d48/uvedit__intern_8h.html#aa407249f84d450ba634b7b4d0e34b092">UV_OT_cylinder_project</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01533"></a>01533 {
<a name="l01534"></a>01534     <span class="comment">/* identifiers */</span>
<a name="l01535"></a>01535     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Cylinder Projection&quot;</span>;
<a name="l01536"></a>01536     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;UV_OT_cylinder_project&quot;</span>;
<a name="l01537"></a>01537     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01538"></a>01538     
<a name="l01539"></a>01539     <span class="comment">/* api callbacks */</span>
<a name="l01540"></a>01540     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a0f33b09432471f5a65a8169a37a03513">cylinder_project_exec</a>;
<a name="l01541"></a>01541     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ad3a7453660a3411394c666022f899c16">ED_operator_uvmap</a>;
<a name="l01542"></a>01542 
<a name="l01543"></a>01543     <span class="comment">/* properties */</span>
<a name="l01544"></a>01544     <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a4523e492d5804ca09bfd45c31a821c5d">uv_transform_properties</a>(ot, 1);
<a name="l01545"></a>01545     <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a8270021eae0ebf754bb6fb4332ce25a2">uv_map_clip_correct_properties</a>(ot);
<a name="l01546"></a>01546 }
<a name="l01547"></a>01547 
<a name="l01548"></a>01548 <span class="comment">/******************* Cube Project operator ****************/</span>
<a name="l01549"></a>01549 
<a name="l01550"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a0ba09ff93c02f6fa982b6f0aef00edeb">01550</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a0ba09ff93c02f6fa982b6f0aef00edeb">cube_project_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01551"></a>01551 {
<a name="l01552"></a>01552     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l01553"></a>01553     <a class="code" href="../../de/de7/structObject.html">Object</a> *obedit = <a class="code" href="../../df/d01/BKE__context_8h.html#a323e283348470c038f3dd98de298a76b">CTX_data_edit_object</a>(C);
<a name="l01554"></a>01554     <a class="code" href="../../d5/de5/structBMEditMesh.html">BMEditMesh</a> *em = <a class="code" href="../../d6/dc7/BKE__tessmesh_8h.html#a4d9806c4d2c9d7777ae1619839d6baed" title="Return the BMEditMesh for a given object.">BMEdit_FromObject</a>(obedit);
<a name="l01555"></a>01555     <a class="code" href="../../d0/d23/structBMFace.html">BMFace</a> *efa;
<a name="l01556"></a>01556     <a class="code" href="../../dc/dd5/structBMLoop.html">BMLoop</a> *l;
<a name="l01557"></a>01557     <a class="code" href="../../de/d88/structBMIter.html">BMIter</a> iter, liter;
<a name="l01558"></a>01558     <span class="comment">/* MTexPoly *tf; */</span> <span class="comment">/* UNUSED */</span>
<a name="l01559"></a>01559     <a class="code" href="../../d6/d90/structMLoopUV.html">MLoopUV</a> *luv;
<a name="l01560"></a>01560     <span class="keywordtype">float</span> cube_size, *loc, dx, dy;
<a name="l01561"></a>01561     <span class="keywordtype">int</span> cox, coy;
<a name="l01562"></a>01562 
<a name="l01563"></a>01563     <span class="comment">/* add uvs if they don&#39;t exist yet */</span>
<a name="l01564"></a>01564     <span class="keywordflow">if</span> (!<a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a7efca9520bb62d682f07d20f0d8a1fbf">ED_uvedit_ensure_uvs</a>(C, scene, obedit)) {
<a name="l01565"></a>01565         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01566"></a>01566     }
<a name="l01567"></a>01567 
<a name="l01568"></a>01568     loc = obedit-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3];
<a name="l01569"></a>01569     cube_size = <a class="code" href="../../d3/d10/rna__access_8c.html#a99bfb3295a4df6fef29f16924fd24c79">RNA_float_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;cube_size&quot;</span>);
<a name="l01570"></a>01570 
<a name="l01571"></a>01571     <span class="comment">/* choose x,y,z axis for projection depending on the largest normal</span>
<a name="l01572"></a>01572 <span class="comment">     * component, but clusters all together around the center of map. */</span>
<a name="l01573"></a>01573 
<a name="l01574"></a>01574     <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a79af59cc6dcf476dee88507d90e316e9">BM_ITER_MESH</a> (efa, &amp;iter, em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1fabe0fe60283f43cd8ce697d52d24a3c1e">BM_FACES_OF_MESH</a>) {
<a name="l01575"></a>01575         <span class="keywordtype">int</span> first = 1;
<a name="l01576"></a>01576 
<a name="l01577"></a>01577         <span class="comment">/* tf = CustomData_bmesh_get(&amp;em-&gt;bm-&gt;pdata, efa-&gt;head.data, CD_MTEXPOLY); */</span> <span class="comment">/* UNUSED */</span>
<a name="l01578"></a>01578         <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d74/bmesh__inline_8h.html#a94748f531b63177f476a182c01fb43b1">BM_elem_flag_test</a>(efa, <a class="code" href="../../d1/d77/bmesh__class_8h.html#a16685eea158879e41b101ca3634de462a6afc5d1391fd30b47036817b139a85ed">BM_ELEM_SELECT</a>))
<a name="l01579"></a>01579             <span class="keywordflow">continue</span>;
<a name="l01580"></a>01580 
<a name="l01581"></a>01581         <a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#a1d7ee186236c67b1591049c92c382e0d">axis_dominant_v3</a>(&amp;cox, &amp;coy, efa-&gt;<a class="code" href="../../d0/d23/structBMFace.html#a9401deff8be300468964ca48850ff702">no</a>);
<a name="l01582"></a>01582 
<a name="l01583"></a>01583         dx = dy = 0;
<a name="l01584"></a>01584         <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a5e5c4d17117bdcca9ab959ebf43a174f">BM_ITER_ELEM</a> (l, &amp;liter, efa, <a class="code" href="../../d8/d17/bmesh__iterators_8h.html#a8b86da2394e306625bbfd94190505d1faf52ecdfb30814f26ead38881b29c7375">BM_LOOPS_OF_FACE</a>) {
<a name="l01585"></a>01585             luv = <a class="code" href="../../d5/d5e/BKE__customdata_8h.html#abd885f96566fa49036c6219d971cc809">CustomData_bmesh_get</a>(&amp;em-&gt;<a class="code" href="../../d5/de5/structBMEditMesh.html#a5b91780fbab0c3a8834609b21acde933">bm</a>-&gt;<a class="code" href="../../d7/d18/structBMesh.html#abee9716c152e57c29af7d211ced0e178">ldata</a>, l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a164c8c2d0c397a56c211f1f0a0db7bc6">head</a>.<a class="code" href="../../d5/d3a/structBMHeader.html#aab6fc118de69cdb678fe6aaba4ec75be">data</a>, <a class="code" href="../../d8/d9f/DNA__customdata__types_8h.html#acc4311230a2627e6cbaf767a15b3aaa2">CD_MLOOPUV</a>);
<a name="l01586"></a>01586 
<a name="l01587"></a>01587             luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>[0] = 0.5f + 0.5f * cube_size * (loc[cox] + l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>[cox]);
<a name="l01588"></a>01588             luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>[1] = 0.5f + 0.5f * cube_size * (loc[coy] + l-&gt;<a class="code" href="../../dc/dd5/structBMLoop.html#a2da088cf339e17dafd9f5e7ee0bf3771">v</a>-&gt;<a class="code" href="../../df/d18/structBMVert.html#a69422c1e633b64cb13937a2e70a160a8">co</a>[coy]);
<a name="l01589"></a>01589             
<a name="l01590"></a>01590             <span class="keywordflow">if</span> (first) {
<a name="l01591"></a>01591                 dx = floor(luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>[0]);
<a name="l01592"></a>01592                 dy = floor(luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>[1]);
<a name="l01593"></a>01593                 first = 0;
<a name="l01594"></a>01594             }
<a name="l01595"></a>01595             
<a name="l01596"></a>01596 
<a name="l01597"></a>01597             luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>[0] -= dx;
<a name="l01598"></a>01598             luv-&gt;<a class="code" href="../../d6/d90/structMLoopUV.html#ac544e39393bf4b87a7addbcb03198a1f">uv</a>[1] -= dy;
<a name="l01599"></a>01599         }
<a name="l01600"></a>01600     }
<a name="l01601"></a>01601 
<a name="l01602"></a>01602     <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a00f8f3188e02352d1df01fea35c9bbe1">uv_map_clip_correct</a>(em, op);
<a name="l01603"></a>01603 
<a name="l01604"></a>01604     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, 0);
<a name="l01605"></a>01605     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a185e97978ae45ed1d3b3ff4d442c567c">NC_GEOM</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a25383f13197df9bda823d34736df4d82">ND_DATA</a>, obedit-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>);
<a name="l01606"></a>01606 
<a name="l01607"></a>01607     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01608"></a>01608 }
<a name="l01609"></a>01609 
<a name="l01610"></a><a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a7c01ebb05b330f549a0102aa67bfd23d">01610</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d48/uvedit__intern_8h.html#a9672ffc642d268d44b2ea2106563500d">UV_OT_cube_project</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01611"></a>01611 {
<a name="l01612"></a>01612     <span class="comment">/* identifiers */</span>
<a name="l01613"></a>01613     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Cube Projection&quot;</span>;
<a name="l01614"></a>01614     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;UV_OT_cube_project&quot;</span>;
<a name="l01615"></a>01615     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a> | <a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01616"></a>01616     
<a name="l01617"></a>01617     <span class="comment">/* api callbacks */</span>
<a name="l01618"></a>01618     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a0ba09ff93c02f6fa982b6f0aef00edeb">cube_project_exec</a>;
<a name="l01619"></a>01619     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#ad3a7453660a3411394c666022f899c16">ED_operator_uvmap</a>;
<a name="l01620"></a>01620 
<a name="l01621"></a>01621     <span class="comment">/* properties */</span>
<a name="l01622"></a>01622     <a class="code" href="../../dc/d7e/rna__define_8c.html#a040f4b08fc87a45a90e2291382e27f75">RNA_def_float</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;cube_size&quot;</span>, 1.0f, 0.0f, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <span class="stringliteral">&quot;Cube Size&quot;</span>, <span class="stringliteral">&quot;Size of the cube to project on&quot;</span>, 0.001f, 100.0f);
<a name="l01623"></a>01623     <a class="code" href="../../dc/de2/uvedit__unwrap__ops_8c.html#a8270021eae0ebf754bb6fb4332ce25a2">uv_map_clip_correct_properties</a>(ot);
<a name="l01624"></a>01624 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:55:02 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: anim_filter.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">anim_filter.c</div>  </div>
</div>
<div class="contents">
<a href="../../dc/d01/anim__filter_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version. </span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2008 Blender Foundation, Joshua Leung</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * </span>
<a name="l00022"></a>00022 <span class="comment"> * Contributor(s): Joshua Leung (original author)</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00025"></a>00025 <span class="comment"> */</span>
<a name="l00026"></a>00026 
<a name="l00032"></a>00032 <span class="comment">/* This file contains a system used to provide a layer of abstraction between sources</span>
<a name="l00033"></a>00033 <span class="comment"> * of animation data and tools in Animation Editors. The method used here involves </span>
<a name="l00034"></a>00034 <span class="comment"> * generating a list of edit structures which enable tools to naively perform the actions </span>
<a name="l00035"></a>00035 <span class="comment"> * they require without all the boiler-plate associated with loops within loops and checking </span>
<a name="l00036"></a>00036 <span class="comment"> * for cases to ignore. </span>
<a name="l00037"></a>00037 <span class="comment"> *</span>
<a name="l00038"></a>00038 <span class="comment"> * While this is primarily used for the Action/Dopesheet Editor (and its accessory modes),</span>
<a name="l00039"></a>00039 <span class="comment"> * the Graph Editor also uses this for its channel list and for determining which curves</span>
<a name="l00040"></a>00040 <span class="comment"> * are being edited. Likewise, the NLA Editor also uses this for its channel list and in</span>
<a name="l00041"></a>00041 <span class="comment"> * its operators.</span>
<a name="l00042"></a>00042 <span class="comment"> *</span>
<a name="l00043"></a>00043 <span class="comment"> * Note: much of the original system this was based on was built before the creation of the RNA</span>
<a name="l00044"></a>00044 <span class="comment"> * system. In future, it would be interesting to replace some parts of this code with RNA queries,</span>
<a name="l00045"></a>00045 <span class="comment"> * however, RNA does not eliminate some of the boiler-plate reduction benefits presented by this </span>
<a name="l00046"></a>00046 <span class="comment"> * system, so if any such work does occur, it should only be used for the internals used here...</span>
<a name="l00047"></a>00047 <span class="comment"> *</span>
<a name="l00048"></a>00048 <span class="comment"> * -- Joshua Leung, Dec 2008 (Last revision July 2009)</span>
<a name="l00049"></a>00049 <span class="comment"> */</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html">DNA_anim_types.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d93/DNA__armature__types_8h.html">DNA_armature_types.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d3b/DNA__camera__types_8h.html">DNA_camera_types.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html">DNA_lamp_types.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d2f/DNA__lattice__types_8h.html">DNA_lattice_types.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d41/DNA__key__types_8h.html">DNA_key_types.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../de/db2/DNA__material__types_8h.html">DNA_material_types.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d96/DNA__mesh__types_8h.html">DNA_mesh_types.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d40/DNA__meta__types_8h.html">DNA_meta_types.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d27/DNA__node__types_8h.html">DNA_node_types.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d5a/DNA__particle__types_8h.html">DNA_particle_types.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d5d/DNA__space__types_8h.html">DNA_space_types.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/da9/DNA__sequence__types_8h.html">DNA_sequence_types.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/da4/DNA__screen__types_8h.html">DNA_screen_types.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="../../da/de4/DNA__speaker__types_8h.html">DNA_speaker_types.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d3b/DNA__world__types_8h.html">DNA_world_types.h</a>&quot;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dcb/DNA__gpencil__types_8h.html">DNA_gpencil_types.h</a>&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00077"></a>00077 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc5/BLI__ghash_8h.html" title="A general (pointer -&gt; pointer) hash table ADT.">BLI_ghash.h</a>&quot;</span>
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d51/BKE__animsys_8h.html">BKE_animsys.h</a>&quot;</span>
<a name="l00080"></a>00080 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/df5/BKE__action_8h.html" title="Blender kernel action and pose functionality.">BKE_action.h</a>&quot;</span>
<a name="l00081"></a>00081 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dba/BKE__fcurve_8h.html">BKE_fcurve.h</a>&quot;</span>
<a name="l00082"></a>00082 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00083"></a>00083 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span>
<a name="l00084"></a>00084 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/df5/BKE__group_8h.html">BKE_group.h</a>&quot;</span>
<a name="l00085"></a>00085 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d17/BKE__key_8h.html">BKE_key.h</a>&quot;</span>
<a name="l00086"></a>00086 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00087"></a>00087 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d0f/BKE__material_8h.html" title="General operations, lookup, etc. for materials.">BKE_material.h</a>&quot;</span>
<a name="l00088"></a>00088 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d91/BKE__node_8h.html">BKE_node.h</a>&quot;</span>
<a name="l00089"></a>00089 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d5f/BKE__sequencer_8h.html">BKE_sequencer.h</a>&quot;</span>
<a name="l00090"></a>00090 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dde/BKE__utildefines_8h.html" title="blender format specific macros">BKE_utildefines.h</a>&quot;</span>
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d6f/ED__anim__api_8h.html">ED_anim_api.h</a>&quot;</span>
<a name="l00093"></a>00093 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/da6/ED__markers_8h.html">ED_markers.h</a>&quot;</span>
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="comment">/* ************************************************************ */</span>
<a name="l00096"></a>00096 <span class="comment">/* Blender Context &lt;-&gt; Animation Context mapping */</span>
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="comment">/* ----------- Private Stuff - Action Editor ------------- */</span>
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="comment">/* Get shapekey data being edited (for Action Editor -&gt; ShapeKey mode) */</span>
<a name="l00101"></a>00101 <span class="comment">/* Note: there&#39;s a similar function in key.c (ob_get_key) */</span>
<a name="l00102"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a369fb66e299a42fc55c60fffc5803ee0">00102</a> <span class="keyword">static</span> <a class="code" href="../../d1/d9e/structKey.html">Key</a> *<a class="code" href="../../dc/d01/anim__filter_8c.html#a369fb66e299a42fc55c60fffc5803ee0">actedit_get_shapekeys</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac) 
<a name="l00103"></a>00103 {
<a name="l00104"></a>00104     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l00105"></a>00105     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l00106"></a>00106     <a class="code" href="../../d1/d9e/structKey.html">Key</a> *key;
<a name="l00107"></a>00107     
<a name="l00108"></a>00108     ob = <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a119935c54737bd111df8fd516c390000">OBACT</a>;
<a name="l00109"></a>00109     <span class="keywordflow">if</span> (ob == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) 
<a name="l00110"></a>00110         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00111"></a>00111     
<a name="l00112"></a>00112     <span class="comment">/* XXX pinning is not available in &#39;ShapeKey&#39; mode... */</span>
<a name="l00113"></a>00113     <span class="comment">//if (saction-&gt;pin) return NULL;</span>
<a name="l00114"></a>00114     
<a name="l00115"></a>00115     <span class="comment">/* shapekey data is stored with geometry data */</span>
<a name="l00116"></a>00116     key= <a class="code" href="../../d5/d17/BKE__key_8h.html#a8f07b4f039eb391df3c5b429d2f79e62">ob_get_key</a>(ob);
<a name="l00117"></a>00117     
<a name="l00118"></a>00118     <span class="keywordflow">if</span> (key) {
<a name="l00119"></a>00119         <span class="keywordflow">if</span> (key-&gt;<a class="code" href="../../d1/d9e/structKey.html#af4673161e52f45eb6c8efc3ea71939fa">type</a> == <a class="code" href="../../de/d41/DNA__key__types_8h.html#a14061dd054afd472999a4f4f6cdf3923a166121abc12de1fb379b9e6956f45c67">KEY_RELATIVE</a>)
<a name="l00120"></a>00120             <span class="keywordflow">return</span> key;
<a name="l00121"></a>00121     }
<a name="l00122"></a>00122     
<a name="l00123"></a>00123     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00124"></a>00124 }
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 <span class="comment">/* Get data being edited in Action Editor (depending on current &#39;mode&#39;) */</span>
<a name="l00127"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#aabc7c1cb2ad34769234dbd09ff1ccf11">00127</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#aabc7c1cb2ad34769234dbd09ff1ccf11">actedit_get_context</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *saction)
<a name="l00128"></a>00128 {
<a name="l00129"></a>00129     <span class="comment">/* get dopesheet */</span>
<a name="l00130"></a>00130     ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a58e9368e226140c365269be25d531a8c">ads</a> = &amp;saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a37c4236d666d2c560e470fa42794b29f">ads</a>;
<a name="l00131"></a>00131     
<a name="l00132"></a>00132     <span class="comment">/* sync settings with current view status, then return appropriate data */</span>
<a name="l00133"></a>00133     <span class="keywordflow">switch</span> (saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a17207518ba0e0cfef7fd9cd1ad53f5b8">mode</a>) {
<a name="l00134"></a>00134         <span class="keywordflow">case</span> <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#ae1d21c078346359580a781c83f6ab640a1284ead9b0873872740e8b1218463bbe">SACTCONT_ACTION</a>: <span class="comment">/* &#39;Action Editor&#39; */</span>
<a name="l00135"></a>00135             <span class="comment">/* if not pinned, sync with active object */</span>
<a name="l00136"></a>00136             <span class="keywordflow">if</span> (<span class="comment">/*saction-&gt;pin == 0*/</span>1) {
<a name="l00137"></a>00137                 <span class="keywordflow">if</span> (ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6d0f0d003e3cfae207a33813b161f070">obact</a> &amp;&amp; ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6d0f0d003e3cfae207a33813b161f070">obact</a>-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>)
<a name="l00138"></a>00138                     saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a2de9c936aea5ac8a1ced8254c027761c">action</a> = ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6d0f0d003e3cfae207a33813b161f070">obact</a>-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>;
<a name="l00139"></a>00139                 <span class="keywordflow">else</span>
<a name="l00140"></a>00140                     saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a2de9c936aea5ac8a1ced8254c027761c">action</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00141"></a>00141             }
<a name="l00142"></a>00142             
<a name="l00143"></a>00143             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86a7eb4a68e2a084c2412b8ca344b3c8b2a">ANIMCONT_ACTION</a>;
<a name="l00144"></a>00144             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>= saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a2de9c936aea5ac8a1ced8254c027761c">action</a>;
<a name="l00145"></a>00145             
<a name="l00146"></a>00146             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#af17e0d27bcc86683f7590f730123ed1d">mode</a>= saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a17207518ba0e0cfef7fd9cd1ad53f5b8">mode</a>;
<a name="l00147"></a>00147             <span class="keywordflow">return</span> 1;
<a name="l00148"></a>00148             
<a name="l00149"></a>00149         <span class="keywordflow">case</span> <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#ae1d21c078346359580a781c83f6ab640a595af644741730a924d0d4d124eea926">SACTCONT_SHAPEKEY</a>: <span class="comment">/* &#39;ShapeKey Editor&#39; */</span>
<a name="l00150"></a>00150             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86a4d05fa9c8ece8ffc5c5bbed30c8c7de1">ANIMCONT_SHAPEKEY</a>;
<a name="l00151"></a>00151             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>= <a class="code" href="../../dc/d01/anim__filter_8c.html#a369fb66e299a42fc55c60fffc5803ee0">actedit_get_shapekeys</a>(ac);
<a name="l00152"></a>00152             
<a name="l00153"></a>00153             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#af17e0d27bcc86683f7590f730123ed1d">mode</a>= saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a17207518ba0e0cfef7fd9cd1ad53f5b8">mode</a>;
<a name="l00154"></a>00154             <span class="keywordflow">return</span> 1;
<a name="l00155"></a>00155             
<a name="l00156"></a>00156         <span class="keywordflow">case</span> <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#ae1d21c078346359580a781c83f6ab640a095bea5baaccc4e181fa60812282c0d5">SACTCONT_GPENCIL</a>: <span class="comment">/* Grease Pencil */</span> <span class="comment">// XXX review how this mode is handled...</span>
<a name="l00157"></a>00157             <span class="comment">/* update scene-pointer (no need to check for pinning yet, as not implemented) */</span>
<a name="l00158"></a>00158             saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a37c4236d666d2c560e470fa42794b29f">ads</a>.<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l00159"></a>00159             
<a name="l00160"></a>00160             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>;
<a name="l00161"></a>00161             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>= &amp;saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a37c4236d666d2c560e470fa42794b29f">ads</a>;
<a name="l00162"></a>00162             
<a name="l00163"></a>00163             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#af17e0d27bcc86683f7590f730123ed1d">mode</a>= saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a17207518ba0e0cfef7fd9cd1ad53f5b8">mode</a>;
<a name="l00164"></a>00164             <span class="keywordflow">return</span> 1;
<a name="l00165"></a>00165             
<a name="l00166"></a>00166         <span class="keywordflow">case</span> <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#ae1d21c078346359580a781c83f6ab640a4f4f54282a990ada2404fd3f3307bf81">SACTCONT_DOPESHEET</a>: <span class="comment">/* DopeSheet */</span>
<a name="l00167"></a>00167             <span class="comment">/* update scene-pointer (no need to check for pinning yet, as not implemented) */</span>
<a name="l00168"></a>00168             saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a37c4236d666d2c560e470fa42794b29f">ads</a>.<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l00169"></a>00169             
<a name="l00170"></a>00170             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86a740590a7047b0cc256d5102bc12b562b">ANIMCONT_DOPESHEET</a>;
<a name="l00171"></a>00171             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>= &amp;saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a37c4236d666d2c560e470fa42794b29f">ads</a>;
<a name="l00172"></a>00172             
<a name="l00173"></a>00173             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#af17e0d27bcc86683f7590f730123ed1d">mode</a>= saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a17207518ba0e0cfef7fd9cd1ad53f5b8">mode</a>;
<a name="l00174"></a>00174             <span class="keywordflow">return</span> 1;
<a name="l00175"></a>00175         
<a name="l00176"></a>00176         <span class="keywordflow">default</span>: <span class="comment">/* unhandled yet */</span>
<a name="l00177"></a>00177             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86a8a981b2b84d21cadfdfad2e865b66585">ANIMCONT_NONE</a>;
<a name="l00178"></a>00178             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00179"></a>00179             
<a name="l00180"></a>00180             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#af17e0d27bcc86683f7590f730123ed1d">mode</a>= -1;
<a name="l00181"></a>00181             <span class="keywordflow">return</span> 0;
<a name="l00182"></a>00182     }
<a name="l00183"></a>00183 }
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 <span class="comment">/* ----------- Private Stuff - Graph Editor ------------- */</span>
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 <span class="comment">/* Get data being edited in Graph Editor (depending on current &#39;mode&#39;) */</span>
<a name="l00188"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a4c4168d3cc5a98e23f0c02d3e58fa6c0">00188</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#a4c4168d3cc5a98e23f0c02d3e58fa6c0">graphedit_get_context</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *sipo)
<a name="l00189"></a>00189 {
<a name="l00190"></a>00190     <span class="comment">/* init dopesheet data if non-existant (i.e. for old files) */</span>
<a name="l00191"></a>00191     <span class="keywordflow">if</span> (sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a818aa81eeab86ebdc0bfddfa0e508e25">ads</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00192"></a>00192         sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a818aa81eeab86ebdc0bfddfa0e508e25">ads</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a>), <span class="stringliteral">&quot;GraphEdit DopeSheet&quot;</span>);
<a name="l00193"></a>00193         sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a818aa81eeab86ebdc0bfddfa0e508e25">ads</a>-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l00194"></a>00194     }
<a name="l00195"></a>00195     ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a58e9368e226140c365269be25d531a8c">ads</a> = sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a818aa81eeab86ebdc0bfddfa0e508e25">ads</a>;
<a name="l00196"></a>00196     
<a name="l00197"></a>00197     <span class="comment">/* set settings for Graph Editor - &quot;Selected = Editable&quot; */</span>
<a name="l00198"></a>00198     <span class="keywordflow">if</span> (sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#afb3a36cb2d2bf16fbe5787baa810e4ea">flag</a> &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a75dbc29df6b2a8b56cdcb84f336ab97f">SIPO_SELCUVERTSONLY</a>)
<a name="l00199"></a>00199         sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a818aa81eeab86ebdc0bfddfa0e508e25">ads</a>-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> |= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a7ff587ec77ece30ccebaeb2a35b8e364">ADS_FILTER_SELEDIT</a>;
<a name="l00200"></a>00200     <span class="keywordflow">else</span>
<a name="l00201"></a>00201         sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a818aa81eeab86ebdc0bfddfa0e508e25">ads</a>-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp;= ~<a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a7ff587ec77ece30ccebaeb2a35b8e364">ADS_FILTER_SELEDIT</a>;
<a name="l00202"></a>00202     
<a name="l00203"></a>00203     <span class="comment">/* sync settings with current view status, then return appropriate data */</span>
<a name="l00204"></a>00204     <span class="keywordflow">switch</span> (sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#ad04487c00586c56a6162e0b2b90a8153">mode</a>) {
<a name="l00205"></a>00205         <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#ac791b66a82093c303b1b2aaf4f185edeacde4a2e953f13ad3f5ddb3d3514a3719">SIPO_MODE_ANIMATION</a>:   <span class="comment">/* Animation F-Curve Editor */</span>
<a name="l00206"></a>00206             <span class="comment">/* update scene-pointer (no need to check for pinning yet, as not implemented) */</span>
<a name="l00207"></a>00207             sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a818aa81eeab86ebdc0bfddfa0e508e25">ads</a>-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l00208"></a>00208             sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a818aa81eeab86ebdc0bfddfa0e508e25">ads</a>-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp;= ~<a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a7b8e831eaeb26376fb22efa2c8e974d3">ADS_FILTER_ONLYDRIVERS</a>;
<a name="l00209"></a>00209             
<a name="l00210"></a>00210             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86a169cb614b4e7fa42e1b533efe831384b">ANIMCONT_FCURVES</a>;
<a name="l00211"></a>00211             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>= sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a818aa81eeab86ebdc0bfddfa0e508e25">ads</a>;
<a name="l00212"></a>00212             
<a name="l00213"></a>00213             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#af17e0d27bcc86683f7590f730123ed1d">mode</a>= sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#ad04487c00586c56a6162e0b2b90a8153">mode</a>;
<a name="l00214"></a>00214             <span class="keywordflow">return</span> 1;
<a name="l00215"></a>00215         
<a name="l00216"></a>00216         <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#ac791b66a82093c303b1b2aaf4f185edea19e04e65e68aa9dccc6fae6b458f7cf0">SIPO_MODE_DRIVERS</a>:     <span class="comment">/* Driver F-Curve Editor */</span>
<a name="l00217"></a>00217             <span class="comment">/* update scene-pointer (no need to check for pinning yet, as not implemented) */</span>
<a name="l00218"></a>00218             sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a818aa81eeab86ebdc0bfddfa0e508e25">ads</a>-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l00219"></a>00219             sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a818aa81eeab86ebdc0bfddfa0e508e25">ads</a>-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> |= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a7b8e831eaeb26376fb22efa2c8e974d3">ADS_FILTER_ONLYDRIVERS</a>;
<a name="l00220"></a>00220             
<a name="l00221"></a>00221             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86a10adc016c09cd01cd52b00387c91cde1">ANIMCONT_DRIVERS</a>;
<a name="l00222"></a>00222             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>= sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#a818aa81eeab86ebdc0bfddfa0e508e25">ads</a>;
<a name="l00223"></a>00223             
<a name="l00224"></a>00224             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#af17e0d27bcc86683f7590f730123ed1d">mode</a>= sipo-&gt;<a class="code" href="../../d1/d53/structSpaceIpo.html#ad04487c00586c56a6162e0b2b90a8153">mode</a>;
<a name="l00225"></a>00225             <span class="keywordflow">return</span> 1;
<a name="l00226"></a>00226         
<a name="l00227"></a>00227         <span class="keywordflow">default</span>: <span class="comment">/* unhandled yet */</span>
<a name="l00228"></a>00228             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86a8a981b2b84d21cadfdfad2e865b66585">ANIMCONT_NONE</a>;
<a name="l00229"></a>00229             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00230"></a>00230             
<a name="l00231"></a>00231             ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#af17e0d27bcc86683f7590f730123ed1d">mode</a>= -1;
<a name="l00232"></a>00232             <span class="keywordflow">return</span> 0;
<a name="l00233"></a>00233     }
<a name="l00234"></a>00234 }
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 <span class="comment">/* ----------- Private Stuff - NLA Editor ------------- */</span>
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 <span class="comment">/* Get data being edited in Graph Editor (depending on current &#39;mode&#39;) */</span>
<a name="l00239"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#aac710d84aee48dddd0739edeca27e4c0">00239</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#aac710d84aee48dddd0739edeca27e4c0">nlaedit_get_context</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *snla)
<a name="l00240"></a>00240 {
<a name="l00241"></a>00241     <span class="comment">/* init dopesheet data if non-existant (i.e. for old files) */</span>
<a name="l00242"></a>00242     <span class="keywordflow">if</span> (snla-&gt;<a class="code" href="../../de/d91/structSpaceNla.html#af0d67c10fd08eed0458ab0f1bb73c0fc">ads</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00243"></a>00243         snla-&gt;<a class="code" href="../../de/d91/structSpaceNla.html#af0d67c10fd08eed0458ab0f1bb73c0fc">ads</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a>), <span class="stringliteral">&quot;NlaEdit DopeSheet&quot;</span>);
<a name="l00244"></a>00244     ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a58e9368e226140c365269be25d531a8c">ads</a> = snla-&gt;<a class="code" href="../../de/d91/structSpaceNla.html#af0d67c10fd08eed0458ab0f1bb73c0fc">ads</a>;
<a name="l00245"></a>00245     
<a name="l00246"></a>00246     <span class="comment">/* sync settings with current view status, then return appropriate data */</span>
<a name="l00247"></a>00247     <span class="comment">/* update scene-pointer (no need to check for pinning yet, as not implemented) */</span>
<a name="l00248"></a>00248     snla-&gt;<a class="code" href="../../de/d91/structSpaceNla.html#af0d67c10fd08eed0458ab0f1bb73c0fc">ads</a>-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l00249"></a>00249     snla-&gt;<a class="code" href="../../de/d91/structSpaceNla.html#af0d67c10fd08eed0458ab0f1bb73c0fc">ads</a>-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> |= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a6dac19b216a42f4c274e49df4984c30b">ADS_FILTER_ONLYNLA</a>;
<a name="l00250"></a>00250     
<a name="l00251"></a>00251     ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86a35217c089b973b733043b33f6c831c69">ANIMCONT_NLA</a>;
<a name="l00252"></a>00252     ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>= snla-&gt;<a class="code" href="../../de/d91/structSpaceNla.html#af0d67c10fd08eed0458ab0f1bb73c0fc">ads</a>;
<a name="l00253"></a>00253     
<a name="l00254"></a>00254     <span class="keywordflow">return</span> 1;
<a name="l00255"></a>00255 }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257 <span class="comment">/* ----------- Public API --------------- */</span>
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 <span class="comment">/* Obtain current anim-data context, given that context info from Blender context has already been set </span>
<a name="l00260"></a>00260 <span class="comment"> *  - AnimContext to write to is provided as pointer to var on stack so that we don&#39;t have</span>
<a name="l00261"></a>00261 <span class="comment"> *    allocation/freeing costs (which are not that avoidable with channels).</span>
<a name="l00262"></a>00262 <span class="comment"> */</span>
<a name="l00263"></a><a class="code" href="../../df/d6f/ED__anim__api_8h.html#adae2380082b15e638a6b1574b5e0a90c">00263</a> <span class="keywordtype">short</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#adae2380082b15e638a6b1574b5e0a90c">ANIM_animdata_context_getdata</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac)
<a name="l00264"></a>00264 {
<a name="l00265"></a>00265     <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl = ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#ace702244f50216d9ca6d1112f6a45c77">sl</a>;
<a name="l00266"></a>00266     <span class="keywordtype">short</span> ok= 0;
<a name="l00267"></a>00267     
<a name="l00268"></a>00268     <span class="comment">/* context depends on editor we are currently in */</span>
<a name="l00269"></a>00269     <span class="keywordflow">if</span> (sl) {
<a name="l00270"></a>00270         <span class="keywordflow">switch</span> (ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a526ad3411cc520d80945ccd256711f40">spacetype</a>) {
<a name="l00271"></a>00271             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>:
<a name="l00272"></a>00272             {
<a name="l00273"></a>00273                 <a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *saction= (<a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *)sl;
<a name="l00274"></a>00274                 ok= <a class="code" href="../../dc/d01/anim__filter_8c.html#aabc7c1cb2ad34769234dbd09ff1ccf11">actedit_get_context</a>(ac, saction);
<a name="l00275"></a>00275             }
<a name="l00276"></a>00276                 <span class="keywordflow">break</span>;
<a name="l00277"></a>00277                 
<a name="l00278"></a>00278             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca67184420c844bcef0dd50660142cede6">SPACE_IPO</a>:
<a name="l00279"></a>00279             {
<a name="l00280"></a>00280                 <a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *sipo= (<a class="code" href="../../d1/d53/structSpaceIpo.html">SpaceIpo</a> *)sl;
<a name="l00281"></a>00281                 ok= <a class="code" href="../../dc/d01/anim__filter_8c.html#a4c4168d3cc5a98e23f0c02d3e58fa6c0">graphedit_get_context</a>(ac, sipo);
<a name="l00282"></a>00282             }
<a name="l00283"></a>00283                 <span class="keywordflow">break</span>;
<a name="l00284"></a>00284                 
<a name="l00285"></a>00285             <span class="keywordflow">case</span> <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca7b7ea2d973db8086363e148983d6adc0">SPACE_NLA</a>:
<a name="l00286"></a>00286             {
<a name="l00287"></a>00287                 <a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *snla= (<a class="code" href="../../de/d91/structSpaceNla.html">SpaceNla</a> *)sl;
<a name="l00288"></a>00288                 ok= <a class="code" href="../../dc/d01/anim__filter_8c.html#aac710d84aee48dddd0739edeca27e4c0">nlaedit_get_context</a>(ac, snla);
<a name="l00289"></a>00289             }
<a name="l00290"></a>00290                 <span class="keywordflow">break</span>;
<a name="l00291"></a>00291         }
<a name="l00292"></a>00292     }
<a name="l00293"></a>00293     
<a name="l00294"></a>00294     <span class="comment">/* check if there&#39;s any valid data */</span>
<a name="l00295"></a>00295     <span class="keywordflow">if</span> (ok &amp;&amp; ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>)
<a name="l00296"></a>00296         <span class="keywordflow">return</span> 1;
<a name="l00297"></a>00297     <span class="keywordflow">else</span>
<a name="l00298"></a>00298         <span class="keywordflow">return</span> 0;
<a name="l00299"></a>00299 }
<a name="l00300"></a>00300 
<a name="l00301"></a>00301 <span class="comment">/* Obtain current anim-data context from Blender Context info </span>
<a name="l00302"></a>00302 <span class="comment"> *  - AnimContext to write to is provided as pointer to var on stack so that we don&#39;t have</span>
<a name="l00303"></a>00303 <span class="comment"> *    allocation/freeing costs (which are not that avoidable with channels).</span>
<a name="l00304"></a>00304 <span class="comment"> *  - Clears data and sets the information from Blender Context which is useful</span>
<a name="l00305"></a>00305 <span class="comment"> */</span>
<a name="l00306"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">00306</a> <span class="keywordtype">short</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a> (<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac)
<a name="l00307"></a>00307 {
<a name="l00308"></a>00308     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa= <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l00309"></a>00309     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar= <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l00310"></a>00310     <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl= <a class="code" href="../../df/d01/BKE__context_8h.html#ac2755ddf45c6787c6429d5af9b04d809">CTX_wm_space_data</a>(C);
<a name="l00311"></a>00311     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00312"></a>00312     
<a name="l00313"></a>00313     <span class="comment">/* clear old context info */</span>
<a name="l00314"></a>00314     <span class="keywordflow">if</span> (ac == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> 0;
<a name="l00315"></a>00315     memset(ac, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a>));
<a name="l00316"></a>00316     
<a name="l00317"></a>00317     <span class="comment">/* get useful default context settings from context */</span>
<a name="l00318"></a>00318     ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>= scene;
<a name="l00319"></a>00319     <span class="keywordflow">if</span> (scene) {
<a name="l00320"></a>00320         ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a1b0dda891e001c9cff1ffeb3c4032673">markers</a>= <a class="code" href="../../df/d12/anim__markers_8c.html#a7bef9082194e9cafe3525c6adbbb74da">ED_context_get_markers</a>(C);     
<a name="l00321"></a>00321         ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6d0f0d003e3cfae207a33813b161f070">obact</a>= (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a040bbb56eb7746d04c4ae455e5b1c638">basact</a>)?  scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a040bbb56eb7746d04c4ae455e5b1c638">basact</a>-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00322"></a>00322     }
<a name="l00323"></a>00323     ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a52c170a304a44903b1f2e88a24288c4d">sa</a>= sa;
<a name="l00324"></a>00324     ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a542e00138258c6836666296f30e0c2c0">ar</a>= ar;
<a name="l00325"></a>00325     ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#ace702244f50216d9ca6d1112f6a45c77">sl</a>= sl;
<a name="l00326"></a>00326     ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a526ad3411cc520d80945ccd256711f40">spacetype</a>= (sa) ? sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a124203529b9ea4c84ca8f8ae4efff3e3">spacetype</a> : 0;
<a name="l00327"></a>00327     ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a969367ff5d69868cc64107ceb5735b37">regiontype</a>= (ar) ? ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> : 0;
<a name="l00328"></a>00328     
<a name="l00329"></a>00329     <span class="comment">/* get data context info */</span>
<a name="l00330"></a>00330     <span class="keywordflow">return</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#adae2380082b15e638a6b1574b5e0a90c">ANIM_animdata_context_getdata</a>(ac);
<a name="l00331"></a>00331 }
<a name="l00332"></a>00332 
<a name="l00333"></a>00333 <span class="comment">/* ************************************************************ */</span>
<a name="l00334"></a>00334 <span class="comment">/* Blender Data &lt;-- Filter --&gt; Channels to be operated on */</span>
<a name="l00335"></a>00335 
<a name="l00336"></a>00336 <span class="comment">/* macros to use before/after getting the sub-channels of some channel,</span>
<a name="l00337"></a>00337 <span class="comment"> * to abstract away some of the tricky logic involved</span>
<a name="l00338"></a>00338 <span class="comment"> *</span>
<a name="l00339"></a>00339 <span class="comment"> * cases:</span>
<a name="l00340"></a>00340 <span class="comment"> *  1) Graph Edit main area (just data) OR channels visible in Channel List</span>
<a name="l00341"></a>00341 <span class="comment"> *  2) If not showing channels, we&#39;re only interested in the data (Action Editor&#39;s editing)</span>
<a name="l00342"></a>00342 <span class="comment"> *  3) We don&#39;t care what data, we just care there is some (so that a collapsed </span>
<a name="l00343"></a>00343 <span class="comment"> *     channel can be kept around). No need to clear channels-flag in order to </span>
<a name="l00344"></a>00344 <span class="comment"> *     keep expander channels with no sub-data out, as those cases should get</span>
<a name="l00345"></a>00345 <span class="comment"> *     dealt with by the recursive detection idiom in place.</span>
<a name="l00346"></a>00346 <span class="comment"> *</span>
<a name="l00347"></a>00347 <span class="comment"> * Implementation Note:</span>
<a name="l00348"></a>00348 <span class="comment"> *  YES the _doSubChannels variable is NOT read anywhere. BUT, this is NOT an excuse</span>
<a name="l00349"></a>00349 <span class="comment"> *  to go steamrolling the logic into a single-line expression as from experience,</span>
<a name="l00350"></a>00350 <span class="comment"> *  those are notoriously difficult to read + debug when extending later on. The code</span>
<a name="l00351"></a>00351 <span class="comment"> *  below is purposefully laid out so that each case noted above corresponds clearly to</span>
<a name="l00352"></a>00352 <span class="comment"> *  one case below.</span>
<a name="l00353"></a>00353 <span class="comment"> */</span>
<a name="l00354"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#ae1e5765ef9b93a06463e6937bcf631e3">00354</a> <span class="preprocessor">#define BEGIN_ANIMFILTER_SUBCHANNELS(expanded_check) \</span>
<a name="l00355"></a>00355 <span class="preprocessor">    { \</span>
<a name="l00356"></a>00356 <span class="preprocessor">        int _filter = filter_mode; \</span>
<a name="l00357"></a>00357 <span class="preprocessor">        short _doSubChannels = 0; \</span>
<a name="l00358"></a>00358 <span class="preprocessor">        if (!(filter_mode &amp; ANIMFILTER_LIST_VISIBLE) || (expanded_check)) \</span>
<a name="l00359"></a>00359 <span class="preprocessor">            _doSubChannels=1; \</span>
<a name="l00360"></a>00360 <span class="preprocessor">        else if (!(filter_mode &amp; ANIMFILTER_LIST_CHANNELS)) \</span>
<a name="l00361"></a>00361 <span class="preprocessor">            _doSubChannels=2; \</span>
<a name="l00362"></a>00362 <span class="preprocessor">        else {\</span>
<a name="l00363"></a>00363 <span class="preprocessor">            filter_mode |= ANIMFILTER_TMP_PEEK; \</span>
<a name="l00364"></a>00364 <span class="preprocessor">        } \</span>
<a name="l00365"></a>00365 <span class="preprocessor">          \</span>
<a name="l00366"></a>00366 <span class="preprocessor">        { \</span>
<a name="l00367"></a>00367 <span class="preprocessor">            (void) _doSubChannels; \</span>
<a name="l00368"></a>00368 <span class="preprocessor">        }</span>
<a name="l00369"></a>00369 <span class="preprocessor"></span>        <span class="comment">/* ... standard sub-channel filtering can go on here now ... */</span>
<a name="l00370"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#ac3825ee442a35f775be20ca19a4177cb">00370</a> <span class="preprocessor">#define END_ANIMFILTER_SUBCHANNELS \</span>
<a name="l00371"></a>00371 <span class="preprocessor">        filter_mode = _filter; \</span>
<a name="l00372"></a>00372 <span class="preprocessor">    }</span>
<a name="l00373"></a>00373 <span class="preprocessor"></span>
<a name="l00374"></a>00374 <span class="comment">/* ............................... */</span>
<a name="l00375"></a>00375 
<a name="l00376"></a>00376 <span class="comment">/* quick macro to test if AnimData is usable */</span>
<a name="l00377"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a3eabd62ec912a41e3303b0efe3b3a6df">00377</a> <span class="preprocessor">#define ANIMDATA_HAS_KEYS(id) ((id)-&gt;adt &amp;&amp; (id)-&gt;adt-&gt;action)</span>
<a name="l00378"></a>00378 <span class="preprocessor"></span>
<a name="l00379"></a>00379 <span class="comment">/* quick macro to test if AnimData is usable for drivers */</span>
<a name="l00380"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a41815d63af690fe7904723df517460b2">00380</a> <span class="preprocessor">#define ANIMDATA_HAS_DRIVERS(id) ((id)-&gt;adt &amp;&amp; (id)-&gt;adt-&gt;drivers.first)</span>
<a name="l00381"></a>00381 <span class="preprocessor"></span>
<a name="l00382"></a>00382 <span class="comment">/* quick macro to test if AnimData is usable for NLA */</span>
<a name="l00383"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#af7849abf733bd007090242acb65d36d1">00383</a> <span class="preprocessor">#define ANIMDATA_HAS_NLA(id) ((id)-&gt;adt &amp;&amp; (id)-&gt;adt-&gt;nla_tracks.first)</span>
<a name="l00384"></a>00384 <span class="preprocessor"></span>
<a name="l00385"></a>00385 <span class="comment">/* Quick macro to test for all three above usability tests, performing the appropriate provided </span>
<a name="l00386"></a>00386 <span class="comment"> * action for each when the AnimData context is appropriate. </span>
<a name="l00387"></a>00387 <span class="comment"> *</span>
<a name="l00388"></a>00388 <span class="comment"> * Priority order for this goes (most important, to least): AnimData blocks, NLA, Drivers, Keyframes.</span>
<a name="l00389"></a>00389 <span class="comment"> *</span>
<a name="l00390"></a>00390 <span class="comment"> * For this to work correctly, a standard set of data needs to be available within the scope that this</span>
<a name="l00391"></a>00391 <span class="comment"> * gets called in: </span>
<a name="l00392"></a>00392 <span class="comment"> *  - ListBase anim_data;</span>
<a name="l00393"></a>00393 <span class="comment"> *  - bDopeSheet *ads;</span>
<a name="l00394"></a>00394 <span class="comment"> *  - bAnimListElem *ale;</span>
<a name="l00395"></a>00395 <span class="comment"> *  - size_t items;</span>
<a name="l00396"></a>00396 <span class="comment"> *</span>
<a name="l00397"></a>00397 <span class="comment"> *  - id: ID block which should have an AnimData pointer following it immediately, to use</span>
<a name="l00398"></a>00398 <span class="comment"> *  - adtOk: line or block of code to execute for AnimData-blocks case (usually ANIMDATA_ADD_ANIMDATA)</span>
<a name="l00399"></a>00399 <span class="comment"> *  - nlaOk: line or block of code to execute for NLA tracks+strips case</span>
<a name="l00400"></a>00400 <span class="comment"> *  - driversOk: line or block of code to execute for Drivers case</span>
<a name="l00401"></a>00401 <span class="comment"> *  - keysOk: line or block of code for Keyframes case</span>
<a name="l00402"></a>00402 <span class="comment"> *</span>
<a name="l00403"></a>00403 <span class="comment"> * The checks for the various cases are as follows:</span>
<a name="l00404"></a>00404 <span class="comment"> *  0) top level: checks for animdata and also that all the F-Curves for the block will be visible</span>
<a name="l00405"></a>00405 <span class="comment"> *  1) animdata check: for filtering animdata blocks only</span>
<a name="l00406"></a>00406 <span class="comment"> *  2A) nla tracks: include animdata block&#39;s data as there are NLA tracks+strips there</span>
<a name="l00407"></a>00407 <span class="comment"> *  2B) actions to convert to nla: include animdata block&#39;s data as there is an action that can be </span>
<a name="l00408"></a>00408 <span class="comment"> *      converted to a new NLA strip, and the filtering options allow this</span>
<a name="l00409"></a>00409 <span class="comment"> *  2C) allow non-animated datablocks to be included so that datablocks can be added</span>
<a name="l00410"></a>00410 <span class="comment"> *  3) drivers: include drivers from animdata block (for Drivers mode in Graph Editor)</span>
<a name="l00411"></a>00411 <span class="comment"> *  4) normal keyframes: only when there is an active action</span>
<a name="l00412"></a>00412 <span class="comment"> */</span>
<a name="l00413"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a6b431d984d5d233b2a81aeb18a24e1fe">00413</a> <span class="preprocessor">#define ANIMDATA_FILTER_CASES(id, adtOk, nlaOk, driversOk, keysOk) \</span>
<a name="l00414"></a>00414 <span class="preprocessor">    {\</span>
<a name="l00415"></a>00415 <span class="preprocessor">        if ((id)-&gt;adt) {\</span>
<a name="l00416"></a>00416 <span class="preprocessor">            if (!(filter_mode &amp; ANIMFILTER_CURVE_VISIBLE) || !((id)-&gt;adt-&gt;flag &amp; ADT_CURVES_NOT_VISIBLE)) {\</span>
<a name="l00417"></a>00417 <span class="preprocessor">                if (filter_mode &amp; ANIMFILTER_ANIMDATA) {\</span>
<a name="l00418"></a>00418 <span class="preprocessor">                    adtOk\</span>
<a name="l00419"></a>00419 <span class="preprocessor">                }\</span>
<a name="l00420"></a>00420 <span class="preprocessor">                else if (ads-&gt;filterflag &amp; ADS_FILTER_ONLYNLA) {\</span>
<a name="l00421"></a>00421 <span class="preprocessor">                    if (ANIMDATA_HAS_NLA(id)) {\</span>
<a name="l00422"></a>00422 <span class="preprocessor">                        nlaOk\</span>
<a name="l00423"></a>00423 <span class="preprocessor">                    }\</span>
<a name="l00424"></a>00424 <span class="preprocessor">                    else if (!(ads-&gt;filterflag &amp; ADS_FILTER_NLA_NOACT) &amp;&amp; ANIMDATA_HAS_KEYS(id)) {\</span>
<a name="l00425"></a>00425 <span class="preprocessor">                        nlaOk\</span>
<a name="l00426"></a>00426 <span class="preprocessor">                    }\</span>
<a name="l00427"></a>00427 <span class="preprocessor">                }\</span>
<a name="l00428"></a>00428 <span class="preprocessor">                else if (ads-&gt;filterflag &amp; ADS_FILTER_ONLYDRIVERS) {\</span>
<a name="l00429"></a>00429 <span class="preprocessor">                    if (ANIMDATA_HAS_DRIVERS(id)) {\</span>
<a name="l00430"></a>00430 <span class="preprocessor">                        driversOk\</span>
<a name="l00431"></a>00431 <span class="preprocessor">                    }\</span>
<a name="l00432"></a>00432 <span class="preprocessor">                }\</span>
<a name="l00433"></a>00433 <span class="preprocessor">                else {\</span>
<a name="l00434"></a>00434 <span class="preprocessor">                    if (ANIMDATA_HAS_KEYS(id)) {\</span>
<a name="l00435"></a>00435 <span class="preprocessor">                        keysOk\</span>
<a name="l00436"></a>00436 <span class="preprocessor">                    }\</span>
<a name="l00437"></a>00437 <span class="preprocessor">                }\</span>
<a name="l00438"></a>00438 <span class="preprocessor">            }\</span>
<a name="l00439"></a>00439 <span class="preprocessor">        }\</span>
<a name="l00440"></a>00440 <span class="preprocessor">    }</span>
<a name="l00441"></a>00441 <span class="preprocessor"></span>
<a name="l00442"></a>00442 <span class="comment">/* ............................... */</span>
<a name="l00443"></a>00443 
<a name="l00444"></a>00444 <span class="comment">/* Add a new animation channel, taking into account the &quot;peek&quot; flag, which is used to just check </span>
<a name="l00445"></a>00445 <span class="comment"> * whether any channels will be added (but without needing them to actually get created).</span>
<a name="l00446"></a>00446 <span class="comment"> *</span>
<a name="l00447"></a>00447 <span class="comment"> * ! This causes the calling function to return early if we&#39;re only &quot;peeking&quot; for channels</span>
<a name="l00448"></a>00448 <span class="comment"> */</span>
<a name="l00449"></a>00449 <span class="comment">// XXX: ale_statement stuff is really a hack for one special case. It shouldn&#39;t really be needed...</span>
<a name="l00450"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a80616751bed5824ffc02f601e29742b4">00450</a> <span class="preprocessor">#define ANIMCHANNEL_NEW_CHANNEL_FULL(channel_data, channel_type, owner_id, ale_statement) \</span>
<a name="l00451"></a>00451 <span class="preprocessor">    if (filter_mode &amp; ANIMFILTER_TMP_PEEK) \</span>
<a name="l00452"></a>00452 <span class="preprocessor">        return 1; \</span>
<a name="l00453"></a>00453 <span class="preprocessor">    else { \</span>
<a name="l00454"></a>00454 <span class="preprocessor">        bAnimListElem *ale= make_new_animlistelem(channel_data, channel_type, (ID *)owner_id); \</span>
<a name="l00455"></a>00455 <span class="preprocessor">        if (ale) {\</span>
<a name="l00456"></a>00456 <span class="preprocessor">            BLI_addtail(anim_data, ale); \</span>
<a name="l00457"></a>00457 <span class="preprocessor">            items++; \</span>
<a name="l00458"></a>00458 <span class="preprocessor">            ale_statement \</span>
<a name="l00459"></a>00459 <span class="preprocessor">        } \</span>
<a name="l00460"></a>00460 <span class="preprocessor">    }</span>
<a name="l00461"></a>00461 <span class="preprocessor"></span>    
<a name="l00462"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">00462</a> <span class="preprocessor">#define ANIMCHANNEL_NEW_CHANNEL(channel_data, channel_type, owner_id) \</span>
<a name="l00463"></a>00463 <span class="preprocessor">    ANIMCHANNEL_NEW_CHANNEL_FULL(channel_data, channel_type, owner_id, {})</span>
<a name="l00464"></a>00464 <span class="preprocessor"></span>    
<a name="l00465"></a>00465 <span class="comment">/* ............................... */</span>
<a name="l00466"></a>00466     
<a name="l00467"></a>00467 <span class="comment">/* quick macro to test if an anim-channel representing an AnimData block is suitably active */</span>
<a name="l00468"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a63183ed1f39a32b7df70adbb9ff1f000">00468</a> <span class="preprocessor">#define ANIMCHANNEL_ACTIVEOK(ale) \</span>
<a name="l00469"></a>00469 <span class="preprocessor">    ( !(filter_mode &amp; ANIMFILTER_ACTIVE) || !(ale-&gt;adt) || (ale-&gt;adt-&gt;flag &amp; ADT_UI_ACTIVE) )</span>
<a name="l00470"></a>00470 <span class="preprocessor"></span>
<a name="l00471"></a>00471 <span class="comment">/* quick macro to test if an anim-channel (F-Curve, Group, etc.) is selected in an acceptable way */</span>
<a name="l00472"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a2806079ca9241a2778c90f7fe033e5b3">00472</a> <span class="preprocessor">#define ANIMCHANNEL_SELOK(test_func) \</span>
<a name="l00473"></a>00473 <span class="preprocessor">        ( !(filter_mode &amp; (ANIMFILTER_SEL|ANIMFILTER_UNSEL)) || \</span>
<a name="l00474"></a>00474 <span class="preprocessor">          ((filter_mode &amp; ANIMFILTER_SEL) &amp;&amp; test_func) || \</span>
<a name="l00475"></a>00475 <span class="preprocessor">          ((filter_mode &amp; ANIMFILTER_UNSEL) &amp;&amp; test_func==0) ) </span>
<a name="l00476"></a>00476 <span class="preprocessor"></span>          
<a name="l00477"></a>00477 <span class="comment">/* quick macro to test if an anim-channel (F-Curve) is selected ok for editing purposes </span>
<a name="l00478"></a>00478 <span class="comment"> *  - _SELEDIT means that only selected curves will have visible+editable keyframes</span>
<a name="l00479"></a>00479 <span class="comment"> *</span>
<a name="l00480"></a>00480 <span class="comment"> * checks here work as follows:</span>
<a name="l00481"></a>00481 <span class="comment"> *  1) seledit off - don&#39;t need to consider the implications of this option</span>
<a name="l00482"></a>00482 <span class="comment"> *  2) foredit off - we&#39;re not considering editing, so channel is ok still</span>
<a name="l00483"></a>00483 <span class="comment"> *  3) test_func (i.e. selection test) - only if selected, this test will pass</span>
<a name="l00484"></a>00484 <span class="comment"> */</span>
<a name="l00485"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#afda08085fef26fc7762c83dded512bc8">00485</a> <span class="preprocessor">#define ANIMCHANNEL_SELEDITOK(test_func) \</span>
<a name="l00486"></a>00486 <span class="preprocessor">        ( !(filter_mode &amp; ANIMFILTER_SELEDIT) || \</span>
<a name="l00487"></a>00487 <span class="preprocessor">          !(filter_mode &amp; ANIMFILTER_FOREDIT) || \</span>
<a name="l00488"></a>00488 <span class="preprocessor">          (test_func) )</span>
<a name="l00489"></a>00489 <span class="preprocessor"></span>
<a name="l00490"></a>00490 <span class="comment">/* ----------- &#39;Private&#39; Stuff --------------- */</span>
<a name="l00491"></a>00491 
<a name="l00492"></a>00492 <span class="comment">/* this function allocates memory for a new bAnimListElem struct for the </span>
<a name="l00493"></a>00493 <span class="comment"> * provided animation channel-data. </span>
<a name="l00494"></a>00494 <span class="comment"> */</span>
<a name="l00495"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#aff7936398344cab2fe37f40fbf434f48">00495</a> <span class="keyword">static</span> <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *<a class="code" href="../../dc/d01/anim__filter_8c.html#aff7936398344cab2fe37f40fbf434f48">make_new_animlistelem</a> (<span class="keywordtype">void</span> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">short</span> datatype, <a class="code" href="../../d8/d7e/structID.html">ID</a> *owner_id)
<a name="l00496"></a>00496 {
<a name="l00497"></a>00497     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00498"></a>00498     
<a name="l00499"></a>00499     <span class="comment">/* only allocate memory if there is data to convert */</span>
<a name="l00500"></a>00500     <span class="keywordflow">if</span> (data) {
<a name="l00501"></a>00501         <span class="comment">/* allocate and set generic data */</span>
<a name="l00502"></a>00502         ale= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a>), <span class="stringliteral">&quot;bAnimListElem&quot;</span>);
<a name="l00503"></a>00503         
<a name="l00504"></a>00504         ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>= <a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>;
<a name="l00505"></a>00505         ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a>= datatype;
<a name="l00506"></a>00506         
<a name="l00507"></a>00507         ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ad2686a20c9c11e9889e3f4d9a60b8b8c">id</a>= owner_id;
<a name="l00508"></a>00508         ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(owner_id);
<a name="l00509"></a>00509         
<a name="l00510"></a>00510         <span class="comment">/* do specifics */</span>
<a name="l00511"></a>00511         <span class="keywordflow">switch</span> (datatype) {
<a name="l00512"></a>00512             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a1ec0c4967d46aaf6b87c893c81221ed4">ANIMTYPE_SUMMARY</a>:
<a name="l00513"></a>00513             {
<a name="l00514"></a>00514                 <span class="comment">/* nothing to include for now... this is just a dummy wrappy around all the other channels </span>
<a name="l00515"></a>00515 <span class="comment">                 * in the DopeSheet, and gets included at the start of the list</span>
<a name="l00516"></a>00516 <span class="comment">                 */</span>
<a name="l00517"></a>00517                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00518"></a>00518                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85aa2d55329bc607873bc513fca9cbdccd8">ALE_ALL</a>;
<a name="l00519"></a>00519             }
<a name="l00520"></a>00520                 <span class="keywordflow">break</span>;
<a name="l00521"></a>00521             
<a name="l00522"></a>00522             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a6beea10df4db5286f40a857d7d837f17">ANIMTYPE_SCENE</a>:
<a name="l00523"></a>00523             {
<a name="l00524"></a>00524                 <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce= (<a class="code" href="../../d9/d27/structScene.html">Scene</a> *)data;
<a name="l00525"></a>00525                 
<a name="l00526"></a>00526                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a60b2a18bedc706447c394de96c276eac">flag</a>;
<a name="l00527"></a>00527                 
<a name="l00528"></a>00528                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= sce;
<a name="l00529"></a>00529                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85a2e534455c996f92c6e4c07f747001038">ALE_SCE</a>;
<a name="l00530"></a>00530                 
<a name="l00531"></a>00531                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(data);
<a name="l00532"></a>00532             }
<a name="l00533"></a>00533                 <span class="keywordflow">break</span>;
<a name="l00534"></a>00534             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7ae2343c6cd206c77f666c41a9fdd2d9b5">ANIMTYPE_OBJECT</a>:
<a name="l00535"></a>00535             {
<a name="l00536"></a>00536                 <a class="code" href="../../d3/da9/structBase.html">Base</a> *base= (<a class="code" href="../../d3/da9/structBase.html">Base</a> *)data;
<a name="l00537"></a>00537                 <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l00538"></a>00538                 
<a name="l00539"></a>00539                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a>;
<a name="l00540"></a>00540                 
<a name="l00541"></a>00541                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= ob;
<a name="l00542"></a>00542                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85adfd4f425b01285d4b196357e67b805b0">ALE_OB</a>;
<a name="l00543"></a>00543                 
<a name="l00544"></a>00544                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>);
<a name="l00545"></a>00545             }
<a name="l00546"></a>00546                 <span class="keywordflow">break</span>;
<a name="l00547"></a>00547             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7ae004aa0b2b14ed418ddbd4891b2d22cb">ANIMTYPE_FILLACTD</a>:
<a name="l00548"></a>00548             {
<a name="l00549"></a>00549                 <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *act= (<a class="code" href="../../d1/d48/structbAction.html">bAction</a> *)data;
<a name="l00550"></a>00550                 
<a name="l00551"></a>00551                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ae61dc79aac883d6f6a8d84ae12a11352">flag</a>;
<a name="l00552"></a>00552                 
<a name="l00553"></a>00553                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= act;
<a name="l00554"></a>00554                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85ac1aa151cfcc7fa642d7c4c2fca27855b">ALE_ACT</a>;
<a name="l00555"></a>00555             }
<a name="l00556"></a>00556                 <span class="keywordflow">break</span>;
<a name="l00557"></a>00557             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a41dfdec97398e8a5738316456bd87fc8">ANIMTYPE_FILLDRIVERS</a>:
<a name="l00558"></a>00558             {
<a name="l00559"></a>00559                 <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= (<a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *)data;
<a name="l00560"></a>00560                 
<a name="l00561"></a>00561                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a057740ebd2ecdddb141073b0f2e0f441">flag</a>;
<a name="l00562"></a>00562                 
<a name="l00563"></a>00563                     <span class="comment">// XXX... drivers don&#39;t show summary for now</span>
<a name="l00564"></a>00564                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00565"></a>00565                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85a4b51dc5b765a5a537ab4fd8d797a6b9d">ALE_NONE</a>;
<a name="l00566"></a>00566             }
<a name="l00567"></a>00567                 <span class="keywordflow">break</span>;
<a name="l00568"></a>00568             
<a name="l00569"></a>00569             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7abb4cbd3d37ed9541439fd5b05540b044">ANIMTYPE_DSMAT</a>:
<a name="l00570"></a>00570             {
<a name="l00571"></a>00571                 <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma= (<a class="code" href="../../d2/d10/structMaterial.html">Material</a> *)data;
<a name="l00572"></a>00572                 <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#abd1e09497ddf15bd6b49b0bc31ce3e42">adt</a>;
<a name="l00573"></a>00573                 
<a name="l00574"></a>00574                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a977021b2d018a354ce438c7349d8ee9b">FILTER_MAT_OBJD</a>(ma);
<a name="l00575"></a>00575                 
<a name="l00576"></a>00576                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= (adt) ? adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00577"></a>00577                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85ac1aa151cfcc7fa642d7c4c2fca27855b">ALE_ACT</a>;
<a name="l00578"></a>00578                 
<a name="l00579"></a>00579                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(data);
<a name="l00580"></a>00580             }
<a name="l00581"></a>00581                 <span class="keywordflow">break</span>;
<a name="l00582"></a>00582             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7ac42c61fbe171c491c54180bef0fc5cf8">ANIMTYPE_DSLAM</a>:
<a name="l00583"></a>00583             {
<a name="l00584"></a>00584                 <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la= (<a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *)data;
<a name="l00585"></a>00585                 <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6f57eb2f6f8da5eff909039d9188c0b1">adt</a>;
<a name="l00586"></a>00586                 
<a name="l00587"></a>00587                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a77b905fd3bc80c53aa99feee0833e581">FILTER_LAM_OBJD</a>(la);
<a name="l00588"></a>00588                 
<a name="l00589"></a>00589                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= (adt) ? adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00590"></a>00590                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85ac1aa151cfcc7fa642d7c4c2fca27855b">ALE_ACT</a>;
<a name="l00591"></a>00591                 
<a name="l00592"></a>00592                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(data);
<a name="l00593"></a>00593             }
<a name="l00594"></a>00594                 <span class="keywordflow">break</span>;
<a name="l00595"></a>00595             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a3a14d52a78f88fdc99a2d956f16fa188">ANIMTYPE_DSCAM</a>:
<a name="l00596"></a>00596             {
<a name="l00597"></a>00597                 <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *ca= (<a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *)data;
<a name="l00598"></a>00598                 <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= ca-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ac2cb75a787d0924ce330394fe4bfb2c4">adt</a>;
<a name="l00599"></a>00599                 
<a name="l00600"></a>00600                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a6827042bd3ecfbd33721beedd214e969">FILTER_CAM_OBJD</a>(ca);
<a name="l00601"></a>00601                 
<a name="l00602"></a>00602                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= (adt) ? adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00603"></a>00603                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85ac1aa151cfcc7fa642d7c4c2fca27855b">ALE_ACT</a>;
<a name="l00604"></a>00604                 
<a name="l00605"></a>00605                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(data);
<a name="l00606"></a>00606             }
<a name="l00607"></a>00607                 <span class="keywordflow">break</span>;
<a name="l00608"></a>00608             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a6526464e0e40895c1585a00c7abff018">ANIMTYPE_DSCUR</a>:
<a name="l00609"></a>00609             {
<a name="l00610"></a>00610                 <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= (<a class="code" href="../../da/d10/structCurve.html">Curve</a> *)data;
<a name="l00611"></a>00611                 <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= cu-&gt;<a class="code" href="../../da/d10/structCurve.html#a43b677aa65b1d464d8e338afe597db66">adt</a>;
<a name="l00612"></a>00612                 
<a name="l00613"></a>00613                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a94c00c66f4a1cb5e177304d06a206ea2">FILTER_CUR_OBJD</a>(cu);
<a name="l00614"></a>00614                 
<a name="l00615"></a>00615                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= (adt) ? adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00616"></a>00616                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85ac1aa151cfcc7fa642d7c4c2fca27855b">ALE_ACT</a>;
<a name="l00617"></a>00617                 
<a name="l00618"></a>00618                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(data);
<a name="l00619"></a>00619             }
<a name="l00620"></a>00620                 <span class="keywordflow">break</span>;
<a name="l00621"></a>00621             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a6d14d789723bb8719a0c28003b003391">ANIMTYPE_DSARM</a>:
<a name="l00622"></a>00622             {
<a name="l00623"></a>00623                 <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm= (<a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *)data;
<a name="l00624"></a>00624                 <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#a3da4410a3e26839cd1a675b0fe1f52d2">adt</a>;
<a name="l00625"></a>00625                 
<a name="l00626"></a>00626                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a47d798523a6e403dc6e5bb25db0b2448">FILTER_ARM_OBJD</a>(arm);
<a name="l00627"></a>00627                 
<a name="l00628"></a>00628                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= (adt) ? adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00629"></a>00629                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85ac1aa151cfcc7fa642d7c4c2fca27855b">ALE_ACT</a>;
<a name="l00630"></a>00630                 
<a name="l00631"></a>00631                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(data);
<a name="l00632"></a>00632             }
<a name="l00633"></a>00633                 <span class="keywordflow">break</span>;
<a name="l00634"></a>00634             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7ae35d2cc8157449ed0d3ef9e3b84d1a51">ANIMTYPE_DSMESH</a>:
<a name="l00635"></a>00635             {
<a name="l00636"></a>00636                 <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me= (<a class="code" href="../../da/d29/structMesh.html">Mesh</a> *)data;
<a name="l00637"></a>00637                 <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= me-&gt;<a class="code" href="../../da/d29/structMesh.html#a4f2d54305057ef6e0615135a03b6dedf">adt</a>;
<a name="l00638"></a>00638                 
<a name="l00639"></a>00639                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a301c6d53edfe18a1c994b21938537e5a">FILTER_MESH_OBJD</a>(me);
<a name="l00640"></a>00640                 
<a name="l00641"></a>00641                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= (adt) ? adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00642"></a>00642                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85ac1aa151cfcc7fa642d7c4c2fca27855b">ALE_ACT</a>;
<a name="l00643"></a>00643                 
<a name="l00644"></a>00644                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(data);
<a name="l00645"></a>00645             }
<a name="l00646"></a>00646                 <span class="keywordflow">break</span>;
<a name="l00647"></a>00647             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a9b80577b1b18330f5b088065fe739a85">ANIMTYPE_DSLAT</a>:
<a name="l00648"></a>00648             {
<a name="l00649"></a>00649                 <a class="code" href="../../dd/d40/structLattice.html">Lattice</a> *lt= (<a class="code" href="../../dd/d40/structLattice.html">Lattice</a> *)data;
<a name="l00650"></a>00650                 <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= lt-&gt;<a class="code" href="../../dd/d40/structLattice.html#aefdb803caabd9962f7781773e027992e">adt</a>;
<a name="l00651"></a>00651                 
<a name="l00652"></a>00652                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a6cbb744b165f2c759f04591ea96ee7e4">FILTER_LATTICE_OBJD</a>(lt);
<a name="l00653"></a>00653                 
<a name="l00654"></a>00654                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= (adt) ? adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00655"></a>00655                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85ac1aa151cfcc7fa642d7c4c2fca27855b">ALE_ACT</a>;
<a name="l00656"></a>00656                 
<a name="l00657"></a>00657                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(data);
<a name="l00658"></a>00658             }   
<a name="l00659"></a>00659                 <span class="keywordflow">break</span>;
<a name="l00660"></a>00660             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a185201d27a1b9e1435c1b0f0542ecef2">ANIMTYPE_DSSPK</a>:
<a name="l00661"></a>00661             {
<a name="l00662"></a>00662                 <a class="code" href="../../d0/d89/structSpeaker.html">Speaker</a> *spk= (<a class="code" href="../../d0/d89/structSpeaker.html">Speaker</a> *)data;
<a name="l00663"></a>00663                 <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= spk-&gt;<a class="code" href="../../d0/d89/structSpeaker.html#a2da8956b59cff6870ca337c0440d10a6">adt</a>;
<a name="l00664"></a>00664 
<a name="l00665"></a>00665                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a06aeb4e13a927d820d73bdbc4fd952de">FILTER_SPK_OBJD</a>(spk);
<a name="l00666"></a>00666 
<a name="l00667"></a>00667                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= (adt) ? adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00668"></a>00668                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85ac1aa151cfcc7fa642d7c4c2fca27855b">ALE_ACT</a>;
<a name="l00669"></a>00669 
<a name="l00670"></a>00670                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(data);
<a name="l00671"></a>00671             }
<a name="l00672"></a>00672                 <span class="keywordflow">break</span>;
<a name="l00673"></a>00673             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7af951f114f33bfd02d3c5a7a5da9f2dd1">ANIMTYPE_DSSKEY</a>:
<a name="l00674"></a>00674             {
<a name="l00675"></a>00675                 <a class="code" href="../../d1/d9e/structKey.html">Key</a> *key= (<a class="code" href="../../d1/d9e/structKey.html">Key</a> *)data;
<a name="l00676"></a>00676                 <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a9e6219935b7f5b387610055b81705180">adt</a>;
<a name="l00677"></a>00677                 
<a name="l00678"></a>00678                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a30006fa688daffe3c7d0872e5e07fc3d">FILTER_SKE_OBJD</a>(key); 
<a name="l00679"></a>00679                 
<a name="l00680"></a>00680                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= (adt) ? adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00681"></a>00681                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85ac1aa151cfcc7fa642d7c4c2fca27855b">ALE_ACT</a>;
<a name="l00682"></a>00682                 
<a name="l00683"></a>00683                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(data);
<a name="l00684"></a>00684             }
<a name="l00685"></a>00685                 <span class="keywordflow">break</span>;
<a name="l00686"></a>00686             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7af662c20f337a08ea34f7e1e95a8e82c9">ANIMTYPE_DSWOR</a>:
<a name="l00687"></a>00687             {
<a name="l00688"></a>00688                 <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wo= (<a class="code" href="../../d7/d3f/structWorld.html">World</a> *)data;
<a name="l00689"></a>00689                 <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a72f1ac7ad0412174afba2f873d70aa36">adt</a>;
<a name="l00690"></a>00690                 
<a name="l00691"></a>00691                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aa1b36088cebbbc332f4fa13a165c0aa2">FILTER_WOR_SCED</a>(wo); 
<a name="l00692"></a>00692                 
<a name="l00693"></a>00693                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= (adt) ? adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00694"></a>00694                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85ac1aa151cfcc7fa642d7c4c2fca27855b">ALE_ACT</a>;
<a name="l00695"></a>00695                 
<a name="l00696"></a>00696                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(data);
<a name="l00697"></a>00697             }
<a name="l00698"></a>00698                 <span class="keywordflow">break</span>;
<a name="l00699"></a>00699             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a302851307dd74cd1fedb1861788af804">ANIMTYPE_DSNTREE</a>:
<a name="l00700"></a>00700             {
<a name="l00701"></a>00701                 <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree= (<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *)data;
<a name="l00702"></a>00702                 <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#af6b8d484e7c71deb7a35e939800d54b5">adt</a>;
<a name="l00703"></a>00703                 
<a name="l00704"></a>00704                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a276cf6239ce15e45c76186dd6ed8d1cd">FILTER_NTREE_DATA</a>(ntree); 
<a name="l00705"></a>00705                 
<a name="l00706"></a>00706                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= (adt) ? adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00707"></a>00707                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85ac1aa151cfcc7fa642d7c4c2fca27855b">ALE_ACT</a>;
<a name="l00708"></a>00708                 
<a name="l00709"></a>00709                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(data);
<a name="l00710"></a>00710             }
<a name="l00711"></a>00711                 <span class="keywordflow">break</span>;
<a name="l00712"></a>00712             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a4a5ae82ee6744695e90970c6f903ae84">ANIMTYPE_DSPART</a>:
<a name="l00713"></a>00713             {
<a name="l00714"></a>00714                 <a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a> *part= (<a class="code" href="../../df/da6/structParticleSettings.html">ParticleSettings</a>*)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l00715"></a>00715                 <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= part-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a35cf38441722e9b029ac80ee28f63031">adt</a>;
<a name="l00716"></a>00716                 
<a name="l00717"></a>00717                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#af960bb2eec00e47f38619d966a4fd2f9">FILTER_PART_OBJD</a>(part); 
<a name="l00718"></a>00718                 
<a name="l00719"></a>00719                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= (adt) ? adt-&gt;action : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00720"></a>00720                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85ac1aa151cfcc7fa642d7c4c2fca27855b">ALE_ACT</a>;
<a name="l00721"></a>00721                 
<a name="l00722"></a>00722                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(data);
<a name="l00723"></a>00723             }
<a name="l00724"></a>00724                 <span class="keywordflow">break</span>;
<a name="l00725"></a>00725             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a1ac4e0b7a95359f78fe6f8e43512275d">ANIMTYPE_DSTEX</a>:
<a name="l00726"></a>00726             {
<a name="l00727"></a>00727                 <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex= (<a class="code" href="../../df/d2d/structTex.html">Tex</a> *)data;
<a name="l00728"></a>00728                 <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a0ec2c56bda9943af0ea2540d25dca05b">adt</a>;
<a name="l00729"></a>00729                 
<a name="l00730"></a>00730                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#ae39260026c6a4359c8afb7611f04c0a1">FILTER_TEX_DATA</a>(tex); 
<a name="l00731"></a>00731                 
<a name="l00732"></a>00732                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= (adt) ? adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00733"></a>00733                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85ac1aa151cfcc7fa642d7c4c2fca27855b">ALE_ACT</a>;
<a name="l00734"></a>00734                 
<a name="l00735"></a>00735                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>= <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(data);
<a name="l00736"></a>00736             }
<a name="l00737"></a>00737                 <span class="keywordflow">break</span>;
<a name="l00738"></a>00738                 
<a name="l00739"></a>00739             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a5745c87a6bad0a1dbe26b8d429774c35">ANIMTYPE_GROUP</a>:
<a name="l00740"></a>00740             {
<a name="l00741"></a>00741                 <a class="code" href="../../d9/dcf/structbActionGroup.html">bActionGroup</a> *agrp= (<a class="code" href="../../d9/dcf/structbActionGroup.html">bActionGroup</a> *)data;
<a name="l00742"></a>00742                 
<a name="l00743"></a>00743                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= agrp-&gt;<a class="code" href="../../d9/dcf/structbActionGroup.html#a5a04faf9cd6c23df183545e5842caf80">flag</a>;
<a name="l00744"></a>00744                 
<a name="l00745"></a>00745                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00746"></a>00746                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85af04cee4c040a8676be97daed83bdb599">ALE_GROUP</a>;
<a name="l00747"></a>00747             }
<a name="l00748"></a>00748                 <span class="keywordflow">break</span>;
<a name="l00749"></a>00749             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7ac4150495b0727fbef95906be4efeba41">ANIMTYPE_FCURVE</a>:
<a name="l00750"></a>00750             {
<a name="l00751"></a>00751                 <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu= (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)data;
<a name="l00752"></a>00752                 
<a name="l00753"></a>00753                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#ad6eecd82ed24f053525b459881e405ea">flag</a>;
<a name="l00754"></a>00754                 
<a name="l00755"></a>00755                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= fcu;
<a name="l00756"></a>00756                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85a6072750eace5e2e8e8a0b0350df28b61">ALE_FCURVE</a>;
<a name="l00757"></a>00757             }
<a name="l00758"></a>00758                 <span class="keywordflow">break</span>;
<a name="l00759"></a>00759                 
<a name="l00760"></a>00760             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a35c2c921ea6a293e5bad35e67b3e695f">ANIMTYPE_SHAPEKEY</a>:
<a name="l00761"></a>00761             {
<a name="l00762"></a>00762                 <a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a> *kb= (<a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a> *)data;
<a name="l00763"></a>00763                 <a class="code" href="../../d1/d9e/structKey.html">Key</a> *key= (<a class="code" href="../../d1/d9e/structKey.html">Key</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ad2686a20c9c11e9889e3f4d9a60b8b8c">id</a>;
<a name="l00764"></a>00764                 
<a name="l00765"></a>00765                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#a293ff458065155efca63b30b33387982">flag</a>;
<a name="l00766"></a>00766                 
<a name="l00767"></a>00767                 <span class="comment">/* whether we have keyframes depends on whether there is a Key block to find it from */</span>
<a name="l00768"></a>00768                 <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (key) {
<a name="l00769"></a>00769                     <span class="comment">/* index of shapekey is defined by place in key&#39;s list */</span>
<a name="l00770"></a>00770                     ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a7add893450198e47ba4eafe5edd28bba">index</a>= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a0a004822554284f0bb32fdc70cfeee1f">BLI_findindex</a>(&amp;key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ab82a3a504826387b0811d68570496e2a">block</a>, kb);
<a name="l00771"></a>00771                     
<a name="l00772"></a>00772                     <span class="comment">/* the corresponding keyframes are from the animdata */</span>
<a name="l00773"></a>00773                     <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a> &amp;&amp; ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>) {
<a name="l00774"></a>00774                         <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *act= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>;
<a name="l00775"></a>00775                         <span class="keywordtype">char</span> *rna_path = <a class="code" href="../../d5/d17/BKE__key_8h.html#ab9ddd1a6f395165723cfe02451d3e19a">key_get_curValue_rnaPath</a>(key, kb);
<a name="l00776"></a>00776                         
<a name="l00777"></a>00777                         <span class="comment">/* try to find the F-Curve which corresponds to this exactly,</span>
<a name="l00778"></a>00778 <span class="comment">                         * then free the MEM_alloc&#39;d string</span>
<a name="l00779"></a>00779 <span class="comment">                         */</span>
<a name="l00780"></a>00780                         <span class="keywordflow">if</span> (rna_path) {
<a name="l00781"></a>00781                             ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= (<span class="keywordtype">void</span> *)<a class="code" href="../../da/dba/BKE__fcurve_8h.html#a3ec021af91abcfc2a7fcaea5ba7a2994">list_find_fcurve</a>(&amp;act-&gt;<a class="code" href="../../d1/d48/structbAction.html#a17c9f9250f377305171640e7a4aa7666">curves</a>, rna_path, 0);
<a name="l00782"></a>00782                             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(rna_path);
<a name="l00783"></a>00783                         }
<a name="l00784"></a>00784                     }
<a name="l00785"></a>00785                     ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>)? <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85a6072750eace5e2e8e8a0b0350df28b61">ALE_FCURVE</a> : <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85a4b51dc5b765a5a537ab4fd8d797a6b9d">ALE_NONE</a>;
<a name="l00786"></a>00786                 }
<a name="l00787"></a>00787             }   
<a name="l00788"></a>00788                 <span class="keywordflow">break</span>;
<a name="l00789"></a>00789             
<a name="l00790"></a>00790             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a725a5252770510310f22ba17a9c37e3a">ANIMTYPE_GPLAYER</a>:
<a name="l00791"></a>00791             {
<a name="l00792"></a>00792                 <a class="code" href="../../da/d7e/structbGPDlayer.html">bGPDlayer</a> *gpl= (<a class="code" href="../../da/d7e/structbGPDlayer.html">bGPDlayer</a> *)data;
<a name="l00793"></a>00793                 
<a name="l00794"></a>00794                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= gpl-&gt;<a class="code" href="../../da/d7e/structbGPDlayer.html#aed047c52577f6e0e3560c80bb65e1359">flag</a>;
<a name="l00795"></a>00795                 
<a name="l00796"></a>00796                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00797"></a>00797                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85a5632b404e7965c3f9c1eaf16ee074903">ALE_GPFRAME</a>;
<a name="l00798"></a>00798             }
<a name="l00799"></a>00799                 <span class="keywordflow">break</span>;
<a name="l00800"></a>00800                 
<a name="l00801"></a>00801             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7af43f86c654825189f3a85bd0485636fa">ANIMTYPE_NLATRACK</a>:
<a name="l00802"></a>00802             {
<a name="l00803"></a>00803                 <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt= (<a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *)data;
<a name="l00804"></a>00804                 
<a name="l00805"></a>00805                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ac0b6ebb1262d413a4c2ccf9dc5dd51d8">flag</a>= nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a285fc1de1605286e8255be7e5edd4863">flag</a>;
<a name="l00806"></a>00806                 
<a name="l00807"></a>00807                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= &amp;nlt-&gt;<a class="code" href="../../d4/de0/structNlaTrack.html#a48a60b4990af20f5ba014adf60ee2043">strips</a>;
<a name="l00808"></a>00808                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85a6b84e471363299a1668100369eb67fc1">ALE_NLASTRIP</a>;
<a name="l00809"></a>00809             }
<a name="l00810"></a>00810                 <span class="keywordflow">break</span>;
<a name="l00811"></a>00811             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7aa59286013a6d77493ae5fa2805b4e477">ANIMTYPE_NLAACTION</a>:
<a name="l00812"></a>00812             {
<a name="l00813"></a>00813                 <span class="comment">/* nothing to include for now... nothing editable from NLA-perspective here */</span>
<a name="l00814"></a>00814                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00815"></a>00815                 ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a>= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85a4b51dc5b765a5a537ab4fd8d797a6b9d">ALE_NONE</a>;
<a name="l00816"></a>00816             }
<a name="l00817"></a>00817                 <span class="keywordflow">break</span>;
<a name="l00818"></a>00818         }
<a name="l00819"></a>00819     }
<a name="l00820"></a>00820     
<a name="l00821"></a>00821     <span class="comment">/* return created datatype */</span>
<a name="l00822"></a>00822     <span class="keywordflow">return</span> ale;
<a name="l00823"></a>00823 }
<a name="l00824"></a>00824  
<a name="l00825"></a>00825 <span class="comment">/* ----------------------------------------- */</span>
<a name="l00826"></a>00826 
<a name="l00827"></a>00827 <span class="comment">/* &#39;Only Selected&#39; selected data filtering</span>
<a name="l00828"></a>00828 <span class="comment"> * NOTE: when this function returns true, the F-Curve is to be skipped </span>
<a name="l00829"></a>00829 <span class="comment"> */</span>
<a name="l00830"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a1fdbe1efd16ba4c293123baf3ae9383d">00830</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#a1fdbe1efd16ba4c293123baf3ae9383d">skip_fcurve_selected_data</a> (<a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu, <a class="code" href="../../d8/d7e/structID.html">ID</a> *owner_id, <span class="keywordtype">int</span> filter_mode)
<a name="l00831"></a>00831 {
<a name="l00832"></a>00832     <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(owner_id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>) == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>) {
<a name="l00833"></a>00833         <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= (<a class="code" href="../../de/de7/structObject.html">Object</a> *)owner_id;
<a name="l00834"></a>00834         
<a name="l00835"></a>00835         <span class="comment">/* only consider if F-Curve involves pose.bones */</span>
<a name="l00836"></a>00836         <span class="keywordflow">if</span> ((fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>) &amp;&amp; strstr(fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>, <span class="stringliteral">&quot;pose.bones&quot;</span>)) {
<a name="l00837"></a>00837             <a class="code" href="../../dd/d41/structbPoseChannel.html">bPoseChannel</a> *pchan;
<a name="l00838"></a>00838             <span class="keywordtype">char</span> *bone_name;
<a name="l00839"></a>00839             
<a name="l00840"></a>00840             <span class="comment">/* get bone-name, and check if this bone is selected */</span>
<a name="l00841"></a>00841             bone_name= <a class="code" href="../../d3/db3/BLI__string_8h.html#a59a96d992ef2c92f5c92b197c7fb2f9b">BLI_getQuotedStr</a>(fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>, <span class="stringliteral">&quot;pose.bones[&quot;</span>);
<a name="l00842"></a>00842             pchan= <a class="code" href="../../d8/df5/BKE__action_8h.html#a18bfaf2fd4139dd5efbf0c5ea657a1aa">get_pose_channel</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a23522fc15312fc5d99e1e1f68c579c25">pose</a>, bone_name);
<a name="l00843"></a>00843             <span class="keywordflow">if</span> (bone_name) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(bone_name);
<a name="l00844"></a>00844             
<a name="l00845"></a>00845             <span class="comment">/* check whether to continue or skip */</span>
<a name="l00846"></a>00846             <span class="keywordflow">if</span> ((pchan) &amp;&amp; (pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a31291bac57d8e3b0edaac489c94ed8b4">bone</a>)) {
<a name="l00847"></a>00847                 <span class="comment">/* if only visible channels, skip if bone not visible unless user wants channels from hidden data too */</span>
<a name="l00848"></a>00848                 <span class="keywordflow">if</span> ((filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a>) &amp;&amp; !(ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167ae57a6ca95f7ac35691a6b67ee3cfa0b2">ADS_FILTER_INCL_HIDDEN</a>)) {
<a name="l00849"></a>00849                     <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm= (<a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00850"></a>00850                     
<a name="l00851"></a>00851                     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> ((arm-&gt;<a class="code" href="../../d9/d9f/structbArmature.html#ac14cfbfc02b044a0a9b933dcbe002780">layer</a> &amp; pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a31291bac57d8e3b0edaac489c94ed8b4">bone</a>-&gt;<a class="code" href="../../de/de0/structBone.html#a7050e920284a4c3c13fab5c79c141a48">layer</a>) == 0)
<a name="l00852"></a>00852                         <span class="keywordflow">return</span> 1;
<a name="l00853"></a>00853                     <span class="comment">// TODO: manually hidden using flags</span>
<a name="l00854"></a>00854                 }
<a name="l00855"></a>00855                 
<a name="l00856"></a>00856                 <span class="comment">/* can only add this F-Curve if it is selected */</span>
<a name="l00857"></a>00857                 <span class="keywordflow">if</span> ((pchan-&gt;<a class="code" href="../../dd/d41/structbPoseChannel.html#a31291bac57d8e3b0edaac489c94ed8b4">bone</a>-&gt;<a class="code" href="../../de/de0/structBone.html#a5b5e463a4ba414686cfe2954ada482fb">flag</a> &amp; <a class="code" href="../../d2/d93/DNA__armature__types_8h.html#ad26c2b448f0e416cffc8cd84065c3b50a176833e258350f5e845cfb780a4c280c">BONE_SELECTED</a>) == 0)
<a name="l00858"></a>00858                     <span class="keywordflow">return</span> 1;
<a name="l00859"></a>00859             }
<a name="l00860"></a>00860         }
<a name="l00861"></a>00861     }
<a name="l00862"></a>00862     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(owner_id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>) == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac2b425dbd1f73ad1720fafad2626d974">ID_SCE</a>) {
<a name="l00863"></a>00863         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = (<a class="code" href="../../d9/d27/structScene.html">Scene</a> *)owner_id;
<a name="l00864"></a>00864         
<a name="l00865"></a>00865         <span class="comment">/* only consider if F-Curve involves sequence_editor.sequences */</span>
<a name="l00866"></a>00866         <span class="keywordflow">if</span> ((fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>) &amp;&amp; strstr(fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>, <span class="stringliteral">&quot;sequences_all&quot;</span>)) {
<a name="l00867"></a>00867             <a class="code" href="../../d5/de9/structEditing.html">Editing</a> *ed= <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#af27ede5fdfee51a163366fd358a03e14">seq_give_editing</a>(scene, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00868"></a>00868             <a class="code" href="../../dd/d1a/structSequence.html">Sequence</a> *seq;
<a name="l00869"></a>00869             <span class="keywordtype">char</span> *seq_name;
<a name="l00870"></a>00870             
<a name="l00871"></a>00871             <span class="comment">/* get strip name, and check if this strip is selected */</span>
<a name="l00872"></a>00872             seq_name= <a class="code" href="../../d3/db3/BLI__string_8h.html#a59a96d992ef2c92f5c92b197c7fb2f9b">BLI_getQuotedStr</a>(fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>, <span class="stringliteral">&quot;sequences_all[&quot;</span>);
<a name="l00873"></a>00873             seq = <a class="code" href="../../d8/d5f/BKE__sequencer_8h.html#a6bb297901645856e57814efbf0855323">get_seq_by_name</a>(ed-&gt;<a class="code" href="../../d5/de9/structEditing.html#a2a3744774bbd84f20c3204f41e73fe97">seqbasep</a>, seq_name, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00874"></a>00874             <span class="keywordflow">if</span> (seq_name) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(seq_name);
<a name="l00875"></a>00875             
<a name="l00876"></a>00876             <span class="comment">/* can only add this F-Curve if it is selected */</span>
<a name="l00877"></a>00877             <span class="keywordflow">if</span> (seq==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || (seq-&gt;<a class="code" href="../../dd/d1a/structSequence.html#add20bc7b873e8f7514725f6f3863de53">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)==0)
<a name="l00878"></a>00878                 <span class="keywordflow">return</span> 1;
<a name="l00879"></a>00879         }
<a name="l00880"></a>00880     }
<a name="l00881"></a>00881     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(owner_id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>) == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6e5ed4060f73b0f46e66af2dbef9dd2a">ID_NT</a>) {
<a name="l00882"></a>00882         <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree = (<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *)owner_id;
<a name="l00883"></a>00883         
<a name="l00884"></a>00884         <span class="comment">/* check for selected  nodes */</span>
<a name="l00885"></a>00885         <span class="keywordflow">if</span> ((fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>) &amp;&amp; strstr(fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>, <span class="stringliteral">&quot;nodes&quot;</span>)) {
<a name="l00886"></a>00886             <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00887"></a>00887             <span class="keywordtype">char</span> *node_name;
<a name="l00888"></a>00888             
<a name="l00889"></a>00889             <span class="comment">/* get strip name, and check if this strip is selected */</span>
<a name="l00890"></a>00890             node_name= <a class="code" href="../../d3/db3/BLI__string_8h.html#a59a96d992ef2c92f5c92b197c7fb2f9b">BLI_getQuotedStr</a>(fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>, <span class="stringliteral">&quot;nodes[&quot;</span>);
<a name="l00891"></a>00891             node = <a class="code" href="../../d4/d91/BKE__node_8h.html#a60b36f71b62212bef4196861570e5120">nodeFindNodebyName</a>(ntree, node_name);
<a name="l00892"></a>00892             <span class="keywordflow">if</span> (node_name) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(node_name);
<a name="l00893"></a>00893             
<a name="l00894"></a>00894             <span class="comment">/* can only add this F-Curve if it is selected */</span>
<a name="l00895"></a>00895             <span class="keywordflow">if</span> ((node) &amp;&amp; (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ad7b09e7f53c184ca8fb8015d3d50d808">NODE_SELECT</a>)==0)
<a name="l00896"></a>00896                 <span class="keywordflow">return</span> 1;
<a name="l00897"></a>00897         }
<a name="l00898"></a>00898     }
<a name="l00899"></a>00899     <span class="keywordflow">return</span> 0;
<a name="l00900"></a>00900 }
<a name="l00901"></a>00901 
<a name="l00902"></a>00902 <span class="comment">/* (Display-)Name-based F-Curve filtering</span>
<a name="l00903"></a>00903 <span class="comment"> * NOTE: when this function returns true, the F-Curve is to be skipped </span>
<a name="l00904"></a>00904 <span class="comment"> */</span>
<a name="l00905"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a498fd6d703e298dbb629914e1939f754">00905</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#a498fd6d703e298dbb629914e1939f754">skip_fcurve_with_name</a> (<a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu, <a class="code" href="../../d8/d7e/structID.html">ID</a> *owner_id)
<a name="l00906"></a>00906 {
<a name="l00907"></a>00907     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> ale_dummy = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00908"></a>00908     <a class="code" href="../../dd/d53/structbAnimChannelType.html">bAnimChannelType</a> *acf;
<a name="l00909"></a>00909     
<a name="l00910"></a>00910     <span class="comment">/* create a dummy wrapper for the F-Curve */</span>
<a name="l00911"></a>00911     ale_dummy.<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a> = <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7ac4150495b0727fbef95906be4efeba41">ANIMTYPE_FCURVE</a>;
<a name="l00912"></a>00912     ale_dummy.<a class="code" href="../../d6/dfc/structbAnimListElem.html#ad2686a20c9c11e9889e3f4d9a60b8b8c">id</a> = owner_id;
<a name="l00913"></a>00913     ale_dummy.<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a> = fcu;
<a name="l00914"></a>00914     
<a name="l00915"></a>00915     <span class="comment">/* get type info for channel */</span>
<a name="l00916"></a>00916     acf = <a class="code" href="../../da/d8b/anim__channels__defines_8c.html#a088f35eba1d1bd09b2b9807d56784a1f">ANIM_channel_get_typeinfo</a>(&amp;ale_dummy);
<a name="l00917"></a>00917     <span class="keywordflow">if</span> (acf &amp;&amp; acf-&gt;<a class="code" href="../../dd/d53/structbAnimChannelType.html#a8f1d4ea2b06243e543477039dfd1b42f">name</a>) {
<a name="l00918"></a>00918         <span class="keywordtype">char</span> name[256]; <span class="comment">/* hopefully this will be enough! */</span>
<a name="l00919"></a>00919         
<a name="l00920"></a>00920         <span class="comment">/* get name */</span>
<a name="l00921"></a>00921         acf-&gt;<a class="code" href="../../dd/d53/structbAnimChannelType.html#a8f1d4ea2b06243e543477039dfd1b42f">name</a>(&amp;ale_dummy, name);
<a name="l00922"></a>00922         
<a name="l00923"></a>00923         <span class="comment">/* check for partial match with the match string, assuming case insensitive filtering </span>
<a name="l00924"></a>00924 <span class="comment">         * if match, this channel shouldn&#39;t be ignored!</span>
<a name="l00925"></a>00925 <span class="comment">         */</span>
<a name="l00926"></a>00926         <span class="keywordflow">return</span> <a class="code" href="../../d3/db3/BLI__string_8h.html#acea342f9e36a26e2d404b1ada16f2b7a">BLI_strcasestr</a>(name, ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#a31ee8731fd2f7c2295633eee87757eff">searchstr</a>) == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00927"></a>00927     }
<a name="l00928"></a>00928     
<a name="l00929"></a>00929     <span class="comment">/* just let this go... */</span>
<a name="l00930"></a>00930     <span class="keywordflow">return</span> 1;
<a name="l00931"></a>00931 }
<a name="l00932"></a>00932 
<a name="l00933"></a>00933 <span class="comment">/* find the next F-Curve that is usable for inclusion */</span>
<a name="l00934"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a2a90961e3b83b30f71b711931a6ffe5f">00934</a> <span class="keyword">static</span> <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *<a class="code" href="../../dc/d01/anim__filter_8c.html#a2a90961e3b83b30f71b711931a6ffe5f">animfilter_fcurve_next</a> (<a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *first, <a class="code" href="../../d9/dcf/structbActionGroup.html">bActionGroup</a> *grp, <span class="keywordtype">int</span> filter_mode, <a class="code" href="../../d8/d7e/structID.html">ID</a> *owner_id)
<a name="l00935"></a>00935 {
<a name="l00936"></a>00936     <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00937"></a>00937     
<a name="l00938"></a>00938     <span class="comment">/* loop over F-Curves - assume that the caller of this has already checked that these should be included </span>
<a name="l00939"></a>00939 <span class="comment">     * NOTE: we need to check if the F-Curves belong to the same group, as this gets called for groups too...</span>
<a name="l00940"></a>00940 <span class="comment">     */</span>
<a name="l00941"></a>00941     <span class="keywordflow">for</span> (fcu= first; ((fcu) &amp;&amp; (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a3e312bcc15bdf7b83ce03a842044350a">grp</a>==grp)); fcu= fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a381b65464374cad861b80c44b9ae0759">next</a>) {
<a name="l00942"></a>00942         <span class="comment">/* special exception for Pose-Channel/Sequence-Strip/Node Based F-Curves:</span>
<a name="l00943"></a>00943 <span class="comment">         *  - the &#39;Only Selected&#39; data filter should be applied to Pose-Channel data too, but those are</span>
<a name="l00944"></a>00944 <span class="comment">         *    represented as F-Curves. The way the filter for objects worked was to be the first check</span>
<a name="l00945"></a>00945 <span class="comment">         *    after &#39;normal&#39; visibility, so this is done first here too...</span>
<a name="l00946"></a>00946 <span class="comment">         *  - we currently use an &#39;approximate&#39; method for getting these F-Curves that doesn&#39;t require</span>
<a name="l00947"></a>00947 <span class="comment">         *    carefully checking the entire path</span>
<a name="l00948"></a>00948 <span class="comment">         *  - this will also affect things like Drivers, and also works for Bone Constraints</span>
<a name="l00949"></a>00949 <span class="comment">         */</span>
<a name="l00950"></a>00950         <span class="keywordflow">if</span> ( ((ads) &amp;&amp; (ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a0642ce38ad5a37344a8a54ddad70b1c1">ADS_FILTER_ONLYSEL</a>)) &amp;&amp; (owner_id) ) {
<a name="l00951"></a>00951             <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#a1fdbe1efd16ba4c293123baf3ae9383d">skip_fcurve_selected_data</a>(ads, fcu, owner_id, filter_mode))
<a name="l00952"></a>00952                 <span class="keywordflow">continue</span>;
<a name="l00953"></a>00953         }
<a name="l00954"></a>00954         
<a name="l00955"></a>00955         <span class="comment">/* only include if visible (Graph Editor check, not channels check) */</span>
<a name="l00956"></a>00956         <span class="keywordflow">if</span> (!(filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a6c5e4b5cf2c3e1b6558850c56dbd490c">ANIMFILTER_CURVE_VISIBLE</a>) || (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#ad6eecd82ed24f053525b459881e405ea">flag</a> &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#ac0aededd6dcdcaa6f2dcf7d0f812e464abc4ace997641edbdb0f8724f583dffda">FCURVE_VISIBLE</a>)) {
<a name="l00957"></a>00957             <span class="comment">/* only work with this channel and its subchannels if it is editable */</span>
<a name="l00958"></a>00958             <span class="keywordflow">if</span> (!(filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>) || <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a8e53a43b3027ef786d49a6db7577e0aa">EDITABLE_FCU</a>(fcu)) {
<a name="l00959"></a>00959                 <span class="comment">/* only include this curve if selected in a way consistent with the filtering requirements */</span>
<a name="l00960"></a>00960                 <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#a2806079ca9241a2778c90f7fe033e5b3">ANIMCHANNEL_SELOK</a>(<a class="code" href="../../df/d6f/ED__anim__api_8h.html#a83c3ae8741e31e0ef1d647bde83ff135">SEL_FCU</a>(fcu)) &amp;&amp; <a class="code" href="../../dc/d01/anim__filter_8c.html#afda08085fef26fc7762c83dded512bc8">ANIMCHANNEL_SELEDITOK</a>(<a class="code" href="../../df/d6f/ED__anim__api_8h.html#a83c3ae8741e31e0ef1d647bde83ff135">SEL_FCU</a>(fcu))) {
<a name="l00961"></a>00961                     <span class="comment">/* only include if this curve is active */</span>
<a name="l00962"></a>00962                     <span class="keywordflow">if</span> (!(filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a14ccbd8e983dd0fb6fa15416e2f91d57">ANIMFILTER_ACTIVE</a>) || (fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#ad6eecd82ed24f053525b459881e405ea">flag</a> &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#ac0aededd6dcdcaa6f2dcf7d0f812e464a4dafc6cfdb87097d84384ce770383b66">FCURVE_ACTIVE</a>)) {
<a name="l00963"></a>00963                         <span class="comment">/* name based filtering... */</span>
<a name="l00964"></a>00964                         <span class="keywordflow">if</span> ( ((ads) &amp;&amp; (ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a79c704fb5732bea1e9637ea5007a1c21">ADS_FILTER_BY_FCU_NAME</a>)) &amp;&amp; (owner_id) ) {
<a name="l00965"></a>00965                             <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#a498fd6d703e298dbb629914e1939f754">skip_fcurve_with_name</a>(ads, fcu, owner_id))
<a name="l00966"></a>00966                                 <span class="keywordflow">continue</span>;
<a name="l00967"></a>00967                         }
<a name="l00968"></a>00968                         
<a name="l00969"></a>00969                         <span class="comment">/* this F-Curve can be used, so return it */</span>
<a name="l00970"></a>00970                         <span class="keywordflow">return</span> fcu;
<a name="l00971"></a>00971                     }
<a name="l00972"></a>00972                 }
<a name="l00973"></a>00973             }
<a name="l00974"></a>00974         }
<a name="l00975"></a>00975     }
<a name="l00976"></a>00976     
<a name="l00977"></a>00977     <span class="comment">/* no (more) F-Curves from the list are suitable... */</span>
<a name="l00978"></a>00978     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00979"></a>00979 }
<a name="l00980"></a>00980 
<a name="l00981"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a9ef9d6f06a2d216432ed1f6f4ca3abec">00981</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#a9ef9d6f06a2d216432ed1f6f4ca3abec">animfilter_fcurves</a> (<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *first, <a class="code" href="../../d9/dcf/structbActionGroup.html">bActionGroup</a> *grp, <span class="keywordtype">int</span> filter_mode, <a class="code" href="../../d8/d7e/structID.html">ID</a> *owner_id)
<a name="l00982"></a>00982 {
<a name="l00983"></a>00983     <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu;
<a name="l00984"></a>00984     <span class="keywordtype">size_t</span> items = 0;
<a name="l00985"></a>00985     
<a name="l00986"></a>00986     <span class="comment">/* loop over every F-Curve able to be included </span>
<a name="l00987"></a>00987 <span class="comment">     *  - this for-loop works like this: </span>
<a name="l00988"></a>00988 <span class="comment">     *      1) the starting F-Curve is assigned to the fcu pointer so that we have a starting point to search from</span>
<a name="l00989"></a>00989 <span class="comment">     *      2) the first valid F-Curve to start from (which may include the one given as &#39;first&#39;) in the remaining </span>
<a name="l00990"></a>00990 <span class="comment">     *         list of F-Curves is found, and verified to be non-null</span>
<a name="l00991"></a>00991 <span class="comment">     *      3) the F-Curve referenced by fcu pointer is added to the list</span>
<a name="l00992"></a>00992 <span class="comment">     *      4) the fcu pointer is set to the F-Curve after the one we just added, so that we can keep going through </span>
<a name="l00993"></a>00993 <span class="comment">     *         the rest of the F-Curve list without an eternal loop. Back to step 2 :)</span>
<a name="l00994"></a>00994 <span class="comment">     */</span>
<a name="l00995"></a>00995     <span class="keywordflow">for</span> (fcu=first; ( (fcu = <a class="code" href="../../dc/d01/anim__filter_8c.html#a2a90961e3b83b30f71b711931a6ffe5f">animfilter_fcurve_next</a>(ads, fcu, grp, filter_mode, owner_id)) ); fcu=fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a381b65464374cad861b80c44b9ae0759">next</a>)
<a name="l00996"></a>00996     {
<a name="l00997"></a>00997         <a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">ANIMCHANNEL_NEW_CHANNEL</a>(fcu, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7ac4150495b0727fbef95906be4efeba41">ANIMTYPE_FCURVE</a>, owner_id);
<a name="l00998"></a>00998     }
<a name="l00999"></a>00999     
<a name="l01000"></a>01000     <span class="comment">/* return the number of items added to the list */</span>
<a name="l01001"></a>01001     <span class="keywordflow">return</span> items;
<a name="l01002"></a>01002 }
<a name="l01003"></a>01003 
<a name="l01004"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#af992e139f84c012b05756438515e7c22">01004</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#af992e139f84c012b05756438515e7c22">animfilter_act_group</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(act), <a class="code" href="../../d9/dcf/structbActionGroup.html">bActionGroup</a> *agrp, <span class="keywordtype">int</span> filter_mode, <a class="code" href="../../d8/d7e/structID.html">ID</a> *owner_id)
<a name="l01005"></a>01005 {
<a name="l01006"></a>01006     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> tmp_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01007"></a>01007     <span class="keywordtype">size_t</span> tmp_items = 0;
<a name="l01008"></a>01008     <span class="keywordtype">size_t</span> items = 0;
<a name="l01009"></a>01009     <span class="comment">//int ofilter = filter_mode;</span>
<a name="l01010"></a>01010     
<a name="l01011"></a>01011     <span class="comment">/* if we care about the selection status of the channels, </span>
<a name="l01012"></a>01012 <span class="comment">     * but the group isn&#39;t expanded (1)...</span>
<a name="l01013"></a>01013 <span class="comment">     *  (1) this only matters if we actually care about the hierarchy though.</span>
<a name="l01014"></a>01014 <span class="comment">     *      - Hierarchy matters: this hack should be applied</span>
<a name="l01015"></a>01015 <span class="comment">     *      - Hierarchy ignored: cases like [#21276] won&#39;t work properly, unless we skip this hack</span>
<a name="l01016"></a>01016 <span class="comment">     */</span>
<a name="l01017"></a>01017     <span class="keywordflow">if</span> ( ((filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a>) &amp;&amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a635042d3c2cfc8f681cc8cde44c2c364">EXPANDED_AGRP</a>(ac, agrp)==0) &amp;&amp;     <span class="comment">/* care about hierarchy but group isn&#39;t expanded */</span>
<a name="l01018"></a>01018           (filter_mode &amp; (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045af15e0b18ede9eb0bdae48b6caab11403">ANIMFILTER_SEL</a>|<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a1d0564e78a5dea4580a2d28fddfa2b93">ANIMFILTER_UNSEL</a>)) )                           <span class="comment">/* care about selection status */</span>    
<a name="l01019"></a>01019     {
<a name="l01020"></a>01020         <span class="comment">/* if the group itself isn&#39;t selected appropriately, we shouldn&#39;t consider it&#39;s children either */</span>
<a name="l01021"></a>01021         <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#a2806079ca9241a2778c90f7fe033e5b3">ANIMCHANNEL_SELOK</a>(<a class="code" href="../../df/d6f/ED__anim__api_8h.html#a363824896f28380acea744afb8164b6d">SEL_AGRP</a>(agrp)) == 0)
<a name="l01022"></a>01022             <span class="keywordflow">return</span> 0;
<a name="l01023"></a>01023         
<a name="l01024"></a>01024         <span class="comment">/* if we&#39;re still here, then the selection status of the curves within this group should not matter,</span>
<a name="l01025"></a>01025 <span class="comment">         * since this creates too much overhead for animators (i.e. making a slow workflow)</span>
<a name="l01026"></a>01026 <span class="comment">         *</span>
<a name="l01027"></a>01027 <span class="comment">         * Tools affected by this at time of coding (2010 Feb 09):</span>
<a name="l01028"></a>01028 <span class="comment">         *  - inserting keyframes on selected channels only</span>
<a name="l01029"></a>01029 <span class="comment">         *  - pasting keyframes</span>
<a name="l01030"></a>01030 <span class="comment">         *  - creating ghost curves in Graph Editor</span>
<a name="l01031"></a>01031 <span class="comment">         */</span>
<a name="l01032"></a>01032         filter_mode &amp;= ~(<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045af15e0b18ede9eb0bdae48b6caab11403">ANIMFILTER_SEL</a>|<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a1d0564e78a5dea4580a2d28fddfa2b93">ANIMFILTER_UNSEL</a>|<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a>);
<a name="l01033"></a>01033     }
<a name="l01034"></a>01034     
<a name="l01035"></a>01035     <span class="comment">/* add grouped F-Curves */</span>
<a name="l01036"></a>01036     <a class="code" href="../../dc/d01/anim__filter_8c.html#ae1e5765ef9b93a06463e6937bcf631e3">BEGIN_ANIMFILTER_SUBCHANNELS</a>(<a class="code" href="../../df/d6f/ED__anim__api_8h.html#a635042d3c2cfc8f681cc8cde44c2c364">EXPANDED_AGRP</a>(ac, agrp))
<a name="l01037"></a>01037     {
<a name="l01038"></a>01038         <span class="comment">/* special filter so that we can get just the F-Curves within the active group */</span>
<a name="l01039"></a>01039         <span class="keywordflow">if</span> (!(filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045afa06cd536011815e6f8e25222c41f7aa">ANIMFILTER_ACTGROUPED</a>) || (agrp-&gt;<a class="code" href="../../d9/dcf/structbActionGroup.html#a5a04faf9cd6c23df183545e5842caf80">flag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a23623a6a10ec8ae24a77f37cf2093d1ea25a50a5f8e32afbcb339aceb59b9c110">AGRP_ACTIVE</a>)) {
<a name="l01040"></a>01040             <span class="comment">/* for the Graph Editor, curves may be set to not be visible in the view to lessen clutter,</span>
<a name="l01041"></a>01041 <span class="comment">             * but to do this, we need to check that the group doesn&#39;t have it&#39;s not-visible flag set preventing </span>
<a name="l01042"></a>01042 <span class="comment">             * all its sub-curves to be shown</span>
<a name="l01043"></a>01043 <span class="comment">             */</span>
<a name="l01044"></a>01044             <span class="keywordflow">if</span> (!(filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a6c5e4b5cf2c3e1b6558850c56dbd490c">ANIMFILTER_CURVE_VISIBLE</a>) || !(agrp-&gt;<a class="code" href="../../d9/dcf/structbActionGroup.html#a5a04faf9cd6c23df183545e5842caf80">flag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a23623a6a10ec8ae24a77f37cf2093d1eae6fbe561fc63ca841f401d343f02dfd5">AGRP_NOTVISIBLE</a>)) {
<a name="l01045"></a>01045                 <span class="comment">/* group must be editable for its children to be editable (if we care about this) */</span>
<a name="l01046"></a>01046                 <span class="keywordflow">if</span> (!(filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>) || <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a54325a6e69c8f014606888a1bfea66d5">EDITABLE_AGRP</a>(agrp)) {
<a name="l01047"></a>01047                     <span class="comment">/* get first F-Curve which can be used here */</span>
<a name="l01048"></a>01048                     <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *first_fcu = <a class="code" href="../../dc/d01/anim__filter_8c.html#a2a90961e3b83b30f71b711931a6ffe5f">animfilter_fcurve_next</a>(ads, agrp-&gt;<a class="code" href="../../d9/dcf/structbActionGroup.html#ad0e1909ae82afb9b3ece50be1e3d9915">channels</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>, agrp, filter_mode, owner_id);
<a name="l01049"></a>01049                     
<a name="l01050"></a>01050                     <span class="comment">/* filter list, starting from this F-Curve */</span>
<a name="l01051"></a>01051                     tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a9ef9d6f06a2d216432ed1f6f4ca3abec">animfilter_fcurves</a>(&amp;tmp_data, ads, first_fcu, agrp, filter_mode, owner_id);
<a name="l01052"></a>01052                 }
<a name="l01053"></a>01053             }
<a name="l01054"></a>01054         }
<a name="l01055"></a>01055     }
<a name="l01056"></a>01056     <a class="code" href="../../dc/d01/anim__filter_8c.html#ac3825ee442a35f775be20ca19a4177cb">END_ANIMFILTER_SUBCHANNELS</a>;
<a name="l01057"></a>01057     
<a name="l01058"></a>01058     <span class="comment">/* did we find anything? */</span>
<a name="l01059"></a>01059     <span class="keywordflow">if</span> (tmp_items) {
<a name="l01060"></a>01060         <span class="comment">/* add this group as a channel first */</span>
<a name="l01061"></a>01061         <span class="keywordflow">if</span> (filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a9c037c92ba2a5b6b36ace05f6933fadf">ANIMFILTER_LIST_CHANNELS</a>) {
<a name="l01062"></a>01062             <span class="comment">/* restore original filter mode so that this next step works ok... */</span>
<a name="l01063"></a>01063             <span class="comment">//filter_mode = ofilter;</span>
<a name="l01064"></a>01064             
<a name="l01065"></a>01065             <span class="comment">/* filter selection of channel specially here again, since may be open and not subject to previous test */</span>
<a name="l01066"></a>01066             <span class="keywordflow">if</span> ( <a class="code" href="../../dc/d01/anim__filter_8c.html#a2806079ca9241a2778c90f7fe033e5b3">ANIMCHANNEL_SELOK</a>(<a class="code" href="../../df/d6f/ED__anim__api_8h.html#a363824896f28380acea744afb8164b6d">SEL_AGRP</a>(agrp)) ) {
<a name="l01067"></a>01067                 <a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">ANIMCHANNEL_NEW_CHANNEL</a>(agrp, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a5745c87a6bad0a1dbe26b8d429774c35">ANIMTYPE_GROUP</a>, owner_id);
<a name="l01068"></a>01068             }
<a name="l01069"></a>01069         }
<a name="l01070"></a>01070         
<a name="l01071"></a>01071         <span class="comment">/* now add the list of collected channels */</span>
<a name="l01072"></a>01072         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aea47205fbf4fc9965bc2b06e7e3ca75a">BLI_movelisttolist</a>(anim_data, &amp;tmp_data);
<a name="l01073"></a>01073         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>((tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == tmp_data.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>) &amp;&amp; (tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));
<a name="l01074"></a>01074         items += tmp_items;
<a name="l01075"></a>01075     }
<a name="l01076"></a>01076     
<a name="l01077"></a>01077     <span class="comment">/* return the number of items added to the list */</span>
<a name="l01078"></a>01078     <span class="keywordflow">return</span> items;
<a name="l01079"></a>01079 }
<a name="l01080"></a>01080 
<a name="l01081"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#afcf140f686a541b0d56db0e6fae560d9">01081</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#afcf140f686a541b0d56db0e6fae560d9">animfilter_action</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *act, <span class="keywordtype">int</span> filter_mode, <a class="code" href="../../d8/d7e/structID.html">ID</a> *owner_id)
<a name="l01082"></a>01082 {
<a name="l01083"></a>01083     <a class="code" href="../../d9/dcf/structbActionGroup.html">bActionGroup</a> *agrp;
<a name="l01084"></a>01084     <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *lastchan = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01085"></a>01085     <span class="keywordtype">size_t</span> items = 0;
<a name="l01086"></a>01086     
<a name="l01087"></a>01087     <span class="comment">/* don&#39;t include anything from this action if it is linked in from another file,</span>
<a name="l01088"></a>01088 <span class="comment">     * and we&#39;re getting stuff for editing...</span>
<a name="l01089"></a>01089 <span class="comment">     */</span>
<a name="l01090"></a>01090     <span class="comment">// TODO: need a way of tagging other channels that may also be affected...</span>
<a name="l01091"></a>01091     <span class="keywordflow">if</span> ((filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>) &amp;&amp; (act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ad0f2d8efde1fdd4f81ee9fe471313bd6">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>))
<a name="l01092"></a>01092         <span class="keywordflow">return</span> 0;
<a name="l01093"></a>01093         
<a name="l01094"></a>01094     <span class="comment">/* do groups */</span>
<a name="l01095"></a>01095     <span class="comment">// TODO: do nested groups?</span>
<a name="l01096"></a>01096     <span class="keywordflow">for</span> (agrp = act-&gt;<a class="code" href="../../d1/d48/structbAction.html#a6d7358fa79f9d0feec006dd2d71c9cd4">groups</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; agrp; agrp = agrp-&gt;<a class="code" href="../../d9/dcf/structbActionGroup.html#a572a3c6b116924498cc9d6a41c93479f">next</a>) {
<a name="l01097"></a>01097         <span class="comment">/* store reference to last channel of group */</span>
<a name="l01098"></a>01098         <span class="keywordflow">if</span> (agrp-&gt;<a class="code" href="../../d9/dcf/structbActionGroup.html#ad0e1909ae82afb9b3ece50be1e3d9915">channels</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>) 
<a name="l01099"></a>01099             lastchan= agrp-&gt;<a class="code" href="../../d9/dcf/structbActionGroup.html#ad0e1909ae82afb9b3ece50be1e3d9915">channels</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>;
<a name="l01100"></a>01100             
<a name="l01101"></a>01101         <span class="comment">/* action group&#39;s channels */</span>
<a name="l01102"></a>01102         items += <a class="code" href="../../dc/d01/anim__filter_8c.html#af992e139f84c012b05756438515e7c22">animfilter_act_group</a>(ac, anim_data, ads, act, agrp, filter_mode, owner_id);
<a name="l01103"></a>01103     }
<a name="l01104"></a>01104     
<a name="l01105"></a>01105     <span class="comment">/* un-grouped F-Curves (only if we&#39;re not only considering those channels in the active group) */</span>
<a name="l01106"></a>01106     <span class="keywordflow">if</span> (!(filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045afa06cd536011815e6f8e25222c41f7aa">ANIMFILTER_ACTGROUPED</a>)) {
<a name="l01107"></a>01107         <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *firstfcu = (lastchan)? (lastchan-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a381b65464374cad861b80c44b9ae0759">next</a>) : (act-&gt;<a class="code" href="../../d1/d48/structbAction.html#a17c9f9250f377305171640e7a4aa7666">curves</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>);
<a name="l01108"></a>01108         items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a9ef9d6f06a2d216432ed1f6f4ca3abec">animfilter_fcurves</a>(anim_data, ads, firstfcu, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, filter_mode, owner_id);
<a name="l01109"></a>01109     }
<a name="l01110"></a>01110     
<a name="l01111"></a>01111     <span class="comment">/* return the number of items added to the list */</span>
<a name="l01112"></a>01112     <span class="keywordflow">return</span> items;
<a name="l01113"></a>01113 }
<a name="l01114"></a>01114 
<a name="l01115"></a>01115 <span class="comment">/* Include NLA-Data for NLA-Editor:</span>
<a name="l01116"></a>01116 <span class="comment"> *  - when ANIMFILTER_LIST_CHANNELS is used, that means we should be filtering the list for display</span>
<a name="l01117"></a>01117 <span class="comment"> *    Although the evaluation order is from the first track to the last and then apply the Action on top,</span>
<a name="l01118"></a>01118 <span class="comment"> *    we present this in the UI as the Active Action followed by the last track to the first so that we </span>
<a name="l01119"></a>01119 <span class="comment"> *    get the evaluation order presented as per a stack.</span>
<a name="l01120"></a>01120 <span class="comment"> *  - for normal filtering (i.e. for editing), we only need the NLA-tracks but they can be in &#39;normal&#39; evaluation</span>
<a name="l01121"></a>01121 <span class="comment"> *    order, i.e. first to last. Otherwise, some tools may get screwed up.</span>
<a name="l01122"></a>01122 <span class="comment"> */</span>
<a name="l01123"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a33a26d5b93be68bf9a85492b3856474f">01123</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#a33a26d5b93be68bf9a85492b3856474f">animfilter_nla</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(ac), <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt, <span class="keywordtype">int</span> filter_mode, <a class="code" href="../../d8/d7e/structID.html">ID</a> *owner_id)
<a name="l01124"></a>01124 {
<a name="l01125"></a>01125     <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *nlt;
<a name="l01126"></a>01126     <a class="code" href="../../d4/de0/structNlaTrack.html">NlaTrack</a> *first=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01127"></a>01127     <span class="keywordtype">size_t</span> items = 0;
<a name="l01128"></a>01128     
<a name="l01129"></a>01129     <span class="comment">/* if showing channels, include active action */</span>
<a name="l01130"></a>01130     <span class="keywordflow">if</span> (filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a9c037c92ba2a5b6b36ace05f6933fadf">ANIMFILTER_LIST_CHANNELS</a>) {
<a name="l01131"></a>01131         <span class="comment">/* if NLA action-line filtering is off, don&#39;t show unless there are keyframes, </span>
<a name="l01132"></a>01132 <span class="comment">         * in order to keep things more compact for doing transforms</span>
<a name="l01133"></a>01133 <span class="comment">         */</span>
<a name="l01134"></a>01134         <span class="keywordflow">if</span> (!(ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a0c0e95d1843bb72def17aeea408c2227">ADS_FILTER_NLA_NOACT</a>) || (adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>)) {
<a name="l01135"></a>01135             <span class="comment">/* there isn&#39;t really anything editable here, so skip if need editable */</span>
<a name="l01136"></a>01136             <span class="keywordflow">if</span> ((filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>) == 0) { 
<a name="l01137"></a>01137                 <span class="comment">/* just add the action track now (this MUST appear for drawing)</span>
<a name="l01138"></a>01138 <span class="comment">                 *  - as AnimData may not have an action, we pass a dummy pointer just to get the list elem created, then</span>
<a name="l01139"></a>01139 <span class="comment">                 *    overwrite this with the real value - REVIEW THIS...</span>
<a name="l01140"></a>01140 <span class="comment">                 */</span>
<a name="l01141"></a>01141                 <a class="code" href="../../dc/d01/anim__filter_8c.html#a80616751bed5824ffc02f601e29742b4">ANIMCHANNEL_NEW_CHANNEL_FULL</a>((<span class="keywordtype">void</span> *)(&amp;adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>), <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7aa59286013a6d77493ae5fa2805b4e477">ANIMTYPE_NLAACTION</a>, owner_id, 
<a name="l01142"></a>01142                     {
<a name="l01143"></a>01143                         ale-&gt;data= adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a> ? adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; 
<a name="l01144"></a>01144                     });
<a name="l01145"></a>01145             }
<a name="l01146"></a>01146         }
<a name="l01147"></a>01147         
<a name="l01148"></a>01148         <span class="comment">/* first track to include will be the last one if we&#39;re filtering by channels */</span>
<a name="l01149"></a>01149         first= adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#ad6e27784ea3b52a7914bc9b00a47b5c1">nla_tracks</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>;
<a name="l01150"></a>01150     }
<a name="l01151"></a>01151     <span class="keywordflow">else</span> {
<a name="l01152"></a>01152         <span class="comment">/* first track to include will the the first one (as per normal) */</span>
<a name="l01153"></a>01153         first= adt-&gt;nla_tracks.first;
<a name="l01154"></a>01154     }
<a name="l01155"></a>01155     
<a name="l01156"></a>01156     <span class="comment">/* loop over NLA Tracks - assume that the caller of this has already checked that these should be included */</span>
<a name="l01157"></a>01157     <span class="keywordflow">for</span> (nlt= first; nlt; nlt= <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>) {
<a name="l01158"></a>01158         <span class="comment">/* &#39;next&#39; NLA-Track to use depends on whether we&#39;re filtering for drawing or not */</span>
<a name="l01159"></a>01159         <span class="keywordflow">if</span> (filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a9c037c92ba2a5b6b36ace05f6933fadf">ANIMFILTER_LIST_CHANNELS</a>) 
<a name="l01160"></a>01160             <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>= nlt-&gt;prev;
<a name="l01161"></a>01161         <span class="keywordflow">else</span>
<a name="l01162"></a>01162             <a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>= nlt-&gt;next;
<a name="l01163"></a>01163         
<a name="l01164"></a>01164         <span class="comment">/* if we&#39;re in NLA-tweakmode, don&#39;t show this track if it was disabled (due to tweaking) for now </span>
<a name="l01165"></a>01165 <span class="comment">         *  - active track should still get shown though (even though it has disabled flag set)</span>
<a name="l01166"></a>01166 <span class="comment">         */</span>
<a name="l01167"></a>01167         <span class="comment">// FIXME: the channels after should still get drawn, just &#39;differently&#39;, and after an active-action channel</span>
<a name="l01168"></a>01168         <span class="keywordflow">if</span> ((adt-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0da68d088688075989bcf4f547c5b673afe405d4c0a7ffe9fd822f85904916a4c">ADT_NLA_EDIT_ON</a>) &amp;&amp; (nlt-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#ad4932569a7243266199669afdd3a36eba5ecdb6168b42848880be95e7c3b8b551">NLATRACK_DISABLED</a>) &amp;&amp; !(nlt-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#ad4932569a7243266199669afdd3a36eba3bfcf76c5ef87c391346e6e7ab29b7f8">NLATRACK_ACTIVE</a>))
<a name="l01169"></a>01169             <span class="keywordflow">continue</span>;
<a name="l01170"></a>01170         
<a name="l01171"></a>01171         <span class="comment">/* only work with this channel and its subchannels if it is editable */</span>
<a name="l01172"></a>01172         <span class="keywordflow">if</span> (!(filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>) || <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a97a89e5857f861996f81d5f9315b71c8">EDITABLE_NLT</a>(nlt)) {
<a name="l01173"></a>01173             <span class="comment">/* only include this track if selected in a way consistent with the filtering requirements */</span>
<a name="l01174"></a>01174             <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#a2806079ca9241a2778c90f7fe033e5b3">ANIMCHANNEL_SELOK</a>(<a class="code" href="../../df/d6f/ED__anim__api_8h.html#ae7deee797fa3046c351b9a837f0b2d48">SEL_NLT</a>(nlt))) {
<a name="l01175"></a>01175                 <span class="comment">/* only include if this track is active */</span>
<a name="l01176"></a>01176                 <span class="keywordflow">if</span> (!(filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a14ccbd8e983dd0fb6fa15416e2f91d57">ANIMFILTER_ACTIVE</a>) || (nlt-&gt;flag &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#ad4932569a7243266199669afdd3a36eba3bfcf76c5ef87c391346e6e7ab29b7f8">NLATRACK_ACTIVE</a>)) {
<a name="l01177"></a>01177                     <a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">ANIMCHANNEL_NEW_CHANNEL</a>(nlt, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7af43f86c654825189f3a85bd0485636fa">ANIMTYPE_NLATRACK</a>, owner_id);
<a name="l01178"></a>01178                 }
<a name="l01179"></a>01179             }
<a name="l01180"></a>01180         }
<a name="l01181"></a>01181     }
<a name="l01182"></a>01182     
<a name="l01183"></a>01183     <span class="comment">/* return the number of items added to the list */</span>
<a name="l01184"></a>01184     <span class="keywordflow">return</span> items;
<a name="l01185"></a>01185 }
<a name="l01186"></a>01186 
<a name="l01187"></a>01187 <span class="comment">/* determine what animation data from AnimData block should get displayed */</span>
<a name="l01188"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a852ca4fa579399b1081fe686fdcc9935">01188</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#a852ca4fa579399b1081fe686fdcc9935">animfilter_block_data</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <span class="keywordtype">int</span> filter_mode)
<a name="l01189"></a>01189 {
<a name="l01190"></a>01190     <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt = <a class="code" href="../../dc/d51/BKE__animsys_8h.html#aa3c6a97f5185329334a481908e7cf985">BKE_animdata_from_id</a>(<span class="keywordtype">id</span>);
<a name="l01191"></a>01191     <span class="keywordtype">size_t</span> items = 0;
<a name="l01192"></a>01192 
<a name="l01193"></a>01193     <span class="comment">/* image object datablocks have no anim-data so check for NULL */</span>
<a name="l01194"></a>01194     <span class="keywordflow">if</span> (adt) {
<a name="l01195"></a>01195         <a class="code" href="../../d7/dba/structIdAdtTemplate.html">IdAdtTemplate</a> *iat = (<a class="code" href="../../d7/dba/structIdAdtTemplate.html">IdAdtTemplate</a>*)<span class="keywordtype">id</span>;
<a name="l01196"></a>01196 
<a name="l01197"></a>01197         <span class="comment">/* NOTE: this macro is used instead of inlining the logic here, since this sort of filtering is still needed</span>
<a name="l01198"></a>01198 <span class="comment">         * in a few places in he rest of the code still - notably for the few cases where special mode-based</span>
<a name="l01199"></a>01199 <span class="comment">         * different types of data expanders are required.</span>
<a name="l01200"></a>01200 <span class="comment">         */</span>
<a name="l01201"></a>01201         <a class="code" href="../../dc/d01/anim__filter_8c.html#a6b431d984d5d233b2a81aeb18a24e1fe">ANIMDATA_FILTER_CASES</a>(iat,
<a name="l01202"></a>01202             { <span class="comment">/* AnimData */</span>
<a name="l01203"></a>01203                 <span class="comment">/* specifically filter animdata block */</span>
<a name="l01204"></a>01204                 <a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">ANIMCHANNEL_NEW_CHANNEL</a>(adt, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a8b1a43f0c0be96dd0da257a4bf376cea">ANIMTYPE_ANIMDATA</a>, <span class="keywordtype">id</span>);
<a name="l01205"></a>01205             },
<a name="l01206"></a>01206             { <span class="comment">/* NLA */</span>
<a name="l01207"></a>01207                 items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a33a26d5b93be68bf9a85492b3856474f">animfilter_nla</a>(ac, anim_data, ads, adt, filter_mode, <span class="keywordtype">id</span>);
<a name="l01208"></a>01208             },
<a name="l01209"></a>01209             { <span class="comment">/* Drivers */</span>
<a name="l01210"></a>01210                 items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a9ef9d6f06a2d216432ed1f6f4ca3abec">animfilter_fcurves</a>(anim_data, ads, adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#aaca565f031ee1209087422d8a5d77769">drivers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, filter_mode, <span class="keywordtype">id</span>);
<a name="l01211"></a>01211             },
<a name="l01212"></a>01212             { <span class="comment">/* Keyframes */</span>
<a name="l01213"></a>01213                 items += <a class="code" href="../../dc/d01/anim__filter_8c.html#afcf140f686a541b0d56db0e6fae560d9">animfilter_action</a>(ac, anim_data, ads, adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>, filter_mode, <span class="keywordtype">id</span>);
<a name="l01214"></a>01214             }
<a name="l01215"></a>01215         );
<a name="l01216"></a>01216     }
<a name="l01217"></a>01217 
<a name="l01218"></a>01218     <span class="keywordflow">return</span> items;
<a name="l01219"></a>01219 }
<a name="l01220"></a>01220 
<a name="l01221"></a>01221 
<a name="l01222"></a>01222 
<a name="l01223"></a>01223 <span class="comment">/* Include ShapeKey Data for ShapeKey Editor */</span>
<a name="l01224"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#af9fcdca0456d688a2452dd02b1dd73e0">01224</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#af9fcdca0456d688a2452dd02b1dd73e0">animdata_filter_shapekey</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../d1/d9e/structKey.html">Key</a> *key, <span class="keywordtype">int</span> filter_mode)
<a name="l01225"></a>01225 {
<a name="l01226"></a>01226     <span class="keywordtype">size_t</span> items = 0;
<a name="l01227"></a>01227     
<a name="l01228"></a>01228     <span class="comment">/* check if channels or only F-Curves */</span>
<a name="l01229"></a>01229     <span class="keywordflow">if</span> (filter_mode &amp; ANIMFILTER_LIST_CHANNELS) {
<a name="l01230"></a>01230         <a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a> *kb;
<a name="l01231"></a>01231         
<a name="l01232"></a>01232         <span class="comment">/* loop through the channels adding ShapeKeys as appropriate */</span>
<a name="l01233"></a>01233         <span class="keywordflow">for</span> (kb= key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ab82a3a504826387b0811d68570496e2a">block</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; kb; kb= kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#ac20a23b2cb5a21986a4c762933f8a95b">next</a>) {
<a name="l01234"></a>01234             <span class="comment">/* skip the first one, since that&#39;s the non-animatable basis */</span>
<a name="l01235"></a>01235             <span class="comment">// XXX maybe in future this may become handy?</span>
<a name="l01236"></a>01236             <span class="keywordflow">if</span> (kb == key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ab82a3a504826387b0811d68570496e2a">block</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) <span class="keywordflow">continue</span>;
<a name="l01237"></a>01237             
<a name="l01238"></a>01238             <span class="comment">/* only work with this channel and its subchannels if it is editable */</span>
<a name="l01239"></a>01239             <span class="keywordflow">if</span> (!(filter_mode &amp; ANIMFILTER_FOREDIT) || <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a8aaf432628e295882ed801087ed3c2f0">EDITABLE_SHAPEKEY</a>(kb)) {
<a name="l01240"></a>01240                 <span class="comment">/* only include this track if selected in a way consistent with the filtering requirements */</span>
<a name="l01241"></a>01241                 <span class="keywordflow">if</span> ( <a class="code" href="../../dc/d01/anim__filter_8c.html#a2806079ca9241a2778c90f7fe033e5b3">ANIMCHANNEL_SELOK</a>(<a class="code" href="../../df/d6f/ED__anim__api_8h.html#a0cf440a7442c14c5650798c4bf51ae7d">SEL_SHAPEKEY</a>(kb)) ) {
<a name="l01242"></a>01242                     <span class="comment">// TODO: consider &#39;active&#39; too?</span>
<a name="l01243"></a>01243                     
<a name="l01244"></a>01244                     <span class="comment">/* owner-id here must be key so that the F-Curve can be resolved... */</span>
<a name="l01245"></a>01245                     <a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">ANIMCHANNEL_NEW_CHANNEL</a>(kb, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a35c2c921ea6a293e5bad35e67b3e695f">ANIMTYPE_SHAPEKEY</a>, key);
<a name="l01246"></a>01246                 }
<a name="l01247"></a>01247             }
<a name="l01248"></a>01248         }
<a name="l01249"></a>01249     }
<a name="l01250"></a>01250     <span class="keywordflow">else</span> {
<a name="l01251"></a>01251         <span class="comment">/* just use the action associated with the shapekey */</span>
<a name="l01252"></a>01252         <span class="comment">// TODO: somehow manage to pass dopesheet info down here too?</span>
<a name="l01253"></a>01253         <span class="keywordflow">if</span> (key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a9e6219935b7f5b387610055b81705180">adt</a>) {
<a name="l01254"></a>01254             <span class="keywordflow">if</span> (filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a4e398ad453b0cbff2de76253616fd334">ANIMFILTER_ANIMDATA</a>) {
<a name="l01255"></a>01255                 <a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">ANIMCHANNEL_NEW_CHANNEL</a>(key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a9e6219935b7f5b387610055b81705180">adt</a>, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a8b1a43f0c0be96dd0da257a4bf376cea">ANIMTYPE_ANIMDATA</a>, key);
<a name="l01256"></a>01256             }
<a name="l01257"></a>01257             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a9e6219935b7f5b387610055b81705180">adt</a>-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>) {
<a name="l01258"></a>01258                 items= <a class="code" href="../../dc/d01/anim__filter_8c.html#afcf140f686a541b0d56db0e6fae560d9">animfilter_action</a>(ac, anim_data, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a9e6219935b7f5b387610055b81705180">adt</a>-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>, filter_mode, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)key);
<a name="l01259"></a>01259             }
<a name="l01260"></a>01260         }
<a name="l01261"></a>01261     }
<a name="l01262"></a>01262     
<a name="l01263"></a>01263     <span class="comment">/* return the number of items added to the list */</span>
<a name="l01264"></a>01264     <span class="keywordflow">return</span> items;
<a name="l01265"></a>01265 }
<a name="l01266"></a>01266 
<a name="l01267"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a20e84e44128c825920c45db2084329b8">01267</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#a20e84e44128c825920c45db2084329b8">animdata_filter_gpencil_data</a> (<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../dd/d52/structbGPdata.html">bGPdata</a> *gpd, <span class="keywordtype">int</span> filter_mode)
<a name="l01268"></a>01268 {
<a name="l01269"></a>01269     <a class="code" href="../../da/d7e/structbGPDlayer.html">bGPDlayer</a> *gpl;
<a name="l01270"></a>01270     <span class="keywordtype">size_t</span> items = 0;
<a name="l01271"></a>01271     
<a name="l01272"></a>01272     <span class="comment">/* loop over layers as the conditions are acceptable */</span>
<a name="l01273"></a>01273     <span class="keywordflow">for</span> (gpl= gpd-&gt;<a class="code" href="../../dd/d52/structbGPdata.html#a758b708bf82bb5351255c6c1f974a0cc">layers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; gpl; gpl= gpl-&gt;<a class="code" href="../../da/d7e/structbGPDlayer.html#a428b812104383d1b973f98c4dde29ac9">next</a>) {
<a name="l01274"></a>01274         <span class="comment">/* only if selected */</span>
<a name="l01275"></a>01275         <span class="keywordflow">if</span> ( <a class="code" href="../../dc/d01/anim__filter_8c.html#a2806079ca9241a2778c90f7fe033e5b3">ANIMCHANNEL_SELOK</a>(<a class="code" href="../../df/d6f/ED__anim__api_8h.html#a3e9caddadd42ef990c509b48ae8f0ad7">SEL_GPL</a>(gpl)) ) {
<a name="l01276"></a>01276             <span class="comment">/* only if editable */</span>
<a name="l01277"></a>01277             <span class="keywordflow">if</span> (!(filter_mode &amp; ANIMFILTER_FOREDIT) || <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a31d5dfa2e797217424b5bb4f7c91df51">EDITABLE_GPL</a>(gpl)) {
<a name="l01278"></a>01278                 <span class="comment">/* active... */</span>
<a name="l01279"></a>01279                 <span class="keywordflow">if</span> (!(filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a14ccbd8e983dd0fb6fa15416e2f91d57">ANIMFILTER_ACTIVE</a>) || (gpl-&gt;<a class="code" href="../../da/d7e/structbGPDlayer.html#aed047c52577f6e0e3560c80bb65e1359">flag</a> &amp; <a class="code" href="../../d6/dcb/DNA__gpencil__types_8h.html#abfffefae185b28a622d3c6f294de6d51">GP_LAYER_ACTIVE</a>)) {
<a name="l01280"></a>01280                     <span class="comment">/* add to list */</span>
<a name="l01281"></a>01281                     <a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">ANIMCHANNEL_NEW_CHANNEL</a>(gpl, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a725a5252770510310f22ba17a9c37e3a">ANIMTYPE_GPLAYER</a>, gpd);
<a name="l01282"></a>01282                 }
<a name="l01283"></a>01283             }
<a name="l01284"></a>01284         }
<a name="l01285"></a>01285     }
<a name="l01286"></a>01286     
<a name="l01287"></a>01287     <span class="keywordflow">return</span> items;
<a name="l01288"></a>01288 }
<a name="l01289"></a>01289 
<a name="l01290"></a>01290 <span class="comment">/* Grab all Grease Pencil datablocks in file */</span>
<a name="l01291"></a>01291 <span class="comment">// TODO: should this be amalgamated with the dopesheet filtering code?</span>
<a name="l01292"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a4cadd09f6d2650d89c714cc1f4dc112a">01292</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#a4cadd09f6d2650d89c714cc1f4dc112a">animdata_filter_gpencil</a> (<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>), <span class="keywordtype">int</span> filter_mode)
<a name="l01293"></a>01293 {
<a name="l01294"></a>01294     <a class="code" href="../../dd/d52/structbGPdata.html">bGPdata</a> *gpd;
<a name="l01295"></a>01295     <span class="keywordtype">size_t</span> items = 0;
<a name="l01296"></a>01296     
<a name="l01297"></a>01297     <span class="comment">/* for now, grab grease pencil datablocks directly from main */</span>
<a name="l01298"></a>01298     <span class="comment">// XXX: this is not good...</span>
<a name="l01299"></a>01299     <span class="keywordflow">for</span> (gpd = <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;gpencil.first; gpd; gpd = gpd-&gt;<a class="code" href="../../dd/d52/structbGPdata.html#aaec6b9082af7de201b9cd5cf7bfafcd1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01300"></a>01300         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> tmp_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01301"></a>01301         <span class="keywordtype">size_t</span> tmp_items = 0;
<a name="l01302"></a>01302         
<a name="l01303"></a>01303         <span class="comment">/* only show if gpd is used by something... */</span>
<a name="l01304"></a>01304         <span class="keywordflow">if</span> (<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ab144cdfd04135cd0bffef8df2ab7eba1">ID_REAL_USERS</a>(gpd) &lt; 1)
<a name="l01305"></a>01305             <span class="keywordflow">continue</span>;
<a name="l01306"></a>01306             
<a name="l01307"></a>01307         <span class="comment">/* add gpencil animation channels */</span>
<a name="l01308"></a>01308         <a class="code" href="../../dc/d01/anim__filter_8c.html#ae1e5765ef9b93a06463e6937bcf631e3">BEGIN_ANIMFILTER_SUBCHANNELS</a>(<a class="code" href="../../df/d6f/ED__anim__api_8h.html#ae350882121b00447671561e1b59f5fe7">EXPANDED_GPD</a>(gpd))
<a name="l01309"></a>01309         {
<a name="l01310"></a>01310             tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a20e84e44128c825920c45db2084329b8">animdata_filter_gpencil_data</a>(&amp;tmp_data, gpd, filter_mode);
<a name="l01311"></a>01311         }
<a name="l01312"></a>01312         <a class="code" href="../../dc/d01/anim__filter_8c.html#ac3825ee442a35f775be20ca19a4177cb">END_ANIMFILTER_SUBCHANNELS</a>;
<a name="l01313"></a>01313         
<a name="l01314"></a>01314         <span class="comment">/* did we find anything? */</span>
<a name="l01315"></a>01315         <span class="keywordflow">if</span> (tmp_items) {
<a name="l01316"></a>01316             <span class="comment">/* include data-expand widget first */</span>
<a name="l01317"></a>01317             <span class="keywordflow">if</span> (filter_mode &amp; ANIMFILTER_LIST_CHANNELS) {
<a name="l01318"></a>01318                 <span class="comment">/* add gpd as channel too (if for drawing, and it has layers) */</span>
<a name="l01319"></a>01319                 <a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">ANIMCHANNEL_NEW_CHANNEL</a>(gpd, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7acb54f9fdf25161b18cf03e1bb249fb90">ANIMTYPE_GPDATABLOCK</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01320"></a>01320             }
<a name="l01321"></a>01321             
<a name="l01322"></a>01322             <span class="comment">/* now add the list of collected channels */</span>
<a name="l01323"></a>01323             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aea47205fbf4fc9965bc2b06e7e3ca75a">BLI_movelisttolist</a>(anim_data, &amp;tmp_data);
<a name="l01324"></a>01324             <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>((tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == tmp_data.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>) &amp;&amp; (tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));
<a name="l01325"></a>01325             items += tmp_items;
<a name="l01326"></a>01326         }
<a name="l01327"></a>01327     }
<a name="l01328"></a>01328     
<a name="l01329"></a>01329     <span class="comment">/* return the number of items added to the list */</span>
<a name="l01330"></a>01330     <span class="keywordflow">return</span> items;
<a name="l01331"></a>01331 }
<a name="l01332"></a>01332 
<a name="l01333"></a>01333 <span class="comment">/* NOTE: owner_id is scene, material, or texture block, which is the direct owner of the node tree in question */</span>
<a name="l01334"></a>01334 <span class="comment">// TODO: how to handle group nodes is still unclear...</span>
<a name="l01335"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#adf32c7e97734f9ccb6612d4c7072ed9c">01335</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#adf32c7e97734f9ccb6612d4c7072ed9c">animdata_filter_ds_nodetree</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../d8/d7e/structID.html">ID</a> *owner_id, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <span class="keywordtype">int</span> filter_mode)
<a name="l01336"></a>01336 {
<a name="l01337"></a>01337     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> tmp_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01338"></a>01338     <span class="keywordtype">size_t</span> tmp_items = 0;
<a name="l01339"></a>01339     <span class="keywordtype">size_t</span> items = 0;
<a name="l01340"></a>01340     
<a name="l01341"></a>01341     <span class="comment">/* add nodetree animation channels */</span>
<a name="l01342"></a>01342     <a class="code" href="../../dc/d01/anim__filter_8c.html#ae1e5765ef9b93a06463e6937bcf631e3">BEGIN_ANIMFILTER_SUBCHANNELS</a>(<a class="code" href="../../df/d6f/ED__anim__api_8h.html#a276cf6239ce15e45c76186dd6ed8d1cd">FILTER_NTREE_DATA</a>(ntree))
<a name="l01343"></a>01343     {
<a name="l01344"></a>01344         <span class="comment">/* animation data filtering */</span>
<a name="l01345"></a>01345         tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a852ca4fa579399b1081fe686fdcc9935">animfilter_block_data</a>(ac, &amp;tmp_data, ads, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ntree, filter_mode);
<a name="l01346"></a>01346     }
<a name="l01347"></a>01347     <a class="code" href="../../dc/d01/anim__filter_8c.html#ac3825ee442a35f775be20ca19a4177cb">END_ANIMFILTER_SUBCHANNELS</a>;
<a name="l01348"></a>01348     
<a name="l01349"></a>01349     <span class="comment">/* did we find anything? */</span>
<a name="l01350"></a>01350     <span class="keywordflow">if</span> (tmp_items) {
<a name="l01351"></a>01351         <span class="comment">/* include data-expand widget first */</span>
<a name="l01352"></a>01352         <span class="keywordflow">if</span> (filter_mode &amp; ANIMFILTER_LIST_CHANNELS) {
<a name="l01353"></a>01353             <span class="comment">/* check if filtering by active status */</span>
<a name="l01354"></a>01354             <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#a63183ed1f39a32b7df70adbb9ff1f000">ANIMCHANNEL_ACTIVEOK</a>(ntree)) {
<a name="l01355"></a>01355                 <a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">ANIMCHANNEL_NEW_CHANNEL</a>(ntree, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a302851307dd74cd1fedb1861788af804">ANIMTYPE_DSNTREE</a>, owner_id);
<a name="l01356"></a>01356             }
<a name="l01357"></a>01357         }
<a name="l01358"></a>01358         
<a name="l01359"></a>01359         <span class="comment">/* now add the list of collected channels */</span>
<a name="l01360"></a>01360         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aea47205fbf4fc9965bc2b06e7e3ca75a">BLI_movelisttolist</a>(anim_data, &amp;tmp_data);
<a name="l01361"></a>01361         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>((tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == tmp_data.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>) &amp;&amp; (tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));
<a name="l01362"></a>01362         items += tmp_items;
<a name="l01363"></a>01363     }
<a name="l01364"></a>01364     
<a name="l01365"></a>01365     <span class="comment">/* return the number of items added to the list */</span>
<a name="l01366"></a>01366     <span class="keywordflow">return</span> items;
<a name="l01367"></a>01367 }
<a name="l01368"></a>01368 
<a name="l01369"></a>01369 <span class="comment">/* NOTE: owner_id is either material, lamp, or world block, which is the direct owner of the texture stack in question */</span>
<a name="l01370"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#ad27c71ade5ec290bd05bc8dcc4921a55">01370</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#ad27c71ade5ec290bd05bc8dcc4921a55">animdata_filter_ds_textures</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../d8/d7e/structID.html">ID</a> *owner_id, <span class="keywordtype">int</span> filter_mode)
<a name="l01371"></a>01371 {
<a name="l01372"></a>01372     <a class="code" href="../../dc/ddd/structMTex.html">MTex</a> **mtex = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01373"></a>01373     <span class="keywordtype">size_t</span> items=0;
<a name="l01374"></a>01374     <span class="keywordtype">int</span> a=0;
<a name="l01375"></a>01375     
<a name="l01376"></a>01376     <span class="comment">/* get datatype specific data first */</span>
<a name="l01377"></a>01377     <span class="keywordflow">if</span> (owner_id == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01378"></a>01378         <span class="keywordflow">return</span> 0;
<a name="l01379"></a>01379     
<a name="l01380"></a>01380     <span class="keywordflow">switch</span> (<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(owner_id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)) {
<a name="l01381"></a>01381         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#acf5020c901e2793a056ffca95ec8195a">ID_MA</a>:
<a name="l01382"></a>01382         {
<a name="l01383"></a>01383             <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma= (<a class="code" href="../../d2/d10/structMaterial.html">Material</a> *)owner_id;
<a name="l01384"></a>01384             mtex= (<a class="code" href="../../dc/ddd/structMTex.html">MTex</a>**)(&amp;ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a738a376b474b09dba529b222ba7876d6">mtex</a>);
<a name="l01385"></a>01385         }
<a name="l01386"></a>01386             <span class="keywordflow">break</span>;
<a name="l01387"></a>01387         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82e259dda95124fd771a23f105f52810">ID_LA</a>:
<a name="l01388"></a>01388         {
<a name="l01389"></a>01389             <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la= (<a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *)owner_id;
<a name="l01390"></a>01390             mtex= (<a class="code" href="../../dc/ddd/structMTex.html">MTex</a>**)(&amp;la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add02e1f88fe6e0ab0f54de00fd02b49e">mtex</a>);
<a name="l01391"></a>01391         }
<a name="l01392"></a>01392             <span class="keywordflow">break</span>;
<a name="l01393"></a>01393         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa1ab8c153d4a007f72d37a2106ecbfa0">ID_WO</a>:
<a name="l01394"></a>01394         {
<a name="l01395"></a>01395             <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wo= (<a class="code" href="../../d7/d3f/structWorld.html">World</a> *)owner_id;
<a name="l01396"></a>01396             mtex= (<a class="code" href="../../dc/ddd/structMTex.html">MTex</a>**)(&amp;wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#aa41e14c520e87635c6c9a748dd144e25">mtex</a>);
<a name="l01397"></a>01397         }
<a name="l01398"></a>01398             <span class="keywordflow">break</span>;
<a name="l01399"></a>01399         <span class="keywordflow">default</span>: 
<a name="l01400"></a>01400         {
<a name="l01401"></a>01401             <span class="comment">/* invalid/unsupported option */</span>
<a name="l01402"></a>01402             <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635a1207ca157c84a6be5a8a36c691c4aa72">G_DEBUG</a>)
<a name="l01403"></a>01403                 printf(<span class="stringliteral">&quot;ERROR: unsupported owner_id (i.e. texture stack) for filter textures - %s\n&quot;</span>, owner_id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>);
<a name="l01404"></a>01404             <span class="keywordflow">return</span> 0;
<a name="l01405"></a>01405         }
<a name="l01406"></a>01406     }
<a name="l01407"></a>01407     
<a name="l01408"></a>01408     <span class="comment">/* firstly check that we actuallly have some textures, by gathering all textures in a temp list */</span>
<a name="l01409"></a>01409     <span class="keywordflow">for</span> (a=0; a &lt; <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l01410"></a>01410         <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex= (mtex[a]) ? mtex[a]-&gt;tex : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01411"></a>01411         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> tmp_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01412"></a>01412         <span class="keywordtype">size_t</span> tmp_items = 0;
<a name="l01413"></a>01413         
<a name="l01414"></a>01414         <span class="comment">/* for now, if no texture returned, skip (this shouldn&#39;t confuse the user I hope) */</span>
<a name="l01415"></a>01415         <span class="keywordflow">if</span> (tex == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) 
<a name="l01416"></a>01416             <span class="keywordflow">continue</span>;
<a name="l01417"></a>01417         
<a name="l01418"></a>01418         <span class="comment">/* add texture&#39;s animation data to temp collection */</span>
<a name="l01419"></a>01419         <a class="code" href="../../dc/d01/anim__filter_8c.html#ae1e5765ef9b93a06463e6937bcf631e3">BEGIN_ANIMFILTER_SUBCHANNELS</a>(<a class="code" href="../../df/d6f/ED__anim__api_8h.html#ae39260026c6a4359c8afb7611f04c0a1">FILTER_TEX_DATA</a>(tex)) 
<a name="l01420"></a>01420         {
<a name="l01421"></a>01421             <span class="comment">/* texture animdata */</span>
<a name="l01422"></a>01422             tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a852ca4fa579399b1081fe686fdcc9935">animfilter_block_data</a>(ac, &amp;tmp_data, ads, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)tex, filter_mode);
<a name="l01423"></a>01423             
<a name="l01424"></a>01424             <span class="comment">/* nodes */</span>
<a name="l01425"></a>01425             <span class="keywordflow">if</span> ((tex-&gt;nodetree) &amp;&amp; !(ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a1d422997875f522d8959598052e90eab">ADS_FILTER_NONTREE</a>)) {
<a name="l01426"></a>01426                 <span class="comment">/* owner_id as id instead of texture, since it&#39;ll otherwise be impossible to track the depth */</span>
<a name="l01427"></a>01427                 <span class="comment">// FIXME: perhaps as a result, textures should NOT be included under materials, but under their own section instead</span>
<a name="l01428"></a>01428                 <span class="comment">// so that free-floating textures can also be animated</span>
<a name="l01429"></a>01429                 tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#adf32c7e97734f9ccb6612d4c7072ed9c">animdata_filter_ds_nodetree</a>(ac, &amp;tmp_data, ads, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)tex, tex-&gt;nodetree, filter_mode);
<a name="l01430"></a>01430             }
<a name="l01431"></a>01431         }
<a name="l01432"></a>01432         <a class="code" href="../../dc/d01/anim__filter_8c.html#ac3825ee442a35f775be20ca19a4177cb">END_ANIMFILTER_SUBCHANNELS</a>;
<a name="l01433"></a>01433         
<a name="l01434"></a>01434         <span class="comment">/* did we find anything? */</span>
<a name="l01435"></a>01435         <span class="keywordflow">if</span> (tmp_items) {
<a name="l01436"></a>01436             <span class="comment">/* include texture-expand widget? */</span>
<a name="l01437"></a>01437             <span class="keywordflow">if</span> (filter_mode &amp; ANIMFILTER_LIST_CHANNELS) {
<a name="l01438"></a>01438                 <span class="comment">/* check if filtering by active status */</span>
<a name="l01439"></a>01439                 <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#a63183ed1f39a32b7df70adbb9ff1f000">ANIMCHANNEL_ACTIVEOK</a>(tex)) {
<a name="l01440"></a>01440                     <a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">ANIMCHANNEL_NEW_CHANNEL</a>(tex, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a1ac4e0b7a95359f78fe6f8e43512275d">ANIMTYPE_DSTEX</a>, owner_id);
<a name="l01441"></a>01441                 }
<a name="l01442"></a>01442             }
<a name="l01443"></a>01443             
<a name="l01444"></a>01444             <span class="comment">/* now add the list of collected channels */</span>
<a name="l01445"></a>01445             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aea47205fbf4fc9965bc2b06e7e3ca75a">BLI_movelisttolist</a>(anim_data, &amp;tmp_data);
<a name="l01446"></a>01446             <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>((tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == tmp_data.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>) &amp;&amp; (tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));
<a name="l01447"></a>01447             items += tmp_items;
<a name="l01448"></a>01448         }
<a name="l01449"></a>01449     }
<a name="l01450"></a>01450     
<a name="l01451"></a>01451     <span class="comment">/* return the number of items added to the list */</span>
<a name="l01452"></a>01452     <span class="keywordflow">return</span> items;
<a name="l01453"></a>01453 }
<a name="l01454"></a>01454 
<a name="l01455"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#ae0be4e4870761de3e79da1ad74aa8b1b">01455</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#ae0be4e4870761de3e79da1ad74aa8b1b">animdata_filter_ds_materials</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keywordtype">int</span> filter_mode)
<a name="l01456"></a>01456 {
<a name="l01457"></a>01457     <span class="keywordtype">size_t</span> items=0;
<a name="l01458"></a>01458     <span class="keywordtype">int</span> a=0;
<a name="l01459"></a>01459     
<a name="l01460"></a>01460     <span class="comment">/* firstly check that we actuallly have some materials, by gathering all materials in a temp list */</span>
<a name="l01461"></a>01461     <span class="keywordflow">for</span> (a=1; a &lt;= ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad3bbabfca98cb47923254dd04d6961ac">totcol</a>; a++) {
<a name="l01462"></a>01462         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma= <a class="code" href="../../d4/d0f/BKE__material_8h.html#a941f5112d1047bcbcf3e2212685296a5">give_current_material</a>(ob, a);
<a name="l01463"></a>01463         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> tmp_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01464"></a>01464         <span class="keywordtype">size_t</span> tmp_items = 0;
<a name="l01465"></a>01465         
<a name="l01466"></a>01466         <span class="comment">/* if no material returned, skip - so that we don&#39;t get weird blank entries... */</span>
<a name="l01467"></a>01467         <span class="keywordflow">if</span> (ma == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">continue</span>;
<a name="l01468"></a>01468         
<a name="l01469"></a>01469         <span class="comment">/* add material&#39;s animation data to temp collection */</span>
<a name="l01470"></a>01470         <a class="code" href="../../dc/d01/anim__filter_8c.html#ae1e5765ef9b93a06463e6937bcf631e3">BEGIN_ANIMFILTER_SUBCHANNELS</a>(<a class="code" href="../../df/d6f/ED__anim__api_8h.html#a977021b2d018a354ce438c7349d8ee9b">FILTER_MAT_OBJD</a>(ma))
<a name="l01471"></a>01471         {
<a name="l01472"></a>01472             <span class="comment">/* material&#39;s animation data */</span>
<a name="l01473"></a>01473             tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a852ca4fa579399b1081fe686fdcc9935">animfilter_block_data</a>(ac, &amp;tmp_data, ads, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ma, filter_mode);
<a name="l01474"></a>01474                 
<a name="l01475"></a>01475             <span class="comment">/* textures */</span>
<a name="l01476"></a>01476             <span class="keywordflow">if</span> (!(ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a5b8082de076ce09f32d3b0ef97a19a18">ADS_FILTER_NOTEX</a>))
<a name="l01477"></a>01477                 tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#ad27c71ade5ec290bd05bc8dcc4921a55">animdata_filter_ds_textures</a>(ac, &amp;tmp_data, ads, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ma, filter_mode);
<a name="l01478"></a>01478                 
<a name="l01479"></a>01479             <span class="comment">/* nodes */</span>
<a name="l01480"></a>01480             <span class="keywordflow">if</span> ((ma-&gt;nodetree) &amp;&amp; !(ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a1d422997875f522d8959598052e90eab">ADS_FILTER_NONTREE</a>)) 
<a name="l01481"></a>01481                 tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#adf32c7e97734f9ccb6612d4c7072ed9c">animdata_filter_ds_nodetree</a>(ac, &amp;tmp_data, ads, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ma, ma-&gt;nodetree, filter_mode);
<a name="l01482"></a>01482         }
<a name="l01483"></a>01483         <a class="code" href="../../dc/d01/anim__filter_8c.html#ac3825ee442a35f775be20ca19a4177cb">END_ANIMFILTER_SUBCHANNELS</a>;
<a name="l01484"></a>01484         
<a name="l01485"></a>01485         <span class="comment">/* did we find anything? */</span>
<a name="l01486"></a>01486         <span class="keywordflow">if</span> (tmp_items) {
<a name="l01487"></a>01487             <span class="comment">/* include material-expand widget first */</span>
<a name="l01488"></a>01488             <span class="comment">// hmm... do we need to store the index of this material in the array anywhere?</span>
<a name="l01489"></a>01489             <span class="keywordflow">if</span> (filter_mode &amp; ANIMFILTER_LIST_CHANNELS) {
<a name="l01490"></a>01490                 <span class="comment">/* check if filtering by active status */</span>
<a name="l01491"></a>01491                 <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#a63183ed1f39a32b7df70adbb9ff1f000">ANIMCHANNEL_ACTIVEOK</a>(ma)) {
<a name="l01492"></a>01492                     <a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">ANIMCHANNEL_NEW_CHANNEL</a>(ma, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7abb4cbd3d37ed9541439fd5b05540b044">ANIMTYPE_DSMAT</a>, ma);
<a name="l01493"></a>01493                 }
<a name="l01494"></a>01494             }
<a name="l01495"></a>01495             
<a name="l01496"></a>01496             <span class="comment">/* now add the list of collected channels */</span>
<a name="l01497"></a>01497             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aea47205fbf4fc9965bc2b06e7e3ca75a">BLI_movelisttolist</a>(anim_data, &amp;tmp_data);
<a name="l01498"></a>01498             <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>((tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == tmp_data.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>) &amp;&amp; (tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));
<a name="l01499"></a>01499             items += tmp_items;
<a name="l01500"></a>01500         }
<a name="l01501"></a>01501     }
<a name="l01502"></a>01502     
<a name="l01503"></a>01503     <span class="comment">/* return the number of items added to the list */</span>
<a name="l01504"></a>01504     <span class="keywordflow">return</span> items;
<a name="l01505"></a>01505 }
<a name="l01506"></a>01506 
<a name="l01507"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#aac78a2acde6db1526e16af0d81ab8af8">01507</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#aac78a2acde6db1526e16af0d81ab8af8">animdata_filter_ds_particles</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keywordtype">int</span> filter_mode)
<a name="l01508"></a>01508 {
<a name="l01509"></a>01509     <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys;
<a name="l01510"></a>01510     <span class="keywordtype">size_t</span> items= 0;
<a name="l01511"></a>01511 
<a name="l01512"></a>01512     <span class="keywordflow">for</span> (psys = ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; psys; psys=psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a734228c70c56227c6f7a29145a5f5b57">next</a>) {
<a name="l01513"></a>01513         <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> tmp_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01514"></a>01514         <span class="keywordtype">size_t</span> tmp_items = 0;
<a name="l01515"></a>01515         
<a name="l01516"></a>01516         <span class="comment">/* if no material returned, skip - so that we don&#39;t get weird blank entries... */</span>
<a name="l01517"></a>01517         <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a35cf38441722e9b029ac80ee28f63031">adt</a>))
<a name="l01518"></a>01518             <span class="keywordflow">continue</span>;
<a name="l01519"></a>01519         
<a name="l01520"></a>01520         <span class="comment">/* add particle-system&#39;s animation data to temp collection */</span>
<a name="l01521"></a>01521         <a class="code" href="../../dc/d01/anim__filter_8c.html#ae1e5765ef9b93a06463e6937bcf631e3">BEGIN_ANIMFILTER_SUBCHANNELS</a>(<a class="code" href="../../df/d6f/ED__anim__api_8h.html#af960bb2eec00e47f38619d966a4fd2f9">FILTER_PART_OBJD</a>(psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>))
<a name="l01522"></a>01522         {
<a name="l01523"></a>01523             <span class="comment">/* material&#39;s animation data */</span>
<a name="l01524"></a>01524             tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a852ca4fa579399b1081fe686fdcc9935">animfilter_block_data</a>(ac, &amp;tmp_data, ads, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>, filter_mode);
<a name="l01525"></a>01525         }
<a name="l01526"></a>01526         <a class="code" href="../../dc/d01/anim__filter_8c.html#ac3825ee442a35f775be20ca19a4177cb">END_ANIMFILTER_SUBCHANNELS</a>;
<a name="l01527"></a>01527         
<a name="l01528"></a>01528         <span class="comment">/* did we find anything? */</span>
<a name="l01529"></a>01529         <span class="keywordflow">if</span> (tmp_items) {
<a name="l01530"></a>01530             <span class="comment">/* include particle-expand widget first */</span>
<a name="l01531"></a>01531             <span class="keywordflow">if</span> (filter_mode &amp; ANIMFILTER_LIST_CHANNELS) {
<a name="l01532"></a>01532                 <span class="comment">/* check if filtering by active status */</span>
<a name="l01533"></a>01533                 <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#a63183ed1f39a32b7df70adbb9ff1f000">ANIMCHANNEL_ACTIVEOK</a>(psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>)) {
<a name="l01534"></a>01534                     <a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">ANIMCHANNEL_NEW_CHANNEL</a>(psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a4a5ae82ee6744695e90970c6f903ae84">ANIMTYPE_DSPART</a>, psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>);
<a name="l01535"></a>01535                 }
<a name="l01536"></a>01536             }
<a name="l01537"></a>01537             
<a name="l01538"></a>01538             <span class="comment">/* now add the list of collected channels */</span>
<a name="l01539"></a>01539             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aea47205fbf4fc9965bc2b06e7e3ca75a">BLI_movelisttolist</a>(anim_data, &amp;tmp_data);
<a name="l01540"></a>01540             <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>((tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == tmp_data.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>) &amp;&amp; (tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));
<a name="l01541"></a>01541             items += tmp_items;
<a name="l01542"></a>01542         }
<a name="l01543"></a>01543     }
<a name="l01544"></a>01544     
<a name="l01545"></a>01545     <span class="comment">/* return the number of items added to the list */</span>
<a name="l01546"></a>01546     <span class="keywordflow">return</span> items;
<a name="l01547"></a>01547 }
<a name="l01548"></a>01548 
<a name="l01549"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a7503c251123aaf4abe657b51bda1334f">01549</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#a7503c251123aaf4abe657b51bda1334f">animdata_filter_ds_obdata</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keywordtype">int</span> filter_mode)
<a name="l01550"></a>01550 {
<a name="l01551"></a>01551     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> tmp_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01552"></a>01552     <span class="keywordtype">size_t</span> tmp_items = 0;
<a name="l01553"></a>01553     <span class="keywordtype">size_t</span> items= 0;
<a name="l01554"></a>01554     
<a name="l01555"></a>01555     <a class="code" href="../../d7/dba/structIdAdtTemplate.html">IdAdtTemplate</a> *iat= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01556"></a>01556     <span class="keywordtype">short</span> type=0, expanded=0;
<a name="l01557"></a>01557     
<a name="l01558"></a>01558     <span class="comment">/* get settings based on data type */</span>
<a name="l01559"></a>01559     <span class="keywordflow">switch</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>) {
<a name="l01560"></a>01560         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#afd7fa4376c670f245aeed7a7116c7005">OB_CAMERA</a>: <span class="comment">/* ------- Camera ------------ */</span>
<a name="l01561"></a>01561         {
<a name="l01562"></a>01562             <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *ca= (<a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01563"></a>01563             
<a name="l01564"></a>01564             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a2862589b38866ea51d997e95be95bab6">ADS_FILTER_NOCAM</a>)
<a name="l01565"></a>01565                 <span class="keywordflow">return</span> 0;
<a name="l01566"></a>01566             
<a name="l01567"></a>01567             type= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a3a14d52a78f88fdc99a2d956f16fa188">ANIMTYPE_DSCAM</a>;
<a name="l01568"></a>01568             expanded= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a6827042bd3ecfbd33721beedd214e969">FILTER_CAM_OBJD</a>(ca);
<a name="l01569"></a>01569         }
<a name="l01570"></a>01570             <span class="keywordflow">break</span>;
<a name="l01571"></a>01571         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1514ec0465b89013544107c908e7abca">OB_LAMP</a>: <span class="comment">/* ---------- Lamp ----------- */</span>
<a name="l01572"></a>01572         {
<a name="l01573"></a>01573             <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la= (<a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01574"></a>01574             
<a name="l01575"></a>01575             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a8bdc878d39fff56bb3dad3765175e053">ADS_FILTER_NOLAM</a>)
<a name="l01576"></a>01576                 <span class="keywordflow">return</span> 0;
<a name="l01577"></a>01577             
<a name="l01578"></a>01578             type= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7ac42c61fbe171c491c54180bef0fc5cf8">ANIMTYPE_DSLAM</a>;
<a name="l01579"></a>01579             expanded= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a77b905fd3bc80c53aa99feee0833e581">FILTER_LAM_OBJD</a>(la);
<a name="l01580"></a>01580         }
<a name="l01581"></a>01581             <span class="keywordflow">break</span>;
<a name="l01582"></a>01582         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a885d669104f0c596dabb147f9371ffc3">OB_CURVE</a>: <span class="comment">/* ------- Curve ---------- */</span>
<a name="l01583"></a>01583         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ae247d3ec6e691b7752d8a90065428ecb">OB_SURF</a>: <span class="comment">/* ------- Nurbs Surface ---------- */</span>
<a name="l01584"></a>01584         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1a94162b6fc469957966a01d41ff71d6">OB_FONT</a>: <span class="comment">/* ------- Text Curve ---------- */</span>
<a name="l01585"></a>01585         {
<a name="l01586"></a>01586             <a class="code" href="../../da/d10/structCurve.html">Curve</a> *cu= (<a class="code" href="../../da/d10/structCurve.html">Curve</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01587"></a>01587             
<a name="l01588"></a>01588             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167ac2a18dcd4f9198d1b39c7b7f189159c8">ADS_FILTER_NOCUR</a>)
<a name="l01589"></a>01589                 <span class="keywordflow">return</span> 0;
<a name="l01590"></a>01590             
<a name="l01591"></a>01591             type= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a6526464e0e40895c1585a00c7abff018">ANIMTYPE_DSCUR</a>;
<a name="l01592"></a>01592             expanded= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a94c00c66f4a1cb5e177304d06a206ea2">FILTER_CUR_OBJD</a>(cu);
<a name="l01593"></a>01593         }
<a name="l01594"></a>01594             <span class="keywordflow">break</span>;
<a name="l01595"></a>01595         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a046d883c32490b5c5ca4c5e7b6504e35">OB_MBALL</a>: <span class="comment">/* ------- MetaBall ---------- */</span>
<a name="l01596"></a>01596         {
<a name="l01597"></a>01597             <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb= (<a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01598"></a>01598             
<a name="l01599"></a>01599             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167ae5e449749ddaaad4fe5b303e4e191e4e">ADS_FILTER_NOMBA</a>)
<a name="l01600"></a>01600                 <span class="keywordflow">return</span> 0;
<a name="l01601"></a>01601             
<a name="l01602"></a>01602             type= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a35d4804de835c50c99a3e9c828ea8ef0">ANIMTYPE_DSMBALL</a>;
<a name="l01603"></a>01603             expanded= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aae75882eee0722cd30e88bb1b31a4ee6">FILTER_MBALL_OBJD</a>(mb);
<a name="l01604"></a>01604         }
<a name="l01605"></a>01605             <span class="keywordflow">break</span>;
<a name="l01606"></a>01606         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>: <span class="comment">/* ------- Armature ---------- */</span>
<a name="l01607"></a>01607         {
<a name="l01608"></a>01608             <a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *arm= (<a class="code" href="../../d9/d9f/structbArmature.html">bArmature</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01609"></a>01609             
<a name="l01610"></a>01610             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a06f99c6ebbf85970283440262fcbc726">ADS_FILTER_NOARM</a>)
<a name="l01611"></a>01611                 <span class="keywordflow">return</span> 0;
<a name="l01612"></a>01612             
<a name="l01613"></a>01613             type= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a6d14d789723bb8719a0c28003b003391">ANIMTYPE_DSARM</a>;
<a name="l01614"></a>01614             expanded= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a47d798523a6e403dc6e5bb25db0b2448">FILTER_ARM_OBJD</a>(arm);
<a name="l01615"></a>01615         }
<a name="l01616"></a>01616             <span class="keywordflow">break</span>;
<a name="l01617"></a>01617         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a8359f8b129e965da60eca2cbcec21bfc">OB_MESH</a>: <span class="comment">/* ------- Mesh ---------- */</span>
<a name="l01618"></a>01618         {
<a name="l01619"></a>01619             <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *me= (<a class="code" href="../../da/d29/structMesh.html">Mesh</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01620"></a>01620             
<a name="l01621"></a>01621             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167acc1073220f0d590652958e4cbcb97ce1">ADS_FILTER_NOMESH</a>)
<a name="l01622"></a>01622                 <span class="keywordflow">return</span> 0;
<a name="l01623"></a>01623             
<a name="l01624"></a>01624             type= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7ae35d2cc8157449ed0d3ef9e3b84d1a51">ANIMTYPE_DSMESH</a>;
<a name="l01625"></a>01625             expanded= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a301c6d53edfe18a1c994b21938537e5a">FILTER_MESH_OBJD</a>(me);
<a name="l01626"></a>01626         }
<a name="l01627"></a>01627             <span class="keywordflow">break</span>;
<a name="l01628"></a>01628         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a648672abc238f500c884f10b9416cb27">OB_LATTICE</a>: <span class="comment">/* ---- Lattice ---- */</span>
<a name="l01629"></a>01629         {
<a name="l01630"></a>01630             <a class="code" href="../../dd/d40/structLattice.html">Lattice</a> *lt = (<a class="code" href="../../dd/d40/structLattice.html">Lattice</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01631"></a>01631             
<a name="l01632"></a>01632             <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167aef84496695b37eef8d01ab77108ef80f">ADS_FILTER_NOLAT</a>)
<a name="l01633"></a>01633                 <span class="keywordflow">return</span> 0;
<a name="l01634"></a>01634             
<a name="l01635"></a>01635             type= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a9b80577b1b18330f5b088065fe739a85">ANIMTYPE_DSLAT</a>;
<a name="l01636"></a>01636             expanded= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a6cbb744b165f2c759f04591ea96ee7e4">FILTER_LATTICE_OBJD</a>(lt);
<a name="l01637"></a>01637         }
<a name="l01638"></a>01638             <span class="keywordflow">break</span>;
<a name="l01639"></a>01639         <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#adbb088925cd622aa2bacd6c46c161549">OB_SPEAKER</a>: <span class="comment">/* ---------- Speaker ----------- */</span>
<a name="l01640"></a>01640         {
<a name="l01641"></a>01641             <a class="code" href="../../d0/d89/structSpeaker.html">Speaker</a> *spk= (<a class="code" href="../../d0/d89/structSpeaker.html">Speaker</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01642"></a>01642             
<a name="l01643"></a>01643             type= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a185201d27a1b9e1435c1b0f0542ecef2">ANIMTYPE_DSSPK</a>;
<a name="l01644"></a>01644             expanded= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a06aeb4e13a927d820d73bdbc4fd952de">FILTER_SPK_OBJD</a>(spk);
<a name="l01645"></a>01645         }
<a name="l01646"></a>01646             <span class="keywordflow">break</span>;
<a name="l01647"></a>01647     }
<a name="l01648"></a>01648     
<a name="l01649"></a>01649     <span class="comment">/* add object data animation channels */</span>
<a name="l01650"></a>01650     <a class="code" href="../../dc/d01/anim__filter_8c.html#ae1e5765ef9b93a06463e6937bcf631e3">BEGIN_ANIMFILTER_SUBCHANNELS</a>(expanded)
<a name="l01651"></a>01651     {
<a name="l01652"></a>01652         <span class="comment">/* animation data filtering */</span>
<a name="l01653"></a>01653         tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a852ca4fa579399b1081fe686fdcc9935">animfilter_block_data</a>(ac, &amp;tmp_data, ads, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)iat, filter_mode);
<a name="l01654"></a>01654         
<a name="l01655"></a>01655         <span class="comment">/* sub-data filtering... */</span>
<a name="l01656"></a>01656         <span class="keywordflow">switch</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>) {
<a name="l01657"></a>01657             <span class="keywordflow">case</span> <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1514ec0465b89013544107c908e7abca">OB_LAMP</a>:   <span class="comment">/* lamp - textures */</span>
<a name="l01658"></a>01658             {
<a name="l01659"></a>01659                 <span class="comment">/* textures */</span>
<a name="l01660"></a>01660                 <span class="keywordflow">if</span> (!(ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a5b8082de076ce09f32d3b0ef97a19a18">ADS_FILTER_NOTEX</a>))
<a name="l01661"></a>01661                     tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#ad27c71ade5ec290bd05bc8dcc4921a55">animdata_filter_ds_textures</a>(ac, &amp;tmp_data, ads, ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, filter_mode);
<a name="l01662"></a>01662             }
<a name="l01663"></a>01663                 <span class="keywordflow">break</span>;
<a name="l01664"></a>01664         }
<a name="l01665"></a>01665     }
<a name="l01666"></a>01666     <a class="code" href="../../dc/d01/anim__filter_8c.html#ac3825ee442a35f775be20ca19a4177cb">END_ANIMFILTER_SUBCHANNELS</a>;
<a name="l01667"></a>01667     
<a name="l01668"></a>01668     <span class="comment">/* did we find anything? */</span>
<a name="l01669"></a>01669     <span class="keywordflow">if</span> (tmp_items) {
<a name="l01670"></a>01670         <span class="comment">/* include data-expand widget first */</span>
<a name="l01671"></a>01671         <span class="keywordflow">if</span> (filter_mode &amp; ANIMFILTER_LIST_CHANNELS) {
<a name="l01672"></a>01672             <span class="comment">/* check if filtering by active status */</span>
<a name="l01673"></a>01673             <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#a63183ed1f39a32b7df70adbb9ff1f000">ANIMCHANNEL_ACTIVEOK</a>(iat)) {
<a name="l01674"></a>01674                 <a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">ANIMCHANNEL_NEW_CHANNEL</a>(iat, type, iat);
<a name="l01675"></a>01675             }
<a name="l01676"></a>01676         }
<a name="l01677"></a>01677         
<a name="l01678"></a>01678         <span class="comment">/* now add the list of collected channels */</span>
<a name="l01679"></a>01679         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aea47205fbf4fc9965bc2b06e7e3ca75a">BLI_movelisttolist</a>(anim_data, &amp;tmp_data);
<a name="l01680"></a>01680         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>((tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == tmp_data.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>) &amp;&amp; (tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));
<a name="l01681"></a>01681         items += tmp_items;
<a name="l01682"></a>01682     }
<a name="l01683"></a>01683     
<a name="l01684"></a>01684     <span class="comment">/* return the number of items added to the list */</span>
<a name="l01685"></a>01685     <span class="keywordflow">return</span> items;
<a name="l01686"></a>01686 }
<a name="l01687"></a>01687 
<a name="l01688"></a>01688 <span class="comment">/* shapekey-level animation */</span>
<a name="l01689"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a8e86c8983fb91973190fa5ef919fe3ad">01689</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#a8e86c8983fb91973190fa5ef919fe3ad">animdata_filter_ds_keyanim</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d1/d9e/structKey.html">Key</a> *key, <span class="keywordtype">int</span> filter_mode)
<a name="l01690"></a>01690 {
<a name="l01691"></a>01691     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> tmp_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01692"></a>01692     <span class="keywordtype">size_t</span> tmp_items = 0;
<a name="l01693"></a>01693     <span class="keywordtype">size_t</span> items = 0;
<a name="l01694"></a>01694     
<a name="l01695"></a>01695     <span class="comment">/* add shapekey-level animation channels */</span>
<a name="l01696"></a>01696     <a class="code" href="../../dc/d01/anim__filter_8c.html#ae1e5765ef9b93a06463e6937bcf631e3">BEGIN_ANIMFILTER_SUBCHANNELS</a>(<a class="code" href="../../df/d6f/ED__anim__api_8h.html#a30006fa688daffe3c7d0872e5e07fc3d">FILTER_SKE_OBJD</a>(key))
<a name="l01697"></a>01697     {
<a name="l01698"></a>01698         <span class="comment">/* animation data filtering */</span>
<a name="l01699"></a>01699         tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a852ca4fa579399b1081fe686fdcc9935">animfilter_block_data</a>(ac, &amp;tmp_data, ads, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)key, filter_mode);
<a name="l01700"></a>01700     }
<a name="l01701"></a>01701     <a class="code" href="../../dc/d01/anim__filter_8c.html#ac3825ee442a35f775be20ca19a4177cb">END_ANIMFILTER_SUBCHANNELS</a>;
<a name="l01702"></a>01702     
<a name="l01703"></a>01703     <span class="comment">/* did we find anything? */</span>
<a name="l01704"></a>01704     <span class="keywordflow">if</span> (tmp_items) {
<a name="l01705"></a>01705         <span class="comment">/* include key-expand widget first */</span>
<a name="l01706"></a>01706         <span class="keywordflow">if</span> (filter_mode &amp; ANIMFILTER_LIST_CHANNELS) {
<a name="l01707"></a>01707             <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#a63183ed1f39a32b7df70adbb9ff1f000">ANIMCHANNEL_ACTIVEOK</a>(key)) {
<a name="l01708"></a>01708                 <a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">ANIMCHANNEL_NEW_CHANNEL</a>(key, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7af951f114f33bfd02d3c5a7a5da9f2dd1">ANIMTYPE_DSSKEY</a>, ob);
<a name="l01709"></a>01709             }
<a name="l01710"></a>01710         }
<a name="l01711"></a>01711         
<a name="l01712"></a>01712         <span class="comment">/* now add the list of collected channels */</span>
<a name="l01713"></a>01713         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aea47205fbf4fc9965bc2b06e7e3ca75a">BLI_movelisttolist</a>(anim_data, &amp;tmp_data);
<a name="l01714"></a>01714         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>((tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == tmp_data.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>) &amp;&amp; (tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));
<a name="l01715"></a>01715         items += tmp_items;
<a name="l01716"></a>01716     }
<a name="l01717"></a>01717     
<a name="l01718"></a>01718     <span class="comment">/* return the number of items added to the list */</span>
<a name="l01719"></a>01719     <span class="keywordflow">return</span> items;
<a name="l01720"></a>01720 }
<a name="l01721"></a>01721 
<a name="l01722"></a>01722 <span class="comment">/* object-level animation */</span>
<a name="l01723"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#aade18cd42071de33f8dcd09ee66ad1ae">01723</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#aade18cd42071de33f8dcd09ee66ad1ae">animdata_filter_ds_obanim</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <span class="keywordtype">int</span> filter_mode)
<a name="l01724"></a>01724 {
<a name="l01725"></a>01725     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> tmp_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01726"></a>01726     <span class="keywordtype">size_t</span> tmp_items = 0;
<a name="l01727"></a>01727     <span class="keywordtype">size_t</span> items = 0;
<a name="l01728"></a>01728     
<a name="l01729"></a>01729     <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt = ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>;
<a name="l01730"></a>01730     <span class="keywordtype">short</span> type=0, expanded=1;
<a name="l01731"></a>01731     <span class="keywordtype">void</span> *cdata = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01732"></a>01732     
<a name="l01733"></a>01733     <span class="comment">/* determine the type of expander channels to use */</span>
<a name="l01734"></a>01734     <span class="comment">// this is the best way to do this for now...</span>
<a name="l01735"></a>01735     <a class="code" href="../../dc/d01/anim__filter_8c.html#a6b431d984d5d233b2a81aeb18a24e1fe">ANIMDATA_FILTER_CASES</a>(ob,
<a name="l01736"></a>01736         {<span class="comment">/* AnimData - no channel, but consider data */</span>},
<a name="l01737"></a>01737         {<span class="comment">/* NLA - no channel, but consider data */</span>},
<a name="l01738"></a>01738         {<span class="comment">/* Drivers */</span>
<a name="l01739"></a>01739             type = <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a41dfdec97398e8a5738316456bd87fc8">ANIMTYPE_FILLDRIVERS</a>;
<a name="l01740"></a>01740             cdata = adt;
<a name="l01741"></a>01741             expanded = <a class="code" href="../../df/d6f/ED__anim__api_8h.html#ac880ed67b9e96f73a5d1bbaa28677077">EXPANDED_DRVD</a>(adt);
<a name="l01742"></a>01742         },
<a name="l01743"></a>01743         {<span class="comment">/* Keyframes */</span>
<a name="l01744"></a>01744             type = <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7ae004aa0b2b14ed418ddbd4891b2d22cb">ANIMTYPE_FILLACTD</a>;
<a name="l01745"></a>01745             cdata = adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>;
<a name="l01746"></a>01746             expanded = <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a71e967af3e69df7cb56ae0accf93fd6d">EXPANDED_ACTC</a>(adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>);
<a name="l01747"></a>01747         });
<a name="l01748"></a>01748         
<a name="l01749"></a>01749     <span class="comment">/* add object-level animation channels */</span>
<a name="l01750"></a>01750     <a class="code" href="../../dc/d01/anim__filter_8c.html#ae1e5765ef9b93a06463e6937bcf631e3">BEGIN_ANIMFILTER_SUBCHANNELS</a>(expanded)
<a name="l01751"></a>01751     {
<a name="l01752"></a>01752         <span class="comment">/* animation data filtering */</span>
<a name="l01753"></a>01753         tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a852ca4fa579399b1081fe686fdcc9935">animfilter_block_data</a>(ac, &amp;tmp_data, ads, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ob, filter_mode);
<a name="l01754"></a>01754     }
<a name="l01755"></a>01755     <a class="code" href="../../dc/d01/anim__filter_8c.html#ac3825ee442a35f775be20ca19a4177cb">END_ANIMFILTER_SUBCHANNELS</a>;
<a name="l01756"></a>01756     
<a name="l01757"></a>01757     <span class="comment">/* did we find anything? */</span>
<a name="l01758"></a>01758     <span class="keywordflow">if</span> (tmp_items) {
<a name="l01759"></a>01759         <span class="comment">/* include anim-expand widget first */</span>
<a name="l01760"></a>01760         <span class="keywordflow">if</span> (filter_mode &amp; ANIMFILTER_LIST_CHANNELS) {
<a name="l01761"></a>01761             <span class="keywordflow">if</span> (type != <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a42e07aeda512052bd36a4241279f6958">ANIMTYPE_NONE</a>) {
<a name="l01762"></a>01762                 <span class="comment">/* NOTE: active-status (and the associated checks) don&#39;t apply here... */</span>
<a name="l01763"></a>01763                 <a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">ANIMCHANNEL_NEW_CHANNEL</a>(cdata, type, ob);
<a name="l01764"></a>01764             }
<a name="l01765"></a>01765         }
<a name="l01766"></a>01766         
<a name="l01767"></a>01767         <span class="comment">/* now add the list of collected channels */</span>
<a name="l01768"></a>01768         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aea47205fbf4fc9965bc2b06e7e3ca75a">BLI_movelisttolist</a>(anim_data, &amp;tmp_data);
<a name="l01769"></a>01769         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>((tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == tmp_data.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>) &amp;&amp; (tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));
<a name="l01770"></a>01770         items += tmp_items;
<a name="l01771"></a>01771     }
<a name="l01772"></a>01772     
<a name="l01773"></a>01773     <span class="comment">/* return the number of items added to the list */</span>
<a name="l01774"></a>01774     <span class="keywordflow">return</span> items;
<a name="l01775"></a>01775 }
<a name="l01776"></a>01776 
<a name="l01777"></a>01777 <span class="comment">/* get animation channels from object2 */</span>
<a name="l01778"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a3c4de8fafbabad00fe0ac0ff60a64af9">01778</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#a3c4de8fafbabad00fe0ac0ff60a64af9">animdata_filter_dopesheet_ob</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../d3/da9/structBase.html">Base</a> *base, <span class="keywordtype">int</span> filter_mode)
<a name="l01779"></a>01779 {
<a name="l01780"></a>01780     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> tmp_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01781"></a>01781     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= base-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>;
<a name="l01782"></a>01782     <span class="keywordtype">size_t</span> tmp_items = 0;
<a name="l01783"></a>01783     <span class="keywordtype">size_t</span> items = 0;
<a name="l01784"></a>01784     
<a name="l01785"></a>01785     <span class="comment">/* filter data contained under object first */</span>
<a name="l01786"></a>01786     <a class="code" href="../../dc/d01/anim__filter_8c.html#ae1e5765ef9b93a06463e6937bcf631e3">BEGIN_ANIMFILTER_SUBCHANNELS</a>(<a class="code" href="../../df/d6f/ED__anim__api_8h.html#a82fe4f3a04ec61bd67805f0b2758206a">EXPANDED_OBJC</a>(ob))
<a name="l01787"></a>01787     {
<a name="l01788"></a>01788         <a class="code" href="../../d1/d9e/structKey.html">Key</a> *key= <a class="code" href="../../d5/d17/BKE__key_8h.html#a8f07b4f039eb391df3c5b429d2f79e62">ob_get_key</a>(ob);
<a name="l01789"></a>01789         
<a name="l01790"></a>01790         <span class="comment">/* object-level animation */</span>
<a name="l01791"></a>01791         <span class="keywordflow">if</span> ((ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>) &amp;&amp; !(ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167ac23b41195c5ff9889d9d7e848ad4abd8">ADS_FILTER_NOOBJ</a>)) {
<a name="l01792"></a>01792             tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#aade18cd42071de33f8dcd09ee66ad1ae">animdata_filter_ds_obanim</a>(ac, &amp;tmp_data, ads, ob, filter_mode);
<a name="l01793"></a>01793         }
<a name="l01794"></a>01794         
<a name="l01795"></a>01795         <span class="comment">/* shape-key */</span>
<a name="l01796"></a>01796         <span class="keywordflow">if</span> ((key &amp;&amp; key-&gt;<a class="code" href="../../d1/d9e/structKey.html#a9e6219935b7f5b387610055b81705180">adt</a>) &amp;&amp; !(ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a372cf4a9594952fe835238bb2a94a6a4">ADS_FILTER_NOSHAPEKEYS</a>)) {
<a name="l01797"></a>01797             tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a8e86c8983fb91973190fa5ef919fe3ad">animdata_filter_ds_keyanim</a>(ac, &amp;tmp_data, ads, ob, key, filter_mode);
<a name="l01798"></a>01798         }
<a name="l01799"></a>01799         
<a name="l01800"></a>01800         <span class="comment">/* materials */</span>
<a name="l01801"></a>01801         <span class="keywordflow">if</span> ((ob-&gt;<a class="code" href="../../de/de7/structObject.html#ad3bbabfca98cb47923254dd04d6961ac">totcol</a>) &amp;&amp; !(ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a168c18787d3f5f6850121530340c45eb">ADS_FILTER_NOMAT</a>)) {
<a name="l01802"></a>01802             tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#ae0be4e4870761de3e79da1ad74aa8b1b">animdata_filter_ds_materials</a>(ac, &amp;tmp_data, ads, ob, filter_mode);
<a name="l01803"></a>01803         }
<a name="l01804"></a>01804         
<a name="l01805"></a>01805         <span class="comment">/* object data */</span>
<a name="l01806"></a>01806         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>) {
<a name="l01807"></a>01807             tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a7503c251123aaf4abe657b51bda1334f">animdata_filter_ds_obdata</a>(ac, &amp;tmp_data, ads, ob, filter_mode);
<a name="l01808"></a>01808         }
<a name="l01809"></a>01809         
<a name="l01810"></a>01810         <span class="comment">/* particles */</span>
<a name="l01811"></a>01811         <span class="keywordflow">if</span> ((ob-&gt;<a class="code" href="../../de/de7/structObject.html#a0eef8205764ed3927f48766acf36ea68">particlesystem</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) &amp;&amp; !(ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167acaa258ef3c7ff771736dddba28bc7e86">ADS_FILTER_NOPART</a>)) {
<a name="l01812"></a>01812             tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#aac78a2acde6db1526e16af0d81ab8af8">animdata_filter_ds_particles</a>(ac, &amp;tmp_data, ads, ob, filter_mode);
<a name="l01813"></a>01813         }
<a name="l01814"></a>01814     }
<a name="l01815"></a>01815     <a class="code" href="../../dc/d01/anim__filter_8c.html#ac3825ee442a35f775be20ca19a4177cb">END_ANIMFILTER_SUBCHANNELS</a>;
<a name="l01816"></a>01816     
<a name="l01817"></a>01817     
<a name="l01818"></a>01818     <span class="comment">/* if we collected some channels, add these to the new list... */</span>
<a name="l01819"></a>01819     <span class="keywordflow">if</span> (tmp_items) {
<a name="l01820"></a>01820         <span class="comment">/* firstly add object expander if required */</span>
<a name="l01821"></a>01821         <span class="keywordflow">if</span> (filter_mode &amp; ANIMFILTER_LIST_CHANNELS) {
<a name="l01822"></a>01822             <span class="comment">/* check if filtering by selection */</span>
<a name="l01823"></a>01823             <span class="comment">// XXX: double-check on this - most of the time, a lot of tools need to filter out these channels!</span>
<a name="l01824"></a>01824             <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#a2806079ca9241a2778c90f7fe033e5b3">ANIMCHANNEL_SELOK</a>((base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>))) {
<a name="l01825"></a>01825                 <span class="comment">/* check if filtering by active status */</span>
<a name="l01826"></a>01826                 <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#a63183ed1f39a32b7df70adbb9ff1f000">ANIMCHANNEL_ACTIVEOK</a>(ob)) {
<a name="l01827"></a>01827                     <a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">ANIMCHANNEL_NEW_CHANNEL</a>(base, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7ae2343c6cd206c77f666c41a9fdd2d9b5">ANIMTYPE_OBJECT</a>, ob);
<a name="l01828"></a>01828                 }
<a name="l01829"></a>01829             }
<a name="l01830"></a>01830         }
<a name="l01831"></a>01831         
<a name="l01832"></a>01832         <span class="comment">/* now add the list of collected channels */</span>
<a name="l01833"></a>01833         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aea47205fbf4fc9965bc2b06e7e3ca75a">BLI_movelisttolist</a>(anim_data, &amp;tmp_data);
<a name="l01834"></a>01834         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>((tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == tmp_data.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>) &amp;&amp; (tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));
<a name="l01835"></a>01835         items += tmp_items;
<a name="l01836"></a>01836     }
<a name="l01837"></a>01837     
<a name="l01838"></a>01838     <span class="comment">/* return the number of items added */</span>
<a name="l01839"></a>01839     <span class="keywordflow">return</span> items;
<a name="l01840"></a>01840 }
<a name="l01841"></a>01841 
<a name="l01842"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#ac38b2183e4c913c2fec637f3dc445ce2">01842</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#ac38b2183e4c913c2fec637f3dc445ce2">animdata_filter_ds_world</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce, <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wo, <span class="keywordtype">int</span> filter_mode)
<a name="l01843"></a>01843 {
<a name="l01844"></a>01844     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> tmp_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01845"></a>01845     <span class="keywordtype">size_t</span> tmp_items = 0;
<a name="l01846"></a>01846     <span class="keywordtype">size_t</span> items = 0;
<a name="l01847"></a>01847     
<a name="l01848"></a>01848     <span class="comment">/* add world animation channels */</span>
<a name="l01849"></a>01849     <a class="code" href="../../dc/d01/anim__filter_8c.html#ae1e5765ef9b93a06463e6937bcf631e3">BEGIN_ANIMFILTER_SUBCHANNELS</a>(<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aa1b36088cebbbc332f4fa13a165c0aa2">FILTER_WOR_SCED</a>(wo))
<a name="l01850"></a>01850     {
<a name="l01851"></a>01851         <span class="comment">/* animation data filtering */</span>
<a name="l01852"></a>01852         tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a852ca4fa579399b1081fe686fdcc9935">animfilter_block_data</a>(ac, &amp;tmp_data, ads, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)wo, filter_mode);
<a name="l01853"></a>01853         
<a name="l01854"></a>01854         <span class="comment">/* textures for world */</span>
<a name="l01855"></a>01855         <span class="keywordflow">if</span> (!(ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a5b8082de076ce09f32d3b0ef97a19a18">ADS_FILTER_NOTEX</a>))
<a name="l01856"></a>01856             items += <a class="code" href="../../dc/d01/anim__filter_8c.html#ad27c71ade5ec290bd05bc8dcc4921a55">animdata_filter_ds_textures</a>(ac, &amp;tmp_data, ads, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)wo, filter_mode);
<a name="l01857"></a>01857             
<a name="l01858"></a>01858         <span class="comment">/* nodes */</span>
<a name="l01859"></a>01859         <span class="keywordflow">if</span> ((wo-&gt;nodetree) &amp;&amp; !(ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a1d422997875f522d8959598052e90eab">ADS_FILTER_NONTREE</a>)) 
<a name="l01860"></a>01860             tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#adf32c7e97734f9ccb6612d4c7072ed9c">animdata_filter_ds_nodetree</a>(ac, &amp;tmp_data, ads, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)wo, wo-&gt;nodetree, filter_mode);
<a name="l01861"></a>01861     }
<a name="l01862"></a>01862     <a class="code" href="../../dc/d01/anim__filter_8c.html#ac3825ee442a35f775be20ca19a4177cb">END_ANIMFILTER_SUBCHANNELS</a>;
<a name="l01863"></a>01863     
<a name="l01864"></a>01864     <span class="comment">/* did we find anything? */</span>
<a name="l01865"></a>01865     <span class="keywordflow">if</span> (tmp_items) {
<a name="l01866"></a>01866         <span class="comment">/* include data-expand widget first */</span>
<a name="l01867"></a>01867         <span class="keywordflow">if</span> (filter_mode &amp; ANIMFILTER_LIST_CHANNELS) {
<a name="l01868"></a>01868             <span class="comment">/* check if filtering by active status */</span>
<a name="l01869"></a>01869             <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#a63183ed1f39a32b7df70adbb9ff1f000">ANIMCHANNEL_ACTIVEOK</a>(wo)) {
<a name="l01870"></a>01870                 <a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">ANIMCHANNEL_NEW_CHANNEL</a>(wo, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7af662c20f337a08ea34f7e1e95a8e82c9">ANIMTYPE_DSWOR</a>, sce);
<a name="l01871"></a>01871             }
<a name="l01872"></a>01872         }
<a name="l01873"></a>01873         
<a name="l01874"></a>01874         <span class="comment">/* now add the list of collected channels */</span>
<a name="l01875"></a>01875         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aea47205fbf4fc9965bc2b06e7e3ca75a">BLI_movelisttolist</a>(anim_data, &amp;tmp_data);
<a name="l01876"></a>01876         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>((tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == tmp_data.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>) &amp;&amp; (tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));
<a name="l01877"></a>01877         items += tmp_items;
<a name="l01878"></a>01878     }
<a name="l01879"></a>01879     
<a name="l01880"></a>01880     <span class="comment">/* return the number of items added to the list */</span>
<a name="l01881"></a>01881     <span class="keywordflow">return</span> items;
<a name="l01882"></a>01882 }
<a name="l01883"></a>01883 
<a name="l01884"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a2e5ff663b2e2902b200125ce290df7ba">01884</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#a2e5ff663b2e2902b200125ce290df7ba">animdata_filter_ds_scene</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce, <span class="keywordtype">int</span> filter_mode)
<a name="l01885"></a>01885 {
<a name="l01886"></a>01886     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> tmp_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01887"></a>01887     <span class="keywordtype">size_t</span> tmp_items = 0;
<a name="l01888"></a>01888     <span class="keywordtype">size_t</span> items = 0;
<a name="l01889"></a>01889     
<a name="l01890"></a>01890     <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt = sce-&gt;<a class="code" href="../../d9/d27/structScene.html#abdea91c45720e729d4fd49b37fee664e">adt</a>;
<a name="l01891"></a>01891     <span class="keywordtype">short</span> type=0, expanded=1;
<a name="l01892"></a>01892     <span class="keywordtype">void</span> *cdata = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01893"></a>01893     
<a name="l01894"></a>01894     <span class="comment">/* determine the type of expander channels to use */</span>
<a name="l01895"></a>01895     <span class="comment">// this is the best way to do this for now...</span>
<a name="l01896"></a>01896     <a class="code" href="../../dc/d01/anim__filter_8c.html#a6b431d984d5d233b2a81aeb18a24e1fe">ANIMDATA_FILTER_CASES</a>(sce,
<a name="l01897"></a>01897         {<span class="comment">/* AnimData - no channel, but consider data */</span>},
<a name="l01898"></a>01898         {<span class="comment">/* NLA - no channel, but consider data */</span>},
<a name="l01899"></a>01899         {<span class="comment">/* Drivers */</span>
<a name="l01900"></a>01900             type = <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a41dfdec97398e8a5738316456bd87fc8">ANIMTYPE_FILLDRIVERS</a>;
<a name="l01901"></a>01901             cdata = adt;
<a name="l01902"></a>01902             expanded = <a class="code" href="../../df/d6f/ED__anim__api_8h.html#ac880ed67b9e96f73a5d1bbaa28677077">EXPANDED_DRVD</a>(adt);
<a name="l01903"></a>01903         },
<a name="l01904"></a>01904         {<span class="comment">/* Keyframes */</span>
<a name="l01905"></a>01905             type = <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7ae004aa0b2b14ed418ddbd4891b2d22cb">ANIMTYPE_FILLACTD</a>;
<a name="l01906"></a>01906             cdata = adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>;
<a name="l01907"></a>01907             expanded = <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a71e967af3e69df7cb56ae0accf93fd6d">EXPANDED_ACTC</a>(adt-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a14a8b84cc330ffddb772fe4a224eba0a">action</a>);
<a name="l01908"></a>01908         });
<a name="l01909"></a>01909         
<a name="l01910"></a>01910     <span class="comment">/* add scene-level animation channels */</span>
<a name="l01911"></a>01911     <a class="code" href="../../dc/d01/anim__filter_8c.html#ae1e5765ef9b93a06463e6937bcf631e3">BEGIN_ANIMFILTER_SUBCHANNELS</a>(expanded)
<a name="l01912"></a>01912     {
<a name="l01913"></a>01913         <span class="comment">/* animation data filtering */</span>
<a name="l01914"></a>01914         tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a852ca4fa579399b1081fe686fdcc9935">animfilter_block_data</a>(ac, &amp;tmp_data, ads, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)sce, filter_mode);
<a name="l01915"></a>01915     }
<a name="l01916"></a>01916     <a class="code" href="../../dc/d01/anim__filter_8c.html#ac3825ee442a35f775be20ca19a4177cb">END_ANIMFILTER_SUBCHANNELS</a>;
<a name="l01917"></a>01917     
<a name="l01918"></a>01918     <span class="comment">/* did we find anything? */</span>
<a name="l01919"></a>01919     <span class="keywordflow">if</span> (tmp_items) {
<a name="l01920"></a>01920         <span class="comment">/* include anim-expand widget first */</span>
<a name="l01921"></a>01921         <span class="keywordflow">if</span> (filter_mode &amp; ANIMFILTER_LIST_CHANNELS) {
<a name="l01922"></a>01922             <span class="keywordflow">if</span> (type != <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a42e07aeda512052bd36a4241279f6958">ANIMTYPE_NONE</a>) {
<a name="l01923"></a>01923                 <span class="comment">/* NOTE: active-status (and the associated checks) don&#39;t apply here... */</span>
<a name="l01924"></a>01924                 <a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">ANIMCHANNEL_NEW_CHANNEL</a>(cdata, type, sce);
<a name="l01925"></a>01925             }
<a name="l01926"></a>01926         }
<a name="l01927"></a>01927         
<a name="l01928"></a>01928         <span class="comment">/* now add the list of collected channels */</span>
<a name="l01929"></a>01929         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aea47205fbf4fc9965bc2b06e7e3ca75a">BLI_movelisttolist</a>(anim_data, &amp;tmp_data);
<a name="l01930"></a>01930         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>((tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == tmp_data.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>) &amp;&amp; (tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));
<a name="l01931"></a>01931         items += tmp_items;
<a name="l01932"></a>01932     }
<a name="l01933"></a>01933     
<a name="l01934"></a>01934     <span class="comment">/* return the number of items added to the list */</span>
<a name="l01935"></a>01935     <span class="keywordflow">return</span> items;
<a name="l01936"></a>01936 }
<a name="l01937"></a>01937 
<a name="l01938"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#ac6703c788e87178608667d9d0c3c2de3">01938</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#ac6703c788e87178608667d9d0c3c2de3">animdata_filter_dopesheet_scene</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce, <span class="keywordtype">int</span> filter_mode)
<a name="l01939"></a>01939 {
<a name="l01940"></a>01940     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> tmp_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01941"></a>01941     <span class="keywordtype">size_t</span> tmp_items = 0;
<a name="l01942"></a>01942     <span class="keywordtype">size_t</span> items = 0;
<a name="l01943"></a>01943     
<a name="l01944"></a>01944     <span class="comment">/* filter data contained under object first */</span>
<a name="l01945"></a>01945     <a class="code" href="../../dc/d01/anim__filter_8c.html#ae1e5765ef9b93a06463e6937bcf631e3">BEGIN_ANIMFILTER_SUBCHANNELS</a>(<a class="code" href="../../df/d6f/ED__anim__api_8h.html#a37654dda54938466989739207d34a8fd">EXPANDED_SCEC</a>(sce))
<a name="l01946"></a>01946     {
<a name="l01947"></a>01947         <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>;
<a name="l01948"></a>01948         <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wo= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aefac18ed3d1ded63b012f79a3ca8ddb2">world</a>;
<a name="l01949"></a>01949         
<a name="l01950"></a>01950         <span class="comment">/* Action, Drivers, or NLA for Scene */</span>
<a name="l01951"></a>01951         <span class="keywordflow">if</span> ((ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a886b50e0ba71d49d3ce8967631a668f6">ADS_FILTER_NOSCE</a>) == 0) {
<a name="l01952"></a>01952             tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a2e5ff663b2e2902b200125ce290df7ba">animdata_filter_ds_scene</a>(ac, &amp;tmp_data, ads, sce, filter_mode);
<a name="l01953"></a>01953         }
<a name="l01954"></a>01954         
<a name="l01955"></a>01955         <span class="comment">/* world */</span>
<a name="l01956"></a>01956         <span class="keywordflow">if</span> ((wo) &amp;&amp; !(ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167ae1d0c53cccdd1ae938a197eb989fd3be">ADS_FILTER_NOWOR</a>)) {
<a name="l01957"></a>01957             tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#ac38b2183e4c913c2fec637f3dc445ce2">animdata_filter_ds_world</a>(ac, &amp;tmp_data, ads, sce, wo, filter_mode);
<a name="l01958"></a>01958         }
<a name="l01959"></a>01959         
<a name="l01960"></a>01960         <span class="comment">/* nodetree */</span>
<a name="l01961"></a>01961         <span class="keywordflow">if</span> ((ntree) &amp;&amp; !(ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a1d422997875f522d8959598052e90eab">ADS_FILTER_NONTREE</a>)) {
<a name="l01962"></a>01962             tmp_items += <a class="code" href="../../dc/d01/anim__filter_8c.html#adf32c7e97734f9ccb6612d4c7072ed9c">animdata_filter_ds_nodetree</a>(ac, &amp;tmp_data, ads, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)sce, ntree, filter_mode);
<a name="l01963"></a>01963         }
<a name="l01964"></a>01964         
<a name="l01965"></a>01965         <span class="comment">// TODO: one day, when sequencer becomes its own datatype, perhaps it should be included here</span>
<a name="l01966"></a>01966     }
<a name="l01967"></a>01967     <a class="code" href="../../dc/d01/anim__filter_8c.html#ac3825ee442a35f775be20ca19a4177cb">END_ANIMFILTER_SUBCHANNELS</a>;
<a name="l01968"></a>01968     
<a name="l01969"></a>01969     <span class="comment">/* if we collected some channels, add these to the new list... */</span>
<a name="l01970"></a>01970     <span class="keywordflow">if</span> (tmp_items) {
<a name="l01971"></a>01971         <span class="comment">/* firstly add object expander if required */</span>
<a name="l01972"></a>01972         <span class="keywordflow">if</span> (filter_mode &amp; ANIMFILTER_LIST_CHANNELS) {
<a name="l01973"></a>01973             <span class="comment">/* check if filtering by selection */</span>
<a name="l01974"></a>01974             <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#a2806079ca9241a2778c90f7fe033e5b3">ANIMCHANNEL_SELOK</a>((sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a60b2a18bedc706447c394de96c276eac">flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ad880593820ce218f61b493c8406ffaf3">SCE_DS_SELECTED</a>))) {
<a name="l01975"></a>01975                 <span class="comment">/* NOTE: active-status doesn&#39;t matter for this! */</span>
<a name="l01976"></a>01976                 <a class="code" href="../../dc/d01/anim__filter_8c.html#a25216e77a47629cdb691daa2f4a3fea3">ANIMCHANNEL_NEW_CHANNEL</a>(sce, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a6beea10df4db5286f40a857d7d837f17">ANIMTYPE_SCENE</a>, sce);
<a name="l01977"></a>01977             }
<a name="l01978"></a>01978         }
<a name="l01979"></a>01979         
<a name="l01980"></a>01980         <span class="comment">/* now add the list of collected channels */</span>
<a name="l01981"></a>01981         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aea47205fbf4fc9965bc2b06e7e3ca75a">BLI_movelisttolist</a>(anim_data, &amp;tmp_data);
<a name="l01982"></a>01982         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa0fb403a3d83d016acdc506b2d4607cb">BLI_assert</a>((tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == tmp_data.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>) &amp;&amp; (tmp_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));
<a name="l01983"></a>01983         items += tmp_items;
<a name="l01984"></a>01984     }
<a name="l01985"></a>01985     
<a name="l01986"></a>01986     <span class="comment">/* return the number of items added */</span>
<a name="l01987"></a>01987     <span class="keywordflow">return</span> items;
<a name="l01988"></a>01988 }
<a name="l01989"></a>01989 
<a name="l01990"></a>01990 <span class="comment">// TODO: implement pinning... (if and when pinning is done, what we need to do is to provide freeing mechanisms - to protect against data that was deleted)</span>
<a name="l01991"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a5e80c725aa43f7f321f97fd927a76705">01991</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#a5e80c725aa43f7f321f97fd927a76705">animdata_filter_dopesheet</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <span class="keywordtype">int</span> filter_mode)
<a name="l01992"></a>01992 {
<a name="l01993"></a>01993     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce= (<a class="code" href="../../d9/d27/structScene.html">Scene</a> *)ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>;
<a name="l01994"></a>01994     <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l01995"></a>01995     <span class="keywordtype">size_t</span> items = 0;
<a name="l01996"></a>01996     
<a name="l01997"></a>01997     <span class="comment">/* check that we do indeed have a scene */</span>
<a name="l01998"></a>01998     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> ((ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)!=<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac2b425dbd1f73ad1720fafad2626d974">ID_SCE</a>)) {
<a name="l01999"></a>01999         printf(<span class="stringliteral">&quot;DopeSheet Error: Not scene!\n&quot;</span>);
<a name="l02000"></a>02000         <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635a1207ca157c84a6be5a8a36c691c4aa72">G_DEBUG</a>)
<a name="l02001"></a>02001             printf(<span class="stringliteral">&quot;\tPointer = %p, Name = &#39;%s&#39;\n&quot;</span>, (<span class="keywordtype">void</span> *)ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>, (ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>)?ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#af9b8583360262fc287f87d09fbf91c2f">source</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>:<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02002"></a>02002         <span class="keywordflow">return</span> 0;
<a name="l02003"></a>02003     }
<a name="l02004"></a>02004     
<a name="l02005"></a>02005     <span class="comment">/* augment the filter-flags with settings based on the dopesheet filterflags </span>
<a name="l02006"></a>02006 <span class="comment">     * so that some temp settings can get added automagically...</span>
<a name="l02007"></a>02007 <span class="comment">     */</span>
<a name="l02008"></a>02008     <span class="keywordflow">if</span> (ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a7ff587ec77ece30ccebaeb2a35b8e364">ADS_FILTER_SELEDIT</a>) {
<a name="l02009"></a>02009         <span class="comment">/* only selected F-Curves should get their keyframes considered for editability */</span>
<a name="l02010"></a>02010         filter_mode |= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a7a5892ffcc39dd77f5281353825f9ff4">ANIMFILTER_SELEDIT</a>;
<a name="l02011"></a>02011     }
<a name="l02012"></a>02012     
<a name="l02013"></a>02013     <span class="comment">/* scene-linked animation - e.g. world, compositing nodes, scene anim (including sequencer currently) */</span>
<a name="l02014"></a>02014     items += <a class="code" href="../../dc/d01/anim__filter_8c.html#ac6703c788e87178608667d9d0c3c2de3">animdata_filter_dopesheet_scene</a>(ac, anim_data, ads, sce, filter_mode);
<a name="l02015"></a>02015     
<a name="l02016"></a>02016     <span class="comment">/* loop over all bases (i.e.objects) in the scene */</span>
<a name="l02017"></a>02017     <span class="keywordflow">for</span> (base= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a21ace55307d1ca141e265b3f55fa37d9">base</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; base; base= base-&gt;next) {
<a name="l02018"></a>02018         <span class="comment">/* check if there&#39;s an object (all the relevant checks are done in the ob-function) */</span>
<a name="l02019"></a>02019         <span class="keywordflow">if</span> (base-&gt;object) {
<a name="l02020"></a>02020             <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= base-&gt;object;
<a name="l02021"></a>02021             
<a name="l02022"></a>02022             <span class="comment">/* firstly, check if object can be included, by the following factors:</span>
<a name="l02023"></a>02023 <span class="comment">             *  - if only visible, must check for layer and also viewport visibility</span>
<a name="l02024"></a>02024 <span class="comment">             *      --&gt; while tools may demand only visible, user setting takes priority</span>
<a name="l02025"></a>02025 <span class="comment">             *          as user option controls whether sets of channels get included while</span>
<a name="l02026"></a>02026 <span class="comment">             *          tool-flag takes into account collapsed/open channels too</span>
<a name="l02027"></a>02027 <span class="comment">             *  - if only selected, must check if object is selected </span>
<a name="l02028"></a>02028 <span class="comment">             *  - there must be animation data to edit (this is done recursively as we </span>
<a name="l02029"></a>02029 <span class="comment">             *    try to add the channels)</span>
<a name="l02030"></a>02030 <span class="comment">             */</span>
<a name="l02031"></a>02031             <span class="keywordflow">if</span> ((filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a>) &amp;&amp; !(ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167ae57a6ca95f7ac35691a6b67ee3cfa0b2">ADS_FILTER_INCL_HIDDEN</a>)) {
<a name="l02032"></a>02032                 <span class="comment">/* layer visibility - we check both object and base, since these may not be in sync yet */</span>
<a name="l02033"></a>02033                 <span class="keywordflow">if</span> ((sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a506dd867fc58506c37c1e56f6b134056">lay</a> &amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa9cfa964651e1e2f3044c9c79cf004b3">lay</a>|base-&gt;lay))==0) <span class="keywordflow">continue</span>;
<a name="l02034"></a>02034                 
<a name="l02035"></a>02035                 <span class="comment">/* outliner restrict-flag */</span>
<a name="l02036"></a>02036                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#afc7a8aca0c2cf33c6323883e313362b0">restrictflag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a405802c89add02dcf80f5fbcce040b09">OB_RESTRICT_VIEW</a>) <span class="keywordflow">continue</span>;
<a name="l02037"></a>02037             }
<a name="l02038"></a>02038             
<a name="l02039"></a>02039             <span class="comment">/* if only F-Curves with visible flags set can be shown, check that </span>
<a name="l02040"></a>02040 <span class="comment">             * datablock hasn&#39;t been set to invisible </span>
<a name="l02041"></a>02041 <span class="comment">             */</span>
<a name="l02042"></a>02042             <span class="keywordflow">if</span> (filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a6c5e4b5cf2c3e1b6558850c56dbd490c">ANIMFILTER_CURVE_VISIBLE</a>) {
<a name="l02043"></a>02043                 <span class="keywordflow">if</span> ((ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>) &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>-&gt;<a class="code" href="../../d1/d5c/structAnimData.html#a057740ebd2ecdddb141073b0f2e0f441">flag</a> &amp; <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a0da68d088688075989bcf4f547c5b673a5e6f8fcb10f8fc62c691517de47779b3">ADT_CURVES_NOT_VISIBLE</a>))
<a name="l02044"></a>02044                     <span class="keywordflow">continue</span>;
<a name="l02045"></a>02045             }
<a name="l02046"></a>02046             
<a name="l02047"></a>02047             <span class="comment">/* check selection and object type filters */</span>
<a name="l02048"></a>02048             <span class="keywordflow">if</span> ( (ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a0642ce38ad5a37344a8a54ddad70b1c1">ADS_FILTER_ONLYSEL</a>) &amp;&amp; !((base-&gt;flag &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) <span class="comment">/*|| (base == sce-&gt;basact)*/</span>) ) {
<a name="l02049"></a>02049                 <span class="comment">/* only selected should be shown */</span>
<a name="l02050"></a>02050                 <span class="keywordflow">continue</span>;
<a name="l02051"></a>02051             }
<a name="l02052"></a>02052             
<a name="l02053"></a>02053             <span class="comment">/* check if object belongs to the filtering group if option to filter </span>
<a name="l02054"></a>02054 <span class="comment">             * objects by the grouped status is on</span>
<a name="l02055"></a>02055 <span class="comment">             *  - used to ease the process of doing multiple-character choreographies</span>
<a name="l02056"></a>02056 <span class="comment">             */</span>
<a name="l02057"></a>02057             <span class="keywordflow">if</span> (ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167a8c716fde7793cc0dbcde5deb6e821eb5">ADS_FILTER_ONLYOBGROUP</a>) {
<a name="l02058"></a>02058                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/df5/BKE__group_8h.html#ad5a2f1b7be24a719b00ed2b01963fb33">object_in_group</a>(ob, ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#a0ce58011be9c23f9e3c3151615515015">filter_grp</a>) == 0)
<a name="l02059"></a>02059                     <span class="keywordflow">continue</span>;
<a name="l02060"></a>02060             }
<a name="l02061"></a>02061                 
<a name="l02062"></a>02062             <span class="comment">/* since we&#39;re still here, this object should be usable */</span>
<a name="l02063"></a>02063             items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a3c4de8fafbabad00fe0ac0ff60a64af9">animdata_filter_dopesheet_ob</a>(ac, anim_data, ads, base, filter_mode);
<a name="l02064"></a>02064         }
<a name="l02065"></a>02065     }
<a name="l02066"></a>02066     
<a name="l02067"></a>02067     <span class="comment">/* return the number of items in the list */</span>
<a name="l02068"></a>02068     <span class="keywordflow">return</span> items;
<a name="l02069"></a>02069 }
<a name="l02070"></a>02070 
<a name="l02071"></a>02071 <span class="comment">/* Summary track for DopeSheet/Action Editor </span>
<a name="l02072"></a>02072 <span class="comment"> *  - return code is whether the summary lets the other channels get drawn</span>
<a name="l02073"></a>02073 <span class="comment"> */</span>
<a name="l02074"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a98d6269d96cd05bb02b3168dfed343b6">02074</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#a98d6269d96cd05bb02b3168dfed343b6">animdata_filter_dopesheet_summary</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <span class="keywordtype">int</span> filter_mode, <span class="keywordtype">size_t</span> *items)
<a name="l02075"></a>02075 {
<a name="l02076"></a>02076     <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02077"></a>02077     
<a name="l02078"></a>02078     <span class="comment">/* get the DopeSheet information to use </span>
<a name="l02079"></a>02079 <span class="comment">     *  - we should only need to deal with the DopeSheet/Action Editor, </span>
<a name="l02080"></a>02080 <span class="comment">     *    since all the other Animation Editors won&#39;t have this concept</span>
<a name="l02081"></a>02081 <span class="comment">     *    being applicable.</span>
<a name="l02082"></a>02082 <span class="comment">     */</span>
<a name="l02083"></a>02083     <span class="keywordflow">if</span> ((ac &amp;&amp; ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#ace702244f50216d9ca6d1112f6a45c77">sl</a>) &amp;&amp; (ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a526ad3411cc520d80945ccd256711f40">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca154950ac39aa053ba159ffbe6768eb68">SPACE_ACTION</a>)) {
<a name="l02084"></a>02084         <a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *saction= (<a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *)ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#ace702244f50216d9ca6d1112f6a45c77">sl</a>;
<a name="l02085"></a>02085         ads= &amp;saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a37c4236d666d2c560e470fa42794b29f">ads</a>;
<a name="l02086"></a>02086     }
<a name="l02087"></a>02087     <span class="keywordflow">else</span> {
<a name="l02088"></a>02088         <span class="comment">/* invalid space type - skip this summary channels */</span>
<a name="l02089"></a>02089         <span class="keywordflow">return</span> 1;
<a name="l02090"></a>02090     }
<a name="l02091"></a>02091     
<a name="l02092"></a>02092     <span class="comment">/* dopesheet summary </span>
<a name="l02093"></a>02093 <span class="comment">     *  - only for drawing and/or selecting keyframes in channels, but not for real editing </span>
<a name="l02094"></a>02094 <span class="comment">     *  - only useful for DopeSheet/Action/etc. editors where it is actually useful</span>
<a name="l02095"></a>02095 <span class="comment">     */</span>
<a name="l02096"></a>02096     <span class="keywordflow">if</span> ((filter_mode &amp; ANIMFILTER_LIST_CHANNELS) &amp;&amp; (ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#adfdb4db9d75595b7745617c9228f6c2d">filterflag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#a21edbff66ba12679ff0278d89fb88167ab5fa15b1951927bcd450bcac86a4c08f">ADS_FILTER_SUMMARY</a>)) {
<a name="l02097"></a>02097         <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale= <a class="code" href="../../dc/d01/anim__filter_8c.html#aff7936398344cab2fe37f40fbf434f48">make_new_animlistelem</a>(ac, <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a1ec0c4967d46aaf6b87c893c81221ed4">ANIMTYPE_SUMMARY</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02098"></a>02098         <span class="keywordflow">if</span> (ale) {
<a name="l02099"></a>02099             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(anim_data, ale);
<a name="l02100"></a>02100             (*items)++;
<a name="l02101"></a>02101         }
<a name="l02102"></a>02102         
<a name="l02103"></a>02103         <span class="comment">/* if summary is collapsed, don&#39;t show other channels beneath this </span>
<a name="l02104"></a>02104 <span class="comment">         *  - this check is put inside the summary check so that it doesn&#39;t interfere with normal operation</span>
<a name="l02105"></a>02105 <span class="comment">         */</span> 
<a name="l02106"></a>02106         <span class="keywordflow">if</span> (ads-&gt;<a class="code" href="../../df/de9/structbDopeSheet.html#ae0be31064e1f1632cb359aa7299a54e7">flag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#acae94b865a0c3ad84897e04f61c7100ba478aef268aebbcf82b1dbcb8ed25d4df">ADS_FLAG_SUMMARY_COLLAPSED</a>)
<a name="l02107"></a>02107             <span class="keywordflow">return</span> 0;
<a name="l02108"></a>02108     }
<a name="l02109"></a>02109     
<a name="l02110"></a>02110     <span class="comment">/* the other channels beneath this can be shown */</span>
<a name="l02111"></a>02111     <span class="keywordflow">return</span> 1;
<a name="l02112"></a>02112 }  
<a name="l02113"></a>02113 
<a name="l02114"></a>02114 <span class="comment">/* ......................... */</span>
<a name="l02115"></a>02115 
<a name="l02116"></a>02116 <span class="comment">/* filter data associated with a channel - usually for handling summary-channels in DopeSheet */</span>
<a name="l02117"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a82af431ef343cfa45f1841032c9f6961">02117</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#a82af431ef343cfa45f1841032c9f6961">animdata_filter_animchan</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads, <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *channel, <span class="keywordtype">int</span> filter_mode)
<a name="l02118"></a>02118 {
<a name="l02119"></a>02119     <span class="keywordtype">size_t</span> items = 0;
<a name="l02120"></a>02120     
<a name="l02121"></a>02121     <span class="comment">/* data to filter depends on channel type */</span>
<a name="l02122"></a>02122     <span class="comment">// XXX: only common channel-types have been handled for now</span>
<a name="l02123"></a>02123     <span class="keywordflow">switch</span> (channel-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a>) {
<a name="l02124"></a>02124         <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a1ec0c4967d46aaf6b87c893c81221ed4">ANIMTYPE_SUMMARY</a>:
<a name="l02125"></a>02125             items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a5e80c725aa43f7f321f97fd927a76705">animdata_filter_dopesheet</a>(ac, anim_data, ads, filter_mode);
<a name="l02126"></a>02126             <span class="keywordflow">break</span>;
<a name="l02127"></a>02127             
<a name="l02128"></a>02128         <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a6beea10df4db5286f40a857d7d837f17">ANIMTYPE_SCENE</a>:
<a name="l02129"></a>02129             items += <a class="code" href="../../dc/d01/anim__filter_8c.html#ac6703c788e87178608667d9d0c3c2de3">animdata_filter_dopesheet_scene</a>(ac, anim_data, ads, channel-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>, filter_mode);
<a name="l02130"></a>02130             <span class="keywordflow">break</span>;
<a name="l02131"></a>02131         
<a name="l02132"></a>02132         <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7ae2343c6cd206c77f666c41a9fdd2d9b5">ANIMTYPE_OBJECT</a>:
<a name="l02133"></a>02133             items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a3c4de8fafbabad00fe0ac0ff60a64af9">animdata_filter_dopesheet_ob</a>(ac, anim_data, ads, channel-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>, filter_mode);
<a name="l02134"></a>02134             <span class="keywordflow">break</span>;
<a name="l02135"></a>02135     }
<a name="l02136"></a>02136     
<a name="l02137"></a>02137     <span class="keywordflow">return</span> items;
<a name="l02138"></a>02138 }
<a name="l02139"></a>02139 
<a name="l02140"></a>02140 <span class="comment">/* ----------- Cleanup API --------------- */</span>
<a name="l02141"></a>02141 
<a name="l02142"></a>02142 <span class="comment">/* Remove entries with invalid types in animation channel list */</span>
<a name="l02143"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#a72a916721b4e50639f19cabdaaa3945c">02143</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#a72a916721b4e50639f19cabdaaa3945c">animdata_filter_remove_invalid</a> (<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data)
<a name="l02144"></a>02144 {
<a name="l02145"></a>02145     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l02146"></a>02146     <span class="keywordtype">size_t</span> items = 0;
<a name="l02147"></a>02147     
<a name="l02148"></a>02148     <span class="comment">/* only keep entries with valid types */</span>
<a name="l02149"></a>02149     <span class="keywordflow">for</span> (ale= anim_data-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= next) {
<a name="l02150"></a>02150         next= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>;
<a name="l02151"></a>02151         
<a name="l02152"></a>02152         <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a42e07aeda512052bd36a4241279f6958">ANIMTYPE_NONE</a>)
<a name="l02153"></a>02153             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a2bb7ce226f8b42d21eb35100f0bb4580">BLI_freelinkN</a>(anim_data, ale);
<a name="l02154"></a>02154         <span class="keywordflow">else</span>
<a name="l02155"></a>02155             items++;
<a name="l02156"></a>02156     }
<a name="l02157"></a>02157     
<a name="l02158"></a>02158     <span class="keywordflow">return</span> items;
<a name="l02159"></a>02159 }
<a name="l02160"></a>02160 
<a name="l02161"></a>02161 <span class="comment">/* Remove duplicate entries in animation channel list */</span>
<a name="l02162"></a><a class="code" href="../../dc/d01/anim__filter_8c.html#ad9669d1d3797800bcb0e5d0a909af6e5">02162</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#ad9669d1d3797800bcb0e5d0a909af6e5">animdata_filter_remove_duplis</a> (<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data)
<a name="l02163"></a>02163 {
<a name="l02164"></a>02164     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l02165"></a>02165     <a class="code" href="../../df/da0/structGHash.html">GHash</a> *gh;
<a name="l02166"></a>02166     <span class="keywordtype">size_t</span> items = 0;
<a name="l02167"></a>02167     
<a name="l02168"></a>02168     <span class="comment">/* build new hashtable to efficiently store and retrieve which entries have been </span>
<a name="l02169"></a>02169 <span class="comment">     * encountered already while searching</span>
<a name="l02170"></a>02170 <span class="comment">     */</span>
<a name="l02171"></a>02171     gh= <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#af2fb34af7b99547b33a34380451a963d">BLI_ghash_new</a>(<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a371913beecfb01de3d0a8d5f0bb598d4">BLI_ghashutil_ptrhash</a>, <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#a51865a4bfcfc2502e01a9369bfb72877">BLI_ghashutil_ptrcmp</a>, <span class="stringliteral">&quot;animdata_filter_duplis_remove gh&quot;</span>);
<a name="l02172"></a>02172     
<a name="l02173"></a>02173     <span class="comment">/* loop through items, removing them from the list if a similar item occurs already */</span>
<a name="l02174"></a>02174     <span class="keywordflow">for</span> (ale = anim_data-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale = next) {
<a name="l02175"></a>02175         next = ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>;
<a name="l02176"></a>02176         
<a name="l02177"></a>02177         <span class="comment">/* check if hash has any record of an entry like this </span>
<a name="l02178"></a>02178 <span class="comment">         *  - just use ale-&gt;data for now, though it would be nicer to involve </span>
<a name="l02179"></a>02179 <span class="comment">         *    ale-&gt;type in combination too to capture corner cases (where same data performs differently)</span>
<a name="l02180"></a>02180 <span class="comment">         */</span>
<a name="l02181"></a>02181         <span class="keywordflow">if</span> (<a class="code" href="../../d7/dc5/BLI__ghash_8h.html#aaf17fe206dcb6b7b222b670b2a9570c1">BLI_ghash_haskey</a>(gh, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>) == 0) {
<a name="l02182"></a>02182             <span class="comment">/* this entry is &#39;unique&#39; and can be kept */</span>
<a name="l02183"></a>02183             <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#ad72f3a6d9b88bc494c6a279d1b7b9165">BLI_ghash_insert</a>(gh, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02184"></a>02184             items++;
<a name="l02185"></a>02185         }
<a name="l02186"></a>02186         <span class="keywordflow">else</span> {
<a name="l02187"></a>02187             <span class="comment">/* this entry isn&#39;t needed anymore */</span>
<a name="l02188"></a>02188             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a2bb7ce226f8b42d21eb35100f0bb4580">BLI_freelinkN</a>(anim_data, ale);
<a name="l02189"></a>02189         }
<a name="l02190"></a>02190     }
<a name="l02191"></a>02191     
<a name="l02192"></a>02192     <span class="comment">/* free the hash... */</span>
<a name="l02193"></a>02193     <a class="code" href="../../d7/dc5/BLI__ghash_8h.html#adc20ede3cd08276d25c11f2d02768119">BLI_ghash_free</a>(gh, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02194"></a>02194     
<a name="l02195"></a>02195     <span class="comment">/* return the number of items still in the list */</span>
<a name="l02196"></a>02196     <span class="keywordflow">return</span> items;
<a name="l02197"></a>02197 }
<a name="l02198"></a>02198 
<a name="l02199"></a>02199 <span class="comment">/* ----------- Public API --------------- */</span>
<a name="l02200"></a>02200 
<a name="l02201"></a>02201 <span class="comment">/* This function filters the active data source to leave only animation channels suitable for</span>
<a name="l02202"></a>02202 <span class="comment"> * usage by the caller. It will return the length of the list </span>
<a name="l02203"></a>02203 <span class="comment"> * </span>
<a name="l02204"></a>02204 <span class="comment"> *  *anim_data: is a pointer to a ListBase, to which the filtered animation channels</span>
<a name="l02205"></a>02205 <span class="comment"> *      will be placed for use.</span>
<a name="l02206"></a>02206 <span class="comment"> *  filter_mode: how should the data be filtered - bitmapping accessed flags</span>
<a name="l02207"></a>02207 <span class="comment"> */</span>
<a name="l02208"></a><a class="code" href="../../df/d6f/ED__anim__api_8h.html#a13681020f63c886ca5bfc9a2ff39620b">02208</a> <span class="keywordtype">size_t</span> <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *anim_data, <span class="keywordtype">int</span> filter_mode, <span class="keywordtype">void</span> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">short</span> datatype)
<a name="l02209"></a>02209 {
<a name="l02210"></a>02210     <span class="keywordtype">size_t</span> items = 0;
<a name="l02211"></a>02211     
<a name="l02212"></a>02212     <span class="comment">/* only filter data if there&#39;s somewhere to put it */</span>
<a name="l02213"></a>02213     <span class="keywordflow">if</span> (data &amp;&amp; anim_data) {
<a name="l02214"></a>02214         
<a name="l02215"></a>02215         <span class="comment">/* firstly filter the data */</span>
<a name="l02216"></a>02216         <span class="keywordflow">switch</span> (datatype) {
<a name="l02217"></a>02217             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86a7eb4a68e2a084c2412b8ca344b3c8b2a">ANIMCONT_ACTION</a>:   <span class="comment">/* &#39;Action Editor&#39; */</span>
<a name="l02218"></a>02218             {
<a name="l02219"></a>02219                 <a class="code" href="../../de/de7/structObject.html">Object</a> *obact= ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6d0f0d003e3cfae207a33813b161f070">obact</a>;
<a name="l02220"></a>02220                 <a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *saction = (<a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *)ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#ace702244f50216d9ca6d1112f6a45c77">sl</a>;
<a name="l02221"></a>02221                 <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads = (saction)? &amp;saction-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a37c4236d666d2c560e470fa42794b29f">ads</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02222"></a>02222                 
<a name="l02223"></a>02223                 <span class="comment">/* the check for the DopeSheet summary is included here since the summary works here too */</span>
<a name="l02224"></a>02224                 <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#a98d6269d96cd05bb02b3168dfed343b6">animdata_filter_dopesheet_summary</a>(ac, anim_data, filter_mode, &amp;items))
<a name="l02225"></a>02225                     items += <a class="code" href="../../dc/d01/anim__filter_8c.html#afcf140f686a541b0d56db0e6fae560d9">animfilter_action</a>(ac, anim_data, ads, data, filter_mode, (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)obact);
<a name="l02226"></a>02226             }
<a name="l02227"></a>02227                 <span class="keywordflow">break</span>;
<a name="l02228"></a>02228                 
<a name="l02229"></a>02229             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86a4d05fa9c8ece8ffc5c5bbed30c8c7de1">ANIMCONT_SHAPEKEY</a>: <span class="comment">/* &#39;ShapeKey Editor&#39; */</span>
<a name="l02230"></a>02230             {
<a name="l02231"></a>02231                 <span class="comment">/* the check for the DopeSheet summary is included here since the summary works here too */</span>
<a name="l02232"></a>02232                 <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#a98d6269d96cd05bb02b3168dfed343b6">animdata_filter_dopesheet_summary</a>(ac, anim_data, filter_mode, &amp;items))
<a name="l02233"></a>02233                     items= <a class="code" href="../../dc/d01/anim__filter_8c.html#af9fcdca0456d688a2452dd02b1dd73e0">animdata_filter_shapekey</a>(ac, anim_data, data, filter_mode);
<a name="l02234"></a>02234             }
<a name="l02235"></a>02235                 <span class="keywordflow">break</span>;
<a name="l02236"></a>02236                 
<a name="l02237"></a>02237             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>:
<a name="l02238"></a>02238             {
<a name="l02239"></a>02239                 items= <a class="code" href="../../dc/d01/anim__filter_8c.html#a4cadd09f6d2650d89c714cc1f4dc112a">animdata_filter_gpencil</a>(anim_data, data, filter_mode);
<a name="l02240"></a>02240             }
<a name="l02241"></a>02241                 <span class="keywordflow">break</span>;
<a name="l02242"></a>02242                 
<a name="l02243"></a>02243             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86a740590a7047b0cc256d5102bc12b562b">ANIMCONT_DOPESHEET</a>: <span class="comment">/* &#39;DopeSheet Editor&#39; */</span>
<a name="l02244"></a>02244             {
<a name="l02245"></a>02245                 <span class="comment">/* the DopeSheet editor is the primary place where the DopeSheet summaries are useful */</span>
<a name="l02246"></a>02246                 <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#a98d6269d96cd05bb02b3168dfed343b6">animdata_filter_dopesheet_summary</a>(ac, anim_data, filter_mode, &amp;items))
<a name="l02247"></a>02247                     items += <a class="code" href="../../dc/d01/anim__filter_8c.html#a5e80c725aa43f7f321f97fd927a76705">animdata_filter_dopesheet</a>(ac, anim_data, data, filter_mode);
<a name="l02248"></a>02248             }
<a name="l02249"></a>02249                 <span class="keywordflow">break</span>;
<a name="l02250"></a>02250                 
<a name="l02251"></a>02251             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86a169cb614b4e7fa42e1b533efe831384b">ANIMCONT_FCURVES</a>: <span class="comment">/* Graph Editor -&gt; FCurves/Animation Editing */</span>
<a name="l02252"></a>02252             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86a10adc016c09cd01cd52b00387c91cde1">ANIMCONT_DRIVERS</a>: <span class="comment">/* Graph Editor -&gt; Drivers Editing */</span>
<a name="l02253"></a>02253             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86a35217c089b973b733043b33f6c831c69">ANIMCONT_NLA</a>: <span class="comment">/* NLA Editor */</span>
<a name="l02254"></a>02254             {
<a name="l02255"></a>02255                 <span class="comment">/* all of these editors use the basic DopeSheet data for filtering options, but don&#39;t have all the same features */</span>
<a name="l02256"></a>02256                 items = <a class="code" href="../../dc/d01/anim__filter_8c.html#a5e80c725aa43f7f321f97fd927a76705">animdata_filter_dopesheet</a>(ac, anim_data, data, filter_mode);
<a name="l02257"></a>02257             }
<a name="l02258"></a>02258                 <span class="keywordflow">break</span>;
<a name="l02259"></a>02259             
<a name="l02260"></a>02260             <span class="keywordflow">case</span> <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86af8ca1fd6d55bcbb90f6061abb699334f">ANIMCONT_CHANNEL</a>: <span class="comment">/* animation channel */</span>
<a name="l02261"></a>02261             {
<a name="l02262"></a>02262                 <a class="code" href="../../df/de9/structbDopeSheet.html">bDopeSheet</a> *ads = ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a58e9368e226140c365269be25d531a8c">ads</a>;
<a name="l02263"></a>02263                 
<a name="l02264"></a>02264                 <span class="comment">/* based on the channel type, filter relevant data for this */</span>
<a name="l02265"></a>02265                 items = <a class="code" href="../../dc/d01/anim__filter_8c.html#a82af431ef343cfa45f1841032c9f6961">animdata_filter_animchan</a>(ac, anim_data, ads, data, filter_mode);
<a name="l02266"></a>02266             }
<a name="l02267"></a>02267                 <span class="keywordflow">break</span>;
<a name="l02268"></a>02268         }
<a name="l02269"></a>02269             
<a name="l02270"></a>02270         <span class="comment">/* remove any &#39;weedy&#39; entries */</span>
<a name="l02271"></a>02271         items = <a class="code" href="../../dc/d01/anim__filter_8c.html#a72a916721b4e50639f19cabdaaa3945c">animdata_filter_remove_invalid</a>(anim_data);
<a name="l02272"></a>02272         
<a name="l02273"></a>02273         <span class="comment">/* remove duplicates (if required) */</span>
<a name="l02274"></a>02274         <span class="keywordflow">if</span> (filter_mode &amp; <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>)
<a name="l02275"></a>02275             items = <a class="code" href="../../dc/d01/anim__filter_8c.html#ad9669d1d3797800bcb0e5d0a909af6e5">animdata_filter_remove_duplis</a>(anim_data);
<a name="l02276"></a>02276     }
<a name="l02277"></a>02277     
<a name="l02278"></a>02278     <span class="comment">/* return the number of items in the list */</span>
<a name="l02279"></a>02279     <span class="keywordflow">return</span> items;
<a name="l02280"></a>02280 }
<a name="l02281"></a>02281 
<a name="l02282"></a>02282 <span class="comment">/* ************************************************************ */</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:53:56 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

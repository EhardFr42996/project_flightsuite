<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: KX_BlenderSceneConverter.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">KX_BlenderSceneConverter.cpp</div>  </div>
</div>
<div class="contents">
<a href="../../d2/df4/KX__BlenderSceneConverter_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): none yet.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00033"></a>00033 <span class="preprocessor">#if defined(WIN32) &amp;&amp; !defined(FREE_WINDOWS)</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#pragma warning (disable:4786) // suppress stl-MSVC debug info warning</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/da5/KX__Scene_8h.html">KX_Scene.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/dc5/KX__GameObject_8h.html" title="General KX game object.">KX_GameObject.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dc5/KX__BlenderSceneConverter_8h.html">KX_BlenderSceneConverter.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/de6/KX__IpoConvert_8h.html">KX_IpoConvert.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d62/RAS__MeshObject_8h.html">RAS_MeshObject.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d98/KX__PhysicsEngineEnums_8h.html">KX_PhysicsEngineEnums.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d95/PHY__IPhysicsEnvironment_8h.html">PHY_IPhysicsEnvironment.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/de7/KX__KetsjiEngine_8h.html">KX_KetsjiEngine.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/df8/KX__IPhysicsController_8h.html">KX_IPhysicsController.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d4a/BL__Material_8h.html">BL_Material.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d45/BL__ActionActuator_8h.html">BL_ActionActuator.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d9b/KX__BlenderMaterial_8h.html">KX_BlenderMaterial.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../da/da5/KX__PolygonMaterial_8h.html">KX_PolygonMaterial.h</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d4a/BL__System_8h.html">BL_System.h</a>&quot;</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d15/DummyPhysicsEnvironment_8h.html">DummyPhysicsEnvironment.h</a>&quot;</span>
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d65/KX__ConvertPhysicsObject_8h.html">KX_ConvertPhysicsObject.h</a>&quot;</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="preprocessor">#ifdef USE_BULLET</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="../../da/d4a/CcdPhysicsEnvironment_8h.html">CcdPhysicsEnvironment.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#endif</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dc5/KX__BlenderSceneConverter_8h.html">KX_BlenderSceneConverter.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d2c/KX__BlenderScalarInterpolator_8h.html">KX_BlenderScalarInterpolator.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d98/BL__BlenderDataConversion_8h.html">BL_BlenderDataConversion.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/db5/BlenderWorldInfo_8h.html">BlenderWorldInfo.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/da5/KX__Scene_8h.html">KX_Scene.h</a>&quot;</span>
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="comment">/* This little block needed for linking to Blender... */</span>
<a name="l00069"></a>00069 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="../../d9/ded/BLI__winstuff_8h.html" title="Compatibility-like things for windows.">BLI_winstuff.h</a>&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#endif</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span>
<a name="l00073"></a>00073 <span class="comment">/* This list includes only data type definitions */</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d3b/DNA__world__types_8h.html">DNA_world_types.h</a>&quot;</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span>
<a name="l00081"></a>00081 {
<a name="l00082"></a>00082 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00083"></a>00083 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d88/DNA__curve__types_8h.html">DNA_curve_types.h</a>&quot;</span>
<a name="l00084"></a>00084 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d96/DNA__mesh__types_8h.html">DNA_mesh_types.h</a>&quot;</span>
<a name="l00085"></a>00085 <span class="preprocessor">#include &quot;<a class="code" href="../../de/db2/DNA__material__types_8h.html">DNA_material_types.h</a>&quot;</span>
<a name="l00086"></a>00086 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00087"></a>00087 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00088"></a>00088 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span>
<a name="l00089"></a>00089 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d51/BKE__animsys_8h.html">BKE_animsys.h</a>&quot;</span>
<a name="l00090"></a>00090 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/db1/BKE__library_8h.html">BKE_library.h</a>&quot;</span>
<a name="l00091"></a>00091 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d0f/BKE__material_8h.html" title="General operations, lookup, etc. for materials.">BKE_material.h</a>&quot;</span> <span class="comment">// copy_material</span>
<a name="l00092"></a>00092 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d7f/BKE__mesh_8h.html">BKE_mesh.h</a>&quot;</span> <span class="comment">// copy_mesh</span>
<a name="l00093"></a>00093 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d5d/DNA__space__types_8h.html">DNA_space_types.h</a>&quot;</span>
<a name="l00094"></a>00094 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html">DNA_anim_types.h</a>&quot;</span>
<a name="l00095"></a>00095 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d68/RNA__define_8h.html">RNA_define.h</a>&quot;</span>
<a name="l00096"></a>00096 <span class="preprocessor">#include &quot;../../blender/editors/include/ED_keyframing.h&quot;</span>
<a name="l00097"></a>00097 }
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 <span class="comment">/* Only for dynamic loading and merging */</span>
<a name="l00100"></a>00100 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dfd/RAS__BucketManager_8h.html">RAS_BucketManager.h</a>&quot;</span> <span class="comment">// XXX cant stay</span>
<a name="l00101"></a>00101 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dc5/KX__BlenderSceneConverter_8h.html">KX_BlenderSceneConverter.h</a>&quot;</span>
<a name="l00102"></a>00102 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d98/BL__BlenderDataConversion_8h.html">BL_BlenderDataConversion.h</a>&quot;</span>
<a name="l00103"></a>00103 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d4e/KX__MeshProxy_8h.html">KX_MeshProxy.h</a>&quot;</span>
<a name="l00104"></a>00104 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d62/RAS__MeshObject_8h.html">RAS_MeshObject.h</a>&quot;</span>
<a name="l00105"></a>00105 <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {
<a name="l00106"></a>00106 <span class="preprocessor">    #include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00107"></a>00107 <span class="preprocessor">    #include &quot;<a class="code" href="../../da/d01/BLO__readfile_8h.html" title="external readfile function prototypes.">BLO_readfile.h</a>&quot;</span>
<a name="l00108"></a>00108 <span class="preprocessor">    #include &quot;<a class="code" href="../../d8/de8/BKE__idcode_8h.html">BKE_idcode.h</a>&quot;</span>
<a name="l00109"></a>00109 <span class="preprocessor">    #include &quot;<a class="code" href="../../d2/d40/BKE__report_8h.html">BKE_report.h</a>&quot;</span>
<a name="l00110"></a>00110 <span class="preprocessor">    #include &quot;<a class="code" href="../../d8/d5d/DNA__space__types_8h.html">DNA_space_types.h</a>&quot;</span>
<a name="l00111"></a>00111 <span class="preprocessor">    #include &quot;<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html">DNA_windowmanager_types.h</a>&quot;</span> <span class="comment">/* report api */</span>
<a name="l00112"></a>00112 <span class="preprocessor">    #include &quot;../../blender/blenlib/BLI_linklist.h&quot;</span>
<a name="l00113"></a>00113 }
<a name="l00114"></a>00114 
<a name="l00115"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a91bfbe81c52bb3f26ea238735ae3d8c3">00115</a> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a91bfbe81c52bb3f26ea238735ae3d8c3">KX_BlenderSceneConverter::KX_BlenderSceneConverter</a>(
<a name="l00116"></a>00116                             <span class="keyword">struct</span> <a class="code" href="../../d0/dc0/structMain.html">Main</a>* maggie,
<a name="l00117"></a>00117                             <span class="keyword">class</span> <a class="code" href="../../db/dcd/classKX__KetsjiEngine.html">KX_KetsjiEngine</a>* engine
<a name="l00118"></a>00118                             )
<a name="l00119"></a>00119                             : m_maggie(maggie),
<a name="l00120"></a>00120                             <span class="comment">/*m_maggie_dyn(NULL),*/</span>
<a name="l00121"></a>00121                             m_ketsjiEngine(engine),
<a name="l00122"></a>00122                             m_alwaysUseExpandFraming(false),
<a name="l00123"></a>00123                             m_usemat(false),
<a name="l00124"></a>00124                             m_useglslmat(false)
<a name="l00125"></a>00125 {
<a name="l00126"></a>00126     <a class="code" href="../../d8/db1/BKE__library_8h.html#a4ae0a1efb5ecd05d334965b5b8567d63">tag_main</a>(maggie, 0); <span class="comment">/* avoid re-tagging later on */</span>
<a name="l00127"></a>00127     m_newfilename = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00128"></a>00128 }
<a name="l00129"></a>00129 
<a name="l00130"></a>00130 
<a name="l00131"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#aea1dd7a5e5e34ee2922b19b3135dde38">00131</a> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#aea1dd7a5e5e34ee2922b19b3135dde38">KX_BlenderSceneConverter::~KX_BlenderSceneConverter</a>()
<a name="l00132"></a>00132 {
<a name="l00133"></a>00133     <span class="comment">// clears meshes, and hashmaps from blender to gameengine data</span>
<a name="l00134"></a>00134     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00135"></a>00135     <span class="comment">// delete sumoshapes</span>
<a name="l00136"></a>00136     
<a name="l00137"></a>00137 
<a name="l00138"></a>00138     <span class="keywordtype">int</span> numAdtLists = m_map_blender_to_gameAdtList.<a class="code" href="../../d8/d8a/classCTR__Map.html#a3762555d21cfec45e6f7ecdcd61a8de5">size</a>();
<a name="l00139"></a>00139     <span class="keywordflow">for</span> (i=0; i&lt;numAdtLists; i++) {
<a name="l00140"></a>00140         <a class="code" href="../../d3/da2/classBL__InterpolatorList.html">BL_InterpolatorList</a> *adtList= *m_map_blender_to_gameAdtList.<a class="code" href="../../d8/d8a/classCTR__Map.html#a4e4c294108caa048b4399f05ab1d1d96">at</a>(i);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142         <span class="keyword">delete</span> (adtList);
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     vector&lt;pair&lt;KX_Scene*,KX_WorldInfo*&gt; &gt;::iterator itw = m_worldinfos.begin();
<a name="l00146"></a>00146     <span class="keywordflow">while</span> (itw != m_worldinfos.end()) {
<a name="l00147"></a>00147         <span class="keyword">delete</span> (*itw).second;
<a name="l00148"></a>00148         itw++;
<a name="l00149"></a>00149     }
<a name="l00150"></a>00150 
<a name="l00151"></a>00151     vector&lt;pair&lt;KX_Scene*,RAS_IPolyMaterial*&gt; &gt;::iterator itp = m_polymaterials.begin();
<a name="l00152"></a>00152     <span class="keywordflow">while</span> (itp != m_polymaterials.end()) {
<a name="l00153"></a>00153         <span class="keyword">delete</span> (*itp).second;
<a name="l00154"></a>00154         itp++;
<a name="l00155"></a>00155     }
<a name="l00156"></a>00156 
<a name="l00157"></a>00157     <span class="comment">// delete after RAS_IPolyMaterial</span>
<a name="l00158"></a>00158     vector&lt;pair&lt;KX_Scene*,BL_Material *&gt; &gt;::iterator itmat = m_materials.begin();
<a name="l00159"></a>00159     <span class="keywordflow">while</span> (itmat != m_materials.end()) {
<a name="l00160"></a>00160         <span class="keyword">delete</span> (*itmat).second;
<a name="l00161"></a>00161         itmat++;
<a name="l00162"></a>00162     }   
<a name="l00163"></a>00163 
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     vector&lt;pair&lt;KX_Scene*,RAS_MeshObject*&gt; &gt;::iterator itm = m_meshobjects.begin();
<a name="l00166"></a>00166     <span class="keywordflow">while</span> (itm != m_meshobjects.end()) {
<a name="l00167"></a>00167         <span class="keyword">delete</span> (*itm).second;
<a name="l00168"></a>00168         itm++;
<a name="l00169"></a>00169     }
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 <span class="preprocessor">#ifdef USE_BULLET</span>
<a name="l00172"></a>00172 <span class="preprocessor"></span>    KX_ClearBulletSharedShapes();
<a name="l00173"></a>00173 <span class="preprocessor">#endif</span>
<a name="l00174"></a>00174 <span class="preprocessor"></span>
<a name="l00175"></a>00175     <span class="comment">/* free any data that was dynamically loaded */</span>
<a name="l00176"></a>00176     <span class="keywordflow">for</span> (vector&lt;Main*&gt;::iterator it=m_DynamicMaggie.begin(); !(it==m_DynamicMaggie.end()); it++) {
<a name="l00177"></a>00177         <a class="code" href="../../d0/dc0/structMain.html">Main</a> *<a class="code" href="../../d5/d95/makesdna_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>= *it;
<a name="l00178"></a>00178         <a class="code" href="../../d8/db1/BKE__library_8h.html#a7dacadb71dbdc69a89bbf5e61818e085">free_main</a>(main);
<a name="l00179"></a>00179     }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181     m_DynamicMaggie.clear();
<a name="l00182"></a>00182 }
<a name="l00183"></a>00183 
<a name="l00184"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#ad5b21e520956d4ed9d5bf22f5be66827">00184</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#ad5b21e520956d4ed9d5bf22f5be66827">KX_BlenderSceneConverter::SetNewFileName</a>(<span class="keyword">const</span> <a class="code" href="../../d6/dce/classSTR__String.html">STR_String</a>&amp; filename)
<a name="l00185"></a>00185 {
<a name="l00186"></a>00186     m_newfilename = filename;
<a name="l00187"></a>00187 }
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 
<a name="l00191"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a1c9fcfc05eb70fb05a0f2e247e5739d7">00191</a> <span class="keywordtype">bool</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a1c9fcfc05eb70fb05a0f2e247e5739d7">KX_BlenderSceneConverter::TryAndLoadNewFile</a>()
<a name="l00192"></a>00192 {
<a name="l00193"></a>00193     <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <span class="comment">// find the file</span>
<a name="l00196"></a>00196 <span class="comment">/*  if ()</span>
<a name="l00197"></a>00197 <span class="comment">    {</span>
<a name="l00198"></a>00198 <span class="comment">        result = true;</span>
<a name="l00199"></a>00199 <span class="comment">    }</span>
<a name="l00200"></a>00200 <span class="comment">    // if not, clear the newfilename</span>
<a name="l00201"></a>00201 <span class="comment">    else</span>
<a name="l00202"></a>00202 <span class="comment">    {</span>
<a name="l00203"></a>00203 <span class="comment">        m_newfilename = &quot;&quot;; </span>
<a name="l00204"></a>00204 <span class="comment">    }</span>
<a name="l00205"></a>00205 <span class="comment">*/</span>
<a name="l00206"></a>00206     <span class="keywordflow">return</span> result;
<a name="l00207"></a>00207 }
<a name="l00208"></a>00208 
<a name="l00209"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a6b8f5cfd7f16f649210fdc147689e40f">00209</a> <a class="code" href="../../d9/d27/structScene.html">Scene</a> *<a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a6b8f5cfd7f16f649210fdc147689e40f">KX_BlenderSceneConverter::GetBlenderSceneForName</a>(<span class="keyword">const</span> <a class="code" href="../../d6/dce/classSTR__String.html">STR_String</a>&amp; name)
<a name="l00210"></a>00210 {
<a name="l00211"></a>00211     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce;
<a name="l00212"></a>00212 
<a name="l00217"></a>00217     <span class="keywordflow">if</span> ((sce= (<a class="code" href="../../d9/d27/structScene.html">Scene</a> *)<a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a07f40c87b9211c9d5fef01d4a4e9054d">BLI_findstring</a>(&amp;m_maggie-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>, name.<a class="code" href="../../d6/dce/classSTR__String.html#a946cab5eea587bf86a388f826fd7e26c">ReadPtr</a>(), offsetof(<a class="code" href="../../d8/d7e/structID.html">ID</a>, name) + 2)))
<a name="l00218"></a>00218         <span class="keywordflow">return</span> sce;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <span class="keywordflow">for</span> (vector&lt;Main*&gt;::iterator it=m_DynamicMaggie.begin(); !(it==m_DynamicMaggie.end()); it++) {
<a name="l00221"></a>00221         <a class="code" href="../../d0/dc0/structMain.html">Main</a> *<a class="code" href="../../d5/d95/makesdna_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>= *it;
<a name="l00222"></a>00222 
<a name="l00223"></a>00223         <span class="keywordflow">if</span> ((sce= (<a class="code" href="../../d9/d27/structScene.html">Scene</a> *)<a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a07f40c87b9211c9d5fef01d4a4e9054d">BLI_findstring</a>(&amp;main-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>, name.<a class="code" href="../../d6/dce/classSTR__String.html#a946cab5eea587bf86a388f826fd7e26c">ReadPtr</a>(), offsetof(<a class="code" href="../../d8/d7e/structID.html">ID</a>, name) + 2)))
<a name="l00224"></a>00224             <span class="keywordflow">return</span> sce;
<a name="l00225"></a>00225     }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     <span class="keywordflow">return</span> (<a class="code" href="../../d9/d27/structScene.html">Scene</a>*)m_maggie-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 }
<a name="l00230"></a>00230 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/de4/KX__PythonInit_8h.html">KX_PythonInit.h</a>&quot;</span>
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 <span class="preprocessor">#ifdef USE_BULLET</span>
<a name="l00233"></a>00233 <span class="preprocessor"></span>
<a name="l00234"></a>00234 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/dc6/btIDebugDraw_8h.html">LinearMath/btIDebugDraw.h</a>&quot;</span>
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 
<a name="l00237"></a>00237 <span class="keyword">struct  </span>BlenderDebugDraw : <span class="keyword">public</span> <a class="code" href="../../d1/d1d/classbtIDebugDraw.html">btIDebugDraw</a>
<a name="l00238"></a>00238 {
<a name="l00239"></a>00239     BlenderDebugDraw () :
<a name="l00240"></a>00240         m_debugMode(0) 
<a name="l00241"></a>00241     {
<a name="l00242"></a>00242     }
<a name="l00243"></a>00243     
<a name="l00244"></a>00244     <span class="keywordtype">int</span> m_debugMode;
<a name="l00245"></a>00245 
<a name="l00246"></a>00246     <span class="keyword">virtual</span> <span class="keywordtype">void</span>    <a class="code" href="../../d1/d1d/classbtIDebugDraw.html#a07b08e255ab4607ab5aeb24399332aff">drawLine</a>(<span class="keyword">const</span> btVector3&amp; from,<span class="keyword">const</span> btVector3&amp; to,<span class="keyword">const</span> btVector3&amp; color)
<a name="l00247"></a>00247     {
<a name="l00248"></a>00248         <span class="keywordflow">if</span> (m_debugMode &gt;0)
<a name="l00249"></a>00249         {
<a name="l00250"></a>00250             <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a> kxfrom(from[0],from[1],from[2]);
<a name="l00251"></a>00251             <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a> kxto(to[0],to[1],to[2]);
<a name="l00252"></a>00252             <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a> kxcolor(color[0],color[1],color[2]);
<a name="l00253"></a>00253 
<a name="l00254"></a>00254             <a class="code" href="../../d6/dc2/KX__PythonInit_8cpp.html#a10e53bea817147a2671bbdef43805f20">KX_RasterizerDrawDebugLine</a>(kxfrom,kxto,kxcolor);
<a name="l00255"></a>00255         }
<a name="l00256"></a>00256     }
<a name="l00257"></a>00257     
<a name="l00258"></a>00258     <span class="keyword">virtual</span> <span class="keywordtype">void</span>    <a class="code" href="../../d1/d1d/classbtIDebugDraw.html#a4114a426d9d922d7b834673bb4044757">reportErrorWarning</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* warningString)
<a name="l00259"></a>00259     {
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262 
<a name="l00263"></a>00263     <span class="keyword">virtual</span> <span class="keywordtype">void</span>    <a class="code" href="../../d1/d1d/classbtIDebugDraw.html#a791eba72577f83519499bd646bb4a3f1">drawContactPoint</a>(<span class="keyword">const</span> btVector3&amp; PointOnB,<span class="keyword">const</span> btVector3&amp; normalOnB,<span class="keywordtype">float</span> <a class="code" href="../../d1/d22/stdosl_8h.html#a4d04eb0874bac8d51beb2f1d36fe6107">distance</a>,<span class="keywordtype">int</span> lifeTime,<span class="keyword">const</span> btVector3&amp; color)
<a name="l00264"></a>00264     {
<a name="l00265"></a>00265         <span class="comment">//not yet</span>
<a name="l00266"></a>00266     }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268     <span class="keyword">virtual</span> <span class="keywordtype">void</span>    <a class="code" href="../../d1/d1d/classbtIDebugDraw.html#a682fb01e96403d1da04207b7a9b46639">setDebugMode</a>(<span class="keywordtype">int</span> debugMode)
<a name="l00269"></a>00269     {
<a name="l00270"></a>00270         m_debugMode = debugMode;
<a name="l00271"></a>00271     }
<a name="l00272"></a>00272     <span class="keyword">virtual</span> <span class="keywordtype">int</span>     <a class="code" href="../../d1/d1d/classbtIDebugDraw.html#a8b0e36c47552ec81ea61a16f6239f92d">getDebugMode</a>()<span class="keyword"> const</span>
<a name="l00273"></a>00273 <span class="keyword">    </span>{
<a name="l00274"></a>00274         <span class="keywordflow">return</span> m_debugMode;
<a name="l00275"></a>00275     }
<a name="l00277"></a>00277     <span class="keyword">virtual</span> <span class="keywordtype">void</span>    <a class="code" href="../../d1/d1d/classbtIDebugDraw.html#a287102dad359ae7c0685ec527c54ea48">draw3dText</a>(<span class="keyword">const</span> btVector3&amp; location,<span class="keyword">const</span> <span class="keywordtype">char</span>* textString)
<a name="l00278"></a>00278     {
<a name="l00279"></a>00279 
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281         
<a name="l00282"></a>00282 };
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 <span class="preprocessor">#endif</span>
<a name="l00285"></a>00285 <span class="preprocessor"></span>
<a name="l00286"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#afde9613c86f7c608321a001d08b2207e">00286</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#afde9613c86f7c608321a001d08b2207e">KX_BlenderSceneConverter::ConvertScene</a>(<span class="keyword">class</span> <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* destinationscene,
<a name="l00287"></a>00287                                             <span class="keyword">class</span> <a class="code" href="../../d0/d53/classRAS__IRenderTools.html">RAS_IRenderTools</a>* rendertools,
<a name="l00288"></a>00288                                             <span class="keyword">class</span> <a class="code" href="../../d5/df6/classRAS__ICanvas.html">RAS_ICanvas</a>* canvas)
<a name="l00289"></a>00289 {
<a name="l00290"></a>00290     <span class="comment">//find out which physics engine</span>
<a name="l00291"></a>00291     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *blenderscene = destinationscene-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a217279a18aca964cf8d28d3ad6bdb95d">GetBlenderScene</a>();
<a name="l00292"></a>00292 
<a name="l00293"></a>00293     <a class="code" href="../../d3/d98/KX__PhysicsEngineEnums_8h.html#a1d02ecff9c9296faee3bc2488e2d4555">e_PhysicsEngine</a> physics_engine = <a class="code" href="../../d3/d98/KX__PhysicsEngineEnums_8h.html#a1d02ecff9c9296faee3bc2488e2d4555a989601135c4f2574a13baf105acaf9a4">UseBullet</a>;
<a name="l00294"></a>00294     <span class="keywordtype">bool</span> useDbvtCulling = <span class="keyword">false</span>;
<a name="l00295"></a>00295     <span class="comment">// hook for registration function during conversion.</span>
<a name="l00296"></a>00296     m_currentScene = destinationscene;
<a name="l00297"></a>00297     destinationscene-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a60ed258cc80ecf20e3dae6a7f3cde078">SetSceneConverter</a>(<span class="keyword">this</span>);
<a name="l00298"></a>00298     <a class="code" href="../../d0/d93/SG__IObject_8h.html#a10758628a73229e0b8b2d062e7b8771a">SG_SetActiveStage</a>(<a class="code" href="../../d0/d93/SG__IObject_8h.html#a0908f91d8a791553b93529d674c70f20a9c39a1f607df8cbc2c7b2281b7d59b34">SG_STAGE_CONVERTER</a>);
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="keywordflow">if</span> (blenderscene)
<a name="l00301"></a>00301     {
<a name="l00302"></a>00302     
<a name="l00303"></a>00303         <span class="keywordflow">switch</span> (blenderscene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#ae830149c6f77170b21f7a12372722b62">physicsEngine</a>)
<a name="l00304"></a>00304         {
<a name="l00305"></a>00305         <span class="keywordflow">case</span> <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a0bc314c665abe5322ee096d610eca563">WOPHY_BULLET</a>:
<a name="l00306"></a>00306             {
<a name="l00307"></a>00307                 physics_engine = <a class="code" href="../../d3/d98/KX__PhysicsEngineEnums_8h.html#a1d02ecff9c9296faee3bc2488e2d4555a989601135c4f2574a13baf105acaf9a4">UseBullet</a>;
<a name="l00308"></a>00308                 useDbvtCulling = (blenderscene-&gt;<a class="code" href="../../d9/d27/structScene.html#a966786bdf5ea4102e08aeeec6fcc65ab">gm</a>.<a class="code" href="../../d4/d6e/structGameData.html#abb0b4ef8392647aaeab643b9e4164673">mode</a> &amp; <a class="code" href="../../d7/d3b/DNA__world__types_8h.html#a70627b3eb11e0243d1b14fe206bef808">WO_DBVT_CULLING</a>) != 0;
<a name="l00309"></a>00309                 <span class="keywordflow">break</span>;
<a name="l00310"></a>00310             }
<a name="l00311"></a>00311             <span class="keywordflow">default</span>:
<a name="l00312"></a>00312             <span class="keywordflow">case</span> <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a2830661964562620db367e497d5e0793">WOPHY_NONE</a>:
<a name="l00313"></a>00313             {
<a name="l00314"></a>00314                 physics_engine = <a class="code" href="../../d3/d98/KX__PhysicsEngineEnums_8h.html#a1d02ecff9c9296faee3bc2488e2d4555ae707385fb6e96ee649832f93a7fbe29b">UseNone</a>;
<a name="l00315"></a>00315                 <span class="keywordflow">break</span>;
<a name="l00316"></a>00316             }
<a name="l00317"></a>00317         }
<a name="l00318"></a>00318     }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     <span class="keywordflow">switch</span> (physics_engine)
<a name="l00321"></a>00321     {
<a name="l00322"></a>00322 <span class="preprocessor">#ifdef USE_BULLET</span>
<a name="l00323"></a>00323 <span class="preprocessor"></span>        <span class="keywordflow">case</span> <a class="code" href="../../d3/d98/KX__PhysicsEngineEnums_8h.html#a1d02ecff9c9296faee3bc2488e2d4555a989601135c4f2574a13baf105acaf9a4">UseBullet</a>:
<a name="l00324"></a>00324             {
<a name="l00325"></a>00325                 <a class="code" href="../../d5/d39/classCcdPhysicsEnvironment.html">CcdPhysicsEnvironment</a>* ccdPhysEnv = <span class="keyword">new</span> <a class="code" href="../../d5/d39/classCcdPhysicsEnvironment.html">CcdPhysicsEnvironment</a>(useDbvtCulling);
<a name="l00326"></a>00326                 ccdPhysEnv-&gt;<a class="code" href="../../d5/d39/classCcdPhysicsEnvironment.html#aef11e95ad01fe14ca84fa21e4e20bb95" title="Perform an integration step of duration &#39;timeStep&#39;.">setDebugDrawer</a>(<span class="keyword">new</span> BlenderDebugDraw());
<a name="l00327"></a>00327                 ccdPhysEnv-&gt;<a class="code" href="../../d5/d39/classCcdPhysicsEnvironment.html#a7b9bdb3526ea4882b67f35644338bd99" title="setDeactivationLinearTreshold sets the linear velocity treshold, see setDeactivationTime">setDeactivationLinearTreshold</a>(0.8f); <span class="comment">// default, can be overridden by Python</span>
<a name="l00328"></a>00328                 ccdPhysEnv-&gt;<a class="code" href="../../d5/d39/classCcdPhysicsEnvironment.html#a2aeca9fc4a697aba3f988d87086e89e6" title="setDeactivationAngularTreshold sets the angular velocity treshold, see setDeactivationTime">setDeactivationAngularTreshold</a>(1.0f); <span class="comment">// default, can be overridden by Python</span>
<a name="l00329"></a>00329 
<a name="l00330"></a>00330                 <a class="code" href="../../dc/d4a/BL__System_8h.html#a14ad21f63f97245f17d100854950b35d">SYS_SystemHandle</a> syshandle = <a class="code" href="../../d7/d58/BL__System_8cpp.html#a6d6d836bf4ccaeb2ba849cf528ddff32">SYS_GetSystem</a>(); <span class="comment">/*unused*/</span>
<a name="l00331"></a>00331                 <span class="keywordtype">int</span> visualizePhysics = <a class="code" href="../../d7/d58/BL__System_8cpp.html#af3bfb765441cb1a85d708421bc854f39">SYS_GetCommandLineInt</a>(syshandle,<span class="stringliteral">&quot;show_physics&quot;</span>,0);
<a name="l00332"></a>00332                 <span class="keywordflow">if</span> (visualizePhysics)
<a name="l00333"></a>00333                     ccdPhysEnv-&gt;<a class="code" href="../../d5/d39/classCcdPhysicsEnvironment.html#a0872ee0f9fda9d80f08175a7a6dbcfc5" title="setDebugMode is used to support several ways of debug lines, contact point visualization">setDebugMode</a>(<a class="code" href="../../d1/d1d/classbtIDebugDraw.html#ab4bb43fbfefb526c552c0943fac5832aa199d702b4391b8a5289f2bd3546a50d3">btIDebugDraw::DBG_DrawWireframe</a>|<a class="code" href="../../d1/d1d/classbtIDebugDraw.html#ab4bb43fbfefb526c552c0943fac5832aaa5944e954a427ddcf5e6e76169cddc8e">btIDebugDraw::DBG_DrawAabb</a>|<a class="code" href="../../d1/d1d/classbtIDebugDraw.html#ab4bb43fbfefb526c552c0943fac5832aa2d0f0593b19a0e0b16242f25f476b9e6">btIDebugDraw::DBG_DrawContactPoints</a>|<a class="code" href="../../d1/d1d/classbtIDebugDraw.html#ab4bb43fbfefb526c552c0943fac5832aafeada1ad6856d5419ec1eec2b787e1b7">btIDebugDraw::DBG_DrawText</a>|<a class="code" href="../../d1/d1d/classbtIDebugDraw.html#ab4bb43fbfefb526c552c0943fac5832aaf0536fdc1e759c0a6a4bb2d6cc6db05d">btIDebugDraw::DBG_DrawConstraintLimits</a>|<a class="code" href="../../d1/d1d/classbtIDebugDraw.html#ab4bb43fbfefb526c552c0943fac5832aa3996f0e8c271f8350f28275aae0d4be2">btIDebugDraw::DBG_DrawConstraints</a>);
<a name="l00334"></a>00334         
<a name="l00335"></a>00335                 <span class="comment">//todo: get a button in blender ?</span>
<a name="l00336"></a>00336                 <span class="comment">//disable / enable debug drawing (contact points, aabb&#39;s etc)   </span>
<a name="l00337"></a>00337                 <span class="comment">//ccdPhysEnv-&gt;setDebugMode(1);</span>
<a name="l00338"></a>00338                 destinationscene-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ac6eb1fbbe7dc93e98d1ca2b14ad5561e">SetPhysicsEnvironment</a>(ccdPhysEnv);
<a name="l00339"></a>00339                 <span class="keywordflow">break</span>;
<a name="l00340"></a>00340             }
<a name="l00341"></a>00341 <span class="preprocessor">#endif</span>
<a name="l00342"></a>00342 <span class="preprocessor"></span>        <span class="keywordflow">default</span>:
<a name="l00343"></a>00343         <span class="keywordflow">case</span> <a class="code" href="../../d3/d98/KX__PhysicsEngineEnums_8h.html#a1d02ecff9c9296faee3bc2488e2d4555ae707385fb6e96ee649832f93a7fbe29b">UseNone</a>:
<a name="l00344"></a>00344             physics_engine = <a class="code" href="../../d3/d98/KX__PhysicsEngineEnums_8h.html#a1d02ecff9c9296faee3bc2488e2d4555ae707385fb6e96ee649832f93a7fbe29b">UseNone</a>;
<a name="l00345"></a>00345             destinationscene -&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ac6eb1fbbe7dc93e98d1ca2b14ad5561e">SetPhysicsEnvironment</a>(<span class="keyword">new</span> <a class="code" href="../../d5/d36/classDummyPhysicsEnvironment.html">DummyPhysicsEnvironment</a>());
<a name="l00346"></a>00346             <span class="keywordflow">break</span>;
<a name="l00347"></a>00347     }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     <a class="code" href="../../d6/df2/BL__BlenderDataConversion_8cpp.html#a3702acd81384ba70ef99494c392d3f69">BL_ConvertBlenderObjects</a>(m_maggie,
<a name="l00350"></a>00350         destinationscene,
<a name="l00351"></a>00351         m_ketsjiEngine,
<a name="l00352"></a>00352         physics_engine,
<a name="l00353"></a>00353         rendertools,
<a name="l00354"></a>00354         canvas,
<a name="l00355"></a>00355         <span class="keyword">this</span>,
<a name="l00356"></a>00356         m_alwaysUseExpandFraming
<a name="l00357"></a>00357         );
<a name="l00358"></a>00358 
<a name="l00359"></a>00359     <span class="comment">//These lookup are not needed during game</span>
<a name="l00360"></a>00360     m_map_blender_to_gameactuator.<a class="code" href="../../d8/d8a/classCTR__Map.html#ab0ccd91972346f43c0388c6cef2159fb">clear</a>();
<a name="l00361"></a>00361     m_map_blender_to_gamecontroller.<a class="code" href="../../d8/d8a/classCTR__Map.html#ab0ccd91972346f43c0388c6cef2159fb">clear</a>();
<a name="l00362"></a>00362     m_map_blender_to_gameobject.<a class="code" href="../../d8/d8a/classCTR__Map.html#ab0ccd91972346f43c0388c6cef2159fb">clear</a>();
<a name="l00363"></a>00363 
<a name="l00364"></a>00364     <span class="comment">//Clearing this lookup table has the effect of disabling the cache of meshes</span>
<a name="l00365"></a>00365     <span class="comment">//between scenes, even if they are shared in the blend file.</span>
<a name="l00366"></a>00366     <span class="comment">//This cache mecanism is buggy so I leave it disable and the memory leak</span>
<a name="l00367"></a>00367     <span class="comment">//that would result from this is fixed in RemoveScene()</span>
<a name="l00368"></a>00368     m_map_mesh_to_gamemesh.<a class="code" href="../../d8/d8a/classCTR__Map.html#ab0ccd91972346f43c0388c6cef2159fb">clear</a>();
<a name="l00369"></a>00369 
<a name="l00370"></a>00370 <span class="preprocessor">#ifndef USE_BULLET</span>
<a name="l00371"></a>00371 <span class="preprocessor"></span>    <span class="comment">/* quiet compiler warning */</span>
<a name="l00372"></a>00372     (void)useDbvtCulling;
<a name="l00373"></a>00373 <span class="preprocessor">#endif</span>
<a name="l00374"></a>00374 <span class="preprocessor"></span>
<a name="l00375"></a>00375 }
<a name="l00376"></a>00376 
<a name="l00377"></a>00377 <span class="comment">// This function removes all entities stored in the converter for that scene</span>
<a name="l00378"></a>00378 <span class="comment">// It should be used instead of direct delete scene</span>
<a name="l00379"></a>00379 <span class="comment">// Note that there was some provision for sharing entities (meshes...) between</span>
<a name="l00380"></a>00380 <span class="comment">// scenes but that is now disabled so all scene will have their own copy</span>
<a name="l00381"></a>00381 <span class="comment">// and we can delete them here. If the sharing is reactivated, change this code too..</span>
<a name="l00382"></a>00382 <span class="comment">// (see KX_BlenderSceneConverter::ConvertScene)</span>
<a name="l00383"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a6a43899dee5c8783b7f110fd9403aec3">00383</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a6a43899dee5c8783b7f110fd9403aec3">KX_BlenderSceneConverter::RemoveScene</a>(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a> *scene)
<a name="l00384"></a>00384 {
<a name="l00385"></a>00385     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l00386"></a>00386     <span class="comment">// delete the scene first as it will stop the use of entities</span>
<a name="l00387"></a>00387     <span class="keyword">delete</span> scene;
<a name="l00388"></a>00388     <span class="comment">// delete the entities of this scene</span>
<a name="l00389"></a>00389     vector&lt;pair&lt;KX_Scene*,KX_WorldInfo*&gt; &gt;::iterator worldit;
<a name="l00390"></a>00390     size = m_worldinfos.size();
<a name="l00391"></a>00391     <span class="keywordflow">for</span> (i=0, worldit=m_worldinfos.begin(); i&lt;<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>; ) {
<a name="l00392"></a>00392         <span class="keywordflow">if</span> ((*worldit).first == scene) {
<a name="l00393"></a>00393             <span class="keyword">delete</span> (*worldit).second;
<a name="l00394"></a>00394             *worldit = m_worldinfos.back();
<a name="l00395"></a>00395             m_worldinfos.pop_back();
<a name="l00396"></a>00396             size--;
<a name="l00397"></a>00397         } <span class="keywordflow">else</span> {
<a name="l00398"></a>00398             i++;
<a name="l00399"></a>00399             worldit++;
<a name="l00400"></a>00400         }
<a name="l00401"></a>00401     }
<a name="l00402"></a>00402 
<a name="l00403"></a>00403     vector&lt;pair&lt;KX_Scene*,RAS_IPolyMaterial*&gt; &gt;::iterator polymit;
<a name="l00404"></a>00404     size = m_polymaterials.size();
<a name="l00405"></a>00405     <span class="keywordflow">for</span> (i=0, polymit=m_polymaterials.begin(); i&lt;<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>; ) {
<a name="l00406"></a>00406         <span class="keywordflow">if</span> ((*polymit).first == scene) {
<a name="l00407"></a>00407             <span class="keyword">delete</span> (*polymit).second;
<a name="l00408"></a>00408             *polymit = m_polymaterials.back();
<a name="l00409"></a>00409             m_polymaterials.pop_back();
<a name="l00410"></a>00410             size--;
<a name="l00411"></a>00411         } <span class="keywordflow">else</span> {
<a name="l00412"></a>00412             i++;
<a name="l00413"></a>00413             polymit++;
<a name="l00414"></a>00414         }
<a name="l00415"></a>00415     }
<a name="l00416"></a>00416 
<a name="l00417"></a>00417     vector&lt;pair&lt;KX_Scene*,BL_Material*&gt; &gt;::iterator matit;
<a name="l00418"></a>00418     size = m_materials.size();
<a name="l00419"></a>00419     <span class="keywordflow">for</span> (i=0, matit=m_materials.begin(); i&lt;<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>; ) {
<a name="l00420"></a>00420         <span class="keywordflow">if</span> ((*matit).first == scene) {
<a name="l00421"></a>00421             <span class="keyword">delete</span> (*matit).second;
<a name="l00422"></a>00422             *matit = m_materials.back();
<a name="l00423"></a>00423             m_materials.pop_back();
<a name="l00424"></a>00424             size--;
<a name="l00425"></a>00425         } <span class="keywordflow">else</span> {
<a name="l00426"></a>00426             i++;
<a name="l00427"></a>00427             matit++;
<a name="l00428"></a>00428         }
<a name="l00429"></a>00429     }
<a name="l00430"></a>00430 
<a name="l00431"></a>00431     vector&lt;pair&lt;KX_Scene*,RAS_MeshObject*&gt; &gt;::iterator meshit;
<a name="l00432"></a>00432     size = m_meshobjects.size();
<a name="l00433"></a>00433     <span class="keywordflow">for</span> (i=0, meshit=m_meshobjects.begin(); i&lt;<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>; ) {
<a name="l00434"></a>00434         <span class="keywordflow">if</span> ((*meshit).first == scene) {
<a name="l00435"></a>00435             <span class="keyword">delete</span> (*meshit).second;
<a name="l00436"></a>00436             *meshit = m_meshobjects.back();
<a name="l00437"></a>00437             m_meshobjects.pop_back();
<a name="l00438"></a>00438             size--;
<a name="l00439"></a>00439         } <span class="keywordflow">else</span> {
<a name="l00440"></a>00440             i++;
<a name="l00441"></a>00441             meshit++;
<a name="l00442"></a>00442         }
<a name="l00443"></a>00443     }
<a name="l00444"></a>00444 }
<a name="l00445"></a>00445 
<a name="l00446"></a>00446 <span class="comment">// use blender materials</span>
<a name="l00447"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a8c944f879b6e146e481992dfb0552a8d">00447</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a8c944f879b6e146e481992dfb0552a8d">KX_BlenderSceneConverter::SetMaterials</a>(<span class="keywordtype">bool</span> val)
<a name="l00448"></a>00448 {
<a name="l00449"></a>00449     m_usemat = val;
<a name="l00450"></a>00450     m_useglslmat = <span class="keyword">false</span>;
<a name="l00451"></a>00451 }
<a name="l00452"></a>00452 
<a name="l00453"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a8395c7d4345987940e7d8c7aac5a1898">00453</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a8395c7d4345987940e7d8c7aac5a1898">KX_BlenderSceneConverter::SetGLSLMaterials</a>(<span class="keywordtype">bool</span> val)
<a name="l00454"></a>00454 {
<a name="l00455"></a>00455     m_usemat = val;
<a name="l00456"></a>00456     m_useglslmat = val;
<a name="l00457"></a>00457 }
<a name="l00458"></a>00458 
<a name="l00459"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a0c62bbec2c2cf3d535f8c7f63b107d47">00459</a> <span class="keywordtype">bool</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a0c62bbec2c2cf3d535f8c7f63b107d47">KX_BlenderSceneConverter::GetMaterials</a>()
<a name="l00460"></a>00460 {
<a name="l00461"></a>00461     <span class="keywordflow">return</span> m_usemat;
<a name="l00462"></a>00462 }
<a name="l00463"></a>00463 
<a name="l00464"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#afe1f045607e0bef2aa9bee3482c04290">00464</a> <span class="keywordtype">bool</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#afe1f045607e0bef2aa9bee3482c04290">KX_BlenderSceneConverter::GetGLSLMaterials</a>()
<a name="l00465"></a>00465 {
<a name="l00466"></a>00466     <span class="keywordflow">return</span> m_useglslmat;
<a name="l00467"></a>00467 }
<a name="l00468"></a>00468 
<a name="l00469"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a06ada250260e5c21417591c991158b7f">00469</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a06ada250260e5c21417591c991158b7f">KX_BlenderSceneConverter::RegisterBlenderMaterial</a>(<a class="code" href="../../d3/de1/classBL__Material.html">BL_Material</a> *mat)
<a name="l00470"></a>00470 {
<a name="l00471"></a>00471     m_materials.push_back(pair&lt;KX_Scene*,BL_Material *&gt;(m_currentScene,mat));
<a name="l00472"></a>00472 }
<a name="l00473"></a>00473 
<a name="l00474"></a>00474 
<a name="l00475"></a>00475 
<a name="l00476"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#aff88dafaa600c64e11aabe93400707cc">00476</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#aff88dafaa600c64e11aabe93400707cc">KX_BlenderSceneConverter::SetAlwaysUseExpandFraming</a>(
<a name="l00477"></a>00477     <span class="keywordtype">bool</span> to_what)
<a name="l00478"></a>00478 {
<a name="l00479"></a>00479     m_alwaysUseExpandFraming= to_what;
<a name="l00480"></a>00480 }
<a name="l00481"></a>00481 
<a name="l00482"></a>00482     
<a name="l00483"></a>00483 
<a name="l00484"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a5d5d85dfabee42148e05efc86a4c184a">00484</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a5d5d85dfabee42148e05efc86a4c184a">KX_BlenderSceneConverter::RegisterGameObject</a>(
<a name="l00485"></a>00485                                     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a> *gameobject, 
<a name="l00486"></a>00486                                     <span class="keyword">struct</span> <a class="code" href="../../de/de7/structObject.html">Object</a> *for_blenderobject) 
<a name="l00487"></a>00487 {
<a name="l00488"></a>00488     <span class="comment">/* only maintained while converting, freed during game runtime */</span>
<a name="l00489"></a>00489     m_map_blender_to_gameobject.<a class="code" href="../../d8/d8a/classCTR__Map.html#a79e68315a7733982eea54107231300df">insert</a>(<a class="code" href="../../df/d70/classCHashedPtr.html">CHashedPtr</a>(for_blenderobject),gameobject);
<a name="l00490"></a>00490 }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492 <span class="comment">/* only need to run this during conversion since</span>
<a name="l00493"></a>00493 <span class="comment"> * m_map_blender_to_gameobject is freed after conversion */</span>
<a name="l00494"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a9df0abe9021caa8548159afaebd2e99f">00494</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a9df0abe9021caa8548159afaebd2e99f">KX_BlenderSceneConverter::UnregisterGameObject</a>(
<a name="l00495"></a>00495                                     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a> *gameobject) 
<a name="l00496"></a>00496 {
<a name="l00497"></a>00497     <span class="keyword">struct </span><a class="code" href="../../de/de7/structObject.html">Object</a> *bobp= gameobject-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a33f8953dd41b83078db209e44d448b7c">GetBlenderObject</a>();
<a name="l00498"></a>00498     <span class="keywordflow">if</span> (bobp) {
<a name="l00499"></a>00499         <a class="code" href="../../df/d70/classCHashedPtr.html">CHashedPtr</a> bptr(bobp);
<a name="l00500"></a>00500         <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a> **gobp= m_map_blender_to_gameobject[bptr];
<a name="l00501"></a>00501         <span class="keywordflow">if</span> (gobp &amp;&amp; *gobp == gameobject)
<a name="l00502"></a>00502         {
<a name="l00503"></a>00503             <span class="comment">// also maintain m_map_blender_to_gameobject if the gameobject</span>
<a name="l00504"></a>00504             <span class="comment">// being removed is matching the blender object</span>
<a name="l00505"></a>00505             m_map_blender_to_gameobject.<a class="code" href="../../d8/d8a/classCTR__Map.html#a8fad837ac3e85e3d68e4ede4814025fd">remove</a>(bptr);
<a name="l00506"></a>00506         }
<a name="l00507"></a>00507     }
<a name="l00508"></a>00508 }
<a name="l00509"></a>00509 
<a name="l00510"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#aeaf9dc2ae10c77bc743a3290e0b807a8">00510</a> <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a> *<a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#aeaf9dc2ae10c77bc743a3290e0b807a8">KX_BlenderSceneConverter::FindGameObject</a>(
<a name="l00511"></a>00511                                     <span class="keyword">struct</span> <a class="code" href="../../de/de7/structObject.html">Object</a> *for_blenderobject) 
<a name="l00512"></a>00512 {
<a name="l00513"></a>00513     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a> **obp= m_map_blender_to_gameobject[<a class="code" href="../../df/d70/classCHashedPtr.html">CHashedPtr</a>(for_blenderobject)];
<a name="l00514"></a>00514     
<a name="l00515"></a>00515     <span class="keywordflow">return</span> obp?*obp:<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00516"></a>00516 }
<a name="l00517"></a>00517 
<a name="l00518"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a606e3b9c61879416e2a63a90f8f9f12e">00518</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a606e3b9c61879416e2a63a90f8f9f12e">KX_BlenderSceneConverter::RegisterGameMesh</a>(
<a name="l00519"></a>00519                                     <a class="code" href="../../d5/d85/classRAS__MeshObject.html">RAS_MeshObject</a> *gamemesh,
<a name="l00520"></a>00520                                     <span class="keyword">struct</span> <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *for_blendermesh)
<a name="l00521"></a>00521 {
<a name="l00522"></a>00522     <span class="keywordflow">if</span> (for_blendermesh) { <span class="comment">/* dynamically loaded meshes we don&#39;t want to keep lookups for */</span>
<a name="l00523"></a>00523         m_map_mesh_to_gamemesh.<a class="code" href="../../d8/d8a/classCTR__Map.html#a79e68315a7733982eea54107231300df">insert</a>(<a class="code" href="../../df/d70/classCHashedPtr.html">CHashedPtr</a>(for_blendermesh),gamemesh);
<a name="l00524"></a>00524     }
<a name="l00525"></a>00525     m_meshobjects.push_back(pair&lt;KX_Scene*,RAS_MeshObject*&gt;(m_currentScene,gamemesh));
<a name="l00526"></a>00526 }
<a name="l00527"></a>00527 
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 
<a name="l00530"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a0bdce6b402feeedbda74f00d8b9f4b1b">00530</a> <a class="code" href="../../d5/d85/classRAS__MeshObject.html">RAS_MeshObject</a> *<a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a0bdce6b402feeedbda74f00d8b9f4b1b">KX_BlenderSceneConverter::FindGameMesh</a>(
<a name="l00531"></a>00531                                     <span class="keyword">struct</span> <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *for_blendermesh<span class="comment">/*,</span>
<a name="l00532"></a>00532 <span class="comment">                                    unsigned int onlayer*/</span>)
<a name="l00533"></a>00533 {
<a name="l00534"></a>00534     <a class="code" href="../../d5/d85/classRAS__MeshObject.html">RAS_MeshObject</a>** meshp = m_map_mesh_to_gamemesh[<a class="code" href="../../df/d70/classCHashedPtr.html">CHashedPtr</a>(for_blendermesh)];
<a name="l00535"></a>00535     
<a name="l00536"></a>00536     <span class="keywordflow">if</span> (meshp<span class="comment">/* &amp;&amp; onlayer==(*meshp)-&gt;GetLightLayer()*/</span>) {
<a name="l00537"></a>00537         <span class="keywordflow">return</span> *meshp;
<a name="l00538"></a>00538     } <span class="keywordflow">else</span> {
<a name="l00539"></a>00539         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00540"></a>00540     }
<a name="l00541"></a>00541 }
<a name="l00542"></a>00542 
<a name="l00543"></a>00543     
<a name="l00544"></a>00544 
<a name="l00545"></a>00545 
<a name="l00546"></a>00546     
<a name="l00547"></a>00547 
<a name="l00548"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a4e2d7e9b1493bf1da3f38923ab89e417">00548</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a4e2d7e9b1493bf1da3f38923ab89e417">KX_BlenderSceneConverter::RegisterPolyMaterial</a>(<a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html">RAS_IPolyMaterial</a> *polymat)
<a name="l00549"></a>00549 {
<a name="l00550"></a>00550     m_polymaterials.push_back(pair&lt;KX_Scene*,RAS_IPolyMaterial*&gt;(m_currentScene,polymat));
<a name="l00551"></a>00551 }
<a name="l00552"></a>00552 
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 
<a name="l00555"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a7c106aa47a56b0cc56b65a86f64cee91">00555</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a7c106aa47a56b0cc56b65a86f64cee91">KX_BlenderSceneConverter::RegisterInterpolatorList</a>(
<a name="l00556"></a>00556                                     <a class="code" href="../../d3/da2/classBL__InterpolatorList.html">BL_InterpolatorList</a> *actList,
<a name="l00557"></a>00557                                     <span class="keyword">struct</span> <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *for_act)
<a name="l00558"></a>00558 {
<a name="l00559"></a>00559     m_map_blender_to_gameAdtList.<a class="code" href="../../d8/d8a/classCTR__Map.html#a79e68315a7733982eea54107231300df">insert</a>(<a class="code" href="../../df/d70/classCHashedPtr.html">CHashedPtr</a>(for_act), actList);
<a name="l00560"></a>00560 }
<a name="l00561"></a>00561 
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 
<a name="l00564"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a22a3e99774c09cd0fa9b77efa923f09b">00564</a> <a class="code" href="../../d3/da2/classBL__InterpolatorList.html">BL_InterpolatorList</a> *<a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a22a3e99774c09cd0fa9b77efa923f09b">KX_BlenderSceneConverter::FindInterpolatorList</a>(
<a name="l00565"></a>00565                                     <span class="keyword">struct</span> <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *for_act)
<a name="l00566"></a>00566 {
<a name="l00567"></a>00567     <a class="code" href="../../d3/da2/classBL__InterpolatorList.html">BL_InterpolatorList</a> **listp = m_map_blender_to_gameAdtList[<a class="code" href="../../df/d70/classCHashedPtr.html">CHashedPtr</a>(for_act)];
<a name="l00568"></a>00568         
<a name="l00569"></a>00569     <span class="keywordflow">return</span> listp?*listp:<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00570"></a>00570 }
<a name="l00571"></a>00571 
<a name="l00572"></a>00572 
<a name="l00573"></a>00573 
<a name="l00574"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a7b9cc715f542ddb18f76ffd2458d48f6">00574</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a7b9cc715f542ddb18f76ffd2458d48f6">KX_BlenderSceneConverter::RegisterGameActuator</a>(
<a name="l00575"></a>00575                                     <a class="code" href="../../d5/d8b/classSCA__IActuator.html">SCA_IActuator</a> *act,
<a name="l00576"></a>00576                                     <span class="keyword">struct</span> <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *for_actuator)
<a name="l00577"></a>00577 {
<a name="l00578"></a>00578     m_map_blender_to_gameactuator.<a class="code" href="../../d8/d8a/classCTR__Map.html#a79e68315a7733982eea54107231300df">insert</a>(<a class="code" href="../../df/d70/classCHashedPtr.html">CHashedPtr</a>(for_actuator), act);
<a name="l00579"></a>00579 }
<a name="l00580"></a>00580 
<a name="l00581"></a>00581 
<a name="l00582"></a>00582 
<a name="l00583"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a0a02f6f0e4168497f8e340edaf56a229">00583</a> <a class="code" href="../../d5/d8b/classSCA__IActuator.html">SCA_IActuator</a> *<a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a0a02f6f0e4168497f8e340edaf56a229">KX_BlenderSceneConverter::FindGameActuator</a>(
<a name="l00584"></a>00584                                     <span class="keyword">struct</span> <a class="code" href="../../d0/d4a/structbActuator.html">bActuator</a> *for_actuator)
<a name="l00585"></a>00585 {
<a name="l00586"></a>00586     <a class="code" href="../../d5/d8b/classSCA__IActuator.html">SCA_IActuator</a> **actp = m_map_blender_to_gameactuator[<a class="code" href="../../df/d70/classCHashedPtr.html">CHashedPtr</a>(for_actuator)];
<a name="l00587"></a>00587     
<a name="l00588"></a>00588     <span class="keywordflow">return</span> actp?*actp:<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00589"></a>00589 }
<a name="l00590"></a>00590 
<a name="l00591"></a>00591 
<a name="l00592"></a>00592 
<a name="l00593"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#ab7530e1e58f6d012ab1ce3f550954775">00593</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#ab7530e1e58f6d012ab1ce3f550954775">KX_BlenderSceneConverter::RegisterGameController</a>(
<a name="l00594"></a>00594                                     <a class="code" href="../../d9/d74/classSCA__IController.html">SCA_IController</a> *cont,
<a name="l00595"></a>00595                                     <span class="keyword">struct</span> <a class="code" href="../../dd/d82/structbController.html">bController</a> *for_controller)
<a name="l00596"></a>00596 {
<a name="l00597"></a>00597     m_map_blender_to_gamecontroller.<a class="code" href="../../d8/d8a/classCTR__Map.html#a79e68315a7733982eea54107231300df">insert</a>(<a class="code" href="../../df/d70/classCHashedPtr.html">CHashedPtr</a>(for_controller), cont);
<a name="l00598"></a>00598 }
<a name="l00599"></a>00599 
<a name="l00600"></a>00600 
<a name="l00601"></a>00601 
<a name="l00602"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#ad7b5a248ef90dc86bdb71530643dea4c">00602</a> <a class="code" href="../../d9/d74/classSCA__IController.html">SCA_IController</a> *<a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#ad7b5a248ef90dc86bdb71530643dea4c">KX_BlenderSceneConverter::FindGameController</a>(
<a name="l00603"></a>00603                                     <span class="keyword">struct</span> <a class="code" href="../../dd/d82/structbController.html">bController</a> *for_controller)
<a name="l00604"></a>00604 {
<a name="l00605"></a>00605     <a class="code" href="../../d9/d74/classSCA__IController.html">SCA_IController</a> **contp = m_map_blender_to_gamecontroller[<a class="code" href="../../df/d70/classCHashedPtr.html">CHashedPtr</a>(for_controller)];
<a name="l00606"></a>00606     
<a name="l00607"></a>00607     <span class="keywordflow">return</span> contp?*contp:<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00608"></a>00608 }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610 
<a name="l00611"></a>00611 
<a name="l00612"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#aa9a274bbce605a15f97d9ea38de9e8f3">00612</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#aa9a274bbce605a15f97d9ea38de9e8f3">KX_BlenderSceneConverter::RegisterWorldInfo</a>(
<a name="l00613"></a>00613                                     <a class="code" href="../../db/d52/classKX__WorldInfo.html">KX_WorldInfo</a> *worldinfo)
<a name="l00614"></a>00614 {
<a name="l00615"></a>00615     m_worldinfos.push_back(pair&lt;KX_Scene*,KX_WorldInfo*&gt;(m_currentScene,worldinfo));
<a name="l00616"></a>00616 }
<a name="l00617"></a>00617 
<a name="l00618"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a4e9c2034dae572b00e80f00933efa058">00618</a> <span class="keywordtype">void</span>    <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a4e9c2034dae572b00e80f00933efa058">KX_BlenderSceneConverter::ResetPhysicsObjectsAnimationIpo</a>(<span class="keywordtype">bool</span> clearIpo)
<a name="l00619"></a>00619 {
<a name="l00620"></a>00620 
<a name="l00621"></a>00621     <a class="code" href="../../d4/da5/KX__Scene_8h.html#a472d409e016e28a4d8d4e71fad49aa48">KX_SceneList</a>* scenes = m_ketsjiEngine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#ab5041d377d715cf6370650b377b6a585">CurrentScenes</a>();
<a name="l00622"></a>00622     <span class="keywordtype">int</span> numScenes = scenes-&gt;size();
<a name="l00623"></a>00623     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00624"></a>00624     <span class="keywordflow">for</span> (i=0;i&lt;numScenes;i++)
<a name="l00625"></a>00625     {
<a name="l00626"></a>00626         <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* scene = scenes-&gt;at(i);
<a name="l00627"></a>00627         <span class="comment">//PHY_IPhysicsEnvironment* physEnv = scene-&gt;GetPhysicsEnvironment();</span>
<a name="l00628"></a>00628         <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a>* parentList = scene-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ac0b0e3bb47162d2022402d0126f0f9ba">GetRootParentList</a>();
<a name="l00629"></a>00629         <span class="keywordtype">int</span> numObjects = parentList-&gt;<a class="code" href="../../d6/de7/classCListValue.html#abdbc617f2a8ab49346008d4ac857f9b4">GetCount</a>();
<a name="l00630"></a>00630         <span class="keywordtype">int</span> <a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a>;
<a name="l00631"></a>00631         <span class="keywordflow">for</span> (g=0;g&lt;numObjects;g++)
<a name="l00632"></a>00632         {
<a name="l00633"></a>00633             <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* gameObj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*)parentList-&gt;<a class="code" href="../../d6/de7/classCListValue.html#aa388a5dfd4110408735fc6926c7464b4">GetValue</a>(g);
<a name="l00634"></a>00634             <span class="keywordflow">if</span> (gameObj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a92e4767b602687027b7d3bdfcfc2407c">IsDynamic</a>())
<a name="l00635"></a>00635             {
<a name="l00636"></a>00636                 <span class="comment">//KX_IPhysicsController* physCtrl = gameObj-&gt;GetPhysicsController();</span>
<a name="l00637"></a>00637                 
<a name="l00638"></a>00638                 <a class="code" href="../../de/de7/structObject.html">Object</a>* blenderObject = gameObj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a33f8953dd41b83078db209e44d448b7c">GetBlenderObject</a>();
<a name="l00639"></a>00639                 <span class="keywordflow">if</span> (blenderObject)
<a name="l00640"></a>00640                 {
<a name="l00641"></a>00641 <span class="preprocessor">#if 0</span>
<a name="l00642"></a>00642 <span class="preprocessor"></span>                    <span class="comment">//erase existing ipo&#39;s</span>
<a name="l00643"></a>00643                     <a class="code" href="../../d2/dc5/structIpo.html">Ipo</a>* ipo = blenderObject-&gt;ipo;<span class="comment">//findIpoForName(blenderObject-&gt;id.name+2);</span>
<a name="l00644"></a>00644                     <span class="keywordflow">if</span> (ipo)
<a name="l00645"></a>00645                     {   <span class="comment">//clear the curve data</span>
<a name="l00646"></a>00646                         <span class="keywordflow">if</span> (clearIpo) {<span class="comment">//rcruiz</span>
<a name="l00647"></a>00647                             <a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *icu1;
<a name="l00648"></a>00648                                                         
<a name="l00649"></a>00649                             <span class="keywordtype">int</span> numCurves = 0;
<a name="l00650"></a>00650                             <span class="keywordflow">for</span> ( icu1 = (<a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a>*)ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a12f162ec784c7d4b3336c583dfa468e4">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; icu1;  ) {
<a name="l00651"></a>00651                             
<a name="l00652"></a>00652                                 <a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a>* tmpicu = icu1;
<a name="l00653"></a>00653                                 
<a name="l00654"></a>00654                                 <span class="comment">/*int i;</span>
<a name="l00655"></a>00655 <span class="comment">                                BezTriple *bezt;</span>
<a name="l00656"></a>00656 <span class="comment">                                for ( bezt = tmpicu-&gt;bezt, i = 0;   i &lt; tmpicu-&gt;totvert; i++, bezt++) {</span>
<a name="l00657"></a>00657 <span class="comment">                                    printf(&quot;(%f,%f,%f),(%f,%f,%f),(%f,%f,%f)\n&quot;,bezt-&gt;vec[0][0],bezt-&gt;vec[0][1],bezt-&gt;vec[0][2],bezt-&gt;vec[1][0],bezt-&gt;vec[1][1],bezt-&gt;vec[1][2],bezt-&gt;vec[2][0],bezt-&gt;vec[2][1],bezt-&gt;vec[2][2]);</span>
<a name="l00658"></a>00658 <span class="comment">                                }*/</span>
<a name="l00659"></a>00659                                 
<a name="l00660"></a>00660                                 icu1 = icu1-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#afe828a2dd44460b47a95430528ec274d">next</a>;
<a name="l00661"></a>00661                                 numCurves++;
<a name="l00662"></a>00662             
<a name="l00663"></a>00663                                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>( &amp;( blenderObject-&gt;ipo-&gt;curve ), tmpicu );
<a name="l00664"></a>00664                                 <span class="keywordflow">if</span> ( tmpicu-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#a2c2ff134af40961c76a8f410200a77d9">bezt</a> )
<a name="l00665"></a>00665                                     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>( tmpicu-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#a2c2ff134af40961c76a8f410200a77d9">bezt</a> );
<a name="l00666"></a>00666                                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>( tmpicu );
<a name="l00667"></a>00667                                 localDel_ipoCurve( tmpicu );
<a name="l00668"></a>00668                             }
<a name="l00669"></a>00669                         }
<a name="l00670"></a>00670                     } <span class="keywordflow">else</span>
<a name="l00671"></a>00671                     {   ipo = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">// XXX add_ipo(blenderObject-&gt;id.name+2, ID_OB);</span>
<a name="l00672"></a>00672                         blenderObject-&gt;ipo = ipo;
<a name="l00673"></a>00673 
<a name="l00674"></a>00674                     }
<a name="l00675"></a>00675 <span class="preprocessor">#endif</span>
<a name="l00676"></a>00676 <span class="preprocessor"></span>                }
<a name="l00677"></a>00677             }
<a name="l00678"></a>00678 
<a name="l00679"></a>00679         }
<a name="l00680"></a>00680         
<a name="l00681"></a>00681     
<a name="l00682"></a>00682     }
<a name="l00683"></a>00683 
<a name="l00684"></a>00684 
<a name="l00685"></a>00685 
<a name="l00686"></a>00686 }
<a name="l00687"></a>00687 
<a name="l00688"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a8fb32fa85a62228f660b3f1e474be096">00688</a> <span class="keywordtype">void</span>    <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a8fb32fa85a62228f660b3f1e474be096" title="this is for reseting the position,rotation and scale of the gameobjet that is not dynamic...">KX_BlenderSceneConverter::resetNoneDynamicObjectToIpo</a>()
<a name="l00689"></a>00689 {
<a name="l00690"></a>00690     <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfb/classKX__ISceneConverter.html#a876fa6054861347717b258b80dcdb85a">addInitFromFrame</a>) {     
<a name="l00691"></a>00691         <a class="code" href="../../d4/da5/KX__Scene_8h.html#a472d409e016e28a4d8d4e71fad49aa48">KX_SceneList</a>* scenes = m_ketsjiEngine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#ab5041d377d715cf6370650b377b6a585">CurrentScenes</a>();
<a name="l00692"></a>00692         <span class="keywordtype">int</span> numScenes = scenes-&gt;size();
<a name="l00693"></a>00693         <span class="keywordflow">if</span> (numScenes&gt;=0) {
<a name="l00694"></a>00694             <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* scene = scenes-&gt;at(0);
<a name="l00695"></a>00695             <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a>* parentList = scene-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ac0b0e3bb47162d2022402d0126f0f9ba">GetRootParentList</a>();
<a name="l00696"></a>00696             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ix=0;ix&lt;parentList-&gt;<a class="code" href="../../d6/de7/classCListValue.html#abdbc617f2a8ab49346008d4ac857f9b4">GetCount</a>();ix++) {
<a name="l00697"></a>00697                 <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* gameobj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*)parentList-&gt;<a class="code" href="../../d6/de7/classCListValue.html#aa388a5dfd4110408735fc6926c7464b4">GetValue</a>(ix);
<a name="l00698"></a>00698                 <span class="keywordflow">if</span> (!gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a92e4767b602687027b7d3bdfcfc2407c">IsDynamic</a>()) {
<a name="l00699"></a>00699                     <a class="code" href="../../de/de7/structObject.html">Object</a>* blenderobject = gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a33f8953dd41b83078db209e44d448b7c">GetBlenderObject</a>();
<a name="l00700"></a>00700                     <span class="keywordflow">if</span> (!blenderobject)
<a name="l00701"></a>00701                         <span class="keywordflow">continue</span>;
<a name="l00702"></a>00702                     <span class="keywordflow">if</span> (blenderobject-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a17c162dffb7fd4f0acb11d051374609b">OB_ARMATURE</a>)
<a name="l00703"></a>00703                         <span class="keywordflow">continue</span>;
<a name="l00704"></a>00704                     <span class="keywordtype">float</span> eu[3];
<a name="l00705"></a>00705                     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#abaa23f334189d294344e4c161701ddb2">mat4_to_eul</a>(eu,blenderobject-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);                   
<a name="l00706"></a>00706                     <a class="code" href="../../d0/d9e/classMT__Point3.html">MT_Point3</a> pos = <a class="code" href="../../d0/d9e/classMT__Point3.html">MT_Point3</a>(
<a name="l00707"></a>00707                         blenderobject-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3][0],
<a name="l00708"></a>00708                         blenderobject-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3][1],
<a name="l00709"></a>00709                         blenderobject-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>[3][2]
<a name="l00710"></a>00710                     );
<a name="l00711"></a>00711                     <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a> eulxyz = <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a>(
<a name="l00712"></a>00712                         eu[0],
<a name="l00713"></a>00713                         eu[1],
<a name="l00714"></a>00714                         eu[2]
<a name="l00715"></a>00715                     );
<a name="l00716"></a>00716                     <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a> scale = <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a>(
<a name="l00717"></a>00717                         blenderobject-&gt;<a class="code" href="../../de/de7/structObject.html#a46e0f5309f8c13d85e16fa6436acf9f8">size</a>[0],
<a name="l00718"></a>00718                         blenderobject-&gt;<a class="code" href="../../de/de7/structObject.html#a46e0f5309f8c13d85e16fa6436acf9f8">size</a>[1],
<a name="l00719"></a>00719                         blenderobject-&gt;<a class="code" href="../../de/de7/structObject.html#a46e0f5309f8c13d85e16fa6436acf9f8">size</a>[2]
<a name="l00720"></a>00720                     );
<a name="l00721"></a>00721                     gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a22d183aca27dacd2942c7eb428fa0eb7">NodeSetLocalPosition</a>(pos);
<a name="l00722"></a>00722                     gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a3832f5baf84b55a2b3d71b98a85ac7b1">NodeSetLocalOrientation</a>(<a class="code" href="../../dd/d6f/classMT__Matrix3x3.html">MT_Matrix3x3</a>(eulxyz));
<a name="l00723"></a>00723                     gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#acfffcf209f87bf7bad4a25d0bfcfd2a8">NodeSetLocalScale</a>(scale);
<a name="l00724"></a>00724                     gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#abd94bbbcf52249812ac7ddd8d61b079c">NodeUpdateGS</a>(0);
<a name="l00725"></a>00725                 }
<a name="l00726"></a>00726             }
<a name="l00727"></a>00727         }
<a name="l00728"></a>00728     }
<a name="l00729"></a>00729 }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731 
<a name="l00733"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#ac6d00ad474c581e781e8dfd93be75579">00733</a> <span class="keywordtype">void</span>    <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#ac6d00ad474c581e781e8dfd93be75579" title="this generates ipo curves for position, rotation, allowing to use game physics in animation...">KX_BlenderSceneConverter::WritePhysicsObjectToAnimationIpo</a>(<span class="keywordtype">int</span> frameNumber)
<a name="l00734"></a>00734 {
<a name="l00735"></a>00735 
<a name="l00736"></a>00736     <a class="code" href="../../d4/da5/KX__Scene_8h.html#a472d409e016e28a4d8d4e71fad49aa48">KX_SceneList</a>* scenes = m_ketsjiEngine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#ab5041d377d715cf6370650b377b6a585">CurrentScenes</a>();
<a name="l00737"></a>00737     <span class="keywordtype">int</span> numScenes = scenes-&gt;size();
<a name="l00738"></a>00738     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00739"></a>00739     <span class="keywordflow">for</span> (i=0;i&lt;numScenes;i++)
<a name="l00740"></a>00740     {
<a name="l00741"></a>00741         <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* scene = scenes-&gt;at(i);
<a name="l00742"></a>00742         <span class="comment">//PHY_IPhysicsEnvironment* physEnv = scene-&gt;GetPhysicsEnvironment();</span>
<a name="l00743"></a>00743         <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a>* parentList = scene-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a82b767d5115895ec258c43d353b75ff5">GetObjectList</a>();
<a name="l00744"></a>00744         <span class="keywordtype">int</span> numObjects = parentList-&gt;<a class="code" href="../../d6/de7/classCListValue.html#abdbc617f2a8ab49346008d4ac857f9b4">GetCount</a>();
<a name="l00745"></a>00745         <span class="keywordtype">int</span> <a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a>;
<a name="l00746"></a>00746         <span class="keywordflow">for</span> (g=0;g&lt;numObjects;g++)
<a name="l00747"></a>00747         {
<a name="l00748"></a>00748             <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* gameObj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*)parentList-&gt;<a class="code" href="../../d6/de7/classCListValue.html#aa388a5dfd4110408735fc6926c7464b4">GetValue</a>(g);
<a name="l00749"></a>00749             <a class="code" href="../../de/de7/structObject.html">Object</a>* blenderObject = gameObj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a33f8953dd41b83078db209e44d448b7c">GetBlenderObject</a>();
<a name="l00750"></a>00750             <span class="keywordflow">if</span> (blenderObject &amp;&amp; blenderObject-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; gameObj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a92e4767b602687027b7d3bdfcfc2407c">IsDynamic</a>())
<a name="l00751"></a>00751             {
<a name="l00752"></a>00752                 <span class="comment">//KX_IPhysicsController* physCtrl = gameObj-&gt;GetPhysicsController();</span>
<a name="l00753"></a>00753 
<a name="l00754"></a>00754                 <span class="keywordflow">if</span> (blenderObject-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00755"></a>00755                     <a class="code" href="../../dc/d51/BKE__animsys_8h.html#a3d1b7d3abe94890891569f4bd6ba21b1">BKE_id_add_animdata</a>(&amp;blenderObject-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>);
<a name="l00756"></a>00756 
<a name="l00757"></a>00757                 <span class="keywordflow">if</span> (blenderObject-&gt;<a class="code" href="../../de/de7/structObject.html#ac096321d973976369c05cef4b2a9565b">adt</a>)
<a name="l00758"></a>00758                 {
<a name="l00759"></a>00759                     <span class="keyword">const</span> <a class="code" href="../../d0/d9e/classMT__Point3.html">MT_Point3</a>&amp; position = gameObj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#afa83f00c96f7d08511a385730442019b">NodeGetWorldPosition</a>();
<a name="l00760"></a>00760                     <span class="comment">//const MT_Vector3&amp; scale = gameObj-&gt;NodeGetWorldScaling();</span>
<a name="l00761"></a>00761                     <span class="keyword">const</span> <a class="code" href="../../dd/d6f/classMT__Matrix3x3.html">MT_Matrix3x3</a>&amp; orn = gameObj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ac4c31c796993a704c92cbc2d82927cfe">NodeGetWorldOrientation</a>();
<a name="l00762"></a>00762 
<a name="l00763"></a>00763                     position.<a class="code" href="../../d8/da2/classMT__Tuple3.html#a860fc415de033c454f55d115fcb0210f">getValue</a>(blenderObject-&gt;<a class="code" href="../../de/de7/structObject.html#a56283253ed00c7461cae7602135fbba9">loc</a>);
<a name="l00764"></a>00764 
<a name="l00765"></a>00765                     <span class="keywordtype">float</span> tmat[3][3];
<a name="l00766"></a>00766                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> r=0;r&lt;3;r++)
<a name="l00767"></a>00767                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c=0;c&lt;3;c++)
<a name="l00768"></a>00768                             tmat[r][c] = (<span class="keywordtype">float</span>)orn[c][r];
<a name="l00769"></a>00769 
<a name="l00770"></a>00770                     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a08e6387e69cccc46190fdb741e8c5375">mat3_to_compatible_eul</a>(blenderObject-&gt;<a class="code" href="../../de/de7/structObject.html#a73a4242dd7998a04e9895fc07c749153">rot</a>, blenderObject-&gt;<a class="code" href="../../de/de7/structObject.html#a73a4242dd7998a04e9895fc07c749153">rot</a>, tmat);
<a name="l00771"></a>00771 
<a name="l00772"></a>00772                     <a class="code" href="../../db/d4b/keyframing_8c.html#a7b16b21b2ffb9b0e3b5caf7c60cadc76">insert_keyframe</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;blenderObject-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">&quot;location&quot;</span>, -1, (<span class="keywordtype">float</span>)frameNumber, <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a6707cbc2befc4b0c2908302c6146362ea01863cb4196f71ef949912ed242ac93f">INSERTKEY_FAST</a>);
<a name="l00773"></a>00773                     <a class="code" href="../../db/d4b/keyframing_8c.html#a7b16b21b2ffb9b0e3b5caf7c60cadc76">insert_keyframe</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;blenderObject-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">&quot;rotation_euler&quot;</span>, -1, (<span class="keywordtype">float</span>)frameNumber, <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a6707cbc2befc4b0c2908302c6146362ea01863cb4196f71ef949912ed242ac93f">INSERTKEY_FAST</a>);
<a name="l00774"></a>00774 
<a name="l00775"></a>00775 <span class="preprocessor">#if 0</span>
<a name="l00776"></a>00776 <span class="preprocessor"></span>                    <span class="keyword">const</span> <a class="code" href="../../d0/d9e/classMT__Point3.html">MT_Point3</a>&amp; position = gameObj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#afa83f00c96f7d08511a385730442019b">NodeGetWorldPosition</a>();
<a name="l00777"></a>00777                     <span class="comment">//const MT_Vector3&amp; scale = gameObj-&gt;NodeGetWorldScaling();</span>
<a name="l00778"></a>00778                     <span class="keyword">const</span> <a class="code" href="../../dd/d6f/classMT__Matrix3x3.html">MT_Matrix3x3</a>&amp; orn = gameObj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ac4c31c796993a704c92cbc2d82927cfe">NodeGetWorldOrientation</a>();
<a name="l00779"></a>00779                     
<a name="l00780"></a>00780                     <span class="keywordtype">float</span> eulerAngles[3];   
<a name="l00781"></a>00781                     <span class="keywordtype">float</span> eulerAnglesOld[3] = {0.0f, 0.0f, 0.0f};                       
<a name="l00782"></a>00782                     <span class="keywordtype">float</span> tmat[3][3];
<a name="l00783"></a>00783                     
<a name="l00784"></a>00784                     <span class="comment">// XXX animato</span>
<a name="l00785"></a>00785                     <a class="code" href="../../d2/dc5/structIpo.html">Ipo</a>* ipo = blenderObject-&gt;ipo;
<a name="l00786"></a>00786 
<a name="l00787"></a>00787                     <span class="comment">//create the curves, if not existing, set linear if new</span>
<a name="l00788"></a>00788 
<a name="l00789"></a>00789                     <a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *icu_lx = findIpoCurve((<a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *)ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a12f162ec784c7d4b3336c583dfa468e4">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>,<span class="stringliteral">&quot;LocX&quot;</span>);
<a name="l00790"></a>00790                     <span class="keywordflow">if</span> (!icu_lx) {
<a name="l00791"></a>00791                         icu_lx = verify_ipocurve(&amp;blenderObject-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a578f52dc83257a470bd250f1ecee80c8">blocktype</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d5e/DNA__ipo__types_8h.html#a27e4792ca7662013defb5d5c49e4dd20">OB_LOC_X</a>, 1);
<a name="l00792"></a>00792                         <span class="keywordflow">if</span> (icu_lx) icu_lx-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#ad39c6179137789e29e8b139a4dbf4549">ipo</a> = <a class="code" href="../../dc/d5e/DNA__ipo__types_8h.html#a45f43fec0249eeb7084d568fda5cd6a6">IPO_LIN</a>;
<a name="l00793"></a>00793                     }
<a name="l00794"></a>00794                     <a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *icu_ly = findIpoCurve((<a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *)ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a12f162ec784c7d4b3336c583dfa468e4">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>,<span class="stringliteral">&quot;LocY&quot;</span>);
<a name="l00795"></a>00795                     <span class="keywordflow">if</span> (!icu_ly) {
<a name="l00796"></a>00796                         icu_ly = verify_ipocurve(&amp;blenderObject-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a578f52dc83257a470bd250f1ecee80c8">blocktype</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d5e/DNA__ipo__types_8h.html#a513a340e950dce9c42a6a80f0a81c1a3">OB_LOC_Y</a>, 1);
<a name="l00797"></a>00797                         <span class="keywordflow">if</span> (icu_ly) icu_ly-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#ad39c6179137789e29e8b139a4dbf4549">ipo</a> = <a class="code" href="../../dc/d5e/DNA__ipo__types_8h.html#a45f43fec0249eeb7084d568fda5cd6a6">IPO_LIN</a>;
<a name="l00798"></a>00798                     }
<a name="l00799"></a>00799                     <a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *icu_lz = findIpoCurve((<a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *)ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a12f162ec784c7d4b3336c583dfa468e4">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>,<span class="stringliteral">&quot;LocZ&quot;</span>);
<a name="l00800"></a>00800                     <span class="keywordflow">if</span> (!icu_lz) {
<a name="l00801"></a>00801                         icu_lz = verify_ipocurve(&amp;blenderObject-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a578f52dc83257a470bd250f1ecee80c8">blocktype</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d5e/DNA__ipo__types_8h.html#a8ae819f84d4bb50a0da0e9c118ff795b">OB_LOC_Z</a>, 1);
<a name="l00802"></a>00802                         <span class="keywordflow">if</span> (icu_lz) icu_lz-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#ad39c6179137789e29e8b139a4dbf4549">ipo</a> = <a class="code" href="../../dc/d5e/DNA__ipo__types_8h.html#a45f43fec0249eeb7084d568fda5cd6a6">IPO_LIN</a>;
<a name="l00803"></a>00803                     }
<a name="l00804"></a>00804                     <a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *icu_rx = findIpoCurve((<a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *)ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a12f162ec784c7d4b3336c583dfa468e4">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>,<span class="stringliteral">&quot;RotX&quot;</span>);
<a name="l00805"></a>00805                     <span class="keywordflow">if</span> (!icu_rx) {
<a name="l00806"></a>00806                         icu_rx = verify_ipocurve(&amp;blenderObject-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a578f52dc83257a470bd250f1ecee80c8">blocktype</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d5e/DNA__ipo__types_8h.html#ab7f95025a9e7c3e44560ff3e47a47028">OB_ROT_X</a>, 1);
<a name="l00807"></a>00807                         <span class="keywordflow">if</span> (icu_rx) icu_rx-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#ad39c6179137789e29e8b139a4dbf4549">ipo</a> = <a class="code" href="../../dc/d5e/DNA__ipo__types_8h.html#a45f43fec0249eeb7084d568fda5cd6a6">IPO_LIN</a>;
<a name="l00808"></a>00808                     }
<a name="l00809"></a>00809                     <a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *icu_ry = findIpoCurve((<a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *)ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a12f162ec784c7d4b3336c583dfa468e4">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>,<span class="stringliteral">&quot;RotY&quot;</span>);
<a name="l00810"></a>00810                     <span class="keywordflow">if</span> (!icu_ry) {
<a name="l00811"></a>00811                         icu_ry = verify_ipocurve(&amp;blenderObject-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a578f52dc83257a470bd250f1ecee80c8">blocktype</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d5e/DNA__ipo__types_8h.html#a338abb6e4e4eded18bbe49c370fbb3a8">OB_ROT_Y</a>, 1);
<a name="l00812"></a>00812                         <span class="keywordflow">if</span> (icu_ry) icu_ry-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#ad39c6179137789e29e8b139a4dbf4549">ipo</a> = <a class="code" href="../../dc/d5e/DNA__ipo__types_8h.html#a45f43fec0249eeb7084d568fda5cd6a6">IPO_LIN</a>;
<a name="l00813"></a>00813                     }
<a name="l00814"></a>00814                     <a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *icu_rz = findIpoCurve((<a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *)ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a12f162ec784c7d4b3336c583dfa468e4">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>,<span class="stringliteral">&quot;RotZ&quot;</span>);
<a name="l00815"></a>00815                     <span class="keywordflow">if</span> (!icu_rz) {
<a name="l00816"></a>00816                         icu_rz = verify_ipocurve(&amp;blenderObject-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a578f52dc83257a470bd250f1ecee80c8">blocktype</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d5e/DNA__ipo__types_8h.html#a61d7f02a72a245dd8ce7ec193bc2c4a7">OB_ROT_Z</a>, 1);
<a name="l00817"></a>00817                         <span class="keywordflow">if</span> (icu_rz) icu_rz-&gt;<a class="code" href="../../dd/d35/structIpoCurve.html#ad39c6179137789e29e8b139a4dbf4549">ipo</a> = <a class="code" href="../../dc/d5e/DNA__ipo__types_8h.html#a45f43fec0249eeb7084d568fda5cd6a6">IPO_LIN</a>;
<a name="l00818"></a>00818                     }
<a name="l00819"></a>00819                     
<a name="l00820"></a>00820                     <span class="keywordflow">if</span> (icu_rx) eulerAnglesOld[0]= eval_icu( icu_rx, frameNumber - 1 ) / ((180 / 3.14159265f) / 10);
<a name="l00821"></a>00821                     <span class="keywordflow">if</span> (icu_ry) eulerAnglesOld[1]= eval_icu( icu_ry, frameNumber - 1 ) / ((180 / 3.14159265f) / 10);
<a name="l00822"></a>00822                     <span class="keywordflow">if</span> (icu_rz) eulerAnglesOld[2]= eval_icu( icu_rz, frameNumber - 1 ) / ((180 / 3.14159265f) / 10);
<a name="l00823"></a>00823                     
<a name="l00824"></a>00824                     <span class="comment">// orn.getValue((float *)tmat); // uses the wrong ordering, cant use this</span>
<a name="l00825"></a>00825                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> r=0;r&lt;3;r++)
<a name="l00826"></a>00826                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c=0;c&lt;3;c++)
<a name="l00827"></a>00827                             tmat[r][c] = orn[c][r];
<a name="l00828"></a>00828                     
<a name="l00829"></a>00829                     <span class="comment">// mat3_to_eul( eulerAngles,tmat); // better to use Mat3ToCompatibleEul</span>
<a name="l00830"></a>00830                     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a08e6387e69cccc46190fdb741e8c5375">mat3_to_compatible_eul</a>( eulerAngles, eulerAnglesOld,tmat);
<a name="l00831"></a>00831                     
<a name="l00832"></a>00832                     <span class="comment">//eval_icu</span>
<a name="l00833"></a>00833                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; 3; x++)
<a name="l00834"></a>00834                         eulerAngles[x] *= (<span class="keywordtype">float</span>) ((180 / 3.14159265f) / 10.0);
<a name="l00835"></a>00835                     
<a name="l00836"></a>00836                     <span class="comment">//fill the curves with data</span>
<a name="l00837"></a>00837                     <span class="keywordflow">if</span> (icu_lx) insert_vert_icu(icu_lx, frameNumber, position.<a class="code" href="../../d8/da2/classMT__Tuple3.html#a4fc6295783618921127b9c2fc50f1886">x</a>(), 1);
<a name="l00838"></a>00838                     <span class="keywordflow">if</span> (icu_ly) insert_vert_icu(icu_ly, frameNumber, position.<a class="code" href="../../d8/da2/classMT__Tuple3.html#a1f96a6c8175338f515073fa85b922275">y</a>(), 1);
<a name="l00839"></a>00839                     <span class="keywordflow">if</span> (icu_lz) insert_vert_icu(icu_lz, frameNumber, position.<a class="code" href="../../d8/da2/classMT__Tuple3.html#af9fc03727b4886fdc3492c2e4f3c8d79">z</a>(), 1);
<a name="l00840"></a>00840                     <span class="keywordflow">if</span> (icu_rx) insert_vert_icu(icu_rx, frameNumber, eulerAngles[0], 1);
<a name="l00841"></a>00841                     <span class="keywordflow">if</span> (icu_ry) insert_vert_icu(icu_ry, frameNumber, eulerAngles[1], 1);
<a name="l00842"></a>00842                     <span class="keywordflow">if</span> (icu_rz) insert_vert_icu(icu_rz, frameNumber, eulerAngles[2], 1);
<a name="l00843"></a>00843                     
<a name="l00844"></a>00844                     <span class="comment">// Handles are corrected at the end, testhandles_ipocurve isn&#39;t needed yet</span>
<a name="l00845"></a>00845 <span class="preprocessor">#endif</span>
<a name="l00846"></a>00846 <span class="preprocessor"></span>                }
<a name="l00847"></a>00847             }
<a name="l00848"></a>00848         }
<a name="l00849"></a>00849     }
<a name="l00850"></a>00850 }
<a name="l00851"></a>00851 
<a name="l00852"></a>00852 
<a name="l00853"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#afaef9930fd1580319a4dcdb017f77f7f">00853</a> <span class="keywordtype">void</span>    <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#afaef9930fd1580319a4dcdb017f77f7f">KX_BlenderSceneConverter::TestHandlesPhysicsObjectToAnimationIpo</a>()
<a name="l00854"></a>00854 {
<a name="l00855"></a>00855 
<a name="l00856"></a>00856     <a class="code" href="../../d4/da5/KX__Scene_8h.html#a472d409e016e28a4d8d4e71fad49aa48">KX_SceneList</a>* scenes = m_ketsjiEngine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#ab5041d377d715cf6370650b377b6a585">CurrentScenes</a>();
<a name="l00857"></a>00857     <span class="keywordtype">int</span> numScenes = scenes-&gt;size();
<a name="l00858"></a>00858     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00859"></a>00859     <span class="keywordflow">for</span> (i=0;i&lt;numScenes;i++)
<a name="l00860"></a>00860     {
<a name="l00861"></a>00861         <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* scene = scenes-&gt;at(i);
<a name="l00862"></a>00862         <span class="comment">//PHY_IPhysicsEnvironment* physEnv = scene-&gt;GetPhysicsEnvironment();</span>
<a name="l00863"></a>00863         <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a>* parentList = scene-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ac0b0e3bb47162d2022402d0126f0f9ba">GetRootParentList</a>();
<a name="l00864"></a>00864         <span class="keywordtype">int</span> numObjects = parentList-&gt;<a class="code" href="../../d6/de7/classCListValue.html#abdbc617f2a8ab49346008d4ac857f9b4">GetCount</a>();
<a name="l00865"></a>00865         <span class="keywordtype">int</span> <a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a>;
<a name="l00866"></a>00866         <span class="keywordflow">for</span> (g=0;g&lt;numObjects;g++)
<a name="l00867"></a>00867         {
<a name="l00868"></a>00868             <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* gameObj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*)parentList-&gt;<a class="code" href="../../d6/de7/classCListValue.html#aa388a5dfd4110408735fc6926c7464b4">GetValue</a>(g);
<a name="l00869"></a>00869             <span class="keywordflow">if</span> (gameObj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a92e4767b602687027b7d3bdfcfc2407c">IsDynamic</a>())
<a name="l00870"></a>00870             {
<a name="l00871"></a>00871                 <span class="comment">//KX_IPhysicsController* physCtrl = gameObj-&gt;GetPhysicsController();</span>
<a name="l00872"></a>00872                 
<a name="l00873"></a>00873 <span class="preprocessor">#if 0</span>
<a name="l00874"></a>00874 <span class="preprocessor"></span>                <a class="code" href="../../de/de7/structObject.html">Object</a>* blenderObject = gameObj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a33f8953dd41b83078db209e44d448b7c">GetBlenderObject</a>();
<a name="l00875"></a>00875                 <span class="keywordflow">if</span> (blenderObject &amp;&amp; blenderObject-&gt;ipo)
<a name="l00876"></a>00876                 {
<a name="l00877"></a>00877                     <span class="comment">// XXX animato</span>
<a name="l00878"></a>00878                     <a class="code" href="../../d2/dc5/structIpo.html">Ipo</a>* ipo = blenderObject-&gt;ipo;
<a name="l00879"></a>00879                     
<a name="l00880"></a>00880                     <span class="comment">//create the curves, if not existing</span>
<a name="l00881"></a>00881                     <span class="comment">//testhandles_ipocurve checks for NULL</span>
<a name="l00882"></a>00882                     testhandles_ipocurve(findIpoCurve((<a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *)ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a12f162ec784c7d4b3336c583dfa468e4">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>,<span class="stringliteral">&quot;LocX&quot;</span>));
<a name="l00883"></a>00883                     testhandles_ipocurve(findIpoCurve((<a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *)ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a12f162ec784c7d4b3336c583dfa468e4">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>,<span class="stringliteral">&quot;LocY&quot;</span>));
<a name="l00884"></a>00884                     testhandles_ipocurve(findIpoCurve((<a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *)ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a12f162ec784c7d4b3336c583dfa468e4">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>,<span class="stringliteral">&quot;LocZ&quot;</span>));
<a name="l00885"></a>00885                     testhandles_ipocurve(findIpoCurve((<a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *)ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a12f162ec784c7d4b3336c583dfa468e4">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>,<span class="stringliteral">&quot;RotX&quot;</span>));
<a name="l00886"></a>00886                     testhandles_ipocurve(findIpoCurve((<a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *)ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a12f162ec784c7d4b3336c583dfa468e4">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>,<span class="stringliteral">&quot;RotY&quot;</span>));
<a name="l00887"></a>00887                     testhandles_ipocurve(findIpoCurve((<a class="code" href="../../dd/d35/structIpoCurve.html">IpoCurve</a> *)ipo-&gt;<a class="code" href="../../d2/dc5/structIpo.html#a12f162ec784c7d4b3336c583dfa468e4">curve</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>,<span class="stringliteral">&quot;RotZ&quot;</span>));
<a name="l00888"></a>00888                 }
<a name="l00889"></a>00889 <span class="preprocessor">#endif</span>
<a name="l00890"></a>00890 <span class="preprocessor"></span>            }
<a name="l00891"></a>00891         }
<a name="l00892"></a>00892     }
<a name="l00893"></a>00893 }
<a name="l00894"></a>00894 
<a name="l00895"></a>00895 <span class="preprocessor">#ifdef WITH_PYTHON</span>
<a name="l00896"></a>00896 <span class="preprocessor"></span>PyObject *KX_BlenderSceneConverter::GetPyNamespace()
<a name="l00897"></a>00897 {
<a name="l00898"></a>00898     <span class="keywordflow">return</span> m_ketsjiEngine-&gt;GetPyNamespace();
<a name="l00899"></a>00899 }
<a name="l00900"></a>00900 <span class="preprocessor">#endif</span>
<a name="l00901"></a>00901 <span class="preprocessor"></span>
<a name="l00902"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a527749076873a7371965e64490135cde">00902</a> vector&lt;Main*&gt; &amp;<a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a527749076873a7371965e64490135cde">KX_BlenderSceneConverter::GetMainDynamic</a>()
<a name="l00903"></a>00903 {
<a name="l00904"></a>00904     <span class="keywordflow">return</span> m_DynamicMaggie;
<a name="l00905"></a>00905 }
<a name="l00906"></a>00906 
<a name="l00907"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a751dd7a9a03087d5a9be1d80fee8e63f">00907</a> <a class="code" href="../../d0/dc0/structMain.html">Main</a>* <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a751dd7a9a03087d5a9be1d80fee8e63f">KX_BlenderSceneConverter::GetMainDynamicPath</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *path)
<a name="l00908"></a>00908 {
<a name="l00909"></a>00909     <span class="keywordflow">for</span> (vector&lt;Main*&gt;::iterator it=m_DynamicMaggie.begin(); !(it==m_DynamicMaggie.end()); it++)
<a name="l00910"></a>00910         <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd9/BLI__path__util_8h.html#af94a3a93cdb6b15b6f283ccf3d467f8e">BLI_path_cmp</a>((*it)-&gt;name, path) == 0)
<a name="l00911"></a>00911             <span class="keywordflow">return</span> *it;
<a name="l00912"></a>00912     
<a name="l00913"></a>00913     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00914"></a>00914 }
<a name="l00915"></a>00915 
<a name="l00916"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#ae9c3c89b9533afbaa94d44873f1690a4">00916</a> <span class="keywordtype">bool</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#ae9c3c89b9533afbaa94d44873f1690a4">KX_BlenderSceneConverter::LinkBlendFileMemory</a>(<span class="keywordtype">void</span> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <span class="keywordtype">int</span> <a class="code" href="../../d1/d22/stdosl_8h.html#a939ad05d43eeb38dcadd8218e52d9648">length</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *path, <span class="keywordtype">char</span> *group, <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a> *scene_merge, <span class="keywordtype">char</span> **err_str, <span class="keywordtype">short</span> <a class="code" href="../../d3/d77/cycles__test_8cpp.html#ae5dd30972ef2b22e7bb03125f3c4a8c8">options</a>)
<a name="l00917"></a>00917 {
<a name="l00918"></a>00918     <a class="code" href="../../da/d01/BLO__readfile_8h.html#a53716b563c0689608d80b71bf07aa4cc">BlendHandle</a> *bpy_openlib = <a class="code" href="../../da/d01/BLO__readfile_8h.html#a63e6dbf99081a3bbb5e93bbe38f9fb17">BLO_blendhandle_from_memory</a>(data, length);
<a name="l00919"></a>00919 
<a name="l00920"></a>00920     <span class="comment">// Error checking is done in LinkBlendFile</span>
<a name="l00921"></a>00921     <span class="keywordflow">return</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a5278a874d93d46ca941f2497934e696a">LinkBlendFile</a>(bpy_openlib, path, group, scene_merge, err_str, options);
<a name="l00922"></a>00922 }
<a name="l00923"></a>00923 
<a name="l00924"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a45dc22c6d1136b1b67d9ac6e1d22afa0">00924</a> <span class="keywordtype">bool</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a45dc22c6d1136b1b67d9ac6e1d22afa0">KX_BlenderSceneConverter::LinkBlendFilePath</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *path, <span class="keywordtype">char</span> *group, <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a> *scene_merge, <span class="keywordtype">char</span> **err_str, <span class="keywordtype">short</span> <a class="code" href="../../d3/d77/cycles__test_8cpp.html#ae5dd30972ef2b22e7bb03125f3c4a8c8">options</a>)
<a name="l00925"></a>00925 {
<a name="l00926"></a>00926     <a class="code" href="../../da/d01/BLO__readfile_8h.html#a53716b563c0689608d80b71bf07aa4cc">BlendHandle</a> *bpy_openlib = <a class="code" href="../../da/d01/BLO__readfile_8h.html#a1ab15fe6495e64d2ece996dc7758bd45">BLO_blendhandle_from_file</a>((<span class="keywordtype">char</span> *)path, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00927"></a>00927 
<a name="l00928"></a>00928     <span class="comment">// Error checking is done in LinkBlendFile</span>
<a name="l00929"></a>00929     <span class="keywordflow">return</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a5278a874d93d46ca941f2497934e696a">LinkBlendFile</a>(bpy_openlib, path, group, scene_merge, err_str, options);
<a name="l00930"></a>00930 }
<a name="l00931"></a>00931 
<a name="l00932"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a5278a874d93d46ca941f2497934e696a">00932</a> <span class="keywordtype">bool</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a5278a874d93d46ca941f2497934e696a">KX_BlenderSceneConverter::LinkBlendFile</a>(<a class="code" href="../../da/d01/BLO__readfile_8h.html#a53716b563c0689608d80b71bf07aa4cc">BlendHandle</a> *bpy_openlib, <span class="keyword">const</span> <span class="keywordtype">char</span> *path, <span class="keywordtype">char</span> *group, <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a> *scene_merge, <span class="keywordtype">char</span> **err_str, <span class="keywordtype">short</span> <a class="code" href="../../d3/d77/cycles__test_8cpp.html#ae5dd30972ef2b22e7bb03125f3c4a8c8">options</a>)
<a name="l00933"></a>00933 {
<a name="l00934"></a>00934     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main_newlib; <span class="comment">/* stored as a dynamic &#39;main&#39; until we free it */</span>
<a name="l00935"></a>00935     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *main_tmp= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">/* created only for linking, then freed */</span>
<a name="l00936"></a>00936     <a class="code" href="../../d7/deb/structLinkNode.html">LinkNode</a> *<a class="code" href="../../d5/d95/makesdna_8c.html#a26fc633cf551a2621e172633486c85ef">names</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00937"></a>00937     <span class="keywordtype">int</span> idcode= <a class="code" href="../../d8/de8/BKE__idcode_8h.html#ab4b0b77f04bd78964c6e5ca362b5493f">BKE_idcode_from_name</a>(group);
<a name="l00938"></a>00938     <span class="keywordtype">short</span> <a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a>= 0; <span class="comment">/* don&#39;t need any special options */</span>
<a name="l00939"></a>00939     <a class="code" href="../../df/df0/structReportList.html">ReportList</a> reports;
<a name="l00940"></a>00940     <span class="keyword">static</span> <span class="keywordtype">char</span> err_local[255];
<a name="l00941"></a>00941     
<a name="l00942"></a>00942     <span class="comment">/* only scene and mesh supported right now */</span>
<a name="l00943"></a>00943     <span class="keywordflow">if</span> (idcode!=<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac2b425dbd1f73ad1720fafad2626d974">ID_SCE</a> &amp;&amp; idcode!=<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a2e6c796d1f9370e5fd552166098cdd27">ID_ME</a> &amp;&amp;idcode!=<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a20fe08f8d0b2a4e6c0dbb2371aacadb0">ID_AC</a>) {
<a name="l00944"></a>00944         <a class="code" href="../../d9/ded/BLI__winstuff_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(err_local, <span class="keyword">sizeof</span>(err_local), <span class="stringliteral">&quot;invalid ID type given \&quot;%s\&quot;\n&quot;</span>, group);
<a name="l00945"></a>00945         *err_str= err_local;
<a name="l00946"></a>00946         <a class="code" href="../../da/d01/BLO__readfile_8h.html#af0160cf4a53737ab47ec6cabbb0348c8">BLO_blendhandle_close</a>(bpy_openlib);
<a name="l00947"></a>00947         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00948"></a>00948     }
<a name="l00949"></a>00949     
<a name="l00950"></a>00950     <span class="keywordflow">if</span> (<a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a751dd7a9a03087d5a9be1d80fee8e63f">GetMainDynamicPath</a>(path)) {
<a name="l00951"></a>00951         <a class="code" href="../../d9/ded/BLI__winstuff_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(err_local, <span class="keyword">sizeof</span>(err_local), <span class="stringliteral">&quot;blend file already open \&quot;%s\&quot;\n&quot;</span>, path);
<a name="l00952"></a>00952         *err_str= err_local;
<a name="l00953"></a>00953         <a class="code" href="../../da/d01/BLO__readfile_8h.html#af0160cf4a53737ab47ec6cabbb0348c8">BLO_blendhandle_close</a>(bpy_openlib);
<a name="l00954"></a>00954         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00955"></a>00955     }
<a name="l00956"></a>00956 
<a name="l00957"></a>00957     <span class="keywordflow">if</span> (bpy_openlib==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00958"></a>00958         <a class="code" href="../../d9/ded/BLI__winstuff_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(err_local, <span class="keyword">sizeof</span>(err_local), <span class="stringliteral">&quot;could not open blendfile \&quot;%s\&quot;\n&quot;</span>, path);
<a name="l00959"></a>00959         *err_str= err_local;
<a name="l00960"></a>00960         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00961"></a>00961     }
<a name="l00962"></a>00962     
<a name="l00963"></a>00963     main_newlib= (<a class="code" href="../../d0/dc0/structMain.html">Main</a> *)<a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>( <span class="keyword">sizeof</span>(<a class="code" href="../../d0/dc0/structMain.html">Main</a>), <span class="stringliteral">&quot;BgeMain&quot;</span>);
<a name="l00964"></a>00964     <a class="code" href="../../d2/d40/BKE__report_8h.html#af5b01bb6a9ddfb55fadc44aee9a0d5a5">BKE_reports_init</a>(&amp;reports, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a22527dc0230f4e952ebf141b004d8861aca8f7314453dc576fbdca03031b66430">RPT_STORE</a>);  
<a name="l00965"></a>00965 
<a name="l00966"></a>00966     <span class="comment">/* here appending/linking starts */</span>
<a name="l00967"></a>00967     main_tmp = <a class="code" href="../../da/d01/BLO__readfile_8h.html#a832d387a5938edeb69c1685ec67e7b7b">BLO_library_append_begin</a>(main_newlib, &amp;bpy_openlib, (<span class="keywordtype">char</span> *)path);
<a name="l00968"></a>00968 
<a name="l00969"></a>00969     <span class="keywordtype">int</span> totnames_dummy;
<a name="l00970"></a>00970     names = <a class="code" href="../../da/d01/BLO__readfile_8h.html#a442f9a82d01910d393bfa444c2cba6a0">BLO_blendhandle_get_datablock_names</a>( bpy_openlib, idcode, &amp;totnames_dummy);
<a name="l00971"></a>00971     
<a name="l00972"></a>00972     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;
<a name="l00973"></a>00973     <a class="code" href="../../d7/deb/structLinkNode.html">LinkNode</a> *n= <a class="code" href="../../d5/d95/makesdna_8c.html#a26fc633cf551a2621e172633486c85ef">names</a>;
<a name="l00974"></a>00974     <span class="keywordflow">while</span>(n) {
<a name="l00975"></a>00975         <a class="code" href="../../da/d01/BLO__readfile_8h.html#aaf13182f65db0c51199fda2cc1cc37a7">BLO_library_append_named_part</a>(main_tmp, &amp;bpy_openlib, (<span class="keywordtype">char</span> *)n-&gt;<a class="code" href="../../d7/deb/structLinkNode.html#a0cbae9a354b6f652667f7d5ccee2d733">link</a>, idcode);
<a name="l00976"></a>00976         n= (<a class="code" href="../../d7/deb/structLinkNode.html">LinkNode</a> *)n-&gt;<a class="code" href="../../d7/deb/structLinkNode.html#a8dfad71be4e66058ae9b9a97383e128c">next</a>;
<a name="l00977"></a>00977         i++;
<a name="l00978"></a>00978     }
<a name="l00979"></a>00979     <a class="code" href="../../df/d31/BLI__linklist_8h.html#a8c58644b0c8fa747ee6d0b1d02b89861">BLI_linklist_free</a>(names, free); <span class="comment">/* free linklist *and* each node&#39;s data */</span>
<a name="l00980"></a>00980     
<a name="l00981"></a>00981     <a class="code" href="../../da/d01/BLO__readfile_8h.html#a4f52aad607d0bdf6f02a5a7b28d163a0">BLO_library_append_end</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, main_tmp, &amp;bpy_openlib, idcode, flag);
<a name="l00982"></a>00982 
<a name="l00983"></a>00983     <span class="comment">/* now do another round of linking for Scenes so all actions are properly loaded */</span>
<a name="l00984"></a>00984     <span class="keywordflow">if</span> (idcode==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac2b425dbd1f73ad1720fafad2626d974">ID_SCE</a> &amp;&amp; options &amp; <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a0e27ab4fd6d6ce78fbbb5aa9444f7fd6ae249b3e6c2cf0c39a682ef86a58a8095">LIB_LOAD_LOAD_ACTIONS</a>) {
<a name="l00985"></a>00985         main_tmp = <a class="code" href="../../da/d01/BLO__readfile_8h.html#a832d387a5938edeb69c1685ec67e7b7b">BLO_library_append_begin</a>(main_newlib, &amp;bpy_openlib, (<span class="keywordtype">char</span> *)path);
<a name="l00986"></a>00986 
<a name="l00987"></a>00987         <span class="keywordtype">int</span> totnames_dummy;
<a name="l00988"></a>00988         names = <a class="code" href="../../da/d01/BLO__readfile_8h.html#a442f9a82d01910d393bfa444c2cba6a0">BLO_blendhandle_get_datablock_names</a>( bpy_openlib, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a20fe08f8d0b2a4e6c0dbb2371aacadb0">ID_AC</a>, &amp;totnames_dummy);
<a name="l00989"></a>00989     
<a name="l00990"></a>00990         <span class="keywordtype">int</span> i=0;
<a name="l00991"></a>00991         <a class="code" href="../../d7/deb/structLinkNode.html">LinkNode</a> *n= <a class="code" href="../../d5/d95/makesdna_8c.html#a26fc633cf551a2621e172633486c85ef">names</a>;
<a name="l00992"></a>00992         <span class="keywordflow">while</span>(n) {
<a name="l00993"></a>00993             <a class="code" href="../../da/d01/BLO__readfile_8h.html#aaf13182f65db0c51199fda2cc1cc37a7">BLO_library_append_named_part</a>(main_tmp, &amp;bpy_openlib, (<span class="keywordtype">char</span> *)n-&gt;<a class="code" href="../../d7/deb/structLinkNode.html#a0cbae9a354b6f652667f7d5ccee2d733">link</a>, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a20fe08f8d0b2a4e6c0dbb2371aacadb0">ID_AC</a>);
<a name="l00994"></a>00994             n= (<a class="code" href="../../d7/deb/structLinkNode.html">LinkNode</a> *)n-&gt;<a class="code" href="../../d7/deb/structLinkNode.html#a8dfad71be4e66058ae9b9a97383e128c">next</a>;
<a name="l00995"></a>00995             i++;
<a name="l00996"></a>00996         }
<a name="l00997"></a>00997         <a class="code" href="../../df/d31/BLI__linklist_8h.html#a8c58644b0c8fa747ee6d0b1d02b89861">BLI_linklist_free</a>(names, free); <span class="comment">/* free linklist *and* each node&#39;s data */</span>
<a name="l00998"></a>00998     
<a name="l00999"></a>00999         <a class="code" href="../../da/d01/BLO__readfile_8h.html#a4f52aad607d0bdf6f02a5a7b28d163a0">BLO_library_append_end</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, main_tmp, &amp;bpy_openlib, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a20fe08f8d0b2a4e6c0dbb2371aacadb0">ID_AC</a>, flag);
<a name="l01000"></a>01000     }
<a name="l01001"></a>01001     
<a name="l01002"></a>01002     <a class="code" href="../../da/d01/BLO__readfile_8h.html#af0160cf4a53737ab47ec6cabbb0348c8">BLO_blendhandle_close</a>(bpy_openlib);
<a name="l01003"></a>01003 
<a name="l01004"></a>01004     <a class="code" href="../../d2/d40/BKE__report_8h.html#aa126c5bc2c816eab9e77a6fc81d6baaa">BKE_reports_clear</a>(&amp;reports);
<a name="l01005"></a>01005     <span class="comment">/* done linking */</span>  
<a name="l01006"></a>01006     
<a name="l01007"></a>01007     <span class="comment">/* needed for lookups*/</span>
<a name="l01008"></a>01008     <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a527749076873a7371965e64490135cde">GetMainDynamic</a>().push_back(main_newlib);
<a name="l01009"></a>01009     strncpy(main_newlib-&gt;<a class="code" href="../../d0/dc0/structMain.html#a8cf7ece1c27b22c05a1198b28d42ebdf">name</a>, path, <span class="keyword">sizeof</span>(main_newlib-&gt;<a class="code" href="../../d0/dc0/structMain.html#a8cf7ece1c27b22c05a1198b28d42ebdf">name</a>));    
<a name="l01010"></a>01010     
<a name="l01011"></a>01011     
<a name="l01012"></a>01012     <span class="keywordflow">if</span> (idcode==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a2e6c796d1f9370e5fd552166098cdd27">ID_ME</a>) {
<a name="l01013"></a>01013         <span class="comment">/* Convert all new meshes into BGE meshes */</span>
<a name="l01014"></a>01014         <a class="code" href="../../d8/d7e/structID.html">ID</a>* <a class="code" href="../../de/de7/structObject.html#ad755772f4633cd0ef94a05738ffb5e84">mesh</a>;
<a name="l01015"></a>01015     
<a name="l01016"></a>01016         <span class="keywordflow">for</span> (mesh= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)main_newlib-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; mesh; mesh= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)mesh-&gt;<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a> ) {
<a name="l01017"></a>01017             <span class="keywordflow">if</span> (options &amp; <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a0e27ab4fd6d6ce78fbbb5aa9444f7fd6af42ca00614cd394a711e0846f58dcfe2">LIB_LOAD_VERBOSE</a>)
<a name="l01018"></a>01018                 printf(<span class="stringliteral">&quot;MeshName: %s\n&quot;</span>, mesh-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2);
<a name="l01019"></a>01019             <a class="code" href="../../d5/d85/classRAS__MeshObject.html">RAS_MeshObject</a> *meshobj = <a class="code" href="../../d6/df2/BL__BlenderDataConversion_8cpp.html#a9dbfbbf38d5103b376e1d9d27915075a">BL_ConvertMesh</a>((<a class="code" href="../../da/d29/structMesh.html">Mesh</a> *)mesh, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, scene_merge, <span class="keyword">this</span>);
<a name="l01020"></a>01020             scene_merge-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ad9270d324274b162133dd9a02f9bca58">GetLogicManager</a>()-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a11c13569539a998c302b2e47924581bb">RegisterMeshName</a>(meshobj-&gt;<a class="code" href="../../d5/d85/classRAS__MeshObject.html#a8e232cc1d6f124cc472f9717f82c2f77">GetName</a>(),meshobj);
<a name="l01021"></a>01021         }
<a name="l01022"></a>01022     }
<a name="l01023"></a>01023     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idcode==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a20fe08f8d0b2a4e6c0dbb2371aacadb0">ID_AC</a>) {
<a name="l01024"></a>01024         <span class="comment">/* Convert all actions */</span>
<a name="l01025"></a>01025         <a class="code" href="../../d8/d7e/structID.html">ID</a> *action;
<a name="l01026"></a>01026 
<a name="l01027"></a>01027         <span class="keywordflow">for</span> (action= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)main_newlib-&gt;<a class="code" href="../../d0/dc0/structMain.html#a672d2abaa0d861f3a2d938549cbe212b">action</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; action; action= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)action-&gt;<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01028"></a>01028             <span class="keywordflow">if</span> (options &amp; <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a0e27ab4fd6d6ce78fbbb5aa9444f7fd6af42ca00614cd394a711e0846f58dcfe2">LIB_LOAD_VERBOSE</a>)
<a name="l01029"></a>01029                 printf(<span class="stringliteral">&quot;ActionName: %s\n&quot;</span>, action-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2);
<a name="l01030"></a>01030             scene_merge-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ad9270d324274b162133dd9a02f9bca58">GetLogicManager</a>()-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a6ecb5dc48bbeaa0c35c5f7a77cefdba8">RegisterActionName</a>(action-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, action);
<a name="l01031"></a>01031         }
<a name="l01032"></a>01032     }
<a name="l01033"></a>01033     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idcode==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac2b425dbd1f73ad1720fafad2626d974">ID_SCE</a>) {      
<a name="l01034"></a>01034         <span class="comment">/* Merge all new linked in scene into the existing one */</span>
<a name="l01035"></a>01035         <a class="code" href="../../d8/d7e/structID.html">ID</a> *scene;
<a name="l01036"></a>01036         <span class="keywordflow">for</span> (scene= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)main_newlib-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; scene; scene= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)scene-&gt;<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a> ) {
<a name="l01037"></a>01037             <span class="keywordflow">if</span> (options &amp; <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a0e27ab4fd6d6ce78fbbb5aa9444f7fd6af42ca00614cd394a711e0846f58dcfe2">LIB_LOAD_VERBOSE</a>)
<a name="l01038"></a>01038                 printf(<span class="stringliteral">&quot;SceneName: %s\n&quot;</span>, scene-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2);
<a name="l01039"></a>01039             
<a name="l01040"></a>01040             <span class="comment">/* merge into the base  scene */</span>
<a name="l01041"></a>01041             <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* other= m_ketsjiEngine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a8b193855b5a768fbfe1a15dd7570b796">CreateScene</a>((<a class="code" href="../../d9/d27/structScene.html">Scene</a> *)scene);
<a name="l01042"></a>01042             scene_merge-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#aaf62549b29afc4d00216c108dd0bd8d9">MergeScene</a>(other);
<a name="l01043"></a>01043             
<a name="l01044"></a>01044             <span class="comment">// RemoveScene(other); // Don&#39;t run this, it frees the entire scene converter data, just delete the scene</span>
<a name="l01045"></a>01045             <span class="keyword">delete</span> other;
<a name="l01046"></a>01046         }
<a name="l01047"></a>01047 
<a name="l01048"></a>01048         <span class="comment">/* Now handle all the actions */</span>
<a name="l01049"></a>01049         <span class="keywordflow">if</span> (options &amp; LIB_LOAD_LOAD_ACTIONS) {
<a name="l01050"></a>01050             <a class="code" href="../../d8/d7e/structID.html">ID</a> *action;
<a name="l01051"></a>01051 
<a name="l01052"></a>01052             <span class="keywordflow">for</span> (action= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)main_newlib-&gt;<a class="code" href="../../d0/dc0/structMain.html#a672d2abaa0d861f3a2d938549cbe212b">action</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; action; action= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)action-&gt;<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01053"></a>01053                 <span class="keywordflow">if</span> (options &amp; <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a0e27ab4fd6d6ce78fbbb5aa9444f7fd6af42ca00614cd394a711e0846f58dcfe2">LIB_LOAD_VERBOSE</a>)
<a name="l01054"></a>01054                     printf(<span class="stringliteral">&quot;ActionName: %s\n&quot;</span>, action-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2);
<a name="l01055"></a>01055                 scene_merge-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ad9270d324274b162133dd9a02f9bca58">GetLogicManager</a>()-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a6ecb5dc48bbeaa0c35c5f7a77cefdba8">RegisterActionName</a>(action-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, action);
<a name="l01056"></a>01056             }
<a name="l01057"></a>01057         }
<a name="l01058"></a>01058     }
<a name="l01059"></a>01059     
<a name="l01060"></a>01060     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01061"></a>01061 }
<a name="l01062"></a>01062 
<a name="l01063"></a>01063 <span class="comment">/* Note m_map_*** are all ok and don&#39;t need to be freed</span>
<a name="l01064"></a>01064 <span class="comment"> * most are temp and NewRemoveObject frees m_map_gameobject_to_blender */</span>
<a name="l01065"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#aea3adfc4ddac4acdf9c47c02d93ea2b6">01065</a> <span class="keywordtype">bool</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#aea3adfc4ddac4acdf9c47c02d93ea2b6">KX_BlenderSceneConverter::FreeBlendFile</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/dc0/structMain.html">Main</a> *maggie)
<a name="l01066"></a>01066 {
<a name="l01067"></a>01067     <span class="keywordtype">int</span> maggie_index= -1;
<a name="l01068"></a>01068     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;
<a name="l01069"></a>01069 
<a name="l01070"></a>01070     <span class="keywordflow">if</span> (maggie==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01071"></a>01071         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01072"></a>01072     
<a name="l01073"></a>01073     <span class="comment">/* tag all false except the one we remove */</span>
<a name="l01074"></a>01074     <span class="keywordflow">for</span> (vector&lt;Main*&gt;::iterator it=m_DynamicMaggie.begin(); !(it==m_DynamicMaggie.end()); it++) {
<a name="l01075"></a>01075         <a class="code" href="../../d0/dc0/structMain.html">Main</a> *<a class="code" href="../../d5/d95/makesdna_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>= *it;
<a name="l01076"></a>01076         <span class="keywordflow">if</span> (main != maggie) {
<a name="l01077"></a>01077             <a class="code" href="../../d8/db1/BKE__library_8h.html#a4ae0a1efb5ecd05d334965b5b8567d63">tag_main</a>(main, 0);
<a name="l01078"></a>01078         }
<a name="l01079"></a>01079         <span class="keywordflow">else</span> {
<a name="l01080"></a>01080             maggie_index= <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01081"></a>01081         }
<a name="l01082"></a>01082         i++;
<a name="l01083"></a>01083     }
<a name="l01084"></a>01084 
<a name="l01085"></a>01085     <span class="comment">/* should never happen but just to be safe */</span>
<a name="l01086"></a>01086     <span class="keywordflow">if</span> (maggie_index == -1)
<a name="l01087"></a>01087         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01088"></a>01088 
<a name="l01089"></a>01089     m_DynamicMaggie.erase(m_DynamicMaggie.begin() + maggie_index);
<a name="l01090"></a>01090     <a class="code" href="../../d8/db1/BKE__library_8h.html#a4ae0a1efb5ecd05d334965b5b8567d63">tag_main</a>(maggie, 1);
<a name="l01091"></a>01091 
<a name="l01092"></a>01092 
<a name="l01093"></a>01093     <span class="comment">/* free all tagged objects */</span>
<a name="l01094"></a>01094     <a class="code" href="../../d4/da5/KX__Scene_8h.html#a472d409e016e28a4d8d4e71fad49aa48">KX_SceneList</a>* scenes = m_ketsjiEngine-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#ab5041d377d715cf6370650b377b6a585">CurrentScenes</a>();
<a name="l01095"></a>01095     <span class="keywordtype">int</span> numScenes = scenes-&gt;size();
<a name="l01096"></a>01096 
<a name="l01097"></a>01097 
<a name="l01098"></a>01098     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> scene_idx=0;scene_idx&lt;numScenes;scene_idx++)
<a name="l01099"></a>01099     {
<a name="l01100"></a>01100         <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* scene = scenes-&gt;at(scene_idx);
<a name="l01101"></a>01101         <span class="keywordflow">if</span> (<a class="code" href="../../d8/db1/BKE__library_8h.html#aa4e0884408263fa48530b69e9b0aa364">IS_TAGGED</a>(scene-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a217279a18aca964cf8d28d3ad6bdb95d">GetBlenderScene</a>())) {
<a name="l01102"></a>01102             <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a6a43899dee5c8783b7f110fd9403aec3">RemoveScene</a>(scene); <span class="comment">// XXX - not tested yet</span>
<a name="l01103"></a>01103             scene_idx--;
<a name="l01104"></a>01104             numScenes--;
<a name="l01105"></a>01105         }
<a name="l01106"></a>01106         <span class="keywordflow">else</span> {
<a name="l01107"></a>01107             
<a name="l01108"></a>01108             <span class="comment">/* in case the mesh might be refered to later */</span>
<a name="l01109"></a>01109             {
<a name="l01110"></a>01110                 <a class="code" href="../../d8/d8a/classCTR__Map.html">CTR_Map&lt;STR_HashedString,void*&gt;</a> &amp;mapStringToMeshes = scene-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ad9270d324274b162133dd9a02f9bca58">GetLogicManager</a>()-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#ad62c8ea2d7536bc7ef558623ea0ab998">GetMeshMap</a>();
<a name="l01111"></a>01111                 
<a name="l01112"></a>01112                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;mapStringToMeshes.<a class="code" href="../../d8/d8a/classCTR__Map.html#a3762555d21cfec45e6f7ecdcd61a8de5">size</a>(); i++)
<a name="l01113"></a>01113                 {
<a name="l01114"></a>01114                     <a class="code" href="../../d5/d85/classRAS__MeshObject.html">RAS_MeshObject</a> *meshobj= (<a class="code" href="../../d5/d85/classRAS__MeshObject.html">RAS_MeshObject</a> *) *mapStringToMeshes.<a class="code" href="../../d8/d8a/classCTR__Map.html#a4e4c294108caa048b4399f05ab1d1d96">at</a>(i);
<a name="l01115"></a>01115                     <span class="keywordflow">if</span> (meshobj &amp;&amp; <a class="code" href="../../d8/db1/BKE__library_8h.html#aa4e0884408263fa48530b69e9b0aa364">IS_TAGGED</a>(meshobj-&gt;<a class="code" href="../../d5/d85/classRAS__MeshObject.html#a3f873a70dc7521e2e67ef719ca3f22dc">GetMesh</a>()))
<a name="l01116"></a>01116                     {   
<a name="l01117"></a>01117                         <a class="code" href="../../dc/dfd/classSTR__HashedString.html">STR_HashedString</a> mn = meshobj-&gt;<a class="code" href="../../d5/d85/classRAS__MeshObject.html#a8e232cc1d6f124cc472f9717f82c2f77">GetName</a>();
<a name="l01118"></a>01118                         mapStringToMeshes.<a class="code" href="../../d8/d8a/classCTR__Map.html#a8fad837ac3e85e3d68e4ede4814025fd">remove</a>(mn);
<a name="l01119"></a>01119                         m_map_mesh_to_gamemesh.<a class="code" href="../../d8/d8a/classCTR__Map.html#a8fad837ac3e85e3d68e4ede4814025fd">remove</a>(<a class="code" href="../../df/d70/classCHashedPtr.html">CHashedPtr</a>(meshobj-&gt;<a class="code" href="../../d5/d85/classRAS__MeshObject.html#a3f873a70dc7521e2e67ef719ca3f22dc">GetMesh</a>()));
<a name="l01120"></a>01120                         i--;
<a name="l01121"></a>01121                     }
<a name="l01122"></a>01122                 }
<a name="l01123"></a>01123             }
<a name="l01124"></a>01124 
<a name="l01125"></a>01125             <span class="comment">/* Now unregister actions */</span>
<a name="l01126"></a>01126             {
<a name="l01127"></a>01127                 <a class="code" href="../../d8/d8a/classCTR__Map.html">CTR_Map&lt;STR_HashedString,void*&gt;</a> &amp;mapStringToActions = scene-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ad9270d324274b162133dd9a02f9bca58">GetLogicManager</a>()-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#af6b182afc21fa9846c48d6b34830fa27">GetActionMap</a>();
<a name="l01128"></a>01128 
<a name="l01129"></a>01129                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;mapStringToActions.<a class="code" href="../../d8/d8a/classCTR__Map.html#a3762555d21cfec45e6f7ecdcd61a8de5">size</a>(); i++)
<a name="l01130"></a>01130                 {
<a name="l01131"></a>01131                     <a class="code" href="../../d8/d7e/structID.html">ID</a> *action= (<a class="code" href="../../d8/d7e/structID.html">ID</a>*) *mapStringToActions.<a class="code" href="../../d8/d8a/classCTR__Map.html#a4e4c294108caa048b4399f05ab1d1d96">at</a>(i);
<a name="l01132"></a>01132 
<a name="l01133"></a>01133                     <span class="keywordflow">if</span> (<a class="code" href="../../d8/db1/BKE__library_8h.html#aa4e0884408263fa48530b69e9b0aa364">IS_TAGGED</a>(action))
<a name="l01134"></a>01134                     {
<a name="l01135"></a>01135                         <a class="code" href="../../dc/dfd/classSTR__HashedString.html">STR_HashedString</a> an = action-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2;
<a name="l01136"></a>01136                         mapStringToActions.<a class="code" href="../../d8/d8a/classCTR__Map.html#a8fad837ac3e85e3d68e4ede4814025fd">remove</a>(an);
<a name="l01137"></a>01137                         i--;
<a name="l01138"></a>01138                     }
<a name="l01139"></a>01139                 }
<a name="l01140"></a>01140             }
<a name="l01141"></a>01141             
<a name="l01142"></a>01142             <span class="comment">//scene-&gt;FreeTagged(); /* removed tagged objects and meshes*/</span>
<a name="l01143"></a>01143             <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a> *obj_lists[] = {scene-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a82b767d5115895ec258c43d353b75ff5">GetObjectList</a>(), scene-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#adb5a23c8d6be0524def1e704be87a251">GetInactiveList</a>(), <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01144"></a>01144 
<a name="l01145"></a>01145             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ob_ls_idx=0; obj_lists[ob_ls_idx]; ob_ls_idx++)
<a name="l01146"></a>01146             {
<a name="l01147"></a>01147                 <a class="code" href="../../d6/de7/classCListValue.html">CListValue</a> *obs= obj_lists[ob_ls_idx];
<a name="l01148"></a>01148                 <a class="code" href="../../d5/d85/classRAS__MeshObject.html">RAS_MeshObject</a>* <a class="code" href="../../de/de7/structObject.html#ad755772f4633cd0ef94a05738ffb5e84">mesh</a>;
<a name="l01149"></a>01149 
<a name="l01150"></a>01150                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ob_idx = 0; ob_idx &lt; obs-&gt;<a class="code" href="../../d6/de7/classCListValue.html#abdbc617f2a8ab49346008d4ac857f9b4">GetCount</a>(); ob_idx++)
<a name="l01151"></a>01151                 {
<a name="l01152"></a>01152                     <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>* gameobj = (<a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*)obs-&gt;<a class="code" href="../../d6/de7/classCListValue.html#aa388a5dfd4110408735fc6926c7464b4">GetValue</a>(ob_idx);
<a name="l01153"></a>01153                     <span class="keywordflow">if</span> (<a class="code" href="../../d8/db1/BKE__library_8h.html#aa4e0884408263fa48530b69e9b0aa364">IS_TAGGED</a>(gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a33f8953dd41b83078db209e44d448b7c">GetBlenderObject</a>())) {
<a name="l01154"></a>01154 
<a name="l01155"></a>01155                         <span class="keywordtype">int</span> size_before = obs-&gt;<a class="code" href="../../d6/de7/classCListValue.html#abdbc617f2a8ab49346008d4ac857f9b4">GetCount</a>();
<a name="l01156"></a>01156 
<a name="l01157"></a>01157                         <span class="comment">/* Eventually calls RemoveNodeDestructObject</span>
<a name="l01158"></a>01158 <span class="comment">                         * frees m_map_gameobject_to_blender from UnregisterGameObject */</span>
<a name="l01159"></a>01159                         scene-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#af875d0f33688aaa8cea374d9a96dbcbe">RemoveObject</a>(gameobj);
<a name="l01160"></a>01160 
<a name="l01161"></a>01161                         <span class="keywordflow">if</span> (size_before != obs-&gt;<a class="code" href="../../d6/de7/classCListValue.html#abdbc617f2a8ab49346008d4ac857f9b4">GetCount</a>())
<a name="l01162"></a>01162                             ob_idx--;
<a name="l01163"></a>01163                         <span class="keywordflow">else</span> {
<a name="l01164"></a>01164                             printf(<span class="stringliteral">&quot;ERROR COULD NOT REMOVE \&quot;%s\&quot;\n&quot;</span>, gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a268fb3bcc390cd18830e91113693eb40">GetName</a>().<a class="code" href="../../d6/dce/classSTR__String.html#a946cab5eea587bf86a388f826fd7e26c">ReadPtr</a>());
<a name="l01165"></a>01165                         }
<a name="l01166"></a>01166                     }
<a name="l01167"></a>01167                     <span class="keywordflow">else</span> {
<a name="l01168"></a>01168                         <span class="comment">/* free the mesh, we could be referecing a linked one! */</span>
<a name="l01169"></a>01169                         <span class="keywordtype">int</span> mesh_index= gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0380469d233ad08592b6a49819db066d">GetMeshCount</a>();
<a name="l01170"></a>01170                         <span class="keywordflow">while</span>(mesh_index--) {
<a name="l01171"></a>01171                             mesh= gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0a71e1e10264a686d4bce3ec2733fe86">GetMesh</a>(mesh_index);
<a name="l01172"></a>01172                             <span class="keywordflow">if</span> (<a class="code" href="../../d8/db1/BKE__library_8h.html#aa4e0884408263fa48530b69e9b0aa364">IS_TAGGED</a>(mesh-&gt;<a class="code" href="../../d5/d85/classRAS__MeshObject.html#a3f873a70dc7521e2e67ef719ca3f22dc">GetMesh</a>())) {
<a name="l01173"></a>01173                                 gameobj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#adc5a6f8bb55a78231a8a5c86de7cc10d">RemoveMeshes</a>(); <span class="comment">/* XXX - slack, should only remove meshes that are library items but mostly objects only have 1 mesh */</span>
<a name="l01174"></a>01174                                 <span class="keywordflow">break</span>;
<a name="l01175"></a>01175                             }
<a name="l01176"></a>01176                         }
<a name="l01177"></a>01177 
<a name="l01178"></a>01178                         <span class="comment">/* make sure action actuators are not referencing tagged actions */</span>
<a name="l01179"></a>01179                         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> act_idx=0; act_idx&lt;gameobj-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a8a1d0ac6bdbc54738fb30fbcf8fe67da">GetActuators</a>().size(); act_idx++)
<a name="l01180"></a>01180                         {
<a name="l01181"></a>01181                             <span class="keywordflow">if</span> (gameobj-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a8a1d0ac6bdbc54738fb30fbcf8fe67da">GetActuators</a>()[act_idx]-&gt;IsType(<a class="code" href="../../d5/d8b/classSCA__IActuator.html#abb1b6912f98c2923c9e9de33ba29f901adeb053a5dc778737958c6dcadeeb0ad6">SCA_IActuator::KX_ACT_ACTION</a>))
<a name="l01182"></a>01182                             {
<a name="l01183"></a>01183                                 <a class="code" href="../../d7/d1a/classBL__ActionActuator.html">BL_ActionActuator</a> *act = (<a class="code" href="../../d7/d1a/classBL__ActionActuator.html">BL_ActionActuator</a>*)gameobj-&gt;<a class="code" href="../../da/d68/classSCA__IObject.html#a8a1d0ac6bdbc54738fb30fbcf8fe67da">GetActuators</a>()[act_idx];
<a name="l01184"></a>01184                                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/db1/BKE__library_8h.html#aa4e0884408263fa48530b69e9b0aa364">IS_TAGGED</a>(act-&gt;<a class="code" href="../../d7/d1a/classBL__ActionActuator.html#a31a1d4ff257e133709792af4aa0111b9">GetAction</a>()))
<a name="l01185"></a>01185                                     act-&gt;<a class="code" href="../../d7/d1a/classBL__ActionActuator.html#a65f3f1c64c2d61772f24d645d6e75e95">SetAction</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01186"></a>01186                             }
<a name="l01187"></a>01187                         }
<a name="l01188"></a>01188                     }
<a name="l01189"></a>01189                 }
<a name="l01190"></a>01190             }
<a name="l01191"></a>01191         }
<a name="l01192"></a>01192     }
<a name="l01193"></a>01193 
<a name="l01194"></a>01194 
<a name="l01195"></a>01195     <span class="keywordtype">int</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l01196"></a>01196 
<a name="l01197"></a>01197     <span class="comment">// delete the entities of this scene</span>
<a name="l01198"></a>01198     <span class="comment">/* TODO - */</span>
<a name="l01199"></a>01199 <span class="preprocessor">#if 0</span>
<a name="l01200"></a>01200 <span class="preprocessor"></span>    vector&lt;pair&lt;KX_Scene*,KX_WorldInfo*&gt; &gt;::iterator worldit;
<a name="l01201"></a>01201     size = m_worldinfos.size();
<a name="l01202"></a>01202     <span class="keywordflow">for</span> (i=0, worldit=m_worldinfos.begin(); i&lt;<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>; ) {
<a name="l01203"></a>01203         <span class="keywordflow">if</span> ((*worldit).second) {
<a name="l01204"></a>01204             <span class="keyword">delete</span> (*worldit).second;
<a name="l01205"></a>01205             *worldit = m_worldinfos.back();
<a name="l01206"></a>01206             m_worldinfos.pop_back();
<a name="l01207"></a>01207             size--;
<a name="l01208"></a>01208         } <span class="keywordflow">else</span> {
<a name="l01209"></a>01209             i++;
<a name="l01210"></a>01210             worldit++;
<a name="l01211"></a>01211         }
<a name="l01212"></a>01212     }
<a name="l01213"></a>01213 <span class="preprocessor">#endif</span>
<a name="l01214"></a>01214 <span class="preprocessor"></span>
<a name="l01215"></a>01215 
<a name="l01216"></a>01216     <span class="comment">/* Worlds don&#39;t reference original blender data so we need to make a set from them */</span>
<a name="l01217"></a>01217     <span class="keyword">typedef</span> std::set&lt;KX_WorldInfo*&gt; KX_WorldInfoSet;
<a name="l01218"></a>01218     KX_WorldInfoSet worldset;
<a name="l01219"></a>01219     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> scene_idx=0;scene_idx&lt;numScenes;scene_idx++)
<a name="l01220"></a>01220     {
<a name="l01221"></a>01221         <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* scene = scenes-&gt;at(scene_idx);
<a name="l01222"></a>01222         <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a4831748648dedf769fd668499302da65">GetWorldInfo</a>())
<a name="l01223"></a>01223             worldset.insert( scene-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a4831748648dedf769fd668499302da65">GetWorldInfo</a>() );
<a name="l01224"></a>01224     }
<a name="l01225"></a>01225 
<a name="l01226"></a>01226     vector&lt;pair&lt;KX_Scene*,KX_WorldInfo*&gt; &gt;::iterator worldit;
<a name="l01227"></a>01227     size = m_worldinfos.size();
<a name="l01228"></a>01228     <span class="keywordflow">for</span> (i=0, worldit=m_worldinfos.begin(); i&lt;<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>; ) {
<a name="l01229"></a>01229         <span class="keywordflow">if</span> ((*worldit).second &amp;&amp; (worldset.count((*worldit).second)) == 0) {
<a name="l01230"></a>01230             <span class="keyword">delete</span> (*worldit).second;
<a name="l01231"></a>01231             *worldit = m_worldinfos.back();
<a name="l01232"></a>01232             m_worldinfos.pop_back();
<a name="l01233"></a>01233             size--;
<a name="l01234"></a>01234         } <span class="keywordflow">else</span> {
<a name="l01235"></a>01235             i++;
<a name="l01236"></a>01236             worldit++;
<a name="l01237"></a>01237         }
<a name="l01238"></a>01238     }
<a name="l01239"></a>01239     worldset.clear();
<a name="l01240"></a>01240     <span class="comment">/* done freeing the worlds */</span>
<a name="l01241"></a>01241 
<a name="l01242"></a>01242 
<a name="l01243"></a>01243 
<a name="l01244"></a>01244 
<a name="l01245"></a>01245     vector&lt;pair&lt;KX_Scene*,RAS_IPolyMaterial*&gt; &gt;::iterator polymit;
<a name="l01246"></a>01246     size = m_polymaterials.size();
<a name="l01247"></a>01247 
<a name="l01248"></a>01248 
<a name="l01249"></a>01249 
<a name="l01250"></a>01250     <span class="keywordflow">for</span> (i=0, polymit=m_polymaterials.begin(); i&lt;<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>; ) {
<a name="l01251"></a>01251         <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html">RAS_IPolyMaterial</a> *<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>= (*polymit).second;
<a name="l01252"></a>01252         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *bmat= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01253"></a>01253 
<a name="l01254"></a>01254         <span class="comment">/* Why do we need to check for RAS_BLENDERMAT if both are cast to a (PyObject*)? - Campbell */</span>
<a name="l01255"></a>01255         <span class="keywordflow">if</span> (mat-&gt;<a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#a7bd4304a59852b7735385966fc4d6092">GetFlag</a>() &amp; <a class="code" href="../../dc/da4/RAS__IPolygonMaterial_8h.html#ad7eead3344431dbbe01a27f3df2eb14fa7f731696da676a0b2f7bb0dec1210248">RAS_BLENDERMAT</a>) {
<a name="l01256"></a>01256             <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a> *bl_mat = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>*<span class="keyword">&gt;</span>(<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>);
<a name="l01257"></a>01257             bmat= bl_mat-&gt;<a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a0e17077cb5f3111b6a7c0d86ea9288c8">GetBlenderMaterial</a>();
<a name="l01258"></a>01258 
<a name="l01259"></a>01259         } <span class="keywordflow">else</span> {
<a name="l01260"></a>01260             <a class="code" href="../../d9/d1f/classKX__PolygonMaterial.html">KX_PolygonMaterial</a> *kx_mat = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d9/d1f/classKX__PolygonMaterial.html">KX_PolygonMaterial</a>*<span class="keyword">&gt;</span>(<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>);
<a name="l01261"></a>01261             bmat= kx_mat-&gt;<a class="code" href="../../d9/d1f/classKX__PolygonMaterial.html#adbc2cb82252fb0d5ae8be957c6dcbc84">GetBlenderMaterial</a>();
<a name="l01262"></a>01262         }
<a name="l01263"></a>01263 
<a name="l01264"></a>01264         <span class="keywordflow">if</span> (<a class="code" href="../../d8/db1/BKE__library_8h.html#aa4e0884408263fa48530b69e9b0aa364">IS_TAGGED</a>(bmat)) {
<a name="l01265"></a>01265             <span class="comment">/* only remove from bucket */</span>
<a name="l01266"></a>01266             ((*polymit).first)-&gt;GetBucketManager()-&gt;RemoveMaterial(mat);
<a name="l01267"></a>01267         }
<a name="l01268"></a>01268 
<a name="l01269"></a>01269         i++;
<a name="l01270"></a>01270         polymit++;
<a name="l01271"></a>01271     }
<a name="l01272"></a>01272 
<a name="l01273"></a>01273 
<a name="l01274"></a>01274 
<a name="l01275"></a>01275     <span class="keywordflow">for</span> (i=0, polymit=m_polymaterials.begin(); i&lt;<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>; ) {
<a name="l01276"></a>01276         <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html">RAS_IPolyMaterial</a> *<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>= (*polymit).second;
<a name="l01277"></a>01277         <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *bmat= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01278"></a>01278 
<a name="l01279"></a>01279         <span class="comment">/* Why do we need to check for RAS_BLENDERMAT if both are cast to a (PyObject*)? - Campbell */</span>
<a name="l01280"></a>01280         <span class="keywordflow">if</span> (mat-&gt;<a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#a7bd4304a59852b7735385966fc4d6092">GetFlag</a>() &amp; <a class="code" href="../../dc/da4/RAS__IPolygonMaterial_8h.html#ad7eead3344431dbbe01a27f3df2eb14fa7f731696da676a0b2f7bb0dec1210248">RAS_BLENDERMAT</a>) {
<a name="l01281"></a>01281             <a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a> *bl_mat = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/d90/classKX__BlenderMaterial.html">KX_BlenderMaterial</a>*<span class="keyword">&gt;</span>(<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>);
<a name="l01282"></a>01282             bmat= bl_mat-&gt;<a class="code" href="../../d2/d90/classKX__BlenderMaterial.html#a0e17077cb5f3111b6a7c0d86ea9288c8">GetBlenderMaterial</a>();
<a name="l01283"></a>01283 
<a name="l01284"></a>01284         } <span class="keywordflow">else</span> {
<a name="l01285"></a>01285             <a class="code" href="../../d9/d1f/classKX__PolygonMaterial.html">KX_PolygonMaterial</a> *kx_mat = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d9/d1f/classKX__PolygonMaterial.html">KX_PolygonMaterial</a>*<span class="keyword">&gt;</span>(<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>);
<a name="l01286"></a>01286             bmat= kx_mat-&gt;<a class="code" href="../../d9/d1f/classKX__PolygonMaterial.html#adbc2cb82252fb0d5ae8be957c6dcbc84">GetBlenderMaterial</a>();
<a name="l01287"></a>01287         }
<a name="l01288"></a>01288 
<a name="l01289"></a>01289         <span class="keywordflow">if</span> (bmat) {
<a name="l01290"></a>01290             <span class="comment">//printf(&quot;FOUND MAT &#39;%s&#39; !!! &quot;, ((ID*)bmat)-&gt;name+2);</span>
<a name="l01291"></a>01291         }
<a name="l01292"></a>01292         <span class="keywordflow">else</span> {
<a name="l01293"></a>01293             <span class="comment">//printf(&quot;LOST MAT  !!!&quot;);</span>
<a name="l01294"></a>01294         }
<a name="l01295"></a>01295 
<a name="l01296"></a>01296         <span class="keywordflow">if</span> (<a class="code" href="../../d8/db1/BKE__library_8h.html#aa4e0884408263fa48530b69e9b0aa364">IS_TAGGED</a>(bmat)) {
<a name="l01297"></a>01297 
<a name="l01298"></a>01298             <span class="keyword">delete</span> (*polymit).second;
<a name="l01299"></a>01299             *polymit = m_polymaterials.back();
<a name="l01300"></a>01300             m_polymaterials.pop_back();
<a name="l01301"></a>01301             size--;
<a name="l01302"></a>01302             <span class="comment">//printf(&quot;tagged !\n&quot;);</span>
<a name="l01303"></a>01303         } <span class="keywordflow">else</span> {
<a name="l01304"></a>01304             i++;
<a name="l01305"></a>01305             polymit++;
<a name="l01306"></a>01306             <span class="comment">//printf(&quot;(un)tagged !\n&quot;);</span>
<a name="l01307"></a>01307         }
<a name="l01308"></a>01308     }
<a name="l01309"></a>01309 
<a name="l01310"></a>01310     vector&lt;pair&lt;KX_Scene*,BL_Material*&gt; &gt;::iterator matit;
<a name="l01311"></a>01311     size = m_materials.size();
<a name="l01312"></a>01312     <span class="keywordflow">for</span> (i=0, matit=m_materials.begin(); i&lt;<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>; ) {
<a name="l01313"></a>01313         <a class="code" href="../../d3/de1/classBL__Material.html">BL_Material</a> *<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>= (*matit).second;
<a name="l01314"></a>01314         <span class="keywordflow">if</span> (<a class="code" href="../../d8/db1/BKE__library_8h.html#aa4e0884408263fa48530b69e9b0aa364">IS_TAGGED</a>(mat-&gt;<a class="code" href="../../d3/de1/classBL__Material.html#a81464bdc9a517649d0f2342cb801e9dd">material</a>)) {
<a name="l01315"></a>01315             <span class="keyword">delete</span> (*matit).second;
<a name="l01316"></a>01316             *matit = m_materials.back();
<a name="l01317"></a>01317             m_materials.pop_back();
<a name="l01318"></a>01318             size--;
<a name="l01319"></a>01319         } <span class="keywordflow">else</span> {
<a name="l01320"></a>01320             i++;
<a name="l01321"></a>01321             matit++;
<a name="l01322"></a>01322         }
<a name="l01323"></a>01323     }
<a name="l01324"></a>01324 
<a name="l01325"></a>01325     vector&lt;pair&lt;KX_Scene*,RAS_MeshObject*&gt; &gt;::iterator meshit;
<a name="l01326"></a>01326     size = m_meshobjects.size();
<a name="l01327"></a>01327     <span class="keywordflow">for</span> (i=0, meshit=m_meshobjects.begin(); i&lt;<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>; ) {
<a name="l01328"></a>01328         <a class="code" href="../../d5/d85/classRAS__MeshObject.html">RAS_MeshObject</a> *me= (*meshit).second;
<a name="l01329"></a>01329         <span class="keywordflow">if</span> (<a class="code" href="../../d8/db1/BKE__library_8h.html#aa4e0884408263fa48530b69e9b0aa364">IS_TAGGED</a>(me-&gt;<a class="code" href="../../d5/d85/classRAS__MeshObject.html#a3f873a70dc7521e2e67ef719ca3f22dc">GetMesh</a>())) {
<a name="l01330"></a>01330             <span class="keyword">delete</span> (*meshit).second;
<a name="l01331"></a>01331             *meshit = m_meshobjects.back();
<a name="l01332"></a>01332             m_meshobjects.pop_back();
<a name="l01333"></a>01333             size--;
<a name="l01334"></a>01334         } <span class="keywordflow">else</span> {
<a name="l01335"></a>01335             i++;
<a name="l01336"></a>01336             meshit++;
<a name="l01337"></a>01337         }
<a name="l01338"></a>01338     }
<a name="l01339"></a>01339 
<a name="l01340"></a>01340     <a class="code" href="../../d8/db1/BKE__library_8h.html#a7dacadb71dbdc69a89bbf5e61818e085">free_main</a>(maggie);
<a name="l01341"></a>01341 
<a name="l01342"></a>01342     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01343"></a>01343 }
<a name="l01344"></a>01344 
<a name="l01345"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a274e8637b2180c1a9d06cf2e3165c5eb">01345</a> <span class="keywordtype">bool</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#aea3adfc4ddac4acdf9c47c02d93ea2b6">KX_BlenderSceneConverter::FreeBlendFile</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *path)
<a name="l01346"></a>01346 {
<a name="l01347"></a>01347     <span class="keywordflow">return</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#aea3adfc4ddac4acdf9c47c02d93ea2b6">FreeBlendFile</a>(<a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a751dd7a9a03087d5a9be1d80fee8e63f">GetMainDynamicPath</a>(path));
<a name="l01348"></a>01348 }
<a name="l01349"></a>01349 
<a name="l01350"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#aa453b081fe69b500cc27ecfe7cd1a494">01350</a> <span class="keywordtype">bool</span> <a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#aa453b081fe69b500cc27ecfe7cd1a494">KX_BlenderSceneConverter::MergeScene</a>(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a> *to, <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a> *from)
<a name="l01351"></a>01351 {
<a name="l01352"></a>01352 
<a name="l01353"></a>01353     {
<a name="l01354"></a>01354         vector&lt;pair&lt;KX_Scene*,KX_WorldInfo*&gt; &gt;::iterator itp = m_worldinfos.begin();
<a name="l01355"></a>01355         <span class="keywordflow">while</span> (itp != m_worldinfos.end()) {
<a name="l01356"></a>01356             <span class="keywordflow">if</span> ((*itp).first==from)
<a name="l01357"></a>01357                 (*itp).first= to;
<a name="l01358"></a>01358             itp++;
<a name="l01359"></a>01359         }
<a name="l01360"></a>01360     }
<a name="l01361"></a>01361 
<a name="l01362"></a>01362     {
<a name="l01363"></a>01363         vector&lt;pair&lt;KX_Scene*,RAS_IPolyMaterial*&gt; &gt;::iterator itp = m_polymaterials.begin();
<a name="l01364"></a>01364         <span class="keywordflow">while</span> (itp != m_polymaterials.end()) {
<a name="l01365"></a>01365             <span class="keywordflow">if</span> ((*itp).first==from) {
<a name="l01366"></a>01366                 (*itp).first= to;
<a name="l01367"></a>01367 
<a name="l01368"></a>01368                 <span class="comment">/* also switch internal data */</span>
<a name="l01369"></a>01369                 <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html">RAS_IPolyMaterial</a>*<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>= (*itp).second;
<a name="l01370"></a>01370                 mat-&gt;<a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html#ab70424be46a22aeec3528c90ff033ed3">Replace_IScene</a>(to);
<a name="l01371"></a>01371             }
<a name="l01372"></a>01372             itp++;
<a name="l01373"></a>01373         }
<a name="l01374"></a>01374     }
<a name="l01375"></a>01375 
<a name="l01376"></a>01376     {
<a name="l01377"></a>01377         vector&lt;pair&lt;KX_Scene*,RAS_MeshObject*&gt; &gt;::iterator itp = m_meshobjects.begin();
<a name="l01378"></a>01378         <span class="keywordflow">while</span> (itp != m_meshobjects.end()) {
<a name="l01379"></a>01379             <span class="keywordflow">if</span> ((*itp).first==from)
<a name="l01380"></a>01380                 (*itp).first= to;
<a name="l01381"></a>01381             itp++;
<a name="l01382"></a>01382         }
<a name="l01383"></a>01383     }
<a name="l01384"></a>01384 
<a name="l01385"></a>01385     {
<a name="l01386"></a>01386         vector&lt;pair&lt;KX_Scene*,BL_Material*&gt; &gt;::iterator itp = m_materials.begin();
<a name="l01387"></a>01387         <span class="keywordflow">while</span> (itp != m_materials.end()) {
<a name="l01388"></a>01388             <span class="keywordflow">if</span> ((*itp).first==from)
<a name="l01389"></a>01389                 (*itp).first= to;
<a name="l01390"></a>01390             itp++;
<a name="l01391"></a>01391         }
<a name="l01392"></a>01392     }
<a name="l01393"></a>01393     
<a name="l01394"></a>01394     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01395"></a>01395 }
<a name="l01396"></a>01396 
<a name="l01397"></a>01397 <span class="comment">/* This function merges a mesh from the current scene into another main</span>
<a name="l01398"></a>01398 <span class="comment"> * it does not convert */</span>
<a name="l01399"></a><a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a6365bf4d69914b27749b7008c1caf606">01399</a> <a class="code" href="../../d5/d85/classRAS__MeshObject.html">RAS_MeshObject</a> *<a class="code" href="../../d3/dc1/classKX__BlenderSceneConverter.html#a6365bf4d69914b27749b7008c1caf606">KX_BlenderSceneConverter::ConvertMeshSpecial</a>(<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>* kx_scene, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *maggie, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/de7/structObject.html#ae84d6eddc68ad710a47bc5210c0bd918">name</a>)
<a name="l01400"></a>01400 {
<a name="l01401"></a>01401     <span class="comment">/* Find a mesh in the current main */</span>
<a name="l01402"></a>01402     <a class="code" href="../../d8/d7e/structID.html">ID</a> *me= <span class="keyword">static_cast&lt;</span><a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keyword">&gt;</span>(<a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a07f40c87b9211c9d5fef01d4a4e9054d">BLI_findstring</a>(&amp;m_maggie-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>, name, offsetof(<a class="code" href="../../d8/d7e/structID.html">ID</a>, name) + 2));
<a name="l01403"></a>01403     
<a name="l01404"></a>01404     <span class="keywordflow">if</span> (me==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01405"></a>01405         printf(<span class="stringliteral">&quot;Could not be found \&quot;%s\&quot;\n&quot;</span>, name);
<a name="l01406"></a>01406         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01407"></a>01407     }
<a name="l01408"></a>01408     
<a name="l01409"></a>01409     <span class="comment">/* Watch this!, if its used in the original scene can cause big troubles */</span>
<a name="l01410"></a>01410     <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a> &gt; 0) {
<a name="l01411"></a>01411         printf(<span class="stringliteral">&quot;Mesh has a user \&quot;%s\&quot;\n&quot;</span>, name);
<a name="l01412"></a>01412         me = (<a class="code" href="../../d8/d7e/structID.html">ID</a>*)<a class="code" href="../../df/d7f/BKE__mesh_8h.html#a094edf743a2a93c2a81a5ebcd22f03cc">copy_mesh</a>((<a class="code" href="../../da/d29/structMesh.html">Mesh</a>*)me);
<a name="l01413"></a>01413         me-&gt;<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--;
<a name="l01414"></a>01414     }
<a name="l01415"></a>01415     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;m_maggie-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>, me); <span class="comment">/* even if we made the copy it needs to be removed */</span>
<a name="l01416"></a>01416     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;maggie-&gt;<a class="code" href="../../d0/dc0/structMain.html#a4d23e4db096dd08321b0081f9f7ac4a0">mesh</a>, me);
<a name="l01417"></a>01417 
<a name="l01418"></a>01418     
<a name="l01419"></a>01419     <span class="comment">/* Must copy the materials this uses else we cant free them */</span>
<a name="l01420"></a>01420     {
<a name="l01421"></a>01421         <a class="code" href="../../da/d29/structMesh.html">Mesh</a> *<a class="code" href="../../de/de7/structObject.html#ad755772f4633cd0ef94a05738ffb5e84">mesh</a>= (<a class="code" href="../../da/d29/structMesh.html">Mesh</a> *)me;
<a name="l01422"></a>01422         
<a name="l01423"></a>01423         <span class="comment">/* ensure all materials are tagged */</span>
<a name="l01424"></a>01424         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac7bd892579cf8a793973b2ce2491ec06">totcol</a>; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++)
<a name="l01425"></a>01425             <span class="keywordflow">if</span> (mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a4fdee04a24d1a821f3bfa659b3bd8156">mat</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>])
<a name="l01426"></a>01426                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a4fdee04a24d1a821f3bfa659b3bd8156">mat</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp;= ~<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a41fa8f648966e669ab4da5b359bd7d57">LIB_DOIT</a>;
<a name="l01427"></a>01427         
<a name="l01428"></a>01428         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac7bd892579cf8a793973b2ce2491ec06">totcol</a>; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++)
<a name="l01429"></a>01429         {
<a name="l01430"></a>01430             <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *mat_old= mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a4fdee04a24d1a821f3bfa659b3bd8156">mat</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01431"></a>01431             
<a name="l01432"></a>01432             <span class="comment">/* if its tagged its a replaced material */</span>
<a name="l01433"></a>01433             <span class="keywordflow">if</span> (mat_old &amp;&amp; (mat_old-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a41fa8f648966e669ab4da5b359bd7d57">LIB_DOIT</a>)==0)
<a name="l01434"></a>01434             {
<a name="l01435"></a>01435                 <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *mat_old= mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a4fdee04a24d1a821f3bfa659b3bd8156">mat</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01436"></a>01436                 <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *mat_new= <a class="code" href="../../d4/d0f/BKE__material_8h.html#ae69d80c54d1397174f1f7e882832682d">copy_material</a>( mat_old );
<a name="l01437"></a>01437                 
<a name="l01438"></a>01438                 mat_new-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> |= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a41fa8f648966e669ab4da5b359bd7d57">LIB_DOIT</a>;
<a name="l01439"></a>01439                 mat_old-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--;
<a name="l01440"></a>01440                 
<a name="l01441"></a>01441                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;m_maggie-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>, mat_new);
<a name="l01442"></a>01442                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;maggie-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>, mat_new);
<a name="l01443"></a>01443                 
<a name="l01444"></a>01444                 mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a4fdee04a24d1a821f3bfa659b3bd8156">mat</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]= mat_new;
<a name="l01445"></a>01445                 
<a name="l01446"></a>01446                 <span class="comment">/* the same material may be used twice */</span>
<a name="l01447"></a>01447                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1; j&lt;mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#ac7bd892579cf8a793973b2ce2491ec06">totcol</a>; j++)
<a name="l01448"></a>01448                 {
<a name="l01449"></a>01449                     <span class="keywordflow">if</span> (mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a4fdee04a24d1a821f3bfa659b3bd8156">mat</a>[j]==mat_old)
<a name="l01450"></a>01450                     {
<a name="l01451"></a>01451                         mesh-&gt;<a class="code" href="../../da/d29/structMesh.html#a4fdee04a24d1a821f3bfa659b3bd8156">mat</a>[j]= mat_new;
<a name="l01452"></a>01452                         mat_new-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>++;
<a name="l01453"></a>01453                         mat_old-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--;
<a name="l01454"></a>01454                     }
<a name="l01455"></a>01455                 }
<a name="l01456"></a>01456             }
<a name="l01457"></a>01457         }
<a name="l01458"></a>01458     }
<a name="l01459"></a>01459     
<a name="l01460"></a>01460     <a class="code" href="../../d5/d85/classRAS__MeshObject.html">RAS_MeshObject</a> *meshobj = <a class="code" href="../../d6/df2/BL__BlenderDataConversion_8cpp.html#a9dbfbbf38d5103b376e1d9d27915075a">BL_ConvertMesh</a>((<a class="code" href="../../da/d29/structMesh.html">Mesh</a> *)me, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, kx_scene, <span class="keyword">this</span>);
<a name="l01461"></a>01461     kx_scene-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#ad9270d324274b162133dd9a02f9bca58">GetLogicManager</a>()-&gt;<a class="code" href="../../db/d0f/classSCA__LogicManager.html#a11c13569539a998c302b2e47924581bb">RegisterMeshName</a>(meshobj-&gt;<a class="code" href="../../d5/d85/classRAS__MeshObject.html#a8e232cc1d6f124cc472f9717f82c2f77">GetName</a>(),meshobj);
<a name="l01462"></a>01462     m_map_mesh_to_gamemesh.<a class="code" href="../../d8/d8a/classCTR__Map.html#ab0ccd91972346f43c0388c6cef2159fb">clear</a>(); <span class="comment">/* This is at runtime so no need to keep this, BL_ConvertMesh adds */</span>
<a name="l01463"></a>01463     <span class="keywordflow">return</span> meshobj;
<a name="l01464"></a>01464 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:27 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: solver_relax.h Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">solver_relax.h</div>  </div>
</div>
<div class="contents">
<a href="../../d2/d75/solver__relax_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00004"></a>00004 <span class="comment">/******************************************************************************</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * El&#39;Beem - the visual lattice boltzmann freesurface simulator</span>
<a name="l00007"></a>00007 <span class="comment"> * All code distributed as part of El&#39;Beem is covered by the version 2 of the </span>
<a name="l00008"></a>00008 <span class="comment"> * GNU General Public License. See the file COPYING for details.</span>
<a name="l00009"></a>00009 <span class="comment"> * Copyright 2003-2006 Nils Thuerey</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * Combined 2D/3D Lattice Boltzmann relaxation macros</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> *****************************************************************************/</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="preprocessor">#if FSGR_STRICT_DEBUG==1</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span><span class="preprocessor">#define CAUSE_PANIC { this-&gt;mPanic=1; </span><span class="comment">/* *((int*)(0x0)) = 1; crash*/</span> }
<a name="l00017"></a>00017 <span class="preprocessor">#else // FSGR_STRICT_DEBUG==1</span>
<a name="l00018"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ae80956f703c9d97b2d0a938e5d7a0aa8">00018</a> <span class="preprocessor"></span><span class="preprocessor">#define CAUSE_PANIC { this-&gt;mPanic=1; } </span><span class="comment">/*set flag*/</span>
<a name="l00019"></a>00019 <span class="preprocessor">#endif // FSGR_STRICT_DEBUG==1</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span>    
<a name="l00021"></a>00021 <span class="comment">/******************************************************************************</span>
<a name="l00022"></a>00022 <span class="comment"> * normal relaxation</span>
<a name="l00023"></a>00023 <span class="comment"> *****************************************************************************/</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="comment">// standard arrays</span>
<a name="l00026"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ae2a212ed93b9d07fae3e2287004e6d6b">00026</a> <span class="preprocessor">#define CSRC_C    RAC(ccel                                , dC )</span>
<a name="l00027"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a526786a8e3cf56866da385271aa31eeb">00027</a> <span class="preprocessor"></span><span class="preprocessor">#define CSRC_E    RAC(ccel + (-1)             *(dTotalNum), dE )</span>
<a name="l00028"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ab6f3593e9b4a4e315091a12104ff91de">00028</a> <span class="preprocessor"></span><span class="preprocessor">#define CSRC_W    RAC(ccel + (+1)             *(dTotalNum), dW )</span>
<a name="l00029"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a04f8a8a812850b486dbc8d7ae4176a3d">00029</a> <span class="preprocessor"></span><span class="preprocessor">#define CSRC_N    RAC(ccel + (-mLevel[lev].lOffsx)        *(dTotalNum), dN )</span>
<a name="l00030"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a187cd781a920848d6b2fc692790ed003">00030</a> <span class="preprocessor"></span><span class="preprocessor">#define CSRC_S    RAC(ccel + (+mLevel[lev].lOffsx)        *(dTotalNum), dS )</span>
<a name="l00031"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#aa0d4141aa9d7777c5dfc0f35838b4514">00031</a> <span class="preprocessor"></span><span class="preprocessor">#define CSRC_NE   RAC(ccel + (-mLevel[lev].lOffsx-1)      *(dTotalNum), dNE)</span>
<a name="l00032"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#aef6b966652e3975b366da359acd6a975">00032</a> <span class="preprocessor"></span><span class="preprocessor">#define CSRC_NW   RAC(ccel + (-mLevel[lev].lOffsx+1)      *(dTotalNum), dNW)</span>
<a name="l00033"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a6122e610d92477fa694faa877d250632">00033</a> <span class="preprocessor"></span><span class="preprocessor">#define CSRC_SE   RAC(ccel + (+mLevel[lev].lOffsx-1)      *(dTotalNum), dSE)</span>
<a name="l00034"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ab3c40eb869b2868a33ce0894641ad8cb">00034</a> <span class="preprocessor"></span><span class="preprocessor">#define CSRC_SW   RAC(ccel + (+mLevel[lev].lOffsx+1)      *(dTotalNum), dSW)</span>
<a name="l00035"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#aad192dcccc6af1da31c716f5acffe5d9">00035</a> <span class="preprocessor"></span><span class="preprocessor">#define CSRC_T    RAC(ccel + (-mLevel[lev].lOffsy)        *(dTotalNum), dT )</span>
<a name="l00036"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ae6e02b39a3048ead6d81630e4118d03a">00036</a> <span class="preprocessor"></span><span class="preprocessor">#define CSRC_B    RAC(ccel + (+mLevel[lev].lOffsy)        *(dTotalNum), dB )</span>
<a name="l00037"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a90d6664ff3ba1cb63b2bdfa6cf90ce45">00037</a> <span class="preprocessor"></span><span class="preprocessor">#define CSRC_ET   RAC(ccel + (-mLevel[lev].lOffsy-1)      *(dTotalNum), dET)</span>
<a name="l00038"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a629424e71ea5be7ca6b05c5c84adbcd5">00038</a> <span class="preprocessor"></span><span class="preprocessor">#define CSRC_EB   RAC(ccel + (+mLevel[lev].lOffsy-1)      *(dTotalNum), dEB)</span>
<a name="l00039"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ad33eab5ae2cca40970497a51fc11d1fc">00039</a> <span class="preprocessor"></span><span class="preprocessor">#define CSRC_WT   RAC(ccel + (-mLevel[lev].lOffsy+1)      *(dTotalNum), dWT)</span>
<a name="l00040"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a95014d86b8ff6b7e80f5a5256b97ea8e">00040</a> <span class="preprocessor"></span><span class="preprocessor">#define CSRC_WB   RAC(ccel + (+mLevel[lev].lOffsy+1)      *(dTotalNum), dWB)</span>
<a name="l00041"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#af2ab4cf68ea009e36ed38595add7d203">00041</a> <span class="preprocessor"></span><span class="preprocessor">#define CSRC_NT   RAC(ccel + (-mLevel[lev].lOffsy-mLevel[lev].lOffsx) *(dTotalNum), dNT)</span>
<a name="l00042"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#acd2a6cff56293ba3085b9853734c6273">00042</a> <span class="preprocessor"></span><span class="preprocessor">#define CSRC_NB   RAC(ccel + (+mLevel[lev].lOffsy-mLevel[lev].lOffsx) *(dTotalNum), dNB)</span>
<a name="l00043"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#af7582b169d5cd89ca748dba22d00c595">00043</a> <span class="preprocessor"></span><span class="preprocessor">#define CSRC_ST   RAC(ccel + (-mLevel[lev].lOffsy+mLevel[lev].lOffsx) *(dTotalNum), dST)</span>
<a name="l00044"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#aa51f481b02f084c356ea1b7b7d0327e0">00044</a> <span class="preprocessor"></span><span class="preprocessor">#define CSRC_SB   RAC(ccel + (+mLevel[lev].lOffsy+mLevel[lev].lOffsx) *(dTotalNum), dSB)</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a0366ee705057e56e77ba494081ff314a">00046</a> <span class="preprocessor">#define XSRC_C(x)    RAC(ccel + (x)                 *dTotalNum, dC )</span>
<a name="l00047"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a452d1f0f08712f1510bf6413db691c94">00047</a> <span class="preprocessor"></span><span class="preprocessor">#define XSRC_E(x)    RAC(ccel + ((x)-1)             *dTotalNum, dE )</span>
<a name="l00048"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#afc1cdfd3e9e08be9cac0eb1f79d00d5c">00048</a> <span class="preprocessor"></span><span class="preprocessor">#define XSRC_W(x)    RAC(ccel + ((x)+1)             *dTotalNum, dW )</span>
<a name="l00049"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a81da4a669e093b83aec224033664287d">00049</a> <span class="preprocessor"></span><span class="preprocessor">#define XSRC_N(x)    RAC(ccel + ((x)-mLevel[lev].lOffsx)        *dTotalNum, dN )</span>
<a name="l00050"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ae168aa66be5d503114709abb0b531ef9">00050</a> <span class="preprocessor"></span><span class="preprocessor">#define XSRC_S(x)    RAC(ccel + ((x)+mLevel[lev].lOffsx)        *dTotalNum, dS )</span>
<a name="l00051"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#aa16296b0c12a89bb37b25cc6708d7139">00051</a> <span class="preprocessor"></span><span class="preprocessor">#define XSRC_NE(x)   RAC(ccel + ((x)-mLevel[lev].lOffsx-1)      *dTotalNum, dNE)</span>
<a name="l00052"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ad98ae7e081fc61f804fd301d51ce3d5e">00052</a> <span class="preprocessor"></span><span class="preprocessor">#define XSRC_NW(x)   RAC(ccel + ((x)-mLevel[lev].lOffsx+1)      *dTotalNum, dNW)</span>
<a name="l00053"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ac093bcca2a3f4dbdc0bae5aeb650e15e">00053</a> <span class="preprocessor"></span><span class="preprocessor">#define XSRC_SE(x)   RAC(ccel + ((x)+mLevel[lev].lOffsx-1)      *dTotalNum, dSE)</span>
<a name="l00054"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a122de310e9f4f31b9bdd13eedba6bc91">00054</a> <span class="preprocessor"></span><span class="preprocessor">#define XSRC_SW(x)   RAC(ccel + ((x)+mLevel[lev].lOffsx+1)      *dTotalNum, dSW)</span>
<a name="l00055"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a4555f525393db8420f55fa8c2de06db1">00055</a> <span class="preprocessor"></span><span class="preprocessor">#define XSRC_T(x)    RAC(ccel + ((x)-mLevel[lev].lOffsy)        *dTotalNum, dT )</span>
<a name="l00056"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a7afeeb5875d835a8987f0045b69a0fb7">00056</a> <span class="preprocessor"></span><span class="preprocessor">#define XSRC_B(x)    RAC(ccel + ((x)+mLevel[lev].lOffsy)        *dTotalNum, dB )</span>
<a name="l00057"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ad45ece58b4ea72dd7f9b92eb9aa332c5">00057</a> <span class="preprocessor"></span><span class="preprocessor">#define XSRC_ET(x)   RAC(ccel + ((x)-mLevel[lev].lOffsy-1)      *dTotalNum, dET)</span>
<a name="l00058"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ace4a95e178d7263ba617d59fa9b5d749">00058</a> <span class="preprocessor"></span><span class="preprocessor">#define XSRC_EB(x)   RAC(ccel + ((x)+mLevel[lev].lOffsy-1)      *dTotalNum, dEB)</span>
<a name="l00059"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a2feff19eee6024be5bdde4d04c54f0b5">00059</a> <span class="preprocessor"></span><span class="preprocessor">#define XSRC_WT(x)   RAC(ccel + ((x)-mLevel[lev].lOffsy+1)      *dTotalNum, dWT)</span>
<a name="l00060"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a58a7ea9a0d4dcfd8b1be8535eaf6f003">00060</a> <span class="preprocessor"></span><span class="preprocessor">#define XSRC_WB(x)   RAC(ccel + ((x)+mLevel[lev].lOffsy+1)      *dTotalNum, dWB)</span>
<a name="l00061"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a1f3df8e46d1d525baf2b8c11be05bb87">00061</a> <span class="preprocessor"></span><span class="preprocessor">#define XSRC_NT(x)   RAC(ccel + ((x)-mLevel[lev].lOffsy-mLevel[lev].lOffsx) *dTotalNum, dNT)</span>
<a name="l00062"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#abbdf22208fd05fecede854bfb24b6d6f">00062</a> <span class="preprocessor"></span><span class="preprocessor">#define XSRC_NB(x)   RAC(ccel + ((x)+mLevel[lev].lOffsy-mLevel[lev].lOffsx) *dTotalNum, dNB)</span>
<a name="l00063"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#aa31429e0060654f5ad9929ff6c1f6389">00063</a> <span class="preprocessor"></span><span class="preprocessor">#define XSRC_ST(x)   RAC(ccel + ((x)-mLevel[lev].lOffsy+mLevel[lev].lOffsx) *dTotalNum, dST)</span>
<a name="l00064"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a88da2c04b1caa6ff6379e4487cd943e7">00064</a> <span class="preprocessor"></span><span class="preprocessor">#define XSRC_SB(x)   RAC(ccel + ((x)+mLevel[lev].lOffsy+mLevel[lev].lOffsx) *dTotalNum, dSB)</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span>
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 
<a name="l00068"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ae15d7dddac50a12cac2bb65f2e29cc2c">00068</a> <span class="preprocessor">#define OMEGA(l) mLevel[(l)].omega</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span>
<a name="l00070"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a1bf027f76ae496c8acba42aeaf5c4a00">00070</a> <span class="preprocessor">#define EQC (  DFL1*(rho - usqr))</span>
<a name="l00071"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a722fe30f4252d44b8a3c5c19beb0adbf">00071</a> <span class="preprocessor"></span><span class="preprocessor">#define EQN (  DFL2*(rho + uy*(4.5*uy + 3.0) - usqr))</span>
<a name="l00072"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a1b96fad41423e3cf4555538bb18d8257">00072</a> <span class="preprocessor"></span><span class="preprocessor">#define EQS (  DFL2*(rho + uy*(4.5*uy - 3.0) - usqr))</span>
<a name="l00073"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a81e0d0c58cfceaa0f34804a4c3c7c87f">00073</a> <span class="preprocessor"></span><span class="preprocessor">#define EQE (  DFL2*(rho + ux*(4.5*ux + 3.0) - usqr))</span>
<a name="l00074"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a7b3634dc94663edad4a9711d53eaf6d3">00074</a> <span class="preprocessor"></span><span class="preprocessor">#define EQW (  DFL2*(rho + ux*(4.5*ux - 3.0) - usqr))</span>
<a name="l00075"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a1020140876056c409ec2a96ba81108e5">00075</a> <span class="preprocessor"></span><span class="preprocessor">#define EQT (  DFL2*(rho + uz*(4.5*uz + 3.0) - usqr))</span>
<a name="l00076"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a48ae093180e17535dac8c1954fbb57ab">00076</a> <span class="preprocessor"></span><span class="preprocessor">#define EQB (  DFL2*(rho + uz*(4.5*uz - 3.0) - usqr))</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span>                    
<a name="l00078"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a36f29e021f6cea7919dd97af1cb6599a">00078</a> <span class="preprocessor">#define EQNE ( DFL3*(rho + (+ux+uy)*(4.5*(+ux+uy) + 3.0) - usqr))</span>
<a name="l00079"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a1ed57c0b94db20a8f5f52ba0c3be5ada">00079</a> <span class="preprocessor"></span><span class="preprocessor">#define EQNW ( DFL3*(rho + (-ux+uy)*(4.5*(-ux+uy) + 3.0) - usqr))</span>
<a name="l00080"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a76ddc4b64460551ac95b96f9bc21ab0b">00080</a> <span class="preprocessor"></span><span class="preprocessor">#define EQSE ( DFL3*(rho + (+ux-uy)*(4.5*(+ux-uy) + 3.0) - usqr))</span>
<a name="l00081"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#acb168bbfb1f13defc6fadaaa966ad148">00081</a> <span class="preprocessor"></span><span class="preprocessor">#define EQSW ( DFL3*(rho + (-ux-uy)*(4.5*(-ux-uy) + 3.0) - usqr))</span>
<a name="l00082"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a404c433c1176658255b9092233970e41">00082</a> <span class="preprocessor"></span><span class="preprocessor">#define EQNT ( DFL3*(rho + (+uy+uz)*(4.5*(+uy+uz) + 3.0) - usqr))</span>
<a name="l00083"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#af90500bf22913ad12aa4eea619518f87">00083</a> <span class="preprocessor"></span><span class="preprocessor">#define EQNB ( DFL3*(rho + (+uy-uz)*(4.5*(+uy-uz) + 3.0) - usqr))</span>
<a name="l00084"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a77fa943c6fa704a4aed89fdb848bc343">00084</a> <span class="preprocessor"></span><span class="preprocessor">#define EQST ( DFL3*(rho + (-uy+uz)*(4.5*(-uy+uz) + 3.0) - usqr))</span>
<a name="l00085"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a435ece83e4586e898880b12b9e25f5cf">00085</a> <span class="preprocessor"></span><span class="preprocessor">#define EQSB ( DFL3*(rho + (-uy-uz)*(4.5*(-uy-uz) + 3.0) - usqr))</span>
<a name="l00086"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#aea72b62ac74fd26e19e5a8b1e6ab6fad">00086</a> <span class="preprocessor"></span><span class="preprocessor">#define EQET ( DFL3*(rho + (+ux+uz)*(4.5*(+ux+uz) + 3.0) - usqr))</span>
<a name="l00087"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a36c155ddd28e226ace503943682ecc96">00087</a> <span class="preprocessor"></span><span class="preprocessor">#define EQEB ( DFL3*(rho + (+ux-uz)*(4.5*(+ux-uz) + 3.0) - usqr))</span>
<a name="l00088"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a4cb50e5d21d4c41a2502d263168220b7">00088</a> <span class="preprocessor"></span><span class="preprocessor">#define EQWT ( DFL3*(rho + (-ux+uz)*(4.5*(-ux+uz) + 3.0) - usqr))</span>
<a name="l00089"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a7e3d6f1de22ae27f016032b3dfb06fad">00089</a> <span class="preprocessor"></span><span class="preprocessor">#define EQWB ( DFL3*(rho + (-ux-uz)*(4.5*(-ux-uz) + 3.0) - usqr))</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span>
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="comment">// this is a bit ugly, but necessary for the CSRC_ access...</span>
<a name="l00093"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ab44ddba9bf97d88cb5dd04a334619cc9">00093</a> <span class="preprocessor">#define MSRC_C    m[dC ]</span>
<a name="l00094"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#af181a6fa81952fda1d26ea93e3e29453">00094</a> <span class="preprocessor"></span><span class="preprocessor">#define MSRC_N    m[dN ]</span>
<a name="l00095"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a51ab534e760b44bd5c3cf43e6752e58b">00095</a> <span class="preprocessor"></span><span class="preprocessor">#define MSRC_S    m[dS ]</span>
<a name="l00096"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a41c72e349125d505e4a3188fec24a025">00096</a> <span class="preprocessor"></span><span class="preprocessor">#define MSRC_E    m[dE ]</span>
<a name="l00097"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ac1a9710fbbbc71c7a9d8368518271dcb">00097</a> <span class="preprocessor"></span><span class="preprocessor">#define MSRC_W    m[dW ]</span>
<a name="l00098"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a6d53cfd57f41ec9b0f236b4e08564a7f">00098</a> <span class="preprocessor"></span><span class="preprocessor">#define MSRC_T    m[dT ]</span>
<a name="l00099"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a09a4b9690cd4c8b926598fb2bae3fa49">00099</a> <span class="preprocessor"></span><span class="preprocessor">#define MSRC_B    m[dB ]</span>
<a name="l00100"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a871ce2dc9e5bbb322c336c269bb4fd0e">00100</a> <span class="preprocessor"></span><span class="preprocessor">#define MSRC_NE   m[dNE]</span>
<a name="l00101"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ac36d19dbbbc36f4ebb8cb0d7f6fcf0bd">00101</a> <span class="preprocessor"></span><span class="preprocessor">#define MSRC_NW   m[dNW]</span>
<a name="l00102"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a5ef90caaabc1b46a1c424990065a9fb7">00102</a> <span class="preprocessor"></span><span class="preprocessor">#define MSRC_SE   m[dSE]</span>
<a name="l00103"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a3ca748555859dfda4d0bb23a09458197">00103</a> <span class="preprocessor"></span><span class="preprocessor">#define MSRC_SW   m[dSW]</span>
<a name="l00104"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a4673aaa45649d305881e9aa5aa0e8edf">00104</a> <span class="preprocessor"></span><span class="preprocessor">#define MSRC_NT   m[dNT]</span>
<a name="l00105"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#abfa854478e08a3b69a156ef021b19774">00105</a> <span class="preprocessor"></span><span class="preprocessor">#define MSRC_NB   m[dNB]</span>
<a name="l00106"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ac7ca45b17fce4c6dcfc5dca90a3b4f95">00106</a> <span class="preprocessor"></span><span class="preprocessor">#define MSRC_ST   m[dST]</span>
<a name="l00107"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a82cba2b66ae866f35533a0836440564f">00107</a> <span class="preprocessor"></span><span class="preprocessor">#define MSRC_SB   m[dSB]</span>
<a name="l00108"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a34ea173bc81cb30721af0a8db9fa0d07">00108</a> <span class="preprocessor"></span><span class="preprocessor">#define MSRC_ET   m[dET]</span>
<a name="l00109"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a0f043c83bc012a696552b3e49cbc0edb">00109</a> <span class="preprocessor"></span><span class="preprocessor">#define MSRC_EB   m[dEB]</span>
<a name="l00110"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#adc55528a0cdd1763a9f4685ce5f242cb">00110</a> <span class="preprocessor"></span><span class="preprocessor">#define MSRC_WT   m[dWT]</span>
<a name="l00111"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a25e545f58c560153b0f85739ec926047">00111</a> <span class="preprocessor"></span><span class="preprocessor">#define MSRC_WB   m[dWB]</span>
<a name="l00112"></a>00112 <span class="preprocessor"></span>
<a name="l00113"></a>00113 <span class="comment">// this is a bit ugly, but necessary for the ccel local access...</span>
<a name="l00114"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a4a98cfc787c79029f43a81d30cd6d606">00114</a> <span class="preprocessor">#define CCEL_C    RAC(ccel, dC )</span>
<a name="l00115"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a9c28ee835512e3eef185d260215a77d9">00115</a> <span class="preprocessor"></span><span class="preprocessor">#define CCEL_N    RAC(ccel, dN )</span>
<a name="l00116"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a47ed294ca8c059a2aaa94d40c6116e8e">00116</a> <span class="preprocessor"></span><span class="preprocessor">#define CCEL_S    RAC(ccel, dS )</span>
<a name="l00117"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a7a7a3b5da89ca579f9fac20195be520e">00117</a> <span class="preprocessor"></span><span class="preprocessor">#define CCEL_E    RAC(ccel, dE )</span>
<a name="l00118"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a22994134ae618afe5c0f7adf4801bdd7">00118</a> <span class="preprocessor"></span><span class="preprocessor">#define CCEL_W    RAC(ccel, dW )</span>
<a name="l00119"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a2a73cab5a7b70371f7dd9344a14334e9">00119</a> <span class="preprocessor"></span><span class="preprocessor">#define CCEL_T    RAC(ccel, dT )</span>
<a name="l00120"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a3b6603080d9ab2bb52787e18f92e3606">00120</a> <span class="preprocessor"></span><span class="preprocessor">#define CCEL_B    RAC(ccel, dB )</span>
<a name="l00121"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a310f3c02141b1077246248b584823552">00121</a> <span class="preprocessor"></span><span class="preprocessor">#define CCEL_NE   RAC(ccel, dNE)</span>
<a name="l00122"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a7687f12ac05715dc887aa879e2c50831">00122</a> <span class="preprocessor"></span><span class="preprocessor">#define CCEL_NW   RAC(ccel, dNW)</span>
<a name="l00123"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#aba1e0dba7dbf2e6895a94503a33e4356">00123</a> <span class="preprocessor"></span><span class="preprocessor">#define CCEL_SE   RAC(ccel, dSE)</span>
<a name="l00124"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a06e1743546fc47c8ce4bcadb2b4c913f">00124</a> <span class="preprocessor"></span><span class="preprocessor">#define CCEL_SW   RAC(ccel, dSW)</span>
<a name="l00125"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ad1783d67b631db4872141d4adfe13124">00125</a> <span class="preprocessor"></span><span class="preprocessor">#define CCEL_NT   RAC(ccel, dNT)</span>
<a name="l00126"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a4643cccdb80c23a1b47462203de3b3ef">00126</a> <span class="preprocessor"></span><span class="preprocessor">#define CCEL_NB   RAC(ccel, dNB)</span>
<a name="l00127"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a179daf4afdcb04672209675bcec59e95">00127</a> <span class="preprocessor"></span><span class="preprocessor">#define CCEL_ST   RAC(ccel, dST)</span>
<a name="l00128"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a66d28ab9b974262f68f900e674f0b759">00128</a> <span class="preprocessor"></span><span class="preprocessor">#define CCEL_SB   RAC(ccel, dSB)</span>
<a name="l00129"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a320bc06dd9ae11a217bbbbf36f2111fe">00129</a> <span class="preprocessor"></span><span class="preprocessor">#define CCEL_ET   RAC(ccel, dET)</span>
<a name="l00130"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a5f0513c971f6d3e49d5486d1d4286dcf">00130</a> <span class="preprocessor"></span><span class="preprocessor">#define CCEL_EB   RAC(ccel, dEB)</span>
<a name="l00131"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#adf33dbbfb15a6c1670ec43e245077daa">00131</a> <span class="preprocessor"></span><span class="preprocessor">#define CCEL_WT   RAC(ccel, dWT)</span>
<a name="l00132"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#aa339ca1767d867b8f4ee37469b23a096">00132</a> <span class="preprocessor"></span><span class="preprocessor">#define CCEL_WB   RAC(ccel, dWB)</span>
<a name="l00133"></a>00133 <span class="preprocessor"></span><span class="comment">// for coarse to fine interpol access</span>
<a name="l00134"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a57c46eebd04425d755f164ff241e195a">00134</a> <span class="preprocessor">#define CCELG_C(f)    (RAC(ccel, dC )*mGaussw[(f)])</span>
<a name="l00135"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a33f138c78c7ae9f7c0ac390d1b762edc">00135</a> <span class="preprocessor"></span><span class="preprocessor">#define CCELG_N(f)    (RAC(ccel, dN )*mGaussw[(f)])</span>
<a name="l00136"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#acd07c1326aaebe0fe66a78844c9636a3">00136</a> <span class="preprocessor"></span><span class="preprocessor">#define CCELG_S(f)    (RAC(ccel, dS )*mGaussw[(f)])</span>
<a name="l00137"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#acf4b0e36f2dedfa9c5516b1bda3184e2">00137</a> <span class="preprocessor"></span><span class="preprocessor">#define CCELG_E(f)    (RAC(ccel, dE )*mGaussw[(f)])</span>
<a name="l00138"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ae93299a77b665908ceabfd61c4d82a74">00138</a> <span class="preprocessor"></span><span class="preprocessor">#define CCELG_W(f)    (RAC(ccel, dW )*mGaussw[(f)])</span>
<a name="l00139"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a0cd1def359c89976030177ba174a062e">00139</a> <span class="preprocessor"></span><span class="preprocessor">#define CCELG_T(f)    (RAC(ccel, dT )*mGaussw[(f)])</span>
<a name="l00140"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a9529331a296876d0b650aa9595565c40">00140</a> <span class="preprocessor"></span><span class="preprocessor">#define CCELG_B(f)    (RAC(ccel, dB )*mGaussw[(f)])</span>
<a name="l00141"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a02b3519435b8e36df01c4a2538307367">00141</a> <span class="preprocessor"></span><span class="preprocessor">#define CCELG_NE(f)   (RAC(ccel, dNE)*mGaussw[(f)])</span>
<a name="l00142"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a64664ca4596629bfb33f897921d9d0d1">00142</a> <span class="preprocessor"></span><span class="preprocessor">#define CCELG_NW(f)   (RAC(ccel, dNW)*mGaussw[(f)])</span>
<a name="l00143"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#abe38994bf170d4f6d2687ff9a38f0f79">00143</a> <span class="preprocessor"></span><span class="preprocessor">#define CCELG_SE(f)   (RAC(ccel, dSE)*mGaussw[(f)])</span>
<a name="l00144"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a470e497bf0b6844dfb742b6fb748203a">00144</a> <span class="preprocessor"></span><span class="preprocessor">#define CCELG_SW(f)   (RAC(ccel, dSW)*mGaussw[(f)])</span>
<a name="l00145"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a8e84d4e0a493d7d1849b2a5196edaf66">00145</a> <span class="preprocessor"></span><span class="preprocessor">#define CCELG_NT(f)   (RAC(ccel, dNT)*mGaussw[(f)])</span>
<a name="l00146"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a713f4094cf7d31cdc8ec537654ecb6ce">00146</a> <span class="preprocessor"></span><span class="preprocessor">#define CCELG_NB(f)   (RAC(ccel, dNB)*mGaussw[(f)])</span>
<a name="l00147"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ab75052c17d325da73c61ac65daa1d647">00147</a> <span class="preprocessor"></span><span class="preprocessor">#define CCELG_ST(f)   (RAC(ccel, dST)*mGaussw[(f)])</span>
<a name="l00148"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ae44631c140a48b70bb29c1fde749aa29">00148</a> <span class="preprocessor"></span><span class="preprocessor">#define CCELG_SB(f)   (RAC(ccel, dSB)*mGaussw[(f)])</span>
<a name="l00149"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#aadf4d9ac4b5af6b5fb2fa48696dea7b7">00149</a> <span class="preprocessor"></span><span class="preprocessor">#define CCELG_ET(f)   (RAC(ccel, dET)*mGaussw[(f)])</span>
<a name="l00150"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a98bdde8586408680a1bd364cafee4311">00150</a> <span class="preprocessor"></span><span class="preprocessor">#define CCELG_EB(f)   (RAC(ccel, dEB)*mGaussw[(f)])</span>
<a name="l00151"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#aabd9f3e7ed09276d46016689c5107be7">00151</a> <span class="preprocessor"></span><span class="preprocessor">#define CCELG_WT(f)   (RAC(ccel, dWT)*mGaussw[(f)])</span>
<a name="l00152"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#aaf7f503f05d1445299be4e3edfc724fc">00152</a> <span class="preprocessor"></span><span class="preprocessor">#define CCELG_WB(f)   (RAC(ccel, dWB)*mGaussw[(f)])</span>
<a name="l00153"></a>00153 <span class="preprocessor"></span>
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 <span class="preprocessor">#if PARALLEL==1</span>
<a name="l00156"></a>00156 <span class="preprocessor"></span><span class="preprocessor">#define CSMOMEGA_STATS(dlev, domega) </span>
<a name="l00157"></a>00157 <span class="preprocessor"></span><span class="preprocessor">#else // PARALLEL==1</span>
<a name="l00158"></a>00158 <span class="preprocessor"></span><span class="preprocessor">#if FSGR_OMEGA_DEBUG==1</span>
<a name="l00159"></a>00159 <span class="preprocessor"></span><span class="preprocessor">#define CSMOMEGA_STATS(dlev, domega) \</span>
<a name="l00160"></a>00160 <span class="preprocessor">    mLevel[dlev].avgOmega += domega; mLevel[dlev].avgOmegaCnt+=1.0; </span>
<a name="l00161"></a>00161 <span class="preprocessor"></span><span class="preprocessor">#else // FSGR_OMEGA_DEBUG==1</span>
<a name="l00162"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a28ff430d6ba0fb3ee2a51cbdb2fcdd5c">00162</a> <span class="preprocessor"></span><span class="preprocessor">#define CSMOMEGA_STATS(dlev, domega) </span>
<a name="l00163"></a>00163 <span class="preprocessor"></span><span class="preprocessor">#endif // FSGR_OMEGA_DEBUG==1</span>
<a name="l00164"></a>00164 <span class="preprocessor"></span><span class="preprocessor">#endif // PARALLEL==1</span>
<a name="l00165"></a>00165 <span class="preprocessor"></span>
<a name="l00166"></a>00166 
<a name="l00167"></a>00167 <span class="comment">// used for main loops and grav init</span>
<a name="l00168"></a>00168 <span class="comment">// source set</span>
<a name="l00169"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a7eab7803391ea704d84e0db95689a8f6">00169</a> <span class="preprocessor">#define SRCS(l) mLevel[(l)].setCurr</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span><span class="comment">// target set</span>
<a name="l00171"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a6d9615b3101a3ac7b60bb3bd118e6878">00171</a> <span class="preprocessor">#define TSET(l) mLevel[(l)].setOther</span>
<a name="l00172"></a>00172 <span class="preprocessor"></span>
<a name="l00173"></a>00173 <span class="comment">// handle mov. obj </span>
<a name="l00174"></a>00174 <span class="preprocessor">#if FSGR_STRICT_DEBUG==1</span>
<a name="l00175"></a>00175 <span class="preprocessor"></span>
<a name="l00176"></a>00176 <span class="preprocessor">#define  LBMDS_ADDMOV(linv,l)  \</span>
<a name="l00177"></a>00177 <span class="preprocessor">     \</span>
<a name="l00178"></a>00178 <span class="preprocessor">    if((nbflag[linv]&amp;CFBndMoving)&amp;&amp;(!(nbflag[l]&amp;CFBnd))){ \</span>
<a name="l00179"></a>00179 <span class="preprocessor">     \</span>
<a name="l00180"></a>00180 <span class="preprocessor">    LbmFloat dte=QCELL_NBINV(lev, i, j, k, SRCS(lev), l,dFlux)-(mSimulationTime+this-&gt;mpParam-&gt;getTimestep()); \</span>
<a name="l00181"></a>00181 <span class="preprocessor">    if( ABS(dte)&lt; 1e-15 ) { \</span>
<a name="l00182"></a>00182 <span class="preprocessor">    m[l]+=QCELL_NBINV(lev, i, j, k, SRCS(lev), l,l); \</span>
<a name="l00183"></a>00183 <span class="preprocessor">    } else { \</span>
<a name="l00184"></a>00184 <span class="preprocessor">    const int sdx = i+this-&gt;dfVecX[linv], sdy = j+this-&gt;dfVecY[linv], sdz = k+this-&gt;dfVecZ[linv]; \</span>
<a name="l00185"></a>00185 <span class="preprocessor">     \</span>
<a name="l00186"></a>00186 <span class="preprocessor">    errMsg(&quot;INVALID_MOV_OBJ_TIME&quot;,&quot; at &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; from l&quot;&lt;&lt;l&lt;&lt;&quot; &quot;&lt;&lt;PRINT_VEC(sdx,sdy,sdz)&lt;&lt;&quot; t=&quot;&lt;&lt;(mSimulationTime+this-&gt;mpParam-&gt;getTimestep())&lt;&lt;&quot; ct=&quot;&lt;&lt;QCELL_NBINV(lev, i, j, k, SRCS(lev), l,dFlux)&lt;&lt;&quot; dte=&quot;&lt;&lt;dte); \</span>
<a name="l00187"></a>00187 <span class="preprocessor">    debugMarkCell(lev,sdx,sdy,sdz); \</span>
<a name="l00188"></a>00188 <span class="preprocessor">    } \</span>
<a name="l00189"></a>00189 <span class="preprocessor">    } \</span>
<a name="l00190"></a>00190 <span class="preprocessor"></span>
<a name="l00191"></a>00191 <span class="preprocessor"></span>
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <span class="preprocessor">#else // FSGR_STRICT_DEBUG==1</span>
<a name="l00194"></a>00194 <span class="preprocessor"></span>
<a name="l00195"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ab51a96da1de7834f68103396c3f63bd5">00195</a> <span class="preprocessor">#define  LBMDS_ADDMOV(linv,l)  \</span>
<a name="l00196"></a>00196 <span class="preprocessor">     \</span>
<a name="l00197"></a>00197 <span class="preprocessor">     \</span>
<a name="l00198"></a>00198 <span class="preprocessor">    if((nbflag[linv]&amp;CFBndMoving)&amp;&amp;(!(nbflag[l]&amp;CFBnd))){ \</span>
<a name="l00199"></a>00199 <span class="preprocessor">     \</span>
<a name="l00200"></a>00200 <span class="preprocessor">    m[l]+=QCELL_NBINV(lev, i, j, k, SRCS(lev), l,l); \</span>
<a name="l00201"></a>00201 <span class="preprocessor">    } \</span>
<a name="l00202"></a>00202 <span class="preprocessor"></span>
<a name="l00203"></a>00203 <span class="preprocessor"></span>
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 <span class="preprocessor">#endif // !FSGR_STRICT_DEBUG==1</span>
<a name="l00206"></a>00206 <span class="preprocessor"></span>
<a name="l00207"></a>00207 <span class="comment">// treatment of freeslip reflection</span>
<a name="l00208"></a>00208 <span class="comment">// used both for OPT and nonOPT</span>
<a name="l00209"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a9421b805f82952e7d54c83985aa7451d">00209</a> <span class="preprocessor">#define  DEFAULT_STREAM_FREESLIP(l,invl,mnbf)  \</span>
<a name="l00210"></a>00210 <span class="preprocessor">     \</span>
<a name="l00211"></a>00211 <span class="preprocessor">    int nb1 = 0, nb2 = 0; \</span>
<a name="l00212"></a>00212 <span class="preprocessor">    LbmFloat newval = 0.0; \</span>
<a name="l00213"></a>00213 <span class="preprocessor">    const int dx = this-&gt;dfVecX[invl], dy = this-&gt;dfVecY[invl], dz = this-&gt;dfVecZ[invl]; \</span>
<a name="l00214"></a>00214 <span class="preprocessor">     \</span>
<a name="l00215"></a>00215 <span class="preprocessor">     \</span>
<a name="l00216"></a>00216 <span class="preprocessor">     \</span>
<a name="l00217"></a>00217 <span class="preprocessor">    const LbmFloat movadd = ( \</span>
<a name="l00218"></a>00218 <span class="preprocessor">    ((nbflag[invl]&amp;CFBndMoving)&amp;&amp;(!(nbflag[l]&amp;CFBnd))) ? \</span>
<a name="l00219"></a>00219 <span class="preprocessor">    (QCELL_NBINV(lev, i, j, k, SRCS(lev), l,l)) : 0.); \</span>
<a name="l00220"></a>00220 <span class="preprocessor">     \</span>
<a name="l00221"></a>00221 <span class="preprocessor">    if(dz==0) { \</span>
<a name="l00222"></a>00222 <span class="preprocessor">    nb1 = !(RFLAG(lev, i,   j+dy,k, SRCS(lev))&amp;(CFFluid|CFInter)); \</span>
<a name="l00223"></a>00223 <span class="preprocessor">    nb2 = !(RFLAG(lev, i+dx,j,   k, SRCS(lev))&amp;(CFFluid|CFInter)); \</span>
<a name="l00224"></a>00224 <span class="preprocessor">    if((nb1)&amp;&amp;(!nb2)) { \</span>
<a name="l00225"></a>00225 <span class="preprocessor">     \</span>
<a name="l00226"></a>00226 <span class="preprocessor">    newval = QCELL(lev, i+dx,j,k,SRCS(lev), this-&gt;dfRefX[l]); \</span>
<a name="l00227"></a>00227 <span class="preprocessor">    } else \</span>
<a name="l00228"></a>00228 <span class="preprocessor">    if((!nb1)&amp;&amp;(nb2)) { \</span>
<a name="l00229"></a>00229 <span class="preprocessor">     \</span>
<a name="l00230"></a>00230 <span class="preprocessor">    newval = QCELL(lev, i,j+dy,k,SRCS(lev), this-&gt;dfRefY[l]); \</span>
<a name="l00231"></a>00231 <span class="preprocessor">    } else { \</span>
<a name="l00232"></a>00232 <span class="preprocessor">     \</span>
<a name="l00233"></a>00233 <span class="preprocessor">    newval = RAC(ccel, this-&gt;dfInv[l] ) +movadd </span><span class="comment">/* */</span>; \
<a name="l00234"></a>00234     } \
<a name="l00235"></a>00235     } else \
<a name="l00236"></a>00236     if(dy==0) { \
<a name="l00237"></a>00237     nb1 = !(RFLAG(lev, i,j,k+dz, SRCS(lev))&amp;(CFFluid|CFInter)); \
<a name="l00238"></a>00238     nb2 = !(RFLAG(lev, i+dx,j,k, SRCS(lev))&amp;(CFFluid|CFInter)); \
<a name="l00239"></a>00239     if((nb1)&amp;&amp;(!nb2)) { \
<a name="l00240"></a>00240      \
<a name="l00241"></a>00241     newval = QCELL(lev, i+dx,j,k,SRCS(lev), this-&gt;dfRefX[l]); \
<a name="l00242"></a>00242     } else \
<a name="l00243"></a>00243     if((!nb1)&amp;&amp;(nb2)) { \
<a name="l00244"></a>00244      \
<a name="l00245"></a>00245     newval = QCELL(lev, i,j,k+dz,SRCS(lev), this-&gt;dfRefZ[l]); \
<a name="l00246"></a>00246     } else { \
<a name="l00247"></a>00247      \
<a name="l00248"></a>00248     newval = RAC(ccel, this-&gt;dfInv[l] )  +movadd <span class="comment">/* */</span>; \
<a name="l00249"></a>00249     } \
<a name="l00250"></a>00250      \
<a name="l00251"></a>00251     } else \
<a name="l00252"></a>00252      \
<a name="l00253"></a>00253     { \
<a name="l00254"></a>00254      \
<a name="l00255"></a>00255     nb1 = !(RFLAG(lev, i,j,k+dz, SRCS(lev))&amp;(CFFluid|CFInter)); \
<a name="l00256"></a>00256     nb2 = !(RFLAG(lev, i,j+dy,k, SRCS(lev))&amp;(CFFluid|CFInter)); \
<a name="l00257"></a>00257     if((nb1)&amp;&amp;(!nb2)) { \
<a name="l00258"></a>00258      \
<a name="l00259"></a>00259     newval = QCELL(lev, i,j+dy,k,SRCS(lev), this-&gt;dfRefY[l]); \
<a name="l00260"></a>00260     } else \
<a name="l00261"></a>00261     if((!nb1)&amp;&amp;(nb2)) { \
<a name="l00262"></a>00262      \
<a name="l00263"></a>00263     newval = QCELL(lev, i,j,k+dz,SRCS(lev), this-&gt;dfRefZ[l]); \
<a name="l00264"></a>00264     } else { \
<a name="l00265"></a>00265      \
<a name="l00266"></a>00266     newval = RAC(ccel, this-&gt;dfInv[l] )  +movadd <span class="comment">/* */</span>; \
<a name="l00267"></a>00267     } \
<a name="l00268"></a>00268     } \
<a name="l00269"></a>00269      \
<a name="l00270"></a>00270     if(mnbf &amp; CFBndPartslip) { \
<a name="l00271"></a>00271     const LbmFloat partv = mObjectPartslips[(int)(mnbf&gt;&gt;24)]; \
<a name="l00272"></a>00272      \
<a name="l00273"></a>00273     m[l] = (RAC(ccel, this-&gt;dfInv[l] )  +movadd <span class="comment">/* d *(1./1.) */</span> ) * partv + newval * (1.0-partv); \
<a name="l00274"></a>00274     } else { \
<a name="l00275"></a>00275     m[l] = newval; \
<a name="l00276"></a>00276     } \
<a name="l00277"></a>00277      \
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 <span class="comment">// complete default stream&amp;collide, 2d/3d</span>
<a name="l00283"></a>00283 <span class="comment">/* read distribution funtions of adjacent cells = sweep step */</span> 
<a name="l00284"></a>00284 <span class="preprocessor">#if OPT3D==0 </span>
<a name="l00285"></a>00285 <span class="preprocessor"></span>
<a name="l00286"></a>00286 <span class="preprocessor">#if FSGR_STRICT_DEBUG==1</span>
<a name="l00287"></a>00287 <span class="preprocessor"></span><span class="preprocessor">#define MARKCELLCHECK \</span>
<a name="l00288"></a>00288 <span class="preprocessor">    debugMarkCell(lev,i,j,k); CAUSE_PANIC;</span>
<a name="l00289"></a>00289 <span class="preprocessor"></span><span class="preprocessor">#define STREAMCHECK(id,ni,nj,nk,nl) \</span>
<a name="l00290"></a>00290 <span class="preprocessor">    if((!(m[nl] &gt; -1.0) &amp;&amp; (m[nl]&lt;1.0)) ) {\</span>
<a name="l00291"></a>00291 <span class="preprocessor">        errMsg(&quot;STREAMCHECK&quot;,&quot;ID&quot;&lt;&lt;id&lt;&lt;&quot; Invalid streamed DF nl&quot;&lt;&lt;nl&lt;&lt;&quot; value:&quot;&lt;&lt;m[nl]&lt;&lt;&quot; at &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; from &quot;&lt;&lt;PRINT_VEC(ni,nj,nk)&lt;&lt;&quot; nl&quot;&lt;&lt;(nl)&lt;&lt;\</span>
<a name="l00292"></a>00292 <span class="preprocessor">                &quot; nfc&quot;&lt;&lt; RFLAG(lev, ni,nj,nk, mLevel[lev].setCurr)&lt;&lt;&quot; nfo&quot;&lt;&lt; RFLAG(lev, ni,nj,nk, mLevel[lev].setOther)  ); \</span>
<a name="l00293"></a>00293 <span class="preprocessor">        </span><span class="comment">/*FORDF0{ errMsg(&quot;STREAMCHECK&quot;,&quot; at &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; df &quot;&lt;&lt;l&lt;&lt;&quot;=&quot;&lt;&lt;m[l] ); } */</span> \
<a name="l00294"></a>00294         MARKCELLCHECK; \
<a name="l00295"></a>00295         m[nl] = dfEquil[nl]; <span class="comment">/* REPAIR */</span> \
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297 <span class="preprocessor">#define COLLCHECK \</span>
<a name="l00298"></a>00298 <span class="preprocessor">    if( (rho&gt;2.0) || (rho&lt;-1.0) || (ABS(ux)&gt;1.0) || (ABS(uy)&gt;1.0) |(ABS(uz)&gt;1.0) ) {\</span>
<a name="l00299"></a>00299 <span class="preprocessor">        errMsg(&quot;COLLCHECK&quot;,&quot;Invalid collision values r:&quot;&lt;&lt;rho&lt;&lt;&quot; u:&quot;PRINT_VEC(ux,uy,uz)&lt;&lt;&quot; at? &quot;&lt;&lt;PRINT_IJK ); \</span>
<a name="l00300"></a>00300 <span class="preprocessor">        </span><span class="comment">/*FORDF0{ errMsg(&quot;COLLCHECK&quot;,&quot; at? &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; df &quot;&lt;&lt;l&lt;&lt;&quot;=&quot;&lt;&lt;m[l] ); }*/</span> \
<a name="l00301"></a>00301         rho=ux=uy=uz= 0.; <span class="comment">/* REPAIR */</span> \
<a name="l00302"></a>00302         MARKCELLCHECK; \
<a name="l00303"></a>00303     }
<a name="l00304"></a>00304 <span class="preprocessor">#else</span>
<a name="l00305"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a4daa6f2c41c5d2eb258194cbe8c4c3df">00305</a> <span class="preprocessor"></span><span class="preprocessor">#define STREAMCHECK(id, ni,nj,nk,nl) </span>
<a name="l00306"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#abe35fb365b7534ef09d1bcf62f80ebbd">00306</a> <span class="preprocessor"></span><span class="preprocessor">#define COLLCHECK</span>
<a name="l00307"></a>00307 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00308"></a>00308 <span class="preprocessor"></span>
<a name="l00309"></a>00309 <span class="comment">// careful ux,uy,uz need to be inited before!</span>
<a name="l00310"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a62aeeb02480e9713cb4c28ac56f625a8">00310</a> <span class="preprocessor">#define  DEFAULT_STREAM  \</span>
<a name="l00311"></a>00311 <span class="preprocessor">    m[dC] = RAC(ccel,dC); \</span>
<a name="l00312"></a>00312 <span class="preprocessor">    STREAMCHECK(1, i,j,k, dC); \</span>
<a name="l00313"></a>00313 <span class="preprocessor">    FORDF1 { \</span>
<a name="l00314"></a>00314 <span class="preprocessor">    CellFlagType nbf = nbflag[ this-&gt;dfInv[l] ]; \</span>
<a name="l00315"></a>00315 <span class="preprocessor">    if(nbf &amp; CFBnd) { \</span>
<a name="l00316"></a>00316 <span class="preprocessor">    if(nbf &amp; CFBndNoslip) { \</span>
<a name="l00317"></a>00317 <span class="preprocessor">     \</span>
<a name="l00318"></a>00318 <span class="preprocessor">    m[l] = RAC(ccel, this-&gt;dfInv[l] ); \</span>
<a name="l00319"></a>00319 <span class="preprocessor">    LBMDS_ADDMOV(this-&gt;dfInv[l],l); \</span>
<a name="l00320"></a>00320 <span class="preprocessor">    STREAMCHECK(2, i,j,k, l); \</span>
<a name="l00321"></a>00321 <span class="preprocessor">    } else if(nbf &amp; (CFBndFreeslip|CFBndPartslip)) { \</span>
<a name="l00322"></a>00322 <span class="preprocessor">     \</span>
<a name="l00323"></a>00323 <span class="preprocessor">    if(l&lt;=LBMDIM*2) { \</span>
<a name="l00324"></a>00324 <span class="preprocessor">    m[l] = RAC(ccel, this-&gt;dfInv[l] ); STREAMCHECK(3, i,j,k, l); \</span>
<a name="l00325"></a>00325 <span class="preprocessor">    LBMDS_ADDMOV(this-&gt;dfInv[l],l); \</span>
<a name="l00326"></a>00326 <span class="preprocessor">    } else { \</span>
<a name="l00327"></a>00327 <span class="preprocessor">    const int inv_l = this-&gt;dfInv[l]; \</span>
<a name="l00328"></a>00328 <span class="preprocessor">    DEFAULT_STREAM_FREESLIP(l,inv_l,nbf); \</span>
<a name="l00329"></a>00329 <span class="preprocessor">    } \</span>
<a name="l00330"></a>00330 <span class="preprocessor">     \</span>
<a name="l00331"></a>00331 <span class="preprocessor">    } \</span>
<a name="l00332"></a>00332 <span class="preprocessor">    else { \</span>
<a name="l00333"></a>00333 <span class="preprocessor">    errMsg(&quot;LbmFsgrSolver&quot;,&quot;Invalid Bnd type at &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; f&quot;&lt;&lt;convertCellFlagType2String(nbf)&lt;&lt;&quot;,nbdir&quot;&lt;&lt;this-&gt;dfInv[l] ); \</span>
<a name="l00334"></a>00334 <span class="preprocessor">    } \</span>
<a name="l00335"></a>00335 <span class="preprocessor">    } else { \</span>
<a name="l00336"></a>00336 <span class="preprocessor">    m[l] = QCELL_NBINV(lev, i, j, k, SRCS(lev), l,l); \</span>
<a name="l00337"></a>00337 <span class="preprocessor">    if(RFLAG(lev, i,j,k, mLevel[lev].setCurr)&amp;CFFluid) { \</span>
<a name="l00338"></a>00338 <span class="preprocessor">    if(!(nbf&amp;(CFFluid|CFInter)) ) { \</span>
<a name="l00339"></a>00339 <span class="preprocessor">    int ni=i+this-&gt;dfVecX[this-&gt;dfInv[l]], nj=j+this-&gt;dfVecY[this-&gt;dfInv[l]], nk=k+this-&gt;dfVecZ[this-&gt;dfInv[l]]; \</span>
<a name="l00340"></a>00340 <span class="preprocessor">    errMsg(&quot;STREAMCHECK&quot;,&quot; Invalid nbflag, streamed DF l&quot;&lt;&lt;l&lt;&lt;&quot; value:&quot;&lt;&lt;m[l]&lt;&lt;&quot; at &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; from &quot;&lt;&lt; \</span>
<a name="l00341"></a>00341 <span class="preprocessor">    PRINT_VEC(ni,nj,nk) &lt;&lt;&quot; l&quot;&lt;&lt;(l)&lt;&lt; \</span>
<a name="l00342"></a>00342 <span class="preprocessor">    &quot; nfc&quot;&lt;&lt; RFLAG(lev, ni,nj,nk, mLevel[lev].setCurr)&lt;&lt;&quot; nfo&quot;&lt;&lt; RFLAG(lev, ni,nj,nk, mLevel[lev].setOther)  ); \</span>
<a name="l00343"></a>00343 <span class="preprocessor">     \</span>
<a name="l00344"></a>00344 <span class="preprocessor">     \</span>
<a name="l00345"></a>00345 <span class="preprocessor">    } } \</span>
<a name="l00346"></a>00346 <span class="preprocessor">    STREAMCHECK(4, i+this-&gt;dfVecX[this-&gt;dfInv[l]], j+this-&gt;dfVecY[this-&gt;dfInv[l]],k+this-&gt;dfVecZ[this-&gt;dfInv[l]], l); \</span>
<a name="l00347"></a>00347 <span class="preprocessor">    } \</span>
<a name="l00348"></a>00348 <span class="preprocessor">    } \</span>
<a name="l00349"></a>00349 <span class="preprocessor"></span>
<a name="l00350"></a>00350 <span class="preprocessor"></span>
<a name="l00351"></a>00351 
<a name="l00352"></a>00352 
<a name="l00353"></a>00353 <span class="comment">// careful ux,uy,uz need to be inited before!</span>
<a name="l00354"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a1ae3840edf382b4dacbc6f5e1e614034">00354</a> <span class="preprocessor">#define  DEFAULT_COLLIDEG(grav)  \</span>
<a name="l00355"></a>00355 <span class="preprocessor">    this-&gt;collideArrays(lev, i,j,k, m, rho,ux,uy,uz, OMEGA(lev), grav, mLevel[lev].lcsmago, &amp;mDebugOmegaRet, &amp;lcsmqo ); \</span>
<a name="l00356"></a>00356 <span class="preprocessor">    CSMOMEGA_STATS(lev,mDebugOmegaRet); \</span>
<a name="l00357"></a>00357 <span class="preprocessor">    FORDF0 { RAC(tcel,l) = m[l]; } \</span>
<a name="l00358"></a>00358 <span class="preprocessor">    usqr = 1.5 * (ux*ux + uy*uy + uz*uz); \</span>
<a name="l00359"></a>00359 <span class="preprocessor">    COLLCHECK; \</span>
<a name="l00360"></a>00360 <span class="preprocessor"></span>
<a name="l00361"></a>00361 <span class="preprocessor"></span>
<a name="l00362"></a>00362 
<a name="l00363"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#aca0e7264a23365d760325084f5f20962">00363</a> <span class="preprocessor">#define  OPTIMIZED_STREAMCOLLIDE  \</span>
<a name="l00364"></a>00364 <span class="preprocessor">    m[0] = RAC(ccel,0); \</span>
<a name="l00365"></a>00365 <span class="preprocessor">    FORDF1 { \</span>
<a name="l00366"></a>00366 <span class="preprocessor">     \</span>
<a name="l00367"></a>00367 <span class="preprocessor">    if(RFLAG_NBINV(lev, i,j,k,SRCS(lev),l)&amp;CFBnd) { errMsg(&quot;???&quot;, &quot;bnd-err-nobndfl&quot;); CAUSE_PANIC; \</span>
<a name="l00368"></a>00368 <span class="preprocessor">    } else { m[l] = QCELL_NBINV(lev, i, j, k, SRCS(lev), l, l); } \</span>
<a name="l00369"></a>00369 <span class="preprocessor">    STREAMCHECK(8, i+this-&gt;dfVecX[this-&gt;dfInv[l]], j+this-&gt;dfVecY[this-&gt;dfInv[l]],k+this-&gt;dfVecZ[this-&gt;dfInv[l]], l); \</span>
<a name="l00370"></a>00370 <span class="preprocessor">    } \</span>
<a name="l00371"></a>00371 <span class="preprocessor">    rho=m[0]; \</span>
<a name="l00372"></a>00372 <span class="preprocessor">    DEFAULT_COLLIDEG(mLevel[lev].gravity) \</span>
<a name="l00373"></a>00373 <span class="preprocessor"></span>
<a name="l00374"></a>00374 <span class="preprocessor"></span>
<a name="l00375"></a>00375 
<a name="l00376"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ae107c4514fb1521eeef4941e2dd558e4">00376</a> <span class="preprocessor">#define  OPTIMIZED_STREAMCOLLIDE___UNUSED  \</span>
<a name="l00377"></a>00377 <span class="preprocessor">     \</span>
<a name="l00378"></a>00378 <span class="preprocessor">    this-&gt;collideArrays(lev, i,j,k, m, rho,ux,uy,uz, OMEGA(lev), mLevel[lev].gravity, mLevel[lev].lcsmago , &amp;mDebugOmegaRet, &amp;lcsmqo   ); \</span>
<a name="l00379"></a>00379 <span class="preprocessor">    CSMOMEGA_STATS(lev,mDebugOmegaRet); \</span>
<a name="l00380"></a>00380 <span class="preprocessor">    FORDF0 { RAC(tcel,l) = m[l]; } \</span>
<a name="l00381"></a>00381 <span class="preprocessor">    usqr = 1.5 * (ux*ux + uy*uy + uz*uz); \</span>
<a name="l00382"></a>00382 <span class="preprocessor">    COLLCHECK; \</span>
<a name="l00383"></a>00383 <span class="preprocessor"></span>
<a name="l00384"></a>00384 <span class="preprocessor"></span>
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 <span class="preprocessor">#else  // 3D, opt OPT3D==true</span>
<a name="l00387"></a>00387 <span class="preprocessor"></span>
<a name="l00388"></a>00388 
<a name="l00389"></a>00389 <span class="comment">// default stream opt3d add moving bc val</span>
<a name="l00390"></a>00390 <span class="preprocessor">#define  DEFAULT_STREAM  \</span>
<a name="l00391"></a>00391 <span class="preprocessor">    m[dC] = RAC(ccel,dC); \</span>
<a name="l00392"></a>00392 <span class="preprocessor">     \</span>
<a name="l00393"></a>00393 <span class="preprocessor">    if(((!nbored) &amp; CFBnd)) { \</span>
<a name="l00394"></a>00394 <span class="preprocessor">     \</span>
<a name="l00395"></a>00395 <span class="preprocessor">    m[dN ] = CSRC_N ; m[dS ] = CSRC_S ; \</span>
<a name="l00396"></a>00396 <span class="preprocessor">    m[dE ] = CSRC_E ; m[dW ] = CSRC_W ; \</span>
<a name="l00397"></a>00397 <span class="preprocessor">    m[dT ] = CSRC_T ; m[dB ] = CSRC_B ; \</span>
<a name="l00398"></a>00398 <span class="preprocessor">    m[dNE] = CSRC_NE; m[dNW] = CSRC_NW; m[dSE] = CSRC_SE; m[dSW] = CSRC_SW; \</span>
<a name="l00399"></a>00399 <span class="preprocessor">    m[dNT] = CSRC_NT; m[dNB] = CSRC_NB; m[dST] = CSRC_ST; m[dSB] = CSRC_SB; \</span>
<a name="l00400"></a>00400 <span class="preprocessor">    m[dET] = CSRC_ET; m[dEB] = CSRC_EB; m[dWT] = CSRC_WT; m[dWB] = CSRC_WB; \</span>
<a name="l00401"></a>00401 <span class="preprocessor">    } else { \</span>
<a name="l00402"></a>00402 <span class="preprocessor">     \</span>
<a name="l00403"></a>00403 <span class="preprocessor">    if(nbflag[dS ]&amp;CFBnd) { m[dN ] = RAC(ccel,dS ); LBMDS_ADDMOV(dS ,dN ); } else { m[dN ] = CSRC_N ; } \</span>
<a name="l00404"></a>00404 <span class="preprocessor">    if(nbflag[dN ]&amp;CFBnd) { m[dS ] = RAC(ccel,dN ); LBMDS_ADDMOV(dN ,dS ); } else { m[dS ] = CSRC_S ; } \</span>
<a name="l00405"></a>00405 <span class="preprocessor">    if(nbflag[dW ]&amp;CFBnd) { m[dE ] = RAC(ccel,dW ); LBMDS_ADDMOV(dW ,dE ); } else { m[dE ] = CSRC_E ; } \</span>
<a name="l00406"></a>00406 <span class="preprocessor">    if(nbflag[dE ]&amp;CFBnd) { m[dW ] = RAC(ccel,dE ); LBMDS_ADDMOV(dE ,dW ); } else { m[dW ] = CSRC_W ; } \</span>
<a name="l00407"></a>00407 <span class="preprocessor">    if(nbflag[dB ]&amp;CFBnd) { m[dT ] = RAC(ccel,dB ); LBMDS_ADDMOV(dB ,dT ); } else { m[dT ] = CSRC_T ; } \</span>
<a name="l00408"></a>00408 <span class="preprocessor">    if(nbflag[dT ]&amp;CFBnd) { m[dB ] = RAC(ccel,dT ); LBMDS_ADDMOV(dT ,dB ); } else { m[dB ] = CSRC_B ; } \</span>
<a name="l00409"></a>00409 <span class="preprocessor">     \</span>
<a name="l00410"></a>00410 <span class="preprocessor">     \</span>
<a name="l00411"></a>00411 <span class="preprocessor">    if(nbflag[dSW]&amp;CFBnd) { if(nbflag[dSW]&amp;CFBndNoslip){ m[dNE] = RAC(ccel,dSW); LBMDS_ADDMOV(dSW,dNE); }else{ DEFAULT_STREAM_FREESLIP(dNE,dSW,nbflag[dSW]);} } else { m[dNE] = CSRC_NE; } \</span>
<a name="l00412"></a>00412 <span class="preprocessor">    if(nbflag[dSE]&amp;CFBnd) { if(nbflag[dSE]&amp;CFBndNoslip){ m[dNW] = RAC(ccel,dSE); LBMDS_ADDMOV(dSE,dNW); }else{ DEFAULT_STREAM_FREESLIP(dNW,dSE,nbflag[dSE]);} } else { m[dNW] = CSRC_NW; } \</span>
<a name="l00413"></a>00413 <span class="preprocessor">    if(nbflag[dNW]&amp;CFBnd) { if(nbflag[dNW]&amp;CFBndNoslip){ m[dSE] = RAC(ccel,dNW); LBMDS_ADDMOV(dNW,dSE); }else{ DEFAULT_STREAM_FREESLIP(dSE,dNW,nbflag[dNW]);} } else { m[dSE] = CSRC_SE; } \</span>
<a name="l00414"></a>00414 <span class="preprocessor">    if(nbflag[dNE]&amp;CFBnd) { if(nbflag[dNE]&amp;CFBndNoslip){ m[dSW] = RAC(ccel,dNE); LBMDS_ADDMOV(dNE,dSW); }else{ DEFAULT_STREAM_FREESLIP(dSW,dNE,nbflag[dNE]);} } else { m[dSW] = CSRC_SW; } \</span>
<a name="l00415"></a>00415 <span class="preprocessor">    if(nbflag[dSB]&amp;CFBnd) { if(nbflag[dSB]&amp;CFBndNoslip){ m[dNT] = RAC(ccel,dSB); LBMDS_ADDMOV(dSB,dNT); }else{ DEFAULT_STREAM_FREESLIP(dNT,dSB,nbflag[dSB]);} } else { m[dNT] = CSRC_NT; } \</span>
<a name="l00416"></a>00416 <span class="preprocessor">    if(nbflag[dST]&amp;CFBnd) { if(nbflag[dST]&amp;CFBndNoslip){ m[dNB] = RAC(ccel,dST); LBMDS_ADDMOV(dST,dNB); }else{ DEFAULT_STREAM_FREESLIP(dNB,dST,nbflag[dST]);} } else { m[dNB] = CSRC_NB; } \</span>
<a name="l00417"></a>00417 <span class="preprocessor">    if(nbflag[dNB]&amp;CFBnd) { if(nbflag[dNB]&amp;CFBndNoslip){ m[dST] = RAC(ccel,dNB); LBMDS_ADDMOV(dNB,dST); }else{ DEFAULT_STREAM_FREESLIP(dST,dNB,nbflag[dNB]);} } else { m[dST] = CSRC_ST; } \</span>
<a name="l00418"></a>00418 <span class="preprocessor">    if(nbflag[dNT]&amp;CFBnd) { if(nbflag[dNT]&amp;CFBndNoslip){ m[dSB] = RAC(ccel,dNT); LBMDS_ADDMOV(dNT,dSB); }else{ DEFAULT_STREAM_FREESLIP(dSB,dNT,nbflag[dNT]);} } else { m[dSB] = CSRC_SB; } \</span>
<a name="l00419"></a>00419 <span class="preprocessor">    if(nbflag[dWB]&amp;CFBnd) { if(nbflag[dWB]&amp;CFBndNoslip){ m[dET] = RAC(ccel,dWB); LBMDS_ADDMOV(dWB,dET); }else{ DEFAULT_STREAM_FREESLIP(dET,dWB,nbflag[dWB]);} } else { m[dET] = CSRC_ET; } \</span>
<a name="l00420"></a>00420 <span class="preprocessor">    if(nbflag[dWT]&amp;CFBnd) { if(nbflag[dWT]&amp;CFBndNoslip){ m[dEB] = RAC(ccel,dWT); LBMDS_ADDMOV(dWT,dEB); }else{ DEFAULT_STREAM_FREESLIP(dEB,dWT,nbflag[dWT]);} } else { m[dEB] = CSRC_EB; } \</span>
<a name="l00421"></a>00421 <span class="preprocessor">    if(nbflag[dEB]&amp;CFBnd) { if(nbflag[dEB]&amp;CFBndNoslip){ m[dWT] = RAC(ccel,dEB); LBMDS_ADDMOV(dEB,dWT); }else{ DEFAULT_STREAM_FREESLIP(dWT,dEB,nbflag[dEB]);} } else { m[dWT] = CSRC_WT; } \</span>
<a name="l00422"></a>00422 <span class="preprocessor">    if(nbflag[dET]&amp;CFBnd) { if(nbflag[dET]&amp;CFBndNoslip){ m[dWB] = RAC(ccel,dET); LBMDS_ADDMOV(dET,dWB); }else{ DEFAULT_STREAM_FREESLIP(dWB,dET,nbflag[dET]);} } else { m[dWB] = CSRC_WB; } \</span>
<a name="l00423"></a>00423 <span class="preprocessor">    } \</span>
<a name="l00424"></a>00424 <span class="preprocessor"></span>
<a name="l00425"></a>00425 <span class="preprocessor"></span>
<a name="l00426"></a>00426 
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 
<a name="l00429"></a>00429 <span class="preprocessor">#define  COLL_CALCULATE_DFEQ(dstarray)  \</span>
<a name="l00430"></a>00430 <span class="preprocessor">    dstarray[dN ] = EQN ; dstarray[dS ] = EQS ; \</span>
<a name="l00431"></a>00431 <span class="preprocessor">    dstarray[dE ] = EQE ; dstarray[dW ] = EQW ; \</span>
<a name="l00432"></a>00432 <span class="preprocessor">    dstarray[dT ] = EQT ; dstarray[dB ] = EQB ; \</span>
<a name="l00433"></a>00433 <span class="preprocessor">    dstarray[dNE] = EQNE; dstarray[dNW] = EQNW; dstarray[dSE] = EQSE; dstarray[dSW] = EQSW; \</span>
<a name="l00434"></a>00434 <span class="preprocessor">    dstarray[dNT] = EQNT; dstarray[dNB] = EQNB; dstarray[dST] = EQST; dstarray[dSB] = EQSB; \</span>
<a name="l00435"></a>00435 <span class="preprocessor">    dstarray[dET] = EQET; dstarray[dEB] = EQEB; dstarray[dWT] = EQWT; dstarray[dWB] = EQWB; \</span>
<a name="l00436"></a>00436 <span class="preprocessor"></span>
<a name="l00437"></a>00437 <span class="preprocessor"></span>
<a name="l00438"></a>00438 
<a name="l00439"></a>00439 <span class="preprocessor">#define  COLL_CALCULATE_NONEQTENSOR(csolev, srcArray )  \</span>
<a name="l00440"></a>00440 <span class="preprocessor">    lcsmqadd  = (srcArray##NE - lcsmeq[ dNE ]); \</span>
<a name="l00441"></a>00441 <span class="preprocessor">    lcsmqadd -= (srcArray##NW - lcsmeq[ dNW ]); \</span>
<a name="l00442"></a>00442 <span class="preprocessor">    lcsmqadd -= (srcArray##SE - lcsmeq[ dSE ]); \</span>
<a name="l00443"></a>00443 <span class="preprocessor">    lcsmqadd += (srcArray##SW - lcsmeq[ dSW ]); \</span>
<a name="l00444"></a>00444 <span class="preprocessor">    lcsmqo = (lcsmqadd*    lcsmqadd); \</span>
<a name="l00445"></a>00445 <span class="preprocessor">    lcsmqadd  = (srcArray##ET - lcsmeq[  dET ]); \</span>
<a name="l00446"></a>00446 <span class="preprocessor">    lcsmqadd -= (srcArray##EB - lcsmeq[  dEB ]); \</span>
<a name="l00447"></a>00447 <span class="preprocessor">    lcsmqadd -= (srcArray##WT - lcsmeq[  dWT ]); \</span>
<a name="l00448"></a>00448 <span class="preprocessor">    lcsmqadd += (srcArray##WB - lcsmeq[  dWB ]); \</span>
<a name="l00449"></a>00449 <span class="preprocessor">    lcsmqo += (lcsmqadd*    lcsmqadd); \</span>
<a name="l00450"></a>00450 <span class="preprocessor">    lcsmqadd  = (srcArray##NT - lcsmeq[  dNT ]); \</span>
<a name="l00451"></a>00451 <span class="preprocessor">    lcsmqadd -= (srcArray##NB - lcsmeq[  dNB ]); \</span>
<a name="l00452"></a>00452 <span class="preprocessor">    lcsmqadd -= (srcArray##ST - lcsmeq[  dST ]); \</span>
<a name="l00453"></a>00453 <span class="preprocessor">    lcsmqadd += (srcArray##SB - lcsmeq[  dSB ]); \</span>
<a name="l00454"></a>00454 <span class="preprocessor">    lcsmqo += (lcsmqadd*    lcsmqadd); \</span>
<a name="l00455"></a>00455 <span class="preprocessor">    lcsmqo *= 2.0; \</span>
<a name="l00456"></a>00456 <span class="preprocessor">    lcsmqadd  = (srcArray##E  -  lcsmeq[ dE  ]); \</span>
<a name="l00457"></a>00457 <span class="preprocessor">    lcsmqadd += (srcArray##W  -  lcsmeq[ dW  ]); \</span>
<a name="l00458"></a>00458 <span class="preprocessor">    lcsmqadd += (srcArray##NE -  lcsmeq[ dNE ]); \</span>
<a name="l00459"></a>00459 <span class="preprocessor">    lcsmqadd += (srcArray##NW -  lcsmeq[ dNW ]); \</span>
<a name="l00460"></a>00460 <span class="preprocessor">    lcsmqadd += (srcArray##SE -  lcsmeq[ dSE ]); \</span>
<a name="l00461"></a>00461 <span class="preprocessor">    lcsmqadd += (srcArray##SW -  lcsmeq[ dSW ]); \</span>
<a name="l00462"></a>00462 <span class="preprocessor">    lcsmqadd += (srcArray##ET  - lcsmeq[ dET ]); \</span>
<a name="l00463"></a>00463 <span class="preprocessor">    lcsmqadd += (srcArray##EB  - lcsmeq[ dEB ]); \</span>
<a name="l00464"></a>00464 <span class="preprocessor">    lcsmqadd += (srcArray##WT  - lcsmeq[ dWT ]); \</span>
<a name="l00465"></a>00465 <span class="preprocessor">    lcsmqadd += (srcArray##WB  - lcsmeq[ dWB ]); \</span>
<a name="l00466"></a>00466 <span class="preprocessor">    lcsmqo += (lcsmqadd*    lcsmqadd); \</span>
<a name="l00467"></a>00467 <span class="preprocessor">    lcsmqadd  = (srcArray##N  -  lcsmeq[ dN  ]); \</span>
<a name="l00468"></a>00468 <span class="preprocessor">    lcsmqadd += (srcArray##S  -  lcsmeq[ dS  ]); \</span>
<a name="l00469"></a>00469 <span class="preprocessor">    lcsmqadd += (srcArray##NE -  lcsmeq[ dNE ]); \</span>
<a name="l00470"></a>00470 <span class="preprocessor">    lcsmqadd += (srcArray##NW -  lcsmeq[ dNW ]); \</span>
<a name="l00471"></a>00471 <span class="preprocessor">    lcsmqadd += (srcArray##SE -  lcsmeq[ dSE ]); \</span>
<a name="l00472"></a>00472 <span class="preprocessor">    lcsmqadd += (srcArray##SW -  lcsmeq[ dSW ]); \</span>
<a name="l00473"></a>00473 <span class="preprocessor">    lcsmqadd += (srcArray##NT  - lcsmeq[ dNT ]); \</span>
<a name="l00474"></a>00474 <span class="preprocessor">    lcsmqadd += (srcArray##NB  - lcsmeq[ dNB ]); \</span>
<a name="l00475"></a>00475 <span class="preprocessor">    lcsmqadd += (srcArray##ST  - lcsmeq[ dST ]); \</span>
<a name="l00476"></a>00476 <span class="preprocessor">    lcsmqadd += (srcArray##SB  - lcsmeq[ dSB ]); \</span>
<a name="l00477"></a>00477 <span class="preprocessor">    lcsmqo += (lcsmqadd*    lcsmqadd); \</span>
<a name="l00478"></a>00478 <span class="preprocessor">    lcsmqadd  = (srcArray##T  -  lcsmeq[ dT  ]); \</span>
<a name="l00479"></a>00479 <span class="preprocessor">    lcsmqadd += (srcArray##B  -  lcsmeq[ dB  ]); \</span>
<a name="l00480"></a>00480 <span class="preprocessor">    lcsmqadd += (srcArray##NT -  lcsmeq[ dNT ]); \</span>
<a name="l00481"></a>00481 <span class="preprocessor">    lcsmqadd += (srcArray##NB -  lcsmeq[ dNB ]); \</span>
<a name="l00482"></a>00482 <span class="preprocessor">    lcsmqadd += (srcArray##ST -  lcsmeq[ dST ]); \</span>
<a name="l00483"></a>00483 <span class="preprocessor">    lcsmqadd += (srcArray##SB -  lcsmeq[ dSB ]); \</span>
<a name="l00484"></a>00484 <span class="preprocessor">    lcsmqadd += (srcArray##ET  - lcsmeq[ dET ]); \</span>
<a name="l00485"></a>00485 <span class="preprocessor">    lcsmqadd += (srcArray##EB  - lcsmeq[ dEB ]); \</span>
<a name="l00486"></a>00486 <span class="preprocessor">    lcsmqadd += (srcArray##WT  - lcsmeq[ dWT ]); \</span>
<a name="l00487"></a>00487 <span class="preprocessor">    lcsmqadd += (srcArray##WB  - lcsmeq[ dWB ]); \</span>
<a name="l00488"></a>00488 <span class="preprocessor">    lcsmqo += (lcsmqadd*    lcsmqadd); \</span>
<a name="l00489"></a>00489 <span class="preprocessor">    lcsmqo = sqrt(lcsmqo); \</span>
<a name="l00490"></a>00490 <span class="preprocessor"></span>
<a name="l00491"></a>00491 <span class="preprocessor"></span>
<a name="l00492"></a>00492 
<a name="l00493"></a>00493 <span class="comment">//          COLL_CALCULATE_CSMOMEGAVAL(csolev, lcsmomega); </span>
<a name="l00494"></a>00494 
<a name="l00495"></a>00495 <span class="comment">// careful - need lcsmqo </span>
<a name="l00496"></a>00496 <span class="preprocessor">#define  COLL_CALCULATE_CSMOMEGAVAL(csolev, dstomega )  \</span>
<a name="l00497"></a>00497 <span class="preprocessor">    dstomega =  1.0/ \</span>
<a name="l00498"></a>00498 <span class="preprocessor">    ( 3.0*( mLevel[(csolev)].lcnu+mLevel[(csolev)].lcsmago_sqr*( \</span>
<a name="l00499"></a>00499 <span class="preprocessor">    -mLevel[(csolev)].lcnu + sqrt( mLevel[(csolev)].lcnu*mLevel[(csolev)].lcnu + 18.0*mLevel[(csolev)].lcsmago_sqr* lcsmqo ) \</span>
<a name="l00500"></a>00500 <span class="preprocessor">    / (6.0*mLevel[(csolev)].lcsmago_sqr)) \</span>
<a name="l00501"></a>00501 <span class="preprocessor">    ) +0.5 ); \</span>
<a name="l00502"></a>00502 <span class="preprocessor"></span>
<a name="l00503"></a>00503 <span class="preprocessor"></span>
<a name="l00504"></a>00504 
<a name="l00505"></a>00505 <span class="preprocessor">#define  DEFAULT_COLLIDE_LES(grav)  \</span>
<a name="l00506"></a>00506 <span class="preprocessor">    rho = + MSRC_C  + MSRC_N \</span>
<a name="l00507"></a>00507 <span class="preprocessor">    + MSRC_S  + MSRC_E \</span>
<a name="l00508"></a>00508 <span class="preprocessor">    + MSRC_W  + MSRC_T \</span>
<a name="l00509"></a>00509 <span class="preprocessor">    + MSRC_B  + MSRC_NE \</span>
<a name="l00510"></a>00510 <span class="preprocessor">    + MSRC_NW + MSRC_SE \</span>
<a name="l00511"></a>00511 <span class="preprocessor">    + MSRC_SW + MSRC_NT \</span>
<a name="l00512"></a>00512 <span class="preprocessor">    + MSRC_NB + MSRC_ST \</span>
<a name="l00513"></a>00513 <span class="preprocessor">    + MSRC_SB + MSRC_ET \</span>
<a name="l00514"></a>00514 <span class="preprocessor">    + MSRC_EB + MSRC_WT \</span>
<a name="l00515"></a>00515 <span class="preprocessor">    + MSRC_WB; \</span>
<a name="l00516"></a>00516 <span class="preprocessor">     \</span>
<a name="l00517"></a>00517 <span class="preprocessor">    ux = MSRC_E - MSRC_W \</span>
<a name="l00518"></a>00518 <span class="preprocessor">    + MSRC_NE - MSRC_NW \</span>
<a name="l00519"></a>00519 <span class="preprocessor">    + MSRC_SE - MSRC_SW \</span>
<a name="l00520"></a>00520 <span class="preprocessor">    + MSRC_ET + MSRC_EB \</span>
<a name="l00521"></a>00521 <span class="preprocessor">    - MSRC_WT - MSRC_WB ; \</span>
<a name="l00522"></a>00522 <span class="preprocessor">     \</span>
<a name="l00523"></a>00523 <span class="preprocessor">    uy = MSRC_N - MSRC_S \</span>
<a name="l00524"></a>00524 <span class="preprocessor">    + MSRC_NE + MSRC_NW \</span>
<a name="l00525"></a>00525 <span class="preprocessor">    - MSRC_SE - MSRC_SW \</span>
<a name="l00526"></a>00526 <span class="preprocessor">    + MSRC_NT + MSRC_NB \</span>
<a name="l00527"></a>00527 <span class="preprocessor">    - MSRC_ST - MSRC_SB ; \</span>
<a name="l00528"></a>00528 <span class="preprocessor">     \</span>
<a name="l00529"></a>00529 <span class="preprocessor">    uz = MSRC_T - MSRC_B \</span>
<a name="l00530"></a>00530 <span class="preprocessor">    + MSRC_NT - MSRC_NB \</span>
<a name="l00531"></a>00531 <span class="preprocessor">    + MSRC_ST - MSRC_SB \</span>
<a name="l00532"></a>00532 <span class="preprocessor">    + MSRC_ET - MSRC_EB \</span>
<a name="l00533"></a>00533 <span class="preprocessor">    + MSRC_WT - MSRC_WB ; \</span>
<a name="l00534"></a>00534 <span class="preprocessor">    PRECOLLIDE_MODS(rho,ux,uy,uz, grav); \</span>
<a name="l00535"></a>00535 <span class="preprocessor">    usqr = 1.5 * (ux*ux + uy*uy + uz*uz); \</span>
<a name="l00536"></a>00536 <span class="preprocessor">    COLL_CALCULATE_DFEQ(lcsmeq); \</span>
<a name="l00537"></a>00537 <span class="preprocessor">    COLL_CALCULATE_NONEQTENSOR(lev, MSRC_); \</span>
<a name="l00538"></a>00538 <span class="preprocessor">    COLL_CALCULATE_CSMOMEGAVAL(lev, lcsmomega); \</span>
<a name="l00539"></a>00539 <span class="preprocessor">    CSMOMEGA_STATS(lev,lcsmomega); \</span>
<a name="l00540"></a>00540 <span class="preprocessor">     \</span>
<a name="l00541"></a>00541 <span class="preprocessor">    RAC(tcel,dC ) = (1.0-lcsmomega)*MSRC_C  + lcsmomega*EQC ; \</span>
<a name="l00542"></a>00542 <span class="preprocessor">     \</span>
<a name="l00543"></a>00543 <span class="preprocessor">    RAC(tcel,dN ) = (1.0-lcsmomega)*MSRC_N  + lcsmomega*lcsmeq[ dN ]; \</span>
<a name="l00544"></a>00544 <span class="preprocessor">    RAC(tcel,dS ) = (1.0-lcsmomega)*MSRC_S  + lcsmomega*lcsmeq[ dS ]; \</span>
<a name="l00545"></a>00545 <span class="preprocessor">    RAC(tcel,dE ) = (1.0-lcsmomega)*MSRC_E  + lcsmomega*lcsmeq[ dE ]; \</span>
<a name="l00546"></a>00546 <span class="preprocessor">    RAC(tcel,dW ) = (1.0-lcsmomega)*MSRC_W  + lcsmomega*lcsmeq[ dW ]; \</span>
<a name="l00547"></a>00547 <span class="preprocessor">    RAC(tcel,dT ) = (1.0-lcsmomega)*MSRC_T  + lcsmomega*lcsmeq[ dT ]; \</span>
<a name="l00548"></a>00548 <span class="preprocessor">    RAC(tcel,dB ) = (1.0-lcsmomega)*MSRC_B  + lcsmomega*lcsmeq[ dB ]; \</span>
<a name="l00549"></a>00549 <span class="preprocessor">     \</span>
<a name="l00550"></a>00550 <span class="preprocessor">    RAC(tcel,dNE) = (1.0-lcsmomega)*MSRC_NE + lcsmomega*lcsmeq[ dNE]; \</span>
<a name="l00551"></a>00551 <span class="preprocessor">    RAC(tcel,dNW) = (1.0-lcsmomega)*MSRC_NW + lcsmomega*lcsmeq[ dNW]; \</span>
<a name="l00552"></a>00552 <span class="preprocessor">    RAC(tcel,dSE) = (1.0-lcsmomega)*MSRC_SE + lcsmomega*lcsmeq[ dSE]; \</span>
<a name="l00553"></a>00553 <span class="preprocessor">    RAC(tcel,dSW) = (1.0-lcsmomega)*MSRC_SW + lcsmomega*lcsmeq[ dSW]; \</span>
<a name="l00554"></a>00554 <span class="preprocessor">    RAC(tcel,dNT) = (1.0-lcsmomega)*MSRC_NT + lcsmomega*lcsmeq[ dNT]; \</span>
<a name="l00555"></a>00555 <span class="preprocessor">    RAC(tcel,dNB) = (1.0-lcsmomega)*MSRC_NB + lcsmomega*lcsmeq[ dNB]; \</span>
<a name="l00556"></a>00556 <span class="preprocessor">    RAC(tcel,dST) = (1.0-lcsmomega)*MSRC_ST + lcsmomega*lcsmeq[ dST]; \</span>
<a name="l00557"></a>00557 <span class="preprocessor">    RAC(tcel,dSB) = (1.0-lcsmomega)*MSRC_SB + lcsmomega*lcsmeq[ dSB]; \</span>
<a name="l00558"></a>00558 <span class="preprocessor">    RAC(tcel,dET) = (1.0-lcsmomega)*MSRC_ET + lcsmomega*lcsmeq[ dET]; \</span>
<a name="l00559"></a>00559 <span class="preprocessor">    RAC(tcel,dEB) = (1.0-lcsmomega)*MSRC_EB + lcsmomega*lcsmeq[ dEB]; \</span>
<a name="l00560"></a>00560 <span class="preprocessor">    RAC(tcel,dWT) = (1.0-lcsmomega)*MSRC_WT + lcsmomega*lcsmeq[ dWT]; \</span>
<a name="l00561"></a>00561 <span class="preprocessor">    RAC(tcel,dWB) = (1.0-lcsmomega)*MSRC_WB + lcsmomega*lcsmeq[ dWB]; \</span>
<a name="l00562"></a>00562 <span class="preprocessor"></span>
<a name="l00563"></a>00563 <span class="preprocessor"></span>
<a name="l00564"></a>00564 
<a name="l00565"></a>00565 <span class="preprocessor">#define  DEFAULT_COLLIDE_NOLES(grav)  \</span>
<a name="l00566"></a>00566 <span class="preprocessor">    rho = + MSRC_C  + MSRC_N \</span>
<a name="l00567"></a>00567 <span class="preprocessor">    + MSRC_S  + MSRC_E \</span>
<a name="l00568"></a>00568 <span class="preprocessor">    + MSRC_W  + MSRC_T \</span>
<a name="l00569"></a>00569 <span class="preprocessor">    + MSRC_B  + MSRC_NE \</span>
<a name="l00570"></a>00570 <span class="preprocessor">    + MSRC_NW + MSRC_SE \</span>
<a name="l00571"></a>00571 <span class="preprocessor">    + MSRC_SW + MSRC_NT \</span>
<a name="l00572"></a>00572 <span class="preprocessor">    + MSRC_NB + MSRC_ST \</span>
<a name="l00573"></a>00573 <span class="preprocessor">    + MSRC_SB + MSRC_ET \</span>
<a name="l00574"></a>00574 <span class="preprocessor">    + MSRC_EB + MSRC_WT \</span>
<a name="l00575"></a>00575 <span class="preprocessor">    + MSRC_WB; \</span>
<a name="l00576"></a>00576 <span class="preprocessor">     \</span>
<a name="l00577"></a>00577 <span class="preprocessor">    ux = MSRC_E - MSRC_W \</span>
<a name="l00578"></a>00578 <span class="preprocessor">    + MSRC_NE - MSRC_NW \</span>
<a name="l00579"></a>00579 <span class="preprocessor">    + MSRC_SE - MSRC_SW \</span>
<a name="l00580"></a>00580 <span class="preprocessor">    + MSRC_ET + MSRC_EB \</span>
<a name="l00581"></a>00581 <span class="preprocessor">    - MSRC_WT - MSRC_WB ; \</span>
<a name="l00582"></a>00582 <span class="preprocessor">     \</span>
<a name="l00583"></a>00583 <span class="preprocessor">    uy = MSRC_N - MSRC_S \</span>
<a name="l00584"></a>00584 <span class="preprocessor">    + MSRC_NE + MSRC_NW \</span>
<a name="l00585"></a>00585 <span class="preprocessor">    - MSRC_SE - MSRC_SW \</span>
<a name="l00586"></a>00586 <span class="preprocessor">    + MSRC_NT + MSRC_NB \</span>
<a name="l00587"></a>00587 <span class="preprocessor">    - MSRC_ST - MSRC_SB ; \</span>
<a name="l00588"></a>00588 <span class="preprocessor">     \</span>
<a name="l00589"></a>00589 <span class="preprocessor">    uz = MSRC_T - MSRC_B \</span>
<a name="l00590"></a>00590 <span class="preprocessor">    + MSRC_NT - MSRC_NB \</span>
<a name="l00591"></a>00591 <span class="preprocessor">    + MSRC_ST - MSRC_SB \</span>
<a name="l00592"></a>00592 <span class="preprocessor">    + MSRC_ET - MSRC_EB \</span>
<a name="l00593"></a>00593 <span class="preprocessor">    + MSRC_WT - MSRC_WB ; \</span>
<a name="l00594"></a>00594 <span class="preprocessor">    PRECOLLIDE_MODS(rho, ux,uy,uz, grav); \</span>
<a name="l00595"></a>00595 <span class="preprocessor">    usqr = 1.5 * (ux*ux + uy*uy + uz*uz); \</span>
<a name="l00596"></a>00596 <span class="preprocessor">     \</span>
<a name="l00597"></a>00597 <span class="preprocessor">    RAC(tcel,dC ) = (1.0-OMEGA(lev))*MSRC_C  + OMEGA(lev)*EQC ; \</span>
<a name="l00598"></a>00598 <span class="preprocessor">     \</span>
<a name="l00599"></a>00599 <span class="preprocessor">    RAC(tcel,dN ) = (1.0-OMEGA(lev))*MSRC_N  + OMEGA(lev)*EQN ; \</span>
<a name="l00600"></a>00600 <span class="preprocessor">    RAC(tcel,dS ) = (1.0-OMEGA(lev))*MSRC_S  + OMEGA(lev)*EQS ; \</span>
<a name="l00601"></a>00601 <span class="preprocessor">    RAC(tcel,dE ) = (1.0-OMEGA(lev))*MSRC_E  + OMEGA(lev)*EQE ; \</span>
<a name="l00602"></a>00602 <span class="preprocessor">    RAC(tcel,dW ) = (1.0-OMEGA(lev))*MSRC_W  + OMEGA(lev)*EQW ; \</span>
<a name="l00603"></a>00603 <span class="preprocessor">    RAC(tcel,dT ) = (1.0-OMEGA(lev))*MSRC_T  + OMEGA(lev)*EQT ; \</span>
<a name="l00604"></a>00604 <span class="preprocessor">    RAC(tcel,dB ) = (1.0-OMEGA(lev))*MSRC_B  + OMEGA(lev)*EQB ; \</span>
<a name="l00605"></a>00605 <span class="preprocessor">     \</span>
<a name="l00606"></a>00606 <span class="preprocessor">    RAC(tcel,dNE) = (1.0-OMEGA(lev))*MSRC_NE + OMEGA(lev)*EQNE; \</span>
<a name="l00607"></a>00607 <span class="preprocessor">    RAC(tcel,dNW) = (1.0-OMEGA(lev))*MSRC_NW + OMEGA(lev)*EQNW; \</span>
<a name="l00608"></a>00608 <span class="preprocessor">    RAC(tcel,dSE) = (1.0-OMEGA(lev))*MSRC_SE + OMEGA(lev)*EQSE; \</span>
<a name="l00609"></a>00609 <span class="preprocessor">    RAC(tcel,dSW) = (1.0-OMEGA(lev))*MSRC_SW + OMEGA(lev)*EQSW; \</span>
<a name="l00610"></a>00610 <span class="preprocessor">    RAC(tcel,dNT) = (1.0-OMEGA(lev))*MSRC_NT + OMEGA(lev)*EQNT; \</span>
<a name="l00611"></a>00611 <span class="preprocessor">    RAC(tcel,dNB) = (1.0-OMEGA(lev))*MSRC_NB + OMEGA(lev)*EQNB; \</span>
<a name="l00612"></a>00612 <span class="preprocessor">    RAC(tcel,dST) = (1.0-OMEGA(lev))*MSRC_ST + OMEGA(lev)*EQST; \</span>
<a name="l00613"></a>00613 <span class="preprocessor">    RAC(tcel,dSB) = (1.0-OMEGA(lev))*MSRC_SB + OMEGA(lev)*EQSB; \</span>
<a name="l00614"></a>00614 <span class="preprocessor">    RAC(tcel,dET) = (1.0-OMEGA(lev))*MSRC_ET + OMEGA(lev)*EQET; \</span>
<a name="l00615"></a>00615 <span class="preprocessor">    RAC(tcel,dEB) = (1.0-OMEGA(lev))*MSRC_EB + OMEGA(lev)*EQEB; \</span>
<a name="l00616"></a>00616 <span class="preprocessor">    RAC(tcel,dWT) = (1.0-OMEGA(lev))*MSRC_WT + OMEGA(lev)*EQWT; \</span>
<a name="l00617"></a>00617 <span class="preprocessor">    RAC(tcel,dWB) = (1.0-OMEGA(lev))*MSRC_WB + OMEGA(lev)*EQWB; \</span>
<a name="l00618"></a>00618 <span class="preprocessor"></span>
<a name="l00619"></a>00619 <span class="preprocessor"></span>
<a name="l00620"></a>00620 
<a name="l00621"></a>00621 
<a name="l00622"></a>00622 
<a name="l00623"></a>00623 <span class="preprocessor">#define  OPTIMIZED_STREAMCOLLIDE_LES  \</span>
<a name="l00624"></a>00624 <span class="preprocessor">     \</span>
<a name="l00625"></a>00625 <span class="preprocessor">    m[dC ] = CSRC_C ; \</span>
<a name="l00626"></a>00626 <span class="preprocessor">    m[dN ] = CSRC_N ; m[dS ] = CSRC_S ; \</span>
<a name="l00627"></a>00627 <span class="preprocessor">    m[dE ] = CSRC_E ; m[dW ] = CSRC_W ; \</span>
<a name="l00628"></a>00628 <span class="preprocessor">    m[dT ] = CSRC_T ; m[dB ] = CSRC_B ; \</span>
<a name="l00629"></a>00629 <span class="preprocessor">    m[dNE] = CSRC_NE; m[dNW] = CSRC_NW; m[dSE] = CSRC_SE; m[dSW] = CSRC_SW; \</span>
<a name="l00630"></a>00630 <span class="preprocessor">    m[dNT] = CSRC_NT; m[dNB] = CSRC_NB; m[dST] = CSRC_ST; m[dSB] = CSRC_SB; \</span>
<a name="l00631"></a>00631 <span class="preprocessor">    m[dET] = CSRC_ET; m[dEB] = CSRC_EB; m[dWT] = CSRC_WT; m[dWB] = CSRC_WB; \</span>
<a name="l00632"></a>00632 <span class="preprocessor">     \</span>
<a name="l00633"></a>00633 <span class="preprocessor">    rho = MSRC_C  + MSRC_N + MSRC_S  + MSRC_E + MSRC_W  + MSRC_T \</span>
<a name="l00634"></a>00634 <span class="preprocessor">    + MSRC_B  + MSRC_NE + MSRC_NW + MSRC_SE + MSRC_SW + MSRC_NT \</span>
<a name="l00635"></a>00635 <span class="preprocessor">    + MSRC_NB + MSRC_ST + MSRC_SB + MSRC_ET + MSRC_EB + MSRC_WT + MSRC_WB; \</span>
<a name="l00636"></a>00636 <span class="preprocessor">    ux = MSRC_E - MSRC_W + MSRC_NE - MSRC_NW + MSRC_SE - MSRC_SW \</span>
<a name="l00637"></a>00637 <span class="preprocessor">    + MSRC_ET + MSRC_EB - MSRC_WT - MSRC_WB; \</span>
<a name="l00638"></a>00638 <span class="preprocessor">    uy = MSRC_N - MSRC_S + MSRC_NE + MSRC_NW - MSRC_SE - MSRC_SW \</span>
<a name="l00639"></a>00639 <span class="preprocessor">    + MSRC_NT + MSRC_NB - MSRC_ST - MSRC_SB; \</span>
<a name="l00640"></a>00640 <span class="preprocessor">    uz = MSRC_T - MSRC_B + MSRC_NT - MSRC_NB + MSRC_ST - MSRC_SB \</span>
<a name="l00641"></a>00641 <span class="preprocessor">    + MSRC_ET - MSRC_EB + MSRC_WT - MSRC_WB; \</span>
<a name="l00642"></a>00642 <span class="preprocessor">    PRECOLLIDE_MODS(rho, ux,uy,uz, mLevel[lev].gravity); \</span>
<a name="l00643"></a>00643 <span class="preprocessor">    usqr = 1.5 * (ux*ux + uy*uy + uz*uz); \</span>
<a name="l00644"></a>00644 <span class="preprocessor">    COLL_CALCULATE_DFEQ(lcsmeq); \</span>
<a name="l00645"></a>00645 <span class="preprocessor">    COLL_CALCULATE_NONEQTENSOR(lev, MSRC_) \</span>
<a name="l00646"></a>00646 <span class="preprocessor">    COLL_CALCULATE_CSMOMEGAVAL(lev, lcsmomega); \</span>
<a name="l00647"></a>00647 <span class="preprocessor">    CSMOMEGA_STATS(lev,lcsmomega); \</span>
<a name="l00648"></a>00648 <span class="preprocessor">     \</span>
<a name="l00649"></a>00649 <span class="preprocessor">    RAC(tcel,dC ) = (1.0-lcsmomega)*MSRC_C  + lcsmomega*EQC ; \</span>
<a name="l00650"></a>00650 <span class="preprocessor">    RAC(tcel,dN ) = (1.0-lcsmomega)*MSRC_N  + lcsmomega*lcsmeq[ dN ]; \</span>
<a name="l00651"></a>00651 <span class="preprocessor">    RAC(tcel,dS ) = (1.0-lcsmomega)*MSRC_S  + lcsmomega*lcsmeq[ dS ]; \</span>
<a name="l00652"></a>00652 <span class="preprocessor">    RAC(tcel,dE ) = (1.0-lcsmomega)*MSRC_E  + lcsmomega*lcsmeq[ dE ]; \</span>
<a name="l00653"></a>00653 <span class="preprocessor">    RAC(tcel,dW ) = (1.0-lcsmomega)*MSRC_W  + lcsmomega*lcsmeq[ dW ]; \</span>
<a name="l00654"></a>00654 <span class="preprocessor">    RAC(tcel,dT ) = (1.0-lcsmomega)*MSRC_T  + lcsmomega*lcsmeq[ dT ]; \</span>
<a name="l00655"></a>00655 <span class="preprocessor">    RAC(tcel,dB ) = (1.0-lcsmomega)*MSRC_B  + lcsmomega*lcsmeq[ dB ]; \</span>
<a name="l00656"></a>00656 <span class="preprocessor">     \</span>
<a name="l00657"></a>00657 <span class="preprocessor">    RAC(tcel,dNE) = (1.0-lcsmomega)*MSRC_NE + lcsmomega*lcsmeq[ dNE]; \</span>
<a name="l00658"></a>00658 <span class="preprocessor">    RAC(tcel,dNW) = (1.0-lcsmomega)*MSRC_NW + lcsmomega*lcsmeq[ dNW]; \</span>
<a name="l00659"></a>00659 <span class="preprocessor">    RAC(tcel,dSE) = (1.0-lcsmomega)*MSRC_SE + lcsmomega*lcsmeq[ dSE]; \</span>
<a name="l00660"></a>00660 <span class="preprocessor">    RAC(tcel,dSW) = (1.0-lcsmomega)*MSRC_SW + lcsmomega*lcsmeq[ dSW]; \</span>
<a name="l00661"></a>00661 <span class="preprocessor">     \</span>
<a name="l00662"></a>00662 <span class="preprocessor">    RAC(tcel,dNT) = (1.0-lcsmomega)*MSRC_NT + lcsmomega*lcsmeq[ dNT]; \</span>
<a name="l00663"></a>00663 <span class="preprocessor">    RAC(tcel,dNB) = (1.0-lcsmomega)*MSRC_NB + lcsmomega*lcsmeq[ dNB]; \</span>
<a name="l00664"></a>00664 <span class="preprocessor">    RAC(tcel,dST) = (1.0-lcsmomega)*MSRC_ST + lcsmomega*lcsmeq[ dST]; \</span>
<a name="l00665"></a>00665 <span class="preprocessor">    RAC(tcel,dSB) = (1.0-lcsmomega)*MSRC_SB + lcsmomega*lcsmeq[ dSB]; \</span>
<a name="l00666"></a>00666 <span class="preprocessor">     \</span>
<a name="l00667"></a>00667 <span class="preprocessor">    RAC(tcel,dET) = (1.0-lcsmomega)*MSRC_ET + lcsmomega*lcsmeq[ dET]; \</span>
<a name="l00668"></a>00668 <span class="preprocessor">    RAC(tcel,dEB) = (1.0-lcsmomega)*MSRC_EB + lcsmomega*lcsmeq[ dEB]; \</span>
<a name="l00669"></a>00669 <span class="preprocessor">    RAC(tcel,dWT) = (1.0-lcsmomega)*MSRC_WT + lcsmomega*lcsmeq[ dWT]; \</span>
<a name="l00670"></a>00670 <span class="preprocessor">    RAC(tcel,dWB) = (1.0-lcsmomega)*MSRC_WB + lcsmomega*lcsmeq[ dWB]; \</span>
<a name="l00671"></a>00671 <span class="preprocessor"></span>
<a name="l00672"></a>00672 <span class="preprocessor"></span>
<a name="l00673"></a>00673 
<a name="l00674"></a>00674 <span class="preprocessor">#define  OPTIMIZED_STREAMCOLLIDE_UNUSED  \</span>
<a name="l00675"></a>00675 <span class="preprocessor">     \</span>
<a name="l00676"></a>00676 <span class="preprocessor">    rho = CSRC_C  + CSRC_N + CSRC_S  + CSRC_E + CSRC_W  + CSRC_T \</span>
<a name="l00677"></a>00677 <span class="preprocessor">    + CSRC_B  + CSRC_NE + CSRC_NW + CSRC_SE + CSRC_SW + CSRC_NT \</span>
<a name="l00678"></a>00678 <span class="preprocessor">    + CSRC_NB + CSRC_ST + CSRC_SB + CSRC_ET + CSRC_EB + CSRC_WT + CSRC_WB; \</span>
<a name="l00679"></a>00679 <span class="preprocessor">    ux = CSRC_E - CSRC_W + CSRC_NE - CSRC_NW + CSRC_SE - CSRC_SW \</span>
<a name="l00680"></a>00680 <span class="preprocessor">    + CSRC_ET + CSRC_EB - CSRC_WT - CSRC_WB; \</span>
<a name="l00681"></a>00681 <span class="preprocessor">    uy = CSRC_N - CSRC_S + CSRC_NE + CSRC_NW - CSRC_SE - CSRC_SW \</span>
<a name="l00682"></a>00682 <span class="preprocessor">    + CSRC_NT + CSRC_NB - CSRC_ST - CSRC_SB; \</span>
<a name="l00683"></a>00683 <span class="preprocessor">    uz = CSRC_T - CSRC_B + CSRC_NT - CSRC_NB + CSRC_ST - CSRC_SB \</span>
<a name="l00684"></a>00684 <span class="preprocessor">    + CSRC_ET - CSRC_EB + CSRC_WT - CSRC_WB; \</span>
<a name="l00685"></a>00685 <span class="preprocessor">    PRECOLLIDE_MODS(rho, ux,uy,uz, mLevel[lev].gravity); \</span>
<a name="l00686"></a>00686 <span class="preprocessor">    usqr = 1.5 * (ux*ux + uy*uy + uz*uz); \</span>
<a name="l00687"></a>00687 <span class="preprocessor">    COLL_CALCULATE_DFEQ(lcsmeq); \</span>
<a name="l00688"></a>00688 <span class="preprocessor">    COLL_CALCULATE_NONEQTENSOR(lev, CSRC_) \</span>
<a name="l00689"></a>00689 <span class="preprocessor">    COLL_CALCULATE_CSMOMEGAVAL(lev, lcsmomega); \</span>
<a name="l00690"></a>00690 <span class="preprocessor">     \</span>
<a name="l00691"></a>00691 <span class="preprocessor">    RAC(tcel,dC ) = (1.0-lcsmomega)*CSRC_C  + lcsmomega*EQC ; \</span>
<a name="l00692"></a>00692 <span class="preprocessor">    RAC(tcel,dN ) = (1.0-lcsmomega)*CSRC_N  + lcsmomega*lcsmeq[ dN ]; \</span>
<a name="l00693"></a>00693 <span class="preprocessor">    RAC(tcel,dS ) = (1.0-lcsmomega)*CSRC_S  + lcsmomega*lcsmeq[ dS ]; \</span>
<a name="l00694"></a>00694 <span class="preprocessor">    RAC(tcel,dE ) = (1.0-lcsmomega)*CSRC_E  + lcsmomega*lcsmeq[ dE ]; \</span>
<a name="l00695"></a>00695 <span class="preprocessor">    RAC(tcel,dW ) = (1.0-lcsmomega)*CSRC_W  + lcsmomega*lcsmeq[ dW ]; \</span>
<a name="l00696"></a>00696 <span class="preprocessor">    RAC(tcel,dT ) = (1.0-lcsmomega)*CSRC_T  + lcsmomega*lcsmeq[ dT ]; \</span>
<a name="l00697"></a>00697 <span class="preprocessor">    RAC(tcel,dB ) = (1.0-lcsmomega)*CSRC_B  + lcsmomega*lcsmeq[ dB ]; \</span>
<a name="l00698"></a>00698 <span class="preprocessor">     \</span>
<a name="l00699"></a>00699 <span class="preprocessor">    RAC(tcel,dNE) = (1.0-lcsmomega)*CSRC_NE + lcsmomega*lcsmeq[ dNE]; \</span>
<a name="l00700"></a>00700 <span class="preprocessor">    RAC(tcel,dNW) = (1.0-lcsmomega)*CSRC_NW + lcsmomega*lcsmeq[ dNW]; \</span>
<a name="l00701"></a>00701 <span class="preprocessor">    RAC(tcel,dSE) = (1.0-lcsmomega)*CSRC_SE + lcsmomega*lcsmeq[ dSE]; \</span>
<a name="l00702"></a>00702 <span class="preprocessor">    RAC(tcel,dSW) = (1.0-lcsmomega)*CSRC_SW + lcsmomega*lcsmeq[ dSW]; \</span>
<a name="l00703"></a>00703 <span class="preprocessor">     \</span>
<a name="l00704"></a>00704 <span class="preprocessor">    RAC(tcel,dNT) = (1.0-lcsmomega)*CSRC_NT + lcsmomega*lcsmeq[ dNT]; \</span>
<a name="l00705"></a>00705 <span class="preprocessor">    RAC(tcel,dNB) = (1.0-lcsmomega)*CSRC_NB + lcsmomega*lcsmeq[ dNB]; \</span>
<a name="l00706"></a>00706 <span class="preprocessor">    RAC(tcel,dST) = (1.0-lcsmomega)*CSRC_ST + lcsmomega*lcsmeq[ dST]; \</span>
<a name="l00707"></a>00707 <span class="preprocessor">    RAC(tcel,dSB) = (1.0-lcsmomega)*CSRC_SB + lcsmomega*lcsmeq[ dSB]; \</span>
<a name="l00708"></a>00708 <span class="preprocessor">     \</span>
<a name="l00709"></a>00709 <span class="preprocessor">    RAC(tcel,dET) = (1.0-lcsmomega)*CSRC_ET + lcsmomega*lcsmeq[ dET]; \</span>
<a name="l00710"></a>00710 <span class="preprocessor">    RAC(tcel,dEB) = (1.0-lcsmomega)*CSRC_EB + lcsmomega*lcsmeq[ dEB]; \</span>
<a name="l00711"></a>00711 <span class="preprocessor">    RAC(tcel,dWT) = (1.0-lcsmomega)*CSRC_WT + lcsmomega*lcsmeq[ dWT]; \</span>
<a name="l00712"></a>00712 <span class="preprocessor">    RAC(tcel,dWB) = (1.0-lcsmomega)*CSRC_WB + lcsmomega*lcsmeq[ dWB]; \</span>
<a name="l00713"></a>00713 <span class="preprocessor"></span>
<a name="l00714"></a>00714 <span class="preprocessor"></span>
<a name="l00715"></a>00715 
<a name="l00716"></a>00716 <span class="preprocessor">#define  OPTIMIZED_STREAMCOLLIDE_NOLES  \</span>
<a name="l00717"></a>00717 <span class="preprocessor">     \</span>
<a name="l00718"></a>00718 <span class="preprocessor">    rho = CSRC_C  + CSRC_N + CSRC_S  + CSRC_E + CSRC_W  + CSRC_T \</span>
<a name="l00719"></a>00719 <span class="preprocessor">    + CSRC_B  + CSRC_NE + CSRC_NW + CSRC_SE + CSRC_SW + CSRC_NT \</span>
<a name="l00720"></a>00720 <span class="preprocessor">    + CSRC_NB + CSRC_ST + CSRC_SB + CSRC_ET + CSRC_EB + CSRC_WT + CSRC_WB; \</span>
<a name="l00721"></a>00721 <span class="preprocessor">    ux = CSRC_E - CSRC_W + CSRC_NE - CSRC_NW + CSRC_SE - CSRC_SW \</span>
<a name="l00722"></a>00722 <span class="preprocessor">    + CSRC_ET + CSRC_EB - CSRC_WT - CSRC_WB; \</span>
<a name="l00723"></a>00723 <span class="preprocessor">    uy = CSRC_N - CSRC_S + CSRC_NE + CSRC_NW - CSRC_SE - CSRC_SW \</span>
<a name="l00724"></a>00724 <span class="preprocessor">    + CSRC_NT + CSRC_NB - CSRC_ST - CSRC_SB; \</span>
<a name="l00725"></a>00725 <span class="preprocessor">    uz = CSRC_T - CSRC_B + CSRC_NT - CSRC_NB + CSRC_ST - CSRC_SB \</span>
<a name="l00726"></a>00726 <span class="preprocessor">    + CSRC_ET - CSRC_EB + CSRC_WT - CSRC_WB; \</span>
<a name="l00727"></a>00727 <span class="preprocessor">    PRECOLLIDE_MODS(rho, ux,uy,uz, mLevel[lev].gravity); \</span>
<a name="l00728"></a>00728 <span class="preprocessor">    usqr = 1.5 * (ux*ux + uy*uy + uz*uz); \</span>
<a name="l00729"></a>00729 <span class="preprocessor">    RAC(tcel,dC ) = (1.0-OMEGA(lev))*CSRC_C  + OMEGA(lev)*EQC ; \</span>
<a name="l00730"></a>00730 <span class="preprocessor">    RAC(tcel,dN ) = (1.0-OMEGA(lev))*CSRC_N  + OMEGA(lev)*EQN ; \</span>
<a name="l00731"></a>00731 <span class="preprocessor">    RAC(tcel,dS ) = (1.0-OMEGA(lev))*CSRC_S  + OMEGA(lev)*EQS ; \</span>
<a name="l00732"></a>00732 <span class="preprocessor">    RAC(tcel,dE ) = (1.0-OMEGA(lev))*CSRC_E  + OMEGA(lev)*EQE ; \</span>
<a name="l00733"></a>00733 <span class="preprocessor">    RAC(tcel,dW ) = (1.0-OMEGA(lev))*CSRC_W  + OMEGA(lev)*EQW ; \</span>
<a name="l00734"></a>00734 <span class="preprocessor">    RAC(tcel,dT ) = (1.0-OMEGA(lev))*CSRC_T  + OMEGA(lev)*EQT ; \</span>
<a name="l00735"></a>00735 <span class="preprocessor">    RAC(tcel,dB ) = (1.0-OMEGA(lev))*CSRC_B  + OMEGA(lev)*EQB ; \</span>
<a name="l00736"></a>00736 <span class="preprocessor">     \</span>
<a name="l00737"></a>00737 <span class="preprocessor">    RAC(tcel,dNE) = (1.0-OMEGA(lev))*CSRC_NE + OMEGA(lev)*EQNE; \</span>
<a name="l00738"></a>00738 <span class="preprocessor">    RAC(tcel,dNW) = (1.0-OMEGA(lev))*CSRC_NW + OMEGA(lev)*EQNW; \</span>
<a name="l00739"></a>00739 <span class="preprocessor">    RAC(tcel,dSE) = (1.0-OMEGA(lev))*CSRC_SE + OMEGA(lev)*EQSE; \</span>
<a name="l00740"></a>00740 <span class="preprocessor">    RAC(tcel,dSW) = (1.0-OMEGA(lev))*CSRC_SW + OMEGA(lev)*EQSW; \</span>
<a name="l00741"></a>00741 <span class="preprocessor">     \</span>
<a name="l00742"></a>00742 <span class="preprocessor">    RAC(tcel,dNT) = (1.0-OMEGA(lev))*CSRC_NT + OMEGA(lev)*EQNT; \</span>
<a name="l00743"></a>00743 <span class="preprocessor">    RAC(tcel,dNB) = (1.0-OMEGA(lev))*CSRC_NB + OMEGA(lev)*EQNB; \</span>
<a name="l00744"></a>00744 <span class="preprocessor">    RAC(tcel,dST) = (1.0-OMEGA(lev))*CSRC_ST + OMEGA(lev)*EQST; \</span>
<a name="l00745"></a>00745 <span class="preprocessor">    RAC(tcel,dSB) = (1.0-OMEGA(lev))*CSRC_SB + OMEGA(lev)*EQSB; \</span>
<a name="l00746"></a>00746 <span class="preprocessor">     \</span>
<a name="l00747"></a>00747 <span class="preprocessor">    RAC(tcel,dET) = (1.0-OMEGA(lev))*CSRC_ET + OMEGA(lev)*EQET; \</span>
<a name="l00748"></a>00748 <span class="preprocessor">    RAC(tcel,dEB) = (1.0-OMEGA(lev))*CSRC_EB + OMEGA(lev)*EQEB; \</span>
<a name="l00749"></a>00749 <span class="preprocessor">    RAC(tcel,dWT) = (1.0-OMEGA(lev))*CSRC_WT + OMEGA(lev)*EQWT; \</span>
<a name="l00750"></a>00750 <span class="preprocessor">    RAC(tcel,dWB) = (1.0-OMEGA(lev))*CSRC_WB + OMEGA(lev)*EQWB; \</span>
<a name="l00751"></a>00751 <span class="preprocessor"></span>
<a name="l00752"></a>00752 <span class="preprocessor"></span>
<a name="l00753"></a>00753 
<a name="l00754"></a>00754 
<a name="l00755"></a>00755 
<a name="l00756"></a>00756 <span class="comment">// LES switching for OPT3D</span>
<a name="l00757"></a>00757 <span class="preprocessor">#if USE_LES==1</span>
<a name="l00758"></a>00758 <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_COLLIDEG(grav) DEFAULT_COLLIDE_LES(grav)</span>
<a name="l00759"></a>00759 <span class="preprocessor"></span><span class="preprocessor">#define OPTIMIZED_STREAMCOLLIDE OPTIMIZED_STREAMCOLLIDE_LES</span>
<a name="l00760"></a>00760 <span class="preprocessor"></span><span class="preprocessor">#else </span>
<a name="l00761"></a>00761 <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_COLLIDEG(grav) DEFAULT_COLLIDE_NOLES(grav)</span>
<a name="l00762"></a>00762 <span class="preprocessor"></span><span class="preprocessor">#define OPTIMIZED_STREAMCOLLIDE OPTIMIZED_STREAMCOLLIDE_NOLES</span>
<a name="l00763"></a>00763 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00764"></a>00764 <span class="preprocessor"></span>
<a name="l00765"></a>00765 <span class="preprocessor">#endif  // 3D, opt OPT3D==true</span>
<a name="l00766"></a>00766 <span class="preprocessor"></span>
<a name="l00767"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a1cfc8e7aa3da03d8b8eab3e1a93fc02d">00767</a> <span class="preprocessor">#define USQRMAXCHECK(Cusqr,Cux,Cuy,Cuz,  CmMaxVlen,CmMxvx,CmMxvy,CmMxvz) \</span>
<a name="l00768"></a>00768 <span class="preprocessor">            if(Cusqr&gt;CmMaxVlen) { \</span>
<a name="l00769"></a>00769 <span class="preprocessor">                CmMxvx = Cux; CmMxvy = Cuy; CmMxvz = Cuz; CmMaxVlen = Cusqr; \</span>
<a name="l00770"></a>00770 <span class="preprocessor">            } </span><span class="comment">/* stats */</span> 
<a name="l00771"></a>00771 
<a name="l00772"></a>00772 
<a name="l00773"></a>00773 
<a name="l00774"></a>00774 <span class="comment">/******************************************************************************</span>
<a name="l00775"></a>00775 <span class="comment"> * interpolateCellFromCoarse macros</span>
<a name="l00776"></a>00776 <span class="comment"> *****************************************************************************/</span>
<a name="l00777"></a>00777 
<a name="l00778"></a>00778 
<a name="l00779"></a>00779 <span class="comment">// WOXDY_N = Weight Order X Dimension Y _ number N</span>
<a name="l00780"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ad8d55c6b37106e3ce9fdc428f7bea6ae">00780</a> <span class="preprocessor">#define WO1D1   ( 1.0/ 2.0)</span>
<a name="l00781"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a279dd6efc978bd18f588509229ab64ea">00781</a> <span class="preprocessor"></span><span class="preprocessor">#define WO1D2   ( 1.0/ 4.0)</span>
<a name="l00782"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a9ef972bf9c21dbe48bb84fbd87296e01">00782</a> <span class="preprocessor"></span><span class="preprocessor">#define WO1D3   ( 1.0/ 8.0)</span>
<a name="l00783"></a>00783 <span class="preprocessor"></span>
<a name="l00784"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a3a84cac236e8f2170a3c9be7a8043210">00784</a> <span class="preprocessor">#define WO2D1_1 (-1.0/16.0)</span>
<a name="l00785"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a1e4a57f5cf40c11914f4d449a338e3b5">00785</a> <span class="preprocessor"></span><span class="preprocessor">#define WO2D1_9 ( 9.0/16.0)</span>
<a name="l00786"></a>00786 <span class="preprocessor"></span>
<a name="l00787"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a19597a6991c1355288e423ee1059bcc9">00787</a> <span class="preprocessor">#define WO2D2_11 (WO2D1_1 * WO2D1_1)</span>
<a name="l00788"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ac35973c134b6f0b660c68ab3e2585120">00788</a> <span class="preprocessor"></span><span class="preprocessor">#define WO2D2_19 (WO2D1_9 * WO2D1_1)</span>
<a name="l00789"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a00948b28edf52e19c934eb74f6cefcbf">00789</a> <span class="preprocessor"></span><span class="preprocessor">#define WO2D2_91 (WO2D1_9 * WO2D1_1)</span>
<a name="l00790"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a306b2b98a53e913bda5255fc6c807f5c">00790</a> <span class="preprocessor"></span><span class="preprocessor">#define WO2D2_99 (WO2D1_9 * WO2D1_9)</span>
<a name="l00791"></a>00791 <span class="preprocessor"></span>
<a name="l00792"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a4da76e43ede9b155424f9636fb2502bc">00792</a> <span class="preprocessor">#define WO2D3_111 (WO2D1_1 * WO2D1_1 * WO2D1_1)</span>
<a name="l00793"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a76211475d04697174c34cb0d22d87be6">00793</a> <span class="preprocessor"></span><span class="preprocessor">#define WO2D3_191 (WO2D1_9 * WO2D1_1 * WO2D1_1)</span>
<a name="l00794"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a22ce3287c3ae62e2c8c94219bbcc5a0e">00794</a> <span class="preprocessor"></span><span class="preprocessor">#define WO2D3_911 (WO2D1_9 * WO2D1_1 * WO2D1_1)</span>
<a name="l00795"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a23d1f34c5cbf2d181691495e3aaeaac1">00795</a> <span class="preprocessor"></span><span class="preprocessor">#define WO2D3_991 (WO2D1_9 * WO2D1_9 * WO2D1_1)</span>
<a name="l00796"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a3f1562fb2d482da2591bf23b00415b47">00796</a> <span class="preprocessor"></span><span class="preprocessor">#define WO2D3_119 (WO2D1_1 * WO2D1_1 * WO2D1_9)</span>
<a name="l00797"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a8c1002e835c5cb8729c5dbeb1f575460">00797</a> <span class="preprocessor"></span><span class="preprocessor">#define WO2D3_199 (WO2D1_9 * WO2D1_1 * WO2D1_9)</span>
<a name="l00798"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a3f454d28b7969e1c06d78a91aabd2a7d">00798</a> <span class="preprocessor"></span><span class="preprocessor">#define WO2D3_919 (WO2D1_9 * WO2D1_1 * WO2D1_9)</span>
<a name="l00799"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a5b1672f6d6a67d00acbd91fca4fca578">00799</a> <span class="preprocessor"></span><span class="preprocessor">#define WO2D3_999 (WO2D1_9 * WO2D1_9 * WO2D1_9)</span>
<a name="l00800"></a>00800 <span class="preprocessor"></span>
<a name="l00801"></a>00801 <span class="preprocessor">#if FSGR_STRICT_DEBUG==1</span>
<a name="l00802"></a>00802 <span class="preprocessor"></span><span class="preprocessor">#define ADD_INT_DFSCHECK(alev, ai,aj,ak, at, afac, l) \</span>
<a name="l00803"></a>00803 <span class="preprocessor">                if( (((1.0-(at))&gt;0.0) &amp;&amp; (!(QCELL((alev), (ai),(aj),(ak),mLevel[(alev)].setCurr , l) &gt; -1.0 ))) || \</span>
<a name="l00804"></a>00804 <span class="preprocessor">                        (((    (at))&gt;0.0) &amp;&amp; (!(QCELL((alev), (ai),(aj),(ak),mLevel[(alev)].setOther, l) &gt; -1.0 ))) ){ \</span>
<a name="l00805"></a>00805 <span class="preprocessor">                    errMsg(&quot;INVDFSCHECK&quot;, &quot; l&quot;&lt;&lt;(alev)&lt;&lt;&quot; &quot;&lt;&lt;PRINT_VEC((ai),(aj),(ak))&lt;&lt;&quot; fc:&quot;&lt;&lt;RFLAG((alev), (ai),(aj),(ak),mLevel[(alev)].setCurr )&lt;&lt;&quot; fo:&quot;&lt;&lt;RFLAG((alev), (ai),(aj),(ak),mLevel[(alev)].setOther )&lt;&lt;&quot; dfl&quot;&lt;&lt;l ); \</span>
<a name="l00806"></a>00806 <span class="preprocessor">                    debugMarkCell((alev), (ai),(aj),(ak));\</span>
<a name="l00807"></a>00807 <span class="preprocessor">                    CAUSE_PANIC; \</span>
<a name="l00808"></a>00808 <span class="preprocessor">                }</span>
<a name="l00809"></a>00809 <span class="preprocessor"></span>                <span class="comment">// end ADD_INT_DFSCHECK</span>
<a name="l00810"></a>00810 <span class="preprocessor">#define ADD_INT_FLAGCHECK(alev, ai,aj,ak, at, afac) \</span>
<a name="l00811"></a>00811 <span class="preprocessor">                if( (((1.0-(at))&gt;0.0) &amp;&amp; (!(RFLAG((alev), (ai),(aj),(ak),mLevel[(alev)].setCurr )&amp;(CFInter|CFFluid|CFGrCoarseInited) ))) || \</span>
<a name="l00812"></a>00812 <span class="preprocessor">                        (((    (at))&gt;0.0) &amp;&amp; (!(RFLAG((alev), (ai),(aj),(ak),mLevel[(alev)].setOther)&amp;(CFInter|CFFluid|CFGrCoarseInited) ))) ){ \</span>
<a name="l00813"></a>00813 <span class="preprocessor">                    errMsg(&quot;INVFLAGCINTCHECK&quot;, &quot; l&quot;&lt;&lt;(alev)&lt;&lt;&quot; at:&quot;&lt;&lt;(at)&lt;&lt;&quot; &quot;&lt;&lt;PRINT_VEC((ai),(aj),(ak))&lt;&lt;\</span>
<a name="l00814"></a>00814 <span class="preprocessor">                            &quot; fc:&quot;&lt;&lt;   convertCellFlagType2String(RFLAG((alev), (ai),(aj),(ak),mLevel[(alev)].setCurr  )) &lt;&lt;\</span>
<a name="l00815"></a>00815 <span class="preprocessor">                            &quot; fold:&quot;&lt;&lt; convertCellFlagType2String(RFLAG((alev), (ai),(aj),(ak),mLevel[(alev)].setOther )) ); \</span>
<a name="l00816"></a>00816 <span class="preprocessor">                    debugMarkCell((alev), (ai),(aj),(ak));\</span>
<a name="l00817"></a>00817 <span class="preprocessor">                    CAUSE_PANIC; \</span>
<a name="l00818"></a>00818 <span class="preprocessor">                }</span>
<a name="l00819"></a>00819 <span class="preprocessor"></span>                <span class="comment">// end ADD_INT_DFSCHECK</span>
<a name="l00820"></a>00820                 
<a name="l00821"></a>00821 <span class="preprocessor">#define INTUNUTCHECK(ix,iy,iz) \</span>
<a name="l00822"></a>00822 <span class="preprocessor">                if( (RFLAG(lev+1, (ix),(iy),(iz), mLevel[lev+1].setCurr) != (CFFluid|CFGrFromCoarse)) ){\</span>
<a name="l00823"></a>00823 <span class="preprocessor">                    errMsg(&quot;INTFLAGUNU_CHECK&quot;, PRINT_VEC(i,j,k)&lt;&lt;&quot; child not unused at l&quot;&lt;&lt;(lev+1)&lt;&lt;&quot; &quot;&lt;&lt;PRINT_VEC((ix),(iy),(iz))&lt;&lt;&quot; flag: &quot;&lt;&lt;  RFLAG(lev+1, (ix),(iy),(iz), mLevel[lev+1].setCurr) ); \</span>
<a name="l00824"></a>00824 <span class="preprocessor">                    debugMarkCell((lev+1), (ix),(iy),(iz));\</span>
<a name="l00825"></a>00825 <span class="preprocessor">                    CAUSE_PANIC; \</span>
<a name="l00826"></a>00826 <span class="preprocessor">                }\</span>
<a name="l00827"></a>00827 <span class="preprocessor">                RFLAG(lev+1, (ix),(iy),(iz), mLevel[lev+1].setCurr) |= CFGrCoarseInited; \</span>
<a name="l00828"></a>00828 <span class="preprocessor">                // INTUNUTCHECK </span>
<a name="l00829"></a>00829 <span class="preprocessor"></span><span class="preprocessor">#define INTSTRICTCHECK(ix,iy,iz,caseId) \</span>
<a name="l00830"></a>00830 <span class="preprocessor">                if( QCELL(lev+1, (ix),(iy),(iz), mLevel[lev+1].setCurr, l) &lt;= 0.0 ){\</span>
<a name="l00831"></a>00831 <span class="preprocessor">                    errMsg(&quot;INVDFCCELLCHECK&quot;, &quot;caseId:&quot;&lt;&lt;caseId&lt;&lt;&quot; &quot;&lt;&lt;PRINT_VEC(i,j,k)&lt;&lt;&quot; child inter at &quot;&lt;&lt;PRINT_VEC((ix),(iy),(iz))&lt;&lt;&quot; invalid df &quot;&lt;&lt;l&lt;&lt;&quot; = &quot;&lt;&lt; QCELL(lev+1, (ix),(iy),(iz), mLevel[lev+1].setCurr, l) ); \</span>
<a name="l00832"></a>00832 <span class="preprocessor">                    debugMarkCell((lev+1), (ix),(iy),(iz));\</span>
<a name="l00833"></a>00833 <span class="preprocessor">                    CAUSE_PANIC; \</span>
<a name="l00834"></a>00834 <span class="preprocessor">                }\</span>
<a name="l00835"></a>00835 <span class="preprocessor">                // INTSTRICTCHECK</span>
<a name="l00836"></a>00836 <span class="preprocessor"></span>
<a name="l00837"></a>00837 <span class="preprocessor">#else// FSGR_STRICT_DEBUG==1</span>
<a name="l00838"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a13dfbca2b05fc08299d002b26aee43bb">00838</a> <span class="preprocessor"></span><span class="preprocessor">#define ADD_INT_FLAGCHECK(alev, ai,aj,ak, at, afac) </span>
<a name="l00839"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#aacd0ad37f673775c193724215fb0abe3">00839</a> <span class="preprocessor"></span><span class="preprocessor">#define ADD_INT_DFSCHECK(alev, ai,aj,ak, at, afac, l) </span>
<a name="l00840"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#af86cb4b4bb620b26625d109023da28d4">00840</a> <span class="preprocessor"></span><span class="preprocessor">#define INTSTRICTCHECK(x,y,z,caseId) </span>
<a name="l00841"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a982d8320c0f024e215973160ad8e2fda">00841</a> <span class="preprocessor"></span><span class="preprocessor">#define INTUNUTCHECK(ix,iy,iz) </span>
<a name="l00842"></a>00842 <span class="preprocessor"></span><span class="preprocessor">#endif// FSGR_STRICT_DEBUG==1</span>
<a name="l00843"></a>00843 <span class="preprocessor"></span>
<a name="l00844"></a>00844 
<a name="l00845"></a>00845 <span class="preprocessor">#if FSGR_STRICT_DEBUG==1</span>
<a name="l00846"></a>00846 <span class="preprocessor"></span><span class="preprocessor">#define INTDEBOUT \</span>
<a name="l00847"></a>00847 <span class="preprocessor">        { </span><span class="comment">/*LbmFloat rho,ux,uy,uz;*/</span> \
<a name="l00848"></a>00848             rho = ux=uy=uz=0.0; \
<a name="l00849"></a>00849             FORDF0{ LbmFloat m = QCELL(lev,i,j,k, dstSet, l); \
<a name="l00850"></a>00850                 rho += m; ux  += (this-&gt;dfDvecX[l]*m); uy  += (this-&gt;dfDvecY[l]*m); uz  += (this-&gt;dfDvecZ[l]*m);  \
<a name="l00851"></a>00851                 if(ABS(m)&gt;1.0) { errMsg(&quot;interpolateCellFromCoarse&quot;, &quot;ICFC_DFCHECK cell  &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; m&quot;&lt;&lt;l&lt;&lt;&quot;:&quot;&lt;&lt; m );CAUSE_PANIC;}\
<a name="l00852"></a>00852                 <span class="comment">/*errMsg(&quot;interpolateCellFromCoarse&quot;, &quot; cell &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; df&quot;&lt;&lt;l&lt;&lt;&quot;:&quot;&lt;&lt;m );*/</span> \
<a name="l00853"></a>00853             }  \
<a name="l00854"></a>00854             <span class="comment">/*if(this-&gt;mPanic) { errMsg(&quot;interpolateCellFromCoarse&quot;, &quot;ICFC_DFOUT cell  &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; rho:&quot;&lt;&lt;rho&lt;&lt;&quot; u:&quot;&lt;&lt;PRINT_VEC(ux,uy,uz)&lt;&lt;&quot; b&quot;&lt;&lt;PRINT_VEC(betx,bety,betz) ); }*/</span> \
<a name="l00855"></a>00855             if(markNbs) errMsg(&quot;interpolateCellFromCoarse&quot;, &quot; cell &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; rho:&quot;&lt;&lt;rho&lt;&lt;&quot; u:&quot;&lt;&lt;PRINT_VEC(ux,uy,uz)&lt;&lt;&quot; b&quot;&lt;&lt;PRINT_VEC(betx,bety,betz) );  \
<a name="l00856"></a>00856             <span class="comment">/*errMsg(&quot;interpolateCellFromCoarse&quot;, &quot;ICFC_DFDEBUG cell  &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; rho:&quot;&lt;&lt;rho&lt;&lt;&quot; u:&quot;&lt;&lt;PRINT_VEC(ux,uy,uz)&lt;&lt;&quot; b&quot;&lt;&lt;PRINT_VEC(betx,bety,betz) ); */</span>\
<a name="l00857"></a>00857         } \
<a name="l00858"></a>00858         <span class="comment">/* both cases are ok to interpolate */</span>  \
<a name="l00859"></a>00859         if( (!(RFLAG(lev,i,j,k, dstSet) &amp; CFGrFromCoarse)) &amp;&amp;   \
<a name="l00860"></a>00860                 (!(RFLAG(lev,i,j,k, dstSet) &amp; CFUnused)) ) {    \
<a name="l00861"></a>00861             <span class="comment">/* might also have CFGrCoarseInited (shouldnt be a problem here)*/</span>  \
<a name="l00862"></a>00862             errMsg(&quot;interpolateCellFromCoarse&quot;, &quot;CHECK cell not CFGrFromCoarse? &quot;&lt;&lt;PRINT_IJK&lt;&lt;&quot; flag:&quot;&lt;&lt; RFLAG(lev,i,j,k, dstSet)&lt;&lt;&quot; fstr:&quot;&lt;&lt;convertCellFlagType2String(  RFLAG(lev,i,j,k, dstSet) ));  \
<a name="l00863"></a>00863             <span class="comment">/* FIXME check this warning...? return; this can happen !? */</span>   \
<a name="l00864"></a>00864             <span class="comment">/*CAUSE_PANIC;*/</span>    \
<a name="l00865"></a>00865         }   \
<a name="l00866"></a>00866         // end INTDEBOUT
<a name="l00867"></a>00867 <span class="preprocessor">#else // FSGR_STRICT_DEBUG==1</span>
<a name="l00868"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#ad4f62ed6f47b4d07a89b651d503f66c9">00868</a> <span class="preprocessor"></span><span class="preprocessor">#define INTDEBOUT </span>
<a name="l00869"></a>00869 <span class="preprocessor"></span><span class="preprocessor">#endif // FSGR_STRICT_DEBUG==1</span>
<a name="l00870"></a>00870 <span class="preprocessor"></span>
<a name="l00871"></a>00871     
<a name="l00872"></a>00872 <span class="comment">// t=0.0 -&gt; only current</span>
<a name="l00873"></a>00873 <span class="comment">// t=0.5 -&gt; mix</span>
<a name="l00874"></a>00874 <span class="comment">// t=1.0 -&gt; only other</span>
<a name="l00875"></a>00875 <span class="preprocessor">#if OPT3D==0 </span>
<a name="l00876"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#aac6dbf2f47fab0f073e12b19bf6e5913">00876</a> <span class="preprocessor"></span><span class="preprocessor">#define ADD_INT_DFS(alev, ai,aj,ak, at, afac) \</span>
<a name="l00877"></a>00877 <span class="preprocessor">                        ADD_INT_FLAGCHECK(alev, ai,aj,ak, at, afac); \</span>
<a name="l00878"></a>00878 <span class="preprocessor">                        FORDF0{ \</span>
<a name="l00879"></a>00879 <span class="preprocessor">                            LbmFloat df = ( \</span>
<a name="l00880"></a>00880 <span class="preprocessor">                                    QCELL((alev), (ai),(aj),(ak),mLevel[(alev)].setCurr , l)*(1.0-(at)) + \</span>
<a name="l00881"></a>00881 <span class="preprocessor">                                    QCELL((alev), (ai),(aj),(ak),mLevel[(alev)].setOther, l)*(    (at)) \</span>
<a name="l00882"></a>00882 <span class="preprocessor">                                    ) ; \</span>
<a name="l00883"></a>00883 <span class="preprocessor">                            ADD_INT_DFSCHECK(alev, ai,aj,ak, at, afac, l); \</span>
<a name="l00884"></a>00884 <span class="preprocessor">                            df *= (afac); \</span>
<a name="l00885"></a>00885 <span class="preprocessor">                            rho += df;  \</span>
<a name="l00886"></a>00886 <span class="preprocessor">                            ux  += (this-&gt;dfDvecX[l]*df);  \</span>
<a name="l00887"></a>00887 <span class="preprocessor">                            uy  += (this-&gt;dfDvecY[l]*df);   \</span>
<a name="l00888"></a>00888 <span class="preprocessor">                            uz  += (this-&gt;dfDvecZ[l]*df);   \</span>
<a name="l00889"></a>00889 <span class="preprocessor">                            intDf[l] += df; \</span>
<a name="l00890"></a>00890 <span class="preprocessor">                        } </span>
<a name="l00891"></a>00891 <span class="preprocessor"></span><span class="comment">// write interpolated dfs back to cell (correct non-eq. parts)</span>
<a name="l00892"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#aa5358572d55b3abbfdb7cb620b1feebc">00892</a> <span class="preprocessor">#define IDF_WRITEBACK_ \</span>
<a name="l00893"></a>00893 <span class="preprocessor">        FORDF0{ \</span>
<a name="l00894"></a>00894 <span class="preprocessor">            LbmFloat eq = getCollideEq(l, rho,ux,uy,uz);\</span>
<a name="l00895"></a>00895 <span class="preprocessor">            QCELL(lev,i,j,k, dstSet, l) = (eq+ (intDf[l]-eq)*mDfScaleDown);\</span>
<a name="l00896"></a>00896 <span class="preprocessor">        } \</span>
<a name="l00897"></a>00897 <span class="preprocessor">        </span><span class="comment">/* check that all values are ok */</span> \
<a name="l00898"></a>00898         INTDEBOUT
<a name="l00899"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a18c311f181e79d2df5383d81fa00cae0">00899</a> <span class="preprocessor">#define IDF_WRITEBACK \</span>
<a name="l00900"></a>00900 <span class="preprocessor">        LbmFloat omegaDst, omegaSrc;\</span>
<a name="l00901"></a>00901 <span class="preprocessor">        </span><span class="comment">/* smago new */</span> \
<a name="l00902"></a>00902         LbmFloat feq[LBM_DFNUM]; \
<a name="l00903"></a>00903         LbmFloat dfScale = mDfScaleDown; \
<a name="l00904"></a>00904         FORDF0{ \
<a name="l00905"></a>00905             feq[l] = getCollideEq(l, rho,ux,uy,uz); \
<a name="l00906"></a>00906         } \
<a name="l00907"></a>00907         if(mLevel[lev  ].lcsmago&gt;0.0) {\
<a name="l00908"></a>00908             LbmFloat Qo = this-&gt;getLesNoneqTensorCoeff(intDf,feq); \
<a name="l00909"></a>00909             omegaDst  = this-&gt;getLesOmega(mLevel[lev+0].omega,mLevel[lev+0].lcsmago,Qo); \
<a name="l00910"></a>00910             omegaSrc = this-&gt;getLesOmega(mLevel[lev-1].omega,mLevel[lev-1].lcsmago,Qo); \
<a name="l00911"></a>00911         } else {\
<a name="l00912"></a>00912             omegaDst = mLevel[lev+0].omega; \
<a name="l00913"></a>00913             omegaSrc = mLevel[lev-1].omega;\
<a name="l00914"></a>00914         } \
<a name="l00915"></a>00915          \
<a name="l00916"></a>00916         dfScale   = (mLevel[lev+0].timestep/mLevel[lev-1].timestep)* (1.0/omegaDst-1.0)/ (1.0/omegaSrc-1.0);  \
<a name="l00917"></a>00917         FORDF0{ \
<a name="l00918"></a>00918             <span class="comment">/*errMsg(&quot;SMAGO&quot;,&quot; org&quot;&lt;&lt;mDfScaleDown&lt;&lt;&quot; n&quot;&lt;&lt;dfScale&lt;&lt;&quot; qc&quot;&lt;&lt; QCELL(lev,i,j,k, dstSet, l)&lt;&lt;&quot; idf&quot;&lt;&lt;intDf[l]&lt;&lt;&quot; eq&quot;&lt;&lt;feq[l] ); */</span> \
<a name="l00919"></a>00919             QCELL(lev,i,j,k, dstSet, l) = (feq[l]+ (intDf[l]-feq[l])*dfScale);\
<a name="l00920"></a>00920         } \
<a name="l00921"></a>00921         <span class="comment">/* check that all values are ok */</span> \
<a name="l00922"></a>00922         INTDEBOUT
<a name="l00923"></a>00923 
<a name="l00924"></a>00924 <span class="preprocessor">#else //OPT3D==0 </span>
<a name="l00925"></a>00925 <span class="preprocessor"></span>
<a name="l00926"></a>00926 <span class="preprocessor">#define ADDALLVALS \</span>
<a name="l00927"></a>00927 <span class="preprocessor">    addVal = addDfFacT * RAC(addfcel , dC ); \</span>
<a name="l00928"></a>00928 <span class="preprocessor">                                            intDf[dC ] += addVal; rho += addVal; \</span>
<a name="l00929"></a>00929 <span class="preprocessor">    addVal  = addDfFacT * RAC(addfcel , dN ); \</span>
<a name="l00930"></a>00930 <span class="preprocessor">                 uy+=addVal;               intDf[dN ] += addVal; rho += addVal; \</span>
<a name="l00931"></a>00931 <span class="preprocessor">    addVal  = addDfFacT * RAC(addfcel , dS ); \</span>
<a name="l00932"></a>00932 <span class="preprocessor">                 uy-=addVal;               intDf[dS ] += addVal; rho += addVal; \</span>
<a name="l00933"></a>00933 <span class="preprocessor">    addVal  = addDfFacT * RAC(addfcel , dE ); \</span>
<a name="l00934"></a>00934 <span class="preprocessor">    ux+=addVal;                            intDf[dE ] += addVal; rho += addVal; \</span>
<a name="l00935"></a>00935 <span class="preprocessor">    addVal  = addDfFacT * RAC(addfcel , dW ); \</span>
<a name="l00936"></a>00936 <span class="preprocessor">    ux-=addVal;                            intDf[dW ] += addVal; rho += addVal; \</span>
<a name="l00937"></a>00937 <span class="preprocessor">    addVal  = addDfFacT * RAC(addfcel , dT ); \</span>
<a name="l00938"></a>00938 <span class="preprocessor">                              uz+=addVal;  intDf[dT ] += addVal; rho += addVal; \</span>
<a name="l00939"></a>00939 <span class="preprocessor">    addVal  = addDfFacT * RAC(addfcel , dB ); \</span>
<a name="l00940"></a>00940 <span class="preprocessor">                              uz-=addVal;  intDf[dB ] += addVal; rho += addVal; \</span>
<a name="l00941"></a>00941 <span class="preprocessor">    addVal  = addDfFacT * RAC(addfcel , dNE); \</span>
<a name="l00942"></a>00942 <span class="preprocessor">    ux+=addVal; uy+=addVal;               intDf[dNE] += addVal; rho += addVal; \</span>
<a name="l00943"></a>00943 <span class="preprocessor">    addVal  = addDfFacT * RAC(addfcel , dNW); \</span>
<a name="l00944"></a>00944 <span class="preprocessor">    ux-=addVal; uy+=addVal;               intDf[dNW] += addVal; rho += addVal; \</span>
<a name="l00945"></a>00945 <span class="preprocessor">    addVal  = addDfFacT * RAC(addfcel , dSE); \</span>
<a name="l00946"></a>00946 <span class="preprocessor">    ux+=addVal; uy-=addVal;               intDf[dSE] += addVal; rho += addVal; \</span>
<a name="l00947"></a>00947 <span class="preprocessor">    addVal  = addDfFacT * RAC(addfcel , dSW); \</span>
<a name="l00948"></a>00948 <span class="preprocessor">    ux-=addVal; uy-=addVal;               intDf[dSW] += addVal; rho += addVal; \</span>
<a name="l00949"></a>00949 <span class="preprocessor">    addVal  = addDfFacT * RAC(addfcel , dNT); \</span>
<a name="l00950"></a>00950 <span class="preprocessor">                 uy+=addVal; uz+=addVal;  intDf[dNT] += addVal; rho += addVal; \</span>
<a name="l00951"></a>00951 <span class="preprocessor">    addVal  = addDfFacT * RAC(addfcel , dNB); \</span>
<a name="l00952"></a>00952 <span class="preprocessor">                 uy+=addVal; uz-=addVal;  intDf[dNB] += addVal; rho += addVal; \</span>
<a name="l00953"></a>00953 <span class="preprocessor">    addVal  = addDfFacT * RAC(addfcel , dST); \</span>
<a name="l00954"></a>00954 <span class="preprocessor">                 uy-=addVal; uz+=addVal;  intDf[dST] += addVal; rho += addVal; \</span>
<a name="l00955"></a>00955 <span class="preprocessor">    addVal  = addDfFacT * RAC(addfcel , dSB); \</span>
<a name="l00956"></a>00956 <span class="preprocessor">                 uy-=addVal; uz-=addVal;  intDf[dSB] += addVal; rho += addVal; \</span>
<a name="l00957"></a>00957 <span class="preprocessor">    addVal  = addDfFacT * RAC(addfcel , dET); \</span>
<a name="l00958"></a>00958 <span class="preprocessor">    ux+=addVal;              uz+=addVal;  intDf[dET] += addVal; rho += addVal; \</span>
<a name="l00959"></a>00959 <span class="preprocessor">    addVal  = addDfFacT * RAC(addfcel , dEB); \</span>
<a name="l00960"></a>00960 <span class="preprocessor">    ux+=addVal;              uz-=addVal;  intDf[dEB] += addVal; rho += addVal; \</span>
<a name="l00961"></a>00961 <span class="preprocessor">    addVal  = addDfFacT * RAC(addfcel , dWT); \</span>
<a name="l00962"></a>00962 <span class="preprocessor">    ux-=addVal;              uz+=addVal;  intDf[dWT] += addVal; rho += addVal; \</span>
<a name="l00963"></a>00963 <span class="preprocessor">    addVal  = addDfFacT * RAC(addfcel , dWB); \</span>
<a name="l00964"></a>00964 <span class="preprocessor">    ux-=addVal;              uz-=addVal;  intDf[dWB] += addVal; rho += addVal; </span>
<a name="l00965"></a>00965 <span class="preprocessor"></span>
<a name="l00966"></a>00966 <span class="preprocessor">#define ADD_INT_DFS(alev, ai,aj,ak, at, afac) \</span>
<a name="l00967"></a>00967 <span class="preprocessor">    addDfFacT = at*afac; \</span>
<a name="l00968"></a>00968 <span class="preprocessor">    addfcel = RACPNT((alev), (ai),(aj),(ak),mLevel[(alev)].setOther); \</span>
<a name="l00969"></a>00969 <span class="preprocessor">    ADDALLVALS\</span>
<a name="l00970"></a>00970 <span class="preprocessor">    addDfFacT = (1.0-at)*afac; \</span>
<a name="l00971"></a>00971 <span class="preprocessor">    addfcel = RACPNT((alev), (ai),(aj),(ak),mLevel[(alev)].setCurr); \</span>
<a name="l00972"></a>00972 <span class="preprocessor">    ADDALLVALS</span>
<a name="l00973"></a>00973 <span class="preprocessor"></span>
<a name="l00974"></a>00974 <span class="comment">// also ugly...</span>
<a name="l00975"></a>00975 <span class="preprocessor">#define INTDF_C    intDf[dC ]</span>
<a name="l00976"></a>00976 <span class="preprocessor"></span><span class="preprocessor">#define INTDF_N    intDf[dN ]</span>
<a name="l00977"></a>00977 <span class="preprocessor"></span><span class="preprocessor">#define INTDF_S    intDf[dS ]</span>
<a name="l00978"></a>00978 <span class="preprocessor"></span><span class="preprocessor">#define INTDF_E    intDf[dE ]</span>
<a name="l00979"></a>00979 <span class="preprocessor"></span><span class="preprocessor">#define INTDF_W    intDf[dW ]</span>
<a name="l00980"></a>00980 <span class="preprocessor"></span><span class="preprocessor">#define INTDF_T    intDf[dT ]</span>
<a name="l00981"></a>00981 <span class="preprocessor"></span><span class="preprocessor">#define INTDF_B    intDf[dB ]</span>
<a name="l00982"></a>00982 <span class="preprocessor"></span><span class="preprocessor">#define INTDF_NE   intDf[dNE]</span>
<a name="l00983"></a>00983 <span class="preprocessor"></span><span class="preprocessor">#define INTDF_NW   intDf[dNW]</span>
<a name="l00984"></a>00984 <span class="preprocessor"></span><span class="preprocessor">#define INTDF_SE   intDf[dSE]</span>
<a name="l00985"></a>00985 <span class="preprocessor"></span><span class="preprocessor">#define INTDF_SW   intDf[dSW]</span>
<a name="l00986"></a>00986 <span class="preprocessor"></span><span class="preprocessor">#define INTDF_NT   intDf[dNT]</span>
<a name="l00987"></a>00987 <span class="preprocessor"></span><span class="preprocessor">#define INTDF_NB   intDf[dNB]</span>
<a name="l00988"></a>00988 <span class="preprocessor"></span><span class="preprocessor">#define INTDF_ST   intDf[dST]</span>
<a name="l00989"></a>00989 <span class="preprocessor"></span><span class="preprocessor">#define INTDF_SB   intDf[dSB]</span>
<a name="l00990"></a>00990 <span class="preprocessor"></span><span class="preprocessor">#define INTDF_ET   intDf[dET]</span>
<a name="l00991"></a>00991 <span class="preprocessor"></span><span class="preprocessor">#define INTDF_EB   intDf[dEB]</span>
<a name="l00992"></a>00992 <span class="preprocessor"></span><span class="preprocessor">#define INTDF_WT   intDf[dWT]</span>
<a name="l00993"></a>00993 <span class="preprocessor"></span><span class="preprocessor">#define INTDF_WB   intDf[dWB]</span>
<a name="l00994"></a>00994 <span class="preprocessor"></span>
<a name="l00995"></a>00995 
<a name="l00996"></a>00996 <span class="comment">// write interpolated dfs back to cell (correct non-eq. parts)</span>
<a name="l00997"></a>00997 <span class="preprocessor">#define IDF_WRITEBACK_LES \</span>
<a name="l00998"></a>00998 <span class="preprocessor">        dstcell = RACPNT(lev, i,j,k,dstSet); \</span>
<a name="l00999"></a>00999 <span class="preprocessor">        usqr = 1.5 * (ux*ux + uy*uy + uz*uz);  \</span>
<a name="l01000"></a>01000 <span class="preprocessor">        \</span>
<a name="l01001"></a>01001 <span class="preprocessor">        lcsmeq[dC] = EQC ; \</span>
<a name="l01002"></a>01002 <span class="preprocessor">        COLL_CALCULATE_DFEQ(lcsmeq); \</span>
<a name="l01003"></a>01003 <span class="preprocessor">        COLL_CALCULATE_NONEQTENSOR(lev, INTDF_ )\</span>
<a name="l01004"></a>01004 <span class="preprocessor">        COLL_CALCULATE_CSMOMEGAVAL(lev+0, lcsmDstOmega); \</span>
<a name="l01005"></a>01005 <span class="preprocessor">        COLL_CALCULATE_CSMOMEGAVAL(lev-1, lcsmSrcOmega); \</span>
<a name="l01006"></a>01006 <span class="preprocessor">        \</span>
<a name="l01007"></a>01007 <span class="preprocessor">        lcsmdfscale   = (mLevel[lev+0].timestep/mLevel[lev-1].timestep)* (1.0/lcsmDstOmega-1.0)/ (1.0/lcsmSrcOmega-1.0);  \</span>
<a name="l01008"></a>01008 <span class="preprocessor">        RAC(dstcell, dC ) = (lcsmeq[dC ] + (intDf[dC ]-lcsmeq[dC ] )*lcsmdfscale);\</span>
<a name="l01009"></a>01009 <span class="preprocessor">        RAC(dstcell, dN ) = (lcsmeq[dN ] + (intDf[dN ]-lcsmeq[dN ] )*lcsmdfscale);\</span>
<a name="l01010"></a>01010 <span class="preprocessor">        RAC(dstcell, dS ) = (lcsmeq[dS ] + (intDf[dS ]-lcsmeq[dS ] )*lcsmdfscale);\</span>
<a name="l01011"></a>01011 <span class="preprocessor">        RAC(dstcell, dE ) = (lcsmeq[dE ] + (intDf[dE ]-lcsmeq[dE ] )*lcsmdfscale);\</span>
<a name="l01012"></a>01012 <span class="preprocessor">        RAC(dstcell, dW ) = (lcsmeq[dW ] + (intDf[dW ]-lcsmeq[dW ] )*lcsmdfscale);\</span>
<a name="l01013"></a>01013 <span class="preprocessor">        RAC(dstcell, dT ) = (lcsmeq[dT ] + (intDf[dT ]-lcsmeq[dT ] )*lcsmdfscale);\</span>
<a name="l01014"></a>01014 <span class="preprocessor">        RAC(dstcell, dB ) = (lcsmeq[dB ] + (intDf[dB ]-lcsmeq[dB ] )*lcsmdfscale);\</span>
<a name="l01015"></a>01015 <span class="preprocessor">        RAC(dstcell, dNE) = (lcsmeq[dNE] + (intDf[dNE]-lcsmeq[dNE] )*lcsmdfscale);\</span>
<a name="l01016"></a>01016 <span class="preprocessor">        RAC(dstcell, dNW) = (lcsmeq[dNW] + (intDf[dNW]-lcsmeq[dNW] )*lcsmdfscale);\</span>
<a name="l01017"></a>01017 <span class="preprocessor">        RAC(dstcell, dSE) = (lcsmeq[dSE] + (intDf[dSE]-lcsmeq[dSE] )*lcsmdfscale);\</span>
<a name="l01018"></a>01018 <span class="preprocessor">        RAC(dstcell, dSW) = (lcsmeq[dSW] + (intDf[dSW]-lcsmeq[dSW] )*lcsmdfscale);\</span>
<a name="l01019"></a>01019 <span class="preprocessor">        RAC(dstcell, dNT) = (lcsmeq[dNT] + (intDf[dNT]-lcsmeq[dNT] )*lcsmdfscale);\</span>
<a name="l01020"></a>01020 <span class="preprocessor">        RAC(dstcell, dNB) = (lcsmeq[dNB] + (intDf[dNB]-lcsmeq[dNB] )*lcsmdfscale);\</span>
<a name="l01021"></a>01021 <span class="preprocessor">        RAC(dstcell, dST) = (lcsmeq[dST] + (intDf[dST]-lcsmeq[dST] )*lcsmdfscale);\</span>
<a name="l01022"></a>01022 <span class="preprocessor">        RAC(dstcell, dSB) = (lcsmeq[dSB] + (intDf[dSB]-lcsmeq[dSB] )*lcsmdfscale);\</span>
<a name="l01023"></a>01023 <span class="preprocessor">        RAC(dstcell, dET) = (lcsmeq[dET] + (intDf[dET]-lcsmeq[dET] )*lcsmdfscale);\</span>
<a name="l01024"></a>01024 <span class="preprocessor">        RAC(dstcell, dEB) = (lcsmeq[dEB] + (intDf[dEB]-lcsmeq[dEB] )*lcsmdfscale);\</span>
<a name="l01025"></a>01025 <span class="preprocessor">        RAC(dstcell, dWT) = (lcsmeq[dWT] + (intDf[dWT]-lcsmeq[dWT] )*lcsmdfscale);\</span>
<a name="l01026"></a>01026 <span class="preprocessor">        RAC(dstcell, dWB) = (lcsmeq[dWB] + (intDf[dWB]-lcsmeq[dWB] )*lcsmdfscale);\</span>
<a name="l01027"></a>01027 <span class="preprocessor">        </span><span class="comment">/* IDF_WRITEBACK optimized */</span>
<a name="l01028"></a>01028 
<a name="l01029"></a>01029 <span class="preprocessor">#define IDF_WRITEBACK_NOLES \</span>
<a name="l01030"></a>01030 <span class="preprocessor">        dstcell = RACPNT(lev, i,j,k,dstSet); \</span>
<a name="l01031"></a>01031 <span class="preprocessor">        usqr = 1.5 * (ux*ux + uy*uy + uz*uz);  \</span>
<a name="l01032"></a>01032 <span class="preprocessor">        \</span>
<a name="l01033"></a>01033 <span class="preprocessor">        RAC(dstcell, dC ) = (EQC  + (intDf[dC ]-EQC  )*mDfScaleDown);\</span>
<a name="l01034"></a>01034 <span class="preprocessor">        RAC(dstcell, dN ) = (EQN  + (intDf[dN ]-EQN  )*mDfScaleDown);\</span>
<a name="l01035"></a>01035 <span class="preprocessor">        RAC(dstcell, dS ) = (EQS  + (intDf[dS ]-EQS  )*mDfScaleDown);\</span>
<a name="l01036"></a>01036 <span class="preprocessor">        </span><span class="comment">/*old*/</span> RAC(dstcell, dE ) = (EQE  + (intDf[dE ]-EQE  )*mDfScaleDown);\
<a name="l01037"></a>01037         RAC(dstcell, dW ) = (EQW  + (intDf[dW ]-EQW  )*mDfScaleDown);\
<a name="l01038"></a>01038         RAC(dstcell, dT ) = (EQT  + (intDf[dT ]-EQT  )*mDfScaleDown);\
<a name="l01039"></a>01039         RAC(dstcell, dB ) = (EQB  + (intDf[dB ]-EQB  )*mDfScaleDown);\
<a name="l01040"></a>01040         <span class="comment">/*old*/</span> RAC(dstcell, dNE) = (EQNE + (intDf[dNE]-EQNE )*mDfScaleDown);\
<a name="l01041"></a>01041         RAC(dstcell, dNW) = (EQNW + (intDf[dNW]-EQNW )*mDfScaleDown);\
<a name="l01042"></a>01042         RAC(dstcell, dSE) = (EQSE + (intDf[dSE]-EQSE )*mDfScaleDown);\
<a name="l01043"></a>01043         RAC(dstcell, dSW) = (EQSW + (intDf[dSW]-EQSW )*mDfScaleDown);\
<a name="l01044"></a>01044         RAC(dstcell, dNT) = (EQNT + (intDf[dNT]-EQNT )*mDfScaleDown);\
<a name="l01045"></a>01045         RAC(dstcell, dNB) = (EQNB + (intDf[dNB]-EQNB )*mDfScaleDown);\
<a name="l01046"></a>01046         RAC(dstcell, dST) = (EQST + (intDf[dST]-EQST )*mDfScaleDown);\
<a name="l01047"></a>01047         RAC(dstcell, dSB) = (EQSB + (intDf[dSB]-EQSB )*mDfScaleDown);\
<a name="l01048"></a>01048         RAC(dstcell, dET) = (EQET + (intDf[dET]-EQET )*mDfScaleDown);\
<a name="l01049"></a>01049         <span class="comment">/*old*/</span> RAC(dstcell, dEB) = (EQEB + (intDf[dEB]-EQEB )*mDfScaleDown);\
<a name="l01050"></a>01050         RAC(dstcell, dWT) = (EQWT + (intDf[dWT]-EQWT )*mDfScaleDown);\
<a name="l01051"></a>01051         RAC(dstcell, dWB) = (EQWB + (intDf[dWB]-EQWB )*mDfScaleDown);\
<a name="l01052"></a>01052         <span class="comment">/* IDF_WRITEBACK optimized */</span>
<a name="l01053"></a>01053 
<a name="l01054"></a>01054 <span class="preprocessor">#if USE_LES==1</span>
<a name="l01055"></a>01055 <span class="preprocessor"></span><span class="preprocessor">#define IDF_WRITEBACK IDF_WRITEBACK_LES</span>
<a name="l01056"></a>01056 <span class="preprocessor"></span><span class="preprocessor">#else </span>
<a name="l01057"></a>01057 <span class="preprocessor"></span><span class="preprocessor">#define IDF_WRITEBACK IDF_WRITEBACK_NOLES</span>
<a name="l01058"></a>01058 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l01059"></a>01059 <span class="preprocessor"></span>
<a name="l01060"></a>01060 <span class="preprocessor">#endif// OPT3D==0 </span>
<a name="l01061"></a>01061 <span class="preprocessor"></span>
<a name="l01062"></a>01062 
<a name="l01063"></a>01063 
<a name="l01064"></a>01064 <span class="comment">/******************************************************************************/</span>
<a name="l01066"></a>01066 <span class="comment">/******************************************************************************/</span>
<a name="l01067"></a>01067 
<a name="l01068"></a>01068 
<a name="l01069"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aa41d1ea95667a655d2815455df964cdc">01069</a> <span class="keyword">inline</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aa41d1ea95667a655d2815455df964cdc">LbmFsgrSolver::getLesNoneqTensorCoeff</a>(
<a name="l01070"></a>01070         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> df[],              
<a name="l01071"></a>01071         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> feq[] ) {
<a name="l01072"></a>01072     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> Qo = 0.0;
<a name="l01073"></a>01073     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> m=0; m&lt; ((<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>*<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>)-<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>)/2 ; m++) { 
<a name="l01074"></a>01074         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> qadd = 0.0;
<a name="l01075"></a>01075         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l=1; l&lt;this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aadafa560920abba91bd5b0ca1c0c5b8e" title="size of a single set of distribution functions">cDfNum</a>; l++) { 
<a name="l01076"></a>01076             <span class="keywordflow">if</span>(this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aa6f23be7f20ebe749c64ad049d16bf31">lesCoeffOffdiag</a>[m][l]==0.0) <span class="keywordflow">continue</span>;
<a name="l01077"></a>01077             qadd += this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aa6f23be7f20ebe749c64ad049d16bf31">lesCoeffOffdiag</a>[m][l]*(df[l]-feq[l]);
<a name="l01078"></a>01078         }
<a name="l01079"></a>01079         Qo += (qadd*qadd);
<a name="l01080"></a>01080     }
<a name="l01081"></a>01081     Qo *= 2.0; <span class="comment">// off diag twice</span>
<a name="l01082"></a>01082     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> m=0; m&lt;<a class="code" href="../../d2/d3c/solver__interface_8h.html#af50003ba6592bac88481fa0fbcb1f512">LBMDIM</a>; m++) { 
<a name="l01083"></a>01083         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> qadd = 0.0;
<a name="l01084"></a>01084         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l=1; l&lt;this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aadafa560920abba91bd5b0ca1c0c5b8e" title="size of a single set of distribution functions">cDfNum</a>; l++) { 
<a name="l01085"></a>01085             <span class="keywordflow">if</span>(this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1f2cc9a7d3fb406276d961df9fa4b81a">lesCoeffDiag</a>[m][l]==0.0) <span class="keywordflow">continue</span>;
<a name="l01086"></a>01086             qadd += this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a1f2cc9a7d3fb406276d961df9fa4b81a">lesCoeffDiag</a>[m][l]*(df[l]-feq[l]);
<a name="l01087"></a>01087         }
<a name="l01088"></a>01088         Qo += (qadd*qadd);
<a name="l01089"></a>01089     }
<a name="l01090"></a>01090     Qo = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(Qo);
<a name="l01091"></a>01091     <span class="keywordflow">return</span> Qo;
<a name="l01092"></a>01092 };
<a name="l01093"></a>01093 
<a name="l01094"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ac8696739d80b280d9106e0edc1fd2491">01094</a> <span class="keyword">inline</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ac8696739d80b280d9106e0edc1fd2491">LbmFsgrSolver::getLesOmega</a>(<a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> omega, <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> csmago, <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> Qo) {
<a name="l01095"></a>01095     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> tau = 1.0/omega;
<a name="l01096"></a>01096     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> nu = (2.0*tau-1.0) * (1.0/6.0);
<a name="l01097"></a>01097     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> <a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a> = csmago;
<a name="l01098"></a>01098     <span class="keyword">const</span> <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> Csqr = C*<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>;
<a name="l01099"></a>01099     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> S = -nu + <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>( nu*nu + 18.0*Csqr*Qo ) / (6.0*Csqr);
<a name="l01100"></a>01100     <span class="keywordflow">return</span>( 1.0/( 3.0*( nu+Csqr*S ) +0.5 ) );
<a name="l01101"></a>01101 }
<a name="l01102"></a>01102 
<a name="l01103"></a><a class="code" href="../../d2/d75/solver__relax_8h.html#a306797b5aea8d3e8bf1fe132c7d9fe09">01103</a> <span class="preprocessor">#define DEBUG_CALCPRINTCELL(str,df) {\</span>
<a name="l01104"></a>01104 <span class="preprocessor">        LbmFloat prho=df[0], pux=0., puy=0., puz=0.; \</span>
<a name="l01105"></a>01105 <span class="preprocessor">        for(int dfl=1; dfl&lt;this-&gt;cDfNum; dfl++) { \</span>
<a name="l01106"></a>01106 <span class="preprocessor">            prho += df[dfl];  \</span>
<a name="l01107"></a>01107 <span class="preprocessor">            pux  += (this-&gt;dfDvecX[dfl]*df[dfl]);  \</span>
<a name="l01108"></a>01108 <span class="preprocessor">            puy  += (this-&gt;dfDvecY[dfl]*df[dfl]);  \</span>
<a name="l01109"></a>01109 <span class="preprocessor">            puz  += (this-&gt;dfDvecZ[dfl]*df[dfl]);  \</span>
<a name="l01110"></a>01110 <span class="preprocessor">        } \</span>
<a name="l01111"></a>01111 <span class="preprocessor">        errMsg(&quot;DEBUG_CALCPRINTCELL&quot;,&quot;&gt;&quot;&lt;&lt;str&lt;&lt;&quot; rho=&quot;&lt;&lt;prho&lt;&lt;&quot; vel=&quot;&lt;&lt;ntlVec3Gfx(pux,puy,puz) ); \</span>
<a name="l01112"></a>01112 <span class="preprocessor">    } </span><span class="comment">/* END DEBUG_CALCPRINTCELL */</span> 
<a name="l01113"></a>01113 
<a name="l01114"></a>01114 <span class="comment">// &quot;normal&quot; collision</span>
<a name="l01115"></a><a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a0c60b2c1cb1bc6319bd519ba9eb3f58b">01115</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a0c60b2c1cb1bc6319bd519ba9eb3f58b">LbmFsgrSolver::collideArrays</a>(
<a name="l01116"></a>01116         <span class="keywordtype">int</span> lev, <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="comment">// position - more for debugging</span>
<a name="l01117"></a>01117         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> df[],              
<a name="l01118"></a>01118         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> &amp;outrho, <span class="comment">// out only!</span>
<a name="l01119"></a>01119         <span class="comment">// velocity modifiers (returns actual velocity!)</span>
<a name="l01120"></a>01120         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> &amp;mux, <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> &amp;muy, <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> &amp;muz, 
<a name="l01121"></a>01121         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> omega, 
<a name="l01122"></a>01122         <a class="code" href="../../dc/d7e/classntlVector3Dim.html">LbmVec</a> gravity,
<a name="l01123"></a>01123         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> csmago, 
<a name="l01124"></a>01124         <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> *newOmegaRet, <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> *newQoRet
<a name="l01125"></a>01125     ) {
<a name="l01126"></a>01126     <span class="keywordtype">int</span> l;
<a name="l01127"></a>01127     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> rho=df[0]; 
<a name="l01128"></a>01128     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> ux = 0; <span class="comment">//mux;</span>
<a name="l01129"></a>01129     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> uy = 0; <span class="comment">//muy;</span>
<a name="l01130"></a>01130     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> uz = 0; <span class="comment">//muz; </span>
<a name="l01131"></a>01131     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> feq[19];
<a name="l01132"></a>01132     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> omegaNew;
<a name="l01133"></a>01133     <a class="code" href="../../d2/d3c/solver__interface_8h.html#af1e9e3e460c78fdb5e07e11cd7960a96">LbmFloat</a> Qo = 0.0;
<a name="l01134"></a>01134 
<a name="l01135"></a>01135     <span class="keywordflow">for</span>(l=1; l&lt;this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aadafa560920abba91bd5b0ca1c0c5b8e" title="size of a single set of distribution functions">cDfNum</a>; l++) { 
<a name="l01136"></a>01136         rho += df[l]; 
<a name="l01137"></a>01137         ux  += (this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a60d0590342236f7662405c849600f6fe">dfDvecX</a>[l]*df[l]); 
<a name="l01138"></a>01138         uy  += (this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a84d3dd485042513c646a2ad651a2c68c">dfDvecY</a>[l]*df[l]);  
<a name="l01139"></a>01139         uz  += (this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a99726a6439256ff33e2a6397e9de0ef9">dfDvecZ</a>[l]*df[l]);  
<a name="l01140"></a>01140     }  
<a name="l01141"></a>01141 
<a name="l01142"></a>01142 
<a name="l01143"></a>01143     <a class="code" href="../../d1/d7f/solver__control_8h.html#acecb7d0507e26fbd13cc8fed9ff97fd0">PRECOLLIDE_MODS</a>(rho,ux,uy,uz, gravity);
<a name="l01144"></a>01144     <span class="keywordflow">for</span>(l=0; l&lt;this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aadafa560920abba91bd5b0ca1c0c5b8e" title="size of a single set of distribution functions">cDfNum</a>; l++) { 
<a name="l01145"></a>01145         feq[l] = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#a25c5045bdb65c365067fbe6ca53a35a5">getCollideEq</a>(l,rho,ux,uy,uz); 
<a name="l01146"></a>01146     }
<a name="l01147"></a>01147 
<a name="l01148"></a>01148     <span class="keywordflow">if</span>(csmago&gt;0.0) {
<a name="l01149"></a>01149         Qo = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aa41d1ea95667a655d2815455df964cdc">getLesNoneqTensorCoeff</a>(df,feq);
<a name="l01150"></a>01150         omegaNew = <a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#ac8696739d80b280d9106e0edc1fd2491">getLesOmega</a>(omega,csmago,Qo);
<a name="l01151"></a>01151     } <span class="keywordflow">else</span> {
<a name="l01152"></a>01152         omegaNew = omega; <span class="comment">// smago off...</span>
<a name="l01153"></a>01153     }
<a name="l01154"></a>01154     <span class="keywordflow">if</span>(newOmegaRet) *newOmegaRet = omegaNew; <span class="comment">// return value for stats</span>
<a name="l01155"></a>01155     <span class="keywordflow">if</span>(newQoRet)    *newQoRet = Qo; <span class="comment">// return value of non-eq. stress tensor</span>
<a name="l01156"></a>01156 
<a name="l01157"></a>01157     <span class="keywordflow">for</span>(l=0; l&lt;this-&gt;<a class="code" href="../../d0/d4d/classLbmFsgrSolver.html#aadafa560920abba91bd5b0ca1c0c5b8e" title="size of a single set of distribution functions">cDfNum</a>; l++) { 
<a name="l01158"></a>01158         df[l] = (1.0-omegaNew ) * df[l] + omegaNew * feq[l]; 
<a name="l01159"></a>01159     }  
<a name="l01160"></a>01160     <span class="comment">//if((i==16)&amp;&amp;(j==10)) DEBUG_CALCPRINTCELL( &quot;2dcoll &quot;&lt;&lt;PRINT_IJK, df);</span>
<a name="l01161"></a>01161 
<a name="l01162"></a>01162     mux = ux;
<a name="l01163"></a>01163     muy = uy;
<a name="l01164"></a>01164     muz = uz;
<a name="l01165"></a>01165     outrho = rho;
<a name="l01166"></a>01166 
<a name="l01167"></a>01167     lev=i=j=k; <span class="comment">// debug, remove warnings</span>
<a name="l01168"></a>01168 };
<a name="l01169"></a>01169 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:56 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

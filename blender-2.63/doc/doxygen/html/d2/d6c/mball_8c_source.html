<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: mball.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">mball.c</div>  </div>
</div>
<div class="contents">
<a href="../../d2/d6c/mball_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * Contributor(s): Jiri Hnidek &lt;jiri.hnidek@vslib.cz&gt;.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * MetaBalls are created from a single Object (with a name without number in it),</span>
<a name="l00026"></a>00026 <span class="comment"> * here the DispList and BoundBox also is located.</span>
<a name="l00027"></a>00027 <span class="comment"> * All objects with the same name (but with a number in it) are added to this.</span>
<a name="l00028"></a>00028 <span class="comment"> *</span>
<a name="l00029"></a>00029 <span class="comment"> * texture coordinates are patched within the displist</span>
<a name="l00030"></a>00030 <span class="comment"> */</span>
<a name="l00031"></a>00031 
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;float.h&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../de/db2/DNA__material__types_8h.html">DNA_material_types.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d40/DNA__meta__types_8h.html">DNA_meta_types.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/dd1/BLI__bpath_8h.html">BLI_bpath.h</a>&quot;</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="comment">/*  #include &quot;BKE_object.h&quot; */</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d51/BKE__animsys_8h.html">BKE_animsys.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d53/BKE__scene_8h.html">BKE_scene.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/db1/BKE__library_8h.html">BKE_library.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d12/BKE__displist_8h.html" title="display list (or rather multi purpose list) stuff.">BKE_displist.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dae/BKE__mball_8h.html">BKE_mball.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dac/BKE__object_8h.html" title="General operations, lookup, etc. for blender objects.">BKE_object.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d0f/BKE__material_8h.html" title="General operations, lookup, etc. for materials.">BKE_material.h</a>&quot;</span>
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="comment">/* Global variables */</span>
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="../../d2/d6c/mball_8c.html#aac8fef4e3b3d833f16d5cef8ddce1ae1">00070</a> <span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../d2/d6c/mball_8c.html#aac8fef4e3b3d833f16d5cef8ddce1ae1">thresh</a>= 0.6f;
<a name="l00071"></a><a class="code" href="../../d2/d6c/mball_8c.html#a41d64e907d93a316f1b41e35cabf13c6">00071</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d6c/mball_8c.html#a41d64e907d93a316f1b41e35cabf13c6">totelem</a>=0;
<a name="l00072"></a><a class="code" href="../../d2/d6c/mball_8c.html#ac083af97a0e2aca7d8b37ed5ea31e886">00072</a> <span class="keyword">static</span> <a class="code" href="../../de/d87/structMetaElem.html">MetaElem</a> **<a class="code" href="../../d2/d6c/mball_8c.html#ac083af97a0e2aca7d8b37ed5ea31e886">mainb</a>;
<a name="l00073"></a><a class="code" href="../../d2/d6c/mball_8c.html#acec2c0ba5a0fe52bebb1b770e41d80be">00073</a> <span class="keyword">static</span> <a class="code" href="../../d7/d2f/structoctal__tree.html">octal_tree</a> *<a class="code" href="../../d2/d6c/mball_8c.html#acec2c0ba5a0fe52bebb1b770e41d80be">metaball_tree</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00074"></a>00074 <span class="comment">/* Functions */</span>
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="../../d2/d6c/mball_8c.html#a06253a5f76d0986fb691899dff6e3e50">00076</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#adcef353d2816fa71c8f99d184d93832e">unlink_mball</a>(<a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb)
<a name="l00077"></a>00077 {
<a name="l00078"></a>00078     <span class="keywordtype">int</span> a;
<a name="l00079"></a>00079     
<a name="l00080"></a>00080     <span class="keywordflow">for</span> (a=0; a&lt;mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ab8971ac14c6143431474bce14b1ea887">totcol</a>; a++) {
<a name="l00081"></a>00081         <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ae78577af3d79eea5d59be6f39a9c768d">mat</a>[a]) mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ae78577af3d79eea5d59be6f39a9c768d">mat</a>[a]-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--;
<a name="l00082"></a>00082         mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ae78577af3d79eea5d59be6f39a9c768d">mat</a>[a]= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00083"></a>00083     }
<a name="l00084"></a>00084 }
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 <span class="comment">/* do not free mball itself */</span>
<a name="l00088"></a><a class="code" href="../../d2/d6c/mball_8c.html#a0fa7fdd7bb258192aa0e6f589f0c626a">00088</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a64f5fea53ccafd0a745b5e10026a7192">free_mball</a>(<a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb)
<a name="l00089"></a>00089 {
<a name="l00090"></a>00090     <a class="code" href="../../df/dae/BKE__mball_8h.html#adcef353d2816fa71c8f99d184d93832e">unlink_mball</a>(mb);   
<a name="l00091"></a>00091     
<a name="l00092"></a>00092     <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad0590fb7ac842ab63fd568c1f393ebb0">adt</a>) {
<a name="l00093"></a>00093         <a class="code" href="../../dc/d51/BKE__animsys_8h.html#a186ce67df8bf9873cc945eed480eaa49">BKE_free_animdata</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)mb);
<a name="l00094"></a>00094         mb-&gt;adt = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00095"></a>00095     }
<a name="l00096"></a>00096     <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ae78577af3d79eea5d59be6f39a9c768d">mat</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ae78577af3d79eea5d59be6f39a9c768d">mat</a>);
<a name="l00097"></a>00097     <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac0ae3b2056b55f10f2bed774c5c30e7e">bb</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac0ae3b2056b55f10f2bed774c5c30e7e">bb</a>);
<a name="l00098"></a>00098     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a582b25f0c9cf3bfa16c4c2d1785f1233">elems</a>);
<a name="l00099"></a>00099     <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#aa6032a298ffca43c17d63ff15e200241">disp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) <a class="code" href="../../d9/d12/BKE__displist_8h.html#a561c3ea04fd61b48f782bfea0aae53ad">freedisplist</a>(&amp;mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#aa6032a298ffca43c17d63ff15e200241">disp</a>);
<a name="l00100"></a>00100 }
<a name="l00101"></a>00101 
<a name="l00102"></a><a class="code" href="../../d2/d6c/mball_8c.html#a59dd7629812ddf75c21786afa3e77e51">00102</a> <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *<a class="code" href="../../df/dae/BKE__mball_8h.html#a6c4328fd538ef1f410c53c83f7352c77">add_mball</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l00103"></a>00103 {
<a name="l00104"></a>00104     <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb;
<a name="l00105"></a>00105     
<a name="l00106"></a>00106     mb= <a class="code" href="../../d8/db1/BKE__library_8h.html#a0856c5e10e28cbe0b45eb00363bf8fb5">alloc_libblock</a>(&amp;<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;mball, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a3e4005eef9876a2cb9d799bdb2a43998">ID_MB</a>, name);
<a name="l00107"></a>00107     
<a name="l00108"></a>00108     mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a3198ab542f7285db71c8965aaffcf7db">size</a>[0]= mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a3198ab542f7285db71c8965aaffcf7db">size</a>[1]= mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a3198ab542f7285db71c8965aaffcf7db">size</a>[2]= 1.0;
<a name="l00109"></a>00109     mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#af8534cda4a48efd8faa6e66feaca4a0c">texflag</a>= <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a3ccdd66d2a569363df6bf2ea56c4c753">MB_AUTOSPACE</a>;
<a name="l00110"></a>00110     
<a name="l00111"></a>00111     mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#aca36a604480ad258251269df20713cb0">wiresize</a>= 0.4f;
<a name="l00112"></a>00112     mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a5e238e919345a3d9bd538c1ae368831b">rendersize</a>= 0.2f;
<a name="l00113"></a>00113     mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a1780a871c75eb9be17bcfd521c4b883d">thresh</a>= 0.6f;
<a name="l00114"></a>00114     
<a name="l00115"></a>00115     <span class="keywordflow">return</span> mb;
<a name="l00116"></a>00116 }
<a name="l00117"></a>00117 
<a name="l00118"></a><a class="code" href="../../d2/d6c/mball_8c.html#a0205acf9ccee229f028e810d103f6fa6">00118</a> <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *<a class="code" href="../../df/dae/BKE__mball_8h.html#a44de281996821f75fdbeb5283d7b0b30">copy_mball</a>(<a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb)
<a name="l00119"></a>00119 {
<a name="l00120"></a>00120     <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mbn;
<a name="l00121"></a>00121     <span class="keywordtype">int</span> a;
<a name="l00122"></a>00122     
<a name="l00123"></a>00123     mbn= <a class="code" href="../../d8/db1/BKE__library_8h.html#a0c0c1987364874c73cda326eace31efd">copy_libblock</a>(&amp;mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>);
<a name="l00124"></a>00124 
<a name="l00125"></a>00125     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#abc6ab715e5696ec3bb40014fc55182c6">BLI_duplicatelist</a>(&amp;mbn-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a582b25f0c9cf3bfa16c4c2d1785f1233">elems</a>, &amp;mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a582b25f0c9cf3bfa16c4c2d1785f1233">elems</a>);
<a name="l00126"></a>00126     
<a name="l00127"></a>00127     mbn-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ae78577af3d79eea5d59be6f39a9c768d">mat</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ae78577af3d79eea5d59be6f39a9c768d">mat</a>);
<a name="l00128"></a>00128     <span class="keywordflow">for</span> (a=0; a&lt;mbn-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ab8971ac14c6143431474bce14b1ea887">totcol</a>; a++) {
<a name="l00129"></a>00129         <a class="code" href="../../d8/db1/BKE__library_8h.html#a967d1ceef29b2612ef6e03194c512ad6">id_us_plus</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)mbn-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ae78577af3d79eea5d59be6f39a9c768d">mat</a>[a]);
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131     mbn-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac0ae3b2056b55f10f2bed774c5c30e7e">bb</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac0ae3b2056b55f10f2bed774c5c30e7e">bb</a>);
<a name="l00132"></a>00132 
<a name="l00133"></a>00133     mbn-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad613f238c10a857cb981c9963efc365a">editelems</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00134"></a>00134     mbn-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a0bc8bbba74fae4b63a7c91bdf6c63337">lastelem</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00135"></a>00135     
<a name="l00136"></a>00136     <span class="keywordflow">return</span> mbn;
<a name="l00137"></a>00137 }
<a name="l00138"></a>00138 
<a name="l00139"></a><a class="code" href="../../d2/d6c/mball_8c.html#aee571bc51156ba5d3bc3ca1b4f7f5b1c">00139</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d2/d6c/mball_8c.html#aee571bc51156ba5d3bc3ca1b4f7f5b1c">extern_local_mball</a>(<a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb)
<a name="l00140"></a>00140 {
<a name="l00141"></a>00141     <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ae78577af3d79eea5d59be6f39a9c768d">mat</a>) {
<a name="l00142"></a>00142         <a class="code" href="../../d4/d0f/BKE__material_8h.html#ace89d626579263a0cf9c248ede11b42e">extern_local_matarar</a>(mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ae78577af3d79eea5d59be6f39a9c768d">mat</a>, mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ab8971ac14c6143431474bce14b1ea887">totcol</a>);
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144 }
<a name="l00145"></a>00145 
<a name="l00146"></a><a class="code" href="../../d2/d6c/mball_8c.html#afe51eea7430e1ad2be34595be1ddd09f">00146</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#af5b14f9b5e694f1e8a7341af8d08d120">make_local_mball</a>(<a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb)
<a name="l00147"></a>00147 {
<a name="l00148"></a>00148     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main;
<a name="l00149"></a>00149     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l00150"></a>00150     <span class="keywordtype">int</span> is_local= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, is_lib= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00151"></a>00151 
<a name="l00152"></a>00152     <span class="comment">/* - only lib users: do nothing</span>
<a name="l00153"></a>00153 <span class="comment">     * - only local users: set flag</span>
<a name="l00154"></a>00154 <span class="comment">     * - mixed: make copy</span>
<a name="l00155"></a>00155 <span class="comment">     */</span>
<a name="l00156"></a>00156     
<a name="l00157"></a>00157     <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00158"></a>00158     <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>==1) {
<a name="l00159"></a>00159         <a class="code" href="../../d8/db1/BKE__library_8h.html#a668f0934d813d85c7920735e681fb2b1">id_clear_lib_data</a>(bmain, &amp;mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>);
<a name="l00160"></a>00160         <a class="code" href="../../d2/d6c/mball_8c.html#aee571bc51156ba5d3bc3ca1b4f7f5b1c">extern_local_mball</a>(mb);
<a name="l00161"></a>00161         
<a name="l00162"></a>00162         <span class="keywordflow">return</span>;
<a name="l00163"></a>00163     }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     <span class="keywordflow">for</span> (ob= <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;object.first; ob &amp;&amp; <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(0, is_lib, is_local); ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l00166"></a>00166         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a> == mb) {
<a name="l00167"></a>00167             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>) is_lib= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00168"></a>00168             <span class="keywordflow">else</span> is_local= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00169"></a>00169         }
<a name="l00170"></a>00170     }
<a name="l00171"></a>00171     
<a name="l00172"></a>00172     <span class="keywordflow">if</span> (is_local &amp;&amp; is_lib == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) {
<a name="l00173"></a>00173         <a class="code" href="../../d8/db1/BKE__library_8h.html#a668f0934d813d85c7920735e681fb2b1">id_clear_lib_data</a>(bmain, &amp;mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>);
<a name="l00174"></a>00174         <a class="code" href="../../d2/d6c/mball_8c.html#aee571bc51156ba5d3bc3ca1b4f7f5b1c">extern_local_mball</a>(mb);
<a name="l00175"></a>00175     }
<a name="l00176"></a>00176     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_local &amp;&amp; is_lib) {
<a name="l00177"></a>00177         <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb_new= <a class="code" href="../../df/dae/BKE__mball_8h.html#a44de281996821f75fdbeb5283d7b0b30">copy_mball</a>(mb);
<a name="l00178"></a>00178         mb_new-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>= 0;
<a name="l00179"></a>00179 
<a name="l00180"></a>00180         <span class="comment">/* Remap paths of new ID using old library as base. */</span>
<a name="l00181"></a>00181         <a class="code" href="../../d8/db1/BKE__library_8h.html#a28231f1e4d5edb6c8498db449bda4528">BKE_id_lib_local_paths</a>(bmain, mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, &amp;mb_new-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>);
<a name="l00182"></a>00182 
<a name="l00183"></a>00183         <span class="keywordflow">for</span> (ob= <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;object.first; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l00184"></a>00184             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a> == mb) {
<a name="l00185"></a>00185                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00186"></a>00186                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>= mb_new;
<a name="l00187"></a>00187                     mb_new-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>++;
<a name="l00188"></a>00188                     mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ac138c02c9b19c4c675e0a9c326e3417e">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--;
<a name="l00189"></a>00189                 }
<a name="l00190"></a>00190             }
<a name="l00191"></a>00191         }
<a name="l00192"></a>00192     }
<a name="l00193"></a>00193 }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 <span class="comment">/* most simple meta-element adding function</span>
<a name="l00196"></a>00196 <span class="comment"> * don&#39;t do context manipulation here (rna uses) */</span>
<a name="l00197"></a><a class="code" href="../../d2/d6c/mball_8c.html#a98e31cd34e68dbbc63a0f3b37b4c0be3">00197</a> <a class="code" href="../../de/d87/structMetaElem.html">MetaElem</a> *<a class="code" href="../../df/dae/BKE__mball_8h.html#aa53e9e10f79fcb5c25c87800bfcb7673">add_metaball_element</a>(<a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb, <span class="keyword">const</span> <span class="keywordtype">int</span> type)
<a name="l00198"></a>00198 {
<a name="l00199"></a>00199     <a class="code" href="../../de/d87/structMetaElem.html">MetaElem</a> *ml= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../de/d87/structMetaElem.html">MetaElem</a>), <span class="stringliteral">&quot;metaelem&quot;</span>);
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a66672ccf9e1308f3ba8c6b6f55fd2a8c">unit_qt</a>(ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a7c377daf6945c6efbba42dd0b89bd6e4">quat</a>);
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a>= 2.0;
<a name="l00204"></a>00204     ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#ab77dbffce529c16d46d8b202b2b535ca">s</a>= 2.0;
<a name="l00205"></a>00205     ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#afcd96395129ff8fdd4006c8ea5cb4915">flag</a>= <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#aad1557458d5997886054a40a75c6b1a0">MB_SCALE_RAD</a>;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207     <span class="keywordflow">switch</span>(type) {
<a name="l00208"></a>00208     <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a1589e65546da77af1d7050c8c69b8ae3">MB_BALL</a>:
<a name="l00209"></a>00209         ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a4522d9cfa0ff3307693b29f206a2dcc4">type</a> = <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a1589e65546da77af1d7050c8c69b8ae3">MB_BALL</a>;
<a name="l00210"></a>00210         ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>= ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>= ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a781a391ca94eb183538d95aa4b84cd0b">expz</a>= 1.0;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212         <span class="keywordflow">break</span>;
<a name="l00213"></a>00213     <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a24efce3a8a3a16764fcc1f5638e884a3">MB_TUBE</a>:
<a name="l00214"></a>00214         ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a4522d9cfa0ff3307693b29f206a2dcc4">type</a> = <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a24efce3a8a3a16764fcc1f5638e884a3">MB_TUBE</a>;
<a name="l00215"></a>00215         ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>= ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>= ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a781a391ca94eb183538d95aa4b84cd0b">expz</a>= 1.0;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217         <span class="keywordflow">break</span>;
<a name="l00218"></a>00218     <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#ac3b41055b5fa6e2ac4556241255a70de">MB_PLANE</a>:
<a name="l00219"></a>00219         ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a4522d9cfa0ff3307693b29f206a2dcc4">type</a> = <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#ac3b41055b5fa6e2ac4556241255a70de">MB_PLANE</a>;
<a name="l00220"></a>00220         ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>= ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>= ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a781a391ca94eb183538d95aa4b84cd0b">expz</a>= 1.0;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222         <span class="keywordflow">break</span>;
<a name="l00223"></a>00223     <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a66e16e57a590239af16fdaf958cc476a">MB_ELIPSOID</a>:
<a name="l00224"></a>00224         ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a4522d9cfa0ff3307693b29f206a2dcc4">type</a> = <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a66e16e57a590239af16fdaf958cc476a">MB_ELIPSOID</a>;
<a name="l00225"></a>00225         ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>= 1.2f;
<a name="l00226"></a>00226         ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>= 0.8f;
<a name="l00227"></a>00227         ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a781a391ca94eb183538d95aa4b84cd0b">expz</a>= 1.0;
<a name="l00228"></a>00228         
<a name="l00229"></a>00229         <span class="keywordflow">break</span>;
<a name="l00230"></a>00230     <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#af61a277733578a6e4e42e11ca6b30835">MB_CUBE</a>:
<a name="l00231"></a>00231         ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a4522d9cfa0ff3307693b29f206a2dcc4">type</a> = <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#af61a277733578a6e4e42e11ca6b30835">MB_CUBE</a>;
<a name="l00232"></a>00232         ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>= ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>= ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a781a391ca94eb183538d95aa4b84cd0b">expz</a>= 1.0;
<a name="l00233"></a>00233 
<a name="l00234"></a>00234         <span class="keywordflow">break</span>;
<a name="l00235"></a>00235     <span class="keywordflow">default</span>:
<a name="l00236"></a>00236         <span class="keywordflow">break</span>;
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a582b25f0c9cf3bfa16c4c2d1785f1233">elems</a>, ml);
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     <span class="keywordflow">return</span> ml;
<a name="l00242"></a>00242 }
<a name="l00249"></a><a class="code" href="../../d2/d6c/mball_8c.html#a5baf5d2d24e4916bd834e118effcd3a3">00249</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a8780cd0454bbccdf8ac3dd0feac14211">tex_space_mball</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l00250"></a>00250 {
<a name="l00251"></a>00251     <a class="code" href="../../d5/d2f/structDispList.html">DispList</a> *dl;
<a name="l00252"></a>00252     <a class="code" href="../../d3/d8a/structBoundBox.html">BoundBox</a> *bb;
<a name="l00253"></a>00253     <span class="keywordtype">float</span> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>[3], <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>[3] <span class="comment">/*, loc[3], size[3] */</span>;
<a name="l00254"></a>00254     <span class="keywordtype">int</span> tot, doit=0;
<a name="l00255"></a>00255 
<a name="l00256"></a>00256     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d3/d8a/structBoundBox.html">BoundBox</a>), <span class="stringliteral">&quot;mb boundbox&quot;</span>);
<a name="l00257"></a>00257     bb= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a>;
<a name="l00258"></a>00258     
<a name="l00259"></a>00259     <span class="comment">/* Weird one, this. */</span>
<a name="l00260"></a>00260 <span class="comment">/*      INIT_MINMAX(min, max); */</span>
<a name="l00261"></a>00261     (<a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>)[0]= (min)[1]= (<a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>)[2]= 1.0e30f;
<a name="l00262"></a>00262     (<a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>)[0]= (max)[1]= (<a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>)[2]= -1.0e30f;
<a name="l00263"></a>00263 
<a name="l00264"></a>00264     dl= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a45d11e4826c3a8ba292c91691bb2885d">disp</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00265"></a>00265     <span class="keywordflow">while</span> (dl) {
<a name="l00266"></a>00266         tot= dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>;
<a name="l00267"></a>00267         <span class="keywordflow">if</span> (tot) doit= 1;
<a name="l00268"></a>00268         data= dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>;
<a name="l00269"></a>00269         <span class="keywordflow">while</span> (tot--) {
<a name="l00270"></a>00270             <span class="comment">/* Also weird... but longer. From utildefines. */</span>
<a name="l00271"></a>00271             <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a56471388e0045022014f3a365af6b34a">DO_MINMAX</a>(data, min, max);
<a name="l00272"></a>00272             data+= 3;
<a name="l00273"></a>00273         }
<a name="l00274"></a>00274         dl= dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a902acb76b3f3a2b20b0c9f755c652bf9">next</a>;
<a name="l00275"></a>00275     }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277     <span class="keywordflow">if</span> (!doit) {
<a name="l00278"></a>00278         min[0] = min[1] = min[2] = -1.0f;
<a name="l00279"></a>00279         max[0] = max[1] = max[2] = 1.0f;
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281 <span class="preprocessor">#if 0</span>
<a name="l00282"></a>00282 <span class="preprocessor"></span>    loc[0]= (min[0]+max[0])/2.0f;
<a name="l00283"></a>00283     loc[1]= (min[1]+max[1])/2.0f;
<a name="l00284"></a>00284     loc[2]= (min[2]+max[2])/2.0f;
<a name="l00285"></a>00285     
<a name="l00286"></a>00286     <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>[0]= (max[0]-min[0])/2.0f;
<a name="l00287"></a>00287     <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>[1]= (max[1]-min[1])/2.0f;
<a name="l00288"></a>00288     <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>[2]= (max[2]-min[2])/2.0f;
<a name="l00289"></a>00289 <span class="preprocessor">#endif</span>
<a name="l00290"></a>00290 <span class="preprocessor"></span>    <a class="code" href="../../df/dac/BKE__object_8h.html#af195012a626e055e795867bdb53d2dd3">boundbox_set_from_min_max</a>(bb, min, max);
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00293"></a><a class="code" href="../../d2/d6c/mball_8c.html#ade3e34bc0cbf37cecffe4c0a5368959b">00293</a> <span class="keywordtype">float</span> *<a class="code" href="../../df/dae/BKE__mball_8h.html#a97c7a731502b6f63b5d2391345232dab">make_orco_mball</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *dispbase)
<a name="l00294"></a>00294 {
<a name="l00295"></a>00295     <a class="code" href="../../d3/d8a/structBoundBox.html">BoundBox</a> *bb;
<a name="l00296"></a>00296     <a class="code" href="../../d5/d2f/structDispList.html">DispList</a> *dl;
<a name="l00297"></a>00297     <span class="keywordtype">float</span> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>, *orco, *orcodata;
<a name="l00298"></a>00298     <span class="keywordtype">float</span> loc[3], <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>[3];
<a name="l00299"></a>00299     <span class="keywordtype">int</span> a;
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     <span class="comment">/* restore size and loc */</span>
<a name="l00302"></a>00302     bb= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a>;
<a name="l00303"></a>00303     loc[0]= (bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][0]+bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[4][0])/2.0f;
<a name="l00304"></a>00304     size[0]= bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[4][0]-loc[0];
<a name="l00305"></a>00305     loc[1]= (bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][1]+bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[2][1])/2.0f;
<a name="l00306"></a>00306     size[1]= bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[2][1]-loc[1];
<a name="l00307"></a>00307     loc[2]= (bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][2]+bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[1][2])/2.0f;
<a name="l00308"></a>00308     size[2]= bb-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[1][2]-loc[2];
<a name="l00309"></a>00309 
<a name="l00310"></a>00310     dl= dispbase-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00311"></a>00311     orcodata= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*3*dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>, <span class="stringliteral">&quot;MballOrco&quot;</span>);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     data= dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>;
<a name="l00314"></a>00314     orco= orcodata;
<a name="l00315"></a>00315     a= dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>;
<a name="l00316"></a>00316     <span class="keywordflow">while</span> (a--) {
<a name="l00317"></a>00317         orco[0]= (data[0]-loc[0])/size[0];
<a name="l00318"></a>00318         orco[1]= (data[1]-loc[1])/size[1];
<a name="l00319"></a>00319         orco[2]= (data[2]-loc[2])/size[2];
<a name="l00320"></a>00320 
<a name="l00321"></a>00321         data+= 3;
<a name="l00322"></a>00322         orco+= 3;
<a name="l00323"></a>00323     }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325     <span class="keywordflow">return</span> orcodata;
<a name="l00326"></a>00326 }
<a name="l00327"></a>00327 
<a name="l00328"></a>00328 <span class="comment">/* Note on mball basis stuff 2.5x (this is a can of worms)</span>
<a name="l00329"></a>00329 <span class="comment"> * This really needs a rewrite/refactor its totally broken in anything other then basic cases</span>
<a name="l00330"></a>00330 <span class="comment"> * Multiple Scenes + Set Scenes &amp; mixing mball basis SHOULD work but fails to update the depsgraph on rename</span>
<a name="l00331"></a>00331 <span class="comment"> * and linking into scenes or removal of basis mball. so take care when changing this code.</span>
<a name="l00332"></a>00332 <span class="comment"> * </span>
<a name="l00333"></a>00333 <span class="comment"> * Main idiot thing here is that the system returns find_basis_mball() objects which fail a is_basis_mball() test.</span>
<a name="l00334"></a>00334 <span class="comment"> *</span>
<a name="l00335"></a>00335 <span class="comment"> * Not only that but the depsgraph and their areas depend on this behavior!, so making small fixes here isn&#39;t worth it.</span>
<a name="l00336"></a>00336 <span class="comment"> * - Campbell</span>
<a name="l00337"></a>00337 <span class="comment"> */</span>
<a name="l00338"></a>00338 
<a name="l00339"></a>00339 
<a name="l00345"></a><a class="code" href="../../d2/d6c/mball_8c.html#abd69f236c9302c5407e9865fd4e88612">00345</a> <span class="keywordtype">int</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#ac35c80651b886132c4740f3296b84f0e" title="Test, if Object *ob is basic MetaBall.">is_basis_mball</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l00346"></a>00346 {
<a name="l00347"></a>00347     <span class="keywordtype">int</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l00348"></a>00348     
<a name="l00349"></a>00349     <span class="comment">/* just a quick test */</span>
<a name="l00350"></a>00350     len= <a class="code" href="../../d1/d22/stdosl_8h.html#af902ac638d8127503ad64a0eacb3a7e8">strlen</a>(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>);
<a name="l00351"></a>00351     <span class="keywordflow">if</span> ( isdigit(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>[len-1]) ) <span class="keywordflow">return</span> 0;
<a name="l00352"></a>00352     <span class="keywordflow">return</span> 1;
<a name="l00353"></a>00353 }
<a name="l00354"></a>00354 
<a name="l00355"></a>00355 <span class="comment">/* return nonzero if ob1 is a basis mball for ob */</span>
<a name="l00356"></a><a class="code" href="../../d2/d6c/mball_8c.html#aaf3f5a629669cd3203877580c1abf77a">00356</a> <span class="keywordtype">int</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#ac744037491db342a7d57af777777ca0f">is_mball_basis_for</a> (<a class="code" href="../../de/de7/structObject.html">Object</a> *ob1, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob2)
<a name="l00357"></a>00357 {
<a name="l00358"></a>00358     <span class="keywordtype">int</span> basis1nr, basis2nr;
<a name="l00359"></a>00359     <span class="keywordtype">char</span> basis1name[<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6d7bce2e9ad79af316c9690a5b84b75c">MAX_ID_NAME</a>], basis2name[<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6d7bce2e9ad79af316c9690a5b84b75c">MAX_ID_NAME</a>];
<a name="l00360"></a>00360 
<a name="l00361"></a>00361     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ad663a2d737c722b9567f70fb488036ad">BLI_split_name_num</a>(basis1name, &amp;basis1nr, ob1-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, <span class="charliteral">&#39;.&#39;</span>);
<a name="l00362"></a>00362     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ad663a2d737c722b9567f70fb488036ad">BLI_split_name_num</a>(basis2name, &amp;basis2nr, ob2-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, <span class="charliteral">&#39;.&#39;</span>);
<a name="l00363"></a>00363 
<a name="l00364"></a>00364     <span class="keywordflow">if</span> (!strcmp(basis1name, basis2name)) <span class="keywordflow">return</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#ac35c80651b886132c4740f3296b84f0e" title="Test, if Object *ob is basic MetaBall.">is_basis_mball</a>(ob1);
<a name="l00365"></a>00365     <span class="keywordflow">else</span> <span class="keywordflow">return</span> 0;
<a name="l00366"></a>00366 }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368 <span class="comment">/* \brief copy some properties from object to other metaball object with same base name</span>
<a name="l00369"></a>00369 <span class="comment"> *</span>
<a name="l00370"></a>00370 <span class="comment"> * When some properties (wiresize, threshold, update flags) of metaball are changed, then this properties</span>
<a name="l00371"></a>00371 <span class="comment"> * are copied to all metaballs in same &quot;group&quot; (metaballs with same base name: MBall,</span>
<a name="l00372"></a>00372 <span class="comment"> * MBall.001, MBall.002, etc). The most important is to copy properties to the base metaball,</span>
<a name="l00373"></a>00373 <span class="comment"> * because this metaball influence polygonisation of metaballs. */</span>
<a name="l00374"></a><a class="code" href="../../d2/d6c/mball_8c.html#a864204a2d757da9f930f1ce5b8d56518">00374</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#ae4938936704b15b17937e3a6b9146e5d">copy_mball_properties</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *active_object)
<a name="l00375"></a>00375 {
<a name="l00376"></a>00376     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce_iter= scene;
<a name="l00377"></a>00377     <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l00378"></a>00378     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l00379"></a>00379     <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *active_mball = (<a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a>*)active_object-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00380"></a>00380     <span class="keywordtype">int</span> basisnr, obnr;
<a name="l00381"></a>00381     <span class="keywordtype">char</span> basisname[<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6d7bce2e9ad79af316c9690a5b84b75c">MAX_ID_NAME</a>], obname[MAX_ID_NAME];
<a name="l00382"></a>00382     
<a name="l00383"></a>00383     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ad663a2d737c722b9567f70fb488036ad">BLI_split_name_num</a>(basisname, &amp;basisnr, active_object-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, <span class="charliteral">&#39;.&#39;</span>);
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     <span class="comment">/* XXX recursion check, see scene.c, just too simple code this next_object() */</span>
<a name="l00386"></a>00386     <span class="keywordflow">if</span> (<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a23288b0a29c27bdbd6455c9adcef89e6">F_ERROR</a>==<a class="code" href="../../d8/d53/BKE__scene_8h.html#aa1af4746ec37edeb9615a009f268ff41">next_object</a>(&amp;sce_iter, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
<a name="l00387"></a>00387         <span class="keywordflow">return</span>;
<a name="l00388"></a>00388     
<a name="l00389"></a>00389     <span class="keywordflow">while</span> (<a class="code" href="../../d8/d53/BKE__scene_8h.html#aa1af4746ec37edeb9615a009f268ff41">next_object</a>(&amp;sce_iter, 1, &amp;base, &amp;ob)) {
<a name="l00390"></a>00390         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a046d883c32490b5c5ca4c5e7b6504e35">OB_MBALL</a>) {
<a name="l00391"></a>00391             <span class="keywordflow">if</span> (ob != active_object) {
<a name="l00392"></a>00392                 <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ad663a2d737c722b9567f70fb488036ad">BLI_split_name_num</a>(obname, &amp;obnr, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, <span class="charliteral">&#39;.&#39;</span>);
<a name="l00393"></a>00393 
<a name="l00394"></a>00394                 <span class="comment">/* Object ob has to be in same &quot;group&quot; ... it means, that it has to have</span>
<a name="l00395"></a>00395 <span class="comment">                 * same base of its name */</span>
<a name="l00396"></a>00396                 <span class="keywordflow">if</span> (strcmp(obname, basisname)==0) {
<a name="l00397"></a>00397                     <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00398"></a>00398 
<a name="l00399"></a>00399                     <span class="comment">/* Copy properties from selected/edited metaball */</span>
<a name="l00400"></a>00400                     mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#aca36a604480ad258251269df20713cb0">wiresize</a>= active_mball-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#aca36a604480ad258251269df20713cb0">wiresize</a>;
<a name="l00401"></a>00401                     mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a5e238e919345a3d9bd538c1ae368831b">rendersize</a>= active_mball-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a5e238e919345a3d9bd538c1ae368831b">rendersize</a>;
<a name="l00402"></a>00402                     mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a1780a871c75eb9be17bcfd521c4b883d">thresh</a>= active_mball-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a1780a871c75eb9be17bcfd521c4b883d">thresh</a>;
<a name="l00403"></a>00403                     mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ab657cb372e8abbb7d367c101f3251de4">flag</a>= active_mball-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ab657cb372e8abbb7d367c101f3251de4">flag</a>;
<a name="l00404"></a>00404                 }
<a name="l00405"></a>00405             }
<a name="l00406"></a>00406         }
<a name="l00407"></a>00407     }
<a name="l00408"></a>00408 }
<a name="l00409"></a>00409 
<a name="l00419"></a><a class="code" href="../../d2/d6c/mball_8c.html#a062a03c59dffee7e4cff93926378e7f4">00419</a> <a class="code" href="../../de/de7/structObject.html">Object</a> *<a class="code" href="../../df/dae/BKE__mball_8h.html#acd6cd7889caaf039ef167e52af35639a" title="This function finds basic MetaBall.">find_basis_mball</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *basis)
<a name="l00420"></a>00420 {
<a name="l00421"></a>00421     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce_iter= scene;
<a name="l00422"></a>00422     <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l00423"></a>00423     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob,*bob= basis;
<a name="l00424"></a>00424     <a class="code" href="../../de/d87/structMetaElem.html">MetaElem</a> *ml=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00425"></a>00425     <span class="keywordtype">int</span> basisnr, obnr;
<a name="l00426"></a>00426     <span class="keywordtype">char</span> basisname[<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6d7bce2e9ad79af316c9690a5b84b75c">MAX_ID_NAME</a>], obname[<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6d7bce2e9ad79af316c9690a5b84b75c">MAX_ID_NAME</a>];
<a name="l00427"></a>00427 
<a name="l00428"></a>00428     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ad663a2d737c722b9567f70fb488036ad">BLI_split_name_num</a>(basisname, &amp;basisnr, basis-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, <span class="charliteral">&#39;.&#39;</span>);
<a name="l00429"></a>00429     <a class="code" href="../../d2/d6c/mball_8c.html#a41d64e907d93a316f1b41e35cabf13c6">totelem</a>= 0;
<a name="l00430"></a>00430 
<a name="l00431"></a>00431     <span class="comment">/* XXX recursion check, see scene.c, just too simple code this next_object() */</span>
<a name="l00432"></a>00432     <span class="keywordflow">if</span> (<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a23288b0a29c27bdbd6455c9adcef89e6">F_ERROR</a>==<a class="code" href="../../d8/d53/BKE__scene_8h.html#aa1af4746ec37edeb9615a009f268ff41">next_object</a>(&amp;sce_iter, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
<a name="l00433"></a>00433         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00434"></a>00434     
<a name="l00435"></a>00435     <span class="keywordflow">while</span> (<a class="code" href="../../d8/d53/BKE__scene_8h.html#aa1af4746ec37edeb9615a009f268ff41">next_object</a>(&amp;sce_iter, 1, &amp;base, &amp;ob)) {
<a name="l00436"></a>00436         
<a name="l00437"></a>00437         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a046d883c32490b5c5ca4c5e7b6504e35">OB_MBALL</a>) {
<a name="l00438"></a>00438             <span class="keywordflow">if</span> (ob==bob) {
<a name="l00439"></a>00439                 <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00440"></a>00440                 
<a name="l00441"></a>00441                 <span class="comment">/* if bob object is in edit mode, then dynamic list of all MetaElems</span>
<a name="l00442"></a>00442 <span class="comment">                 * is stored in editelems */</span>
<a name="l00443"></a>00443                 <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad613f238c10a857cb981c9963efc365a">editelems</a>) ml= mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad613f238c10a857cb981c9963efc365a">editelems</a>-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00444"></a>00444                 <span class="comment">/* if bob object is in object mode */</span>
<a name="l00445"></a>00445                 <span class="keywordflow">else</span> ml= mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a582b25f0c9cf3bfa16c4c2d1785f1233">elems</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00446"></a>00446             }
<a name="l00447"></a>00447             <span class="keywordflow">else</span> {
<a name="l00448"></a>00448                 <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ad663a2d737c722b9567f70fb488036ad">BLI_split_name_num</a>(obname, &amp;obnr, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, <span class="charliteral">&#39;.&#39;</span>);
<a name="l00449"></a>00449 
<a name="l00450"></a>00450                 <span class="comment">/* object ob has to be in same &quot;group&quot; ... it means, that it has to have</span>
<a name="l00451"></a>00451 <span class="comment">                 * same base of its name */</span>
<a name="l00452"></a>00452                 <span class="keywordflow">if</span> (strcmp(obname, basisname)==0) {
<a name="l00453"></a>00453                     <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00454"></a>00454                     
<a name="l00455"></a>00455                     <span class="comment">/* if object is in edit mode, then dynamic list of all MetaElems</span>
<a name="l00456"></a>00456 <span class="comment">                     * is stored in editelems */</span>
<a name="l00457"></a>00457                     <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad613f238c10a857cb981c9963efc365a">editelems</a>) ml= mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad613f238c10a857cb981c9963efc365a">editelems</a>-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00458"></a>00458                     <span class="comment">/* if bob object is in object mode */</span>
<a name="l00459"></a>00459                     <span class="keywordflow">else</span> ml= mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a582b25f0c9cf3bfa16c4c2d1785f1233">elems</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00460"></a>00460                     
<a name="l00461"></a>00461                     <span class="keywordflow">if</span> (obnr &lt; basisnr) {
<a name="l00462"></a>00462                         <span class="keywordflow">if</span> (!(ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4cb926ee8d882f0a18f0a2dbdea46e73">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ac31d50d415c660a44c0ccdc6b4854721">OB_FROMDUPLI</a>)) {
<a name="l00463"></a>00463                             basis= ob;
<a name="l00464"></a>00464                             basisnr= obnr;
<a name="l00465"></a>00465                         }
<a name="l00466"></a>00466                     }   
<a name="l00467"></a>00467                 }
<a name="l00468"></a>00468             }
<a name="l00469"></a>00469             
<a name="l00470"></a>00470             <span class="keywordflow">while</span> (ml) {
<a name="l00471"></a>00471                 <span class="keywordflow">if</span> (!(ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#afcd96395129ff8fdd4006c8ea5cb4915">flag</a> &amp; <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a69a6c2462f45d47e85bc9265c34f50f9">MB_HIDE</a>)) <a class="code" href="../../d2/d6c/mball_8c.html#a41d64e907d93a316f1b41e35cabf13c6">totelem</a>++;
<a name="l00472"></a>00472                 ml= ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a441cace5b6e487bfc3c2c29f3ab9e150">next</a>;
<a name="l00473"></a>00473             }
<a name="l00474"></a>00474         }
<a name="l00475"></a>00475     }
<a name="l00476"></a>00476 
<a name="l00477"></a>00477     <span class="keywordflow">return</span> basis;
<a name="l00478"></a>00478 }
<a name="l00479"></a>00479 
<a name="l00480"></a>00480 
<a name="l00481"></a>00481 <span class="comment">/* ******************** ARITH ************************* */</span>
<a name="l00482"></a>00482 
<a name="l00483"></a>00483 <span class="comment">/* BASED AT CODE (but mostly rewritten) :</span>
<a name="l00484"></a>00484 <span class="comment"> * C code from the article</span>
<a name="l00485"></a>00485 <span class="comment"> * &quot;An Implicit Surface Polygonizer&quot;</span>
<a name="l00486"></a>00486 <span class="comment"> * by Jules Bloomenthal, jbloom@beauty.gmu.edu</span>
<a name="l00487"></a>00487 <span class="comment"> * in &quot;Graphics Gems IV&quot;, Academic Press, 1994</span>
<a name="l00488"></a>00488 <span class="comment"> *</span>
<a name="l00489"></a>00489 <span class="comment"> * Authored by Jules Bloomenthal, Xerox PARC.</span>
<a name="l00490"></a>00490 <span class="comment"> * Copyright (c) Xerox Corporation, 1991.  All rights reserved.</span>
<a name="l00491"></a>00491 <span class="comment"> * Permission is granted to reproduce, use and distribute this code for</span>
<a name="l00492"></a>00492 <span class="comment"> * any and all purposes, provided that this notice appears in all copies. */</span>
<a name="l00493"></a>00493 
<a name="l00494"></a><a class="code" href="../../d2/d6c/mball_8c.html#a65b26605d90a0bcd0e13e05db54f551f">00494</a> <span class="preprocessor">#define RES 12 </span><span class="comment">/* # converge iterations    */</span>
<a name="l00495"></a>00495 
<a name="l00496"></a><a class="code" href="../../d2/d6c/mball_8c.html#aa73214aa5f2f94f63d90bb4e3d99fe53">00496</a> <span class="preprocessor">#define L   0  </span><span class="comment">/* left direction:   -x, -i */</span>
<a name="l00497"></a><a class="code" href="../../d2/d6c/mball_8c.html#a5c71a5e59a53413cd6c270266d63b031">00497</a> <span class="preprocessor">#define R   1  </span><span class="comment">/* right direction:  +x, +i */</span>
<a name="l00498"></a><a class="code" href="../../d2/d6c/mball_8c.html#a111da81ae5883147168bbb8366377b10">00498</a> <span class="preprocessor">#define B   2  </span><span class="comment">/* bottom direction: -y, -j */</span>
<a name="l00499"></a><a class="code" href="../../d2/d6c/mball_8c.html#a0acb682b8260ab1c60b918599864e2e5">00499</a> <span class="preprocessor">#define T   3  </span><span class="comment">/* top direction:    +y, +j */</span>
<a name="l00500"></a><a class="code" href="../../d2/d6c/mball_8c.html#a0240ac851181b84ac374872dc5434ee4">00500</a> <span class="preprocessor">#define N   4  </span><span class="comment">/* near direction:   -z, -k */</span>
<a name="l00501"></a><a class="code" href="../../d2/d6c/mball_8c.html#a42257a545daf5b7933d6e8f96adc74f2">00501</a> <span class="preprocessor">#define F   5  </span><span class="comment">/* far direction:    +z, +k */</span>
<a name="l00502"></a><a class="code" href="../../d2/d6c/mball_8c.html#aa749e5cf7139dc97361e975f13e467a2">00502</a> <span class="preprocessor">#define LBN 0  </span><span class="comment">/* left bottom near corner  */</span>
<a name="l00503"></a><a class="code" href="../../d2/d6c/mball_8c.html#a9a88665e307459c076b93109741d973f">00503</a> <span class="preprocessor">#define LBF 1  </span><span class="comment">/* left bottom far corner   */</span>
<a name="l00504"></a><a class="code" href="../../d2/d6c/mball_8c.html#a586f695dc09fe7822e51d8d06f905be8">00504</a> <span class="preprocessor">#define LTN 2  </span><span class="comment">/* left top near corner     */</span>
<a name="l00505"></a><a class="code" href="../../d2/d6c/mball_8c.html#a836d252087ebe4128fc3dccd9830e181">00505</a> <span class="preprocessor">#define LTF 3  </span><span class="comment">/* left top far corner      */</span>
<a name="l00506"></a><a class="code" href="../../d2/d6c/mball_8c.html#a3fae26a43a83ee9c2a9c468d3fe22621">00506</a> <span class="preprocessor">#define RBN 4  </span><span class="comment">/* right bottom near corner */</span>
<a name="l00507"></a><a class="code" href="../../d2/d6c/mball_8c.html#abae7fd1d616531c926f64eb405fe6c48">00507</a> <span class="preprocessor">#define RBF 5  </span><span class="comment">/* right bottom far corner  */</span>
<a name="l00508"></a><a class="code" href="../../d2/d6c/mball_8c.html#a098fafd7946985437f25577c38fcb9f4">00508</a> <span class="preprocessor">#define RTN 6  </span><span class="comment">/* right top near corner    */</span>
<a name="l00509"></a><a class="code" href="../../d2/d6c/mball_8c.html#a4763592545b4347769e93323316b7d89">00509</a> <span class="preprocessor">#define RTF 7  </span><span class="comment">/* right top far corner     */</span>
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 <span class="comment">/* the LBN corner of cube (i, j, k), corresponds with location</span>
<a name="l00512"></a>00512 <span class="comment"> * (i-0.5)*size, (j-0.5)*size, (k-0.5)*size) */</span>
<a name="l00513"></a>00513 
<a name="l00514"></a><a class="code" href="../../d2/d6c/mball_8c.html#a32cbe72c305705149c8689e80e80aa50">00514</a> <span class="preprocessor">#define HASHBIT     (5)</span>
<a name="l00515"></a><a class="code" href="../../d2/d6c/mball_8c.html#a2b4054af9a8f1ec4104846747ded1675">00515</a> <span class="preprocessor"></span><span class="preprocessor">#define HASHSIZE    (size_t)(1&lt;&lt;(3*HASHBIT))   </span>
<a name="l00517"></a><a class="code" href="../../d2/d6c/mball_8c.html#a87a01b7715b9a07056ea603a4f7abad0">00517</a> <span class="preprocessor">#define HASH(i,j,k) ((((( (i) &amp; 31)&lt;&lt;5) | ( (j) &amp; 31))&lt;&lt;5 ) | ( (k) &amp; 31) )</span>
<a name="l00518"></a>00518 <span class="preprocessor"></span>
<a name="l00519"></a><a class="code" href="../../d2/d6c/mball_8c.html#abeee01da3e6b645a8d4c3513f4d4a7dd">00519</a> <span class="preprocessor">#define MB_BIT(i, bit) (((i)&gt;&gt;(bit))&amp;1)</span>
<a name="l00520"></a><a class="code" href="../../d2/d6c/mball_8c.html#abcd6f1a5d0984973deec18bafcbd8d10">00520</a> <span class="preprocessor"></span><span class="preprocessor">#define FLIP(i,bit) ((i)^1&lt;&lt;(bit)) </span><span class="comment">/* flip the given bit of i */</span>
<a name="l00521"></a>00521 
<a name="l00522"></a>00522 
<a name="l00523"></a>00523 <span class="comment">/* **************** POLYGONIZATION ************************ */</span>
<a name="l00524"></a>00524 
<a name="l00525"></a><a class="code" href="../../d2/d6c/mball_8c.html#a2202b4f9ea0b564c71a2ae55310d2ef5">00525</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#aa628449644542b634b63c99f8fa8271f">calc_mballco</a>(<a class="code" href="../../de/d87/structMetaElem.html">MetaElem</a> *ml, <span class="keywordtype">float</span> vec[3])
<a name="l00526"></a>00526 {
<a name="l00527"></a>00527     <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#aadba09bfcf67a62add6f3e2c9d7a54ab">mat</a>) {
<a name="l00528"></a>00528         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>((<span class="keywordtype">float</span> (*)[4])ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#aadba09bfcf67a62add6f3e2c9d7a54ab">mat</a>, vec);
<a name="l00529"></a>00529     }
<a name="l00530"></a>00530 }
<a name="l00531"></a>00531 
<a name="l00532"></a><a class="code" href="../../d2/d6c/mball_8c.html#a8b3587b294df57497dd07e57e12856f8">00532</a> <span class="keywordtype">float</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a260394c8885690732c62b09344038b4d">densfunc</a>(<a class="code" href="../../de/d87/structMetaElem.html">MetaElem</a> *ball, <span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keywordtype">float</span> z)
<a name="l00533"></a>00533 {
<a name="l00534"></a>00534     <span class="keywordtype">float</span> dist2 = 0.0, dx, dy, dz;
<a name="l00535"></a>00535     <span class="keywordtype">float</span> vec[3];
<a name="l00536"></a>00536 
<a name="l00537"></a>00537     vec[0]= x;
<a name="l00538"></a>00538     vec[1]= y;
<a name="l00539"></a>00539     vec[2]= z;
<a name="l00540"></a>00540     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>((<span class="keywordtype">float</span> (*)[4])ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a334b0071cf58c79064166b79409a9247">imat</a>, vec);
<a name="l00541"></a>00541     dx= vec[0];
<a name="l00542"></a>00542     dy= vec[1];
<a name="l00543"></a>00543     dz= vec[2];
<a name="l00544"></a>00544     
<a name="l00545"></a>00545     <span class="keywordflow">if</span> (ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a4522d9cfa0ff3307693b29f206a2dcc4">type</a>==<a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a1589e65546da77af1d7050c8c69b8ae3">MB_BALL</a>) {
<a name="l00546"></a>00546     }
<a name="l00547"></a>00547     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a4522d9cfa0ff3307693b29f206a2dcc4">type</a>==<a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a87c774d76cfb62d764212ffc7472577e">MB_TUBEX</a>) {
<a name="l00548"></a>00548         <span class="keywordflow">if</span> ( dx &gt; ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a9939a121953fb032eac30a9a5399e305">len</a>) dx-= ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a9939a121953fb032eac30a9a5399e305">len</a>;
<a name="l00549"></a>00549         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dx&lt; -ball-&gt;<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>) dx+= ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a9939a121953fb032eac30a9a5399e305">len</a>;
<a name="l00550"></a>00550         <span class="keywordflow">else</span> dx= 0.0;
<a name="l00551"></a>00551     }
<a name="l00552"></a>00552     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a4522d9cfa0ff3307693b29f206a2dcc4">type</a>==<a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a3cc9c924ce0a5c2355bdafe1eb78e7ee">MB_TUBEY</a>) {
<a name="l00553"></a>00553         <span class="keywordflow">if</span> ( dy &gt; ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a9939a121953fb032eac30a9a5399e305">len</a>) dy-= ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a9939a121953fb032eac30a9a5399e305">len</a>;
<a name="l00554"></a>00554         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dy&lt; -ball-&gt;<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>) dy+= ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a9939a121953fb032eac30a9a5399e305">len</a>;
<a name="l00555"></a>00555         <span class="keywordflow">else</span> dy= 0.0;
<a name="l00556"></a>00556     }
<a name="l00557"></a>00557     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a4522d9cfa0ff3307693b29f206a2dcc4">type</a>==<a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a5a3261271d38cbe7437590a6fa43c051">MB_TUBEZ</a>) {
<a name="l00558"></a>00558         <span class="keywordflow">if</span> ( dz &gt; ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a9939a121953fb032eac30a9a5399e305">len</a>) dz-= ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a9939a121953fb032eac30a9a5399e305">len</a>;
<a name="l00559"></a>00559         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dz&lt; -ball-&gt;<a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>) dz+= ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a9939a121953fb032eac30a9a5399e305">len</a>;
<a name="l00560"></a>00560         <span class="keywordflow">else</span> dz= 0.0;
<a name="l00561"></a>00561     }
<a name="l00562"></a>00562     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a4522d9cfa0ff3307693b29f206a2dcc4">type</a>==<a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a24efce3a8a3a16764fcc1f5638e884a3">MB_TUBE</a>) {
<a name="l00563"></a>00563         <span class="keywordflow">if</span> ( dx &gt; ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>) dx-= ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>;
<a name="l00564"></a>00564         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dx&lt; -ball-&gt;expx) dx+= ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>;
<a name="l00565"></a>00565         <span class="keywordflow">else</span> dx= 0.0;
<a name="l00566"></a>00566     }
<a name="l00567"></a>00567     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a4522d9cfa0ff3307693b29f206a2dcc4">type</a>==<a class="code" href="../../d0/d40/DNA__meta__types_8h.html#ac3b41055b5fa6e2ac4556241255a70de">MB_PLANE</a>) {
<a name="l00568"></a>00568         <span class="keywordflow">if</span> ( dx &gt; ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>) dx-= ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>;
<a name="l00569"></a>00569         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dx&lt; -ball-&gt;expx) dx+= ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>;
<a name="l00570"></a>00570         <span class="keywordflow">else</span> dx= 0.0;
<a name="l00571"></a>00571         <span class="keywordflow">if</span> ( dy &gt; ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>) dy-= ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>;
<a name="l00572"></a>00572         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dy&lt; -ball-&gt;expy) dy+= ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>;
<a name="l00573"></a>00573         <span class="keywordflow">else</span> dy= 0.0;
<a name="l00574"></a>00574     }
<a name="l00575"></a>00575     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a4522d9cfa0ff3307693b29f206a2dcc4">type</a>==<a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a66e16e57a590239af16fdaf958cc476a">MB_ELIPSOID</a>) {
<a name="l00576"></a>00576         dx *= 1/ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>;
<a name="l00577"></a>00577         dy *= 1/ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>;
<a name="l00578"></a>00578         dz *= 1/ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a781a391ca94eb183538d95aa4b84cd0b">expz</a>;
<a name="l00579"></a>00579     }
<a name="l00580"></a>00580     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a4522d9cfa0ff3307693b29f206a2dcc4">type</a>==<a class="code" href="../../d0/d40/DNA__meta__types_8h.html#af61a277733578a6e4e42e11ca6b30835">MB_CUBE</a>) {
<a name="l00581"></a>00581         <span class="keywordflow">if</span> ( dx &gt; ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>) dx-= ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>;
<a name="l00582"></a>00582         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dx&lt; -ball-&gt;expx) dx+= ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>;
<a name="l00583"></a>00583         <span class="keywordflow">else</span> dx= 0.0;
<a name="l00584"></a>00584         <span class="keywordflow">if</span> ( dy &gt; ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>) dy-= ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>;
<a name="l00585"></a>00585         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dy&lt; -ball-&gt;expy) dy+= ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>;
<a name="l00586"></a>00586         <span class="keywordflow">else</span> dy= 0.0;
<a name="l00587"></a>00587         <span class="keywordflow">if</span> ( dz &gt; ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a781a391ca94eb183538d95aa4b84cd0b">expz</a>) dz-= ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a781a391ca94eb183538d95aa4b84cd0b">expz</a>;
<a name="l00588"></a>00588         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dz&lt; -ball-&gt;expz) dz+= ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a781a391ca94eb183538d95aa4b84cd0b">expz</a>;
<a name="l00589"></a>00589         <span class="keywordflow">else</span> dz= 0.0;
<a name="l00590"></a>00590     }
<a name="l00591"></a>00591 
<a name="l00592"></a>00592     dist2= (dx*dx + dy*dy + dz*dz);
<a name="l00593"></a>00593 
<a name="l00594"></a>00594     <span class="keywordflow">if</span> (ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#afcd96395129ff8fdd4006c8ea5cb4915">flag</a> &amp; <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a7cbd8ff38c4022078d47cee819de0639">MB_NEGATIVE</a>) {
<a name="l00595"></a>00595         dist2= 1.0f-(dist2/ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a88bbc436c1dc961ef4259896dbf892dc">rad2</a>);
<a name="l00596"></a>00596         <span class="keywordflow">if</span> (dist2 &lt; 0.0f) <span class="keywordflow">return</span> 0.5f;
<a name="l00597"></a>00597 
<a name="l00598"></a>00598         <span class="keywordflow">return</span> 0.5f-ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#ab77dbffce529c16d46d8b202b2b535ca">s</a>*dist2*dist2*dist2;
<a name="l00599"></a>00599     }
<a name="l00600"></a>00600     <span class="keywordflow">else</span> {
<a name="l00601"></a>00601         dist2= 1.0f-(dist2/ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a88bbc436c1dc961ef4259896dbf892dc">rad2</a>);
<a name="l00602"></a>00602         <span class="keywordflow">if</span> (dist2 &lt; 0.0f) <span class="keywordflow">return</span> -0.5f;
<a name="l00603"></a>00603 
<a name="l00604"></a>00604         <span class="keywordflow">return</span> ball-&gt;<a class="code" href="../../de/d87/structMetaElem.html#ab77dbffce529c16d46d8b202b2b535ca">s</a>*dist2*dist2*dist2 -0.5f;
<a name="l00605"></a>00605     }
<a name="l00606"></a>00606 }
<a name="l00607"></a>00607 
<a name="l00608"></a><a class="code" href="../../d2/d6c/mball_8c.html#a883725eac24fb2e6b8b8de66a938e29e">00608</a> <a class="code" href="../../d2/d6e/structoctal__node.html">octal_node</a>* <a class="code" href="../../df/dae/BKE__mball_8h.html#a883725eac24fb2e6b8b8de66a938e29e">find_metaball_octal_node</a>(<a class="code" href="../../d2/d6e/structoctal__node.html">octal_node</a> *node, <span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keywordtype">float</span> z, <span class="keywordtype">short</span> depth)
<a name="l00609"></a>00609 {
<a name="l00610"></a>00610     <span class="keywordflow">if</span> (!depth) <span class="keywordflow">return</span> node;
<a name="l00611"></a>00611     
<a name="l00612"></a>00612     <span class="keywordflow">if</span> (z &lt; node-&gt;z) {
<a name="l00613"></a>00613         <span class="keywordflow">if</span> (y &lt; node-&gt;y) {
<a name="l00614"></a>00614             <span class="keywordflow">if</span> (x &lt; node-&gt;x) {
<a name="l00615"></a>00615                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[0])
<a name="l00616"></a>00616                     <span class="keywordflow">return</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a883725eac24fb2e6b8b8de66a938e29e">find_metaball_octal_node</a>(node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[0],x,y,z,depth--);
<a name="l00617"></a>00617                 <span class="keywordflow">else</span>
<a name="l00618"></a>00618                     <span class="keywordflow">return</span> node;
<a name="l00619"></a>00619             }
<a name="l00620"></a>00620             <span class="keywordflow">else</span> {
<a name="l00621"></a>00621                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[1])
<a name="l00622"></a>00622                     <span class="keywordflow">return</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a883725eac24fb2e6b8b8de66a938e29e">find_metaball_octal_node</a>(node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[1],x,y,z,depth--);
<a name="l00623"></a>00623                 <span class="keywordflow">else</span>
<a name="l00624"></a>00624                     <span class="keywordflow">return</span> node;
<a name="l00625"></a>00625             }
<a name="l00626"></a>00626         }
<a name="l00627"></a>00627         <span class="keywordflow">else</span> {
<a name="l00628"></a>00628             <span class="keywordflow">if</span> (x &lt; node-&gt;x) {
<a name="l00629"></a>00629                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[3])
<a name="l00630"></a>00630                     <span class="keywordflow">return</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a883725eac24fb2e6b8b8de66a938e29e">find_metaball_octal_node</a>(node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[3],x,y,z,depth--);
<a name="l00631"></a>00631                 <span class="keywordflow">else</span>
<a name="l00632"></a>00632                     <span class="keywordflow">return</span> node;
<a name="l00633"></a>00633             }
<a name="l00634"></a>00634             <span class="keywordflow">else</span> {
<a name="l00635"></a>00635                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[2])
<a name="l00636"></a>00636                     <span class="keywordflow">return</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a883725eac24fb2e6b8b8de66a938e29e">find_metaball_octal_node</a>(node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[2],x,y,z,depth--);
<a name="l00637"></a>00637                 <span class="keywordflow">else</span>
<a name="l00638"></a>00638                     <span class="keywordflow">return</span> node;
<a name="l00639"></a>00639             }       
<a name="l00640"></a>00640         }
<a name="l00641"></a>00641     }
<a name="l00642"></a>00642     <span class="keywordflow">else</span> {
<a name="l00643"></a>00643         <span class="keywordflow">if</span> (y &lt; node-&gt;y) {
<a name="l00644"></a>00644             <span class="keywordflow">if</span> (x &lt; node-&gt;x) {
<a name="l00645"></a>00645                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[4])
<a name="l00646"></a>00646                     <span class="keywordflow">return</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a883725eac24fb2e6b8b8de66a938e29e">find_metaball_octal_node</a>(node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[4],x,y,z,depth--);
<a name="l00647"></a>00647                 <span class="keywordflow">else</span>
<a name="l00648"></a>00648                     <span class="keywordflow">return</span> node;
<a name="l00649"></a>00649             }
<a name="l00650"></a>00650             <span class="keywordflow">else</span> {
<a name="l00651"></a>00651                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[5])
<a name="l00652"></a>00652                     <span class="keywordflow">return</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a883725eac24fb2e6b8b8de66a938e29e">find_metaball_octal_node</a>(node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[5],x,y,z,depth--);
<a name="l00653"></a>00653                 <span class="keywordflow">else</span>
<a name="l00654"></a>00654                     <span class="keywordflow">return</span> node;
<a name="l00655"></a>00655             }
<a name="l00656"></a>00656         }
<a name="l00657"></a>00657         <span class="keywordflow">else</span> {
<a name="l00658"></a>00658             <span class="keywordflow">if</span> (x &lt; node-&gt;x) {
<a name="l00659"></a>00659                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[7])
<a name="l00660"></a>00660                     <span class="keywordflow">return</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a883725eac24fb2e6b8b8de66a938e29e">find_metaball_octal_node</a>(node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[7],x,y,z,depth--);
<a name="l00661"></a>00661                 <span class="keywordflow">else</span>
<a name="l00662"></a>00662                     <span class="keywordflow">return</span> node;
<a name="l00663"></a>00663             }
<a name="l00664"></a>00664             <span class="keywordflow">else</span> {
<a name="l00665"></a>00665                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[6])
<a name="l00666"></a>00666                     <span class="keywordflow">return</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a883725eac24fb2e6b8b8de66a938e29e">find_metaball_octal_node</a>(node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[6],x,y,z,depth--);
<a name="l00667"></a>00667                 <span class="keywordflow">else</span>
<a name="l00668"></a>00668                     <span class="keywordflow">return</span> node;
<a name="l00669"></a>00669             }       
<a name="l00670"></a>00670         }
<a name="l00671"></a>00671     }
<a name="l00672"></a>00672     
<a name="l00673"></a>00673     <span class="keywordflow">return</span> node;
<a name="l00674"></a>00674 }
<a name="l00675"></a>00675 
<a name="l00676"></a><a class="code" href="../../d2/d6c/mball_8c.html#ac6dac50283063cea1ce61ea4cc1138e9">00676</a> <span class="keywordtype">float</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#ac6dac50283063cea1ce61ea4cc1138e9">metaball</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keywordtype">float</span> z)
<a name="l00677"></a>00677 <span class="comment">/*  float x, y, z; */</span>
<a name="l00678"></a>00678 {
<a name="l00679"></a>00679     <span class="keyword">struct </span><a class="code" href="../../d2/d6e/structoctal__node.html">octal_node</a> *node;
<a name="l00680"></a>00680     <span class="keyword">struct </span><a class="code" href="../../d6/d47/structml__pointer.html">ml_pointer</a> *ml_p;
<a name="l00681"></a>00681     <span class="keywordtype">float</span> dens=0;
<a name="l00682"></a>00682     <span class="keywordtype">int</span> a;
<a name="l00683"></a>00683     
<a name="l00684"></a>00684     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d6c/mball_8c.html#a41d64e907d93a316f1b41e35cabf13c6">totelem</a> &gt; 1) {
<a name="l00685"></a>00685         node= <a class="code" href="../../df/dae/BKE__mball_8h.html#a883725eac24fb2e6b8b8de66a938e29e">find_metaball_octal_node</a>(metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a54ade2ba77049f66c0f5201963969ef2">first</a>, x, y, z, metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a150ef8e8ce4c75f8e21521c0f5b82999">depth</a>);
<a name="l00686"></a>00686         <span class="keywordflow">if</span> (node) {
<a name="l00687"></a>00687             ml_p= node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ac8a61207b7cc395ef46a127854c29d14">elems</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00688"></a>00688 
<a name="l00689"></a>00689             <span class="keywordflow">while</span> (ml_p) {
<a name="l00690"></a>00690                 dens+=<a class="code" href="../../df/dae/BKE__mball_8h.html#a260394c8885690732c62b09344038b4d">densfunc</a>(ml_p-&gt;<a class="code" href="../../d6/d47/structml__pointer.html#a2adf0b13dacfe243e0c56df2b12a7f3d">ml</a>, x, y, z);
<a name="l00691"></a>00691                 ml_p= ml_p-&gt;<a class="code" href="../../d6/d47/structml__pointer.html#a57ff7e964e98b65addd1599136e255b7">next</a>;
<a name="l00692"></a>00692             }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694             dens+= -0.5f*(metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a845afc2650e99ade973a2cc7436739fe">pos</a> - node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#aedee03fc529f0c15040d7bdebede8fd8">pos</a>);
<a name="l00695"></a>00695             dens+= 0.5f*(metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a4fd7e0c41041886c6adda2eacada83fc">neg</a> - node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ac3114daca6ce737316e2570b1fd52629">neg</a>);
<a name="l00696"></a>00696         }
<a name="l00697"></a>00697         <span class="keywordflow">else</span> {
<a name="l00698"></a>00698             <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d2/d6c/mball_8c.html#a41d64e907d93a316f1b41e35cabf13c6">totelem</a>; a++) {
<a name="l00699"></a>00699                 dens += <a class="code" href="../../df/dae/BKE__mball_8h.html#a260394c8885690732c62b09344038b4d">densfunc</a>(mainb[a], x, y, z);
<a name="l00700"></a>00700             }
<a name="l00701"></a>00701         }
<a name="l00702"></a>00702     }
<a name="l00703"></a>00703     <span class="keywordflow">else</span> {
<a name="l00704"></a>00704         dens += <a class="code" href="../../df/dae/BKE__mball_8h.html#a260394c8885690732c62b09344038b4d">densfunc</a>(mainb[0], x, y, z);
<a name="l00705"></a>00705     }
<a name="l00706"></a>00706 
<a name="l00707"></a>00707     <span class="keywordflow">return</span> <a class="code" href="../../d2/d6c/mball_8c.html#aac8fef4e3b3d833f16d5cef8ddce1ae1">thresh</a> - dens;
<a name="l00708"></a>00708 }
<a name="l00709"></a>00709 
<a name="l00710"></a>00710 <span class="comment">/* ******************************************** */</span>
<a name="l00711"></a>00711 
<a name="l00712"></a><a class="code" href="../../d2/d6c/mball_8c.html#a47e7cc913f2b356de088363a1d87db4a">00712</a> <span class="keyword">static</span> <span class="keywordtype">int</span> *<a class="code" href="../../d2/d6c/mball_8c.html#a47e7cc913f2b356de088363a1d87db4a">indices</a>=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00713"></a><a class="code" href="../../d2/d6c/mball_8c.html#a16996c17496386a947d510a19ad1facc">00713</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d6c/mball_8c.html#a16996c17496386a947d510a19ad1facc">totindex</a>, <a class="code" href="../../d2/d6c/mball_8c.html#aa0aed51016f3947bd4956c5742df8f20">curindex</a>;
<a name="l00714"></a>00714 
<a name="l00715"></a>00715 
<a name="l00716"></a><a class="code" href="../../d2/d6c/mball_8c.html#a67d4a23c050f08e42c426471ef8579be">00716</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a67d4a23c050f08e42c426471ef8579be">accum_mballfaces</a>(<span class="keywordtype">int</span> i1, <span class="keywordtype">int</span> i2, <span class="keywordtype">int</span> i3, <span class="keywordtype">int</span> i4)
<a name="l00717"></a>00717 {
<a name="l00718"></a>00718     <span class="keywordtype">int</span> *newi, *cur;
<a name="l00719"></a>00719     <span class="comment">/* static int i=0; I would like to delete altogether, but I don&#39;t dare to, yet */</span>
<a name="l00720"></a>00720 
<a name="l00721"></a>00721     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d6c/mball_8c.html#a16996c17496386a947d510a19ad1facc">totindex</a>==<a class="code" href="../../d2/d6c/mball_8c.html#aa0aed51016f3947bd4956c5742df8f20">curindex</a>) {
<a name="l00722"></a>00722         <a class="code" href="../../d2/d6c/mball_8c.html#a16996c17496386a947d510a19ad1facc">totindex</a>+= 256;
<a name="l00723"></a>00723         newi= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(4*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*<a class="code" href="../../d2/d6c/mball_8c.html#a16996c17496386a947d510a19ad1facc">totindex</a>, <span class="stringliteral">&quot;vertindex&quot;</span>);
<a name="l00724"></a>00724         
<a name="l00725"></a>00725         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d6c/mball_8c.html#a47e7cc913f2b356de088363a1d87db4a">indices</a>) {
<a name="l00726"></a>00726             memcpy(newi, <a class="code" href="../../d2/d6c/mball_8c.html#a47e7cc913f2b356de088363a1d87db4a">indices</a>, 4*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*(totindex-256));
<a name="l00727"></a>00727             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(<a class="code" href="../../d2/d6c/mball_8c.html#a47e7cc913f2b356de088363a1d87db4a">indices</a>);
<a name="l00728"></a>00728         }
<a name="l00729"></a>00729         <a class="code" href="../../d2/d6c/mball_8c.html#a47e7cc913f2b356de088363a1d87db4a">indices</a>= newi;
<a name="l00730"></a>00730     }
<a name="l00731"></a>00731     
<a name="l00732"></a>00732     cur= <a class="code" href="../../d2/d6c/mball_8c.html#a47e7cc913f2b356de088363a1d87db4a">indices</a>+4*<a class="code" href="../../d2/d6c/mball_8c.html#aa0aed51016f3947bd4956c5742df8f20">curindex</a>;
<a name="l00733"></a>00733 
<a name="l00734"></a>00734     <span class="comment">/* displists now support array drawing, we treat tri&#39;s as fake quad */</span>
<a name="l00735"></a>00735     
<a name="l00736"></a>00736     cur[0]= i1;
<a name="l00737"></a>00737     cur[1]= i2;
<a name="l00738"></a>00738     cur[2]= i3;
<a name="l00739"></a>00739     <span class="keywordflow">if</span> (i4==0)
<a name="l00740"></a>00740         cur[3]= i3;
<a name="l00741"></a>00741     <span class="keywordflow">else</span> 
<a name="l00742"></a>00742         cur[3]= i4;
<a name="l00743"></a>00743     
<a name="l00744"></a>00744     curindex++;
<a name="l00745"></a>00745 
<a name="l00746"></a>00746 }
<a name="l00747"></a>00747 
<a name="l00748"></a>00748 <span class="comment">/* ******************* MEMORY MANAGEMENT *********************** */</span>
<a name="l00749"></a><a class="code" href="../../d2/d6c/mball_8c.html#a96110050b671393c3c26e7ddc3a25286">00749</a> <span class="keywordtype">void</span> *<a class="code" href="../../df/dae/BKE__mball_8h.html#a96110050b671393c3c26e7ddc3a25286">new_pgn_element</a>(<span class="keywordtype">int</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>)
<a name="l00750"></a>00750 {
<a name="l00751"></a>00751     <span class="comment">/* during polygonize 1000s of elements are allocated</span>
<a name="l00752"></a>00752 <span class="comment">     * and never freed in between. Freeing only done at the end.</span>
<a name="l00753"></a>00753 <span class="comment">     */</span>
<a name="l00754"></a>00754     <span class="keywordtype">int</span> blocksize= 16384;
<a name="l00755"></a>00755     <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d35/meshtools_8c.html#a95306f188b8885dc64be154d19f1232c">offs</a>= 0;     <span class="comment">/* the current free address */</span>
<a name="l00756"></a>00756     <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d3/de5/structpgn__elements.html">pgn_elements</a> *cur= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00757"></a>00757     <span class="keyword">static</span> <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> lb= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00758"></a>00758     <span class="keywordtype">void</span> *adr;
<a name="l00759"></a>00759     
<a name="l00760"></a>00760     <span class="keywordflow">if</span> (size&gt;10000 || size==0) {
<a name="l00761"></a>00761         printf(<span class="stringliteral">&quot;incorrect use of new_pgn_element\n&quot;</span>);
<a name="l00762"></a>00762     }
<a name="l00763"></a>00763     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (size== -1) {
<a name="l00764"></a>00764         cur= lb.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00765"></a>00765         <span class="keywordflow">while</span> (cur) {
<a name="l00766"></a>00766             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cur-&gt;<a class="code" href="../../d3/de5/structpgn__elements.html#a05dc2d4e786d97ebf0d93f0b6bff716d">data</a>);
<a name="l00767"></a>00767             cur= cur-&gt;<a class="code" href="../../d3/de5/structpgn__elements.html#a67c47ee20d27950508c15475c2a9adf2">next</a>;
<a name="l00768"></a>00768         }
<a name="l00769"></a>00769         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;lb);
<a name="l00770"></a>00770         
<a name="l00771"></a>00771         <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;    
<a name="l00772"></a>00772     }
<a name="l00773"></a>00773     
<a name="l00774"></a>00774     size= 4*( (size+3)/4 );
<a name="l00775"></a>00775     
<a name="l00776"></a>00776     <span class="keywordflow">if</span> (cur) {
<a name="l00777"></a>00777         <span class="keywordflow">if</span> (size+offs &lt; blocksize) {
<a name="l00778"></a>00778             adr= (<span class="keywordtype">void</span> *) (cur-&gt;<a class="code" href="../../d3/de5/structpgn__elements.html#a05dc2d4e786d97ebf0d93f0b6bff716d">data</a>+offs);
<a name="l00779"></a>00779             offs+= <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l00780"></a>00780             <span class="keywordflow">return</span> adr;
<a name="l00781"></a>00781         }
<a name="l00782"></a>00782     }
<a name="l00783"></a>00783     
<a name="l00784"></a>00784     cur= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>( <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../d3/de5/structpgn__elements.html">pgn_elements</a>), <span class="stringliteral">&quot;newpgn&quot;</span>);
<a name="l00785"></a>00785     cur-&gt;<a class="code" href="../../d3/de5/structpgn__elements.html#a05dc2d4e786d97ebf0d93f0b6bff716d">data</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(blocksize, <span class="stringliteral">&quot;newpgn&quot;</span>);
<a name="l00786"></a>00786     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;lb, cur);
<a name="l00787"></a>00787     
<a name="l00788"></a>00788     offs= <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l00789"></a>00789     <span class="keywordflow">return</span> cur-&gt;<a class="code" href="../../d3/de5/structpgn__elements.html#a05dc2d4e786d97ebf0d93f0b6bff716d">data</a>;
<a name="l00790"></a>00790 }
<a name="l00791"></a>00791 
<a name="l00792"></a><a class="code" href="../../d2/d6c/mball_8c.html#ad92f9bfbd4a3b210ce198214ec48060d">00792</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#ad92f9bfbd4a3b210ce198214ec48060d">freepolygonize</a>(<a class="code" href="../../d8/d20/structprocess.html">PROCESS</a> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>)
<a name="l00793"></a>00793 {
<a name="l00794"></a>00794     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(p-&gt;<a class="code" href="../../d8/d20/structprocess.html#ad395b509219d2599a41ec35060821d29">corners</a>);
<a name="l00795"></a>00795     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(p-&gt;<a class="code" href="../../d8/d20/structprocess.html#a31eb04bb61ee3f2d3e8218109112e3c2">edges</a>);
<a name="l00796"></a>00796     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(p-&gt;<a class="code" href="../../d8/d20/structprocess.html#ab4465b7a1892851ebfe9b665ecd797ef">centers</a>);
<a name="l00797"></a>00797 
<a name="l00798"></a>00798     <a class="code" href="../../df/dae/BKE__mball_8h.html#a96110050b671393c3c26e7ddc3a25286">new_pgn_element</a>(-1);
<a name="l00799"></a>00799     
<a name="l00800"></a>00800     <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d8/d20/structprocess.html#aebd6d1255f648e618754613b69138cc6">vertices</a>.<a class="code" href="../../d9/d0b/structvertices.html#aa31fd70f91b53a343b8e11297fd57c30">ptr</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(p-&gt;<a class="code" href="../../d8/d20/structprocess.html#aebd6d1255f648e618754613b69138cc6">vertices</a>.<a class="code" href="../../d9/d0b/structvertices.html#aa31fd70f91b53a343b8e11297fd57c30">ptr</a>);
<a name="l00801"></a>00801 }
<a name="l00802"></a>00802 
<a name="l00803"></a>00803 <span class="comment">/**** Cubical Polygonization (optional) ****/</span>
<a name="l00804"></a>00804 
<a name="l00805"></a><a class="code" href="../../d2/d6c/mball_8c.html#acc55daa58d88a3612f2ef74a6abbe97f">00805</a> <span class="preprocessor">#define LB  0  </span><span class="comment">/* left bottom edge  */</span>
<a name="l00806"></a><a class="code" href="../../d2/d6c/mball_8c.html#aaf56b99cbe34023f42ce5b7878c827d8">00806</a> <span class="preprocessor">#define LT  1  </span><span class="comment">/* left top edge */</span>
<a name="l00807"></a><a class="code" href="../../d2/d6c/mball_8c.html#a9239321da94853834c18e339f382d9fc">00807</a> <span class="preprocessor">#define LN  2  </span><span class="comment">/* left near edge    */</span>
<a name="l00808"></a><a class="code" href="../../d2/d6c/mball_8c.html#a350c9d6cb81908d59427ee96844d1a9c">00808</a> <span class="preprocessor">#define LF  3  </span><span class="comment">/* left far edge */</span>
<a name="l00809"></a><a class="code" href="../../d2/d6c/mball_8c.html#a171160a766f85c8816b898ed24d28408">00809</a> <span class="preprocessor">#define RB  4  </span><span class="comment">/* right bottom edge */</span>
<a name="l00810"></a><a class="code" href="../../d2/d6c/mball_8c.html#ad05d2f1b67cda860903cecd9f21b6b9f">00810</a> <span class="preprocessor">#define RT  5  </span><span class="comment">/* right top edge    */</span>
<a name="l00811"></a><a class="code" href="../../d2/d6c/mball_8c.html#acce0d4c4425d3def3d8448f8734aa370">00811</a> <span class="preprocessor">#define RN  6  </span><span class="comment">/* right near edge   */</span>
<a name="l00812"></a><a class="code" href="../../d2/d6c/mball_8c.html#a8480531c08b9aa2ba525a6a03d119487">00812</a> <span class="preprocessor">#define RF  7  </span><span class="comment">/* right far edge    */</span>
<a name="l00813"></a><a class="code" href="../../d2/d6c/mball_8c.html#a1d0ece5ecf0d2437c47afedee891058c">00813</a> <span class="preprocessor">#define BN  8  </span><span class="comment">/* bottom near edge  */</span>
<a name="l00814"></a><a class="code" href="../../d2/d6c/mball_8c.html#ac1b964c0b57e6d800ea0a5e4203ab1f9">00814</a> <span class="preprocessor">#define BF  9  </span><span class="comment">/* bottom far edge   */</span>
<a name="l00815"></a><a class="code" href="../../d2/d6c/mball_8c.html#adda1ea75ba8153e72cfb5c87606c55a6">00815</a> <span class="preprocessor">#define TN  10 </span><span class="comment">/* top near edge */</span>
<a name="l00816"></a><a class="code" href="../../d2/d6c/mball_8c.html#a1c0168a9703a05a19de4ce775acc6647">00816</a> <span class="preprocessor">#define TF  11 </span><span class="comment">/* top far edge  */</span>
<a name="l00817"></a>00817 
<a name="l00818"></a><a class="code" href="../../d2/d6c/mball_8c.html#a2d301cdc38074c2f4c20c26767f008b6">00818</a> <span class="keyword">static</span> <a class="code" href="../../d3/df8/structintlists.html">INTLISTS</a> *<a class="code" href="../../d2/d6c/mball_8c.html#a2d301cdc38074c2f4c20c26767f008b6">cubetable</a>[256];
<a name="l00819"></a>00819 
<a name="l00820"></a>00820 <span class="comment">/* edge: LB, LT, LN, LF, RB, RT, RN, RF, BN, BF, TN, TF */</span>
<a name="l00821"></a><a class="code" href="../../d2/d6c/mball_8c.html#a07d3da67fb2109e25ce2730c46243ee3">00821</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d6c/mball_8c.html#a07d3da67fb2109e25ce2730c46243ee3">corner1</a>[12]     = {
<a name="l00822"></a>00822     <a class="code" href="../../d2/d6c/mball_8c.html#aa749e5cf7139dc97361e975f13e467a2">LBN</a>,<a class="code" href="../../d2/d6c/mball_8c.html#a586f695dc09fe7822e51d8d06f905be8">LTN</a>,<a class="code" href="../../d2/d6c/mball_8c.html#aa749e5cf7139dc97361e975f13e467a2">LBN</a>,<a class="code" href="../../d2/d6c/mball_8c.html#a9a88665e307459c076b93109741d973f">LBF</a>,<a class="code" href="../../d2/d6c/mball_8c.html#a3fae26a43a83ee9c2a9c468d3fe22621">RBN</a>,<a class="code" href="../../d2/d6c/mball_8c.html#a098fafd7946985437f25577c38fcb9f4">RTN</a>,<a class="code" href="../../d2/d6c/mball_8c.html#a3fae26a43a83ee9c2a9c468d3fe22621">RBN</a>,<a class="code" href="../../d2/d6c/mball_8c.html#abae7fd1d616531c926f64eb405fe6c48">RBF</a>,<a class="code" href="../../d2/d6c/mball_8c.html#aa749e5cf7139dc97361e975f13e467a2">LBN</a>,<a class="code" href="../../d2/d6c/mball_8c.html#a9a88665e307459c076b93109741d973f">LBF</a>,<a class="code" href="../../d2/d6c/mball_8c.html#a586f695dc09fe7822e51d8d06f905be8">LTN</a>,<a class="code" href="../../d2/d6c/mball_8c.html#a836d252087ebe4128fc3dccd9830e181">LTF</a>};
<a name="l00823"></a><a class="code" href="../../d2/d6c/mball_8c.html#af6b10c0de30dc541b6be6f3de3bb95d7">00823</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d6c/mball_8c.html#af6b10c0de30dc541b6be6f3de3bb95d7">corner2</a>[12]     = {
<a name="l00824"></a>00824     <a class="code" href="../../d2/d6c/mball_8c.html#a9a88665e307459c076b93109741d973f">LBF</a>,<a class="code" href="../../d2/d6c/mball_8c.html#a836d252087ebe4128fc3dccd9830e181">LTF</a>,<a class="code" href="../../d2/d6c/mball_8c.html#a586f695dc09fe7822e51d8d06f905be8">LTN</a>,<a class="code" href="../../d2/d6c/mball_8c.html#a836d252087ebe4128fc3dccd9830e181">LTF</a>,<a class="code" href="../../d2/d6c/mball_8c.html#abae7fd1d616531c926f64eb405fe6c48">RBF</a>,<a class="code" href="../../d2/d6c/mball_8c.html#a4763592545b4347769e93323316b7d89">RTF</a>,<a class="code" href="../../d2/d6c/mball_8c.html#a098fafd7946985437f25577c38fcb9f4">RTN</a>,<a class="code" href="../../d2/d6c/mball_8c.html#a4763592545b4347769e93323316b7d89">RTF</a>,<a class="code" href="../../d2/d6c/mball_8c.html#a3fae26a43a83ee9c2a9c468d3fe22621">RBN</a>,<a class="code" href="../../d2/d6c/mball_8c.html#abae7fd1d616531c926f64eb405fe6c48">RBF</a>,<a class="code" href="../../d2/d6c/mball_8c.html#a098fafd7946985437f25577c38fcb9f4">RTN</a>,RTF};
<a name="l00825"></a><a class="code" href="../../d2/d6c/mball_8c.html#a6f65b8feb538246f6cfb709de17c2386">00825</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d6c/mball_8c.html#a6f65b8feb538246f6cfb709de17c2386">leftface</a>[12]    = {
<a name="l00826"></a>00826     <a class="code" href="../../d2/d6c/mball_8c.html#a111da81ae5883147168bbb8366377b10">B</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#aa73214aa5f2f94f63d90bb4e3d99fe53">L</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#aa73214aa5f2f94f63d90bb4e3d99fe53">L</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#a42257a545daf5b7933d6e8f96adc74f2">F</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#a5c71a5e59a53413cd6c270266d63b031">R</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#a0acb682b8260ab1c60b918599864e2e5">T</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#a5c71a5e59a53413cd6c270266d63b031">R</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#a111da81ae5883147168bbb8366377b10">B</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#a0acb682b8260ab1c60b918599864e2e5">T</a>,  F};
<a name="l00827"></a>00827 <span class="comment">/* face on left when going corner1 to corner2 */</span>
<a name="l00828"></a><a class="code" href="../../d2/d6c/mball_8c.html#a211e202deb43cc0312bbe82e8a8c77a4">00828</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d6c/mball_8c.html#a211e202deb43cc0312bbe82e8a8c77a4">rightface</a>[12]   = {
<a name="l00829"></a>00829     <a class="code" href="../../d2/d6c/mball_8c.html#aa73214aa5f2f94f63d90bb4e3d99fe53">L</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#a0acb682b8260ab1c60b918599864e2e5">T</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#aa73214aa5f2f94f63d90bb4e3d99fe53">L</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#a111da81ae5883147168bbb8366377b10">B</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#a5c71a5e59a53413cd6c270266d63b031">R</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#a5c71a5e59a53413cd6c270266d63b031">R</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#a42257a545daf5b7933d6e8f96adc74f2">F</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#a111da81ae5883147168bbb8366377b10">B</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#a42257a545daf5b7933d6e8f96adc74f2">F</a>,  <a class="code" href="../../d2/d6c/mball_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>,  T};
<a name="l00830"></a>00830 <span class="comment">/* face on right when going corner1 to corner2 */</span>
<a name="l00831"></a>00831 
<a name="l00832"></a>00832 
<a name="l00833"></a>00833 <span class="comment">/* docube: triangulate the cube directly, without decomposition */</span>
<a name="l00834"></a>00834 
<a name="l00835"></a><a class="code" href="../../d2/d6c/mball_8c.html#a33d69b68f1523f5a80bd85e45c5ef0fe">00835</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a93a6b9d8889a6747d727ed614e3de7c0">docube</a>(<a class="code" href="../../df/d81/structcube.html">CUBE</a> *<a class="code" href="../../df/d81/structcube.html">cube</a>, <a class="code" href="../../d8/d20/structprocess.html">PROCESS</a> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>, <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb)
<a name="l00836"></a>00836 {
<a name="l00837"></a>00837     <a class="code" href="../../d3/df8/structintlists.html">INTLISTS</a> *polys;
<a name="l00838"></a>00838     <a class="code" href="../../d5/d7a/structcorner.html">CORNER</a> *c1, *c2;
<a name="l00839"></a>00839     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, index = 0, count, indexar[8];
<a name="l00840"></a>00840     
<a name="l00841"></a>00841     <span class="keywordflow">for</span> (i = 0; i &lt; 8; i++) <span class="keywordflow">if</span> (cube-&gt;<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[i]-&gt;<a class="code" href="../../d5/d7a/structcorner.html#ac4d3dda7d0029094a9211b2570848a04">value</a> &gt; 0.0f) index += (1&lt;&lt;<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>);
<a name="l00842"></a>00842     
<a name="l00843"></a>00843     <span class="keywordflow">for</span> (polys = cubetable[index]; polys; polys = polys-&gt;<a class="code" href="../../d3/df8/structintlists.html#af6afd33fd900817d8aeb30172b3c18f9">next</a>) {
<a name="l00844"></a>00844         <a class="code" href="../../d9/d93/structintlist.html">INTLIST</a> *edges;
<a name="l00845"></a>00845         
<a name="l00846"></a>00846         count = 0;
<a name="l00847"></a>00847         
<a name="l00848"></a>00848         <span class="keywordflow">for</span> (edges = polys-&gt;<a class="code" href="../../d3/df8/structintlists.html#acf058da586a44992db4bf6b8bd893260">list</a>; edges; edges = edges-&gt;<a class="code" href="../../d9/d93/structintlist.html#aa678c36b92d8ca9d6e79aebf3b605132">next</a>) {
<a name="l00849"></a>00849             c1 = cube-&gt;<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[<a class="code" href="../../d2/d6c/mball_8c.html#a07d3da67fb2109e25ce2730c46243ee3">corner1</a>[edges-&gt;<a class="code" href="../../d9/d93/structintlist.html#a22008316cd2518b4463db2ebd7b77b75">i</a>]];
<a name="l00850"></a>00850             c2 = cube-&gt;<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[<a class="code" href="../../d2/d6c/mball_8c.html#af6b10c0de30dc541b6be6f3de3bb95d7">corner2</a>[edges-&gt;<a class="code" href="../../d9/d93/structintlist.html#a22008316cd2518b4463db2ebd7b77b75">i</a>]];
<a name="l00851"></a>00851             
<a name="l00852"></a>00852             indexar[count] = <a class="code" href="../../df/dae/BKE__mball_8h.html#aacaaf457cf01c422849545ceb5a16d7c">vertid</a>(c1, c2, p, mb);
<a name="l00853"></a>00853             count++;
<a name="l00854"></a>00854         }
<a name="l00855"></a>00855         <span class="keywordflow">if</span> (count&gt;2) {
<a name="l00856"></a>00856             <span class="keywordflow">switch</span>(count) {
<a name="l00857"></a>00857             <span class="keywordflow">case</span> 3:
<a name="l00858"></a>00858                 <a class="code" href="../../df/dae/BKE__mball_8h.html#a67d4a23c050f08e42c426471ef8579be">accum_mballfaces</a>(indexar[2], indexar[1], indexar[0], 0);
<a name="l00859"></a>00859                 <span class="keywordflow">break</span>;
<a name="l00860"></a>00860             <span class="keywordflow">case</span> 4:
<a name="l00861"></a>00861                 <span class="keywordflow">if</span> (indexar[0]==0) <a class="code" href="../../df/dae/BKE__mball_8h.html#a67d4a23c050f08e42c426471ef8579be">accum_mballfaces</a>(indexar[0], indexar[3], indexar[2], indexar[1]);
<a name="l00862"></a>00862                 <span class="keywordflow">else</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a67d4a23c050f08e42c426471ef8579be">accum_mballfaces</a>(indexar[3], indexar[2], indexar[1], indexar[0]);
<a name="l00863"></a>00863                 <span class="keywordflow">break</span>;
<a name="l00864"></a>00864             <span class="keywordflow">case</span> 5:
<a name="l00865"></a>00865                 <span class="keywordflow">if</span> (indexar[0]==0) <a class="code" href="../../df/dae/BKE__mball_8h.html#a67d4a23c050f08e42c426471ef8579be">accum_mballfaces</a>(indexar[0], indexar[3], indexar[2], indexar[1]);
<a name="l00866"></a>00866                 <span class="keywordflow">else</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a67d4a23c050f08e42c426471ef8579be">accum_mballfaces</a>(indexar[3], indexar[2], indexar[1], indexar[0]);
<a name="l00867"></a>00867 
<a name="l00868"></a>00868                 <a class="code" href="../../df/dae/BKE__mball_8h.html#a67d4a23c050f08e42c426471ef8579be">accum_mballfaces</a>(indexar[4], indexar[3], indexar[0], 0);
<a name="l00869"></a>00869                 <span class="keywordflow">break</span>;
<a name="l00870"></a>00870             <span class="keywordflow">case</span> 6:
<a name="l00871"></a>00871                 <span class="keywordflow">if</span> (indexar[0]==0) {
<a name="l00872"></a>00872                     <a class="code" href="../../df/dae/BKE__mball_8h.html#a67d4a23c050f08e42c426471ef8579be">accum_mballfaces</a>(indexar[0], indexar[3], indexar[2], indexar[1]);
<a name="l00873"></a>00873                     <a class="code" href="../../df/dae/BKE__mball_8h.html#a67d4a23c050f08e42c426471ef8579be">accum_mballfaces</a>(indexar[0], indexar[5], indexar[4], indexar[3]);
<a name="l00874"></a>00874                 }
<a name="l00875"></a>00875                 <span class="keywordflow">else</span> {
<a name="l00876"></a>00876                     <a class="code" href="../../df/dae/BKE__mball_8h.html#a67d4a23c050f08e42c426471ef8579be">accum_mballfaces</a>(indexar[3], indexar[2], indexar[1], indexar[0]);
<a name="l00877"></a>00877                     <a class="code" href="../../df/dae/BKE__mball_8h.html#a67d4a23c050f08e42c426471ef8579be">accum_mballfaces</a>(indexar[5], indexar[4], indexar[3], indexar[0]);
<a name="l00878"></a>00878                 }
<a name="l00879"></a>00879                 <span class="keywordflow">break</span>;
<a name="l00880"></a>00880             <span class="keywordflow">case</span> 7:
<a name="l00881"></a>00881                 <span class="keywordflow">if</span> (indexar[0]==0) {
<a name="l00882"></a>00882                     <a class="code" href="../../df/dae/BKE__mball_8h.html#a67d4a23c050f08e42c426471ef8579be">accum_mballfaces</a>(indexar[0], indexar[3], indexar[2], indexar[1]);
<a name="l00883"></a>00883                     <a class="code" href="../../df/dae/BKE__mball_8h.html#a67d4a23c050f08e42c426471ef8579be">accum_mballfaces</a>(indexar[0], indexar[5], indexar[4], indexar[3]);
<a name="l00884"></a>00884                 }
<a name="l00885"></a>00885                 <span class="keywordflow">else</span> {
<a name="l00886"></a>00886                     <a class="code" href="../../df/dae/BKE__mball_8h.html#a67d4a23c050f08e42c426471ef8579be">accum_mballfaces</a>(indexar[3], indexar[2], indexar[1], indexar[0]);
<a name="l00887"></a>00887                     <a class="code" href="../../df/dae/BKE__mball_8h.html#a67d4a23c050f08e42c426471ef8579be">accum_mballfaces</a>(indexar[5], indexar[4], indexar[3], indexar[0]);
<a name="l00888"></a>00888                 }
<a name="l00889"></a>00889                 
<a name="l00890"></a>00890                 <a class="code" href="../../df/dae/BKE__mball_8h.html#a67d4a23c050f08e42c426471ef8579be">accum_mballfaces</a>(indexar[6], indexar[5], indexar[0], 0);
<a name="l00891"></a>00891                 
<a name="l00892"></a>00892                 <span class="keywordflow">break</span>;
<a name="l00893"></a>00893             }
<a name="l00894"></a>00894         }
<a name="l00895"></a>00895     }
<a name="l00896"></a>00896 }
<a name="l00897"></a>00897 
<a name="l00898"></a>00898 
<a name="l00899"></a>00899 <span class="comment">/* testface: given cube at lattice (i, j, k), and four corners of face,</span>
<a name="l00900"></a>00900 <span class="comment"> * if surface crosses face, compute other four corners of adjacent cube</span>
<a name="l00901"></a>00901 <span class="comment"> * and add new cube to cube stack */</span>
<a name="l00902"></a>00902 
<a name="l00903"></a><a class="code" href="../../d2/d6c/mball_8c.html#a830bc62fc8b9541aeb338bbcca5349a7">00903</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a830bc62fc8b9541aeb338bbcca5349a7">testface</a>(<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <a class="code" href="../../df/d81/structcube.html">CUBE</a>* old, <span class="keywordtype">int</span> bit, <span class="keywordtype">int</span> c1, <span class="keywordtype">int</span> c2, <span class="keywordtype">int</span> c3, <span class="keywordtype">int</span> c4, <a class="code" href="../../d8/d20/structprocess.html">PROCESS</a> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>)
<a name="l00904"></a>00904 {
<a name="l00905"></a>00905     <a class="code" href="../../df/d81/structcube.html">CUBE</a> newc;
<a name="l00906"></a>00906     <a class="code" href="../../da/de9/structcubes.html">CUBES</a> *oldcubes = p-&gt;<a class="code" href="../../d8/d20/structprocess.html#ae132fb3ae2da26633e0452b6e846ada8">cubes</a>;
<a name="l00907"></a>00907     <a class="code" href="../../d5/d7a/structcorner.html">CORNER</a> *corn1, *corn2, *corn3, *corn4;
<a name="l00908"></a>00908     <span class="keywordtype">int</span> n, pos;
<a name="l00909"></a>00909 
<a name="l00910"></a>00910     corn1= old-&gt;<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[c1];
<a name="l00911"></a>00911     corn2= old-&gt;<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[c2];
<a name="l00912"></a>00912     corn3= old-&gt;<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[c3];
<a name="l00913"></a>00913     corn4= old-&gt;<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[c4];
<a name="l00914"></a>00914     
<a name="l00915"></a>00915     pos = corn1-&gt;<a class="code" href="../../d5/d7a/structcorner.html#ac4d3dda7d0029094a9211b2570848a04">value</a> &gt; 0.0f ? 1 : 0;
<a name="l00916"></a>00916 
<a name="l00917"></a>00917     <span class="comment">/* test if no surface crossing */</span>
<a name="l00918"></a>00918     <span class="keywordflow">if</span> ( (corn2-&gt;<a class="code" href="../../d5/d7a/structcorner.html#ac4d3dda7d0029094a9211b2570848a04">value</a> &gt; 0) == pos &amp;&amp; (corn3-&gt;<a class="code" href="../../d5/d7a/structcorner.html#ac4d3dda7d0029094a9211b2570848a04">value</a> &gt; 0) == pos &amp;&amp; (corn4-&gt;<a class="code" href="../../d5/d7a/structcorner.html#ac4d3dda7d0029094a9211b2570848a04">value</a> &gt; 0) == pos) <span class="keywordflow">return</span>;
<a name="l00919"></a>00919     <span class="comment">/* test if cube out of bounds */</span>
<a name="l00920"></a>00920     <span class="comment">/*if ( abs(i) &gt; p-&gt;bounds || abs(j) &gt; p-&gt;bounds || abs(k) &gt; p-&gt;bounds) return;*/</span>
<a name="l00921"></a>00921     <span class="comment">/* test if already visited (always as last) */</span>
<a name="l00922"></a>00922     <span class="keywordflow">if</span> (<a class="code" href="../../df/dae/BKE__mball_8h.html#ae31a7784233b7632009917308a4c41e1">setcenter</a>(p-&gt;<a class="code" href="../../d8/d20/structprocess.html#ab4465b7a1892851ebfe9b665ecd797ef">centers</a>, i, j, k)) <span class="keywordflow">return</span>;
<a name="l00923"></a>00923 
<a name="l00924"></a>00924 
<a name="l00925"></a>00925     <span class="comment">/* create new cube and add cube to top of stack: */</span>
<a name="l00926"></a>00926     p-&gt;<a class="code" href="../../d8/d20/structprocess.html#ae132fb3ae2da26633e0452b6e846ada8">cubes</a> = (<a class="code" href="../../da/de9/structcubes.html">CUBES</a> *) <a class="code" href="../../df/dae/BKE__mball_8h.html#a96110050b671393c3c26e7ddc3a25286">new_pgn_element</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/de9/structcubes.html">CUBES</a>));
<a name="l00927"></a>00927     p-&gt;<a class="code" href="../../d8/d20/structprocess.html#ae132fb3ae2da26633e0452b6e846ada8">cubes</a>-&gt;<a class="code" href="../../da/de9/structcubes.html#a40a3f4af08f68689644f932458873304">next</a> = oldcubes;
<a name="l00928"></a>00928     
<a name="l00929"></a>00929     newc.<a class="code" href="../../df/d81/structcube.html#aeb3c618a61a9ffe4d5fb2c74bc5aa2a0">i</a> = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00930"></a>00930     newc.<a class="code" href="../../df/d81/structcube.html#afbbc026f5003816eb1e7c44bdcf9f54a">j</a> = j;
<a name="l00931"></a>00931     newc.<a class="code" href="../../df/d81/structcube.html#a614bd77c99fb9a1a100665775ee02728">k</a> = k;
<a name="l00932"></a>00932     <span class="keywordflow">for</span> (n = 0; n &lt; 8; n++) newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[n] = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00933"></a>00933     
<a name="l00934"></a>00934     newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[<a class="code" href="../../d2/d6c/mball_8c.html#abcd6f1a5d0984973deec18bafcbd8d10">FLIP</a>(c1, bit)] = corn1;
<a name="l00935"></a>00935     newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[<a class="code" href="../../d2/d6c/mball_8c.html#abcd6f1a5d0984973deec18bafcbd8d10">FLIP</a>(c2, bit)] = corn2;
<a name="l00936"></a>00936     newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[<a class="code" href="../../d2/d6c/mball_8c.html#abcd6f1a5d0984973deec18bafcbd8d10">FLIP</a>(c3, bit)] = corn3;
<a name="l00937"></a>00937     newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[<a class="code" href="../../d2/d6c/mball_8c.html#abcd6f1a5d0984973deec18bafcbd8d10">FLIP</a>(c4, bit)] = corn4;
<a name="l00938"></a>00938 
<a name="l00939"></a>00939     <span class="keywordflow">if</span> (newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[0]==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[0] = <a class="code" href="../../df/dae/BKE__mball_8h.html#aa6cb120f0ee213ee460fbe0eb7dbe0b2">setcorner</a>(p, i, j, k);
<a name="l00940"></a>00940     <span class="keywordflow">if</span> (newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[1]==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[1] = <a class="code" href="../../df/dae/BKE__mball_8h.html#aa6cb120f0ee213ee460fbe0eb7dbe0b2">setcorner</a>(p, i, j, k+1);
<a name="l00941"></a>00941     <span class="keywordflow">if</span> (newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[2]==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[2] = <a class="code" href="../../df/dae/BKE__mball_8h.html#aa6cb120f0ee213ee460fbe0eb7dbe0b2">setcorner</a>(p, i, j+1, k);
<a name="l00942"></a>00942     <span class="keywordflow">if</span> (newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[3]==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[3] = <a class="code" href="../../df/dae/BKE__mball_8h.html#aa6cb120f0ee213ee460fbe0eb7dbe0b2">setcorner</a>(p, i, j+1, k+1);
<a name="l00943"></a>00943     <span class="keywordflow">if</span> (newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[4]==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[4] = <a class="code" href="../../df/dae/BKE__mball_8h.html#aa6cb120f0ee213ee460fbe0eb7dbe0b2">setcorner</a>(p, i+1, j, k);
<a name="l00944"></a>00944     <span class="keywordflow">if</span> (newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[5]==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[5] = <a class="code" href="../../df/dae/BKE__mball_8h.html#aa6cb120f0ee213ee460fbe0eb7dbe0b2">setcorner</a>(p, i+1, j, k+1);
<a name="l00945"></a>00945     <span class="keywordflow">if</span> (newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[6]==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[6] = <a class="code" href="../../df/dae/BKE__mball_8h.html#aa6cb120f0ee213ee460fbe0eb7dbe0b2">setcorner</a>(p, i+1, j+1, k);
<a name="l00946"></a>00946     <span class="keywordflow">if</span> (newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[7]==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) newc.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[7] = <a class="code" href="../../df/dae/BKE__mball_8h.html#aa6cb120f0ee213ee460fbe0eb7dbe0b2">setcorner</a>(p, i+1, j+1, k+1);
<a name="l00947"></a>00947 
<a name="l00948"></a>00948     p-&gt;<a class="code" href="../../d8/d20/structprocess.html#ae132fb3ae2da26633e0452b6e846ada8">cubes</a>-&gt;<a class="code" href="../../da/de9/structcubes.html#abe54f8919e9c65c601ac8aba52529ec1">cube</a>= newc;   
<a name="l00949"></a>00949 }
<a name="l00950"></a>00950 
<a name="l00951"></a>00951 <span class="comment">/* setcorner: return corner with the given lattice location</span>
<a name="l00952"></a>00952 <span class="comment"> * set (and cache) its function value */</span>
<a name="l00953"></a>00953 
<a name="l00954"></a><a class="code" href="../../d2/d6c/mball_8c.html#aa6cb120f0ee213ee460fbe0eb7dbe0b2">00954</a> <a class="code" href="../../d5/d7a/structcorner.html">CORNER</a> *<a class="code" href="../../df/dae/BKE__mball_8h.html#aa6cb120f0ee213ee460fbe0eb7dbe0b2">setcorner</a> (<a class="code" href="../../d8/d20/structprocess.html">PROCESS</a>* <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>, <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k)
<a name="l00955"></a>00955 {
<a name="l00956"></a>00956     <span class="comment">/* for speed, do corner value caching here */</span>
<a name="l00957"></a>00957     <a class="code" href="../../d5/d7a/structcorner.html">CORNER</a> *c;
<a name="l00958"></a>00958     <span class="keywordtype">int</span> index;
<a name="l00959"></a>00959 
<a name="l00960"></a>00960     <span class="comment">/* does corner exist? */</span>
<a name="l00961"></a>00961     index = <a class="code" href="../../d2/d6c/mball_8c.html#a87a01b7715b9a07056ea603a4f7abad0">HASH</a>(i, j, k);
<a name="l00962"></a>00962     c = p-&gt;<a class="code" href="../../d8/d20/structprocess.html#ad395b509219d2599a41ec35060821d29">corners</a>[index];
<a name="l00963"></a>00963     
<a name="l00964"></a>00964     <span class="keywordflow">for</span> (; c != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; c = c-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a0d08dd49eddd80bfb1a3324cf3ce144d">next</a>) {
<a name="l00965"></a>00965         <span class="keywordflow">if</span> (c-&gt;<a class="code" href="../../d5/d7a/structcorner.html#ad554584e8c3b48779cabb3e59da6a112">i</a> == i &amp;&amp; c-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a818b66ff98bf426b3b8479258a6fe772">j</a> == j &amp;&amp; c-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a20827bf5c23b190c383d6b65fb402027">k</a> == k) {
<a name="l00966"></a>00966             <span class="keywordflow">return</span> c;
<a name="l00967"></a>00967         }
<a name="l00968"></a>00968     }
<a name="l00969"></a>00969 
<a name="l00970"></a>00970     c = (<a class="code" href="../../d5/d7a/structcorner.html">CORNER</a> *) <a class="code" href="../../df/dae/BKE__mball_8h.html#a96110050b671393c3c26e7ddc3a25286">new_pgn_element</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d7a/structcorner.html">CORNER</a>));
<a name="l00971"></a>00971 
<a name="l00972"></a>00972     c-&gt;<a class="code" href="../../d5/d7a/structcorner.html#ad554584e8c3b48779cabb3e59da6a112">i</a> = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; 
<a name="l00973"></a>00973     c-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a71d01533adaf1cdf5dfcca575ab27570">x</a> = ((float)i-0.5f)*p-&gt;<a class="code" href="../../d8/d20/structprocess.html#a6e8c8f8c7f35216fc9bbeeaf74faeccd">size</a>;
<a name="l00974"></a>00974     c-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a818b66ff98bf426b3b8479258a6fe772">j</a> = j; 
<a name="l00975"></a>00975     c-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a7ae334887d1f6ff7223781649c73afb7">y</a> = ((float)j-0.5f)*p-&gt;<a class="code" href="../../d8/d20/structprocess.html#a6e8c8f8c7f35216fc9bbeeaf74faeccd">size</a>;
<a name="l00976"></a>00976     c-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a20827bf5c23b190c383d6b65fb402027">k</a> = k; 
<a name="l00977"></a>00977     c-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a3df637e8d344fe21f91eb18a888a1f81">z</a> = ((float)k-0.5f)*p-&gt;<a class="code" href="../../d8/d20/structprocess.html#a6e8c8f8c7f35216fc9bbeeaf74faeccd">size</a>;
<a name="l00978"></a>00978     c-&gt;<a class="code" href="../../d5/d7a/structcorner.html#ac4d3dda7d0029094a9211b2570848a04">value</a> = p-&gt;<a class="code" href="../../d8/d20/structprocess.html#aa869826f5c153b5c22a16eeea7a6bb44">function</a>(c-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a71d01533adaf1cdf5dfcca575ab27570">x</a>, c-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a7ae334887d1f6ff7223781649c73afb7">y</a>, c-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a3df637e8d344fe21f91eb18a888a1f81">z</a>);
<a name="l00979"></a>00979     
<a name="l00980"></a>00980     c-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a0d08dd49eddd80bfb1a3324cf3ce144d">next</a> = p-&gt;<a class="code" href="../../d8/d20/structprocess.html#ad395b509219d2599a41ec35060821d29">corners</a>[index];
<a name="l00981"></a>00981     p-&gt;<a class="code" href="../../d8/d20/structprocess.html#ad395b509219d2599a41ec35060821d29">corners</a>[index] = c;
<a name="l00982"></a>00982     
<a name="l00983"></a>00983     <span class="keywordflow">return</span> c;
<a name="l00984"></a>00984 }
<a name="l00985"></a>00985 
<a name="l00986"></a>00986 
<a name="l00987"></a>00987 <span class="comment">/* nextcwedge: return next clockwise edge from given edge around given face */</span>
<a name="l00988"></a>00988 
<a name="l00989"></a><a class="code" href="../../d2/d6c/mball_8c.html#a87ac07a6192b3e4584d93e7e9bd573ba">00989</a> <span class="keywordtype">int</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a87ac07a6192b3e4584d93e7e9bd573ba">nextcwedge</a> (<span class="keywordtype">int</span> edge, <span class="keywordtype">int</span> face)
<a name="l00990"></a>00990 {
<a name="l00991"></a>00991     <span class="keywordflow">switch</span> (edge) {
<a name="l00992"></a>00992     <span class="keywordflow">case</span> <a class="code" href="../../d2/d6c/mball_8c.html#acc55daa58d88a3612f2ef74a6abbe97f">LB</a>: 
<a name="l00993"></a>00993         <span class="keywordflow">return</span> (face == <a class="code" href="../../d2/d6c/mball_8c.html#aa73214aa5f2f94f63d90bb4e3d99fe53">L</a>)? <a class="code" href="../../d2/d6c/mball_8c.html#a350c9d6cb81908d59427ee96844d1a9c">LF</a> : <a class="code" href="../../d2/d6c/mball_8c.html#a1d0ece5ecf0d2437c47afedee891058c">BN</a>;
<a name="l00994"></a>00994     <span class="keywordflow">case</span> <a class="code" href="../../d2/d6c/mball_8c.html#aaf56b99cbe34023f42ce5b7878c827d8">LT</a>: 
<a name="l00995"></a>00995         <span class="keywordflow">return</span> (face == <a class="code" href="../../d2/d6c/mball_8c.html#aa73214aa5f2f94f63d90bb4e3d99fe53">L</a>)? <a class="code" href="../../d2/d6c/mball_8c.html#a9239321da94853834c18e339f382d9fc">LN</a> : <a class="code" href="../../d2/d6c/mball_8c.html#a1c0168a9703a05a19de4ce775acc6647">TF</a>;
<a name="l00996"></a>00996     <span class="keywordflow">case</span> <a class="code" href="../../d2/d6c/mball_8c.html#a9239321da94853834c18e339f382d9fc">LN</a>: 
<a name="l00997"></a>00997         <span class="keywordflow">return</span> (face == <a class="code" href="../../d2/d6c/mball_8c.html#aa73214aa5f2f94f63d90bb4e3d99fe53">L</a>)? <a class="code" href="../../d2/d6c/mball_8c.html#acc55daa58d88a3612f2ef74a6abbe97f">LB</a> : <a class="code" href="../../d2/d6c/mball_8c.html#adda1ea75ba8153e72cfb5c87606c55a6">TN</a>;
<a name="l00998"></a>00998     <span class="keywordflow">case</span> <a class="code" href="../../d2/d6c/mball_8c.html#a350c9d6cb81908d59427ee96844d1a9c">LF</a>: 
<a name="l00999"></a>00999         <span class="keywordflow">return</span> (face == <a class="code" href="../../d2/d6c/mball_8c.html#aa73214aa5f2f94f63d90bb4e3d99fe53">L</a>)? <a class="code" href="../../d2/d6c/mball_8c.html#aaf56b99cbe34023f42ce5b7878c827d8">LT</a> : <a class="code" href="../../d2/d6c/mball_8c.html#ac1b964c0b57e6d800ea0a5e4203ab1f9">BF</a>;
<a name="l01000"></a>01000     <span class="keywordflow">case</span> <a class="code" href="../../d2/d6c/mball_8c.html#a171160a766f85c8816b898ed24d28408">RB</a>: 
<a name="l01001"></a>01001         <span class="keywordflow">return</span> (face == <a class="code" href="../../d2/d6c/mball_8c.html#a5c71a5e59a53413cd6c270266d63b031">R</a>)? <a class="code" href="../../d2/d6c/mball_8c.html#acce0d4c4425d3def3d8448f8734aa370">RN</a> : <a class="code" href="../../d2/d6c/mball_8c.html#ac1b964c0b57e6d800ea0a5e4203ab1f9">BF</a>;
<a name="l01002"></a>01002     <span class="keywordflow">case</span> <a class="code" href="../../d2/d6c/mball_8c.html#ad05d2f1b67cda860903cecd9f21b6b9f">RT</a>: 
<a name="l01003"></a>01003         <span class="keywordflow">return</span> (face == <a class="code" href="../../d2/d6c/mball_8c.html#a5c71a5e59a53413cd6c270266d63b031">R</a>)? <a class="code" href="../../d2/d6c/mball_8c.html#a8480531c08b9aa2ba525a6a03d119487">RF</a> : <a class="code" href="../../d2/d6c/mball_8c.html#adda1ea75ba8153e72cfb5c87606c55a6">TN</a>;
<a name="l01004"></a>01004     <span class="keywordflow">case</span> <a class="code" href="../../d2/d6c/mball_8c.html#acce0d4c4425d3def3d8448f8734aa370">RN</a>: 
<a name="l01005"></a>01005         <span class="keywordflow">return</span> (face == <a class="code" href="../../d2/d6c/mball_8c.html#a5c71a5e59a53413cd6c270266d63b031">R</a>)? <a class="code" href="../../d2/d6c/mball_8c.html#ad05d2f1b67cda860903cecd9f21b6b9f">RT</a> : <a class="code" href="../../d2/d6c/mball_8c.html#a1d0ece5ecf0d2437c47afedee891058c">BN</a>;
<a name="l01006"></a>01006     <span class="keywordflow">case</span> <a class="code" href="../../d2/d6c/mball_8c.html#a8480531c08b9aa2ba525a6a03d119487">RF</a>: 
<a name="l01007"></a>01007         <span class="keywordflow">return</span> (face == <a class="code" href="../../d2/d6c/mball_8c.html#a5c71a5e59a53413cd6c270266d63b031">R</a>)? <a class="code" href="../../d2/d6c/mball_8c.html#a171160a766f85c8816b898ed24d28408">RB</a> : <a class="code" href="../../d2/d6c/mball_8c.html#a1c0168a9703a05a19de4ce775acc6647">TF</a>;
<a name="l01008"></a>01008     <span class="keywordflow">case</span> <a class="code" href="../../d2/d6c/mball_8c.html#a1d0ece5ecf0d2437c47afedee891058c">BN</a>: 
<a name="l01009"></a>01009         <span class="keywordflow">return</span> (face == <a class="code" href="../../d2/d6c/mball_8c.html#a111da81ae5883147168bbb8366377b10">B</a>)? <a class="code" href="../../d2/d6c/mball_8c.html#a171160a766f85c8816b898ed24d28408">RB</a> : <a class="code" href="../../d2/d6c/mball_8c.html#a9239321da94853834c18e339f382d9fc">LN</a>;
<a name="l01010"></a>01010     <span class="keywordflow">case</span> <a class="code" href="../../d2/d6c/mball_8c.html#ac1b964c0b57e6d800ea0a5e4203ab1f9">BF</a>: 
<a name="l01011"></a>01011         <span class="keywordflow">return</span> (face == <a class="code" href="../../d2/d6c/mball_8c.html#a111da81ae5883147168bbb8366377b10">B</a>)? <a class="code" href="../../d2/d6c/mball_8c.html#acc55daa58d88a3612f2ef74a6abbe97f">LB</a> : <a class="code" href="../../d2/d6c/mball_8c.html#a8480531c08b9aa2ba525a6a03d119487">RF</a>;
<a name="l01012"></a>01012     <span class="keywordflow">case</span> <a class="code" href="../../d2/d6c/mball_8c.html#adda1ea75ba8153e72cfb5c87606c55a6">TN</a>: 
<a name="l01013"></a>01013         <span class="keywordflow">return</span> (face == <a class="code" href="../../d2/d6c/mball_8c.html#a0acb682b8260ab1c60b918599864e2e5">T</a>)? <a class="code" href="../../d2/d6c/mball_8c.html#aaf56b99cbe34023f42ce5b7878c827d8">LT</a> : <a class="code" href="../../d2/d6c/mball_8c.html#acce0d4c4425d3def3d8448f8734aa370">RN</a>;
<a name="l01014"></a>01014     <span class="keywordflow">case</span> <a class="code" href="../../d2/d6c/mball_8c.html#a1c0168a9703a05a19de4ce775acc6647">TF</a>: 
<a name="l01015"></a>01015         <span class="keywordflow">return</span> (face == <a class="code" href="../../d2/d6c/mball_8c.html#a0acb682b8260ab1c60b918599864e2e5">T</a>)? <a class="code" href="../../d2/d6c/mball_8c.html#ad05d2f1b67cda860903cecd9f21b6b9f">RT</a> : <a class="code" href="../../d2/d6c/mball_8c.html#a350c9d6cb81908d59427ee96844d1a9c">LF</a>;
<a name="l01016"></a>01016     }
<a name="l01017"></a>01017     <span class="keywordflow">return</span> 0;
<a name="l01018"></a>01018 }
<a name="l01019"></a>01019 
<a name="l01020"></a>01020 
<a name="l01021"></a>01021 <span class="comment">/* otherface: return face adjoining edge that is not the given face */</span>
<a name="l01022"></a>01022 
<a name="l01023"></a><a class="code" href="../../d2/d6c/mball_8c.html#a90d648a19e93949f9eef3f8b9fd03971">01023</a> <span class="keywordtype">int</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a90d648a19e93949f9eef3f8b9fd03971">otherface</a> (<span class="keywordtype">int</span> edge, <span class="keywordtype">int</span> face)
<a name="l01024"></a>01024 {
<a name="l01025"></a>01025     <span class="keywordtype">int</span> other = <a class="code" href="../../d2/d6c/mball_8c.html#a6f65b8feb538246f6cfb709de17c2386">leftface</a>[edge];
<a name="l01026"></a>01026     <span class="keywordflow">return</span> face == other? <a class="code" href="../../d2/d6c/mball_8c.html#a211e202deb43cc0312bbe82e8a8c77a4">rightface</a>[edge] : other;
<a name="l01027"></a>01027 }
<a name="l01028"></a>01028 
<a name="l01029"></a>01029 
<a name="l01030"></a>01030 <span class="comment">/* makecubetable: create the 256 entry table for cubical polygonization */</span>
<a name="l01031"></a>01031 
<a name="l01032"></a><a class="code" href="../../d2/d6c/mball_8c.html#a056e9e069bb31fd80f9195dac2bd56c8">01032</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a056e9e069bb31fd80f9195dac2bd56c8">makecubetable</a> (<span class="keywordtype">void</span>)
<a name="l01033"></a>01033 {
<a name="l01034"></a>01034     <span class="keyword">static</span> <span class="keywordtype">int</span> isdone= 0;
<a name="l01035"></a>01035     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, e, c, done[12], pos[8];
<a name="l01036"></a>01036 
<a name="l01037"></a>01037     <span class="keywordflow">if</span> (isdone) <span class="keywordflow">return</span>;
<a name="l01038"></a>01038     isdone= 1;
<a name="l01039"></a>01039 
<a name="l01040"></a>01040     <span class="keywordflow">for</span> (i = 0; i &lt; 256; i++) {
<a name="l01041"></a>01041         <span class="keywordflow">for</span> (e = 0; e &lt; 12; e++) done[e] = 0;
<a name="l01042"></a>01042         <span class="keywordflow">for</span> (c = 0; c &lt; 8; c++) pos[c] = <a class="code" href="../../d2/d6c/mball_8c.html#abeee01da3e6b645a8d4c3513f4d4a7dd">MB_BIT</a>(i, c);
<a name="l01043"></a>01043         <span class="keywordflow">for</span> (e = 0; e &lt; 12; e++)
<a name="l01044"></a>01044             <span class="keywordflow">if</span> (!done[e] &amp;&amp; (pos[<a class="code" href="../../d2/d6c/mball_8c.html#a07d3da67fb2109e25ce2730c46243ee3">corner1</a>[e]] != pos[<a class="code" href="../../d2/d6c/mball_8c.html#af6b10c0de30dc541b6be6f3de3bb95d7">corner2</a>[e]])) {
<a name="l01045"></a>01045                 <a class="code" href="../../d9/d93/structintlist.html">INTLIST</a> *ints = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01046"></a>01046                 <a class="code" href="../../d3/df8/structintlists.html">INTLISTS</a> *lists = (<a class="code" href="../../d3/df8/structintlists.html">INTLISTS</a> *) <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d3/df8/structintlists.html">INTLISTS</a>), <span class="stringliteral">&quot;mball_intlist&quot;</span>);
<a name="l01047"></a>01047                 <span class="keywordtype">int</span> start = e, edge = e;
<a name="l01048"></a>01048                 
<a name="l01049"></a>01049                 <span class="comment">/* get face that is to right of edge from pos to neg corner: */</span>
<a name="l01050"></a>01050                 <span class="keywordtype">int</span> face = pos[<a class="code" href="../../d2/d6c/mball_8c.html#a07d3da67fb2109e25ce2730c46243ee3">corner1</a>[e]]? <a class="code" href="../../d2/d6c/mball_8c.html#a211e202deb43cc0312bbe82e8a8c77a4">rightface</a>[e] : <a class="code" href="../../d2/d6c/mball_8c.html#a6f65b8feb538246f6cfb709de17c2386">leftface</a>[e];
<a name="l01051"></a>01051                 
<a name="l01052"></a>01052                 <span class="keywordflow">while</span> (1) {
<a name="l01053"></a>01053                     edge = <a class="code" href="../../df/dae/BKE__mball_8h.html#a87ac07a6192b3e4584d93e7e9bd573ba">nextcwedge</a>(edge, face);
<a name="l01054"></a>01054                     done[edge] = 1;
<a name="l01055"></a>01055                     <span class="keywordflow">if</span> (pos[<a class="code" href="../../d2/d6c/mball_8c.html#a07d3da67fb2109e25ce2730c46243ee3">corner1</a>[edge]] != pos[<a class="code" href="../../d2/d6c/mball_8c.html#af6b10c0de30dc541b6be6f3de3bb95d7">corner2</a>[edge]]) {
<a name="l01056"></a>01056                         <a class="code" href="../../d9/d93/structintlist.html">INTLIST</a> *tmp = ints;
<a name="l01057"></a>01057                         
<a name="l01058"></a>01058                         ints = (<a class="code" href="../../d9/d93/structintlist.html">INTLIST</a> *) <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d93/structintlist.html">INTLIST</a>), <span class="stringliteral">&quot;mball_intlist&quot;</span>);
<a name="l01059"></a>01059                         ints-&gt;<a class="code" href="../../d9/d93/structintlist.html#a22008316cd2518b4463db2ebd7b77b75">i</a> = edge;
<a name="l01060"></a>01060                         ints-&gt;<a class="code" href="../../d9/d93/structintlist.html#aa678c36b92d8ca9d6e79aebf3b605132">next</a> = tmp; <span class="comment">/* add edge to head of list */</span>
<a name="l01061"></a>01061                         
<a name="l01062"></a>01062                         <span class="keywordflow">if</span> (edge == start) <span class="keywordflow">break</span>;
<a name="l01063"></a>01063                         face = <a class="code" href="../../df/dae/BKE__mball_8h.html#a90d648a19e93949f9eef3f8b9fd03971">otherface</a>(edge, face);
<a name="l01064"></a>01064                     }
<a name="l01065"></a>01065                 }
<a name="l01066"></a>01066                 lists-&gt;<a class="code" href="../../d3/df8/structintlists.html#acf058da586a44992db4bf6b8bd893260">list</a> = ints; <span class="comment">/* add ints to head of table entry */</span>
<a name="l01067"></a>01067                 lists-&gt;<a class="code" href="../../d3/df8/structintlists.html#af6afd33fd900817d8aeb30172b3c18f9">next</a> = cubetable[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01068"></a>01068                 cubetable[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = lists;
<a name="l01069"></a>01069             }
<a name="l01070"></a>01070     }
<a name="l01071"></a>01071 }
<a name="l01072"></a>01072 
<a name="l01073"></a><a class="code" href="../../d2/d6c/mball_8c.html#afe16d98c679d5710816fa03bb572685f">01073</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#afe16d98c679d5710816fa03bb572685f">BKE_freecubetable</a>(<span class="keywordtype">void</span>)
<a name="l01074"></a>01074 {
<a name="l01075"></a>01075     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01076"></a>01076     <a class="code" href="../../d3/df8/structintlists.html">INTLISTS</a> *lists, *nlists;
<a name="l01077"></a>01077     <a class="code" href="../../d9/d93/structintlist.html">INTLIST</a> *ints, *nints;
<a name="l01078"></a>01078 
<a name="l01079"></a>01079     <span class="keywordflow">for</span> (i = 0; i &lt; 256; i++) {
<a name="l01080"></a>01080         lists= cubetable[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l01081"></a>01081         <span class="keywordflow">while</span> (lists) {
<a name="l01082"></a>01082             nlists= lists-&gt;<a class="code" href="../../d3/df8/structintlists.html#af6afd33fd900817d8aeb30172b3c18f9">next</a>;
<a name="l01083"></a>01083             
<a name="l01084"></a>01084             ints= lists-&gt;<a class="code" href="../../d3/df8/structintlists.html#acf058da586a44992db4bf6b8bd893260">list</a>;
<a name="l01085"></a>01085             <span class="keywordflow">while</span> (ints) {
<a name="l01086"></a>01086                 nints= ints-&gt;<a class="code" href="../../d9/d93/structintlist.html#aa678c36b92d8ca9d6e79aebf3b605132">next</a>;
<a name="l01087"></a>01087                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ints);
<a name="l01088"></a>01088                 ints= nints;
<a name="l01089"></a>01089             }
<a name="l01090"></a>01090             
<a name="l01091"></a>01091             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(lists);
<a name="l01092"></a>01092             lists= nlists;
<a name="l01093"></a>01093         }
<a name="l01094"></a>01094         cubetable[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01095"></a>01095     }
<a name="l01096"></a>01096 }
<a name="l01097"></a>01097 
<a name="l01098"></a>01098 <span class="comment">/**** Storage ****/</span>
<a name="l01099"></a>01099 
<a name="l01100"></a>01100 <span class="comment">/* setcenter: set (i,j,k) entry of table[]</span>
<a name="l01101"></a>01101 <span class="comment"> * return 1 if already set; otherwise, set and return 0 */</span>
<a name="l01102"></a>01102 
<a name="l01103"></a><a class="code" href="../../d2/d6c/mball_8c.html#ae31a7784233b7632009917308a4c41e1">01103</a> <span class="keywordtype">int</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#ae31a7784233b7632009917308a4c41e1">setcenter</a>(<a class="code" href="../../d2/d34/structcenterlist.html">CENTERLIST</a> *<a class="code" href="../../d7/d35/meshtools_8c.html#ae0806484720dd424e53ea053a3cd1309">table</a>[], <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k)
<a name="l01104"></a>01104 {
<a name="l01105"></a>01105     <span class="keywordtype">int</span> index;
<a name="l01106"></a>01106     <a class="code" href="../../d2/d34/structcenterlist.html">CENTERLIST</a> *newc, *l, *q;
<a name="l01107"></a>01107 
<a name="l01108"></a>01108     index= <a class="code" href="../../d2/d6c/mball_8c.html#a87a01b7715b9a07056ea603a4f7abad0">HASH</a>(i, j, k);
<a name="l01109"></a>01109     q= table[index];
<a name="l01110"></a>01110 
<a name="l01111"></a>01111     <span class="keywordflow">for</span> (l = q; l != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; l = l-&gt;<a class="code" href="../../d2/d34/structcenterlist.html#a8c4e716468aa0713c898aab8902eb7ea">next</a>) {
<a name="l01112"></a>01112         <span class="keywordflow">if</span> (l-&gt;<a class="code" href="../../d2/d34/structcenterlist.html#a0654550eaaedecb15a0ce11bfd086265">i</a> == i &amp;&amp; l-&gt;<a class="code" href="../../d2/d34/structcenterlist.html#aeb066087fe1e21d29e43ada20729e84b">j</a> == j &amp;&amp; l-&gt;<a class="code" href="../../d2/d34/structcenterlist.html#a77465285803cb9f11ccfdd04c57748d9">k</a> == k) <span class="keywordflow">return</span> 1;
<a name="l01113"></a>01113     }
<a name="l01114"></a>01114     
<a name="l01115"></a>01115     newc = (<a class="code" href="../../d2/d34/structcenterlist.html">CENTERLIST</a> *) <a class="code" href="../../df/dae/BKE__mball_8h.html#a96110050b671393c3c26e7ddc3a25286">new_pgn_element</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d2/d34/structcenterlist.html">CENTERLIST</a>));
<a name="l01116"></a>01116     newc-&gt;<a class="code" href="../../d2/d34/structcenterlist.html#a0654550eaaedecb15a0ce11bfd086265">i</a> = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; 
<a name="l01117"></a>01117     newc-&gt;<a class="code" href="../../d2/d34/structcenterlist.html#aeb066087fe1e21d29e43ada20729e84b">j</a> = j; 
<a name="l01118"></a>01118     newc-&gt;<a class="code" href="../../d2/d34/structcenterlist.html#a77465285803cb9f11ccfdd04c57748d9">k</a> = k; 
<a name="l01119"></a>01119     newc-&gt;<a class="code" href="../../d2/d34/structcenterlist.html#a8c4e716468aa0713c898aab8902eb7ea">next</a> = q;
<a name="l01120"></a>01120     table[index] = newc;
<a name="l01121"></a>01121     
<a name="l01122"></a>01122     <span class="keywordflow">return</span> 0;
<a name="l01123"></a>01123 }
<a name="l01124"></a>01124 
<a name="l01125"></a>01125 
<a name="l01126"></a>01126 <span class="comment">/* setedge: set vertex id for edge */</span>
<a name="l01127"></a>01127 
<a name="l01128"></a><a class="code" href="../../d2/d6c/mball_8c.html#a635074d1160e4cf6679cd17e73578f67">01128</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a635074d1160e4cf6679cd17e73578f67">setedge</a> (<a class="code" href="../../d6/d8c/structedgelist.html">EDGELIST</a> *<a class="code" href="../../d7/d35/meshtools_8c.html#ae0806484720dd424e53ea053a3cd1309">table</a>[],
<a name="l01129"></a>01129               <span class="keywordtype">int</span> i1, <span class="keywordtype">int</span> j1,
<a name="l01130"></a>01130               <span class="keywordtype">int</span> k1, <span class="keywordtype">int</span> i2,
<a name="l01131"></a>01131               <span class="keywordtype">int</span> j2, <span class="keywordtype">int</span> k2,
<a name="l01132"></a>01132               <span class="keywordtype">int</span> vid)
<a name="l01133"></a>01133 {
<a name="l01134"></a>01134     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index;
<a name="l01135"></a>01135     <a class="code" href="../../d6/d8c/structedgelist.html">EDGELIST</a> *newe;
<a name="l01136"></a>01136     
<a name="l01137"></a>01137     <span class="keywordflow">if</span> (i1&gt;i2 || (i1==i2 &amp;&amp; (j1&gt;j2 || (j1==j2 &amp;&amp; k1&gt;k2)))) {
<a name="l01138"></a>01138         <span class="keywordtype">int</span> t=i1; 
<a name="l01139"></a>01139         i1=i2; 
<a name="l01140"></a>01140         i2=t; 
<a name="l01141"></a>01141         t=j1; 
<a name="l01142"></a>01142         j1=j2; 
<a name="l01143"></a>01143         j2=t; 
<a name="l01144"></a>01144         t=k1; 
<a name="l01145"></a>01145         k1=k2; 
<a name="l01146"></a>01146         k2=t;
<a name="l01147"></a>01147     }
<a name="l01148"></a>01148     index = <a class="code" href="../../d2/d6c/mball_8c.html#a87a01b7715b9a07056ea603a4f7abad0">HASH</a>(i1, j1, k1) + <a class="code" href="../../d2/d6c/mball_8c.html#a87a01b7715b9a07056ea603a4f7abad0">HASH</a>(i2, j2, k2);
<a name="l01149"></a>01149     newe = (<a class="code" href="../../d6/d8c/structedgelist.html">EDGELIST</a> *) <a class="code" href="../../df/dae/BKE__mball_8h.html#a96110050b671393c3c26e7ddc3a25286">new_pgn_element</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d8c/structedgelist.html">EDGELIST</a>));
<a name="l01150"></a>01150     newe-&gt;<a class="code" href="../../d6/d8c/structedgelist.html#a02d298b501cccc5d2204a56f16f1554d">i1</a> = i1; 
<a name="l01151"></a>01151     newe-&gt;<a class="code" href="../../d6/d8c/structedgelist.html#aed827f30f4fb286eb972fb2660720dc8">j1</a> = j1; 
<a name="l01152"></a>01152     newe-&gt;<a class="code" href="../../d6/d8c/structedgelist.html#a869719710f86fdceb7201d27e12c8521">k1</a> = k1;
<a name="l01153"></a>01153     newe-&gt;<a class="code" href="../../d6/d8c/structedgelist.html#a7a559f60fcc7ec0546b5ea1fc27e99b0">i2</a> = i2; 
<a name="l01154"></a>01154     newe-&gt;<a class="code" href="../../d6/d8c/structedgelist.html#ab2f36375a316b1884813dab605ddad0c">j2</a> = j2; 
<a name="l01155"></a>01155     newe-&gt;<a class="code" href="../../d6/d8c/structedgelist.html#ad47595805f50c2511a4c6c07eb307bbc">k2</a> = k2;
<a name="l01156"></a>01156     newe-&gt;<a class="code" href="../../d6/d8c/structedgelist.html#ae635b1d3b1ce7b15a7322f45d43e4746">vid</a> = vid;
<a name="l01157"></a>01157     newe-&gt;<a class="code" href="../../d6/d8c/structedgelist.html#aed3b3eb00190823410e71e101ef64c03">next</a> = table[index];
<a name="l01158"></a>01158     table[index] = newe;
<a name="l01159"></a>01159 }
<a name="l01160"></a>01160 
<a name="l01161"></a>01161 
<a name="l01162"></a>01162 <span class="comment">/* getedge: return vertex id for edge; return -1 if not set */</span>
<a name="l01163"></a>01163 
<a name="l01164"></a><a class="code" href="../../d2/d6c/mball_8c.html#a048f378ba5342ae743708fd716c2e544">01164</a> <span class="keywordtype">int</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a048f378ba5342ae743708fd716c2e544">getedge</a> (<a class="code" href="../../d6/d8c/structedgelist.html">EDGELIST</a> *<a class="code" href="../../d7/d35/meshtools_8c.html#ae0806484720dd424e53ea053a3cd1309">table</a>[],
<a name="l01165"></a>01165              <span class="keywordtype">int</span> i1, <span class="keywordtype">int</span> j1, <span class="keywordtype">int</span> k1,
<a name="l01166"></a>01166              <span class="keywordtype">int</span> i2, <span class="keywordtype">int</span> j2, <span class="keywordtype">int</span> k2)
<a name="l01167"></a>01167 {
<a name="l01168"></a>01168     <a class="code" href="../../d6/d8c/structedgelist.html">EDGELIST</a> *q;
<a name="l01169"></a>01169     
<a name="l01170"></a>01170     <span class="keywordflow">if</span> (i1&gt;i2 || (i1==i2 &amp;&amp; (j1&gt;j2 || (j1==j2 &amp;&amp; k1&gt;k2)))) {
<a name="l01171"></a>01171         <span class="keywordtype">int</span> t=i1; 
<a name="l01172"></a>01172         i1=i2; 
<a name="l01173"></a>01173         i2=t; 
<a name="l01174"></a>01174         t=j1; 
<a name="l01175"></a>01175         j1=j2; 
<a name="l01176"></a>01176         j2=t; 
<a name="l01177"></a>01177         t=k1; 
<a name="l01178"></a>01178         k1=k2; 
<a name="l01179"></a>01179         k2=t;
<a name="l01180"></a>01180     }
<a name="l01181"></a>01181     q = table[<a class="code" href="../../d2/d6c/mball_8c.html#a87a01b7715b9a07056ea603a4f7abad0">HASH</a>(i1, j1, k1)+<a class="code" href="../../d2/d6c/mball_8c.html#a87a01b7715b9a07056ea603a4f7abad0">HASH</a>(i2, j2, k2)];
<a name="l01182"></a>01182     <span class="keywordflow">for</span> (; q != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; q = q-&gt;<a class="code" href="../../d6/d8c/structedgelist.html#aed3b3eb00190823410e71e101ef64c03">next</a>)
<a name="l01183"></a>01183         <span class="keywordflow">if</span> (q-&gt;<a class="code" href="../../d6/d8c/structedgelist.html#a02d298b501cccc5d2204a56f16f1554d">i1</a> == i1 &amp;&amp; q-&gt;<a class="code" href="../../d6/d8c/structedgelist.html#aed827f30f4fb286eb972fb2660720dc8">j1</a> == j1 &amp;&amp; q-&gt;<a class="code" href="../../d6/d8c/structedgelist.html#a869719710f86fdceb7201d27e12c8521">k1</a> == k1 &amp;&amp;
<a name="l01184"></a>01184             q-&gt;<a class="code" href="../../d6/d8c/structedgelist.html#a7a559f60fcc7ec0546b5ea1fc27e99b0">i2</a> == i2 &amp;&amp; q-&gt;<a class="code" href="../../d6/d8c/structedgelist.html#ab2f36375a316b1884813dab605ddad0c">j2</a> == j2 &amp;&amp; q-&gt;<a class="code" href="../../d6/d8c/structedgelist.html#ad47595805f50c2511a4c6c07eb307bbc">k2</a> == k2)
<a name="l01185"></a>01185             <span class="keywordflow">return</span> q-&gt;<a class="code" href="../../d6/d8c/structedgelist.html#ae635b1d3b1ce7b15a7322f45d43e4746">vid</a>;
<a name="l01186"></a>01186     <span class="keywordflow">return</span> -1;
<a name="l01187"></a>01187 }
<a name="l01188"></a>01188 
<a name="l01189"></a>01189 
<a name="l01190"></a>01190 <span class="comment">/**** Vertices ****/</span>
<a name="l01191"></a>01191 
<a name="l01192"></a>01192 <span class="preprocessor">#undef R</span>
<a name="l01193"></a>01193 <span class="preprocessor"></span>
<a name="l01194"></a>01194 
<a name="l01195"></a>01195 
<a name="l01196"></a>01196 <span class="comment">/* vertid: return index for vertex on edge:</span>
<a name="l01197"></a>01197 <span class="comment"> * c1-&gt;value and c2-&gt;value are presumed of different sign</span>
<a name="l01198"></a>01198 <span class="comment"> * return saved index if any; else compute vertex and save */</span>
<a name="l01199"></a>01199 
<a name="l01200"></a>01200 <span class="comment">/* addtovertices: add v to sequence of vertices */</span>
<a name="l01201"></a>01201 
<a name="l01202"></a><a class="code" href="../../d2/d6c/mball_8c.html#a9905b43af91cf8d48d4869fea2c0a504">01202</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a9905b43af91cf8d48d4869fea2c0a504">addtovertices</a> (<a class="code" href="../../d9/d0b/structvertices.html">VERTICES</a> *<a class="code" href="../../d9/d0b/structvertices.html">vertices</a>, <a class="code" href="../../db/d7c/structvertex.html">VERTEX</a> v)
<a name="l01203"></a>01203 {
<a name="l01204"></a>01204     <span class="keywordflow">if</span> (vertices-&gt;<a class="code" href="../../d9/d0b/structvertices.html#ae251f69ebca5a10d0227d78b476f41d8">count</a> == vertices-&gt;<a class="code" href="../../d9/d0b/structvertices.html#a5e6cc6e62190fe8a47fe5a848ac02c11">max</a>) {
<a name="l01205"></a>01205         <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01206"></a>01206         <a class="code" href="../../db/d7c/structvertex.html">VERTEX</a> *newv;
<a name="l01207"></a>01207         vertices-&gt;<a class="code" href="../../d9/d0b/structvertices.html#a5e6cc6e62190fe8a47fe5a848ac02c11">max</a> = vertices-&gt;<a class="code" href="../../d9/d0b/structvertices.html#ae251f69ebca5a10d0227d78b476f41d8">count</a> == 0 ? 10 : 2*vertices-&gt;<a class="code" href="../../d9/d0b/structvertices.html#ae251f69ebca5a10d0227d78b476f41d8">count</a>;
<a name="l01208"></a>01208         newv = (<a class="code" href="../../db/d7c/structvertex.html">VERTEX</a> *) <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(vertices-&gt;<a class="code" href="../../d9/d0b/structvertices.html#a5e6cc6e62190fe8a47fe5a848ac02c11">max</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../db/d7c/structvertex.html">VERTEX</a>), <span class="stringliteral">&quot;addtovertices&quot;</span>);
<a name="l01209"></a>01209         
<a name="l01210"></a>01210         <span class="keywordflow">for</span> (i = 0; i &lt; vertices-&gt;<a class="code" href="../../d9/d0b/structvertices.html#ae251f69ebca5a10d0227d78b476f41d8">count</a>; i++) newv[i] = vertices-&gt;<a class="code" href="../../d9/d0b/structvertices.html#aa31fd70f91b53a343b8e11297fd57c30">ptr</a>[i];
<a name="l01211"></a>01211         
<a name="l01212"></a>01212         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (vertices-&gt;<a class="code" href="../../d9/d0b/structvertices.html#aa31fd70f91b53a343b8e11297fd57c30">ptr</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(vertices-&gt;<a class="code" href="../../d9/d0b/structvertices.html#aa31fd70f91b53a343b8e11297fd57c30">ptr</a>);
<a name="l01213"></a>01213         vertices-&gt;<a class="code" href="../../d9/d0b/structvertices.html#aa31fd70f91b53a343b8e11297fd57c30">ptr</a> = newv;
<a name="l01214"></a>01214     }
<a name="l01215"></a>01215     vertices-&gt;<a class="code" href="../../d9/d0b/structvertices.html#aa31fd70f91b53a343b8e11297fd57c30">ptr</a>[vertices-&gt;<a class="code" href="../../d9/d0b/structvertices.html#ae251f69ebca5a10d0227d78b476f41d8">count</a>++] = v;
<a name="l01216"></a>01216 }
<a name="l01217"></a>01217 
<a name="l01218"></a>01218 <span class="comment">/* vnormal: compute unit length surface normal at point */</span>
<a name="l01219"></a>01219 
<a name="l01220"></a><a class="code" href="../../d2/d6c/mball_8c.html#aec2d752753646f357110ad531816727d">01220</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#aec2d752753646f357110ad531816727d">vnormal</a> (<a class="code" href="../../d8/dae/structpoint.html">MB_POINT</a> *<a class="code" href="../../d8/dae/structpoint.html">point</a>, <a class="code" href="../../d8/d20/structprocess.html">PROCESS</a> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>, <a class="code" href="../../d8/dae/structpoint.html">MB_POINT</a> *v)
<a name="l01221"></a>01221 {
<a name="l01222"></a>01222     <span class="keywordtype">float</span> delta= 0.2f*p-&gt;<a class="code" href="../../d8/d20/structprocess.html#a7061ae3c95f30e13167a7e9ba161fcd5">delta</a>;
<a name="l01223"></a>01223     <span class="keywordtype">float</span> f = p-&gt;<a class="code" href="../../d8/d20/structprocess.html#aa869826f5c153b5c22a16eeea7a6bb44">function</a>(point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>, point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>, point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>);
<a name="l01224"></a>01224 
<a name="l01225"></a>01225     v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = p-&gt;<a class="code" href="../../d8/d20/structprocess.html#aa869826f5c153b5c22a16eeea7a6bb44">function</a>(point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>+delta, point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>, point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>)-f;
<a name="l01226"></a>01226     v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = p-&gt;<a class="code" href="../../d8/d20/structprocess.html#aa869826f5c153b5c22a16eeea7a6bb44">function</a>(point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>, point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>+delta, point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>)-f;
<a name="l01227"></a>01227     v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> = p-&gt;<a class="code" href="../../d8/d20/structprocess.html#aa869826f5c153b5c22a16eeea7a6bb44">function</a>(point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>, point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>, point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>+delta)-f;
<a name="l01228"></a>01228     f = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a33f9e82220f9ff9453a6557bd04bd8c5">sqrtf</a>(v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>*v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> + v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>*v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> + v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>*v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>);
<a name="l01229"></a>01229 
<a name="l01230"></a>01230     <span class="keywordflow">if</span> (f != 0.0f) {
<a name="l01231"></a>01231         v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> /= f; 
<a name="l01232"></a>01232         v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> /= f; 
<a name="l01233"></a>01233         v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> /= f;
<a name="l01234"></a>01234     }
<a name="l01235"></a>01235     
<a name="l01236"></a>01236     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) {
<a name="l01237"></a>01237         <a class="code" href="../../d8/dae/structpoint.html">MB_POINT</a> temp;
<a name="l01238"></a>01238         
<a name="l01239"></a>01239         delta *= 2.0f;
<a name="l01240"></a>01240         
<a name="l01241"></a>01241         f = p-&gt;<a class="code" href="../../d8/d20/structprocess.html#aa869826f5c153b5c22a16eeea7a6bb44">function</a>(point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>, point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>, point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>);
<a name="l01242"></a>01242     
<a name="l01243"></a>01243         temp.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = p-&gt;<a class="code" href="../../d8/d20/structprocess.html#aa869826f5c153b5c22a16eeea7a6bb44">function</a>(point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>+delta, point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>, point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>)-f;
<a name="l01244"></a>01244         temp.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = p-&gt;<a class="code" href="../../d8/d20/structprocess.html#aa869826f5c153b5c22a16eeea7a6bb44">function</a>(point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>, point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>+delta, point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>)-f;
<a name="l01245"></a>01245         temp.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> = p-&gt;<a class="code" href="../../d8/d20/structprocess.html#aa869826f5c153b5c22a16eeea7a6bb44">function</a>(point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>, point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>, point-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>+delta)-f;
<a name="l01246"></a>01246         f = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a33f9e82220f9ff9453a6557bd04bd8c5">sqrtf</a>(temp.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>*temp.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> + temp.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>*temp.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> + temp.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>*temp.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>);
<a name="l01247"></a>01247     
<a name="l01248"></a>01248         <span class="keywordflow">if</span> (f != 0.0f) {
<a name="l01249"></a>01249             temp.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> /= f; 
<a name="l01250"></a>01250             temp.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> /= f; 
<a name="l01251"></a>01251             temp.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> /= f;
<a name="l01252"></a>01252             
<a name="l01253"></a>01253             v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>+= temp.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>;
<a name="l01254"></a>01254             v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>+= temp.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>;
<a name="l01255"></a>01255             v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>+= temp.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>;
<a name="l01256"></a>01256             
<a name="l01257"></a>01257             f = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a33f9e82220f9ff9453a6557bd04bd8c5">sqrtf</a>(v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>*v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> + v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>*v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> + v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>*v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>);
<a name="l01258"></a>01258         
<a name="l01259"></a>01259             <span class="keywordflow">if</span> (f != 0.0f) {
<a name="l01260"></a>01260                 v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> /= f; 
<a name="l01261"></a>01261                 v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> /= f; 
<a name="l01262"></a>01262                 v-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> /= f;
<a name="l01263"></a>01263             }
<a name="l01264"></a>01264         }
<a name="l01265"></a>01265     }
<a name="l01266"></a>01266     
<a name="l01267"></a>01267 }
<a name="l01268"></a>01268 
<a name="l01269"></a>01269 
<a name="l01270"></a><a class="code" href="../../d2/d6c/mball_8c.html#ac4996a3e33afa0b5a331ea13cf215c94">01270</a> <span class="keywordtype">int</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#aacaaf457cf01c422849545ceb5a16d7c">vertid</a> (<a class="code" href="../../d5/d7a/structcorner.html">CORNER</a> *c1, <a class="code" href="../../d5/d7a/structcorner.html">CORNER</a> *c2, <a class="code" href="../../d8/d20/structprocess.html">PROCESS</a> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>, <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb)
<a name="l01271"></a>01271 {
<a name="l01272"></a>01272     <a class="code" href="../../db/d7c/structvertex.html">VERTEX</a> v;
<a name="l01273"></a>01273     <a class="code" href="../../d8/dae/structpoint.html">MB_POINT</a> a, b;
<a name="l01274"></a>01274     <span class="keywordtype">int</span> vid = <a class="code" href="../../df/dae/BKE__mball_8h.html#a048f378ba5342ae743708fd716c2e544">getedge</a>(p-&gt;<a class="code" href="../../d8/d20/structprocess.html#a31eb04bb61ee3f2d3e8218109112e3c2">edges</a>, c1-&gt;<a class="code" href="../../d5/d7a/structcorner.html#ad554584e8c3b48779cabb3e59da6a112">i</a>, c1-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a818b66ff98bf426b3b8479258a6fe772">j</a>, c1-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a20827bf5c23b190c383d6b65fb402027">k</a>, c2-&gt;<a class="code" href="../../d5/d7a/structcorner.html#ad554584e8c3b48779cabb3e59da6a112">i</a>, c2-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a818b66ff98bf426b3b8479258a6fe772">j</a>, c2-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a20827bf5c23b190c383d6b65fb402027">k</a>);
<a name="l01275"></a>01275 
<a name="l01276"></a>01276     <span class="keywordflow">if</span> (vid != -1) <span class="keywordflow">return</span> vid;               <span class="comment">/* previously computed */</span>
<a name="l01277"></a>01277     a.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = c1-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a71d01533adaf1cdf5dfcca575ab27570">x</a>; 
<a name="l01278"></a>01278     a.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = c1-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a7ae334887d1f6ff7223781649c73afb7">y</a>; 
<a name="l01279"></a>01279     a.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> = c1-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a3df637e8d344fe21f91eb18a888a1f81">z</a>;
<a name="l01280"></a>01280     b.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = c2-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a71d01533adaf1cdf5dfcca575ab27570">x</a>; 
<a name="l01281"></a>01281     b.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = c2-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a7ae334887d1f6ff7223781649c73afb7">y</a>; 
<a name="l01282"></a>01282     b.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> = c2-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a3df637e8d344fe21f91eb18a888a1f81">z</a>;
<a name="l01283"></a>01283 
<a name="l01284"></a>01284     <a class="code" href="../../df/dae/BKE__mball_8h.html#a7f9e07fa28cdc556723c6254738580fb">converge</a>(&amp;a, &amp;b, c1-&gt;<a class="code" href="../../d5/d7a/structcorner.html#ac4d3dda7d0029094a9211b2570848a04">value</a>, c2-&gt;<a class="code" href="../../d5/d7a/structcorner.html#ac4d3dda7d0029094a9211b2570848a04">value</a>, p-&gt;<a class="code" href="../../d8/d20/structprocess.html#aa869826f5c153b5c22a16eeea7a6bb44">function</a>, &amp;v.<a class="code" href="../../db/d7c/structvertex.html#a82eb4df764c653c70ade447feb8092d8">position</a>, mb, 1); <span class="comment">/* position */</span>
<a name="l01285"></a>01285     <a class="code" href="../../df/dae/BKE__mball_8h.html#aec2d752753646f357110ad531816727d">vnormal</a>(&amp;v.<a class="code" href="../../db/d7c/structvertex.html#a82eb4df764c653c70ade447feb8092d8">position</a>, p, &amp;v.<a class="code" href="../../db/d7c/structvertex.html#ae912c230fbda01a841109dc9f836c5ef">normal</a>);
<a name="l01286"></a>01286 
<a name="l01287"></a>01287     <a class="code" href="../../df/dae/BKE__mball_8h.html#a9905b43af91cf8d48d4869fea2c0a504">addtovertices</a>(&amp;p-&gt;<a class="code" href="../../d8/d20/structprocess.html#aebd6d1255f648e618754613b69138cc6">vertices</a>, v);            <span class="comment">/* save vertex */</span>
<a name="l01288"></a>01288     vid = p-&gt;<a class="code" href="../../d8/d20/structprocess.html#aebd6d1255f648e618754613b69138cc6">vertices</a>.<a class="code" href="../../d9/d0b/structvertices.html#ae251f69ebca5a10d0227d78b476f41d8">count</a>-1;
<a name="l01289"></a>01289     <a class="code" href="../../df/dae/BKE__mball_8h.html#a635074d1160e4cf6679cd17e73578f67">setedge</a>(p-&gt;<a class="code" href="../../d8/d20/structprocess.html#a31eb04bb61ee3f2d3e8218109112e3c2">edges</a>, c1-&gt;<a class="code" href="../../d5/d7a/structcorner.html#ad554584e8c3b48779cabb3e59da6a112">i</a>, c1-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a818b66ff98bf426b3b8479258a6fe772">j</a>, c1-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a20827bf5c23b190c383d6b65fb402027">k</a>, c2-&gt;<a class="code" href="../../d5/d7a/structcorner.html#ad554584e8c3b48779cabb3e59da6a112">i</a>, c2-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a818b66ff98bf426b3b8479258a6fe772">j</a>, c2-&gt;<a class="code" href="../../d5/d7a/structcorner.html#a20827bf5c23b190c383d6b65fb402027">k</a>, vid);
<a name="l01290"></a>01290     
<a name="l01291"></a>01291     <span class="keywordflow">return</span> vid;
<a name="l01292"></a>01292 }
<a name="l01293"></a>01293 
<a name="l01294"></a>01294 
<a name="l01295"></a>01295 
<a name="l01296"></a>01296 
<a name="l01297"></a>01297 <span class="comment">/* converge: from two points of differing sign, converge to zero crossing */</span>
<a name="l01298"></a>01298 <span class="comment">/* watch it: p1 and p2 are used to calculate */</span>
<a name="l01299"></a><a class="code" href="../../d2/d6c/mball_8c.html#a5eeb98ceebe717269f77940e2d96862d">01299</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a7f9e07fa28cdc556723c6254738580fb">converge</a> (<a class="code" href="../../d8/dae/structpoint.html">MB_POINT</a> *p1, <a class="code" href="../../d8/dae/structpoint.html">MB_POINT</a> *p2, <span class="keywordtype">float</span> v1, <span class="keywordtype">float</span> v2,
<a name="l01300"></a>01300                <span class="keywordtype">float</span> (*function)(<span class="keywordtype">float</span>, <span class="keywordtype">float</span>, <span class="keywordtype">float</span>), <a class="code" href="../../d8/dae/structpoint.html">MB_POINT</a> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>, <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb, <span class="keywordtype">int</span> f)
<a name="l01301"></a>01301 {
<a name="l01302"></a>01302     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;
<a name="l01303"></a>01303     <a class="code" href="../../d8/dae/structpoint.html">MB_POINT</a> pos, neg;
<a name="l01304"></a>01304     <span class="keywordtype">float</span> positive = 0.0f, negative = 0.0f;
<a name="l01305"></a>01305     <span class="keywordtype">float</span> dx = 0.0f ,dy = 0.0f ,dz = 0.0f;
<a name="l01306"></a>01306     
<a name="l01307"></a>01307     <span class="keywordflow">if</span> (v1 &lt; 0) {
<a name="l01308"></a>01308         pos= *p2;
<a name="l01309"></a>01309         neg= *p1;
<a name="l01310"></a>01310         positive = v2;
<a name="l01311"></a>01311         negative = v1;
<a name="l01312"></a>01312     }
<a name="l01313"></a>01313     <span class="keywordflow">else</span> {
<a name="l01314"></a>01314         pos= *p1;
<a name="l01315"></a>01315         neg= *p2;
<a name="l01316"></a>01316         positive = v1;
<a name="l01317"></a>01317         negative = v2;
<a name="l01318"></a>01318     }
<a name="l01319"></a>01319 
<a name="l01320"></a>01320     dx = pos.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> - neg.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>;
<a name="l01321"></a>01321     dy = pos.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> - neg.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>;
<a name="l01322"></a>01322     dz = pos.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> - neg.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>;
<a name="l01323"></a>01323 
<a name="l01324"></a>01324 <span class="comment">/* Approximation by linear interpolation is faster then binary subdivision,</span>
<a name="l01325"></a>01325 <span class="comment"> * but it results sometimes (mb-&gt;thresh &lt; 0.2) into the strange results */</span>
<a name="l01326"></a>01326     <span class="keywordflow">if</span> ((mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a1780a871c75eb9be17bcfd521c4b883d">thresh</a> &gt; 0.2f) &amp;&amp; (f==1)) {
<a name="l01327"></a>01327     <span class="keywordflow">if</span> ((dy == 0.0f) &amp;&amp; (dz == 0.0f)) {
<a name="l01328"></a>01328         p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = neg.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> - negative*dx/(positive-negative);
<a name="l01329"></a>01329         p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = neg.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>;
<a name="l01330"></a>01330         p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> = neg.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>;
<a name="l01331"></a>01331         <span class="keywordflow">return</span>;
<a name="l01332"></a>01332     }
<a name="l01333"></a>01333       <span class="keywordflow">if</span> ((dx == 0.0f) &amp;&amp; (dz == 0.0f)) {
<a name="l01334"></a>01334         p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = neg.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>;
<a name="l01335"></a>01335         p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = neg.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> - negative*dy/(positive-negative);
<a name="l01336"></a>01336         p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> = neg.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>;
<a name="l01337"></a>01337         <span class="keywordflow">return</span>;
<a name="l01338"></a>01338     }
<a name="l01339"></a>01339     <span class="keywordflow">if</span> ((dx == 0.0f) &amp;&amp; (dy == 0.0f)) {
<a name="l01340"></a>01340         p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = neg.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>;
<a name="l01341"></a>01341         p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = neg.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>;
<a name="l01342"></a>01342         p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> = neg.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> - negative*dz/(positive-negative);
<a name="l01343"></a>01343         <span class="keywordflow">return</span>;
<a name="l01344"></a>01344     }
<a name="l01345"></a>01345     }
<a name="l01346"></a>01346 
<a name="l01347"></a>01347     <span class="keywordflow">if</span> ((dy == 0.0f) &amp;&amp; (dz == 0.0f)) {
<a name="l01348"></a>01348         p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = neg.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>;
<a name="l01349"></a>01349         p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> = neg.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>;
<a name="l01350"></a>01350         <span class="keywordflow">while</span> (1) {
<a name="l01351"></a>01351             <span class="keywordflow">if</span> (i++ == <a class="code" href="../../d2/d6c/mball_8c.html#a65b26605d90a0bcd0e13e05db54f551f">RES</a>) <span class="keywordflow">return</span>;
<a name="l01352"></a>01352             p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = 0.5f*(pos.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> + neg.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>);
<a name="l01353"></a>01353             <span class="keywordflow">if</span> ((function(p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>,p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>,p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>)) &gt; 0.0f)  pos.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>; <span class="keywordflow">else</span> neg.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>;
<a name="l01354"></a>01354         }
<a name="l01355"></a>01355     }
<a name="l01356"></a>01356 
<a name="l01357"></a>01357     <span class="keywordflow">if</span> ((dx == 0.0f) &amp;&amp; (dz == 0.0f)) {
<a name="l01358"></a>01358         p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = neg.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>;
<a name="l01359"></a>01359         p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> = neg.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>;
<a name="l01360"></a>01360         <span class="keywordflow">while</span> (1) {
<a name="l01361"></a>01361             <span class="keywordflow">if</span> (i++ == <a class="code" href="../../d2/d6c/mball_8c.html#a65b26605d90a0bcd0e13e05db54f551f">RES</a>) <span class="keywordflow">return</span>;
<a name="l01362"></a>01362             p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = 0.5f*(pos.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> + neg.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>);
<a name="l01363"></a>01363             <span class="keywordflow">if</span> ((function(p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>,p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>,p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>)) &gt; 0.0f)  pos.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>; <span class="keywordflow">else</span> neg.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>;
<a name="l01364"></a>01364         }
<a name="l01365"></a>01365       }
<a name="l01366"></a>01366    
<a name="l01367"></a>01367     <span class="keywordflow">if</span> ((dx == 0.0f) &amp;&amp; (dy == 0.0f)) {
<a name="l01368"></a>01368         p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = neg.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>;
<a name="l01369"></a>01369         p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = neg.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>;
<a name="l01370"></a>01370         <span class="keywordflow">while</span> (1) {
<a name="l01371"></a>01371             <span class="keywordflow">if</span> (i++ == <a class="code" href="../../d2/d6c/mball_8c.html#a65b26605d90a0bcd0e13e05db54f551f">RES</a>) <span class="keywordflow">return</span>;
<a name="l01372"></a>01372             p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> = 0.5f*(pos.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> + neg.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>);
<a name="l01373"></a>01373             <span class="keywordflow">if</span> ((function(p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>,p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>,p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>)) &gt; 0.0f)  pos.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> = p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>; <span class="keywordflow">else</span> neg.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> = p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>;
<a name="l01374"></a>01374         }
<a name="l01375"></a>01375     }
<a name="l01376"></a>01376 
<a name="l01377"></a>01377     <span class="comment">/* This is necessary to find start point */</span>
<a name="l01378"></a>01378     <span class="keywordflow">while</span> (1) {
<a name="l01379"></a>01379         p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = 0.5f*(pos.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> + neg.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>);
<a name="l01380"></a>01380         p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = 0.5f*(pos.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> + neg.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>);
<a name="l01381"></a>01381         p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> = 0.5f*(pos.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> + neg.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>);
<a name="l01382"></a>01382 
<a name="l01383"></a>01383         <span class="keywordflow">if</span> (i++ == <a class="code" href="../../d2/d6c/mball_8c.html#a65b26605d90a0bcd0e13e05db54f551f">RES</a>) <span class="keywordflow">return</span>;
<a name="l01384"></a>01384    
<a name="l01385"></a>01385         <span class="keywordflow">if</span> ((function(p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>, p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>, p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>)) &gt; 0.0f) {
<a name="l01386"></a>01386             pos.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>;
<a name="l01387"></a>01387             pos.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>;
<a name="l01388"></a>01388             pos.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> = p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>;
<a name="l01389"></a>01389         }
<a name="l01390"></a>01390         <span class="keywordflow">else</span> {
<a name="l01391"></a>01391             neg.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>;
<a name="l01392"></a>01392             neg.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>;
<a name="l01393"></a>01393             neg.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> = p-&gt;<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>;
<a name="l01394"></a>01394         }
<a name="l01395"></a>01395     }
<a name="l01396"></a>01396 }
<a name="l01397"></a>01397 
<a name="l01398"></a>01398 <span class="comment">/* ************************************** */</span>
<a name="l01399"></a><a class="code" href="../../d2/d6c/mball_8c.html#a53ab1d37bc58ae4505af5d62a7fa609a">01399</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a53ab1d37bc58ae4505af5d62a7fa609a">add_cube</a>(<a class="code" href="../../d8/d20/structprocess.html">PROCESS</a> *mbproc, <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">int</span> count)
<a name="l01400"></a>01400 {
<a name="l01401"></a>01401     <a class="code" href="../../da/de9/structcubes.html">CUBES</a> *ncube;
<a name="l01402"></a>01402     <span class="keywordtype">int</span> n;
<a name="l01403"></a>01403     <span class="keywordtype">int</span> a, b, c;
<a name="l01404"></a>01404 
<a name="l01405"></a>01405     <span class="comment">/* hmmm, not only one, but eight cube will be added on the stack </span>
<a name="l01406"></a>01406 <span class="comment">     * ... */</span>
<a name="l01407"></a>01407     <span class="keywordflow">for</span> (a=i-1; a&lt;i+count; a++)
<a name="l01408"></a>01408         <span class="keywordflow">for</span> (b=j-1; b&lt;j+count; b++)
<a name="l01409"></a>01409             <span class="keywordflow">for</span> (c=k-1; c&lt;k+count; c++) {
<a name="l01410"></a>01410                 <span class="comment">/* test if cube has been found before */</span>
<a name="l01411"></a>01411                 <span class="keywordflow">if</span> ( <a class="code" href="../../df/dae/BKE__mball_8h.html#ae31a7784233b7632009917308a4c41e1">setcenter</a>(mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#ab4465b7a1892851ebfe9b665ecd797ef">centers</a>, a, b, c)==0 ) {
<a name="l01412"></a>01412                     <span class="comment">/* push cube on stack: */</span>
<a name="l01413"></a>01413                     ncube= (<a class="code" href="../../da/de9/structcubes.html">CUBES</a> *) <a class="code" href="../../df/dae/BKE__mball_8h.html#a96110050b671393c3c26e7ddc3a25286">new_pgn_element</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/de9/structcubes.html">CUBES</a>));
<a name="l01414"></a>01414                     ncube-&gt;<a class="code" href="../../da/de9/structcubes.html#a40a3f4af08f68689644f932458873304">next</a>= mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#ae132fb3ae2da26633e0452b6e846ada8">cubes</a>;
<a name="l01415"></a>01415                     mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#ae132fb3ae2da26633e0452b6e846ada8">cubes</a>= ncube;
<a name="l01416"></a>01416 
<a name="l01417"></a>01417                     ncube-&gt;<a class="code" href="../../da/de9/structcubes.html#abe54f8919e9c65c601ac8aba52529ec1">cube</a>.<a class="code" href="../../df/d81/structcube.html#aeb3c618a61a9ffe4d5fb2c74bc5aa2a0">i</a>= a;
<a name="l01418"></a>01418                     ncube-&gt;<a class="code" href="../../da/de9/structcubes.html#abe54f8919e9c65c601ac8aba52529ec1">cube</a>.<a class="code" href="../../df/d81/structcube.html#afbbc026f5003816eb1e7c44bdcf9f54a">j</a>= b;
<a name="l01419"></a>01419                     ncube-&gt;<a class="code" href="../../da/de9/structcubes.html#abe54f8919e9c65c601ac8aba52529ec1">cube</a>.<a class="code" href="../../df/d81/structcube.html#a614bd77c99fb9a1a100665775ee02728">k</a>= c;
<a name="l01420"></a>01420 
<a name="l01421"></a>01421                     <span class="comment">/* set corners of initial cube: */</span>
<a name="l01422"></a>01422                     <span class="keywordflow">for</span> (n = 0; n &lt; 8; n++)
<a name="l01423"></a>01423                     ncube-&gt;<a class="code" href="../../da/de9/structcubes.html#abe54f8919e9c65c601ac8aba52529ec1">cube</a>.<a class="code" href="../../df/d81/structcube.html#acd34000dcaa77cb5a26b40026bd9427e">corners</a>[n] = <a class="code" href="../../df/dae/BKE__mball_8h.html#aa6cb120f0ee213ee460fbe0eb7dbe0b2">setcorner</a>(mbproc, a+<a class="code" href="../../d2/d6c/mball_8c.html#abeee01da3e6b645a8d4c3513f4d4a7dd">MB_BIT</a>(n,2), b+<a class="code" href="../../d2/d6c/mball_8c.html#abeee01da3e6b645a8d4c3513f4d4a7dd">MB_BIT</a>(n,1), c+<a class="code" href="../../d2/d6c/mball_8c.html#abeee01da3e6b645a8d4c3513f4d4a7dd">MB_BIT</a>(n,0));
<a name="l01424"></a>01424                 }
<a name="l01425"></a>01425             }
<a name="l01426"></a>01426 }
<a name="l01427"></a>01427 
<a name="l01428"></a>01428 
<a name="l01429"></a><a class="code" href="../../d2/d6c/mball_8c.html#ab13f2225830022052ef6b701f2c164ef">01429</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#aac43b8ee33027a61ed4aad488960712d">find_first_points</a>(<a class="code" href="../../d8/d20/structprocess.html">PROCESS</a> *mbproc, <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb, <span class="keywordtype">int</span> a)
<a name="l01430"></a>01430 {
<a name="l01431"></a>01431     <a class="code" href="../../d8/dae/structpoint.html">MB_POINT</a> <a class="code" href="../../da/dd5/BOP__Tag_8h.html#aa9cb80513c72cd93e51903ed7ed2b8a6af3180515f5867a29932df1dc207b31ad">IN</a>, in, <a class="code" href="../../da/dd5/BOP__Tag_8h.html#aa9cb80513c72cd93e51903ed7ed2b8a6ac72cb4ba9e379a25e80f157177dbe2b8">OUT</a>, out; <span class="comment">/*point;*/</span>
<a name="l01432"></a>01432     <a class="code" href="../../de/d87/structMetaElem.html">MetaElem</a> *ml;
<a name="l01433"></a>01433     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j, k, c_i, c_j, c_k;
<a name="l01434"></a>01434     <span class="keywordtype">int</span> index[3]={1,0,-1};
<a name="l01435"></a>01435     <span class="keywordtype">float</span> f =0.0f;
<a name="l01436"></a>01436     <span class="keywordtype">float</span> in_v <span class="comment">/*, out_v*/</span>;
<a name="l01437"></a>01437     <a class="code" href="../../d8/dae/structpoint.html">MB_POINT</a> workp;
<a name="l01438"></a>01438     <span class="keywordtype">float</span> tmp_v, workp_v, max_len, <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>, dx, dy, dz, nx, ny, nz, MAXN;
<a name="l01439"></a>01439 
<a name="l01440"></a>01440     ml = mainb[a];
<a name="l01441"></a>01441 
<a name="l01442"></a>01442     f = 1-(mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a1780a871c75eb9be17bcfd521c4b883d">thresh</a>/ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#ab77dbffce529c16d46d8b202b2b535ca">s</a>);
<a name="l01443"></a>01443 
<a name="l01444"></a>01444     <span class="comment">/* Skip, when Stiffness of MetaElement is too small ... MetaElement can&#39;t be</span>
<a name="l01445"></a>01445 <span class="comment">     * visible alone ... but still can influence others MetaElements :-) */</span>
<a name="l01446"></a>01446     <span class="keywordflow">if</span> (f &gt; 0.0f) {
<a name="l01447"></a>01447         OUT.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = IN.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = in.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>= 0.0;
<a name="l01448"></a>01448         OUT.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = IN.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = in.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>= 0.0;
<a name="l01449"></a>01449         OUT.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> = IN.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> = in.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>= 0.0;
<a name="l01450"></a>01450 
<a name="l01451"></a>01451         <a class="code" href="../../df/dae/BKE__mball_8h.html#aa628449644542b634b63c99f8fa8271f">calc_mballco</a>(ml, (<span class="keywordtype">float</span> *)&amp;in);
<a name="l01452"></a>01452         in_v = mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#aa869826f5c153b5c22a16eeea7a6bb44">function</a>(in.x, in.y, in.z);
<a name="l01453"></a>01453 
<a name="l01454"></a>01454         <span class="keywordflow">for</span> (i=0;i&lt;3;i++) {
<a name="l01455"></a>01455             <span class="keywordflow">switch</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a4522d9cfa0ff3307693b29f206a2dcc4">type</a>) {
<a name="l01456"></a>01456                 <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a1589e65546da77af1d7050c8c69b8ae3">MB_BALL</a>:
<a name="l01457"></a>01457                     OUT.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = out.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>= IN.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> + index[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]*ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a>;
<a name="l01458"></a>01458                     <span class="keywordflow">break</span>;
<a name="l01459"></a>01459                 <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a24efce3a8a3a16764fcc1f5638e884a3">MB_TUBE</a>:
<a name="l01460"></a>01460                 <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#ac3b41055b5fa6e2ac4556241255a70de">MB_PLANE</a>:
<a name="l01461"></a>01461                 <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a66e16e57a590239af16fdaf958cc476a">MB_ELIPSOID</a>:
<a name="l01462"></a>01462                 <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#af61a277733578a6e4e42e11ca6b30835">MB_CUBE</a>:
<a name="l01463"></a>01463                     OUT.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = out.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>= IN.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> + index[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]*(ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a> + ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a>);
<a name="l01464"></a>01464                     <span class="keywordflow">break</span>;
<a name="l01465"></a>01465             }
<a name="l01466"></a>01466 
<a name="l01467"></a>01467             <span class="keywordflow">for</span> (j=0;j&lt;3;j++) {
<a name="l01468"></a>01468                 <span class="keywordflow">switch</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a4522d9cfa0ff3307693b29f206a2dcc4">type</a>) {
<a name="l01469"></a>01469                     <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a1589e65546da77af1d7050c8c69b8ae3">MB_BALL</a>:
<a name="l01470"></a>01470                         OUT.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = out.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>= IN.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> + index[j]*ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a>;
<a name="l01471"></a>01471                         <span class="keywordflow">break</span>;
<a name="l01472"></a>01472                     <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a24efce3a8a3a16764fcc1f5638e884a3">MB_TUBE</a>:
<a name="l01473"></a>01473                     <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#ac3b41055b5fa6e2ac4556241255a70de">MB_PLANE</a>:
<a name="l01474"></a>01474                     <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a66e16e57a590239af16fdaf958cc476a">MB_ELIPSOID</a>:
<a name="l01475"></a>01475                     <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#af61a277733578a6e4e42e11ca6b30835">MB_CUBE</a>:
<a name="l01476"></a>01476                         OUT.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = out.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>= IN.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> + index[j]*(ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a> + ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a>);
<a name="l01477"></a>01477                         <span class="keywordflow">break</span>;
<a name="l01478"></a>01478                 }
<a name="l01479"></a>01479             
<a name="l01480"></a>01480                 <span class="keywordflow">for</span> (k=0;k&lt;3;k++) {
<a name="l01481"></a>01481                     out.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = OUT.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>;
<a name="l01482"></a>01482                     out.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = OUT.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>;
<a name="l01483"></a>01483                     <span class="keywordflow">switch</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a4522d9cfa0ff3307693b29f206a2dcc4">type</a>) {
<a name="l01484"></a>01484                         <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a1589e65546da77af1d7050c8c69b8ae3">MB_BALL</a>:
<a name="l01485"></a>01485                         <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a24efce3a8a3a16764fcc1f5638e884a3">MB_TUBE</a>:
<a name="l01486"></a>01486                         <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#ac3b41055b5fa6e2ac4556241255a70de">MB_PLANE</a>:
<a name="l01487"></a>01487                             out.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>= IN.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> + index[k]*ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a>;
<a name="l01488"></a>01488                             <span class="keywordflow">break</span>;
<a name="l01489"></a>01489                         <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a66e16e57a590239af16fdaf958cc476a">MB_ELIPSOID</a>:
<a name="l01490"></a>01490                         <span class="keywordflow">case</span> <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#af61a277733578a6e4e42e11ca6b30835">MB_CUBE</a>:
<a name="l01491"></a>01491                             out.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>= IN.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> + index[k]*(ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a781a391ca94eb183538d95aa4b84cd0b">expz</a> + ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a>);
<a name="l01492"></a>01492                             <span class="keywordflow">break</span>;
<a name="l01493"></a>01493                     }
<a name="l01494"></a>01494 
<a name="l01495"></a>01495                     <a class="code" href="../../df/dae/BKE__mball_8h.html#aa628449644542b634b63c99f8fa8271f">calc_mballco</a>(ml, (<span class="keywordtype">float</span> *)&amp;out);
<a name="l01496"></a>01496 
<a name="l01497"></a>01497                     <span class="comment">/*out_v = mbproc-&gt;function(out.x, out.y, out.z);*/</span> <span class="comment">/*UNUSED*/</span>
<a name="l01498"></a>01498 
<a name="l01499"></a>01499                     <span class="comment">/* find &quot;first points&quot; on Implicit Surface of MetaElemnt ml */</span>
<a name="l01500"></a>01500                     workp.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> = in.x;
<a name="l01501"></a>01501                     workp.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> = in.y;
<a name="l01502"></a>01502                     workp.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> = in.z;
<a name="l01503"></a>01503                     workp_v = in_v;
<a name="l01504"></a>01504                     max_len = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a33f9e82220f9ff9453a6557bd04bd8c5">sqrtf</a>((out.x-in.x)*(out.x-in.x) + (out.y-in.y)*(out.y-in.y) + (out.z-in.z)*(out.z-in.z));
<a name="l01505"></a>01505 
<a name="l01506"></a>01506                     nx = <a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>((out.x - in.x)/mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#a6e8c8f8c7f35216fc9bbeeaf74faeccd">size</a>);
<a name="l01507"></a>01507                     ny = <a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>((out.y - in.y)/mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#a6e8c8f8c7f35216fc9bbeeaf74faeccd">size</a>);
<a name="l01508"></a>01508                     nz = <a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>((out.z - in.z)/mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#a6e8c8f8c7f35216fc9bbeeaf74faeccd">size</a>);
<a name="l01509"></a>01509                     
<a name="l01510"></a>01510                     MAXN = <a class="code" href="../../dd/d46/IMAGE_8h.html#a87a519a4901f827aca98fa11601a739c">MAX3</a>(nx,ny,nz);
<a name="l01511"></a>01511                     <span class="keywordflow">if</span> (MAXN!=0.0f) {
<a name="l01512"></a>01512                         dx = (out.x - in.x)/MAXN;
<a name="l01513"></a>01513                         dy = (out.y - in.y)/MAXN;
<a name="l01514"></a>01514                         dz = (out.z - in.z)/MAXN;
<a name="l01515"></a>01515 
<a name="l01516"></a>01516                         len = 0.0;
<a name="l01517"></a>01517                         <span class="keywordflow">while</span> (len&lt;=max_len) {
<a name="l01518"></a>01518                             workp.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a> += dx;
<a name="l01519"></a>01519                             workp.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a> += dy;
<a name="l01520"></a>01520                             workp.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a> += dz;
<a name="l01521"></a>01521                             <span class="comment">/* compute value of implicite function */</span>
<a name="l01522"></a>01522                             tmp_v = mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#aa869826f5c153b5c22a16eeea7a6bb44">function</a>(workp.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>, workp.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>, workp.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>);
<a name="l01523"></a>01523                             <span class="comment">/* add cube to the stack, when value of implicite function crosses zero value */</span>
<a name="l01524"></a>01524                             <span class="keywordflow">if</span> ((tmp_v&lt;0.0f &amp;&amp; workp_v&gt;=0.0f)||(tmp_v&gt;0.0f &amp;&amp; workp_v&lt;=0.0f)) {
<a name="l01525"></a>01525 
<a name="l01526"></a>01526                                 <span class="comment">/* indexes of CUBE, which includes &quot;first point&quot; */</span>
<a name="l01527"></a>01527                                 c_i= (int)floor(workp.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>/mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#a6e8c8f8c7f35216fc9bbeeaf74faeccd">size</a>);
<a name="l01528"></a>01528                                 c_j= (int)floor(workp.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>/mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#a6e8c8f8c7f35216fc9bbeeaf74faeccd">size</a>);
<a name="l01529"></a>01529                                 c_k= (int)floor(workp.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>/mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#a6e8c8f8c7f35216fc9bbeeaf74faeccd">size</a>);
<a name="l01530"></a>01530                                 
<a name="l01531"></a>01531                                 <span class="comment">/* add CUBE (with indexes c_i, c_j, c_k) to the stack,</span>
<a name="l01532"></a>01532 <span class="comment">                                 * this cube includes found point of Implicit Surface */</span>
<a name="l01533"></a>01533                                 <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#afcd96395129ff8fdd4006c8ea5cb4915">flag</a> &amp; <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a7cbd8ff38c4022078d47cee819de0639">MB_NEGATIVE</a>)
<a name="l01534"></a>01534                                     <a class="code" href="../../df/dae/BKE__mball_8h.html#a53ab1d37bc58ae4505af5d62a7fa609a">add_cube</a>(mbproc, c_i, c_j, c_k, 2);
<a name="l01535"></a>01535                                 <span class="keywordflow">else</span>
<a name="l01536"></a>01536                                     <a class="code" href="../../df/dae/BKE__mball_8h.html#a53ab1d37bc58ae4505af5d62a7fa609a">add_cube</a>(mbproc, c_i, c_j, c_k, 1);
<a name="l01537"></a>01537                             }
<a name="l01538"></a>01538                             len = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a33f9e82220f9ff9453a6557bd04bd8c5">sqrtf</a>((workp.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>-in.x)*(workp.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>-in.x) + (workp.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>-in.y)*(workp.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>-in.y) + (workp.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>-in.z)*(workp.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>-in.z));
<a name="l01539"></a>01539                             workp_v = tmp_v;
<a name="l01540"></a>01540 
<a name="l01541"></a>01541                         }
<a name="l01542"></a>01542                     }
<a name="l01543"></a>01543                 }
<a name="l01544"></a>01544             }
<a name="l01545"></a>01545         }
<a name="l01546"></a>01546     }
<a name="l01547"></a>01547 }
<a name="l01548"></a>01548 
<a name="l01549"></a><a class="code" href="../../d2/d6c/mball_8c.html#ae6c87812abe1ddf72ca9c75bb16b0ea3">01549</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a5af0353b4f404ffbe6cc5b7e5b0da622">polygonize</a>(<a class="code" href="../../d8/d20/structprocess.html">PROCESS</a> *mbproc, <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb)
<a name="l01550"></a>01550 {
<a name="l01551"></a>01551     <a class="code" href="../../df/d81/structcube.html">CUBE</a> c;
<a name="l01552"></a>01552     <span class="keywordtype">int</span> a;
<a name="l01553"></a>01553 
<a name="l01554"></a>01554     mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#aebd6d1255f648e618754613b69138cc6">vertices</a>.<a class="code" href="../../d9/d0b/structvertices.html#ae251f69ebca5a10d0227d78b476f41d8">count</a> = mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#aebd6d1255f648e618754613b69138cc6">vertices</a>.<a class="code" href="../../d9/d0b/structvertices.html#a5e6cc6e62190fe8a47fe5a848ac02c11">max</a> = 0;
<a name="l01555"></a>01555     mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#aebd6d1255f648e618754613b69138cc6">vertices</a>.<a class="code" href="../../d9/d0b/structvertices.html#aa31fd70f91b53a343b8e11297fd57c30">ptr</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01556"></a>01556 
<a name="l01557"></a>01557     <span class="comment">/* allocate hash tables and build cube polygon table: */</span>
<a name="l01558"></a>01558     mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#ab4465b7a1892851ebfe9b665ecd797ef">centers</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<a class="code" href="../../d2/d6c/mball_8c.html#a2b4054af9a8f1ec4104846747ded1675">HASHSIZE</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d34/structcenterlist.html">CENTERLIST</a> *), <span class="stringliteral">&quot;mbproc-&gt;centers&quot;</span>);
<a name="l01559"></a>01559     mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#ad395b509219d2599a41ec35060821d29">corners</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<a class="code" href="../../d2/d6c/mball_8c.html#a2b4054af9a8f1ec4104846747ded1675">HASHSIZE</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d7a/structcorner.html">CORNER</a> *), <span class="stringliteral">&quot;mbproc-&gt;corners&quot;</span>);
<a name="l01560"></a>01560     mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#a31eb04bb61ee3f2d3e8218109112e3c2">edges</a> = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(2*<a class="code" href="../../d2/d6c/mball_8c.html#a2b4054af9a8f1ec4104846747ded1675">HASHSIZE</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d8c/structedgelist.html">EDGELIST</a> *), <span class="stringliteral">&quot;mbproc-&gt;edges&quot;</span>);
<a name="l01561"></a>01561     <a class="code" href="../../df/dae/BKE__mball_8h.html#a056e9e069bb31fd80f9195dac2bd56c8">makecubetable</a>();
<a name="l01562"></a>01562 
<a name="l01563"></a>01563     <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d2/d6c/mball_8c.html#a41d64e907d93a316f1b41e35cabf13c6">totelem</a>; a++) {
<a name="l01564"></a>01564 
<a name="l01565"></a>01565         <span class="comment">/* try to find 8 points on the surface for each MetaElem */</span>
<a name="l01566"></a>01566         <a class="code" href="../../df/dae/BKE__mball_8h.html#aac43b8ee33027a61ed4aad488960712d">find_first_points</a>(mbproc, mb, a);   
<a name="l01567"></a>01567     }
<a name="l01568"></a>01568 
<a name="l01569"></a>01569     <span class="comment">/* polygonize all MetaElems of current MetaBall */</span>
<a name="l01570"></a>01570     <span class="keywordflow">while</span> (mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#ae132fb3ae2da26633e0452b6e846ada8">cubes</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) { <span class="comment">/* process active cubes till none left */</span>
<a name="l01571"></a>01571         c = mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#ae132fb3ae2da26633e0452b6e846ada8">cubes</a>-&gt;<a class="code" href="../../da/de9/structcubes.html#abe54f8919e9c65c601ac8aba52529ec1">cube</a>;
<a name="l01572"></a>01572 
<a name="l01573"></a>01573         <span class="comment">/* polygonize the cube directly: */</span>
<a name="l01574"></a>01574         <a class="code" href="../../df/dae/BKE__mball_8h.html#a93a6b9d8889a6747d727ed614e3de7c0">docube</a>(&amp;c, mbproc, mb);
<a name="l01575"></a>01575         
<a name="l01576"></a>01576         <span class="comment">/* pop current cube from stack */</span>
<a name="l01577"></a>01577         mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#ae132fb3ae2da26633e0452b6e846ada8">cubes</a> = mbproc-&gt;<a class="code" href="../../d8/d20/structprocess.html#ae132fb3ae2da26633e0452b6e846ada8">cubes</a>-&gt;<a class="code" href="../../da/de9/structcubes.html#a40a3f4af08f68689644f932458873304">next</a>;
<a name="l01578"></a>01578         
<a name="l01579"></a>01579         <span class="comment">/* test six face directions, maybe add to stack: */</span>
<a name="l01580"></a>01580         <a class="code" href="../../df/dae/BKE__mball_8h.html#a830bc62fc8b9541aeb338bbcca5349a7">testface</a>(c.<a class="code" href="../../df/d81/structcube.html#aeb3c618a61a9ffe4d5fb2c74bc5aa2a0">i</a>-1, c.<a class="code" href="../../df/d81/structcube.html#afbbc026f5003816eb1e7c44bdcf9f54a">j</a>, c.<a class="code" href="../../df/d81/structcube.html#a614bd77c99fb9a1a100665775ee02728">k</a>, &amp;c, 2, <a class="code" href="../../d2/d6c/mball_8c.html#aa749e5cf7139dc97361e975f13e467a2">LBN</a>, <a class="code" href="../../d2/d6c/mball_8c.html#a9a88665e307459c076b93109741d973f">LBF</a>, <a class="code" href="../../d2/d6c/mball_8c.html#a586f695dc09fe7822e51d8d06f905be8">LTN</a>, <a class="code" href="../../d2/d6c/mball_8c.html#a836d252087ebe4128fc3dccd9830e181">LTF</a>, mbproc);
<a name="l01581"></a>01581         <a class="code" href="../../df/dae/BKE__mball_8h.html#a830bc62fc8b9541aeb338bbcca5349a7">testface</a>(c.<a class="code" href="../../df/d81/structcube.html#aeb3c618a61a9ffe4d5fb2c74bc5aa2a0">i</a>+1, c.<a class="code" href="../../df/d81/structcube.html#afbbc026f5003816eb1e7c44bdcf9f54a">j</a>, c.<a class="code" href="../../df/d81/structcube.html#a614bd77c99fb9a1a100665775ee02728">k</a>, &amp;c, 2, <a class="code" href="../../d2/d6c/mball_8c.html#a3fae26a43a83ee9c2a9c468d3fe22621">RBN</a>, <a class="code" href="../../d2/d6c/mball_8c.html#abae7fd1d616531c926f64eb405fe6c48">RBF</a>, <a class="code" href="../../d2/d6c/mball_8c.html#a098fafd7946985437f25577c38fcb9f4">RTN</a>, <a class="code" href="../../d2/d6c/mball_8c.html#a4763592545b4347769e93323316b7d89">RTF</a>, mbproc);
<a name="l01582"></a>01582         <a class="code" href="../../df/dae/BKE__mball_8h.html#a830bc62fc8b9541aeb338bbcca5349a7">testface</a>(c.<a class="code" href="../../df/d81/structcube.html#aeb3c618a61a9ffe4d5fb2c74bc5aa2a0">i</a>, c.<a class="code" href="../../df/d81/structcube.html#afbbc026f5003816eb1e7c44bdcf9f54a">j</a>-1, c.<a class="code" href="../../df/d81/structcube.html#a614bd77c99fb9a1a100665775ee02728">k</a>, &amp;c, 1, <a class="code" href="../../d2/d6c/mball_8c.html#aa749e5cf7139dc97361e975f13e467a2">LBN</a>, <a class="code" href="../../d2/d6c/mball_8c.html#a9a88665e307459c076b93109741d973f">LBF</a>, <a class="code" href="../../d2/d6c/mball_8c.html#a3fae26a43a83ee9c2a9c468d3fe22621">RBN</a>, <a class="code" href="../../d2/d6c/mball_8c.html#abae7fd1d616531c926f64eb405fe6c48">RBF</a>, mbproc);
<a name="l01583"></a>01583         <a class="code" href="../../df/dae/BKE__mball_8h.html#a830bc62fc8b9541aeb338bbcca5349a7">testface</a>(c.<a class="code" href="../../df/d81/structcube.html#aeb3c618a61a9ffe4d5fb2c74bc5aa2a0">i</a>, c.<a class="code" href="../../df/d81/structcube.html#afbbc026f5003816eb1e7c44bdcf9f54a">j</a>+1, c.<a class="code" href="../../df/d81/structcube.html#a614bd77c99fb9a1a100665775ee02728">k</a>, &amp;c, 1, <a class="code" href="../../d2/d6c/mball_8c.html#a586f695dc09fe7822e51d8d06f905be8">LTN</a>, <a class="code" href="../../d2/d6c/mball_8c.html#a836d252087ebe4128fc3dccd9830e181">LTF</a>, <a class="code" href="../../d2/d6c/mball_8c.html#a098fafd7946985437f25577c38fcb9f4">RTN</a>, <a class="code" href="../../d2/d6c/mball_8c.html#a4763592545b4347769e93323316b7d89">RTF</a>, mbproc);
<a name="l01584"></a>01584         <a class="code" href="../../df/dae/BKE__mball_8h.html#a830bc62fc8b9541aeb338bbcca5349a7">testface</a>(c.<a class="code" href="../../df/d81/structcube.html#aeb3c618a61a9ffe4d5fb2c74bc5aa2a0">i</a>, c.<a class="code" href="../../df/d81/structcube.html#afbbc026f5003816eb1e7c44bdcf9f54a">j</a>, c.<a class="code" href="../../df/d81/structcube.html#a614bd77c99fb9a1a100665775ee02728">k</a>-1, &amp;c, 0, <a class="code" href="../../d2/d6c/mball_8c.html#aa749e5cf7139dc97361e975f13e467a2">LBN</a>, <a class="code" href="../../d2/d6c/mball_8c.html#a586f695dc09fe7822e51d8d06f905be8">LTN</a>, <a class="code" href="../../d2/d6c/mball_8c.html#a3fae26a43a83ee9c2a9c468d3fe22621">RBN</a>, <a class="code" href="../../d2/d6c/mball_8c.html#a098fafd7946985437f25577c38fcb9f4">RTN</a>, mbproc);
<a name="l01585"></a>01585         <a class="code" href="../../df/dae/BKE__mball_8h.html#a830bc62fc8b9541aeb338bbcca5349a7">testface</a>(c.<a class="code" href="../../df/d81/structcube.html#aeb3c618a61a9ffe4d5fb2c74bc5aa2a0">i</a>, c.<a class="code" href="../../df/d81/structcube.html#afbbc026f5003816eb1e7c44bdcf9f54a">j</a>, c.<a class="code" href="../../df/d81/structcube.html#a614bd77c99fb9a1a100665775ee02728">k</a>+1, &amp;c, 0, <a class="code" href="../../d2/d6c/mball_8c.html#a9a88665e307459c076b93109741d973f">LBF</a>, <a class="code" href="../../d2/d6c/mball_8c.html#a836d252087ebe4128fc3dccd9830e181">LTF</a>, <a class="code" href="../../d2/d6c/mball_8c.html#abae7fd1d616531c926f64eb405fe6c48">RBF</a>, <a class="code" href="../../d2/d6c/mball_8c.html#a4763592545b4347769e93323316b7d89">RTF</a>, mbproc);
<a name="l01586"></a>01586     }
<a name="l01587"></a>01587 }
<a name="l01588"></a>01588 
<a name="l01589"></a><a class="code" href="../../d2/d6c/mball_8c.html#a2daaa16419900b0bdec4eec85ae62e7c">01589</a> <span class="keywordtype">float</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#abfcf98de3ad974751fee2c8efac6fa49">init_meta</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob)   <span class="comment">/* return totsize */</span>
<a name="l01590"></a>01590 {
<a name="l01591"></a>01591     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce_iter= scene;
<a name="l01592"></a>01592     <a class="code" href="../../d3/da9/structBase.html">Base</a> *base;
<a name="l01593"></a>01593     <a class="code" href="../../de/de7/structObject.html">Object</a> *bob;
<a name="l01594"></a>01594     <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb;
<a name="l01595"></a>01595     <a class="code" href="../../de/d87/structMetaElem.html">MetaElem</a> *ml;
<a name="l01596"></a>01596     <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>, totsize, obinv[4][4], obmat[4][4], vec[3];
<a name="l01597"></a>01597     <span class="comment">//float max=0.0;</span>
<a name="l01598"></a>01598     <span class="keywordtype">int</span> a, obnr, zero_size=0;
<a name="l01599"></a>01599     <span class="keywordtype">char</span> obname[<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6d7bce2e9ad79af316c9690a5b84b75c">MAX_ID_NAME</a>];
<a name="l01600"></a>01600     
<a name="l01601"></a>01601     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(obmat, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);   <span class="comment">/* to cope with duplicators from next_object */</span>
<a name="l01602"></a>01602     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(obinv, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l01603"></a>01603     a= 0;
<a name="l01604"></a>01604     
<a name="l01605"></a>01605     <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ad663a2d737c722b9567f70fb488036ad">BLI_split_name_num</a>(obname, &amp;obnr, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, <span class="charliteral">&#39;.&#39;</span>);
<a name="l01606"></a>01606     
<a name="l01607"></a>01607     <span class="comment">/* make main array */</span>
<a name="l01608"></a>01608     <a class="code" href="../../d8/d53/BKE__scene_8h.html#aa1af4746ec37edeb9615a009f268ff41">next_object</a>(&amp;sce_iter, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01609"></a>01609     <span class="keywordflow">while</span> (<a class="code" href="../../d8/d53/BKE__scene_8h.html#aa1af4746ec37edeb9615a009f268ff41">next_object</a>(&amp;sce_iter, 1, &amp;base, &amp;bob)) {
<a name="l01610"></a>01610 
<a name="l01611"></a>01611         <span class="keywordflow">if</span> (bob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a046d883c32490b5c5ca4c5e7b6504e35">OB_MBALL</a>) {
<a name="l01612"></a>01612             zero_size= 0;
<a name="l01613"></a>01613             ml= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01614"></a>01614 
<a name="l01615"></a>01615             <span class="keywordflow">if</span> (bob==ob &amp;&amp; (base-&gt;<a class="code" href="../../d3/da9/structBase.html#a0e10616272837fff209501e1cd7fb26b">flag</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ac31d50d415c660a44c0ccdc6b4854721">OB_FROMDUPLI</a>)==0) {
<a name="l01616"></a>01616                 mb= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01617"></a>01617     
<a name="l01618"></a>01618                 <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad613f238c10a857cb981c9963efc365a">editelems</a>) ml= mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad613f238c10a857cb981c9963efc365a">editelems</a>-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01619"></a>01619                 <span class="keywordflow">else</span> ml= mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a582b25f0c9cf3bfa16c4c2d1785f1233">elems</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01620"></a>01620             }
<a name="l01621"></a>01621             <span class="keywordflow">else</span> {
<a name="l01622"></a>01622                 <span class="keywordtype">char</span> name[<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6d7bce2e9ad79af316c9690a5b84b75c">MAX_ID_NAME</a>];
<a name="l01623"></a>01623                 <span class="keywordtype">int</span> nr;
<a name="l01624"></a>01624                 
<a name="l01625"></a>01625                 <a class="code" href="../../d2/dd9/BLI__path__util_8h.html#ad663a2d737c722b9567f70fb488036ad">BLI_split_name_num</a>(name, &amp;nr, bob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, <span class="charliteral">&#39;.&#39;</span>);
<a name="l01626"></a>01626                 <span class="keywordflow">if</span> ( strcmp(obname, name)==0 ) {
<a name="l01627"></a>01627                     mb= bob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l01628"></a>01628                     
<a name="l01629"></a>01629                     <span class="keywordflow">if</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad613f238c10a857cb981c9963efc365a">editelems</a>) ml= mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ad613f238c10a857cb981c9963efc365a">editelems</a>-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01630"></a>01630                     <span class="keywordflow">else</span> ml= mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a582b25f0c9cf3bfa16c4c2d1785f1233">elems</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01631"></a>01631                 }
<a name="l01632"></a>01632             }
<a name="l01633"></a>01633 
<a name="l01634"></a>01634             <span class="comment">/* when metaball object has zero scale, then MetaElem to this MetaBall</span>
<a name="l01635"></a>01635 <span class="comment">             * will not be put to mainb array */</span>
<a name="l01636"></a>01636             <span class="keywordflow">if</span> (bob-&gt;<a class="code" href="../../de/de7/structObject.html#a46e0f5309f8c13d85e16fa6436acf9f8">size</a>[0]==0.0f || bob-&gt;<a class="code" href="../../de/de7/structObject.html#a46e0f5309f8c13d85e16fa6436acf9f8">size</a>[1]==0.0f || bob-&gt;<a class="code" href="../../de/de7/structObject.html#a46e0f5309f8c13d85e16fa6436acf9f8">size</a>[2]==0.0f) {
<a name="l01637"></a>01637                 zero_size= 1;
<a name="l01638"></a>01638             }
<a name="l01639"></a>01639             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>) {
<a name="l01640"></a>01640                 <span class="keyword">struct </span><a class="code" href="../../de/de7/structObject.html">Object</a> *pob=bob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>;
<a name="l01641"></a>01641                 <span class="keywordflow">while</span> (pob) {
<a name="l01642"></a>01642                     <span class="keywordflow">if</span> (pob-&gt;<a class="code" href="../../de/de7/structObject.html#a46e0f5309f8c13d85e16fa6436acf9f8">size</a>[0]==0.0f || pob-&gt;<a class="code" href="../../de/de7/structObject.html#a46e0f5309f8c13d85e16fa6436acf9f8">size</a>[1]==0.0f || pob-&gt;<a class="code" href="../../de/de7/structObject.html#a46e0f5309f8c13d85e16fa6436acf9f8">size</a>[2]==0.0f) {
<a name="l01643"></a>01643                         zero_size= 1;
<a name="l01644"></a>01644                         <span class="keywordflow">break</span>;
<a name="l01645"></a>01645                     }
<a name="l01646"></a>01646                     pob= pob-&gt;<a class="code" href="../../de/de7/structObject.html#acefcc0d10011d68526b827509403b951">parent</a>;
<a name="l01647"></a>01647                 }
<a name="l01648"></a>01648             }
<a name="l01649"></a>01649 
<a name="l01650"></a>01650             <span class="keywordflow">if</span> (zero_size) {
<a name="l01651"></a>01651                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ml_count=0;
<a name="l01652"></a>01652                 <span class="keywordflow">while</span> (ml) {
<a name="l01653"></a>01653                     ml_count++;
<a name="l01654"></a>01654                     ml= ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a441cace5b6e487bfc3c2c29f3ab9e150">next</a>;
<a name="l01655"></a>01655                 }
<a name="l01656"></a>01656                 <a class="code" href="../../d2/d6c/mball_8c.html#a41d64e907d93a316f1b41e35cabf13c6">totelem</a> -= ml_count;
<a name="l01657"></a>01657             }
<a name="l01658"></a>01658             <span class="keywordflow">else</span> {
<a name="l01659"></a>01659             <span class="keywordflow">while</span> (ml) {
<a name="l01660"></a>01660                 <span class="keywordflow">if</span> (!(ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#afcd96395129ff8fdd4006c8ea5cb4915">flag</a> &amp; <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a69a6c2462f45d47e85bc9265c34f50f9">MB_HIDE</a>)) {
<a name="l01661"></a>01661                     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01662"></a>01662                     <span class="keywordtype">float</span> temp1[4][4], temp2[4][4], temp3[4][4];
<a name="l01663"></a>01663                     float (*<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>)[4] = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, (*imat)[4] = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01664"></a>01664                     <span class="keywordtype">float</span> max_x, max_y, max_z, min_x, min_y, min_z;
<a name="l01665"></a>01665 
<a name="l01666"></a>01666                     max_x = max_y = max_z = -3.4e38;
<a name="l01667"></a>01667                     min_x = min_y = min_z =  3.4e38;
<a name="l01668"></a>01668 
<a name="l01669"></a>01669                     <span class="comment">/* too big stiffness seems only ugly due to linear interpolation</span>
<a name="l01670"></a>01670 <span class="comment">                     * no need to have possibility for too big stiffness */</span>
<a name="l01671"></a>01671                     <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#ab77dbffce529c16d46d8b202b2b535ca">s</a> &gt; 10.0f) ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#ab77dbffce529c16d46d8b202b2b535ca">s</a> = 10.0f;
<a name="l01672"></a>01672                     
<a name="l01673"></a>01673                     <span class="comment">/* Rotation of MetaElem is stored in quat */</span>
<a name="l01674"></a>01674                      <a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#aff22852eb07b63a696ea49fa09958bf6">quat_to_mat4</a>( temp3,ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a7c377daf6945c6efbba42dd0b89bd6e4">quat</a>);
<a name="l01675"></a>01675 
<a name="l01676"></a>01676                     <span class="comment">/* Translation of MetaElem */</span>
<a name="l01677"></a>01677                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a573114dda84526c82734926c26953eb0">unit_m4</a>(temp2);
<a name="l01678"></a>01678                     temp2[3][0]= ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a65f806a2e216ec2f3b15f7fd27538bd8">x</a>;
<a name="l01679"></a>01679                     temp2[3][1]= ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a9c102060f72cff6b45759ee5341747d2">y</a>;
<a name="l01680"></a>01680                     temp2[3][2]= ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a6ce09774e3c0c3d37ebbcfdd29b2c1d5">z</a>;
<a name="l01681"></a>01681 
<a name="l01682"></a>01682                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ae41a59d6db4a10a85f8fbf1e3842ba81">mult_m4_m4m4</a>(temp1, temp2, temp3);
<a name="l01683"></a>01683                 
<a name="l01684"></a>01684                     <span class="comment">/* make a copy because of duplicates */</span>
<a name="l01685"></a>01685                     mainb[a]= <a class="code" href="../../df/dae/BKE__mball_8h.html#a96110050b671393c3c26e7ddc3a25286">new_pgn_element</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../de/d87/structMetaElem.html">MetaElem</a>));
<a name="l01686"></a>01686                     *(mainb[a])= *ml;
<a name="l01687"></a>01687                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a> = <a class="code" href="../../df/dae/BKE__mball_8h.html#a96110050b671393c3c26e7ddc3a25286">new_pgn_element</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d3/d8a/structBoundBox.html">BoundBox</a>));
<a name="l01688"></a>01688                 
<a name="l01689"></a>01689                     <a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>= <a class="code" href="../../df/dae/BKE__mball_8h.html#a96110050b671393c3c26e7ddc3a25286">new_pgn_element</a>(4*4*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l01690"></a>01690                     imat= <a class="code" href="../../df/dae/BKE__mball_8h.html#a96110050b671393c3c26e7ddc3a25286">new_pgn_element</a>(4*4*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l01691"></a>01691                     
<a name="l01692"></a>01692                     <span class="comment">/* mat is the matrix to transform from mball into the basis-mball */</span>
<a name="l01693"></a>01693                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(obinv, obmat);
<a name="l01694"></a>01694                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ae41a59d6db4a10a85f8fbf1e3842ba81">mult_m4_m4m4</a>(temp2, obinv, bob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l01695"></a>01695                     <span class="comment">/* MetaBall transformation */</span>
<a name="l01696"></a>01696                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ae41a59d6db4a10a85f8fbf1e3842ba81">mult_m4_m4m4</a>(<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>, temp2, temp1);
<a name="l01697"></a>01697 
<a name="l01698"></a>01698                     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(imat,<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>);             
<a name="l01699"></a>01699 
<a name="l01700"></a>01700                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a88bbc436c1dc961ef4259896dbf892dc">rad2</a>= ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a>*ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a>;
<a name="l01701"></a>01701 
<a name="l01702"></a>01702                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#aadba09bfcf67a62add6f3e2c9d7a54ab">mat</a>= (<span class="keywordtype">float</span>*) <a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>;
<a name="l01703"></a>01703                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a334b0071cf58c79064166b79409a9247">imat</a>= (<span class="keywordtype">float</span>*) imat;
<a name="l01704"></a>01704 
<a name="l01705"></a>01705                     <span class="comment">/* untransformed Bounding Box of MetaElem */</span>
<a name="l01706"></a>01706                     <span class="comment">/* 0 */</span>
<a name="l01707"></a>01707                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][0]= -ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>;
<a name="l01708"></a>01708                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][1]= -ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>;
<a name="l01709"></a>01709                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][2]= -ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a781a391ca94eb183538d95aa4b84cd0b">expz</a>;
<a name="l01710"></a>01710                     <span class="comment">/* 1 */</span>
<a name="l01711"></a>01711                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[1][0]=  ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>;
<a name="l01712"></a>01712                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[1][1]= -ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>;
<a name="l01713"></a>01713                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[1][2]= -ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a781a391ca94eb183538d95aa4b84cd0b">expz</a>;
<a name="l01714"></a>01714                     <span class="comment">/* 2 */</span>
<a name="l01715"></a>01715                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[2][0]=  ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>;
<a name="l01716"></a>01716                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[2][1]=  ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>;
<a name="l01717"></a>01717                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[2][2]= -ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a781a391ca94eb183538d95aa4b84cd0b">expz</a>;
<a name="l01718"></a>01718                     <span class="comment">/* 3 */</span>
<a name="l01719"></a>01719                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[3][0]= -ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>;
<a name="l01720"></a>01720                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[3][1]=  ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>;
<a name="l01721"></a>01721                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[3][2]= -ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a781a391ca94eb183538d95aa4b84cd0b">expz</a>;
<a name="l01722"></a>01722                     <span class="comment">/* 4 */</span>
<a name="l01723"></a>01723                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[4][0]= -ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>;
<a name="l01724"></a>01724                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[4][1]= -ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>;
<a name="l01725"></a>01725                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[4][2]=  ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a781a391ca94eb183538d95aa4b84cd0b">expz</a>;
<a name="l01726"></a>01726                     <span class="comment">/* 5 */</span>
<a name="l01727"></a>01727                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[5][0]=  ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>;
<a name="l01728"></a>01728                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[5][1]= -ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>;
<a name="l01729"></a>01729                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[5][2]=  ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a781a391ca94eb183538d95aa4b84cd0b">expz</a>;
<a name="l01730"></a>01730                     <span class="comment">/* 6 */</span>
<a name="l01731"></a>01731                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][0]=  ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>;
<a name="l01732"></a>01732                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][1]=  ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>;
<a name="l01733"></a>01733                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][2]=  ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a781a391ca94eb183538d95aa4b84cd0b">expz</a>;
<a name="l01734"></a>01734                     <span class="comment">/* 7 */</span>
<a name="l01735"></a>01735                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[7][0]= -ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>;
<a name="l01736"></a>01736                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[7][1]=  ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>;
<a name="l01737"></a>01737                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[7][2]=  ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a781a391ca94eb183538d95aa4b84cd0b">expz</a>;
<a name="l01738"></a>01738 
<a name="l01739"></a>01739                     <span class="comment">/* transformation of Metalem bb */</span>
<a name="l01740"></a>01740                     <span class="keywordflow">for</span> (i=0; i&lt;8; i++)
<a name="l01741"></a>01741                         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>((<span class="keywordtype">float</span> (*)[4])<a class="code" href="../../de/de7/structObject.html#a545b54048d299d5d9b5f49d6a80f1a9f">mat</a>, mainb[a]-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[i]);
<a name="l01742"></a>01742 
<a name="l01743"></a>01743                     <span class="comment">/* find max and min of transformed bb */</span>
<a name="l01744"></a>01744                     <span class="keywordflow">for</span> (i=0; i&lt;8; i++) {
<a name="l01745"></a>01745                         <span class="comment">/* find maximums */</span>
<a name="l01746"></a>01746                         <span class="keywordflow">if</span> (mainb[a]-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[i][0] &gt; max_x) max_x = mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][0];
<a name="l01747"></a>01747                         <span class="keywordflow">if</span> (mainb[a]-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[i][1] &gt; max_y) max_y = mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][1];
<a name="l01748"></a>01748                         <span class="keywordflow">if</span> (mainb[a]-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[i][2] &gt; max_z) max_z = mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][2];
<a name="l01749"></a>01749                         <span class="comment">/* find  minimums */</span>
<a name="l01750"></a>01750                         <span class="keywordflow">if</span> (mainb[a]-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[i][0] &lt; min_x) min_x = mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][0];
<a name="l01751"></a>01751                         <span class="keywordflow">if</span> (mainb[a]-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[i][1] &lt; min_y) min_y = mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][1];
<a name="l01752"></a>01752                         <span class="keywordflow">if</span> (mainb[a]-&gt;<a class="code" href="../../de/de7/structObject.html#a5513f8ac51a6d67252f5c3ceaf3c34eb">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[i][2] &lt; min_z) min_z = mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][2];
<a name="l01753"></a>01753                     }
<a name="l01754"></a>01754 
<a name="l01755"></a>01755                     <span class="comment">/* create &quot;new&quot; bb, only point 0 and 6, which are</span>
<a name="l01756"></a>01756 <span class="comment">                     * necessary for octal tree filling */</span>
<a name="l01757"></a>01757                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][0] = min_x - ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a>;
<a name="l01758"></a>01758                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][1] = min_y - ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a>;
<a name="l01759"></a>01759                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][2] = min_z - ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a>;
<a name="l01760"></a>01760 
<a name="l01761"></a>01761                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][0] = max_x + ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a>;
<a name="l01762"></a>01762                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][1] = max_y + ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a>;
<a name="l01763"></a>01763                     mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][2] = max_z + ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a>;
<a name="l01764"></a>01764                     
<a name="l01765"></a>01765                     a++;
<a name="l01766"></a>01766                 }
<a name="l01767"></a>01767                 ml= ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a441cace5b6e487bfc3c2c29f3ab9e150">next</a>;
<a name="l01768"></a>01768             }
<a name="l01769"></a>01769             }
<a name="l01770"></a>01770         }
<a name="l01771"></a>01771     }
<a name="l01772"></a>01772 
<a name="l01773"></a>01773     
<a name="l01774"></a>01774     <span class="comment">/* totsize (= &#39;manhattan&#39; radius) */</span>
<a name="l01775"></a>01775     totsize= 0.0;
<a name="l01776"></a>01776     <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d2/d6c/mball_8c.html#a41d64e907d93a316f1b41e35cabf13c6">totelem</a>; a++) {
<a name="l01777"></a>01777         
<a name="l01778"></a>01778         vec[0]= mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a65f806a2e216ec2f3b15f7fd27538bd8">x</a> + mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a> + mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a505710e3c78fd97ac36a65ceac957adf">expx</a>;
<a name="l01779"></a>01779         vec[1]= mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a9c102060f72cff6b45759ee5341747d2">y</a> + mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a> + mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a11237041693ea750bea5b287cd48a6ad">expy</a>;
<a name="l01780"></a>01780         vec[2]= mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a6ce09774e3c0c3d37ebbcfdd29b2c1d5">z</a> + mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a> + mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a781a391ca94eb183538d95aa4b84cd0b">expz</a>;
<a name="l01781"></a>01781 
<a name="l01782"></a>01782         <a class="code" href="../../df/dae/BKE__mball_8h.html#aa628449644542b634b63c99f8fa8271f">calc_mballco</a>(mainb[a], vec);
<a name="l01783"></a>01783     
<a name="l01784"></a>01784         size= <a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>( vec[0] );
<a name="l01785"></a>01785         <span class="keywordflow">if</span> ( size &gt; totsize ) totsize= <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l01786"></a>01786         size= <a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>( vec[1] );
<a name="l01787"></a>01787         <span class="keywordflow">if</span> ( size &gt; totsize ) totsize= <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l01788"></a>01788         size= <a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>( vec[2] );
<a name="l01789"></a>01789         <span class="keywordflow">if</span> ( size &gt; totsize ) totsize= <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l01790"></a>01790 
<a name="l01791"></a>01791         vec[0]= mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a65f806a2e216ec2f3b15f7fd27538bd8">x</a> - mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a>;
<a name="l01792"></a>01792         vec[1]= mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a9c102060f72cff6b45759ee5341747d2">y</a> - mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a>;
<a name="l01793"></a>01793         vec[2]= mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a6ce09774e3c0c3d37ebbcfdd29b2c1d5">z</a> - mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a0adbfddb307638a1228ed06fa6e08fd1">rad</a>;
<a name="l01794"></a>01794                 
<a name="l01795"></a>01795         <a class="code" href="../../df/dae/BKE__mball_8h.html#aa628449644542b634b63c99f8fa8271f">calc_mballco</a>(mainb[a], vec);
<a name="l01796"></a>01796     
<a name="l01797"></a>01797         size= <a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>( vec[0] );
<a name="l01798"></a>01798         <span class="keywordflow">if</span> ( size &gt; totsize ) totsize= <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l01799"></a>01799         size= <a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>( vec[1] );
<a name="l01800"></a>01800         <span class="keywordflow">if</span> ( size &gt; totsize ) totsize= <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l01801"></a>01801         size= <a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>( vec[2] );
<a name="l01802"></a>01802         <span class="keywordflow">if</span> ( size &gt; totsize ) totsize= <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l01803"></a>01803     }
<a name="l01804"></a>01804 
<a name="l01805"></a>01805     <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d2/d6c/mball_8c.html#a41d64e907d93a316f1b41e35cabf13c6">totelem</a>; a++) {
<a name="l01806"></a>01806         <a class="code" href="../../d2/d6c/mball_8c.html#aac8fef4e3b3d833f16d5cef8ddce1ae1">thresh</a> += <a class="code" href="../../df/dae/BKE__mball_8h.html#a260394c8885690732c62b09344038b4d">densfunc</a>(mainb[a], 2.0f * totsize, 2.0f * totsize, 2.0f * totsize);
<a name="l01807"></a>01807     }
<a name="l01808"></a>01808 
<a name="l01809"></a>01809     <span class="keywordflow">return</span> totsize;
<a name="l01810"></a>01810 }
<a name="l01811"></a>01811 
<a name="l01812"></a>01812 <span class="comment">/* if MetaElem lies in node, then node includes MetaElem pointer (ml_p)</span>
<a name="l01813"></a>01813 <span class="comment"> * pointing at MetaElem (ml)</span>
<a name="l01814"></a>01814 <span class="comment"> */</span>
<a name="l01815"></a><a class="code" href="../../d2/d6c/mball_8c.html#a76f81f31fd020871a9f79ba5ba98ded0">01815</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(<a class="code" href="../../d2/d6e/structoctal__node.html">octal_node</a> *node, <a class="code" href="../../de/d87/structMetaElem.html">MetaElem</a> *ml, <span class="keywordtype">short</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>)
<a name="l01816"></a>01816 {
<a name="l01817"></a>01817     <a class="code" href="../../d6/d47/structml__pointer.html">ml_pointer</a> *ml_p;
<a name="l01818"></a>01818 
<a name="l01819"></a>01819     ml_p= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d47/structml__pointer.html">ml_pointer</a>), <span class="stringliteral">&quot;ml_pointer&quot;</span>);
<a name="l01820"></a>01820     ml_p-&gt;<a class="code" href="../../d6/d47/structml__pointer.html#a2adf0b13dacfe243e0c56df2b12a7f3d">ml</a>= ml;
<a name="l01821"></a>01821     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;(node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[i]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ac8a61207b7cc395ef46a127854c29d14">elems</a>), ml_p);
<a name="l01822"></a>01822     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a137a565a095a6306443d3effce3039fc">count</a>++;
<a name="l01823"></a>01823     
<a name="l01824"></a>01824     <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#afcd96395129ff8fdd4006c8ea5cb4915">flag</a> &amp; <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a7cbd8ff38c4022078d47cee819de0639">MB_NEGATIVE</a>) {
<a name="l01825"></a>01825         node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ac3114daca6ce737316e2570b1fd52629">neg</a>++;
<a name="l01826"></a>01826     }
<a name="l01827"></a>01827     <span class="keywordflow">else</span> {
<a name="l01828"></a>01828         node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#aedee03fc529f0c15040d7bdebede8fd8">pos</a>++;
<a name="l01829"></a>01829     }
<a name="l01830"></a>01830 }
<a name="l01831"></a>01831 
<a name="l01832"></a>01832 <span class="comment">/* Node is subdivided as is illustrated on the following figure:</span>
<a name="l01833"></a>01833 <span class="comment"> * </span>
<a name="l01834"></a>01834 <span class="comment"> *      +------+------+</span>
<a name="l01835"></a>01835 <span class="comment"> *     /      /      /|</span>
<a name="l01836"></a>01836 <span class="comment"> *    +------+------+ |</span>
<a name="l01837"></a>01837 <span class="comment"> *   /      /      /| +</span>
<a name="l01838"></a>01838 <span class="comment"> *  +------+------+ |/|</span>
<a name="l01839"></a>01839 <span class="comment"> *  |      |      | + |</span>
<a name="l01840"></a>01840 <span class="comment"> *  |      |      |/| +</span>
<a name="l01841"></a>01841 <span class="comment"> *  +------+------+ |/</span>
<a name="l01842"></a>01842 <span class="comment"> *  |      |      | +</span>
<a name="l01843"></a>01843 <span class="comment"> *  |      |      |/</span>
<a name="l01844"></a>01844 <span class="comment"> *  +------+------+</span>
<a name="l01845"></a>01845 <span class="comment"> *  </span>
<a name="l01846"></a>01846 <span class="comment"> */</span>
<a name="l01847"></a><a class="code" href="../../d2/d6c/mball_8c.html#a144ad7639ddeb22c3cbc4f489f75bcc0">01847</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a144ad7639ddeb22c3cbc4f489f75bcc0">subdivide_metaball_octal_node</a>(<a class="code" href="../../d2/d6e/structoctal__node.html">octal_node</a> *node, <span class="keywordtype">float</span> size_x, <span class="keywordtype">float</span> size_y, <span class="keywordtype">float</span> size_z, <span class="keywordtype">short</span> depth)
<a name="l01848"></a>01848 {
<a name="l01849"></a>01849     <a class="code" href="../../de/d87/structMetaElem.html">MetaElem</a> *ml;
<a name="l01850"></a>01850     <a class="code" href="../../d6/d47/structml__pointer.html">ml_pointer</a> *ml_p;
<a name="l01851"></a>01851     <span class="keywordtype">float</span> x,y,z;
<a name="l01852"></a>01852     <span class="keywordtype">int</span> a,<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l01853"></a>01853 
<a name="l01854"></a>01854     <span class="comment">/* create new nodes */</span>
<a name="l01855"></a>01855     <span class="keywordflow">for</span> (a=0;a&lt;8;a++) {
<a name="l01856"></a>01856         node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[a]= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d2/d6e/structoctal__node.html">octal_node</a>),<span class="stringliteral">&quot;octal_node&quot;</span>);
<a name="l01857"></a>01857         <span class="keywordflow">for</span> (i=0;i&lt;8;i++)
<a name="l01858"></a>01858             node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[a]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[i]= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01859"></a>01859         node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[a]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad7836f8b09a8ca7b7808e1c9b0ed628b">parent</a>= node;
<a name="l01860"></a>01860         node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[a]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ac8a61207b7cc395ef46a127854c29d14">elems</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01861"></a>01861         node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[a]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ac8a61207b7cc395ef46a127854c29d14">elems</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01862"></a>01862         node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[a]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a137a565a095a6306443d3effce3039fc">count</a>= 0;
<a name="l01863"></a>01863         node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[a]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ac3114daca6ce737316e2570b1fd52629">neg</a>= 0;
<a name="l01864"></a>01864         node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[a]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#aedee03fc529f0c15040d7bdebede8fd8">pos</a>= 0;
<a name="l01865"></a>01865     }
<a name="l01866"></a>01866 
<a name="l01867"></a>01867     size_x /= 2;
<a name="l01868"></a>01868     size_y /= 2;
<a name="l01869"></a>01869     size_z /= 2;
<a name="l01870"></a>01870     
<a name="l01871"></a>01871     <span class="comment">/* center of node */</span>
<a name="l01872"></a>01872     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad95df42627b2a7bd182b85a0b86c91d3">x</a> = x = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a> + size_x;
<a name="l01873"></a>01873     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a8ff408b72f36f62388f54c067a816d69">y</a> = y = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a> + size_y;
<a name="l01874"></a>01874     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#adc4ae04e5d2a35a5070eabcb8f3b8f43">z</a> = z = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a> + size_z;
<a name="l01875"></a>01875 
<a name="l01876"></a>01876     <span class="comment">/* setting up of border points of new nodes */</span>
<a name="l01877"></a>01877     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[0]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a>;
<a name="l01878"></a>01878     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[0]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a>;
<a name="l01879"></a>01879     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[0]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a>;
<a name="l01880"></a>01880     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[0]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad95df42627b2a7bd182b85a0b86c91d3">x</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[0]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a> + size_x/2;
<a name="l01881"></a>01881     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[0]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a8ff408b72f36f62388f54c067a816d69">y</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[0]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a> + size_y/2;
<a name="l01882"></a>01882     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[0]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#adc4ae04e5d2a35a5070eabcb8f3b8f43">z</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[0]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a> + size_z/2;
<a name="l01883"></a>01883     
<a name="l01884"></a>01884     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[1]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a> = x;
<a name="l01885"></a>01885     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[1]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a>;
<a name="l01886"></a>01886     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[1]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a>;
<a name="l01887"></a>01887     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[1]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad95df42627b2a7bd182b85a0b86c91d3">x</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[1]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a> + size_x/2;
<a name="l01888"></a>01888     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[1]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a8ff408b72f36f62388f54c067a816d69">y</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[1]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a> + size_y/2;
<a name="l01889"></a>01889     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[1]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#adc4ae04e5d2a35a5070eabcb8f3b8f43">z</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[1]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a> + size_z/2;
<a name="l01890"></a>01890 
<a name="l01891"></a>01891     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[2]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a> = x;
<a name="l01892"></a>01892     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[2]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a> = y;
<a name="l01893"></a>01893     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[2]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a>;
<a name="l01894"></a>01894     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[2]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad95df42627b2a7bd182b85a0b86c91d3">x</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[2]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a> + size_x/2;
<a name="l01895"></a>01895     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[2]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a8ff408b72f36f62388f54c067a816d69">y</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[2]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a> + size_y/2;
<a name="l01896"></a>01896     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[2]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#adc4ae04e5d2a35a5070eabcb8f3b8f43">z</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[2]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a> + size_z/2;
<a name="l01897"></a>01897 
<a name="l01898"></a>01898     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[3]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a>;
<a name="l01899"></a>01899     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[3]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a> = y;
<a name="l01900"></a>01900     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[3]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a>;
<a name="l01901"></a>01901     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[3]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad95df42627b2a7bd182b85a0b86c91d3">x</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[3]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a> + size_x/2;
<a name="l01902"></a>01902     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[3]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a8ff408b72f36f62388f54c067a816d69">y</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[3]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a> + size_y/2;
<a name="l01903"></a>01903     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[3]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#adc4ae04e5d2a35a5070eabcb8f3b8f43">z</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[3]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a> + size_z/2;
<a name="l01904"></a>01904 
<a name="l01905"></a>01905     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[4]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a>;
<a name="l01906"></a>01906     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[4]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a>;
<a name="l01907"></a>01907     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[4]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a> = z;
<a name="l01908"></a>01908     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[4]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad95df42627b2a7bd182b85a0b86c91d3">x</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[4]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a> + size_x/2;
<a name="l01909"></a>01909     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[4]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a8ff408b72f36f62388f54c067a816d69">y</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[4]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a> + size_y/2;
<a name="l01910"></a>01910     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[4]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#adc4ae04e5d2a35a5070eabcb8f3b8f43">z</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[4]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a> + size_z/2;
<a name="l01911"></a>01911     
<a name="l01912"></a>01912     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[5]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a> = x;
<a name="l01913"></a>01913     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[5]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a>;
<a name="l01914"></a>01914     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[5]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a> = z;
<a name="l01915"></a>01915     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[5]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad95df42627b2a7bd182b85a0b86c91d3">x</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[5]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a> + size_x/2;
<a name="l01916"></a>01916     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[5]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a8ff408b72f36f62388f54c067a816d69">y</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[5]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a> + size_y/2;
<a name="l01917"></a>01917     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[5]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#adc4ae04e5d2a35a5070eabcb8f3b8f43">z</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[5]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a> + size_z/2;
<a name="l01918"></a>01918 
<a name="l01919"></a>01919     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[6]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a> = x;
<a name="l01920"></a>01920     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[6]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a> = y;
<a name="l01921"></a>01921     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[6]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a> = z;
<a name="l01922"></a>01922     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[6]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad95df42627b2a7bd182b85a0b86c91d3">x</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[6]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a> + size_x/2;
<a name="l01923"></a>01923     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[6]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a8ff408b72f36f62388f54c067a816d69">y</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[6]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a> + size_y/2;
<a name="l01924"></a>01924     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[6]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#adc4ae04e5d2a35a5070eabcb8f3b8f43">z</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[6]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a> + size_z/2;
<a name="l01925"></a>01925 
<a name="l01926"></a>01926     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[7]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a>;
<a name="l01927"></a>01927     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[7]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a> = y;
<a name="l01928"></a>01928     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[7]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a> = z;
<a name="l01929"></a>01929     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[7]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad95df42627b2a7bd182b85a0b86c91d3">x</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[7]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a> + size_x/2;
<a name="l01930"></a>01930     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[7]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a8ff408b72f36f62388f54c067a816d69">y</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[7]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a> + size_y/2;
<a name="l01931"></a>01931     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[7]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#adc4ae04e5d2a35a5070eabcb8f3b8f43">z</a> = node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[7]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a> + size_z/2;
<a name="l01932"></a>01932 
<a name="l01933"></a>01933     ml_p= node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ac8a61207b7cc395ef46a127854c29d14">elems</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01934"></a>01934     
<a name="l01935"></a>01935     <span class="comment">/* setting up references of MetaElems for new nodes */</span>
<a name="l01936"></a>01936     <span class="keywordflow">while</span> (ml_p) {
<a name="l01937"></a>01937         ml= ml_p-&gt;<a class="code" href="../../d6/d47/structml__pointer.html#a2adf0b13dacfe243e0c56df2b12a7f3d">ml</a>;
<a name="l01938"></a>01938         <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][2] &lt; z) {
<a name="l01939"></a>01939             <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][1] &lt; y) {
<a name="l01940"></a>01940                 <span class="comment">/* vec[0][0] lies in first octant */</span>
<a name="l01941"></a>01941                 <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][0] &lt; x) {
<a name="l01942"></a>01942                     <span class="comment">/* ml belongs to the (0)1st node */</span>
<a name="l01943"></a>01943                     <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 0);
<a name="l01944"></a>01944 
<a name="l01945"></a>01945                     <span class="comment">/* ml belongs to the (3)4th node */</span>
<a name="l01946"></a>01946                     <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][1] &gt;= y) {
<a name="l01947"></a>01947                         <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 3);
<a name="l01948"></a>01948 
<a name="l01949"></a>01949                         <span class="comment">/* ml belongs to the (7)8th node */</span>
<a name="l01950"></a>01950                         <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][2] &gt;= z) {
<a name="l01951"></a>01951                             <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 7);
<a name="l01952"></a>01952                         }
<a name="l01953"></a>01953                     }
<a name="l01954"></a>01954     
<a name="l01955"></a>01955                     <span class="comment">/* ml belongs to the (1)2nd node */</span>
<a name="l01956"></a>01956                     <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][0] &gt;= x) {
<a name="l01957"></a>01957                         <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 1);
<a name="l01958"></a>01958 
<a name="l01959"></a>01959                         <span class="comment">/* ml belongs to the (5)6th node */</span>
<a name="l01960"></a>01960                         <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][2] &gt;= z) {
<a name="l01961"></a>01961                             <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 5);
<a name="l01962"></a>01962                         }
<a name="l01963"></a>01963                     }
<a name="l01964"></a>01964 
<a name="l01965"></a>01965                     <span class="comment">/* ml belongs to the (2)3th node */</span>
<a name="l01966"></a>01966                     <span class="keywordflow">if</span> ((ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][0] &gt;= x) &amp;&amp; (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][1] &gt;= y)) {
<a name="l01967"></a>01967                         <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 2);
<a name="l01968"></a>01968                         
<a name="l01969"></a>01969                         <span class="comment">/* ml belong to the (6)7th node */</span>
<a name="l01970"></a>01970                         <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][2] &gt;= z) {
<a name="l01971"></a>01971                             <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 6);
<a name="l01972"></a>01972                         }
<a name="l01973"></a>01973                         
<a name="l01974"></a>01974                     }
<a name="l01975"></a>01975             
<a name="l01976"></a>01976                     <span class="comment">/* ml belongs to the (4)5th node too */</span> 
<a name="l01977"></a>01977                     <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][2] &gt;= z) {
<a name="l01978"></a>01978                         <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 4);
<a name="l01979"></a>01979                     }
<a name="l01980"></a>01980 
<a name="l01981"></a>01981                     
<a name="l01982"></a>01982                     
<a name="l01983"></a>01983                 }
<a name="l01984"></a>01984                 <span class="comment">/* vec[0][0] is in the (1)second octant */</span>
<a name="l01985"></a>01985                 <span class="keywordflow">else</span> {
<a name="l01986"></a>01986                     <span class="comment">/* ml belong to the (1)2nd node */</span>
<a name="l01987"></a>01987                     <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 1);
<a name="l01988"></a>01988 
<a name="l01989"></a>01989                     <span class="comment">/* ml belongs to the (2)3th node */</span>
<a name="l01990"></a>01990                     <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][1] &gt;= y) {
<a name="l01991"></a>01991                         <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 2);
<a name="l01992"></a>01992 
<a name="l01993"></a>01993                         <span class="comment">/* ml belongs to the (6)7th node */</span>
<a name="l01994"></a>01994                         <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][2] &gt;= z) {
<a name="l01995"></a>01995                             <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 6);
<a name="l01996"></a>01996                         }
<a name="l01997"></a>01997                         
<a name="l01998"></a>01998                     }
<a name="l01999"></a>01999                     
<a name="l02000"></a>02000                     <span class="comment">/* ml belongs to the (5)6th node */</span>
<a name="l02001"></a>02001                     <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][2] &gt;= z) {
<a name="l02002"></a>02002                         <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 5);
<a name="l02003"></a>02003                     }
<a name="l02004"></a>02004                 }
<a name="l02005"></a>02005             }
<a name="l02006"></a>02006             <span class="keywordflow">else</span> {
<a name="l02007"></a>02007                 <span class="comment">/* vec[0][0] is in the (3)4th octant */</span>
<a name="l02008"></a>02008                 <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][0] &lt; x) {
<a name="l02009"></a>02009                     <span class="comment">/* ml belongs to the (3)4nd node */</span>
<a name="l02010"></a>02010                     <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 3);
<a name="l02011"></a>02011                     
<a name="l02012"></a>02012                     <span class="comment">/* ml belongs to the (7)8th node */</span>
<a name="l02013"></a>02013                     <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][2] &gt;= z) {
<a name="l02014"></a>02014                         <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 7);
<a name="l02015"></a>02015                     }
<a name="l02016"></a>02016                 
<a name="l02017"></a>02017 
<a name="l02018"></a>02018                     <span class="comment">/* ml belongs to the (2)3th node */</span>
<a name="l02019"></a>02019                     <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][0] &gt;= x) {
<a name="l02020"></a>02020                         <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 2);
<a name="l02021"></a>02021                     
<a name="l02022"></a>02022                         <span class="comment">/* ml belongs to the (6)7th node */</span>
<a name="l02023"></a>02023                         <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][2] &gt;= z) {
<a name="l02024"></a>02024                             <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 6);
<a name="l02025"></a>02025                         }
<a name="l02026"></a>02026                     }
<a name="l02027"></a>02027                 }
<a name="l02028"></a>02028 
<a name="l02029"></a>02029             }
<a name="l02030"></a>02030 
<a name="l02031"></a>02031             <span class="comment">/* vec[0][0] is in the (2)3th octant */</span>
<a name="l02032"></a>02032             <span class="keywordflow">if</span> ((ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][0] &gt;= x) &amp;&amp; (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][1] &gt;= y)) {
<a name="l02033"></a>02033                 <span class="comment">/* ml belongs to the (2)3th node */</span>
<a name="l02034"></a>02034                 <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 2);
<a name="l02035"></a>02035                 
<a name="l02036"></a>02036                 <span class="comment">/* ml belongs to the (6)7th node */</span>
<a name="l02037"></a>02037                 <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][2] &gt;= z) {
<a name="l02038"></a>02038                     <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 6);
<a name="l02039"></a>02039                 }
<a name="l02040"></a>02040             }
<a name="l02041"></a>02041         }
<a name="l02042"></a>02042         <span class="keywordflow">else</span> {
<a name="l02043"></a>02043             <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][1] &lt; y) {
<a name="l02044"></a>02044                 <span class="comment">/* vec[0][0] lies in (4)5th octant */</span>
<a name="l02045"></a>02045                 <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][0] &lt; x) {
<a name="l02046"></a>02046                     <span class="comment">/* ml belongs to the (4)5th node */</span>
<a name="l02047"></a>02047                     <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 4);
<a name="l02048"></a>02048 
<a name="l02049"></a>02049                     <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][0] &gt;= x) {
<a name="l02050"></a>02050                         <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 5);
<a name="l02051"></a>02051                     }
<a name="l02052"></a>02052 
<a name="l02053"></a>02053                     <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][1] &gt;= y) {
<a name="l02054"></a>02054                         <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 7);
<a name="l02055"></a>02055                     }
<a name="l02056"></a>02056                     
<a name="l02057"></a>02057                     <span class="keywordflow">if</span> ((ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][0] &gt;= x) &amp;&amp; (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][1] &gt;= y)) {
<a name="l02058"></a>02058                         <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 6);
<a name="l02059"></a>02059                     }
<a name="l02060"></a>02060                 }
<a name="l02061"></a>02061                 <span class="comment">/* vec[0][0] lies in (5)6th octant */</span>
<a name="l02062"></a>02062                 <span class="keywordflow">else</span> {
<a name="l02063"></a>02063                     <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 5);
<a name="l02064"></a>02064 
<a name="l02065"></a>02065                     <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][1] &gt;= y) {
<a name="l02066"></a>02066                         <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 6);
<a name="l02067"></a>02067                     }
<a name="l02068"></a>02068                 }
<a name="l02069"></a>02069             }
<a name="l02070"></a>02070             <span class="keywordflow">else</span> {
<a name="l02071"></a>02071                 <span class="comment">/* vec[0][0] lies in (7)8th octant */</span>
<a name="l02072"></a>02072                 <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][0] &lt; x) {
<a name="l02073"></a>02073                     <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 7);
<a name="l02074"></a>02074 
<a name="l02075"></a>02075                     <span class="keywordflow">if</span> (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][0] &gt;= x) {
<a name="l02076"></a>02076                         <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 6);
<a name="l02077"></a>02077                     }
<a name="l02078"></a>02078                 }
<a name="l02079"></a>02079 
<a name="l02080"></a>02080             }
<a name="l02081"></a>02081             
<a name="l02082"></a>02082             <span class="comment">/* vec[0][0] lies in (6)7th octant */</span>
<a name="l02083"></a>02083             <span class="keywordflow">if</span> ((ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][0] &gt;= x) &amp;&amp; (ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][1] &gt;= y)) {
<a name="l02084"></a>02084                 <a class="code" href="../../df/dae/BKE__mball_8h.html#a2a7d3b27eff5125ac286e559f90c9dfb">fill_metaball_octal_node</a>(node, ml, 6);
<a name="l02085"></a>02085             }
<a name="l02086"></a>02086         }
<a name="l02087"></a>02087         ml_p= ml_p-&gt;<a class="code" href="../../d6/d47/structml__pointer.html#a57ff7e964e98b65addd1599136e255b7">next</a>;
<a name="l02088"></a>02088     }
<a name="l02089"></a>02089 
<a name="l02090"></a>02090     <span class="comment">/* free references of MetaElems for curent node (it is not needed anymore) */</span>
<a name="l02091"></a>02091     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ac8a61207b7cc395ef46a127854c29d14">elems</a>);
<a name="l02092"></a>02092 
<a name="l02093"></a>02093     depth--;
<a name="l02094"></a>02094     
<a name="l02095"></a>02095     <span class="keywordflow">if</span> (depth&gt;0) {
<a name="l02096"></a>02096         <span class="keywordflow">for</span> (a=0;a&lt;8;a++) {
<a name="l02097"></a>02097             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[a]-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a137a565a095a6306443d3effce3039fc">count</a> &gt; 0) <span class="comment">/* if node is not empty, then it is subdivided */</span>
<a name="l02098"></a>02098                 <a class="code" href="../../df/dae/BKE__mball_8h.html#a144ad7639ddeb22c3cbc4f489f75bcc0">subdivide_metaball_octal_node</a>(node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[a], size_x, size_y, size_z, depth);
<a name="l02099"></a>02099         }
<a name="l02100"></a>02100     }
<a name="l02101"></a>02101 }
<a name="l02102"></a>02102 
<a name="l02103"></a>02103 <span class="comment">/* free all octal nodes recursively */</span>
<a name="l02104"></a><a class="code" href="../../d2/d6c/mball_8c.html#ad548aae3f55c41dea9a1518fca88e44d">02104</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#ad548aae3f55c41dea9a1518fca88e44d">free_metaball_octal_node</a>(<a class="code" href="../../d2/d6e/structoctal__node.html">octal_node</a> *node)
<a name="l02105"></a>02105 {
<a name="l02106"></a>02106     <span class="keywordtype">int</span> a;
<a name="l02107"></a>02107     <span class="keywordflow">for</span> (a=0;a&lt;8;a++) {
<a name="l02108"></a>02108         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[a]!=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <a class="code" href="../../df/dae/BKE__mball_8h.html#ad548aae3f55c41dea9a1518fca88e44d">free_metaball_octal_node</a>(node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[a]);
<a name="l02109"></a>02109     }
<a name="l02110"></a>02110     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ac8a61207b7cc395ef46a127854c29d14">elems</a>);
<a name="l02111"></a>02111     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(node);
<a name="l02112"></a>02112 }
<a name="l02113"></a>02113 
<a name="l02114"></a>02114 <span class="comment">/* If scene include more then one MetaElem, then octree is used */</span>
<a name="l02115"></a><a class="code" href="../../d2/d6c/mball_8c.html#a942ce6ce9a21f75b7e01037a75c4eb06">02115</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a942ce6ce9a21f75b7e01037a75c4eb06">init_metaball_octal_tree</a>(<span class="keywordtype">int</span> depth)
<a name="l02116"></a>02116 {
<a name="l02117"></a>02117     <span class="keyword">struct </span><a class="code" href="../../d2/d6e/structoctal__node.html">octal_node</a> *node;
<a name="l02118"></a>02118     <a class="code" href="../../d6/d47/structml__pointer.html">ml_pointer</a> *ml_p;
<a name="l02119"></a>02119     <span class="keywordtype">float</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>[3];
<a name="l02120"></a>02120     <span class="keywordtype">int</span> a;
<a name="l02121"></a>02121     
<a name="l02122"></a>02122     metaball_tree= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d7/d2f/structoctal__tree.html">octal_tree</a>), <span class="stringliteral">&quot;metaball_octal_tree&quot;</span>);
<a name="l02123"></a>02123     metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a54ade2ba77049f66c0f5201963969ef2">first</a>= node= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d2/d6e/structoctal__node.html">octal_node</a>), <span class="stringliteral">&quot;metaball_octal_node&quot;</span>);
<a name="l02124"></a>02124     <span class="comment">/* maximal depth of octree */</span>
<a name="l02125"></a>02125     metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a150ef8e8ce4c75f8e21521c0f5b82999">depth</a>= depth;
<a name="l02126"></a>02126 
<a name="l02127"></a>02127     metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a4fd7e0c41041886c6adda2eacada83fc">neg</a>= node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ac3114daca6ce737316e2570b1fd52629">neg</a>=0;
<a name="l02128"></a>02128     metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a845afc2650e99ade973a2cc7436739fe">pos</a>= node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#aedee03fc529f0c15040d7bdebede8fd8">pos</a>=0;
<a name="l02129"></a>02129     
<a name="l02130"></a>02130     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ac8a61207b7cc395ef46a127854c29d14">elems</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02131"></a>02131     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ac8a61207b7cc395ef46a127854c29d14">elems</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02132"></a>02132     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a137a565a095a6306443d3effce3039fc">count</a>=0;
<a name="l02133"></a>02133 
<a name="l02134"></a>02134     <span class="keywordflow">for</span> (a=0;a&lt;8;a++)
<a name="l02135"></a>02135         node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ad52bc4bbff4ec9192d1141e36e8e4ed7">nodes</a>[a]=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02136"></a>02136 
<a name="l02137"></a>02137     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a>= node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a>= node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a>= <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>;
<a name="l02138"></a>02138     node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#afddc3d557bfec13e55d35e4a7993c232">x_max</a>= node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#aad77b78714accac181b2f0ca81003540">y_max</a>= node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a271ea95f7508b72ebc9f6aaa61ef027f">z_max</a>= -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>;
<a name="l02139"></a>02139 
<a name="l02140"></a>02140     <span class="comment">/* size of octal tree scene */</span>
<a name="l02141"></a>02141     for (a=0;a&lt;<a class="code" href="../../d2/d6c/mball_8c.html#a41d64e907d93a316f1b41e35cabf13c6">totelem</a>;a++) {
<a name="l02142"></a>02142         <span class="keywordflow">if</span> (mainb[a]-&gt;bb-&gt;vec[0][0] &lt; node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a>) node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a>= mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][0];
<a name="l02143"></a>02143         <span class="keywordflow">if</span> (mainb[a]-&gt;bb-&gt;vec[0][1] &lt; node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a>) node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a>= mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][1];
<a name="l02144"></a>02144         <span class="keywordflow">if</span> (mainb[a]-&gt;bb-&gt;vec[0][2] &lt; node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a>) node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a>= mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[0][2];
<a name="l02145"></a>02145         
<a name="l02146"></a>02146         <span class="keywordflow">if</span> (mainb[a]-&gt;bb-&gt;vec[6][0] &gt; node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#afddc3d557bfec13e55d35e4a7993c232">x_max</a>) node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#afddc3d557bfec13e55d35e4a7993c232">x_max</a>= mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][0];
<a name="l02147"></a>02147         <span class="keywordflow">if</span> (mainb[a]-&gt;bb-&gt;vec[6][1] &gt; node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#aad77b78714accac181b2f0ca81003540">y_max</a>) node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#aad77b78714accac181b2f0ca81003540">y_max</a>= mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][1];
<a name="l02148"></a>02148         <span class="keywordflow">if</span> (mainb[a]-&gt;bb-&gt;vec[6][2] &gt; node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a271ea95f7508b72ebc9f6aaa61ef027f">z_max</a>) node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a271ea95f7508b72ebc9f6aaa61ef027f">z_max</a>= mainb[a]-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a904b3479cf146ec10783b9b00a8a1c26">bb</a>-&gt;<a class="code" href="../../d3/d8a/structBoundBox.html#ad1955c11c5a6c98f2c8b714c20337fb3">vec</a>[6][2];
<a name="l02149"></a>02149 
<a name="l02150"></a>02150         ml_p= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d47/structml__pointer.html">ml_pointer</a>), <span class="stringliteral">&quot;ml_pointer&quot;</span>);
<a name="l02151"></a>02151         ml_p-&gt;<a class="code" href="../../d6/d47/structml__pointer.html#a2adf0b13dacfe243e0c56df2b12a7f3d">ml</a>= mainb[a];
<a name="l02152"></a>02152         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ac8a61207b7cc395ef46a127854c29d14">elems</a>, ml_p);
<a name="l02153"></a>02153 
<a name="l02154"></a>02154         <span class="keywordflow">if</span> (mainb[a]-&gt;flag &amp; <a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a7cbd8ff38c4022078d47cee819de0639">MB_NEGATIVE</a>) {
<a name="l02155"></a>02155             <span class="comment">/* number of negative MetaElem in scene */</span>
<a name="l02156"></a>02156             metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a4fd7e0c41041886c6adda2eacada83fc">neg</a>++;
<a name="l02157"></a>02157         }
<a name="l02158"></a>02158         <span class="keywordflow">else</span> {
<a name="l02159"></a>02159             <span class="comment">/* number of positive MetaElem in scene */</span>
<a name="l02160"></a>02160             metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a845afc2650e99ade973a2cc7436739fe">pos</a>++;
<a name="l02161"></a>02161         }
<a name="l02162"></a>02162     }
<a name="l02163"></a>02163 
<a name="l02164"></a>02164     <span class="comment">/* size of first node */</span>    
<a name="l02165"></a>02165     size[0]= node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#afddc3d557bfec13e55d35e4a7993c232">x_max</a> - node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a>;
<a name="l02166"></a>02166     size[1]= node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#aad77b78714accac181b2f0ca81003540">y_max</a> - node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a>;
<a name="l02167"></a>02167     size[2]= node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a271ea95f7508b72ebc9f6aaa61ef027f">z_max</a> - node-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a>;
<a name="l02168"></a>02168 
<a name="l02169"></a>02169     <span class="comment">/* first node is subdivided recursively */</span>
<a name="l02170"></a>02170     <a class="code" href="../../df/dae/BKE__mball_8h.html#a144ad7639ddeb22c3cbc4f489f75bcc0">subdivide_metaball_octal_node</a>(node, size[0], size[1], size[2], metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a150ef8e8ce4c75f8e21521c0f5b82999">depth</a>);
<a name="l02171"></a>02171 }
<a name="l02172"></a>02172 
<a name="l02173"></a><a class="code" href="../../d2/d6c/mball_8c.html#ac01dae1f92b20068c7961ef52ed0d205">02173</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a3a7875f465f92b91adc4023134476a3e">metaball_polygonize</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *dispbase)
<a name="l02174"></a>02174 {
<a name="l02175"></a>02175     <a class="code" href="../../d8/d20/structprocess.html">PROCESS</a> mbproc;
<a name="l02176"></a>02176     <a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb;
<a name="l02177"></a>02177     <a class="code" href="../../d5/d2f/structDispList.html">DispList</a> *dl;
<a name="l02178"></a>02178     <span class="keywordtype">int</span> a, nr_cubes;
<a name="l02179"></a>02179     <span class="keywordtype">float</span> *ve, *no, totsize, width;
<a name="l02180"></a>02180 
<a name="l02181"></a>02181     mb= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l02182"></a>02182 
<a name="l02183"></a>02183     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d6c/mball_8c.html#a41d64e907d93a316f1b41e35cabf13c6">totelem</a>==0) <span class="keywordflow">return</span>;
<a name="l02184"></a>02184     <span class="keywordflow">if</span> (!(<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.rendering) &amp;&amp; (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ab657cb372e8abbb7d367c101f3251de4">flag</a>==<a class="code" href="../../d0/d40/DNA__meta__types_8h.html#a96fc2104c109cd675031e3b597f0c4d5">MB_UPDATE_NEVER</a>)) <span class="keywordflow">return</span>;
<a name="l02185"></a>02185     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.moving &amp;&amp; mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ab657cb372e8abbb7d367c101f3251de4">flag</a>==<a class="code" href="../../d0/d40/DNA__meta__types_8h.html#abc4e28d072b7c2f7ec8541a520064c8a">MB_UPDATE_FAST</a>) <span class="keywordflow">return</span>;
<a name="l02186"></a>02186 
<a name="l02187"></a>02187     <a class="code" href="../../d2/d6c/mball_8c.html#aa0aed51016f3947bd4956c5742df8f20">curindex</a>= <a class="code" href="../../d2/d6c/mball_8c.html#a16996c17496386a947d510a19ad1facc">totindex</a>= 0;
<a name="l02188"></a>02188     <a class="code" href="../../d2/d6c/mball_8c.html#a47e7cc913f2b356de088363a1d87db4a">indices</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02189"></a>02189     <a class="code" href="../../d2/d6c/mball_8c.html#aac8fef4e3b3d833f16d5cef8ddce1ae1">thresh</a>= mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a1780a871c75eb9be17bcfd521c4b883d">thresh</a>;
<a name="l02190"></a>02190 
<a name="l02191"></a>02191     <span class="comment">/* total number of MetaElems (totelem) is precomputed in find_basis_mball() function */</span>
<a name="l02192"></a>02192     mainb= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *)*<a class="code" href="../../d2/d6c/mball_8c.html#a41d64e907d93a316f1b41e35cabf13c6">totelem</a>, <span class="stringliteral">&quot;mainb&quot;</span>);
<a name="l02193"></a>02193     
<a name="l02194"></a>02194     <span class="comment">/* initialize all mainb (MetaElems) */</span>
<a name="l02195"></a>02195     totsize= <a class="code" href="../../df/dae/BKE__mball_8h.html#abfcf98de3ad974751fee2c8efac6fa49">init_meta</a>(scene, ob);
<a name="l02196"></a>02196 
<a name="l02197"></a>02197     <span class="keywordflow">if</span> (metaball_tree) {
<a name="l02198"></a>02198         <a class="code" href="../../df/dae/BKE__mball_8h.html#ad548aae3f55c41dea9a1518fca88e44d">free_metaball_octal_node</a>(metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a54ade2ba77049f66c0f5201963969ef2">first</a>);
<a name="l02199"></a>02199         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(metaball_tree);
<a name="l02200"></a>02200         metaball_tree= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02201"></a>02201     }
<a name="l02202"></a>02202 
<a name="l02203"></a>02203     <span class="comment">/* if scene includes more then one MetaElem, then octal tree optimalisation is used */</span>  
<a name="l02204"></a>02204     <span class="keywordflow">if</span> ((totelem &gt; 1) &amp;&amp; (totelem &lt;= 64)) <a class="code" href="../../df/dae/BKE__mball_8h.html#a942ce6ce9a21f75b7e01037a75c4eb06">init_metaball_octal_tree</a>(1);
<a name="l02205"></a>02205     <span class="keywordflow">if</span> ((totelem &gt; 64) &amp;&amp; (totelem &lt;= 128)) <a class="code" href="../../df/dae/BKE__mball_8h.html#a942ce6ce9a21f75b7e01037a75c4eb06">init_metaball_octal_tree</a>(2);
<a name="l02206"></a>02206     <span class="keywordflow">if</span> ((totelem &gt; 128) &amp;&amp; (totelem &lt;= 512))    <a class="code" href="../../df/dae/BKE__mball_8h.html#a942ce6ce9a21f75b7e01037a75c4eb06">init_metaball_octal_tree</a>(3);
<a name="l02207"></a>02207     <span class="keywordflow">if</span> ((totelem &gt; 512) &amp;&amp; (totelem &lt;= 1024)) <a class="code" href="../../df/dae/BKE__mball_8h.html#a942ce6ce9a21f75b7e01037a75c4eb06">init_metaball_octal_tree</a>(4);
<a name="l02208"></a>02208     <span class="keywordflow">if</span> (totelem &gt; 1024) <a class="code" href="../../df/dae/BKE__mball_8h.html#a942ce6ce9a21f75b7e01037a75c4eb06">init_metaball_octal_tree</a>(5);
<a name="l02209"></a>02209 
<a name="l02210"></a>02210     <span class="comment">/* don&#39;t polygonize metaballs with too high resolution (base mball to small)</span>
<a name="l02211"></a>02211 <span class="comment">     * note: Eps was 0.0001f but this was giving problems for blood animation for durian, using 0.00001f */</span>
<a name="l02212"></a>02212     <span class="keywordflow">if</span> (metaball_tree) {
<a name="l02213"></a>02213         <span class="keywordflow">if</span> (    ob-&gt;<a class="code" href="../../de/de7/structObject.html#a46e0f5309f8c13d85e16fa6436acf9f8">size</a>[0] &lt;= 0.00001f * (metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a54ade2ba77049f66c0f5201963969ef2">first</a>-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#afddc3d557bfec13e55d35e4a7993c232">x_max</a> - metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a54ade2ba77049f66c0f5201963969ef2">first</a>-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a4c7d249d41024280568b8f4bf9c9ce0a">x_min</a>) ||
<a name="l02214"></a>02214             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a46e0f5309f8c13d85e16fa6436acf9f8">size</a>[1] &lt;= 0.00001f * (metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a54ade2ba77049f66c0f5201963969ef2">first</a>-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#aad77b78714accac181b2f0ca81003540">y_max</a> - metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a54ade2ba77049f66c0f5201963969ef2">first</a>-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a65e7b86601be790f735141c830e6424b">y_min</a>) ||
<a name="l02215"></a>02215             ob-&gt;<a class="code" href="../../de/de7/structObject.html#a46e0f5309f8c13d85e16fa6436acf9f8">size</a>[2] &lt;= 0.00001f * (metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a54ade2ba77049f66c0f5201963969ef2">first</a>-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#a271ea95f7508b72ebc9f6aaa61ef027f">z_max</a> - metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a54ade2ba77049f66c0f5201963969ef2">first</a>-&gt;<a class="code" href="../../d2/d6e/structoctal__node.html#ab03b8ca32da9cea0d60cef55d8351ada">z_min</a>))
<a name="l02216"></a>02216         {
<a name="l02217"></a>02217             <a class="code" href="../../df/dae/BKE__mball_8h.html#a96110050b671393c3c26e7ddc3a25286">new_pgn_element</a>(-1); <span class="comment">/* free values created by init_meta */</span>
<a name="l02218"></a>02218 
<a name="l02219"></a>02219             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(mainb);
<a name="l02220"></a>02220 
<a name="l02221"></a>02221             <span class="comment">/* free tree */</span>
<a name="l02222"></a>02222             <a class="code" href="../../df/dae/BKE__mball_8h.html#ad548aae3f55c41dea9a1518fca88e44d">free_metaball_octal_node</a>(metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a54ade2ba77049f66c0f5201963969ef2">first</a>);
<a name="l02223"></a>02223             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(metaball_tree);
<a name="l02224"></a>02224             metaball_tree= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02225"></a>02225 
<a name="l02226"></a>02226             <span class="keywordflow">return</span>;
<a name="l02227"></a>02227         }
<a name="l02228"></a>02228     }
<a name="l02229"></a>02229 
<a name="l02230"></a>02230     <span class="comment">/* width is size per polygonize cube */</span>
<a name="l02231"></a>02231     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.rendering) width= mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a5e238e919345a3d9bd538c1ae368831b">rendersize</a>;
<a name="l02232"></a>02232     <span class="keywordflow">else</span> {
<a name="l02233"></a>02233         width= mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#aca36a604480ad258251269df20713cb0">wiresize</a>;
<a name="l02234"></a>02234         <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.moving &amp;&amp; mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#ab657cb372e8abbb7d367c101f3251de4">flag</a>==<a class="code" href="../../d0/d40/DNA__meta__types_8h.html#ac2d6ac8c994babb12a1fe6424ec44c6c">MB_UPDATE_HALFRES</a>) width*= 2;
<a name="l02235"></a>02235     }
<a name="l02236"></a>02236     <span class="comment">/* nr_cubes is just for safety, minimum is totsize */</span>
<a name="l02237"></a>02237     nr_cubes= (int)(0.5f+totsize/width);
<a name="l02238"></a>02238 
<a name="l02239"></a>02239     <span class="comment">/* init process */</span>
<a name="l02240"></a>02240     mbproc.<a class="code" href="../../d8/d20/structprocess.html#aa869826f5c153b5c22a16eeea7a6bb44">function</a> = <a class="code" href="../../df/dae/BKE__mball_8h.html#ac6dac50283063cea1ce61ea4cc1138e9">metaball</a>;
<a name="l02241"></a>02241     mbproc.<a class="code" href="../../d8/d20/structprocess.html#a6e8c8f8c7f35216fc9bbeeaf74faeccd">size</a> = width;
<a name="l02242"></a>02242     mbproc.<a class="code" href="../../d8/d20/structprocess.html#accdf67270b2097acfc1d0b5e659520f9">bounds</a> = nr_cubes;
<a name="l02243"></a>02243     mbproc.<a class="code" href="../../d8/d20/structprocess.html#ae132fb3ae2da26633e0452b6e846ada8">cubes</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02244"></a>02244     mbproc.<a class="code" href="../../d8/d20/structprocess.html#a7061ae3c95f30e13167a7e9ba161fcd5">delta</a> = width/(float)(<a class="code" href="../../d2/d6c/mball_8c.html#a65b26605d90a0bcd0e13e05db54f551f">RES</a>*<a class="code" href="../../d2/d6c/mball_8c.html#a65b26605d90a0bcd0e13e05db54f551f">RES</a>);
<a name="l02245"></a>02245 
<a name="l02246"></a>02246     <a class="code" href="../../df/dae/BKE__mball_8h.html#a5af0353b4f404ffbe6cc5b7e5b0da622">polygonize</a>(&amp;mbproc, mb);
<a name="l02247"></a>02247     
<a name="l02248"></a>02248     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(mainb);
<a name="l02249"></a>02249 
<a name="l02250"></a>02250     <span class="comment">/* free octal tree */</span>
<a name="l02251"></a>02251     <span class="keywordflow">if</span> (totelem &gt; 1) {
<a name="l02252"></a>02252         <a class="code" href="../../df/dae/BKE__mball_8h.html#ad548aae3f55c41dea9a1518fca88e44d">free_metaball_octal_node</a>(metaball_tree-&gt;<a class="code" href="../../d7/d2f/structoctal__tree.html#a54ade2ba77049f66c0f5201963969ef2">first</a>);
<a name="l02253"></a>02253         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(metaball_tree);
<a name="l02254"></a>02254         metaball_tree= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02255"></a>02255     }
<a name="l02256"></a>02256 
<a name="l02257"></a>02257     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d6c/mball_8c.html#aa0aed51016f3947bd4956c5742df8f20">curindex</a>) {
<a name="l02258"></a>02258         dl= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d2f/structDispList.html">DispList</a>), <span class="stringliteral">&quot;mbaldisp&quot;</span>);
<a name="l02259"></a>02259         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(dispbase, dl);
<a name="l02260"></a>02260         dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a14a8a66c424ba6ecb972e49847b61483">type</a>= <a class="code" href="../../d9/d12/BKE__displist_8h.html#ac31985d3494fb5bb0f23b72f1cc28487">DL_INDEX4</a>;
<a name="l02261"></a>02261         dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a0943092aadac633bbdd4c566e6956538">nr</a>= mbproc.<a class="code" href="../../d8/d20/structprocess.html#aebd6d1255f648e618754613b69138cc6">vertices</a>.<a class="code" href="../../d9/d0b/structvertices.html#ae251f69ebca5a10d0227d78b476f41d8">count</a>;
<a name="l02262"></a>02262         dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a90540d3d4399d33b9dbdb9c03ab403f0">parts</a>= <a class="code" href="../../d2/d6c/mball_8c.html#aa0aed51016f3947bd4956c5742df8f20">curindex</a>;
<a name="l02263"></a>02263 
<a name="l02264"></a>02264         dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a6c3c9ad7f71c3ee1a79e23af0c6cef42">index</a>= <a class="code" href="../../d2/d6c/mball_8c.html#a47e7cc913f2b356de088363a1d87db4a">indices</a>;
<a name="l02265"></a>02265         <a class="code" href="../../d2/d6c/mball_8c.html#a47e7cc913f2b356de088363a1d87db4a">indices</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02266"></a>02266         
<a name="l02267"></a>02267         a= mbproc.<a class="code" href="../../d8/d20/structprocess.html#aebd6d1255f648e618754613b69138cc6">vertices</a>.<a class="code" href="../../d9/d0b/structvertices.html#ae251f69ebca5a10d0227d78b476f41d8">count</a>;
<a name="l02268"></a>02268         dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#a43f6598aca5bb0f893aa32f09e1b9b07">verts</a>= ve= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*3*a, <span class="stringliteral">&quot;mballverts&quot;</span>);
<a name="l02269"></a>02269         dl-&gt;<a class="code" href="../../d5/d2f/structDispList.html#aa979db9e4f514999a21f547dab4caa19">nors</a>= no= <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)*3*a, <span class="stringliteral">&quot;mballnors&quot;</span>);
<a name="l02270"></a>02270 
<a name="l02271"></a>02271         <span class="keywordflow">for</span> (a=0; a&lt;mbproc.<a class="code" href="../../d8/d20/structprocess.html#aebd6d1255f648e618754613b69138cc6">vertices</a>.<a class="code" href="../../d9/d0b/structvertices.html#ae251f69ebca5a10d0227d78b476f41d8">count</a>; a++, no+=3, ve+=3) {
<a name="l02272"></a>02272             ve[0]= mbproc.<a class="code" href="../../d8/d20/structprocess.html#aebd6d1255f648e618754613b69138cc6">vertices</a>.<a class="code" href="../../d9/d0b/structvertices.html#aa31fd70f91b53a343b8e11297fd57c30">ptr</a>[a].<a class="code" href="../../db/d7c/structvertex.html#a82eb4df764c653c70ade447feb8092d8">position</a>.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>;
<a name="l02273"></a>02273             ve[1]= mbproc.<a class="code" href="../../d8/d20/structprocess.html#aebd6d1255f648e618754613b69138cc6">vertices</a>.<a class="code" href="../../d9/d0b/structvertices.html#aa31fd70f91b53a343b8e11297fd57c30">ptr</a>[a].<a class="code" href="../../db/d7c/structvertex.html#a82eb4df764c653c70ade447feb8092d8">position</a>.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>;
<a name="l02274"></a>02274             ve[2]= mbproc.<a class="code" href="../../d8/d20/structprocess.html#aebd6d1255f648e618754613b69138cc6">vertices</a>.<a class="code" href="../../d9/d0b/structvertices.html#aa31fd70f91b53a343b8e11297fd57c30">ptr</a>[a].<a class="code" href="../../db/d7c/structvertex.html#a82eb4df764c653c70ade447feb8092d8">position</a>.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>;
<a name="l02275"></a>02275 
<a name="l02276"></a>02276             no[0]= mbproc.<a class="code" href="../../d8/d20/structprocess.html#aebd6d1255f648e618754613b69138cc6">vertices</a>.<a class="code" href="../../d9/d0b/structvertices.html#aa31fd70f91b53a343b8e11297fd57c30">ptr</a>[a].<a class="code" href="../../db/d7c/structvertex.html#ae912c230fbda01a841109dc9f836c5ef">normal</a>.<a class="code" href="../../d8/dae/structpoint.html#a8293fd2de3ce739deb6d53691fd21fcf">x</a>;
<a name="l02277"></a>02277             no[1]= mbproc.<a class="code" href="../../d8/d20/structprocess.html#aebd6d1255f648e618754613b69138cc6">vertices</a>.<a class="code" href="../../d9/d0b/structvertices.html#aa31fd70f91b53a343b8e11297fd57c30">ptr</a>[a].<a class="code" href="../../db/d7c/structvertex.html#ae912c230fbda01a841109dc9f836c5ef">normal</a>.<a class="code" href="../../d8/dae/structpoint.html#a616ad85a2096d1566f5971666bbc3b3f">y</a>;
<a name="l02278"></a>02278             no[2]= mbproc.<a class="code" href="../../d8/d20/structprocess.html#aebd6d1255f648e618754613b69138cc6">vertices</a>.<a class="code" href="../../d9/d0b/structvertices.html#aa31fd70f91b53a343b8e11297fd57c30">ptr</a>[a].<a class="code" href="../../db/d7c/structvertex.html#ae912c230fbda01a841109dc9f836c5ef">normal</a>.<a class="code" href="../../d8/dae/structpoint.html#a3c15cf62431e51a4d9432ca40b3b04f5">z</a>;
<a name="l02279"></a>02279         }
<a name="l02280"></a>02280     }
<a name="l02281"></a>02281 
<a name="l02282"></a>02282     <a class="code" href="../../df/dae/BKE__mball_8h.html#ad92f9bfbd4a3b210ce198214ec48060d">freepolygonize</a>(&amp;mbproc);
<a name="l02283"></a>02283 }
<a name="l02284"></a>02284 
<a name="l02285"></a>02285 <span class="comment">/* basic vertex data functions */</span>
<a name="l02286"></a><a class="code" href="../../d2/d6c/mball_8c.html#ae4c91f2a9b3d9703772bac7543002e5f">02286</a> <span class="keywordtype">int</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a2ea7ed5a69a1a80daad78be80f28030d">BKE_metaball_minmax</a>(<a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb, <span class="keywordtype">float</span> <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>[3], <span class="keywordtype">float</span> <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>[3])
<a name="l02287"></a>02287 {
<a name="l02288"></a>02288     <a class="code" href="../../de/d87/structMetaElem.html">MetaElem</a> *ml;
<a name="l02289"></a>02289 
<a name="l02290"></a>02290     <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a329751705c70a4b2fd8a24744f172bb2">INIT_MINMAX</a>(min, max);
<a name="l02291"></a>02291 
<a name="l02292"></a>02292     <span class="keywordflow">for</span> (ml = mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a582b25f0c9cf3bfa16c4c2d1785f1233">elems</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ml; ml = ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a441cace5b6e487bfc3c2c29f3ab9e150">next</a>) {
<a name="l02293"></a>02293         <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a56471388e0045022014f3a365af6b34a">DO_MINMAX</a>(&amp;ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a65f806a2e216ec2f3b15f7fd27538bd8">x</a>, min, max);
<a name="l02294"></a>02294     }
<a name="l02295"></a>02295 
<a name="l02296"></a>02296     <span class="keywordflow">return</span> (mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a582b25f0c9cf3bfa16c4c2d1785f1233">elems</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02297"></a>02297 }
<a name="l02298"></a>02298 
<a name="l02299"></a><a class="code" href="../../d2/d6c/mball_8c.html#a280e120d353bd41d459818c5fc5fc949">02299</a> <span class="keywordtype">int</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#aeb7658428c9a8019e94677353b80bd70">BKE_metaball_center_median</a>(<a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb, <span class="keywordtype">float</span> cent[3])
<a name="l02300"></a>02300 {
<a name="l02301"></a>02301     <a class="code" href="../../de/d87/structMetaElem.html">MetaElem</a> *ml;
<a name="l02302"></a>02302     <span class="keywordtype">int</span> total= 0;
<a name="l02303"></a>02303 
<a name="l02304"></a>02304     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#acd4d89007c860a4c74d459ac72593065">zero_v3</a>(cent);
<a name="l02305"></a>02305 
<a name="l02306"></a>02306     <span class="keywordflow">for</span> (ml = mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a582b25f0c9cf3bfa16c4c2d1785f1233">elems</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ml; ml = ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a441cace5b6e487bfc3c2c29f3ab9e150">next</a>) {
<a name="l02307"></a>02307         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(cent, &amp;ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a65f806a2e216ec2f3b15f7fd27538bd8">x</a>);
<a name="l02308"></a>02308     }
<a name="l02309"></a>02309 
<a name="l02310"></a>02310     <span class="keywordflow">if</span> (total)
<a name="l02311"></a>02311         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(cent, 1.0f/(<span class="keywordtype">float</span>)total);
<a name="l02312"></a>02312 
<a name="l02313"></a>02313     <span class="keywordflow">return</span> (total != 0);
<a name="l02314"></a>02314 }
<a name="l02315"></a>02315 
<a name="l02316"></a><a class="code" href="../../d2/d6c/mball_8c.html#a79d4fc077a96346ea6049a56e03fe998">02316</a> <span class="keywordtype">int</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a62fb99a57ebcd4602f7bb46fe83427e0">BKE_metaball_center_bounds</a>(<a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb, <span class="keywordtype">float</span> cent[3])
<a name="l02317"></a>02317 {
<a name="l02318"></a>02318     <span class="keywordtype">float</span> <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>[3], <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>[3];
<a name="l02319"></a>02319 
<a name="l02320"></a>02320     <span class="keywordflow">if</span> (<a class="code" href="../../df/dae/BKE__mball_8h.html#a2ea7ed5a69a1a80daad78be80f28030d">BKE_metaball_minmax</a>(mb, min, max)) {
<a name="l02321"></a>02321         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ac3186a97188a3cf15bc5e2f8b0e97ad2">mid_v3_v3v3</a>(cent, min, max);
<a name="l02322"></a>02322         <span class="keywordflow">return</span> 1;
<a name="l02323"></a>02323     }
<a name="l02324"></a>02324 
<a name="l02325"></a>02325     <span class="keywordflow">return</span> 0;
<a name="l02326"></a>02326 }
<a name="l02327"></a>02327 
<a name="l02328"></a><a class="code" href="../../d2/d6c/mball_8c.html#a6b4a70506bb556360130780a04f5e3a4">02328</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dae/BKE__mball_8h.html#a7f24a57a35421c243d6c1afcd7c9dc87">BKE_metaball_translate</a>(<a class="code" href="../../d3/d6c/structMetaBall.html">MetaBall</a> *mb, <span class="keywordtype">float</span> offset[3])
<a name="l02329"></a>02329 {
<a name="l02330"></a>02330     <a class="code" href="../../de/d87/structMetaElem.html">MetaElem</a> *ml;
<a name="l02331"></a>02331 
<a name="l02332"></a>02332     <span class="keywordflow">for</span> (ml = mb-&gt;<a class="code" href="../../d3/d6c/structMetaBall.html#a582b25f0c9cf3bfa16c4c2d1785f1233">elems</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ml; ml = ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a441cace5b6e487bfc3c2c29f3ab9e150">next</a>) {
<a name="l02333"></a>02333         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ae0067c77927da3b22dec1de77ac8ba78">add_v3_v3</a>(&amp;ml-&gt;<a class="code" href="../../de/d87/structMetaElem.html#a65f806a2e216ec2f3b15f7fd27538bd8">x</a>, offset);
<a name="l02334"></a>02334     }
<a name="l02335"></a>02335 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:32 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

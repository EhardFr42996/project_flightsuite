<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: action_edit.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">action_edit.c</div>  </div>
</div>
<div class="contents">
<a href="../../d2/dd6/action__edit_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): Joshua Leung</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;float.h&gt;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html">DNA_anim_types.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dcb/DNA__gpencil__types_8h.html">DNA_gpencil_types.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d68/RNA__define_8h.html">RNA_define.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d68/RNA__enum__types_8h.html">RNA_enum_types.h</a>&quot;</span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/df5/BKE__action_8h.html" title="Blender kernel action and pose functionality.">BKE_action.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dba/BKE__fcurve_8h.html">BKE_fcurve.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/de6/BKE__nla_8h.html">BKE_nla.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d40/BKE__report_8h.html">BKE_report.h</a>&quot;</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d63/UI__view2d_8h.html">UI_view2d.h</a>&quot;</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d6f/ED__anim__api_8h.html">ED_anim_api.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dea/ED__gpencil_8h.html">ED_gpencil.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../da/df9/ED__keyframing_8h.html">ED_keyframing.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html">ED_keyframes_edit.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d12/ED__screen_8h.html">ED_screen.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/df2/ED__transform_8h.html">ED_transform.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/da6/ED__markers_8h.html">ED_markers.h</a>&quot;</span>
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d1e/UI__interface_8h.html">UI_interface.h</a>&quot;</span>
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d02/action__intern_8h.html">action_intern.h</a>&quot;</span>
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="comment">/* ************************************************************************** */</span>
<a name="l00076"></a>00076 <span class="comment">/* ACTION MANAGEMENT */</span>
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="comment">/* ******************** New Action Operator *********************** */</span>
<a name="l00079"></a>00079 
<a name="l00080"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a8875564f15bf2c9f33896253abe5c82a">00080</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a8875564f15bf2c9f33896253abe5c82a">act_new_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00081"></a>00081 {
<a name="l00082"></a>00082     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> ptr, idptr;
<a name="l00083"></a>00083     <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *prop;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085     <span class="comment">/* hook into UI */</span>
<a name="l00086"></a>00086     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a6bfd6ea66a2b01a45cc660c37585a58f">uiIDContextProperty</a>(C, &amp;ptr, &amp;prop);
<a name="l00087"></a>00087     
<a name="l00088"></a>00088     <span class="keywordflow">if</span> (prop) {
<a name="l00089"></a>00089         <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *action=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *oldact=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00090"></a>00090         <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> oldptr;
<a name="l00091"></a>00091         
<a name="l00092"></a>00092         <span class="comment">/* create action - the way to do this depends on whether we&#39;ve got an</span>
<a name="l00093"></a>00093 <span class="comment">         * existing one there already, in which case we make a copy of it</span>
<a name="l00094"></a>00094 <span class="comment">         * (which is useful for &quot;versioning&quot; actions within the same file)</span>
<a name="l00095"></a>00095 <span class="comment">         */</span>
<a name="l00096"></a>00096         oldptr = <a class="code" href="../../d3/d10/rna__access_8c.html#a575c543a2a1f509f371bc1cee4fbe4d7">RNA_property_pointer_get</a>(&amp;ptr, prop);
<a name="l00097"></a>00097         oldact = (<a class="code" href="../../d1/d48/structbAction.html">bAction</a> *)oldptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a7afa52885727738cb03bbdf46e808e1b">id</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>;
<a name="l00098"></a>00098         
<a name="l00099"></a>00099         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (oldact &amp;&amp; <a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(oldact-&gt;id.name)==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a20fe08f8d0b2a4e6c0dbb2371aacadb0">ID_AC</a>) {
<a name="l00100"></a>00100             <span class="comment">/* make a copy of the existing action */</span>
<a name="l00101"></a>00101             action= <a class="code" href="../../d8/df5/BKE__action_8h.html#a2b3b7578e40afa786b725009fa9289d4">copy_action</a>(oldact);
<a name="l00102"></a>00102         }
<a name="l00103"></a>00103         <span class="keywordflow">else</span> {
<a name="l00104"></a>00104             <span class="comment">/* just make a new (empty) action */</span>
<a name="l00105"></a>00105             action= <a class="code" href="../../d8/df5/BKE__action_8h.html#a77b6bd66ec260f2485cf1ff2d075fdb2">add_empty_action</a>(<span class="stringliteral">&quot;Action&quot;</span>);
<a name="l00106"></a>00106         }
<a name="l00107"></a>00107         
<a name="l00108"></a>00108         <span class="comment">/* when creating new ID blocks, use is already 1 (fake user), </span>
<a name="l00109"></a>00109 <span class="comment">         * but RNA pointer use also increases user, so this compensates it </span>
<a name="l00110"></a>00110 <span class="comment">         */</span>
<a name="l00111"></a>00111         action-&gt;<a class="code" href="../../d1/d48/structbAction.html#ad0f2d8efde1fdd4f81ee9fe471313bd6">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--;
<a name="l00112"></a>00112         
<a name="l00113"></a>00113         <a class="code" href="../../d3/d10/rna__access_8c.html#a2ce5c1d9b520b00730820e0e118dd4e1">RNA_id_pointer_create</a>(&amp;action-&gt;<a class="code" href="../../d1/d48/structbAction.html#ad0f2d8efde1fdd4f81ee9fe471313bd6">id</a>, &amp;idptr);
<a name="l00114"></a>00114         <a class="code" href="../../d3/d10/rna__access_8c.html#adafe00269e3f01d8a6182040597fd020">RNA_property_pointer_set</a>(&amp;ptr, prop, idptr);
<a name="l00115"></a>00115         <a class="code" href="../../d3/d10/rna__access_8c.html#a5fa7d69c3a73312275e1e6d20baf3bc6">RNA_property_update</a>(C, &amp;ptr, prop);
<a name="l00116"></a>00116     }
<a name="l00117"></a>00117     
<a name="l00118"></a>00118     <span class="comment">/* set notifier that keyframes have changed */</span>
<a name="l00119"></a>00119     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00120"></a>00120     
<a name="l00121"></a>00121     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00122"></a>00122 }
<a name="l00123"></a>00123  
<a name="l00124"></a><a class="code" href="../../df/d02/action__intern_8h.html#ab50b33164047b120e6bc7bafcc725316">00124</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#adefa8449e2f68963ef925c6d26a1aa4a">ACTION_OT_new</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00125"></a>00125 {
<a name="l00126"></a>00126     <span class="comment">/* identifiers */</span>
<a name="l00127"></a>00127     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;New Action&quot;</span>;
<a name="l00128"></a>00128     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_new&quot;</span>;
<a name="l00129"></a>00129     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Create new action&quot;</span>;
<a name="l00130"></a>00130     
<a name="l00131"></a>00131     <span class="comment">/* api callbacks */</span>
<a name="l00132"></a>00132     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#a8875564f15bf2c9f33896253abe5c82a">act_new_exec</a>;
<a name="l00133"></a>00133         <span class="comment">// NOTE: this is used in the NLA too...</span>
<a name="l00134"></a>00134     <span class="comment">//ot-&gt;poll = ED_operator_action_active;</span>
<a name="l00135"></a>00135     
<a name="l00136"></a>00136     <span class="comment">/* flags */</span>
<a name="l00137"></a>00137     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00138"></a>00138 }
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 <span class="comment">/* ************************************************************************** */</span>
<a name="l00141"></a>00141 <span class="comment">/* POSE MARKERS STUFF */</span>
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="comment">/* *************************** Localise Markers ***************************** */</span>
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 <span class="comment">/* ensure that there is:</span>
<a name="l00146"></a>00146 <span class="comment"> *  1) an active action editor</span>
<a name="l00147"></a>00147 <span class="comment"> *  2) that the mode will have an active action available </span>
<a name="l00148"></a>00148 <span class="comment"> *  3) that the set of markers being shown are the scene markers, not the list we&#39;re merging</span>
<a name="l00149"></a>00149 <span class="comment"> *  4) that there are some selected markers</span>
<a name="l00150"></a>00150 <span class="comment"> */</span>
<a name="l00151"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a4f879546a40b4366a39d8a11eb49f33c">00151</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a4f879546a40b4366a39d8a11eb49f33c">act_markers_make_local_poll</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l00152"></a>00152 {
<a name="l00153"></a>00153     <a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *sact = <a class="code" href="../../df/d01/BKE__context_8h.html#ac4b034580691861586681b3e4cdc91f9">CTX_wm_space_action</a>(C);
<a name="l00154"></a>00154     
<a name="l00155"></a>00155     <span class="comment">/* 1) */</span>
<a name="l00156"></a>00156     <span class="keywordflow">if</span> (sact == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00157"></a>00157         <span class="keywordflow">return</span> 0;
<a name="l00158"></a>00158     
<a name="l00159"></a>00159     <span class="comment">/* 2) */</span>
<a name="l00160"></a>00160     <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(sact-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a17207518ba0e0cfef7fd9cd1ad53f5b8">mode</a>, <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#ae1d21c078346359580a781c83f6ab640a1284ead9b0873872740e8b1218463bbe">SACTCONT_ACTION</a>, <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#ae1d21c078346359580a781c83f6ab640a595af644741730a924d0d4d124eea926">SACTCONT_SHAPEKEY</a>) == 0)
<a name="l00161"></a>00161         <span class="keywordflow">return</span> 0;
<a name="l00162"></a>00162     <span class="keywordflow">if</span> (sact-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a2de9c936aea5ac8a1ced8254c027761c">action</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00163"></a>00163         <span class="keywordflow">return</span> 0;
<a name="l00164"></a>00164         
<a name="l00165"></a>00165     <span class="comment">/* 3) */</span>
<a name="l00166"></a>00166     <span class="keywordflow">if</span> (sact-&gt;<a class="code" href="../../de/def/structSpaceAction.html#aa9c9b1bb84c77908e70219d39ed8696c">flag</a> &amp; <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#af4dbf3f7801297d71ef69d77c2724d0ea102506f37e9bb9db1f2eea7701fb9c3f">SACTION_POSEMARKERS_SHOW</a>)
<a name="l00167"></a>00167         <span class="keywordflow">return</span> 0;
<a name="l00168"></a>00168         
<a name="l00169"></a>00169     <span class="comment">/* 4) */</span>
<a name="l00170"></a>00170     <span class="keywordflow">return</span> <a class="code" href="../../df/d12/anim__markers_8c.html#a6b4df214ebae590f34dbf8a358f8f438">ED_markers_get_first_selected</a>(<a class="code" href="../../df/d12/anim__markers_8c.html#a7bef9082194e9cafe3525c6adbbb74da">ED_context_get_markers</a>(C)) != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00171"></a>00171 }
<a name="l00172"></a>00172 
<a name="l00173"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a82632953cea686f07358f8822c9d5826">00173</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a82632953cea686f07358f8822c9d5826">act_markers_make_local_exec</a> (<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00174"></a>00174 {   
<a name="l00175"></a>00175     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *markers = <a class="code" href="../../df/d12/anim__markers_8c.html#a7bef9082194e9cafe3525c6adbbb74da">ED_context_get_markers</a>(C);
<a name="l00176"></a>00176     
<a name="l00177"></a>00177     <a class="code" href="../../de/def/structSpaceAction.html">SpaceAction</a> *sact = <a class="code" href="../../df/d01/BKE__context_8h.html#ac4b034580691861586681b3e4cdc91f9">CTX_wm_space_action</a>(C);
<a name="l00178"></a>00178     <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *act = (sact)? sact-&gt;<a class="code" href="../../de/def/structSpaceAction.html#a2de9c936aea5ac8a1ced8254c027761c">action</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00179"></a>00179     
<a name="l00180"></a>00180     <a class="code" href="../../d2/d3e/structTimeMarker.html">TimeMarker</a> *marker, *markern=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00181"></a>00181     
<a name="l00182"></a>00182     <span class="comment">/* sanity checks */</span>
<a name="l00183"></a>00183     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, markers, act))
<a name="l00184"></a>00184         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00185"></a>00185         
<a name="l00186"></a>00186     <span class="comment">/* migrate markers */</span>
<a name="l00187"></a>00187     <span class="keywordflow">for</span> (marker = markers-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; marker; marker = markern) {
<a name="l00188"></a>00188         markern = marker-&gt;next;
<a name="l00189"></a>00189         
<a name="l00190"></a>00190         <span class="comment">/* move if marker is selected */</span>
<a name="l00191"></a>00191         <span class="keywordflow">if</span> (marker-&gt;flag &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l00192"></a>00192             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(markers, marker);
<a name="l00193"></a>00193             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;act-&gt;<a class="code" href="../../d1/d48/structbAction.html#ae841959f9a22c79888ab355d652146ca">markers</a>, marker);
<a name="l00194"></a>00194         }
<a name="l00195"></a>00195     }
<a name="l00196"></a>00196     
<a name="l00197"></a>00197     <span class="comment">/* now enable the &quot;show posemarkers only&quot; setting, so that we can see that something did happen */</span>
<a name="l00198"></a>00198     sact-&gt;<a class="code" href="../../de/def/structSpaceAction.html#aa9c9b1bb84c77908e70219d39ed8696c">flag</a> |= <a class="code" href="../../dc/d2a/DNA__action__types_8h.html#af4dbf3f7801297d71ef69d77c2724d0ea102506f37e9bb9db1f2eea7701fb9c3f">SACTION_POSEMARKERS_SHOW</a>;
<a name="l00199"></a>00199     
<a name="l00200"></a>00200     <span class="comment">/* notifiers - both sets, as this change affects both */</span>
<a name="l00201"></a>00201     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a61261a6b5ea948eee6d42c7e7ee18166">NC_SCENE</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a8e69caa8fd49513b1bf6088e9b7750a6">ND_MARKERS</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00202"></a>00202     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a8e69caa8fd49513b1bf6088e9b7750a6">ND_MARKERS</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00203"></a>00203     
<a name="l00204"></a>00204     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00205"></a>00205 }
<a name="l00206"></a>00206 
<a name="l00207"></a><a class="code" href="../../df/d02/action__intern_8h.html#a29197bfbc49058512037f86cafc68700">00207</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#ac6ec351e7c638cd79e03a27de86a6be6">ACTION_OT_markers_make_local</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00208"></a>00208 {
<a name="l00209"></a>00209     <span class="comment">/* identifiers */</span>
<a name="l00210"></a>00210     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Make Markers Local&quot;</span>;
<a name="l00211"></a>00211     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_markers_make_local&quot;</span>;
<a name="l00212"></a>00212     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Move selected scene markers to the active Action as local &#39;pose&#39; markers&quot;</span>;
<a name="l00213"></a>00213     
<a name="l00214"></a>00214     <span class="comment">/* callbacks */</span>
<a name="l00215"></a>00215     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#a82632953cea686f07358f8822c9d5826">act_markers_make_local_exec</a>;
<a name="l00216"></a>00216     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#a4f879546a40b4366a39d8a11eb49f33c">act_markers_make_local_poll</a>;
<a name="l00217"></a>00217     
<a name="l00218"></a>00218     <span class="comment">/* flags */</span>
<a name="l00219"></a>00219     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00220"></a>00220 }
<a name="l00221"></a>00221 
<a name="l00222"></a>00222 <span class="comment">/* ************************************************************************** */</span>
<a name="l00223"></a>00223 <span class="comment">/* KEYFRAME-RANGE STUFF */</span>
<a name="l00224"></a>00224 
<a name="l00225"></a>00225 <span class="comment">/* *************************** Calculate Range ************************** */</span>
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 <span class="comment">/* Get the min/max keyframes*/</span>
<a name="l00228"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a424e36d217d43f768ebd9fdbfef246ff">00228</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a424e36d217d43f768ebd9fdbfef246ff">get_keyframe_extents</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keywordtype">float</span> *<a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>, <span class="keywordtype">float</span> *<a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>, <span class="keyword">const</span> <span class="keywordtype">short</span> onlySel)
<a name="l00229"></a>00229 {
<a name="l00230"></a>00230     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00231"></a>00231     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00232"></a>00232     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00233"></a>00233     
<a name="l00234"></a>00234     <span class="comment">/* get data to filter, from Action or Dopesheet */</span>
<a name="l00235"></a>00235     <span class="comment">// XXX: what is sel doing here?!</span>
<a name="l00236"></a>00236     <span class="comment">//      Commented it, was breaking things (eg. the &quot;auto preview range&quot; tool).</span>
<a name="l00237"></a>00237     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> <span class="comment">/*| ANIMFILTER_SEL */</span><span class="comment">/*| ANIMFILTER_CURVESONLY*/</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00238"></a>00238     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00239"></a>00239     
<a name="l00240"></a>00240     <span class="comment">/* set large values to try to override */</span>
<a name="l00241"></a>00241     *min= 999999999.0f;
<a name="l00242"></a>00242     *max= -999999999.0f;
<a name="l00243"></a>00243     
<a name="l00244"></a>00244     <span class="comment">/* check if any channels to set range with */</span>
<a name="l00245"></a>00245     <span class="keywordflow">if</span> (anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>) {
<a name="l00246"></a>00246         <span class="comment">/* go through channels, finding max extents */</span>
<a name="l00247"></a>00247         <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00248"></a>00248             <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= <a class="code" href="../../d5/d34/anim__draw_8c.html#a37ad7a1d679ae57a5492066d63bb9c72">ANIM_nla_mapping_get</a>(ac, ale);
<a name="l00249"></a>00249             <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#aec6f7b3ac92e3d6d50d03ecdc587dd7d">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a697a9efd0371fe4203c3627cbcdbad85a5632b404e7965c3f9c1eaf16ee074903">ALE_GPFRAME</a>) {
<a name="l00250"></a>00250                 <a class="code" href="../../da/d7e/structbGPDlayer.html">bGPDlayer</a> *gpl= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l00251"></a>00251                 <a class="code" href="../../d7/dcf/structbGPDframe.html">bGPDframe</a> *gpf;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253                 <span class="comment">/* find gp-frame which is less than or equal to cframe */</span>
<a name="l00254"></a>00254                 <span class="keywordflow">for</span> (gpf= gpl-&gt;<a class="code" href="../../da/d7e/structbGPDlayer.html#ab6b8d0f88de061c89b2e6c982cf315d8">frames</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; gpf; gpf= gpf-&gt;<a class="code" href="../../d7/dcf/structbGPDframe.html#a4d6f43b91302df84606cc035b683243c">next</a>) {
<a name="l00255"></a>00255                     *min= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(*min, gpf-&gt;<a class="code" href="../../d7/dcf/structbGPDframe.html#afec3bb15ee1286d1d6e299b682b0c069">framenum</a>);
<a name="l00256"></a>00256                     *max= <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(*max, gpf-&gt;<a class="code" href="../../d7/dcf/structbGPDframe.html#afec3bb15ee1286d1d6e299b682b0c069">framenum</a>);
<a name="l00257"></a>00257                 }
<a name="l00258"></a>00258             }
<a name="l00259"></a>00259             <span class="keywordflow">else</span> {
<a name="l00260"></a>00260                 <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu= (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>;
<a name="l00261"></a>00261                 <span class="keywordtype">float</span> tmin, tmax;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263                 <span class="comment">/* get range and apply necessary scaling before processing */</span>
<a name="l00264"></a>00264                 <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a3ae0d09406f4d940179d6208e74b08e5">calc_fcurve_range</a>(fcu, &amp;tmin, &amp;tmax, onlySel, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00265"></a>00265 
<a name="l00266"></a>00266                 <span class="keywordflow">if</span> (adt) {
<a name="l00267"></a>00267                     tmin= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab4ae36c08ea78520b80d5d517ac20da4">BKE_nla_tweakedit_remap</a>(adt, tmin, <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035da67b7b4a040b6e4341cfbb48b51f8dcc3">NLATIME_CONVERT_MAP</a>);
<a name="l00268"></a>00268                     tmax= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab4ae36c08ea78520b80d5d517ac20da4">BKE_nla_tweakedit_remap</a>(adt, tmax, <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035da67b7b4a040b6e4341cfbb48b51f8dcc3">NLATIME_CONVERT_MAP</a>);
<a name="l00269"></a>00269                 }
<a name="l00270"></a>00270 
<a name="l00271"></a>00271                 <span class="comment">/* try to set cur using these values, if they&#39;re more extreme than previously set values */</span>
<a name="l00272"></a>00272                 *min= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(*min, tmin);
<a name="l00273"></a>00273                 *max= <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(*max, tmax);
<a name="l00274"></a>00274             }
<a name="l00275"></a>00275         }
<a name="l00276"></a>00276         
<a name="l00277"></a>00277         <span class="comment">/* free memory */</span>
<a name="l00278"></a>00278         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00279"></a>00279     }
<a name="l00280"></a>00280     <span class="keywordflow">else</span> {
<a name="l00281"></a>00281         <span class="comment">/* set default range */</span>
<a name="l00282"></a>00282         <span class="keywordflow">if</span> (ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>) {
<a name="l00283"></a>00283             *min= (float)ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a97f52582406befb3dba13b121d886526">sfra</a>;
<a name="l00284"></a>00284             *max= (<span class="keywordtype">float</span>)ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#af94766d58b62a533f851ce3f42ce026c">efra</a>;
<a name="l00285"></a>00285         }
<a name="l00286"></a>00286         <span class="keywordflow">else</span> {
<a name="l00287"></a>00287             *min= -5;
<a name="l00288"></a>00288             *max= 100;
<a name="l00289"></a>00289         }
<a name="l00290"></a>00290     }
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 <span class="comment">/* ****************** Automatic Preview-Range Operator ****************** */</span>
<a name="l00294"></a>00294 
<a name="l00295"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a61cab8974963549ba7f96b11e2c47c3f">00295</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a61cab8974963549ba7f96b11e2c47c3f">actkeys_previewrange_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00296"></a>00296 {
<a name="l00297"></a>00297     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00298"></a>00298     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene;
<a name="l00299"></a>00299     <span class="keywordtype">float</span> <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>, <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>;
<a name="l00300"></a>00300     
<a name="l00301"></a>00301     <span class="comment">/* get editor data */</span>
<a name="l00302"></a>00302     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00303"></a>00303         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00304"></a>00304     <span class="keywordflow">if</span> (ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00305"></a>00305         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00306"></a>00306     <span class="keywordflow">else</span>
<a name="l00307"></a>00307         scene= ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l00308"></a>00308     
<a name="l00309"></a>00309     <span class="comment">/* set the range directly */</span>
<a name="l00310"></a>00310     <a class="code" href="../../d2/dd6/action__edit_8c.html#a424e36d217d43f768ebd9fdbfef246ff">get_keyframe_extents</a>(&amp;ac, &amp;min, &amp;max, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00311"></a>00311     scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a774510430c9284c3c9088ddcbbad5587">flag</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a540a3b9562f581eeb0e5226fbb90afa3">SCER_PRV_RANGE</a>;
<a name="l00312"></a>00312     scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a019c2dff23be11d91575d9ac1002ef60">psfra</a>= (int)floor(min + 0.5f);
<a name="l00313"></a>00313     scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aaee474473e40650735fd619f1b357aa3">pefra</a>= (int)floor(max + 0.5f);
<a name="l00314"></a>00314     
<a name="l00315"></a>00315     <span class="comment">/* set notifier that things have changed */</span>
<a name="l00316"></a>00316     <span class="comment">// XXX err... there&#39;s nothing for frame ranges yet, but this should do fine too</span>
<a name="l00317"></a>00317     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a61261a6b5ea948eee6d42c7e7ee18166">NC_SCENE</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a93a7b7f4bba572e9176db2aa580d7aa9">ND_FRAME</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>); 
<a name="l00318"></a>00318     
<a name="l00319"></a>00319     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321  
<a name="l00322"></a><a class="code" href="../../df/d02/action__intern_8h.html#a30bf7e2d170395c638be90970191abd6">00322</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a4c654658c602a280e7eca5ed220a18eb">ACTION_OT_previewrange_set</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00323"></a>00323 {
<a name="l00324"></a>00324     <span class="comment">/* identifiers */</span>
<a name="l00325"></a>00325     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Auto-Set Preview Range&quot;</span>;
<a name="l00326"></a>00326     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_previewrange_set&quot;</span>;
<a name="l00327"></a>00327     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Set Preview Range based on extents of selected Keyframes&quot;</span>;
<a name="l00328"></a>00328     
<a name="l00329"></a>00329     <span class="comment">/* api callbacks */</span>
<a name="l00330"></a>00330     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#a61cab8974963549ba7f96b11e2c47c3f">actkeys_previewrange_exec</a>;
<a name="l00331"></a>00331     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l00332"></a>00332     
<a name="l00333"></a>00333     <span class="comment">/* flags */</span>
<a name="l00334"></a>00334     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00335"></a>00335 }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 <span class="comment">/* ****************** View-All Operator ****************** */</span>
<a name="l00338"></a>00338 
<a name="l00339"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#afbefacc8bbc1bb151c3c5127c3fabed2">00339</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#afbefacc8bbc1bb151c3c5127c3fabed2">actkeys_viewall</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keyword">const</span> <span class="keywordtype">short</span> onlySel)
<a name="l00340"></a>00340 {
<a name="l00341"></a>00341     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00342"></a>00342     <a class="code" href="../../d7/de3/structView2D.html">View2D</a> *v2d;
<a name="l00343"></a>00343     <span class="keywordtype">float</span> extra;
<a name="l00344"></a>00344     
<a name="l00345"></a>00345     <span class="comment">/* get editor data */</span>
<a name="l00346"></a>00346     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00347"></a>00347         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00348"></a>00348     v2d= &amp;ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a542e00138258c6836666296f30e0c2c0">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>;
<a name="l00349"></a>00349     
<a name="l00350"></a>00350     <span class="comment">/* set the horizontal range, with an extra offset so that the extreme keys will be in view */</span>
<a name="l00351"></a>00351     <a class="code" href="../../d2/dd6/action__edit_8c.html#a424e36d217d43f768ebd9fdbfef246ff">get_keyframe_extents</a>(&amp;ac, &amp;v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, &amp;v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>, onlySel);
<a name="l00352"></a>00352     
<a name="l00353"></a>00353     extra= 0.1f * (v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>);
<a name="l00354"></a>00354     v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> -= extra;
<a name="l00355"></a>00355     v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> += extra;
<a name="l00356"></a>00356     
<a name="l00357"></a>00357     <span class="comment">/* set vertical range */</span>
<a name="l00358"></a>00358     v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = 0.0f;
<a name="l00359"></a>00359     v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a3e5cff50450e7702e8a33b40dd056cbb">cur</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = (float)-(v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> - v2d-&gt;<a class="code" href="../../d7/de3/structView2D.html#a5cb400ea187f0be505947260808d428f">mask</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>);
<a name="l00360"></a>00360     
<a name="l00361"></a>00361     <span class="comment">/* do View2D syncing */</span>
<a name="l00362"></a>00362     <a class="code" href="../../d5/d63/UI__view2d_8h.html#ab7089b88d3b7fdc1f26037f32468c7b1">UI_view2d_sync</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C), <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C), v2d, <a class="code" href="../../d5/d63/UI__view2d_8h.html#a1df4e9b75e5090a9a745b6f6bb9846af">V2D_LOCK_COPY</a>);
<a name="l00363"></a>00363     
<a name="l00364"></a>00364     <span class="comment">/* just redraw this view */</span>
<a name="l00365"></a>00365     <a class="code" href="../../d1/d12/ED__screen_8h.html#a0982c011d985308b08320d5f9604418b">ED_area_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C));
<a name="l00366"></a>00366     
<a name="l00367"></a>00367     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00368"></a>00368 }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370 <span class="comment">/* ......... */</span>
<a name="l00371"></a>00371 
<a name="l00372"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#af96114f551f5e7350bf76c03fe938f38">00372</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#af96114f551f5e7350bf76c03fe938f38">actkeys_viewall_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00373"></a>00373 {   
<a name="l00374"></a>00374     <span class="comment">/* whole range */</span>
<a name="l00375"></a>00375     <span class="keywordflow">return</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#afbefacc8bbc1bb151c3c5127c3fabed2">actkeys_viewall</a>(C, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00376"></a>00376 }
<a name="l00377"></a>00377 
<a name="l00378"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#af4772f4bde7eb85796b2436fbd8e0fe6">00378</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#af4772f4bde7eb85796b2436fbd8e0fe6">actkeys_viewsel_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00379"></a>00379 {
<a name="l00380"></a>00380     <span class="comment">/* only selected */</span>
<a name="l00381"></a>00381     <span class="keywordflow">return</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#afbefacc8bbc1bb151c3c5127c3fabed2">actkeys_viewall</a>(C, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00382"></a>00382 }
<a name="l00383"></a>00383  
<a name="l00384"></a><a class="code" href="../../df/d02/action__intern_8h.html#a1b83445ad973d95ae42940e1897a2ed1">00384</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a36add5a66756cf586ad6112963c56a0c">ACTION_OT_view_all</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00385"></a>00385 {
<a name="l00386"></a>00386     <span class="comment">/* identifiers */</span>
<a name="l00387"></a>00387     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;View All&quot;</span>;
<a name="l00388"></a>00388     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_view_all&quot;</span>;
<a name="l00389"></a>00389     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Reset viewable area to show full keyframe range&quot;</span>;
<a name="l00390"></a>00390     
<a name="l00391"></a>00391     <span class="comment">/* api callbacks */</span>
<a name="l00392"></a>00392     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#af96114f551f5e7350bf76c03fe938f38">actkeys_viewall_exec</a>;
<a name="l00393"></a>00393     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l00394"></a>00394     
<a name="l00395"></a>00395     <span class="comment">/* flags */</span>
<a name="l00396"></a>00396     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00397"></a>00397 }
<a name="l00398"></a>00398 
<a name="l00399"></a><a class="code" href="../../df/d02/action__intern_8h.html#ae7614f95bf1cd3671aace87be70b2f9d">00399</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a07c17e06a28f0d7b6c10d074a7097b54">ACTION_OT_view_selected</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00400"></a>00400 {
<a name="l00401"></a>00401     <span class="comment">/* identifiers */</span>
<a name="l00402"></a>00402     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;View Selected&quot;</span>;
<a name="l00403"></a>00403     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_view_selected&quot;</span>;
<a name="l00404"></a>00404     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Reset viewable area to show selected keyframes range&quot;</span>;
<a name="l00405"></a>00405     
<a name="l00406"></a>00406     <span class="comment">/* api callbacks */</span>
<a name="l00407"></a>00407     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#af4772f4bde7eb85796b2436fbd8e0fe6">actkeys_viewsel_exec</a>;
<a name="l00408"></a>00408     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l00409"></a>00409     
<a name="l00410"></a>00410     <span class="comment">/* flags */</span>
<a name="l00411"></a>00411     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00412"></a>00412 }
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 <span class="comment">/* ************************************************************************** */</span>
<a name="l00415"></a>00415 <span class="comment">/* GENERAL STUFF */</span>
<a name="l00416"></a>00416 
<a name="l00417"></a>00417 <span class="comment">/* ******************** Copy/Paste Keyframes Operator ************************* */</span>
<a name="l00418"></a>00418 <span class="comment">/* NOTE: the backend code for this is shared with the graph editor */</span>
<a name="l00419"></a>00419 
<a name="l00420"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#abcc2a43bb36f8df0fd922f4d27b31f33">00420</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#abcc2a43bb36f8df0fd922f4d27b31f33">copy_action_keys</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac)
<a name="l00421"></a>00421 {   
<a name="l00422"></a>00422     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00423"></a>00423     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>, ok=0;
<a name="l00424"></a>00424     
<a name="l00425"></a>00425     <span class="comment">/* clear buffer first */</span>
<a name="l00426"></a>00426     <a class="code" href="../../db/d58/keyframes__general_8c.html#aabce3a2b0700c57c8f59b91d1b7b619d">free_anim_copybuf</a>();
<a name="l00427"></a>00427     
<a name="l00428"></a>00428     <span class="comment">/* filter data */</span>
<a name="l00429"></a>00429     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> <span class="comment">/*| ANIMFILTER_CURVESONLY*/</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00430"></a>00430     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00431"></a>00431     
<a name="l00432"></a>00432     <span class="comment">/* copy keyframes */</span>
<a name="l00433"></a>00433     ok= <a class="code" href="../../db/d58/keyframes__general_8c.html#a439fa8e89a3e02e22958c056c8748d03">copy_animedit_keys</a>(ac, &amp;anim_data);
<a name="l00434"></a>00434     
<a name="l00435"></a>00435     <span class="comment">/* clean up */</span>
<a name="l00436"></a>00436     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00437"></a>00437 
<a name="l00438"></a>00438     <span class="keywordflow">return</span> ok;
<a name="l00439"></a>00439 }
<a name="l00440"></a>00440 
<a name="l00441"></a>00441 
<a name="l00442"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a62bfb59bbe6847a300549327702dfbef">00442</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a62bfb59bbe6847a300549327702dfbef">paste_action_keys</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac,
<a name="l00443"></a>00443     <span class="keyword">const</span> <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a7343f5e1ba1ea11bbd6ed9a3c52683a1">eKeyPasteOffset</a> offset_mode, <span class="keyword">const</span> <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a5d09767fa7c3d1d57357e25d1bb593e9">eKeyMergeMode</a> merge_mode)
<a name="l00444"></a>00444 {   
<a name="l00445"></a>00445     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00446"></a>00446     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>, ok=0;
<a name="l00447"></a>00447     
<a name="l00448"></a>00448     <span class="comment">/* filter data */</span>
<a name="l00449"></a>00449     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045af15e0b18ede9eb0bdae48b6caab11403">ANIMFILTER_SEL</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a> <span class="comment">/*| ANIMFILTER_CURVESONLY*/</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00450"></a>00450     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00451"></a>00451     
<a name="l00452"></a>00452     <span class="comment">/* paste keyframes */</span>
<a name="l00453"></a>00453     ok= <a class="code" href="../../db/d58/keyframes__general_8c.html#a2af1009cf0576ddff205a9ee8c971946">paste_animedit_keys</a>(ac, &amp;anim_data, offset_mode, merge_mode);
<a name="l00454"></a>00454     
<a name="l00455"></a>00455     <span class="comment">/* clean up */</span>
<a name="l00456"></a>00456     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00457"></a>00457 
<a name="l00458"></a>00458     <span class="keywordflow">return</span> ok;
<a name="l00459"></a>00459 }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 <span class="comment">/* ------------------- */</span>
<a name="l00462"></a>00462 
<a name="l00463"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#ac52970c653cb11cf74800df404c3a896">00463</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#ac52970c653cb11cf74800df404c3a896">actkeys_copy_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00464"></a>00464 {
<a name="l00465"></a>00465     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00466"></a>00466     
<a name="l00467"></a>00467     <span class="comment">/* get editor data */</span>
<a name="l00468"></a>00468     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00469"></a>00469         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00470"></a>00470     
<a name="l00471"></a>00471     <span class="comment">/* copy keyframes */</span>
<a name="l00472"></a>00472     <span class="keywordflow">if</span> (ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>) {
<a name="l00473"></a>00473         <span class="comment">// FIXME...</span>
<a name="l00474"></a>00474         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Keyframe pasting is not available for Grease Pencil mode&quot;</span>);
<a name="l00475"></a>00475         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00476"></a>00476     }
<a name="l00477"></a>00477     <span class="keywordflow">else</span> {
<a name="l00478"></a>00478         <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd6/action__edit_8c.html#abcc2a43bb36f8df0fd922f4d27b31f33">copy_action_keys</a>(&amp;ac)) {    
<a name="l00479"></a>00479             <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;No keyframes copied to keyframes copy/paste buffer&quot;</span>);
<a name="l00480"></a>00480             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00481"></a>00481         }
<a name="l00482"></a>00482     }
<a name="l00483"></a>00483     
<a name="l00484"></a>00484     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00485"></a>00485 }
<a name="l00486"></a>00486  
<a name="l00487"></a><a class="code" href="../../df/d02/action__intern_8h.html#addbb82f78c6a74f92a486bc09205d90d">00487</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#ab355aafe1c5c6914d240042cf96add94">ACTION_OT_copy</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00488"></a>00488 {
<a name="l00489"></a>00489     <span class="comment">/* identifiers */</span>
<a name="l00490"></a>00490     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Copy Keyframes&quot;</span>;
<a name="l00491"></a>00491     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_copy&quot;</span>;
<a name="l00492"></a>00492     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Copy selected keyframes to the copy/paste buffer&quot;</span>;
<a name="l00493"></a>00493     
<a name="l00494"></a>00494     <span class="comment">/* api callbacks */</span>
<a name="l00495"></a>00495     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#ac52970c653cb11cf74800df404c3a896">actkeys_copy_exec</a>;
<a name="l00496"></a>00496     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l00497"></a>00497 
<a name="l00498"></a>00498     <span class="comment">/* flags */</span>
<a name="l00499"></a>00499     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00500"></a>00500 }
<a name="l00501"></a>00501 
<a name="l00502"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a8c72b11a94a97706feb576898abb9f5f">00502</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a8c72b11a94a97706feb576898abb9f5f">actkeys_paste_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00503"></a>00503 {
<a name="l00504"></a>00504     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00505"></a>00505 
<a name="l00506"></a>00506     <span class="keyword">const</span> <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a7343f5e1ba1ea11bbd6ed9a3c52683a1">eKeyPasteOffset</a> offset_mode= <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;offset&quot;</span>);
<a name="l00507"></a>00507     <span class="keyword">const</span> <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a5d09767fa7c3d1d57357e25d1bb593e9">eKeyMergeMode</a> merge_mode= <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;merge&quot;</span>);
<a name="l00508"></a>00508     
<a name="l00509"></a>00509     <span class="comment">/* get editor data */</span>
<a name="l00510"></a>00510     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00511"></a>00511         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00512"></a>00512         
<a name="l00513"></a>00513     <span class="comment">/* ac.reports by default will be the global reports list, which won&#39;t show warnings */</span>
<a name="l00514"></a>00514     ac.<a class="code" href="../../d6/dca/structbAnimContext.html#aa43c33a4e64d842bfcf8890cdfdf2ced">reports</a>= op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>;
<a name="l00515"></a>00515     
<a name="l00516"></a>00516     <span class="comment">/* paste keyframes */</span>
<a name="l00517"></a>00517     <span class="keywordflow">if</span> (ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>) {
<a name="l00518"></a>00518         <span class="comment">// FIXME...</span>
<a name="l00519"></a>00519         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Keyframe pasting is not available for Grease Pencil mode&quot;</span>);
<a name="l00520"></a>00520         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00521"></a>00521     }
<a name="l00522"></a>00522     <span class="keywordflow">else</span> {
<a name="l00523"></a>00523         <span class="comment">/* non-zero return means an error occurred while trying to paste */</span>
<a name="l00524"></a>00524         <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd6/action__edit_8c.html#a62bfb59bbe6847a300549327702dfbef">paste_action_keys</a>(&amp;ac, offset_mode, merge_mode)) {
<a name="l00525"></a>00525             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00526"></a>00526         }
<a name="l00527"></a>00527     }
<a name="l00528"></a>00528     
<a name="l00529"></a>00529     <span class="comment">/* validate keyframes after editing */</span>
<a name="l00530"></a>00530     <a class="code" href="../../db/d71/keyframes__edit_8c.html#a3674716b592ffe7198ea9ee213e77d73">ANIM_editkeyframes_refresh</a>(&amp;ac);
<a name="l00531"></a>00531     
<a name="l00532"></a>00532     <span class="comment">/* set notifier that keyframes have changed */</span>
<a name="l00533"></a>00533     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00534"></a>00534     
<a name="l00535"></a>00535     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00536"></a>00536 }
<a name="l00537"></a>00537  
<a name="l00538"></a><a class="code" href="../../df/d02/action__intern_8h.html#a4e62ebd2e73d9c8176bb75422e390903">00538</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a9e75828355a38cee2eb54006a492a665">ACTION_OT_paste</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00539"></a>00539 {
<a name="l00540"></a>00540     <span class="comment">/* identifiers */</span>
<a name="l00541"></a>00541     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Paste Keyframes&quot;</span>;
<a name="l00542"></a>00542     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_paste&quot;</span>;
<a name="l00543"></a>00543     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Paste keyframes from copy/paste buffer for the selected channels, starting on the current frame&quot;</span>;
<a name="l00544"></a>00544     
<a name="l00545"></a>00545     <span class="comment">/* api callbacks */</span>
<a name="l00546"></a>00546 <span class="comment">//  ot-&gt;invoke = WM_operator_props_popup; // better wait for action redo panel</span>
<a name="l00547"></a>00547     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#a8c72b11a94a97706feb576898abb9f5f">actkeys_paste_exec</a>;
<a name="l00548"></a>00548     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l00549"></a>00549     
<a name="l00550"></a>00550     <span class="comment">/* flags */</span>
<a name="l00551"></a>00551     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00552"></a>00552     
<a name="l00553"></a>00553     <span class="comment">/* props */</span>
<a name="l00554"></a>00554     <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;offset&quot;</span>, <a class="code" href="../../db/d58/keyframes__general_8c.html#ad842f622fb9f18589fb942a633487f84">keyframe_paste_offset_items</a>, <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a7343f5e1ba1ea11bbd6ed9a3c52683a1ad23ce827524de0f82196c36aca2962ee">KEYFRAME_PASTE_OFFSET_CFRA_START</a>, <span class="stringliteral">&quot;Offset&quot;</span>, <span class="stringliteral">&quot;Paste time offset of keys&quot;</span>);
<a name="l00555"></a>00555     <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;merge&quot;</span>, <a class="code" href="../../db/d58/keyframes__general_8c.html#aaef984a3b9a46ca897cb789d98ff6df0">keyframe_paste_merge_items</a>, <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a5d09767fa7c3d1d57357e25d1bb593e9ae0dd4e94e8ee95ed549e2424a701c27a">KEYFRAME_PASTE_MERGE_MIX</a>, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;Method of merging pasted keys and existing&quot;</span>);
<a name="l00556"></a>00556 }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 <span class="comment">/* ******************** Insert Keyframes Operator ************************* */</span>
<a name="l00559"></a>00559 
<a name="l00560"></a>00560 <span class="comment">/* defines for insert keyframes tool */</span>
<a name="l00561"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a3dcf9a8c0cbec49e0d72992a3799b1a3">00561</a> <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> <a class="code" href="../../d2/dd6/action__edit_8c.html#a3dcf9a8c0cbec49e0d72992a3799b1a3">prop_actkeys_insertkey_types</a>[] = {
<a name="l00562"></a>00562     {1, <span class="stringliteral">&quot;ALL&quot;</span>, 0, <span class="stringliteral">&quot;All Channels&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00563"></a>00563     {2, <span class="stringliteral">&quot;SEL&quot;</span>, 0, <span class="stringliteral">&quot;Only Selected Channels&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00564"></a>00564     {3, <span class="stringliteral">&quot;GROUP&quot;</span>, 0, <span class="stringliteral">&quot;In Active Group&quot;</span>, <span class="stringliteral">&quot;&quot;</span>}, <span class="comment">// xxx not in all cases</span>
<a name="l00565"></a>00565     {0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL}
<a name="l00566"></a>00566 };
<a name="l00567"></a>00567 
<a name="l00568"></a>00568 <span class="comment">/* this function is responsible for snapping keyframes to frame-times */</span>
<a name="l00569"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a741691097eb18975458ccce64b068e19">00569</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a741691097eb18975458ccce64b068e19">insert_action_keys</a>(<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keywordtype">short</span> mode) 
<a name="l00570"></a>00570 {
<a name="l00571"></a>00571     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00572"></a>00572     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00573"></a>00573     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00574"></a>00574     
<a name="l00575"></a>00575     <a class="code" href="../../df/df0/structReportList.html">ReportList</a> *reports = ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#aa43c33a4e64d842bfcf8890cdfdf2ced">reports</a>;
<a name="l00576"></a>00576     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l00577"></a>00577     <span class="keywordtype">short</span> flag = 0;
<a name="l00578"></a>00578     
<a name="l00579"></a>00579     <span class="comment">/* filter data */</span>
<a name="l00580"></a>00580     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a> <span class="comment">/*| ANIMFILTER_CURVESONLY*/</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00581"></a>00581     <span class="keywordflow">if</span> (mode == 2)          filter |= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045af15e0b18ede9eb0bdae48b6caab11403">ANIMFILTER_SEL</a>;
<a name="l00582"></a>00582     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == 3)     filter |= <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045afa06cd536011815e6f8e25222c41f7aa">ANIMFILTER_ACTGROUPED</a>;
<a name="l00583"></a>00583     
<a name="l00584"></a>00584     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00585"></a>00585     
<a name="l00586"></a>00586     <span class="comment">/* init keyframing flag */</span>
<a name="l00587"></a>00587     flag = <a class="code" href="../../db/d4b/keyframing_8c.html#ae69d690ee9dc8d2947eed67672d3f295">ANIM_get_keyframing_flags</a>(scene, 1);
<a name="l00588"></a>00588     
<a name="l00589"></a>00589     <span class="comment">/* insert keyframes */</span>
<a name="l00590"></a>00590     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00591"></a>00591         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= <a class="code" href="../../d5/d34/anim__draw_8c.html#a37ad7a1d679ae57a5492066d63bb9c72">ANIM_nla_mapping_get</a>(ac, ale);
<a name="l00592"></a>00592         <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu= (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>;
<a name="l00593"></a>00593         <span class="keywordtype">float</span> cfra;
<a name="l00594"></a>00594         
<a name="l00595"></a>00595         <span class="comment">/* adjust current frame for NLA-scaling */</span>
<a name="l00596"></a>00596         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (adt)
<a name="l00597"></a>00597             cfra= <a class="code" href="../../d9/de6/BKE__nla_8h.html#ab4ae36c08ea78520b80d5d517ac20da4">BKE_nla_tweakedit_remap</a>(adt, (<span class="keywordtype">float</span>)<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a>, <a class="code" href="../../d9/de6/BKE__nla_8h.html#abc5c98fcc1211af2b80116dd6e0a035dad6f4c7caaf2b3ab5e648419d521cfc9e">NLATIME_CONVERT_UNMAP</a>);
<a name="l00598"></a>00598         <span class="keywordflow">else</span> 
<a name="l00599"></a>00599             cfra= (float)CFRA;
<a name="l00600"></a>00600             
<a name="l00601"></a>00601         <span class="comment">/* if there&#39;s an id */</span>
<a name="l00602"></a>00602         <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ad2686a20c9c11e9889e3f4d9a60b8b8c">id</a>)
<a name="l00603"></a>00603             <a class="code" href="../../db/d4b/keyframing_8c.html#a7b16b21b2ffb9b0e3b5caf7c60cadc76">insert_keyframe</a>(reports, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ad2686a20c9c11e9889e3f4d9a60b8b8c">id</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ((fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a3e312bcc15bdf7b83ce03a842044350a">grp</a>)?(fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a3e312bcc15bdf7b83ce03a842044350a">grp</a>-&gt;<a class="code" href="../../d9/dcf/structbActionGroup.html#a40cae12763851806783e00f80f1e01ec">name</a>):(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)), fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a4b841fbabd01a3fd639b7672dcc1da7a">rna_path</a>, fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#ad63b7b4ef28bdd8a212bd6e35e954208">array_index</a>, cfra, flag);
<a name="l00604"></a>00604         <span class="keywordflow">else</span>
<a name="l00605"></a>00605             <a class="code" href="../../db/d4b/keyframing_8c.html#a0571cb8bf7d082031428aa24348644a9">insert_vert_fcurve</a>(fcu, cfra, fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#a49947c25d2aa958182e7d5001cb0a245">curval</a>, 0);
<a name="l00606"></a>00606     }
<a name="l00607"></a>00607     
<a name="l00608"></a>00608     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00609"></a>00609 }
<a name="l00610"></a>00610 
<a name="l00611"></a>00611 <span class="comment">/* ------------------- */</span>
<a name="l00612"></a>00612 
<a name="l00613"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#ae06e0850876408d288dab120e3d2bd40">00613</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#ae06e0850876408d288dab120e3d2bd40">actkeys_insertkey_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00614"></a>00614 {
<a name="l00615"></a>00615     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00616"></a>00616     <span class="keywordtype">short</span> mode;
<a name="l00617"></a>00617     
<a name="l00618"></a>00618     <span class="comment">/* get editor data */</span>
<a name="l00619"></a>00619     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00620"></a>00620         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00621"></a>00621     <span class="keywordflow">if</span> (ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>)
<a name="l00622"></a>00622         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00623"></a>00623         
<a name="l00624"></a>00624     <span class="comment">/* what channels to affect? */</span>
<a name="l00625"></a>00625     mode= <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;type&quot;</span>);
<a name="l00626"></a>00626     
<a name="l00627"></a>00627     <span class="comment">/* insert keyframes */</span>
<a name="l00628"></a>00628     <a class="code" href="../../d2/dd6/action__edit_8c.html#a741691097eb18975458ccce64b068e19">insert_action_keys</a>(&amp;ac, mode);
<a name="l00629"></a>00629     
<a name="l00630"></a>00630     <span class="comment">/* validate keyframes after editing */</span>
<a name="l00631"></a>00631     <a class="code" href="../../db/d71/keyframes__edit_8c.html#a3674716b592ffe7198ea9ee213e77d73">ANIM_editkeyframes_refresh</a>(&amp;ac);
<a name="l00632"></a>00632     
<a name="l00633"></a>00633     <span class="comment">/* set notifier that keyframes have changed */</span>
<a name="l00634"></a>00634     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00635"></a>00635     
<a name="l00636"></a>00636     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00637"></a>00637 }
<a name="l00638"></a>00638 
<a name="l00639"></a><a class="code" href="../../df/d02/action__intern_8h.html#a559b29cfd74ea47bee3c62a64d3039cf">00639</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a6c756f95ea729e184de40dcc3a46f834">ACTION_OT_keyframe_insert</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00640"></a>00640 {
<a name="l00641"></a>00641     <span class="comment">/* identifiers */</span>
<a name="l00642"></a>00642     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Insert Keyframes&quot;</span>;
<a name="l00643"></a>00643     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_keyframe_insert&quot;</span>;
<a name="l00644"></a>00644     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Insert keyframes for the specified channels&quot;</span>;
<a name="l00645"></a>00645     
<a name="l00646"></a>00646     <span class="comment">/* api callbacks */</span>
<a name="l00647"></a>00647     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a926375c583166540cfa96299e433e071">WM_menu_invoke</a>;
<a name="l00648"></a>00648     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#ae06e0850876408d288dab120e3d2bd40">actkeys_insertkey_exec</a>;
<a name="l00649"></a>00649     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l00650"></a>00650     
<a name="l00651"></a>00651     <span class="comment">/* flags */</span>
<a name="l00652"></a>00652     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00653"></a>00653     
<a name="l00654"></a>00654     <span class="comment">/* id-props */</span>
<a name="l00655"></a>00655     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;type&quot;</span>, prop_actkeys_insertkey_types, 0, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00656"></a>00656 }
<a name="l00657"></a>00657 
<a name="l00658"></a>00658 <span class="comment">/* ******************** Duplicate Keyframes Operator ************************* */</span>
<a name="l00659"></a>00659 
<a name="l00660"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a8b1062a2347b4e06f3ed40bc7a4d8bd5">00660</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a8b1062a2347b4e06f3ed40bc7a4d8bd5">duplicate_action_keys</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac)
<a name="l00661"></a>00661 {
<a name="l00662"></a>00662     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00663"></a>00663     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00664"></a>00664     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00665"></a>00665     
<a name="l00666"></a>00666     <span class="comment">/* filter data */</span>
<a name="l00667"></a>00667     <span class="keywordflow">if</span> (ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>)
<a name="l00668"></a>00668         filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00669"></a>00669     <span class="keywordflow">else</span>
<a name="l00670"></a>00670         filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a> <span class="comment">/*| ANIMFILTER_CURVESONLY*/</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00671"></a>00671     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00672"></a>00672     
<a name="l00673"></a>00673     <span class="comment">/* loop through filtered data and delete selected keys */</span>
<a name="l00674"></a>00674     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00675"></a>00675         <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7ac4150495b0727fbef95906be4efeba41">ANIMTYPE_FCURVE</a>)
<a name="l00676"></a>00676             <a class="code" href="../../db/d58/keyframes__general_8c.html#a0fb732d980b0f0d4aed83968102c63d1">duplicate_fcurve_keys</a>((<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>);
<a name="l00677"></a>00677         <span class="keywordflow">else</span>
<a name="l00678"></a>00678             <a class="code" href="../../d7/d35/editaction__gpencil_8c.html#a03654435d328bcdc6a28de212aed6916">duplicate_gplayer_frames</a>((<a class="code" href="../../da/d7e/structbGPDlayer.html">bGPDlayer</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>);
<a name="l00679"></a>00679     }
<a name="l00680"></a>00680     
<a name="l00681"></a>00681     <span class="comment">/* free filtered list */</span>
<a name="l00682"></a>00682     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00683"></a>00683 }
<a name="l00684"></a>00684 
<a name="l00685"></a>00685 <span class="comment">/* ------------------- */</span>
<a name="l00686"></a>00686 
<a name="l00687"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a34d549f6040e93757fe7cd6345c05113">00687</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a34d549f6040e93757fe7cd6345c05113">actkeys_duplicate_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00688"></a>00688 {
<a name="l00689"></a>00689     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00690"></a>00690     
<a name="l00691"></a>00691     <span class="comment">/* get editor data */</span>
<a name="l00692"></a>00692     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00693"></a>00693         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00694"></a>00694         
<a name="l00695"></a>00695     <span class="comment">/* duplicate keyframes */</span>
<a name="l00696"></a>00696     <a class="code" href="../../d2/dd6/action__edit_8c.html#a8b1062a2347b4e06f3ed40bc7a4d8bd5">duplicate_action_keys</a>(&amp;ac);
<a name="l00697"></a>00697     
<a name="l00698"></a>00698     <span class="comment">/* validate keyframes after editing */</span>
<a name="l00699"></a>00699     <span class="keywordflow">if</span> (ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> != <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>)
<a name="l00700"></a>00700         <a class="code" href="../../db/d71/keyframes__edit_8c.html#a3674716b592ffe7198ea9ee213e77d73">ANIM_editkeyframes_refresh</a>(&amp;ac);
<a name="l00701"></a>00701     
<a name="l00702"></a>00702     <span class="comment">/* set notifier that keyframes have changed */</span>
<a name="l00703"></a>00703     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00704"></a>00704     
<a name="l00705"></a>00705     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00706"></a>00706 }
<a name="l00707"></a>00707 
<a name="l00708"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a9edf5c8b1c1b9739a4819c8c625f8c84">00708</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a9edf5c8b1c1b9739a4819c8c625f8c84">actkeys_duplicate_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l00709"></a>00709 {
<a name="l00710"></a>00710     <a class="code" href="../../d2/dd6/action__edit_8c.html#a34d549f6040e93757fe7cd6345c05113">actkeys_duplicate_exec</a>(C, op);
<a name="l00711"></a>00711     
<a name="l00712"></a>00712     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00713"></a>00713 }
<a name="l00714"></a>00714  
<a name="l00715"></a><a class="code" href="../../df/d02/action__intern_8h.html#a98814fc6298c523a591c019f844ac08a">00715</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a580d5186167204ee39df23bc3f4a69a3">ACTION_OT_duplicate</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00716"></a>00716 {
<a name="l00717"></a>00717     <span class="comment">/* identifiers */</span>
<a name="l00718"></a>00718     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Duplicate Keyframes&quot;</span>;
<a name="l00719"></a>00719     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_duplicate&quot;</span>;
<a name="l00720"></a>00720     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Make a copy of all selected keyframes&quot;</span>;
<a name="l00721"></a>00721     
<a name="l00722"></a>00722     <span class="comment">/* api callbacks */</span>
<a name="l00723"></a>00723     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#a9edf5c8b1c1b9739a4819c8c625f8c84">actkeys_duplicate_invoke</a>;
<a name="l00724"></a>00724     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#a34d549f6040e93757fe7cd6345c05113">actkeys_duplicate_exec</a>;
<a name="l00725"></a>00725     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l00726"></a>00726     
<a name="l00727"></a>00727     <span class="comment">/* flags */</span>
<a name="l00728"></a>00728     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00729"></a>00729 }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731 <span class="comment">/* ******************** Delete Keyframes Operator ************************* */</span>
<a name="l00732"></a>00732 
<a name="l00733"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a3105e0cbb386928c39da3b0bfa410157">00733</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a3105e0cbb386928c39da3b0bfa410157">delete_action_keys</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac)
<a name="l00734"></a>00734 {
<a name="l00735"></a>00735     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00736"></a>00736     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00737"></a>00737     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00738"></a>00738     
<a name="l00739"></a>00739     <span class="comment">/* filter data */</span>
<a name="l00740"></a>00740     <span class="keywordflow">if</span> (ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>)
<a name="l00741"></a>00741         filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00742"></a>00742     <span class="keywordflow">else</span>
<a name="l00743"></a>00743         filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a> <span class="comment">/*| ANIMFILTER_CURVESONLY*/</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00744"></a>00744     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00745"></a>00745     
<a name="l00746"></a>00746     <span class="comment">/* loop through filtered data and delete selected keys */</span>
<a name="l00747"></a>00747     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00748"></a>00748         <span class="keywordflow">if</span> (ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5441225f529822c4d371c0de8bf8151f">type</a> != <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a1f9698bef8587ea2fa6522d0299e70b7a725a5252770510310f22ba17a9c37e3a">ANIMTYPE_GPLAYER</a>) {
<a name="l00749"></a>00749             <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu= (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>;
<a name="l00750"></a>00750             <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#ab7b41d9d9780a114a3ef17efbda67444">adt</a>;
<a name="l00751"></a>00751             
<a name="l00752"></a>00752             <span class="comment">/* delete selected keyframes only */</span>
<a name="l00753"></a>00753             <a class="code" href="../../db/d58/keyframes__general_8c.html#a7208ccc8657d6a2f87866acfd45e4e97">delete_fcurve_keys</a>(fcu); 
<a name="l00754"></a>00754             
<a name="l00755"></a>00755             <span class="comment">/* Only delete curve too if it won&#39;t be doing anything anymore */</span>
<a name="l00756"></a>00756             <span class="keywordflow">if</span> ((fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#adec915e7ed4f2b66b12313566bf5c33f">totvert</a> == 0) &amp;&amp; (<a class="code" href="../../da/dba/BKE__fcurve_8h.html#af507d5b05d44a294131417635cc297b9">list_has_suitable_fmodifier</a>(&amp;fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#afd96cdfbbfd2b148482ca111cefa1f74">modifiers</a>, 0, <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a048b0ea81093e0ff3691ac15274ab5a7aeb1884bc3c507d4b438f7911fc2ee1a8">FMI_TYPE_GENERATE_CURVE</a>) == 0))
<a name="l00757"></a>00757                 <a class="code" href="../../d8/dc4/anim__channels__edit_8c.html#afff2ec35984d3c8db3161ea6a269851b">ANIM_fcurve_delete_from_animdata</a>(ac, adt, fcu);
<a name="l00758"></a>00758         }
<a name="l00759"></a>00759         <span class="keywordflow">else</span>
<a name="l00760"></a>00760             <a class="code" href="../../d7/d35/editaction__gpencil_8c.html#a8b33cc2d3dd73ed24ad63c6dbbf98675">delete_gplayer_frames</a>((<a class="code" href="../../da/d7e/structbGPDlayer.html">bGPDlayer</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>);
<a name="l00761"></a>00761     }
<a name="l00762"></a>00762     
<a name="l00763"></a>00763     <span class="comment">/* free filtered list */</span>
<a name="l00764"></a>00764     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00765"></a>00765 }
<a name="l00766"></a>00766 
<a name="l00767"></a>00767 <span class="comment">/* ------------------- */</span>
<a name="l00768"></a>00768 
<a name="l00769"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a0c840047b06a5d8cbfdd1265df3de231">00769</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a0c840047b06a5d8cbfdd1265df3de231">actkeys_delete_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00770"></a>00770 {
<a name="l00771"></a>00771     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00772"></a>00772     
<a name="l00773"></a>00773     <span class="comment">/* get editor data */</span>
<a name="l00774"></a>00774     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00775"></a>00775         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00776"></a>00776         
<a name="l00777"></a>00777     <span class="comment">/* delete keyframes */</span>
<a name="l00778"></a>00778     <a class="code" href="../../d2/dd6/action__edit_8c.html#a3105e0cbb386928c39da3b0bfa410157">delete_action_keys</a>(&amp;ac);
<a name="l00779"></a>00779     
<a name="l00780"></a>00780     <span class="comment">/* validate keyframes after editing */</span>
<a name="l00781"></a>00781     <span class="keywordflow">if</span> (ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> != <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>)
<a name="l00782"></a>00782         <a class="code" href="../../db/d71/keyframes__edit_8c.html#a3674716b592ffe7198ea9ee213e77d73">ANIM_editkeyframes_refresh</a>(&amp;ac);
<a name="l00783"></a>00783     
<a name="l00784"></a>00784     <span class="comment">/* set notifier that keyframes have changed */</span>
<a name="l00785"></a>00785     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00786"></a>00786     
<a name="l00787"></a>00787     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00788"></a>00788 }
<a name="l00789"></a>00789  
<a name="l00790"></a><a class="code" href="../../df/d02/action__intern_8h.html#aea03df50743d5c6d33423b1a1d0b68c9">00790</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a5837da8b7cbce468fcdf0a7785e0929f">ACTION_OT_delete</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00791"></a>00791 {
<a name="l00792"></a>00792     <span class="comment">/* identifiers */</span>
<a name="l00793"></a>00793     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Delete Keyframes&quot;</span>;
<a name="l00794"></a>00794     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_delete&quot;</span>;
<a name="l00795"></a>00795     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Remove all selected keyframes&quot;</span>;
<a name="l00796"></a>00796     
<a name="l00797"></a>00797     <span class="comment">/* api callbacks */</span>
<a name="l00798"></a>00798     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a63ac1372a9efaaca8bec8660ff770026">WM_operator_confirm</a>;
<a name="l00799"></a>00799     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#a0c840047b06a5d8cbfdd1265df3de231">actkeys_delete_exec</a>;
<a name="l00800"></a>00800     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l00801"></a>00801     
<a name="l00802"></a>00802     <span class="comment">/* flags */</span>
<a name="l00803"></a>00803     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00804"></a>00804 }
<a name="l00805"></a>00805 
<a name="l00806"></a>00806 <span class="comment">/* ******************** Clean Keyframes Operator ************************* */</span>
<a name="l00807"></a>00807 
<a name="l00808"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a2c054323cab57a89a99e2484e851ca0f">00808</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a2c054323cab57a89a99e2484e851ca0f">clean_action_keys</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keywordtype">float</span> <a class="code" href="../../d2/d6c/mball_8c.html#aac8fef4e3b3d833f16d5cef8ddce1ae1">thresh</a>)
<a name="l00809"></a>00809 {   
<a name="l00810"></a>00810     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00811"></a>00811     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00812"></a>00812     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00813"></a>00813     
<a name="l00814"></a>00814     <span class="comment">/* filter data */</span>
<a name="l00815"></a>00815     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045af15e0b18ede9eb0bdae48b6caab11403">ANIMFILTER_SEL</a> <span class="comment">/*| ANIMFILTER_CURVESONLY*/</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00816"></a>00816     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00817"></a>00817     
<a name="l00818"></a>00818     <span class="comment">/* loop through filtered data and clean curves */</span>
<a name="l00819"></a>00819     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>)
<a name="l00820"></a>00820         <a class="code" href="../../db/d58/keyframes__general_8c.html#aa7cf0813cf482ba9d44a53dba382a760">clean_fcurve</a>((<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, thresh);
<a name="l00821"></a>00821     
<a name="l00822"></a>00822     <span class="comment">/* free temp data */</span>
<a name="l00823"></a>00823     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00824"></a>00824 }
<a name="l00825"></a>00825 
<a name="l00826"></a>00826 <span class="comment">/* ------------------- */</span>
<a name="l00827"></a>00827 
<a name="l00828"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#aa552b3785f6a19ef15ec0c4ea93ce7a6">00828</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#aa552b3785f6a19ef15ec0c4ea93ce7a6">actkeys_clean_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00829"></a>00829 {
<a name="l00830"></a>00830     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00831"></a>00831     <span class="keywordtype">float</span> <a class="code" href="../../d2/d6c/mball_8c.html#aac8fef4e3b3d833f16d5cef8ddce1ae1">thresh</a>;
<a name="l00832"></a>00832     
<a name="l00833"></a>00833     <span class="comment">/* get editor data */</span>
<a name="l00834"></a>00834     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00835"></a>00835         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00836"></a>00836     <span class="keywordflow">if</span> (ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>)
<a name="l00837"></a>00837         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l00838"></a>00838         
<a name="l00839"></a>00839     <span class="comment">/* get cleaning threshold */</span>
<a name="l00840"></a>00840     thresh= <a class="code" href="../../d3/d10/rna__access_8c.html#a99bfb3295a4df6fef29f16924fd24c79">RNA_float_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;threshold&quot;</span>);
<a name="l00841"></a>00841     
<a name="l00842"></a>00842     <span class="comment">/* clean keyframes */</span>
<a name="l00843"></a>00843     <a class="code" href="../../d2/dd6/action__edit_8c.html#a2c054323cab57a89a99e2484e851ca0f">clean_action_keys</a>(&amp;ac, thresh);
<a name="l00844"></a>00844     
<a name="l00845"></a>00845     <span class="comment">/* validate keyframes after editing */</span>
<a name="l00846"></a>00846     <a class="code" href="../../db/d71/keyframes__edit_8c.html#a3674716b592ffe7198ea9ee213e77d73">ANIM_editkeyframes_refresh</a>(&amp;ac);
<a name="l00847"></a>00847     
<a name="l00848"></a>00848     <span class="comment">/* set notifier that keyframes have changed */</span>
<a name="l00849"></a>00849     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00850"></a>00850     
<a name="l00851"></a>00851     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00852"></a>00852 }
<a name="l00853"></a>00853  
<a name="l00854"></a><a class="code" href="../../df/d02/action__intern_8h.html#a81752e0232b1b35a797aae588e69a9b3">00854</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#af27aa98ea065419458ea3df70579bfc4">ACTION_OT_clean</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00855"></a>00855 {
<a name="l00856"></a>00856     <span class="comment">/* identifiers */</span>
<a name="l00857"></a>00857     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Clean Keyframes&quot;</span>;
<a name="l00858"></a>00858     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_clean&quot;</span>;
<a name="l00859"></a>00859     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Simplify F-Curves by removing closely spaced keyframes&quot;</span>;
<a name="l00860"></a>00860     
<a name="l00861"></a>00861     <span class="comment">/* api callbacks */</span>
<a name="l00862"></a>00862     <span class="comment">//ot-&gt;invoke =  // XXX we need that number popup for this! </span>
<a name="l00863"></a>00863     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#aa552b3785f6a19ef15ec0c4ea93ce7a6">actkeys_clean_exec</a>;
<a name="l00864"></a>00864     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l00865"></a>00865     
<a name="l00866"></a>00866     <span class="comment">/* flags */</span>
<a name="l00867"></a>00867     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00868"></a>00868     
<a name="l00869"></a>00869     <span class="comment">/* properties */</span>
<a name="l00870"></a>00870     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#a040f4b08fc87a45a90e2291382e27f75">RNA_def_float</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;threshold&quot;</span>, 0.001f, 0.0f, <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>, <span class="stringliteral">&quot;Threshold&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 0.0f, 1000.0f);
<a name="l00871"></a>00871 }
<a name="l00872"></a>00872 
<a name="l00873"></a>00873 <span class="comment">/* ******************** Sample Keyframes Operator *********************** */</span>
<a name="l00874"></a>00874 
<a name="l00875"></a>00875 <span class="comment">/* Evaluates the curves between each selected keyframe on each frame, and keys the value  */</span>
<a name="l00876"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a9900c195e4c201b8a390faf737ceab7e">00876</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a9900c195e4c201b8a390faf737ceab7e">sample_action_keys</a> (<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac)
<a name="l00877"></a>00877 {   
<a name="l00878"></a>00878     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00879"></a>00879     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00880"></a>00880     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00881"></a>00881     
<a name="l00882"></a>00882     <span class="comment">/* filter data */</span>
<a name="l00883"></a>00883     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a> <span class="comment">/*| ANIMFILTER_CURVESONLY*/</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00884"></a>00884     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00885"></a>00885     
<a name="l00886"></a>00886     <span class="comment">/* loop through filtered data and add keys between selected keyframes on every frame  */</span>
<a name="l00887"></a>00887     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>)
<a name="l00888"></a>00888         <a class="code" href="../../db/d58/keyframes__general_8c.html#a704d11dc6951b9132bb6ace4a2af477d">sample_fcurve</a>((<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>);
<a name="l00889"></a>00889     
<a name="l00890"></a>00890     <span class="comment">/* admin and redraws */</span>
<a name="l00891"></a>00891     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00892"></a>00892 }
<a name="l00893"></a>00893 
<a name="l00894"></a>00894 <span class="comment">/* ------------------- */</span>
<a name="l00895"></a>00895 
<a name="l00896"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a1b8e99021100d8189137688053e7cb70">00896</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a1b8e99021100d8189137688053e7cb70">actkeys_sample_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00897"></a>00897 {
<a name="l00898"></a>00898     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l00899"></a>00899     
<a name="l00900"></a>00900     <span class="comment">/* get editor data */</span>
<a name="l00901"></a>00901     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l00902"></a>00902         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00903"></a>00903     <span class="keywordflow">if</span> (ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>)
<a name="l00904"></a>00904         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l00905"></a>00905     
<a name="l00906"></a>00906     <span class="comment">/* sample keyframes */</span>
<a name="l00907"></a>00907     <a class="code" href="../../d2/dd6/action__edit_8c.html#a9900c195e4c201b8a390faf737ceab7e">sample_action_keys</a>(&amp;ac);
<a name="l00908"></a>00908     
<a name="l00909"></a>00909     <span class="comment">/* validate keyframes after editing */</span>
<a name="l00910"></a>00910     <a class="code" href="../../db/d71/keyframes__edit_8c.html#a3674716b592ffe7198ea9ee213e77d73">ANIM_editkeyframes_refresh</a>(&amp;ac);
<a name="l00911"></a>00911     
<a name="l00912"></a>00912     <span class="comment">/* set notifier that keyframes have changed */</span>
<a name="l00913"></a>00913     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00914"></a>00914     
<a name="l00915"></a>00915     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00916"></a>00916 }
<a name="l00917"></a>00917  
<a name="l00918"></a><a class="code" href="../../df/d02/action__intern_8h.html#a4215125a87dfd5e890e844acdfab83b0">00918</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a44153f81b4adbc49a105dae0244f8ceb">ACTION_OT_sample</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00919"></a>00919 {
<a name="l00920"></a>00920     <span class="comment">/* identifiers */</span>
<a name="l00921"></a>00921     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Sample Keyframes&quot;</span>;
<a name="l00922"></a>00922     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_sample&quot;</span>;
<a name="l00923"></a>00923     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Add keyframes on every frame between the selected keyframes&quot;</span>;
<a name="l00924"></a>00924     
<a name="l00925"></a>00925     <span class="comment">/* api callbacks */</span>
<a name="l00926"></a>00926     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#a1b8e99021100d8189137688053e7cb70">actkeys_sample_exec</a>;
<a name="l00927"></a>00927     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l00928"></a>00928     
<a name="l00929"></a>00929     <span class="comment">/* flags */</span>
<a name="l00930"></a>00930     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00931"></a>00931 }
<a name="l00932"></a>00932 
<a name="l00933"></a>00933 <span class="comment">/* ************************************************************************** */</span>
<a name="l00934"></a>00934 <span class="comment">/* SETTINGS STUFF */</span>
<a name="l00935"></a>00935 
<a name="l00936"></a>00936 <span class="comment">/* ******************** Set Extrapolation-Type Operator *********************** */</span>
<a name="l00937"></a>00937 
<a name="l00938"></a>00938 <span class="comment">/* defines for make/clear cyclic extrapolation tools */</span>
<a name="l00939"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a940511c14b526eb468926aae7e1d4b92">00939</a> <span class="preprocessor">#define MAKE_CYCLIC_EXPO    -1</span>
<a name="l00940"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#af347fc61f538843e5b55c0f8d3d860b6">00940</a> <span class="preprocessor"></span><span class="preprocessor">#define CLEAR_CYCLIC_EXPO   -2</span>
<a name="l00941"></a>00941 <span class="preprocessor"></span>
<a name="l00942"></a>00942 <span class="comment">/* defines for set extrapolation-type for selected keyframes tool */</span>
<a name="l00943"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a62c4f4a94fe84fd19eaa291533eb2075">00943</a> <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> <a class="code" href="../../d2/dd6/action__edit_8c.html#a62c4f4a94fe84fd19eaa291533eb2075">prop_actkeys_expo_types</a>[] = {
<a name="l00944"></a>00944     {<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#adb4a5053227c5d734c2586c5b536ddcaa5bd72cf7f090932e6427cac8ac0f6dc5">FCURVE_EXTRAPOLATE_CONSTANT</a>, <span class="stringliteral">&quot;CONSTANT&quot;</span>, 0, <span class="stringliteral">&quot;Constant Extrapolation&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00945"></a>00945     {<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#adb4a5053227c5d734c2586c5b536ddcaa9fb213c325c652c818d9a4025fb9de47">FCURVE_EXTRAPOLATE_LINEAR</a>, <span class="stringliteral">&quot;LINEAR&quot;</span>, 0, <span class="stringliteral">&quot;Linear Extrapolation&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l00946"></a>00946     
<a name="l00947"></a>00947     {<a class="code" href="../../d2/dd6/action__edit_8c.html#a940511c14b526eb468926aae7e1d4b92">MAKE_CYCLIC_EXPO</a>, <span class="stringliteral">&quot;MAKE_CYCLIC&quot;</span>, 0, <span class="stringliteral">&quot;Make Cyclic (F-Modifier)&quot;</span>, <span class="stringliteral">&quot;Add Cycles F-Modifier if one doesn&#39;t exist already&quot;</span>},
<a name="l00948"></a>00948     {<a class="code" href="../../d2/dd6/action__edit_8c.html#af347fc61f538843e5b55c0f8d3d860b6">CLEAR_CYCLIC_EXPO</a>, <span class="stringliteral">&quot;CLEAR_CYCLIC&quot;</span>, 0, <span class="stringliteral">&quot;Clear Cyclic (F-Modifier)&quot;</span>, <span class="stringliteral">&quot;Remove Cycles F-Modifier if not needed anymore&quot;</span>},
<a name="l00949"></a>00949     {0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL}
<a name="l00950"></a>00950 };
<a name="l00951"></a>00951 
<a name="l00952"></a>00952 <span class="comment">/* this function is responsible for setting extrapolation mode for keyframes */</span>
<a name="l00953"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#ae9b225bc0bccc6bdbc4548f7f635c38d">00953</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#ae9b225bc0bccc6bdbc4548f7f635c38d">setexpo_action_keys</a>(<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keywordtype">short</span> mode) 
<a name="l00954"></a>00954 {
<a name="l00955"></a>00955     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00956"></a>00956     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l00957"></a>00957     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l00958"></a>00958     
<a name="l00959"></a>00959     <span class="comment">/* filter data */</span>
<a name="l00960"></a>00960     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045af15e0b18ede9eb0bdae48b6caab11403">ANIMFILTER_SEL</a> <span class="comment">/*| ANIMFILTER_CURVESONLY*/</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l00961"></a>00961     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l00962"></a>00962     
<a name="l00963"></a>00963     <span class="comment">/* loop through setting mode per F-Curve */</span>
<a name="l00964"></a>00964     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l00965"></a>00965         <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu= (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a954a70adedee38f0fe952eda8c704fff">data</a>;
<a name="l00966"></a>00966         
<a name="l00967"></a>00967         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (mode &gt;= 0) {
<a name="l00968"></a>00968             <span class="comment">/* just set mode setting */</span>
<a name="l00969"></a>00969             fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#ac932d96a37634a3b105b80b0daf3afd5">extend</a>= mode;
<a name="l00970"></a>00970         }
<a name="l00971"></a>00971         <span class="keywordflow">else</span> {
<a name="l00972"></a>00972             <span class="comment">/* shortcuts for managing Cycles F-Modifiers to make it easier to toggle cyclic animation </span>
<a name="l00973"></a>00973 <span class="comment">             * without having to go through FModifier UI in Graph Editor to do so</span>
<a name="l00974"></a>00974 <span class="comment">             */</span>
<a name="l00975"></a>00975             <span class="keywordflow">if</span> (mode == <a class="code" href="../../d2/dd6/action__edit_8c.html#a940511c14b526eb468926aae7e1d4b92">MAKE_CYCLIC_EXPO</a>) {
<a name="l00976"></a>00976                 <span class="comment">/* only add if one doesn&#39;t exist */</span>
<a name="l00977"></a>00977                 <span class="keywordflow">if</span> (<a class="code" href="../../da/dba/BKE__fcurve_8h.html#af507d5b05d44a294131417635cc297b9">list_has_suitable_fmodifier</a>(&amp;fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#afd96cdfbbfd2b148482ca111cefa1f74">modifiers</a>, <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a780a87e4018e6dbc53e4dc812f83c97ba0a9f871f719b71334e21fb78f83aa48d">FMODIFIER_TYPE_CYCLES</a>, -1) == 0) {
<a name="l00978"></a>00978                     <span class="comment">// TODO: add some more preset versions which set different extrapolation options?</span>
<a name="l00979"></a>00979                     <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a782b8a634387db32ffbadd880093bf60">add_fmodifier</a>(&amp;fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#afd96cdfbbfd2b148482ca111cefa1f74">modifiers</a>, <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a780a87e4018e6dbc53e4dc812f83c97ba0a9f871f719b71334e21fb78f83aa48d">FMODIFIER_TYPE_CYCLES</a>);
<a name="l00980"></a>00980                 }
<a name="l00981"></a>00981             }
<a name="l00982"></a>00982             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == <a class="code" href="../../d2/dd6/action__edit_8c.html#af347fc61f538843e5b55c0f8d3d860b6">CLEAR_CYCLIC_EXPO</a>) {
<a name="l00983"></a>00983                 <span class="comment">/* remove all the modifiers fitting this description */</span>
<a name="l00984"></a>00984                 <a class="code" href="../../dc/d68/structFModifier.html">FModifier</a> *fcm, *fcn=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00985"></a>00985                 
<a name="l00986"></a>00986                 <span class="keywordflow">for</span> (fcm = fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#afd96cdfbbfd2b148482ca111cefa1f74">modifiers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; fcm; fcm = fcn) {
<a name="l00987"></a>00987                     fcn = fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a2b03be89329aab5401fcd674e0f2d9ca">next</a>;
<a name="l00988"></a>00988                     
<a name="l00989"></a>00989                     <span class="keywordflow">if</span> (fcm-&gt;<a class="code" href="../../dc/d68/structFModifier.html#a2618b2144f7498de1afe54faa6692344">type</a> == <a class="code" href="../../d5/ddb/DNA__anim__types_8h.html#a780a87e4018e6dbc53e4dc812f83c97ba0a9f871f719b71334e21fb78f83aa48d">FMODIFIER_TYPE_CYCLES</a>)
<a name="l00990"></a>00990                         <a class="code" href="../../da/dba/BKE__fcurve_8h.html#a0c7fe5f18826b120b79ce4c17f1ac17d">remove_fmodifier</a>(&amp;fcu-&gt;<a class="code" href="../../d6/df2/structFCurve.html#afd96cdfbbfd2b148482ca111cefa1f74">modifiers</a>, fcm);
<a name="l00991"></a>00991                 }
<a name="l00992"></a>00992             }
<a name="l00993"></a>00993         }
<a name="l00994"></a>00994     }
<a name="l00995"></a>00995     
<a name="l00996"></a>00996     <span class="comment">/* cleanup */</span>
<a name="l00997"></a>00997     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l00998"></a>00998 }
<a name="l00999"></a>00999 
<a name="l01000"></a>01000 <span class="comment">/* ------------------- */</span>
<a name="l01001"></a>01001 
<a name="l01002"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#ad3ddabd45a1978f30242059d8eea0eb4">01002</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#ad3ddabd45a1978f30242059d8eea0eb4">actkeys_expo_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01003"></a>01003 {
<a name="l01004"></a>01004     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01005"></a>01005     <span class="keywordtype">short</span> mode;
<a name="l01006"></a>01006     
<a name="l01007"></a>01007     <span class="comment">/* get editor data */</span>
<a name="l01008"></a>01008     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01009"></a>01009         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01010"></a>01010     <span class="keywordflow">if</span> (ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>) 
<a name="l01011"></a>01011         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l01012"></a>01012         
<a name="l01013"></a>01013     <span class="comment">/* get handle setting mode */</span>
<a name="l01014"></a>01014     mode= <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;type&quot;</span>);
<a name="l01015"></a>01015     
<a name="l01016"></a>01016     <span class="comment">/* set handle type */</span>
<a name="l01017"></a>01017     <a class="code" href="../../d2/dd6/action__edit_8c.html#ae9b225bc0bccc6bdbc4548f7f635c38d">setexpo_action_keys</a>(&amp;ac, mode);
<a name="l01018"></a>01018     
<a name="l01019"></a>01019     <span class="comment">/* validate keyframes after editing */</span>
<a name="l01020"></a>01020     <a class="code" href="../../db/d71/keyframes__edit_8c.html#a3674716b592ffe7198ea9ee213e77d73">ANIM_editkeyframes_refresh</a>(&amp;ac);
<a name="l01021"></a>01021     
<a name="l01022"></a>01022     <span class="comment">/* set notifier that keyframe properties have changed */</span>
<a name="l01023"></a>01023     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a7f09fa8269c80b98dae22ad97b49b532">ND_KEYFRAME_PROP</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01024"></a>01024     
<a name="l01025"></a>01025     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01026"></a>01026 }
<a name="l01027"></a>01027  
<a name="l01028"></a><a class="code" href="../../df/d02/action__intern_8h.html#aef07a8a71152ee9e65b07e1020270a1e">01028</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a68792ac51d822f89411d99baf2cf43d4">ACTION_OT_extrapolation_type</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01029"></a>01029 {
<a name="l01030"></a>01030     <span class="comment">/* identifiers */</span>
<a name="l01031"></a>01031     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Set Keyframe Extrapolation&quot;</span>;
<a name="l01032"></a>01032     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_extrapolation_type&quot;</span>;
<a name="l01033"></a>01033     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Set extrapolation mode for selected F-Curves&quot;</span>;
<a name="l01034"></a>01034     
<a name="l01035"></a>01035     <span class="comment">/* api callbacks */</span>
<a name="l01036"></a>01036     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a926375c583166540cfa96299e433e071">WM_menu_invoke</a>;
<a name="l01037"></a>01037     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#ad3ddabd45a1978f30242059d8eea0eb4">actkeys_expo_exec</a>;
<a name="l01038"></a>01038     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l01039"></a>01039     
<a name="l01040"></a>01040     <span class="comment">/* flags */</span>
<a name="l01041"></a>01041     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01042"></a>01042     
<a name="l01043"></a>01043     <span class="comment">/* id-props */</span>
<a name="l01044"></a>01044     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;type&quot;</span>, prop_actkeys_expo_types, 0, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01045"></a>01045 }
<a name="l01046"></a>01046 
<a name="l01047"></a>01047 <span class="comment">/* ******************** Set Interpolation-Type Operator *********************** */</span>
<a name="l01048"></a>01048 
<a name="l01049"></a>01049 <span class="comment">/* this function is responsible for setting interpolation mode for keyframes */</span>
<a name="l01050"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a76cfe42585a14521f6ba54064ad7bd19">01050</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a76cfe42585a14521f6ba54064ad7bd19">setipo_action_keys</a>(<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keywordtype">short</span> mode) 
<a name="l01051"></a>01051 {
<a name="l01052"></a>01052     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01053"></a>01053     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l01054"></a>01054     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l01055"></a>01055     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> set_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#ab86fce43e4f66eeeac7df54c03deaae9">ANIM_editkeyframes_ipo</a>(mode);
<a name="l01056"></a>01056     
<a name="l01057"></a>01057     <span class="comment">/* filter data */</span>
<a name="l01058"></a>01058     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a> <span class="comment">/*| ANIMFILTER_CURVESONLY*/</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l01059"></a>01059     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l01060"></a>01060     
<a name="l01061"></a>01061     <span class="comment">/* loop through setting BezTriple interpolation</span>
<a name="l01062"></a>01062 <span class="comment">     * Note: we do not supply KeyframeEditData to the looper yet. Currently that&#39;s not necessary here...</span>
<a name="l01063"></a>01063 <span class="comment">     */</span>
<a name="l01064"></a>01064     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>)
<a name="l01065"></a>01065         <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, set_cb, <a class="code" href="../../da/dba/BKE__fcurve_8h.html#abb464452313d3795a48da7421069f9e3">calchandles_fcurve</a>);
<a name="l01066"></a>01066     
<a name="l01067"></a>01067     <span class="comment">/* cleanup */</span>
<a name="l01068"></a>01068     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01069"></a>01069 }
<a name="l01070"></a>01070 
<a name="l01071"></a>01071 <span class="comment">/* ------------------- */</span>
<a name="l01072"></a>01072 
<a name="l01073"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a6aceee33b6f63ffee2a8ba947bc46716">01073</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a6aceee33b6f63ffee2a8ba947bc46716">actkeys_ipo_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01074"></a>01074 {
<a name="l01075"></a>01075     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01076"></a>01076     <span class="keywordtype">short</span> mode;
<a name="l01077"></a>01077     
<a name="l01078"></a>01078     <span class="comment">/* get editor data */</span>
<a name="l01079"></a>01079     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01080"></a>01080         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01081"></a>01081     <span class="keywordflow">if</span> (ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>) 
<a name="l01082"></a>01082         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l01083"></a>01083         
<a name="l01084"></a>01084     <span class="comment">/* get handle setting mode */</span>
<a name="l01085"></a>01085     mode= <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;type&quot;</span>);
<a name="l01086"></a>01086     
<a name="l01087"></a>01087     <span class="comment">/* set handle type */</span>
<a name="l01088"></a>01088     <a class="code" href="../../d2/dd6/action__edit_8c.html#a76cfe42585a14521f6ba54064ad7bd19">setipo_action_keys</a>(&amp;ac, mode);
<a name="l01089"></a>01089     
<a name="l01090"></a>01090     <span class="comment">/* validate keyframes after editing */</span>
<a name="l01091"></a>01091     <a class="code" href="../../db/d71/keyframes__edit_8c.html#a3674716b592ffe7198ea9ee213e77d73">ANIM_editkeyframes_refresh</a>(&amp;ac);
<a name="l01092"></a>01092     
<a name="l01093"></a>01093     <span class="comment">/* set notifier that keyframe properties have changed */</span>
<a name="l01094"></a>01094     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a7f09fa8269c80b98dae22ad97b49b532">ND_KEYFRAME_PROP</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01095"></a>01095     
<a name="l01096"></a>01096     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01097"></a>01097 }
<a name="l01098"></a>01098  
<a name="l01099"></a><a class="code" href="../../df/d02/action__intern_8h.html#a53b82741fa9edf860330810e400dd53b">01099</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#ac87469551a394b0993b3a09e3062fcaf">ACTION_OT_interpolation_type</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01100"></a>01100 {
<a name="l01101"></a>01101     <span class="comment">/* identifiers */</span>
<a name="l01102"></a>01102     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Set Keyframe Interpolation&quot;</span>;
<a name="l01103"></a>01103     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_interpolation_type&quot;</span>;
<a name="l01104"></a>01104     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Set interpolation mode for the F-Curve segments starting from the selected keyframes&quot;</span>;
<a name="l01105"></a>01105     
<a name="l01106"></a>01106     <span class="comment">/* api callbacks */</span>
<a name="l01107"></a>01107     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a926375c583166540cfa96299e433e071">WM_menu_invoke</a>;
<a name="l01108"></a>01108     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#a6aceee33b6f63ffee2a8ba947bc46716">actkeys_ipo_exec</a>;
<a name="l01109"></a>01109     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l01110"></a>01110     
<a name="l01111"></a>01111     <span class="comment">/* flags */</span>
<a name="l01112"></a>01112     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01113"></a>01113     
<a name="l01114"></a>01114     <span class="comment">/* id-props */</span>
<a name="l01115"></a>01115     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;type&quot;</span>, <a class="code" href="../../db/da5/rna__curve_8c.html#a0dec1de606d025db574bfd289ff6eeb1">beztriple_interpolation_mode_items</a>, 0, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01116"></a>01116 }
<a name="l01117"></a>01117 
<a name="l01118"></a>01118 <span class="comment">/* ******************** Set Handle-Type Operator *********************** */</span>
<a name="l01119"></a>01119 
<a name="l01120"></a>01120 <span class="comment">/* this function is responsible for setting handle-type of selected keyframes */</span>
<a name="l01121"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#aad67a91d225a5af774b76fb415a97991">01121</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#aad67a91d225a5af774b76fb415a97991">sethandles_action_keys</a>(<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keywordtype">short</span> mode) 
<a name="l01122"></a>01122 {
<a name="l01123"></a>01123     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01124"></a>01124     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l01125"></a>01125     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l01126"></a>01126     
<a name="l01127"></a>01127     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> edit_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#a1806034e52d545f8b82fc41891e5a63a">ANIM_editkeyframes_handles</a>(mode);
<a name="l01128"></a>01128     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> sel_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#ad8d50a9387bd9e246565328e381e1026">ANIM_editkeyframes_ok</a>(<a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a8e98b37d6c08d1ff6782cda85ede7f39aa3a47676c0cdcc866536e24fe737afdb">BEZT_OK_SELECTED</a>);
<a name="l01129"></a>01129     
<a name="l01130"></a>01130     <span class="comment">/* filter data */</span>
<a name="l01131"></a>01131     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a> <span class="comment">/*| ANIMFILTER_CURVESONLY*/</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l01132"></a>01132     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l01133"></a>01133     
<a name="l01134"></a>01134     <span class="comment">/* loop through setting flags for handles </span>
<a name="l01135"></a>01135 <span class="comment">     * Note: we do not supply KeyframeEditData to the looper yet. Currently that&#39;s not necessary here...</span>
<a name="l01136"></a>01136 <span class="comment">     */</span>
<a name="l01137"></a>01137     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l01138"></a>01138         <a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *fcu= (<a class="code" href="../../d6/df2/structFCurve.html">FCurve</a> *)ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>;
<a name="l01139"></a>01139         
<a name="l01140"></a>01140         <span class="comment">/* any selected keyframes for editing? */</span>
<a name="l01141"></a>01141         <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (<a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, fcu, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, sel_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {
<a name="l01142"></a>01142             <span class="comment">/* change type of selected handles */</span>
<a name="l01143"></a>01143             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, fcu, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, edit_cb, <a class="code" href="../../da/dba/BKE__fcurve_8h.html#abb464452313d3795a48da7421069f9e3">calchandles_fcurve</a>);
<a name="l01144"></a>01144         }
<a name="l01145"></a>01145     }
<a name="l01146"></a>01146     
<a name="l01147"></a>01147     <span class="comment">/* cleanup */</span>
<a name="l01148"></a>01148     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01149"></a>01149 }
<a name="l01150"></a>01150 
<a name="l01151"></a>01151 <span class="comment">/* ------------------- */</span>
<a name="l01152"></a>01152 
<a name="l01153"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#ad5ece6b0bbbc58729f093e187a140f95">01153</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#ad5ece6b0bbbc58729f093e187a140f95">actkeys_handletype_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01154"></a>01154 {
<a name="l01155"></a>01155     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01156"></a>01156     <span class="keywordtype">short</span> mode;
<a name="l01157"></a>01157     
<a name="l01158"></a>01158     <span class="comment">/* get editor data */</span>
<a name="l01159"></a>01159     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01160"></a>01160         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01161"></a>01161     <span class="keywordflow">if</span> (ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>) 
<a name="l01162"></a>01162         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l01163"></a>01163         
<a name="l01164"></a>01164     <span class="comment">/* get handle setting mode */</span>
<a name="l01165"></a>01165     mode= <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;type&quot;</span>);
<a name="l01166"></a>01166     
<a name="l01167"></a>01167     <span class="comment">/* set handle type */</span>
<a name="l01168"></a>01168     <a class="code" href="../../d2/dd6/action__edit_8c.html#aad67a91d225a5af774b76fb415a97991">sethandles_action_keys</a>(&amp;ac, mode);
<a name="l01169"></a>01169     
<a name="l01170"></a>01170     <span class="comment">/* validate keyframes after editing */</span>
<a name="l01171"></a>01171     <a class="code" href="../../db/d71/keyframes__edit_8c.html#a3674716b592ffe7198ea9ee213e77d73">ANIM_editkeyframes_refresh</a>(&amp;ac);
<a name="l01172"></a>01172     
<a name="l01173"></a>01173     <span class="comment">/* set notifier that keyframe properties have changed */</span>
<a name="l01174"></a>01174     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a7f09fa8269c80b98dae22ad97b49b532">ND_KEYFRAME_PROP</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01175"></a>01175     
<a name="l01176"></a>01176     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01177"></a>01177 }
<a name="l01178"></a>01178  
<a name="l01179"></a><a class="code" href="../../df/d02/action__intern_8h.html#a3367c06e7e64600df647f80f190c3ed0">01179</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#adafa9ebded4b1cd3b8c5ab4633add85a">ACTION_OT_handle_type</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01180"></a>01180 {
<a name="l01181"></a>01181     <span class="comment">/* identifiers */</span>
<a name="l01182"></a>01182     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Set Keyframe Handle Type&quot;</span>;
<a name="l01183"></a>01183     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_handle_type&quot;</span>;
<a name="l01184"></a>01184     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Set type of handle for selected keyframes&quot;</span>;
<a name="l01185"></a>01185     
<a name="l01186"></a>01186     <span class="comment">/* api callbacks */</span>
<a name="l01187"></a>01187     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a926375c583166540cfa96299e433e071">WM_menu_invoke</a>;
<a name="l01188"></a>01188     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#ad5ece6b0bbbc58729f093e187a140f95">actkeys_handletype_exec</a>;
<a name="l01189"></a>01189     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l01190"></a>01190     
<a name="l01191"></a>01191     <span class="comment">/* flags */</span>
<a name="l01192"></a>01192     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01193"></a>01193     
<a name="l01194"></a>01194     <span class="comment">/* id-props */</span>
<a name="l01195"></a>01195     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;type&quot;</span>, <a class="code" href="../../db/da5/rna__curve_8c.html#a2e44021e2a1d98b64a9e54e564c1e526">keyframe_handle_type_items</a>, 0, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01196"></a>01196 }
<a name="l01197"></a>01197 
<a name="l01198"></a>01198 <span class="comment">/* ******************** Set Keyframe-Type Operator *********************** */</span>
<a name="l01199"></a>01199 
<a name="l01200"></a>01200 <span class="comment">/* this function is responsible for setting interpolation mode for keyframes */</span>
<a name="l01201"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#aee7ffbbff6b4d85f77fb0356c3bb598f">01201</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#aee7ffbbff6b4d85f77fb0356c3bb598f">setkeytype_action_keys</a>(<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keywordtype">short</span> mode) 
<a name="l01202"></a>01202 {
<a name="l01203"></a>01203     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01204"></a>01204     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l01205"></a>01205     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l01206"></a>01206     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> set_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#a7ffa96d7c2ede27fc7ea077a32faf4ea">ANIM_editkeyframes_keytype</a>(mode);
<a name="l01207"></a>01207     
<a name="l01208"></a>01208     <span class="comment">/* filter data */</span>
<a name="l01209"></a>01209     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a> <span class="comment">/*| ANIMFILTER_CURVESONLY*/</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l01210"></a>01210     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l01211"></a>01211     
<a name="l01212"></a>01212     <span class="comment">/* loop through setting BezTriple interpolation</span>
<a name="l01213"></a>01213 <span class="comment">     * Note: we do not supply KeyframeEditData to the looper yet. Currently that&#39;s not necessary here...</span>
<a name="l01214"></a>01214 <span class="comment">     */</span>
<a name="l01215"></a>01215     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>)
<a name="l01216"></a>01216         <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, set_cb, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01217"></a>01217     
<a name="l01218"></a>01218     <span class="comment">/* cleanup */</span>
<a name="l01219"></a>01219     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01220"></a>01220 }
<a name="l01221"></a>01221 
<a name="l01222"></a>01222 <span class="comment">/* ------------------- */</span>
<a name="l01223"></a>01223 
<a name="l01224"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#afa7c3215df6368b55a28ccf16a674fb4">01224</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#afa7c3215df6368b55a28ccf16a674fb4">actkeys_keytype_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01225"></a>01225 {
<a name="l01226"></a>01226     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01227"></a>01227     <span class="keywordtype">short</span> mode;
<a name="l01228"></a>01228     
<a name="l01229"></a>01229     <span class="comment">/* get editor data */</span>
<a name="l01230"></a>01230     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01231"></a>01231         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01232"></a>01232     <span class="keywordflow">if</span> (ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>) 
<a name="l01233"></a>01233         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l01234"></a>01234         
<a name="l01235"></a>01235     <span class="comment">/* get handle setting mode */</span>
<a name="l01236"></a>01236     mode= <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;type&quot;</span>);
<a name="l01237"></a>01237     
<a name="l01238"></a>01238     <span class="comment">/* set handle type */</span>
<a name="l01239"></a>01239     <a class="code" href="../../d2/dd6/action__edit_8c.html#aee7ffbbff6b4d85f77fb0356c3bb598f">setkeytype_action_keys</a>(&amp;ac, mode);
<a name="l01240"></a>01240     
<a name="l01241"></a>01241     <span class="comment">/* validate keyframes after editing */</span>
<a name="l01242"></a>01242     <a class="code" href="../../db/d71/keyframes__edit_8c.html#a3674716b592ffe7198ea9ee213e77d73">ANIM_editkeyframes_refresh</a>(&amp;ac);
<a name="l01243"></a>01243     
<a name="l01244"></a>01244     <span class="comment">/* set notifier that keyframe properties have changed */</span>
<a name="l01245"></a>01245     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a7f09fa8269c80b98dae22ad97b49b532">ND_KEYFRAME_PROP</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01246"></a>01246     
<a name="l01247"></a>01247     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01248"></a>01248 }
<a name="l01249"></a>01249  
<a name="l01250"></a><a class="code" href="../../df/d02/action__intern_8h.html#a2c382cc12a5122be3f3b5bc24927dc89">01250</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a0ffa3235d5d418b558222928446d2711">ACTION_OT_keyframe_type</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01251"></a>01251 {
<a name="l01252"></a>01252     <span class="comment">/* identifiers */</span>
<a name="l01253"></a>01253     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Set Keyframe Type&quot;</span>;
<a name="l01254"></a>01254     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_keyframe_type&quot;</span>;
<a name="l01255"></a>01255     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Set type of keyframe for the selected keyframes&quot;</span>;
<a name="l01256"></a>01256     
<a name="l01257"></a>01257     <span class="comment">/* api callbacks */</span>
<a name="l01258"></a>01258     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a926375c583166540cfa96299e433e071">WM_menu_invoke</a>;
<a name="l01259"></a>01259     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#afa7c3215df6368b55a28ccf16a674fb4">actkeys_keytype_exec</a>;
<a name="l01260"></a>01260     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l01261"></a>01261     
<a name="l01262"></a>01262     <span class="comment">/* flags */</span>
<a name="l01263"></a>01263     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01264"></a>01264     
<a name="l01265"></a>01265     <span class="comment">/* id-props */</span>
<a name="l01266"></a>01266     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;type&quot;</span>, <a class="code" href="../../d3/de6/rna__fcurve_8c.html#a1b0e4f06a95287436037df71b614295c">beztriple_keyframe_type_items</a>, 0, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01267"></a>01267 }
<a name="l01268"></a>01268 
<a name="l01269"></a>01269 <span class="comment">/* ************************************************************************** */</span>
<a name="l01270"></a>01270 <span class="comment">/* TRANSFORM STUFF */</span>
<a name="l01271"></a>01271 
<a name="l01272"></a>01272 <span class="comment">/* ***************** Jump to Selected Frames Operator *********************** */</span>
<a name="l01273"></a>01273 
<a name="l01274"></a>01274 <span class="comment">/* snap current-frame indicator to &#39;average time&#39; of selected keyframe */</span>
<a name="l01275"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#af50bcc7ac9e6f013d6977fa90b9ef099">01275</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#af50bcc7ac9e6f013d6977fa90b9ef099">actkeys_framejump_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l01276"></a>01276 {
<a name="l01277"></a>01277     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01278"></a>01278     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01279"></a>01279     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l01280"></a>01280     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l01281"></a>01281     <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked= {{<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}};
<a name="l01282"></a>01282     
<a name="l01283"></a>01283     <span class="comment">/* get editor data */</span>
<a name="l01284"></a>01284     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01285"></a>01285         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01286"></a>01286     
<a name="l01287"></a>01287     <span class="comment">/* init edit data */</span>    
<a name="l01288"></a>01288     <span class="comment">/* loop over action data, averaging values */</span>
<a name="l01289"></a>01289     filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> <span class="comment">/*| ANIMFILTER_CURVESONLY */</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l01290"></a>01290     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(&amp;ac, &amp;anim_data, filter, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l01291"></a>01291     
<a name="l01292"></a>01292     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l01293"></a>01293         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= <a class="code" href="../../d5/d34/anim__draw_8c.html#a37ad7a1d679ae57a5492066d63bb9c72">ANIM_nla_mapping_get</a>(&amp;ac, ale);
<a name="l01294"></a>01294         <span class="keywordflow">if</span> (adt) {
<a name="l01295"></a>01295             <a class="code" href="../../d5/d34/anim__draw_8c.html#af3391f209e37113f866e6bc3d15bcf97">ANIM_nla_mapping_apply_fcurve</a>(adt, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, 0, 1); 
<a name="l01296"></a>01296             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/d71/keyframes__edit_8c.html#aefa62c7dca2d9fdf8642ecaed0b61249">bezt_calc_average</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01297"></a>01297             <a class="code" href="../../d5/d34/anim__draw_8c.html#af3391f209e37113f866e6bc3d15bcf97">ANIM_nla_mapping_apply_fcurve</a>(adt, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, 1, 1);
<a name="l01298"></a>01298         }
<a name="l01299"></a>01299         <span class="keywordflow">else</span>
<a name="l01300"></a>01300             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/d71/keyframes__edit_8c.html#aefa62c7dca2d9fdf8642ecaed0b61249">bezt_calc_average</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01301"></a>01301     }
<a name="l01302"></a>01302     
<a name="l01303"></a>01303     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01304"></a>01304     
<a name="l01305"></a>01305     <span class="comment">/* set the new current frame value, based on the average time */</span>
<a name="l01306"></a>01306     <span class="keywordflow">if</span> (ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#ae7333f659ba9d2b9924524225d64a27a">i1</a>) {
<a name="l01307"></a>01307         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l01308"></a>01308         <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a3619c6f2d3bfb9dbb64eeb250fd5fdcb">CFRA</a>= (int)floor((ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1444ccfbecc1ce0317e003838ccc261d">f1</a> / ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#ae7333f659ba9d2b9924524225d64a27a">i1</a>) + 0.5f);
<a name="l01309"></a>01309         <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a082349bb8880b731aee02266c5814a97">SUBFRA</a>= 0.f;
<a name="l01310"></a>01310     }
<a name="l01311"></a>01311     
<a name="l01312"></a>01312     <span class="comment">/* set notifier that things have changed */</span>
<a name="l01313"></a>01313     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a61261a6b5ea948eee6d42c7e7ee18166">NC_SCENE</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a93a7b7f4bba572e9176db2aa580d7aa9">ND_FRAME</a>, ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>);
<a name="l01314"></a>01314     
<a name="l01315"></a>01315     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01316"></a>01316 }
<a name="l01317"></a>01317 
<a name="l01318"></a><a class="code" href="../../df/d02/action__intern_8h.html#ace499506f329602a225e21d0ad532323">01318</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a959c3ff509658d5268d245e684d43b3a">ACTION_OT_frame_jump</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01319"></a>01319 {
<a name="l01320"></a>01320     <span class="comment">/* identifiers */</span>
<a name="l01321"></a>01321     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Jump to Frame&quot;</span>;
<a name="l01322"></a>01322     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_frame_jump&quot;</span>;
<a name="l01323"></a>01323     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Set the current frame to the average frame of the selected keyframes&quot;</span>;
<a name="l01324"></a>01324     
<a name="l01325"></a>01325     <span class="comment">/* api callbacks */</span>
<a name="l01326"></a>01326     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#af50bcc7ac9e6f013d6977fa90b9ef099">actkeys_framejump_exec</a>;
<a name="l01327"></a>01327     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l01328"></a>01328     
<a name="l01329"></a>01329     <span class="comment">/* flags */</span>
<a name="l01330"></a>01330     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01331"></a>01331 }
<a name="l01332"></a>01332 
<a name="l01333"></a>01333 <span class="comment">/* ******************** Snap Keyframes Operator *********************** */</span>
<a name="l01334"></a>01334 
<a name="l01335"></a>01335 <span class="comment">/* defines for snap keyframes tool */</span>
<a name="l01336"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#ac4edd78a16aaedbd88e8aad2bee0c180">01336</a> <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> <a class="code" href="../../d2/dd6/action__edit_8c.html#ac4edd78a16aaedbd88e8aad2bee0c180">prop_actkeys_snap_types</a>[] = {
<a name="l01337"></a>01337     {<a class="code" href="../../df/d02/action__intern_8h.html#a7646ae03981912f97626c39dfe9318daabf6bc20c2e0ca0bff33226787d3adf72">ACTKEYS_SNAP_CFRA</a>, <span class="stringliteral">&quot;CFRA&quot;</span>, 0, <span class="stringliteral">&quot;Current frame&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l01338"></a>01338     {<a class="code" href="../../df/d02/action__intern_8h.html#a7646ae03981912f97626c39dfe9318daa977cf533c9ba184c706229ed71a28e5a">ACTKEYS_SNAP_NEAREST_FRAME</a>, <span class="stringliteral">&quot;NEAREST_FRAME&quot;</span>, 0, <span class="stringliteral">&quot;Nearest Frame&quot;</span>, <span class="stringliteral">&quot;&quot;</span>}, <span class="comment">// XXX as single entry?</span>
<a name="l01339"></a>01339     {<a class="code" href="../../df/d02/action__intern_8h.html#a7646ae03981912f97626c39dfe9318daaa2326d909e6ade343868bd7e51b30a4c">ACTKEYS_SNAP_NEAREST_SECOND</a>, <span class="stringliteral">&quot;NEAREST_SECOND&quot;</span>, 0, <span class="stringliteral">&quot;Nearest Second&quot;</span>, <span class="stringliteral">&quot;&quot;</span>}, <span class="comment">// XXX as single entry?</span>
<a name="l01340"></a>01340     {<a class="code" href="../../df/d02/action__intern_8h.html#a7646ae03981912f97626c39dfe9318daadcf8040aa58d540f8d3e8837ecdc0b19">ACTKEYS_SNAP_NEAREST_MARKER</a>, <span class="stringliteral">&quot;NEAREST_MARKER&quot;</span>, 0, <span class="stringliteral">&quot;Nearest Marker&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l01341"></a>01341     {0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL}
<a name="l01342"></a>01342 };
<a name="l01343"></a>01343 
<a name="l01344"></a>01344 <span class="comment">/* this function is responsible for snapping keyframes to frame-times */</span>
<a name="l01345"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a27fe8ef6b1c52be63a8920baebee9ee5">01345</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a27fe8ef6b1c52be63a8920baebee9ee5">snap_action_keys</a>(<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keywordtype">short</span> mode) 
<a name="l01346"></a>01346 {
<a name="l01347"></a>01347     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01348"></a>01348     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l01349"></a>01349     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l01350"></a>01350     
<a name="l01351"></a>01351     <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked= {{<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}};
<a name="l01352"></a>01352     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> edit_cb;
<a name="l01353"></a>01353     
<a name="l01354"></a>01354     <span class="comment">/* filter data */</span>
<a name="l01355"></a>01355     <span class="keywordflow">if</span> (ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>)
<a name="l01356"></a>01356         filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a>);
<a name="l01357"></a>01357     <span class="keywordflow">else</span>
<a name="l01358"></a>01358         filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a> <span class="comment">/*| ANIMFILTER_CURVESONLY*/</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l01359"></a>01359     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l01360"></a>01360     
<a name="l01361"></a>01361     <span class="comment">/* get beztriple editing callbacks */</span>
<a name="l01362"></a>01362     edit_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#ada6692e8aa0dc0363b9d7ec88638bbf1">ANIM_editkeyframes_snap</a>(mode);
<a name="l01363"></a>01363 
<a name="l01364"></a>01364     ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#ae92b25f59272e31e000b38273ef9d30b">scene</a>= ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l01365"></a>01365     <span class="keywordflow">if</span> (mode == <a class="code" href="../../df/d02/action__intern_8h.html#a7646ae03981912f97626c39dfe9318daadcf8040aa58d540f8d3e8837ecdc0b19">ACTKEYS_SNAP_NEAREST_MARKER</a>) {
<a name="l01366"></a>01366         ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a2348e0effff022a6ba66371076556163">list</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= (ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a1b0dda891e001c9cff1ffeb3c4032673">markers</a>) ? ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a1b0dda891e001c9cff1ffeb3c4032673">markers</a>-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01367"></a>01367         ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a2348e0effff022a6ba66371076556163">list</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= (ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a1b0dda891e001c9cff1ffeb3c4032673">markers</a>) ? ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a1b0dda891e001c9cff1ffeb3c4032673">markers</a>-&gt;<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> : <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01368"></a>01368     }
<a name="l01369"></a>01369     
<a name="l01370"></a>01370     <span class="comment">/* snap keyframes */</span>
<a name="l01371"></a>01371     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l01372"></a>01372         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= <a class="code" href="../../d5/d34/anim__draw_8c.html#a37ad7a1d679ae57a5492066d63bb9c72">ANIM_nla_mapping_get</a>(ac, ale);
<a name="l01373"></a>01373         
<a name="l01374"></a>01374         <span class="keywordflow">if</span> (adt) {
<a name="l01375"></a>01375             <a class="code" href="../../d5/d34/anim__draw_8c.html#af3391f209e37113f866e6bc3d15bcf97">ANIM_nla_mapping_apply_fcurve</a>(adt, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, 0, 1); 
<a name="l01376"></a>01376             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, edit_cb, <a class="code" href="../../da/dba/BKE__fcurve_8h.html#abb464452313d3795a48da7421069f9e3">calchandles_fcurve</a>);
<a name="l01377"></a>01377             <a class="code" href="../../d5/d34/anim__draw_8c.html#af3391f209e37113f866e6bc3d15bcf97">ANIM_nla_mapping_apply_fcurve</a>(adt, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, 1, 1);
<a name="l01378"></a>01378         }
<a name="l01379"></a>01379         <span class="comment">//else if (ale-&gt;type == ACTTYPE_GPLAYER)</span>
<a name="l01380"></a>01380         <span class="comment">//  snap_gplayer_frames(ale-&gt;data, mode);</span>
<a name="l01381"></a>01381         <span class="keywordflow">else</span> 
<a name="l01382"></a>01382             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, edit_cb, <a class="code" href="../../da/dba/BKE__fcurve_8h.html#abb464452313d3795a48da7421069f9e3">calchandles_fcurve</a>);
<a name="l01383"></a>01383     }
<a name="l01384"></a>01384     
<a name="l01385"></a>01385     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01386"></a>01386 }
<a name="l01387"></a>01387 
<a name="l01388"></a>01388 <span class="comment">/* ------------------- */</span>
<a name="l01389"></a>01389 
<a name="l01390"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a4f2794e07cb00c132740a556927b76d8">01390</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a4f2794e07cb00c132740a556927b76d8">actkeys_snap_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01391"></a>01391 {
<a name="l01392"></a>01392     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01393"></a>01393     <span class="keywordtype">short</span> mode;
<a name="l01394"></a>01394     
<a name="l01395"></a>01395     <span class="comment">/* get editor data */</span>
<a name="l01396"></a>01396     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01397"></a>01397         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01398"></a>01398         
<a name="l01399"></a>01399     <span class="comment">// XXX...</span>
<a name="l01400"></a>01400     <span class="keywordflow">if</span> (ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>)
<a name="l01401"></a>01401         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l01402"></a>01402         
<a name="l01403"></a>01403     <span class="comment">/* get snapping mode */</span>
<a name="l01404"></a>01404     mode= <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;type&quot;</span>);
<a name="l01405"></a>01405     
<a name="l01406"></a>01406     <span class="comment">/* snap keyframes */</span>
<a name="l01407"></a>01407     <a class="code" href="../../d2/dd6/action__edit_8c.html#a27fe8ef6b1c52be63a8920baebee9ee5">snap_action_keys</a>(&amp;ac, mode);
<a name="l01408"></a>01408     
<a name="l01409"></a>01409     <span class="comment">/* validate keyframes after editing */</span>
<a name="l01410"></a>01410     <a class="code" href="../../db/d71/keyframes__edit_8c.html#a3674716b592ffe7198ea9ee213e77d73">ANIM_editkeyframes_refresh</a>(&amp;ac);
<a name="l01411"></a>01411     
<a name="l01412"></a>01412     <span class="comment">/* set notifier that keyframes have changed */</span>
<a name="l01413"></a>01413     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01414"></a>01414     
<a name="l01415"></a>01415     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01416"></a>01416 }
<a name="l01417"></a>01417  
<a name="l01418"></a><a class="code" href="../../df/d02/action__intern_8h.html#af2f362e31f13ee87728bb152afd10bca">01418</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#a7feb602f9cac613b217bef139b3dcb1c">ACTION_OT_snap</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01419"></a>01419 {
<a name="l01420"></a>01420     <span class="comment">/* identifiers */</span>
<a name="l01421"></a>01421     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Snap Keys&quot;</span>;
<a name="l01422"></a>01422     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_snap&quot;</span>;
<a name="l01423"></a>01423     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Snap selected keyframes to the times specified&quot;</span>;
<a name="l01424"></a>01424     
<a name="l01425"></a>01425     <span class="comment">/* api callbacks */</span>
<a name="l01426"></a>01426     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a926375c583166540cfa96299e433e071">WM_menu_invoke</a>;
<a name="l01427"></a>01427     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#a4f2794e07cb00c132740a556927b76d8">actkeys_snap_exec</a>;
<a name="l01428"></a>01428     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l01429"></a>01429     
<a name="l01430"></a>01430     <span class="comment">/* flags */</span>
<a name="l01431"></a>01431     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01432"></a>01432     
<a name="l01433"></a>01433     <span class="comment">/* id-props */</span>
<a name="l01434"></a>01434     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;type&quot;</span>, prop_actkeys_snap_types, 0, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01435"></a>01435 }
<a name="l01436"></a>01436 
<a name="l01437"></a>01437 <span class="comment">/* ******************** Mirror Keyframes Operator *********************** */</span>
<a name="l01438"></a>01438 
<a name="l01439"></a>01439 <span class="comment">/* defines for mirror keyframes tool */</span>
<a name="l01440"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#a8916f9f58394f9a46a4ba63234640cf0">01440</a> <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> <a class="code" href="../../d2/dd6/action__edit_8c.html#a8916f9f58394f9a46a4ba63234640cf0">prop_actkeys_mirror_types</a>[] = {
<a name="l01441"></a>01441     {<a class="code" href="../../df/d02/action__intern_8h.html#a29d44341ce767c5dfc737d622fc97ba1a65912918e7a0b0a68576d72319d488de">ACTKEYS_MIRROR_CFRA</a>, <span class="stringliteral">&quot;CFRA&quot;</span>, 0, <span class="stringliteral">&quot;By Times over Current frame&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l01442"></a>01442     {<a class="code" href="../../df/d02/action__intern_8h.html#a29d44341ce767c5dfc737d622fc97ba1ae55b8a2974bd590de29634700180b100">ACTKEYS_MIRROR_XAXIS</a>, <span class="stringliteral">&quot;XAXIS&quot;</span>, 0, <span class="stringliteral">&quot;By Values over Value=0&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l01443"></a>01443     {<a class="code" href="../../df/d02/action__intern_8h.html#a29d44341ce767c5dfc737d622fc97ba1abb4c9d11b76896c3a6b8a7015e11468b">ACTKEYS_MIRROR_MARKER</a>, <span class="stringliteral">&quot;MARKER&quot;</span>, 0, <span class="stringliteral">&quot;By Times over First Selected Marker&quot;</span>, <span class="stringliteral">&quot;&quot;</span>},
<a name="l01444"></a>01444     {0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL}
<a name="l01445"></a>01445 };
<a name="l01446"></a>01446 
<a name="l01447"></a>01447 <span class="comment">/* this function is responsible for mirroring keyframes */</span>
<a name="l01448"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#ab272bbe75ae9027432a03d5e79b565f9">01448</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#ab272bbe75ae9027432a03d5e79b565f9">mirror_action_keys</a>(<a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> *ac, <span class="keywordtype">short</span> mode) 
<a name="l01449"></a>01449 {
<a name="l01450"></a>01450     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> anim_data = {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l01451"></a>01451     <a class="code" href="../../d6/dfc/structbAnimListElem.html">bAnimListElem</a> *ale;
<a name="l01452"></a>01452     <span class="keywordtype">int</span> <a class="code" href="../../dc/d53/implicit_8c.html#a5085563b3b926cbcce0bef0946da311e">filter</a>;
<a name="l01453"></a>01453     
<a name="l01454"></a>01454     <a class="code" href="../../d5/d01/structKeyframeEditData.html">KeyframeEditData</a> ked= {{<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}};
<a name="l01455"></a>01455     <a class="code" href="../../d7/d10/ED__keyframes__edit_8h.html#a1de51656b7a1d10c00977eefd746cb44">KeyframeEditFunc</a> edit_cb;
<a name="l01456"></a>01456     
<a name="l01457"></a>01457     <span class="comment">/* get beztriple editing callbacks */</span>
<a name="l01458"></a>01458     edit_cb= <a class="code" href="../../db/d71/keyframes__edit_8c.html#a4ba8a011811cb5c89c6ce928c7e43181">ANIM_editkeyframes_mirror</a>(mode);
<a name="l01459"></a>01459 
<a name="l01460"></a>01460     ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#ae92b25f59272e31e000b38273ef9d30b">scene</a>= ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a4cf3452bc416802e623d25c9cf90cc23">scene</a>;
<a name="l01461"></a>01461     
<a name="l01462"></a>01462     <span class="comment">/* for &#39;first selected marker&#39; mode, need to find first selected marker first! */</span>
<a name="l01463"></a>01463     <span class="comment">// XXX should this be made into a helper func in the API?</span>
<a name="l01464"></a>01464     <span class="keywordflow">if</span> (mode == <a class="code" href="../../df/d02/action__intern_8h.html#a29d44341ce767c5dfc737d622fc97ba1abb4c9d11b76896c3a6b8a7015e11468b">ACTKEYS_MIRROR_MARKER</a>) {
<a name="l01465"></a>01465         <a class="code" href="../../d2/d3e/structTimeMarker.html">TimeMarker</a> *marker= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01466"></a>01466         
<a name="l01467"></a>01467         <span class="comment">/* find first selected marker */</span>
<a name="l01468"></a>01468         marker= <a class="code" href="../../df/d12/anim__markers_8c.html#a6b4df214ebae590f34dbf8a358f8f438">ED_markers_get_first_selected</a>(ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a1b0dda891e001c9cff1ffeb3c4032673">markers</a>);
<a name="l01469"></a>01469         
<a name="l01470"></a>01470         <span class="comment">/* store marker&#39;s time (if available) */</span>
<a name="l01471"></a>01471         <span class="keywordflow">if</span> (marker)
<a name="l01472"></a>01472             ked.<a class="code" href="../../d5/d01/structKeyframeEditData.html#a1444ccfbecc1ce0317e003838ccc261d">f1</a>= (float)marker-&gt;<a class="code" href="../../d2/d3e/structTimeMarker.html#a63f34b0e44a21b9e0a7d43d8cbc44700">frame</a>;
<a name="l01473"></a>01473         <span class="keywordflow">else</span>
<a name="l01474"></a>01474             <span class="keywordflow">return</span>;
<a name="l01475"></a>01475     }
<a name="l01476"></a>01476     
<a name="l01477"></a>01477     <span class="comment">/* filter data */</span>
<a name="l01478"></a>01478     <span class="keywordflow">if</span> (ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>)
<a name="l01479"></a>01479         filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l01480"></a>01480     <span class="keywordflow">else</span>
<a name="l01481"></a>01481         filter= (<a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a584f2145e984f8afb13e6cdeb4c0ac31">ANIMFILTER_DATA_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a99e976a44a2de2b075e12d85a4cf1410">ANIMFILTER_LIST_VISIBLE</a> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045a34fc8aa5ee8899f5befc9be26991b785">ANIMFILTER_FOREDIT</a> <span class="comment">/*| ANIMFILTER_CURVESONLY*/</span> | <a class="code" href="../../df/d6f/ED__anim__api_8h.html#aeb469b1e009f7669ddacedd695291045ab52dad3e5d602f0b3320a13ea1c37614">ANIMFILTER_NODUPLIS</a>);
<a name="l01482"></a>01482     <a class="code" href="../../dc/d01/anim__filter_8c.html#a13681020f63c886ca5bfc9a2ff39620b">ANIM_animdata_filter</a>(ac, &amp;anim_data, filter, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a6746afe77831350347f788f226a9320a">data</a>, ac-&gt;<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a>);
<a name="l01483"></a>01483     
<a name="l01484"></a>01484     <span class="comment">/* mirror keyframes */</span>
<a name="l01485"></a>01485     <span class="keywordflow">for</span> (ale= anim_data.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ale; ale= ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a5ccf2b36d14379524140d1c18942a2ef">next</a>) {
<a name="l01486"></a>01486         <a class="code" href="../../d1/d5c/structAnimData.html">AnimData</a> *adt= <a class="code" href="../../d5/d34/anim__draw_8c.html#a37ad7a1d679ae57a5492066d63bb9c72">ANIM_nla_mapping_get</a>(ac, ale);
<a name="l01487"></a>01487         
<a name="l01488"></a>01488         <span class="keywordflow">if</span> (adt) {
<a name="l01489"></a>01489             <a class="code" href="../../d5/d34/anim__draw_8c.html#af3391f209e37113f866e6bc3d15bcf97">ANIM_nla_mapping_apply_fcurve</a>(adt, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, 0, 1); 
<a name="l01490"></a>01490             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, edit_cb, <a class="code" href="../../da/dba/BKE__fcurve_8h.html#abb464452313d3795a48da7421069f9e3">calchandles_fcurve</a>);
<a name="l01491"></a>01491             <a class="code" href="../../d5/d34/anim__draw_8c.html#af3391f209e37113f866e6bc3d15bcf97">ANIM_nla_mapping_apply_fcurve</a>(adt, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, 1, 1);
<a name="l01492"></a>01492         }
<a name="l01493"></a>01493         <span class="comment">//else if (ale-&gt;type == ACTTYPE_GPLAYER)</span>
<a name="l01494"></a>01494         <span class="comment">//  snap_gplayer_frames(ale-&gt;data, mode);</span>
<a name="l01495"></a>01495         <span class="keywordflow">else</span> 
<a name="l01496"></a>01496             <a class="code" href="../../db/d71/keyframes__edit_8c.html#acc5f398b98ef3107626e8c507091d544">ANIM_fcurve_keyframes_loop</a>(&amp;ked, ale-&gt;<a class="code" href="../../d6/dfc/structbAnimListElem.html#a829149ba40390f68b20ac1d2649b0078">key_data</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, edit_cb, <a class="code" href="../../da/dba/BKE__fcurve_8h.html#abb464452313d3795a48da7421069f9e3">calchandles_fcurve</a>);
<a name="l01497"></a>01497     }
<a name="l01498"></a>01498     
<a name="l01499"></a>01499     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;anim_data);
<a name="l01500"></a>01500 }
<a name="l01501"></a>01501 
<a name="l01502"></a>01502 <span class="comment">/* ------------------- */</span>
<a name="l01503"></a>01503 
<a name="l01504"></a><a class="code" href="../../d2/dd6/action__edit_8c.html#ac5d610f75a88b9a082565adf00df8555">01504</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#ac5d610f75a88b9a082565adf00df8555">actkeys_mirror_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01505"></a>01505 {
<a name="l01506"></a>01506     <a class="code" href="../../d6/dca/structbAnimContext.html">bAnimContext</a> ac;
<a name="l01507"></a>01507     <span class="keywordtype">short</span> mode;
<a name="l01508"></a>01508     
<a name="l01509"></a>01509     <span class="comment">/* get editor data */</span>
<a name="l01510"></a>01510     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d01/anim__filter_8c.html#af1a4fda8e00ccbf101c60f9b991ef1cd">ANIM_animdata_get_context</a>(C, &amp;ac) == 0)
<a name="l01511"></a>01511         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01512"></a>01512         
<a name="l01513"></a>01513     <span class="comment">// XXX...</span>
<a name="l01514"></a>01514     <span class="keywordflow">if</span> (ac.<a class="code" href="../../d6/dca/structbAnimContext.html#a5a52c7e6c531f78a79d7d8b92a887700">datatype</a> == <a class="code" href="../../df/d6f/ED__anim__api_8h.html#a7a050140c42c915acc0ce08d5028df86ac38aef9af2cfaa9607ee7cc42478b80a">ANIMCONT_GPENCIL</a>)
<a name="l01515"></a>01515         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l01516"></a>01516         
<a name="l01517"></a>01517     <span class="comment">/* get mirroring mode */</span>
<a name="l01518"></a>01518     mode= <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;type&quot;</span>);
<a name="l01519"></a>01519     
<a name="l01520"></a>01520     <span class="comment">/* mirror keyframes */</span>
<a name="l01521"></a>01521     <a class="code" href="../../d2/dd6/action__edit_8c.html#ab272bbe75ae9027432a03d5e79b565f9">mirror_action_keys</a>(&amp;ac, mode);
<a name="l01522"></a>01522     
<a name="l01523"></a>01523     <span class="comment">/* validate keyframes after editing */</span>
<a name="l01524"></a>01524     <a class="code" href="../../db/d71/keyframes__edit_8c.html#a3674716b592ffe7198ea9ee213e77d73">ANIM_editkeyframes_refresh</a>(&amp;ac);
<a name="l01525"></a>01525     
<a name="l01526"></a>01526     <span class="comment">/* set notifier that keyframes have changed */</span>
<a name="l01527"></a>01527     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a367b640edd611357ec6de8d1923d027e">NC_ANIMATION</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ad3ac9c1f16a6876edef02a4bc8287a61">ND_KEYFRAME</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01528"></a>01528     
<a name="l01529"></a>01529     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01530"></a>01530 }
<a name="l01531"></a>01531  
<a name="l01532"></a><a class="code" href="../../df/d02/action__intern_8h.html#a46e94599774d9efb6141da50099f2925">01532</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dd6/action__edit_8c.html#ae25fd071431aee88a1691284924a5ea4">ACTION_OT_mirror</a> (<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01533"></a>01533 {
<a name="l01534"></a>01534     <span class="comment">/* identifiers */</span>
<a name="l01535"></a>01535     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Mirror Keys&quot;</span>;
<a name="l01536"></a>01536     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;ACTION_OT_mirror&quot;</span>;
<a name="l01537"></a>01537     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Flip selected keyframes over the selected mirror line&quot;</span>;
<a name="l01538"></a>01538     
<a name="l01539"></a>01539     <span class="comment">/* api callbacks */</span>
<a name="l01540"></a>01540     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a926375c583166540cfa96299e433e071">WM_menu_invoke</a>;
<a name="l01541"></a>01541     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d2/dd6/action__edit_8c.html#ac5d610f75a88b9a082565adf00df8555">actkeys_mirror_exec</a>;
<a name="l01542"></a>01542     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#af407f5bc39655cc6560c07edb70795c9">ED_operator_action_active</a>;
<a name="l01543"></a>01543     
<a name="l01544"></a>01544     <span class="comment">/* flags */</span>
<a name="l01545"></a>01545     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01546"></a>01546     
<a name="l01547"></a>01547     <span class="comment">/* id-props */</span>
<a name="l01548"></a>01548     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ad2ecde05b67ff7682699554ee5a0bfc9">prop</a> = <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;type&quot;</span>, prop_actkeys_mirror_types, 0, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01549"></a>01549 }
<a name="l01550"></a>01550 
<a name="l01551"></a>01551 <span class="comment">/* ************************************************************************** */</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:53:55 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

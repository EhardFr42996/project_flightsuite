<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: buttons_texture.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">buttons_texture.c</div>  </div>
</div>
<div class="contents">
<a href="../../d1/dd7/buttons__texture_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version. </span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2009 Blender Foundation.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * Contributor(s): Blender Foundation</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00024"></a>00024 <span class="comment"> */</span>
<a name="l00025"></a>00025 
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d3e/BLI__listbase_8h.html">BLI_listbase.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/db3/BLI__string_8h.html">BLI_string.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d37/DNA__brush__types_8h.html">DNA_brush_types.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dfb/DNA__ID_8h.html" title="ID and Library types, which are fundamental for sdna.">DNA_ID.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html">DNA_lamp_types.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../de/db2/DNA__material__types_8h.html">DNA_material_types.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d27/DNA__node__types_8h.html">DNA_node_types.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d60/DNA__object__force_8h.html">DNA_object_force.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d5a/DNA__particle__types_8h.html">DNA_particle_types.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/da4/DNA__screen__types_8h.html">DNA_screen_types.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d5d/DNA__space__types_8h.html">DNA_space_types.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d3b/DNA__world__types_8h.html">DNA_world_types.h</a>&quot;</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d0f/BKE__material_8h.html" title="General operations, lookup, etc. for materials.">BKE_material.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d0f/BKE__modifier_8h.html">BKE_modifier.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d91/BKE__node_8h.html">BKE_node.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d86/BKE__paint_8h.html">BKE_paint.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dca/BKE__particle_8h.html">BKE_particle.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d53/BKE__scene_8h.html">BKE_scene.h</a>&quot;</span>
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d1e/UI__interface_8h.html">UI_interface.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d96/UI__resources_8h.html">UI_resources.h</a>&quot;</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dcc/ED__node_8h.html">ED_node.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d12/ED__screen_8h.html">ED_screen.h</a>&quot;</span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;../interface/interface_intern.h&quot;</span>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/dbb/buttons__intern_8h.html">buttons_intern.h</a>&quot;</span> <span class="comment">// own include</span>
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="comment">/************************* Texture User **************************/</span>
<a name="l00074"></a>00074 
<a name="l00075"></a><a class="code" href="../../d1/dd7/buttons__texture_8c.html#a78c3870c755522d079dd10597cc0c0a7">00075</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dd7/buttons__texture_8c.html#a78c3870c755522d079dd10597cc0c0a7">buttons_texture_user_property_add</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *users, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, 
<a name="l00076"></a>00076     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> ptr, <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *prop,
<a name="l00077"></a>00077     <span class="keyword">const</span> <span class="keywordtype">char</span> *category, <span class="keywordtype">int</span> icon, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l00078"></a>00078 {
<a name="l00079"></a>00079     <a class="code" href="../../d2/db2/structButsTextureUser.html">ButsTextureUser</a> *user = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d2/db2/structButsTextureUser.html">ButsTextureUser</a>), <span class="stringliteral">&quot;ButsTextureUser&quot;</span>);
<a name="l00080"></a>00080 
<a name="l00081"></a>00081     user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#a703cb4660f4a0247cb7f12a513565df6">id</a>= id;
<a name="l00082"></a>00082     user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#af9e9b5dbd2ea0a549c9db1a48fc2d5f9">ptr</a> = ptr;
<a name="l00083"></a>00083     user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#afd1ef7dff7c52d4e6eb103cf88aacdbb">prop</a> = prop;
<a name="l00084"></a>00084     user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#a25819f34a0e0919d995d2575a4b09f04">category</a> = category;
<a name="l00085"></a>00085     user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#a3bd873a78f171116b4aa10c201da6a72">icon</a> = icon;
<a name="l00086"></a>00086     user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#aafda3f732651ae5afe903cb4f9b3c866">name</a> = name;
<a name="l00087"></a>00087     user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#ad0f27abe97d1d5330264cb4d904e5646">index</a> = <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aa3b37105a0793ac30946a6d220ee97d7">BLI_countlist</a>(users);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(users, user);
<a name="l00090"></a>00090 }
<a name="l00091"></a>00091 
<a name="l00092"></a><a class="code" href="../../d1/dd7/buttons__texture_8c.html#abbab934570a76ba0e68ea23ca3e00044">00092</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dd7/buttons__texture_8c.html#abbab934570a76ba0e68ea23ca3e00044">buttons_texture_user_node_add</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *users, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, 
<a name="l00093"></a>00093     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node,
<a name="l00094"></a>00094     <span class="keyword">const</span> <span class="keywordtype">char</span> *category, <span class="keywordtype">int</span> icon, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l00095"></a>00095 {
<a name="l00096"></a>00096     <a class="code" href="../../d2/db2/structButsTextureUser.html">ButsTextureUser</a> *user = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d2/db2/structButsTextureUser.html">ButsTextureUser</a>), <span class="stringliteral">&quot;ButsTextureUser&quot;</span>);
<a name="l00097"></a>00097 
<a name="l00098"></a>00098     user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#a703cb4660f4a0247cb7f12a513565df6">id</a>= id;
<a name="l00099"></a>00099     user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#a7ada531a2406f5617fbbec83b5124650">ntree</a> = ntree;
<a name="l00100"></a>00100     user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#ae13e644ac755fbb994488493bae9f341">node</a> = node;
<a name="l00101"></a>00101     user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#a25819f34a0e0919d995d2575a4b09f04">category</a> = category;
<a name="l00102"></a>00102     user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#a3bd873a78f171116b4aa10c201da6a72">icon</a> = icon;
<a name="l00103"></a>00103     user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#aafda3f732651ae5afe903cb4f9b3c866">name</a> = name;
<a name="l00104"></a>00104     user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#ad0f27abe97d1d5330264cb4d904e5646">index</a> = <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aa3b37105a0793ac30946a6d220ee97d7">BLI_countlist</a>(users);
<a name="l00105"></a>00105 
<a name="l00106"></a>00106     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(users, user);
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 
<a name="l00109"></a><a class="code" href="../../d1/dd7/buttons__texture_8c.html#af96f3dd50e5c37d7ac4bc8754a64039a">00109</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dd7/buttons__texture_8c.html#af96f3dd50e5c37d7ac4bc8754a64039a">buttons_texture_users_find_nodetree</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *users, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>,
<a name="l00110"></a>00110     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <span class="keyword">const</span> <span class="keywordtype">char</span> *category)
<a name="l00111"></a>00111 {
<a name="l00112"></a>00112     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     <span class="keywordflow">if</span> (ntree) {
<a name="l00115"></a>00115         <span class="keywordflow">for</span> (node=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00116"></a>00116             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a7c8943e4ceda60872297b827f72494f2">nclass</a> == <a class="code" href="../../d4/d91/BKE__node_8h.html#ae08783155f76296c2137f55ed691bb69">NODE_CLASS_TEXTURE</a>) {
<a name="l00117"></a>00117                 <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> ptr;
<a name="l00118"></a>00118                 <span class="comment">/* PropertyRNA *prop; */</span> <span class="comment">/* UNUSED */</span>
<a name="l00119"></a>00119 
<a name="l00120"></a>00120                 <a class="code" href="../../d3/d10/rna__access_8c.html#a1f8fb80da9a6450a51ab2e9b97264f01">RNA_pointer_create</a>(&amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#a0b393a65055e74d24d805993ba618d79">RNA_Node</a>, node, &amp;ptr);
<a name="l00121"></a>00121                 <span class="comment">/* prop = RNA_struct_find_property(&amp;ptr, &quot;texture&quot;); */</span> <span class="comment">/* UNUSED */</span>
<a name="l00122"></a>00122 
<a name="l00123"></a>00123                 <a class="code" href="../../d1/dd7/buttons__texture_8c.html#abbab934570a76ba0e68ea23ca3e00044">buttons_texture_user_node_add</a>(users, <span class="keywordtype">id</span>, ntree, node,
<a name="l00124"></a>00124                     category, <a class="code" href="../../d3/d10/rna__access_8c.html#a5a07a8315a1b6d5b30bbca822db7195c">RNA_struct_ui_icon</a>(ptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a41f868aea62068fbbfa36c1a5dbe30f9">type</a>), node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a5d65cbe1159d2c591a3ba7815817b0c4">name</a>);
<a name="l00125"></a>00125             }
<a name="l00126"></a>00126             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> == <a class="code" href="../../d4/d91/BKE__node_8h.html#ab9f16ff5fded11f644b983a041c97edd">NODE_GROUP</a> &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>) {
<a name="l00127"></a>00127                 <a class="code" href="../../d1/dd7/buttons__texture_8c.html#af96f3dd50e5c37d7ac4bc8754a64039a">buttons_texture_users_find_nodetree</a>(users, <span class="keywordtype">id</span>, (<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a>*)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>, category);
<a name="l00128"></a>00128             }
<a name="l00129"></a>00129         }
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131 }
<a name="l00132"></a>00132 
<a name="l00133"></a><a class="code" href="../../d1/dd7/buttons__texture_8c.html#aeb6f7b35f2079d3c70451c3ad169e853">00133</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dd7/buttons__texture_8c.html#aeb6f7b35f2079d3c70451c3ad169e853">buttons_texture_modifier_foreach</a>(<span class="keywordtype">void</span> *userData, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob, <a class="code" href="../../db/ddd/structModifierData.html">ModifierData</a> *md, <span class="keyword">const</span> <span class="keywordtype">char</span> *propname)
<a name="l00134"></a>00134 {
<a name="l00135"></a>00135     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> ptr;
<a name="l00136"></a>00136     <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *prop;
<a name="l00137"></a>00137     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *users = userData;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     <a class="code" href="../../d3/d10/rna__access_8c.html#a1f8fb80da9a6450a51ab2e9b97264f01">RNA_pointer_create</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#a3579aeeec101cbed2e2de13bd918a52e">RNA_Modifier</a>, md, &amp;ptr);
<a name="l00140"></a>00140     prop = <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(&amp;ptr, propname);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142     <a class="code" href="../../d1/dd7/buttons__texture_8c.html#a78c3870c755522d079dd10597cc0c0a7">buttons_texture_user_property_add</a>(users, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, ptr, prop,
<a name="l00143"></a>00143         <span class="stringliteral">&quot;Modifiers&quot;</span>, <a class="code" href="../../d3/d10/rna__access_8c.html#a5a07a8315a1b6d5b30bbca822db7195c">RNA_struct_ui_icon</a>(ptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a41f868aea62068fbbfa36c1a5dbe30f9">type</a>), md-&gt;<a class="code" href="../../db/ddd/structModifierData.html#a11ae633f1d5e802a57abdd651ca99956">name</a>);
<a name="l00144"></a>00144 }
<a name="l00145"></a>00145 
<a name="l00146"></a><a class="code" href="../../d1/dd7/buttons__texture_8c.html#a59d63549f5fe4785f38fe2538c8b6b25">00146</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dd7/buttons__texture_8c.html#a59d63549f5fe4785f38fe2538c8b6b25">buttons_texture_users_from_context</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *users, <span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../da/dff/structSpaceButs.html">SpaceButs</a> *sbuts)
<a name="l00147"></a>00147 {
<a name="l00148"></a>00148     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00149"></a>00149     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00150"></a>00150     <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00151"></a>00151     <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00152"></a>00152     <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wrld= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00153"></a>00153     <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00154"></a>00154     <a class="code" href="../../d8/d7e/structID.html">ID</a> *pinid = sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a48c2cdcf5973a7b6f96c5109eca34b25">pinid</a>;
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     <span class="comment">/* get data from context */</span>
<a name="l00157"></a>00157     <span class="keywordflow">if</span> (pinid) {
<a name="l00158"></a>00158         <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(pinid-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>) == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac2b425dbd1f73ad1720fafad2626d974">ID_SCE</a>)
<a name="l00159"></a>00159             scene= (<a class="code" href="../../d9/d27/structScene.html">Scene</a>*)pinid;
<a name="l00160"></a>00160         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(pinid-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>) == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a1f263dac7c79853c097b8ebde25cb0c1">ID_OB</a>)
<a name="l00161"></a>00161             ob= (<a class="code" href="../../de/de7/structObject.html">Object</a>*)pinid;
<a name="l00162"></a>00162         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(pinid-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>) == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82e259dda95124fd771a23f105f52810">ID_LA</a>)
<a name="l00163"></a>00163             la= (<a class="code" href="../../d5/d72/structLamp.html">Lamp</a>*)pinid;
<a name="l00164"></a>00164         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(pinid-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>) == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa1ab8c153d4a007f72d37a2106ecbfa0">ID_WO</a>)
<a name="l00165"></a>00165             wrld= (<a class="code" href="../../d7/d3f/structWorld.html">World</a>*)pinid;
<a name="l00166"></a>00166         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(pinid-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>) == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#acf5020c901e2793a056ffca95ec8195a">ID_MA</a>)
<a name="l00167"></a>00167             ma= (<a class="code" href="../../d2/d10/structMaterial.html">Material</a>*)pinid;
<a name="l00168"></a>00168         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(pinid-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>) == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac7f2ccbf688d8c6763420cb2fe028e5a">ID_BR</a>)
<a name="l00169"></a>00169             brush= (<a class="code" href="../../d1/d9f/structBrush.html">Brush</a>*)pinid;
<a name="l00170"></a>00170     }
<a name="l00171"></a>00171 
<a name="l00172"></a>00172     <span class="keywordflow">if</span> (!scene)
<a name="l00173"></a>00173         scene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00174"></a>00174     
<a name="l00175"></a>00175     <span class="keywordflow">if</span> (!(pinid || pinid == &amp;scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>)) {
<a name="l00176"></a>00176         ob= (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a040bbb56eb7746d04c4ae455e5b1c638">basact</a>)? scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a040bbb56eb7746d04c4ae455e5b1c638">basact</a>-&gt;<a class="code" href="../../d3/da9/structBase.html#a74bed66e64803246e406c1ed2dd7f1ab">object</a>: <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00177"></a>00177         wrld= scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aefac18ed3d1ded63b012f79a3ca8ddb2">world</a>;
<a name="l00178"></a>00178         brush= <a class="code" href="../../d8/d86/BKE__paint_8h.html#abc920423e2205663f7131ab5d7eb9eaa">paint_brush</a>(<a class="code" href="../../d8/d86/BKE__paint_8h.html#a4b3c2e4641d652cc475f36b3de296334">paint_get_active</a>(scene));
<a name="l00179"></a>00179     }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181     <span class="keywordflow">if</span> (ob &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1514ec0465b89013544107c908e7abca">OB_LAMP</a> &amp;&amp; !la)
<a name="l00182"></a>00182         la= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00183"></a>00183     <span class="keywordflow">if</span> (ob &amp;&amp; !ma)
<a name="l00184"></a>00184         ma= <a class="code" href="../../d4/d0f/BKE__material_8h.html#a941f5112d1047bcbcf3e2212685296a5">give_current_material</a>(ob, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a7f7913949235b61d1cd0b8f343d0cbfc">actcol</a>);
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     <span class="comment">/* fill users */</span>
<a name="l00187"></a>00187     users-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a> = users-&gt;<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     <span class="keywordflow">if</span> (ma)
<a name="l00190"></a>00190         <a class="code" href="../../d1/dd7/buttons__texture_8c.html#af96f3dd50e5c37d7ac4bc8754a64039a">buttons_texture_users_find_nodetree</a>(users, &amp;ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>, ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>, <span class="stringliteral">&quot;Material&quot;</span>);
<a name="l00191"></a>00191     <span class="keywordflow">if</span> (la)
<a name="l00192"></a>00192         <a class="code" href="../../d1/dd7/buttons__texture_8c.html#af96f3dd50e5c37d7ac4bc8754a64039a">buttons_texture_users_find_nodetree</a>(users, &amp;la-&gt;<a class="code" href="../../d5/d72/structLamp.html#add71cdc042b5fe8dc4d423f9bfcd8335">id</a>, la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a957058346e5bf9659eec90ba4e31d76f">nodetree</a>, <span class="stringliteral">&quot;Lamp&quot;</span>);
<a name="l00193"></a>00193     <span class="keywordflow">if</span> (wrld)
<a name="l00194"></a>00194         <a class="code" href="../../d1/dd7/buttons__texture_8c.html#af96f3dd50e5c37d7ac4bc8754a64039a">buttons_texture_users_find_nodetree</a>(users, &amp;wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>, wrld-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a141c5c72fbf4bedfab53b9f0f091b1a9">nodetree</a>, <span class="stringliteral">&quot;World&quot;</span>);
<a name="l00195"></a>00195 
<a name="l00196"></a>00196     <span class="keywordflow">if</span> (ob) {
<a name="l00197"></a>00197         <a class="code" href="../../d4/d14/structParticleSystem.html">ParticleSystem</a> *psys= <a class="code" href="../../db/dca/BKE__particle_8h.html#a9eae54309f86c733c9cf7f7699a1fa83">psys_get_current</a>(ob);
<a name="l00198"></a>00198         <a class="code" href="../../dc/ddd/structMTex.html">MTex</a> *mtex;
<a name="l00199"></a>00199         <span class="keywordtype">int</span> a;
<a name="l00200"></a>00200 
<a name="l00201"></a>00201         <span class="comment">/* modifiers */</span>
<a name="l00202"></a>00202         <a class="code" href="../../d3/d0f/BKE__modifier_8h.html#a3d052c82e01da0bb32db7af3ecceebb9">modifiers_foreachTexLink</a>(ob, <a class="code" href="../../d1/dd7/buttons__texture_8c.html#aeb6f7b35f2079d3c70451c3ad169e853">buttons_texture_modifier_foreach</a>, users);
<a name="l00203"></a>00203 
<a name="l00204"></a>00204         <span class="comment">/* particle systems */</span>
<a name="l00205"></a>00205         <span class="keywordflow">if</span> (psys) {
<a name="l00206"></a>00206             <span class="comment">/* todo: these slots are not in the UI */</span>
<a name="l00207"></a>00207             <span class="keywordflow">for</span> (a=0; a&lt;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a5c921b6ba71dfcfa9a404e101d9bcaf4">MAX_MTEX</a>; a++) {
<a name="l00208"></a>00208                 mtex = psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a92d6a0f7010711f045efc7d9b4b8478b">mtex</a>[a];
<a name="l00209"></a>00209 
<a name="l00210"></a>00210                 <span class="keywordflow">if</span> (mtex) {
<a name="l00211"></a>00211                     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> ptr;
<a name="l00212"></a>00212                     <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *prop;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214                     <a class="code" href="../../d3/d10/rna__access_8c.html#a1f8fb80da9a6450a51ab2e9b97264f01">RNA_pointer_create</a>(&amp;psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#a9aa284f1387fdf3a7bc0eca45f766ff2">RNA_ParticleSettingsTextureSlot</a>, mtex, &amp;ptr);
<a name="l00215"></a>00215                     prop = <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(&amp;ptr, <span class="stringliteral">&quot;texture&quot;</span>);
<a name="l00216"></a>00216 
<a name="l00217"></a>00217                     <a class="code" href="../../d1/dd7/buttons__texture_8c.html#a78c3870c755522d079dd10597cc0c0a7">buttons_texture_user_property_add</a>(users, &amp;psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#a3b53997470f35e5d3a5e99ba52fb1c3a">part</a>-&gt;<a class="code" href="../../df/da6/structParticleSettings.html#a210d807df3902dfeb404ae25d402959d">id</a>, ptr, prop,
<a name="l00218"></a>00218                         <span class="stringliteral">&quot;Particles&quot;</span>, <a class="code" href="../../d3/d10/rna__access_8c.html#a5a07a8315a1b6d5b30bbca822db7195c">RNA_struct_ui_icon</a>(&amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#aee0b0ae132c21d793bec0251aa06c99a">RNA_ParticleSettings</a>), psys-&gt;<a class="code" href="../../d4/d14/structParticleSystem.html#ae13e5ba7109dfff3a69f8b1871e774d0">name</a>);
<a name="l00219"></a>00219                 }
<a name="l00220"></a>00220             }
<a name="l00221"></a>00221         }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223         <span class="comment">/* field */</span>
<a name="l00224"></a>00224         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a> &amp;&amp; ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>-&gt;<a class="code" href="../../d3/d76/structPartDeflect.html#af87e0d987bb26cc6ef8d580e6c97bc57">forcefield</a> == <a class="code" href="../../d2/d60/DNA__object__force_8h.html#ac0a610e8040ea8fe8e9b696ab71e2e1baca7d52fea971450bd4a0333c24005a8b">PFIELD_TEXTURE</a>) {
<a name="l00225"></a>00225             <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> ptr;
<a name="l00226"></a>00226             <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *prop;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228             <a class="code" href="../../d3/d10/rna__access_8c.html#a1f8fb80da9a6450a51ab2e9b97264f01">RNA_pointer_create</a>(&amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#a63013addc0c794e933b7b01768b1e67f">RNA_FieldSettings</a>, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a5af3210d70b057f538ce36c033548836">pd</a>, &amp;ptr);
<a name="l00229"></a>00229             prop = <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(&amp;ptr, <span class="stringliteral">&quot;texture&quot;</span>);
<a name="l00230"></a>00230 
<a name="l00231"></a>00231             <a class="code" href="../../d1/dd7/buttons__texture_8c.html#a78c3870c755522d079dd10597cc0c0a7">buttons_texture_user_property_add</a>(users, &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>, ptr, prop,
<a name="l00232"></a>00232                 <span class="stringliteral">&quot;Fields&quot;</span>, ICON_FORCE_TEXTURE, <span class="stringliteral">&quot;Texture Field&quot;</span>);
<a name="l00233"></a>00233         }
<a name="l00234"></a>00234     }
<a name="l00235"></a>00235 
<a name="l00236"></a>00236     <span class="comment">/* brush */</span>
<a name="l00237"></a>00237     <span class="keywordflow">if</span> (brush) {
<a name="l00238"></a>00238         <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> ptr;
<a name="l00239"></a>00239         <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *prop;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241         <a class="code" href="../../d3/d10/rna__access_8c.html#a1f8fb80da9a6450a51ab2e9b97264f01">RNA_pointer_create</a>(&amp;brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a853736fc6943d266e72d96080bccf6f0">id</a>, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#a8304265a5ac3d5063970370a05cf87dd">RNA_BrushTextureSlot</a>, &amp;brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>, &amp;ptr);
<a name="l00242"></a>00242         prop= <a class="code" href="../../d3/d10/rna__access_8c.html#a58253ea33cfb6f09202907a524090aab">RNA_struct_find_property</a>(&amp;ptr, <span class="stringliteral">&quot;texture&quot;</span>);
<a name="l00243"></a>00243 
<a name="l00244"></a>00244         <a class="code" href="../../d1/dd7/buttons__texture_8c.html#a78c3870c755522d079dd10597cc0c0a7">buttons_texture_user_property_add</a>(users, &amp;brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a853736fc6943d266e72d96080bccf6f0">id</a>, ptr, prop,
<a name="l00245"></a>00245             <span class="stringliteral">&quot;Brush&quot;</span>, ICON_BRUSH_DATA, brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a853736fc6943d266e72d96080bccf6f0">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2);
<a name="l00246"></a>00246     }
<a name="l00247"></a>00247 }
<a name="l00248"></a>00248 
<a name="l00249"></a><a class="code" href="../../d1/dd7/buttons__texture_8c.html#add49ed2e28bda40c00cbd9baad4de5f8">00249</a> <span class="keywordtype">void</span> <a class="code" href="../../d5/dbb/buttons__intern_8h.html#ab79efcfc72e2dd8036c67c803191fefb">buttons_texture_context_compute</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../da/dff/structSpaceButs.html">SpaceButs</a> *sbuts)
<a name="l00250"></a>00250 {
<a name="l00251"></a>00251     <span class="comment">/* gatheravailable texture users in context. runs on every draw of</span>
<a name="l00252"></a>00252 <span class="comment">     * properties editor, before the buttons are created. */</span>
<a name="l00253"></a>00253     <a class="code" href="../../df/de4/structButsContextTexture.html">ButsContextTexture</a> *ct= sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a72a195849400d9b64137ba5b98cc5420">texuser</a>;
<a name="l00254"></a>00254     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00255"></a>00255 
<a name="l00256"></a>00256     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d53/BKE__scene_8h.html#a041ff0e68dd0152e85ceddddc9b53cdc">scene_use_new_shading_nodes</a>(scene)) {
<a name="l00257"></a>00257         <span class="keywordflow">if</span> (ct) {
<a name="l00258"></a>00258             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a89907f0958ffe7467fa8b472e132ff62">users</a>);
<a name="l00259"></a>00259             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ct);
<a name="l00260"></a>00260             sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a72a195849400d9b64137ba5b98cc5420">texuser</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00261"></a>00261         }
<a name="l00262"></a>00262         
<a name="l00263"></a>00263         <span class="keywordflow">return</span>;
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     <span class="keywordflow">if</span> (!ct) {
<a name="l00267"></a>00267         ct= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../df/de4/structButsContextTexture.html">ButsContextTexture</a>), <span class="stringliteral">&quot;ButsContextTexture&quot;</span>);
<a name="l00268"></a>00268         sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a72a195849400d9b64137ba5b98cc5420">texuser</a>= ct;
<a name="l00269"></a>00269     }
<a name="l00270"></a>00270     <span class="keywordflow">else</span> {
<a name="l00271"></a>00271         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a89907f0958ffe7467fa8b472e132ff62">users</a>);
<a name="l00272"></a>00272     }
<a name="l00273"></a>00273 
<a name="l00274"></a>00274     <a class="code" href="../../d1/dd7/buttons__texture_8c.html#a59d63549f5fe4785f38fe2538c8b6b25">buttons_texture_users_from_context</a>(&amp;ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a89907f0958ffe7467fa8b472e132ff62">users</a>, C, sbuts);
<a name="l00275"></a>00275 
<a name="l00276"></a>00276     <span class="comment">/* set one user as active based on active index */</span>
<a name="l00277"></a>00277     <span class="keywordflow">if</span> (ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a8a2471db1214f660fe6048a0964c996b">index</a> &gt;= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aa3b37105a0793ac30946a6d220ee97d7">BLI_countlist</a>(&amp;ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a89907f0958ffe7467fa8b472e132ff62">users</a>))
<a name="l00278"></a>00278         ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a8a2471db1214f660fe6048a0964c996b">index</a>= 0;
<a name="l00279"></a>00279 
<a name="l00280"></a>00280     ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a5ff2ffe11c49e36b834308bb5a37659e">user</a> = <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a89907f0958ffe7467fa8b472e132ff62">users</a>, ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a8a2471db1214f660fe6048a0964c996b">index</a>);
<a name="l00281"></a>00281     ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#afad2113dae8853ac624231aad69333be">texture</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00282"></a>00282 
<a name="l00283"></a>00283     <span class="keywordflow">if</span> (ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a5ff2ffe11c49e36b834308bb5a37659e">user</a>) {
<a name="l00284"></a>00284         <span class="keywordflow">if</span> (ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a5ff2ffe11c49e36b834308bb5a37659e">user</a>-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#af9e9b5dbd2ea0a549c9db1a48fc2d5f9">ptr</a>.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>) {
<a name="l00285"></a>00285             <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> texptr;
<a name="l00286"></a>00286             <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex;
<a name="l00287"></a>00287 
<a name="l00288"></a>00288             <span class="comment">/* get texture datablock pointer if it&#39;s a property */</span>
<a name="l00289"></a>00289             texptr = <a class="code" href="../../d3/d10/rna__access_8c.html#a575c543a2a1f509f371bc1cee4fbe4d7">RNA_property_pointer_get</a>(&amp;ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a5ff2ffe11c49e36b834308bb5a37659e">user</a>-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#af9e9b5dbd2ea0a549c9db1a48fc2d5f9">ptr</a>, ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a5ff2ffe11c49e36b834308bb5a37659e">user</a>-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#afd1ef7dff7c52d4e6eb103cf88aacdbb">prop</a>);
<a name="l00290"></a>00290             tex = (<a class="code" href="../../d3/d10/rna__access_8c.html#ab0ac980958da7c9390bc055c30bf429b">RNA_struct_is_a</a>(texptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a41f868aea62068fbbfa36c1a5dbe30f9">type</a>, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#ae59cf2103f62b2f5de697c81a33c30af">RNA_Texture</a>))? texptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>: <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00291"></a>00291 
<a name="l00292"></a>00292             ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#afad2113dae8853ac624231aad69333be">texture</a> = tex;
<a name="l00293"></a>00293         }
<a name="l00294"></a>00294         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a5ff2ffe11c49e36b834308bb5a37659e">user</a>-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#ae13e644ac755fbb994488493bae9f341">node</a> &amp;&amp; !(ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a5ff2ffe11c49e36b834308bb5a37659e">user</a>-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#ae13e644ac755fbb994488493bae9f341">node</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6bfb8557e92ab04b26c5520fca97d6a9">NODE_ACTIVE_TEXTURE</a>)) {
<a name="l00295"></a>00295             <a class="code" href="../../d2/db2/structButsTextureUser.html">ButsTextureUser</a> *user;
<a name="l00296"></a>00296 
<a name="l00297"></a>00297             <span class="comment">/* detect change of active texture node in same node tree, in that</span>
<a name="l00298"></a>00298 <span class="comment">             * case we also automatically switch to the other node */</span>
<a name="l00299"></a>00299             <span class="keywordflow">for</span> (user=ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a89907f0958ffe7467fa8b472e132ff62">users</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; user; user=user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#af20acf1141e380e26d5c9ad524b21370">next</a>) {
<a name="l00300"></a>00300                 <span class="keywordflow">if</span> (user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#a7ada531a2406f5617fbbec83b5124650">ntree</a> == ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a5ff2ffe11c49e36b834308bb5a37659e">user</a>-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#a7ada531a2406f5617fbbec83b5124650">ntree</a> &amp;&amp; user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#ae13e644ac755fbb994488493bae9f341">node</a> != ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a5ff2ffe11c49e36b834308bb5a37659e">user</a>-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#ae13e644ac755fbb994488493bae9f341">node</a>) {
<a name="l00301"></a>00301                     <span class="keywordflow">if</span> (user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#ae13e644ac755fbb994488493bae9f341">node</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6bfb8557e92ab04b26c5520fca97d6a9">NODE_ACTIVE_TEXTURE</a>) {
<a name="l00302"></a>00302                         ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a5ff2ffe11c49e36b834308bb5a37659e">user</a> = user;
<a name="l00303"></a>00303                         ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a8a2471db1214f660fe6048a0964c996b">index</a> = <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a0a004822554284f0bb32fdc70cfeee1f">BLI_findindex</a>(&amp;ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a89907f0958ffe7467fa8b472e132ff62">users</a>, user);
<a name="l00304"></a>00304                         <span class="keywordflow">break</span>;
<a name="l00305"></a>00305                     }
<a name="l00306"></a>00306                 }
<a name="l00307"></a>00307             }
<a name="l00308"></a>00308         }
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310 }
<a name="l00311"></a>00311 
<a name="l00312"></a><a class="code" href="../../d1/dd7/buttons__texture_8c.html#ac4bbd96dfb9ec9a57669d8bcaa5425c8">00312</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dd7/buttons__texture_8c.html#ac4bbd96dfb9ec9a57669d8bcaa5425c8">template_texture_select</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <span class="keywordtype">void</span> *user_p, <span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(arg))
<a name="l00313"></a>00313 {
<a name="l00314"></a>00314     <span class="comment">/* callback when selecting a texture user in the menu */</span>
<a name="l00315"></a>00315     <a class="code" href="../../da/dff/structSpaceButs.html">SpaceButs</a> *sbuts = <a class="code" href="../../df/d01/BKE__context_8h.html#a91f51d2bb7994f69676eb25cbc0cda62">CTX_wm_space_buts</a>(C);
<a name="l00316"></a>00316     <a class="code" href="../../df/de4/structButsContextTexture.html">ButsContextTexture</a> *ct= (sbuts)? sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a72a195849400d9b64137ba5b98cc5420">texuser</a>: <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00317"></a>00317     <a class="code" href="../../d2/db2/structButsTextureUser.html">ButsTextureUser</a> *user = (<a class="code" href="../../d2/db2/structButsTextureUser.html">ButsTextureUser</a>*)user_p;
<a name="l00318"></a>00318     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> texptr;
<a name="l00319"></a>00319     <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex;
<a name="l00320"></a>00320 
<a name="l00321"></a>00321     <span class="keywordflow">if</span> (!ct)
<a name="l00322"></a>00322         <span class="keywordflow">return</span>;
<a name="l00323"></a>00323 
<a name="l00324"></a>00324     <span class="comment">/* set user as active */</span>
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (user-&gt;node) {
<a name="l00326"></a>00326         <a class="code" href="../../da/dcc/ED__node_8h.html#afc5f25d34b779aed3615fee37c390cdc">ED_node_set_active</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C), user-&gt;ntree, user-&gt;node);
<a name="l00327"></a>00327         ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#afad2113dae8853ac624231aad69333be">texture</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00328"></a>00328     }
<a name="l00329"></a>00329     <span class="keywordflow">else</span> {
<a name="l00330"></a>00330         texptr = <a class="code" href="../../d3/d10/rna__access_8c.html#a575c543a2a1f509f371bc1cee4fbe4d7">RNA_property_pointer_get</a>(&amp;user-&gt;ptr, user-&gt;prop);
<a name="l00331"></a>00331         tex = (<a class="code" href="../../d3/d10/rna__access_8c.html#ab0ac980958da7c9390bc055c30bf429b">RNA_struct_is_a</a>(texptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a41f868aea62068fbbfa36c1a5dbe30f9">type</a>, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#ae59cf2103f62b2f5de697c81a33c30af">RNA_Texture</a>))? texptr.<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>: <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00332"></a>00332 
<a name="l00333"></a>00333         ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#afad2113dae8853ac624231aad69333be">texture</a> = tex;
<a name="l00334"></a>00334     }
<a name="l00335"></a>00335 
<a name="l00336"></a>00336     ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a5ff2ffe11c49e36b834308bb5a37659e">user</a> = user;
<a name="l00337"></a>00337     ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a8a2471db1214f660fe6048a0964c996b">index</a> = user-&gt;index;
<a name="l00338"></a>00338 }
<a name="l00339"></a>00339 
<a name="l00340"></a><a class="code" href="../../d1/dd7/buttons__texture_8c.html#afc96fbd0289ab1fe466c919a6bc2e68e">00340</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dd7/buttons__texture_8c.html#afc96fbd0289ab1fe466c919a6bc2e68e">template_texture_user_menu</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d4/d94/structuiLayout.html">uiLayout</a> *layout, <span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(arg))
<a name="l00341"></a>00341 {
<a name="l00342"></a>00342     <span class="comment">/* callback when opening texture user selection menu, to create buttons. */</span>
<a name="l00343"></a>00343     <a class="code" href="../../da/dff/structSpaceButs.html">SpaceButs</a> *sbuts = <a class="code" href="../../df/d01/BKE__context_8h.html#a91f51d2bb7994f69676eb25cbc0cda62">CTX_wm_space_buts</a>(C);
<a name="l00344"></a>00344     <a class="code" href="../../df/de4/structButsContextTexture.html">ButsContextTexture</a> *ct= (sbuts)? sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a72a195849400d9b64137ba5b98cc5420">texuser</a>: <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00345"></a>00345     <a class="code" href="../../d2/db2/structButsTextureUser.html">ButsTextureUser</a> *user;
<a name="l00346"></a>00346     <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a103df17c27f04aa1a4d649c3d1ea349c">uiLayoutGetBlock</a>(layout);
<a name="l00347"></a>00347     <span class="keyword">const</span> <span class="keywordtype">char</span> *last_category = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     <span class="keywordflow">for</span> (user=ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a89907f0958ffe7467fa8b472e132ff62">users</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; user; user=user-&gt;next) {
<a name="l00350"></a>00350         <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l00351"></a>00351         <span class="keywordtype">char</span> name[<a class="code" href="../../d8/d1e/UI__interface_8h.html#add15eab7eae8baf93524951b6df38dd5">UI_MAX_NAME_STR</a>];
<a name="l00352"></a>00352 
<a name="l00353"></a>00353         <span class="comment">/* add label per category */</span>
<a name="l00354"></a>00354         <span class="keywordflow">if</span> (!last_category || strcmp(last_category, user-&gt;category) != 0) {
<a name="l00355"></a>00355             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a35f187f3b43444171e2ffb0a080c0fe7">uiItemL</a>(layout, user-&gt;category, ICON_NONE);
<a name="l00356"></a>00356             but= block-&gt;buttons.last;
<a name="l00357"></a>00357             but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a>= <a class="code" href="../../d8/d1e/UI__interface_8h.html#a91767f9bd27e8867feb9aa89e6d5a179">UI_TEXT_LEFT</a>;
<a name="l00358"></a>00358         }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360         <span class="comment">/* create button */</span>
<a name="l00361"></a>00361         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(name, <a class="code" href="../../d8/d1e/UI__interface_8h.html#add15eab7eae8baf93524951b6df38dd5">UI_MAX_NAME_STR</a>, <span class="stringliteral">&quot;  %s&quot;</span>, user-&gt;name);
<a name="l00362"></a>00362 
<a name="l00363"></a>00363         but = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a4d5e60fb7b1232c922c87756f90161ff">uiDefIconTextBut</a>(block, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a02c336ab5ee16270de92af2f3f2cb5eb">BUT</a>, 0, user-&gt;icon, name, 0, 0, <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad9963844aa21423f54e23c6746f5bd07">UI_UNIT_X</a>*4, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a07a4d52f535e8a85b1550584847132d8">UI_UNIT_Y</a>,
<a name="l00364"></a>00364             <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0.0, 0.0, 0.0, 0.0, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00365"></a>00365         <a class="code" href="../../d8/d1e/UI__interface_8h.html#aeb04b1acc3bfca77e8ceec6590d59ef2">uiButSetNFunc</a>(but, <a class="code" href="../../d1/dd7/buttons__texture_8c.html#ac4bbd96dfb9ec9a57669d8bcaa5425c8">template_texture_select</a>, <a class="code" href="../../da/d2b/mallocn_8c.html#a949901146866de87c434b2a6e225d2ec">MEM_dupallocN</a>(user), <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00366"></a>00366 
<a name="l00367"></a>00367         last_category = user-&gt;category;
<a name="l00368"></a>00368     }
<a name="l00369"></a>00369 }
<a name="l00370"></a>00370 
<a name="l00371"></a><a class="code" href="../../d1/dd7/buttons__texture_8c.html#a2475d5d3f7882ea2e50b5f4d89b61f54">00371</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#abc1b376dceba2d51526ce9e65221df2d">uiTemplateTextureUser</a>(<a class="code" href="../../d4/d94/structuiLayout.html">uiLayout</a> *layout, <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C)
<a name="l00372"></a>00372 {
<a name="l00373"></a>00373     <span class="comment">/* texture user selection dropdown menu. the available users have been</span>
<a name="l00374"></a>00374 <span class="comment">     * gathered before drawing in ButsContextTexture, we merely need to</span>
<a name="l00375"></a>00375 <span class="comment">     * display the current item. */</span>
<a name="l00376"></a>00376     <a class="code" href="../../da/dff/structSpaceButs.html">SpaceButs</a> *sbuts = <a class="code" href="../../df/d01/BKE__context_8h.html#a91f51d2bb7994f69676eb25cbc0cda62">CTX_wm_space_buts</a>(C);
<a name="l00377"></a>00377     <a class="code" href="../../df/de4/structButsContextTexture.html">ButsContextTexture</a> *ct= (sbuts)? sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a72a195849400d9b64137ba5b98cc5420">texuser</a>: <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00378"></a>00378     <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a103df17c27f04aa1a4d649c3d1ea349c">uiLayoutGetBlock</a>(layout);
<a name="l00379"></a>00379     <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l00380"></a>00380     <a class="code" href="../../d2/db2/structButsTextureUser.html">ButsTextureUser</a> *user;
<a name="l00381"></a>00381     <span class="keywordtype">char</span> name[<a class="code" href="../../d8/d1e/UI__interface_8h.html#add15eab7eae8baf93524951b6df38dd5">UI_MAX_NAME_STR</a>];
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <span class="keywordflow">if</span> (!ct)
<a name="l00384"></a>00384         <span class="keywordflow">return</span>;
<a name="l00385"></a>00385 
<a name="l00386"></a>00386     <span class="comment">/* get current user */</span>
<a name="l00387"></a>00387     user= ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a5ff2ffe11c49e36b834308bb5a37659e">user</a>;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389     <span class="keywordflow">if</span> (!user) {
<a name="l00390"></a>00390         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a35f187f3b43444171e2ffb0a080c0fe7">uiItemL</a>(layout, <span class="stringliteral">&quot;No textures in context.&quot;</span>, ICON_NONE);
<a name="l00391"></a>00391         <span class="keywordflow">return</span>;
<a name="l00392"></a>00392     }
<a name="l00393"></a>00393 
<a name="l00394"></a>00394     <span class="comment">/* create button */</span>
<a name="l00395"></a>00395     <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(name, <a class="code" href="../../d8/d1e/UI__interface_8h.html#add15eab7eae8baf93524951b6df38dd5">UI_MAX_NAME_STR</a>, <span class="stringliteral">&quot;%s&quot;</span>, user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#aafda3f732651ae5afe903cb4f9b3c866">name</a>);
<a name="l00396"></a>00396 
<a name="l00397"></a>00397     <span class="keywordflow">if</span> (user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#a3bd873a78f171116b4aa10c201da6a72">icon</a>) {
<a name="l00398"></a>00398         but = <a class="code" href="../../d8/d1e/UI__interface_8h.html#ab6d07deb6b6b025f6deff800001873a2">uiDefIconTextMenuBut</a>(block, <a class="code" href="../../d1/dd7/buttons__texture_8c.html#afc96fbd0289ab1fe466c919a6bc2e68e">template_texture_user_menu</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,
<a name="l00399"></a>00399             user-&gt;<a class="code" href="../../d2/db2/structButsTextureUser.html#a3bd873a78f171116b4aa10c201da6a72">icon</a>, name, 0, 0, <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad9963844aa21423f54e23c6746f5bd07">UI_UNIT_X</a>*4, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a07a4d52f535e8a85b1550584847132d8">UI_UNIT_Y</a>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00400"></a>00400     }
<a name="l00401"></a>00401     <span class="keywordflow">else</span> {
<a name="l00402"></a>00402         but = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a0a98416bc2a86ca4300422452b67ece3">uiDefMenuBut</a>(block, <a class="code" href="../../d1/dd7/buttons__texture_8c.html#afc96fbd0289ab1fe466c919a6bc2e68e">template_texture_user_menu</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,
<a name="l00403"></a>00403             name, 0, 0, <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad9963844aa21423f54e23c6746f5bd07">UI_UNIT_X</a>*4, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a07a4d52f535e8a85b1550584847132d8">UI_UNIT_Y</a>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00404"></a>00404     }
<a name="l00405"></a>00405 
<a name="l00406"></a>00406     <span class="comment">/* some cosmetic tweaks */</span>
<a name="l00407"></a>00407     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a56284cdae8be83ded3a0a78571caf54d">type</a>= <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad0d059e6a83d21bea4f4db1c9fbd240b">MENU</a>;
<a name="l00408"></a>00408     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> |= <a class="code" href="../../d8/d1e/UI__interface_8h.html#a91767f9bd27e8867feb9aa89e6d5a179">UI_TEXT_LEFT</a>;
<a name="l00409"></a>00409     but-&gt;<a class="code" href="../../d5/dd7/structuiBut.html#a23817cfadf5bb0c6ec9bc28eeffc1368">flag</a> &amp;= ~<a class="code" href="../../d8/d1e/UI__interface_8h.html#a37020aaeb659a80d5b6fcc2c384c8848">UI_ICON_SUBMENU</a>;
<a name="l00410"></a>00410 }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412 <span class="comment">/************************* Texture Show **************************/</span>
<a name="l00413"></a>00413 
<a name="l00414"></a><a class="code" href="../../d1/dd7/buttons__texture_8c.html#a1326076c36a1f2f25c8e0b90e8d08e76">00414</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/dd7/buttons__texture_8c.html#a1326076c36a1f2f25c8e0b90e8d08e76">template_texture_show</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keywordtype">void</span> *data_p, <span class="keywordtype">void</span> *prop_p)
<a name="l00415"></a>00415 {
<a name="l00416"></a>00416     <a class="code" href="../../da/dff/structSpaceButs.html">SpaceButs</a> *sbuts = <a class="code" href="../../df/d01/BKE__context_8h.html#a91f51d2bb7994f69676eb25cbc0cda62">CTX_wm_space_buts</a>(C);
<a name="l00417"></a>00417     <a class="code" href="../../df/de4/structButsContextTexture.html">ButsContextTexture</a> *ct= (sbuts)? sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a72a195849400d9b64137ba5b98cc5420">texuser</a>: <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00418"></a>00418     <a class="code" href="../../d2/db2/structButsTextureUser.html">ButsTextureUser</a> *user;
<a name="l00419"></a>00419 
<a name="l00420"></a>00420     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (!ct)
<a name="l00421"></a>00421         <span class="keywordflow">return</span>;
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     <span class="keywordflow">for</span> (user=ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a89907f0958ffe7467fa8b472e132ff62">users</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; user; user=user-&gt;next)
<a name="l00424"></a>00424         <span class="keywordflow">if</span> (user-&gt;ptr.data == data_p &amp;&amp; user-&gt;prop == prop_p)
<a name="l00425"></a>00425             <span class="keywordflow">break</span>;
<a name="l00426"></a>00426     
<a name="l00427"></a>00427     <span class="keywordflow">if</span> (user) {
<a name="l00428"></a>00428         <span class="comment">/* select texture */</span>
<a name="l00429"></a>00429         <a class="code" href="../../d1/dd7/buttons__texture_8c.html#ac4bbd96dfb9ec9a57669d8bcaa5425c8">template_texture_select</a>(C, user, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00430"></a>00430 
<a name="l00431"></a>00431         <span class="comment">/* change context */</span>
<a name="l00432"></a>00432         sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a9b64ce8a53612a6ea166c81364b48aba">BCONTEXT_TEXTURE</a>;
<a name="l00433"></a>00433         sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a3bad9320a18de672b22effaf986d76a3">mainbuser</a>= sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a>;
<a name="l00434"></a>00434         sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a8313641bf2c7b9d2ad3762371c695a81">preview</a>= 1;
<a name="l00435"></a>00435 
<a name="l00436"></a>00436         <span class="comment">/* redraw editor */</span>
<a name="l00437"></a>00437         <a class="code" href="../../d1/d12/ED__screen_8h.html#a0982c011d985308b08320d5f9604418b">ED_area_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C));
<a name="l00438"></a>00438     }
<a name="l00439"></a>00439 }
<a name="l00440"></a>00440 
<a name="l00441"></a><a class="code" href="../../d1/dd7/buttons__texture_8c.html#a3a5a5521b95c3ab872f39eb8be043c2f">00441</a> <span class="keywordtype">void</span> <a class="code" href="../../d8/d1e/UI__interface_8h.html#aec7c39e1c7981d4e80f7b661fec44a03">uiTemplateTextureShow</a>(<a class="code" href="../../d4/d94/structuiLayout.html">uiLayout</a> *layout, <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> *ptr, <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *prop)
<a name="l00442"></a>00442 {
<a name="l00443"></a>00443     <span class="comment">/* button to quickly show texture in texture tab */</span>
<a name="l00444"></a>00444     <a class="code" href="../../da/dff/structSpaceButs.html">SpaceButs</a> *sbuts = <a class="code" href="../../df/d01/BKE__context_8h.html#a91f51d2bb7994f69676eb25cbc0cda62">CTX_wm_space_buts</a>(C);
<a name="l00445"></a>00445     <a class="code" href="../../df/de4/structButsContextTexture.html">ButsContextTexture</a> *ct= (sbuts)? sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a72a195849400d9b64137ba5b98cc5420">texuser</a>: <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00446"></a>00446     <a class="code" href="../../d2/db2/structButsTextureUser.html">ButsTextureUser</a> *user;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     <span class="comment">/* only show button in other tabs in properties editor */</span>
<a name="l00449"></a>00449     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (!ct || sbuts-&gt;<a class="code" href="../../da/dff/structSpaceButs.html#a32ecfcef558bdd03b61e8afa5e061eb9">mainb</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a9b64ce8a53612a6ea166c81364b48aba">BCONTEXT_TEXTURE</a>)
<a name="l00450"></a>00450         <span class="keywordflow">return</span>;
<a name="l00451"></a>00451 
<a name="l00452"></a>00452     <span class="comment">/* find corresponding texture user */</span>
<a name="l00453"></a>00453     <span class="keywordflow">for</span> (user=ct-&gt;<a class="code" href="../../df/de4/structButsContextTexture.html#a89907f0958ffe7467fa8b472e132ff62">users</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; user; user=user-&gt;next)
<a name="l00454"></a>00454         <span class="keywordflow">if</span> (user-&gt;ptr.data == ptr-&gt;<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a> &amp;&amp; user-&gt;prop == prop)
<a name="l00455"></a>00455             <span class="keywordflow">break</span>;
<a name="l00456"></a>00456     
<a name="l00457"></a>00457     <span class="comment">/* draw button */</span>
<a name="l00458"></a>00458     <span class="keywordflow">if</span> (user) {
<a name="l00459"></a>00459         <a class="code" href="../../df/d5b/structuiBlock.html">uiBlock</a> *block = <a class="code" href="../../d8/d1e/UI__interface_8h.html#a103df17c27f04aa1a4d649c3d1ea349c">uiLayoutGetBlock</a>(layout);
<a name="l00460"></a>00460         <a class="code" href="../../d5/dd7/structuiBut.html">uiBut</a> *but;
<a name="l00461"></a>00461         
<a name="l00462"></a>00462         but = <a class="code" href="../../d8/d1e/UI__interface_8h.html#afb370449e683507d2b022aec0be66046">uiDefIconBut</a>(block, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a02c336ab5ee16270de92af2f3f2cb5eb">BUT</a>, 0, ICON_BUTS, 0, 0, <a class="code" href="../../d8/d1e/UI__interface_8h.html#ad9963844aa21423f54e23c6746f5bd07">UI_UNIT_X</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a07a4d52f535e8a85b1550584847132d8">UI_UNIT_Y</a>,
<a name="l00463"></a>00463             <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0.0, 0.0, 0.0, 0.0, <span class="stringliteral">&quot;Show texture in texture tab&quot;</span>);
<a name="l00464"></a>00464         <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3577b54257b3f858be44d8808e6c5cc6">uiButSetFunc</a>(but, <a class="code" href="../../d1/dd7/buttons__texture_8c.html#a1326076c36a1f2f25c8e0b90e8d08e76">template_texture_show</a>, user-&gt;ptr.data, user-&gt;prop);
<a name="l00465"></a>00465     }
<a name="l00466"></a>00466 }
<a name="l00467"></a>00467 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:10 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

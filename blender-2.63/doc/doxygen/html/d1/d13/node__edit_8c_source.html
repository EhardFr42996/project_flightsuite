<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: node_edit.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">node_edit.c</div>  </div>
</div>
<div class="contents">
<a href="../../d1/d13/node__edit_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version. </span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2005 Blender Foundation.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): David Millan Escriva, Juho Vepsäläinen, Nathan Letwory</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;errno.h&gt;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dfb/DNA__ID_8h.html" title="ID and Library types, which are fundamental for sdna.">DNA_ID.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html">DNA_lamp_types.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../de/db2/DNA__material__types_8h.html">DNA_material_types.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d27/DNA__node__types_8h.html">DNA_node_types.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d5a/DNA__particle__types_8h.html">DNA_particle_types.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d3b/DNA__world__types_8h.html">DNA_world_types.h</a>&quot;</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/da0/BKE__depsgraph_8h.html">BKE_depsgraph.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d77/BKE__image_8h.html">BKE_image.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/db1/BKE__library_8h.html">BKE_library.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d91/BKE__node_8h.html">BKE_node.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d0f/BKE__material_8h.html" title="General operations, lookup, etc. for materials.">BKE_material.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d0f/BKE__modifier_8h.html">BKE_modifier.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d86/BKE__paint_8h.html">BKE_paint.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d53/BKE__scene_8h.html">BKE_scene.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/da3/BKE__screen_8h.html">BKE_screen.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d66/BKE__texture_8h.html">BKE_texture.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d40/BKE__report_8h.html">BKE_report.h</a>&quot;</span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/dfd/RE__pipeline_8h.html">RE_pipeline.h</a>&quot;</span>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html" title="Contains defines and structs used throughout the imbuf module.">IMB_imbuf_types.h</a>&quot;</span>
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dcc/ED__node_8h.html">ED_node.h</a>&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d53/ED__image_8h.html">ED_image.h</a>&quot;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d12/ED__screen_8h.html">ED_screen.h</a>&quot;</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d5f/ED__space__api_8h.html">ED_space_api.h</a>&quot;</span>
<a name="l00077"></a>00077 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d53/ED__render_8h.html">ED_render.h</a>&quot;</span>
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="preprocessor">#include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00080"></a>00080 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d68/RNA__define_8h.html">RNA_define.h</a>&quot;</span>
<a name="l00081"></a>00081 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d68/RNA__enum__types_8h.html">RNA_enum_types.h</a>&quot;</span>
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00084"></a>00084 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d1e/UI__interface_8h.html">UI_interface.h</a>&quot;</span>
<a name="l00087"></a>00087 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d96/UI__resources_8h.html">UI_resources.h</a>&quot;</span>
<a name="l00088"></a>00088 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d63/UI__view2d_8h.html">UI_view2d.h</a>&quot;</span>
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d49/IMB__imbuf_8h.html">IMB_imbuf.h</a>&quot;</span>
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d68/RNA__enum__types_8h.html">RNA_enum_types.h</a>&quot;</span>
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d68/GPU__material_8h.html">GPU_material.h</a>&quot;</span>
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d8c/node__intern_8h.html">node_intern.h</a>&quot;</span>
<a name="l00097"></a>00097 
<a name="l00098"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a565b350b87ad559d709bb0a7ee221e9a">00098</a> <span class="keyword">static</span> <a class="code" href="../../d1/d8a/structEnumPropertyItem.html">EnumPropertyItem</a> <a class="code" href="../../d1/d13/node__edit_8c.html#a565b350b87ad559d709bb0a7ee221e9a">socket_in_out_items</a>[] = {
<a name="l00099"></a>00099     { <a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>, <span class="stringliteral">&quot;SOCK_IN&quot;</span>, 0, <span class="stringliteral">&quot;Input&quot;</span>, <span class="stringliteral">&quot;&quot;</span> },
<a name="l00100"></a>00100     { <a class="code" href="../../d4/d91/BKE__node_8h.html#a3e72f128f404bd40757228c1c30edfb6">SOCK_OUT</a>, <span class="stringliteral">&quot;SOCK_OUT&quot;</span>, 0, <span class="stringliteral">&quot;Output&quot;</span>, <span class="stringliteral">&quot;&quot;</span> },
<a name="l00101"></a>00101     { 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, NULL },
<a name="l00102"></a>00102 };
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 <span class="comment">/* ***************** composite job manager ********************** */</span>
<a name="l00105"></a>00105 
<a name="l00106"></a><a class="code" href="../../d6/dcb/structCompoJob.html">00106</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/dcb/structCompoJob.html">CompoJob</a> {
<a name="l00107"></a><a class="code" href="../../d6/dcb/structCompoJob.html#a7c2393240a2047315d9332a5950d9e21">00107</a>     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *<a class="code" href="../../d6/dcb/structCompoJob.html#a7c2393240a2047315d9332a5950d9e21">scene</a>;
<a name="l00108"></a><a class="code" href="../../d6/dcb/structCompoJob.html#a08286376921047d1c92db087f47b9cd6">00108</a>     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *<a class="code" href="../../d6/dcb/structCompoJob.html#a08286376921047d1c92db087f47b9cd6">ntree</a>;
<a name="l00109"></a><a class="code" href="../../d6/dcb/structCompoJob.html#afbeec69871543856f26e3075d4f1a3e0">00109</a>     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *<a class="code" href="../../d6/dcb/structCompoJob.html#afbeec69871543856f26e3075d4f1a3e0">localtree</a>;
<a name="l00110"></a><a class="code" href="../../d6/dcb/structCompoJob.html#a1505a547fd91b7d2ee68493465077123">00110</a>     <span class="keywordtype">short</span> *<a class="code" href="../../d6/dcb/structCompoJob.html#a1505a547fd91b7d2ee68493465077123">stop</a>;
<a name="l00111"></a><a class="code" href="../../d6/dcb/structCompoJob.html#aee38058bdd2bf7cdb074e47d3dba9bca">00111</a>     <span class="keywordtype">short</span> *<a class="code" href="../../d6/dcb/structCompoJob.html#aee38058bdd2bf7cdb074e47d3dba9bca">do_update</a>;
<a name="l00112"></a><a class="code" href="../../d6/dcb/structCompoJob.html#acbc712098e5b0f4866290e7bbc5e877d">00112</a>     <span class="keywordtype">float</span> *<a class="code" href="../../d6/dcb/structCompoJob.html#acbc712098e5b0f4866290e7bbc5e877d">progress</a>;
<a name="l00113"></a>00113 } <a class="code" href="../../d1/d13/node__edit_8c.html#ae7a88e42827d05c9ec81d8575273a05e">CompoJob</a>;
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 <span class="comment">/* called by compo, only to check job &#39;stop&#39; value */</span>
<a name="l00116"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a4a75d42aeb17d7b2490bf8afbe99cd8f">00116</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a4a75d42aeb17d7b2490bf8afbe99cd8f">compo_breakjob</a>(<span class="keywordtype">void</span> *cjv)
<a name="l00117"></a>00117 {
<a name="l00118"></a>00118     <a class="code" href="../../d6/dcb/structCompoJob.html">CompoJob</a> *cj= cjv;
<a name="l00119"></a>00119     
<a name="l00120"></a>00120     <span class="keywordflow">return</span> *(cj-&gt;<a class="code" href="../../d6/dcb/structCompoJob.html#a1505a547fd91b7d2ee68493465077123">stop</a>);
<a name="l00121"></a>00121 }
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 <span class="comment">/* called by compo, wmJob sends notifier */</span>
<a name="l00124"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a6643485c1ab201f3fa076cdc2489a2fb">00124</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a6643485c1ab201f3fa076cdc2489a2fb">compo_redrawjob</a>(<span class="keywordtype">void</span> *cjv, <span class="keywordtype">char</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<a class="code" href="../../d2/d36/interface__layout_8c.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>))
<a name="l00125"></a>00125 {
<a name="l00126"></a>00126     <a class="code" href="../../d6/dcb/structCompoJob.html">CompoJob</a> *cj= cjv;
<a name="l00127"></a>00127     
<a name="l00128"></a>00128     *(cj-&gt;<a class="code" href="../../d6/dcb/structCompoJob.html#aee38058bdd2bf7cdb074e47d3dba9bca">do_update</a>)= 1;
<a name="l00129"></a>00129 }
<a name="l00130"></a>00130 
<a name="l00131"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a6441de9533db1387500b11a9c7ecff15">00131</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a6441de9533db1387500b11a9c7ecff15">compo_freejob</a>(<span class="keywordtype">void</span> *cjv)
<a name="l00132"></a>00132 {
<a name="l00133"></a>00133     <a class="code" href="../../d6/dcb/structCompoJob.html">CompoJob</a> *cj= cjv;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135     <span class="keywordflow">if</span> (cj-&gt;<a class="code" href="../../d6/dcb/structCompoJob.html#afbeec69871543856f26e3075d4f1a3e0">localtree</a>) {
<a name="l00136"></a>00136         <a class="code" href="../../d4/d91/BKE__node_8h.html#a82e3e5d063980554bf0feb1286e087bc">ntreeLocalMerge</a>(cj-&gt;<a class="code" href="../../d6/dcb/structCompoJob.html#afbeec69871543856f26e3075d4f1a3e0">localtree</a>, cj-&gt;<a class="code" href="../../d6/dcb/structCompoJob.html#a08286376921047d1c92db087f47b9cd6">ntree</a>);
<a name="l00137"></a>00137     }
<a name="l00138"></a>00138     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(cj);
<a name="l00139"></a>00139 }
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 <span class="comment">/* only now we copy the nodetree, so adding many jobs while</span>
<a name="l00142"></a>00142 <span class="comment"> * sliding buttons doesn&#39;t frustrate */</span>
<a name="l00143"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a765dd27ac9ba517d9c10a7479af670b9">00143</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a765dd27ac9ba517d9c10a7479af670b9">compo_initjob</a>(<span class="keywordtype">void</span> *cjv)
<a name="l00144"></a>00144 {
<a name="l00145"></a>00145     <a class="code" href="../../d6/dcb/structCompoJob.html">CompoJob</a> *cj= cjv;
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     cj-&gt;<a class="code" href="../../d6/dcb/structCompoJob.html#afbeec69871543856f26e3075d4f1a3e0">localtree</a>= <a class="code" href="../../d4/d91/BKE__node_8h.html#a0c6fac4e1bca3cc6a05968379937ecb7">ntreeLocalize</a>(cj-&gt;<a class="code" href="../../d6/dcb/structCompoJob.html#a08286376921047d1c92db087f47b9cd6">ntree</a>);
<a name="l00148"></a>00148 }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 <span class="comment">/* called before redraw notifiers, it moves finished previews over */</span>
<a name="l00151"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a376f932a903418b1d7a83ec31a75f56d">00151</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a376f932a903418b1d7a83ec31a75f56d">compo_updatejob</a>(<span class="keywordtype">void</span> *cjv)
<a name="l00152"></a>00152 {
<a name="l00153"></a>00153     <a class="code" href="../../d6/dcb/structCompoJob.html">CompoJob</a> *cj= cjv;
<a name="l00154"></a>00154     
<a name="l00155"></a>00155     <a class="code" href="../../d4/d91/BKE__node_8h.html#a3ac7c3fa7bd32bf7910afd02209e31ff">ntreeLocalSync</a>(cj-&gt;<a class="code" href="../../d6/dcb/structCompoJob.html#afbeec69871543856f26e3075d4f1a3e0">localtree</a>, cj-&gt;<a class="code" href="../../d6/dcb/structCompoJob.html#a08286376921047d1c92db087f47b9cd6">ntree</a>);
<a name="l00156"></a>00156 }
<a name="l00157"></a>00157 
<a name="l00158"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a7a9d420812e659d72a9be13fc8b35a8f">00158</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a7a9d420812e659d72a9be13fc8b35a8f">compo_progressjob</a>(<span class="keywordtype">void</span> *cjv, <span class="keywordtype">float</span> progress)
<a name="l00159"></a>00159 {
<a name="l00160"></a>00160     <a class="code" href="../../d6/dcb/structCompoJob.html">CompoJob</a> *cj= cjv;
<a name="l00161"></a>00161     
<a name="l00162"></a>00162     *(cj-&gt;<a class="code" href="../../d6/dcb/structCompoJob.html#acbc712098e5b0f4866290e7bbc5e877d">progress</a>) = progress;
<a name="l00163"></a>00163 }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 <span class="comment">/* only this runs inside thread */</span>
<a name="l00167"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a05e930ce2cc2ce5ec7de861362e4fd60">00167</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a05e930ce2cc2ce5ec7de861362e4fd60">compo_startjob</a>(<span class="keywordtype">void</span> *cjv, <span class="keywordtype">short</span> *stop, <span class="keywordtype">short</span> *do_update, <span class="keywordtype">float</span> *progress)
<a name="l00168"></a>00168 {
<a name="l00169"></a>00169     <a class="code" href="../../d6/dcb/structCompoJob.html">CompoJob</a> *cj= cjv;
<a name="l00170"></a>00170     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree= cj-&gt;<a class="code" href="../../d6/dcb/structCompoJob.html#afbeec69871543856f26e3075d4f1a3e0">localtree</a>;
<a name="l00171"></a>00171 
<a name="l00172"></a>00172     <span class="keywordflow">if</span> (cj-&gt;<a class="code" href="../../d6/dcb/structCompoJob.html#a7c2393240a2047315d9332a5950d9e21">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#aad111279d77725d23416058f31414dd3">use_nodes</a>==0)
<a name="l00173"></a>00173         <span class="keywordflow">return</span>;
<a name="l00174"></a>00174     
<a name="l00175"></a>00175     cj-&gt;<a class="code" href="../../d6/dcb/structCompoJob.html#a1505a547fd91b7d2ee68493465077123">stop</a>= stop;
<a name="l00176"></a>00176     cj-&gt;<a class="code" href="../../d6/dcb/structCompoJob.html#aee38058bdd2bf7cdb074e47d3dba9bca">do_update</a>= do_update;
<a name="l00177"></a>00177     cj-&gt;<a class="code" href="../../d6/dcb/structCompoJob.html#acbc712098e5b0f4866290e7bbc5e877d">progress</a>= progress;
<a name="l00178"></a>00178     
<a name="l00179"></a>00179     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a33028b0ff737c58f606715b49a8bae35">test_break</a>= <a class="code" href="../../d1/d13/node__edit_8c.html#a4a75d42aeb17d7b2490bf8afbe99cd8f">compo_breakjob</a>;
<a name="l00180"></a>00180     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#aecbba0ec059f553dbb1530e11424c4b3">tbh</a>= cj;
<a name="l00181"></a>00181     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a47606240b472cca3dcc8c3e5df76ed6b">stats_draw</a>= <a class="code" href="../../d1/d13/node__edit_8c.html#a6643485c1ab201f3fa076cdc2489a2fb">compo_redrawjob</a>;
<a name="l00182"></a>00182     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ab3d45911784e71d09002cd77c4ee4309">sdh</a>= cj;
<a name="l00183"></a>00183     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac9e0ac3502eccbd86f1b149c9a7669ea">progress</a>= <a class="code" href="../../d1/d13/node__edit_8c.html#a7a9d420812e659d72a9be13fc8b35a8f">compo_progressjob</a>;
<a name="l00184"></a>00184     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a1a4d80f84e8990a31327c231cf3c4b9d">prh</a>= cj;
<a name="l00185"></a>00185     
<a name="l00186"></a>00186     <span class="comment">// XXX BIF_store_spare();</span>
<a name="l00187"></a>00187     
<a name="l00188"></a>00188     <a class="code" href="../../d4/d91/BKE__node_8h.html#a7a9f8c512b1d325d4c3b06486591d362">ntreeCompositExecTree</a>(ntree, &amp;cj-&gt;<a class="code" href="../../d6/dcb/structCompoJob.html#a7c2393240a2047315d9332a5950d9e21">scene</a>-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>, 1); <span class="comment">/* 1 is do_previews */</span>
<a name="l00189"></a>00189     
<a name="l00190"></a>00190     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a33028b0ff737c58f606715b49a8bae35">test_break</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00191"></a>00191     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a47606240b472cca3dcc8c3e5df76ed6b">stats_draw</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00192"></a>00192     ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac9e0ac3502eccbd86f1b149c9a7669ea">progress</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00193"></a>00193 
<a name="l00194"></a>00194 }
<a name="l00195"></a>00195 
<a name="l00196"></a><a class="code" href="../../d1/d13/node__edit_8c.html#ac7372edeaeb2932a3d4562cfbdc10cbb">00196</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ac7372edeaeb2932a3d4562cfbdc10cbb">snode_composite_job</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa)
<a name="l00197"></a>00197 {
<a name="l00198"></a>00198     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00199"></a>00199     <a class="code" href="../../df/da1/structwmJob.html">wmJob</a> *steve;
<a name="l00200"></a>00200     <a class="code" href="../../d6/dcb/structCompoJob.html">CompoJob</a> *cj;
<a name="l00201"></a>00201 
<a name="l00202"></a>00202     steve= <a class="code" href="../../d6/ddf/wm__jobs_8c.html#a03e66c0464fe9538f2be29d10983a54b">WM_jobs_get</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C), <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C), sa, <span class="stringliteral">&quot;Compositing&quot;</span>, <a class="code" href="../../d4/d7f/WM__api_8h.html#a9a92e41811d7810f88def86200440764">WM_JOB_EXCL_RENDER</a>|<a class="code" href="../../d4/d7f/WM__api_8h.html#a465c1325f2e6a043e462d7cb9af39731">WM_JOB_PROGRESS</a>);
<a name="l00203"></a>00203     cj= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/dcb/structCompoJob.html">CompoJob</a>), <span class="stringliteral">&quot;compo job&quot;</span>);
<a name="l00204"></a>00204     
<a name="l00205"></a>00205     <span class="comment">/* customdata for preview thread */</span>
<a name="l00206"></a>00206     cj-&gt;<a class="code" href="../../d6/dcb/structCompoJob.html#a7c2393240a2047315d9332a5950d9e21">scene</a>= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00207"></a>00207     cj-&gt;<a class="code" href="../../d6/dcb/structCompoJob.html#a08286376921047d1c92db087f47b9cd6">ntree</a>= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>;
<a name="l00208"></a>00208     
<a name="l00209"></a>00209     <span class="comment">/* setup job */</span>
<a name="l00210"></a>00210     <a class="code" href="../../d6/ddf/wm__jobs_8c.html#a32861c1bffe82b79764b704b38ef0751">WM_jobs_customdata</a>(steve, cj, <a class="code" href="../../d1/d13/node__edit_8c.html#a6441de9533db1387500b11a9c7ecff15">compo_freejob</a>);
<a name="l00211"></a>00211     <a class="code" href="../../d6/ddf/wm__jobs_8c.html#a61b5493e2cc31b7445290f3bd26be5ef">WM_jobs_timer</a>(steve, 0.1, <a class="code" href="../../d4/ddc/WM__types_8h.html#a61261a6b5ea948eee6d42c7e7ee18166">NC_SCENE</a>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a61261a6b5ea948eee6d42c7e7ee18166">NC_SCENE</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a457da89ce61565509b622e12c3a706bf">ND_COMPO_RESULT</a>);
<a name="l00212"></a>00212     <a class="code" href="../../d6/ddf/wm__jobs_8c.html#ad483f8df6cb0321204a4f98c645db4ba">WM_jobs_callbacks</a>(steve, <a class="code" href="../../d1/d13/node__edit_8c.html#a05e930ce2cc2ce5ec7de861362e4fd60">compo_startjob</a>, <a class="code" href="../../d1/d13/node__edit_8c.html#a765dd27ac9ba517d9c10a7479af670b9">compo_initjob</a>, <a class="code" href="../../d1/d13/node__edit_8c.html#a376f932a903418b1d7a83ec31a75f56d">compo_updatejob</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00213"></a>00213     
<a name="l00214"></a>00214     <a class="code" href="../../d6/ddf/wm__jobs_8c.html#a6b58050bebd06f6dcf195967da599bf0">WM_jobs_start</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C), steve);
<a name="l00215"></a>00215     
<a name="l00216"></a>00216 }
<a name="l00217"></a>00217 
<a name="l00218"></a>00218 <span class="comment">/* ***************************************** */</span>
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 <span class="comment">/* operator poll callback */</span>
<a name="l00221"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a6ccb546628222c2bc2e034b9352a52d1">00221</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a6ccb546628222c2bc2e034b9352a52d1">composite_node_active</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l00222"></a>00222 {
<a name="l00223"></a>00223     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>(C)) {
<a name="l00224"></a>00224         <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l00225"></a>00225         <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#acc2e52658693034e5b1f8ea667163749">treetype</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>)
<a name="l00226"></a>00226             <span class="keywordflow">return</span> 1;
<a name="l00227"></a>00227     }
<a name="l00228"></a>00228     <span class="keywordflow">return</span> 0;
<a name="l00229"></a>00229 }
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 <span class="comment">/* also checks for edited groups */</span>
<a name="l00232"></a><a class="code" href="../../d1/d13/node__edit_8c.html#aab7cc4b56c93a885d8a9bf3a40f9c59c">00232</a> <span class="keyword">static</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *<a class="code" href="../../d1/d13/node__edit_8c.html#aab7cc4b56c93a885d8a9bf3a40f9c59c">editnode_get_active</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00233"></a>00233 {
<a name="l00234"></a>00234     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00235"></a>00235     
<a name="l00236"></a>00236     <span class="comment">/* check for edited group */</span>
<a name="l00237"></a>00237     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l00238"></a>00238         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/BKE__node_8h.html#a3eb89e599889f39e698a8d06204e19a4">nodeGroupEditGet</a>(node))
<a name="l00239"></a>00239             <span class="keywordflow">break</span>;
<a name="l00240"></a>00240     <span class="keywordflow">if</span> (node)
<a name="l00241"></a>00241         <span class="keywordflow">return</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a65bf254e8194856a100e3e88d96cf4fe">nodeGetActive</a>((<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>);
<a name="l00242"></a>00242     <span class="keywordflow">else</span>
<a name="l00243"></a>00243         <span class="keywordflow">return</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a65bf254e8194856a100e3e88d96cf4fe">nodeGetActive</a>(ntree);
<a name="l00244"></a>00244 }
<a name="l00245"></a>00245 
<a name="l00246"></a><a class="code" href="../../d1/d13/node__edit_8c.html#addc9fdee9fc2340eedb472e61a7b9b18">00246</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#addc9fdee9fc2340eedb472e61a7b9b18">snode_dag_update</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>), <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode)
<a name="l00247"></a>00247 {
<a name="l00248"></a>00248     <a class="code" href="../../d2/da0/BKE__depsgraph_8h.html#a70d8c170e1f4bbcc010d94405d6a9817">DAG_id_tag_update</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>, 0);
<a name="l00249"></a>00249 }
<a name="l00250"></a>00250 
<a name="l00251"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#ab1d6ee4b761971486000224e290b2ff9">00251</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode)
<a name="l00252"></a>00252 {
<a name="l00253"></a>00253     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a13c3603eb6f6a0ef5fd6d45c1e740eb6">NC_NODE</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#acc2e52658693034e5b1f8ea667163749">treetype</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>)
<a name="l00256"></a>00256         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a835f426982dfbc3be8305095253ad793">NC_MATERIAL</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a6cc4913036e9953f8c01c6630065fc2f">ND_NODES</a>, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>);
<a name="l00257"></a>00257     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#acc2e52658693034e5b1f8ea667163749">treetype</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>)
<a name="l00258"></a>00258         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a61261a6b5ea948eee6d42c7e7ee18166">NC_SCENE</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a6cc4913036e9953f8c01c6630065fc2f">ND_NODES</a>, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>);
<a name="l00259"></a>00259     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#acc2e52658693034e5b1f8ea667163749">treetype</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a2a2ccfad1cf200204b0fdd594f45de7b">NTREE_TEXTURE</a>)
<a name="l00260"></a>00260         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#aa5d5ad0b941376d3be89c261f876f4fa">NC_TEXTURE</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a6cc4913036e9953f8c01c6630065fc2f">ND_NODES</a>, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>);
<a name="l00261"></a>00261 }
<a name="l00262"></a>00262 
<a name="l00263"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a7921cf9c4d67d6e6801f29bee0012897">00263</a> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *<a class="code" href="../../d1/d13/node__edit_8c.html#a3502c8be1cf3dd72e3cc366ae3bd91ef">node_tree_get_editgroup</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *nodetree)
<a name="l00264"></a>00264 {
<a name="l00265"></a>00265     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *gnode;
<a name="l00266"></a>00266     
<a name="l00267"></a>00267     <span class="comment">/* get the groupnode */</span>
<a name="l00268"></a>00268     <span class="keywordflow">for</span> (gnode= nodetree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; gnode; gnode= gnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l00269"></a>00269         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/BKE__node_8h.html#a3eb89e599889f39e698a8d06204e19a4">nodeGroupEditGet</a>(gnode))
<a name="l00270"></a>00270             <span class="keywordflow">break</span>;
<a name="l00271"></a>00271     <span class="keywordflow">return</span> gnode;
<a name="l00272"></a>00272 }
<a name="l00273"></a>00273 
<a name="l00274"></a>00274 <span class="comment">/* assumes nothing being done in ntree yet, sets the default in/out node */</span>
<a name="l00275"></a>00275 <span class="comment">/* called from shading buttons or header */</span>
<a name="l00276"></a><a class="code" href="../../d1/d13/node__edit_8c.html#af3a4a7d1bada90afae944116b16d3de4">00276</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dcc/ED__node_8h.html#af1e00a1c0b42263c5445f8393c51a91a">ED_node_shader_default</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>)
<a name="l00277"></a>00277 {
<a name="l00278"></a>00278     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *in, *out;
<a name="l00279"></a>00279     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *fromsock, *tosock, *sock;
<a name="l00280"></a>00280     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree;
<a name="l00281"></a>00281     <a class="code" href="../../dd/dc3/structbNodeTemplate.html">bNodeTemplate</a> ntemp;
<a name="l00282"></a>00282     <span class="keywordtype">int</span> output_type, shader_type;
<a name="l00283"></a>00283     <span class="keywordtype">float</span> color[3], strength = 1.0f;
<a name="l00284"></a>00284     
<a name="l00285"></a>00285     ntree= <a class="code" href="../../d4/d91/BKE__node_8h.html#a061b08730b913443f7b577f99ae284c1">ntreeAddTree</a>(<span class="stringliteral">&quot;Shader Nodetree&quot;</span>, <a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>, 0);
<a name="l00286"></a>00286 
<a name="l00287"></a>00287     <span class="keywordflow">switch</span>(<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)) {
<a name="l00288"></a>00288         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#acf5020c901e2793a056ffca95ec8195a">ID_MA</a>: {
<a name="l00289"></a>00289             <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma= (<a class="code" href="../../d2/d10/structMaterial.html">Material</a>*)<span class="keywordtype">id</span>;
<a name="l00290"></a>00290             ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a> = ntree;
<a name="l00291"></a>00291 
<a name="l00292"></a>00292             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d53/BKE__scene_8h.html#a041ff0e68dd0152e85ceddddc9b53cdc">scene_use_new_shading_nodes</a>(scene)) {
<a name="l00293"></a>00293                 output_type = <a class="code" href="../../d4/d91/BKE__node_8h.html#a923c936199dd06f0bd993936344ee607">SH_NODE_OUTPUT_MATERIAL</a>;
<a name="l00294"></a>00294                 shader_type = <a class="code" href="../../d4/d91/BKE__node_8h.html#a7f276ec1005f3baadd6d652ce3256812">SH_NODE_BSDF_DIFFUSE</a>;
<a name="l00295"></a>00295             }
<a name="l00296"></a>00296             <span class="keywordflow">else</span> {
<a name="l00297"></a>00297                 output_type = <a class="code" href="../../d4/d91/BKE__node_8h.html#a36fae285d8d3d3b17405ec81d409be1f">SH_NODE_OUTPUT</a>;
<a name="l00298"></a>00298                 shader_type = <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#ace6b95d5a7f5e545f627bdd7dde1a278">SH_NODE_MATERIAL</a>;
<a name="l00299"></a>00299             }
<a name="l00300"></a>00300 
<a name="l00301"></a>00301             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(color, &amp;ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a9e892cbd7e25b6fd5ee00c383cd9cacf">r</a>);
<a name="l00302"></a>00302             strength= 0.0f;
<a name="l00303"></a>00303             <span class="keywordflow">break</span>;
<a name="l00304"></a>00304         }
<a name="l00305"></a>00305         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa1ab8c153d4a007f72d37a2106ecbfa0">ID_WO</a>: {
<a name="l00306"></a>00306             <a class="code" href="../../d7/d3f/structWorld.html">World</a> *wo= (<a class="code" href="../../d7/d3f/structWorld.html">World</a>*)<span class="keywordtype">id</span>;
<a name="l00307"></a>00307             wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a141c5c72fbf4bedfab53b9f0f091b1a9">nodetree</a> = ntree;
<a name="l00308"></a>00308 
<a name="l00309"></a>00309             output_type = <a class="code" href="../../d4/d91/BKE__node_8h.html#a1b1b3b5ed4848479d7aa3c497ca53c57">SH_NODE_OUTPUT_WORLD</a>;
<a name="l00310"></a>00310             shader_type = <a class="code" href="../../d4/d91/BKE__node_8h.html#aa16cf297436000bc8ec5b291b0b0c8c6">SH_NODE_BACKGROUND</a>;
<a name="l00311"></a>00311 
<a name="l00312"></a>00312             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(color, &amp;wo-&gt;<a class="code" href="../../d7/d3f/structWorld.html#af555a01e6a98f5768255cd8be50d0a6a">horr</a>);
<a name="l00313"></a>00313             strength= 1.0f;
<a name="l00314"></a>00314             <span class="keywordflow">break</span>;
<a name="l00315"></a>00315         }
<a name="l00316"></a>00316         <span class="keywordflow">case</span> <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82e259dda95124fd771a23f105f52810">ID_LA</a>: {
<a name="l00317"></a>00317             <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la= (<a class="code" href="../../d5/d72/structLamp.html">Lamp</a>*)<span class="keywordtype">id</span>;
<a name="l00318"></a>00318             la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a957058346e5bf9659eec90ba4e31d76f">nodetree</a> = ntree;
<a name="l00319"></a>00319 
<a name="l00320"></a>00320             output_type = <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#adb4e2f06c21b9af79d07f7be46ae58df">SH_NODE_OUTPUT_LAMP</a>;
<a name="l00321"></a>00321             shader_type = <a class="code" href="../../d4/d91/BKE__node_8h.html#a34981f39ad54a64712065a5bd6155f4a">SH_NODE_EMISSION</a>;
<a name="l00322"></a>00322 
<a name="l00323"></a>00323             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(color, &amp;la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a78ed635336937d2f878451f2ad65e849">r</a>);
<a name="l00324"></a>00324             <span class="keywordflow">if</span> (la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6c8bfeca1d8a74252bfe284de7d754cb">type</a> == <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#ab67de808c369ec7696aff85a24eace8e">LA_LOCAL</a> || la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6c8bfeca1d8a74252bfe284de7d754cb">type</a> == <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a55ba7e9dc61979b7097cb11dace90bdb">LA_SPOT</a> || la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a6c8bfeca1d8a74252bfe284de7d754cb">type</a> == <a class="code" href="../../d0/d16/DNA__lamp__types_8h.html#a0f089dd53e59d56d00b73493496fa2c3">LA_AREA</a>)
<a name="l00325"></a>00325                 strength= 100.0f;
<a name="l00326"></a>00326             <span class="keywordflow">else</span>
<a name="l00327"></a>00327                 strength= 1.0f;
<a name="l00328"></a>00328             <span class="keywordflow">break</span>;
<a name="l00329"></a>00329         }
<a name="l00330"></a>00330         <span class="keywordflow">default</span>:
<a name="l00331"></a>00331             printf(<span class="stringliteral">&quot;ED_node_shader_default called on wrong ID type.\n&quot;</span>);
<a name="l00332"></a>00332             <span class="keywordflow">return</span>;
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334     
<a name="l00335"></a>00335     ntemp.<a class="code" href="../../dd/dc3/structbNodeTemplate.html#a8948f989fe76d9bbfc8c31b10bc4d761">type</a> = output_type;
<a name="l00336"></a>00336     out= <a class="code" href="../../d4/d91/BKE__node_8h.html#a9a6d0fd5e4711cb2a9a33cf1d5ec84c2">nodeAddNode</a>(ntree, &amp;ntemp);
<a name="l00337"></a>00337     out-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6529ad3fb2c8ec6ed289fcc90418d777">locx</a>= 300.0f; out-&gt;<a class="code" href="../../dc/daa/structbNode.html#a137e36d3b64e577a17fda472a8f34588">locy</a>= 300.0f;
<a name="l00338"></a>00338     
<a name="l00339"></a>00339     ntemp.<a class="code" href="../../dd/dc3/structbNodeTemplate.html#a8948f989fe76d9bbfc8c31b10bc4d761">type</a> = shader_type;
<a name="l00340"></a>00340     in= <a class="code" href="../../d4/d91/BKE__node_8h.html#a9a6d0fd5e4711cb2a9a33cf1d5ec84c2">nodeAddNode</a>(ntree, &amp;ntemp);
<a name="l00341"></a>00341     in-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6529ad3fb2c8ec6ed289fcc90418d777">locx</a>= 10.0f; in-&gt;<a class="code" href="../../dc/daa/structbNode.html#a137e36d3b64e577a17fda472a8f34588">locy</a>= 300.0f;
<a name="l00342"></a>00342     <a class="code" href="../../d4/d91/BKE__node_8h.html#aef5a94d758aa610c384ae08b358b0bbc">nodeSetActive</a>(ntree, in);
<a name="l00343"></a>00343     
<a name="l00344"></a>00344     <span class="comment">/* only a link from color to color */</span>
<a name="l00345"></a>00345     fromsock= in-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00346"></a>00346     tosock= out-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00347"></a>00347     <a class="code" href="../../d4/d91/BKE__node_8h.html#aa161c89ff293492384fdccbbe61863fa">nodeAddLink</a>(ntree, in, fromsock, out, tosock);
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     <span class="comment">/* default values */</span>
<a name="l00350"></a>00350     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d53/BKE__scene_8h.html#a041ff0e68dd0152e85ceddddc9b53cdc">scene_use_new_shading_nodes</a>(scene)) {
<a name="l00351"></a>00351         sock= in-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00352"></a>00352         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(((<a class="code" href="../../de/da3/structbNodeSocketValueRGBA.html">bNodeSocketValueRGBA</a>*)sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>)-&gt;value, color);
<a name="l00353"></a>00353 
<a name="l00354"></a>00354         <span class="keywordflow">if</span> (strength != 0.0f) {
<a name="l00355"></a>00355             sock= in-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>;
<a name="l00356"></a>00356             ((<a class="code" href="../../d3/d8f/structbNodeSocketValueFloat.html">bNodeSocketValueFloat</a>*)sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#aa2e80e88e95eb16b4627c4973aaa06b8">default_value</a>)-&gt;value= strength;
<a name="l00357"></a>00357         }
<a name="l00358"></a>00358     }
<a name="l00359"></a>00359     
<a name="l00360"></a>00360     <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(ntree);
<a name="l00361"></a>00361 }
<a name="l00362"></a>00362 
<a name="l00363"></a>00363 <span class="comment">/* assumes nothing being done in ntree yet, sets the default in/out node */</span>
<a name="l00364"></a>00364 <span class="comment">/* called from shading buttons or header */</span>
<a name="l00365"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a667a346931e820fc3159a4db4084f7df">00365</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dcc/ED__node_8h.html#af6fc13c79158dbaacb0a888c65a8b4f6">ED_node_composit_default</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce)
<a name="l00366"></a>00366 {
<a name="l00367"></a>00367     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *in, *out;
<a name="l00368"></a>00368     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *fromsock, *tosock;
<a name="l00369"></a>00369     <a class="code" href="../../dd/dc3/structbNodeTemplate.html">bNodeTemplate</a> ntemp;
<a name="l00370"></a>00370     
<a name="l00371"></a>00371     <span class="comment">/* but lets check it anyway */</span>
<a name="l00372"></a>00372     <span class="keywordflow">if</span> (sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>) {
<a name="l00373"></a>00373         <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635a1207ca157c84a6be5a8a36c691c4aa72">G_DEBUG</a>)
<a name="l00374"></a>00374             printf(<span class="stringliteral">&quot;error in composite initialize\n&quot;</span>);
<a name="l00375"></a>00375         <span class="keywordflow">return</span>;
<a name="l00376"></a>00376     }
<a name="l00377"></a>00377     
<a name="l00378"></a>00378     sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>= <a class="code" href="../../d4/d91/BKE__node_8h.html#a061b08730b913443f7b577f99ae284c1">ntreeAddTree</a>(<span class="stringliteral">&quot;Compositing Nodetree&quot;</span>, <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>, 0);
<a name="l00379"></a>00379     
<a name="l00380"></a>00380     ntemp.<a class="code" href="../../dd/dc3/structbNodeTemplate.html#a8948f989fe76d9bbfc8c31b10bc4d761">type</a> = <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#afebb3fe5e904f63ef36f0dce271da9ed">CMP_NODE_COMPOSITE</a>;
<a name="l00381"></a>00381     out= <a class="code" href="../../d4/d91/BKE__node_8h.html#a9a6d0fd5e4711cb2a9a33cf1d5ec84c2">nodeAddNode</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>, &amp;ntemp);
<a name="l00382"></a>00382     out-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6529ad3fb2c8ec6ed289fcc90418d777">locx</a>= 300.0f; out-&gt;<a class="code" href="../../dc/daa/structbNode.html#a137e36d3b64e577a17fda472a8f34588">locy</a>= 400.0f;
<a name="l00383"></a>00383     out-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>= &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>;
<a name="l00384"></a>00384     <a class="code" href="../../d8/db1/BKE__library_8h.html#a967d1ceef29b2612ef6e03194c512ad6">id_us_plus</a>(out-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>);
<a name="l00385"></a>00385     
<a name="l00386"></a>00386     ntemp.<a class="code" href="../../dd/dc3/structbNodeTemplate.html#a8948f989fe76d9bbfc8c31b10bc4d761">type</a> = <a class="code" href="../../d4/d91/BKE__node_8h.html#ad757ff9a25034f9e939a65aaea8d1cce">CMP_NODE_R_LAYERS</a>;
<a name="l00387"></a>00387     in= <a class="code" href="../../d4/d91/BKE__node_8h.html#a9a6d0fd5e4711cb2a9a33cf1d5ec84c2">nodeAddNode</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>, &amp;ntemp);
<a name="l00388"></a>00388     in-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6529ad3fb2c8ec6ed289fcc90418d777">locx</a>= 10.0f; in-&gt;<a class="code" href="../../dc/daa/structbNode.html#a137e36d3b64e577a17fda472a8f34588">locy</a>= 400.0f;
<a name="l00389"></a>00389     in-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>= &amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>;
<a name="l00390"></a>00390     <a class="code" href="../../d8/db1/BKE__library_8h.html#a967d1ceef29b2612ef6e03194c512ad6">id_us_plus</a>(in-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>);
<a name="l00391"></a>00391     <a class="code" href="../../d4/d91/BKE__node_8h.html#aef5a94d758aa610c384ae08b358b0bbc">nodeSetActive</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>, in);
<a name="l00392"></a>00392     
<a name="l00393"></a>00393     <span class="comment">/* links from color to color */</span>
<a name="l00394"></a>00394     fromsock= in-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00395"></a>00395     tosock= out-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00396"></a>00396     <a class="code" href="../../d4/d91/BKE__node_8h.html#aa161c89ff293492384fdccbbe61863fa">nodeAddLink</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>, in, fromsock, out, tosock);
<a name="l00397"></a>00397     
<a name="l00398"></a>00398     <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>);
<a name="l00399"></a>00399     
<a name="l00400"></a>00400     <span class="comment">// XXX ntreeCompositForceHidden(sce-&gt;nodetree);</span>
<a name="l00401"></a>00401 }
<a name="l00402"></a>00402 
<a name="l00403"></a>00403 <span class="comment">/* assumes nothing being done in ntree yet, sets the default in/out node */</span>
<a name="l00404"></a>00404 <span class="comment">/* called from shading buttons or header */</span>
<a name="l00405"></a><a class="code" href="../../d1/d13/node__edit_8c.html#added3e808c79ffc1cd93cfba4a2c2dcc">00405</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dcc/ED__node_8h.html#ae658981292360aa28e2997784f97090a">ED_node_texture_default</a>(<a class="code" href="../../df/d2d/structTex.html">Tex</a> *tx)
<a name="l00406"></a>00406 {
<a name="l00407"></a>00407     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *in, *out;
<a name="l00408"></a>00408     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *fromsock, *tosock;
<a name="l00409"></a>00409     <a class="code" href="../../dd/dc3/structbNodeTemplate.html">bNodeTemplate</a> ntemp;
<a name="l00410"></a>00410     
<a name="l00411"></a>00411     <span class="comment">/* but lets check it anyway */</span>
<a name="l00412"></a>00412     <span class="keywordflow">if</span> (tx-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>) {
<a name="l00413"></a>00413         <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635a1207ca157c84a6be5a8a36c691c4aa72">G_DEBUG</a>)
<a name="l00414"></a>00414             printf(<span class="stringliteral">&quot;error in texture initialize\n&quot;</span>);
<a name="l00415"></a>00415         <span class="keywordflow">return</span>;
<a name="l00416"></a>00416     }
<a name="l00417"></a>00417     
<a name="l00418"></a>00418     tx-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>= <a class="code" href="../../d4/d91/BKE__node_8h.html#a061b08730b913443f7b577f99ae284c1">ntreeAddTree</a>(<span class="stringliteral">&quot;Texture Nodetree&quot;</span>, <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a2a2ccfad1cf200204b0fdd594f45de7b">NTREE_TEXTURE</a>, 0);
<a name="l00419"></a>00419     
<a name="l00420"></a>00420     ntemp.<a class="code" href="../../dd/dc3/structbNodeTemplate.html#a8948f989fe76d9bbfc8c31b10bc4d761">type</a> = <a class="code" href="../../d4/d91/BKE__node_8h.html#ac211721c4d688750f281901d7619001d">TEX_NODE_OUTPUT</a>;
<a name="l00421"></a>00421     out= <a class="code" href="../../d4/d91/BKE__node_8h.html#a9a6d0fd5e4711cb2a9a33cf1d5ec84c2">nodeAddNode</a>(tx-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>, &amp;ntemp);
<a name="l00422"></a>00422     out-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6529ad3fb2c8ec6ed289fcc90418d777">locx</a>= 300.0f; out-&gt;<a class="code" href="../../dc/daa/structbNode.html#a137e36d3b64e577a17fda472a8f34588">locy</a>= 300.0f;
<a name="l00423"></a>00423     
<a name="l00424"></a>00424     ntemp.<a class="code" href="../../dd/dc3/structbNodeTemplate.html#a8948f989fe76d9bbfc8c31b10bc4d761">type</a> = <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#af74192d474eba2b98e084505148f19c1">TEX_NODE_CHECKER</a>;
<a name="l00425"></a>00425     in= <a class="code" href="../../d4/d91/BKE__node_8h.html#a9a6d0fd5e4711cb2a9a33cf1d5ec84c2">nodeAddNode</a>(tx-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>, &amp;ntemp);
<a name="l00426"></a>00426     in-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6529ad3fb2c8ec6ed289fcc90418d777">locx</a>= 10.0f; in-&gt;<a class="code" href="../../dc/daa/structbNode.html#a137e36d3b64e577a17fda472a8f34588">locy</a>= 300.0f;
<a name="l00427"></a>00427     <a class="code" href="../../d4/d91/BKE__node_8h.html#aef5a94d758aa610c384ae08b358b0bbc">nodeSetActive</a>(tx-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>, in);
<a name="l00428"></a>00428     
<a name="l00429"></a>00429     fromsock= in-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00430"></a>00430     tosock= out-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00431"></a>00431     <a class="code" href="../../d4/d91/BKE__node_8h.html#aa161c89ff293492384fdccbbe61863fa">nodeAddLink</a>(tx-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>, in, fromsock, out, tosock);
<a name="l00432"></a>00432     
<a name="l00433"></a>00433     <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(tx-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>);
<a name="l00434"></a>00434 }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436 <span class="comment">/* id is supposed to contain a node tree */</span>
<a name="l00437"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#ab0f5a4ac5037d67e861a9b0d58e70d3e">00437</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ab0f5a4ac5037d67e861a9b0d58e70d3e">node_tree_from_ID</a>(<a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> **ntree, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> **edittree, <span class="keywordtype">int</span> *treetype)
<a name="l00438"></a>00438 {
<a name="l00439"></a>00439     <span class="keywordflow">if</span> (<span class="keywordtype">id</span>) {
<a name="l00440"></a>00440         <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00441"></a>00441         <span class="keywordtype">short</span> idtype= <a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(id-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>);
<a name="l00442"></a>00442     
<a name="l00443"></a>00443         <span class="keywordflow">if</span> (idtype == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6e5ed4060f73b0f46e66af2dbef9dd2a">ID_NT</a>) {
<a name="l00444"></a>00444             *ntree= (<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a>*)<span class="keywordtype">id</span>;
<a name="l00445"></a>00445             <span class="keywordflow">if</span> (treetype) *treetype= (*ntree)-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>;
<a name="l00446"></a>00446         }
<a name="l00447"></a>00447         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idtype == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#acf5020c901e2793a056ffca95ec8195a">ID_MA</a>) {
<a name="l00448"></a>00448             *ntree= ((<a class="code" href="../../d2/d10/structMaterial.html">Material</a>*)<span class="keywordtype">id</span>)-&gt;nodetree;
<a name="l00449"></a>00449             <span class="keywordflow">if</span> (treetype) *treetype= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>;
<a name="l00450"></a>00450         }
<a name="l00451"></a>00451         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idtype == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82e259dda95124fd771a23f105f52810">ID_LA</a>) {
<a name="l00452"></a>00452             *ntree= ((<a class="code" href="../../d5/d72/structLamp.html">Lamp</a>*)<span class="keywordtype">id</span>)-&gt;nodetree;
<a name="l00453"></a>00453             <span class="keywordflow">if</span> (treetype) *treetype= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>;
<a name="l00454"></a>00454         }
<a name="l00455"></a>00455         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idtype == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa1ab8c153d4a007f72d37a2106ecbfa0">ID_WO</a>) {
<a name="l00456"></a>00456             *ntree= ((<a class="code" href="../../d7/d3f/structWorld.html">World</a>*)<span class="keywordtype">id</span>)-&gt;nodetree;
<a name="l00457"></a>00457             <span class="keywordflow">if</span> (treetype) *treetype= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>;
<a name="l00458"></a>00458         }
<a name="l00459"></a>00459         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idtype == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac2b425dbd1f73ad1720fafad2626d974">ID_SCE</a>) {
<a name="l00460"></a>00460             *ntree= ((<a class="code" href="../../d9/d27/structScene.html">Scene</a>*)<span class="keywordtype">id</span>)-&gt;nodetree;
<a name="l00461"></a>00461             <span class="keywordflow">if</span> (treetype) *treetype= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>;
<a name="l00462"></a>00462         }
<a name="l00463"></a>00463         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idtype == <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac850344bf7854d7860b43adb1e65e228">ID_TE</a>) {
<a name="l00464"></a>00464             *ntree= ((<a class="code" href="../../df/d2d/structTex.html">Tex</a>*)<span class="keywordtype">id</span>)-&gt;nodetree;
<a name="l00465"></a>00465             <span class="keywordflow">if</span> (treetype) *treetype= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a2a2ccfad1cf200204b0fdd594f45de7b">NTREE_TEXTURE</a>;
<a name="l00466"></a>00466         }
<a name="l00467"></a>00467         <span class="keywordflow">else</span> {
<a name="l00468"></a>00468             <span class="keywordflow">if</span> (treetype) *treetype= 0;
<a name="l00469"></a>00469             <span class="keywordflow">return</span>;
<a name="l00470"></a>00470         }
<a name="l00471"></a>00471     
<a name="l00472"></a>00472         <span class="comment">/* find editable group */</span>
<a name="l00473"></a>00473         <span class="keywordflow">if</span> (edittree) {
<a name="l00474"></a>00474             <span class="keywordflow">if</span> (*ntree)
<a name="l00475"></a>00475                 <span class="keywordflow">for</span> (node= (*ntree)-&gt;nodes.first; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l00476"></a>00476                     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/BKE__node_8h.html#a3eb89e599889f39e698a8d06204e19a4">nodeGroupEditGet</a>(node))
<a name="l00477"></a>00477                         <span class="keywordflow">break</span>;
<a name="l00478"></a>00478             
<a name="l00479"></a>00479             <span class="keywordflow">if</span> (node &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>)
<a name="l00480"></a>00480                 *edittree= (<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>;
<a name="l00481"></a>00481             <span class="keywordflow">else</span>
<a name="l00482"></a>00482                 *edittree= *ntree;
<a name="l00483"></a>00483         }
<a name="l00484"></a>00484     }
<a name="l00485"></a>00485     <span class="keywordflow">else</span> {
<a name="l00486"></a>00486         *ntree= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00487"></a>00487         *edittree= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00488"></a>00488         <span class="keywordflow">if</span> (treetype) *treetype= 0;
<a name="l00489"></a>00489     }
<a name="l00490"></a>00490 }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492 <span class="comment">/* Here we set the active tree(s), even called for each redraw now, so keep it fast :) */</span>
<a name="l00493"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#af3752ed9cce41665ca8279adeee8be39">00493</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#af3752ed9cce41665ca8279adeee8be39">snode_set_context</a>(<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene)
<a name="l00494"></a>00494 {
<a name="l00495"></a>00495     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a119935c54737bd111df8fd516c390000">OBACT</a>;
<a name="l00496"></a>00496     
<a name="l00497"></a>00497     snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a1b5e5e7f5f27603d73df99964b7a9e33">from</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00498"></a>00498     
<a name="l00499"></a>00499     <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#acc2e52658693034e5b1f8ea667163749">treetype</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>) {
<a name="l00500"></a>00500         <span class="comment">/* need active object, or we allow pinning... */</span>
<a name="l00501"></a>00501         <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#affd0451a1a9e19c9d9c1915abf80cd6e">shaderfrom</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a071dcf28f16005b87ce54ed24fb4d3e7">SNODE_SHADER_OBJECT</a>) {
<a name="l00502"></a>00502             <span class="keywordflow">if</span> (ob) {
<a name="l00503"></a>00503                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1514ec0465b89013544107c908e7abca">OB_LAMP</a>) {
<a name="l00504"></a>00504                     snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a1b5e5e7f5f27603d73df99964b7a9e33">from</a>= &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>;
<a name="l00505"></a>00505                     snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00506"></a>00506                 }
<a name="l00507"></a>00507                 <span class="keywordflow">else</span> {
<a name="l00508"></a>00508                     <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma= <a class="code" href="../../d4/d0f/BKE__material_8h.html#a941f5112d1047bcbcf3e2212685296a5">give_current_material</a>(ob, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a7f7913949235b61d1cd0b8f343d0cbfc">actcol</a>);
<a name="l00509"></a>00509                     <span class="keywordflow">if</span> (ma) {
<a name="l00510"></a>00510                         snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a1b5e5e7f5f27603d73df99964b7a9e33">from</a>= &amp;ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>;
<a name="l00511"></a>00511                         snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>= &amp;ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>;
<a name="l00512"></a>00512                     }
<a name="l00513"></a>00513                 }
<a name="l00514"></a>00514             }
<a name="l00515"></a>00515         }
<a name="l00516"></a>00516         <span class="keywordflow">else</span> { <span class="comment">/* SNODE_SHADER_WORLD */</span>
<a name="l00517"></a>00517             <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aefac18ed3d1ded63b012f79a3ca8ddb2">world</a>) {
<a name="l00518"></a>00518                 snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a1b5e5e7f5f27603d73df99964b7a9e33">from</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00519"></a>00519                 snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>= &amp;scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aefac18ed3d1ded63b012f79a3ca8ddb2">world</a>-&gt;<a class="code" href="../../d7/d3f/structWorld.html#a4504eae7c57dff86fda73ab56264a50a">id</a>;
<a name="l00520"></a>00520             }
<a name="l00521"></a>00521         }
<a name="l00522"></a>00522     }
<a name="l00523"></a>00523     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#acc2e52658693034e5b1f8ea667163749">treetype</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>) {
<a name="l00524"></a>00524         snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>= &amp;scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>;
<a name="l00525"></a>00525         
<a name="l00526"></a>00526         <span class="comment">/* update output sockets based on available layers */</span>
<a name="l00527"></a>00527         <a class="code" href="../../d4/d91/BKE__node_8h.html#adbc74c8525b3597285bdb7e9b42fd016">ntreeCompositForceHidden</a>(scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>, scene);
<a name="l00528"></a>00528     }
<a name="l00529"></a>00529     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#acc2e52658693034e5b1f8ea667163749">treetype</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a2a2ccfad1cf200204b0fdd594f45de7b">NTREE_TEXTURE</a>) {
<a name="l00530"></a>00530         <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tx= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00531"></a>00531 
<a name="l00532"></a>00532         <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ab6de6dbe6910b78c040cc245ad78d2fd">texfrom</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a1dfbf0f96e8522ff8f389857e4175fab">SNODE_TEX_OBJECT</a>) {
<a name="l00533"></a>00533             <span class="keywordflow">if</span> (ob) {
<a name="l00534"></a>00534                 tx= <a class="code" href="../../d2/d66/BKE__texture_8h.html#aa497baad2307b0c609be9890f5a5ebdc">give_current_object_texture</a>(ob);
<a name="l00535"></a>00535 
<a name="l00536"></a>00536                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> == <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1514ec0465b89013544107c908e7abca">OB_LAMP</a>)
<a name="l00537"></a>00537                     snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a1b5e5e7f5f27603d73df99964b7a9e33">from</a>= (<a class="code" href="../../d8/d7e/structID.html">ID</a>*)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00538"></a>00538                 <span class="keywordflow">else</span>
<a name="l00539"></a>00539                     snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a1b5e5e7f5f27603d73df99964b7a9e33">from</a>= (<a class="code" href="../../d8/d7e/structID.html">ID</a>*)<a class="code" href="../../d4/d0f/BKE__material_8h.html#a941f5112d1047bcbcf3e2212685296a5">give_current_material</a>(ob, ob-&gt;<a class="code" href="../../de/de7/structObject.html#a7f7913949235b61d1cd0b8f343d0cbfc">actcol</a>);
<a name="l00540"></a>00540 
<a name="l00541"></a>00541                 <span class="comment">/* from is not set fully for material nodes, should be ID + Node then */</span>
<a name="l00542"></a>00542                 snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>= &amp;tx-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>;
<a name="l00543"></a>00543             }
<a name="l00544"></a>00544         }
<a name="l00545"></a>00545         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ab6de6dbe6910b78c040cc245ad78d2fd">texfrom</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a3f53c0822b978a865b4461d54f7831a0">SNODE_TEX_WORLD</a>) {
<a name="l00546"></a>00546             tx= <a class="code" href="../../d2/d66/BKE__texture_8h.html#ae340b8ac4023f729e268ff88db2dbbd2">give_current_world_texture</a>(scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aefac18ed3d1ded63b012f79a3ca8ddb2">world</a>);
<a name="l00547"></a>00547             snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a1b5e5e7f5f27603d73df99964b7a9e33">from</a>= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aefac18ed3d1ded63b012f79a3ca8ddb2">world</a>;
<a name="l00548"></a>00548             snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>= &amp;tx-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>;
<a name="l00549"></a>00549         }
<a name="l00550"></a>00550         <span class="keywordflow">else</span> {
<a name="l00551"></a>00551             <span class="keyword">struct </span><a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00552"></a>00552             
<a name="l00553"></a>00553             <span class="keywordflow">if</span> (ob &amp;&amp; (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a4f90725f5876b309d325c84ae4f5c51b">mode</a> &amp; <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a36fb08f71e0c90da2a0f21518ef0d550a7b8620799f1bc866a5dc5ecaacf987a7">OB_MODE_SCULPT</a>))
<a name="l00554"></a>00554                 brush= <a class="code" href="../../d8/d86/BKE__paint_8h.html#abc920423e2205663f7131ab5d7eb9eaa">paint_brush</a>(&amp;scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a3d7b2bfc12195d43d8dac148e95d0281">sculpt</a>-&gt;<a class="code" href="../../d2/df6/structSculpt.html#a266f9f0d61a292f88102781150d7acc5">paint</a>);
<a name="l00555"></a>00555             <span class="keywordflow">else</span>
<a name="l00556"></a>00556                 brush= <a class="code" href="../../d8/d86/BKE__paint_8h.html#abc920423e2205663f7131ab5d7eb9eaa">paint_brush</a>(&amp;scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a6723b2b9cc9129060c7b2b5c3de1cc77">toolsettings</a>-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a1a36b13607238910a064c1b9b61430e5">imapaint</a>.<a class="code" href="../../d1/d54/structImagePaintSettings.html#a2ef68c48836293b4bdbddd0dcedf958b">paint</a>);
<a name="l00557"></a>00557 
<a name="l00558"></a>00558             <span class="keywordflow">if</span> (brush) {
<a name="l00559"></a>00559                 snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a1b5e5e7f5f27603d73df99964b7a9e33">from</a>= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)brush;
<a name="l00560"></a>00560                 tx= <a class="code" href="../../d2/d66/BKE__texture_8h.html#aa986ca3756ba55713da1a8cbb771c300">give_current_brush_texture</a>(brush);
<a name="l00561"></a>00561                 snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>= &amp;tx-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>;
<a name="l00562"></a>00562             }
<a name="l00563"></a>00563         }
<a name="l00564"></a>00564     }
<a name="l00565"></a>00565     <span class="keywordflow">else</span> {
<a name="l00566"></a>00566         <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a> &amp;&amp; snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a> == snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#acc2e52658693034e5b1f8ea667163749">treetype</a>)
<a name="l00567"></a>00567             snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a> = &amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>;
<a name="l00568"></a>00568         <span class="keywordflow">else</span>
<a name="l00569"></a>00569             snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00570"></a>00570     }
<a name="l00571"></a>00571 
<a name="l00572"></a>00572     <a class="code" href="../../d1/d13/node__edit_8c.html#ab0f5a4ac5037d67e861a9b0d58e70d3e">node_tree_from_ID</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>, &amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>, &amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00573"></a>00573 }
<a name="l00574"></a>00574 
<a name="l00575"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a3cfedc979a13196864e0774f29f9419e">00575</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a3cfedc979a13196864e0774f29f9419e">snode_update</a>(<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00576"></a>00576 {
<a name="l00577"></a>00577     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *gnode;
<a name="l00578"></a>00578     
<a name="l00579"></a>00579     <span class="keywordflow">if</span> (node)
<a name="l00580"></a>00580         <a class="code" href="../../d4/d91/BKE__node_8h.html#a5899bdebefd986150eaa5bfc95641c5b">nodeUpdate</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, node);
<a name="l00581"></a>00581     
<a name="l00582"></a>00582     <span class="comment">/* if inside group, tag entire group */</span>
<a name="l00583"></a>00583     gnode= <a class="code" href="../../d1/d13/node__edit_8c.html#a3502c8be1cf3dd72e3cc366ae3bd91ef">node_tree_get_editgroup</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>);
<a name="l00584"></a>00584     <span class="keywordflow">if</span> (gnode)
<a name="l00585"></a>00585         <a class="code" href="../../d4/d91/BKE__node_8h.html#a7f3de8e85e038cac2d3843fd77a8f05e">nodeUpdateID</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>, gnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>);
<a name="l00586"></a>00586 }
<a name="l00587"></a>00587 
<a name="l00588"></a><a class="code" href="../../d1/d13/node__edit_8c.html#aea6f5ac5649668a5175043c05e47ad56">00588</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#aea6f5ac5649668a5175043c05e47ad56">has_nodetree</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *lookup)
<a name="l00589"></a>00589 {
<a name="l00590"></a>00590     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00591"></a>00591     
<a name="l00592"></a>00592     <span class="keywordflow">if</span> (ntree == lookup)
<a name="l00593"></a>00593         <span class="keywordflow">return</span> 1;
<a name="l00594"></a>00594     
<a name="l00595"></a>00595     <span class="keywordflow">for</span> (node=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l00596"></a>00596         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a> == <a class="code" href="../../d4/d91/BKE__node_8h.html#ab9f16ff5fded11f644b983a041c97edd">NODE_GROUP</a> &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>)
<a name="l00597"></a>00597             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d13/node__edit_8c.html#aea6f5ac5649668a5175043c05e47ad56">has_nodetree</a>((<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a>*)node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>, lookup))
<a name="l00598"></a>00598                 <span class="keywordflow">return</span> 1;
<a name="l00599"></a>00599     
<a name="l00600"></a>00600     <span class="keywordflow">return</span> 0;
<a name="l00601"></a>00601 }
<a name="l00602"></a>00602 
<a name="l00603"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a93a9f26ffe699f25d2548bfe11cec266">00603</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dcc/ED__node_8h.html#afc5f25d34b779aed3615fee37c390cdc">ED_node_set_active</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l00604"></a>00604 {
<a name="l00605"></a>00605     <span class="keywordtype">int</span> was_active_texture = (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6bfb8557e92ab04b26c5520fca97d6a9">NODE_ACTIVE_TEXTURE</a>);
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     <a class="code" href="../../d4/d91/BKE__node_8h.html#aef5a94d758aa610c384ae08b358b0bbc">nodeSetActive</a>(ntree, node);
<a name="l00608"></a>00608     
<a name="l00609"></a>00609     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>!=<a class="code" href="../../d4/d91/BKE__node_8h.html#ab9f16ff5fded11f644b983a041c97edd">NODE_GROUP</a>) {
<a name="l00610"></a>00610         <span class="keywordtype">int</span> was_output= (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5235b68781c15e33df28760c8e43aa84">NODE_DO_OUTPUT</a>);
<a name="l00611"></a>00611         
<a name="l00612"></a>00612         <span class="comment">/* tree specific activate calls */</span>
<a name="l00613"></a>00613         <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>) {
<a name="l00614"></a>00614             <span class="comment">/* when we select a material, active texture is cleared, for buttons */</span>
<a name="l00615"></a>00615             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a> &amp;&amp; <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(<a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>), <a class="code" href="../../d3/dfb/DNA__ID_8h.html#acf5020c901e2793a056ffca95ec8195a">ID_MA</a>, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82e259dda95124fd771a23f105f52810">ID_LA</a>, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#aa1ab8c153d4a007f72d37a2106ecbfa0">ID_WO</a>))
<a name="l00616"></a>00616                 <a class="code" href="../../d4/d91/BKE__node_8h.html#a2272a6c8d8829e022d91891bd07c2a27">nodeClearActiveID</a>(ntree, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ac850344bf7854d7860b43adb1e65e228">ID_TE</a>);
<a name="l00617"></a>00617             
<a name="l00618"></a>00618             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#a36fae285d8d3d3b17405ec81d409be1f">SH_NODE_OUTPUT</a>) {
<a name="l00619"></a>00619                 <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *tnode;
<a name="l00620"></a>00620                 
<a name="l00621"></a>00621                 <span class="keywordflow">for</span> (tnode= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tnode; tnode= tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l00622"></a>00622                     <span class="keywordflow">if</span> ( tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#a36fae285d8d3d3b17405ec81d409be1f">SH_NODE_OUTPUT</a>)
<a name="l00623"></a>00623                         tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5235b68781c15e33df28760c8e43aa84">NODE_DO_OUTPUT</a>;
<a name="l00624"></a>00624                 
<a name="l00625"></a>00625                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5235b68781c15e33df28760c8e43aa84">NODE_DO_OUTPUT</a>;
<a name="l00626"></a>00626                 <span class="keywordflow">if</span> (was_output==0)
<a name="l00627"></a>00627                     <a class="code" href="../../da/dcc/ED__node_8h.html#a5d76bd5684ce41263f3d1af3f46cdcbc">ED_node_generic_update</a>(bmain, ntree, node);
<a name="l00628"></a>00628             }
<a name="l00629"></a>00629 
<a name="l00630"></a>00630             <span class="comment">/* if active texture changed, free glsl materials */</span>
<a name="l00631"></a>00631             <span class="keywordflow">if</span> ((node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6bfb8557e92ab04b26c5520fca97d6a9">NODE_ACTIVE_TEXTURE</a>) &amp;&amp; !was_active_texture) {
<a name="l00632"></a>00632                 <a class="code" href="../../d2/d10/structMaterial.html">Material</a> *ma;
<a name="l00633"></a>00633 
<a name="l00634"></a>00634                 <span class="keywordflow">for</span> (ma=bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#afbcb0c6e7f10e562d567fe016fc6c5a5">mat</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ma; ma=ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a3fc06eed9b3244922dd05906dcc58cde">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l00635"></a>00635                     <span class="keywordflow">if</span> (ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a> &amp;&amp; ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#ae5c87659b1f4bd186431d96361ade966">use_nodes</a> &amp;&amp; <a class="code" href="../../d1/d13/node__edit_8c.html#aea6f5ac5649668a5175043c05e47ad56">has_nodetree</a>(ma-&gt;<a class="code" href="../../d2/d10/structMaterial.html#a535477b1fb0d8090cc56a0541c5ff467">nodetree</a>, ntree))
<a name="l00636"></a>00636                         <a class="code" href="../../de/d68/GPU__material_8h.html#acdaa9d514ad84c86d16569bd6e328530">GPU_material_free</a>(ma);
<a name="l00637"></a>00637 
<a name="l00638"></a>00638                 <a class="code" href="../../df/db0/wm__event__system_8c.html#a2d4bab7477e1a026061d578f19247457">WM_main_add_notifier</a>(<a class="code" href="../../d4/ddc/WM__types_8h.html#a86a44bfe4ef4915f026b4dd988498727">NC_IMAGE</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00639"></a>00639             }
<a name="l00640"></a>00640 
<a name="l00641"></a>00641             <a class="code" href="../../df/db0/wm__event__system_8c.html#a2d4bab7477e1a026061d578f19247457">WM_main_add_notifier</a>(<a class="code" href="../../d4/ddc/WM__types_8h.html#a835f426982dfbc3be8305095253ad793">NC_MATERIAL</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a6cc4913036e9953f8c01c6630065fc2f">ND_NODES</a>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>);
<a name="l00642"></a>00642         }
<a name="l00643"></a>00643         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>) {
<a name="l00644"></a>00644             <span class="comment">/* make active viewer, currently only 1 supported... */</span>
<a name="l00645"></a>00645             <span class="keywordflow">if</span> ( <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a2228c27b390d81a533a4bf66c5c9d5c7">CMP_NODE_VIEWER</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#abc03163f091ee64dc016da0f154af5f2">CMP_NODE_SPLITVIEWER</a>)) {
<a name="l00646"></a>00646                 <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *tnode;
<a name="l00647"></a>00647                 
<a name="l00648"></a>00648 
<a name="l00649"></a>00649                 <span class="keywordflow">for</span> (tnode= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tnode; tnode= tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l00650"></a>00650                     <span class="keywordflow">if</span> ( <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a2228c27b390d81a533a4bf66c5c9d5c7">CMP_NODE_VIEWER</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#abc03163f091ee64dc016da0f154af5f2">CMP_NODE_SPLITVIEWER</a>))
<a name="l00651"></a>00651                         tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5235b68781c15e33df28760c8e43aa84">NODE_DO_OUTPUT</a>;
<a name="l00652"></a>00652                 
<a name="l00653"></a>00653                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5235b68781c15e33df28760c8e43aa84">NODE_DO_OUTPUT</a>;
<a name="l00654"></a>00654                 <span class="keywordflow">if</span> (was_output==0)
<a name="l00655"></a>00655                     <a class="code" href="../../da/dcc/ED__node_8h.html#a5d76bd5684ce41263f3d1af3f46cdcbc">ED_node_generic_update</a>(bmain, ntree, node);
<a name="l00656"></a>00656                 
<a name="l00657"></a>00657                 <span class="comment">/* addnode() doesnt link this yet... */</span>
<a name="l00658"></a>00658                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>= (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)<a class="code" href="../../d2/d77/BKE__image_8h.html#acadfd029703b4c5129e5e763506421a5">BKE_image_verify_viewer</a>(<a class="code" href="../../d2/d77/BKE__image_8h.html#a922dc453e6b157a2da1dc7ffb5fb19f6">IMA_TYPE_COMPOSITE</a>, <span class="stringliteral">&quot;Viewer Node&quot;</span>);
<a name="l00659"></a>00659             }
<a name="l00660"></a>00660             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#ad757ff9a25034f9e939a65aaea8d1cce">CMP_NODE_R_LAYERS</a>) {
<a name="l00661"></a>00661                 <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene;
<a name="l00662"></a>00662 
<a name="l00663"></a>00663                 <span class="keywordflow">for</span> (scene=bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; scene; scene=scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l00664"></a>00664                     <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a> &amp;&amp; scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aad111279d77725d23416058f31414dd3">use_nodes</a> &amp;&amp; <a class="code" href="../../d1/d13/node__edit_8c.html#aea6f5ac5649668a5175043c05e47ad56">has_nodetree</a>(scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>, ntree)) {
<a name="l00665"></a>00665                         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>==(<a class="code" href="../../d8/d7e/structID.html">ID</a> *)scene) {
<a name="l00666"></a>00666                             scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a74466739f51a2d037494278cd2c9dd97">actlay</a>= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a55bc501c3ee93e75427b84f309d9b7">custom1</a>;
<a name="l00667"></a>00667                         }
<a name="l00668"></a>00668                     }
<a name="l00669"></a>00669                 }
<a name="l00670"></a>00670             }
<a name="l00671"></a>00671             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#afebb3fe5e904f63ef36f0dce271da9ed">CMP_NODE_COMPOSITE</a>) {
<a name="l00672"></a>00672                 <span class="keywordflow">if</span> (was_output==0) {
<a name="l00673"></a>00673                     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *tnode;
<a name="l00674"></a>00674                     
<a name="l00675"></a>00675                     <span class="keywordflow">for</span> (tnode= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tnode; tnode= tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l00676"></a>00676                         <span class="keywordflow">if</span> ( tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#afebb3fe5e904f63ef36f0dce271da9ed">CMP_NODE_COMPOSITE</a>)
<a name="l00677"></a>00677                             tnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5235b68781c15e33df28760c8e43aa84">NODE_DO_OUTPUT</a>;
<a name="l00678"></a>00678                     
<a name="l00679"></a>00679                     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5235b68781c15e33df28760c8e43aa84">NODE_DO_OUTPUT</a>;
<a name="l00680"></a>00680                     <a class="code" href="../../da/dcc/ED__node_8h.html#a5d76bd5684ce41263f3d1af3f46cdcbc">ED_node_generic_update</a>(bmain, ntree, node);
<a name="l00681"></a>00681                 }
<a name="l00682"></a>00682             }
<a name="l00683"></a>00683         }
<a name="l00684"></a>00684         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a2a2ccfad1cf200204b0fdd594f45de7b">NTREE_TEXTURE</a>) {
<a name="l00685"></a>00685             <span class="comment">// XXX</span>
<a name="l00686"></a>00686 <span class="preprocessor">#if 0</span>
<a name="l00687"></a>00687 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>)
<a name="l00688"></a>00688                 ; <span class="comment">// XXX BIF_preview_changed(-1);</span>
<a name="l00689"></a>00689             <span class="comment">// allqueue(REDRAWBUTSSHADING, 1);</span>
<a name="l00690"></a>00690             <span class="comment">// allqueue(REDRAWIPO, 0);</span>
<a name="l00691"></a>00691 <span class="preprocessor">#endif</span>
<a name="l00692"></a>00692 <span class="preprocessor"></span>        }
<a name="l00693"></a>00693     }
<a name="l00694"></a>00694 }
<a name="l00695"></a>00695 
<a name="l00696"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a60c7ffe0d359aae69a4c1dc3e4d3d221">00696</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a60c7ffe0d359aae69a4c1dc3e4d3d221">inside_rctf</a>(<a class="code" href="../../da/d10/structrctf.html">rctf</a> *<a class="code" href="../../d8/d40/btDbvt_8cpp.html#a42f734331cf10fc65cd1c80c5d764ebc">bounds</a>, <a class="code" href="../../da/d10/structrctf.html">rctf</a> *rect)
<a name="l00697"></a>00697 {
<a name="l00698"></a>00698     <span class="keywordflow">return</span> (bounds-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> &lt;= rect-&gt;<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> &amp;&amp;
<a name="l00699"></a>00699             bounds-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> &gt;= rect-&gt;<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> &amp;&amp;
<a name="l00700"></a>00700             bounds-&gt;<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> &lt;= rect-&gt;<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> &amp;&amp;
<a name="l00701"></a>00701             bounds-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> &gt;= rect-&gt;<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>);
<a name="l00702"></a>00702 }
<a name="l00703"></a>00703 
<a name="l00704"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a820d9daaad41d0bb31bf91b4b6865a86">00704</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a820d9daaad41d0bb31bf91b4b6865a86">node_frame_attach_nodes</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(ntree), <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *frame)
<a name="l00705"></a>00705 {
<a name="l00706"></a>00706     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00707"></a>00707     
<a name="l00708"></a>00708     <span class="comment">/* only check nodes on top of the frame for attaching */</span>
<a name="l00709"></a>00709     <span class="keywordflow">for</span> (node=frame-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l00710"></a>00710         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a>==frame) {
<a name="l00711"></a>00711             <span class="comment">/* detach nodes that went outside the frame */</span>
<a name="l00712"></a>00712             <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d13/node__edit_8c.html#a60c7ffe0d359aae69a4c1dc3e4d3d221">inside_rctf</a>(&amp;frame-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>, &amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>))
<a name="l00713"></a>00713                 <a class="code" href="../../d4/d91/BKE__node_8h.html#ae533a989f90d55311cafea5673d9adb1">nodeDetachNode</a>(node);
<a name="l00714"></a>00714         }
<a name="l00715"></a>00715         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ad7b09e7f53c184ca8fb8015d3d50d808">NODE_SELECT</a> &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00716"></a>00716             <span class="comment">/* attach selected, still unparented nodes */</span>
<a name="l00717"></a>00717             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d13/node__edit_8c.html#a60c7ffe0d359aae69a4c1dc3e4d3d221">inside_rctf</a>(&amp;frame-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>, &amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>))
<a name="l00718"></a>00718                 <a class="code" href="../../d4/d91/BKE__node_8h.html#a6045214a4d26524eeeb49eb4c1d0a8f5">nodeAttachNode</a>(node, frame);
<a name="l00719"></a>00719         }
<a name="l00720"></a>00720     }
<a name="l00721"></a>00721 }
<a name="l00722"></a>00722 
<a name="l00723"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a09a7873d6154e425696e3894cce6791a">00723</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dcc/ED__node_8h.html#a82a56547160cd057b88d1b64d8336f63">ED_node_update_hierarchy</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>), <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree)
<a name="l00724"></a>00724 {
<a name="l00725"></a>00725     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00726"></a>00726     
<a name="l00727"></a>00727     <span class="comment">/* XXX This does not work due to layout functions relying on node-&gt;block,</span>
<a name="l00728"></a>00728 <span class="comment">     * which only exists during actual drawing. Can we rely on valid totr rects?</span>
<a name="l00729"></a>00729 <span class="comment">     */</span>
<a name="l00730"></a>00730     <span class="comment">/* make sure nodes have correct bounding boxes after transform */</span>
<a name="l00731"></a>00731 <span class="comment">//  node_update_nodetree(C, ntree, 0.0f, 0.0f);</span>
<a name="l00732"></a>00732     
<a name="l00733"></a>00733     <span class="comment">/* all selected nodes are re-parented */</span>
<a name="l00734"></a>00734     <span class="keywordflow">for</span> (node=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94bdf8dfba2cce2d62f1d6e4cd0ec81d">prev</a>) {
<a name="l00735"></a>00735         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ad7b09e7f53c184ca8fb8015d3d50d808">NODE_SELECT</a> &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a50a1960a5acd5f2d2aa3c2efb08b316d">parent</a>)
<a name="l00736"></a>00736             <a class="code" href="../../d4/d91/BKE__node_8h.html#ae533a989f90d55311cafea5673d9adb1">nodeDetachNode</a>(node);
<a name="l00737"></a>00737     }
<a name="l00738"></a>00738     
<a name="l00739"></a>00739     <span class="comment">/* update higher Z-level nodes first */</span>
<a name="l00740"></a>00740     <span class="keywordflow">for</span> (node=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94bdf8dfba2cce2d62f1d6e4cd0ec81d">prev</a>) {
<a name="l00741"></a>00741         <span class="comment">/* XXX callback? */</span>
<a name="l00742"></a>00742         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#ad313d75abf85b020b6e6cc7d63a65295">NODE_FRAME</a>)
<a name="l00743"></a>00743             <a class="code" href="../../d1/d13/node__edit_8c.html#a820d9daaad41d0bb31bf91b4b6865a86">node_frame_attach_nodes</a>(ntree, node);
<a name="l00744"></a>00744     }
<a name="l00745"></a>00745 }
<a name="l00746"></a>00746 
<a name="l00747"></a>00747 <span class="comment">/* ***************** generic operator functions for nodes ***************** */</span>
<a name="l00748"></a>00748 
<a name="l00749"></a>00749 <span class="preprocessor">#if 0 </span><span class="comment">/* UNUSED */</span>
<a name="l00750"></a>00750 
<a name="l00751"></a>00751 <span class="keyword">static</span> <span class="keywordtype">int</span> edit_node_poll(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l00752"></a>00752 {
<a name="l00753"></a>00753     <span class="keywordflow">return</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>(C);
<a name="l00754"></a>00754 }
<a name="l00755"></a>00755 
<a name="l00756"></a>00756 <span class="keyword">static</span> <span class="keywordtype">void</span> edit_node_properties(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00757"></a>00757 {
<a name="l00758"></a>00758     <span class="comment">/* XXX could node be a context pointer? */</span>
<a name="l00759"></a>00759     <a class="code" href="../../dc/d7e/rna__define_8c.html#ac53a3ed18da454971065d5b4e4cb4d62">RNA_def_string</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;node&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../d1/db4/DNA__defs_8h.html#ac7c0207aa5a0e10d378be03b68041350">MAX_NAME</a>, <span class="stringliteral">&quot;Node&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00760"></a>00760     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;socket&quot;</span>, 0, 0, <a class="code" href="../../d4/d91/BKE__node_8h.html#ac0ab6f439d003d912087974e24160b68">MAX_SOCKET</a>, <span class="stringliteral">&quot;Socket&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 0, <a class="code" href="../../d4/d91/BKE__node_8h.html#ac0ab6f439d003d912087974e24160b68">MAX_SOCKET</a>);
<a name="l00761"></a>00761     <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;in_out&quot;</span>, socket_in_out_items, <a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>, <span class="stringliteral">&quot;Socket Side&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00762"></a>00762 }
<a name="l00763"></a>00763 
<a name="l00764"></a>00764 <span class="keyword">static</span> <span class="keywordtype">int</span> edit_node_invoke_properties(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00765"></a>00765 {
<a name="l00766"></a>00766     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;node&quot;</span>)) {
<a name="l00767"></a>00767         <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node= <a class="code" href="../../df/d01/BKE__context_8h.html#a67398d15e34f7a4b3c0b5eec1bf5fb94">CTX_data_pointer_get_type</a>(C, <span class="stringliteral">&quot;node&quot;</span>, &amp;RNA_Node).<a class="code" href="../../dd/d80/structPointerRNA.html#a18702e1d8f8c1a63389b3a322536e0e6">data</a>;
<a name="l00768"></a>00768         <span class="keywordflow">if</span> (!node)
<a name="l00769"></a>00769             <span class="keywordflow">return</span> 0;
<a name="l00770"></a>00770         <span class="keywordflow">else</span>
<a name="l00771"></a>00771             <a class="code" href="../../d3/d10/rna__access_8c.html#a229b9421e0a1d2e5fd079ec933a2d6f5">RNA_string_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;node&quot;</span>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a5d65cbe1159d2c591a3ba7815817b0c4">name</a>);
<a name="l00772"></a>00772     }
<a name="l00773"></a>00773     
<a name="l00774"></a>00774     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;in_out&quot;</span>))
<a name="l00775"></a>00775         <a class="code" href="../../d3/d10/rna__access_8c.html#ad70d450cec9fe951de69b8c9128b8cc4">RNA_enum_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;in_out&quot;</span>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>);
<a name="l00776"></a>00776     
<a name="l00777"></a>00777     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;socket&quot;</span>))
<a name="l00778"></a>00778         <a class="code" href="../../d3/d10/rna__access_8c.html#a55040b7e90ed07022f7a82575f3b3e1d">RNA_int_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;socket&quot;</span>, 0);
<a name="l00779"></a>00779     
<a name="l00780"></a>00780     <span class="keywordflow">return</span> 1;
<a name="l00781"></a>00781 }
<a name="l00782"></a>00782 
<a name="l00783"></a>00783 <span class="keyword">static</span> <span class="keywordtype">void</span> edit_node_properties_get(<a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> **rnode, <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> **rsock, <span class="keywordtype">int</span> *rin_out)
<a name="l00784"></a>00784 {
<a name="l00785"></a>00785     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00786"></a>00786     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00787"></a>00787     <span class="keywordtype">char</span> nodename[<a class="code" href="../../d1/db4/DNA__defs_8h.html#ac7c0207aa5a0e10d378be03b68041350">MAX_NAME</a>];
<a name="l00788"></a>00788     <span class="keywordtype">int</span> sockindex;
<a name="l00789"></a>00789     <span class="keywordtype">int</span> in_out;
<a name="l00790"></a>00790     
<a name="l00791"></a>00791     <a class="code" href="../../d3/d10/rna__access_8c.html#a810e909d61281bbb2d9fe99f9f2219ab">RNA_string_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;node&quot;</span>, nodename);
<a name="l00792"></a>00792     node = <a class="code" href="../../d4/d91/BKE__node_8h.html#a60b36f71b62212bef4196861570e5120">nodeFindNodebyName</a>(ntree, nodename);
<a name="l00793"></a>00793     
<a name="l00794"></a>00794     in_out = <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;in_out&quot;</span>);
<a name="l00795"></a>00795     
<a name="l00796"></a>00796     sockindex = <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;socket&quot;</span>);
<a name="l00797"></a>00797     <span class="keywordflow">switch</span> (in_out) {
<a name="l00798"></a>00798     <span class="keywordflow">case</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>:   sock = <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>, sockindex);  <span class="keywordflow">break</span>;
<a name="l00799"></a>00799     <span class="keywordflow">case</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#a3e72f128f404bd40757228c1c30edfb6">SOCK_OUT</a>:  sock = <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>, sockindex); <span class="keywordflow">break</span>;
<a name="l00800"></a>00800     }
<a name="l00801"></a>00801     
<a name="l00802"></a>00802     <span class="keywordflow">if</span> (rnode)
<a name="l00803"></a>00803         *rnode = node;
<a name="l00804"></a>00804     <span class="keywordflow">if</span> (rsock)
<a name="l00805"></a>00805         *rsock = sock;
<a name="l00806"></a>00806     <span class="keywordflow">if</span> (rin_out)
<a name="l00807"></a>00807         *rin_out = in_out;
<a name="l00808"></a>00808 }
<a name="l00809"></a>00809 <span class="preprocessor">#endif</span>
<a name="l00810"></a>00810 <span class="preprocessor"></span>
<a name="l00811"></a>00811 <span class="comment">/* ***************** Edit Group operator ************* */</span>
<a name="l00812"></a>00812 
<a name="l00813"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a2b7f4784efa4fc8b0f57cc908ffda6b6">00813</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a2b7f4784efa4fc8b0f57cc908ffda6b6">snode_make_group_editable</a>(<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *gnode)
<a name="l00814"></a>00814 {
<a name="l00815"></a>00815     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l00816"></a>00816     
<a name="l00817"></a>00817     <span class="comment">/* make sure nothing has group editing on */</span>
<a name="l00818"></a>00818     <span class="keywordflow">for</span> (node=snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l00819"></a>00819         <a class="code" href="../../d4/d91/BKE__node_8h.html#ac4c0ce40fc5796d932b182848b74f0e9">nodeGroupEditClear</a>(node);
<a name="l00820"></a>00820     
<a name="l00821"></a>00821     <span class="keywordflow">if</span> (gnode==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00822"></a>00822         <span class="comment">/* with NULL argument we do a toggle */</span>
<a name="l00823"></a>00823         <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>==snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>)
<a name="l00824"></a>00824             gnode= <a class="code" href="../../d4/d91/BKE__node_8h.html#a65bf254e8194856a100e3e88d96cf4fe">nodeGetActive</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>);
<a name="l00825"></a>00825     }
<a name="l00826"></a>00826     
<a name="l00827"></a>00827     <span class="keywordflow">if</span> (gnode) {
<a name="l00828"></a>00828         snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a> = <a class="code" href="../../d4/d91/BKE__node_8h.html#a6da6f9e1254e7d6521ead9176e21aca8">nodeGroupEditSet</a>(gnode, 1);
<a name="l00829"></a>00829         
<a name="l00830"></a>00830         <span class="comment">/* deselect all other nodes, so we can also do grabbing of entire subtree */</span>
<a name="l00831"></a>00831         <span class="keywordflow">for</span> (node= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l00832"></a>00832             <a class="code" href="../../d8/d8c/node__intern_8h.html#a16b0aa1538f66433d976e7b855a81cd0">node_deselect</a>(node);
<a name="l00833"></a>00833         <a class="code" href="../../d8/d8c/node__intern_8h.html#add2a37f4f9817568e6b324762705ae44">node_select</a>(gnode);
<a name="l00834"></a>00834     }
<a name="l00835"></a>00835     <span class="keywordflow">else</span> 
<a name="l00836"></a>00836         snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>;
<a name="l00837"></a>00837 }
<a name="l00838"></a>00838 
<a name="l00839"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a75df32562c5d78139cde6746fe68e32a">00839</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a75df32562c5d78139cde6746fe68e32a">node_group_edit_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l00840"></a>00840 {
<a name="l00841"></a>00841     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode = <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l00842"></a>00842 
<a name="l00843"></a>00843     <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l00844"></a>00844 
<a name="l00845"></a>00845     <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>==snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>) {
<a name="l00846"></a>00846         <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *gnode = <a class="code" href="../../d4/d91/BKE__node_8h.html#a65bf254e8194856a100e3e88d96cf4fe">nodeGetActive</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l00847"></a>00847         <a class="code" href="../../d1/d13/node__edit_8c.html#a2b7f4784efa4fc8b0f57cc908ffda6b6">snode_make_group_editable</a>(snode, gnode);
<a name="l00848"></a>00848     }
<a name="l00849"></a>00849     <span class="keywordflow">else</span>
<a name="l00850"></a>00850         <a class="code" href="../../d1/d13/node__edit_8c.html#a2b7f4784efa4fc8b0f57cc908ffda6b6">snode_make_group_editable</a>(snode, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00851"></a>00851 
<a name="l00852"></a>00852     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a61261a6b5ea948eee6d42c7e7ee18166">NC_SCENE</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a6cc4913036e9953f8c01c6630065fc2f">ND_NODES</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00853"></a>00853 
<a name="l00854"></a>00854     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00855"></a>00855 }
<a name="l00856"></a>00856 
<a name="l00857"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a3615a208ac505fa95b1c17d117470718">00857</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a3615a208ac505fa95b1c17d117470718">node_group_edit_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(event))
<a name="l00858"></a>00858 {
<a name="l00859"></a>00859     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode = <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l00860"></a>00860     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *gnode;
<a name="l00861"></a>00861     
<a name="l00862"></a>00862     <span class="comment">/* XXX callback? */</span>
<a name="l00863"></a>00863     <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>==snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>) {
<a name="l00864"></a>00864         gnode = <a class="code" href="../../d4/d91/BKE__node_8h.html#a65bf254e8194856a100e3e88d96cf4fe">nodeGetActive</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l00865"></a>00865         <span class="keywordflow">if</span> (gnode &amp;&amp; gnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a> &amp;&amp; <a class="code" href="../../db/ddc/icons_8c.html#adcd5f4a8d30b31ea3612fab180fa3338">GS</a>(gnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>)==<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6e5ed4060f73b0f46e66af2dbef9dd2a">ID_NT</a> &amp;&amp; gnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>) {
<a name="l00866"></a>00866             <a class="code" href="../../d8/d1e/UI__interface_8h.html#aa2b8edf3af47bf6ae30f4eee756f9246">uiPupMenuOkee</a>(C, op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a75c88e62b43b663e9a0cf6cfbede007c">type</a>-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a>, <span class="stringliteral">&quot;Make group local?&quot;</span>);
<a name="l00867"></a>00867             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00868"></a>00868         }
<a name="l00869"></a>00869     }
<a name="l00870"></a>00870 
<a name="l00871"></a>00871     <span class="keywordflow">return</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a75df32562c5d78139cde6746fe68e32a">node_group_edit_exec</a>(C, op);
<a name="l00872"></a>00872 }
<a name="l00873"></a>00873 
<a name="l00874"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#abe3c0cc1bd05784856568f253d9570f4">00874</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#afc5cedbf56bbfd1b6ae19e3ca55b63fc">NODE_OT_group_edit</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00875"></a>00875 {
<a name="l00876"></a>00876     <span class="comment">/* identifiers */</span>
<a name="l00877"></a>00877     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Edit Group&quot;</span>;
<a name="l00878"></a>00878     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Edit node group&quot;</span>;
<a name="l00879"></a>00879     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_group_edit&quot;</span>;
<a name="l00880"></a>00880     
<a name="l00881"></a>00881     <span class="comment">/* api callbacks */</span>
<a name="l00882"></a>00882     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a3615a208ac505fa95b1c17d117470718">node_group_edit_invoke</a>;
<a name="l00883"></a>00883     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a75df32562c5d78139cde6746fe68e32a">node_group_edit_exec</a>;
<a name="l00884"></a>00884     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l00885"></a>00885     
<a name="l00886"></a>00886     <span class="comment">/* flags */</span>
<a name="l00887"></a>00887     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00888"></a>00888 }
<a name="l00889"></a>00889 
<a name="l00890"></a>00890 <span class="comment">/* ***************** Add Group Socket operator ************* */</span>
<a name="l00891"></a>00891 
<a name="l00892"></a><a class="code" href="../../d1/d13/node__edit_8c.html#addf058f14fb7cb0c2317a8cf3ad87ee3">00892</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#addf058f14fb7cb0c2317a8cf3ad87ee3">node_group_socket_add_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00893"></a>00893 {
<a name="l00894"></a>00894     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode = <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l00895"></a>00895     <span class="keywordtype">int</span> in_out= -1;
<a name="l00896"></a>00896     <span class="keywordtype">char</span> name[<a class="code" href="../../d1/db4/DNA__defs_8h.html#ac7c0207aa5a0e10d378be03b68041350">MAX_NAME</a>]= <span class="stringliteral">&quot;&quot;</span>;
<a name="l00897"></a>00897     <span class="keywordtype">int</span> type= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a8e6e748887f7b8c2fa267b03e905d417">SOCK_FLOAT</a>;
<a name="l00898"></a>00898     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ngroup= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>;
<a name="l00899"></a>00899     <span class="comment">/* bNodeSocket *sock; */</span> <span class="comment">/* UNUSED */</span>
<a name="l00900"></a>00900     
<a name="l00901"></a>00901     <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l00902"></a>00902     
<a name="l00903"></a>00903     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;name&quot;</span>))
<a name="l00904"></a>00904         <a class="code" href="../../d3/d10/rna__access_8c.html#a810e909d61281bbb2d9fe99f9f2219ab">RNA_string_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;name&quot;</span>, name);
<a name="l00905"></a>00905     
<a name="l00906"></a>00906     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;type&quot;</span>))
<a name="l00907"></a>00907         type = <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;type&quot;</span>);
<a name="l00908"></a>00908     
<a name="l00909"></a>00909     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;in_out&quot;</span>))
<a name="l00910"></a>00910         in_out = <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;in_out&quot;</span>);
<a name="l00911"></a>00911     <span class="keywordflow">else</span>
<a name="l00912"></a>00912         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00913"></a>00913     
<a name="l00914"></a>00914     <span class="comment">/* using placeholder subtype first */</span>
<a name="l00915"></a>00915     <span class="comment">/* sock = */</span> <span class="comment">/* UNUSED */</span> <a class="code" href="../../d4/d91/BKE__node_8h.html#aed508f9b3d8087bfcc53ea45335da29e">node_group_add_socket</a>(ngroup, name, type, in_out);
<a name="l00916"></a>00916     
<a name="l00917"></a>00917     <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(ngroup);
<a name="l00918"></a>00918     
<a name="l00919"></a>00919     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l00920"></a>00920     
<a name="l00921"></a>00921     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00922"></a>00922 }
<a name="l00923"></a>00923 
<a name="l00924"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#ae28422099660a704bc3d0b6e31991563">00924</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a179987c704fdb7fca562cbd6569c689b">NODE_OT_group_socket_add</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00925"></a>00925 {
<a name="l00926"></a>00926     <span class="comment">/* identifiers */</span>
<a name="l00927"></a>00927     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add Group Socket&quot;</span>;
<a name="l00928"></a>00928     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Add node group socket&quot;</span>;
<a name="l00929"></a>00929     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_group_socket_add&quot;</span>;
<a name="l00930"></a>00930     
<a name="l00931"></a>00931     <span class="comment">/* api callbacks */</span>
<a name="l00932"></a>00932     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#addf058f14fb7cb0c2317a8cf3ad87ee3">node_group_socket_add_exec</a>;
<a name="l00933"></a>00933     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l00934"></a>00934     
<a name="l00935"></a>00935     <span class="comment">/* flags */</span>
<a name="l00936"></a>00936     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00937"></a>00937     
<a name="l00938"></a>00938     <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;in_out&quot;</span>, socket_in_out_items, <a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>, <span class="stringliteral">&quot;Socket Type&quot;</span>, <span class="stringliteral">&quot;Input or Output&quot;</span>);
<a name="l00939"></a>00939     <a class="code" href="../../dc/d7e/rna__define_8c.html#ac53a3ed18da454971065d5b4e4cb4d62">RNA_def_string</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../d1/db4/DNA__defs_8h.html#ac7c0207aa5a0e10d378be03b68041350">MAX_NAME</a>, <span class="stringliteral">&quot;Name&quot;</span>, <span class="stringliteral">&quot;Group socket name&quot;</span>);
<a name="l00940"></a>00940     <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;type&quot;</span>, <a class="code" href="../../d5/dff/rna__nodetree_8c.html#a7ec10c120d82d0ae25873a483e9530ff">node_socket_type_items</a>, <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a8e6e748887f7b8c2fa267b03e905d417">SOCK_FLOAT</a>, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;Type of the group socket&quot;</span>);
<a name="l00941"></a>00941 }
<a name="l00942"></a>00942 
<a name="l00943"></a>00943 <span class="comment">/* ***************** Remove Group Socket operator ************* */</span>
<a name="l00944"></a>00944 
<a name="l00945"></a><a class="code" href="../../d1/d13/node__edit_8c.html#ab0293adbbec48493538becc3570caeb2">00945</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ab0293adbbec48493538becc3570caeb2">node_group_socket_remove_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00946"></a>00946 {
<a name="l00947"></a>00947     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode = <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l00948"></a>00948     <span class="keywordtype">int</span> index= -1;
<a name="l00949"></a>00949     <span class="keywordtype">int</span> in_out= -1;
<a name="l00950"></a>00950     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ngroup= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>;
<a name="l00951"></a>00951     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l00952"></a>00952     
<a name="l00953"></a>00953     <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l00954"></a>00954     
<a name="l00955"></a>00955     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;index&quot;</span>))
<a name="l00956"></a>00956         index = <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;index&quot;</span>);
<a name="l00957"></a>00957     <span class="keywordflow">else</span>
<a name="l00958"></a>00958         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00959"></a>00959     
<a name="l00960"></a>00960     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;in_out&quot;</span>))
<a name="l00961"></a>00961         in_out = <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;in_out&quot;</span>);
<a name="l00962"></a>00962     <span class="keywordflow">else</span>
<a name="l00963"></a>00963         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l00964"></a>00964     
<a name="l00965"></a>00965     sock = (<a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a>*)<a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(in_out==<a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a> ? &amp;ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a> : &amp;ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>, index);
<a name="l00966"></a>00966     <span class="keywordflow">if</span> (sock) {
<a name="l00967"></a>00967         <a class="code" href="../../d4/d91/BKE__node_8h.html#a137eb9d5c558a90a87069e14e06d321c">node_group_remove_socket</a>(ngroup, sock, in_out);
<a name="l00968"></a>00968         <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(ngroup);
<a name="l00969"></a>00969         
<a name="l00970"></a>00970         <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l00971"></a>00971     }
<a name="l00972"></a>00972     
<a name="l00973"></a>00973     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l00974"></a>00974 }
<a name="l00975"></a>00975 
<a name="l00976"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a2703d56f26f60a1368171900f2f94229">00976</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#acd4c3785623e0f2b50506a3d37be810f">NODE_OT_group_socket_remove</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l00977"></a>00977 {
<a name="l00978"></a>00978     <span class="comment">/* identifiers */</span>
<a name="l00979"></a>00979     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Remove Group Socket&quot;</span>;
<a name="l00980"></a>00980     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Remove a node group socket&quot;</span>;
<a name="l00981"></a>00981     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_group_socket_remove&quot;</span>;
<a name="l00982"></a>00982     
<a name="l00983"></a>00983     <span class="comment">/* api callbacks */</span>
<a name="l00984"></a>00984     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#ab0293adbbec48493538becc3570caeb2">node_group_socket_remove_exec</a>;
<a name="l00985"></a>00985     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l00986"></a>00986     
<a name="l00987"></a>00987     <span class="comment">/* flags */</span>
<a name="l00988"></a>00988     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l00989"></a>00989     
<a name="l00990"></a>00990     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;index&quot;</span>, 0, 0, INT_MAX, <span class="stringliteral">&quot;Index&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 0, INT_MAX);
<a name="l00991"></a>00991     <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;in_out&quot;</span>, socket_in_out_items, <a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>, <span class="stringliteral">&quot;Socket Type&quot;</span>, <span class="stringliteral">&quot;Input or Output&quot;</span>);
<a name="l00992"></a>00992 }
<a name="l00993"></a>00993 
<a name="l00994"></a>00994 <span class="comment">/* ***************** Move Group Socket Up operator ************* */</span>
<a name="l00995"></a>00995 
<a name="l00996"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a9e3e3653310efd7cab95f70a6acf39a6">00996</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a9e3e3653310efd7cab95f70a6acf39a6">node_group_socket_move_up_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l00997"></a>00997 {
<a name="l00998"></a>00998     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode = <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l00999"></a>00999     <span class="keywordtype">int</span> index= -1;
<a name="l01000"></a>01000     <span class="keywordtype">int</span> in_out= -1;
<a name="l01001"></a>01001     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ngroup= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>;
<a name="l01002"></a>01002     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock, *prev;
<a name="l01003"></a>01003     
<a name="l01004"></a>01004     <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l01005"></a>01005     
<a name="l01006"></a>01006     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;index&quot;</span>))
<a name="l01007"></a>01007         index = <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;index&quot;</span>);
<a name="l01008"></a>01008     <span class="keywordflow">else</span>
<a name="l01009"></a>01009         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01010"></a>01010     
<a name="l01011"></a>01011     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;in_out&quot;</span>))
<a name="l01012"></a>01012         in_out = <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;in_out&quot;</span>);
<a name="l01013"></a>01013     <span class="keywordflow">else</span>
<a name="l01014"></a>01014         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01015"></a>01015     
<a name="l01016"></a>01016     <span class="comment">/* swap */</span>
<a name="l01017"></a>01017     <span class="keywordflow">if</span> (in_out==<a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>) {
<a name="l01018"></a>01018         sock = (<a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a>*)<a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>, index);
<a name="l01019"></a>01019         prev = sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a918812ad6e2578652718ce8e00483749">prev</a>;
<a name="l01020"></a>01020         <span class="comment">/* can&#39;t move up the first socket */</span>
<a name="l01021"></a>01021         <span class="keywordflow">if</span> (!prev)
<a name="l01022"></a>01022             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01023"></a>01023         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>, sock);
<a name="l01024"></a>01024         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a168dc4cffe5e3a86086f3cfc4f7b95e6">BLI_insertlinkbefore</a>(&amp;ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>, prev, sock);
<a name="l01025"></a>01025         
<a name="l01026"></a>01026         ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a8bfbcb433682227b3d2df7906b01bdec">NTREE_UPDATE_GROUP_IN</a>;
<a name="l01027"></a>01027     }
<a name="l01028"></a>01028     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (in_out==<a class="code" href="../../d4/d91/BKE__node_8h.html#a3e72f128f404bd40757228c1c30edfb6">SOCK_OUT</a>) {
<a name="l01029"></a>01029         sock = (<a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a>*)<a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>, index);
<a name="l01030"></a>01030         prev = sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a918812ad6e2578652718ce8e00483749">prev</a>;
<a name="l01031"></a>01031         <span class="comment">/* can&#39;t move up the first socket */</span>
<a name="l01032"></a>01032         <span class="keywordflow">if</span> (!prev)
<a name="l01033"></a>01033             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01034"></a>01034         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>, sock);
<a name="l01035"></a>01035         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a168dc4cffe5e3a86086f3cfc4f7b95e6">BLI_insertlinkbefore</a>(&amp;ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>, prev, sock);
<a name="l01036"></a>01036         
<a name="l01037"></a>01037         ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#acfca127cf8015189d938f38d18f6c8f0">NTREE_UPDATE_GROUP_OUT</a>;
<a name="l01038"></a>01038     }
<a name="l01039"></a>01039     <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(ngroup);
<a name="l01040"></a>01040     
<a name="l01041"></a>01041     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l01042"></a>01042     
<a name="l01043"></a>01043     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01044"></a>01044 }
<a name="l01045"></a>01045 
<a name="l01046"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a47fcf5f26f58433ba5f9908d0c2f7170">01046</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a2a60a01fed6582c264cab354ef7d4585">NODE_OT_group_socket_move_up</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01047"></a>01047 {
<a name="l01048"></a>01048     <span class="comment">/* identifiers */</span>
<a name="l01049"></a>01049     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Move Group Socket Up&quot;</span>;
<a name="l01050"></a>01050     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Move up node group socket&quot;</span>;
<a name="l01051"></a>01051     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_group_socket_move_up&quot;</span>;
<a name="l01052"></a>01052     
<a name="l01053"></a>01053     <span class="comment">/* api callbacks */</span>
<a name="l01054"></a>01054     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a9e3e3653310efd7cab95f70a6acf39a6">node_group_socket_move_up_exec</a>;
<a name="l01055"></a>01055     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l01056"></a>01056     
<a name="l01057"></a>01057     <span class="comment">/* flags */</span>
<a name="l01058"></a>01058     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01059"></a>01059     
<a name="l01060"></a>01060     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;index&quot;</span>, 0, 0, INT_MAX, <span class="stringliteral">&quot;Index&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 0, INT_MAX);
<a name="l01061"></a>01061     <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;in_out&quot;</span>, socket_in_out_items, <a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>, <span class="stringliteral">&quot;Socket Type&quot;</span>, <span class="stringliteral">&quot;Input or Output&quot;</span>);
<a name="l01062"></a>01062 }
<a name="l01063"></a>01063 
<a name="l01064"></a>01064 <span class="comment">/* ***************** Move Group Socket Up operator ************* */</span>
<a name="l01065"></a>01065 
<a name="l01066"></a><a class="code" href="../../d1/d13/node__edit_8c.html#af3b79ca57840b581e6fc7a24d9cfcaa6">01066</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#af3b79ca57840b581e6fc7a24d9cfcaa6">node_group_socket_move_down_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01067"></a>01067 {
<a name="l01068"></a>01068     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode = <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l01069"></a>01069     <span class="keywordtype">int</span> index= -1;
<a name="l01070"></a>01070     <span class="keywordtype">int</span> in_out= -1;
<a name="l01071"></a>01071     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ngroup= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>;
<a name="l01072"></a>01072     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l01073"></a>01073     
<a name="l01074"></a>01074     <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l01075"></a>01075     
<a name="l01076"></a>01076     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;index&quot;</span>))
<a name="l01077"></a>01077         index = <a class="code" href="../../d3/d10/rna__access_8c.html#a852d694fd9e9dbdc92b6a6608e3a73ef">RNA_int_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;index&quot;</span>);
<a name="l01078"></a>01078     <span class="keywordflow">else</span>
<a name="l01079"></a>01079         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01080"></a>01080     
<a name="l01081"></a>01081     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;in_out&quot;</span>))
<a name="l01082"></a>01082         in_out = <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;in_out&quot;</span>);
<a name="l01083"></a>01083     <span class="keywordflow">else</span>
<a name="l01084"></a>01084         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01085"></a>01085     
<a name="l01086"></a>01086     <span class="comment">/* swap */</span>
<a name="l01087"></a>01087     <span class="keywordflow">if</span> (in_out==<a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>) {
<a name="l01088"></a>01088         sock = (<a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a>*)<a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>, index);
<a name="l01089"></a>01089         next = sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>;
<a name="l01090"></a>01090         <span class="comment">/* can&#39;t move down the last socket */</span>
<a name="l01091"></a>01091         <span class="keywordflow">if</span> (!next)
<a name="l01092"></a>01092             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01093"></a>01093         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>, sock);
<a name="l01094"></a>01094         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a9c299678f8810312806da26e6132ccc7">BLI_insertlinkafter</a>(&amp;ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>, next, sock);
<a name="l01095"></a>01095         
<a name="l01096"></a>01096         ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a8bfbcb433682227b3d2df7906b01bdec">NTREE_UPDATE_GROUP_IN</a>;
<a name="l01097"></a>01097     }
<a name="l01098"></a>01098     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (in_out==<a class="code" href="../../d4/d91/BKE__node_8h.html#a3e72f128f404bd40757228c1c30edfb6">SOCK_OUT</a>) {
<a name="l01099"></a>01099         sock = (<a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a>*)<a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>, index);
<a name="l01100"></a>01100         next = sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>;
<a name="l01101"></a>01101         <span class="comment">/* can&#39;t move down the last socket */</span>
<a name="l01102"></a>01102         <span class="keywordflow">if</span> (!next)
<a name="l01103"></a>01103             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01104"></a>01104         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>, sock);
<a name="l01105"></a>01105         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a9c299678f8810312806da26e6132ccc7">BLI_insertlinkafter</a>(&amp;ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>, next, sock);
<a name="l01106"></a>01106         
<a name="l01107"></a>01107         ngroup-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#acfca127cf8015189d938f38d18f6c8f0">NTREE_UPDATE_GROUP_OUT</a>;
<a name="l01108"></a>01108     }
<a name="l01109"></a>01109     <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(ngroup);
<a name="l01110"></a>01110     
<a name="l01111"></a>01111     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l01112"></a>01112     
<a name="l01113"></a>01113     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01114"></a>01114 }
<a name="l01115"></a>01115 
<a name="l01116"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a7e4692c7e8e3d1f769b939e8077c2530">01116</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a081343b7947f81752ec1df180dcc04fc">NODE_OT_group_socket_move_down</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01117"></a>01117 {
<a name="l01118"></a>01118     <span class="comment">/* identifiers */</span>
<a name="l01119"></a>01119     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Move Group Socket Down&quot;</span>;
<a name="l01120"></a>01120     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Move down node group socket&quot;</span>;
<a name="l01121"></a>01121     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_group_socket_move_down&quot;</span>;
<a name="l01122"></a>01122     
<a name="l01123"></a>01123     <span class="comment">/* api callbacks */</span>
<a name="l01124"></a>01124     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#af3b79ca57840b581e6fc7a24d9cfcaa6">node_group_socket_move_down_exec</a>;
<a name="l01125"></a>01125     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l01126"></a>01126     
<a name="l01127"></a>01127     <span class="comment">/* flags */</span>
<a name="l01128"></a>01128     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01129"></a>01129     
<a name="l01130"></a>01130     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;index&quot;</span>, 0, 0, INT_MAX, <span class="stringliteral">&quot;Index&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 0, INT_MAX);
<a name="l01131"></a>01131     <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;in_out&quot;</span>, socket_in_out_items, <a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>, <span class="stringliteral">&quot;Socket Type&quot;</span>, <span class="stringliteral">&quot;Input or Output&quot;</span>);
<a name="l01132"></a>01132 }
<a name="l01133"></a>01133 
<a name="l01134"></a>01134 <span class="comment">/* ******************** Ungroup operator ********************** */</span>
<a name="l01135"></a>01135 
<a name="l01136"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a68fd0ef525d9571a61e02d3c1239d522">01136</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a68fd0ef525d9571a61e02d3c1239d522">node_group_ungroup_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01137"></a>01137 {
<a name="l01138"></a>01138     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode = <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l01139"></a>01139     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *gnode;
<a name="l01140"></a>01140 
<a name="l01141"></a>01141     <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l01142"></a>01142 
<a name="l01143"></a>01143     <span class="comment">/* are we inside of a group? */</span>
<a name="l01144"></a>01144     gnode= <a class="code" href="../../d1/d13/node__edit_8c.html#a3502c8be1cf3dd72e3cc366ae3bd91ef">node_tree_get_editgroup</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>);
<a name="l01145"></a>01145     <span class="keywordflow">if</span> (gnode)
<a name="l01146"></a>01146         <a class="code" href="../../d1/d13/node__edit_8c.html#a2b7f4784efa4fc8b0f57cc908ffda6b6">snode_make_group_editable</a>(snode, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01147"></a>01147     
<a name="l01148"></a>01148     gnode= <a class="code" href="../../d4/d91/BKE__node_8h.html#a65bf254e8194856a100e3e88d96cf4fe">nodeGetActive</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l01149"></a>01149     <span class="keywordflow">if</span> (gnode==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01150"></a>01150         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01151"></a>01151     
<a name="l01152"></a>01152     <span class="keywordflow">if</span> (gnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>!=<a class="code" href="../../d4/d91/BKE__node_8h.html#ab9f16ff5fded11f644b983a041c97edd">NODE_GROUP</a>) {
<a name="l01153"></a>01153         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68aa7428e90bb3916896145e5eb14a7dd7b">RPT_WARNING</a>, <span class="stringliteral">&quot;Not a group&quot;</span>);
<a name="l01154"></a>01154         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01155"></a>01155     }
<a name="l01156"></a>01156     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d91/BKE__node_8h.html#a285cfd568f4acbdc566d0597bdf5937a">node_group_ungroup</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, gnode)) {
<a name="l01157"></a>01157         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68aa7428e90bb3916896145e5eb14a7dd7b">RPT_WARNING</a>, <span class="stringliteral">&quot;Can&#39;t ungroup&quot;</span>);
<a name="l01158"></a>01158         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01159"></a>01159     }
<a name="l01160"></a>01160 
<a name="l01161"></a>01161     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l01162"></a>01162     <a class="code" href="../../d1/d13/node__edit_8c.html#addc9fdee9fc2340eedb472e61a7b9b18">snode_dag_update</a>(C, snode);
<a name="l01163"></a>01163 
<a name="l01164"></a>01164     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01165"></a>01165 }
<a name="l01166"></a>01166 
<a name="l01167"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a2deb3bb7bdeaeff177e3439c5b87a736">01167</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ac6d66fc743b1050dfddb638a376c5005">NODE_OT_group_ungroup</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01168"></a>01168 {
<a name="l01169"></a>01169     <span class="comment">/* identifiers */</span>
<a name="l01170"></a>01170     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Ungroup&quot;</span>;
<a name="l01171"></a>01171     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Ungroup selected nodes&quot;</span>;
<a name="l01172"></a>01172     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_group_ungroup&quot;</span>;
<a name="l01173"></a>01173     
<a name="l01174"></a>01174     <span class="comment">/* api callbacks */</span>
<a name="l01175"></a>01175     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a68fd0ef525d9571a61e02d3c1239d522">node_group_ungroup_exec</a>;
<a name="l01176"></a>01176     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l01177"></a>01177     
<a name="l01178"></a>01178     <span class="comment">/* flags */</span>
<a name="l01179"></a>01179     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01180"></a>01180 }
<a name="l01181"></a>01181 
<a name="l01182"></a>01182 <span class="comment">/* ************************** Node generic ************** */</span>
<a name="l01183"></a>01183 
<a name="l01184"></a>01184 <span class="comment">/* is rct in visible part of node? */</span>
<a name="l01185"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a1628c78068595e550aa3db9e4089c138">01185</a> <span class="keyword">static</span> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *<a class="code" href="../../d1/d13/node__edit_8c.html#a1628c78068595e550aa3db9e4089c138">visible_node</a>(<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode, <a class="code" href="../../da/d10/structrctf.html">rctf</a> *rct)
<a name="l01186"></a>01186 {
<a name="l01187"></a>01187     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01188"></a>01188     
<a name="l01189"></a>01189     <span class="keywordflow">for</span> (node=snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>; node; node=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a94bdf8dfba2cce2d62f1d6e4cd0ec81d">prev</a>) {
<a name="l01190"></a>01190         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d44/BLI__rect_8h.html#a0d49c0e9c2375707f05bbc7b00c857dd">BLI_isect_rctf</a>(&amp;node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>, rct, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
<a name="l01191"></a>01191             <span class="keywordflow">break</span>;
<a name="l01192"></a>01192     }
<a name="l01193"></a>01193     <span class="keywordflow">return</span> node;
<a name="l01194"></a>01194 }
<a name="l01195"></a>01195 
<a name="l01196"></a>01196 <span class="comment">/* **************************** */</span>
<a name="l01197"></a>01197 
<a name="l01198"></a><a class="code" href="../../d2/d8c/structNodeViewMove.html">01198</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d8c/structNodeViewMove.html">NodeViewMove</a> {
<a name="l01199"></a><a class="code" href="../../d2/d8c/structNodeViewMove.html#a1a8686a6d29621e8f61ecce672e781d2">01199</a>     <span class="keywordtype">int</span> <a class="code" href="../../d2/d8c/structNodeViewMove.html#a1a8686a6d29621e8f61ecce672e781d2">mvalo</a>[2];
<a name="l01200"></a><a class="code" href="../../d2/d8c/structNodeViewMove.html#a765fc6d97994b4b7ddbfd6fd98f9315f">01200</a>     <span class="keywordtype">int</span> <a class="code" href="../../d2/d8c/structNodeViewMove.html#ae6e866130d03cafb6ba60f5458932340">xmin</a>, <a class="code" href="../../d2/d8c/structNodeViewMove.html#a765fc6d97994b4b7ddbfd6fd98f9315f">ymin</a>, <a class="code" href="../../d2/d8c/structNodeViewMove.html#a5481bdf96922a82747ccd4d9c32a9397">xmax</a>, <a class="code" href="../../d2/d8c/structNodeViewMove.html#a0736c63feae2672b8a259b9c7f4006c8">ymax</a>;
<a name="l01201"></a>01201 } <a class="code" href="../../d1/d13/node__edit_8c.html#ae5ce03cda3bd472b593b8011ec32f1b0">NodeViewMove</a>;
<a name="l01202"></a>01202 
<a name="l01203"></a><a class="code" href="../../d1/d13/node__edit_8c.html#abda90ddc3c8b0e50eee2b53f1176176a">01203</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#abda90ddc3c8b0e50eee2b53f1176176a">snode_bg_viewmove_modal</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01204"></a>01204 {
<a name="l01205"></a>01205     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l01206"></a>01206     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar= <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01207"></a>01207     <a class="code" href="../../d2/d8c/structNodeViewMove.html">NodeViewMove</a> *nvm= op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l01208"></a>01208 
<a name="l01209"></a>01209     <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l01210"></a>01210         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>:
<a name="l01211"></a>01211             
<a name="l01212"></a>01212             snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ae0bd4f596cb3e076232df9bbcf89f7c7">xof</a> -= (nvm-&gt;<a class="code" href="../../d2/d8c/structNodeViewMove.html#a1a8686a6d29621e8f61ecce672e781d2">mvalo</a>[0]-<span class="keyword">event</span>-&gt;mval[0]);
<a name="l01213"></a>01213             snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#af387d4847424c597405c01a533954661">yof</a> -= (nvm-&gt;<a class="code" href="../../d2/d8c/structNodeViewMove.html#a1a8686a6d29621e8f61ecce672e781d2">mvalo</a>[1]-<span class="keyword">event</span>-&gt;mval[1]);
<a name="l01214"></a>01214             nvm-&gt;<a class="code" href="../../d2/d8c/structNodeViewMove.html#a1a8686a6d29621e8f61ecce672e781d2">mvalo</a>[0]= <span class="keyword">event</span>-&gt;mval[0];
<a name="l01215"></a>01215             nvm-&gt;<a class="code" href="../../d2/d8c/structNodeViewMove.html#a1a8686a6d29621e8f61ecce672e781d2">mvalo</a>[1]= <span class="keyword">event</span>-&gt;mval[1];
<a name="l01216"></a>01216             
<a name="l01217"></a>01217             <span class="comment">/* prevent dragging image outside of the window and losing it! */</span>
<a name="l01218"></a>01218             <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ae0bd4f596cb3e076232df9bbcf89f7c7">xof</a>, nvm-&gt;<a class="code" href="../../d2/d8c/structNodeViewMove.html#ae6e866130d03cafb6ba60f5458932340">xmin</a>, nvm-&gt;<a class="code" href="../../d2/d8c/structNodeViewMove.html#a5481bdf96922a82747ccd4d9c32a9397">xmax</a>);
<a name="l01219"></a>01219             <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#af387d4847424c597405c01a533954661">yof</a>, nvm-&gt;<a class="code" href="../../d2/d8c/structNodeViewMove.html#a765fc6d97994b4b7ddbfd6fd98f9315f">ymin</a>, nvm-&gt;<a class="code" href="../../d2/d8c/structNodeViewMove.html#a0736c63feae2672b8a259b9c7f4006c8">ymax</a>);
<a name="l01220"></a>01220             
<a name="l01221"></a>01221             <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(ar);
<a name="l01222"></a>01222             
<a name="l01223"></a>01223             <span class="keywordflow">break</span>;
<a name="l01224"></a>01224             
<a name="l01225"></a>01225         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>:
<a name="l01226"></a>01226         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>:
<a name="l01227"></a>01227         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#adc87b609a6285a24e23172a90734044c">RIGHTMOUSE</a>:
<a name="l01228"></a>01228             
<a name="l01229"></a>01229             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nvm);
<a name="l01230"></a>01230             op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01231"></a>01231 
<a name="l01232"></a>01232             <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#af1c384817f70d0a752fc68681535fcc9">NC_SPACE</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a3b819c24591049308491580db55063aa">ND_SPACE_NODE</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01233"></a>01233             
<a name="l01234"></a>01234             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01235"></a>01235     }
<a name="l01236"></a>01236     
<a name="l01237"></a>01237     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l01238"></a>01238 }
<a name="l01239"></a>01239 
<a name="l01240"></a><a class="code" href="../../d1/d13/node__edit_8c.html#ae97e1507024e5664bb9069f2e9f52f34">01240</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ae97e1507024e5664bb9069f2e9f52f34">snode_bg_viewmove_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01241"></a>01241 {
<a name="l01242"></a>01242     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar= <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01243"></a>01243     <a class="code" href="../../d2/d8c/structNodeViewMove.html">NodeViewMove</a> *nvm;
<a name="l01244"></a>01244     <a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *ima;
<a name="l01245"></a>01245     <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf;
<a name="l01246"></a>01246     <span class="keywordtype">int</span> pad= 10;
<a name="l01247"></a>01247     <span class="keywordtype">void</span> *lock;
<a name="l01248"></a>01248     
<a name="l01249"></a>01249     ima= <a class="code" href="../../d2/d77/BKE__image_8h.html#acadfd029703b4c5129e5e763506421a5">BKE_image_verify_viewer</a>(<a class="code" href="../../d2/d77/BKE__image_8h.html#a922dc453e6b157a2da1dc7ffb5fb19f6">IMA_TYPE_COMPOSITE</a>, <span class="stringliteral">&quot;Viewer Node&quot;</span>);
<a name="l01250"></a>01250     ibuf= <a class="code" href="../../d2/d77/BKE__image_8h.html#a2b04dffde4310589df05cf29db9d2ea4">BKE_image_acquire_ibuf</a>(ima, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;lock);
<a name="l01251"></a>01251     
<a name="l01252"></a>01252     <span class="keywordflow">if</span> (ibuf == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01253"></a>01253         <a class="code" href="../../d2/d77/BKE__image_8h.html#a9aa97df76020d8128b568780db6a0568">BKE_image_release_ibuf</a>(ima, lock);
<a name="l01254"></a>01254         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01255"></a>01255     }
<a name="l01256"></a>01256 
<a name="l01257"></a>01257     nvm= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d2/d8c/structNodeViewMove.html">NodeViewMove</a>), <span class="stringliteral">&quot;NodeViewMove struct&quot;</span>);
<a name="l01258"></a>01258     op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>= nvm;
<a name="l01259"></a>01259     nvm-&gt;<a class="code" href="../../d2/d8c/structNodeViewMove.html#a1a8686a6d29621e8f61ecce672e781d2">mvalo</a>[0]= <span class="keyword">event</span>-&gt;mval[0];
<a name="l01260"></a>01260     nvm-&gt;<a class="code" href="../../d2/d8c/structNodeViewMove.html#a1a8686a6d29621e8f61ecce672e781d2">mvalo</a>[1]= <span class="keyword">event</span>-&gt;mval[1];
<a name="l01261"></a>01261 
<a name="l01262"></a>01262     nvm-&gt;<a class="code" href="../../d2/d8c/structNodeViewMove.html#ae6e866130d03cafb6ba60f5458932340">xmin</a> = -(ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a32e37003215c0dc7f77e12e4fc9db3f4">winx</a>/2) - ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>/2 + pad;
<a name="l01263"></a>01263     nvm-&gt;<a class="code" href="../../d2/d8c/structNodeViewMove.html#a5481bdf96922a82747ccd4d9c32a9397">xmax</a> = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a32e37003215c0dc7f77e12e4fc9db3f4">winx</a>/2 + ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>/2 - pad;
<a name="l01264"></a>01264     nvm-&gt;<a class="code" href="../../d2/d8c/structNodeViewMove.html#a765fc6d97994b4b7ddbfd6fd98f9315f">ymin</a> = -(ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a908d20a23657ef143d2de1496be69f42">winy</a>/2) - ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>/2 + pad;
<a name="l01265"></a>01265     nvm-&gt;<a class="code" href="../../d2/d8c/structNodeViewMove.html#a0736c63feae2672b8a259b9c7f4006c8">ymax</a> = ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a908d20a23657ef143d2de1496be69f42">winy</a>/2 + ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>/2 - pad;
<a name="l01266"></a>01266 
<a name="l01267"></a>01267     <a class="code" href="../../d2/d77/BKE__image_8h.html#a9aa97df76020d8128b568780db6a0568">BKE_image_release_ibuf</a>(ima, lock);
<a name="l01268"></a>01268     
<a name="l01269"></a>01269     <span class="comment">/* add modal handler */</span>
<a name="l01270"></a>01270     <a class="code" href="../../df/db0/wm__event__system_8c.html#ab89ad80681bbec4a06930903ea043251">WM_event_add_modal_handler</a>(C, op);
<a name="l01271"></a>01271     
<a name="l01272"></a>01272     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l01273"></a>01273 }
<a name="l01274"></a>01274 
<a name="l01275"></a><a class="code" href="../../d1/d13/node__edit_8c.html#aa3db353d42f56058369532e1d89b9468">01275</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#aa3db353d42f56058369532e1d89b9468">snode_bg_viewmove_cancel</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(C), <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01276"></a>01276 {
<a name="l01277"></a>01277     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>);
<a name="l01278"></a>01278     op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01279"></a>01279 
<a name="l01280"></a>01280     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01281"></a>01281 }
<a name="l01282"></a>01282 
<a name="l01283"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a4ee01b8673d2413a7cae687e767ece1a">01283</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a643e3e3b89a748d1f4e334a0d71e3531">NODE_OT_backimage_move</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01284"></a>01284 {
<a name="l01285"></a>01285     <span class="comment">/* identifiers */</span>
<a name="l01286"></a>01286     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Background Image Move&quot;</span>;
<a name="l01287"></a>01287     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Move Node backdrop&quot;</span>;
<a name="l01288"></a>01288     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_backimage_move&quot;</span>;
<a name="l01289"></a>01289     
<a name="l01290"></a>01290     <span class="comment">/* api callbacks */</span>
<a name="l01291"></a>01291     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#ae97e1507024e5664bb9069f2e9f52f34">snode_bg_viewmove_invoke</a>;
<a name="l01292"></a>01292     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#abda90ddc3c8b0e50eee2b53f1176176a">snode_bg_viewmove_modal</a>;
<a name="l01293"></a>01293     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a6ccb546628222c2bc2e034b9352a52d1">composite_node_active</a>;
<a name="l01294"></a>01294     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#aa3db353d42f56058369532e1d89b9468">snode_bg_viewmove_cancel</a>;
<a name="l01295"></a>01295     
<a name="l01296"></a>01296     <span class="comment">/* flags */</span>
<a name="l01297"></a>01297     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#a2458c730dbcabf67cc8917d8de127bab">OPTYPE_BLOCKING</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#ac9470de8419174a032e9097a5ec317fd">OPTYPE_GRAB_POINTER</a>;
<a name="l01298"></a>01298 }
<a name="l01299"></a>01299 
<a name="l01300"></a><a class="code" href="../../d1/d13/node__edit_8c.html#ac3cf4cda2ba9ddf06455b38efa4c2c85">01300</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ac3cf4cda2ba9ddf06455b38efa4c2c85">backimage_zoom</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01301"></a>01301 {
<a name="l01302"></a>01302     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l01303"></a>01303     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar= <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01304"></a>01304     <span class="keywordtype">float</span> fac= <a class="code" href="../../d3/d10/rna__access_8c.html#a99bfb3295a4df6fef29f16924fd24c79">RNA_float_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;factor&quot;</span>);
<a name="l01305"></a>01305 
<a name="l01306"></a>01306     snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ab6d4bf7c83bce9b79665fe5835605600">zoom</a> *= fac;
<a name="l01307"></a>01307     <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(ar);
<a name="l01308"></a>01308 
<a name="l01309"></a>01309     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01310"></a>01310 }
<a name="l01311"></a>01311 
<a name="l01312"></a>01312 
<a name="l01313"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a86df7ba2c4299238e13c30b4d00aff79">01313</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a8caca4cc58e19f6581e2ff333e08ff4d">NODE_OT_backimage_zoom</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01314"></a>01314 {
<a name="l01315"></a>01315     
<a name="l01316"></a>01316     <span class="comment">/* identifiers */</span>
<a name="l01317"></a>01317     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Background Image Zoom&quot;</span>;
<a name="l01318"></a>01318     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_backimage_zoom&quot;</span>;
<a name="l01319"></a>01319     
<a name="l01320"></a>01320     <span class="comment">/* api callbacks */</span>
<a name="l01321"></a>01321     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#ac3cf4cda2ba9ddf06455b38efa4c2c85">backimage_zoom</a>;
<a name="l01322"></a>01322     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a6ccb546628222c2bc2e034b9352a52d1">composite_node_active</a>;
<a name="l01323"></a>01323     
<a name="l01324"></a>01324     <span class="comment">/* flags */</span>
<a name="l01325"></a>01325     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#a2458c730dbcabf67cc8917d8de127bab">OPTYPE_BLOCKING</a>;
<a name="l01326"></a>01326 
<a name="l01327"></a>01327     <span class="comment">/* internal */</span>
<a name="l01328"></a>01328     <a class="code" href="../../dc/d7e/rna__define_8c.html#a040f4b08fc87a45a90e2291382e27f75">RNA_def_float</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;factor&quot;</span>, 1.2f, 0.0f, 10.0f, <span class="stringliteral">&quot;Factor&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 0.0f, 10.0f);
<a name="l01329"></a>01329 }
<a name="l01330"></a>01330 
<a name="l01331"></a>01331 <span class="comment">/******************** sample backdrop operator ********************/</span>
<a name="l01332"></a>01332 
<a name="l01333"></a>01333 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d11/structImageSampleInfo.html">ImageSampleInfo</a> {
<a name="l01334"></a>01334     <a class="code" href="../../d7/da9/structARegionType.html">ARegionType</a> *<a class="code" href="../../d9/d11/structImageSampleInfo.html#a26e1be1e663e4b986c76f140e5901c93">art</a>;
<a name="l01335"></a>01335     <span class="keywordtype">void</span> *<a class="code" href="../../d9/d11/structImageSampleInfo.html#a0f6533be826f1998c9be6121f80fd555">draw_handle</a>;
<a name="l01336"></a>01336     <span class="keywordtype">int</span> <a class="code" href="../../d9/d11/structImageSampleInfo.html#aa61d0608e6ca5be1399278b5188b78ca">x</a>, <a class="code" href="../../d9/d11/structImageSampleInfo.html#ae509c7aff6dd6a6574a9d3b97e8d67e7">y</a>;
<a name="l01337"></a>01337     <span class="keywordtype">int</span> <a class="code" href="../../d9/d11/structImageSampleInfo.html#a4297cd8461cde7e44cadbc39e305cf41">channels</a>;
<a name="l01338"></a><a class="code" href="../../d9/d11/structImageSampleInfo.html#a7f8df6ada65653ca8aebd56324ebb737">01338</a>     <span class="keywordtype">int</span> <a class="code" href="../../d9/d11/structImageSampleInfo.html#a7f8df6ada65653ca8aebd56324ebb737">color_manage</a>;
<a name="l01339"></a>01339 
<a name="l01340"></a>01340     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="../../d9/d11/structImageSampleInfo.html#ae5640f3b30574d56be157e71f930dfe2">col</a>[4];
<a name="l01341"></a>01341     <span class="keywordtype">float</span> <a class="code" href="../../d9/d11/structImageSampleInfo.html#aba39a3509f65986578e10ec9e199f6a1">colf</a>[4];
<a name="l01342"></a>01342 
<a name="l01343"></a>01343     <span class="keywordtype">int</span> <a class="code" href="../../d9/d11/structImageSampleInfo.html#ab7ccbe3ba05d8bbdc3087b343f2f9586">draw</a>;
<a name="l01344"></a>01344 } <a class="code" href="../../d6/d1f/image__ops_8c.html#af80f994fefa12f870b3bd4500343db27">ImageSampleInfo</a>;
<a name="l01345"></a>01345 
<a name="l01346"></a><a class="code" href="../../d1/d13/node__edit_8c.html#ab627acc0ada816964ee7a85483dc1451">01346</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ab627acc0ada816964ee7a85483dc1451">sample_draw</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar, <span class="keywordtype">void</span> *arg_info)
<a name="l01347"></a>01347 {
<a name="l01348"></a>01348     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l01349"></a>01349     <a class="code" href="../../d9/d11/structImageSampleInfo.html">ImageSampleInfo</a> *info= arg_info;
<a name="l01350"></a>01350 
<a name="l01351"></a>01351     <a class="code" href="../../de/d53/ED__image_8h.html#a7139dbf7af29cfb54d48d4204e9737c0">ED_image_draw_info</a>(ar, (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aa9a0521ac4e22707d09ddeac4bf104b2">color_mgt_flag</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#aea9753cc8aec8bc51c69f789cd188848">R_COLOR_MANAGEMENT</a>), info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#a4297cd8461cde7e44cadbc39e305cf41">channels</a>,
<a name="l01352"></a>01352                        info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#aa61d0608e6ca5be1399278b5188b78ca">x</a>, info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#ae509c7aff6dd6a6574a9d3b97e8d67e7">y</a>, info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#ae5640f3b30574d56be157e71f930dfe2">col</a>, info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#aba39a3509f65986578e10ec9e199f6a1">colf</a>,
<a name="l01353"></a>01353                        <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> <span class="comment">/* zbuf - unused for nodes */</span>
<a name="l01354"></a>01354                        );
<a name="l01355"></a>01355 }
<a name="l01356"></a>01356 
<a name="l01357"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a866973997f13b652cffe45388a74551e">01357</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a866973997f13b652cffe45388a74551e">sample_apply</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01358"></a>01358 {
<a name="l01359"></a>01359     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l01360"></a>01360     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar= <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01361"></a>01361     <a class="code" href="../../d9/d11/structImageSampleInfo.html">ImageSampleInfo</a> *info= op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l01362"></a>01362     <span class="keywordtype">void</span> *lock;
<a name="l01363"></a>01363     <a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *ima;
<a name="l01364"></a>01364     <a class="code" href="../../d3/dd9/structImBuf.html">ImBuf</a> *ibuf;
<a name="l01365"></a>01365     <span class="keywordtype">float</span> fx, fy, bufx, bufy;
<a name="l01366"></a>01366     
<a name="l01367"></a>01367     ima= <a class="code" href="../../d2/d77/BKE__image_8h.html#acadfd029703b4c5129e5e763506421a5">BKE_image_verify_viewer</a>(<a class="code" href="../../d2/d77/BKE__image_8h.html#a922dc453e6b157a2da1dc7ffb5fb19f6">IMA_TYPE_COMPOSITE</a>, <span class="stringliteral">&quot;Viewer Node&quot;</span>);
<a name="l01368"></a>01368     ibuf= <a class="code" href="../../d2/d77/BKE__image_8h.html#a2b04dffde4310589df05cf29db9d2ea4">BKE_image_acquire_ibuf</a>(ima, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;lock);
<a name="l01369"></a>01369     <span class="keywordflow">if</span> (!ibuf)
<a name="l01370"></a>01370         <span class="keywordflow">return</span>;
<a name="l01371"></a>01371     
<a name="l01372"></a>01372     <span class="keywordflow">if</span> (!ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>) {
<a name="l01373"></a>01373         <span class="keywordflow">if</span> (info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#a7f8df6ada65653ca8aebd56324ebb737">color_manage</a>)
<a name="l01374"></a>01374             ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a0aa104fffb1090d64f06da549681e81c">profile</a> = <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#ac9d7d77e52c7153b987c86cccfb8ad4c">IB_PROFILE_LINEAR_RGB</a>;
<a name="l01375"></a>01375         <span class="keywordflow">else</span>
<a name="l01376"></a>01376             ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a0aa104fffb1090d64f06da549681e81c">profile</a> = <a class="code" href="../../d7/dc9/IMB__imbuf__types_8h.html#a5a4ca931467afcec1f255cd469ec5433">IB_PROFILE_NONE</a>;
<a name="l01377"></a>01377         <a class="code" href="../../db/d49/IMB__imbuf_8h.html#a3af34b4b5c6b91ddf5b872fcb9e2d66c">IMB_rect_from_float</a>(ibuf);
<a name="l01378"></a>01378     }
<a name="l01379"></a>01379 
<a name="l01380"></a>01380     <span class="comment">/* map the mouse coords to the backdrop image space */</span>
<a name="l01381"></a>01381     bufx = ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> * snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ab6d4bf7c83bce9b79665fe5835605600">zoom</a>;
<a name="l01382"></a>01382     bufy = ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a> * snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ab6d4bf7c83bce9b79665fe5835605600">zoom</a>;
<a name="l01383"></a>01383     fx = (bufx &gt; 0.0f ? ((float)event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[0] - 0.5f*ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a32e37003215c0dc7f77e12e4fc9db3f4">winx</a> - snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ae0bd4f596cb3e076232df9bbcf89f7c7">xof</a>) / bufx + 0.5f : 0.0f);
<a name="l01384"></a>01384     fy = (bufy &gt; 0.0f ? ((float)event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[1] - 0.5f*ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a908d20a23657ef143d2de1496be69f42">winy</a> - snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#af387d4847424c597405c01a533954661">yof</a>) / bufy + 0.5f : 0.0f);
<a name="l01385"></a>01385 
<a name="l01386"></a>01386     <span class="keywordflow">if</span> (fx&gt;=0.0f &amp;&amp; fy&gt;=0.0f &amp;&amp; fx&lt;1.0f &amp;&amp; fy&lt;1.0f) {
<a name="l01387"></a>01387         <span class="keywordtype">float</span> *fp;
<a name="l01388"></a>01388         <span class="keywordtype">char</span> *cp;
<a name="l01389"></a>01389         <span class="keywordtype">int</span> x= (int)(fx*ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>), y= (int)(fy*ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>);
<a name="l01390"></a>01390 
<a name="l01391"></a>01391         <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(x, 0, ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a>-1);
<a name="l01392"></a>01392         <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(y, 0, ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a9b88fc1c373dd2aa0d4c174c87913050">y</a>-1);
<a name="l01393"></a>01393 
<a name="l01394"></a>01394         info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#aa61d0608e6ca5be1399278b5188b78ca">x</a>= x;
<a name="l01395"></a>01395         info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#ae509c7aff6dd6a6574a9d3b97e8d67e7">y</a>= y;
<a name="l01396"></a>01396         info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#ab7ccbe3ba05d8bbdc3087b343f2f9586">draw</a>= 1;
<a name="l01397"></a>01397         info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#a4297cd8461cde7e44cadbc39e305cf41">channels</a>= ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a6be7accc39275e1b7c48794361e024dc">channels</a>;
<a name="l01398"></a>01398 
<a name="l01399"></a>01399         <span class="keywordflow">if</span> (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a>) {
<a name="l01400"></a>01400             cp= (<span class="keywordtype">char</span> *)(ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ade8b2f05559e57840af8d3657817f8c8">rect</a> + y*ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> + x);
<a name="l01401"></a>01401 
<a name="l01402"></a>01402             info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#ae5640f3b30574d56be157e71f930dfe2">col</a>[0]= cp[0];
<a name="l01403"></a>01403             info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#ae5640f3b30574d56be157e71f930dfe2">col</a>[1]= cp[1];
<a name="l01404"></a>01404             info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#ae5640f3b30574d56be157e71f930dfe2">col</a>[2]= cp[2];
<a name="l01405"></a>01405             info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#ae5640f3b30574d56be157e71f930dfe2">col</a>[3]= cp[3];
<a name="l01406"></a>01406 
<a name="l01407"></a>01407             info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#aba39a3509f65986578e10ec9e199f6a1">colf</a>[0]= (float)cp[0]/255.0f;
<a name="l01408"></a>01408             info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#aba39a3509f65986578e10ec9e199f6a1">colf</a>[1]= (float)cp[1]/255.0f;
<a name="l01409"></a>01409             info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#aba39a3509f65986578e10ec9e199f6a1">colf</a>[2]= (float)cp[2]/255.0f;
<a name="l01410"></a>01410             info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#aba39a3509f65986578e10ec9e199f6a1">colf</a>[3]= (float)cp[3]/255.0f;
<a name="l01411"></a>01411         }
<a name="l01412"></a>01412         <span class="keywordflow">if</span> (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a>) {
<a name="l01413"></a>01413             fp= (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a45bb91c70233262497998fcada3b752e">rect_float</a> + (ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#a6be7accc39275e1b7c48794361e024dc">channels</a>)*(y*ibuf-&gt;<a class="code" href="../../d3/dd9/structImBuf.html#ae7734bc51f5e3e75be66e6f6a26f4f4e">x</a> + x));
<a name="l01414"></a>01414 
<a name="l01415"></a>01415             info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#aba39a3509f65986578e10ec9e199f6a1">colf</a>[0]= fp[0];
<a name="l01416"></a>01416             info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#aba39a3509f65986578e10ec9e199f6a1">colf</a>[1]= fp[1];
<a name="l01417"></a>01417             info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#aba39a3509f65986578e10ec9e199f6a1">colf</a>[2]= fp[2];
<a name="l01418"></a>01418             info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#aba39a3509f65986578e10ec9e199f6a1">colf</a>[3]= fp[3];
<a name="l01419"></a>01419         }
<a name="l01420"></a>01420     }
<a name="l01421"></a>01421     <span class="keywordflow">else</span>
<a name="l01422"></a>01422         info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#ab7ccbe3ba05d8bbdc3087b343f2f9586">draw</a>= 0;
<a name="l01423"></a>01423 
<a name="l01424"></a>01424     <a class="code" href="../../d2/d77/BKE__image_8h.html#a9aa97df76020d8128b568780db6a0568">BKE_image_release_ibuf</a>(ima, lock);
<a name="l01425"></a>01425     
<a name="l01426"></a>01426     <a class="code" href="../../d1/d12/ED__screen_8h.html#a0982c011d985308b08320d5f9604418b">ED_area_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C));
<a name="l01427"></a>01427 }
<a name="l01428"></a>01428 
<a name="l01429"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a526919c20e16a39ace37afc3aedeeb2d">01429</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a526919c20e16a39ace37afc3aedeeb2d">sample_exit</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01430"></a>01430 {
<a name="l01431"></a>01431     <a class="code" href="../../d9/d11/structImageSampleInfo.html">ImageSampleInfo</a> *info= op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l01432"></a>01432 
<a name="l01433"></a>01433     <a class="code" href="../../d0/d5f/ED__space__api_8h.html#af2341642ec2a46070cd7b0be6a6e716a">ED_region_draw_cb_exit</a>(info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#a26e1be1e663e4b986c76f140e5901c93">art</a>, info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#a0f6533be826f1998c9be6121f80fd555">draw_handle</a>);
<a name="l01434"></a>01434     <a class="code" href="../../d1/d12/ED__screen_8h.html#a0982c011d985308b08320d5f9604418b">ED_area_tag_redraw</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C));
<a name="l01435"></a>01435     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(info);
<a name="l01436"></a>01436 }
<a name="l01437"></a>01437 
<a name="l01438"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a1557cc85ecc4c1b1a85f95e45a74328f">01438</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a1557cc85ecc4c1b1a85f95e45a74328f">sample_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01439"></a>01439 {
<a name="l01440"></a>01440     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l01441"></a>01441     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar= <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01442"></a>01442     <a class="code" href="../../d9/d11/structImageSampleInfo.html">ImageSampleInfo</a> *info;
<a name="l01443"></a>01443 
<a name="l01444"></a>01444     <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#acc2e52658693034e5b1f8ea667163749">treetype</a>!=<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a> || !(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#aa55137a8b32e24fb7e81da012b717df3">flag</a> &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a603f10d972b3e2af65f878542fdb2da5">SNODE_BACKDRAW</a>))
<a name="l01445"></a>01445         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01446"></a>01446     
<a name="l01447"></a>01447     info= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d11/structImageSampleInfo.html">ImageSampleInfo</a>), <span class="stringliteral">&quot;ImageSampleInfo&quot;</span>);
<a name="l01448"></a>01448     info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#a26e1be1e663e4b986c76f140e5901c93">art</a>= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ae957cd551d82034b24008cfb99bbc4c7">type</a>;
<a name="l01449"></a>01449     info-&gt;<a class="code" href="../../d9/d11/structImageSampleInfo.html#a0f6533be826f1998c9be6121f80fd555">draw_handle</a> = <a class="code" href="../../d0/d5f/ED__space__api_8h.html#a48864a13f19218cbd1ff98b7fe9eb958">ED_region_draw_cb_activate</a>(ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ae957cd551d82034b24008cfb99bbc4c7">type</a>, <a class="code" href="../../d1/d13/node__edit_8c.html#ab627acc0ada816964ee7a85483dc1451">sample_draw</a>, info, <a class="code" href="../../d0/d5f/ED__space__api_8h.html#aabcb5bd755a601a5c2d662858b74505b">REGION_DRAW_POST_PIXEL</a>);
<a name="l01450"></a>01450     op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>= info;
<a name="l01451"></a>01451 
<a name="l01452"></a>01452     <a class="code" href="../../d1/d13/node__edit_8c.html#a866973997f13b652cffe45388a74551e">sample_apply</a>(C, op, event);
<a name="l01453"></a>01453 
<a name="l01454"></a>01454     <a class="code" href="../../df/db0/wm__event__system_8c.html#ab89ad80681bbec4a06930903ea043251">WM_event_add_modal_handler</a>(C, op);
<a name="l01455"></a>01455 
<a name="l01456"></a>01456     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l01457"></a>01457 }
<a name="l01458"></a>01458 
<a name="l01459"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a1dec8cbd786aa7249ac4919b2669c4c2">01459</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a1dec8cbd786aa7249ac4919b2669c4c2">sample_modal</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01460"></a>01460 {
<a name="l01461"></a>01461     <span class="keywordflow">switch</span>(event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l01462"></a>01462         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>:
<a name="l01463"></a>01463         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#adc87b609a6285a24e23172a90734044c">RIGHTMOUSE</a>: <span class="comment">// XXX hardcoded</span>
<a name="l01464"></a>01464             <a class="code" href="../../d1/d13/node__edit_8c.html#a526919c20e16a39ace37afc3aedeeb2d">sample_exit</a>(C, op);
<a name="l01465"></a>01465             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01466"></a>01466         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>:
<a name="l01467"></a>01467             <a class="code" href="../../d1/d13/node__edit_8c.html#a866973997f13b652cffe45388a74551e">sample_apply</a>(C, op, event);
<a name="l01468"></a>01468             <span class="keywordflow">break</span>;
<a name="l01469"></a>01469     }
<a name="l01470"></a>01470 
<a name="l01471"></a>01471     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l01472"></a>01472 }
<a name="l01473"></a>01473 
<a name="l01474"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a973e86fc00f00782dc53a114fd1e0176">01474</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a973e86fc00f00782dc53a114fd1e0176">sample_cancel</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01475"></a>01475 {
<a name="l01476"></a>01476     <a class="code" href="../../d1/d13/node__edit_8c.html#a526919c20e16a39ace37afc3aedeeb2d">sample_exit</a>(C, op);
<a name="l01477"></a>01477     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01478"></a>01478 }
<a name="l01479"></a>01479 
<a name="l01480"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a86cc0b538905d563c276717f0f488bf0">01480</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a86cc0b538905d563c276717f0f488bf0">NODE_OT_backimage_sample</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01481"></a>01481 {
<a name="l01482"></a>01482     <span class="comment">/* identifiers */</span>
<a name="l01483"></a>01483     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Backimage Sample&quot;</span>;
<a name="l01484"></a>01484     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_backimage_sample&quot;</span>;
<a name="l01485"></a>01485     
<a name="l01486"></a>01486     <span class="comment">/* api callbacks */</span>
<a name="l01487"></a>01487     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a1557cc85ecc4c1b1a85f95e45a74328f">sample_invoke</a>;
<a name="l01488"></a>01488     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a1dec8cbd786aa7249ac4919b2669c4c2">sample_modal</a>;
<a name="l01489"></a>01489     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a973e86fc00f00782dc53a114fd1e0176">sample_cancel</a>;
<a name="l01490"></a>01490     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l01491"></a>01491 
<a name="l01492"></a>01492     <span class="comment">/* flags */</span>
<a name="l01493"></a>01493     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#a2458c730dbcabf67cc8917d8de127bab">OPTYPE_BLOCKING</a>;
<a name="l01494"></a>01494 }
<a name="l01495"></a>01495 
<a name="l01496"></a>01496 <span class="comment">/* ********************** size widget operator ******************** */</span>
<a name="l01497"></a>01497 
<a name="l01498"></a><a class="code" href="../../df/d41/structNodeSizeWidget.html">01498</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../df/d41/structNodeSizeWidget.html">NodeSizeWidget</a> {
<a name="l01499"></a><a class="code" href="../../df/d41/structNodeSizeWidget.html#a38df11fa753d1162e81207f757cb84d9">01499</a>     <span class="keywordtype">float</span> <a class="code" href="../../df/d41/structNodeSizeWidget.html#ad93a1968dd9ac3fa93c44014427715e3">mxstart</a>, <a class="code" href="../../df/d41/structNodeSizeWidget.html#a38df11fa753d1162e81207f757cb84d9">mystart</a>;
<a name="l01500"></a><a class="code" href="../../df/d41/structNodeSizeWidget.html#ab40deb26278caccabf6ba6e8128a4a6c">01500</a>     <span class="keywordtype">float</span> <a class="code" href="../../df/d41/structNodeSizeWidget.html#ab40deb26278caccabf6ba6e8128a4a6c">oldwidth</a>, <a class="code" href="../../df/d41/structNodeSizeWidget.html#a47c70e33708e5823f7797f64456f2f54">oldheight</a>;
<a name="l01501"></a><a class="code" href="../../df/d41/structNodeSizeWidget.html#a8a35a676c264c82ac823d6229bd47f26">01501</a>     <span class="keywordtype">float</span> <a class="code" href="../../df/d41/structNodeSizeWidget.html#a8a35a676c264c82ac823d6229bd47f26">oldminiwidth</a>;
<a name="l01502"></a>01502 } <a class="code" href="../../d1/d13/node__edit_8c.html#a4442e93707c0f96d5432a89320515c7c">NodeSizeWidget</a>;
<a name="l01503"></a>01503 
<a name="l01504"></a><a class="code" href="../../d1/d13/node__edit_8c.html#aa714c9c9245de24e518ac36dd56b5bc7">01504</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#aa714c9c9245de24e518ac36dd56b5bc7">node_resize_modal</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01505"></a>01505 {
<a name="l01506"></a>01506     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l01507"></a>01507     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar= <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01508"></a>01508     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node= <a class="code" href="../../d1/d13/node__edit_8c.html#aab7cc4b56c93a885d8a9bf3a40f9c59c">editnode_get_active</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l01509"></a>01509     <a class="code" href="../../df/d41/structNodeSizeWidget.html">NodeSizeWidget</a> *nsw= op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l01510"></a>01510     <span class="keywordtype">float</span> mx, my;
<a name="l01511"></a>01511     
<a name="l01512"></a>01512     <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l01513"></a>01513         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>:
<a name="l01514"></a>01514             
<a name="l01515"></a>01515             <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[0], event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[1],
<a name="l01516"></a>01516                                      &amp;mx, &amp;my);
<a name="l01517"></a>01517             
<a name="l01518"></a>01518             <span class="keywordflow">if</span> (node) {
<a name="l01519"></a>01519                 <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a9514398b17ede671295e5c873e7bb3df">NODE_HIDDEN</a>) {
<a name="l01520"></a>01520                     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a45344c987d49653cfdedebb4c403a3f2">miniwidth</a>= nsw-&gt;<a class="code" href="../../df/d41/structNodeSizeWidget.html#a8a35a676c264c82ac823d6229bd47f26">oldminiwidth</a> + mx - nsw-&gt;<a class="code" href="../../df/d41/structNodeSizeWidget.html#ad93a1968dd9ac3fa93c44014427715e3">mxstart</a>;
<a name="l01521"></a>01521                     <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a45344c987d49653cfdedebb4c403a3f2">miniwidth</a>, 0.0f, 100.0f);
<a name="l01522"></a>01522                 }
<a name="l01523"></a>01523                 <span class="keywordflow">else</span> {
<a name="l01524"></a>01524                     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1f3be7314aef8500d0a879189ad97025">width</a>= nsw-&gt;<a class="code" href="../../df/d41/structNodeSizeWidget.html#ab40deb26278caccabf6ba6e8128a4a6c">oldwidth</a> + mx - nsw-&gt;<a class="code" href="../../df/d41/structNodeSizeWidget.html#ad93a1968dd9ac3fa93c44014427715e3">mxstart</a>;
<a name="l01525"></a>01525                     <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1f3be7314aef8500d0a879189ad97025">width</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a9325556134c3580294c6bbc2e05251b5">UI_DPI_FAC</a>*node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a17a19bf64a9af92a9dea9e3c1c49a5bb">minwidth</a>, <a class="code" href="../../d8/d1e/UI__interface_8h.html#a9325556134c3580294c6bbc2e05251b5">UI_DPI_FAC</a>*node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a3e874db2170ffa85faed857fbd0e9de1">maxwidth</a>);
<a name="l01526"></a>01526                 }
<a name="l01527"></a>01527                 <span class="comment">/* height works the other way round ... */</span>
<a name="l01528"></a>01528                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3892585203606fd3e3b0f448eb93c6a8">height</a>= nsw-&gt;<a class="code" href="../../df/d41/structNodeSizeWidget.html#a47c70e33708e5823f7797f64456f2f54">oldheight</a> - my + nsw-&gt;<a class="code" href="../../df/d41/structNodeSizeWidget.html#a38df11fa753d1162e81207f757cb84d9">mystart</a>;
<a name="l01529"></a>01529                 <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3892585203606fd3e3b0f448eb93c6a8">height</a>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ab64177c02d764173d8947e80ae1a3bd6">minheight</a>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ad65f56a9d654920824ac0535f72cc616">maxheight</a>);
<a name="l01530"></a>01530             }
<a name="l01531"></a>01531                 
<a name="l01532"></a>01532             <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(ar);
<a name="l01533"></a>01533 
<a name="l01534"></a>01534             <span class="keywordflow">break</span>;
<a name="l01535"></a>01535             
<a name="l01536"></a>01536         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>:
<a name="l01537"></a>01537         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>:
<a name="l01538"></a>01538         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#adc87b609a6285a24e23172a90734044c">RIGHTMOUSE</a>:
<a name="l01539"></a>01539             
<a name="l01540"></a>01540             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nsw);
<a name="l01541"></a>01541             op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01542"></a>01542             
<a name="l01543"></a>01543             <a class="code" href="../../da/dcc/ED__node_8h.html#a82a56547160cd057b88d1b64d8336f63">ED_node_update_hierarchy</a>(C, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l01544"></a>01544             
<a name="l01545"></a>01545             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01546"></a>01546     }
<a name="l01547"></a>01547     
<a name="l01548"></a>01548     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l01549"></a>01549 }
<a name="l01550"></a>01550 
<a name="l01551"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a3732d4bddb98e4d582bb135e7da677f2">01551</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a3732d4bddb98e4d582bb135e7da677f2">node_resize_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01552"></a>01552 {
<a name="l01553"></a>01553     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l01554"></a>01554     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar= <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01555"></a>01555     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node= <a class="code" href="../../d1/d13/node__edit_8c.html#aab7cc4b56c93a885d8a9bf3a40f9c59c">editnode_get_active</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l01556"></a>01556     
<a name="l01557"></a>01557     <span class="keywordflow">if</span> (node) {
<a name="l01558"></a>01558         <span class="comment">/* convert mouse coordinates to v2d space */</span>
<a name="l01559"></a>01559         <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[0], event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[1],
<a name="l01560"></a>01560                                  &amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#aac12564b7d6feb2bba41b868e33a8b7e">mx</a>, &amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a463c64fb2748e53199ba27bf3f7d6ec2">my</a>);
<a name="l01561"></a>01561         
<a name="l01562"></a>01562         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#aa242a47e5d985dbf86c1ff35966d4f74" title="Optional custom resize handle polling.">resize_area_func</a>(node, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#aac12564b7d6feb2bba41b868e33a8b7e">mx</a>, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a463c64fb2748e53199ba27bf3f7d6ec2">my</a>)) {
<a name="l01563"></a>01563             <a class="code" href="../../df/d41/structNodeSizeWidget.html">NodeSizeWidget</a> *nsw= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../df/d41/structNodeSizeWidget.html">NodeSizeWidget</a>), <span class="stringliteral">&quot;size widget op data&quot;</span>);
<a name="l01564"></a>01564             
<a name="l01565"></a>01565             op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>= nsw;
<a name="l01566"></a>01566             nsw-&gt;<a class="code" href="../../df/d41/structNodeSizeWidget.html#ad93a1968dd9ac3fa93c44014427715e3">mxstart</a>= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#aac12564b7d6feb2bba41b868e33a8b7e">mx</a>;
<a name="l01567"></a>01567             nsw-&gt;<a class="code" href="../../df/d41/structNodeSizeWidget.html#a38df11fa753d1162e81207f757cb84d9">mystart</a>= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a463c64fb2748e53199ba27bf3f7d6ec2">my</a>;
<a name="l01568"></a>01568             
<a name="l01569"></a>01569             <span class="comment">/* store old */</span>
<a name="l01570"></a>01570             nsw-&gt;<a class="code" href="../../df/d41/structNodeSizeWidget.html#ab40deb26278caccabf6ba6e8128a4a6c">oldwidth</a>= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a1f3be7314aef8500d0a879189ad97025">width</a>;
<a name="l01571"></a>01571             nsw-&gt;<a class="code" href="../../df/d41/structNodeSizeWidget.html#a47c70e33708e5823f7797f64456f2f54">oldheight</a>= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3892585203606fd3e3b0f448eb93c6a8">height</a>;
<a name="l01572"></a>01572             nsw-&gt;<a class="code" href="../../df/d41/structNodeSizeWidget.html#a8a35a676c264c82ac823d6229bd47f26">oldminiwidth</a>= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a45344c987d49653cfdedebb4c403a3f2">miniwidth</a>;
<a name="l01573"></a>01573             
<a name="l01574"></a>01574             <span class="comment">/* add modal handler */</span>
<a name="l01575"></a>01575             <a class="code" href="../../df/db0/wm__event__system_8c.html#ab89ad80681bbec4a06930903ea043251">WM_event_add_modal_handler</a>(C, op);
<a name="l01576"></a>01576 
<a name="l01577"></a>01577             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l01578"></a>01578         }
<a name="l01579"></a>01579     }
<a name="l01580"></a>01580     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>|<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l01581"></a>01581 }
<a name="l01582"></a>01582 
<a name="l01583"></a><a class="code" href="../../d1/d13/node__edit_8c.html#ad0c986d86d8595941d0fd1baee08b239">01583</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ad0c986d86d8595941d0fd1baee08b239">node_resize_cancel</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(C), <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l01584"></a>01584 {
<a name="l01585"></a>01585     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>);
<a name="l01586"></a>01586     op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01587"></a>01587 
<a name="l01588"></a>01588     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01589"></a>01589 }
<a name="l01590"></a>01590 
<a name="l01591"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a84e8914c0ae6853b756472473e910a66">01591</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a916c8140661fc577ac8d3fdf89780642">NODE_OT_resize</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01592"></a>01592 {
<a name="l01593"></a>01593     <span class="comment">/* identifiers */</span>
<a name="l01594"></a>01594     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Resize Node&quot;</span>;
<a name="l01595"></a>01595     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_resize&quot;</span>;
<a name="l01596"></a>01596     
<a name="l01597"></a>01597     <span class="comment">/* api callbacks */</span>
<a name="l01598"></a>01598     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a3732d4bddb98e4d582bb135e7da677f2">node_resize_invoke</a>;
<a name="l01599"></a>01599     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#aa714c9c9245de24e518ac36dd56b5bc7">node_resize_modal</a>;
<a name="l01600"></a>01600     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l01601"></a>01601     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#ad0c986d86d8595941d0fd1baee08b239">node_resize_cancel</a>;
<a name="l01602"></a>01602     
<a name="l01603"></a>01603     <span class="comment">/* flags */</span>
<a name="l01604"></a>01604     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#a2458c730dbcabf67cc8917d8de127bab">OPTYPE_BLOCKING</a>;
<a name="l01605"></a>01605 }
<a name="l01606"></a>01606 
<a name="l01607"></a>01607 
<a name="l01608"></a>01608 <span class="comment">/* ********************** hidden sockets ******************** */</span>
<a name="l01609"></a>01609 
<a name="l01610"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#aeeb0b50edcd3ac751beaa31dac85f91b">01610</a> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#aeeb0b50edcd3ac751beaa31dac85f91b">node_has_hidden_sockets</a>(<a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node)
<a name="l01611"></a>01611 {
<a name="l01612"></a>01612     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l01613"></a>01613     
<a name="l01614"></a>01614     <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l01615"></a>01615         <span class="keywordflow">if</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a099cc90779228b45e80bdfe473895402">SOCK_HIDDEN</a>)
<a name="l01616"></a>01616             <span class="keywordflow">return</span> 1;
<a name="l01617"></a>01617     <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l01618"></a>01618         <span class="keywordflow">if</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a099cc90779228b45e80bdfe473895402">SOCK_HIDDEN</a>)
<a name="l01619"></a>01619             <span class="keywordflow">return</span> 1;
<a name="l01620"></a>01620     <span class="keywordflow">return</span> 0;
<a name="l01621"></a>01621 }
<a name="l01622"></a>01622 
<a name="l01623"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#ada971c9141ec30833ccf790bcd03c0d2">01623</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ada971c9141ec30833ccf790bcd03c0d2">node_set_hidden_sockets</a>(<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <span class="keywordtype">int</span> <span class="keyword">set</span>)
<a name="l01624"></a>01624 {   
<a name="l01625"></a>01625     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l01626"></a>01626 
<a name="l01627"></a>01627     <span class="keywordflow">if</span> (<span class="keyword">set</span>==0) {
<a name="l01628"></a>01628         <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l01629"></a>01629             sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a099cc90779228b45e80bdfe473895402">SOCK_HIDDEN</a>;
<a name="l01630"></a>01630         <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l01631"></a>01631             sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a099cc90779228b45e80bdfe473895402">SOCK_HIDDEN</a>;
<a name="l01632"></a>01632     }
<a name="l01633"></a>01633     <span class="keywordflow">else</span> {
<a name="l01634"></a>01634         <span class="comment">/* hide unused sockets */</span>
<a name="l01635"></a>01635         <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l01636"></a>01636             <span class="keywordflow">if</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a2c66abc5a509d2688c720bdef242d472">link</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01637"></a>01637                 sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a099cc90779228b45e80bdfe473895402">SOCK_HIDDEN</a>;
<a name="l01638"></a>01638         }
<a name="l01639"></a>01639         <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l01640"></a>01640             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/BKE__node_8h.html#a1dcee100d64318b34a1326b25579bda9">nodeCountSocketLinks</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, sock)==0)
<a name="l01641"></a>01641                 sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a099cc90779228b45e80bdfe473895402">SOCK_HIDDEN</a>;
<a name="l01642"></a>01642         }
<a name="l01643"></a>01643     }
<a name="l01644"></a>01644 }
<a name="l01645"></a>01645 
<a name="l01646"></a><a class="code" href="../../d1/d13/node__edit_8c.html#af93790c1249b8e64a215b3d582e5a552">01646</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#af93790c1249b8e64a215b3d582e5a552">node_link_viewer</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *tonode)
<a name="l01647"></a>01647 {
<a name="l01648"></a>01648     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode = <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l01649"></a>01649     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01650"></a>01650     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l01651"></a>01651     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l01652"></a>01652 
<a name="l01653"></a>01653     <span class="comment">/* context check */</span>
<a name="l01654"></a>01654     <span class="keywordflow">if</span> (tonode==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || tonode-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01655"></a>01655         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01656"></a>01656     <span class="keywordflow">if</span> ( <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(tonode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a2228c27b390d81a533a4bf66c5c9d5c7">CMP_NODE_VIEWER</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#abc03163f091ee64dc016da0f154af5f2">CMP_NODE_SPLITVIEWER</a>))
<a name="l01657"></a>01657         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01658"></a>01658     
<a name="l01659"></a>01659     <span class="comment">/* get viewer */</span>
<a name="l01660"></a>01660     <span class="keywordflow">for</span> (node= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>)
<a name="l01661"></a>01661         <span class="keywordflow">if</span> ( <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a2228c27b390d81a533a4bf66c5c9d5c7">CMP_NODE_VIEWER</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#abc03163f091ee64dc016da0f154af5f2">CMP_NODE_SPLITVIEWER</a>))
<a name="l01662"></a>01662             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5235b68781c15e33df28760c8e43aa84">NODE_DO_OUTPUT</a>)
<a name="l01663"></a>01663                 <span class="keywordflow">break</span>;
<a name="l01664"></a>01664     <span class="comment">/* no viewer, we make one active */</span>
<a name="l01665"></a>01665     <span class="keywordflow">if</span> (node==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01666"></a>01666         <span class="keywordflow">for</span> (node= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l01667"></a>01667             <span class="keywordflow">if</span> ( <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a2228c27b390d81a533a4bf66c5c9d5c7">CMP_NODE_VIEWER</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#abc03163f091ee64dc016da0f154af5f2">CMP_NODE_SPLITVIEWER</a>)) {
<a name="l01668"></a>01668                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5235b68781c15e33df28760c8e43aa84">NODE_DO_OUTPUT</a>;
<a name="l01669"></a>01669                 <span class="keywordflow">break</span>;
<a name="l01670"></a>01670             }
<a name="l01671"></a>01671         }
<a name="l01672"></a>01672     }
<a name="l01673"></a>01673     
<a name="l01674"></a>01674     sock = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01675"></a>01675     
<a name="l01676"></a>01676     <span class="comment">/* try to find an already connected socket to cycle to the next */</span>
<a name="l01677"></a>01677     <span class="keywordflow">if</span> (node) {
<a name="l01678"></a>01678         link = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01679"></a>01679         <span class="keywordflow">for</span> (link= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>)
<a name="l01680"></a>01680             <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>==node &amp;&amp; link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>==tonode)
<a name="l01681"></a>01681                 <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>==node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)
<a name="l01682"></a>01682                     <span class="keywordflow">break</span>;
<a name="l01683"></a>01683         <span class="keywordflow">if</span> (link) {
<a name="l01684"></a>01684             <span class="comment">/* unlink existing connection */</span>
<a name="l01685"></a>01685             sock= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>;
<a name="l01686"></a>01686             <a class="code" href="../../d4/d91/BKE__node_8h.html#a667c004db8aacff9f348c81658f32732">nodeRemLink</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, link);
<a name="l01687"></a>01687             
<a name="l01688"></a>01688             <span class="comment">/* find a socket after the previously connected socket */</span>
<a name="l01689"></a>01689             <span class="keywordflow">for</span> (sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l01690"></a>01690                 <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d91/BKE__node_8h.html#a74896dcfa78a426cabc3b97a51c7ed1c">nodeSocketIsHidden</a>(sock))
<a name="l01691"></a>01691                     <span class="keywordflow">break</span>;
<a name="l01692"></a>01692         }
<a name="l01693"></a>01693     }
<a name="l01694"></a>01694     
<a name="l01695"></a>01695     <span class="comment">/* find a socket starting from the first socket */</span>
<a name="l01696"></a>01696     <span class="keywordflow">if</span> (!sock) {
<a name="l01697"></a>01697         <span class="keywordflow">for</span> (sock= tonode-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l01698"></a>01698             <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d91/BKE__node_8h.html#a74896dcfa78a426cabc3b97a51c7ed1c">nodeSocketIsHidden</a>(sock))
<a name="l01699"></a>01699                 <span class="keywordflow">break</span>;
<a name="l01700"></a>01700     }
<a name="l01701"></a>01701     
<a name="l01702"></a>01702     <span class="keywordflow">if</span> (sock) {
<a name="l01703"></a>01703         <span class="comment">/* add a new viewer if none exists yet */</span>
<a name="l01704"></a>01704         <span class="keywordflow">if</span> (!node) {
<a name="l01705"></a>01705             <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain = <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C);
<a name="l01706"></a>01706             <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l01707"></a>01707             <a class="code" href="../../dd/dc3/structbNodeTemplate.html">bNodeTemplate</a> ntemp;
<a name="l01708"></a>01708             
<a name="l01709"></a>01709             ntemp.<a class="code" href="../../dd/dc3/structbNodeTemplate.html#a8948f989fe76d9bbfc8c31b10bc4d761">type</a> = <a class="code" href="../../d4/d91/BKE__node_8h.html#a2228c27b390d81a533a4bf66c5c9d5c7">CMP_NODE_VIEWER</a>;
<a name="l01710"></a>01710             <span class="comment">/* XXX location is a quick hack, just place it next to the linked socket */</span>
<a name="l01711"></a>01711             node = <a class="code" href="../../d1/d13/node__edit_8c.html#ae165da0231fe29bd0ee616a3ae4f4467">node_add_node</a>(snode, bmain, scene, &amp;ntemp, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a9877be615b6c9a27144e427c0ff1dd1a">locx</a> + 100, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a4ae84049b3bcf99e82018d48fc6ecc8e">locy</a>);
<a name="l01712"></a>01712             <span class="keywordflow">if</span> (!node)
<a name="l01713"></a>01713                 <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01714"></a>01714             
<a name="l01715"></a>01715             link = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01716"></a>01716         }
<a name="l01717"></a>01717         <span class="keywordflow">else</span> {
<a name="l01718"></a>01718             <span class="comment">/* get link to viewer */</span>
<a name="l01719"></a>01719             <span class="keywordflow">for</span> (link= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>)
<a name="l01720"></a>01720                 <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>==node &amp;&amp; link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>==node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>)
<a name="l01721"></a>01721                     <span class="keywordflow">break</span>;
<a name="l01722"></a>01722         }
<a name="l01723"></a>01723         
<a name="l01724"></a>01724         <span class="keywordflow">if</span> (link==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01725"></a>01725             <a class="code" href="../../d4/d91/BKE__node_8h.html#aa161c89ff293492384fdccbbe61863fa">nodeAddLink</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, tonode, sock, node, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>);
<a name="l01726"></a>01726         }
<a name="l01727"></a>01727         <span class="keywordflow">else</span> {
<a name="l01728"></a>01728             link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>= tonode;
<a name="l01729"></a>01729             link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>= sock;
<a name="l01730"></a>01730         }
<a name="l01731"></a>01731         <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l01732"></a>01732         <a class="code" href="../../d1/d13/node__edit_8c.html#a3cfedc979a13196864e0774f29f9419e">snode_update</a>(snode, node);
<a name="l01733"></a>01733     }
<a name="l01734"></a>01734     
<a name="l01735"></a>01735     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01736"></a>01736 }
<a name="l01737"></a>01737 
<a name="l01738"></a>01738 
<a name="l01739"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a0adf42adea93760e4ec5a0ddfe80cfac">01739</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a0adf42adea93760e4ec5a0ddfe80cfac">node_active_link_viewer</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l01740"></a>01740 {
<a name="l01741"></a>01741     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l01742"></a>01742     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01743"></a>01743     
<a name="l01744"></a>01744     node= <a class="code" href="../../d1/d13/node__edit_8c.html#aab7cc4b56c93a885d8a9bf3a40f9c59c">editnode_get_active</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l01745"></a>01745     
<a name="l01746"></a>01746     <span class="keywordflow">if</span> (!node)
<a name="l01747"></a>01747         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01748"></a>01748 
<a name="l01749"></a>01749     <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l01750"></a>01750 
<a name="l01751"></a>01751     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d13/node__edit_8c.html#af93790c1249b8e64a215b3d582e5a552">node_link_viewer</a>(C, node) == <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>)
<a name="l01752"></a>01752         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l01753"></a>01753 
<a name="l01754"></a>01754     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l01755"></a>01755 
<a name="l01756"></a>01756     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l01757"></a>01757 }
<a name="l01758"></a>01758 
<a name="l01759"></a>01759 
<a name="l01760"></a>01760 
<a name="l01761"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a587b9002aebf288fe1370a8d9395646a">01761</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#abb3684b7ff4934ca71b7695aad5aaf5a">NODE_OT_link_viewer</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l01762"></a>01762 {
<a name="l01763"></a>01763     <span class="comment">/* identifiers */</span>
<a name="l01764"></a>01764     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Link to Viewer Node&quot;</span>;
<a name="l01765"></a>01765     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Link to viewer node&quot;</span>;
<a name="l01766"></a>01766     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_link_viewer&quot;</span>;
<a name="l01767"></a>01767     
<a name="l01768"></a>01768     <span class="comment">/* api callbacks */</span>
<a name="l01769"></a>01769     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a0adf42adea93760e4ec5a0ddfe80cfac">node_active_link_viewer</a>;
<a name="l01770"></a>01770     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a6ccb546628222c2bc2e034b9352a52d1">composite_node_active</a>;
<a name="l01771"></a>01771     
<a name="l01772"></a>01772     <span class="comment">/* flags */</span>
<a name="l01773"></a>01773     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l01774"></a>01774 }
<a name="l01775"></a>01775 
<a name="l01776"></a>01776 
<a name="l01777"></a>01777 
<a name="l01778"></a>01778 <span class="comment">/* return 0, nothing done */</span>
<a name="l01779"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a807f5971fe7b7b065c9213ed708452bb">01779</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a26aa3564d15ae9e56cce569a324df5da">UNUSED_FUNCTION</a>(<a class="code" href="../../d1/d13/node__edit_8c.html#a807f5971fe7b7b065c9213ed708452bb">node_mouse_groupheader</a>)(<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode)
<a name="l01780"></a>01780 {
<a name="l01781"></a>01781     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *gnode;
<a name="l01782"></a>01782     <span class="keywordtype">float</span> mx=0, my=0;
<a name="l01783"></a>01783 <span class="comment">// XXX  int mval[2];</span>
<a name="l01784"></a>01784     
<a name="l01785"></a>01785     gnode= <a class="code" href="../../d1/d13/node__edit_8c.html#a3502c8be1cf3dd72e3cc366ae3bd91ef">node_tree_get_editgroup</a>(snode-&gt;nodetree);
<a name="l01786"></a>01786     <span class="keywordflow">if</span> (gnode==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> 0;
<a name="l01787"></a>01787     
<a name="l01788"></a>01788 <span class="comment">// XXX  getmouseco_areawin(mval);</span>
<a name="l01789"></a>01789 <span class="comment">// XXX  areamouseco_to_ipoco(G.v2d, mval, &amp;mx, &amp;my);</span>
<a name="l01790"></a>01790     
<a name="l01791"></a>01791     <span class="comment">/* click in header or outside? */</span>
<a name="l01792"></a>01792     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d44/BLI__rect_8h.html#a6601514c8df73c1e060cb2b3f4887b09">BLI_in_rctf</a>(&amp;gnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>, mx, my)==0) {
<a name="l01793"></a>01793         <a class="code" href="../../da/d10/structrctf.html">rctf</a> rect= gnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>;
<a name="l01794"></a>01794         
<a name="l01795"></a>01795         rect.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> += <a class="code" href="../../d8/d8c/node__intern_8h.html#ae35013494b5806430ef68e697464e75f">NODE_DY</a>;
<a name="l01796"></a>01796         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d44/BLI__rect_8h.html#a6601514c8df73c1e060cb2b3f4887b09">BLI_in_rctf</a>(&amp;rect, mx, my)==0)
<a name="l01797"></a>01797             <a class="code" href="../../d1/d13/node__edit_8c.html#a2b7f4784efa4fc8b0f57cc908ffda6b6">snode_make_group_editable</a>(snode, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>); <span class="comment">/* toggles, so exits editmode */</span>
<a name="l01798"></a>01798 <span class="comment">//      else</span>
<a name="l01799"></a>01799 <span class="comment">// XXX          transform_nodes(snode-&gt;nodetree, &#39;g&#39;, &quot;Move group&quot;);</span>
<a name="l01800"></a>01800         
<a name="l01801"></a>01801         <span class="keywordflow">return</span> 1;
<a name="l01802"></a>01802     }
<a name="l01803"></a>01803     <span class="keywordflow">return</span> 0;
<a name="l01804"></a>01804 }
<a name="l01805"></a>01805 
<a name="l01806"></a>01806 <span class="comment">/* checks snode-&gt;mouse position, and returns found node/socket */</span>
<a name="l01807"></a>01807 <span class="comment">/* type is SOCK_IN and/or SOCK_OUT */</span>
<a name="l01808"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a9a27afcce324e84eec0d214350f52562">01808</a> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a934c96fc49a21a9a2d8d99a6f6abe9f6">node_find_indicated_socket</a>(<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> **nodep, <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> **sockp, <span class="keywordtype">int</span> in_out)
<a name="l01809"></a>01809 {
<a name="l01810"></a>01810     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l01811"></a>01811     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l01812"></a>01812     <a class="code" href="../../da/d10/structrctf.html">rctf</a> rect;
<a name="l01813"></a>01813     
<a name="l01814"></a>01814     *nodep= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01815"></a>01815     *sockp= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01816"></a>01816     
<a name="l01817"></a>01817     <span class="comment">/* check if we click in a socket */</span>
<a name="l01818"></a>01818     <span class="keywordflow">for</span> (node= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l01819"></a>01819         
<a name="l01820"></a>01820         rect.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> = snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#aac12564b7d6feb2bba41b868e33a8b7e">mx</a> - (<a class="code" href="../../d8/d8c/node__intern_8h.html#a5505effe0b9e9114cf060876f71dda22">NODE_SOCKSIZE</a>+4);
<a name="l01821"></a>01821         rect.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a463c64fb2748e53199ba27bf3f7d6ec2">my</a> - (<a class="code" href="../../d8/d8c/node__intern_8h.html#a5505effe0b9e9114cf060876f71dda22">NODE_SOCKSIZE</a>+4);
<a name="l01822"></a>01822         rect.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> = snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#aac12564b7d6feb2bba41b868e33a8b7e">mx</a> + (<a class="code" href="../../d8/d8c/node__intern_8h.html#a5505effe0b9e9114cf060876f71dda22">NODE_SOCKSIZE</a>+4);
<a name="l01823"></a>01823         rect.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a463c64fb2748e53199ba27bf3f7d6ec2">my</a> + (<a class="code" href="../../d8/d8c/node__intern_8h.html#a5505effe0b9e9114cf060876f71dda22">NODE_SOCKSIZE</a>+4);
<a name="l01824"></a>01824         
<a name="l01825"></a>01825         <span class="keywordflow">if</span> (!(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a9514398b17ede671295e5c873e7bb3df">NODE_HIDDEN</a>)) {
<a name="l01826"></a>01826             <span class="comment">/* extra padding inside and out - allow dragging on the text areas too */</span>
<a name="l01827"></a>01827             <span class="keywordflow">if</span> (in_out == <a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>) {
<a name="l01828"></a>01828                 rect.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> += <a class="code" href="../../d8/d8c/node__intern_8h.html#a5505effe0b9e9114cf060876f71dda22">NODE_SOCKSIZE</a>;
<a name="l01829"></a>01829                 rect.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> -= <a class="code" href="../../d8/d8c/node__intern_8h.html#a5505effe0b9e9114cf060876f71dda22">NODE_SOCKSIZE</a>*4;
<a name="l01830"></a>01830             }
<a name="l01831"></a>01831             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (in_out == <a class="code" href="../../d4/d91/BKE__node_8h.html#a3e72f128f404bd40757228c1c30edfb6">SOCK_OUT</a>) {
<a name="l01832"></a>01832                 rect.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> += <a class="code" href="../../d8/d8c/node__intern_8h.html#a5505effe0b9e9114cf060876f71dda22">NODE_SOCKSIZE</a>*4;
<a name="l01833"></a>01833                 rect.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> -= <a class="code" href="../../d8/d8c/node__intern_8h.html#a5505effe0b9e9114cf060876f71dda22">NODE_SOCKSIZE</a>;
<a name="l01834"></a>01834             }
<a name="l01835"></a>01835         }
<a name="l01836"></a>01836         
<a name="l01837"></a>01837         <span class="keywordflow">if</span> (in_out &amp; <a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>) {
<a name="l01838"></a>01838             <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l01839"></a>01839                 <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d91/BKE__node_8h.html#a74896dcfa78a426cabc3b97a51c7ed1c">nodeSocketIsHidden</a>(sock)) {
<a name="l01840"></a>01840                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d44/BLI__rect_8h.html#a6601514c8df73c1e060cb2b3f4887b09">BLI_in_rctf</a>(&amp;rect, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a9877be615b6c9a27144e427c0ff1dd1a">locx</a>, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a4ae84049b3bcf99e82018d48fc6ecc8e">locy</a>)) {
<a name="l01841"></a>01841                         <span class="keywordflow">if</span> (node == <a class="code" href="../../d1/d13/node__edit_8c.html#a1628c78068595e550aa3db9e4089c138">visible_node</a>(snode, &amp;rect)) {
<a name="l01842"></a>01842                             *nodep= node;
<a name="l01843"></a>01843                             *sockp= sock;
<a name="l01844"></a>01844                             <span class="keywordflow">return</span> 1;
<a name="l01845"></a>01845                         }
<a name="l01846"></a>01846                     }
<a name="l01847"></a>01847                 }
<a name="l01848"></a>01848             }
<a name="l01849"></a>01849         }
<a name="l01850"></a>01850         <span class="keywordflow">if</span> (in_out &amp; <a class="code" href="../../d4/d91/BKE__node_8h.html#a3e72f128f404bd40757228c1c30edfb6">SOCK_OUT</a>) {
<a name="l01851"></a>01851             <span class="keywordflow">for</span> (sock= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l01852"></a>01852                 <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d91/BKE__node_8h.html#a74896dcfa78a426cabc3b97a51c7ed1c">nodeSocketIsHidden</a>(sock)) {
<a name="l01853"></a>01853                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d44/BLI__rect_8h.html#a6601514c8df73c1e060cb2b3f4887b09">BLI_in_rctf</a>(&amp;rect, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a9877be615b6c9a27144e427c0ff1dd1a">locx</a>, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a4ae84049b3bcf99e82018d48fc6ecc8e">locy</a>)) {
<a name="l01854"></a>01854                         <span class="keywordflow">if</span> (node == <a class="code" href="../../d1/d13/node__edit_8c.html#a1628c78068595e550aa3db9e4089c138">visible_node</a>(snode, &amp;rect)) {
<a name="l01855"></a>01855                             *nodep= node;
<a name="l01856"></a>01856                             *sockp= sock;
<a name="l01857"></a>01857                             <span class="keywordflow">return</span> 1;
<a name="l01858"></a>01858                         }
<a name="l01859"></a>01859                     }
<a name="l01860"></a>01860                 }
<a name="l01861"></a>01861             }
<a name="l01862"></a>01862         }
<a name="l01863"></a>01863     }
<a name="l01864"></a>01864     
<a name="l01865"></a>01865     <span class="comment">/* check group sockets</span>
<a name="l01866"></a>01866 <span class="comment">     * NB: using ngroup-&gt;outputs as input sockets and vice versa here!</span>
<a name="l01867"></a>01867 <span class="comment">     */</span>
<a name="l01868"></a>01868     <span class="keywordflow">if</span> (in_out &amp; <a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>) {
<a name="l01869"></a>01869         <span class="keywordflow">for</span> (sock= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ae1eec42e9fab3d7e4f3ef2f1e508c8b4">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l01870"></a>01870             <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d91/BKE__node_8h.html#a74896dcfa78a426cabc3b97a51c7ed1c">nodeSocketIsHidden</a>(sock)) {
<a name="l01871"></a>01871                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d44/BLI__rect_8h.html#a6601514c8df73c1e060cb2b3f4887b09">BLI_in_rctf</a>(&amp;rect, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a9877be615b6c9a27144e427c0ff1dd1a">locx</a>, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a4ae84049b3bcf99e82018d48fc6ecc8e">locy</a>)) {
<a name="l01872"></a>01872                     *nodep= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;   <span class="comment">/* NULL node pointer indicates group socket */</span>
<a name="l01873"></a>01873                     *sockp= sock;
<a name="l01874"></a>01874                     <span class="keywordflow">return</span> 1;
<a name="l01875"></a>01875                 }
<a name="l01876"></a>01876             }
<a name="l01877"></a>01877         }
<a name="l01878"></a>01878     }
<a name="l01879"></a>01879     <span class="keywordflow">if</span> (in_out &amp; <a class="code" href="../../d4/d91/BKE__node_8h.html#a3e72f128f404bd40757228c1c30edfb6">SOCK_OUT</a>) {
<a name="l01880"></a>01880         <span class="keywordflow">for</span> (sock= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad2372db7171c8ace61f2d1c36c4a9953">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l01881"></a>01881             <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d91/BKE__node_8h.html#a74896dcfa78a426cabc3b97a51c7ed1c">nodeSocketIsHidden</a>(sock)) {
<a name="l01882"></a>01882                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d44/BLI__rect_8h.html#a6601514c8df73c1e060cb2b3f4887b09">BLI_in_rctf</a>(&amp;rect, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a9877be615b6c9a27144e427c0ff1dd1a">locx</a>, sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a4ae84049b3bcf99e82018d48fc6ecc8e">locy</a>)) {
<a name="l01883"></a>01883                     *nodep= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;   <span class="comment">/* NULL node pointer indicates group socket */</span>
<a name="l01884"></a>01884                     *sockp= sock;
<a name="l01885"></a>01885                     <span class="keywordflow">return</span> 1;
<a name="l01886"></a>01886                 }
<a name="l01887"></a>01887             }
<a name="l01888"></a>01888         }
<a name="l01889"></a>01889     }
<a name="l01890"></a>01890     
<a name="l01891"></a>01891     <span class="keywordflow">return</span> 0;
<a name="l01892"></a>01892 }
<a name="l01893"></a>01893 
<a name="l01894"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a2d16a63c988af047de4c215a9a6c196d">01894</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a2d16a63c988af047de4c215a9a6c196d">outside_group_rect</a>(<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode)
<a name="l01895"></a>01895 {
<a name="l01896"></a>01896     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *gnode= <a class="code" href="../../d1/d13/node__edit_8c.html#a3502c8be1cf3dd72e3cc366ae3bd91ef">node_tree_get_editgroup</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>);
<a name="l01897"></a>01897     <span class="keywordflow">if</span> (gnode) {
<a name="l01898"></a>01898         <span class="keywordflow">return</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#aac12564b7d6feb2bba41b868e33a8b7e">mx</a> &lt;  gnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> ||
<a name="l01899"></a>01899                 snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#aac12564b7d6feb2bba41b868e33a8b7e">mx</a> &gt;= gnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> ||
<a name="l01900"></a>01900                 snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a463c64fb2748e53199ba27bf3f7d6ec2">my</a> &lt;  gnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> ||
<a name="l01901"></a>01901                 snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a463c64fb2748e53199ba27bf3f7d6ec2">my</a> &gt;= gnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>);
<a name="l01902"></a>01902     }
<a name="l01903"></a>01903     <span class="keywordflow">return</span> 0;
<a name="l01904"></a>01904 }
<a name="l01905"></a>01905 
<a name="l01906"></a>01906 <span class="comment">/* ****************** Add *********************** */</span>
<a name="l01907"></a>01907 
<a name="l01908"></a>01908 
<a name="l01909"></a><a class="code" href="../../d7/d80/structbNodeListItem.html">01909</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d80/structbNodeListItem.html">bNodeListItem</a> {
<a name="l01910"></a><a class="code" href="../../d7/d80/structbNodeListItem.html#a88372514008bbe48382bd1031758e19c">01910</a>     <span class="keyword">struct </span><a class="code" href="../../d7/d80/structbNodeListItem.html">bNodeListItem</a> *<a class="code" href="../../d7/d80/structbNodeListItem.html#a461607ecac518df12f4071da7995f789">next</a>, *<a class="code" href="../../d7/d80/structbNodeListItem.html#a88372514008bbe48382bd1031758e19c">prev</a>;
<a name="l01911"></a><a class="code" href="../../d7/d80/structbNodeListItem.html#a239a7798753b19efcbfcc56274edd1c9">01911</a>     <span class="keyword">struct </span><a class="code" href="../../dc/daa/structbNode.html">bNode</a> *<a class="code" href="../../d7/d80/structbNodeListItem.html#a239a7798753b19efcbfcc56274edd1c9">node</a>; 
<a name="l01912"></a>01912 } <a class="code" href="../../d1/d13/node__edit_8c.html#ac47307e26798a478119dea8e858fdb51">bNodeListItem</a>;
<a name="l01913"></a>01913 
<a name="l01914"></a><a class="code" href="../../d1/d13/node__edit_8c.html#adf61d01126b84fd9cc6706d4fcf07a5c">01914</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#adf61d01126b84fd9cc6706d4fcf07a5c">sort_nodes_locx</a>(<span class="keywordtype">void</span> *a, <span class="keywordtype">void</span> *b)
<a name="l01915"></a>01915 {
<a name="l01916"></a>01916     <a class="code" href="../../d7/d80/structbNodeListItem.html">bNodeListItem</a> *nli1 = (<a class="code" href="../../d7/d80/structbNodeListItem.html">bNodeListItem</a> *)a;
<a name="l01917"></a>01917     <a class="code" href="../../d7/d80/structbNodeListItem.html">bNodeListItem</a> *nli2 = (<a class="code" href="../../d7/d80/structbNodeListItem.html">bNodeListItem</a> *)b;
<a name="l01918"></a>01918     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node1 = nli1-&gt;<a class="code" href="../../d7/d80/structbNodeListItem.html#a239a7798753b19efcbfcc56274edd1c9">node</a>;
<a name="l01919"></a>01919     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node2 = nli2-&gt;<a class="code" href="../../d7/d80/structbNodeListItem.html#a239a7798753b19efcbfcc56274edd1c9">node</a>;
<a name="l01920"></a>01920     
<a name="l01921"></a>01921     <span class="keywordflow">if</span> (node1-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6529ad3fb2c8ec6ed289fcc90418d777">locx</a> &gt; node2-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6529ad3fb2c8ec6ed289fcc90418d777">locx</a>)
<a name="l01922"></a>01922         <span class="keywordflow">return</span> 1;
<a name="l01923"></a>01923     <span class="keywordflow">else</span> 
<a name="l01924"></a>01924         <span class="keywordflow">return</span> 0;
<a name="l01925"></a>01925 }
<a name="l01926"></a>01926 
<a name="l01927"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a1c2df6fec4bfb0f7c7c79c8cf9bbb8f3">01927</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a1c2df6fec4bfb0f7c7c79c8cf9bbb8f3">socket_is_available</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(ntree), <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock, <span class="keywordtype">int</span> allow_used)
<a name="l01928"></a>01928 {
<a name="l01929"></a>01929     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/BKE__node_8h.html#a74896dcfa78a426cabc3b97a51c7ed1c">nodeSocketIsHidden</a>(sock))
<a name="l01930"></a>01930         <span class="keywordflow">return</span> 0;
<a name="l01931"></a>01931     
<a name="l01932"></a>01932     <span class="keywordflow">if</span> (!allow_used &amp;&amp; (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a1554b14945fdfba6a3f0db89baa291be">SOCK_IN_USE</a>))
<a name="l01933"></a>01933         <span class="keywordflow">return</span> 0;
<a name="l01934"></a>01934     
<a name="l01935"></a>01935     <span class="keywordflow">return</span> 1;
<a name="l01936"></a>01936 }
<a name="l01937"></a>01937 
<a name="l01938"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a5d461152f240650c1e0a77f7f1d46ac7">01938</a> <span class="keyword">static</span> <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *<a class="code" href="../../d1/d13/node__edit_8c.html#a5d461152f240650c1e0a77f7f1d46ac7">best_socket_output</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock_target, <span class="keywordtype">int</span> allow_multiple)
<a name="l01939"></a>01939 {
<a name="l01940"></a>01940     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l01941"></a>01941     
<a name="l01942"></a>01942     <span class="comment">/* first look for selected output */</span>
<a name="l01943"></a>01943     <span class="keywordflow">for</span> (sock=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l01944"></a>01944         <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d13/node__edit_8c.html#a1c2df6fec4bfb0f7c7c79c8cf9bbb8f3">socket_is_available</a>(ntree, sock, allow_multiple))
<a name="l01945"></a>01945             <span class="keywordflow">continue</span>;
<a name="l01946"></a>01946         
<a name="l01947"></a>01947         <span class="keywordflow">if</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)
<a name="l01948"></a>01948             <span class="keywordflow">return</span> sock;
<a name="l01949"></a>01949     }
<a name="l01950"></a>01950     
<a name="l01951"></a>01951     <span class="comment">/* try to find a socket with a matching name */</span>
<a name="l01952"></a>01952     <span class="keywordflow">for</span> (sock=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l01953"></a>01953         <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d13/node__edit_8c.html#a1c2df6fec4bfb0f7c7c79c8cf9bbb8f3">socket_is_available</a>(ntree, sock, allow_multiple))
<a name="l01954"></a>01954             <span class="keywordflow">continue</span>;
<a name="l01955"></a>01955 
<a name="l01956"></a>01956         <span class="comment">/* check for same types */</span>
<a name="l01957"></a>01957         <span class="keywordflow">if</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a> == sock_target-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>) {
<a name="l01958"></a>01958             <span class="keywordflow">if</span> (strcmp(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a08af833b0a18870a5dd633ede04e1ac8">name</a>, sock_target-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a08af833b0a18870a5dd633ede04e1ac8">name</a>)==0)
<a name="l01959"></a>01959                 <span class="keywordflow">return</span> sock;
<a name="l01960"></a>01960         }
<a name="l01961"></a>01961     }
<a name="l01962"></a>01962     
<a name="l01963"></a>01963     <span class="comment">/* otherwise settle for the first available socket of the right type */</span>
<a name="l01964"></a>01964     <span class="keywordflow">for</span> (sock=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l01965"></a>01965 
<a name="l01966"></a>01966         <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d13/node__edit_8c.html#a1c2df6fec4bfb0f7c7c79c8cf9bbb8f3">socket_is_available</a>(ntree, sock, allow_multiple))
<a name="l01967"></a>01967             <span class="keywordflow">continue</span>;
<a name="l01968"></a>01968         
<a name="l01969"></a>01969         <span class="comment">/* check for same types */</span>
<a name="l01970"></a>01970         <span class="keywordflow">if</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a> == sock_target-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>) {
<a name="l01971"></a>01971             <span class="keywordflow">return</span> sock;
<a name="l01972"></a>01972         }
<a name="l01973"></a>01973     }
<a name="l01974"></a>01974     
<a name="l01975"></a>01975     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01976"></a>01976 }
<a name="l01977"></a>01977 
<a name="l01978"></a>01978 <span class="comment">/* this is a bit complicated, but designed to prioritize finding</span>
<a name="l01979"></a>01979 <span class="comment"> * sockets of higher types, such as image, first */</span>
<a name="l01980"></a><a class="code" href="../../d1/d13/node__edit_8c.html#ac0a98aefe64f96c18c6075f0d69dcb07">01980</a> <span class="keyword">static</span> <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *<a class="code" href="../../d1/d13/node__edit_8c.html#ac0a98aefe64f96c18c6075f0d69dcb07">best_socket_input</a>(<a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, <span class="keywordtype">int</span> num, <span class="keywordtype">int</span> replace)
<a name="l01981"></a>01981 {
<a name="l01982"></a>01982     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l01983"></a>01983     <span class="keywordtype">int</span> socktype, maxtype=0;
<a name="l01984"></a>01984     <span class="keywordtype">int</span> a = 0;
<a name="l01985"></a>01985     
<a name="l01986"></a>01986     <span class="keywordflow">for</span> (sock=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l01987"></a>01987         maxtype = <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>, maxtype);
<a name="l01988"></a>01988     }
<a name="l01989"></a>01989     
<a name="l01990"></a>01990     <span class="comment">/* find sockets of higher &#39;types&#39; first (i.e. image) */</span>
<a name="l01991"></a>01991     <span class="keywordflow">for</span> (socktype=maxtype; socktype &gt;= 0; socktype--) {
<a name="l01992"></a>01992         <span class="keywordflow">for</span> (sock=node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l01993"></a>01993             
<a name="l01994"></a>01994             <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d13/node__edit_8c.html#a1c2df6fec4bfb0f7c7c79c8cf9bbb8f3">socket_is_available</a>(ntree, sock, replace)) {
<a name="l01995"></a>01995                 a++;
<a name="l01996"></a>01996                 <span class="keywordflow">continue</span>;
<a name="l01997"></a>01997             }
<a name="l01998"></a>01998                 
<a name="l01999"></a>01999             <span class="keywordflow">if</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a> == socktype) {
<a name="l02000"></a>02000                 <span class="comment">/* increment to make sure we don&#39;t keep finding </span>
<a name="l02001"></a>02001 <span class="comment">                 * the same socket on every attempt running this function */</span>
<a name="l02002"></a>02002                 a++;
<a name="l02003"></a>02003                 <span class="keywordflow">if</span> (a &gt; num)
<a name="l02004"></a>02004                     <span class="keywordflow">return</span> sock;
<a name="l02005"></a>02005             }
<a name="l02006"></a>02006         }
<a name="l02007"></a>02007     }
<a name="l02008"></a>02008     
<a name="l02009"></a>02009     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02010"></a>02010 }
<a name="l02011"></a>02011 
<a name="l02012"></a><a class="code" href="../../d1/d13/node__edit_8c.html#ab00beb64b1f4f2d6c51d73f7effe9b9e">02012</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ab00beb64b1f4f2d6c51d73f7effe9b9e">snode_autoconnect_input</a>(<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node_fr, <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock_fr, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node_to, <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock_to, <span class="keywordtype">int</span> replace)
<a name="l02013"></a>02013 {
<a name="l02014"></a>02014     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree = snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>;
<a name="l02015"></a>02015     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l02016"></a>02016     
<a name="l02017"></a>02017     <span class="comment">/* then we can connect */</span>
<a name="l02018"></a>02018     <span class="keywordflow">if</span> (replace)
<a name="l02019"></a>02019         <a class="code" href="../../d4/d91/BKE__node_8h.html#a2ea3b16bccdfe374b7c1a19435ef4350">nodeRemSocketLinks</a>(ntree, sock_to);
<a name="l02020"></a>02020     
<a name="l02021"></a>02021     link = <a class="code" href="../../d4/d91/BKE__node_8h.html#aa161c89ff293492384fdccbbe61863fa">nodeAddLink</a>(ntree, node_fr, sock_fr, node_to, sock_to);
<a name="l02022"></a>02022     <span class="comment">/* validate the new link */</span>
<a name="l02023"></a>02023     <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(ntree);
<a name="l02024"></a>02024     <span class="keywordflow">if</span> (!(link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#abd5477bf5dc782c73d15e01f696107ee">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a29a0264c85ac1f8b42bc71d236cd4842">NODE_LINK_VALID</a>)) {
<a name="l02025"></a>02025         <a class="code" href="../../d4/d91/BKE__node_8h.html#a667c004db8aacff9f348c81658f32732">nodeRemLink</a>(ntree, link);
<a name="l02026"></a>02026         <span class="keywordflow">return</span> 0;
<a name="l02027"></a>02027     }
<a name="l02028"></a>02028     
<a name="l02029"></a>02029     <a class="code" href="../../d1/d13/node__edit_8c.html#a3cfedc979a13196864e0774f29f9419e">snode_update</a>(snode, node_to);
<a name="l02030"></a>02030     <span class="keywordflow">return</span> 1;
<a name="l02031"></a>02031 }
<a name="l02032"></a>02032 
<a name="l02033"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a70b0ba03a3143f94f746aa6cd48618a4">02033</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a70b0ba03a3143f94f746aa6cd48618a4">snode_autoconnect</a>(<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode, <span class="keywordtype">int</span> allow_multiple, <span class="keywordtype">int</span> replace)
<a name="l02034"></a>02034 {
<a name="l02035"></a>02035     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree = snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>;
<a name="l02036"></a>02036     <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *nodelist = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a>), <span class="stringliteral">&quot;items_list&quot;</span>);
<a name="l02037"></a>02037     <a class="code" href="../../d7/d80/structbNodeListItem.html">bNodeListItem</a> *nli;
<a name="l02038"></a>02038     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l02039"></a>02039     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, numlinks=0;
<a name="l02040"></a>02040     
<a name="l02041"></a>02041     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l02042"></a>02042         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ad7b09e7f53c184ca8fb8015d3d50d808">NODE_SELECT</a>) {
<a name="l02043"></a>02043             nli = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d7/d80/structbNodeListItem.html">bNodeListItem</a>), <span class="stringliteral">&quot;temporary node list item&quot;</span>);
<a name="l02044"></a>02044             nli-&gt;<a class="code" href="../../d7/d80/structbNodeListItem.html#a239a7798753b19efcbfcc56274edd1c9">node</a> = node;
<a name="l02045"></a>02045             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(nodelist, nli);
<a name="l02046"></a>02046         }
<a name="l02047"></a>02047     }
<a name="l02048"></a>02048     
<a name="l02049"></a>02049     <span class="comment">/* sort nodes left to right */</span>
<a name="l02050"></a>02050     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aa842d1a72dc3dc49faa64be1b066797a">BLI_sortlist</a>(nodelist, <a class="code" href="../../d1/d13/node__edit_8c.html#adf61d01126b84fd9cc6706d4fcf07a5c">sort_nodes_locx</a>);
<a name="l02051"></a>02051     
<a name="l02052"></a>02052     <span class="keywordflow">for</span> (nli=nodelist-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; nli; nli=nli-&gt;<a class="code" href="../../d7/d80/structbNodeListItem.html#a461607ecac518df12f4071da7995f789">next</a>) {
<a name="l02053"></a>02053         <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node_fr, *node_to;
<a name="l02054"></a>02054         <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock_fr, *sock_to;
<a name="l02055"></a>02055         <span class="keywordtype">int</span> has_selected_inputs = 0;
<a name="l02056"></a>02056         
<a name="l02057"></a>02057         <span class="keywordflow">if</span> (nli-&gt;<a class="code" href="../../d7/d80/structbNodeListItem.html#a461607ecac518df12f4071da7995f789">next</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">break</span>;
<a name="l02058"></a>02058         
<a name="l02059"></a>02059         node_fr = nli-&gt;<a class="code" href="../../d7/d80/structbNodeListItem.html#a239a7798753b19efcbfcc56274edd1c9">node</a>;
<a name="l02060"></a>02060         node_to = nli-&gt;<a class="code" href="../../d7/d80/structbNodeListItem.html#a461607ecac518df12f4071da7995f789">next</a>-&gt;<a class="code" href="../../d7/d80/structbNodeListItem.html#a239a7798753b19efcbfcc56274edd1c9">node</a>;
<a name="l02061"></a>02061         
<a name="l02062"></a>02062         <span class="comment">/* if there are selected sockets, connect those */</span>
<a name="l02063"></a>02063         <span class="keywordflow">for</span> (sock_to = node_to-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock_to; sock_to=sock_to-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l02064"></a>02064             <span class="keywordflow">if</span> (sock_to-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l02065"></a>02065                 has_selected_inputs = 1;
<a name="l02066"></a>02066                 
<a name="l02067"></a>02067                 <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d13/node__edit_8c.html#a1c2df6fec4bfb0f7c7c79c8cf9bbb8f3">socket_is_available</a>(ntree, sock_to, replace))
<a name="l02068"></a>02068                     <span class="keywordflow">continue</span>;
<a name="l02069"></a>02069                 
<a name="l02070"></a>02070                 <span class="comment">/* check for an appropriate output socket to connect from */</span>
<a name="l02071"></a>02071                 sock_fr = <a class="code" href="../../d1/d13/node__edit_8c.html#a5d461152f240650c1e0a77f7f1d46ac7">best_socket_output</a>(ntree, node_fr, sock_to, allow_multiple);
<a name="l02072"></a>02072                 <span class="keywordflow">if</span> (!sock_fr)
<a name="l02073"></a>02073                     <span class="keywordflow">continue</span>;
<a name="l02074"></a>02074     
<a name="l02075"></a>02075                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d13/node__edit_8c.html#ab00beb64b1f4f2d6c51d73f7effe9b9e">snode_autoconnect_input</a>(snode, node_fr, sock_fr, node_to, sock_to, replace))
<a name="l02076"></a>02076                     ++numlinks;
<a name="l02077"></a>02077             }
<a name="l02078"></a>02078         }
<a name="l02079"></a>02079         
<a name="l02080"></a>02080         <span class="keywordflow">if</span> (!has_selected_inputs) {
<a name="l02081"></a>02081             <span class="comment">/* no selected inputs, connect by finding suitable match */</span>
<a name="l02082"></a>02082             <span class="keywordtype">int</span> num_inputs = <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#aa3b37105a0793ac30946a6d220ee97d7">BLI_countlist</a>(&amp;node_to-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>);
<a name="l02083"></a>02083             
<a name="l02084"></a>02084             <span class="keywordflow">for</span> (i=0; i&lt;num_inputs; i++) {
<a name="l02085"></a>02085                 
<a name="l02086"></a>02086                 <span class="comment">/* find the best guess input socket */</span>
<a name="l02087"></a>02087                 sock_to = <a class="code" href="../../d1/d13/node__edit_8c.html#ac0a98aefe64f96c18c6075f0d69dcb07">best_socket_input</a>(ntree, node_to, i, replace);
<a name="l02088"></a>02088                 <span class="keywordflow">if</span> (!sock_to)
<a name="l02089"></a>02089                     <span class="keywordflow">continue</span>;
<a name="l02090"></a>02090                 
<a name="l02091"></a>02091                 <span class="comment">/* check for an appropriate output socket to connect from */</span>
<a name="l02092"></a>02092                 sock_fr = <a class="code" href="../../d1/d13/node__edit_8c.html#a5d461152f240650c1e0a77f7f1d46ac7">best_socket_output</a>(ntree, node_fr, sock_to, allow_multiple);
<a name="l02093"></a>02093                 <span class="keywordflow">if</span> (!sock_fr)
<a name="l02094"></a>02094                     <span class="keywordflow">continue</span>;
<a name="l02095"></a>02095     
<a name="l02096"></a>02096                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d13/node__edit_8c.html#ab00beb64b1f4f2d6c51d73f7effe9b9e">snode_autoconnect_input</a>(snode, node_fr, sock_fr, node_to, sock_to, replace)) {
<a name="l02097"></a>02097                     ++numlinks;
<a name="l02098"></a>02098                     <span class="keywordflow">break</span>;
<a name="l02099"></a>02099                 }
<a name="l02100"></a>02100             }
<a name="l02101"></a>02101         }
<a name="l02102"></a>02102     }
<a name="l02103"></a>02103     
<a name="l02104"></a>02104     <span class="keywordflow">if</span> (numlinks &gt; 0) {
<a name="l02105"></a>02105         <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(ntree);
<a name="l02106"></a>02106     }
<a name="l02107"></a>02107     
<a name="l02108"></a>02108     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(nodelist);
<a name="l02109"></a>02109     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nodelist);
<a name="l02110"></a>02110 }
<a name="l02111"></a>02111 
<a name="l02112"></a>02112 <span class="comment">/* can be called from menus too, but they should do own undopush and redraws */</span>
<a name="l02113"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#acd4ebe83533b09ed94c7ace9015f724f">02113</a> <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *<a class="code" href="../../d1/d13/node__edit_8c.html#ae165da0231fe29bd0ee616a3ae4f4467">node_add_node</a>(<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode, <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../dd/dc3/structbNodeTemplate.html">bNodeTemplate</a> *ntemp, <span class="keywordtype">float</span> <a class="code" href="../../dc/daa/structbNode.html#a6529ad3fb2c8ec6ed289fcc90418d777">locx</a>, <span class="keywordtype">float</span> <a class="code" href="../../dc/daa/structbNode.html#a137e36d3b64e577a17fda472a8f34588">locy</a>)
<a name="l02114"></a>02114 {
<a name="l02115"></a>02115     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *gnode;
<a name="l02116"></a>02116     
<a name="l02117"></a>02117     <a class="code" href="../../d8/d8c/node__intern_8h.html#a9d5edf625cf8e384090aa1b81f4dac30">node_deselect_all</a>(snode);
<a name="l02118"></a>02118     
<a name="l02119"></a>02119     node = <a class="code" href="../../d4/d91/BKE__node_8h.html#a9a6d0fd5e4711cb2a9a33cf1d5ec84c2">nodeAddNode</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, ntemp);
<a name="l02120"></a>02120     
<a name="l02121"></a>02121     <span class="comment">/* generics */</span>
<a name="l02122"></a>02122     <span class="keywordflow">if</span> (node) {
<a name="l02123"></a>02123         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6529ad3fb2c8ec6ed289fcc90418d777">locx</a>= <a class="code" href="../../dc/daa/structbNode.html#a6529ad3fb2c8ec6ed289fcc90418d777">locx</a>;
<a name="l02124"></a>02124         node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a137e36d3b64e577a17fda472a8f34588">locy</a>= locy + 60.0f;       <span class="comment">// arbitrary.. so its visible, (0,0) is top of node</span>
<a name="l02125"></a>02125         <a class="code" href="../../d8/d8c/node__intern_8h.html#add2a37f4f9817568e6b324762705ae44">node_select</a>(node);
<a name="l02126"></a>02126         
<a name="l02127"></a>02127         gnode= <a class="code" href="../../d1/d13/node__edit_8c.html#a3502c8be1cf3dd72e3cc366ae3bd91ef">node_tree_get_editgroup</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>);
<a name="l02128"></a>02128         <span class="keywordflow">if</span> (gnode) {
<a name="l02129"></a>02129             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6529ad3fb2c8ec6ed289fcc90418d777">locx</a> -= gnode-&gt;locx;
<a name="l02130"></a>02130             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a137e36d3b64e577a17fda472a8f34588">locy</a> -= gnode-&gt;locy;
<a name="l02131"></a>02131         }
<a name="l02132"></a>02132 
<a name="l02133"></a>02133         <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l02134"></a>02134         <a class="code" href="../../da/dcc/ED__node_8h.html#afc5f25d34b779aed3615fee37c390cdc">ED_node_set_active</a>(bmain, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, node);
<a name="l02135"></a>02135         
<a name="l02136"></a>02136         <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>) {
<a name="l02137"></a>02137             <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0388eda1f65113c4a15720e037c11cb4">ELEM4</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#ad757ff9a25034f9e939a65aaea8d1cce">CMP_NODE_R_LAYERS</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#afebb3fe5e904f63ef36f0dce271da9ed">CMP_NODE_COMPOSITE</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a2086c1d38c6ebfa4ff268bf267b7920a">CMP_NODE_DEFOCUS</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a993ae4ed5e6e026e42a3f81b3ef71787">CMP_NODE_OUTPUT_FILE</a>)) {
<a name="l02138"></a>02138                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a> = &amp;scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>;
<a name="l02139"></a>02139             }
<a name="l02140"></a>02140             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#ad3568ab74428f47aea1c855024e467f0">ELEM3</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a7c1ef39c4f464f1da0e05f5b3f846c85">CMP_NODE_MOVIECLIP</a>, <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a7a7174378c79e98cd046514c9565a7b2">CMP_NODE_MOVIEDISTORTION</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#aaa18a02f26df6c291baf424742b39685">CMP_NODE_STABILIZE2D</a>)) {
<a name="l02141"></a>02141                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a> = (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a5ff6096f2dbaa433889794ded2733521">clip</a>;
<a name="l02142"></a>02142             }
<a name="l02143"></a>02143             
<a name="l02144"></a>02144             <a class="code" href="../../d4/d91/BKE__node_8h.html#adbc74c8525b3597285bdb7e9b42fd016">ntreeCompositForceHidden</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, scene);
<a name="l02145"></a>02145         }
<a name="l02146"></a>02146             
<a name="l02147"></a>02147         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>)
<a name="l02148"></a>02148             <a class="code" href="../../d8/db1/BKE__library_8h.html#a967d1ceef29b2612ef6e03194c512ad6">id_us_plus</a>(node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>);
<a name="l02149"></a>02149             
<a name="l02150"></a>02150         <a class="code" href="../../d1/d13/node__edit_8c.html#a3cfedc979a13196864e0774f29f9419e">snode_update</a>(snode, node);
<a name="l02151"></a>02151     }
<a name="l02152"></a>02152     
<a name="l02153"></a>02153     <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a2a2ccfad1cf200204b0fdd594f45de7b">NTREE_TEXTURE</a>) {
<a name="l02154"></a>02154         <a class="code" href="../../d4/d91/BKE__node_8h.html#a91c7768254c9fa6fa54830eba4fa9bb4">ntreeTexCheckCyclics</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l02155"></a>02155     }
<a name="l02156"></a>02156     
<a name="l02157"></a>02157     <span class="keywordflow">return</span> node;
<a name="l02158"></a>02158 }
<a name="l02159"></a>02159 
<a name="l02160"></a>02160 <span class="comment">/* ****************** Duplicate *********************** */</span>
<a name="l02161"></a>02161 
<a name="l02162"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a1bc9f8b4e3016275f5a98782198a1ca2">02162</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a1bc9f8b4e3016275f5a98782198a1ca2">node_duplicate_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l02163"></a>02163 {
<a name="l02164"></a>02164     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l02165"></a>02165     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>;
<a name="l02166"></a>02166     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, *newnode, *lastnode;
<a name="l02167"></a>02167     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>, *newlink, *lastlink;
<a name="l02168"></a>02168     <span class="keywordtype">int</span> keep_inputs = <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;keep_inputs&quot;</span>);
<a name="l02169"></a>02169     
<a name="l02170"></a>02170     <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l02171"></a>02171     
<a name="l02172"></a>02172     lastnode = ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>;
<a name="l02173"></a>02173     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l02174"></a>02174         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l02175"></a>02175             newnode = <a class="code" href="../../d4/d91/BKE__node_8h.html#abf956330b2cdbf553a616ec2f866d20d">nodeCopyNode</a>(ntree, node);
<a name="l02176"></a>02176             
<a name="l02177"></a>02177             <span class="keywordflow">if</span> (newnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>) {
<a name="l02178"></a>02178                 <span class="comment">/* simple id user adjustment, node internal functions don&#39;t touch this</span>
<a name="l02179"></a>02179 <span class="comment">                 * but operators and readfile.c do. */</span>
<a name="l02180"></a>02180                 <a class="code" href="../../d8/db1/BKE__library_8h.html#a967d1ceef29b2612ef6e03194c512ad6">id_us_plus</a>(newnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>);
<a name="l02181"></a>02181                 <span class="comment">/* to ensure redraws or rerenders happen */</span>
<a name="l02182"></a>02182                 <a class="code" href="../../da/dcc/ED__node_8h.html#a95b3e3668704677f2f588426b9506419">ED_node_changed_update</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>, newnode);
<a name="l02183"></a>02183             }
<a name="l02184"></a>02184         }
<a name="l02185"></a>02185         
<a name="l02186"></a>02186         <span class="comment">/* make sure we don&#39;t copy new nodes again! */</span>
<a name="l02187"></a>02187         <span class="keywordflow">if</span> (node==lastnode)
<a name="l02188"></a>02188             <span class="keywordflow">break</span>;
<a name="l02189"></a>02189     }
<a name="l02190"></a>02190     
<a name="l02191"></a>02191     <span class="comment">/* copy links between selected nodes</span>
<a name="l02192"></a>02192 <span class="comment">     * NB: this depends on correct node-&gt;new_node and sock-&gt;new_sock pointers from above copy!</span>
<a name="l02193"></a>02193 <span class="comment">     */</span>
<a name="l02194"></a>02194     lastlink = ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>;
<a name="l02195"></a>02195     <span class="keywordflow">for</span> (link=ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link=link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>) {
<a name="l02196"></a>02196         <span class="comment">/* This creates new links between copied nodes.</span>
<a name="l02197"></a>02197 <span class="comment">         * If keep_inputs is set, also copies input links from unselected (when fromnode==NULL)!</span>
<a name="l02198"></a>02198 <span class="comment">         */</span>
<a name="l02199"></a>02199         <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a> &amp;&amp; (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ad7b09e7f53c184ca8fb8015d3d50d808">NODE_SELECT</a>) &amp;&amp;
<a name="l02200"></a>02200             (keep_inputs || (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a> &amp;&amp; (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ad7b09e7f53c184ca8fb8015d3d50d808">NODE_SELECT</a>))))
<a name="l02201"></a>02201         {
<a name="l02202"></a>02202             newlink = <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a>), <span class="stringliteral">&quot;bNodeLink&quot;</span>);
<a name="l02203"></a>02203             newlink-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#abd5477bf5dc782c73d15e01f696107ee">flag</a> = link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#abd5477bf5dc782c73d15e01f696107ee">flag</a>;
<a name="l02204"></a>02204             newlink-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a> = link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>;
<a name="l02205"></a>02205             newlink-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a> = link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a652e2d25bfb52f5c1fafd99c533b1e45">new_sock</a>;
<a name="l02206"></a>02206             <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a> &amp;&amp; (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ad7b09e7f53c184ca8fb8015d3d50d808">NODE_SELECT</a>)) {
<a name="l02207"></a>02207                 newlink-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a> = link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>;
<a name="l02208"></a>02208                 newlink-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a> = link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a652e2d25bfb52f5c1fafd99c533b1e45">new_sock</a>;
<a name="l02209"></a>02209             }
<a name="l02210"></a>02210             <span class="keywordflow">else</span> {
<a name="l02211"></a>02211                 <span class="comment">/* input node not copied, this keeps the original input linked */</span>
<a name="l02212"></a>02212                 newlink-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a> = link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>;
<a name="l02213"></a>02213                 newlink-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a> = link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>;
<a name="l02214"></a>02214             }
<a name="l02215"></a>02215             
<a name="l02216"></a>02216             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>, newlink);
<a name="l02217"></a>02217         }
<a name="l02218"></a>02218         
<a name="l02219"></a>02219         <span class="comment">/* make sure we don&#39;t copy new links again! */</span>
<a name="l02220"></a>02220         <span class="keywordflow">if</span> (link==lastlink)
<a name="l02221"></a>02221             <span class="keywordflow">break</span>;
<a name="l02222"></a>02222     }
<a name="l02223"></a>02223     
<a name="l02224"></a>02224     <span class="comment">/* deselect old nodes, select the copies instead */</span>
<a name="l02225"></a>02225     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l02226"></a>02226         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l02227"></a>02227             <span class="comment">/* has been set during copy above */</span>
<a name="l02228"></a>02228             newnode = node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a17275d6a2f47a33f2065d0e34f5ab3">new_node</a>;
<a name="l02229"></a>02229             
<a name="l02230"></a>02230             <a class="code" href="../../d8/d8c/node__intern_8h.html#a16b0aa1538f66433d976e7b855a81cd0">node_deselect</a>(node);
<a name="l02231"></a>02231             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#affd125a5a79b463ae03eb15557906ef2">NODE_ACTIVE</a>;
<a name="l02232"></a>02232             <a class="code" href="../../d8/d8c/node__intern_8h.html#add2a37f4f9817568e6b324762705ae44">node_select</a>(newnode);
<a name="l02233"></a>02233         }
<a name="l02234"></a>02234         
<a name="l02235"></a>02235         <span class="comment">/* make sure we don&#39;t copy new nodes again! */</span>
<a name="l02236"></a>02236         <span class="keywordflow">if</span> (node==lastnode)
<a name="l02237"></a>02237             <span class="keywordflow">break</span>;
<a name="l02238"></a>02238     }
<a name="l02239"></a>02239     
<a name="l02240"></a>02240     <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l02241"></a>02241     
<a name="l02242"></a>02242     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l02243"></a>02243     <a class="code" href="../../d1/d13/node__edit_8c.html#addc9fdee9fc2340eedb472e61a7b9b18">snode_dag_update</a>(C, snode);
<a name="l02244"></a>02244 
<a name="l02245"></a>02245     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02246"></a>02246 }
<a name="l02247"></a>02247 
<a name="l02248"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a1a87410cfcae8890e319fa6cf689eb0a">02248</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a29f0e7ced9f1d2bc2aeebf809cf16bf6">NODE_OT_duplicate</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02249"></a>02249 {
<a name="l02250"></a>02250     <span class="comment">/* identifiers */</span>
<a name="l02251"></a>02251     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Duplicate Nodes&quot;</span>;
<a name="l02252"></a>02252     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Duplicate selected nodes&quot;</span>;
<a name="l02253"></a>02253     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_duplicate&quot;</span>;
<a name="l02254"></a>02254     
<a name="l02255"></a>02255     <span class="comment">/* api callbacks */</span>
<a name="l02256"></a>02256     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a1bc9f8b4e3016275f5a98782198a1ca2">node_duplicate_exec</a>;
<a name="l02257"></a>02257     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l02258"></a>02258     
<a name="l02259"></a>02259     <span class="comment">/* flags */</span>
<a name="l02260"></a>02260     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l02261"></a>02261     
<a name="l02262"></a>02262     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;keep_inputs&quot;</span>, 0, <span class="stringliteral">&quot;Keep Inputs&quot;</span>, <span class="stringliteral">&quot;Keep the input links to duplicated nodes&quot;</span>);
<a name="l02263"></a>02263 }
<a name="l02264"></a>02264 
<a name="l02265"></a>02265 <span class="comment">/* *************************** add link op ******************** */</span>
<a name="l02266"></a>02266 
<a name="l02267"></a><a class="code" href="../../d1/d13/node__edit_8c.html#aecf75c218d0100783c9f47849b5b695c">02267</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#aecf75c218d0100783c9f47849b5b695c">node_remove_extra_links</a>(<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode, <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *tsock, <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>)
<a name="l02268"></a>02268 {
<a name="l02269"></a>02269     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *tlink;
<a name="l02270"></a>02270     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l02271"></a>02271     
<a name="l02272"></a>02272     <span class="keywordflow">if</span> (tsock &amp;&amp; <a class="code" href="../../d4/d91/BKE__node_8h.html#a1dcee100d64318b34a1326b25579bda9">nodeCountSocketLinks</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>) &gt; tsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a36deb7fbd6dea184e99685a979750824">limit</a>) {
<a name="l02273"></a>02273         
<a name="l02274"></a>02274         <span class="keywordflow">for</span> (tlink= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tlink; tlink= tlink-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>) {
<a name="l02275"></a>02275             <span class="keywordflow">if</span> (link!=tlink &amp;&amp; tlink-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>==link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>)
<a name="l02276"></a>02276                 <span class="keywordflow">break</span>;
<a name="l02277"></a>02277         }
<a name="l02278"></a>02278         <span class="keywordflow">if</span> (tlink) {
<a name="l02279"></a>02279             <span class="comment">/* try to move the existing link to the next available socket */</span>
<a name="l02280"></a>02280             <span class="keywordflow">if</span> (tlink-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>) {
<a name="l02281"></a>02281                 <span class="comment">/* is there a free input socket with the target type? */</span>
<a name="l02282"></a>02282                 <span class="keywordflow">for</span> (sock= tlink-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l02283"></a>02283                     <span class="keywordflow">if</span> (sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>==tlink-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>)
<a name="l02284"></a>02284                         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/BKE__node_8h.html#a1dcee100d64318b34a1326b25579bda9">nodeCountSocketLinks</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, sock) &lt; sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a36deb7fbd6dea184e99685a979750824">limit</a>)
<a name="l02285"></a>02285                             <span class="keywordflow">break</span>;
<a name="l02286"></a>02286                 }
<a name="l02287"></a>02287                 <span class="keywordflow">if</span> (sock) {
<a name="l02288"></a>02288                     tlink-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>= sock;
<a name="l02289"></a>02289                     sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a099cc90779228b45e80bdfe473895402">SOCK_HIDDEN</a>;
<a name="l02290"></a>02290                 }
<a name="l02291"></a>02291                 <span class="keywordflow">else</span> {
<a name="l02292"></a>02292                     <a class="code" href="../../d4/d91/BKE__node_8h.html#a667c004db8aacff9f348c81658f32732">nodeRemLink</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, tlink);
<a name="l02293"></a>02293                 }
<a name="l02294"></a>02294             }
<a name="l02295"></a>02295             <span class="keywordflow">else</span>
<a name="l02296"></a>02296                 <a class="code" href="../../d4/d91/BKE__node_8h.html#a667c004db8aacff9f348c81658f32732">nodeRemLink</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, tlink);
<a name="l02297"></a>02297             
<a name="l02298"></a>02298             snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae3e3eb720ffd4e45784e4f269d8f070d">NTREE_UPDATE_LINKS</a>;
<a name="l02299"></a>02299         }
<a name="l02300"></a>02300     }
<a name="l02301"></a>02301 }
<a name="l02302"></a>02302 
<a name="l02303"></a>02303 <span class="comment">/* loop that adds a nodelink, called by function below  */</span>
<a name="l02304"></a>02304 <span class="comment">/* in_out = starting socket */</span>
<a name="l02305"></a><a class="code" href="../../d1/d13/node__edit_8c.html#ae60788f4c500e300b5ceca143c5e612f">02305</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ae60788f4c500e300b5ceca143c5e612f">node_link_modal</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02306"></a>02306 {
<a name="l02307"></a>02307     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l02308"></a>02308     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar= <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l02309"></a>02309     <a class="code" href="../../d2/d39/structbNodeLinkDrag.html">bNodeLinkDrag</a> *nldrag= op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l02310"></a>02310     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *tnode, *node;
<a name="l02311"></a>02311     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *tsock= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *sock;
<a name="l02312"></a>02312     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l02313"></a>02313     <span class="keywordtype">int</span> in_out;
<a name="l02314"></a>02314 
<a name="l02315"></a>02315     in_out= nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a03a66e6b0d9cfbdaff3885de96f186d5">in_out</a>;
<a name="l02316"></a>02316     node= nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a8cb225ab2dcfab74a3a3b3dc10ace6dd">node</a>;
<a name="l02317"></a>02317     sock= nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a58b6222c2713d74c6002cdd60bd48bdc">sock</a>;
<a name="l02318"></a>02318     link= nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a4570e1b420b67fb24e0bf323e035112f">link</a>;
<a name="l02319"></a>02319     
<a name="l02320"></a>02320     <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[0], event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[1],
<a name="l02321"></a>02321                              &amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#aac12564b7d6feb2bba41b868e33a8b7e">mx</a>, &amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a463c64fb2748e53199ba27bf3f7d6ec2">my</a>);
<a name="l02322"></a>02322 
<a name="l02323"></a>02323     <span class="keywordflow">switch</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aeddd07f29c499fe2e38964ae993296ff">type</a>) {
<a name="l02324"></a>02324         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#aa58b8b831d49bfef312f9ae99d742aae">MOUSEMOVE</a>:
<a name="l02325"></a>02325             
<a name="l02326"></a>02326             <span class="keywordflow">if</span> (in_out==<a class="code" href="../../d4/d91/BKE__node_8h.html#a3e72f128f404bd40757228c1c30edfb6">SOCK_OUT</a>) {
<a name="l02327"></a>02327                 <span class="comment">/* only target socket becomes hilighted */</span>
<a name="l02328"></a>02328                 <a class="code" href="../../d8/d8c/node__intern_8h.html#a481ac7e3b95085ad44878ab476dfe1ea">node_deselect_all_input_sockets</a>(snode, 0);
<a name="l02329"></a>02329                 
<a name="l02330"></a>02330                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d13/node__edit_8c.html#a934c96fc49a21a9a2d8d99a6f6abe9f6">node_find_indicated_socket</a>(snode, &amp;tnode, &amp;tsock, <a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>)) {
<a name="l02331"></a>02331                     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/BKE__node_8h.html#a02685bdaa86bfa81440393e18e466ece">nodeFindLink</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, sock, tsock)==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02332"></a>02332                         <span class="keywordflow">if</span> ( link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>!= tsock &amp;&amp; (!tnode || (tnode!=node &amp;&amp; link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>!=tnode)) ) {
<a name="l02333"></a>02333                             link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>= tnode;
<a name="l02334"></a>02334                             link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>= tsock;
<a name="l02335"></a>02335                             <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#ad2c372f0bf50d5f6a9edd38e4a456b43">prev</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02336"></a>02336                                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>, link);
<a name="l02337"></a>02337                             }
<a name="l02338"></a>02338                             
<a name="l02339"></a>02339                             snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae3e3eb720ffd4e45784e4f269d8f070d">NTREE_UPDATE_LINKS</a>;
<a name="l02340"></a>02340                             <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l02341"></a>02341                         }
<a name="l02342"></a>02342                     }
<a name="l02343"></a>02343                     
<a name="l02344"></a>02344                     <span class="comment">/* hilight target socket */</span>
<a name="l02345"></a>02345                     <a class="code" href="../../d8/d8c/node__intern_8h.html#aae19d4deb9069e7c1a4755dca2c25d93">node_socket_select</a>(tnode, tsock);
<a name="l02346"></a>02346                 }
<a name="l02347"></a>02347                 <span class="keywordflow">else</span> {
<a name="l02348"></a>02348                     <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a> || link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>) {
<a name="l02349"></a>02349                         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>, link);
<a name="l02350"></a>02350                         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#ad2c372f0bf50d5f6a9edd38e4a456b43">prev</a> = link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02351"></a>02351                         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02352"></a>02352                         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02353"></a>02353                         
<a name="l02354"></a>02354                         snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae3e3eb720ffd4e45784e4f269d8f070d">NTREE_UPDATE_LINKS</a>;
<a name="l02355"></a>02355                         <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l02356"></a>02356                     }
<a name="l02357"></a>02357                 }
<a name="l02358"></a>02358             }
<a name="l02359"></a>02359             <span class="keywordflow">else</span> {
<a name="l02360"></a>02360                 <span class="comment">/* only target socket becomes hilighted */</span>
<a name="l02361"></a>02361                 <a class="code" href="../../d8/d8c/node__intern_8h.html#a914f0edec343808de78a83dfde38a608">node_deselect_all_output_sockets</a>(snode, 0);
<a name="l02362"></a>02362                 
<a name="l02363"></a>02363                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d13/node__edit_8c.html#a934c96fc49a21a9a2d8d99a6f6abe9f6">node_find_indicated_socket</a>(snode, &amp;tnode, &amp;tsock, <a class="code" href="../../d4/d91/BKE__node_8h.html#a3e72f128f404bd40757228c1c30edfb6">SOCK_OUT</a>)) {
<a name="l02364"></a>02364                     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/BKE__node_8h.html#a02685bdaa86bfa81440393e18e466ece">nodeFindLink</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, sock, tsock)==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02365"></a>02365                         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/BKE__node_8h.html#a1dcee100d64318b34a1326b25579bda9">nodeCountSocketLinks</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, tsock) &lt; tsock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a36deb7fbd6dea184e99685a979750824">limit</a>) {
<a name="l02366"></a>02366                             <span class="keywordflow">if</span> ( link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>!= tsock &amp;&amp; (!tnode || (tnode!=node &amp;&amp; link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>!=tnode)) ) {
<a name="l02367"></a>02367                                 link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>= tnode;
<a name="l02368"></a>02368                                 link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>= tsock;
<a name="l02369"></a>02369                                 <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#ad2c372f0bf50d5f6a9edd38e4a456b43">prev</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02370"></a>02370                                     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>, link);
<a name="l02371"></a>02371                                 }
<a name="l02372"></a>02372                                 
<a name="l02373"></a>02373                                 snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae3e3eb720ffd4e45784e4f269d8f070d">NTREE_UPDATE_LINKS</a>;
<a name="l02374"></a>02374                                 <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l02375"></a>02375                             }
<a name="l02376"></a>02376                         }
<a name="l02377"></a>02377                     }
<a name="l02378"></a>02378                     
<a name="l02379"></a>02379                     <span class="comment">/* hilight target socket */</span>
<a name="l02380"></a>02380                     <a class="code" href="../../d8/d8c/node__intern_8h.html#aae19d4deb9069e7c1a4755dca2c25d93">node_socket_select</a>(tnode, tsock);
<a name="l02381"></a>02381                 }
<a name="l02382"></a>02382                 <span class="keywordflow">else</span> {
<a name="l02383"></a>02383                     <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a> || link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>) {
<a name="l02384"></a>02384                         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>, link);
<a name="l02385"></a>02385                         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#ad2c372f0bf50d5f6a9edd38e4a456b43">prev</a> = link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02386"></a>02386                         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02387"></a>02387                         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02388"></a>02388                         snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae3e3eb720ffd4e45784e4f269d8f070d">NTREE_UPDATE_LINKS</a>;
<a name="l02389"></a>02389                         <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l02390"></a>02390                     }
<a name="l02391"></a>02391                 }
<a name="l02392"></a>02392             }
<a name="l02393"></a>02393             
<a name="l02394"></a>02394             <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(ar);
<a name="l02395"></a>02395             <span class="keywordflow">break</span>;
<a name="l02396"></a>02396             
<a name="l02397"></a>02397         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#ae726b291aecab43654d1ac45b9e4d57d">LEFTMOUSE</a>:
<a name="l02398"></a>02398         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#adc87b609a6285a24e23172a90734044c">RIGHTMOUSE</a>:
<a name="l02399"></a>02399         <span class="keywordflow">case</span> <a class="code" href="../../d1/d40/wm__event__types_8h.html#a64d06d50176bcded7e70cd4ebbce0e12">MIDDLEMOUSE</a>:
<a name="l02400"></a>02400             <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a> &amp;&amp; link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>) {
<a name="l02401"></a>02401                 <span class="comment">/* send changed events for original tonode and new */</span>
<a name="l02402"></a>02402                 <a class="code" href="../../d1/d13/node__edit_8c.html#a3cfedc979a13196864e0774f29f9419e">snode_update</a>(snode, link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>);
<a name="l02403"></a>02403                 
<a name="l02404"></a>02404                 <span class="comment">/* we might need to remove a link */</span>
<a name="l02405"></a>02405                 <span class="keywordflow">if</span> (in_out==<a class="code" href="../../d4/d91/BKE__node_8h.html#a3e72f128f404bd40757228c1c30edfb6">SOCK_OUT</a>)
<a name="l02406"></a>02406                     <a class="code" href="../../d1/d13/node__edit_8c.html#aecf75c218d0100783c9f47849b5b695c">node_remove_extra_links</a>(snode, link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>, link);
<a name="l02407"></a>02407                 
<a name="l02408"></a>02408                 <span class="comment">/* deselect sockets after successful linking */</span>
<a name="l02409"></a>02409                 <a class="code" href="../../d8/d8c/node__intern_8h.html#a481ac7e3b95085ad44878ab476dfe1ea">node_deselect_all_input_sockets</a>(snode, 0);
<a name="l02410"></a>02410                 <a class="code" href="../../d8/d8c/node__intern_8h.html#a914f0edec343808de78a83dfde38a608">node_deselect_all_output_sockets</a>(snode, 0);
<a name="l02411"></a>02411                 
<a name="l02412"></a>02412                 <span class="comment">/* when linking to group outputs, update the socket type */</span>
<a name="l02413"></a>02413                 <span class="comment">/* XXX this should all be part of a generic update system */</span>
<a name="l02414"></a>02414                 <span class="keywordflow">if</span> (!link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>) {
<a name="l02415"></a>02415                     link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a> = link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>;
<a name="l02416"></a>02416                 }
<a name="l02417"></a>02417             }
<a name="l02418"></a>02418             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d13/node__edit_8c.html#a2d16a63c988af047de4c215a9a6c196d">outside_group_rect</a>(snode) &amp;&amp; (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a> || link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>)) {
<a name="l02419"></a>02419                 <span class="comment">/* automatically add new group socket */</span>
<a name="l02420"></a>02420                 <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a> &amp;&amp; link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>) {
<a name="l02421"></a>02421                     link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a> = <a class="code" href="../../d4/d91/BKE__node_8h.html#a4c467bd868c8399c3dc652091c113893">node_group_expose_socket</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>);
<a name="l02422"></a>02422                     link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02423"></a>02423                     <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#ad2c372f0bf50d5f6a9edd38e4a456b43">prev</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02424"></a>02424                         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>, link);
<a name="l02425"></a>02425                     }
<a name="l02426"></a>02426                     snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a8bfbcb433682227b3d2df7906b01bdec">NTREE_UPDATE_GROUP_IN</a> | <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae3e3eb720ffd4e45784e4f269d8f070d">NTREE_UPDATE_LINKS</a>;
<a name="l02427"></a>02427                 }
<a name="l02428"></a>02428                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a> &amp;&amp; link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>) {
<a name="l02429"></a>02429                     link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a> = <a class="code" href="../../d4/d91/BKE__node_8h.html#a4c467bd868c8399c3dc652091c113893">node_group_expose_socket</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a3e72f128f404bd40757228c1c30edfb6">SOCK_OUT</a>);
<a name="l02430"></a>02430                     link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02431"></a>02431                     <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#ad2c372f0bf50d5f6a9edd38e4a456b43">prev</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02432"></a>02432                         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>, link);
<a name="l02433"></a>02433                     }
<a name="l02434"></a>02434                     snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a2e124d4a234096ace1e3d5c00d67b245">update</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#acfca127cf8015189d938f38d18f6c8f0">NTREE_UPDATE_GROUP_OUT</a> | <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ae3e3eb720ffd4e45784e4f269d8f070d">NTREE_UPDATE_LINKS</a>;
<a name="l02435"></a>02435                 }
<a name="l02436"></a>02436                 
<a name="l02437"></a>02437                 <span class="comment">/* deselect sockets after successful linking */</span>
<a name="l02438"></a>02438                 <a class="code" href="../../d8/d8c/node__intern_8h.html#a481ac7e3b95085ad44878ab476dfe1ea">node_deselect_all_input_sockets</a>(snode, 0);
<a name="l02439"></a>02439                 <a class="code" href="../../d8/d8c/node__intern_8h.html#a914f0edec343808de78a83dfde38a608">node_deselect_all_output_sockets</a>(snode, 0);
<a name="l02440"></a>02440             }
<a name="l02441"></a>02441             <span class="keywordflow">else</span>
<a name="l02442"></a>02442                 <a class="code" href="../../d4/d91/BKE__node_8h.html#a667c004db8aacff9f348c81658f32732">nodeRemLink</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, link);
<a name="l02443"></a>02443             
<a name="l02444"></a>02444             <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l02445"></a>02445             <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l02446"></a>02446             <a class="code" href="../../d1/d13/node__edit_8c.html#addc9fdee9fc2340eedb472e61a7b9b18">snode_dag_update</a>(C, snode);
<a name="l02447"></a>02447             
<a name="l02448"></a>02448             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a1e16ca4023bb5f8981c0c8c79cd7cdc8">linkdrag</a>, nldrag);
<a name="l02449"></a>02449             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nldrag);
<a name="l02450"></a>02450             
<a name="l02451"></a>02451             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02452"></a>02452     }
<a name="l02453"></a>02453     
<a name="l02454"></a>02454     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l02455"></a>02455 }
<a name="l02456"></a>02456 
<a name="l02457"></a>02457 <span class="comment">/* return 1 when socket clicked */</span>
<a name="l02458"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a36ae281031fc9b5aa5c3cad2da5b4355">02458</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a36ae281031fc9b5aa5c3cad2da5b4355">node_link_init</a>(<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode, <a class="code" href="../../d2/d39/structbNodeLinkDrag.html">bNodeLinkDrag</a> *nldrag)
<a name="l02459"></a>02459 {
<a name="l02460"></a>02460     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l02461"></a>02461     <span class="keywordtype">int</span> in_out = 0;
<a name="l02462"></a>02462 
<a name="l02463"></a>02463     <span class="comment">/* output indicated? */</span>
<a name="l02464"></a>02464     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d13/node__edit_8c.html#a934c96fc49a21a9a2d8d99a6f6abe9f6">node_find_indicated_socket</a>(snode, &amp;nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a8cb225ab2dcfab74a3a3b3dc10ace6dd">node</a>, &amp;nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a58b6222c2713d74c6002cdd60bd48bdc">sock</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a3e72f128f404bd40757228c1c30edfb6">SOCK_OUT</a>)) {
<a name="l02465"></a>02465         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/BKE__node_8h.html#a1dcee100d64318b34a1326b25579bda9">nodeCountSocketLinks</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a58b6222c2713d74c6002cdd60bd48bdc">sock</a>) &lt; nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a58b6222c2713d74c6002cdd60bd48bdc">sock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a36deb7fbd6dea184e99685a979750824">limit</a>)
<a name="l02466"></a>02466             in_out = <a class="code" href="../../d4/d91/BKE__node_8h.html#a3e72f128f404bd40757228c1c30edfb6">SOCK_OUT</a>;
<a name="l02467"></a>02467         <span class="keywordflow">else</span> {
<a name="l02468"></a>02468             <span class="comment">/* find if we break a link */</span>
<a name="l02469"></a>02469             <span class="keywordflow">for</span> (link= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>) {
<a name="l02470"></a>02470                 <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>==nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a58b6222c2713d74c6002cdd60bd48bdc">sock</a>)
<a name="l02471"></a>02471                     <span class="keywordflow">break</span>;
<a name="l02472"></a>02472             }
<a name="l02473"></a>02473             <span class="keywordflow">if</span> (link) {
<a name="l02474"></a>02474                 nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a8cb225ab2dcfab74a3a3b3dc10ace6dd">node</a>= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>;
<a name="l02475"></a>02475                 nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a58b6222c2713d74c6002cdd60bd48bdc">sock</a>= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>;
<a name="l02476"></a>02476                 <a class="code" href="../../d4/d91/BKE__node_8h.html#a667c004db8aacff9f348c81658f32732">nodeRemLink</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, link);
<a name="l02477"></a>02477                 in_out = <a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>;
<a name="l02478"></a>02478             }
<a name="l02479"></a>02479         }
<a name="l02480"></a>02480         
<a name="l02481"></a>02481         <span class="comment">/* hilight source socket only */</span>
<a name="l02482"></a>02482         <a class="code" href="../../d8/d8c/node__intern_8h.html#a914f0edec343808de78a83dfde38a608">node_deselect_all_output_sockets</a>(snode, 0);
<a name="l02483"></a>02483         <a class="code" href="../../d8/d8c/node__intern_8h.html#aae19d4deb9069e7c1a4755dca2c25d93">node_socket_select</a>(nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a8cb225ab2dcfab74a3a3b3dc10ace6dd">node</a>, nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a58b6222c2713d74c6002cdd60bd48bdc">sock</a>);
<a name="l02484"></a>02484     }
<a name="l02485"></a>02485     <span class="comment">/* or an input? */</span>
<a name="l02486"></a>02486     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d13/node__edit_8c.html#a934c96fc49a21a9a2d8d99a6f6abe9f6">node_find_indicated_socket</a>(snode, &amp;nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a8cb225ab2dcfab74a3a3b3dc10ace6dd">node</a>, &amp;nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a58b6222c2713d74c6002cdd60bd48bdc">sock</a>, <a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>)) {
<a name="l02487"></a>02487         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d91/BKE__node_8h.html#a1dcee100d64318b34a1326b25579bda9">nodeCountSocketLinks</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a58b6222c2713d74c6002cdd60bd48bdc">sock</a>) &lt; nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a58b6222c2713d74c6002cdd60bd48bdc">sock</a>-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a36deb7fbd6dea184e99685a979750824">limit</a>)
<a name="l02488"></a>02488             in_out = <a class="code" href="../../d4/d91/BKE__node_8h.html#a39f69a51ecc17c4bb41f0b8089cc3082">SOCK_IN</a>;
<a name="l02489"></a>02489         <span class="keywordflow">else</span> {
<a name="l02490"></a>02490             <span class="comment">/* find if we break a link */</span>
<a name="l02491"></a>02491             <span class="keywordflow">for</span> (link= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>) {
<a name="l02492"></a>02492                 <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>==nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a58b6222c2713d74c6002cdd60bd48bdc">sock</a>)
<a name="l02493"></a>02493                     <span class="keywordflow">break</span>;
<a name="l02494"></a>02494             }
<a name="l02495"></a>02495             <span class="keywordflow">if</span> (link) {
<a name="l02496"></a>02496                 <span class="comment">/* send changed event to original tonode */</span>
<a name="l02497"></a>02497                 <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>)
<a name="l02498"></a>02498                     <a class="code" href="../../d1/d13/node__edit_8c.html#a3cfedc979a13196864e0774f29f9419e">snode_update</a>(snode, link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>);
<a name="l02499"></a>02499                 
<a name="l02500"></a>02500                 nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a8cb225ab2dcfab74a3a3b3dc10ace6dd">node</a>= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>;
<a name="l02501"></a>02501                 nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a58b6222c2713d74c6002cdd60bd48bdc">sock</a>= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>;
<a name="l02502"></a>02502                 <a class="code" href="../../d4/d91/BKE__node_8h.html#a667c004db8aacff9f348c81658f32732">nodeRemLink</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, link);
<a name="l02503"></a>02503                 in_out = <a class="code" href="../../d4/d91/BKE__node_8h.html#a3e72f128f404bd40757228c1c30edfb6">SOCK_OUT</a>;
<a name="l02504"></a>02504             }
<a name="l02505"></a>02505         }
<a name="l02506"></a>02506         
<a name="l02507"></a>02507         <span class="comment">/* hilight source socket only */</span>
<a name="l02508"></a>02508         <a class="code" href="../../d8/d8c/node__intern_8h.html#a481ac7e3b95085ad44878ab476dfe1ea">node_deselect_all_input_sockets</a>(snode, 0);
<a name="l02509"></a>02509         <a class="code" href="../../d8/d8c/node__intern_8h.html#aae19d4deb9069e7c1a4755dca2c25d93">node_socket_select</a>(nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a8cb225ab2dcfab74a3a3b3dc10ace6dd">node</a>, nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a58b6222c2713d74c6002cdd60bd48bdc">sock</a>);
<a name="l02510"></a>02510     }
<a name="l02511"></a>02511     
<a name="l02512"></a>02512     <span class="keywordflow">return</span> in_out;
<a name="l02513"></a>02513 }
<a name="l02514"></a>02514 
<a name="l02515"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a3d784c6903dc4288ed653649b82435f2">02515</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a3d784c6903dc4288ed653649b82435f2">node_link_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l02516"></a>02516 {
<a name="l02517"></a>02517     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l02518"></a>02518     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar= <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l02519"></a>02519     <a class="code" href="../../d2/d39/structbNodeLinkDrag.html">bNodeLinkDrag</a> *nldrag= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d2/d39/structbNodeLinkDrag.html">bNodeLinkDrag</a>), <span class="stringliteral">&quot;drag link op customdata&quot;</span>);
<a name="l02520"></a>02520     
<a name="l02521"></a>02521     
<a name="l02522"></a>02522     <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[0], event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[1],
<a name="l02523"></a>02523                              &amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#aac12564b7d6feb2bba41b868e33a8b7e">mx</a>, &amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a463c64fb2748e53199ba27bf3f7d6ec2">my</a>);
<a name="l02524"></a>02524 
<a name="l02525"></a>02525     <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l02526"></a>02526 
<a name="l02527"></a>02527     nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a03a66e6b0d9cfbdaff3885de96f186d5">in_out</a>= <a class="code" href="../../d1/d13/node__edit_8c.html#a36ae281031fc9b5aa5c3cad2da5b4355">node_link_init</a>(snode, nldrag);
<a name="l02528"></a>02528     
<a name="l02529"></a>02529     <span class="keywordflow">if</span> (nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a03a66e6b0d9cfbdaff3885de96f186d5">in_out</a>) {
<a name="l02530"></a>02530         op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>= nldrag;
<a name="l02531"></a>02531         
<a name="l02532"></a>02532         <span class="comment">/* we make a temporal link */</span>
<a name="l02533"></a>02533         <span class="keywordflow">if</span> (nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a03a66e6b0d9cfbdaff3885de96f186d5">in_out</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#a3e72f128f404bd40757228c1c30edfb6">SOCK_OUT</a>) {
<a name="l02534"></a>02534             nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a4570e1b420b67fb24e0bf323e035112f">link</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a>), <span class="stringliteral">&quot;link&quot;</span>);
<a name="l02535"></a>02535             nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a4570e1b420b67fb24e0bf323e035112f">link</a>-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>= nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a8cb225ab2dcfab74a3a3b3dc10ace6dd">node</a>;
<a name="l02536"></a>02536             nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a4570e1b420b67fb24e0bf323e035112f">link</a>-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>= nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a58b6222c2713d74c6002cdd60bd48bdc">sock</a>;
<a name="l02537"></a>02537             nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a4570e1b420b67fb24e0bf323e035112f">link</a>-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02538"></a>02538             nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a4570e1b420b67fb24e0bf323e035112f">link</a>-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02539"></a>02539         }
<a name="l02540"></a>02540         <span class="keywordflow">else</span> {
<a name="l02541"></a>02541             nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a4570e1b420b67fb24e0bf323e035112f">link</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a>), <span class="stringliteral">&quot;link&quot;</span>);
<a name="l02542"></a>02542             nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a4570e1b420b67fb24e0bf323e035112f">link</a>-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02543"></a>02543             nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a4570e1b420b67fb24e0bf323e035112f">link</a>-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a49a00b03dce8dca5e7bc76670fc72da4">fromsock</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02544"></a>02544             nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a4570e1b420b67fb24e0bf323e035112f">link</a>-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>= nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a8cb225ab2dcfab74a3a3b3dc10ace6dd">node</a>;
<a name="l02545"></a>02545             nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a4570e1b420b67fb24e0bf323e035112f">link</a>-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>= nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a58b6222c2713d74c6002cdd60bd48bdc">sock</a>;
<a name="l02546"></a>02546         }
<a name="l02547"></a>02547         <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a1e16ca4023bb5f8981c0c8c79cd7cdc8">linkdrag</a>, nldrag);
<a name="l02548"></a>02548         
<a name="l02549"></a>02549         <span class="comment">/* add modal handler */</span>
<a name="l02550"></a>02550         <a class="code" href="../../df/db0/wm__event__system_8c.html#ab89ad80681bbec4a06930903ea043251">WM_event_add_modal_handler</a>(C, op);
<a name="l02551"></a>02551         
<a name="l02552"></a>02552         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a3ae275907ae986c695e88547409d19bb">OPERATOR_RUNNING_MODAL</a>;
<a name="l02553"></a>02553     }
<a name="l02554"></a>02554     <span class="keywordflow">else</span> {
<a name="l02555"></a>02555         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nldrag);
<a name="l02556"></a>02556         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>|<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l02557"></a>02557     }
<a name="l02558"></a>02558 }
<a name="l02559"></a>02559 
<a name="l02560"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a73b0413b9e0769647d090462b50c7b8a">02560</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a73b0413b9e0769647d090462b50c7b8a">node_link_cancel</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l02561"></a>02561 {
<a name="l02562"></a>02562     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l02563"></a>02563     <a class="code" href="../../d2/d39/structbNodeLinkDrag.html">bNodeLinkDrag</a> *nldrag= op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a5202237a336c7d3a03fc25f4c87b26d1">customdata</a>;
<a name="l02564"></a>02564 
<a name="l02565"></a>02565     <a class="code" href="../../d4/d91/BKE__node_8h.html#a667c004db8aacff9f348c81658f32732">nodeRemLink</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, nldrag-&gt;<a class="code" href="../../d2/d39/structbNodeLinkDrag.html#a4570e1b420b67fb24e0bf323e035112f">link</a>);
<a name="l02566"></a>02566     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a1e16ca4023bb5f8981c0c8c79cd7cdc8">linkdrag</a>, nldrag);
<a name="l02567"></a>02567     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(nldrag);
<a name="l02568"></a>02568 
<a name="l02569"></a>02569     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l02570"></a>02570 }
<a name="l02571"></a>02571 
<a name="l02572"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a0c0c0590ee0165ee9dd7cff699902e4e">02572</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a8bdec02210bf92cc541ba7bc4180be06">NODE_OT_link</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02573"></a>02573 {
<a name="l02574"></a>02574     <span class="comment">/* identifiers */</span>
<a name="l02575"></a>02575     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Link Nodes&quot;</span>;
<a name="l02576"></a>02576     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_link&quot;</span>;
<a name="l02577"></a>02577     
<a name="l02578"></a>02578     <span class="comment">/* api callbacks */</span>
<a name="l02579"></a>02579     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a3d784c6903dc4288ed653649b82435f2">node_link_invoke</a>;
<a name="l02580"></a>02580     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#ae60788f4c500e300b5ceca143c5e612f">node_link_modal</a>;
<a name="l02581"></a>02581 <span class="comment">//  ot-&gt;exec = node_link_exec;</span>
<a name="l02582"></a>02582     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l02583"></a>02583     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a73b0413b9e0769647d090462b50c7b8a">node_link_cancel</a>;
<a name="l02584"></a>02584     
<a name="l02585"></a>02585     <span class="comment">/* flags */</span>
<a name="l02586"></a>02586     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a2458c730dbcabf67cc8917d8de127bab">OPTYPE_BLOCKING</a>;
<a name="l02587"></a>02587 }
<a name="l02588"></a>02588 
<a name="l02589"></a>02589 <span class="comment">/* ********************** Make Link operator ***************** */</span>
<a name="l02590"></a>02590 
<a name="l02591"></a>02591 <span class="comment">/* makes a link between selected output and input sockets */</span>
<a name="l02592"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a002b26572b225d8393159f64b3f2f1ad">02592</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a002b26572b225d8393159f64b3f2f1ad">node_make_link_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l02593"></a>02593 {
<a name="l02594"></a>02594     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l02595"></a>02595     <span class="keywordtype">int</span> replace = <a class="code" href="../../d3/d10/rna__access_8c.html#a3a81efded6e2e77b384a5d7db179d4b9">RNA_boolean_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;replace&quot;</span>);
<a name="l02596"></a>02596 
<a name="l02597"></a>02597     <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l02598"></a>02598 
<a name="l02599"></a>02599     <a class="code" href="../../d1/d13/node__edit_8c.html#a70b0ba03a3143f94f746aa6cd48618a4">snode_autoconnect</a>(snode, 1, replace);
<a name="l02600"></a>02600 
<a name="l02601"></a>02601     <span class="comment">/* deselect sockets after linking */</span>
<a name="l02602"></a>02602     <a class="code" href="../../d8/d8c/node__intern_8h.html#a481ac7e3b95085ad44878ab476dfe1ea">node_deselect_all_input_sockets</a>(snode, 0);
<a name="l02603"></a>02603     <a class="code" href="../../d8/d8c/node__intern_8h.html#a914f0edec343808de78a83dfde38a608">node_deselect_all_output_sockets</a>(snode, 0);
<a name="l02604"></a>02604 
<a name="l02605"></a>02605     <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l02606"></a>02606     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l02607"></a>02607     <a class="code" href="../../d1/d13/node__edit_8c.html#addc9fdee9fc2340eedb472e61a7b9b18">snode_dag_update</a>(C, snode);
<a name="l02608"></a>02608     
<a name="l02609"></a>02609     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02610"></a>02610 }
<a name="l02611"></a>02611 
<a name="l02612"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a0097a7cf895a567435b191864aba0675">02612</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a2cf219c38d0910480540b6dfaa14f06b">NODE_OT_link_make</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02613"></a>02613 {
<a name="l02614"></a>02614     <span class="comment">/* identifiers */</span>
<a name="l02615"></a>02615     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Make Links&quot;</span>;
<a name="l02616"></a>02616     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Makes a link between selected output in input sockets&quot;</span>;
<a name="l02617"></a>02617     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_link_make&quot;</span>;
<a name="l02618"></a>02618     
<a name="l02619"></a>02619     <span class="comment">/* callbacks */</span>
<a name="l02620"></a>02620     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a002b26572b225d8393159f64b3f2f1ad">node_make_link_exec</a>;
<a name="l02621"></a>02621     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>; <span class="comment">// XXX we need a special poll which checks that there are selected input/output sockets</span>
<a name="l02622"></a>02622     
<a name="l02623"></a>02623     <span class="comment">/* flags */</span>
<a name="l02624"></a>02624     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l02625"></a>02625     
<a name="l02626"></a>02626     <a class="code" href="../../dc/d7e/rna__define_8c.html#a6025d606b895666e4099441c3dae79fe">RNA_def_boolean</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;replace&quot;</span>, 0, <span class="stringliteral">&quot;Replace&quot;</span>, <span class="stringliteral">&quot;Replace socket connections with the new links&quot;</span>);
<a name="l02627"></a>02627 }
<a name="l02628"></a>02628 
<a name="l02629"></a>02629 <span class="comment">/* ********************** Cut Link operator ***************** */</span>
<a name="l02630"></a>02630 
<a name="l02631"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a0d4faabbd21f5cb616704019943528b9">02631</a> <span class="preprocessor">#define LINK_RESOL 12</span>
<a name="l02632"></a><a class="code" href="../../d1/d13/node__edit_8c.html#aa8e8b66590200f4bec24c6679c10290e">02632</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#aa8e8b66590200f4bec24c6679c10290e">cut_links_intersect</a>(<a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>, <span class="keywordtype">float</span> mcoords[][2], <span class="keywordtype">int</span> tot)
<a name="l02633"></a>02633 {
<a name="l02634"></a>02634     <span class="keywordtype">float</span> coord_array[<a class="code" href="../../d1/d13/node__edit_8c.html#a0d4faabbd21f5cb616704019943528b9">LINK_RESOL</a>+1][2];
<a name="l02635"></a>02635     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, b;
<a name="l02636"></a>02636     
<a name="l02637"></a>02637     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d1d/drawnode_8c.html#a6290a939c00f84d53ea794ceea7f4c94">node_link_bezier_points</a>(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, link, coord_array, <a class="code" href="../../d1/d13/node__edit_8c.html#a0d4faabbd21f5cb616704019943528b9">LINK_RESOL</a>)) {
<a name="l02638"></a>02638 
<a name="l02639"></a>02639         <span class="keywordflow">for</span> (i=0; i&lt;tot-1; i++)
<a name="l02640"></a>02640             <span class="keywordflow">for</span> (b=0; b&lt;<a class="code" href="../../d1/d13/node__edit_8c.html#a0d4faabbd21f5cb616704019943528b9">LINK_RESOL</a>; b++)
<a name="l02641"></a>02641                 <span class="keywordflow">if</span> (<a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#ae064721a493a37d68f1d5add94201f6a">isect_line_line_v2</a>(mcoords[i], mcoords[i+1], coord_array[b], coord_array[b+1]) &gt; 0)
<a name="l02642"></a>02642                     <span class="keywordflow">return</span> 1;
<a name="l02643"></a>02643     }
<a name="l02644"></a>02644     <span class="keywordflow">return</span> 0;
<a name="l02645"></a>02645 }
<a name="l02646"></a>02646 
<a name="l02647"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a18e90e63ef9a172f7172a879ec13e1f3">02647</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a18e90e63ef9a172f7172a879ec13e1f3">cut_links_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l02648"></a>02648 {
<a name="l02649"></a>02649     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l02650"></a>02650     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar= <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l02651"></a>02651     <span class="keywordtype">float</span> mcoords[256][2];
<a name="l02652"></a>02652     <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>= 0;
<a name="l02653"></a>02653     
<a name="l02654"></a>02654     <a class="code" href="../../de/ddf/RNA__access_8h.html#a0310a34930fc9ac8d15a39c38d3dd429">RNA_BEGIN</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, itemptr, <span class="stringliteral">&quot;path&quot;</span>) {
<a name="l02655"></a>02655         <span class="keywordtype">float</span> loc[2];
<a name="l02656"></a>02656         
<a name="l02657"></a>02657         <a class="code" href="../../d3/d10/rna__access_8c.html#a5d95f86ccce314676ae750034fb56709">RNA_float_get_array</a>(&amp;itemptr, <span class="stringliteral">&quot;loc&quot;</span>, loc);
<a name="l02658"></a>02658         <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, (<span class="keywordtype">short</span>)loc[0], (<span class="keywordtype">short</span>)loc[1], 
<a name="l02659"></a>02659                                  &amp;mcoords[i][0], &amp;mcoords[i][1]);
<a name="l02660"></a>02660         i++;
<a name="l02661"></a>02661         <span class="keywordflow">if</span> (i&gt;= 256) <span class="keywordflow">break</span>;
<a name="l02662"></a>02662     }
<a name="l02663"></a>02663     <a class="code" href="../../de/ddf/RNA__access_8h.html#a245d0341a908eab74fc30b93cf24a74d">RNA_END</a>;
<a name="l02664"></a>02664     
<a name="l02665"></a>02665     <span class="keywordflow">if</span> (i&gt;1) {
<a name="l02666"></a>02666         <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l02667"></a>02667 
<a name="l02668"></a>02668         <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l02669"></a>02669         
<a name="l02670"></a>02670         <span class="keywordflow">for</span> (link= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link= next) {
<a name="l02671"></a>02671             next= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>;
<a name="l02672"></a>02672             
<a name="l02673"></a>02673             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d13/node__edit_8c.html#aa8e8b66590200f4bec24c6679c10290e">cut_links_intersect</a>(link, mcoords, i)) {
<a name="l02674"></a>02674                 <a class="code" href="../../d1/d13/node__edit_8c.html#a3cfedc979a13196864e0774f29f9419e">snode_update</a>(snode, link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>);
<a name="l02675"></a>02675                 <a class="code" href="../../d4/d91/BKE__node_8h.html#a667c004db8aacff9f348c81658f32732">nodeRemLink</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, link);
<a name="l02676"></a>02676             }
<a name="l02677"></a>02677         }
<a name="l02678"></a>02678         
<a name="l02679"></a>02679         <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l02680"></a>02680         <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l02681"></a>02681         <a class="code" href="../../d1/d13/node__edit_8c.html#addc9fdee9fc2340eedb472e61a7b9b18">snode_dag_update</a>(C, snode);
<a name="l02682"></a>02682         
<a name="l02683"></a>02683         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02684"></a>02684     }
<a name="l02685"></a>02685     
<a name="l02686"></a>02686     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>|<a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ac593ccb5bdf99609d37aac1dc5b03eee">OPERATOR_PASS_THROUGH</a>;
<a name="l02687"></a>02687 }
<a name="l02688"></a>02688 
<a name="l02689"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#adb1661d958e94ef7678ad5b92751debe">02689</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a76e270e9ecb5a4f4ff9c5ee5f97c4581">NODE_OT_links_cut</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02690"></a>02690 {
<a name="l02691"></a>02691     <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *prop;
<a name="l02692"></a>02692     
<a name="l02693"></a>02693     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Cut links&quot;</span>;
<a name="l02694"></a>02694     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_links_cut&quot;</span>;
<a name="l02695"></a>02695     
<a name="l02696"></a>02696     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a6e3d94d2b105cd626ec262e2de31c6d7">WM_gesture_lines_invoke</a>;
<a name="l02697"></a>02697     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a721a4a53a8435e444ec3460f327bca3b">modal</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#ac64d748df121db8d3126cc72910289b9">WM_gesture_lines_modal</a>;
<a name="l02698"></a>02698     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a18e90e63ef9a172f7172a879ec13e1f3">cut_links_exec</a>;
<a name="l02699"></a>02699     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#ac3d8df4a62e774a42cf67a761f260c1d">cancel</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#ae1cfa3419b2cfe0b0e106a0ade9dd91f">WM_gesture_lines_cancel</a>;
<a name="l02700"></a>02700     
<a name="l02701"></a>02701     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l02702"></a>02702     
<a name="l02703"></a>02703     <span class="comment">/* flags */</span>
<a name="l02704"></a>02704     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l02705"></a>02705     
<a name="l02706"></a>02706     prop= <a class="code" href="../../dc/d7e/rna__define_8c.html#a91cb4d1ec0eb64b77f2e193607eaec4c">RNA_def_property</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;path&quot;</span>, <a class="code" href="../../de/d7e/RNA__types_8h.html#a7ff5a5c54f182b86d1cd993cf4512c87af6747d14516095c7da178bdce8ec547e">PROP_COLLECTION</a>, <a class="code" href="../../de/d7e/RNA__types_8h.html#afc8d3af46d7ce49bb3e75305354fd9bca8134bae8bb64b7bab4a27a4b504f8081">PROP_NONE</a>);
<a name="l02707"></a>02707     <a class="code" href="../../dc/d7e/rna__define_8c.html#a3b6e29f6229322ce084b6a9df34dfe5d">RNA_def_property_struct_runtime</a>(prop, &amp;<a class="code" href="../../de/ddf/RNA__access_8h.html#adc48d820579cb86b1e06c0e9f10a22b2">RNA_OperatorMousePath</a>);
<a name="l02708"></a>02708     <span class="comment">/* internal */</span>
<a name="l02709"></a>02709     <a class="code" href="../../dc/d7e/rna__define_8c.html#ad9b0c75a6330ff1837409c5d1767af62">RNA_def_int</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;cursor&quot;</span>, <a class="code" href="../../db/da6/wm__cursors_8h.html#a737c1bdca78a4eec48fa026fcca3dd9ba7f8faa1caf5643f093157898591ccb6d">BC_KNIFECURSOR</a>, 0, INT_MAX, <span class="stringliteral">&quot;Cursor&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 0, INT_MAX);
<a name="l02710"></a>02710 }
<a name="l02711"></a>02711 
<a name="l02712"></a>02712 <span class="comment">/* ********************** Detach links operator ***************** */</span>
<a name="l02713"></a>02713 
<a name="l02714"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a7cc0c17d7d29d673476bf4a487237db9">02714</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a7cc0c17d7d29d673476bf4a487237db9">detach_links_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l02715"></a>02715 {
<a name="l02716"></a>02716     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l02717"></a>02717     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>;
<a name="l02718"></a>02718     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l02719"></a>02719     
<a name="l02720"></a>02720     <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l02721"></a>02721     
<a name="l02722"></a>02722     <span class="keywordflow">for</span> (node= ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l02723"></a>02723         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l02724"></a>02724             <a class="code" href="../../d4/d91/BKE__node_8h.html#a28c5a2c4425a5a23de80e2715a6bb816">nodeInternalRelink</a>(ntree, node);
<a name="l02725"></a>02725         }
<a name="l02726"></a>02726     }
<a name="l02727"></a>02727     
<a name="l02728"></a>02728     <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(ntree);
<a name="l02729"></a>02729     
<a name="l02730"></a>02730     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l02731"></a>02731     <a class="code" href="../../d1/d13/node__edit_8c.html#addc9fdee9fc2340eedb472e61a7b9b18">snode_dag_update</a>(C, snode);
<a name="l02732"></a>02732 
<a name="l02733"></a>02733     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02734"></a>02734 }
<a name="l02735"></a>02735 
<a name="l02736"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#aa5a681858f403c3944e0869f498f636f">02736</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a9157f265ee905a975fc597db6588ffd1">NODE_OT_links_detach</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02737"></a>02737 {
<a name="l02738"></a>02738     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Detach Links&quot;</span>;
<a name="l02739"></a>02739     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_links_detach&quot;</span>;
<a name="l02740"></a>02740     
<a name="l02741"></a>02741     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a7cc0c17d7d29d673476bf4a487237db9">detach_links_exec</a>;
<a name="l02742"></a>02742     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l02743"></a>02743     
<a name="l02744"></a>02744     <span class="comment">/* flags */</span>
<a name="l02745"></a>02745     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l02746"></a>02746 }
<a name="l02747"></a>02747 
<a name="l02748"></a>02748 <span class="comment">/* *********************  automatic node insert on dragging ******************* */</span>
<a name="l02749"></a>02749 
<a name="l02750"></a>02750 <span class="comment">/* assumes sockets in list */</span>
<a name="l02751"></a><a class="code" href="../../d1/d13/node__edit_8c.html#ae2929ab86acdaeef33588040891ea9ab">02751</a> <span class="keyword">static</span> <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *<a class="code" href="../../d1/d13/node__edit_8c.html#ae2929ab86acdaeef33588040891ea9ab">socket_best_match</a>(<a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *sockets)
<a name="l02752"></a>02752 {
<a name="l02753"></a>02753     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sock;
<a name="l02754"></a>02754     <span class="keywordtype">int</span> <a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>, maxtype=0;
<a name="l02755"></a>02755     
<a name="l02756"></a>02756     <span class="comment">/* find type range */</span>
<a name="l02757"></a>02757     <span class="keywordflow">for</span> (sock=sockets-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock=sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>)
<a name="l02758"></a>02758         maxtype = <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>, maxtype);
<a name="l02759"></a>02759     
<a name="l02760"></a>02760     <span class="comment">/* try all types, starting from &#39;highest&#39; (i.e. colors, vectors, values) */</span>
<a name="l02761"></a>02761     <span class="keywordflow">for</span> (type=maxtype; type &gt;= 0; --<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>) {
<a name="l02762"></a>02762         <span class="keywordflow">for</span> (sock= sockets-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l02763"></a>02763             <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d91/BKE__node_8h.html#a74896dcfa78a426cabc3b97a51c7ed1c">nodeSocketIsHidden</a>(sock) &amp;&amp; type==sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>) {
<a name="l02764"></a>02764                 <span class="keywordflow">return</span> sock;
<a name="l02765"></a>02765             }
<a name="l02766"></a>02766         }
<a name="l02767"></a>02767     }
<a name="l02768"></a>02768     
<a name="l02769"></a>02769     <span class="comment">/* no visible sockets, unhide first of highest type */</span>
<a name="l02770"></a>02770     <span class="keywordflow">for</span> (type=maxtype; type &gt;= 0; --<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>) {
<a name="l02771"></a>02771         <span class="keywordflow">for</span> (sock= sockets-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sock; sock= sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#a7e1f426e43244487e24f9cc94e4d407b">next</a>) {
<a name="l02772"></a>02772             <span class="keywordflow">if</span> (type==sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ac06da7586b2ece1c92acaebc2ad2d26a">type</a>) {
<a name="l02773"></a>02773                 sock-&gt;<a class="code" href="../../dd/d4e/structbNodeSocket.html#ae4d2ceaf8952f9cc34878ef6037435d8">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a099cc90779228b45e80bdfe473895402">SOCK_HIDDEN</a>;
<a name="l02774"></a>02774                 <span class="keywordflow">return</span> sock;
<a name="l02775"></a>02775             }
<a name="l02776"></a>02776         }
<a name="l02777"></a>02777     }
<a name="l02778"></a>02778     
<a name="l02779"></a>02779     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02780"></a>02780 }
<a name="l02781"></a>02781 
<a name="l02782"></a>02782 <span class="comment">/* prevent duplicate testing code below */</span>
<a name="l02783"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a9cdcb7eef2f58b3f651ea7b44a536605">02783</a> <span class="keyword">static</span> <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *<a class="code" href="../../d1/d13/node__edit_8c.html#a9cdcb7eef2f58b3f651ea7b44a536605">ed_node_link_conditions</a>(<a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa, <a class="code" href="../../dc/daa/structbNode.html">bNode</a> **select)
<a name="l02784"></a>02784 {
<a name="l02785"></a>02785     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= sa?sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>:<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02786"></a>02786     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l02787"></a>02787     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l02788"></a>02788     
<a name="l02789"></a>02789     <span class="comment">/* no unlucky accidents */</span>
<a name="l02790"></a>02790     <span class="keywordflow">if</span> (sa==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a124203529b9ea4c84ca8f8ae4efff3e3">spacetype</a>!=<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca2ef41082c072d92dbf2d57e20442751d">SPACE_NODE</a>) <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02791"></a>02791     
<a name="l02792"></a>02792     *select= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02793"></a>02793     
<a name="l02794"></a>02794     <span class="keywordflow">for</span> (node= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l02795"></a>02795         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l02796"></a>02796             <span class="keywordflow">if</span> (*select)
<a name="l02797"></a>02797                 <span class="keywordflow">break</span>;
<a name="l02798"></a>02798             <span class="keywordflow">else</span>
<a name="l02799"></a>02799                 *select= node;
<a name="l02800"></a>02800         }
<a name="l02801"></a>02801     }
<a name="l02802"></a>02802     <span class="comment">/* only one selected */</span>
<a name="l02803"></a>02803     <span class="keywordflow">if</span> (node || *select==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02804"></a>02804     
<a name="l02805"></a>02805     <span class="comment">/* correct node */</span>
<a name="l02806"></a>02806     <span class="keywordflow">if</span> ((*select)-&gt;inputs.first==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || (*select)-&gt;outputs.first==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02807"></a>02807     
<a name="l02808"></a>02808     <span class="comment">/* test node for links */</span>
<a name="l02809"></a>02809     <span class="keywordflow">for</span> (link= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link=link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>) {
<a name="l02810"></a>02810         <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a> == *select || link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a94e88670c21ac413725881f7e2193d53">fromnode</a> == *select)
<a name="l02811"></a>02811             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02812"></a>02812     }
<a name="l02813"></a>02813     
<a name="l02814"></a>02814     <span class="keywordflow">return</span> snode;
<a name="l02815"></a>02815 }
<a name="l02816"></a>02816 
<a name="l02817"></a>02817 <span class="comment">/* assumes link with NODE_LINKFLAG_HILITE set */</span>
<a name="l02818"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a4f23ec9af0b2a8f34f3aa51341e56d16">02818</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dcc/ED__node_8h.html#a19e5f3c5945f2effd073b7acb8fa7136">ED_node_link_insert</a>(<a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa)
<a name="l02819"></a>02819 {
<a name="l02820"></a>02820     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, *select;
<a name="l02821"></a>02821     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../d1/d13/node__edit_8c.html#a9cdcb7eef2f58b3f651ea7b44a536605">ed_node_link_conditions</a>(sa, &amp;select);
<a name="l02822"></a>02822     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l02823"></a>02823     <a class="code" href="../../dd/d4e/structbNodeSocket.html">bNodeSocket</a> *sockto;
<a name="l02824"></a>02824     
<a name="l02825"></a>02825     <span class="keywordflow">if</span> (snode==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l02826"></a>02826     
<a name="l02827"></a>02827     <span class="comment">/* get the link */</span>
<a name="l02828"></a>02828     <span class="keywordflow">for</span> (link= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link=link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>)
<a name="l02829"></a>02829         <span class="keywordflow">if</span> (link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#abd5477bf5dc782c73d15e01f696107ee">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ad8f37257924c25f9e394fa32b6c2c8d5">NODE_LINKFLAG_HILITE</a>)
<a name="l02830"></a>02830             <span class="keywordflow">break</span>;
<a name="l02831"></a>02831     
<a name="l02832"></a>02832     <span class="keywordflow">if</span> (link) {
<a name="l02833"></a>02833         node= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>;
<a name="l02834"></a>02834         sockto= link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>;
<a name="l02835"></a>02835         
<a name="l02836"></a>02836         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a7caa6063fb5591939f72baee71113c9e">tonode</a>= select;
<a name="l02837"></a>02837         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a981b0966a554947812e7bc2af09f9391">tosock</a>= <a class="code" href="../../d1/d13/node__edit_8c.html#ae2929ab86acdaeef33588040891ea9ab">socket_best_match</a>(&amp;select-&gt;<a class="code" href="../../dc/daa/structbNode.html#a299fd2f4ec8c8b867ae921a4a8b958e3">inputs</a>);
<a name="l02838"></a>02838         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#abd5477bf5dc782c73d15e01f696107ee">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#ad8f37257924c25f9e394fa32b6c2c8d5">NODE_LINKFLAG_HILITE</a>;
<a name="l02839"></a>02839         
<a name="l02840"></a>02840         <a class="code" href="../../d4/d91/BKE__node_8h.html#aa161c89ff293492384fdccbbe61863fa">nodeAddLink</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, select, <a class="code" href="../../d1/d13/node__edit_8c.html#ae2929ab86acdaeef33588040891ea9ab">socket_best_match</a>(&amp;select-&gt;<a class="code" href="../../dc/daa/structbNode.html#ad82f27cc8bfdc348465ed4de147bcb0c">outputs</a>), node, sockto);
<a name="l02841"></a>02841         <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);   <span class="comment">/* needed for pointers */</span>
<a name="l02842"></a>02842         <a class="code" href="../../d1/d13/node__edit_8c.html#a3cfedc979a13196864e0774f29f9419e">snode_update</a>(snode, select);
<a name="l02843"></a>02843         <a class="code" href="../../da/dcc/ED__node_8h.html#a95b3e3668704677f2f588426b9506419">ED_node_changed_update</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a94248169b00a2e09020ca229582c328a">id</a>, select);
<a name="l02844"></a>02844     }
<a name="l02845"></a>02845 }
<a name="l02846"></a>02846 
<a name="l02847"></a>02847 
<a name="l02848"></a>02848 <span class="comment">/* test == 0, clear all intersect flags */</span>
<a name="l02849"></a><a class="code" href="../../d1/d13/node__edit_8c.html#abb445e026f6da8058929f09646bfe651">02849</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dcc/ED__node_8h.html#a5db7620b5ea8339238427dd452671034">ED_node_link_intersect_test</a>(<a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa, <span class="keywordtype">int</span> test)
<a name="l02850"></a>02850 {
<a name="l02851"></a>02851     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *select;
<a name="l02852"></a>02852     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../d1/d13/node__edit_8c.html#a9cdcb7eef2f58b3f651ea7b44a536605">ed_node_link_conditions</a>(sa, &amp;select);
<a name="l02853"></a>02853     <a class="code" href="../../dc/d21/structbNodeLink.html">bNodeLink</a> *<a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>, *selink=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02854"></a>02854     <span class="keywordtype">float</span> mcoords[6][2];
<a name="l02855"></a>02855     
<a name="l02856"></a>02856     <span class="keywordflow">if</span> (snode==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l02857"></a>02857     
<a name="l02858"></a>02858     <span class="comment">/* clear flags */</span>
<a name="l02859"></a>02859     <span class="keywordflow">for</span> (link= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link=link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>)
<a name="l02860"></a>02860         link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#abd5477bf5dc782c73d15e01f696107ee">flag</a> &amp;= ~<a class="code" href="../../d3/d27/DNA__node__types_8h.html#ad8f37257924c25f9e394fa32b6c2c8d5">NODE_LINKFLAG_HILITE</a>;
<a name="l02861"></a>02861     
<a name="l02862"></a>02862     <span class="keywordflow">if</span> (test==0) <span class="keywordflow">return</span>;
<a name="l02863"></a>02863     
<a name="l02864"></a>02864     <span class="comment">/* okay, there&#39;s 1 node, without links, now intersect */</span>
<a name="l02865"></a>02865     mcoords[0][0]= select-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>;
<a name="l02866"></a>02866     mcoords[0][1]= select-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>;
<a name="l02867"></a>02867     mcoords[1][0]= select-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>;
<a name="l02868"></a>02868     mcoords[1][1]= select-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>;
<a name="l02869"></a>02869     mcoords[2][0]= select-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>;
<a name="l02870"></a>02870     mcoords[2][1]= select-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>;
<a name="l02871"></a>02871     mcoords[3][0]= select-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>;
<a name="l02872"></a>02872     mcoords[3][1]= select-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>;
<a name="l02873"></a>02873     mcoords[4][0]= select-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>;
<a name="l02874"></a>02874     mcoords[4][1]= select-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>;
<a name="l02875"></a>02875     mcoords[5][0]= select-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>;
<a name="l02876"></a>02876     mcoords[5][1]= select-&gt;<a class="code" href="../../dc/daa/structbNode.html#a6cb83e24c3439b5829dd8620b443cb63">totr</a>.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>;
<a name="l02877"></a>02877     
<a name="l02878"></a>02878     <span class="comment">/* we only tag a single link for intersect now */</span>
<a name="l02879"></a>02879     <span class="comment">/* idea; use header dist when more? */</span>
<a name="l02880"></a>02880     <span class="keywordflow">for</span> (link= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ad92d85963902f1a5246be5c67474bdd9">links</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; link; link=link-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#a1a0227118b3be70fe9eb04a3fdfa8240">next</a>) {
<a name="l02881"></a>02881         
<a name="l02882"></a>02882         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d13/node__edit_8c.html#aa8e8b66590200f4bec24c6679c10290e">cut_links_intersect</a>(link, mcoords, 5)) { <span class="comment">/* intersect code wants edges */</span>
<a name="l02883"></a>02883             <span class="keywordflow">if</span> (selink)
<a name="l02884"></a>02884                 <span class="keywordflow">break</span>;
<a name="l02885"></a>02885             selink= <a class="code" href="../../d0/dea/sp__coletree_8c.html#aaa63f127f8b967960d824c4cf6e93ca0">link</a>;
<a name="l02886"></a>02886         }
<a name="l02887"></a>02887     }
<a name="l02888"></a>02888         
<a name="l02889"></a>02889     <span class="keywordflow">if</span> (link==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; selink)
<a name="l02890"></a>02890         selink-&gt;<a class="code" href="../../dc/d21/structbNodeLink.html#abd5477bf5dc782c73d15e01f696107ee">flag</a> |= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#ad8f37257924c25f9e394fa32b6c2c8d5">NODE_LINKFLAG_HILITE</a>;
<a name="l02891"></a>02891 }
<a name="l02892"></a>02892 
<a name="l02893"></a>02893 
<a name="l02894"></a>02894 <span class="comment">/* ******************************** */</span>
<a name="l02895"></a>02895 <span class="comment">// XXX some code needing updating to operators...</span>
<a name="l02896"></a>02896 
<a name="l02897"></a>02897 
<a name="l02898"></a>02898 <span class="comment">/* goes over all scenes, reads render layers */</span>
<a name="l02899"></a><a class="code" href="../../d1/d13/node__edit_8c.html#aaf863bccf05748a24245947cd7049e6c">02899</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#aaf863bccf05748a24245947cd7049e6c">node_read_renderlayers_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l02900"></a>02900 {
<a name="l02901"></a>02901     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C);
<a name="l02902"></a>02902     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l02903"></a>02903     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *curscene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C), *scene;
<a name="l02904"></a>02904     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l02905"></a>02905 
<a name="l02906"></a>02906     <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l02907"></a>02907 
<a name="l02908"></a>02908     <span class="comment">/* first tag scenes unread */</span>
<a name="l02909"></a>02909     <span class="keywordflow">for</span> (scene= bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a976062774f867fa0f917c23f2ec331bb">scene</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; scene; scene= scene-&gt;id.next)
<a name="l02910"></a>02910         scene-&gt;id.flag |= <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a41fa8f648966e669ab4da5b359bd7d57">LIB_DOIT</a>;
<a name="l02911"></a>02911 
<a name="l02912"></a>02912     <span class="keywordflow">for</span> (node= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l02913"></a>02913         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#ad757ff9a25034f9e939a65aaea8d1cce">CMP_NODE_R_LAYERS</a>) {
<a name="l02914"></a>02914             <a class="code" href="../../d8/d7e/structID.html">ID</a> *<span class="keywordtype">id</span>= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>;
<a name="l02915"></a>02915             <span class="keywordflow">if</span> (id-&gt;<a class="code" href="../../d8/d7e/structID.html#aaa0124bd1f312b0d778e1e0de8b8be9f">flag</a> &amp; <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a41fa8f648966e669ab4da5b359bd7d57">LIB_DOIT</a>) {
<a name="l02916"></a>02916                 <a class="code" href="../../d8/dfd/RE__pipeline_8h.html#acd871e7bfd10b82d3821853dfcee522e">RE_ReadRenderResult</a>(curscene, (<a class="code" href="../../d9/d27/structScene.html">Scene</a> *)<span class="keywordtype">id</span>);
<a name="l02917"></a>02917                 <a class="code" href="../../d4/d91/BKE__node_8h.html#ab1865501b049a261fc9ac4ce5e9e9e80">ntreeCompositTagRender</a>((<a class="code" href="../../d9/d27/structScene.html">Scene</a> *)<span class="keywordtype">id</span>);
<a name="l02918"></a>02918                 <span class="keywordtype">id</span>-&gt;flag &amp;= ~<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a41fa8f648966e669ab4da5b359bd7d57">LIB_DOIT</a>;
<a name="l02919"></a>02919             }
<a name="l02920"></a>02920         }
<a name="l02921"></a>02921     }
<a name="l02922"></a>02922     
<a name="l02923"></a>02923     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l02924"></a>02924     <a class="code" href="../../d1/d13/node__edit_8c.html#addc9fdee9fc2340eedb472e61a7b9b18">snode_dag_update</a>(C, snode);
<a name="l02925"></a>02925 
<a name="l02926"></a>02926     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02927"></a>02927 }
<a name="l02928"></a>02928 
<a name="l02929"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a3212f0e07d336684a28f110890ff1fc4">02929</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ad154f69cd990ae072d96002d72f95bec">NODE_OT_read_renderlayers</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02930"></a>02930 {
<a name="l02931"></a>02931     
<a name="l02932"></a>02932     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Read Render Layers&quot;</span>;
<a name="l02933"></a>02933     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_read_renderlayers&quot;</span>;
<a name="l02934"></a>02934     
<a name="l02935"></a>02935     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#aaf863bccf05748a24245947cd7049e6c">node_read_renderlayers_exec</a>;
<a name="l02936"></a>02936     
<a name="l02937"></a>02937     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a6ccb546628222c2bc2e034b9352a52d1">composite_node_active</a>;
<a name="l02938"></a>02938     
<a name="l02939"></a>02939     <span class="comment">/* flags */</span>
<a name="l02940"></a>02940     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = 0;
<a name="l02941"></a>02941 }
<a name="l02942"></a>02942 
<a name="l02943"></a><a class="code" href="../../d1/d13/node__edit_8c.html#ace90aed62130db6bed51467dd5792497">02943</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ace90aed62130db6bed51467dd5792497">node_read_fullsamplelayers_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l02944"></a>02944 {
<a name="l02945"></a>02945     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C);
<a name="l02946"></a>02946     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l02947"></a>02947     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *curscene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l02948"></a>02948     <a class="code" href="../../d6/d7a/structRender.html">Render</a> *re= <a class="code" href="../../d8/dfd/RE__pipeline_8h.html#aa539d2c227f40725b93fe2df94a76bd1">RE_NewRender</a>(curscene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>);
<a name="l02949"></a>02949 
<a name="l02950"></a>02950     <a class="code" href="../../de/d3c/wm__cursors_8c.html#ae5b57427153f1f60f6638a537465c805">WM_cursor_wait</a>(1);
<a name="l02951"></a>02951     <a class="code" href="../../d8/dfd/RE__pipeline_8h.html#aa5c11778b0f65d46d794077feac9dc3f">RE_MergeFullSample</a>(re, bmain, curscene, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>);
<a name="l02952"></a>02952     <a class="code" href="../../de/d3c/wm__cursors_8c.html#ae5b57427153f1f60f6638a537465c805">WM_cursor_wait</a>(0);
<a name="l02953"></a>02953 
<a name="l02954"></a>02954     <span class="comment">/* note we are careful to send the right notifier, as otherwise the</span>
<a name="l02955"></a>02955 <span class="comment">     * compositor would reexecute and overwrite the full sample result */</span>
<a name="l02956"></a>02956     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a61261a6b5ea948eee6d42c7e7ee18166">NC_SCENE</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a457da89ce61565509b622e12c3a706bf">ND_COMPO_RESULT</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02957"></a>02957 
<a name="l02958"></a>02958     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l02959"></a>02959 }
<a name="l02960"></a>02960 
<a name="l02961"></a>02961 
<a name="l02962"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a7abfe7e1bbd45cc462f3942134e453fe">02962</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#aeb568317312918bad19876711b896854">NODE_OT_read_fullsamplelayers</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l02963"></a>02963 {
<a name="l02964"></a>02964     
<a name="l02965"></a>02965     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Read Full Sample Layers&quot;</span>;
<a name="l02966"></a>02966     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_read_fullsamplelayers&quot;</span>;
<a name="l02967"></a>02967     
<a name="l02968"></a>02968     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#ace90aed62130db6bed51467dd5792497">node_read_fullsamplelayers_exec</a>;
<a name="l02969"></a>02969     
<a name="l02970"></a>02970     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a6ccb546628222c2bc2e034b9352a52d1">composite_node_active</a>;
<a name="l02971"></a>02971     
<a name="l02972"></a>02972     <span class="comment">/* flags */</span>
<a name="l02973"></a>02973     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = 0;
<a name="l02974"></a>02974 }
<a name="l02975"></a>02975 
<a name="l02976"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a8f49cd3fb9cb7a0e5d917f51cd1da143">02976</a> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a8f49cd3fb9cb7a0e5d917f51cd1da143">node_render_changed_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l02977"></a>02977 {
<a name="l02978"></a>02978     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *sce= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l02979"></a>02979     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l02980"></a>02980     
<a name="l02981"></a>02981     <span class="keywordflow">for</span> (node= sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l02982"></a>02982         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>==(<a class="code" href="../../d8/d7e/structID.html">ID</a> *)sce &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a37f3b57849379521514f103da2e8ffe3">need_exec</a>) {
<a name="l02983"></a>02983             <span class="keywordflow">break</span>;
<a name="l02984"></a>02984         }
<a name="l02985"></a>02985     }
<a name="l02986"></a>02986     <span class="keywordflow">if</span> (node) {
<a name="l02987"></a>02987         <a class="code" href="../../d1/d51/structSceneRenderLayer.html">SceneRenderLayer</a> *srl= <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a09f13df59d10774f0bcf69a054f9d865">BLI_findlink</a>(&amp;sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a235b7b4bed2d2d73189d3e12c219672a">layers</a>, node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a0a55bc501c3ee93e75427b84f309d9b7">custom1</a>);
<a name="l02988"></a>02988         
<a name="l02989"></a>02989         <span class="keywordflow">if</span> (srl) {
<a name="l02990"></a>02990             <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> op_ptr;
<a name="l02991"></a>02991             
<a name="l02992"></a>02992             <a class="code" href="../../d6/dae/wm__operators_8c.html#ad61b3bbf58d8c110a878750c1b4731a6">WM_operator_properties_create</a>(&amp;op_ptr, <span class="stringliteral">&quot;RENDER_OT_render&quot;</span>);
<a name="l02993"></a>02993             <a class="code" href="../../d3/d10/rna__access_8c.html#a229b9421e0a1d2e5fd079ec933a2d6f5">RNA_string_set</a>(&amp;op_ptr, <span class="stringliteral">&quot;layer&quot;</span>, srl-&gt;<a class="code" href="../../d1/d51/structSceneRenderLayer.html#afd4367d69e75f800a0feb539c8f71c0f">name</a>);
<a name="l02994"></a>02994             <a class="code" href="../../d3/d10/rna__access_8c.html#a229b9421e0a1d2e5fd079ec933a2d6f5">RNA_string_set</a>(&amp;op_ptr, <span class="stringliteral">&quot;scene&quot;</span>, sce-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2);
<a name="l02995"></a>02995             
<a name="l02996"></a>02996             <span class="comment">/* to keep keypositions */</span>
<a name="l02997"></a>02997             sce-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad853a19c13a6c728a07b82fbb9f52bc6">scemode</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ac2be740497e894e7a2b2bc73d9a255fb">R_NO_FRAME_UPDATE</a>;
<a name="l02998"></a>02998             
<a name="l02999"></a>02999             <a class="code" href="../../df/db0/wm__event__system_8c.html#a0208cd65e2ce6a150f2653214cfc57dd">WM_operator_name_call</a>(C, <span class="stringliteral">&quot;RENDER_OT_render&quot;</span>, <a class="code" href="../../d4/ddc/WM__types_8h.html#a871a83db4e53fc6c6872b5ac7cc94f39ab5a7f40e5e55a912d974ab5224a0fa15">WM_OP_INVOKE_DEFAULT</a>, &amp;op_ptr);
<a name="l03000"></a>03000 
<a name="l03001"></a>03001             <a class="code" href="../../d6/dae/wm__operators_8c.html#ae26f29609662ec248827ff991fe8c5cb">WM_operator_properties_free</a>(&amp;op_ptr);
<a name="l03002"></a>03002             
<a name="l03003"></a>03003             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l03004"></a>03004         }
<a name="l03005"></a>03005            
<a name="l03006"></a>03006     }
<a name="l03007"></a>03007     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03008"></a>03008 }
<a name="l03009"></a>03009 
<a name="l03010"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a82e574a904a71afcfdb9375286bb3662">03010</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#acaaaff22defcf98de96e01b16ccf7803">NODE_OT_render_changed</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l03011"></a>03011 {
<a name="l03012"></a>03012     
<a name="l03013"></a>03013     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Render Changed Layer&quot;</span>;
<a name="l03014"></a>03014     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_render_changed&quot;</span>;
<a name="l03015"></a>03015     
<a name="l03016"></a>03016     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a8f49cd3fb9cb7a0e5d917f51cd1da143">node_render_changed_exec</a>;
<a name="l03017"></a>03017     
<a name="l03018"></a>03018     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a6ccb546628222c2bc2e034b9352a52d1">composite_node_active</a>;
<a name="l03019"></a>03019     
<a name="l03020"></a>03020     <span class="comment">/* flags */</span>
<a name="l03021"></a>03021     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = 0;
<a name="l03022"></a>03022 }
<a name="l03023"></a>03023 
<a name="l03024"></a>03024 
<a name="l03025"></a>03025 <span class="comment">/* ****************** Make Group operator ******************* */</span>
<a name="l03026"></a>03026 
<a name="l03027"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a41c06af2c5e706c7623a0f3714688a69">03027</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a41c06af2c5e706c7623a0f3714688a69">node_group_make_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l03028"></a>03028 {
<a name="l03029"></a>03029     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode = <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l03030"></a>03030     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *gnode;
<a name="l03031"></a>03031     
<a name="l03032"></a>03032     <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>!=snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>) {
<a name="l03033"></a>03033         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68aa7428e90bb3916896145e5eb14a7dd7b">RPT_WARNING</a>, <span class="stringliteral">&quot;Can not add a new Group in a Group&quot;</span>);
<a name="l03034"></a>03034         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03035"></a>03035     }
<a name="l03036"></a>03036     
<a name="l03037"></a>03037     <span class="comment">/* for time being... is too complex to handle */</span>
<a name="l03038"></a>03038     <span class="keywordflow">if</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#acc2e52658693034e5b1f8ea667163749">treetype</a>==<a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>) {
<a name="l03039"></a>03039         <span class="keywordflow">for</span> (gnode=snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; gnode; gnode= gnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l03040"></a>03040             <span class="keywordflow">if</span> (gnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>)
<a name="l03041"></a>03041                 <span class="keywordflow">if</span> (gnode-&gt;<a class="code" href="../../dc/daa/structbNode.html#a95416f774e5a5a27105522a1b74e5989">type</a>==<a class="code" href="../../d4/d91/BKE__node_8h.html#ad757ff9a25034f9e939a65aaea8d1cce">CMP_NODE_R_LAYERS</a>)
<a name="l03042"></a>03042                     <span class="keywordflow">break</span>;
<a name="l03043"></a>03043         }
<a name="l03044"></a>03044         
<a name="l03045"></a>03045         <span class="keywordflow">if</span> (gnode) {
<a name="l03046"></a>03046             <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68aa7428e90bb3916896145e5eb14a7dd7b">RPT_WARNING</a>, <span class="stringliteral">&quot;Can not add RenderLayer in a Group&quot;</span>);
<a name="l03047"></a>03047             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03048"></a>03048         }
<a name="l03049"></a>03049     }
<a name="l03050"></a>03050 
<a name="l03051"></a>03051     <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l03052"></a>03052     
<a name="l03053"></a>03053     gnode= <a class="code" href="../../d4/d91/BKE__node_8h.html#a2ced7ddfadf9c865e5b38848f292682a">node_group_make_from_selected</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>);
<a name="l03054"></a>03054     <span class="keywordflow">if</span> (gnode==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l03055"></a>03055         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68aa7428e90bb3916896145e5eb14a7dd7b">RPT_WARNING</a>, <span class="stringliteral">&quot;Can not make Group&quot;</span>);
<a name="l03056"></a>03056         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03057"></a>03057     }
<a name="l03058"></a>03058     <span class="keywordflow">else</span> {
<a name="l03059"></a>03059         <a class="code" href="../../d4/d91/BKE__node_8h.html#aef5a94d758aa610c384ae08b358b0bbc">nodeSetActive</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>, gnode);
<a name="l03060"></a>03060         <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>);
<a name="l03061"></a>03061     }
<a name="l03062"></a>03062     
<a name="l03063"></a>03063     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l03064"></a>03064     <a class="code" href="../../d1/d13/node__edit_8c.html#addc9fdee9fc2340eedb472e61a7b9b18">snode_dag_update</a>(C, snode);
<a name="l03065"></a>03065     
<a name="l03066"></a>03066     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l03067"></a>03067 }
<a name="l03068"></a>03068 
<a name="l03069"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a17e300afea84e3eab1b300259ec79b6b">03069</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#aa8fb408c699665c8e4e38e38ad937dbc">NODE_OT_group_make</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l03070"></a>03070 {
<a name="l03071"></a>03071     <span class="comment">/* identifiers */</span>
<a name="l03072"></a>03072     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Group&quot;</span>;
<a name="l03073"></a>03073     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Make group from selected nodes&quot;</span>;
<a name="l03074"></a>03074     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_group_make&quot;</span>;
<a name="l03075"></a>03075     
<a name="l03076"></a>03076     <span class="comment">/* api callbacks */</span>
<a name="l03077"></a>03077     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a41c06af2c5e706c7623a0f3714688a69">node_group_make_exec</a>;
<a name="l03078"></a>03078     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l03079"></a>03079     
<a name="l03080"></a>03080     <span class="comment">/* flags */</span>
<a name="l03081"></a>03081     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l03082"></a>03082 }
<a name="l03083"></a>03083 
<a name="l03084"></a>03084 <span class="comment">/* ****************** Hide operator *********************** */</span>
<a name="l03085"></a>03085 
<a name="l03086"></a><a class="code" href="../../d1/d13/node__edit_8c.html#af67249b9de6581ab03ecd9e94a2b7701">03086</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#af67249b9de6581ab03ecd9e94a2b7701">node_flag_toggle_exec</a>(<a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode, <span class="keywordtype">int</span> toggle_flag)
<a name="l03087"></a>03087 {
<a name="l03088"></a>03088     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l03089"></a>03089     <span class="keywordtype">int</span> tot_eq= 0, tot_neq= 0;
<a name="l03090"></a>03090 
<a name="l03091"></a>03091     <span class="comment">/* Toggles the flag on all selected nodes.</span>
<a name="l03092"></a>03092 <span class="comment">     * If the flag is set on all nodes it is unset.</span>
<a name="l03093"></a>03093 <span class="comment">     * If the flag is not set on all nodes, it is set.</span>
<a name="l03094"></a>03094 <span class="comment">     */</span>
<a name="l03095"></a>03095     <span class="keywordflow">for</span> (node= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l03096"></a>03096         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l03097"></a>03097             
<a name="l03098"></a>03098             <span class="keywordflow">if</span> (toggle_flag== <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa3a4e7cc34cf1a7854820ce5ca7b4184">NODE_PREVIEW</a> &amp;&amp; (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a2ff36f56a88a9c87b5ec4bbe7a67b79f">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa3a4e7cc34cf1a7854820ce5ca7b4184">NODE_PREVIEW</a>)==0)
<a name="l03099"></a>03099                 <span class="keywordflow">continue</span>;
<a name="l03100"></a>03100             <span class="keywordflow">if</span> (toggle_flag== <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a0925ab7ab82c3540f1bb95a217e2367e">NODE_OPTIONS</a> &amp;&amp; (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a2ff36f56a88a9c87b5ec4bbe7a67b79f">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a0925ab7ab82c3540f1bb95a217e2367e">NODE_OPTIONS</a>)==0)
<a name="l03101"></a>03101                 <span class="keywordflow">continue</span>;
<a name="l03102"></a>03102             
<a name="l03103"></a>03103             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; toggle_flag)
<a name="l03104"></a>03104                 tot_eq++;
<a name="l03105"></a>03105             <span class="keywordflow">else</span>
<a name="l03106"></a>03106                 tot_neq++;
<a name="l03107"></a>03107         }
<a name="l03108"></a>03108     }
<a name="l03109"></a>03109     <span class="keywordflow">for</span> (node= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l03110"></a>03110         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l03111"></a>03111             
<a name="l03112"></a>03112             <span class="keywordflow">if</span> (toggle_flag== <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa3a4e7cc34cf1a7854820ce5ca7b4184">NODE_PREVIEW</a> &amp;&amp; (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a2ff36f56a88a9c87b5ec4bbe7a67b79f">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa3a4e7cc34cf1a7854820ce5ca7b4184">NODE_PREVIEW</a>)==0)
<a name="l03113"></a>03113                 <span class="keywordflow">continue</span>;
<a name="l03114"></a>03114             <span class="keywordflow">if</span> (toggle_flag== <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a0925ab7ab82c3540f1bb95a217e2367e">NODE_OPTIONS</a> &amp;&amp; (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#a2ff36f56a88a9c87b5ec4bbe7a67b79f">flag</a> &amp; <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a0925ab7ab82c3540f1bb95a217e2367e">NODE_OPTIONS</a>)==0)
<a name="l03115"></a>03115                 <span class="keywordflow">continue</span>;
<a name="l03116"></a>03116             
<a name="l03117"></a>03117             <span class="keywordflow">if</span> ( (tot_eq &amp;&amp; tot_neq) || tot_eq==0)
<a name="l03118"></a>03118                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> |= toggle_flag;
<a name="l03119"></a>03119             <span class="keywordflow">else</span>
<a name="l03120"></a>03120                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp;= ~toggle_flag;
<a name="l03121"></a>03121         }
<a name="l03122"></a>03122     }
<a name="l03123"></a>03123 }
<a name="l03124"></a>03124 
<a name="l03125"></a><a class="code" href="../../d1/d13/node__edit_8c.html#af9cdb5eaca7a3f745c830b1f00212de8">03125</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#af9cdb5eaca7a3f745c830b1f00212de8">node_hide_toggle_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l03126"></a>03126 {
<a name="l03127"></a>03127     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l03128"></a>03128     
<a name="l03129"></a>03129     <span class="comment">/* sanity checking (poll callback checks this already) */</span>
<a name="l03130"></a>03130     <span class="keywordflow">if</span> ((snode == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
<a name="l03131"></a>03131         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03132"></a>03132     
<a name="l03133"></a>03133     <a class="code" href="../../d1/d13/node__edit_8c.html#af67249b9de6581ab03ecd9e94a2b7701">node_flag_toggle_exec</a>(snode, <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a9514398b17ede671295e5c873e7bb3df">NODE_HIDDEN</a>);
<a name="l03134"></a>03134     
<a name="l03135"></a>03135     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l03136"></a>03136     
<a name="l03137"></a>03137     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l03138"></a>03138 }
<a name="l03139"></a>03139 
<a name="l03140"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#ace4620d747973d111a626b99b2a51ba2">03140</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a06e13ff46b594169c38da40546ff4c47">NODE_OT_hide_toggle</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l03141"></a>03141 {
<a name="l03142"></a>03142     <span class="comment">/* identifiers */</span>
<a name="l03143"></a>03143     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Hide&quot;</span>;
<a name="l03144"></a>03144     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Toggle hiding of selected nodes&quot;</span>;
<a name="l03145"></a>03145     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_hide_toggle&quot;</span>;
<a name="l03146"></a>03146     
<a name="l03147"></a>03147     <span class="comment">/* callbacks */</span>
<a name="l03148"></a>03148     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#af9cdb5eaca7a3f745c830b1f00212de8">node_hide_toggle_exec</a>;
<a name="l03149"></a>03149     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l03150"></a>03150 
<a name="l03151"></a>03151     <span class="comment">/* flags */</span>
<a name="l03152"></a>03152     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l03153"></a>03153 }
<a name="l03154"></a>03154 
<a name="l03155"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a9c7ecdadc4c680577edca885e832f30f">03155</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a9c7ecdadc4c680577edca885e832f30f">node_preview_toggle_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l03156"></a>03156 {
<a name="l03157"></a>03157     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l03158"></a>03158 
<a name="l03159"></a>03159     <span class="comment">/* sanity checking (poll callback checks this already) */</span>
<a name="l03160"></a>03160     <span class="keywordflow">if</span> ((snode == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
<a name="l03161"></a>03161         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03162"></a>03162 
<a name="l03163"></a>03163     <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l03164"></a>03164 
<a name="l03165"></a>03165     <a class="code" href="../../d1/d13/node__edit_8c.html#af67249b9de6581ab03ecd9e94a2b7701">node_flag_toggle_exec</a>(snode, <a class="code" href="../../d3/d27/DNA__node__types_8h.html#aa3a4e7cc34cf1a7854820ce5ca7b4184">NODE_PREVIEW</a>);
<a name="l03166"></a>03166 
<a name="l03167"></a>03167     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l03168"></a>03168 
<a name="l03169"></a>03169     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l03170"></a>03170 }
<a name="l03171"></a>03171 
<a name="l03172"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#ae6d686f5d5453f5db57a1bd3074de13f">03172</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a577aadbb6048cb5c95df0e930deca0b3">NODE_OT_preview_toggle</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l03173"></a>03173 {
<a name="l03174"></a>03174     <span class="comment">/* identifiers */</span>
<a name="l03175"></a>03175     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Toggle Node Preview&quot;</span>;
<a name="l03176"></a>03176     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Toggle preview display for selected nodes&quot;</span>;
<a name="l03177"></a>03177     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_preview_toggle&quot;</span>;
<a name="l03178"></a>03178 
<a name="l03179"></a>03179     <span class="comment">/* callbacks */</span>
<a name="l03180"></a>03180     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a9c7ecdadc4c680577edca885e832f30f">node_preview_toggle_exec</a>;
<a name="l03181"></a>03181     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l03182"></a>03182 
<a name="l03183"></a>03183     <span class="comment">/* flags */</span>
<a name="l03184"></a>03184     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l03185"></a>03185 }
<a name="l03186"></a>03186 
<a name="l03187"></a><a class="code" href="../../d1/d13/node__edit_8c.html#ae2ad4d60a74cdd6ffa34f9b0bf60342a">03187</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ae2ad4d60a74cdd6ffa34f9b0bf60342a">node_options_toggle_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l03188"></a>03188 {
<a name="l03189"></a>03189     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l03190"></a>03190 
<a name="l03191"></a>03191     <span class="comment">/* sanity checking (poll callback checks this already) */</span>
<a name="l03192"></a>03192     <span class="keywordflow">if</span> ((snode == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
<a name="l03193"></a>03193         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03194"></a>03194 
<a name="l03195"></a>03195     <a class="code" href="../../d1/d13/node__edit_8c.html#af67249b9de6581ab03ecd9e94a2b7701">node_flag_toggle_exec</a>(snode, <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a0925ab7ab82c3540f1bb95a217e2367e">NODE_OPTIONS</a>);
<a name="l03196"></a>03196 
<a name="l03197"></a>03197     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l03198"></a>03198 
<a name="l03199"></a>03199     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l03200"></a>03200 }
<a name="l03201"></a>03201 
<a name="l03202"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a0c8a9b012872ece7bc2b3fae9d4e07dd">03202</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ab733434bcc2382935002ef869665836a">NODE_OT_options_toggle</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l03203"></a>03203 {
<a name="l03204"></a>03204     <span class="comment">/* identifiers */</span>
<a name="l03205"></a>03205     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Toggle Node Options&quot;</span>;
<a name="l03206"></a>03206     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Toggle option buttons display for selected nodes&quot;</span>;
<a name="l03207"></a>03207     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_options_toggle&quot;</span>;
<a name="l03208"></a>03208 
<a name="l03209"></a>03209     <span class="comment">/* callbacks */</span>
<a name="l03210"></a>03210     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#ae2ad4d60a74cdd6ffa34f9b0bf60342a">node_options_toggle_exec</a>;
<a name="l03211"></a>03211     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l03212"></a>03212 
<a name="l03213"></a>03213     <span class="comment">/* flags */</span>
<a name="l03214"></a>03214     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l03215"></a>03215 }
<a name="l03216"></a>03216 
<a name="l03217"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a0ab609a313e9530bb6a42010ff3dd6b6">03217</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a0ab609a313e9530bb6a42010ff3dd6b6">node_socket_toggle_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l03218"></a>03218 {
<a name="l03219"></a>03219     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l03220"></a>03220     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l03221"></a>03221     <span class="keywordtype">int</span> hidden;
<a name="l03222"></a>03222 
<a name="l03223"></a>03223     <span class="comment">/* sanity checking (poll callback checks this already) */</span>
<a name="l03224"></a>03224     <span class="keywordflow">if</span> ((snode == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a> == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
<a name="l03225"></a>03225         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03226"></a>03226 
<a name="l03227"></a>03227     <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l03228"></a>03228 
<a name="l03229"></a>03229     <span class="comment">/* Toggle for all selected nodes */</span>
<a name="l03230"></a>03230     hidden = 0;
<a name="l03231"></a>03231     <span class="keywordflow">for</span> (node= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l03232"></a>03232         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l03233"></a>03233             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d13/node__edit_8c.html#aeeb0b50edcd3ac751beaa31dac85f91b">node_has_hidden_sockets</a>(node)) {
<a name="l03234"></a>03234                 hidden= 1;
<a name="l03235"></a>03235                 <span class="keywordflow">break</span>;
<a name="l03236"></a>03236             }
<a name="l03237"></a>03237         }
<a name="l03238"></a>03238     }
<a name="l03239"></a>03239     
<a name="l03240"></a>03240     <span class="keywordflow">for</span> (node= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l03241"></a>03241         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l03242"></a>03242             <a class="code" href="../../d1/d13/node__edit_8c.html#ada971c9141ec30833ccf790bcd03c0d2">node_set_hidden_sockets</a>(snode, node, !hidden);
<a name="l03243"></a>03243         }
<a name="l03244"></a>03244     }
<a name="l03245"></a>03245 
<a name="l03246"></a>03246     <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l03247"></a>03247 
<a name="l03248"></a>03248     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l03249"></a>03249 
<a name="l03250"></a>03250     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l03251"></a>03251 }
<a name="l03252"></a>03252 
<a name="l03253"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a081c6eb6a11bc96c3a7ae5775d69ca6b">03253</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ad60507908a95b0eaf93c0a253b6ce5af">NODE_OT_hide_socket_toggle</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l03254"></a>03254 {
<a name="l03255"></a>03255     <span class="comment">/* identifiers */</span>
<a name="l03256"></a>03256     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Toggle Hidden Node Sockets&quot;</span>;
<a name="l03257"></a>03257     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Toggle unused node socket display&quot;</span>;
<a name="l03258"></a>03258     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_hide_socket_toggle&quot;</span>;
<a name="l03259"></a>03259 
<a name="l03260"></a>03260     <span class="comment">/* callbacks */</span>
<a name="l03261"></a>03261     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a0ab609a313e9530bb6a42010ff3dd6b6">node_socket_toggle_exec</a>;
<a name="l03262"></a>03262     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l03263"></a>03263 
<a name="l03264"></a>03264     <span class="comment">/* flags */</span>
<a name="l03265"></a>03265     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l03266"></a>03266 }
<a name="l03267"></a>03267 
<a name="l03268"></a>03268 <span class="comment">/* ****************** Mute operator *********************** */</span>
<a name="l03269"></a>03269 
<a name="l03270"></a><a class="code" href="../../d1/d13/node__edit_8c.html#ae13795cc3b271d1f97ff6d78547fcca4">03270</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ae13795cc3b271d1f97ff6d78547fcca4">node_mute_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l03271"></a>03271 {
<a name="l03272"></a>03272     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l03273"></a>03273     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l03274"></a>03274 
<a name="l03275"></a>03275     <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l03276"></a>03276 
<a name="l03277"></a>03277     <span class="keywordflow">for</span> (node= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>) {
<a name="l03278"></a>03278         <span class="comment">/* Only allow muting of nodes having a mute func! */</span>
<a name="l03279"></a>03279         <span class="keywordflow">if</span> ((node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) &amp;&amp; node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a3d71052273338b7b000f2010527d2613">typeinfo</a>-&gt;<a class="code" href="../../dd/d0c/structbNodeType.html#ac0302c3d0d72ca5c6fefa585eae01ae7">internal_connect</a>) {
<a name="l03280"></a>03280             node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> ^= <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a5ac24732c48b9f55ca854d76228c0ae5">NODE_MUTED</a>;
<a name="l03281"></a>03281             <a class="code" href="../../d1/d13/node__edit_8c.html#a3cfedc979a13196864e0774f29f9419e">snode_update</a>(snode, node);
<a name="l03282"></a>03282         }
<a name="l03283"></a>03283     }
<a name="l03284"></a>03284     
<a name="l03285"></a>03285     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l03286"></a>03286     <a class="code" href="../../d1/d13/node__edit_8c.html#addc9fdee9fc2340eedb472e61a7b9b18">snode_dag_update</a>(C, snode);
<a name="l03287"></a>03287     
<a name="l03288"></a>03288     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l03289"></a>03289 }
<a name="l03290"></a>03290 
<a name="l03291"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a0f887c1b77c57cd110b41ad70469be9e">03291</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a9c41db49af962c8263e67b10df865cd7">NODE_OT_mute_toggle</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l03292"></a>03292 {
<a name="l03293"></a>03293     <span class="comment">/* identifiers */</span>
<a name="l03294"></a>03294     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Toggle Node Mute&quot;</span>;
<a name="l03295"></a>03295     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Toggle muting of the nodes&quot;</span>;
<a name="l03296"></a>03296     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_mute_toggle&quot;</span>;
<a name="l03297"></a>03297     
<a name="l03298"></a>03298     <span class="comment">/* callbacks */</span>
<a name="l03299"></a>03299     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#ae13795cc3b271d1f97ff6d78547fcca4">node_mute_exec</a>;
<a name="l03300"></a>03300     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l03301"></a>03301     
<a name="l03302"></a>03302     <span class="comment">/* flags */</span>
<a name="l03303"></a>03303     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l03304"></a>03304 }
<a name="l03305"></a>03305 
<a name="l03306"></a>03306 <span class="comment">/* ****************** Delete operator ******************* */</span>
<a name="l03307"></a>03307 
<a name="l03308"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a28484ed997fb0ebdc89637afc3157ce2">03308</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a28484ed997fb0ebdc89637afc3157ce2">node_delete_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l03309"></a>03309 {
<a name="l03310"></a>03310     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l03311"></a>03311     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l03312"></a>03312     
<a name="l03313"></a>03313     <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l03314"></a>03314 
<a name="l03315"></a>03315     <span class="keywordflow">for</span> (node= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= next) {
<a name="l03316"></a>03316         next= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>;
<a name="l03317"></a>03317         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l03318"></a>03318             <span class="comment">/* check id user here, nodeFreeNode is called for free dbase too */</span>
<a name="l03319"></a>03319             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>)
<a name="l03320"></a>03320                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--;
<a name="l03321"></a>03321             <a class="code" href="../../d4/d91/BKE__node_8h.html#a6913c62630bd85b7514bebc6e58c5d51">nodeFreeNode</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, node);
<a name="l03322"></a>03322         }
<a name="l03323"></a>03323     }
<a name="l03324"></a>03324     
<a name="l03325"></a>03325     <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l03326"></a>03326 
<a name="l03327"></a>03327     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l03328"></a>03328     <a class="code" href="../../d1/d13/node__edit_8c.html#addc9fdee9fc2340eedb472e61a7b9b18">snode_dag_update</a>(C, snode);
<a name="l03329"></a>03329     
<a name="l03330"></a>03330     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l03331"></a>03331 }
<a name="l03332"></a>03332 
<a name="l03333"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a772ae6d1fb25683229fd395275ba0d70">03333</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a06d8440a1bdddbf2f8ab5b4103679a1e">NODE_OT_delete</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l03334"></a>03334 {
<a name="l03335"></a>03335     <span class="comment">/* identifiers */</span>
<a name="l03336"></a>03336     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Delete&quot;</span>;
<a name="l03337"></a>03337     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Delete selected nodes&quot;</span>;
<a name="l03338"></a>03338     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_delete&quot;</span>;
<a name="l03339"></a>03339     
<a name="l03340"></a>03340     <span class="comment">/* api callbacks */</span>
<a name="l03341"></a>03341     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a28484ed997fb0ebdc89637afc3157ce2">node_delete_exec</a>;
<a name="l03342"></a>03342     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l03343"></a>03343     
<a name="l03344"></a>03344     <span class="comment">/* flags */</span>
<a name="l03345"></a>03345     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l03346"></a>03346 }
<a name="l03347"></a>03347 
<a name="l03348"></a>03348 <span class="comment">/* ****************** Delete with reconnect ******************* */</span>
<a name="l03349"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a36fff1a72a7d0602fd4a4506cb62b081">03349</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a36fff1a72a7d0602fd4a4506cb62b081">node_delete_reconnect_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l03350"></a>03350 {
<a name="l03351"></a>03351     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l03352"></a>03352     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node, *<a class="code" href="../../d3/d41/mathutils__noise_8c.html#ac68daf2bcc2adb77f62b5dd17eb769b7">next</a>;
<a name="l03353"></a>03353 
<a name="l03354"></a>03354     <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l03355"></a>03355 
<a name="l03356"></a>03356     <span class="keywordflow">for</span> (node= snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#ac928f4eb3314d2b9ce2d9c6a49c1f233">nodes</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; node; node= next) {
<a name="l03357"></a>03357         next= node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a978093ed3cb2529e1f932bc8c5081968">next</a>;
<a name="l03358"></a>03358         <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a984514ad4ed611a3c6b8bc8f6fec6b76">flag</a> &amp; <a class="code" href="../../db/d17/fcurve_8c.html#a53dc4af00adc7b3b4d12eafb71596dfc">SELECT</a>) {
<a name="l03359"></a>03359             <a class="code" href="../../d4/d91/BKE__node_8h.html#a28c5a2c4425a5a23de80e2715a6bb816">nodeInternalRelink</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, node);
<a name="l03360"></a>03360             
<a name="l03361"></a>03361             <span class="comment">/* check id user here, nodeFreeNode is called for free dbase too */</span>
<a name="l03362"></a>03362             <span class="keywordflow">if</span> (node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>)
<a name="l03363"></a>03363                 node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a>-&gt;<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--;
<a name="l03364"></a>03364             <a class="code" href="../../d4/d91/BKE__node_8h.html#a6913c62630bd85b7514bebc6e58c5d51">nodeFreeNode</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>, node);
<a name="l03365"></a>03365         }
<a name="l03366"></a>03366     }
<a name="l03367"></a>03367 
<a name="l03368"></a>03368     <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>);
<a name="l03369"></a>03369 
<a name="l03370"></a>03370     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l03371"></a>03371     <a class="code" href="../../d1/d13/node__edit_8c.html#addc9fdee9fc2340eedb472e61a7b9b18">snode_dag_update</a>(C, snode);
<a name="l03372"></a>03372 
<a name="l03373"></a>03373     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l03374"></a>03374 }
<a name="l03375"></a>03375 
<a name="l03376"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#ac0db0b43246531f9aa6668897b9436d9">03376</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a1306dc9a2a9145ca60762188facbc1cb">NODE_OT_delete_reconnect</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l03377"></a>03377 {
<a name="l03378"></a>03378     <span class="comment">/* identifiers */</span>
<a name="l03379"></a>03379     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Delete with reconnect&quot;</span>;
<a name="l03380"></a>03380     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Delete nodes; will reconnect nodes as if deletion was muted&quot;</span>;
<a name="l03381"></a>03381     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_delete_reconnect&quot;</span>;
<a name="l03382"></a>03382 
<a name="l03383"></a>03383     <span class="comment">/* api callbacks */</span>
<a name="l03384"></a>03384     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a36fff1a72a7d0602fd4a4506cb62b081">node_delete_reconnect_exec</a>;
<a name="l03385"></a>03385     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l03386"></a>03386 
<a name="l03387"></a>03387     <span class="comment">/* flags */</span>
<a name="l03388"></a>03388     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l03389"></a>03389 }
<a name="l03390"></a>03390 
<a name="l03391"></a>03391 <span class="comment">/* ****************** Show Cyclic Dependencies Operator  ******************* */</span>
<a name="l03392"></a>03392 
<a name="l03393"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a48602450393d9dd52059d91c40f0ad70">03393</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a48602450393d9dd52059d91c40f0ad70">node_show_cycles_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l03394"></a>03394 {
<a name="l03395"></a>03395     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l03396"></a>03396     
<a name="l03397"></a>03397     <span class="comment">/* this is just a wrapper around this call... */</span>
<a name="l03398"></a>03398     <a class="code" href="../../d4/d91/BKE__node_8h.html#a6752adcef0b845138957d4c6a1b0e651">ntreeUpdateTree</a>(snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>);
<a name="l03399"></a>03399     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l03400"></a>03400     
<a name="l03401"></a>03401     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l03402"></a>03402 }
<a name="l03403"></a>03403 
<a name="l03404"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a91dd3d40463e6018d59b8c615330eef7">03404</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ac3a254f418a54bc1c226b69f4187874a">NODE_OT_show_cyclic_dependencies</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l03405"></a>03405 {
<a name="l03406"></a>03406     <span class="comment">/* identifiers */</span>
<a name="l03407"></a>03407     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Show Cyclic Dependencies&quot;</span>;
<a name="l03408"></a>03408     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Sort the nodes and show the cyclic dependencies between the nodes&quot;</span>;
<a name="l03409"></a>03409     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_show_cyclic_dependencies&quot;</span>;
<a name="l03410"></a>03410     
<a name="l03411"></a>03411     <span class="comment">/* callbacks */</span>
<a name="l03412"></a>03412     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a48602450393d9dd52059d91c40f0ad70">node_show_cycles_exec</a>;
<a name="l03413"></a>03413     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l03414"></a>03414     
<a name="l03415"></a>03415     <span class="comment">/* flags */</span>
<a name="l03416"></a>03416     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l03417"></a>03417 }
<a name="l03418"></a>03418 
<a name="l03419"></a>03419 <span class="comment">/* ****************** Add File Node Operator  ******************* */</span>
<a name="l03420"></a>03420 
<a name="l03421"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a89d4f0c4bc9e255896438f10c9263be7">03421</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a89d4f0c4bc9e255896438f10c9263be7">node_add_file_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l03422"></a>03422 {
<a name="l03423"></a>03423     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C);
<a name="l03424"></a>03424     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l03425"></a>03425     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l03426"></a>03426     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node;
<a name="l03427"></a>03427     <a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *ima= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03428"></a>03428     <a class="code" href="../../dd/dc3/structbNodeTemplate.html">bNodeTemplate</a> ntemp;
<a name="l03429"></a>03429 
<a name="l03430"></a>03430     <span class="comment">/* check input variables */</span>
<a name="l03431"></a>03431     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;filepath&quot;</span>)) {
<a name="l03432"></a>03432         <span class="keywordtype">char</span> path[<a class="code" href="../../d3/dde/BKE__utildefines_8h.html#a4d71bd743114c866e342b82481760d80">FILE_MAX</a>];
<a name="l03433"></a>03433         <a class="code" href="../../d3/d10/rna__access_8c.html#a810e909d61281bbb2d9fe99f9f2219ab">RNA_string_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;filepath&quot;</span>, path);
<a name="l03434"></a>03434 
<a name="l03435"></a>03435         errno= 0;
<a name="l03436"></a>03436 
<a name="l03437"></a>03437         ima= <a class="code" href="../../d2/d77/BKE__image_8h.html#ada7c3f7a7be3638972a7635a304420a4">BKE_add_image_file</a>(path);
<a name="l03438"></a>03438 
<a name="l03439"></a>03439         <span class="keywordflow">if</span> (!ima) {
<a name="l03440"></a>03440             <a class="code" href="../../d2/d40/BKE__report_8h.html#af25c247b3b620d13cef87ec2bed1698e">BKE_reportf</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Can&#39;t read: \&quot;%s\&quot;, %s&quot;</span>, path, errno ? strerror(errno) : <span class="stringliteral">&quot;Unsupported image format&quot;</span>);
<a name="l03441"></a>03441             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03442"></a>03442         }
<a name="l03443"></a>03443     }
<a name="l03444"></a>03444     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;name&quot;</span>)) {
<a name="l03445"></a>03445         <span class="keywordtype">char</span> <a class="code" href="../../dc/daa/structbNode.html#a5d65cbe1159d2c591a3ba7815817b0c4">name</a>[<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6d7bce2e9ad79af316c9690a5b84b75c">MAX_ID_NAME</a>-2];
<a name="l03446"></a>03446         <a class="code" href="../../d3/d10/rna__access_8c.html#a810e909d61281bbb2d9fe99f9f2219ab">RNA_string_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;name&quot;</span>, name);
<a name="l03447"></a>03447         ima= (<a class="code" href="../../d8/d00/classImage.html" title="32 bit RGBA image.">Image</a> *)<a class="code" href="../../d8/db1/BKE__library_8h.html#acb5f76f4bade78a03b7328ed4944c702">find_id</a>(<span class="stringliteral">&quot;IM&quot;</span>, name);
<a name="l03448"></a>03448 
<a name="l03449"></a>03449         <span class="keywordflow">if</span> (!ima) {
<a name="l03450"></a>03450             <a class="code" href="../../d2/d40/BKE__report_8h.html#af25c247b3b620d13cef87ec2bed1698e">BKE_reportf</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68a77427e7d5e1c0e3f2fbe37425794e319">RPT_ERROR</a>, <span class="stringliteral">&quot;Image named \&quot;%s\&quot;, not found&quot;</span>, name);
<a name="l03451"></a>03451             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03452"></a>03452         }
<a name="l03453"></a>03453     }
<a name="l03454"></a>03454     
<a name="l03455"></a>03455     <a class="code" href="../../d8/d8c/node__intern_8h.html#a9d5edf625cf8e384090aa1b81f4dac30">node_deselect_all</a>(snode);
<a name="l03456"></a>03456     
<a name="l03457"></a>03457     <span class="keywordflow">switch</span> (snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a>-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a39525dc78d484240165cc94275af309a">type</a>) {
<a name="l03458"></a>03458         <span class="keywordflow">case</span> <a class="code" href="../../d3/d27/DNA__node__types_8h.html#adeb0511a8e73dda0bd9c99adfd4edd50">NTREE_SHADER</a>:
<a name="l03459"></a>03459             ntemp.<a class="code" href="../../dd/dc3/structbNodeTemplate.html#a8948f989fe76d9bbfc8c31b10bc4d761">type</a> = <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#accf84320f1bb7a7dc319ad137d395749">SH_NODE_TEX_IMAGE</a>;
<a name="l03460"></a>03460             <span class="keywordflow">break</span>;
<a name="l03461"></a>03461         <span class="keywordflow">case</span> <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a2a2ccfad1cf200204b0fdd594f45de7b">NTREE_TEXTURE</a>:
<a name="l03462"></a>03462             ntemp.<a class="code" href="../../dd/dc3/structbNodeTemplate.html#a8948f989fe76d9bbfc8c31b10bc4d761">type</a> = <a class="code" href="../../d4/d91/BKE__node_8h.html#a93c4ae48bb8d648610cfe6eb0f00e38c">TEX_NODE_IMAGE</a>;
<a name="l03463"></a>03463             <span class="keywordflow">break</span>;
<a name="l03464"></a>03464         <span class="keywordflow">case</span> <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>:
<a name="l03465"></a>03465             ntemp.<a class="code" href="../../dd/dc3/structbNodeTemplate.html#a8948f989fe76d9bbfc8c31b10bc4d761">type</a> = <a class="code" href="../../dc/d4f/rna__nodetree__types_8h.html#a3b39f18a88ab67e0d7065d992f6ea1b0">CMP_NODE_IMAGE</a>;
<a name="l03466"></a>03466             <span class="keywordflow">break</span>;
<a name="l03467"></a>03467         <span class="keywordflow">default</span>:
<a name="l03468"></a>03468             <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03469"></a>03469     }
<a name="l03470"></a>03470     
<a name="l03471"></a>03471     <a class="code" href="../../d6/d53/ED__render_8h.html#a5bd64056444412c65b860fc03acbe00a">ED_preview_kill_jobs</a>(C);
<a name="l03472"></a>03472     
<a name="l03473"></a>03473     node = <a class="code" href="../../d1/d13/node__edit_8c.html#ae165da0231fe29bd0ee616a3ae4f4467">node_add_node</a>(snode, bmain, scene, &amp;ntemp, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#aac12564b7d6feb2bba41b868e33a8b7e">mx</a>, snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a463c64fb2748e53199ba27bf3f7d6ec2">my</a>);
<a name="l03474"></a>03474     
<a name="l03475"></a>03475     <span class="keywordflow">if</span> (!node) {
<a name="l03476"></a>03476         <a class="code" href="../../d2/d40/BKE__report_8h.html#a704625c22b5bb0148eea14635968537a">BKE_report</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#a07dcf0c512e769205201c34c254f4049">reports</a>, <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#ae4f179a72db5cca021a37ec4c6fe4c68aa7428e90bb3916896145e5eb14a7dd7b">RPT_WARNING</a>, <span class="stringliteral">&quot;Could not add an image node&quot;</span>);
<a name="l03477"></a>03477         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03478"></a>03478     }
<a name="l03479"></a>03479     
<a name="l03480"></a>03480     node-&gt;<a class="code" href="../../dc/daa/structbNode.html#a4054a28b64f94943286ab0e0df99afba">id</a> = (<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ima;
<a name="l03481"></a>03481     
<a name="l03482"></a>03482     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l03483"></a>03483     <a class="code" href="../../d1/d13/node__edit_8c.html#addc9fdee9fc2340eedb472e61a7b9b18">snode_dag_update</a>(C, snode);
<a name="l03484"></a>03484     
<a name="l03485"></a>03485     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l03486"></a>03486 }
<a name="l03487"></a>03487 
<a name="l03488"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a09bed7eee8999c360cf95906c1d4bb8a">03488</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a09bed7eee8999c360cf95906c1d4bb8a">node_add_file_invoke</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l03489"></a>03489 {
<a name="l03490"></a>03490     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar= <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l03491"></a>03491     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l03492"></a>03492     
<a name="l03493"></a>03493     <span class="comment">/* convert mouse coordinates to v2d space */</span>
<a name="l03494"></a>03494     <a class="code" href="../../d5/d63/UI__view2d_8h.html#acb43bece9ce784b1daa91efb77069e78">UI_view2d_region_to_view</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a3abcb927aedd966f98e3417897e2c243">v2d</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[0], event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a7ecdf2416014628878116151dcb377f1">mval</a>[1],
<a name="l03495"></a>03495                              &amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#aac12564b7d6feb2bba41b868e33a8b7e">mx</a>, &amp;snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a463c64fb2748e53199ba27bf3f7d6ec2">my</a>);
<a name="l03496"></a>03496     
<a name="l03497"></a>03497     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;filepath&quot;</span>) || <a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;name&quot;</span>))
<a name="l03498"></a>03498         <span class="keywordflow">return</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a89d4f0c4bc9e255896438f10c9263be7">node_add_file_exec</a>(C, op);
<a name="l03499"></a>03499     <span class="keywordflow">else</span>
<a name="l03500"></a>03500         <span class="keywordflow">return</span> <a class="code" href="../../d6/dae/wm__operators_8c.html#ac7b63d8e0cfa66ce78cd39de06b374c7">WM_operator_filesel</a>(C, op, event);
<a name="l03501"></a>03501 }
<a name="l03502"></a>03502 
<a name="l03503"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a39e2e4482b424a3ae69b425d0ffcdc6d">03503</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a27790c288e9eb95c993551fb6c488f62">NODE_OT_add_file</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l03504"></a>03504 {
<a name="l03505"></a>03505     <span class="comment">/* identifiers */</span>
<a name="l03506"></a>03506     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add File Node&quot;</span>;
<a name="l03507"></a>03507     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Add a file node to the current node editor&quot;</span>;
<a name="l03508"></a>03508     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_add_file&quot;</span>;
<a name="l03509"></a>03509     
<a name="l03510"></a>03510     <span class="comment">/* callbacks */</span>
<a name="l03511"></a>03511     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a89d4f0c4bc9e255896438f10c9263be7">node_add_file_exec</a>;
<a name="l03512"></a>03512     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a712df4059514069aeb44df0248922812">invoke</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a09bed7eee8999c360cf95906c1d4bb8a">node_add_file_invoke</a>;
<a name="l03513"></a>03513     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l03514"></a>03514     
<a name="l03515"></a>03515     <span class="comment">/* flags */</span>
<a name="l03516"></a>03516     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l03517"></a>03517     
<a name="l03518"></a>03518     <a class="code" href="../../d6/dae/wm__operators_8c.html#a5fa435f05172819dfaae1f6acf79bab8">WM_operator_properties_filesel</a>(ot, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#aaac3f2bc8c44aafb973f3b1cf5b1c9b1">FOLDERFILE</a>|<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#aa1c7480dc3bd39628bc5c3531e2a4d1f">IMAGEFILE</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#ada7c3cc863dd57483b348dcdf9569b4c">FILE_SPECIAL</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a95da76b164841451e8aef4b21d3f38a2">FILE_OPENFILE</a>, <a class="code" href="../../d4/d7f/WM__api_8h.html#a615ddace8bd4db6f6afb8e59f5366d97">WM_FILESEL_FILEPATH</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a21d31fc4a7d23f7ebc977203f7e63571ac853e68e87258d362a5539682d68af18">FILE_DEFAULTDISPLAY</a>);  <span class="comment">//XXX TODO, relative_path</span>
<a name="l03519"></a>03519     <a class="code" href="../../dc/d7e/rna__define_8c.html#ac53a3ed18da454971065d5b4e4cb4d62">RNA_def_string</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;Image&quot;</span>, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6d7bce2e9ad79af316c9690a5b84b75c">MAX_ID_NAME</a>-2, <span class="stringliteral">&quot;Name&quot;</span>, <span class="stringliteral">&quot;Datablock name to assign&quot;</span>);
<a name="l03520"></a>03520 }
<a name="l03521"></a>03521 
<a name="l03522"></a>03522 <span class="comment">/********************** New node tree operator *********************/</span>
<a name="l03523"></a>03523 
<a name="l03524"></a><a class="code" href="../../d1/d13/node__edit_8c.html#af761c538cee1b109a83a13f560e7ffde">03524</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#af761c538cee1b109a83a13f560e7ffde">new_node_tree_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l03525"></a>03525 {
<a name="l03526"></a>03526     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode;
<a name="l03527"></a>03527     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree;
<a name="l03528"></a>03528     <a class="code" href="../../dd/d80/structPointerRNA.html">PointerRNA</a> ptr, idptr;
<a name="l03529"></a>03529     <a class="code" href="../../d0/de5/structPropertyRNA.html">PropertyRNA</a> *prop;
<a name="l03530"></a>03530     <span class="keywordtype">int</span> treetype;
<a name="l03531"></a>03531     <span class="keywordtype">char</span> treename[<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6d7bce2e9ad79af316c9690a5b84b75c">MAX_ID_NAME</a>-2] = <span class="stringliteral">&quot;NodeTree&quot;</span>;
<a name="l03532"></a>03532     
<a name="l03533"></a>03533     <span class="comment">/* retrieve state */</span>
<a name="l03534"></a>03534     snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l03535"></a>03535     
<a name="l03536"></a>03536     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;type&quot;</span>))
<a name="l03537"></a>03537         treetype = <a class="code" href="../../d3/d10/rna__access_8c.html#adf28976d740b269f80b747eb62fea6ce">RNA_enum_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;type&quot;</span>);
<a name="l03538"></a>03538     <span class="keywordflow">else</span>
<a name="l03539"></a>03539         treetype = snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#acc2e52658693034e5b1f8ea667163749">treetype</a>;
<a name="l03540"></a>03540     
<a name="l03541"></a>03541     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d10/rna__access_8c.html#a6134701e8798d50496b725c9cb1b6868">RNA_struct_property_is_set</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;name&quot;</span>))
<a name="l03542"></a>03542         <a class="code" href="../../d3/d10/rna__access_8c.html#a810e909d61281bbb2d9fe99f9f2219ab">RNA_string_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;name&quot;</span>, treename);
<a name="l03543"></a>03543     
<a name="l03544"></a>03544     ntree = <a class="code" href="../../d4/d91/BKE__node_8h.html#a061b08730b913443f7b577f99ae284c1">ntreeAddTree</a>(treename, treetype, 0);
<a name="l03545"></a>03545     <span class="keywordflow">if</span> (!ntree)
<a name="l03546"></a>03546         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03547"></a>03547     
<a name="l03548"></a>03548     <span class="comment">/* hook into UI */</span>
<a name="l03549"></a>03549     <a class="code" href="../../d8/d1e/UI__interface_8h.html#a6bfd6ea66a2b01a45cc660c37585a58f">uiIDContextProperty</a>(C, &amp;ptr, &amp;prop);
<a name="l03550"></a>03550 
<a name="l03551"></a>03551     <span class="keywordflow">if</span> (prop) {
<a name="l03552"></a>03552         <a class="code" href="../../d3/d10/rna__access_8c.html#a2ce5c1d9b520b00730820e0e118dd4e1">RNA_id_pointer_create</a>(&amp;ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>, &amp;idptr);
<a name="l03553"></a>03553         <a class="code" href="../../d3/d10/rna__access_8c.html#adafe00269e3f01d8a6182040597fd020">RNA_property_pointer_set</a>(&amp;ptr, prop, idptr);
<a name="l03554"></a>03554         <span class="comment">/* RNA_property_pointer_set increases the user count,</span>
<a name="l03555"></a>03555 <span class="comment">         * fixed here as the editor is the initial user.</span>
<a name="l03556"></a>03556 <span class="comment">         */</span>
<a name="l03557"></a>03557         --ntree-&gt;<a class="code" href="../../d9/da9/structbNodeTree.html#a233b9a866d220cf92ec699450bec5866">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>;
<a name="l03558"></a>03558         <a class="code" href="../../d3/d10/rna__access_8c.html#a5fa7d69c3a73312275e1e6d20baf3bc6">RNA_property_update</a>(C, &amp;ptr, prop);
<a name="l03559"></a>03559     }
<a name="l03560"></a>03560     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (snode) {
<a name="l03561"></a>03561         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l03562"></a>03562         snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#ad1209aeb8590fee7f9eff379d5a375ef">nodetree</a> = ntree;
<a name="l03563"></a>03563         
<a name="l03564"></a>03564         <a class="code" href="../../da/dcc/ED__node_8h.html#a5bf38cf7fcad9b80dfc1ac7ba6c45b50">ED_node_tree_update</a>(snode, scene);
<a name="l03565"></a>03565     }
<a name="l03566"></a>03566     
<a name="l03567"></a>03567     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l03568"></a>03568 }
<a name="l03569"></a>03569 
<a name="l03570"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#aa27ddb1129e1e66057825d05542748df">03570</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#ad19ef4daaeb1752a043da1c622c45a05">NODE_OT_new_node_tree</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l03571"></a>03571 {
<a name="l03572"></a>03572     <span class="comment">/* identifiers */</span>
<a name="l03573"></a>03573     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;New node tree&quot;</span>;
<a name="l03574"></a>03574     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_new_node_tree&quot;</span>;
<a name="l03575"></a>03575     
<a name="l03576"></a>03576     <span class="comment">/* api callbacks */</span>
<a name="l03577"></a>03577     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#af761c538cee1b109a83a13f560e7ffde">new_node_tree_exec</a>;
<a name="l03578"></a>03578     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d12/ED__screen_8h.html#a61bdc064a7b37ed5f93fc50f3eba7ff4">ED_operator_node_active</a>;
<a name="l03579"></a>03579     
<a name="l03580"></a>03580     <span class="comment">/* flags */</span>
<a name="l03581"></a>03581     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l03582"></a>03582     
<a name="l03583"></a>03583     <a class="code" href="../../dc/d7e/rna__define_8c.html#af2ad58c3924113813903fe1b6a2bd5ac">RNA_def_enum</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;type&quot;</span>, <a class="code" href="../../d5/dff/rna__nodetree_8c.html#a44df1cf5fcb806aabb0b505dc7020fce">nodetree_type_items</a>, <a class="code" href="../../d3/d27/DNA__node__types_8h.html#a6613848c5cc3fa45f3f9a0a4a95bd6d0">NTREE_COMPOSIT</a>, <span class="stringliteral">&quot;Tree Type&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l03584"></a>03584     <a class="code" href="../../dc/d7e/rna__define_8c.html#ac53a3ed18da454971065d5b4e4cb4d62">RNA_def_string</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;NodeTree&quot;</span>, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6d7bce2e9ad79af316c9690a5b84b75c">MAX_ID_NAME</a>-2, <span class="stringliteral">&quot;Name&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l03585"></a>03585 }
<a name="l03586"></a>03586 
<a name="l03587"></a>03587 <span class="comment">/* ****************** File Output Add Socket  ******************* */</span>
<a name="l03588"></a>03588 
<a name="l03589"></a><a class="code" href="../../d1/d13/node__edit_8c.html#aea369668ff37d8aad758ad6379973c3d">03589</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#aea369668ff37d8aad758ad6379973c3d">node_output_file_add_socket_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *op)
<a name="l03590"></a>03590 {
<a name="l03591"></a>03591     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l03592"></a>03592     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l03593"></a>03593     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree = snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>;
<a name="l03594"></a>03594     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node = <a class="code" href="../../d4/d91/BKE__node_8h.html#a65bf254e8194856a100e3e88d96cf4fe">nodeGetActive</a>(ntree);
<a name="l03595"></a>03595     <span class="keywordtype">char</span> file_path[<a class="code" href="../../d1/db4/DNA__defs_8h.html#ac7c0207aa5a0e10d378be03b68041350">MAX_NAME</a>];
<a name="l03596"></a>03596     
<a name="l03597"></a>03597     <span class="keywordflow">if</span> (!node)
<a name="l03598"></a>03598         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03599"></a>03599     
<a name="l03600"></a>03600     <a class="code" href="../../d3/d10/rna__access_8c.html#a810e909d61281bbb2d9fe99f9f2219ab">RNA_string_get</a>(op-&gt;<a class="code" href="../../d3/d19/structwmOperator.html#ab29f54bc949a386e57fa0211637bbbbe">ptr</a>, <span class="stringliteral">&quot;file_path&quot;</span>, file_path);
<a name="l03601"></a>03601     <a class="code" href="../../d4/d91/BKE__node_8h.html#a75e76ad21aa89db3cfd5a9025265e029">ntreeCompositOutputFileAddSocket</a>(ntree, node, file_path, &amp;scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a53cdd260f397aa4d2bead55f90780180">im_format</a>);
<a name="l03602"></a>03602     
<a name="l03603"></a>03603     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l03604"></a>03604     
<a name="l03605"></a>03605     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l03606"></a>03606 }
<a name="l03607"></a>03607 
<a name="l03608"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a6e89ba7aa56aa9960c622225dd0871e8">03608</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a921ed8f4da2a7dc6c2609691a0e96344">NODE_OT_output_file_add_socket</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l03609"></a>03609 {
<a name="l03610"></a>03610     <span class="comment">/* identifiers */</span>
<a name="l03611"></a>03611     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Add File Node Socket&quot;</span>;
<a name="l03612"></a>03612     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Add a new input to a file output node&quot;</span>;
<a name="l03613"></a>03613     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_output_file_add_socket&quot;</span>;
<a name="l03614"></a>03614     
<a name="l03615"></a>03615     <span class="comment">/* callbacks */</span>
<a name="l03616"></a>03616     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#aea369668ff37d8aad758ad6379973c3d">node_output_file_add_socket_exec</a>;
<a name="l03617"></a>03617     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a6ccb546628222c2bc2e034b9352a52d1">composite_node_active</a>;
<a name="l03618"></a>03618     
<a name="l03619"></a>03619     <span class="comment">/* flags */</span>
<a name="l03620"></a>03620     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l03621"></a>03621     
<a name="l03622"></a>03622     <a class="code" href="../../dc/d7e/rna__define_8c.html#ac53a3ed18da454971065d5b4e4cb4d62">RNA_def_string</a>(ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a7f4c35af5aa349f0e4a90a1f0710ddc6">srna</a>, <span class="stringliteral">&quot;file_path&quot;</span>, <span class="stringliteral">&quot;Image&quot;</span>, <a class="code" href="../../d1/db4/DNA__defs_8h.html#ac7c0207aa5a0e10d378be03b68041350">MAX_NAME</a>, <span class="stringliteral">&quot;File Path&quot;</span>, <span class="stringliteral">&quot;Sub-path of the output file&quot;</span>);
<a name="l03623"></a>03623 }
<a name="l03624"></a>03624 
<a name="l03625"></a>03625 <span class="comment">/* ****************** Multi File Output Remove Socket  ******************* */</span>
<a name="l03626"></a>03626 
<a name="l03627"></a><a class="code" href="../../d1/d13/node__edit_8c.html#a85e07a66b523e6e98d8abd21bf39d37f">03627</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a85e07a66b523e6e98d8abd21bf39d37f">node_output_file_remove_active_socket_exec</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <a class="code" href="../../d3/d19/structwmOperator.html">wmOperator</a> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(op))
<a name="l03628"></a>03628 {
<a name="l03629"></a>03629     <a class="code" href="../../db/dc9/structSpaceNode.html">SpaceNode</a> *snode= <a class="code" href="../../df/d01/BKE__context_8h.html#a2bdc7246ca49eb0f285a56d01ea63b39">CTX_wm_space_node</a>(C);
<a name="l03630"></a>03630     <a class="code" href="../../d9/da9/structbNodeTree.html">bNodeTree</a> *ntree = snode-&gt;<a class="code" href="../../db/dc9/structSpaceNode.html#a89849109b4ca177aa13a5d230cecc8c6">edittree</a>;
<a name="l03631"></a>03631     <a class="code" href="../../dc/daa/structbNode.html">bNode</a> *node = <a class="code" href="../../d4/d91/BKE__node_8h.html#a65bf254e8194856a100e3e88d96cf4fe">nodeGetActive</a>(ntree);
<a name="l03632"></a>03632     
<a name="l03633"></a>03633     <span class="keywordflow">if</span> (!node)
<a name="l03634"></a>03634         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03635"></a>03635     
<a name="l03636"></a>03636     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d91/BKE__node_8h.html#a47dbf5a0c2ac233192356c9775abfcf1">ntreeCompositOutputFileRemoveActiveSocket</a>(ntree, node))
<a name="l03637"></a>03637         <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a1f73d37a649632bed12f1ee51e2af55b">OPERATOR_CANCELLED</a>;
<a name="l03638"></a>03638     
<a name="l03639"></a>03639     <a class="code" href="../../d1/d13/node__edit_8c.html#ab1d6ee4b761971486000224e290b2ff9">snode_notify</a>(C, snode);
<a name="l03640"></a>03640     
<a name="l03641"></a>03641     <span class="keywordflow">return</span> <a class="code" href="../../de/dc1/DNA__windowmanager__types_8h.html#a818d2533e88d91a930488ab021d18474">OPERATOR_FINISHED</a>;
<a name="l03642"></a>03642 }
<a name="l03643"></a>03643 
<a name="l03644"></a><a class="code" href="../../d8/d8c/node__intern_8h.html#a000342e7e9d9d1ca6b5b05137ab1e93d">03644</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d13/node__edit_8c.html#a609db7cdb98af94e040dbf9fc3a7aa9d">NODE_OT_output_file_remove_active_socket</a>(<a class="code" href="../../de/d5e/structwmOperatorType.html">wmOperatorType</a> *ot)
<a name="l03645"></a>03645 {
<a name="l03646"></a>03646     <span class="comment">/* identifiers */</span>
<a name="l03647"></a>03647     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a04a27d629d618d3991e1825683ecbd99">name</a> = <span class="stringliteral">&quot;Remove File Node Socket&quot;</span>;
<a name="l03648"></a>03648     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aa66ab7b95cf41f92a6da53c53e873db4">description</a> = <span class="stringliteral">&quot;Remove active input from a file output node&quot;</span>;
<a name="l03649"></a>03649     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a46882f447e704ec2b65bf69bf826a306">idname</a> = <span class="stringliteral">&quot;NODE_OT_output_file_remove_active_socket&quot;</span>;
<a name="l03650"></a>03650     
<a name="l03651"></a>03651     <span class="comment">/* callbacks */</span>
<a name="l03652"></a>03652     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#acf19aee20badd3857d211524b081a939">exec</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a85e07a66b523e6e98d8abd21bf39d37f">node_output_file_remove_active_socket_exec</a>;
<a name="l03653"></a>03653     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#aecedd63f8c02cb14ac8e91014550c7d9">poll</a> = <a class="code" href="../../d1/d13/node__edit_8c.html#a6ccb546628222c2bc2e034b9352a52d1">composite_node_active</a>;
<a name="l03654"></a>03654     
<a name="l03655"></a>03655     <span class="comment">/* flags */</span>
<a name="l03656"></a>03656     ot-&gt;<a class="code" href="../../de/d5e/structwmOperatorType.html#a0f07ac6290f51c0a39e25940bf8c9d78">flag</a> = <a class="code" href="../../d4/ddc/WM__types_8h.html#adb7cbb6b0205d00b470cbd1f158bb489">OPTYPE_REGISTER</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a0884b8bbb246819cf52a01174d687370">OPTYPE_UNDO</a>;
<a name="l03657"></a>03657 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:35 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

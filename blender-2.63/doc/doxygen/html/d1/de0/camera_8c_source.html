<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: camera.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">camera.c</div>  </div>
</div>
<div class="contents">
<a href="../../d1/de0/camera_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): none yet.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d3b/DNA__camera__types_8h.html">DNA_camera_types.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d16/DNA__lamp__types_8h.html">DNA_lamp_types.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d06/DNA__view3d__types_8h.html">DNA_view3d_types.h</a>&quot;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d51/BKE__animsys_8h.html">BKE_animsys.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/dff/BKE__camera_8h.html" title="Camera datablock and utility functions.">BKE_camera.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dac/BKE__object_8h.html" title="General operations, lookup, etc. for blender objects.">BKE_object.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/db1/BKE__library_8h.html">BKE_library.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/da3/BKE__screen_8h.html">BKE_screen.h</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="comment">/****************************** Camera Datablock *****************************/</span>
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="../../d1/de0/camera_8c.html#a23d7a99d809344e3e034feb206aedc80">00053</a> <span class="keywordtype">void</span> *<a class="code" href="../../d2/dff/BKE__camera_8h.html#a23d7a99d809344e3e034feb206aedc80">add_camera</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055     <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *cam;
<a name="l00056"></a>00056     
<a name="l00057"></a>00057     cam=  <a class="code" href="../../d8/db1/BKE__library_8h.html#a0856c5e10e28cbe0b45eb00363bf8fb5">alloc_libblock</a>(&amp;<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;camera, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#a82bdb2fdea7abee55d993c0210101273">ID_CA</a>, name);
<a name="l00058"></a>00058 
<a name="l00059"></a>00059     cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a480d411803627517badcebf58c28d0da">lens</a>= 35.0f;
<a name="l00060"></a>00060     cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#acdf39c5ffbd9b9363fd230256a6a5bef">sensor_x</a>= 32.0f;
<a name="l00061"></a>00061     cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a18c42686b5afa4583d29abdf269d2948">sensor_y</a>= 18.0f;
<a name="l00062"></a>00062     cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a3c6d9c49ef4066ff463617f719d1fef2">clipsta</a>= 0.1f;
<a name="l00063"></a>00063     cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a394ace3dbfbcb6a755adb8690fe76288">clipend</a>= 100.0f;
<a name="l00064"></a>00064     cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#af1fde3b857240c7f053ee0b5d89a6154">drawsize</a>= 0.5f;
<a name="l00065"></a>00065     cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#afc85f917510266df662de3aa053c0ee3">ortho_scale</a>= 6.0;
<a name="l00066"></a>00066     cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ad56527aff42496f598ee9357b1244ae4">flag</a> |= <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a30f7e93e83ee6e0ccd626f68f7d08be4">CAM_SHOWPASSEPARTOUT</a>;
<a name="l00067"></a>00067     cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab6d918212ec9726f3cb13d9ab1b26105">passepartalpha</a> = 0.5f;
<a name="l00068"></a>00068     
<a name="l00069"></a>00069     <span class="keywordflow">return</span> cam;
<a name="l00070"></a>00070 }
<a name="l00071"></a>00071 
<a name="l00072"></a><a class="code" href="../../d1/de0/camera_8c.html#a4b014dc0c51e593200e3c0458ad67753">00072</a> <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *<a class="code" href="../../d2/dff/BKE__camera_8h.html#a313db048296d99c951601ec60d22d617">copy_camera</a>(<a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *cam)
<a name="l00073"></a>00073 {
<a name="l00074"></a>00074     <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *camn;
<a name="l00075"></a>00075     
<a name="l00076"></a>00076     camn= <a class="code" href="../../d8/db1/BKE__library_8h.html#a0c0c1987364874c73cda326eace31efd">copy_libblock</a>(&amp;cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>);
<a name="l00077"></a>00077 
<a name="l00078"></a>00078     <a class="code" href="../../d8/db1/BKE__library_8h.html#a43e37bd819b3a44520ff6fbfd9e8962d">id_lib_extern</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)camn-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a93506a794b0a75f3c16e4740c20bb3f5">dof_ob</a>);
<a name="l00079"></a>00079 
<a name="l00080"></a>00080     <span class="keywordflow">return</span> camn;
<a name="l00081"></a>00081 }
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="../../d1/de0/camera_8c.html#a2009593d5162cd3b8a83d4a51eaf7356">00083</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dff/BKE__camera_8h.html#a93cffba6bc6748ed66d8cee2c3c2cf10">make_local_camera</a>(<a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *cam)
<a name="l00084"></a>00084 {
<a name="l00085"></a>00085     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main;
<a name="l00086"></a>00086     <a class="code" href="../../de/de7/structObject.html">Object</a> *ob;
<a name="l00087"></a>00087     <span class="keywordtype">int</span> is_local= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, is_lib= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089     <span class="comment">/* - only lib users: do nothing</span>
<a name="l00090"></a>00090 <span class="comment">     * - only local users: set flag</span>
<a name="l00091"></a>00091 <span class="comment">     * - mixed: make copy</span>
<a name="l00092"></a>00092 <span class="comment">     */</span>
<a name="l00093"></a>00093     
<a name="l00094"></a>00094     <span class="keywordflow">if</span> (cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span>;
<a name="l00095"></a>00095     <span class="keywordflow">if</span> (cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>==1) {
<a name="l00096"></a>00096         <a class="code" href="../../d8/db1/BKE__library_8h.html#a668f0934d813d85c7920735e681fb2b1">id_clear_lib_data</a>(bmain, &amp;cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>);
<a name="l00097"></a>00097         <span class="keywordflow">return</span>;
<a name="l00098"></a>00098     }
<a name="l00099"></a>00099     
<a name="l00100"></a>00100     <span class="keywordflow">for</span> (ob= bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob &amp;&amp; <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(0, is_lib, is_local); ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l00101"></a>00101         <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>==cam) {
<a name="l00102"></a>00102             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>) is_lib= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00103"></a>00103             <span class="keywordflow">else</span> is_local= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00104"></a>00104         }
<a name="l00105"></a>00105     }
<a name="l00106"></a>00106     
<a name="l00107"></a>00107     <span class="keywordflow">if</span> (is_local &amp;&amp; is_lib == <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) {
<a name="l00108"></a>00108         <a class="code" href="../../d8/db1/BKE__library_8h.html#a668f0934d813d85c7920735e681fb2b1">id_clear_lib_data</a>(bmain, &amp;cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>);
<a name="l00109"></a>00109     }
<a name="l00110"></a>00110     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_local &amp;&amp; is_lib) {
<a name="l00111"></a>00111         <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *cam_new= <a class="code" href="../../d2/dff/BKE__camera_8h.html#a313db048296d99c951601ec60d22d617">copy_camera</a>(cam);
<a name="l00112"></a>00112 
<a name="l00113"></a>00113         cam_new-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>= 0;
<a name="l00114"></a>00114 
<a name="l00115"></a>00115         <span class="comment">/* Remap paths of new ID using old library as base. */</span>
<a name="l00116"></a>00116         <a class="code" href="../../d8/db1/BKE__library_8h.html#a28231f1e4d5edb6c8498db449bda4528">BKE_id_lib_local_paths</a>(bmain, cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>, &amp;cam_new-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118         <span class="keywordflow">for</span> (ob= bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#ac9c12335b530e1b3f1717bb9cbc269a4">object</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ob; ob= ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l00119"></a>00119             <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a> == cam) {
<a name="l00120"></a>00120                 <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a879e9a4b2068335bf9b33dab896e439b">id</a>.<a class="code" href="../../d8/d7e/structID.html#a56d730e86e0fc566622c5f5ea2a7de9f">lib</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00121"></a>00121                     ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>= cam_new;
<a name="l00122"></a>00122                     cam_new-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>++;
<a name="l00123"></a>00123                     cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ab734d7dca17ac9d8cefcbac786413e41">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad88374dc626795552b5c3f5b77fab1ab">us</a>--;
<a name="l00124"></a>00124                 }
<a name="l00125"></a>00125             }
<a name="l00126"></a>00126         }
<a name="l00127"></a>00127     }
<a name="l00128"></a>00128 }
<a name="l00129"></a>00129 
<a name="l00130"></a><a class="code" href="../../d1/de0/camera_8c.html#a32e0da6280b3ac04532ed7870c68b211">00130</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dff/BKE__camera_8h.html#a1471fb6a1b3ab00fb1d60a2b5f0e72ec">free_camera</a>(<a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *ca)
<a name="l00131"></a>00131 {
<a name="l00132"></a>00132     <a class="code" href="../../dc/d51/BKE__animsys_8h.html#a186ce67df8bf9873cc945eed480eaa49">BKE_free_animdata</a>((<a class="code" href="../../d8/d7e/structID.html">ID</a> *)ca);
<a name="l00133"></a>00133 }
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="comment">/******************************** Camera Usage *******************************/</span>
<a name="l00136"></a>00136 
<a name="l00137"></a><a class="code" href="../../d1/de0/camera_8c.html#ac05cd17df4b742a6d89167d09f6c91d3">00137</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dff/BKE__camera_8h.html#a41c28592491f500923fae6f3cde5b4e3">object_camera_mode</a>(<a class="code" href="../../d3/d27/structRenderData.html">RenderData</a> *rd, <a class="code" href="../../de/de7/structObject.html">Object</a> *cam_ob)
<a name="l00138"></a>00138 {
<a name="l00139"></a>00139     rd-&gt;<a class="code" href="../../d3/d27/structRenderData.html#ad4b607d22d4e5f4c2f92dda62358d664">mode</a> &amp;= ~(<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ad1461325b45cf05ec52533e0b5fc9c5b">R_ORTHO</a>|<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a734c49fbcb5788988d667052995f4fa0">R_PANORAMA</a>);
<a name="l00140"></a>00140 
<a name="l00141"></a>00141     <span class="keywordflow">if</span> (cam_ob &amp;&amp; cam_ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#afd7fa4376c670f245aeed7a7116c7005">OB_CAMERA</a>) {
<a name="l00142"></a>00142         <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *cam= cam_ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00143"></a>00143         <span class="keywordflow">if</span> (cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#abd4c2c91f9398b35caaa737a7bc6da3b">type</a> == <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a75085da10f07c9a36e9a305ca2ecc6d8">CAM_ORTHO</a>) rd-&gt;<a class="code" href="../../d3/d27/structRenderData.html#ad4b607d22d4e5f4c2f92dda62358d664">mode</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ad1461325b45cf05ec52533e0b5fc9c5b">R_ORTHO</a>;
<a name="l00144"></a>00144         <span class="keywordflow">if</span> (cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ad56527aff42496f598ee9357b1244ae4">flag</a> &amp; <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a2cc8f6e08560c47032ee909c2d7cc2ea">CAM_PANORAMA</a>) rd-&gt;<a class="code" href="../../d3/d27/structRenderData.html#ad4b607d22d4e5f4c2f92dda62358d664">mode</a> |= <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a734c49fbcb5788988d667052995f4fa0">R_PANORAMA</a>;
<a name="l00145"></a>00145     }
<a name="l00146"></a>00146 }
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 <span class="comment">/* get the camera&#39;s dof value, takes the dof object into account */</span>
<a name="l00149"></a><a class="code" href="../../d1/de0/camera_8c.html#ae701c877593ff1667686bd752cbaf1cf">00149</a> <span class="keywordtype">float</span> <a class="code" href="../../d2/dff/BKE__camera_8h.html#aa5e61ab28c19d40aef25d90946ccde3d">object_camera_dof_distance</a>(<a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l00150"></a>00150 {
<a name="l00151"></a>00151     <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *cam = (<a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *)ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>; 
<a name="l00152"></a>00152     <a class="code" href="../../dd/db6/paraloopend_8h.html#a65986f23fef03474a87b62a14beafe42">if</a> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a> != <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#afd7fa4376c670f245aeed7a7116c7005">OB_CAMERA</a>)
<a name="l00153"></a>00153         <span class="keywordflow">return</span> 0.0f;
<a name="l00154"></a>00154     <span class="keywordflow">if</span> (cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a93506a794b0a75f3c16e4740c20bb3f5">dof_ob</a>) {  
<a name="l00155"></a>00155         <span class="comment">/* too simple, better to return the distance on the view axis only</span>
<a name="l00156"></a>00156 <span class="comment">         * return len_v3v3(ob-&gt;obmat[3], cam-&gt;dof_ob-&gt;obmat[3]); */</span>
<a name="l00157"></a>00157         <span class="keywordtype">float</span> mat[4][4], imat[4][4], obmat[4][4];
<a name="l00158"></a>00158         
<a name="l00159"></a>00159         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a54d4323b3d706eb2ad167e9551ba4414">copy_m4_m4</a>(obmat, ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l00160"></a>00160         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a927af9664e9476288c23d0f5e59c4edc">normalize_m4</a>(obmat);
<a name="l00161"></a>00161         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#aab557e66ccdc3534593b413d9b2d7fe8">invert_m4_m4</a>(imat, obmat);
<a name="l00162"></a>00162         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ae41a59d6db4a10a85f8fbf1e3842ba81">mult_m4_m4m4</a>(mat, imat, cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a93506a794b0a75f3c16e4740c20bb3f5">dof_ob</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l00163"></a>00163         <span class="keywordflow">return</span> <a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(mat[3][2]);
<a name="l00164"></a>00164     }
<a name="l00165"></a>00165     <span class="keywordflow">return</span> cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ad7ca0058a5dd2fc4d773753da7e41178">YF_dofdist</a>;
<a name="l00166"></a>00166 }
<a name="l00167"></a>00167 
<a name="l00168"></a><a class="code" href="../../d1/de0/camera_8c.html#a04cc453c95ae2e32c43875cdbc994c32">00168</a> <span class="keywordtype">float</span> <a class="code" href="../../d2/dff/BKE__camera_8h.html#a04cc453c95ae2e32c43875cdbc994c32">camera_sensor_size</a>(<span class="keywordtype">int</span> sensor_fit, <span class="keywordtype">float</span> sensor_x, <span class="keywordtype">float</span> sensor_y)
<a name="l00169"></a>00169 {
<a name="l00170"></a>00170     <span class="comment">/* sensor size used to fit to. for auto, sensor_x is both x and y. */</span>
<a name="l00171"></a>00171     <span class="keywordflow">if</span> (sensor_fit == <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#acdb23889ac5f447d14b7da8ac72eb31e">CAMERA_SENSOR_FIT_VERT</a>)
<a name="l00172"></a>00172         <span class="keywordflow">return</span> sensor_y;
<a name="l00173"></a>00173 
<a name="l00174"></a>00174     <span class="keywordflow">return</span> sensor_x;
<a name="l00175"></a>00175 }
<a name="l00176"></a>00176 
<a name="l00177"></a><a class="code" href="../../d1/de0/camera_8c.html#af580761b65f49ae6a5d28d43a230ee83">00177</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/dff/BKE__camera_8h.html#af580761b65f49ae6a5d28d43a230ee83">camera_sensor_fit</a>(<span class="keywordtype">int</span> sensor_fit, <span class="keywordtype">float</span> sizex, <span class="keywordtype">float</span> sizey)
<a name="l00178"></a>00178 {
<a name="l00179"></a>00179     <span class="keywordflow">if</span> (sensor_fit == <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a7cfd9f3a93c7ffd7ee104c8b560d1d5f">CAMERA_SENSOR_FIT_AUTO</a>) {
<a name="l00180"></a>00180         <span class="keywordflow">if</span> (sizex &gt;= sizey)
<a name="l00181"></a>00181             <span class="keywordflow">return</span> <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a4ffc97a71a38fa5e791161fddf1e07c4">CAMERA_SENSOR_FIT_HOR</a>;
<a name="l00182"></a>00182         <span class="keywordflow">else</span>
<a name="l00183"></a>00183             <span class="keywordflow">return</span> <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#acdb23889ac5f447d14b7da8ac72eb31e">CAMERA_SENSOR_FIT_VERT</a>;
<a name="l00184"></a>00184     }
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     <span class="keywordflow">return</span> sensor_fit;
<a name="l00187"></a>00187 }
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 <span class="comment">/******************************** Camera Params *******************************/</span>
<a name="l00190"></a>00190 
<a name="l00191"></a><a class="code" href="../../d1/de0/camera_8c.html#a114faeb2a77048e814e5a120d29026b3">00191</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dff/BKE__camera_8h.html#a114faeb2a77048e814e5a120d29026b3">camera_params_init</a>(<a class="code" href="../../d4/daf/structCameraParams.html">CameraParams</a> *params)
<a name="l00192"></a>00192 {
<a name="l00193"></a>00193     memset(params, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../d4/daf/structCameraParams.html">CameraParams</a>));
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <span class="comment">/* defaults */</span>
<a name="l00196"></a>00196     params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a1d346afc97b089c5352ead2df78a8756">sensor_x</a>= <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#ace9c8f3f81ece0fc989dae8302a2911c">DEFAULT_SENSOR_WIDTH</a>;
<a name="l00197"></a>00197     params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#adb180d545a3183885ecbdd19dbd6d538">sensor_y</a>= <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a3725d1d157899ccaf49920dc3c8addc3">DEFAULT_SENSOR_HEIGHT</a>;
<a name="l00198"></a>00198     params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a00a5d2b273d94ee653bd6a9959dd5c18">sensor_fit</a>= <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a7cfd9f3a93c7ffd7ee104c8b560d1d5f">CAMERA_SENSOR_FIT_AUTO</a>;
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a434fdd5fd869725d57df6c4127ede5a7">zoom</a>= 1.0f;
<a name="l00201"></a>00201 }
<a name="l00202"></a>00202 
<a name="l00203"></a><a class="code" href="../../d1/de0/camera_8c.html#a6e11ff071922f1cd46cfc312358946e6">00203</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dff/BKE__camera_8h.html#ac561da82b9e128bc2020a2d4e4d2ddd8">camera_params_from_object</a>(<a class="code" href="../../d4/daf/structCameraParams.html">CameraParams</a> *params, <a class="code" href="../../de/de7/structObject.html">Object</a> *ob)
<a name="l00204"></a>00204 {
<a name="l00205"></a>00205     <span class="keywordflow">if</span> (!ob)
<a name="l00206"></a>00206         <span class="keywordflow">return</span>;
<a name="l00207"></a>00207 
<a name="l00208"></a>00208     <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#afd7fa4376c670f245aeed7a7116c7005">OB_CAMERA</a>) {
<a name="l00209"></a>00209         <span class="comment">/* camera object */</span>
<a name="l00210"></a>00210         <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *cam= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212         <span class="keywordflow">if</span> (cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#abd4c2c91f9398b35caaa737a7bc6da3b">type</a> == <a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a75085da10f07c9a36e9a305ca2ecc6d8">CAM_ORTHO</a>)
<a name="l00213"></a>00213             params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a360670b5b20df46648686f386e1fc2d2">is_ortho</a>= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00214"></a>00214         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a9e47f7eafc02d81f208f55b92275ee66">lens</a>= cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a480d411803627517badcebf58c28d0da">lens</a>;
<a name="l00215"></a>00215         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a0f8e523af36c96c5433f4426a763545d">ortho_scale</a>= cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#afc85f917510266df662de3aa053c0ee3">ortho_scale</a>;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#af5ace798d9dad9f6560630373ba278c9">shiftx</a>= cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a69e033fd80e2390b579d43d81b79f1c7">shiftx</a>;
<a name="l00218"></a>00218         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a1c3926b9baef104772ac603f7425dc93">shifty</a>= cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ae9ed1d789ff2218ca0c0f2170353d563">shifty</a>;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a1d346afc97b089c5352ead2df78a8756">sensor_x</a>= cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#acdf39c5ffbd9b9363fd230256a6a5bef">sensor_x</a>;
<a name="l00221"></a>00221         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#adb180d545a3183885ecbdd19dbd6d538">sensor_y</a>= cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a18c42686b5afa4583d29abdf269d2948">sensor_y</a>;
<a name="l00222"></a>00222         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a00a5d2b273d94ee653bd6a9959dd5c18">sensor_fit</a>= cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a0ed5613b5883c690ae6b8cf690a36d11">sensor_fit</a>;
<a name="l00223"></a>00223 
<a name="l00224"></a>00224         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a6fdd84ec4312347929d3b560fd1f603e">clipsta</a>= cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a3c6d9c49ef4066ff463617f719d1fef2">clipsta</a>;
<a name="l00225"></a>00225         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#addd6d77879aab2484838c2c66861422e">clipend</a>= cam-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a394ace3dbfbcb6a755adb8690fe76288">clipend</a>;
<a name="l00226"></a>00226     }
<a name="l00227"></a>00227     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ob-&gt;<a class="code" href="../../de/de7/structObject.html#a8137cf4265bcaaf2fc7c91a9ccd8e4f4">type</a>==<a class="code" href="../../d9/dd9/DNA__object__types_8h.html#a1514ec0465b89013544107c908e7abca">OB_LAMP</a>) {
<a name="l00228"></a>00228         <span class="comment">/* lamp object */</span>
<a name="l00229"></a>00229         <a class="code" href="../../d5/d72/structLamp.html">Lamp</a> *la= ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>;
<a name="l00230"></a>00230         <span class="keywordtype">float</span> fac= <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a2503b77b52ff481a3507a596ae1f3938">cosf</a>((<span class="keywordtype">float</span>)<a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>*la-&gt;<a class="code" href="../../d5/d72/structLamp.html#afbf90c480b2728c3b48a5680dd4a9487">spotsize</a>/360.0f);
<a name="l00231"></a>00231         <span class="keywordtype">float</span> phi= <a class="code" href="../../d7/d47/NM__Scalar_8h.html#afc5ba75c46d1596598d6bc5fafdbda12">acos</a>(fac);
<a name="l00232"></a>00232 
<a name="l00233"></a>00233         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a9e47f7eafc02d81f208f55b92275ee66">lens</a>= 16.0f*fac/<a class="code" href="../../dd/d06/BLI__math__base_8h.html#a1a55e3226c270625a4bff1befa977638">sinf</a>(phi);
<a name="l00234"></a>00234         <span class="keywordflow">if</span> (params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a9e47f7eafc02d81f208f55b92275ee66">lens</a>==0.0f)
<a name="l00235"></a>00235             params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a9e47f7eafc02d81f208f55b92275ee66">lens</a>= 35.0f;
<a name="l00236"></a>00236 
<a name="l00237"></a>00237         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a6fdd84ec4312347929d3b560fd1f603e">clipsta</a>= la-&gt;<a class="code" href="../../d5/d72/structLamp.html#a156245e4d5ec132d205a5d08afe6657d">clipsta</a>;
<a name="l00238"></a>00238         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#addd6d77879aab2484838c2c66861422e">clipend</a>= la-&gt;<a class="code" href="../../d5/d72/structLamp.html#ab6fadfcc03d2ecc3b5fa8058dc016e10">clipend</a>;
<a name="l00239"></a>00239     }
<a name="l00240"></a>00240 }
<a name="l00241"></a>00241 
<a name="l00242"></a><a class="code" href="../../d1/de0/camera_8c.html#a125af7c98ea06199f6b719dca7f86bd5">00242</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dff/BKE__camera_8h.html#a2c373e6795dbb537d98547fdc4e5addf">camera_params_from_view3d</a>(<a class="code" href="../../d4/daf/structCameraParams.html">CameraParams</a> *params, <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d)
<a name="l00243"></a>00243 {
<a name="l00244"></a>00244     <span class="comment">/* common */</span>
<a name="l00245"></a>00245     params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a9e47f7eafc02d81f208f55b92275ee66">lens</a>= v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a11bb79c913de7b38d21b9a3bece7c767">lens</a>;
<a name="l00246"></a>00246     params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a6fdd84ec4312347929d3b560fd1f603e">clipsta</a>= v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#aba3819f92b7807dcb98e1bc8605be7cb">near</a>;
<a name="l00247"></a>00247     params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#addd6d77879aab2484838c2c66861422e">clipend</a>= v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#af51cbdca30d806138c2b3a734b4df2b5">far</a>;
<a name="l00248"></a>00248 
<a name="l00249"></a>00249     <span class="keywordflow">if</span> (rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8f435c152f17185773a21cd8b7067ebb">persp</a>==<a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a4c869f8f07a58e54e43d35474bbe4757">RV3D_CAMOB</a>) {
<a name="l00250"></a>00250         <span class="comment">/* camera view */</span>
<a name="l00251"></a>00251         <a class="code" href="../../d2/dff/BKE__camera_8h.html#ac561da82b9e128bc2020a2d4e4d2ddd8">camera_params_from_object</a>(params, v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>);
<a name="l00252"></a>00252 
<a name="l00253"></a>00253         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a434fdd5fd869725d57df6c4127ede5a7">zoom</a>= <a class="code" href="../../d7/da3/BKE__screen_8h.html#ad44cf5c73ea1bdce9fd1010d755c8c9e">BKE_screen_view3d_zoom_to_fac</a>((<span class="keywordtype">float</span>)rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a9b348c353599b475e71f720ef3a0351f">camzoom</a>);
<a name="l00254"></a>00254 
<a name="l00255"></a>00255         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a60af57150b3ed44cdbe71d15a73eb947">offsetx</a>= 2.0f*rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a6aafddd6d2fbca8bea0654c9c789e55f">camdx</a>*params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a434fdd5fd869725d57df6c4127ede5a7">zoom</a>;
<a name="l00256"></a>00256         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a8faedb22ec3bab5ccdbc5045cc046f95">offsety</a>= 2.0f*rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#af7b44b570db42cbcd7a7ad8072e43384">camdy</a>*params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a434fdd5fd869725d57df6c4127ede5a7">zoom</a>;
<a name="l00257"></a>00257 
<a name="l00258"></a>00258         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#af5ace798d9dad9f6560630373ba278c9">shiftx</a> *= params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a434fdd5fd869725d57df6c4127ede5a7">zoom</a>;
<a name="l00259"></a>00259         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a1c3926b9baef104772ac603f7425dc93">shifty</a> *= params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a434fdd5fd869725d57df6c4127ede5a7">zoom</a>;
<a name="l00260"></a>00260 
<a name="l00261"></a>00261         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a434fdd5fd869725d57df6c4127ede5a7">zoom</a>= 1.0f/params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a434fdd5fd869725d57df6c4127ede5a7">zoom</a>;
<a name="l00262"></a>00262     }
<a name="l00263"></a>00263     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8f435c152f17185773a21cd8b7067ebb">persp</a>==<a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#af086af25ae5c28a12be8eb6f7687c6dd">RV3D_ORTHO</a>) {
<a name="l00264"></a>00264         <span class="comment">/* orthographic view */</span>
<a name="l00265"></a>00265         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#addd6d77879aab2484838c2c66861422e">clipend</a> *= 0.5f;    <span class="comment">// otherwise too extreme low zbuffer quality</span>
<a name="l00266"></a>00266         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a6fdd84ec4312347929d3b560fd1f603e">clipsta</a>= - params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#addd6d77879aab2484838c2c66861422e">clipend</a>;
<a name="l00267"></a>00267 
<a name="l00268"></a>00268         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a360670b5b20df46648686f386e1fc2d2">is_ortho</a>= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00269"></a>00269         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a0f8e523af36c96c5433f4426a763545d">ortho_scale</a> = rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a5a4f191256ccc5c28828b922636ca588">dist</a>;
<a name="l00270"></a>00270         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a434fdd5fd869725d57df6c4127ede5a7">zoom</a>= 2.0f;
<a name="l00271"></a>00271     }
<a name="l00272"></a>00272     <span class="keywordflow">else</span> {
<a name="l00273"></a>00273         <span class="comment">/* perspective view */</span>
<a name="l00274"></a>00274         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a434fdd5fd869725d57df6c4127ede5a7">zoom</a>= 2.0f;
<a name="l00275"></a>00275     }
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 
<a name="l00278"></a><a class="code" href="../../d1/de0/camera_8c.html#ac2657dc0e01a4419e840d9dfa9f2c569">00278</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dff/BKE__camera_8h.html#af290ff2b9dc901aae0f54d62f44c0e1a">camera_params_compute_viewplane</a>(<a class="code" href="../../d4/daf/structCameraParams.html">CameraParams</a> *params, <span class="keywordtype">int</span> winx, <span class="keywordtype">int</span> winy, <span class="keywordtype">float</span> xasp, <span class="keywordtype">float</span> yasp)
<a name="l00279"></a>00279 {
<a name="l00280"></a>00280     <a class="code" href="../../da/d10/structrctf.html">rctf</a> viewplane;
<a name="l00281"></a>00281     <span class="keywordtype">float</span> pixsize, viewfac, sensor_size, dx, dy;
<a name="l00282"></a>00282     <span class="keywordtype">int</span> sensor_fit;
<a name="l00283"></a>00283 
<a name="l00284"></a>00284     <span class="comment">/* fields rendering */</span>
<a name="l00285"></a>00285     params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a6dae68b8a150da747c94252056285cfb">ycor</a>= yasp/xasp;
<a name="l00286"></a>00286     <span class="keywordflow">if</span> (params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#aae2a562f0000d6bf206134365ea26fdf">use_fields</a>)
<a name="l00287"></a>00287         params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a6dae68b8a150da747c94252056285cfb">ycor</a> *= 2.0f;
<a name="l00288"></a>00288 
<a name="l00289"></a>00289     <span class="keywordflow">if</span> (params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a360670b5b20df46648686f386e1fc2d2">is_ortho</a>) {
<a name="l00290"></a>00290         <span class="comment">/* orthographic camera */</span>
<a name="l00291"></a>00291         <span class="comment">/* scale == 1.0 means exact 1 to 1 mapping */</span>
<a name="l00292"></a>00292         pixsize= params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a0f8e523af36c96c5433f4426a763545d">ortho_scale</a>;
<a name="l00293"></a>00293     }
<a name="l00294"></a>00294     <span class="keywordflow">else</span> {
<a name="l00295"></a>00295         <span class="comment">/* perspective camera */</span>
<a name="l00296"></a>00296         sensor_size= <a class="code" href="../../d2/dff/BKE__camera_8h.html#a04cc453c95ae2e32c43875cdbc994c32">camera_sensor_size</a>(params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a00a5d2b273d94ee653bd6a9959dd5c18">sensor_fit</a>, params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a1d346afc97b089c5352ead2df78a8756">sensor_x</a>, params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#adb180d545a3183885ecbdd19dbd6d538">sensor_y</a>);
<a name="l00297"></a>00297         pixsize= (sensor_size * params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a6fdd84ec4312347929d3b560fd1f603e">clipsta</a>)/params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a9e47f7eafc02d81f208f55b92275ee66">lens</a>;
<a name="l00298"></a>00298     }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="comment">/* determine sensor fit */</span>
<a name="l00301"></a>00301     sensor_fit = <a class="code" href="../../d2/dff/BKE__camera_8h.html#af580761b65f49ae6a5d28d43a230ee83">camera_sensor_fit</a>(params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a00a5d2b273d94ee653bd6a9959dd5c18">sensor_fit</a>, xasp*winx, yasp*winy);
<a name="l00302"></a>00302 
<a name="l00303"></a>00303     <span class="keywordflow">if</span> (sensor_fit==<a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a4ffc97a71a38fa5e791161fddf1e07c4">CAMERA_SENSOR_FIT_HOR</a>)
<a name="l00304"></a>00304         viewfac= winx;
<a name="l00305"></a>00305     <span class="keywordflow">else</span>
<a name="l00306"></a>00306         viewfac= params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a6dae68b8a150da747c94252056285cfb">ycor</a> * winy;
<a name="l00307"></a>00307 
<a name="l00308"></a>00308     pixsize /= viewfac;
<a name="l00309"></a>00309 
<a name="l00310"></a>00310     <span class="comment">/* extra zoom factor */</span>
<a name="l00311"></a>00311     pixsize *= params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a434fdd5fd869725d57df6c4127ede5a7">zoom</a>;
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     <span class="comment">/* compute view plane:</span>
<a name="l00314"></a>00314 <span class="comment">     * fully centered, zbuffer fills in jittered between -.5 and +.5 */</span>
<a name="l00315"></a>00315     viewplane.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> = -0.5f*(float)winx;
<a name="l00316"></a>00316     viewplane.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = -0.5f*params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a6dae68b8a150da747c94252056285cfb">ycor</a>*(float)winy;
<a name="l00317"></a>00317     viewplane.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> =  0.5f*(float)winx;
<a name="l00318"></a>00318     viewplane.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> =  0.5f*params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a6dae68b8a150da747c94252056285cfb">ycor</a>*(float)winy;
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     <span class="comment">/* lens shift and offset */</span>
<a name="l00321"></a>00321     dx= params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#af5ace798d9dad9f6560630373ba278c9">shiftx</a>*viewfac + winx*params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a60af57150b3ed44cdbe71d15a73eb947">offsetx</a>;
<a name="l00322"></a>00322     dy= params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a1c3926b9baef104772ac603f7425dc93">shifty</a>*viewfac + winy*params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a8faedb22ec3bab5ccdbc5045cc046f95">offsety</a>;
<a name="l00323"></a>00323 
<a name="l00324"></a>00324     viewplane.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> += dx;
<a name="l00325"></a>00325     viewplane.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> += dy;
<a name="l00326"></a>00326     viewplane.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> += dx;
<a name="l00327"></a>00327     viewplane.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> += dy;
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <span class="comment">/* fields offset */</span>
<a name="l00330"></a>00330     <span class="keywordflow">if</span> (params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#afcf73bb3d7fbb4cb4313ec8656b0fb42">field_second</a>) {
<a name="l00331"></a>00331         <span class="keywordflow">if</span> (params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a5daa40a3b44649c52c72c61fc8314dfd">field_odd</a>) {
<a name="l00332"></a>00332             viewplane.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>-= 0.5f * params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a6dae68b8a150da747c94252056285cfb">ycor</a>;
<a name="l00333"></a>00333             viewplane.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>-= 0.5f * params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a6dae68b8a150da747c94252056285cfb">ycor</a>;
<a name="l00334"></a>00334         }
<a name="l00335"></a>00335         <span class="keywordflow">else</span> {
<a name="l00336"></a>00336             viewplane.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>+= 0.5f * params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a6dae68b8a150da747c94252056285cfb">ycor</a>;
<a name="l00337"></a>00337             viewplane.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>+= 0.5f * params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a6dae68b8a150da747c94252056285cfb">ycor</a>;
<a name="l00338"></a>00338         }
<a name="l00339"></a>00339     }
<a name="l00340"></a>00340 
<a name="l00341"></a>00341     <span class="comment">/* the window matrix is used for clipping, and not changed during OSA steps */</span>
<a name="l00342"></a>00342     <span class="comment">/* using an offset of +0.5 here would give clip errors on edges */</span>
<a name="l00343"></a>00343     viewplane.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> *= pixsize;
<a name="l00344"></a>00344     viewplane.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> *= pixsize;
<a name="l00345"></a>00345     viewplane.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> *= pixsize;
<a name="l00346"></a>00346     viewplane.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> *= pixsize;
<a name="l00347"></a>00347 
<a name="l00348"></a>00348     params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#ac9ab98dfa65b99258fd42b108dcd0caf">viewdx</a>= pixsize;
<a name="l00349"></a>00349     params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a05709379401780d8537c87508d64c4bc">viewdy</a>= params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a6dae68b8a150da747c94252056285cfb">ycor</a> * pixsize;
<a name="l00350"></a>00350     params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#ac9c3eb8d20281908932c41b6e370abbd">viewplane</a>= viewplane;
<a name="l00351"></a>00351 }
<a name="l00352"></a>00352 
<a name="l00353"></a>00353 <span class="comment">/* viewplane is assumed to be already computed */</span>
<a name="l00354"></a><a class="code" href="../../d1/de0/camera_8c.html#a892ebdf01c9cd451ee7244f472dcaba3">00354</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dff/BKE__camera_8h.html#a892ebdf01c9cd451ee7244f472dcaba3">camera_params_compute_matrix</a>(<a class="code" href="../../d4/daf/structCameraParams.html">CameraParams</a> *params)
<a name="l00355"></a>00355 {
<a name="l00356"></a>00356     <a class="code" href="../../da/d10/structrctf.html">rctf</a> viewplane= params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#ac9c3eb8d20281908932c41b6e370abbd">viewplane</a>;
<a name="l00357"></a>00357 
<a name="l00358"></a>00358     <span class="comment">/* compute projection matrix */</span>
<a name="l00359"></a>00359     <span class="keywordflow">if</span> (params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a360670b5b20df46648686f386e1fc2d2">is_ortho</a>)
<a name="l00360"></a>00360         <a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#ae0264cbbfe3f229f9ec380190e1ed8a8">orthographic_m4</a>(params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a231ce565968a26a1ec032de9d5940a89">winmat</a>, viewplane.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, viewplane.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>,
<a name="l00361"></a>00361             viewplane.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>, viewplane.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>, params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a6fdd84ec4312347929d3b560fd1f603e">clipsta</a>, params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#addd6d77879aab2484838c2c66861422e">clipend</a>);
<a name="l00362"></a>00362     <span class="keywordflow">else</span>
<a name="l00363"></a>00363         <a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#a8e39ae9dcc346cc95db26002260d0ee7">perspective_m4</a>(params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a231ce565968a26a1ec032de9d5940a89">winmat</a>, viewplane.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, viewplane.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>,
<a name="l00364"></a>00364             viewplane.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>, viewplane.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>, params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#a6fdd84ec4312347929d3b560fd1f603e">clipsta</a>, params-&gt;<a class="code" href="../../d4/daf/structCameraParams.html#addd6d77879aab2484838c2c66861422e">clipend</a>);
<a name="l00365"></a>00365 }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367 <span class="comment">/***************************** Camera View Frame *****************************/</span>
<a name="l00368"></a>00368 
<a name="l00369"></a><a class="code" href="../../d1/de0/camera_8c.html#a790b3e7dabe6692406fa9b2ee7045bb5">00369</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dff/BKE__camera_8h.html#a87a875da3c96221d633327cc6557fb48">camera_view_frame_ex</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *camera, <span class="keywordtype">float</span> drawsize, <span class="keyword">const</span> <span class="keywordtype">short</span> do_clip, <span class="keyword">const</span> <span class="keywordtype">float</span> scale[3],
<a name="l00370"></a>00370                           <span class="keywordtype">float</span> r_asp[2], <span class="keywordtype">float</span> r_shift[2], <span class="keywordtype">float</span> *r_drawsize, <span class="keywordtype">float</span> r_vec[4][3])
<a name="l00371"></a>00371 {
<a name="l00372"></a>00372     <span class="keywordtype">float</span> facx, facy;
<a name="l00373"></a>00373     <span class="keywordtype">float</span> depth;
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     <span class="comment">/* aspect correcton */</span>
<a name="l00376"></a>00376     <span class="keywordflow">if</span> (scene) {
<a name="l00377"></a>00377         <span class="keywordtype">float</span> aspx= (float) scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#afac89783028ff848f111de04e0c29fbe">xsch</a>*scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a7c97c9fb3ae2b02bd4ccb8c76d68811a">xasp</a>;
<a name="l00378"></a>00378         <span class="keywordtype">float</span> aspy= (<span class="keywordtype">float</span>) scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aca3c1ebdf50a6c74730e19e24983217d">ysch</a>*scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a1f4c395a81051abd055a1014e02c9f00">yasp</a>;
<a name="l00379"></a>00379         <span class="keywordtype">int</span> sensor_fit= <a class="code" href="../../d2/dff/BKE__camera_8h.html#af580761b65f49ae6a5d28d43a230ee83">camera_sensor_fit</a>(camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a0ed5613b5883c690ae6b8cf690a36d11">sensor_fit</a>, aspx, aspy);
<a name="l00380"></a>00380 
<a name="l00381"></a>00381         <span class="keywordflow">if</span> (sensor_fit==<a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a4ffc97a71a38fa5e791161fddf1e07c4">CAMERA_SENSOR_FIT_HOR</a>) {
<a name="l00382"></a>00382             r_asp[0]= 1.0;
<a name="l00383"></a>00383             r_asp[1]= aspy / aspx;
<a name="l00384"></a>00384         }
<a name="l00385"></a>00385         <span class="keywordflow">else</span> {
<a name="l00386"></a>00386             r_asp[0]= aspx / aspy;
<a name="l00387"></a>00387             r_asp[1]= 1.0;
<a name="l00388"></a>00388         }
<a name="l00389"></a>00389     }
<a name="l00390"></a>00390     <span class="keywordflow">else</span> {
<a name="l00391"></a>00391         r_asp[0]= 1.0f;
<a name="l00392"></a>00392         r_asp[1]= 1.0f;
<a name="l00393"></a>00393     }
<a name="l00394"></a>00394 
<a name="l00395"></a>00395     <span class="keywordflow">if</span> (camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#abd4c2c91f9398b35caaa737a7bc6da3b">type</a>==<a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#a75085da10f07c9a36e9a305ca2ecc6d8">CAM_ORTHO</a>) {
<a name="l00396"></a>00396         facx= 0.5f * camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#afc85f917510266df662de3aa053c0ee3">ortho_scale</a> * r_asp[0] * scale[0];
<a name="l00397"></a>00397         facy= 0.5f * camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#afc85f917510266df662de3aa053c0ee3">ortho_scale</a> * r_asp[1] * scale[1];
<a name="l00398"></a>00398         r_shift[0]= camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a69e033fd80e2390b579d43d81b79f1c7">shiftx</a> * camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#afc85f917510266df662de3aa053c0ee3">ortho_scale</a> * scale[0];
<a name="l00399"></a>00399         r_shift[1]= camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ae9ed1d789ff2218ca0c0f2170353d563">shifty</a> * camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#afc85f917510266df662de3aa053c0ee3">ortho_scale</a> * scale[1];
<a name="l00400"></a>00400         depth= do_clip ? -((camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a3c6d9c49ef4066ff463617f719d1fef2">clipsta</a> * scale[2]) + 0.1f) : - drawsize * camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#afc85f917510266df662de3aa053c0ee3">ortho_scale</a> * scale[2];
<a name="l00401"></a>00401 
<a name="l00402"></a>00402         *r_drawsize= 0.5f * camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#afc85f917510266df662de3aa053c0ee3">ortho_scale</a>;
<a name="l00403"></a>00403     }
<a name="l00404"></a>00404     <span class="keywordflow">else</span> {
<a name="l00405"></a>00405         <span class="comment">/* that way it&#39;s always visible - clipsta+0.1 */</span>
<a name="l00406"></a>00406         <span class="keywordtype">float</span> fac;
<a name="l00407"></a>00407         <span class="keywordtype">float</span> half_sensor= 0.5f*((camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a0ed5613b5883c690ae6b8cf690a36d11">sensor_fit</a>==<a class="code" href="../../d6/d3b/DNA__camera__types_8h.html#acdb23889ac5f447d14b7da8ac72eb31e">CAMERA_SENSOR_FIT_VERT</a>) ? (camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a18c42686b5afa4583d29abdf269d2948">sensor_y</a>) : (camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#acdf39c5ffbd9b9363fd230256a6a5bef">sensor_x</a>));
<a name="l00408"></a>00408 
<a name="l00409"></a>00409         *r_drawsize= drawsize / ((scale[0] + scale[1] + scale[2]) / 3.0f);
<a name="l00410"></a>00410 
<a name="l00411"></a>00411         <span class="keywordflow">if</span> (do_clip) {
<a name="l00412"></a>00412             <span class="comment">/* fixed depth, variable size (avoids exceeding clipping range) */</span>
<a name="l00413"></a>00413             depth = -(camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a3c6d9c49ef4066ff463617f719d1fef2">clipsta</a> + 0.1f);
<a name="l00414"></a>00414             fac = depth / (camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a480d411803627517badcebf58c28d0da">lens</a>/(-half_sensor) * scale[2]);
<a name="l00415"></a>00415         }
<a name="l00416"></a>00416         <span class="keywordflow">else</span> {
<a name="l00417"></a>00417             <span class="comment">/* fixed size, variable depth (stays a reasonable size in the 3D view) */</span>
<a name="l00418"></a>00418             depth= *r_drawsize * camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a480d411803627517badcebf58c28d0da">lens</a>/(-half_sensor) * scale[2];
<a name="l00419"></a>00419             fac= *r_drawsize;
<a name="l00420"></a>00420         }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422         facx= fac * r_asp[0] * scale[0];
<a name="l00423"></a>00423         facy= fac * r_asp[1] * scale[1];
<a name="l00424"></a>00424         r_shift[0]= camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#a69e033fd80e2390b579d43d81b79f1c7">shiftx</a>*fac*2 * scale[0];
<a name="l00425"></a>00425         r_shift[1]= camera-&gt;<a class="code" href="../../d7/d7e/structCamera.html#ae9ed1d789ff2218ca0c0f2170353d563">shifty</a>*fac*2 * scale[1];
<a name="l00426"></a>00426     }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428     r_vec[0][0]= r_shift[0] + facx; r_vec[0][1]= r_shift[1] + facy; r_vec[0][2]= depth;
<a name="l00429"></a>00429     r_vec[1][0]= r_shift[0] + facx; r_vec[1][1]= r_shift[1] - facy; r_vec[1][2]= depth;
<a name="l00430"></a>00430     r_vec[2][0]= r_shift[0] - facx; r_vec[2][1]= r_shift[1] - facy; r_vec[2][2]= depth;
<a name="l00431"></a>00431     r_vec[3][0]= r_shift[0] - facx; r_vec[3][1]= r_shift[1] + facy; r_vec[3][2]= depth;
<a name="l00432"></a>00432 }
<a name="l00433"></a>00433 
<a name="l00434"></a><a class="code" href="../../d1/de0/camera_8c.html#a228847e5d87612f94238fff6b6639a5e">00434</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/dff/BKE__camera_8h.html#a2925a448dfb214c7006f8fddd57851ee">camera_view_frame</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../d7/d7e/structCamera.html">Camera</a> *camera, <span class="keywordtype">float</span> r_vec[4][3])
<a name="l00435"></a>00435 {
<a name="l00436"></a>00436     <span class="keywordtype">float</span> dummy_asp[2];
<a name="l00437"></a>00437     <span class="keywordtype">float</span> dummy_shift[2];
<a name="l00438"></a>00438     <span class="keywordtype">float</span> dummy_drawsize;
<a name="l00439"></a>00439     <span class="keyword">const</span> <span class="keywordtype">float</span> dummy_scale[3]= {1.0f, 1.0f, 1.0f};
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     <a class="code" href="../../d2/dff/BKE__camera_8h.html#a87a875da3c96221d633327cc6557fb48">camera_view_frame_ex</a>(scene, camera, <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, 1.0, dummy_scale,
<a name="l00442"></a>00442                          dummy_asp, dummy_shift, &amp;dummy_drawsize, r_vec);
<a name="l00443"></a>00443 }
<a name="l00444"></a>00444 
<a name="l00445"></a>00445 
<a name="l00446"></a><a class="code" href="../../d9/d19/structCameraViewFrameData.html">00446</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d19/structCameraViewFrameData.html">CameraViewFrameData</a> {
<a name="l00447"></a><a class="code" href="../../d9/d19/structCameraViewFrameData.html#aa831c882dc56f6951a0a707c1df2c96b">00447</a>     <span class="keywordtype">float</span> <a class="code" href="../../d9/d19/structCameraViewFrameData.html#aa831c882dc56f6951a0a707c1df2c96b">frame_tx</a>[4][3];
<a name="l00448"></a><a class="code" href="../../d9/d19/structCameraViewFrameData.html#ad5289a4bebf7bfc6f8406988bc0fffe1">00448</a>     <span class="keywordtype">float</span> <a class="code" href="../../d9/d19/structCameraViewFrameData.html#ad5289a4bebf7bfc6f8406988bc0fffe1">normal_tx</a>[4][3];
<a name="l00449"></a><a class="code" href="../../d9/d19/structCameraViewFrameData.html#a312571ed6d422eafe01b5209aa4f384f">00449</a>     <span class="keywordtype">float</span> <a class="code" href="../../d9/d19/structCameraViewFrameData.html#a312571ed6d422eafe01b5209aa4f384f">dist_vals</a>[4];
<a name="l00450"></a><a class="code" href="../../d9/d19/structCameraViewFrameData.html#abedea16b78b0a5bf637aebc042548545">00450</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/d19/structCameraViewFrameData.html#abedea16b78b0a5bf637aebc042548545">tot</a>;
<a name="l00451"></a>00451 } <a class="code" href="../../d1/de0/camera_8c.html#aae6f39398673dee82d417b33b90cf8a4">CameraViewFrameData</a>;
<a name="l00452"></a>00452 
<a name="l00453"></a><a class="code" href="../../d1/de0/camera_8c.html#a8caf77f9cb296edc5a395658fc40d8b1">00453</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/de0/camera_8c.html#a8caf77f9cb296edc5a395658fc40d8b1">camera_to_frame_view_cb</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../d4/dd4/drawarmature_8c.html#a7cadd25320d9bbcc4f8d41f1b6d0978b">co</a>[3], <span class="keywordtype">void</span> *user_data)
<a name="l00454"></a>00454 {
<a name="l00455"></a>00455     <a class="code" href="../../d9/d19/structCameraViewFrameData.html">CameraViewFrameData</a> *<a class="code" href="../../d2/d3a/AUD__JOSResampleReader_8cpp.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>= (<a class="code" href="../../d9/d19/structCameraViewFrameData.html">CameraViewFrameData</a> *)user_data;
<a name="l00456"></a>00456     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00457"></a>00457 
<a name="l00458"></a>00458     <span class="keywordflow">for</span> (i= 0; i &lt; 4; i++) {
<a name="l00459"></a>00459         <span class="keywordtype">float</span> nd= <a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#ab780ebdccbb6130d50da6d1ecc2244c3">dist_to_plane_v3</a>(co, data-&gt;<a class="code" href="../../d9/d19/structCameraViewFrameData.html#aa831c882dc56f6951a0a707c1df2c96b">frame_tx</a>[i], data-&gt;<a class="code" href="../../d9/d19/structCameraViewFrameData.html#ad5289a4bebf7bfc6f8406988bc0fffe1">normal_tx</a>[i]);
<a name="l00460"></a>00460         <span class="keywordflow">if</span> (nd &lt; data-&gt;dist_vals[i]) {
<a name="l00461"></a>00461             data-&gt;<a class="code" href="../../d9/d19/structCameraViewFrameData.html#a312571ed6d422eafe01b5209aa4f384f">dist_vals</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]= nd;
<a name="l00462"></a>00462         }
<a name="l00463"></a>00463     }
<a name="l00464"></a>00464 
<a name="l00465"></a>00465     data-&gt;<a class="code" href="../../d9/d19/structCameraViewFrameData.html#abedea16b78b0a5bf637aebc042548545">tot</a>++;
<a name="l00466"></a>00466 }
<a name="l00467"></a>00467 
<a name="l00468"></a>00468 <span class="comment">/* don&#39;t move the camera, just yield the fit location */</span>
<a name="l00469"></a>00469 <span class="comment">/* only valid for perspective cameras */</span>
<a name="l00470"></a><a class="code" href="../../d1/de0/camera_8c.html#a3dbbffa11109fb395a73277e958cb006">00470</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/dff/BKE__camera_8h.html#a5e4c5c94697cd3365b14009b6a92131e">camera_view_frame_fit_to_scene</a>(<a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <span class="keyword">struct</span> <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d, <a class="code" href="../../de/de7/structObject.html">Object</a> *camera_ob, <span class="keywordtype">float</span> r_co[3])
<a name="l00471"></a>00471 {
<a name="l00472"></a>00472     <span class="keywordtype">float</span> shift[2];
<a name="l00473"></a>00473     <span class="keywordtype">float</span> plane_tx[4][3];
<a name="l00474"></a>00474     <span class="keywordtype">float</span> rot_obmat[3][3];
<a name="l00475"></a>00475     <span class="keyword">const</span> <span class="keywordtype">float</span> zero[3]= {0,0,0};
<a name="l00476"></a>00476     <a class="code" href="../../d9/d19/structCameraViewFrameData.html">CameraViewFrameData</a> data_cb;
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00479"></a>00479 
<a name="l00480"></a>00480     <a class="code" href="../../d2/dff/BKE__camera_8h.html#a2925a448dfb214c7006f8fddd57851ee">camera_view_frame</a>(scene, camera_ob-&gt;<a class="code" href="../../de/de7/structObject.html#af121d9ecf1402708a17302a8a615cbfe">data</a>, data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#aa831c882dc56f6951a0a707c1df2c96b">frame_tx</a>);
<a name="l00481"></a>00481 
<a name="l00482"></a>00482     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a36f8fd23b3f7785d0396ea7a93683d09">copy_m3_m4</a>(rot_obmat, camera_ob-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>);
<a name="l00483"></a>00483     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a9fe495fab322328da024b78e09e43921">normalize_m3</a>(rot_obmat);
<a name="l00484"></a>00484 
<a name="l00485"></a>00485     <span class="keywordflow">for</span> (i= 0; i &lt; 4; i++) {
<a name="l00486"></a>00486         <span class="comment">/* normalize so Z is always 1.0f*/</span>
<a name="l00487"></a>00487         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#aa831c882dc56f6951a0a707c1df2c96b">frame_tx</a>[i], 1.0f/data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#aa831c882dc56f6951a0a707c1df2c96b">frame_tx</a>[i][2]);
<a name="l00488"></a>00488     }
<a name="l00489"></a>00489 
<a name="l00490"></a>00490     <span class="comment">/* get the shift back out of the frame */</span>
<a name="l00491"></a>00491     shift[0]= (data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#aa831c882dc56f6951a0a707c1df2c96b">frame_tx</a>[0][0] +
<a name="l00492"></a>00492                data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#aa831c882dc56f6951a0a707c1df2c96b">frame_tx</a>[1][0] +
<a name="l00493"></a>00493                data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#aa831c882dc56f6951a0a707c1df2c96b">frame_tx</a>[2][0] +
<a name="l00494"></a>00494                data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#aa831c882dc56f6951a0a707c1df2c96b">frame_tx</a>[3][0]) / 4.0f;
<a name="l00495"></a>00495     shift[1]= (data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#aa831c882dc56f6951a0a707c1df2c96b">frame_tx</a>[0][1] +
<a name="l00496"></a>00496                data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#aa831c882dc56f6951a0a707c1df2c96b">frame_tx</a>[1][1] +
<a name="l00497"></a>00497                data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#aa831c882dc56f6951a0a707c1df2c96b">frame_tx</a>[2][1] +
<a name="l00498"></a>00498                data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#aa831c882dc56f6951a0a707c1df2c96b">frame_tx</a>[3][1]) / 4.0f;
<a name="l00499"></a>00499 
<a name="l00500"></a>00500     <span class="keywordflow">for</span> (i= 0; i &lt; 4; i++) {
<a name="l00501"></a>00501         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(rot_obmat, data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#aa831c882dc56f6951a0a707c1df2c96b">frame_tx</a>[i]);
<a name="l00502"></a>00502     }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504     <span class="keywordflow">for</span> (i= 0; i &lt; 4; i++) {
<a name="l00505"></a>00505         <a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#ada7050cefa95b7a630489eddee0c3834">normal_tri_v3</a>(data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#ad5289a4bebf7bfc6f8406988bc0fffe1">normal_tx</a>[i],
<a name="l00506"></a>00506                       zero, data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#aa831c882dc56f6951a0a707c1df2c96b">frame_tx</a>[i], data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#aa831c882dc56f6951a0a707c1df2c96b">frame_tx</a>[(i + 1) % 4]);
<a name="l00507"></a>00507     }
<a name="l00508"></a>00508 
<a name="l00509"></a>00509     <span class="comment">/* initialize callback data */</span>
<a name="l00510"></a>00510     data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#a312571ed6d422eafe01b5209aa4f384f">dist_vals</a>[0]=
<a name="l00511"></a>00511     data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#a312571ed6d422eafe01b5209aa4f384f">dist_vals</a>[1]=
<a name="l00512"></a>00512     data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#a312571ed6d422eafe01b5209aa4f384f">dist_vals</a>[2]=
<a name="l00513"></a>00513     data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#a312571ed6d422eafe01b5209aa4f384f">dist_vals</a>[3]= <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>;
<a name="l00514"></a>00514     data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#abedea16b78b0a5bf637aebc042548545">tot</a>= 0;
<a name="l00515"></a>00515     <span class="comment">/* run callback on all visible points */</span>
<a name="l00516"></a>00516     <a class="code" href="../../df/dac/BKE__object_8h.html#a07038df91d6b5e51829b79ec0ee38954">BKE_scene_foreach_display_point</a>(scene, v3d, <a class="code" href="../../d9/dd9/DNA__object__types_8h.html#ab0df02a4e2042be1a106dce7cc150e33">BA_SELECT</a>,
<a name="l00517"></a>00517                                     <a class="code" href="../../d1/de0/camera_8c.html#a8caf77f9cb296edc5a395658fc40d8b1">camera_to_frame_view_cb</a>, &amp;data_cb);
<a name="l00518"></a>00518 
<a name="l00519"></a>00519     <span class="keywordflow">if</span> (data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#abedea16b78b0a5bf637aebc042548545">tot</a> &lt;= 1) {
<a name="l00520"></a>00520         <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00521"></a>00521     }
<a name="l00522"></a>00522     <span class="keywordflow">else</span> {
<a name="l00523"></a>00523         <span class="keywordtype">float</span> plane_isect_1[3], plane_isect_1_no[3], plane_isect_1_other[3];
<a name="l00524"></a>00524         <span class="keywordtype">float</span> plane_isect_2[3], plane_isect_2_no[3], plane_isect_2_other[3];
<a name="l00525"></a>00525 
<a name="l00526"></a>00526         <span class="keywordtype">float</span> plane_isect_pt_1[3], plane_isect_pt_2[3];
<a name="l00527"></a>00527 
<a name="l00528"></a>00528         <span class="comment">/* apply the dist-from-plane&#39;s to the transformed plane points */</span>
<a name="l00529"></a>00529         <span class="keywordflow">for</span> (i= 0; i &lt; 4; i++) {
<a name="l00530"></a>00530             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ad32a55246dbd69dbd150cd3fe480c734">mul_v3_v3fl</a>(plane_tx[i], data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#ad5289a4bebf7bfc6f8406988bc0fffe1">normal_tx</a>[i], data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#a312571ed6d422eafe01b5209aa4f384f">dist_vals</a>[i]);
<a name="l00531"></a>00531         }
<a name="l00532"></a>00532 
<a name="l00533"></a>00533         <a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#ac97125caaba32c7301db50cd76e80bc8">isect_plane_plane_v3</a>(plane_isect_1, plane_isect_1_no,
<a name="l00534"></a>00534                              plane_tx[0], data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#ad5289a4bebf7bfc6f8406988bc0fffe1">normal_tx</a>[0],
<a name="l00535"></a>00535                              plane_tx[2], data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#ad5289a4bebf7bfc6f8406988bc0fffe1">normal_tx</a>[2]);
<a name="l00536"></a>00536         <a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#ac97125caaba32c7301db50cd76e80bc8">isect_plane_plane_v3</a>(plane_isect_2, plane_isect_2_no,
<a name="l00537"></a>00537                              plane_tx[1], data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#ad5289a4bebf7bfc6f8406988bc0fffe1">normal_tx</a>[1],
<a name="l00538"></a>00538                              plane_tx[3], data_cb.<a class="code" href="../../d9/d19/structCameraViewFrameData.html#ad5289a4bebf7bfc6f8406988bc0fffe1">normal_tx</a>[3]);
<a name="l00539"></a>00539 
<a name="l00540"></a>00540         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(plane_isect_1_other, plane_isect_1, plane_isect_1_no);
<a name="l00541"></a>00541         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(plane_isect_2_other, plane_isect_2, plane_isect_2_no);
<a name="l00542"></a>00542 
<a name="l00543"></a>00543         <span class="keywordflow">if</span> (<a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#a60ead4f3b5813794f90d67f9d2ee1bfa">isect_line_line_v3</a>(plane_isect_1, plane_isect_1_other,
<a name="l00544"></a>00544                                plane_isect_2, plane_isect_2_other,
<a name="l00545"></a>00545                                plane_isect_pt_1, plane_isect_pt_2) == 0)
<a name="l00546"></a>00546         {
<a name="l00547"></a>00547             <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00548"></a>00548         }
<a name="l00549"></a>00549         <span class="keywordflow">else</span> {
<a name="l00550"></a>00550             <span class="keywordtype">float</span> cam_plane_no[3]= {0.0f, 0.0f, -1.0f};
<a name="l00551"></a>00551             <span class="keywordtype">float</span> plane_isect_delta[3];
<a name="l00552"></a>00552             <span class="keywordtype">float</span> plane_isect_delta_len;
<a name="l00553"></a>00553 
<a name="l00554"></a>00554             <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(rot_obmat, cam_plane_no);
<a name="l00555"></a>00555 
<a name="l00556"></a>00556             <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(plane_isect_delta, plane_isect_pt_2, plane_isect_pt_1);
<a name="l00557"></a>00557             plane_isect_delta_len= <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a5dedd24d16c008a3d9e5fc0c4db3fa81">len_v3</a>(plane_isect_delta);
<a name="l00558"></a>00558 
<a name="l00559"></a>00559             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a76629ccfe891bccda30f790ed501e959">dot_v3v3</a>(plane_isect_delta, cam_plane_no) &gt; 0.0f) {
<a name="l00560"></a>00560                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(r_co, plane_isect_pt_1);
<a name="l00561"></a>00561 
<a name="l00562"></a>00562                 <span class="comment">/* offset shift */</span>
<a name="l00563"></a>00563                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(plane_isect_1_no);
<a name="l00564"></a>00564                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1b4079b4f57c1eaf908d521b5a0f867e">madd_v3_v3fl</a>(r_co, plane_isect_1_no, shift[1] * -plane_isect_delta_len);
<a name="l00565"></a>00565             }
<a name="l00566"></a>00566             <span class="keywordflow">else</span> {
<a name="l00567"></a>00567                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(r_co, plane_isect_pt_2);
<a name="l00568"></a>00568 
<a name="l00569"></a>00569                 <span class="comment">/* offset shift */</span>
<a name="l00570"></a>00570                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(plane_isect_2_no);
<a name="l00571"></a>00571                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a1b4079b4f57c1eaf908d521b5a0f867e">madd_v3_v3fl</a>(r_co, plane_isect_2_no, shift[0] * -plane_isect_delta_len);
<a name="l00572"></a>00572             }
<a name="l00573"></a>00573 
<a name="l00574"></a>00574 
<a name="l00575"></a>00575             <span class="keywordflow">return</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00576"></a>00576         }
<a name="l00577"></a>00577     }
<a name="l00578"></a>00578 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:10 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

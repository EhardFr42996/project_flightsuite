<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: paint_cursor.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">paint_cursor.c</div>  </div>
</div>
<div class="contents">
<a href="../../d1/d4d/paint__cursor_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software  Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2009 by Nicholas Bishop</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * Contributor(s): Jason Wilkins, Tom Musgrove.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> */</span>
<a name="l00026"></a>00026 
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d37/DNA__brush__types_8h.html">DNA_brush_types.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../da/ddd/DNA__color__types_8h.html">DNA_color_types.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd9/DNA__object__types_8h.html" title="Object is a sort of wrapper for general info.">DNA_object_types.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/da4/DNA__screen__types_8h.html">DNA_screen_types.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/de4/DNA__userdef__types_8h.html">DNA_userdef_types.h</a>&quot;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dc9/BKE__brush_8h.html">BKE_brush.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d86/BKE__paint_8h.html">BKE_paint.h</a>&quot;</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d44/BIF__gl_8h.html">BIF_gl.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d71/BIF__glutil_8h.html">BIF_glutil.h</a>&quot;</span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d6a/ED__view3d_8h.html">ED_view3d.h</a>&quot;</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d6c/paint__intern_8h.html">paint_intern.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="comment">/* still needed for sculpt_stroke_get_location, should be</span>
<a name="l00056"></a>00056 <span class="comment"> * removed eventually (TODO) */</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d69/sculpt__intern_8h.html">sculpt_intern.h</a>&quot;</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="comment">/* TODOs:</span>
<a name="l00060"></a>00060 <span class="comment"> *</span>
<a name="l00061"></a>00061 <span class="comment"> * Some of the cursor drawing code is doing non-draw stuff</span>
<a name="l00062"></a>00062 <span class="comment"> * (e.g. updating the brush rake angle). This should be cleaned up</span>
<a name="l00063"></a>00063 <span class="comment"> * still.</span>
<a name="l00064"></a>00064 <span class="comment"> *</span>
<a name="l00065"></a>00065 <span class="comment"> * There is also some ugliness with sculpt-specific code.</span>
<a name="l00066"></a>00066 <span class="comment"> */</span>
<a name="l00067"></a>00067 
<a name="l00068"></a><a class="code" href="../../d5/dbb/structSnapshot.html">00068</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/dbb/structSnapshot.html">Snapshot</a> {
<a name="l00069"></a><a class="code" href="../../d5/dbb/structSnapshot.html#a0fbe476dd24f918fa314a3b64473508c">00069</a>     <span class="keywordtype">float</span> <a class="code" href="../../d5/dbb/structSnapshot.html#a0fbe476dd24f918fa314a3b64473508c">size</a>[3];
<a name="l00070"></a><a class="code" href="../../d5/dbb/structSnapshot.html#ae71a6485010615c0b3c13ff9f5cd32cd">00070</a>     <span class="keywordtype">float</span> <a class="code" href="../../d5/dbb/structSnapshot.html#ae71a6485010615c0b3c13ff9f5cd32cd">ofs</a>[3];
<a name="l00071"></a><a class="code" href="../../d5/dbb/structSnapshot.html#a77a34a77b725867c8d087256a63c223d">00071</a>     <span class="keywordtype">float</span> <a class="code" href="../../d5/dbb/structSnapshot.html#a77a34a77b725867c8d087256a63c223d">rot</a>;
<a name="l00072"></a><a class="code" href="../../d5/dbb/structSnapshot.html#a7f0efc2f370290b328364d2de5784c67">00072</a>     <span class="keywordtype">int</span> <a class="code" href="../../d5/dbb/structSnapshot.html#a7f0efc2f370290b328364d2de5784c67">brush_size</a>;
<a name="l00073"></a><a class="code" href="../../d5/dbb/structSnapshot.html#afd183e04b9df82c6e7377c753985e6fe">00073</a>     <span class="keywordtype">int</span> <a class="code" href="../../d5/dbb/structSnapshot.html#afd183e04b9df82c6e7377c753985e6fe">winx</a>;
<a name="l00074"></a><a class="code" href="../../d5/dbb/structSnapshot.html#a12b9259118c904d8ee286a71a054d8b6">00074</a>     <span class="keywordtype">int</span> <a class="code" href="../../d5/dbb/structSnapshot.html#a12b9259118c904d8ee286a71a054d8b6">winy</a>;
<a name="l00075"></a><a class="code" href="../../d5/dbb/structSnapshot.html#ade2b3158c420321a23d84ff45b1cdce5">00075</a>     <span class="keywordtype">int</span> <a class="code" href="../../d5/dbb/structSnapshot.html#ade2b3158c420321a23d84ff45b1cdce5">brush_map_mode</a>;
<a name="l00076"></a><a class="code" href="../../d5/dbb/structSnapshot.html#af99cb97ce70e53548e72885073065e8b">00076</a>     <span class="keywordtype">int</span> <a class="code" href="../../d5/dbb/structSnapshot.html#af99cb97ce70e53548e72885073065e8b">curve_changed_timestamp</a>;
<a name="l00077"></a>00077 } <a class="code" href="../../d1/d4d/paint__cursor_8c.html#a6f104b8ce0cf7d0358427ae52622f003">Snapshot</a>;
<a name="l00078"></a>00078 
<a name="l00079"></a><a class="code" href="../../d1/d4d/paint__cursor_8c.html#a50345de6bfd448d0dae692bdac170e89">00079</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d4d/paint__cursor_8c.html#a50345de6bfd448d0dae692bdac170e89">same_snap</a>(<a class="code" href="../../d5/dbb/structSnapshot.html">Snapshot</a> *snap, <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush, <a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> *vc)
<a name="l00080"></a>00080 {
<a name="l00081"></a>00081     <a class="code" href="../../dc/ddd/structMTex.html">MTex</a> *mtex = &amp;brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083     <span class="keywordflow">return</span> (((mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>) &amp;&amp;
<a name="l00084"></a>00084              <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a9dc4c60131bb140808b9c356ac956756">equals_v3v3</a>(mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a9b7596a4182c5d9c82299e9599edfe48">ofs</a>, snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#ae71a6485010615c0b3c13ff9f5cd32cd">ofs</a>) &amp;&amp;
<a name="l00085"></a>00085              <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a9dc4c60131bb140808b9c356ac956756">equals_v3v3</a>(mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#accae10059528ad76fb12b21d19f7d9c1">size</a>, snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#a0fbe476dd24f918fa314a3b64473508c">size</a>) &amp;&amp;
<a name="l00086"></a>00086              mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a803aac9dbe661a1c7084dc89f1ccb249">rot</a> == snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#a77a34a77b725867c8d087256a63c223d">rot</a>) &amp;&amp;
<a name="l00087"></a>00087 
<a name="l00088"></a>00088             <span class="comment">/* make brush smaller shouldn&#39;t cause a resample */</span>
<a name="l00089"></a>00089             ((mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a5fc62eda7ff8a5006c6469ad8f33b238">brush_map_mode</a> == <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a805117aca0721c2b3af62b85ffd71c60">MTEX_MAP_MODE_FIXED</a> &amp;&amp;
<a name="l00090"></a>00090               (<a class="code" href="../../da/dc9/BKE__brush_8h.html#a41e7464811e837c486e4e2d48bf74190">brush_size</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a318ac2fefa5f4e6ad6faa0a7249d7e73">scene</a>, brush) &lt;= snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#a7f0efc2f370290b328364d2de5784c67">brush_size</a>)) ||
<a name="l00091"></a>00091              (<a class="code" href="../../da/dc9/BKE__brush_8h.html#a41e7464811e837c486e4e2d48bf74190">brush_size</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a318ac2fefa5f4e6ad6faa0a7249d7e73">scene</a>, brush) == snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#a7f0efc2f370290b328364d2de5784c67">brush_size</a>)) &amp;&amp;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093             (mtex-&gt;<a class="code" href="../../dc/ddd/structMTex.html#a5fc62eda7ff8a5006c6469ad8f33b238">brush_map_mode</a> == snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#ade2b3158c420321a23d84ff45b1cdce5">brush_map_mode</a>) &amp;&amp;
<a name="l00094"></a>00094             (vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#a32e37003215c0dc7f77e12e4fc9db3f4">winx</a> == snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#afd183e04b9df82c6e7377c753985e6fe">winx</a>) &amp;&amp;
<a name="l00095"></a>00095             (vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#a908d20a23657ef143d2de1496be69f42">winy</a> == snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#a12b9259118c904d8ee286a71a054d8b6">winy</a>));
<a name="l00096"></a>00096 }
<a name="l00097"></a>00097 
<a name="l00098"></a><a class="code" href="../../d1/d4d/paint__cursor_8c.html#ab0ce919995639c164fab57af62d5c1f0">00098</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/d4d/paint__cursor_8c.html#ab0ce919995639c164fab57af62d5c1f0">make_snap</a>(<a class="code" href="../../d5/dbb/structSnapshot.html">Snapshot</a> *snap, <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush, <a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> *vc)
<a name="l00099"></a>00099 {
<a name="l00100"></a>00100     <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>) {
<a name="l00101"></a>00101         snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#ade2b3158c420321a23d84ff45b1cdce5">brush_map_mode</a> = brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#a5fc62eda7ff8a5006c6469ad8f33b238">brush_map_mode</a>;
<a name="l00102"></a>00102         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#ae71a6485010615c0b3c13ff9f5cd32cd">ofs</a>, brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#a9b7596a4182c5d9c82299e9599edfe48">ofs</a>);
<a name="l00103"></a>00103         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#a0fbe476dd24f918fa314a3b64473508c">size</a>, brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#accae10059528ad76fb12b21d19f7d9c1">size</a>);
<a name="l00104"></a>00104         snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#a77a34a77b725867c8d087256a63c223d">rot</a> = brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#a803aac9dbe661a1c7084dc89f1ccb249">rot</a>;
<a name="l00105"></a>00105     }
<a name="l00106"></a>00106     <span class="keywordflow">else</span> {
<a name="l00107"></a>00107         snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#ade2b3158c420321a23d84ff45b1cdce5">brush_map_mode</a> = -1;
<a name="l00108"></a>00108         snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#ae71a6485010615c0b3c13ff9f5cd32cd">ofs</a>[0] = snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#ae71a6485010615c0b3c13ff9f5cd32cd">ofs</a>[1] = snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#ae71a6485010615c0b3c13ff9f5cd32cd">ofs</a>[2] = -1;
<a name="l00109"></a>00109         snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#a0fbe476dd24f918fa314a3b64473508c">size</a>[0] = snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#a0fbe476dd24f918fa314a3b64473508c">size</a>[1] = snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#a0fbe476dd24f918fa314a3b64473508c">size</a>[2] = -1;
<a name="l00110"></a>00110         snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#a77a34a77b725867c8d087256a63c223d">rot</a> = -1;
<a name="l00111"></a>00111     }
<a name="l00112"></a>00112 
<a name="l00113"></a>00113     snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#a7f0efc2f370290b328364d2de5784c67">brush_size</a> = <a class="code" href="../../da/dc9/BKE__brush_8h.html#a41e7464811e837c486e4e2d48bf74190">brush_size</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a318ac2fefa5f4e6ad6faa0a7249d7e73">scene</a>, brush);
<a name="l00114"></a>00114     snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#afd183e04b9df82c6e7377c753985e6fe">winx</a> = vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#a32e37003215c0dc7f77e12e4fc9db3f4">winx</a>;
<a name="l00115"></a>00115     snap-&gt;<a class="code" href="../../d5/dbb/structSnapshot.html#a12b9259118c904d8ee286a71a054d8b6">winy</a> = vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#a908d20a23657ef143d2de1496be69f42">winy</a>;
<a name="l00116"></a>00116 }
<a name="l00117"></a>00117 
<a name="l00118"></a><a class="code" href="../../d1/d4d/paint__cursor_8c.html#a4b2f4e693cf876425e7533120c7689c0">00118</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d4d/paint__cursor_8c.html#a4b2f4e693cf876425e7533120c7689c0">load_tex</a>(<a class="code" href="../../d2/df6/structSculpt.html">Sculpt</a> *sd, <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *br, <a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> *vc)
<a name="l00119"></a>00119 {
<a name="l00120"></a>00120     <span class="keyword">static</span> GLuint overlay_texture = 0;
<a name="l00121"></a>00121     <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/db3/node__composite__movieclip_8c.html#a9e3042c67b9ca0db42c98423ee8f4da9">init</a> = 0;
<a name="l00122"></a>00122     <span class="keyword">static</span> <span class="keywordtype">int</span> tex_changed_timestamp = -1;
<a name="l00123"></a>00123     <span class="keyword">static</span> <span class="keywordtype">int</span> curve_changed_timestamp = -1;
<a name="l00124"></a>00124     <span class="keyword">static</span> <a class="code" href="../../d5/dbb/structSnapshot.html">Snapshot</a> snap;
<a name="l00125"></a>00125     <span class="keyword">static</span> <span class="keywordtype">int</span> old_size = -1;
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     GLubyte *buffer = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00128"></a>00128 
<a name="l00129"></a>00129     <span class="keywordtype">int</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l00130"></a>00130     <span class="keywordtype">int</span> j;
<a name="l00131"></a>00131     <span class="keywordtype">int</span> refresh;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 <span class="preprocessor">#ifndef _OPENMP</span>
<a name="l00134"></a>00134 <span class="preprocessor"></span>    (void)sd; <span class="comment">/* quied unused warning */</span>
<a name="l00135"></a>00135 <span class="preprocessor">#endif</span>
<a name="l00136"></a>00136 <span class="preprocessor"></span>    
<a name="l00137"></a>00137     <span class="keywordflow">if</span> (br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#a5fc62eda7ff8a5006c6469ad8f33b238">brush_map_mode</a> == <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a86f1c5426dbee356b4041eee42bd02bf">MTEX_MAP_MODE_TILED</a> &amp;&amp; !br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>) <span class="keywordflow">return</span> 0;
<a name="l00138"></a>00138     
<a name="l00139"></a>00139     refresh = 
<a name="l00140"></a>00140         !overlay_texture ||
<a name="l00141"></a>00141         (br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a> &amp;&amp;
<a name="l00142"></a>00142          (!br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>-&gt;<a class="code" href="../../df/d2d/structTex.html#a4d69ee82e64e0c519433a2962a0a1b3a">preview</a> ||
<a name="l00143"></a>00143           br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>-&gt;<a class="code" href="../../df/d2d/structTex.html#a4d69ee82e64e0c519433a2962a0a1b3a">preview</a>-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#ab26d0262633c4ca204ecf0de4c9afd8c">changed_timestamp</a>[0] != tex_changed_timestamp)) ||
<a name="l00144"></a>00144         !br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a5f7b0d9181df178da588821ce9f02d44">curve</a> ||
<a name="l00145"></a>00145         br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a5f7b0d9181df178da588821ce9f02d44">curve</a>-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#adf3f306b2001b72a3a2328cdd3303e32">changed_timestamp</a> != curve_changed_timestamp ||
<a name="l00146"></a>00146         !<a class="code" href="../../d1/d4d/paint__cursor_8c.html#a50345de6bfd448d0dae692bdac170e89">same_snap</a>(&amp;snap, br, vc);
<a name="l00147"></a>00147 
<a name="l00148"></a>00148     <span class="keywordflow">if</span> (refresh) {
<a name="l00149"></a>00149         <span class="keywordflow">if</span> (br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a> &amp;&amp; br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>-&gt;<a class="code" href="../../df/d2d/structTex.html#a4d69ee82e64e0c519433a2962a0a1b3a">preview</a>)
<a name="l00150"></a>00150             tex_changed_timestamp = br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a>-&gt;<a class="code" href="../../df/d2d/structTex.html#a4d69ee82e64e0c519433a2962a0a1b3a">preview</a>-&gt;<a class="code" href="../../df/dbe/structPreviewImage.html#ab26d0262633c4ca204ecf0de4c9afd8c">changed_timestamp</a>[0];
<a name="l00151"></a>00151 
<a name="l00152"></a>00152         <span class="keywordflow">if</span> (br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a5f7b0d9181df178da588821ce9f02d44">curve</a>)
<a name="l00153"></a>00153             curve_changed_timestamp = br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a5f7b0d9181df178da588821ce9f02d44">curve</a>-&gt;<a class="code" href="../../d4/d40/structCurveMapping.html#adf3f306b2001b72a3a2328cdd3303e32">changed_timestamp</a>;
<a name="l00154"></a>00154 
<a name="l00155"></a>00155         <a class="code" href="../../d1/d4d/paint__cursor_8c.html#ab0ce919995639c164fab57af62d5c1f0">make_snap</a>(&amp;snap, br, vc);
<a name="l00156"></a>00156 
<a name="l00157"></a>00157         <span class="keywordflow">if</span> (br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#a5fc62eda7ff8a5006c6469ad8f33b238">brush_map_mode</a> == <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a805117aca0721c2b3af62b85ffd71c60">MTEX_MAP_MODE_FIXED</a>) {
<a name="l00158"></a>00158             <span class="keywordtype">int</span> s = <a class="code" href="../../da/dc9/BKE__brush_8h.html#a41e7464811e837c486e4e2d48bf74190">brush_size</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a318ac2fefa5f4e6ad6faa0a7249d7e73">scene</a>, br);
<a name="l00159"></a>00159             <span class="keywordtype">int</span> r = 1;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161             <span class="keywordflow">for</span> (s &gt;&gt;= 1; s &gt; 0; s &gt;&gt;= 1)
<a name="l00162"></a>00162                 r++;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164             size = (1 &lt;&lt; r);
<a name="l00165"></a>00165 
<a name="l00166"></a>00166             <span class="keywordflow">if</span> (size &lt; 256)
<a name="l00167"></a>00167                 size = 256;
<a name="l00168"></a>00168 
<a name="l00169"></a>00169             <span class="keywordflow">if</span> (size &lt; old_size)
<a name="l00170"></a>00170                 size = old_size;
<a name="l00171"></a>00171         }
<a name="l00172"></a>00172         <span class="keywordflow">else</span>
<a name="l00173"></a>00173             size = 512;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175         <span class="keywordflow">if</span> (old_size != size) {
<a name="l00176"></a>00176             <span class="keywordflow">if</span> (overlay_texture) {
<a name="l00177"></a>00177                 glDeleteTextures(1, &amp;overlay_texture);
<a name="l00178"></a>00178                 overlay_texture = 0;
<a name="l00179"></a>00179             }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181             init = 0;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183             old_size = <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>;
<a name="l00184"></a>00184         }
<a name="l00185"></a>00185 
<a name="l00186"></a>00186         buffer = <a class="code" href="../../da/d2b/mallocn_8c.html#a2bfff00be1f0c49f1945b5d6f66af243">MEM_mallocN</a>(<span class="keyword">sizeof</span>(GLubyte) * size * size, <span class="stringliteral">&quot;load_tex&quot;</span>);
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 <span class="preprocessor">        #pragma omp parallel for schedule(static) if (sd-&gt;flags &amp; SCULPT_USE_OPENMP)</span>
<a name="l00189"></a>00189 <span class="preprocessor"></span>        <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>; j++) {
<a name="l00190"></a>00190             <span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00191"></a>00191             <span class="keywordtype">float</span> y;
<a name="l00192"></a>00192             <span class="keywordtype">float</span> <a class="code" href="../../d9/d90/util__math_8h.html#aa4232e576aca913870e7753393b82894">len</a>;
<a name="l00193"></a>00193 
<a name="l00194"></a>00194             <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a0dbff19ad8155e43555569d371ad95a1">size</a>; i++) {
<a name="l00195"></a>00195 
<a name="l00196"></a>00196                 <span class="comment">// largely duplicated from tex_strength</span>
<a name="l00197"></a>00197 
<a name="l00198"></a>00198                 <span class="keyword">const</span> <span class="keywordtype">float</span> rotation = -br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#a803aac9dbe661a1c7084dc89f1ccb249">rot</a>;
<a name="l00199"></a>00199                 <span class="keywordtype">float</span> radius = <a class="code" href="../../da/dc9/BKE__brush_8h.html#a41e7464811e837c486e4e2d48bf74190">brush_size</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a318ac2fefa5f4e6ad6faa0a7249d7e73">scene</a>, br);
<a name="l00200"></a>00200                 <span class="keywordtype">int</span> index = j * size + <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00201"></a>00201                 <span class="keywordtype">float</span> x;
<a name="l00202"></a>00202                 <span class="keywordtype">float</span> avg;
<a name="l00203"></a>00203 
<a name="l00204"></a>00204                 x = (float)i / size;
<a name="l00205"></a>00205                 y = (float)j / size;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207                 x -= 0.5f;
<a name="l00208"></a>00208                 y -= 0.5f;
<a name="l00209"></a>00209 
<a name="l00210"></a>00210                 <span class="keywordflow">if</span> (br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#a5fc62eda7ff8a5006c6469ad8f33b238">brush_map_mode</a> == <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a86f1c5426dbee356b4041eee42bd02bf">MTEX_MAP_MODE_TILED</a>) {
<a name="l00211"></a>00211                     x *= vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#a32e37003215c0dc7f77e12e4fc9db3f4">winx</a> / radius;
<a name="l00212"></a>00212                     y *= vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#a908d20a23657ef143d2de1496be69f42">winy</a> / radius;
<a name="l00213"></a>00213                 }
<a name="l00214"></a>00214                 <span class="keywordflow">else</span> {
<a name="l00215"></a>00215                     x *= 2;
<a name="l00216"></a>00216                     y *= 2;
<a name="l00217"></a>00217                 }
<a name="l00218"></a>00218 
<a name="l00219"></a>00219                 len = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a33f9e82220f9ff9453a6557bd04bd8c5">sqrtf</a>(x * x + y * y);
<a name="l00220"></a>00220 
<a name="l00221"></a>00221                 <span class="keywordflow">if</span> ((br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#a5fc62eda7ff8a5006c6469ad8f33b238">brush_map_mode</a> == <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a86f1c5426dbee356b4041eee42bd02bf">MTEX_MAP_MODE_TILED</a>) || len &lt;= 1) {
<a name="l00222"></a>00222                     <span class="comment">/* it is probably worth optimizing for those cases where </span>
<a name="l00223"></a>00223 <span class="comment">                     * the texture is not rotated by skipping the calls to</span>
<a name="l00224"></a>00224 <span class="comment">                     * atan2, sqrtf, sin, and cos. */</span>
<a name="l00225"></a>00225                     <span class="keywordflow">if</span> (br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a> &amp;&amp; (rotation &gt; 0.001f || rotation &lt; -0.001f)) {
<a name="l00226"></a>00226                         <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="../../d9/d42/btQuaternion_8h.html#a0dbf74d697e478378c0c48ef948cac37" title="Return the angle between two quaternions.">angle</a>    = <a class="code" href="../../dd/d06/BLI__math__base_8h.html#ab616618cf09fc0ef5c0ec0d9e5825f58">atan2f</a>(y, x) + rotation;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228                         x = len * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a2503b77b52ff481a3507a596ae1f3938">cosf</a>(angle);
<a name="l00229"></a>00229                         y = len * <a class="code" href="../../dd/d06/BLI__math__base_8h.html#a1a55e3226c270625a4bff1befa977638">sinf</a>(angle);
<a name="l00230"></a>00230                     }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232                     x *= br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#accae10059528ad76fb12b21d19f7d9c1">size</a>[0];
<a name="l00233"></a>00233                     y *= br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#accae10059528ad76fb12b21d19f7d9c1">size</a>[1];
<a name="l00234"></a>00234 
<a name="l00235"></a>00235                     x += br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#a9b7596a4182c5d9c82299e9599edfe48">ofs</a>[0];
<a name="l00236"></a>00236                     y += br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#a9b7596a4182c5d9c82299e9599edfe48">ofs</a>[1];
<a name="l00237"></a>00237 
<a name="l00238"></a>00238                     avg = br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#aef6acbb854984bb254e1cb5b75f821d4">tex</a> ? <a class="code" href="../../d3/d6c/paint__intern_8h.html#ae8bd807fcf24b0680532db6c191ed423">paint_get_tex_pixel</a>(br, x, y) : 1;
<a name="l00239"></a>00239 
<a name="l00240"></a>00240                     avg += br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a649085a61e71a012c640c7cdb7c98586">texture_sample_bias</a>;
<a name="l00241"></a>00241 
<a name="l00242"></a>00242                     <span class="keywordflow">if</span> (br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#a5fc62eda7ff8a5006c6469ad8f33b238">brush_map_mode</a> == <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a805117aca0721c2b3af62b85ffd71c60">MTEX_MAP_MODE_FIXED</a>)
<a name="l00243"></a>00243                         avg *= <a class="code" href="../../da/dc9/BKE__brush_8h.html#afcd6c828e3c28abab8e3aaf5f32b60d9">brush_curve_strength</a>(br, len, 1);  <span class="comment">/* Falloff curve */</span>
<a name="l00244"></a>00244 
<a name="l00245"></a>00245                     buffer[index] = 255 - (GLubyte)(255 * avg);
<a name="l00246"></a>00246                 }
<a name="l00247"></a>00247                 <span class="keywordflow">else</span> {
<a name="l00248"></a>00248                     buffer[index] = 0;
<a name="l00249"></a>00249                 }
<a name="l00250"></a>00250             }
<a name="l00251"></a>00251         }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253         <span class="keywordflow">if</span> (!overlay_texture)
<a name="l00254"></a>00254             glGenTextures(1, &amp;overlay_texture);
<a name="l00255"></a>00255     }
<a name="l00256"></a>00256     <span class="keywordflow">else</span> {
<a name="l00257"></a>00257         size = old_size;
<a name="l00258"></a>00258     }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260     glBindTexture(GL_TEXTURE_2D, overlay_texture);
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     <span class="keywordflow">if</span> (refresh) {
<a name="l00263"></a>00263         <span class="keywordflow">if</span> (!init) {
<a name="l00264"></a>00264             glTexImage2D(GL_TEXTURE_2D, 0, GL_ALPHA, size, size, 0, GL_ALPHA, GL_UNSIGNED_BYTE, buffer);
<a name="l00265"></a>00265             init = 1;
<a name="l00266"></a>00266         }
<a name="l00267"></a>00267         <span class="keywordflow">else</span> {
<a name="l00268"></a>00268             glTexSubImage2D(GL_TEXTURE_2D, 0, 0, 0, size, size, GL_ALPHA, GL_UNSIGNED_BYTE, buffer);
<a name="l00269"></a>00269         }
<a name="l00270"></a>00270 
<a name="l00271"></a>00271         <span class="keywordflow">if</span> (buffer)
<a name="l00272"></a>00272             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(buffer);
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     glEnable(GL_TEXTURE_2D);
<a name="l00276"></a>00276 
<a name="l00277"></a>00277     glTexEnvf(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
<a name="l00278"></a>00278     glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
<a name="l00279"></a>00279     glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
<a name="l00280"></a>00280 
<a name="l00281"></a>00281     <span class="keywordflow">if</span> (br-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#a5fc62eda7ff8a5006c6469ad8f33b238">brush_map_mode</a> == <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a805117aca0721c2b3af62b85ffd71c60">MTEX_MAP_MODE_FIXED</a>) {
<a name="l00282"></a>00282         glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_BORDER);
<a name="l00283"></a>00283         glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_BORDER);
<a name="l00284"></a>00284     }
<a name="l00285"></a>00285 
<a name="l00286"></a>00286     <span class="keywordflow">return</span> 1;
<a name="l00287"></a>00287 }
<a name="l00288"></a>00288 
<a name="l00289"></a><a class="code" href="../../d1/d4d/paint__cursor_8c.html#a7e955f5131f77252fc0a601eda1d35ef">00289</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d4d/paint__cursor_8c.html#a7e955f5131f77252fc0a601eda1d35ef">project_brush_radius</a>(<a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> *vc,
<a name="l00290"></a>00290                                 <span class="keywordtype">float</span> radius,
<a name="l00291"></a>00291                                 <span class="keyword">const</span> <span class="keywordtype">float</span> location[3])
<a name="l00292"></a>00292 {
<a name="l00293"></a>00293     <span class="keywordtype">float</span> view[3], nonortho[3], ortho[3], offset[3], p1[2], p2[2];
<a name="l00294"></a>00294 
<a name="l00295"></a>00295     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#ab33af45771ed8b8665840fa6ae39a80e">ED_view3d_global_to_vector</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#ae849219034a130d5a58b5164ab8fc960">rv3d</a>, location, view);
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <span class="comment">// create a vector that is not orthogonal to view</span>
<a name="l00298"></a>00298 
<a name="l00299"></a>00299     <span class="keywordflow">if</span> (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(view[0]) &lt; 0.1f) {
<a name="l00300"></a>00300         nonortho[0] = view[0] + 1.0f;
<a name="l00301"></a>00301         nonortho[1] = view[1];
<a name="l00302"></a>00302         nonortho[2] = view[2];
<a name="l00303"></a>00303     }
<a name="l00304"></a>00304     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../dd/d06/BLI__math__base_8h.html#aa825035ff543e2be9c11ad8acf18d480">fabsf</a>(view[1]) &lt; 0.1f) {
<a name="l00305"></a>00305         nonortho[0] = view[0];
<a name="l00306"></a>00306         nonortho[1] = view[1] + 1.0f;
<a name="l00307"></a>00307         nonortho[2] = view[2];
<a name="l00308"></a>00308     }
<a name="l00309"></a>00309     <span class="keywordflow">else</span> {
<a name="l00310"></a>00310         nonortho[0] = view[0];
<a name="l00311"></a>00311         nonortho[1] = view[1];
<a name="l00312"></a>00312         nonortho[2] = view[2] + 1.0f;
<a name="l00313"></a>00313     }
<a name="l00314"></a>00314 
<a name="l00315"></a>00315     <span class="comment">// get a vector in the plane of the view</span>
<a name="l00316"></a>00316     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(ortho, nonortho, view);
<a name="l00317"></a>00317     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(ortho);
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     <span class="comment">// make a point on the surface of the brush tagent to the view</span>
<a name="l00320"></a>00320     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(ortho, radius);
<a name="l00321"></a>00321     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(offset, location, ortho);
<a name="l00322"></a>00322 
<a name="l00323"></a>00323     <span class="comment">// project the center of the brush, and the tangent point to the view onto the screen</span>
<a name="l00324"></a>00324     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af20708c74cee9dd6a964e68911246ef8">project_float</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>, location, p1);
<a name="l00325"></a>00325     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#af20708c74cee9dd6a964e68911246ef8">project_float</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>, offset, p2);
<a name="l00326"></a>00326 
<a name="l00327"></a>00327     <span class="comment">// the distance between these points is the size of the projected brush in pixels</span>
<a name="l00328"></a>00328     <span class="keywordflow">return</span> <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#ad64ff54d1edbd568345377c3d4660b78">len_v2v2</a>(p1, p2);
<a name="l00329"></a>00329 }
<a name="l00330"></a>00330 
<a name="l00331"></a><a class="code" href="../../d1/d4d/paint__cursor_8c.html#a72f3e2cf08a0f809511afaad8615abdc">00331</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d4d/paint__cursor_8c.html#a72f3e2cf08a0f809511afaad8615abdc">sculpt_get_brush_geometry</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> *vc,
<a name="l00332"></a>00332                                      <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> *pixel_radius,
<a name="l00333"></a>00333                                      <span class="keywordtype">float</span> location[3])
<a name="l00334"></a>00334 {
<a name="l00335"></a>00335     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00336"></a>00336     <a class="code" href="../../d0/d6c/structPaint.html">Paint</a> *paint = <a class="code" href="../../d8/d86/BKE__paint_8h.html#a4b3c2e4641d652cc475f36b3de296334">paint_get_active</a>(scene);
<a name="l00337"></a>00337     <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush = <a class="code" href="../../d8/d86/BKE__paint_8h.html#abc920423e2205663f7131ab5d7eb9eaa">paint_brush</a>(paint);
<a name="l00338"></a>00338     <span class="keywordtype">float</span> window[2];
<a name="l00339"></a>00339     <span class="keywordtype">int</span> hit;
<a name="l00340"></a>00340 
<a name="l00341"></a>00341     window[0] = x + vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>;
<a name="l00342"></a>00342     window[1] = y + vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>;
<a name="l00343"></a>00343 
<a name="l00344"></a>00344     <span class="keywordflow">if</span> (vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a8c8d7f1222ef72f73849512aa5ee0372">obact</a>-&gt;<a class="code" href="../../de/de7/structObject.html#add5d1bf7bdd64ae917bed87d4d933277">sculpt</a> &amp;&amp; vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a8c8d7f1222ef72f73849512aa5ee0372">obact</a>-&gt;<a class="code" href="../../de/de7/structObject.html#add5d1bf7bdd64ae917bed87d4d933277">sculpt</a>-&gt;<a class="code" href="../../dc/de3/structSculptSession.html#afdbbb6c115ebe8041fbea48dd714bc96">pbvh</a> &amp;&amp;
<a name="l00345"></a>00345         <a class="code" href="../../d2/df6/sculpt_8c.html#a9e682a11db1b4242c7f787d9e8d8dbae">sculpt_stroke_get_location</a>(C, location, window)) {
<a name="l00346"></a>00346         *pixel_radius =
<a name="l00347"></a>00347             <a class="code" href="../../d1/d4d/paint__cursor_8c.html#a7e955f5131f77252fc0a601eda1d35ef">project_brush_radius</a>(vc,
<a name="l00348"></a>00348                                  <a class="code" href="../../da/dc9/BKE__brush_8h.html#a41b4719703fddf033bfac555bd01d5c4">brush_unprojected_radius</a>(scene, brush),
<a name="l00349"></a>00349                                  location);
<a name="l00350"></a>00350 
<a name="l00351"></a>00351         <span class="keywordflow">if</span> (*pixel_radius == 0)
<a name="l00352"></a>00352             *pixel_radius = <a class="code" href="../../da/dc9/BKE__brush_8h.html#a41e7464811e837c486e4e2d48bf74190">brush_size</a>(scene, brush);
<a name="l00353"></a>00353 
<a name="l00354"></a>00354         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a2fc1e6236f291e8cf3b62c8e0541eb00">mul_m4_v3</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a8c8d7f1222ef72f73849512aa5ee0372">obact</a>-&gt;<a class="code" href="../../de/de7/structObject.html#aa29519ce424b73cbb5a638814f1080ea">obmat</a>, location);
<a name="l00355"></a>00355 
<a name="l00356"></a>00356         hit = 1;
<a name="l00357"></a>00357     }
<a name="l00358"></a>00358     <span class="keywordflow">else</span> {
<a name="l00359"></a>00359         <a class="code" href="../../d2/df6/structSculpt.html">Sculpt</a> *sd    = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C)-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a3d7b2bfc12195d43d8dac148e95d0281">sculpt</a>;
<a name="l00360"></a>00360         <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush = <a class="code" href="../../d8/d86/BKE__paint_8h.html#abc920423e2205663f7131ab5d7eb9eaa">paint_brush</a>(&amp;sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#a266f9f0d61a292f88102781150d7acc5">paint</a>);
<a name="l00361"></a>00361 
<a name="l00362"></a>00362         *pixel_radius = <a class="code" href="../../da/dc9/BKE__brush_8h.html#a41e7464811e837c486e4e2d48bf74190">brush_size</a>(scene, brush);
<a name="l00363"></a>00363         hit = 0;
<a name="l00364"></a>00364     }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366     <span class="keywordflow">return</span> hit;
<a name="l00367"></a>00367 }
<a name="l00368"></a>00368 
<a name="l00369"></a>00369 <span class="comment">/* Draw an overlay that shows what effect the brush&#39;s texture will</span>
<a name="l00370"></a>00370 <span class="comment"> * have on brush strength */</span>
<a name="l00371"></a>00371 <span class="comment">/* TODO: sculpt only for now */</span>
<a name="l00372"></a><a class="code" href="../../d1/d4d/paint__cursor_8c.html#a4783346f2e889d656c25c43fe358d9af">00372</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/d4d/paint__cursor_8c.html#a4783346f2e889d656c25c43fe358d9af">paint_draw_alpha_overlay</a>(<a class="code" href="../../d2/df6/structSculpt.html">Sculpt</a> *sd, <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush,
<a name="l00373"></a>00373                                      <a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> *vc, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)
<a name="l00374"></a>00374 {
<a name="l00375"></a>00375     <a class="code" href="../../da/d10/structrctf.html">rctf</a> quad;
<a name="l00376"></a>00376 
<a name="l00377"></a>00377     <span class="comment">/* check for overlay mode */</span>
<a name="l00378"></a>00378     <span class="keywordflow">if</span> (!(brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a45f7d9dd35234376f5d6822ed734f162">flag</a> &amp; <a class="code" href="../../da/d37/DNA__brush__types_8h.html#a54ce80e56a089d8035b76a3071e3b0baace89048406530d63082ec346809fc455">BRUSH_TEXTURE_OVERLAY</a>) ||
<a name="l00379"></a>00379         !(<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a0b02ecc2161884c6587b77fd39150632">ELEM</a>(brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#a5fc62eda7ff8a5006c6469ad8f33b238">brush_map_mode</a>, <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a805117aca0721c2b3af62b85ffd71c60">MTEX_MAP_MODE_FIXED</a>, <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a86f1c5426dbee356b4041eee42bd02bf">MTEX_MAP_MODE_TILED</a>)))
<a name="l00380"></a>00380         <span class="keywordflow">return</span>;
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     <span class="comment">/* save lots of GL state</span>
<a name="l00383"></a>00383 <span class="comment">     * TODO: check on whether all of these are needed? */</span>
<a name="l00384"></a>00384     glPushAttrib(GL_COLOR_BUFFER_BIT |
<a name="l00385"></a>00385                  GL_CURRENT_BIT |
<a name="l00386"></a>00386                  GL_DEPTH_BUFFER_BIT |
<a name="l00387"></a>00387                  GL_ENABLE_BIT |
<a name="l00388"></a>00388                  GL_LINE_BIT |
<a name="l00389"></a>00389                  GL_POLYGON_BIT |
<a name="l00390"></a>00390                  GL_STENCIL_BUFFER_BIT |
<a name="l00391"></a>00391                  GL_TRANSFORM_BIT |
<a name="l00392"></a>00392                  GL_VIEWPORT_BIT |
<a name="l00393"></a>00393                  GL_TEXTURE_BIT);
<a name="l00394"></a>00394 
<a name="l00395"></a>00395     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d4d/paint__cursor_8c.html#a4b2f4e693cf876425e7533120c7689c0">load_tex</a>(sd, brush, vc)) {
<a name="l00396"></a>00396         glEnable(GL_BLEND);
<a name="l00397"></a>00397 
<a name="l00398"></a>00398         glColorMask(GL_TRUE, GL_TRUE, GL_TRUE, GL_TRUE);
<a name="l00399"></a>00399         glDepthMask(GL_FALSE);
<a name="l00400"></a>00400         glDepthFunc(GL_ALWAYS);
<a name="l00401"></a>00401 
<a name="l00402"></a>00402         glMatrixMode(GL_TEXTURE);
<a name="l00403"></a>00403         glPushMatrix();
<a name="l00404"></a>00404         glLoadIdentity();
<a name="l00405"></a>00405 
<a name="l00406"></a>00406         <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a32f9a049d7bb4ec8093ef569975f2919">mtex</a>.<a class="code" href="../../dc/ddd/structMTex.html#a5fc62eda7ff8a5006c6469ad8f33b238">brush_map_mode</a> == <a class="code" href="../../da/ddf/DNA__texture__types_8h.html#a805117aca0721c2b3af62b85ffd71c60">MTEX_MAP_MODE_FIXED</a>) {
<a name="l00407"></a>00407             <span class="comment">/* brush rotation */</span>
<a name="l00408"></a>00408             glTranslatef(0.5, 0.5, 0);
<a name="l00409"></a>00409             glRotatef((<span class="keywordtype">double</span>)<a class="code" href="../../d4/d90/BLI__math__rotation_8h.html#a95c550a7b3c9b2628d20aef44bc12b56">RAD2DEGF</a>((brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a45f7d9dd35234376f5d6822ed734f162">flag</a> &amp; <a class="code" href="../../da/d37/DNA__brush__types_8h.html#a54ce80e56a089d8035b76a3071e3b0baa83ea7d03bfcb5421092dc11a7110536a">BRUSH_RAKE</a>) ?
<a name="l00410"></a>00410                                        sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#af8164c326f80e3954f2bc7370c1db805">last_angle</a> : sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#a0485a05b5730a78670c85ed5c98bcef3">special_rotation</a>),
<a name="l00411"></a>00411                       0.0, 0.0, 1.0);
<a name="l00412"></a>00412             glTranslatef(-0.5f, -0.5f, 0);
<a name="l00413"></a>00413 
<a name="l00414"></a>00414             <span class="comment">/* scale based on tablet pressure */</span>
<a name="l00415"></a>00415             <span class="keywordflow">if</span> (sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#a35f984f2d3004590da17ae661afec133">draw_pressure</a> &amp;&amp; <a class="code" href="../../da/dc9/BKE__brush_8h.html#a9246972f773b7523f024e5a58488f328">brush_use_size_pressure</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a318ac2fefa5f4e6ad6faa0a7249d7e73">scene</a>, brush)) {
<a name="l00416"></a>00416                 glTranslatef(0.5f, 0.5f, 0);
<a name="l00417"></a>00417                 glScalef(1.0f / sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#a04f0afeacd715b6214334ddda9ed1e48">pressure_value</a>, 1.0f / sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#a04f0afeacd715b6214334ddda9ed1e48">pressure_value</a>, 1);
<a name="l00418"></a>00418                 glTranslatef(-0.5f, -0.5f, 0);
<a name="l00419"></a>00419             }
<a name="l00420"></a>00420 
<a name="l00421"></a>00421             <span class="keywordflow">if</span> (sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#adc9f48ac7b6d200dd64aa2c358b4d968">draw_anchored</a>) {
<a name="l00422"></a>00422                 <span class="keyword">const</span> <span class="keywordtype">float</span> *aim = sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#afa0da95ebea8c8b1ea9d98f064ff934d">anchored_initial_mouse</a>;
<a name="l00423"></a>00423                 <span class="keyword">const</span> <a class="code" href="../../d0/d28/structrcti.html">rcti</a> *win = &amp;vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>;
<a name="l00424"></a>00424                 quad.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> = aim[0] - sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#a25f4cb1c49ac281ca1804ad3e66cb2fd">anchored_size</a> - win-&gt;<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>;
<a name="l00425"></a>00425                 quad.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = aim[1] - sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#a25f4cb1c49ac281ca1804ad3e66cb2fd">anchored_size</a> - win-&gt;<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>;
<a name="l00426"></a>00426                 quad.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> = aim[0] + sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#a25f4cb1c49ac281ca1804ad3e66cb2fd">anchored_size</a> - win-&gt;<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>;
<a name="l00427"></a>00427                 quad.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = aim[1] + sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#a25f4cb1c49ac281ca1804ad3e66cb2fd">anchored_size</a> - win-&gt;<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>;
<a name="l00428"></a>00428             }
<a name="l00429"></a>00429             <span class="keywordflow">else</span> {
<a name="l00430"></a>00430                 <span class="keyword">const</span> <span class="keywordtype">int</span> radius = <a class="code" href="../../da/dc9/BKE__brush_8h.html#a41e7464811e837c486e4e2d48bf74190">brush_size</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a318ac2fefa5f4e6ad6faa0a7249d7e73">scene</a>, brush);
<a name="l00431"></a>00431                 quad.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> = x - radius;
<a name="l00432"></a>00432                 quad.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = y - radius;
<a name="l00433"></a>00433                 quad.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> = x + radius;
<a name="l00434"></a>00434                 quad.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = y + radius;
<a name="l00435"></a>00435             }
<a name="l00436"></a>00436         }
<a name="l00437"></a>00437         <span class="keywordflow">else</span> {
<a name="l00438"></a>00438             quad.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a> = 0;
<a name="l00439"></a>00439             quad.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a> = 0;
<a name="l00440"></a>00440             quad.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a> = vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> - vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>;
<a name="l00441"></a>00441             quad.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a> = vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> - vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>;
<a name="l00442"></a>00442         }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444         <span class="comment">/* set quad color */</span>
<a name="l00445"></a>00445         glColor4f(<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.sculpt_paint_overlay_col[0],
<a name="l00446"></a>00446                   <a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.sculpt_paint_overlay_col[1],
<a name="l00447"></a>00447                   <a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.sculpt_paint_overlay_col[2],
<a name="l00448"></a>00448                   brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a370eb070b1a9ae34e7f2190f347046aa">texture_overlay_alpha</a> / 100.0f);
<a name="l00449"></a>00449 
<a name="l00450"></a>00450         <span class="comment">/* draw textured quad */</span>
<a name="l00451"></a>00451         glBegin(GL_QUADS);
<a name="l00452"></a>00452         glTexCoord2f(0, 0);
<a name="l00453"></a>00453         glVertex2f(quad.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, quad.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>);
<a name="l00454"></a>00454         glTexCoord2f(1, 0);
<a name="l00455"></a>00455         glVertex2f(quad.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>, quad.<a class="code" href="../../da/d10/structrctf.html#aeea1ce7886a81f1099e897d587012013">ymin</a>);
<a name="l00456"></a>00456         glTexCoord2f(1, 1);
<a name="l00457"></a>00457         glVertex2f(quad.<a class="code" href="../../da/d10/structrctf.html#a76a664abf5a6971d8cc82d85c31a1178">xmax</a>, quad.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>);
<a name="l00458"></a>00458         glTexCoord2f(0, 1);
<a name="l00459"></a>00459         glVertex2f(quad.<a class="code" href="../../da/d10/structrctf.html#a9d7813796d160db4cdb7b9c749a8901d">xmin</a>, quad.<a class="code" href="../../da/d10/structrctf.html#ab8c08095a5b34878ced13a9b3026b74f">ymax</a>);
<a name="l00460"></a>00460         glEnd();
<a name="l00461"></a>00461 
<a name="l00462"></a>00462         glPopMatrix();
<a name="l00463"></a>00463     }
<a name="l00464"></a>00464 
<a name="l00465"></a>00465     glPopAttrib();
<a name="l00466"></a>00466 }
<a name="l00467"></a>00467 
<a name="l00468"></a>00468 <span class="comment">/* Special actions taken when paint cursor goes over mesh */</span>
<a name="l00469"></a>00469 <span class="comment">/* TODO: sculpt only for now */</span>
<a name="l00470"></a><a class="code" href="../../d1/d4d/paint__cursor_8c.html#a0461f75e47cf2a4947f7ae5ec7244274">00470</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/d4d/paint__cursor_8c.html#a0461f75e47cf2a4947f7ae5ec7244274">paint_cursor_on_hit</a>(<a class="code" href="../../d2/df6/structSculpt.html">Sculpt</a> *sd, <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush, <a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> *vc,
<a name="l00471"></a>00471                                 <span class="keyword">const</span> <span class="keywordtype">float</span> location[3])
<a name="l00472"></a>00472 {
<a name="l00473"></a>00473     <span class="keywordtype">float</span> unprojected_radius, projected_radius;
<a name="l00474"></a>00474 
<a name="l00475"></a>00475     <span class="comment">/* update the brush&#39;s cached 3D radius */</span>
<a name="l00476"></a>00476     <span class="keywordflow">if</span> (!<a class="code" href="../../da/dc9/BKE__brush_8h.html#af14a6efb74307c40b650151608585bf6">brush_use_locked_size</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a318ac2fefa5f4e6ad6faa0a7249d7e73">scene</a>, brush)) {
<a name="l00477"></a>00477         <span class="comment">/* get 2D brush radius */</span>
<a name="l00478"></a>00478         <span class="keywordflow">if</span> (sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#adc9f48ac7b6d200dd64aa2c358b4d968">draw_anchored</a>)
<a name="l00479"></a>00479             projected_radius = sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#a25f4cb1c49ac281ca1804ad3e66cb2fd">anchored_size</a>;
<a name="l00480"></a>00480         <span class="keywordflow">else</span> {
<a name="l00481"></a>00481             <span class="keywordflow">if</span> (brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a45f7d9dd35234376f5d6822ed734f162">flag</a> &amp; <a class="code" href="../../da/d37/DNA__brush__types_8h.html#a54ce80e56a089d8035b76a3071e3b0baaa226f73c6e663f17d978981991b101df">BRUSH_ANCHORED</a>)
<a name="l00482"></a>00482                 projected_radius = 8;
<a name="l00483"></a>00483             <span class="keywordflow">else</span>
<a name="l00484"></a>00484                 projected_radius = <a class="code" href="../../da/dc9/BKE__brush_8h.html#a41e7464811e837c486e4e2d48bf74190">brush_size</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a318ac2fefa5f4e6ad6faa0a7249d7e73">scene</a>, brush);
<a name="l00485"></a>00485         }
<a name="l00486"></a>00486     
<a name="l00487"></a>00487         <span class="comment">/* convert brush radius from 2D to 3D */</span>
<a name="l00488"></a>00488         unprojected_radius = <a class="code" href="../../d3/d6c/paint__intern_8h.html#a84bc37e0a242d9c303d75143ff16acc6">paint_calc_object_space_radius</a>(vc, location,
<a name="l00489"></a>00489                                                             projected_radius);
<a name="l00490"></a>00490 
<a name="l00491"></a>00491         <span class="comment">/* scale 3D brush radius by pressure */</span>
<a name="l00492"></a>00492         <span class="keywordflow">if</span> (sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#a35f984f2d3004590da17ae661afec133">draw_pressure</a> &amp;&amp; <a class="code" href="../../da/dc9/BKE__brush_8h.html#a9246972f773b7523f024e5a58488f328">brush_use_size_pressure</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a318ac2fefa5f4e6ad6faa0a7249d7e73">scene</a>, brush))
<a name="l00493"></a>00493             unprojected_radius *= sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#a04f0afeacd715b6214334ddda9ed1e48">pressure_value</a>;
<a name="l00494"></a>00494 
<a name="l00495"></a>00495         <span class="comment">/* set cached value in either Brush or UnifiedPaintSettings */</span>
<a name="l00496"></a>00496         <a class="code" href="../../da/dc9/BKE__brush_8h.html#ae3b23fd74a84a739f9a3ed82c2973935">brush_set_unprojected_radius</a>(vc-&gt;<a class="code" href="../../d8/d30/structViewContext.html#a318ac2fefa5f4e6ad6faa0a7249d7e73">scene</a>, brush, unprojected_radius);
<a name="l00497"></a>00497     }
<a name="l00498"></a>00498 }
<a name="l00499"></a>00499 
<a name="l00500"></a><a class="code" href="../../d1/d4d/paint__cursor_8c.html#a884b6f28fa390a9f4091fe73322e1b13">00500</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/d4d/paint__cursor_8c.html#a884b6f28fa390a9f4091fe73322e1b13">paint_draw_cursor</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">void</span> *<a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(unused))
<a name="l00501"></a>00501 {
<a name="l00502"></a>00502     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene = <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l00503"></a>00503     <a class="code" href="../../d0/d6c/structPaint.html">Paint</a> *paint = <a class="code" href="../../d8/d86/BKE__paint_8h.html#a4b3c2e4641d652cc475f36b3de296334">paint_get_active</a>(scene);
<a name="l00504"></a>00504     <a class="code" href="../../d1/d9f/structBrush.html">Brush</a> *brush = <a class="code" href="../../d8/d86/BKE__paint_8h.html#abc920423e2205663f7131ab5d7eb9eaa">paint_brush</a>(paint);
<a name="l00505"></a>00505     <a class="code" href="../../d8/d30/structViewContext.html">ViewContext</a> vc;
<a name="l00506"></a>00506     <span class="keywordtype">float</span> final_radius;
<a name="l00507"></a>00507     <span class="keywordtype">float</span> translation[2];
<a name="l00508"></a>00508     <span class="keywordtype">float</span> outline_alpha, *outline_col;
<a name="l00509"></a>00509     
<a name="l00510"></a>00510     <span class="comment">/* set various defaults */</span>
<a name="l00511"></a>00511     translation[0] = x;
<a name="l00512"></a>00512     translation[1] = y;
<a name="l00513"></a>00513     outline_alpha = 0.5;
<a name="l00514"></a>00514     outline_col = brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a3c63c7d97556220c0e4918b6c65fbb2f">add_col</a>;
<a name="l00515"></a>00515     final_radius = <a class="code" href="../../da/dc9/BKE__brush_8h.html#a41e7464811e837c486e4e2d48bf74190">brush_size</a>(scene, brush);
<a name="l00516"></a>00516 
<a name="l00517"></a>00517     <span class="comment">/* check that brush drawing is enabled */</span>
<a name="l00518"></a>00518     <span class="keywordflow">if</span> (!(paint-&gt;<a class="code" href="../../d0/d6c/structPaint.html#a89f27059527cc9fd7a8dec3e9e124183">flags</a> &amp; <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a5031a8567a0671de309866bb78b88f87a86fab31513af94207aada5bd51a2c9b6">PAINT_SHOW_BRUSH</a>))
<a name="l00519"></a>00519         <span class="keywordflow">return</span>;
<a name="l00520"></a>00520 
<a name="l00521"></a>00521     <span class="comment">/* can&#39;t use stroke vc here because this will be called during</span>
<a name="l00522"></a>00522 <span class="comment">     * mouse over too, not just during a stroke */</span>
<a name="l00523"></a>00523     <a class="code" href="../../d8/d6a/ED__view3d_8h.html#aa18efc327ab12e74064a2c1129237431">view3d_set_viewcontext</a>(C, &amp;vc);
<a name="l00524"></a>00524 
<a name="l00525"></a>00525     <span class="comment">/* TODO: as sculpt and other paint modes are unified, this</span>
<a name="l00526"></a>00526 <span class="comment">     * special mode of drawing will go away */</span>
<a name="l00527"></a>00527     <span class="keywordflow">if</span> (vc.<a class="code" href="../../d8/d30/structViewContext.html#a8c8d7f1222ef72f73849512aa5ee0372">obact</a>-&gt;<a class="code" href="../../de/de7/structObject.html#add5d1bf7bdd64ae917bed87d4d933277">sculpt</a>) {
<a name="l00528"></a>00528         <a class="code" href="../../d2/df6/structSculpt.html">Sculpt</a> *sd = <a class="code" href="../../df/d01/BKE__context_8h.html#ae91ddb50e1e5a0888a5636ce717a8ef3">CTX_data_tool_settings</a>(C)-&gt;<a class="code" href="../../d0/d65/structToolSettings.html#a3d7b2bfc12195d43d8dac148e95d0281">sculpt</a>;
<a name="l00529"></a>00529         <span class="keywordtype">float</span> location[3];
<a name="l00530"></a>00530         <span class="keywordtype">int</span> pixel_radius, hit;
<a name="l00531"></a>00531 
<a name="l00532"></a>00532         <span class="comment">/* this is probably here so that rake takes into</span>
<a name="l00533"></a>00533 <span class="comment">         * account the brush movements before the stroke</span>
<a name="l00534"></a>00534 <span class="comment">         * starts, but this doesn&#39;t really belong in draw code</span>
<a name="l00535"></a>00535 <span class="comment">         *  TODO) */</span>
<a name="l00536"></a>00536         {
<a name="l00537"></a>00537             <span class="keyword">const</span> <span class="keywordtype">float</span> u = 0.5f;
<a name="l00538"></a>00538             <span class="keyword">const</span> <span class="keywordtype">float</span> v = 1 - u;
<a name="l00539"></a>00539             <span class="keyword">const</span> <span class="keywordtype">float</span> r = 20;
<a name="l00540"></a>00540 
<a name="l00541"></a>00541             <span class="keyword">const</span> <span class="keywordtype">float</span> dx = sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#adaa9b257ef1de6487ccf87dbc42151d4">last_x</a> - x;
<a name="l00542"></a>00542             <span class="keyword">const</span> <span class="keywordtype">float</span> dy = sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#af3a433b7ad66008f2619270166b93d80">last_y</a> - y;
<a name="l00543"></a>00543 
<a name="l00544"></a>00544             <span class="keywordflow">if</span> (dx * dx + dy * dy &gt;= r * r) {
<a name="l00545"></a>00545                 sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#af8164c326f80e3954f2bc7370c1db805">last_angle</a> = <a class="code" href="../../d0/dbc/namespaceKDL.html#adedc70818d20a954bd4dec554150d250">atan2</a>(dx, dy);
<a name="l00546"></a>00546 
<a name="l00547"></a>00547                 sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#adaa9b257ef1de6487ccf87dbc42151d4">last_x</a> = u * sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#adaa9b257ef1de6487ccf87dbc42151d4">last_x</a> + v * x;
<a name="l00548"></a>00548                 sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#af3a433b7ad66008f2619270166b93d80">last_y</a> = u * sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#af3a433b7ad66008f2619270166b93d80">last_y</a> + v * y;
<a name="l00549"></a>00549             }
<a name="l00550"></a>00550         }
<a name="l00551"></a>00551 
<a name="l00552"></a>00552         <span class="comment">/* test if brush is over the mesh */</span>
<a name="l00553"></a>00553         hit = <a class="code" href="../../d1/d4d/paint__cursor_8c.html#a72f3e2cf08a0f809511afaad8615abdc">sculpt_get_brush_geometry</a>(C, &amp;vc, x, y, &amp;pixel_radius, location);
<a name="l00554"></a>00554 
<a name="l00555"></a>00555         <span class="comment">/* draw overlay */</span>
<a name="l00556"></a>00556         <a class="code" href="../../d1/d4d/paint__cursor_8c.html#a4783346f2e889d656c25c43fe358d9af">paint_draw_alpha_overlay</a>(sd, brush, &amp;vc, x, y);
<a name="l00557"></a>00557 
<a name="l00558"></a>00558         <span class="keywordflow">if</span> (<a class="code" href="../../da/dc9/BKE__brush_8h.html#af14a6efb74307c40b650151608585bf6">brush_use_locked_size</a>(scene, brush))
<a name="l00559"></a>00559             <a class="code" href="../../da/dc9/BKE__brush_8h.html#ae0954743a49aa014b39af43834c9af70">brush_set_size</a>(scene, brush, pixel_radius);
<a name="l00560"></a>00560 
<a name="l00561"></a>00561         <span class="comment">/* check if brush is subtracting, use different color then */</span>
<a name="l00562"></a>00562         <span class="comment">/* TODO: no way currently to know state of pen flip or</span>
<a name="l00563"></a>00563 <span class="comment">         * invert key modifier without starting a stroke */</span>
<a name="l00564"></a>00564         <span class="keywordflow">if</span> ((!(brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a45f7d9dd35234376f5d6822ed734f162">flag</a> &amp; <a class="code" href="../../da/d37/DNA__brush__types_8h.html#a54ce80e56a089d8035b76a3071e3b0baaa8a7d6f11162c06bb00d3aa9a018eed2">BRUSH_INVERTED</a>) ^
<a name="l00565"></a>00565              !(brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a45f7d9dd35234376f5d6822ed734f162">flag</a> &amp; <a class="code" href="../../da/d37/DNA__brush__types_8h.html#a54ce80e56a089d8035b76a3071e3b0baa9cd2632129ecafb7cb6748add92632e2">BRUSH_DIR_IN</a>)) &amp;&amp;
<a name="l00566"></a>00566             <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a94fe4335845faafd0b969e89a13d8c76">ELEM5</a>(brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#ab1a9175890a69550b6dae0cd66e5a8d6">sculpt_tool</a>, <a class="code" href="../../da/d37/DNA__brush__types_8h.html#a32b04aa41966305a60754f234d6a39eba58d31ad3a29727e9d3308379f73cab0e">SCULPT_TOOL_DRAW</a>,
<a name="l00567"></a>00567                   <a class="code" href="../../da/d37/DNA__brush__types_8h.html#a32b04aa41966305a60754f234d6a39eba474790ce9d631606a9d6ef9c9ec87deb">SCULPT_TOOL_INFLATE</a>, <a class="code" href="../../da/d37/DNA__brush__types_8h.html#a32b04aa41966305a60754f234d6a39ebad3a2bb262942af524e1d81e401a6a146">SCULPT_TOOL_CLAY</a>,
<a name="l00568"></a>00568                   <a class="code" href="../../da/d37/DNA__brush__types_8h.html#a32b04aa41966305a60754f234d6a39eba726b91c3d87cb30b75d00c1c4df4b866">SCULPT_TOOL_PINCH</a>, <a class="code" href="../../da/d37/DNA__brush__types_8h.html#a32b04aa41966305a60754f234d6a39ebaf6659442b4838609d2dcdff049636832">SCULPT_TOOL_CREASE</a>))
<a name="l00569"></a>00569             outline_col = brush-&gt;<a class="code" href="../../d1/d9f/structBrush.html#a7fe6da287c1d2414c87fabc8e8325167">sub_col</a>;
<a name="l00570"></a>00570 
<a name="l00571"></a>00571         <span class="comment">/* only do if brush is over the mesh */</span>
<a name="l00572"></a>00572         <span class="keywordflow">if</span> (hit)
<a name="l00573"></a>00573             <a class="code" href="../../d1/d4d/paint__cursor_8c.html#a0461f75e47cf2a4947f7ae5ec7244274">paint_cursor_on_hit</a>(sd, brush, &amp;vc, location);
<a name="l00574"></a>00574 
<a name="l00575"></a>00575         <span class="keywordflow">if</span> (sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#adc9f48ac7b6d200dd64aa2c358b4d968">draw_anchored</a>) {
<a name="l00576"></a>00576             final_radius = sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#a25f4cb1c49ac281ca1804ad3e66cb2fd">anchored_size</a>;
<a name="l00577"></a>00577             translation[0] = sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#afa0da95ebea8c8b1ea9d98f064ff934d">anchored_initial_mouse</a>[0] - vc.<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>;
<a name="l00578"></a>00578             translation[1] = sd-&gt;<a class="code" href="../../d2/df6/structSculpt.html#afa0da95ebea8c8b1ea9d98f064ff934d">anchored_initial_mouse</a>[1] - vc.<a class="code" href="../../d8/d30/structViewContext.html#a6f44641101d37b3ad843fabd70e185c8">ar</a>-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>;
<a name="l00579"></a>00579         }
<a name="l00580"></a>00580     }
<a name="l00581"></a>00581 
<a name="l00582"></a>00582     <span class="comment">/* make lines pretty */</span>
<a name="l00583"></a>00583     glEnable(GL_BLEND);
<a name="l00584"></a>00584     glEnable(GL_LINE_SMOOTH);
<a name="l00585"></a>00585 
<a name="l00586"></a>00586     <span class="comment">/* set brush color */</span>
<a name="l00587"></a>00587     glColor4f(outline_col[0], outline_col[1], outline_col[2], outline_alpha);
<a name="l00588"></a>00588 
<a name="l00589"></a>00589     <span class="comment">/* draw brush outline */</span>
<a name="l00590"></a>00590     glTranslatef(translation[0], translation[1], 0);
<a name="l00591"></a>00591     <a class="code" href="../../d9/d71/BIF__glutil_8h.html#a86d799e333a90e03d5ab783640bde74a">glutil_draw_lined_arc</a>(0.0, <a class="code" href="../../d6/ddc/constraint_8c.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> * 2.0, final_radius, 40);
<a name="l00592"></a>00592     glTranslatef(-translation[0], -translation[1], 0);
<a name="l00593"></a>00593 
<a name="l00594"></a>00594     <span class="comment">/* restore GL state */</span>
<a name="l00595"></a>00595     glDisable(GL_BLEND);
<a name="l00596"></a>00596     glDisable(GL_LINE_SMOOTH);
<a name="l00597"></a>00597 }
<a name="l00598"></a>00598 
<a name="l00599"></a>00599 <span class="comment">/* Public API */</span>
<a name="l00600"></a>00600 
<a name="l00601"></a><a class="code" href="../../d1/d4d/paint__cursor_8c.html#acc1341bd38131aace67b2e5e8c26aace">00601</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d4d/paint__cursor_8c.html#acc1341bd38131aace67b2e5e8c26aace">paint_cursor_start</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C, <span class="keywordtype">int</span> (*poll)(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *C))
<a name="l00602"></a>00602 {
<a name="l00603"></a>00603     <a class="code" href="../../d0/d6c/structPaint.html">Paint</a> *<a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a> = <a class="code" href="../../d8/d86/BKE__paint_8h.html#a4b3c2e4641d652cc475f36b3de296334">paint_get_active</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C));
<a name="l00604"></a>00604 
<a name="l00605"></a>00605     <span class="keywordflow">if</span> (p &amp;&amp; !p-&gt;<a class="code" href="../../d0/d6c/structPaint.html#a7dc6da5441cf836834a5844fedfa9601">paint_cursor</a>)
<a name="l00606"></a>00606         p-&gt;<a class="code" href="../../d0/d6c/structPaint.html#a7dc6da5441cf836834a5844fedfa9601">paint_cursor</a> = <a class="code" href="../../d6/dae/wm__operators_8c.html#a734142166fb62b582767fbe4974c70d4">WM_paint_cursor_activate</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C), poll, <a class="code" href="../../d1/d4d/paint__cursor_8c.html#a884b6f28fa390a9f4091fe73322e1b13">paint_draw_cursor</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00607"></a>00607 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:42 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

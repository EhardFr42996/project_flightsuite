<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: EIGENVALUE_HELPER.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">EIGENVALUE_HELPER.cpp</div>  </div>
</div>
<div class="contents">
<a href="../../d1/d05/EIGENVALUE__HELPER_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00005"></a>00005 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d0b/EIGENVALUE__HELPER_8h.html">EIGENVALUE_HELPER.h</a>&quot;</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 
<a name="l00008"></a><a class="code" href="../../da/d0b/EIGENVALUE__HELPER_8h.html#a360b1ead54ddd48790e3798ca5513f29">00008</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d05/EIGENVALUE__HELPER_8cpp.html#a360b1ead54ddd48790e3798ca5513f29">Eigentred2</a>(<a class="code" href="../../dd/d53/structsEigenvalue.html">sEigenvalue</a>&amp; eval) {
<a name="l00009"></a>00009 
<a name="l00010"></a>00010    <span class="comment">//  This is derived from the Algol procedures tred2 by</span>
<a name="l00011"></a>00011    <span class="comment">//  Bowdler, Martin, Reinsch, and Wilkinson, Handbook for</span>
<a name="l00012"></a>00012    <span class="comment">//  Auto. Comp., Vol.ii-Linear Algebra, and the corresponding</span>
<a name="l00013"></a>00013    <span class="comment">//  Fortran subroutine in EISPACK.</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015       <span class="keywordtype">int</span> n=eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a59a54c72aa6425fe26688528dff054cb">n</a>;
<a name="l00016"></a>00016 
<a name="l00017"></a>00017       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; n; j++) {
<a name="l00018"></a>00018          eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[j] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[n-1][j];
<a name="l00019"></a>00019       }
<a name="l00020"></a>00020 
<a name="l00021"></a>00021       <span class="comment">// Householder reduction to tridiagonal form.</span>
<a name="l00022"></a>00022    
<a name="l00023"></a>00023       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = n-1; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>--) {
<a name="l00024"></a>00024    
<a name="l00025"></a>00025          <span class="comment">// Scale to avoid under/overflow.</span>
<a name="l00026"></a>00026    
<a name="l00027"></a>00027          <span class="keywordtype">float</span> scale = 0.0;
<a name="l00028"></a>00028          <span class="keywordtype">float</span> h = 0.0;
<a name="l00029"></a>00029          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; k++) {
<a name="l00030"></a>00030             scale = scale + <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[k]);
<a name="l00031"></a>00031          }
<a name="l00032"></a>00032          <span class="keywordflow">if</span> (scale == 0.0) {
<a name="l00033"></a>00033             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[i-1];
<a name="l00034"></a>00034             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; j++) {
<a name="l00035"></a>00035                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[j] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[i-1][j];
<a name="l00036"></a>00036                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = 0.0;
<a name="l00037"></a>00037                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[j][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0;
<a name="l00038"></a>00038             }
<a name="l00039"></a>00039          } <span class="keywordflow">else</span> {
<a name="l00040"></a>00040    
<a name="l00041"></a>00041             <span class="comment">// Generate Householder vector.</span>
<a name="l00042"></a>00042    
<a name="l00043"></a>00043             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; k++) {
<a name="l00044"></a>00044                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[k] /= scale;
<a name="l00045"></a>00045                h += eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[k] * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[k];
<a name="l00046"></a>00046             }
<a name="l00047"></a>00047             <span class="keywordtype">float</span> f = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[i-1];
<a name="l00048"></a>00048             <span class="keywordtype">float</span> <a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a> = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(h);
<a name="l00049"></a>00049             <span class="keywordflow">if</span> (f &gt; 0) {
<a name="l00050"></a>00050                g = -<a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a>;
<a name="l00051"></a>00051             }
<a name="l00052"></a>00052             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = scale * <a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a>;
<a name="l00053"></a>00053             h = h - f * <a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a>;
<a name="l00054"></a>00054             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[i-1] = f - <a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a>;
<a name="l00055"></a>00055             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; j++) {
<a name="l00056"></a>00056                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[j] = 0.0;
<a name="l00057"></a>00057             }
<a name="l00058"></a>00058    
<a name="l00059"></a>00059             <span class="comment">// Apply similarity transformation to remaining columns.</span>
<a name="l00060"></a>00060    
<a name="l00061"></a>00061             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; j++) {
<a name="l00062"></a>00062                f = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[j];
<a name="l00063"></a>00063                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[j][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = f;
<a name="l00064"></a>00064                g = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[j] + eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[j][j] * f;
<a name="l00065"></a>00065                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = j+1; k &lt;= i-1; k++) {
<a name="l00066"></a>00066                   g += eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[k][j] * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[k];
<a name="l00067"></a>00067                   eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[k] += eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[k][j] * f;
<a name="l00068"></a>00068                }
<a name="l00069"></a>00069                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[j] = <a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a>;
<a name="l00070"></a>00070             }
<a name="l00071"></a>00071             f = 0.0;
<a name="l00072"></a>00072             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; j++) {
<a name="l00073"></a>00073                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[j] /= h;
<a name="l00074"></a>00074                f += eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[j] * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[j];
<a name="l00075"></a>00075             }
<a name="l00076"></a>00076             <span class="keywordtype">float</span> hh = f / (h + h);
<a name="l00077"></a>00077             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; j++) {
<a name="l00078"></a>00078                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[j] -= hh * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[j];
<a name="l00079"></a>00079             }
<a name="l00080"></a>00080             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; j++) {
<a name="l00081"></a>00081                f = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[j];
<a name="l00082"></a>00082                g = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[j];
<a name="l00083"></a>00083                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = j; k &lt;= i-1; k++) {
<a name="l00084"></a>00084                   eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[k][j] -= (f * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[k] + g * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[k]);
<a name="l00085"></a>00085                }
<a name="l00086"></a>00086                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[j] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[i-1][j];
<a name="l00087"></a>00087                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = 0.0;
<a name="l00088"></a>00088             }
<a name="l00089"></a>00089          }
<a name="l00090"></a>00090          eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = h;
<a name="l00091"></a>00091       }
<a name="l00092"></a>00092    
<a name="l00093"></a>00093       <span class="comment">// Accumulate transformations.</span>
<a name="l00094"></a>00094    
<a name="l00095"></a>00095       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n-1; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00096"></a>00096          eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[n-1][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00097"></a>00097          eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 1.0;
<a name="l00098"></a>00098          <span class="keywordtype">float</span> h = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1];
<a name="l00099"></a>00099          <span class="keywordflow">if</span> (h != 0.0) {
<a name="l00100"></a>00100             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt;= <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; k++) {
<a name="l00101"></a>00101                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[k] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[k][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1] / h;
<a name="l00102"></a>00102             }
<a name="l00103"></a>00103             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt;= <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; j++) {
<a name="l00104"></a>00104                <span class="keywordtype">float</span> <a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a> = 0.0;
<a name="l00105"></a>00105                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt;= <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; k++) {
<a name="l00106"></a>00106                   g += eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[k][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1] * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[k][j];
<a name="l00107"></a>00107                }
<a name="l00108"></a>00108                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt;= <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; k++) {
<a name="l00109"></a>00109                   eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[k][j] -= g * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[k];
<a name="l00110"></a>00110                }
<a name="l00111"></a>00111             }
<a name="l00112"></a>00112          }
<a name="l00113"></a>00113          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt;= <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; k++) {
<a name="l00114"></a>00114             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[k][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1] = 0.0;
<a name="l00115"></a>00115          }
<a name="l00116"></a>00116       }
<a name="l00117"></a>00117       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; n; j++) {
<a name="l00118"></a>00118          eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[j] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[n-1][j];
<a name="l00119"></a>00119          eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[n-1][j] = 0.0;
<a name="l00120"></a>00120       }
<a name="l00121"></a>00121       eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[n-1][n-1] = 1.0;
<a name="l00122"></a>00122       eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[0] = 0.0;
<a name="l00123"></a>00123 }
<a name="l00124"></a>00124 
<a name="l00125"></a><a class="code" href="../../da/d0b/EIGENVALUE__HELPER_8h.html#a776ded5abcb855d69a1bc8eb4ad02083">00125</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d05/EIGENVALUE__HELPER_8cpp.html#a776ded5abcb855d69a1bc8eb4ad02083">Eigencdiv</a>(<a class="code" href="../../dd/d53/structsEigenvalue.html">sEigenvalue</a>&amp; eval, <span class="keywordtype">float</span> xr, <span class="keywordtype">float</span> xi, <span class="keywordtype">float</span> yr, <span class="keywordtype">float</span> yi) {
<a name="l00126"></a>00126       <span class="keywordtype">float</span> r,d;
<a name="l00127"></a>00127       <span class="keywordflow">if</span> (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(yr) &gt; <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(yi)) {
<a name="l00128"></a>00128          r = yi/yr;
<a name="l00129"></a>00129          d = yr + r*yi;
<a name="l00130"></a>00130          eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a9d450c33e52f45b5a897e3035698c4d0">cdivr</a> = (xr + r*xi)/d;
<a name="l00131"></a>00131          eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a855c235c1558d908d21f228506aada89">cdivi</a> = (xi - r*xr)/d;
<a name="l00132"></a>00132       } <span class="keywordflow">else</span> {
<a name="l00133"></a>00133          r = yr/yi;
<a name="l00134"></a>00134          d = yi + r*yr;
<a name="l00135"></a>00135          eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a9d450c33e52f45b5a897e3035698c4d0">cdivr</a> = (r*xr + xi)/d;
<a name="l00136"></a>00136          eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a855c235c1558d908d21f228506aada89">cdivi</a> = (r*xi - xr)/d;
<a name="l00137"></a>00137       }
<a name="l00138"></a>00138    }
<a name="l00139"></a>00139 
<a name="l00140"></a><a class="code" href="../../da/d0b/EIGENVALUE__HELPER_8h.html#aacb51e1e305b514373fe8255b44b8f7d">00140</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d05/EIGENVALUE__HELPER_8cpp.html#aacb51e1e305b514373fe8255b44b8f7d">Eigentql2</a> (<a class="code" href="../../dd/d53/structsEigenvalue.html">sEigenvalue</a>&amp; eval) {
<a name="l00141"></a>00141 
<a name="l00142"></a>00142    <span class="comment">//  This is derived from the Algol procedures tql2, by</span>
<a name="l00143"></a>00143    <span class="comment">//  Bowdler, Martin, Reinsch, and Wilkinson, Handbook for</span>
<a name="l00144"></a>00144    <span class="comment">//  Auto. Comp., Vol.ii-Linear Algebra, and the corresponding</span>
<a name="l00145"></a>00145    <span class="comment">//  Fortran subroutine in EISPACK.</span>
<a name="l00146"></a>00146    
<a name="l00147"></a>00147       <span class="keywordtype">int</span> n=eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a59a54c72aa6425fe26688528dff054cb">n</a>;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00150"></a>00150          eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>-1] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00151"></a>00151       }
<a name="l00152"></a>00152       eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[n-1] = 0.0;
<a name="l00153"></a>00153    
<a name="l00154"></a>00154       <span class="keywordtype">float</span> f = 0.0;
<a name="l00155"></a>00155       <span class="keywordtype">float</span> tst1 = 0.0;
<a name="l00156"></a>00156       <span class="keywordtype">float</span> eps = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#af46040b4ed6734ce0bcafe3e53d46dd3">pow</a>(2.0,-52.0);
<a name="l00157"></a>00157       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l = 0; l &lt; n; l++) {
<a name="l00158"></a>00158 
<a name="l00159"></a>00159          <span class="comment">// Find small subdiagonal element</span>
<a name="l00160"></a>00160    
<a name="l00161"></a>00161          tst1 = <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(tst1,<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[l]) + <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[l]));
<a name="l00162"></a>00162          <span class="keywordtype">int</span> m = l;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164         <span class="comment">// Original while-loop from Java code</span>
<a name="l00165"></a>00165          <span class="keywordflow">while</span> (m &lt; n) {
<a name="l00166"></a>00166             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[m]) &lt;= eps*tst1) {
<a name="l00167"></a>00167                <span class="keywordflow">break</span>;
<a name="l00168"></a>00168             }
<a name="l00169"></a>00169             m++;
<a name="l00170"></a>00170          }
<a name="l00171"></a>00171 
<a name="l00172"></a>00172    
<a name="l00173"></a>00173          <span class="comment">// If m == l, d[l] is an eigenvalue,</span>
<a name="l00174"></a>00174          <span class="comment">// otherwise, iterate.</span>
<a name="l00175"></a>00175    
<a name="l00176"></a>00176          <span class="keywordflow">if</span> (m &gt; l) {
<a name="l00177"></a>00177             <span class="keywordtype">int</span> iter = 0;
<a name="l00178"></a>00178             <span class="keywordflow">do</span> {
<a name="l00179"></a>00179                iter = iter + 1;  <span class="comment">// (Could check iteration count here.)</span>
<a name="l00180"></a>00180    
<a name="l00181"></a>00181                <span class="comment">// Compute implicit shift</span>
<a name="l00182"></a>00182 
<a name="l00183"></a>00183                <span class="keywordtype">float</span> <a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a> = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[l];
<a name="l00184"></a>00184                <span class="keywordtype">float</span> <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a> = (eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[l+1] - <a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a>) / (2.0 * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[l]);
<a name="l00185"></a>00185                <span class="keywordtype">float</span> r = <a class="code" href="../../d1/d22/stdosl_8h.html#a7a755196a329811567d88d36ffec115e">hypot</a>(p,1.0);
<a name="l00186"></a>00186                <span class="keywordflow">if</span> (p &lt; 0) {
<a name="l00187"></a>00187                   r = -r;
<a name="l00188"></a>00188                }
<a name="l00189"></a>00189                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[l] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[l] / (p + r);
<a name="l00190"></a>00190                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[l+1] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[l] * (p + r);
<a name="l00191"></a>00191                <span class="keywordtype">float</span> dl1 = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[l+1];
<a name="l00192"></a>00192                <span class="keywordtype">float</span> h = g - eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[l];
<a name="l00193"></a>00193                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = l+2; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00194"></a>00194                   eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] -= h;
<a name="l00195"></a>00195                }
<a name="l00196"></a>00196                f = f + h;
<a name="l00197"></a>00197    
<a name="l00198"></a>00198                <span class="comment">// Implicit QL transformation.</span>
<a name="l00199"></a>00199    
<a name="l00200"></a>00200                p = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[m];
<a name="l00201"></a>00201                <span class="keywordtype">float</span> c = 1.0;
<a name="l00202"></a>00202                <span class="keywordtype">float</span> c2 = c;
<a name="l00203"></a>00203                <span class="keywordtype">float</span> c3 = c;
<a name="l00204"></a>00204                <span class="keywordtype">float</span> el1 = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[l+1];
<a name="l00205"></a>00205                <span class="keywordtype">float</span> s = 0.0;
<a name="l00206"></a>00206                <span class="keywordtype">float</span> s2 = 0.0;
<a name="l00207"></a>00207                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = m-1; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt;= l; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>--) {
<a name="l00208"></a>00208                   c3 = c2;
<a name="l00209"></a>00209                   c2 = c;
<a name="l00210"></a>00210                   s2 = s;
<a name="l00211"></a>00211                   g = c * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00212"></a>00212                   h = c * <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l00213"></a>00213                   r = <a class="code" href="../../d1/d22/stdosl_8h.html#a7a755196a329811567d88d36ffec115e">hypot</a>(p,eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);
<a name="l00214"></a>00214                   eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1] = s * r;
<a name="l00215"></a>00215                   s = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] / r;
<a name="l00216"></a>00216                   c = p / r;
<a name="l00217"></a>00217                   p = c * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] - s * <a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a>;
<a name="l00218"></a>00218                   eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1] = h + s * (c * g + s * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);
<a name="l00219"></a>00219    
<a name="l00220"></a>00220                   <span class="comment">// Accumulate transformation.</span>
<a name="l00221"></a>00221    
<a name="l00222"></a>00222                   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; n; k++) {
<a name="l00223"></a>00223                      h = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[k][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1];
<a name="l00224"></a>00224                      eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[k][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1] = s * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[k][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] + c * h;
<a name="l00225"></a>00225                      eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[k][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = c * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[k][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] - s * h;
<a name="l00226"></a>00226                   }
<a name="l00227"></a>00227                }
<a name="l00228"></a>00228                p = -s * s2 * c3 * el1 * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[l] / dl1;
<a name="l00229"></a>00229                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[l] = s * <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l00230"></a>00230                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[l] = c * <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l00231"></a>00231    
<a name="l00232"></a>00232                <span class="comment">// Check for convergence.</span>
<a name="l00233"></a>00233    
<a name="l00234"></a>00234             } <span class="keywordflow">while</span> (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[l]) &gt; eps*tst1);
<a name="l00235"></a>00235          }
<a name="l00236"></a>00236          eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[l] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[l] + f;
<a name="l00237"></a>00237          eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[l] = 0.0;
<a name="l00238"></a>00238       }
<a name="l00239"></a>00239      
<a name="l00240"></a>00240       <span class="comment">// Sort eigenvalues and corresponding vectors.</span>
<a name="l00241"></a>00241    
<a name="l00242"></a>00242       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n-1; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00243"></a>00243          <span class="keywordtype">int</span> k = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00244"></a>00244          <span class="keywordtype">float</span> <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a> = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00245"></a>00245          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1; j &lt; n; j++) {
<a name="l00246"></a>00246             <span class="keywordflow">if</span> (eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[j] &lt; p) {
<a name="l00247"></a>00247                k = j;
<a name="l00248"></a>00248                p = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[j];
<a name="l00249"></a>00249             }
<a name="l00250"></a>00250          }
<a name="l00251"></a>00251          <span class="keywordflow">if</span> (k != <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>) {
<a name="l00252"></a>00252             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[k] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00253"></a>00253             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l00254"></a>00254             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; n; j++) {
<a name="l00255"></a>00255                p = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[j][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00256"></a>00256                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[j][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[j][k];
<a name="l00257"></a>00257                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[j][k] = <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l00258"></a>00258             }
<a name="l00259"></a>00259          }
<a name="l00260"></a>00260       }
<a name="l00261"></a>00261 }
<a name="l00262"></a>00262 
<a name="l00263"></a><a class="code" href="../../da/d0b/EIGENVALUE__HELPER_8h.html#a487b9262fe6381c4aa1524475981eacd">00263</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d05/EIGENVALUE__HELPER_8cpp.html#a487b9262fe6381c4aa1524475981eacd">Eigenorthes</a> (<a class="code" href="../../dd/d53/structsEigenvalue.html">sEigenvalue</a>&amp; eval) {
<a name="l00264"></a>00264    
<a name="l00265"></a>00265       <span class="comment">//  This is derived from the Algol procedures orthes and ortran,</span>
<a name="l00266"></a>00266       <span class="comment">//  by Martin and Wilkinson, Handbook for Auto. Comp.,</span>
<a name="l00267"></a>00267       <span class="comment">//  Vol.ii-Linear Algebra, and the corresponding</span>
<a name="l00268"></a>00268       <span class="comment">//  Fortran subroutines in EISPACK.</span>
<a name="l00269"></a>00269    
<a name="l00270"></a>00270       <span class="keywordtype">int</span> n=eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a59a54c72aa6425fe26688528dff054cb">n</a>;
<a name="l00271"></a>00271 
<a name="l00272"></a>00272       <span class="keywordtype">int</span> low = 0;
<a name="l00273"></a>00273       <span class="keywordtype">int</span> high = n-1;
<a name="l00274"></a>00274    
<a name="l00275"></a>00275       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m = low+1; m &lt;= high-1; m++) {
<a name="l00276"></a>00276    
<a name="l00277"></a>00277          <span class="comment">// Scale column.</span>
<a name="l00278"></a>00278    
<a name="l00279"></a>00279          <span class="keywordtype">float</span> scale = 0.0;
<a name="l00280"></a>00280          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = m; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= high; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00281"></a>00281             scale = scale + <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][m-1]);
<a name="l00282"></a>00282          }
<a name="l00283"></a>00283          <span class="keywordflow">if</span> (scale != 0.0) {
<a name="l00284"></a>00284    
<a name="l00285"></a>00285             <span class="comment">// Compute Householder transformation.</span>
<a name="l00286"></a>00286    
<a name="l00287"></a>00287             <span class="keywordtype">float</span> h = 0.0;
<a name="l00288"></a>00288             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = high; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt;= m; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>--) {
<a name="l00289"></a>00289                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a01d98226df9962d71a0e811f379dbd1b">ort</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][m-1]/scale;
<a name="l00290"></a>00290                h += eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a01d98226df9962d71a0e811f379dbd1b">ort</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a01d98226df9962d71a0e811f379dbd1b">ort</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00291"></a>00291             }
<a name="l00292"></a>00292             <span class="keywordtype">float</span> <a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a> = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(h);
<a name="l00293"></a>00293             <span class="keywordflow">if</span> (eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a01d98226df9962d71a0e811f379dbd1b">ort</a>[m] &gt; 0) {
<a name="l00294"></a>00294                g = -<a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a>;
<a name="l00295"></a>00295             }
<a name="l00296"></a>00296             h = h - eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a01d98226df9962d71a0e811f379dbd1b">ort</a>[m] * <a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a>;
<a name="l00297"></a>00297             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a01d98226df9962d71a0e811f379dbd1b">ort</a>[m] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a01d98226df9962d71a0e811f379dbd1b">ort</a>[m] - <a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a>;
<a name="l00298"></a>00298    
<a name="l00299"></a>00299             <span class="comment">// Apply Householder similarity transformation</span>
<a name="l00300"></a>00300             <span class="comment">// H = (I-u*u&#39;/h)*H*(I-u*u&#39;)/h)</span>
<a name="l00301"></a>00301    
<a name="l00302"></a>00302             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = m; j &lt; n; j++) {
<a name="l00303"></a>00303                <span class="keywordtype">float</span> f = 0.0;
<a name="l00304"></a>00304                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = high; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt;= m; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>--) {
<a name="l00305"></a>00305                   f += eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a01d98226df9962d71a0e811f379dbd1b">ort</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]*eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j];
<a name="l00306"></a>00306                }
<a name="l00307"></a>00307                f = f/h;
<a name="l00308"></a>00308                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = m; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= high; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00309"></a>00309                   eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] -= f*eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a01d98226df9962d71a0e811f379dbd1b">ort</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00310"></a>00310                }
<a name="l00311"></a>00311            }
<a name="l00312"></a>00312    
<a name="l00313"></a>00313            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= high; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00314"></a>00314                <span class="keywordtype">float</span> f = 0.0;
<a name="l00315"></a>00315                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = high; j &gt;= m; j--) {
<a name="l00316"></a>00316                   f += eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a01d98226df9962d71a0e811f379dbd1b">ort</a>[j]*eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j];
<a name="l00317"></a>00317                }
<a name="l00318"></a>00318                f = f/h;
<a name="l00319"></a>00319                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = m; j &lt;= high; j++) {
<a name="l00320"></a>00320                   eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] -= f*eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a01d98226df9962d71a0e811f379dbd1b">ort</a>[j];
<a name="l00321"></a>00321                }
<a name="l00322"></a>00322             }
<a name="l00323"></a>00323             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a01d98226df9962d71a0e811f379dbd1b">ort</a>[m] = scale*eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a01d98226df9962d71a0e811f379dbd1b">ort</a>[m];
<a name="l00324"></a>00324             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[m][m-1] = scale*<a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a>;
<a name="l00325"></a>00325          }
<a name="l00326"></a>00326       }
<a name="l00327"></a>00327    
<a name="l00328"></a>00328       <span class="comment">// Accumulate transformations (Algol&#39;s ortran).</span>
<a name="l00329"></a>00329 
<a name="l00330"></a>00330       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00331"></a>00331          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; n; j++) {
<a name="l00332"></a>00332             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> == j ? 1.0 : 0.0);
<a name="l00333"></a>00333          }
<a name="l00334"></a>00334       }
<a name="l00335"></a>00335 
<a name="l00336"></a>00336       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m = high-1; m &gt;= low+1; m--) {
<a name="l00337"></a>00337          <span class="keywordflow">if</span> (eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[m][m-1] != 0.0) {
<a name="l00338"></a>00338             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = m+1; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= high; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00339"></a>00339                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a01d98226df9962d71a0e811f379dbd1b">ort</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][m-1];
<a name="l00340"></a>00340             }
<a name="l00341"></a>00341             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = m; j &lt;= high; j++) {
<a name="l00342"></a>00342                <span class="keywordtype">float</span> <a class="code" href="../../dd/d05/noise_8c.html#aff056b2f79b1fecd20667df6d20f81d6">g</a> = 0.0;
<a name="l00343"></a>00343                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = m; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= high; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00344"></a>00344                   g += eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a01d98226df9962d71a0e811f379dbd1b">ort</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j];
<a name="l00345"></a>00345                }
<a name="l00346"></a>00346                <span class="comment">// Double division avoids possible underflow</span>
<a name="l00347"></a>00347                g = (g / eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a01d98226df9962d71a0e811f379dbd1b">ort</a>[m]) / eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[m][m-1];
<a name="l00348"></a>00348                for (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = m; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= high; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00349"></a>00349                   eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] += g * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a01d98226df9962d71a0e811f379dbd1b">ort</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00350"></a>00350                }
<a name="l00351"></a>00351             }
<a name="l00352"></a>00352          }
<a name="l00353"></a>00353       }
<a name="l00354"></a>00354    }
<a name="l00355"></a>00355 
<a name="l00356"></a><a class="code" href="../../da/d0b/EIGENVALUE__HELPER_8h.html#ae55e090955761803c4f56d523f21c602">00356</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d05/EIGENVALUE__HELPER_8cpp.html#ae55e090955761803c4f56d523f21c602">Eigenhqr2</a> (<a class="code" href="../../dd/d53/structsEigenvalue.html">sEigenvalue</a>&amp; eval) {
<a name="l00357"></a>00357    
<a name="l00358"></a>00358       <span class="comment">//  This is derived from the Algol procedure hqr2,</span>
<a name="l00359"></a>00359       <span class="comment">//  by Martin and Wilkinson, Handbook for Auto. Comp.,</span>
<a name="l00360"></a>00360       <span class="comment">//  Vol.ii-Linear Algebra, and the corresponding</span>
<a name="l00361"></a>00361       <span class="comment">//  Fortran subroutine in EISPACK.</span>
<a name="l00362"></a>00362    
<a name="l00363"></a>00363       <span class="comment">// Initialize</span>
<a name="l00364"></a>00364    
<a name="l00365"></a>00365       <span class="keywordtype">int</span> nn = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a59a54c72aa6425fe26688528dff054cb">n</a>;
<a name="l00366"></a>00366       <span class="keywordtype">int</span> n = nn-1;
<a name="l00367"></a>00367       <span class="keywordtype">int</span> low = 0;
<a name="l00368"></a>00368       <span class="keywordtype">int</span> high = nn-1;
<a name="l00369"></a>00369       <span class="keywordtype">float</span> eps = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#af46040b4ed6734ce0bcafe3e53d46dd3">pow</a>(2.0,-52.0);
<a name="l00370"></a>00370       <span class="keywordtype">float</span> exshift = 0.0;
<a name="l00371"></a>00371       <span class="keywordtype">float</span> <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>=0,q=0,r=0,s=0,z=0,t,w,x,y;
<a name="l00372"></a>00372    
<a name="l00373"></a>00373       <span class="comment">// Store roots isolated by balanc and compute matrix norm</span>
<a name="l00374"></a>00374    
<a name="l00375"></a>00375       <span class="keywordtype">float</span> <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a> = 0.0;
<a name="l00376"></a>00376       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nn; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00377"></a>00377          <span class="keywordflow">if</span> ((<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; low) || (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; high)) {
<a name="l00378"></a>00378             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00379"></a>00379             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 0.0;
<a name="l00380"></a>00380          }
<a name="l00381"></a>00381          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>-1,0); j &lt; nn; j++) {
<a name="l00382"></a>00382             norm = norm + <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j]);
<a name="l00383"></a>00383          }
<a name="l00384"></a>00384       }
<a name="l00385"></a>00385    
<a name="l00386"></a>00386       <span class="comment">// Outer loop over eigenvalue index</span>
<a name="l00387"></a>00387    
<a name="l00388"></a>00388       <span class="keywordtype">int</span> iter = 0;
<a name="l00389"></a>00389         <span class="keywordtype">int</span> totIter = 0;
<a name="l00390"></a>00390       <span class="keywordflow">while</span> (n &gt;= low) {
<a name="l00391"></a>00391 
<a name="l00392"></a>00392             <span class="comment">// NT limit no. of iterations</span>
<a name="l00393"></a>00393             totIter++;
<a name="l00394"></a>00394             <span class="keywordflow">if</span>(totIter&gt;100) {
<a name="l00395"></a>00395                 <span class="comment">//if(totIter&gt;15) std::cout&lt;&lt;&quot;!!!!iter ABORT !!!!!!! &quot;&lt;&lt;totIter&lt;&lt;&quot;\n&quot;; </span>
<a name="l00396"></a>00396                 <span class="comment">// NT hack/fix, return large eigenvalues</span>
<a name="l00397"></a>00397                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nn; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00398"></a>00398                     eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 10000.;
<a name="l00399"></a>00399                     eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] = 10000.;
<a name="l00400"></a>00400                 }
<a name="l00401"></a>00401                 <span class="keywordflow">return</span>;
<a name="l00402"></a>00402             }
<a name="l00403"></a>00403    
<a name="l00404"></a>00404          <span class="comment">// Look for single small sub-diagonal element</span>
<a name="l00405"></a>00405    
<a name="l00406"></a>00406          <span class="keywordtype">int</span> l = n;
<a name="l00407"></a>00407          <span class="keywordflow">while</span> (l &gt; low) {
<a name="l00408"></a>00408             s = <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[l-1][l-1]) + <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[l][l]);
<a name="l00409"></a>00409             <span class="keywordflow">if</span> (s == 0.0) {
<a name="l00410"></a>00410                s = <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a>;
<a name="l00411"></a>00411             }
<a name="l00412"></a>00412             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[l][l-1]) &lt; eps * s) {
<a name="l00413"></a>00413                <span class="keywordflow">break</span>;
<a name="l00414"></a>00414             }
<a name="l00415"></a>00415             l--;
<a name="l00416"></a>00416          }
<a name="l00417"></a>00417        
<a name="l00418"></a>00418          <span class="comment">// Check for convergence</span>
<a name="l00419"></a>00419          <span class="comment">// One root found</span>
<a name="l00420"></a>00420    
<a name="l00421"></a>00421          <span class="keywordflow">if</span> (l == n) {
<a name="l00422"></a>00422             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][n] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][n] + exshift;
<a name="l00423"></a>00423             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[n] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][n];
<a name="l00424"></a>00424             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[n] = 0.0;
<a name="l00425"></a>00425             n--;
<a name="l00426"></a>00426             iter = 0;
<a name="l00427"></a>00427    
<a name="l00428"></a>00428          <span class="comment">// Two roots found</span>
<a name="l00429"></a>00429    
<a name="l00430"></a>00430          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (l == n-1) {
<a name="l00431"></a>00431             w = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][n-1] * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n-1][n];
<a name="l00432"></a>00432             p = (eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n-1][n-1] - eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][n]) / 2.0;
<a name="l00433"></a>00433             q = p * p + w;
<a name="l00434"></a>00434             z = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(q));
<a name="l00435"></a>00435             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][n] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][n] + exshift;
<a name="l00436"></a>00436             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n-1][n-1] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n-1][n-1] + exshift;
<a name="l00437"></a>00437             x = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][n];
<a name="l00438"></a>00438    
<a name="l00439"></a>00439             <span class="comment">// float pair</span>
<a name="l00440"></a>00440    
<a name="l00441"></a>00441             <span class="keywordflow">if</span> (q &gt;= 0) {
<a name="l00442"></a>00442                <span class="keywordflow">if</span> (p &gt;= 0) {
<a name="l00443"></a>00443                   z = p + z;
<a name="l00444"></a>00444                } <span class="keywordflow">else</span> {
<a name="l00445"></a>00445                   z = p - z;
<a name="l00446"></a>00446                }
<a name="l00447"></a>00447                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[n-1] = x + z;
<a name="l00448"></a>00448                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[n] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[n-1];
<a name="l00449"></a>00449                <span class="keywordflow">if</span> (z != 0.0) {
<a name="l00450"></a>00450                   eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[n] = x - w / z;
<a name="l00451"></a>00451                }
<a name="l00452"></a>00452                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[n-1] = 0.0;
<a name="l00453"></a>00453                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[n] = 0.0;
<a name="l00454"></a>00454                x = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][n-1];
<a name="l00455"></a>00455                s = <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(x) + <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(z);
<a name="l00456"></a>00456                p = x / s;
<a name="l00457"></a>00457                q = z / s;
<a name="l00458"></a>00458                r = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(p * p+q * q);
<a name="l00459"></a>00459                p = p / r;
<a name="l00460"></a>00460                q = q / r;
<a name="l00461"></a>00461    
<a name="l00462"></a>00462                <span class="comment">// Row modification</span>
<a name="l00463"></a>00463    
<a name="l00464"></a>00464                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = n-1; j &lt; nn; j++) {
<a name="l00465"></a>00465                   z = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n-1][j];
<a name="l00466"></a>00466                   eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n-1][j] = q * z + p * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][j];
<a name="l00467"></a>00467                   eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][j] = q * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][j] - p * z;
<a name="l00468"></a>00468                }
<a name="l00469"></a>00469    
<a name="l00470"></a>00470                <span class="comment">// Column modification</span>
<a name="l00471"></a>00471    
<a name="l00472"></a>00472                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= n; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00473"></a>00473                   z = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n-1];
<a name="l00474"></a>00474                   eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n-1] = q * z + p * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n];
<a name="l00475"></a>00475                   eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n] = q * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n] - p * z;
<a name="l00476"></a>00476                }
<a name="l00477"></a>00477    
<a name="l00478"></a>00478                <span class="comment">// Accumulate transformations</span>
<a name="l00479"></a>00479    
<a name="l00480"></a>00480                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = low; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= high; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00481"></a>00481                   z = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n-1];
<a name="l00482"></a>00482                   eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n-1] = q * z + p * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n];
<a name="l00483"></a>00483                   eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n] = q * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n] - p * z;
<a name="l00484"></a>00484                }
<a name="l00485"></a>00485    
<a name="l00486"></a>00486             <span class="comment">// Complex pair</span>
<a name="l00487"></a>00487    
<a name="l00488"></a>00488             } <span class="keywordflow">else</span> {
<a name="l00489"></a>00489                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[n-1] = x + <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l00490"></a>00490                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[n] = x + <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l00491"></a>00491                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[n-1] = z;
<a name="l00492"></a>00492                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[n] = -z;
<a name="l00493"></a>00493             }
<a name="l00494"></a>00494             n = n - 2;
<a name="l00495"></a>00495             iter = 0;
<a name="l00496"></a>00496    
<a name="l00497"></a>00497          <span class="comment">// No convergence yet</span>
<a name="l00498"></a>00498    
<a name="l00499"></a>00499          } <span class="keywordflow">else</span> {
<a name="l00500"></a>00500    
<a name="l00501"></a>00501             <span class="comment">// Form shift</span>
<a name="l00502"></a>00502    
<a name="l00503"></a>00503             x = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][n];
<a name="l00504"></a>00504             y = 0.0;
<a name="l00505"></a>00505             w = 0.0;
<a name="l00506"></a>00506             <span class="keywordflow">if</span> (l &lt; n) {
<a name="l00507"></a>00507                y = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n-1][n-1];
<a name="l00508"></a>00508                w = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][n-1] * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n-1][n];
<a name="l00509"></a>00509             }
<a name="l00510"></a>00510    
<a name="l00511"></a>00511             <span class="comment">// Wilkinson&#39;s original ad hoc shift</span>
<a name="l00512"></a>00512    
<a name="l00513"></a>00513             <span class="keywordflow">if</span> (iter == 10) {
<a name="l00514"></a>00514                exshift += x;
<a name="l00515"></a>00515                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = low; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= n; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00516"></a>00516                   eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] -= x;
<a name="l00517"></a>00517                }
<a name="l00518"></a>00518                s = <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][n-1]) + <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n-1][n-2]);
<a name="l00519"></a>00519                x = y = 0.75 * s;
<a name="l00520"></a>00520                w = -0.4375 * s * s;
<a name="l00521"></a>00521             }
<a name="l00522"></a>00522 
<a name="l00523"></a>00523             <span class="comment">// MATLAB&#39;s new ad hoc shift</span>
<a name="l00524"></a>00524 
<a name="l00525"></a>00525             <span class="keywordflow">if</span> (iter == 30) {
<a name="l00526"></a>00526                 s = (y - x) / 2.0;
<a name="l00527"></a>00527                 s = s * s + w;
<a name="l00528"></a>00528                 <span class="keywordflow">if</span> (s &gt; 0) {
<a name="l00529"></a>00529                     s = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(s);
<a name="l00530"></a>00530                     <span class="keywordflow">if</span> (y &lt; x) {
<a name="l00531"></a>00531                        s = -s;
<a name="l00532"></a>00532                     }
<a name="l00533"></a>00533                     s = x - w / ((y - x) / 2.0 + s);
<a name="l00534"></a>00534                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = low; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= n; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00535"></a>00535                        eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] -= s;
<a name="l00536"></a>00536                     }
<a name="l00537"></a>00537                     exshift += s;
<a name="l00538"></a>00538                     x = y = w = 0.964;
<a name="l00539"></a>00539                 }
<a name="l00540"></a>00540             }
<a name="l00541"></a>00541    
<a name="l00542"></a>00542             iter = iter + 1;   <span class="comment">// (Could check iteration count here.)</span>
<a name="l00543"></a>00543    
<a name="l00544"></a>00544             <span class="comment">// Look for two consecutive small sub-diagonal elements</span>
<a name="l00545"></a>00545    
<a name="l00546"></a>00546             <span class="keywordtype">int</span> m = n-2;
<a name="l00547"></a>00547             <span class="keywordflow">while</span> (m &gt;= l) {
<a name="l00548"></a>00548                z = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[m][m];
<a name="l00549"></a>00549                r = x - z;
<a name="l00550"></a>00550                s = y - z;
<a name="l00551"></a>00551                p = (r * s - w) / eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[m+1][m] + eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[m][m+1];
<a name="l00552"></a>00552                q = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[m+1][m+1] - z - r - s;
<a name="l00553"></a>00553                r = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[m+2][m+1];
<a name="l00554"></a>00554                s = <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(p) + <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(q) + <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(r);
<a name="l00555"></a>00555                p = p / s;
<a name="l00556"></a>00556                q = q / s;
<a name="l00557"></a>00557                r = r / s;
<a name="l00558"></a>00558                <span class="keywordflow">if</span> (m == l) {
<a name="l00559"></a>00559                   <span class="keywordflow">break</span>;
<a name="l00560"></a>00560                }
<a name="l00561"></a>00561                <span class="keywordflow">if</span> (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[m][m-1]) * (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(q) + <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(r)) &lt;
<a name="l00562"></a>00562                   eps * (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(p) * (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[m-1][m-1]) + <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(z) +
<a name="l00563"></a>00563                   <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[m+1][m+1])))) {
<a name="l00564"></a>00564                      <span class="keywordflow">break</span>;
<a name="l00565"></a>00565                }
<a name="l00566"></a>00566                m--;
<a name="l00567"></a>00567             }
<a name="l00568"></a>00568    
<a name="l00569"></a>00569             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = m+2; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= n; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00570"></a>00570                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>-2] = 0.0;
<a name="l00571"></a>00571                <span class="keywordflow">if</span> (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; m+2) {
<a name="l00572"></a>00572                   eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>-3] = 0.0;
<a name="l00573"></a>00573                }
<a name="l00574"></a>00574             }
<a name="l00575"></a>00575    
<a name="l00576"></a>00576             <span class="comment">// Double QR step involving rows l:n and columns m:n</span>
<a name="l00577"></a>00577    
<a name="l00578"></a>00578             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = m; k &lt;= n-1; k++) {
<a name="l00579"></a>00579                <span class="keywordtype">int</span> notlast = (k != n-1);
<a name="l00580"></a>00580                <span class="keywordflow">if</span> (k != m) {
<a name="l00581"></a>00581                   p = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[k][k-1];
<a name="l00582"></a>00582                   q = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[k+1][k-1];
<a name="l00583"></a>00583                   r = (notlast ? eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[k+2][k-1] : 0.0);
<a name="l00584"></a>00584                   x = <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(p) + <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(q) + <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(r);
<a name="l00585"></a>00585                   <span class="keywordflow">if</span> (x != 0.0) {
<a name="l00586"></a>00586                      p = p / x;
<a name="l00587"></a>00587                      q = q / x;
<a name="l00588"></a>00588                      r = r / x;
<a name="l00589"></a>00589                   }
<a name="l00590"></a>00590                }
<a name="l00591"></a>00591                <span class="keywordflow">if</span> (x == 0.0) {
<a name="l00592"></a>00592                   <span class="keywordflow">break</span>;
<a name="l00593"></a>00593                }
<a name="l00594"></a>00594                s = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(p * p + q * q + r * r);
<a name="l00595"></a>00595                <span class="keywordflow">if</span> (p &lt; 0) {
<a name="l00596"></a>00596                   s = -s;
<a name="l00597"></a>00597                }
<a name="l00598"></a>00598                <span class="keywordflow">if</span> (s != 0) {
<a name="l00599"></a>00599                   <span class="keywordflow">if</span> (k != m) {
<a name="l00600"></a>00600                      eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[k][k-1] = -s * x;
<a name="l00601"></a>00601                   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (l != m) {
<a name="l00602"></a>00602                      eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[k][k-1] = -eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[k][k-1];
<a name="l00603"></a>00603                   }
<a name="l00604"></a>00604                   p = p + s;
<a name="l00605"></a>00605                   x = p / s;
<a name="l00606"></a>00606                   y = q / s;
<a name="l00607"></a>00607                   z = r / s;
<a name="l00608"></a>00608                   q = q / <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l00609"></a>00609                   r = r / <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l00610"></a>00610    
<a name="l00611"></a>00611                   <span class="comment">// Row modification</span>
<a name="l00612"></a>00612    
<a name="l00613"></a>00613                   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = k; j &lt; nn; j++) {
<a name="l00614"></a>00614                      p = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[k][j] + q * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[k+1][j];
<a name="l00615"></a>00615                      <span class="keywordflow">if</span> (notlast) {
<a name="l00616"></a>00616                         p = p + r * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[k+2][j];
<a name="l00617"></a>00617                         eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[k+2][j] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[k+2][j] - p * z;
<a name="l00618"></a>00618                      }
<a name="l00619"></a>00619                      eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[k][j] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[k][j] - p * x;
<a name="l00620"></a>00620                      eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[k+1][j] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[k+1][j] - p * y;
<a name="l00621"></a>00621                   }
<a name="l00622"></a>00622    
<a name="l00623"></a>00623                   <span class="comment">// Column modification</span>
<a name="l00624"></a>00624    
<a name="l00625"></a>00625                   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(n,k+3); <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00626"></a>00626                      p = x * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][k] + y * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][k+1];
<a name="l00627"></a>00627                      <span class="keywordflow">if</span> (notlast) {
<a name="l00628"></a>00628                         p = p + z * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][k+2];
<a name="l00629"></a>00629                         eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][k+2] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][k+2] - p * r;
<a name="l00630"></a>00630                      }
<a name="l00631"></a>00631                      eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][k] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][k] - <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l00632"></a>00632                      eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][k+1] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][k+1] - p * q;
<a name="l00633"></a>00633                   }
<a name="l00634"></a>00634    
<a name="l00635"></a>00635                   <span class="comment">// Accumulate transformations</span>
<a name="l00636"></a>00636    
<a name="l00637"></a>00637                   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = low; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= high; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00638"></a>00638                      p = x * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][k] + y * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][k+1];
<a name="l00639"></a>00639                      <span class="keywordflow">if</span> (notlast) {
<a name="l00640"></a>00640                         p = p + z * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][k+2];
<a name="l00641"></a>00641                         eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][k+2] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][k+2] - p * r;
<a name="l00642"></a>00642                      }
<a name="l00643"></a>00643                      eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][k] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][k] - <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l00644"></a>00644                      eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][k+1] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][k+1] - p * q;
<a name="l00645"></a>00645                   }
<a name="l00646"></a>00646                }  <span class="comment">// (s != 0)</span>
<a name="l00647"></a>00647             }  <span class="comment">// k loop</span>
<a name="l00648"></a>00648          }  <span class="comment">// check convergence</span>
<a name="l00649"></a>00649       }  <span class="comment">// while (n &gt;= low)</span>
<a name="l00650"></a>00650         <span class="comment">//if(totIter&gt;15) std::cout&lt;&lt;&quot;!!!!iter &quot;&lt;&lt;totIter&lt;&lt;&quot;\n&quot;;</span>
<a name="l00651"></a>00651       
<a name="l00652"></a>00652       <span class="comment">// Backsubstitute to find vectors of upper triangular form</span>
<a name="l00653"></a>00653 
<a name="l00654"></a>00654       <span class="keywordflow">if</span> (norm == 0.0) {
<a name="l00655"></a>00655          <span class="keywordflow">return</span>;
<a name="l00656"></a>00656       }
<a name="l00657"></a>00657    
<a name="l00658"></a>00658       <span class="keywordflow">for</span> (n = nn-1; n &gt;= 0; n--) {
<a name="l00659"></a>00659          p = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[n];
<a name="l00660"></a>00660          q = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[n];
<a name="l00661"></a>00661    
<a name="l00662"></a>00662          <span class="comment">// float vector</span>
<a name="l00663"></a>00663    
<a name="l00664"></a>00664          <span class="keywordflow">if</span> (q == 0) {
<a name="l00665"></a>00665             <span class="keywordtype">int</span> l = n;
<a name="l00666"></a>00666             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][n] = 1.0;
<a name="l00667"></a>00667             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = n-1; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt;= 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>--) {
<a name="l00668"></a>00668                w = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] - <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l00669"></a>00669                r = 0.0;
<a name="l00670"></a>00670                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = l; j &lt;= n; j++) {
<a name="l00671"></a>00671                   r = r + eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[j][n];
<a name="l00672"></a>00672                }
<a name="l00673"></a>00673                <span class="keywordflow">if</span> (eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt; 0.0) {
<a name="l00674"></a>00674                   z = w;
<a name="l00675"></a>00675                   s = r;
<a name="l00676"></a>00676                } <span class="keywordflow">else</span> {
<a name="l00677"></a>00677                   l = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00678"></a>00678                   <span class="keywordflow">if</span> (eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] == 0.0) {
<a name="l00679"></a>00679                      <span class="keywordflow">if</span> (w != 0.0) {
<a name="l00680"></a>00680                         eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n] = -r / w;
<a name="l00681"></a>00681                      } <span class="keywordflow">else</span> {
<a name="l00682"></a>00682                         eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n] = -r / (eps * <a class="code" href="../../d1/d8e/ntl__vector3dim_8h.html#a828f653994f3f04fe2a539bc1ed64590">norm</a>);
<a name="l00683"></a>00683                      }
<a name="l00684"></a>00684    
<a name="l00685"></a>00685                   <span class="comment">// Solve real equations</span>
<a name="l00686"></a>00686    
<a name="l00687"></a>00687                   } <span class="keywordflow">else</span> {
<a name="l00688"></a>00688                      x = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1];
<a name="l00689"></a>00689                      y = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00690"></a>00690                      q = (eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] - <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>) * (eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] - p) + eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00691"></a>00691                      t = (x * s - z * r) / q;
<a name="l00692"></a>00692                      eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n] = t;
<a name="l00693"></a>00693                      <span class="keywordflow">if</span> (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(x) &gt; <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(z)) {
<a name="l00694"></a>00694                         eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1][n] = (-r - w * t) / x;
<a name="l00695"></a>00695                      } <span class="keywordflow">else</span> {
<a name="l00696"></a>00696                         eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1][n] = (-s - y * t) / z;
<a name="l00697"></a>00697                      }
<a name="l00698"></a>00698                   }
<a name="l00699"></a>00699    
<a name="l00700"></a>00700                   <span class="comment">// Overflow control</span>
<a name="l00701"></a>00701    
<a name="l00702"></a>00702                   t = <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n]);
<a name="l00703"></a>00703                   <span class="keywordflow">if</span> ((eps * t) * t &gt; 1) {
<a name="l00704"></a>00704                      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; j &lt;= n; j++) {
<a name="l00705"></a>00705                         eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[j][n] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[j][n] / t;
<a name="l00706"></a>00706                      }
<a name="l00707"></a>00707                   }
<a name="l00708"></a>00708                }
<a name="l00709"></a>00709             }
<a name="l00710"></a>00710    
<a name="l00711"></a>00711          <span class="comment">// Complex vector</span>
<a name="l00712"></a>00712    
<a name="l00713"></a>00713          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (q &lt; 0) {
<a name="l00714"></a>00714             <span class="keywordtype">int</span> l = n-1;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716             <span class="comment">// Last vector component imaginary so matrix is triangular</span>
<a name="l00717"></a>00717    
<a name="l00718"></a>00718             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][n-1]) &gt; <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n-1][n])) {
<a name="l00719"></a>00719                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n-1][n-1] = q / eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][n-1];
<a name="l00720"></a>00720                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n-1][n] = -(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][n] - <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>) / eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][n-1];
<a name="l00721"></a>00721             } <span class="keywordflow">else</span> {
<a name="l00722"></a>00722                <a class="code" href="../../d1/d05/EIGENVALUE__HELPER_8cpp.html#a776ded5abcb855d69a1bc8eb4ad02083">Eigencdiv</a>(eval, 0.0,-eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n-1][n],eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n-1][n-1]-p,q);
<a name="l00723"></a>00723                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n-1][n-1] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a9d450c33e52f45b5a897e3035698c4d0">cdivr</a>;
<a name="l00724"></a>00724                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n-1][n] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a855c235c1558d908d21f228506aada89">cdivi</a>;
<a name="l00725"></a>00725             }
<a name="l00726"></a>00726             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][n-1] = 0.0;
<a name="l00727"></a>00727             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[n][n] = 1.0;
<a name="l00728"></a>00728             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = n-2; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt;= 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>--) {
<a name="l00729"></a>00729                <span class="keywordtype">float</span> ra,sa,vr,vi;
<a name="l00730"></a>00730                ra = 0.0;
<a name="l00731"></a>00731                sa = 0.0;
<a name="l00732"></a>00732                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = l; j &lt;= n; j++) {
<a name="l00733"></a>00733                   ra = ra + eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[j][n-1];
<a name="l00734"></a>00734                   sa = sa + eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[j][n];
<a name="l00735"></a>00735                }
<a name="l00736"></a>00736                w = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] - <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>;
<a name="l00737"></a>00737    
<a name="l00738"></a>00738                <span class="keywordflow">if</span> (eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt; 0.0) {
<a name="l00739"></a>00739                   z = w;
<a name="l00740"></a>00740                   r = ra;
<a name="l00741"></a>00741                   s = sa;
<a name="l00742"></a>00742                } <span class="keywordflow">else</span> {
<a name="l00743"></a>00743                   l = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00744"></a>00744                   <span class="keywordflow">if</span> (eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] == 0) {
<a name="l00745"></a>00745                      <a class="code" href="../../d1/d05/EIGENVALUE__HELPER_8cpp.html#a776ded5abcb855d69a1bc8eb4ad02083">Eigencdiv</a>(eval,-ra,-sa,w,q);
<a name="l00746"></a>00746                      eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n-1] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a9d450c33e52f45b5a897e3035698c4d0">cdivr</a>;
<a name="l00747"></a>00747                      eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a855c235c1558d908d21f228506aada89">cdivi</a>;
<a name="l00748"></a>00748                   } <span class="keywordflow">else</span> {
<a name="l00749"></a>00749    
<a name="l00750"></a>00750                      <span class="comment">// Solve complex equations</span>
<a name="l00751"></a>00751    
<a name="l00752"></a>00752                      x = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1];
<a name="l00753"></a>00753                      y = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>];
<a name="l00754"></a>00754                      vr = (eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] - <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>) * (eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] - p) + eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] - q * q;
<a name="l00755"></a>00755                      vi = (eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>] - <a class="code" href="../../dd/d05/noise_8c.html#aa5b68af6f39f968261f8942af260e938">p</a>) * 2.0 * q;
<a name="l00756"></a>00756                      <span class="keywordflow">if</span> ((vr == 0.0) &amp;&amp; (vi == 0.0)) {
<a name="l00757"></a>00757                         vr = eps * norm * (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(w) + <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(q) +
<a name="l00758"></a>00758                         <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(x) + <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(y) + <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(z));
<a name="l00759"></a>00759                      }
<a name="l00760"></a>00760                      <a class="code" href="../../d1/d05/EIGENVALUE__HELPER_8cpp.html#a776ded5abcb855d69a1bc8eb4ad02083">Eigencdiv</a>(eval, x*r-z*ra+q*sa,x*s-z*sa-q*ra,vr,vi);
<a name="l00761"></a>00761                      eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n-1] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a9d450c33e52f45b5a897e3035698c4d0">cdivr</a>;
<a name="l00762"></a>00762                      eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a855c235c1558d908d21f228506aada89">cdivi</a>;
<a name="l00763"></a>00763                      <span class="keywordflow">if</span> (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(x) &gt; (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(z) + <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(q))) {
<a name="l00764"></a>00764                         eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1][n-1] = (-ra - w * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n-1] + q * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n]) / x;
<a name="l00765"></a>00765                         eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1][n] = (-sa - w * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n] - q * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n-1]) / x;
<a name="l00766"></a>00766                      } <span class="keywordflow">else</span> {
<a name="l00767"></a>00767                         <a class="code" href="../../d1/d05/EIGENVALUE__HELPER_8cpp.html#a776ded5abcb855d69a1bc8eb4ad02083">Eigencdiv</a>(eval, -r-y*eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n-1],-s-y*eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n],z,q);
<a name="l00768"></a>00768                         eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1][n-1] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a9d450c33e52f45b5a897e3035698c4d0">cdivr</a>;
<a name="l00769"></a>00769                         eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>+1][n] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a855c235c1558d908d21f228506aada89">cdivi</a>;
<a name="l00770"></a>00770                      }
<a name="l00771"></a>00771                   }
<a name="l00772"></a>00772    
<a name="l00773"></a>00773                   <span class="comment">// Overflow control</span>
<a name="l00774"></a>00774 
<a name="l00775"></a>00775                   t = <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n-1]),<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][n]));
<a name="l00776"></a>00776                   <span class="keywordflow">if</span> ((eps * t) * t &gt; 1) {
<a name="l00777"></a>00777                      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; j &lt;= n; j++) {
<a name="l00778"></a>00778                         eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[j][n-1] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[j][n-1] / t;
<a name="l00779"></a>00779                         eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[j][n] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[j][n] / t;
<a name="l00780"></a>00780                      }
<a name="l00781"></a>00781                   }
<a name="l00782"></a>00782                }
<a name="l00783"></a>00783             }
<a name="l00784"></a>00784          }
<a name="l00785"></a>00785       }
<a name="l00786"></a>00786    
<a name="l00787"></a>00787       <span class="comment">// Vectors of isolated roots</span>
<a name="l00788"></a>00788    
<a name="l00789"></a>00789       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; nn; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00790"></a>00790          <span class="keywordflow">if</span> (i &lt; low || i &gt; high) {
<a name="l00791"></a>00791             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>; j &lt; nn; j++) {
<a name="l00792"></a>00792                eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j];
<a name="l00793"></a>00793             }
<a name="l00794"></a>00794          }
<a name="l00795"></a>00795       }
<a name="l00796"></a>00796    
<a name="l00797"></a>00797       <span class="comment">// Back transformation to get eigenvectors of original matrix</span>
<a name="l00798"></a>00798    
<a name="l00799"></a>00799       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = nn-1; j &gt;= low; j--) {
<a name="l00800"></a>00800          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = low; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;= high; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00801"></a>00801             z = 0.0;
<a name="l00802"></a>00802             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = low; k &lt;= <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(j,high); k++) {
<a name="l00803"></a>00803                z = z + eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][k] * eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[k][j];
<a name="l00804"></a>00804             }
<a name="l00805"></a>00805             eval.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = z;
<a name="l00806"></a>00806          }
<a name="l00807"></a>00807       }
<a name="l00808"></a>00808 }
<a name="l00809"></a>00809 
<a name="l00810"></a>00810 
<a name="l00811"></a>00811 
<a name="l00812"></a><a class="code" href="../../da/d0b/EIGENVALUE__HELPER_8h.html#a3582d3e64171dfc96191bf4c42abfc8c">00812</a> <span class="keywordtype">int</span> <a class="code" href="../../d1/d05/EIGENVALUE__HELPER_8cpp.html#a3582d3e64171dfc96191bf4c42abfc8c">computeEigenvalues3x3</a>(
<a name="l00813"></a>00813         <span class="keywordtype">float</span> dout[3], 
<a name="l00814"></a>00814         <span class="keywordtype">float</span> a[3][3])
<a name="l00815"></a>00815 {
<a name="l00816"></a>00816   <span class="comment">/*TNT::Array2D&lt;float&gt; A = TNT::Array2D&lt;float&gt;(3,3, &amp;a[0][0]);</span>
<a name="l00817"></a>00817 <span class="comment">  TNT::Array1D&lt;float&gt; eig = TNT::Array1D&lt;float&gt;(3);</span>
<a name="l00818"></a>00818 <span class="comment">  TNT::Array1D&lt;float&gt; eigImag = TNT::Array1D&lt;float&gt;(3);</span>
<a name="l00819"></a>00819 <span class="comment">  JAMA::Eigenvalue&lt;float&gt; jeig = JAMA::Eigenvalue&lt;float&gt;(A);*/</span>
<a name="l00820"></a>00820 
<a name="l00821"></a>00821     <a class="code" href="../../dd/d53/structsEigenvalue.html">sEigenvalue</a> jeig;
<a name="l00822"></a>00822 
<a name="l00823"></a>00823     <span class="comment">// Compute the values</span>
<a name="l00824"></a>00824     {
<a name="l00825"></a>00825         jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#a59a54c72aa6425fe26688528dff054cb">n</a> = 3;
<a name="l00826"></a>00826         <span class="keywordtype">int</span> n=3;
<a name="l00827"></a>00827       <span class="comment">//V = Array2D&lt;float&gt;(n,n);</span>
<a name="l00828"></a>00828       <span class="comment">//d = Array1D&lt;float&gt;(n);</span>
<a name="l00829"></a>00829       <span class="comment">//e = Array1D&lt;float&gt;(n);</span>
<a name="l00830"></a>00830         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=0; y&lt;3; y++)
<a name="l00831"></a>00831          {
<a name="l00832"></a>00832              jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[y]=0.0f;
<a name="l00833"></a>00833              jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[y]=0.0f;
<a name="l00834"></a>00834              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> t=0; t&lt;3; t++) jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[y][t]=0.0f;
<a name="l00835"></a>00835          }
<a name="l00836"></a>00836 
<a name="l00837"></a>00837       jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#a018f787d350ca92d59ecf316941d439f">issymmetric</a> = 1;
<a name="l00838"></a>00838       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; (j &lt; 3) &amp;&amp; jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#a018f787d350ca92d59ecf316941d439f">issymmetric</a>; j++) {
<a name="l00839"></a>00839          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; (<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 3) &amp;&amp; jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#a018f787d350ca92d59ecf316941d439f">issymmetric</a>; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00840"></a>00840             jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#a018f787d350ca92d59ecf316941d439f">issymmetric</a> = (a[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] == a[j][<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>]);
<a name="l00841"></a>00841          }
<a name="l00842"></a>00842       }
<a name="l00843"></a>00843 
<a name="l00844"></a>00844       <span class="keywordflow">if</span> (jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#a018f787d350ca92d59ecf316941d439f">issymmetric</a>) {
<a name="l00845"></a>00845          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 3; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00846"></a>00846             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) {
<a name="l00847"></a>00847                jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#a79e8b9268f70180fb7b35d227b363a36">V</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = a[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j];
<a name="l00848"></a>00848             }
<a name="l00849"></a>00849          }
<a name="l00850"></a>00850    
<a name="l00851"></a>00851          <span class="comment">// Tridiagonalize.</span>
<a name="l00852"></a>00852          <a class="code" href="../../d1/d05/EIGENVALUE__HELPER_8cpp.html#a360b1ead54ddd48790e3798ca5513f29">Eigentred2</a>(jeig);
<a name="l00853"></a>00853    
<a name="l00854"></a>00854          <span class="comment">// Diagonalize.</span>
<a name="l00855"></a>00855          <a class="code" href="../../d1/d05/EIGENVALUE__HELPER_8cpp.html#aacb51e1e305b514373fe8255b44b8f7d">Eigentql2</a>(jeig);
<a name="l00856"></a>00856 
<a name="l00857"></a>00857       } <span class="keywordflow">else</span> {
<a name="l00858"></a>00858          <span class="comment">//H = TNT::Array2D&lt;float&gt;(n,n);</span>
<a name="l00859"></a>00859          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=0; y&lt;3; y++)
<a name="l00860"></a>00860          {
<a name="l00861"></a>00861              jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#a01d98226df9962d71a0e811f379dbd1b">ort</a>[y]=0.0f;
<a name="l00862"></a>00862              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> t=0; t&lt;3; t++) jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[y][t]=0.0f;
<a name="l00863"></a>00863          }
<a name="l00864"></a>00864          <span class="comment">//ort = TNT::Array1D&lt;float&gt;(n);</span>
<a name="l00865"></a>00865          
<a name="l00866"></a>00866          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; n; j++) {
<a name="l00867"></a>00867             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; n; <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {
<a name="l00868"></a>00868                jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#a752ecfad25b1f79f4b1e0a1f6e171462">H</a>[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j] = a[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>][j];
<a name="l00869"></a>00869             }
<a name="l00870"></a>00870          }
<a name="l00871"></a>00871    
<a name="l00872"></a>00872          <span class="comment">// Reduce to Hessenberg form.</span>
<a name="l00873"></a>00873          <a class="code" href="../../d1/d05/EIGENVALUE__HELPER_8cpp.html#a487b9262fe6381c4aa1524475981eacd">Eigenorthes</a>(jeig);
<a name="l00874"></a>00874    
<a name="l00875"></a>00875          <span class="comment">// Reduce Hessenberg to real Schur form.</span>
<a name="l00876"></a>00876          <a class="code" href="../../d1/d05/EIGENVALUE__HELPER_8cpp.html#ae55e090955761803c4f56d523f21c602">Eigenhqr2</a>(jeig);
<a name="l00877"></a>00877       }
<a name="l00878"></a>00878    }
<a name="l00879"></a>00879 
<a name="l00880"></a>00880   <span class="comment">//jeig.getfloatEigenvalues(eig);</span>
<a name="l00881"></a>00881 
<a name="l00882"></a>00882   <span class="comment">// complex ones</span>
<a name="l00883"></a>00883   <span class="comment">//jeig.getImagEigenvalues(eigImag);</span>
<a name="l00884"></a>00884   dout[0]  = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[0]*jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[0] + jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[0]*jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[0]);
<a name="l00885"></a>00885   dout[1]  = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[1]*jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[1] + jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[1]*jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[1]);
<a name="l00886"></a>00886   dout[2]  = <a class="code" href="../../d7/d47/NM__Scalar_8h.html#aa3fc8738e36a262f694814c04e8ef744">sqrt</a>(jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[2]*jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#ac8ef4a5a52a76a25a85b4e5e7f3941bf">d</a>[2] + jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[2]*jeig.<a class="code" href="../../dd/d53/structsEigenvalue.html#aee22f9c2528a3658355a3eab1a0ad8b9">e</a>[2]);
<a name="l00887"></a>00887   <span class="keywordflow">return</span> 0;
<a name="l00888"></a>00888 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:17 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: ImageRender.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">ImageRender.cpp</div>  </div>
</div>
<div class="contents">
<a href="../../d1/d58/ImageRender_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">-----------------------------------------------------------------------------</span>
<a name="l00003"></a>00003 <span class="comment">This source file is part of VideoTexture library</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">Copyright (c) 2007 The Zdeno Ash Miklas</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">This program is free software; you can redistribute it and/or modify it under</span>
<a name="l00008"></a>00008 <span class="comment">the terms of the GNU Lesser General Public License as published by the Free Software</span>
<a name="l00009"></a>00009 <span class="comment">Foundation; either version 2 of the License, or (at your option) any later</span>
<a name="l00010"></a>00010 <span class="comment">version.</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</span>
<a name="l00013"></a>00013 <span class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span>
<a name="l00014"></a>00014 <span class="comment">FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.</span>
<a name="l00015"></a>00015 <span class="comment"></span>
<a name="l00016"></a>00016 <span class="comment">You should have received a copy of the GNU Lesser General Public License along with</span>
<a name="l00017"></a>00017 <span class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</span>
<a name="l00018"></a>00018 <span class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</span>
<a name="l00019"></a>00019 <span class="comment">http://www.gnu.org/copyleft/lesser.txt.</span>
<a name="l00020"></a>00020 <span class="comment">-----------------------------------------------------------------------------</span>
<a name="l00021"></a>00021 <span class="comment">*/</span>
<a name="l00022"></a>00022 
<a name="l00027"></a>00027 <span class="comment">// implementation</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="../../d7/db2/PyObjectPlus_8h.html">PyObjectPlus.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;structmember.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;float.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;GL/glew.h&quot;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/de4/KX__PythonInit_8h.html">KX_PythonInit.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d10/RAS__CameraData_8h.html">RAS_CameraData.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d62/RAS__MeshObject_8h.html">RAS_MeshObject.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d56/ImageRender_8h.html">ImageRender.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/dc8/ImageBase_8h.html">ImageBase.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/dbe/BlendType_8h.html">BlendType.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d8a/Exception_8h.html">Exception.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dbf/Texture_8h.html">Texture.h</a>&quot;</span>
<a name="l00048"></a>00048 
<a name="l00049"></a><a class="code" href="../../d1/d58/ImageRender_8cpp.html#acac6bcb1038b453d40ee0893a372d2f4">00049</a> <a class="code" href="../../d5/d67/classExceptionID.html">ExceptionID</a> <a class="code" href="../../d1/d58/ImageRender_8cpp.html#acac6bcb1038b453d40ee0893a372d2f4">SceneInvalid</a>, <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a1d28a9933503b7d5c7946e1fc22ad2a4">CameraInvalid</a>, <a class="code" href="../../d1/d58/ImageRender_8cpp.html#aea62251b7566807249c5e2df4992b27b">ObserverInvalid</a>;
<a name="l00050"></a><a class="code" href="../../d1/d58/ImageRender_8cpp.html#a85aecf2fc90c99c24b39ca86fc16bc33">00050</a> <a class="code" href="../../d5/d67/classExceptionID.html">ExceptionID</a> <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a3b7486e6317c40beee404adf4cc5fda1">MirrorInvalid</a>, <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a762528afd39c69dc1d08d23b977c8f58">MirrorSizeInvalid</a>, <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a2415e539b60200768ad0f263975cfd1d">MirrorNormalInvalid</a>, <a class="code" href="../../d1/d58/ImageRender_8cpp.html#ad118fa90b9a2b23ae6fe31439d74d4f3">MirrorHorizontal</a>, <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a85aecf2fc90c99c24b39ca86fc16bc33">MirrorTooSmall</a>;
<a name="l00051"></a>00051 <a class="code" href="../../d6/d6b/classExpDesc.html">ExpDesc</a> <a class="code" href="../../d8/d8a/Exception_8h.html#a6074f79b082a9789f81b99b7e1a66e89">SceneInvalidDesc</a> (SceneInvalid, <span class="stringliteral">&quot;Scene object is invalid&quot;</span>);
<a name="l00052"></a>00052 <a class="code" href="../../d6/d6b/classExpDesc.html">ExpDesc</a> <a class="code" href="../../d8/d8a/Exception_8h.html#a3a1cae4a37c83f5b19ed7a398bf6b146">CameraInvalidDesc</a> (CameraInvalid, <span class="stringliteral">&quot;Camera object is invalid&quot;</span>);
<a name="l00053"></a>00053 <a class="code" href="../../d6/d6b/classExpDesc.html">ExpDesc</a> <a class="code" href="../../d8/d8a/Exception_8h.html#a44280ac3ad743bbf219f8a443f579225">ObserverInvalidDesc</a> (ObserverInvalid, <span class="stringliteral">&quot;Observer object is invalid&quot;</span>);
<a name="l00054"></a>00054 <a class="code" href="../../d6/d6b/classExpDesc.html">ExpDesc</a> <a class="code" href="../../d8/d8a/Exception_8h.html#a9058814177afbeaaf3e4a8ea98faad4d">MirrorInvalidDesc</a> (MirrorInvalid, <span class="stringliteral">&quot;Mirror object is invalid&quot;</span>);
<a name="l00055"></a>00055 <a class="code" href="../../d6/d6b/classExpDesc.html">ExpDesc</a> <a class="code" href="../../d8/d8a/Exception_8h.html#a2336fdbd794698a6922de2f15a5b2582">MirrorSizeInvalidDesc</a> (MirrorSizeInvalid, <span class="stringliteral">&quot;Mirror has no vertex or no size&quot;</span>);
<a name="l00056"></a>00056 <a class="code" href="../../d6/d6b/classExpDesc.html">ExpDesc</a> <a class="code" href="../../d8/d8a/Exception_8h.html#ac44a9a505e3cd7977ac9e725a8bb13b9">MirrorNormalInvalidDesc</a> (MirrorNormalInvalid, <span class="stringliteral">&quot;Cannot determine mirror plane&quot;</span>);
<a name="l00057"></a>00057 <a class="code" href="../../d6/d6b/classExpDesc.html">ExpDesc</a> <a class="code" href="../../d8/d8a/Exception_8h.html#a1175a23a094096137fc9e4b9305364a0">MirrorHorizontalDesc</a> (MirrorHorizontal, <span class="stringliteral">&quot;Mirror is horizontal in local space&quot;</span>);
<a name="l00058"></a>00058 <a class="code" href="../../d6/d6b/classExpDesc.html">ExpDesc</a> <a class="code" href="../../d8/d8a/Exception_8h.html#a224dd3a3b2acad66349130b7bdebdd40">MirrorTooSmallDesc</a> (MirrorTooSmall, <span class="stringliteral">&quot;Mirror is too small&quot;</span>);
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="comment">// constructor</span>
<a name="l00061"></a><a class="code" href="../../d9/d39/classImageRender.html#a0c716b4bbcb486ba4a89f981b32bd209">00061</a> <a class="code" href="../../d9/d39/classImageRender.html#a0c716b4bbcb486ba4a89f981b32bd209" title="constructor">ImageRender::ImageRender</a> (<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a> * scene, <a class="code" href="../../dc/d6b/classKX__Camera.html">KX_Camera</a> * camera) : 
<a name="l00062"></a>00062     <a class="code" href="../../d5/dbb/classImageViewport.html" title="class for viewport access">ImageViewport</a>(),
<a name="l00063"></a>00063     m_render(true),
<a name="l00064"></a>00064     m_scene(scene),
<a name="l00065"></a>00065     m_camera(camera),
<a name="l00066"></a>00066     m_owncamera(false),
<a name="l00067"></a>00067     m_observer(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),
<a name="l00068"></a>00068     m_mirror(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),
<a name="l00069"></a>00069     m_clip(100.f)
<a name="l00070"></a>00070 {
<a name="l00071"></a>00071     <span class="comment">// initialize background color</span>
<a name="l00072"></a>00072     <a class="code" href="../../d9/d39/classImageRender.html#af850c63feb829045e043c08ce62b06fb" title="set background color">setBackground</a>(0, 0, 255, 255);
<a name="l00073"></a>00073     <span class="comment">// retrieve rendering objects</span>
<a name="l00074"></a>00074     <a class="code" href="../../d9/d39/classImageRender.html#a08abdefd263c1e5b0704a76139fecaa4" title="engine">m_engine</a> = <a class="code" href="../../d6/dc2/KX__PythonInit_8cpp.html#a73270876d4beab375ee4cbc78e597251">KX_GetActiveEngine</a>();
<a name="l00075"></a>00075     <a class="code" href="../../d9/d39/classImageRender.html#aea654ba5e5ae670e8fc31aba031245f4" title="rasterizer">m_rasterizer</a> = <a class="code" href="../../d9/d39/classImageRender.html#a08abdefd263c1e5b0704a76139fecaa4" title="engine">m_engine</a>-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a270c67e55406bb68bfd7319d5969411b">GetRasterizer</a>();
<a name="l00076"></a>00076     <a class="code" href="../../d9/d39/classImageRender.html#a92fd1c68835cb45297999a424f0db4f5" title="canvas">m_canvas</a> = <a class="code" href="../../d9/d39/classImageRender.html#a08abdefd263c1e5b0704a76139fecaa4" title="engine">m_engine</a>-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a95ef4b484c4599aad58075d438a84fb7">GetCanvas</a>();
<a name="l00077"></a>00077     <a class="code" href="../../d9/d39/classImageRender.html#ab2841958aab8cb3acdaa1c0ecf9f8d02" title="render tools">m_rendertools</a> = <a class="code" href="../../d9/d39/classImageRender.html#a08abdefd263c1e5b0704a76139fecaa4" title="engine">m_engine</a>-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#af284473bd42a01eb72f9f87422cbda7d">GetRenderTools</a>();
<a name="l00078"></a>00078 }
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="comment">// destructor</span>
<a name="l00081"></a><a class="code" href="../../d9/d39/classImageRender.html#a604b5ffe4d37d6d3c11fd09e43b81cef">00081</a> <a class="code" href="../../d9/d39/classImageRender.html#a604b5ffe4d37d6d3c11fd09e43b81cef" title="destructor">ImageRender::~ImageRender</a> (<span class="keywordtype">void</span>)
<a name="l00082"></a>00082 {
<a name="l00083"></a>00083     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d39/classImageRender.html#aae4a067350e00c95087f8bf55b0525b3" title="do we own the camera?">m_owncamera</a>)
<a name="l00084"></a>00084         <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l00085"></a>00085 }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="comment">// set background color</span>
<a name="l00089"></a><a class="code" href="../../d9/d39/classImageRender.html#af850c63feb829045e043c08ce62b06fb">00089</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/d39/classImageRender.html#af850c63feb829045e043c08ce62b06fb" title="set background color">ImageRender::setBackground</a> (<span class="keywordtype">int</span> red, <span class="keywordtype">int</span> green, <span class="keywordtype">int</span> blue, <span class="keywordtype">int</span> alpha)
<a name="l00090"></a>00090 {
<a name="l00091"></a>00091     <a class="code" href="../../d9/d39/classImageRender.html#ad00bdf1f5f3faab5b32a136f75f111a4" title="background color">m_background</a>[0] = (red &lt; 0) ? 0.f : (red &gt; 255) ? 1.f : float(red)/255.f;
<a name="l00092"></a>00092     <a class="code" href="../../d9/d39/classImageRender.html#ad00bdf1f5f3faab5b32a136f75f111a4" title="background color">m_background</a>[1] = (green &lt; 0) ? 0.f : (green &gt; 255) ? 1.f : float(green)/255.f;
<a name="l00093"></a>00093     <a class="code" href="../../d9/d39/classImageRender.html#ad00bdf1f5f3faab5b32a136f75f111a4" title="background color">m_background</a>[2] = (blue &lt; 0) ? 0.f : (blue &gt; 255) ? 1.f : float(blue)/255.f;
<a name="l00094"></a>00094     <a class="code" href="../../d9/d39/classImageRender.html#ad00bdf1f5f3faab5b32a136f75f111a4" title="background color">m_background</a>[3] = (alpha &lt; 0) ? 0.f : (alpha &gt; 255) ? 1.f : float(alpha)/255.f;
<a name="l00095"></a>00095 }
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="comment">// capture image from viewport</span>
<a name="l00099"></a><a class="code" href="../../d9/d39/classImageRender.html#a8113bd837faeb5b296b990b9abf21ddd">00099</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/d39/classImageRender.html#a8113bd837faeb5b296b990b9abf21ddd" title="render 3d scene to image">ImageRender::calcImage</a> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> texId, <span class="keywordtype">double</span> ts)
<a name="l00100"></a>00100 {
<a name="l00101"></a>00101     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d39/classImageRender.html#aea654ba5e5ae670e8fc31aba031245f4" title="rasterizer">m_rasterizer</a>-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a42f751301787c9e1b6b33496272c68b3">GetDrawingMode</a>() != <a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1e450d3092cf13b212c568ddf5b6573ba4b378cf7c027c56584bd10ef212077ba">RAS_IRasterizer::KX_TEXTURED</a> ||   <span class="comment">// no need for texture</span>
<a name="l00102"></a>00102             <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#a3f906da230c5ac4a8699a8ad12305a56">GetViewport</a>() ||        <span class="comment">// camera must be inactive</span>
<a name="l00103"></a>00103             <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a> == <a class="code" href="../../d9/d39/classImageRender.html#abbc05f766a69f4677745db509b9c546a" title="rendered scene">m_scene</a>-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a8127f5823a26b8f1c87db68908088826">GetActiveCamera</a>())
<a name="l00104"></a>00104     {
<a name="l00105"></a>00105         <span class="comment">// no need to compute texture in non texture rendering</span>
<a name="l00106"></a>00106         <a class="code" href="../../d7/d1e/classImageBase.html#a5d95583e493b1c7281fa80fdc0ca54e5" title="image is available">m_avail</a> = <span class="keyword">false</span>;
<a name="l00107"></a>00107         <span class="keywordflow">return</span>;
<a name="l00108"></a>00108     }
<a name="l00109"></a>00109     <span class="comment">// render the scene from the camera</span>
<a name="l00110"></a>00110     <a class="code" href="../../d9/d39/classImageRender.html#ab07cc5f58689e065611b845cdd977b4f">Render</a>();
<a name="l00111"></a>00111     <span class="comment">// get image from viewport</span>
<a name="l00112"></a>00112     <a class="code" href="../../d9/d39/classImageRender.html#a8113bd837faeb5b296b990b9abf21ddd" title="render 3d scene to image">ImageViewport::calcImage</a>(texId, ts);
<a name="l00113"></a>00113     <span class="comment">// restore OpenGL state</span>
<a name="l00114"></a>00114     <a class="code" href="../../d9/d39/classImageRender.html#a92fd1c68835cb45297999a424f0db4f5" title="canvas">m_canvas</a>-&gt;<a class="code" href="../../d5/df6/classRAS__ICanvas.html#ac84834e8518ec51d988bf16345a5b7ad">EndFrame</a>();
<a name="l00115"></a>00115 }
<a name="l00116"></a>00116 
<a name="l00117"></a><a class="code" href="../../d9/d39/classImageRender.html#ab07cc5f58689e065611b845cdd977b4f">00117</a> <span class="keywordtype">void</span> <a class="code" href="../../d9/d39/classImageRender.html#ab07cc5f58689e065611b845cdd977b4f">ImageRender::Render</a>()
<a name="l00118"></a>00118 {
<a name="l00119"></a>00119     <a class="code" href="../../dd/d89/structRAS__FrameFrustum.html">RAS_FrameFrustum</a> frustrum;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121     <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d39/classImageRender.html#a3f229e2d20ec1cffd0b7afc77a07ae55" title="true if ready to render">m_render</a>)
<a name="l00122"></a>00122         <span class="keywordflow">return</span>;
<a name="l00123"></a>00123 
<a name="l00124"></a>00124     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d39/classImageRender.html#a4f7fee0c88b5d091f90e4452891df49b">m_mirror</a>)
<a name="l00125"></a>00125     {
<a name="l00126"></a>00126         <span class="comment">// mirror mode, compute camera frustrum, position and orientation</span>
<a name="l00127"></a>00127         <span class="comment">// convert mirror position and normal in world space</span>
<a name="l00128"></a>00128         <span class="keyword">const</span> <a class="code" href="../../dd/d6f/classMT__Matrix3x3.html">MT_Matrix3x3</a> &amp; mirrorObjWorldOri = <a class="code" href="../../d9/d39/classImageRender.html#a4f7fee0c88b5d091f90e4452891df49b">m_mirror</a>-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a1da2a4c264204b135154f815f41d637e">GetWorldOrientation</a>();
<a name="l00129"></a>00129         <span class="keyword">const</span> <a class="code" href="../../d0/d9e/classMT__Point3.html">MT_Point3</a> &amp; mirrorObjWorldPos = <a class="code" href="../../d9/d39/classImageRender.html#a4f7fee0c88b5d091f90e4452891df49b">m_mirror</a>-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a1bbc34fe0c2345e55900eaa5943dfc51">GetWorldPosition</a>();
<a name="l00130"></a>00130         <span class="keyword">const</span> <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a> &amp; mirrorObjWorldScale = <a class="code" href="../../d9/d39/classImageRender.html#a4f7fee0c88b5d091f90e4452891df49b">m_mirror</a>-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a3078d7872c2ae7a194546c96b09ff301">GetWorldScaling</a>();
<a name="l00131"></a>00131         <a class="code" href="../../d0/d9e/classMT__Point3.html">MT_Point3</a> mirrorWorldPos =
<a name="l00132"></a>00132                 mirrorObjWorldPos + mirrorObjWorldScale * (mirrorObjWorldOri * <a class="code" href="../../d9/d39/classImageRender.html#a6fe6800583ee5161f07b78dfe9240523">m_mirrorPos</a>);
<a name="l00133"></a>00133         <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a> mirrorWorldZ = mirrorObjWorldOri * <a class="code" href="../../d9/d39/classImageRender.html#a675cf44208b656f4f2b2083a3a7d722a">m_mirrorZ</a>;
<a name="l00134"></a>00134         <span class="comment">// get observer world position</span>
<a name="l00135"></a>00135         <span class="keyword">const</span> <a class="code" href="../../d0/d9e/classMT__Point3.html">MT_Point3</a> &amp; observerWorldPos = <a class="code" href="../../d9/d39/classImageRender.html#a959094b8b90105618320310da580b34b" title="for mirror operation">m_observer</a>-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a1bbc34fe0c2345e55900eaa5943dfc51">GetWorldPosition</a>();
<a name="l00136"></a>00136         <span class="comment">// get plane D term = mirrorPos . normal</span>
<a name="l00137"></a>00137         <a class="code" href="../../d6/dc4/MT__Scalar_8h.html#a71b06cc1a8da1da228878ebfd84cd2a9">MT_Scalar</a> mirrorPlaneDTerm = mirrorWorldPos.<a class="code" href="../../d6/d9d/classMT__Vector3.html#a46a95b173394ecf471432277a14135df">dot</a>(mirrorWorldZ);
<a name="l00138"></a>00138         <span class="comment">// compute distance of observer to mirror = D - observerPos . normal</span>
<a name="l00139"></a>00139         <a class="code" href="../../d6/dc4/MT__Scalar_8h.html#a71b06cc1a8da1da228878ebfd84cd2a9">MT_Scalar</a> observerDistance = mirrorPlaneDTerm - observerWorldPos.<a class="code" href="../../d6/d9d/classMT__Vector3.html#a46a95b173394ecf471432277a14135df">dot</a>(mirrorWorldZ);
<a name="l00140"></a>00140         <span class="comment">// if distance &lt; 0.01 =&gt; observer is on wrong side of mirror, don&#39;t render</span>
<a name="l00141"></a>00141         <span class="keywordflow">if</span> (observerDistance &lt; 0.01f)
<a name="l00142"></a>00142             <span class="keywordflow">return</span>;
<a name="l00143"></a>00143         <span class="comment">// set camera world position = observerPos + normal * 2 * distance</span>
<a name="l00144"></a>00144         <a class="code" href="../../d0/d9e/classMT__Point3.html">MT_Point3</a> cameraWorldPos = observerWorldPos + (<a class="code" href="../../d6/dc4/MT__Scalar_8h.html#a71b06cc1a8da1da228878ebfd84cd2a9">MT_Scalar</a>(2.0)*observerDistance)*mirrorWorldZ;
<a name="l00145"></a>00145         <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a30d80c0a5ade811c461435a6875aa77f">SetLocalPosition</a>(cameraWorldPos);
<a name="l00146"></a>00146         <span class="comment">// set camera orientation: z=normal, y=mirror_up in world space, x= y x z</span>
<a name="l00147"></a>00147         <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a> mirrorWorldY = mirrorObjWorldOri * <a class="code" href="../../d9/d39/classImageRender.html#afc3d270e893f7e3061b7fa5b05044c2b">m_mirrorY</a>;
<a name="l00148"></a>00148         <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a> mirrorWorldX = mirrorObjWorldOri * <a class="code" href="../../d9/d39/classImageRender.html#af6156f2ae22d30b244809035f64cb6f1">m_mirrorX</a>;
<a name="l00149"></a>00149         <a class="code" href="../../dd/d6f/classMT__Matrix3x3.html">MT_Matrix3x3</a> cameraWorldOri(
<a name="l00150"></a>00150                     mirrorWorldX[0], mirrorWorldY[0], mirrorWorldZ[0],
<a name="l00151"></a>00151                     mirrorWorldX[1], mirrorWorldY[1], mirrorWorldZ[1],
<a name="l00152"></a>00152                     mirrorWorldX[2], mirrorWorldY[2], mirrorWorldZ[2]);
<a name="l00153"></a>00153         <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d4/d22/classSG__Spatial.html#a589c6b5ec03b113430cd912d5bd0fdc1">SetLocalOrientation</a>(cameraWorldOri);
<a name="l00154"></a>00154         <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0be04ac2ce18c262fd28cb92f5c296b7">GetSGNode</a>()-&gt;<a class="code" href="../../d8/d3b/classSG__Node.html#a791ba43c770c33dc637bb61f93152745">UpdateWorldData</a>(0.0);
<a name="l00155"></a>00155         <span class="comment">// compute camera frustrum:</span>
<a name="l00156"></a>00156         <span class="comment">//   get position of mirror relative to camera: offset = mirrorPos-cameraPos</span>
<a name="l00157"></a>00157         <a class="code" href="../../d6/d9d/classMT__Vector3.html">MT_Vector3</a> mirrorOffset = mirrorWorldPos - cameraWorldPos;
<a name="l00158"></a>00158         <span class="comment">//   convert to camera orientation</span>
<a name="l00159"></a>00159         mirrorOffset = mirrorOffset * cameraWorldOri;
<a name="l00160"></a>00160         <span class="comment">//   scale mirror size to world scale:</span>
<a name="l00161"></a>00161         <span class="comment">//     get closest local axis for mirror Y and X axis and scale height and width by local axis scale</span>
<a name="l00162"></a>00162         <a class="code" href="../../d6/dc4/MT__Scalar_8h.html#a71b06cc1a8da1da228878ebfd84cd2a9">MT_Scalar</a> x, y;
<a name="l00163"></a>00163         x = <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(m_mirrorY[0]);
<a name="l00164"></a>00164         y = <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(m_mirrorY[1]);
<a name="l00165"></a>00165         <span class="keywordtype">float</span> height = (x &gt; y) ?
<a name="l00166"></a>00166                     ((x &gt; <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(m_mirrorY[2])) ? mirrorObjWorldScale[0] : mirrorObjWorldScale[2]):
<a name="l00167"></a>00167                     ((y &gt; <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(m_mirrorY[2])) ? mirrorObjWorldScale[1] : mirrorObjWorldScale[2]);
<a name="l00168"></a>00168         x = <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(m_mirrorX[0]);
<a name="l00169"></a>00169         y = <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(m_mirrorX[1]);
<a name="l00170"></a>00170         <span class="keywordtype">float</span> width = (x &gt; y) ?
<a name="l00171"></a>00171                     ((x &gt; <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(m_mirrorX[2])) ? mirrorObjWorldScale[0] : mirrorObjWorldScale[2]):
<a name="l00172"></a>00172                     ((y &gt; <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(m_mirrorX[2])) ? mirrorObjWorldScale[1] : mirrorObjWorldScale[2]);
<a name="l00173"></a>00173         width *= <a class="code" href="../../d9/d39/classImageRender.html#acc39511cae054e324498e8770a100c5c">m_mirrorHalfWidth</a>;
<a name="l00174"></a>00174         height *= <a class="code" href="../../d9/d39/classImageRender.html#a2cfac82b50827b9b83bf49dc4293ccf0">m_mirrorHalfHeight</a>;
<a name="l00175"></a>00175         <span class="comment">//   left = offsetx-width</span>
<a name="l00176"></a>00176         <span class="comment">//   right = offsetx+width</span>
<a name="l00177"></a>00177         <span class="comment">//   top = offsety+height</span>
<a name="l00178"></a>00178         <span class="comment">//   bottom = offsety-height</span>
<a name="l00179"></a>00179         <span class="comment">//   near = -offsetz</span>
<a name="l00180"></a>00180         <span class="comment">//   far = near+100</span>
<a name="l00181"></a>00181         frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#a7e0df7f27503f0081b4fcc866ddfa5eb">x1</a> = mirrorOffset[0]-width;
<a name="l00182"></a>00182         frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#aa6136e0602b4659033e59d31c5281d40">x2</a> = mirrorOffset[0]+width;
<a name="l00183"></a>00183         frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#ab4ddefa682c1930d06e915ece3e69f05">y1</a> = mirrorOffset[1]-height;
<a name="l00184"></a>00184         frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#a0fd0c1bdef582ca08a8bc1965727b4c8">y2</a> = mirrorOffset[1]+height;
<a name="l00185"></a>00185         frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#a0ea1170690da47dc34508eaa7eba5ad5">camnear</a> = -mirrorOffset[2];
<a name="l00186"></a>00186         frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#ae98a2b5dd698a836610688f144ef676a">camfar</a> = -mirrorOffset[2]+<a class="code" href="../../d9/d39/classImageRender.html#aa51c494113696b58d29f535ae78a9ec6">m_clip</a>;
<a name="l00187"></a>00187     }
<a name="l00188"></a>00188     <span class="comment">// Store settings to be restored later</span>
<a name="l00189"></a>00189     <span class="keyword">const</span> <a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a40a4df42bdb050d883d4ff0a40558dc8">RAS_IRasterizer::StereoMode</a> stereomode = <a class="code" href="../../d9/d39/classImageRender.html#aea654ba5e5ae670e8fc31aba031245f4" title="rasterizer">m_rasterizer</a>-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a9ec64e5944bfdbc13e7b098b8f130987">GetStereoMode</a>();
<a name="l00190"></a>00190     <a class="code" href="../../d9/d14/classRAS__Rect.html">RAS_Rect</a> area = <a class="code" href="../../d9/d39/classImageRender.html#a92fd1c68835cb45297999a424f0db4f5" title="canvas">m_canvas</a>-&gt;<a class="code" href="../../d5/df6/classRAS__ICanvas.html#a1c856054e47078f4b3cfd0e9da61b0b8">GetWindowArea</a>();
<a name="l00191"></a>00191 
<a name="l00192"></a>00192     <span class="comment">// The screen area that ImageViewport will copy is also the rendering zone</span>
<a name="l00193"></a>00193     <a class="code" href="../../d9/d39/classImageRender.html#a92fd1c68835cb45297999a424f0db4f5" title="canvas">m_canvas</a>-&gt;<a class="code" href="../../d5/df6/classRAS__ICanvas.html#a7752b6fe56ad96775c842386ef176d50">SetViewPort</a>(<a class="code" href="../../d5/dbb/classImageViewport.html#adf51a8a89a2ed4e0f147a8910ca46d3e" title="position of capture rectangle in viewport">m_position</a>[0], <a class="code" href="../../d5/dbb/classImageViewport.html#adf51a8a89a2ed4e0f147a8910ca46d3e" title="position of capture rectangle in viewport">m_position</a>[1], <a class="code" href="../../d5/dbb/classImageViewport.html#adf51a8a89a2ed4e0f147a8910ca46d3e" title="position of capture rectangle in viewport">m_position</a>[0]+<a class="code" href="../../d5/dbb/classImageViewport.html#a011aeaee3e75cf70d97f9fea40b20dbc" title="size of captured area">m_capSize</a>[0]-1, <a class="code" href="../../d5/dbb/classImageViewport.html#adf51a8a89a2ed4e0f147a8910ca46d3e" title="position of capture rectangle in viewport">m_position</a>[1]+<a class="code" href="../../d5/dbb/classImageViewport.html#a011aeaee3e75cf70d97f9fea40b20dbc" title="size of captured area">m_capSize</a>[1]-1);
<a name="l00194"></a>00194     <a class="code" href="../../d9/d39/classImageRender.html#a92fd1c68835cb45297999a424f0db4f5" title="canvas">m_canvas</a>-&gt;<a class="code" href="../../d5/df6/classRAS__ICanvas.html#acb17d1a03add17037f7b6b4df880cbf0">ClearColor</a>(<a class="code" href="../../d9/d39/classImageRender.html#ad00bdf1f5f3faab5b32a136f75f111a4" title="background color">m_background</a>[0], <a class="code" href="../../d9/d39/classImageRender.html#ad00bdf1f5f3faab5b32a136f75f111a4" title="background color">m_background</a>[1], <a class="code" href="../../d9/d39/classImageRender.html#ad00bdf1f5f3faab5b32a136f75f111a4" title="background color">m_background</a>[2], <a class="code" href="../../d9/d39/classImageRender.html#ad00bdf1f5f3faab5b32a136f75f111a4" title="background color">m_background</a>[3]);
<a name="l00195"></a>00195     <a class="code" href="../../d9/d39/classImageRender.html#a92fd1c68835cb45297999a424f0db4f5" title="canvas">m_canvas</a>-&gt;<a class="code" href="../../d5/df6/classRAS__ICanvas.html#a51c9148b5a85dcbc015755cb419b3cc7">ClearBuffer</a>(<a class="code" href="../../d5/df6/classRAS__ICanvas.html#aecc0ff8375685e5500be06e2d63c3b9aa0275f5b2c36aafa89068cd53b459032d">RAS_ICanvas::COLOR_BUFFER</a>|<a class="code" href="../../d5/df6/classRAS__ICanvas.html#aecc0ff8375685e5500be06e2d63c3b9aaf00e00f727c7701009aba73c001783fa">RAS_ICanvas::DEPTH_BUFFER</a>);
<a name="l00196"></a>00196     <a class="code" href="../../d9/d39/classImageRender.html#aea654ba5e5ae670e8fc31aba031245f4" title="rasterizer">m_rasterizer</a>-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a29d922d1b20e33c3f8dd8d5ff2afb1bd">BeginFrame</a>(<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1e450d3092cf13b212c568ddf5b6573ba4b378cf7c027c56584bd10ef212077ba">RAS_IRasterizer::KX_TEXTURED</a>,<a class="code" href="../../d9/d39/classImageRender.html#a08abdefd263c1e5b0704a76139fecaa4" title="engine">m_engine</a>-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a74e367e3f14c5eab971b301278482ac8">GetClockTime</a>());
<a name="l00197"></a>00197     <a class="code" href="../../d9/d39/classImageRender.html#ab2841958aab8cb3acdaa1c0ecf9f8d02" title="render tools">m_rendertools</a>-&gt;<a class="code" href="../../d0/d53/classRAS__IRenderTools.html#a0e1f31f5ad82d515b198f059c9e80919">BeginFrame</a>(<a class="code" href="../../d9/d39/classImageRender.html#aea654ba5e5ae670e8fc31aba031245f4" title="rasterizer">m_rasterizer</a>);
<a name="l00198"></a>00198     <a class="code" href="../../d9/d39/classImageRender.html#a08abdefd263c1e5b0704a76139fecaa4" title="engine">m_engine</a>-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a96b70fc06533ca2436b08a488aeba0bb">SetWorldSettings</a>(<a class="code" href="../../d9/d39/classImageRender.html#abbc05f766a69f4677745db509b9c546a" title="rendered scene">m_scene</a>-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a4831748648dedf769fd668499302da65">GetWorldInfo</a>());
<a name="l00199"></a>00199     <a class="code" href="../../d9/d39/classImageRender.html#ab2841958aab8cb3acdaa1c0ecf9f8d02" title="render tools">m_rendertools</a>-&gt;<a class="code" href="../../d0/d53/classRAS__IRenderTools.html#a2c7fe610cbca83cefa752013ee1eeda6">SetAuxilaryClientInfo</a>(<a class="code" href="../../d9/d39/classImageRender.html#abbc05f766a69f4677745db509b9c546a" title="rendered scene">m_scene</a>);
<a name="l00200"></a>00200     <a class="code" href="../../d9/d39/classImageRender.html#aea654ba5e5ae670e8fc31aba031245f4" title="rasterizer">m_rasterizer</a>-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#abdb81cdb82feda39ecf2715bfb7dd271">DisplayFog</a>();
<a name="l00201"></a>00201     <span class="comment">// matrix calculation, don&#39;t apply any of the stereo mode</span>
<a name="l00202"></a>00202     <a class="code" href="../../d9/d39/classImageRender.html#aea654ba5e5ae670e8fc31aba031245f4" title="rasterizer">m_rasterizer</a>-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1938989a3e96dfff9a57b61c9ab8d668">SetStereoMode</a>(<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a40a4df42bdb050d883d4ff0a40558dc8a75351f25797fa47d5cd720f98c2080a8">RAS_IRasterizer::RAS_STEREO_NOSTEREO</a>);
<a name="l00203"></a>00203     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d39/classImageRender.html#a4f7fee0c88b5d091f90e4452891df49b">m_mirror</a>)
<a name="l00204"></a>00204     {
<a name="l00205"></a>00205         <span class="comment">// frustrum was computed above</span>
<a name="l00206"></a>00206         <span class="comment">// get frustrum matrix and set projection matrix</span>
<a name="l00207"></a>00207         <a class="code" href="../../d0/d08/classMT__Matrix4x4.html">MT_Matrix4x4</a> projmat = <a class="code" href="../../d9/d39/classImageRender.html#aea654ba5e5ae670e8fc31aba031245f4" title="rasterizer">m_rasterizer</a>-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#af5ad4a4d1db68049e17ea3ed5831cf41">GetFrustumMatrix</a>(
<a name="l00208"></a>00208                     frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#a7e0df7f27503f0081b4fcc866ddfa5eb">x1</a>, frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#aa6136e0602b4659033e59d31c5281d40">x2</a>, frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#ab4ddefa682c1930d06e915ece3e69f05">y1</a>, frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#a0fd0c1bdef582ca08a8bc1965727b4c8">y2</a>, frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#a0ea1170690da47dc34508eaa7eba5ad5">camnear</a>, frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#ae98a2b5dd698a836610688f144ef676a">camfar</a>);
<a name="l00209"></a>00209 
<a name="l00210"></a>00210         <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#aadcd28903e9b4ec55b06a4975bfdbc4f">SetProjectionMatrix</a>(projmat);
<a name="l00211"></a>00211     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#ad50a81e44b719db3c8ce94eb256f8ba1">hasValidProjectionMatrix</a>())
<a name="l00212"></a>00212     {
<a name="l00213"></a>00213         <a class="code" href="../../d9/d39/classImageRender.html#aea654ba5e5ae670e8fc31aba031245f4" title="rasterizer">m_rasterizer</a>-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a2d89588f8158e2bb0ea2af4c28a73442">SetProjectionMatrix</a>(<a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#a42094332026a25144f0f8479728d3f10">GetProjectionMatrix</a>());
<a name="l00214"></a>00214     } <span class="keywordflow">else</span>
<a name="l00215"></a>00215     {
<a name="l00216"></a>00216         <span class="keywordtype">float</span> lens = <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#afea0738739733416f77a974d6e09f592">GetLens</a>();
<a name="l00217"></a>00217         <span class="keywordtype">float</span> sensor_x = <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#a23f99917faf5b5d3b214cfef5644f3f5">GetSensorWidth</a>();
<a name="l00218"></a>00218         <span class="keywordtype">float</span> sensor_y = <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#a9dc4e076e38dd4408b26520c5891c377">GetSensorHeight</a>();
<a name="l00219"></a>00219         <span class="keywordtype">bool</span> orthographic = !<a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#a3e184a18c7a79e6c28b93dc50628785a">GetCameraData</a>()-&gt;<a class="code" href="../../d4/d81/structRAS__CameraData.html#a51a2d3a80aaca99ecb43a31b76a6dec5">m_perspective</a>;
<a name="l00220"></a>00220         <span class="keywordtype">float</span> nearfrust = <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#aa3714035978a31d4300732f61e48755b">GetCameraNear</a>();
<a name="l00221"></a>00221         <span class="keywordtype">float</span> farfrust = <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#a2ef3c6679c3915fd6673812f0bcabdf6">GetCameraFar</a>();
<a name="l00222"></a>00222         <span class="keywordtype">float</span> aspect_ratio = 1.0f;
<a name="l00223"></a>00223         <a class="code" href="../../d9/d27/structScene.html">Scene</a> *blenderScene = <a class="code" href="../../d9/d39/classImageRender.html#abbc05f766a69f4677745db509b9c546a" title="rendered scene">m_scene</a>-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a217279a18aca964cf8d28d3ad6bdb95d">GetBlenderScene</a>();
<a name="l00224"></a>00224         <a class="code" href="../../d0/d08/classMT__Matrix4x4.html">MT_Matrix4x4</a> projmat;
<a name="l00225"></a>00225 
<a name="l00226"></a>00226         <span class="comment">// compute the aspect ratio from frame blender scene settings so that render to texture</span>
<a name="l00227"></a>00227         <span class="comment">// works the same in Blender and in Blender player</span>
<a name="l00228"></a>00228         <span class="keywordflow">if</span> (blenderScene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aca3c1ebdf50a6c74730e19e24983217d">ysch</a> != 0)
<a name="l00229"></a>00229             aspect_ratio = float(blenderScene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#afac89783028ff848f111de04e0c29fbe">xsch</a>*blenderScene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a7c97c9fb3ae2b02bd4ccb8c76d68811a">xasp</a>) / float(blenderScene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#aca3c1ebdf50a6c74730e19e24983217d">ysch</a>*blenderScene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a1f4c395a81051abd055a1014e02c9f00">yasp</a>);
<a name="l00230"></a>00230 
<a name="l00231"></a>00231         <span class="keywordflow">if</span> (orthographic) {
<a name="l00232"></a>00232 
<a name="l00233"></a>00233             <a class="code" href="../../d4/d13/classRAS__FramingManager.html#acbf75d9335ec98f86c193d62bf25e338">RAS_FramingManager::ComputeDefaultOrtho</a>(
<a name="l00234"></a>00234                         nearfrust,
<a name="l00235"></a>00235                         farfrust,
<a name="l00236"></a>00236                         <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#a40674fe85a7933fbeb4196b322b33d52">GetScale</a>(),
<a name="l00237"></a>00237                         aspect_ratio,
<a name="l00238"></a>00238                         <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#a67d4527ba3aedca877bdb2dd97a47ca0">GetSensorFit</a>(),
<a name="l00239"></a>00239                         frustrum
<a name="l00240"></a>00240                         );
<a name="l00241"></a>00241 
<a name="l00242"></a>00242             projmat = <a class="code" href="../../d9/d39/classImageRender.html#aea654ba5e5ae670e8fc31aba031245f4" title="rasterizer">m_rasterizer</a>-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#ab983ceff193cdad9d5a3e1481f9a7b99">GetOrthoMatrix</a>(
<a name="l00243"></a>00243                         frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#a7e0df7f27503f0081b4fcc866ddfa5eb">x1</a>, frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#aa6136e0602b4659033e59d31c5281d40">x2</a>, frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#ab4ddefa682c1930d06e915ece3e69f05">y1</a>, frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#a0fd0c1bdef582ca08a8bc1965727b4c8">y2</a>, frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#a0ea1170690da47dc34508eaa7eba5ad5">camnear</a>, frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#ae98a2b5dd698a836610688f144ef676a">camfar</a>);
<a name="l00244"></a>00244         } <span class="keywordflow">else</span>
<a name="l00245"></a>00245         {
<a name="l00246"></a>00246             <a class="code" href="../../d4/d13/classRAS__FramingManager.html#ab3cb178bdbebbac1121040e25b56cf43">RAS_FramingManager::ComputeDefaultFrustum</a>(
<a name="l00247"></a>00247                         nearfrust,
<a name="l00248"></a>00248                         farfrust,
<a name="l00249"></a>00249                         lens,
<a name="l00250"></a>00250                         sensor_x,
<a name="l00251"></a>00251                         sensor_y,
<a name="l00252"></a>00252                         <a class="code" href="../../da/da6/RAS__FramingManager_8h.html#a1224590ae92216547f249fe515fb571ca6ba2528abb7205700af82f21a0fca857">RAS_SENSORFIT_AUTO</a>,
<a name="l00253"></a>00253                         aspect_ratio,
<a name="l00254"></a>00254                         frustrum);
<a name="l00255"></a>00255             
<a name="l00256"></a>00256             projmat = <a class="code" href="../../d9/d39/classImageRender.html#aea654ba5e5ae670e8fc31aba031245f4" title="rasterizer">m_rasterizer</a>-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#af5ad4a4d1db68049e17ea3ed5831cf41">GetFrustumMatrix</a>(
<a name="l00257"></a>00257                         frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#a7e0df7f27503f0081b4fcc866ddfa5eb">x1</a>, frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#aa6136e0602b4659033e59d31c5281d40">x2</a>, frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#ab4ddefa682c1930d06e915ece3e69f05">y1</a>, frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#a0fd0c1bdef582ca08a8bc1965727b4c8">y2</a>, frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#a0ea1170690da47dc34508eaa7eba5ad5">camnear</a>, frustrum.<a class="code" href="../../dd/d89/structRAS__FrameFrustum.html#ae98a2b5dd698a836610688f144ef676a">camfar</a>);
<a name="l00258"></a>00258         }
<a name="l00259"></a>00259         <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#aadcd28903e9b4ec55b06a4975bfdbc4f">SetProjectionMatrix</a>(projmat);
<a name="l00260"></a>00260     }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     <a class="code" href="../../d0/df9/classMT__Transform.html">MT_Transform</a> camtrans(<a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#a11c49865f3d83531723cf3c0c5881488">GetWorldToCamera</a>());
<a name="l00263"></a>00263     <a class="code" href="../../d0/d08/classMT__Matrix4x4.html">MT_Matrix4x4</a> viewmat(camtrans);
<a name="l00264"></a>00264     
<a name="l00265"></a>00265     <a class="code" href="../../d9/d39/classImageRender.html#aea654ba5e5ae670e8fc31aba031245f4" title="rasterizer">m_rasterizer</a>-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#ac5c9c2c1090c324d90b98a1bf86d35a0">SetViewMatrix</a>(viewmat, <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#ac4c31c796993a704c92cbc2d82927cfe">NodeGetWorldOrientation</a>(), <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#afa83f00c96f7d08511a385730442019b">NodeGetWorldPosition</a>(), <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#a3e184a18c7a79e6c28b93dc50628785a">GetCameraData</a>()-&gt;<a class="code" href="../../d4/d81/structRAS__CameraData.html#a51a2d3a80aaca99ecb43a31b76a6dec5">m_perspective</a>);
<a name="l00266"></a>00266     <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../dc/d6b/classKX__Camera.html#a3b171333f77ab5a36f752539a65391cd">SetModelviewMatrix</a>(viewmat);
<a name="l00267"></a>00267     <span class="comment">// restore the stereo mode now that the matrix is computed</span>
<a name="l00268"></a>00268     <a class="code" href="../../d9/d39/classImageRender.html#aea654ba5e5ae670e8fc31aba031245f4" title="rasterizer">m_rasterizer</a>-&gt;<a class="code" href="../../d3/d64/classRAS__IRasterizer.html#a1938989a3e96dfff9a57b61c9ab8d668">SetStereoMode</a>(stereomode);
<a name="l00269"></a>00269 
<a name="l00270"></a>00270     <a class="code" href="../../d9/d39/classImageRender.html#abbc05f766a69f4677745db509b9c546a" title="rendered scene">m_scene</a>-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a900a6e3a5557be098988d17da66b0d99">CalculateVisibleMeshes</a>(<a class="code" href="../../d9/d39/classImageRender.html#aea654ba5e5ae670e8fc31aba031245f4" title="rasterizer">m_rasterizer</a>,<a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>);
<a name="l00271"></a>00271 
<a name="l00272"></a>00272     <a class="code" href="../../d9/d39/classImageRender.html#abbc05f766a69f4677745db509b9c546a" title="rendered scene">m_scene</a>-&gt;<a class="code" href="../../d2/da3/classKX__Scene.html#a443cbcc3cd2fc6c7ac960fbef4bcae85">RenderBuckets</a>(camtrans, <a class="code" href="../../d9/d39/classImageRender.html#aea654ba5e5ae670e8fc31aba031245f4" title="rasterizer">m_rasterizer</a>, <a class="code" href="../../d9/d39/classImageRender.html#ab2841958aab8cb3acdaa1c0ecf9f8d02" title="render tools">m_rendertools</a>);
<a name="l00273"></a>00273 
<a name="l00274"></a>00274     <span class="comment">// restore the canvas area now that the render is completed</span>
<a name="l00275"></a>00275     <a class="code" href="../../d9/d39/classImageRender.html#a92fd1c68835cb45297999a424f0db4f5" title="canvas">m_canvas</a>-&gt;<a class="code" href="../../d5/df6/classRAS__ICanvas.html#a1c856054e47078f4b3cfd0e9da61b0b8">GetWindowArea</a>() = area;
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 <span class="comment">// cast Image pointer to ImageRender</span>
<a name="l00280"></a><a class="code" href="../../d1/d58/ImageRender_8cpp.html#a64a0d5427ac136019e0c82fdd8429296">00280</a> <span class="keyword">inline</span> <a class="code" href="../../d9/d39/classImageRender.html" title="class for render 3d scene">ImageRender</a> * <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a64a0d5427ac136019e0c82fdd8429296">getImageRender</a> (<a class="code" href="../../db/d22/structPyImage.html">PyImage</a> * <span class="keyword">self</span>)
<a name="l00281"></a>00281 { <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><a class="code" href="../../d9/d39/classImageRender.html" title="class for render 3d scene">ImageRender</a>*<span class="keyword">&gt;</span>(<span class="keyword">self</span>-&gt;m_image); }
<a name="l00282"></a>00282 
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 <span class="comment">// python methods</span>
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 <span class="comment">// Blender Scene type</span>
<a name="l00287"></a>00287 <a class="code" href="../../d0/d37/classBlendType.html">BlendType&lt;KX_Scene&gt;</a> <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a33873864f6c030ef2db9c4de5f872284">sceneType</a> (<span class="stringliteral">&quot;KX_Scene&quot;</span>);
<a name="l00288"></a>00288 <span class="comment">// Blender Camera type</span>
<a name="l00289"></a>00289 <a class="code" href="../../d0/d37/classBlendType.html">BlendType&lt;KX_Camera&gt;</a> <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a5bd0c758568a3ef38a7e96d1f81800a9">cameraType</a> (<span class="stringliteral">&quot;KX_Camera&quot;</span>);
<a name="l00290"></a>00290 
<a name="l00291"></a>00291 
<a name="l00292"></a>00292 <span class="comment">// object initialization</span>
<a name="l00293"></a><a class="code" href="../../d1/d58/ImageRender_8cpp.html#ac3789d2b2c4b39a530c434832802d8f7">00293</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d58/ImageRender_8cpp.html#ac3789d2b2c4b39a530c434832802d8f7">ImageRender_init</a> (PyObject * pySelf, PyObject * args, PyObject * kwds)
<a name="l00294"></a>00294 {
<a name="l00295"></a>00295     <span class="comment">// parameters - scene object</span>
<a name="l00296"></a>00296     PyObject * scene;
<a name="l00297"></a>00297     <span class="comment">// camera object</span>
<a name="l00298"></a>00298     PyObject * camera;
<a name="l00299"></a>00299     <span class="comment">// parameter keywords</span>
<a name="l00300"></a>00300     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *kwlist[] = {<span class="stringliteral">&quot;sceneObj&quot;</span>, <span class="stringliteral">&quot;cameraObj&quot;</span>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00301"></a>00301     <span class="comment">// get parameters</span>
<a name="l00302"></a>00302     <span class="keywordflow">if</span> (!PyArg_ParseTupleAndKeywords(args, kwds, <span class="stringliteral">&quot;OO&quot;</span>,
<a name="l00303"></a>00303         const_cast&lt;char**&gt;(kwlist), &amp;scene, &amp;camera))
<a name="l00304"></a>00304         <span class="keywordflow">return</span> -1;
<a name="l00305"></a>00305     <span class="keywordflow">try</span>
<a name="l00306"></a>00306     {
<a name="l00307"></a>00307         <span class="comment">// get scene pointer</span>
<a name="l00308"></a>00308         <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a> * scenePtr (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00309"></a>00309         <span class="keywordflow">if</span> (scene != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) scenePtr = <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a33873864f6c030ef2db9c4de5f872284">sceneType</a>.checkType(scene);
<a name="l00310"></a>00310         <span class="comment">// throw exception if scene is not available</span>
<a name="l00311"></a>00311         <span class="keywordflow">if</span> (scenePtr == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <a class="code" href="../../d8/d8a/Exception_8h.html#ac3b2bffb453f4e8e369013659070c6f8">THRWEXCP</a>(SceneInvalid, <a class="code" href="../../d6/d5c/gameengine_2VideoTexture_2Common_8h.html#a14bc2dfa42241600d567369cd25ddc70">S_OK</a>);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313         <span class="comment">// get camera pointer</span>
<a name="l00314"></a>00314         <a class="code" href="../../dc/d6b/classKX__Camera.html">KX_Camera</a> * cameraPtr (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00315"></a>00315         <span class="keywordflow">if</span> (camera != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) cameraPtr = <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a5bd0c758568a3ef38a7e96d1f81800a9">cameraType</a>.checkType(camera);
<a name="l00316"></a>00316         <span class="comment">// throw exception if camera is not available</span>
<a name="l00317"></a>00317         <span class="keywordflow">if</span> (cameraPtr == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <a class="code" href="../../d8/d8a/Exception_8h.html#ac3b2bffb453f4e8e369013659070c6f8">THRWEXCP</a>(CameraInvalid, <a class="code" href="../../d6/d5c/gameengine_2VideoTexture_2Common_8h.html#a14bc2dfa42241600d567369cd25ddc70">S_OK</a>);
<a name="l00318"></a>00318 
<a name="l00319"></a>00319         <span class="comment">// get pointer to image structure</span>
<a name="l00320"></a>00320         <a class="code" href="../../db/d22/structPyImage.html">PyImage</a> * <span class="keyword">self</span> = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="../../db/d22/structPyImage.html">PyImage</a>*<span class="keyword">&gt;</span>(pySelf);
<a name="l00321"></a>00321         <span class="comment">// create source object</span>
<a name="l00322"></a>00322         <span class="keywordflow">if</span> (self-&gt;m_image != <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keyword">delete</span> <span class="keyword">self</span>-&gt;<a class="code" href="../../db/d22/structPyImage.html#afc529fdd78ba3d4d2c3e89d4a0d4f987">m_image</a>;
<a name="l00323"></a>00323         <span class="keyword">self</span>-&gt;<a class="code" href="../../d7/d1e/classImageBase.html#a5b007e53c09d6ece89292fa690e74c96" title="image buffer">m_image</a> = <span class="keyword">new</span> <a class="code" href="../../d9/d39/classImageRender.html" title="class for render 3d scene">ImageRender</a>(scenePtr, cameraPtr);
<a name="l00324"></a>00324     }
<a name="l00325"></a>00325     <span class="keywordflow">catch</span> (<a class="code" href="../../d4/d67/classException.html">Exception</a> &amp; <a class="code" href="../../d0/dbc/namespaceKDL.html#a82c1904677c13464d30566d25edc9034">exp</a>)
<a name="l00326"></a>00326     {
<a name="l00327"></a>00327         exp.<a class="code" href="../../d4/d67/classException.html#a23fbb421ab3e1a05de04890fd2d86c7c">report</a>();
<a name="l00328"></a>00328         <span class="keywordflow">return</span> -1;
<a name="l00329"></a>00329     }
<a name="l00330"></a>00330     <span class="comment">// initialization succeded</span>
<a name="l00331"></a>00331     <span class="keywordflow">return</span> 0;
<a name="l00332"></a>00332 }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 
<a name="l00335"></a>00335 <span class="comment">// get background color</span>
<a name="l00336"></a><a class="code" href="../../d1/d58/ImageRender_8cpp.html#afe5350d200dc588c166496137fe4183c">00336</a> PyObject * <a class="code" href="../../d1/d58/ImageRender_8cpp.html#afe5350d200dc588c166496137fe4183c">getBackground</a> (<a class="code" href="../../db/d22/structPyImage.html">PyImage</a> * <span class="keyword">self</span>, <span class="keywordtype">void</span> * closure)
<a name="l00337"></a>00337 {
<a name="l00338"></a>00338     <span class="keywordflow">return</span> Py_BuildValue(<span class="stringliteral">&quot;[BBBB]&quot;</span>,
<a name="l00339"></a>00339                          <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a64a0d5427ac136019e0c82fdd8429296">getImageRender</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="../../d1/d58/ImageRender_8cpp.html#afe5350d200dc588c166496137fe4183c">getBackground</a>(0),
<a name="l00340"></a>00340                          <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a64a0d5427ac136019e0c82fdd8429296">getImageRender</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="../../d1/d58/ImageRender_8cpp.html#afe5350d200dc588c166496137fe4183c">getBackground</a>(1),
<a name="l00341"></a>00341                          <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a64a0d5427ac136019e0c82fdd8429296">getImageRender</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="../../d1/d58/ImageRender_8cpp.html#afe5350d200dc588c166496137fe4183c">getBackground</a>(2),
<a name="l00342"></a>00342                          <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a64a0d5427ac136019e0c82fdd8429296">getImageRender</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="../../d1/d58/ImageRender_8cpp.html#afe5350d200dc588c166496137fe4183c">getBackground</a>(3));
<a name="l00343"></a>00343 }
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 <span class="comment">// set color</span>
<a name="l00346"></a><a class="code" href="../../d1/d58/ImageRender_8cpp.html#a59e255be83877a01f9a15fb4b27f5630">00346</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a59e255be83877a01f9a15fb4b27f5630">setBackground</a> (<a class="code" href="../../db/d22/structPyImage.html">PyImage</a> * <span class="keyword">self</span>, PyObject * value, <span class="keywordtype">void</span> * closure)
<a name="l00347"></a>00347 {
<a name="l00348"></a>00348     <span class="comment">// check validity of parameter</span>
<a name="l00349"></a>00349     <span class="keywordflow">if</span> (value == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || !PySequence_Check(value) || PySequence_Size(value) != 4
<a name="l00350"></a>00350         || !PyLong_Check(PySequence_Fast_GET_ITEM(value, 0))
<a name="l00351"></a>00351         || !PyLong_Check(PySequence_Fast_GET_ITEM(value, 1))
<a name="l00352"></a>00352         || !PyLong_Check(PySequence_Fast_GET_ITEM(value, 2))
<a name="l00353"></a>00353         || !PyLong_Check(PySequence_Fast_GET_ITEM(value, 3)))
<a name="l00354"></a>00354     {
<a name="l00355"></a>00355         PyErr_SetString(PyExc_TypeError, <span class="stringliteral">&quot;The value must be a sequence of 4 integer between 0 and 255&quot;</span>);
<a name="l00356"></a>00356         <span class="keywordflow">return</span> -1;
<a name="l00357"></a>00357     }
<a name="l00358"></a>00358     <span class="comment">// set background color</span>
<a name="l00359"></a>00359     <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a64a0d5427ac136019e0c82fdd8429296">getImageRender</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="../../d9/d39/classImageRender.html#af850c63feb829045e043c08ce62b06fb" title="set background color">setBackground</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(PyLong_AsSsize_t(PySequence_Fast_GET_ITEM(value, 0))),
<a name="l00360"></a>00360         (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(PyLong_AsSsize_t(PySequence_Fast_GET_ITEM(value, 1))),
<a name="l00361"></a>00361         (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(PyLong_AsSsize_t(PySequence_Fast_GET_ITEM(value, 2))),
<a name="l00362"></a>00362         (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(PyLong_AsSsize_t(PySequence_Fast_GET_ITEM(value, 3))));
<a name="l00363"></a>00363     <span class="comment">// success</span>
<a name="l00364"></a>00364     <span class="keywordflow">return</span> 0;
<a name="l00365"></a>00365 }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367 
<a name="l00368"></a>00368 <span class="comment">// methods structure</span>
<a name="l00369"></a><a class="code" href="../../d1/d58/ImageRender_8cpp.html#a649e31d749315d92704938ee042abf78">00369</a> <span class="keyword">static</span> PyMethodDef <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a649e31d749315d92704938ee042abf78">imageRenderMethods</a>[] =
<a name="l00370"></a>00370 { <span class="comment">// methods from ImageBase class</span>
<a name="l00371"></a>00371     {<span class="stringliteral">&quot;refresh&quot;</span>, (PyCFunction)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#a32a9996415eb4022f96f8d7ec4e11324">Image_refresh</a>, METH_NOARGS, <span class="stringliteral">&quot;Refresh image - invalidate its current content&quot;</span>},
<a name="l00372"></a>00372     {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>}
<a name="l00373"></a>00373 };
<a name="l00374"></a>00374 <span class="comment">// attributes structure</span>
<a name="l00375"></a><a class="code" href="../../d1/d58/ImageRender_8cpp.html#acf6b25c124ac3d07828a403c03aec90d">00375</a> <span class="keyword">static</span> PyGetSetDef <a class="code" href="../../d1/d58/ImageRender_8cpp.html#acf6b25c124ac3d07828a403c03aec90d">imageRenderGetSets</a>[] =
<a name="l00376"></a>00376 { 
<a name="l00377"></a>00377     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;background&quot;</span>, (getter)<a class="code" href="../../d1/d58/ImageRender_8cpp.html#afe5350d200dc588c166496137fe4183c">getBackground</a>, (setter)<a class="code" href="../../d1/d58/ImageRender_8cpp.html#a59e255be83877a01f9a15fb4b27f5630">setBackground</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;background color&quot;</span>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},
<a name="l00378"></a>00378     <span class="comment">// attribute from ImageViewport</span>
<a name="l00379"></a>00379     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;capsize&quot;</span>, (getter)<a class="code" href="../../da/dda/ImageViewport_8cpp.html#a5d321cb7a6819f043c5f8573f2d43c14">ImageViewport_getCaptureSize</a>, (setter)<a class="code" href="../../da/dda/ImageViewport_8cpp.html#a7eb9d4bc0f315f1d422ad06f0275dfe7">ImageViewport_setCaptureSize</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;size of render area&quot;</span>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},
<a name="l00380"></a>00380     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;alpha&quot;</span>, (getter)<a class="code" href="../../da/dda/ImageViewport_8cpp.html#ae5d49ee34ccbed6b6fdcc6bac53462ff">ImageViewport_getAlpha</a>, (setter)<a class="code" href="../../da/dda/ImageViewport_8cpp.html#aaa7a02d5791166ab07f6c329361c7e4b">ImageViewport_setAlpha</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;use alpha in texture&quot;</span>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},
<a name="l00381"></a>00381     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;whole&quot;</span>, (getter)<a class="code" href="../../da/dda/ImageViewport_8cpp.html#a9eed982478f73d9949e995a99bee8f0e">ImageViewport_getWhole</a>, (setter)<a class="code" href="../../da/dda/ImageViewport_8cpp.html#a81797cb7fbfc41fa7a1dbec33becee20">ImageViewport_setWhole</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;use whole viewport to render&quot;</span>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>},
<a name="l00382"></a>00382     <span class="comment">// attributes from ImageBase class</span>
<a name="l00383"></a>00383     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;valid&quot;</span>, (getter)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#a6b3f44688f95712ef88fe7d77a691faa">Image_valid</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;bool to tell if an image is available&quot;</span>, NULL},
<a name="l00384"></a>00384     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;image&quot;</span>, (getter)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#a9b4db516cc4d59b2cf81a103395a15d3">Image_getImage</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;image data&quot;</span>, NULL},
<a name="l00385"></a>00385     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;size&quot;</span>, (getter)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#a0dde8b5e268ab4f832ebce906c8f1381">Image_getSize</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;image size&quot;</span>, NULL},
<a name="l00386"></a>00386     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;scale&quot;</span>, (getter)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#aa2921166202839803e54f1d69c4b244c">Image_getScale</a>, (setter)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#a2b3fc30447615f7c5155a0820e119ea6">Image_setScale</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;fast scale of image (near neighbor)&quot;</span>,  NULL},
<a name="l00387"></a>00387     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;flip&quot;</span>, (getter)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#a60a82932d95bd5ca1b7a79bd652f9a66">Image_getFlip</a>, (setter)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#a3e5611278b05dd5398ec3e68e0807f96">Image_setFlip</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;flip image vertically&quot;</span>, NULL},
<a name="l00388"></a>00388     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;filter&quot;</span>, (getter)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#a4d20ed03b397f1f9c2819a8c087a351c">Image_getFilter</a>, (setter)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#ada454e6ebcbdea4d40ad7369d5a2dc79">Image_setFilter</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;pixel filter&quot;</span>, NULL},
<a name="l00389"></a>00389     {NULL}
<a name="l00390"></a>00390 };
<a name="l00391"></a>00391 
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 <span class="comment">// define python type</span>
<a name="l00394"></a><a class="code" href="../../d1/d58/ImageRender_8cpp.html#addafbf910f21cff39875542d9acd6fef">00394</a> PyTypeObject <a class="code" href="../../d3/dbe/blendVideoTex_8cpp.html#addafbf910f21cff39875542d9acd6fef">ImageRenderType</a> =
<a name="l00395"></a>00395 { 
<a name="l00396"></a>00396     PyVarObject_HEAD_INIT(NULL, 0)
<a name="l00397"></a>00397     <span class="stringliteral">&quot;VideoTexture.ImageRender&quot;</span>,   <span class="comment">/*tp_name*/</span>
<a name="l00398"></a>00398     <span class="keyword">sizeof</span>(<a class="code" href="../../db/d22/structPyImage.html">PyImage</a>),          <span class="comment">/*tp_basicsize*/</span>
<a name="l00399"></a>00399     0,                         <span class="comment">/*tp_itemsize*/</span>
<a name="l00400"></a>00400     (destructor)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#aab9974bdcd9824aa8304d102279e0b99">Image_dealloc</a>, <span class="comment">/*tp_dealloc*/</span>
<a name="l00401"></a>00401     0,                         <span class="comment">/*tp_print*/</span>
<a name="l00402"></a>00402     0,                         <span class="comment">/*tp_getattr*/</span>
<a name="l00403"></a>00403     0,                         <span class="comment">/*tp_setattr*/</span>
<a name="l00404"></a>00404     0,                         <span class="comment">/*tp_compare*/</span>
<a name="l00405"></a>00405     0,                         <span class="comment">/*tp_repr*/</span>
<a name="l00406"></a>00406     0,                         <span class="comment">/*tp_as_number*/</span>
<a name="l00407"></a>00407     0,                         <span class="comment">/*tp_as_sequence*/</span>
<a name="l00408"></a>00408     0,                         <span class="comment">/*tp_as_mapping*/</span>
<a name="l00409"></a>00409     0,                         <span class="comment">/*tp_hash */</span>
<a name="l00410"></a>00410     0,                         <span class="comment">/*tp_call*/</span>
<a name="l00411"></a>00411     0,                         <span class="comment">/*tp_str*/</span>
<a name="l00412"></a>00412     0,                         <span class="comment">/*tp_getattro*/</span>
<a name="l00413"></a>00413     0,                         <span class="comment">/*tp_setattro*/</span>
<a name="l00414"></a>00414     &amp;<a class="code" href="../../db/d8e/ImageBase_8cpp.html#ab77040fc062c59fed8cfc59f057e3271">imageBufferProcs</a>,         <span class="comment">/*tp_as_buffer*/</span>
<a name="l00415"></a>00415     Py_TPFLAGS_DEFAULT,        <span class="comment">/*tp_flags*/</span>
<a name="l00416"></a>00416     <span class="stringliteral">&quot;Image source from render&quot;</span>,       <span class="comment">/* tp_doc */</span>
<a name="l00417"></a>00417     0,                     <span class="comment">/* tp_traverse */</span>
<a name="l00418"></a>00418     0,                     <span class="comment">/* tp_clear */</span>
<a name="l00419"></a>00419     0,                     <span class="comment">/* tp_richcompare */</span>
<a name="l00420"></a>00420     0,                     <span class="comment">/* tp_weaklistoffset */</span>
<a name="l00421"></a>00421     0,                     <span class="comment">/* tp_iter */</span>
<a name="l00422"></a>00422     0,                     <span class="comment">/* tp_iternext */</span>
<a name="l00423"></a>00423     <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a649e31d749315d92704938ee042abf78">imageRenderMethods</a>,    <span class="comment">/* tp_methods */</span>
<a name="l00424"></a>00424     0,                   <span class="comment">/* tp_members */</span>
<a name="l00425"></a>00425     <a class="code" href="../../d1/d58/ImageRender_8cpp.html#acf6b25c124ac3d07828a403c03aec90d">imageRenderGetSets</a>,          <span class="comment">/* tp_getset */</span>
<a name="l00426"></a>00426     0,                         <span class="comment">/* tp_base */</span>
<a name="l00427"></a>00427     0,                         <span class="comment">/* tp_dict */</span>
<a name="l00428"></a>00428     0,                         <span class="comment">/* tp_descr_get */</span>
<a name="l00429"></a>00429     0,                         <span class="comment">/* tp_descr_set */</span>
<a name="l00430"></a>00430     0,                         <span class="comment">/* tp_dictoffset */</span>
<a name="l00431"></a>00431     (initproc)<a class="code" href="../../d1/d58/ImageRender_8cpp.html#ac3789d2b2c4b39a530c434832802d8f7">ImageRender_init</a>,     <span class="comment">/* tp_init */</span>
<a name="l00432"></a>00432     0,                         <span class="comment">/* tp_alloc */</span>
<a name="l00433"></a>00433     <a class="code" href="../../db/d8e/ImageBase_8cpp.html#a0c7bec9878faf6a119923b192d797361">Image_allocNew</a>,           <span class="comment">/* tp_new */</span>
<a name="l00434"></a>00434 };
<a name="l00435"></a>00435 
<a name="l00436"></a>00436 <span class="comment">// object initialization</span>
<a name="l00437"></a><a class="code" href="../../d1/d58/ImageRender_8cpp.html#a773b2a20164ebe51c566aed55639bd0d">00437</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a773b2a20164ebe51c566aed55639bd0d">ImageMirror_init</a> (PyObject * pySelf, PyObject * args, PyObject * kwds)
<a name="l00438"></a>00438 {
<a name="l00439"></a>00439     <span class="comment">// parameters - scene object</span>
<a name="l00440"></a>00440     PyObject * scene;
<a name="l00441"></a>00441     <span class="comment">// reference object for mirror</span>
<a name="l00442"></a>00442     PyObject * observer;
<a name="l00443"></a>00443     <span class="comment">// object holding the mirror</span>
<a name="l00444"></a>00444     PyObject * mirror;
<a name="l00445"></a>00445     <span class="comment">// material of the mirror</span>
<a name="l00446"></a>00446     <span class="keywordtype">short</span> materialID = 0;
<a name="l00447"></a>00447     <span class="comment">// parameter keywords</span>
<a name="l00448"></a>00448     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *kwlist[] = {<span class="stringliteral">&quot;scene&quot;</span>, <span class="stringliteral">&quot;observer&quot;</span>, <span class="stringliteral">&quot;mirror&quot;</span>, <span class="stringliteral">&quot;material&quot;</span>, NULL};
<a name="l00449"></a>00449     <span class="comment">// get parameters</span>
<a name="l00450"></a>00450     <span class="keywordflow">if</span> (!PyArg_ParseTupleAndKeywords(args, kwds, <span class="stringliteral">&quot;OOO|h&quot;</span>,
<a name="l00451"></a>00451                                      const_cast&lt;char**&gt;(kwlist), &amp;scene, &amp;observer, &amp;mirror, &amp;materialID))
<a name="l00452"></a>00452         <span class="keywordflow">return</span> -1;
<a name="l00453"></a>00453     <span class="keywordflow">try</span>
<a name="l00454"></a>00454     {
<a name="l00455"></a>00455         <span class="comment">// get scene pointer</span>
<a name="l00456"></a>00456         <a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a> * scenePtr (NULL);
<a name="l00457"></a>00457         <span class="keywordflow">if</span> (scene != NULL &amp;&amp; PyObject_TypeCheck(scene, &amp;KX_Scene::Type))
<a name="l00458"></a>00458             scenePtr = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a>*<span class="keyword">&gt;</span>BGE_PROXY_REF(scene);
<a name="l00459"></a>00459         <span class="keywordflow">else</span>
<a name="l00460"></a>00460             <a class="code" href="../../d8/d8a/Exception_8h.html#ac3b2bffb453f4e8e369013659070c6f8">THRWEXCP</a>(SceneInvalid, <a class="code" href="../../d6/d5c/gameengine_2VideoTexture_2Common_8h.html#a14bc2dfa42241600d567369cd25ddc70">S_OK</a>);
<a name="l00461"></a>00461         
<a name="l00462"></a>00462         <span class="keywordflow">if</span> (scenePtr==NULL) <span class="comment">/* in case the python proxy reference is invalid */</span>
<a name="l00463"></a>00463             <a class="code" href="../../d8/d8a/Exception_8h.html#ac3b2bffb453f4e8e369013659070c6f8">THRWEXCP</a>(SceneInvalid, <a class="code" href="../../d6/d5c/gameengine_2VideoTexture_2Common_8h.html#a14bc2dfa42241600d567369cd25ddc70">S_OK</a>);
<a name="l00464"></a>00464         
<a name="l00465"></a>00465         <span class="comment">// get observer pointer</span>
<a name="l00466"></a>00466         <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a> * observerPtr (NULL);
<a name="l00467"></a>00467         <span class="keywordflow">if</span> (observer != NULL &amp;&amp; PyObject_TypeCheck(observer, &amp;KX_GameObject::Type))
<a name="l00468"></a>00468             observerPtr = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*<span class="keyword">&gt;</span>BGE_PROXY_REF(observer);
<a name="l00469"></a>00469         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (observer != NULL &amp;&amp; PyObject_TypeCheck(observer, &amp;KX_Camera::Type))
<a name="l00470"></a>00470             observerPtr = <span class="keyword">static_cast&lt;</span><a class="code" href="../../dc/d6b/classKX__Camera.html">KX_Camera</a>*<span class="keyword">&gt;</span>BGE_PROXY_REF(observer);
<a name="l00471"></a>00471         <span class="keywordflow">else</span>
<a name="l00472"></a>00472             <a class="code" href="../../d8/d8a/Exception_8h.html#ac3b2bffb453f4e8e369013659070c6f8">THRWEXCP</a>(ObserverInvalid, <a class="code" href="../../d6/d5c/gameengine_2VideoTexture_2Common_8h.html#a14bc2dfa42241600d567369cd25ddc70">S_OK</a>);
<a name="l00473"></a>00473         
<a name="l00474"></a>00474         <span class="keywordflow">if</span> (observerPtr==NULL) <span class="comment">/* in case the python proxy reference is invalid */</span>
<a name="l00475"></a>00475             <a class="code" href="../../d8/d8a/Exception_8h.html#ac3b2bffb453f4e8e369013659070c6f8">THRWEXCP</a>(ObserverInvalid, <a class="code" href="../../d6/d5c/gameengine_2VideoTexture_2Common_8h.html#a14bc2dfa42241600d567369cd25ddc70">S_OK</a>);
<a name="l00476"></a>00476 
<a name="l00477"></a>00477         <span class="comment">// get mirror pointer</span>
<a name="l00478"></a>00478         <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a> * mirrorPtr (NULL);
<a name="l00479"></a>00479         <span class="keywordflow">if</span> (mirror != NULL &amp;&amp; PyObject_TypeCheck(mirror, &amp;KX_GameObject::Type))
<a name="l00480"></a>00480             mirrorPtr = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a>*<span class="keyword">&gt;</span>BGE_PROXY_REF(mirror);
<a name="l00481"></a>00481         <span class="keywordflow">else</span>
<a name="l00482"></a>00482             <a class="code" href="../../d8/d8a/Exception_8h.html#ac3b2bffb453f4e8e369013659070c6f8">THRWEXCP</a>(MirrorInvalid, <a class="code" href="../../d6/d5c/gameengine_2VideoTexture_2Common_8h.html#a14bc2dfa42241600d567369cd25ddc70">S_OK</a>);
<a name="l00483"></a>00483         
<a name="l00484"></a>00484         <span class="keywordflow">if</span> (mirrorPtr==NULL) <span class="comment">/* in case the python proxy reference is invalid */</span>
<a name="l00485"></a>00485             <a class="code" href="../../d8/d8a/Exception_8h.html#ac3b2bffb453f4e8e369013659070c6f8">THRWEXCP</a>(MirrorInvalid, <a class="code" href="../../d6/d5c/gameengine_2VideoTexture_2Common_8h.html#a14bc2dfa42241600d567369cd25ddc70">S_OK</a>);
<a name="l00486"></a>00486 
<a name="l00487"></a>00487         <span class="comment">// locate the material in the mirror</span>
<a name="l00488"></a>00488         <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html">RAS_IPolyMaterial</a> * material = <a class="code" href="../../d5/d87/Texture_8cpp.html#aa6e608fd88b7356f2636b6136e10feca">getMaterial</a>(mirror, materialID);
<a name="l00489"></a>00489         <span class="keywordflow">if</span> (material == NULL)
<a name="l00490"></a>00490             <a class="code" href="../../d8/d8a/Exception_8h.html#ac3b2bffb453f4e8e369013659070c6f8">THRWEXCP</a>(<a class="code" href="../../d5/d87/Texture_8cpp.html#a7d71596ca546fad3c30964ff983df0a8">MaterialNotAvail</a>, <a class="code" href="../../d6/d5c/gameengine_2VideoTexture_2Common_8h.html#a14bc2dfa42241600d567369cd25ddc70">S_OK</a>);
<a name="l00491"></a>00491 
<a name="l00492"></a>00492         <span class="comment">// get pointer to image structure</span>
<a name="l00493"></a>00493         <a class="code" href="../../db/d22/structPyImage.html">PyImage</a> * <span class="keyword">self</span> = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="../../db/d22/structPyImage.html">PyImage</a>*<span class="keyword">&gt;</span>(pySelf);
<a name="l00494"></a>00494 
<a name="l00495"></a>00495         <span class="comment">// create source object</span>
<a name="l00496"></a>00496         <span class="keywordflow">if</span> (self-&gt;m_image != NULL)
<a name="l00497"></a>00497         {
<a name="l00498"></a>00498             <span class="keyword">delete</span> <span class="keyword">self</span>-&gt;<a class="code" href="../../db/d22/structPyImage.html#afc529fdd78ba3d4d2c3e89d4a0d4f987">m_image</a>;
<a name="l00499"></a>00499             <span class="keyword">self</span>-&gt;<a class="code" href="../../d7/d1e/classImageBase.html#a5b007e53c09d6ece89292fa690e74c96" title="image buffer">m_image</a> = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00500"></a>00500         }
<a name="l00501"></a>00501         <span class="keyword">self</span>-&gt;m_image = <span class="keyword">new</span> <a class="code" href="../../d9/d39/classImageRender.html" title="class for render 3d scene">ImageRender</a>(scenePtr, observerPtr, mirrorPtr, material);
<a name="l00502"></a>00502     }
<a name="l00503"></a>00503     <span class="keywordflow">catch</span> (<a class="code" href="../../d4/d67/classException.html">Exception</a> &amp; <a class="code" href="../../d0/dbc/namespaceKDL.html#a82c1904677c13464d30566d25edc9034">exp</a>)
<a name="l00504"></a>00504     {
<a name="l00505"></a>00505         exp.<a class="code" href="../../d4/d67/classException.html#a23fbb421ab3e1a05de04890fd2d86c7c">report</a>();
<a name="l00506"></a>00506         <span class="keywordflow">return</span> -1;
<a name="l00507"></a>00507     }
<a name="l00508"></a>00508     <span class="comment">// initialization succeded</span>
<a name="l00509"></a>00509     <span class="keywordflow">return</span> 0;
<a name="l00510"></a>00510 }
<a name="l00511"></a>00511 
<a name="l00512"></a>00512 <span class="comment">// get background color</span>
<a name="l00513"></a><a class="code" href="../../d1/d58/ImageRender_8cpp.html#a5984c5e9c67ac4e5a1fead068c1dc317">00513</a> PyObject * <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a5984c5e9c67ac4e5a1fead068c1dc317">getClip</a> (<a class="code" href="../../db/d22/structPyImage.html">PyImage</a> * <span class="keyword">self</span>, <span class="keywordtype">void</span> * closure)
<a name="l00514"></a>00514 {
<a name="l00515"></a>00515     <span class="keywordflow">return</span> PyFloat_FromDouble(<a class="code" href="../../d1/d58/ImageRender_8cpp.html#a64a0d5427ac136019e0c82fdd8429296">getImageRender</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="../../d1/d58/ImageRender_8cpp.html#a5984c5e9c67ac4e5a1fead068c1dc317">getClip</a>());
<a name="l00516"></a>00516 }
<a name="l00517"></a>00517 
<a name="l00518"></a>00518 <span class="comment">// set clip</span>
<a name="l00519"></a><a class="code" href="../../d1/d58/ImageRender_8cpp.html#a1d1a3ee499a43942b25356fc74aac7dd">00519</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a1d1a3ee499a43942b25356fc74aac7dd">setClip</a> (<a class="code" href="../../db/d22/structPyImage.html">PyImage</a> * <span class="keyword">self</span>, PyObject * value, <span class="keywordtype">void</span> * closure)
<a name="l00520"></a>00520 {
<a name="l00521"></a>00521     <span class="comment">// check validity of parameter</span>
<a name="l00522"></a>00522     <span class="keywordtype">double</span> clip;
<a name="l00523"></a>00523     <span class="keywordflow">if</span> (value == NULL || !PyFloat_Check(value) || (clip = PyFloat_AsDouble(value)) &lt; 0.01 || clip &gt; 5000.0)
<a name="l00524"></a>00524     {
<a name="l00525"></a>00525         PyErr_SetString(PyExc_TypeError, <span class="stringliteral">&quot;The value must be an float between 0.01 and 5000&quot;</span>);
<a name="l00526"></a>00526         <span class="keywordflow">return</span> -1;
<a name="l00527"></a>00527     }
<a name="l00528"></a>00528     <span class="comment">// set background color</span>
<a name="l00529"></a>00529     <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a64a0d5427ac136019e0c82fdd8429296">getImageRender</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="../../d9/d39/classImageRender.html#a29be52f990babb20337190ca8706eb48" title="set whole buffer use">setClip</a>(<span class="keywordtype">float</span>(clip));
<a name="l00530"></a>00530     <span class="comment">// success</span>
<a name="l00531"></a>00531     <span class="keywordflow">return</span> 0;
<a name="l00532"></a>00532 }
<a name="l00533"></a>00533 
<a name="l00534"></a>00534 <span class="comment">// attributes structure</span>
<a name="l00535"></a><a class="code" href="../../d1/d58/ImageRender_8cpp.html#a3a6962a97eaa914badf9583c19183de8">00535</a> <span class="keyword">static</span> PyGetSetDef <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a3a6962a97eaa914badf9583c19183de8">imageMirrorGetSets</a>[] =
<a name="l00536"></a>00536 { 
<a name="l00537"></a>00537     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;clip&quot;</span>, (getter)<a class="code" href="../../d1/d58/ImageRender_8cpp.html#a5984c5e9c67ac4e5a1fead068c1dc317">getClip</a>, (setter)<a class="code" href="../../d1/d58/ImageRender_8cpp.html#a1d1a3ee499a43942b25356fc74aac7dd">setClip</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;clipping distance&quot;</span>, NULL},
<a name="l00538"></a>00538     <span class="comment">// attribute from ImageRender</span>
<a name="l00539"></a>00539     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;background&quot;</span>, (getter)<a class="code" href="../../d1/d58/ImageRender_8cpp.html#afe5350d200dc588c166496137fe4183c">getBackground</a>, (setter)<a class="code" href="../../d1/d58/ImageRender_8cpp.html#a59e255be83877a01f9a15fb4b27f5630">setBackground</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;background color&quot;</span>, NULL},
<a name="l00540"></a>00540     <span class="comment">// attribute from ImageViewport</span>
<a name="l00541"></a>00541     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;capsize&quot;</span>, (getter)<a class="code" href="../../da/dda/ImageViewport_8cpp.html#a5d321cb7a6819f043c5f8573f2d43c14">ImageViewport_getCaptureSize</a>, (setter)<a class="code" href="../../da/dda/ImageViewport_8cpp.html#a7eb9d4bc0f315f1d422ad06f0275dfe7">ImageViewport_setCaptureSize</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;size of render area&quot;</span>, NULL},
<a name="l00542"></a>00542     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;alpha&quot;</span>, (getter)<a class="code" href="../../da/dda/ImageViewport_8cpp.html#ae5d49ee34ccbed6b6fdcc6bac53462ff">ImageViewport_getAlpha</a>, (setter)<a class="code" href="../../da/dda/ImageViewport_8cpp.html#aaa7a02d5791166ab07f6c329361c7e4b">ImageViewport_setAlpha</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;use alpha in texture&quot;</span>, NULL},
<a name="l00543"></a>00543     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;whole&quot;</span>, (getter)<a class="code" href="../../da/dda/ImageViewport_8cpp.html#a9eed982478f73d9949e995a99bee8f0e">ImageViewport_getWhole</a>, (setter)<a class="code" href="../../da/dda/ImageViewport_8cpp.html#a81797cb7fbfc41fa7a1dbec33becee20">ImageViewport_setWhole</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;use whole viewport to render&quot;</span>, NULL},
<a name="l00544"></a>00544     <span class="comment">// attributes from ImageBase class</span>
<a name="l00545"></a>00545     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;valid&quot;</span>, (getter)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#a6b3f44688f95712ef88fe7d77a691faa">Image_valid</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;bool to tell if an image is available&quot;</span>, NULL},
<a name="l00546"></a>00546     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;image&quot;</span>, (getter)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#a9b4db516cc4d59b2cf81a103395a15d3">Image_getImage</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;image data&quot;</span>, NULL},
<a name="l00547"></a>00547     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;size&quot;</span>, (getter)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#a0dde8b5e268ab4f832ebce906c8f1381">Image_getSize</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;image size&quot;</span>, NULL},
<a name="l00548"></a>00548     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;scale&quot;</span>, (getter)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#aa2921166202839803e54f1d69c4b244c">Image_getScale</a>, (setter)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#a2b3fc30447615f7c5155a0820e119ea6">Image_setScale</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;fast scale of image (near neighbor)&quot;</span>,  NULL},
<a name="l00549"></a>00549     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;flip&quot;</span>, (getter)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#a60a82932d95bd5ca1b7a79bd652f9a66">Image_getFlip</a>, (setter)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#a3e5611278b05dd5398ec3e68e0807f96">Image_setFlip</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;flip image vertically&quot;</span>, NULL},
<a name="l00550"></a>00550     {(<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;filter&quot;</span>, (getter)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#a4d20ed03b397f1f9c2819a8c087a351c">Image_getFilter</a>, (setter)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#ada454e6ebcbdea4d40ad7369d5a2dc79">Image_setFilter</a>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;pixel filter&quot;</span>, NULL},
<a name="l00551"></a>00551     {NULL}
<a name="l00552"></a>00552 };
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 
<a name="l00555"></a>00555 <span class="comment">// constructor</span>
<a name="l00556"></a><a class="code" href="../../d9/d39/classImageRender.html#a3620f6cf006aea64ac0f50271b4ef0de">00556</a> <a class="code" href="../../d9/d39/classImageRender.html#a0c716b4bbcb486ba4a89f981b32bd209" title="constructor">ImageRender::ImageRender</a> (<a class="code" href="../../d2/da3/classKX__Scene.html">KX_Scene</a> * scene, <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a> * observer, <a class="code" href="../../d1/d73/classKX__GameObject.html">KX_GameObject</a> * mirror, <a class="code" href="../../d1/d00/classRAS__IPolyMaterial.html">RAS_IPolyMaterial</a> * mat) :
<a name="l00557"></a>00557     <a class="code" href="../../d5/dbb/classImageViewport.html" title="class for viewport access">ImageViewport</a>(),
<a name="l00558"></a>00558     m_render(false),
<a name="l00559"></a>00559     m_scene(scene),
<a name="l00560"></a>00560     m_observer(observer),
<a name="l00561"></a>00561     m_mirror(mirror),
<a name="l00562"></a>00562     m_clip(100.f)
<a name="l00563"></a>00563 {
<a name="l00564"></a>00564     <span class="comment">// this constructor is used for automatic planar mirror</span>
<a name="l00565"></a>00565     <span class="comment">// create a camera, take all data by default, in any case we will recompute the frustrum on each frame</span>
<a name="l00566"></a>00566     <a class="code" href="../../d4/d81/structRAS__CameraData.html">RAS_CameraData</a> camdata;
<a name="l00567"></a>00567     vector&lt;RAS_TexVert*&gt; mirrorVerts;
<a name="l00568"></a>00568     vector&lt;RAS_TexVert*&gt;::iterator it;
<a name="l00569"></a>00569     <span class="keywordtype">float</span> mirrorArea = 0.f;
<a name="l00570"></a>00570     <span class="keywordtype">float</span> mirrorNormal[3] = {0.f, 0.f, 0.f};
<a name="l00571"></a>00571     <span class="keywordtype">float</span> mirrorUp[3];
<a name="l00572"></a>00572     <span class="keywordtype">float</span> dist, vec[3], axis[3];
<a name="l00573"></a>00573     <span class="keywordtype">float</span> zaxis[3] = {0.f, 0.f, 1.f};
<a name="l00574"></a>00574     <span class="keywordtype">float</span> yaxis[3] = {0.f, 1.f, 0.f};
<a name="l00575"></a>00575     <span class="keywordtype">float</span> mirrorMat[3][3];
<a name="l00576"></a>00576     <span class="keywordtype">float</span> <a class="code" href="../../db/d0f/navmesh__conversion_8c.html#a4d78fdbccaa4d42dc8599d58cdf0de96">left</a>, right, top, bottom, back;
<a name="l00577"></a>00577     <span class="comment">// make sure this camera will delete its node</span>
<a name="l00578"></a>00578     <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>= <span class="keyword">new</span> <a class="code" href="../../dc/d6b/classKX__Camera.html">KX_Camera</a>(scene, <a class="code" href="../../d2/da3/classKX__Scene.html#a95b425043c91b7e775df61e5d34a581e">KX_Scene::m_callbacks</a>, camdata, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l00579"></a>00579     <a class="code" href="../../d9/d39/classImageRender.html#af59a80edae8b51906be83887869e5f7d" title="camera for render">m_camera</a>-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a43c0693d1745f2b6cbe31d0ef691d3a5">SetName</a>(<span class="stringliteral">&quot;__mirror__cam__&quot;</span>);
<a name="l00580"></a>00580     <span class="comment">// don&#39;t add the camera to the scene object list, it doesn&#39;t need to be accessible</span>
<a name="l00581"></a>00581     <a class="code" href="../../d9/d39/classImageRender.html#aae4a067350e00c95087f8bf55b0525b3" title="do we own the camera?">m_owncamera</a> = <span class="keyword">true</span>;
<a name="l00582"></a>00582     <span class="comment">// retrieve rendering objects</span>
<a name="l00583"></a>00583     <a class="code" href="../../d9/d39/classImageRender.html#a08abdefd263c1e5b0704a76139fecaa4" title="engine">m_engine</a> = <a class="code" href="../../d6/dc2/KX__PythonInit_8cpp.html#a73270876d4beab375ee4cbc78e597251">KX_GetActiveEngine</a>();
<a name="l00584"></a>00584     <a class="code" href="../../d9/d39/classImageRender.html#aea654ba5e5ae670e8fc31aba031245f4" title="rasterizer">m_rasterizer</a> = <a class="code" href="../../d9/d39/classImageRender.html#a08abdefd263c1e5b0704a76139fecaa4" title="engine">m_engine</a>-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a270c67e55406bb68bfd7319d5969411b">GetRasterizer</a>();
<a name="l00585"></a>00585     <a class="code" href="../../d9/d39/classImageRender.html#a92fd1c68835cb45297999a424f0db4f5" title="canvas">m_canvas</a> = <a class="code" href="../../d9/d39/classImageRender.html#a08abdefd263c1e5b0704a76139fecaa4" title="engine">m_engine</a>-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a95ef4b484c4599aad58075d438a84fb7">GetCanvas</a>();
<a name="l00586"></a>00586     <a class="code" href="../../d9/d39/classImageRender.html#ab2841958aab8cb3acdaa1c0ecf9f8d02" title="render tools">m_rendertools</a> = <a class="code" href="../../d9/d39/classImageRender.html#a08abdefd263c1e5b0704a76139fecaa4" title="engine">m_engine</a>-&gt;<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#af284473bd42a01eb72f9f87422cbda7d">GetRenderTools</a>();
<a name="l00587"></a>00587     <span class="comment">// locate the vertex assigned to mat and do following calculation in mesh coordinates</span>
<a name="l00588"></a>00588     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> meshIndex = 0; meshIndex &lt; mirror-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0380469d233ad08592b6a49819db066d">GetMeshCount</a>(); meshIndex++)
<a name="l00589"></a>00589     {
<a name="l00590"></a>00590         <a class="code" href="../../d5/d85/classRAS__MeshObject.html">RAS_MeshObject</a>* mesh = mirror-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#a0a71e1e10264a686d4bce3ec2733fe86">GetMesh</a>(meshIndex);
<a name="l00591"></a>00591         <span class="keywordtype">int</span> numPolygons = mesh-&gt;<a class="code" href="../../d5/d85/classRAS__MeshObject.html#afaeb47385d766ebce971b11476d97009">NumPolygons</a>();
<a name="l00592"></a>00592         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> polygonIndex=0; polygonIndex &lt; numPolygons; polygonIndex++)
<a name="l00593"></a>00593         {
<a name="l00594"></a>00594             <a class="code" href="../../dc/dd9/classRAS__Polygon.html">RAS_Polygon</a>* polygon = mesh-&gt;<a class="code" href="../../d5/d85/classRAS__MeshObject.html#a599277a8e5d4f4460b4ebe8eb32652ce">GetPolygon</a>(polygonIndex);
<a name="l00595"></a>00595             <span class="keywordflow">if</span> (polygon-&gt;<a class="code" href="../../dc/dd9/classRAS__Polygon.html#ab66f7735ffe08089a054a19da9dd1740">GetMaterial</a>()-&gt;<a class="code" href="../../de/dc6/classRAS__MaterialBucket.html#acc588ec1f42649b68ce44a4b1dd02711">GetPolyMaterial</a>() == mat)
<a name="l00596"></a>00596             {
<a name="l00597"></a>00597                 <a class="code" href="../../dc/dd2/classRAS__TexVert.html">RAS_TexVert</a> *v1, *v2, *v3, *v4;
<a name="l00598"></a>00598                 <span class="keywordtype">float</span> normal[3];
<a name="l00599"></a>00599                 <span class="keywordtype">float</span> area;
<a name="l00600"></a>00600                 <span class="comment">// this polygon is part of the mirror,</span>
<a name="l00601"></a>00601                 v1 = polygon-&gt;<a class="code" href="../../dc/dd9/classRAS__Polygon.html#a183769a341bffba880c774f683c01d49">GetVertex</a>(0);
<a name="l00602"></a>00602                 v2 = polygon-&gt;<a class="code" href="../../dc/dd9/classRAS__Polygon.html#a183769a341bffba880c774f683c01d49">GetVertex</a>(1);
<a name="l00603"></a>00603                 v3 = polygon-&gt;<a class="code" href="../../dc/dd9/classRAS__Polygon.html#a183769a341bffba880c774f683c01d49">GetVertex</a>(2);
<a name="l00604"></a>00604                 mirrorVerts.push_back(v1);
<a name="l00605"></a>00605                 mirrorVerts.push_back(v2);
<a name="l00606"></a>00606                 mirrorVerts.push_back(v3);
<a name="l00607"></a>00607                 <span class="keywordflow">if</span> (polygon-&gt;<a class="code" href="../../dc/dd9/classRAS__Polygon.html#a4ac9781df1430304b634f76236a5cfd1">VertexCount</a>() == 4)
<a name="l00608"></a>00608                 {
<a name="l00609"></a>00609                     v4 = polygon-&gt;<a class="code" href="../../dc/dd9/classRAS__Polygon.html#a183769a341bffba880c774f683c01d49">GetVertex</a>(3);
<a name="l00610"></a>00610                     mirrorVerts.push_back(v4);
<a name="l00611"></a>00611                     area = <a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#a79b270ef64d46a87c7739ff2042fb7db">normal_quad_v3</a>( normal,(<span class="keywordtype">float</span>*)v1-&gt;<a class="code" href="../../dc/dd2/classRAS__TexVert.html#ad90716d0e59579a64f0c5d4ce4527400">getXYZ</a>(), (<span class="keywordtype">float</span>*)v2-&gt;<a class="code" href="../../dc/dd2/classRAS__TexVert.html#ad90716d0e59579a64f0c5d4ce4527400">getXYZ</a>(), (<span class="keywordtype">float</span>*)v3-&gt;<a class="code" href="../../dc/dd2/classRAS__TexVert.html#ad90716d0e59579a64f0c5d4ce4527400">getXYZ</a>(), (<span class="keywordtype">float</span>*)v4-&gt;<a class="code" href="../../dc/dd2/classRAS__TexVert.html#ad90716d0e59579a64f0c5d4ce4527400">getXYZ</a>());
<a name="l00612"></a>00612                 } <span class="keywordflow">else</span>
<a name="l00613"></a>00613                 {
<a name="l00614"></a>00614                     area = <a class="code" href="../../d9/dc3/BLI__math__geom_8h.html#ada7050cefa95b7a630489eddee0c3834">normal_tri_v3</a>( normal,(<span class="keywordtype">float</span>*)v1-&gt;<a class="code" href="../../dc/dd2/classRAS__TexVert.html#ad90716d0e59579a64f0c5d4ce4527400">getXYZ</a>(), (<span class="keywordtype">float</span>*)v2-&gt;<a class="code" href="../../dc/dd2/classRAS__TexVert.html#ad90716d0e59579a64f0c5d4ce4527400">getXYZ</a>(), (<span class="keywordtype">float</span>*)v3-&gt;<a class="code" href="../../dc/dd2/classRAS__TexVert.html#ad90716d0e59579a64f0c5d4ce4527400">getXYZ</a>());
<a name="l00615"></a>00615                 }
<a name="l00616"></a>00616                 area = <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(area);
<a name="l00617"></a>00617                 mirrorArea += area;
<a name="l00618"></a>00618                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(normal, area);
<a name="l00619"></a>00619                 <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a870d4342840636e86ed7966cd883cebc">add_v3_v3v3</a>(mirrorNormal, mirrorNormal, normal);
<a name="l00620"></a>00620             }
<a name="l00621"></a>00621         }
<a name="l00622"></a>00622     }
<a name="l00623"></a>00623     <span class="keywordflow">if</span> (mirrorVerts.size() == 0 || mirrorArea &lt; FLT_EPSILON)
<a name="l00624"></a>00624     {
<a name="l00625"></a>00625         <span class="comment">// no vertex or zero size mirror</span>
<a name="l00626"></a>00626         <a class="code" href="../../d8/d8a/Exception_8h.html#ac3b2bffb453f4e8e369013659070c6f8">THRWEXCP</a>(MirrorSizeInvalid, <a class="code" href="../../d6/d5c/gameengine_2VideoTexture_2Common_8h.html#a14bc2dfa42241600d567369cd25ddc70">S_OK</a>);
<a name="l00627"></a>00627     }
<a name="l00628"></a>00628     <span class="comment">// compute average normal of mirror faces</span>
<a name="l00629"></a>00629     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(mirrorNormal, 1.0f/mirrorArea);
<a name="l00630"></a>00630     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(mirrorNormal) == 0.f)
<a name="l00631"></a>00631     {
<a name="l00632"></a>00632         <span class="comment">// no normal</span>
<a name="l00633"></a>00633         <a class="code" href="../../d8/d8a/Exception_8h.html#ac3b2bffb453f4e8e369013659070c6f8">THRWEXCP</a>(MirrorNormalInvalid, <a class="code" href="../../d6/d5c/gameengine_2VideoTexture_2Common_8h.html#a14bc2dfa42241600d567369cd25ddc70">S_OK</a>);
<a name="l00634"></a>00634     }
<a name="l00635"></a>00635     <span class="comment">// the mirror plane has an equation of the type ax+by+cz = d where (a,b,c) is the normal vector</span>
<a name="l00636"></a>00636     <span class="comment">// if the mirror is more vertical then horizontal, the Z axis is the up direction.</span>
<a name="l00637"></a>00637     <span class="comment">// otherwise the Y axis is the up direction.</span>
<a name="l00638"></a>00638     <span class="comment">// If the mirror is not perfectly vertical(horizontal), the Z(Y) axis projection on the mirror</span>
<a name="l00639"></a>00639     <span class="comment">// plan by the normal will be the up direction.</span>
<a name="l00640"></a>00640     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(mirrorNormal[2]) &gt; <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(mirrorNormal[1]) &amp;&amp;
<a name="l00641"></a>00641             <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(mirrorNormal[2]) &gt; <a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(mirrorNormal[0]))
<a name="l00642"></a>00642     {
<a name="l00643"></a>00643         <span class="comment">// the mirror is more horizontal than vertical</span>
<a name="l00644"></a>00644         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(axis, yaxis);
<a name="l00645"></a>00645     }
<a name="l00646"></a>00646     <span class="keywordflow">else</span>
<a name="l00647"></a>00647     {
<a name="l00648"></a>00648         <span class="comment">// the mirror is more vertical than horizontal</span>
<a name="l00649"></a>00649         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(axis, zaxis);
<a name="l00650"></a>00650     }
<a name="l00651"></a>00651     dist = <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a76629ccfe891bccda30f790ed501e959">dot_v3v3</a>(mirrorNormal, axis);
<a name="l00652"></a>00652     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d22/stdosl_8h.html#a706cbf0492993ed1d280ccf8e9b56682">fabs</a>(dist) &lt; FLT_EPSILON)
<a name="l00653"></a>00653     {
<a name="l00654"></a>00654         <span class="comment">// the mirror is already fully aligned with up axis</span>
<a name="l00655"></a>00655         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(mirrorUp, axis);
<a name="l00656"></a>00656     }
<a name="l00657"></a>00657     <span class="keywordflow">else</span>
<a name="l00658"></a>00658     {
<a name="l00659"></a>00659         <span class="comment">// projection of axis to mirror plane through normal</span>
<a name="l00660"></a>00660         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, mirrorNormal);
<a name="l00661"></a>00661         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a614c21caf4e6d770c7a49006a7f734b4">mul_v3_fl</a>(vec, dist);
<a name="l00662"></a>00662         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a55cc5423278e715951545237ac71fb8b">sub_v3_v3v3</a>(mirrorUp, axis, vec);
<a name="l00663"></a>00663         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a3b49789e4776d019ff5756b73df2f3a1">normalize_v3</a>(mirrorUp) == 0.f)
<a name="l00664"></a>00664         {
<a name="l00665"></a>00665             <span class="comment">// should not happen</span>
<a name="l00666"></a>00666             <a class="code" href="../../d8/d8a/Exception_8h.html#ac3b2bffb453f4e8e369013659070c6f8">THRWEXCP</a>(MirrorHorizontal, <a class="code" href="../../d6/d5c/gameengine_2VideoTexture_2Common_8h.html#a14bc2dfa42241600d567369cd25ddc70">S_OK</a>);
<a name="l00667"></a>00667             <span class="keywordflow">return</span>;
<a name="l00668"></a>00668         }
<a name="l00669"></a>00669     }
<a name="l00670"></a>00670     <span class="comment">// compute rotation matrix between local coord and mirror coord</span>
<a name="l00671"></a>00671     <span class="comment">// to match camera orientation, we select mirror z = -normal, y = up, x = y x z</span>
<a name="l00672"></a>00672     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a728bb3f38e925644683c9ace0cee4977">negate_v3_v3</a>(mirrorMat[2], mirrorNormal);
<a name="l00673"></a>00673     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(mirrorMat[1], mirrorUp);
<a name="l00674"></a>00674     <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a8828e92cd5d3d481c95a1745c94c1c6f">cross_v3_v3v3</a>(mirrorMat[0], mirrorMat[1], mirrorMat[2]);
<a name="l00675"></a>00675     <span class="comment">// transpose to make it a orientation matrix from local space to mirror space</span>
<a name="l00676"></a>00676     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad34fc69317ce2354d58d80147b753408">transpose_m3</a>(mirrorMat);
<a name="l00677"></a>00677     <span class="comment">// transform all vertex to plane coordinates and determine mirror position</span>
<a name="l00678"></a>00678     left = <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>;
<a name="l00679"></a>00679     right = -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>;
<a name="l00680"></a>00680     bottom = <a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>;
<a name="l00681"></a>00681     top = -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>;
<a name="l00682"></a>00682     back = -<a class="code" href="../../d3/db4/VEC3_8h.html#a7fbf1534f9e0f0bfdb86fb928902474c">FLT_MAX</a>; <span class="comment">// most backward vertex (=highest Z coord in mirror space)</span>
<a name="l00683"></a>00683     <span class="keywordflow">for</span> (it = mirrorVerts.begin(); it != mirrorVerts.end(); it++)
<a name="l00684"></a>00684     {
<a name="l00685"></a>00685         <a class="code" href="../../d3/d86/BLI__math__vector_8h.html#a6cf5ea9576bb2186e5c71a02480875eb">copy_v3_v3</a>(vec, (<span class="keywordtype">float</span>*)(*it)-&gt;getXYZ());
<a name="l00686"></a>00686         <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(mirrorMat, vec);
<a name="l00687"></a>00687         <span class="keywordflow">if</span> (vec[0] &lt; left)
<a name="l00688"></a>00688             left = vec[0];
<a name="l00689"></a>00689         <span class="keywordflow">if</span> (vec[0] &gt; right)
<a name="l00690"></a>00690             right = vec[0];
<a name="l00691"></a>00691         <span class="keywordflow">if</span> (vec[1] &lt; bottom)
<a name="l00692"></a>00692             bottom = vec[1];
<a name="l00693"></a>00693         <span class="keywordflow">if</span> (vec[1] &gt; top)
<a name="l00694"></a>00694             top = vec[1];
<a name="l00695"></a>00695         <span class="keywordflow">if</span> (vec[2] &gt; back)
<a name="l00696"></a>00696             back = vec[2];
<a name="l00697"></a>00697     }
<a name="l00698"></a>00698     <span class="comment">// now store this information in the object for later rendering</span>
<a name="l00699"></a>00699     <a class="code" href="../../d9/d39/classImageRender.html#acc39511cae054e324498e8770a100c5c">m_mirrorHalfWidth</a> = (right-<a class="code" href="../../db/d0f/navmesh__conversion_8c.html#a4d78fdbccaa4d42dc8599d58cdf0de96">left</a>)*0.5f;
<a name="l00700"></a>00700     <a class="code" href="../../d9/d39/classImageRender.html#a2cfac82b50827b9b83bf49dc4293ccf0">m_mirrorHalfHeight</a> = (top-bottom)*0.5f;
<a name="l00701"></a>00701     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d39/classImageRender.html#acc39511cae054e324498e8770a100c5c">m_mirrorHalfWidth</a> &lt; 0.01f || <a class="code" href="../../d9/d39/classImageRender.html#a2cfac82b50827b9b83bf49dc4293ccf0">m_mirrorHalfHeight</a> &lt; 0.01f)
<a name="l00702"></a>00702     {
<a name="l00703"></a>00703         <span class="comment">// mirror too small</span>
<a name="l00704"></a>00704         <a class="code" href="../../d8/d8a/Exception_8h.html#ac3b2bffb453f4e8e369013659070c6f8">THRWEXCP</a>(MirrorTooSmall, <a class="code" href="../../d6/d5c/gameengine_2VideoTexture_2Common_8h.html#a14bc2dfa42241600d567369cd25ddc70">S_OK</a>);
<a name="l00705"></a>00705     }
<a name="l00706"></a>00706     <span class="comment">// mirror position in mirror coord</span>
<a name="l00707"></a>00707     vec[0] = (left+right)*0.5f;
<a name="l00708"></a>00708     vec[1] = (top+bottom)*0.5f;
<a name="l00709"></a>00709     vec[2] = back;
<a name="l00710"></a>00710     <span class="comment">// convert it in local space: transpose again the matrix to get back to mirror to local transform</span>
<a name="l00711"></a>00711     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#ad34fc69317ce2354d58d80147b753408">transpose_m3</a>(mirrorMat);
<a name="l00712"></a>00712     <a class="code" href="../../d3/d8c/BLI__math__matrix_8h.html#a8ffa2d992371e11fad87ffbb55f034c8">mul_m3_v3</a>(mirrorMat, vec);
<a name="l00713"></a>00713     <span class="comment">// mirror position in local space</span>
<a name="l00714"></a>00714     <a class="code" href="../../d9/d39/classImageRender.html#a6fe6800583ee5161f07b78dfe9240523">m_mirrorPos</a>.<a class="code" href="../../d8/da2/classMT__Tuple3.html#af98629114dfe61b7e4c27dee89d7e94d">setValue</a>(vec[0], vec[1], vec[2]);
<a name="l00715"></a>00715     <span class="comment">// mirror normal vector (pointed towards the back of the mirror) in local space</span>
<a name="l00716"></a>00716     <a class="code" href="../../d9/d39/classImageRender.html#a675cf44208b656f4f2b2083a3a7d722a">m_mirrorZ</a>.<a class="code" href="../../d8/da2/classMT__Tuple3.html#af98629114dfe61b7e4c27dee89d7e94d">setValue</a>(-mirrorNormal[0], -mirrorNormal[1], -mirrorNormal[2]);
<a name="l00717"></a>00717     <a class="code" href="../../d9/d39/classImageRender.html#afc3d270e893f7e3061b7fa5b05044c2b">m_mirrorY</a>.<a class="code" href="../../d8/da2/classMT__Tuple3.html#af98629114dfe61b7e4c27dee89d7e94d">setValue</a>(mirrorUp[0], mirrorUp[1], mirrorUp[2]);
<a name="l00718"></a>00718     <a class="code" href="../../d9/d39/classImageRender.html#af6156f2ae22d30b244809035f64cb6f1">m_mirrorX</a> = <a class="code" href="../../d9/d39/classImageRender.html#afc3d270e893f7e3061b7fa5b05044c2b">m_mirrorY</a>.<a class="code" href="../../d6/d9d/classMT__Vector3.html#ac59c854987e49d18361e2bf452e222fe">cross</a>(<a class="code" href="../../d9/d39/classImageRender.html#a675cf44208b656f4f2b2083a3a7d722a">m_mirrorZ</a>);
<a name="l00719"></a>00719     <a class="code" href="../../d9/d39/classImageRender.html#a3f229e2d20ec1cffd0b7afc77a07ae55" title="true if ready to render">m_render</a> = <span class="keyword">true</span>;
<a name="l00720"></a>00720 
<a name="l00721"></a>00721     <a class="code" href="../../d9/d39/classImageRender.html#af850c63feb829045e043c08ce62b06fb" title="set background color">setBackground</a>(0, 0, 255, 255);
<a name="l00722"></a>00722 }
<a name="l00723"></a>00723 
<a name="l00724"></a>00724 
<a name="l00725"></a>00725 
<a name="l00726"></a>00726 
<a name="l00727"></a>00727 <span class="comment">// define python type</span>
<a name="l00728"></a><a class="code" href="../../d1/d58/ImageRender_8cpp.html#af0115356e1fa4b97d5b60faeb671a51b">00728</a> PyTypeObject <a class="code" href="../../d3/dbe/blendVideoTex_8cpp.html#af0115356e1fa4b97d5b60faeb671a51b">ImageMirrorType</a> =
<a name="l00729"></a>00729 { 
<a name="l00730"></a>00730     PyVarObject_HEAD_INIT(NULL, 0)
<a name="l00731"></a>00731     <span class="stringliteral">&quot;VideoTexture.ImageMirror&quot;</span>,   <span class="comment">/*tp_name*/</span>
<a name="l00732"></a>00732     <span class="keyword">sizeof</span>(<a class="code" href="../../db/d22/structPyImage.html">PyImage</a>),          <span class="comment">/*tp_basicsize*/</span>
<a name="l00733"></a>00733     0,                         <span class="comment">/*tp_itemsize*/</span>
<a name="l00734"></a>00734     (destructor)<a class="code" href="../../db/d8e/ImageBase_8cpp.html#aab9974bdcd9824aa8304d102279e0b99">Image_dealloc</a>, <span class="comment">/*tp_dealloc*/</span>
<a name="l00735"></a>00735     0,                         <span class="comment">/*tp_print*/</span>
<a name="l00736"></a>00736     0,                         <span class="comment">/*tp_getattr*/</span>
<a name="l00737"></a>00737     0,                         <span class="comment">/*tp_setattr*/</span>
<a name="l00738"></a>00738     0,                         <span class="comment">/*tp_compare*/</span>
<a name="l00739"></a>00739     0,                         <span class="comment">/*tp_repr*/</span>
<a name="l00740"></a>00740     0,                         <span class="comment">/*tp_as_number*/</span>
<a name="l00741"></a>00741     0,                         <span class="comment">/*tp_as_sequence*/</span>
<a name="l00742"></a>00742     0,                         <span class="comment">/*tp_as_mapping*/</span>
<a name="l00743"></a>00743     0,                         <span class="comment">/*tp_hash */</span>
<a name="l00744"></a>00744     0,                         <span class="comment">/*tp_call*/</span>
<a name="l00745"></a>00745     0,                         <span class="comment">/*tp_str*/</span>
<a name="l00746"></a>00746     0,                         <span class="comment">/*tp_getattro*/</span>
<a name="l00747"></a>00747     0,                         <span class="comment">/*tp_setattro*/</span>
<a name="l00748"></a>00748     &amp;<a class="code" href="../../db/d8e/ImageBase_8cpp.html#ab77040fc062c59fed8cfc59f057e3271">imageBufferProcs</a>,         <span class="comment">/*tp_as_buffer*/</span>
<a name="l00749"></a>00749     Py_TPFLAGS_DEFAULT,        <span class="comment">/*tp_flags*/</span>
<a name="l00750"></a>00750     <span class="stringliteral">&quot;Image source from mirror&quot;</span>,       <span class="comment">/* tp_doc */</span>
<a name="l00751"></a>00751     0,                     <span class="comment">/* tp_traverse */</span>
<a name="l00752"></a>00752     0,                     <span class="comment">/* tp_clear */</span>
<a name="l00753"></a>00753     0,                     <span class="comment">/* tp_richcompare */</span>
<a name="l00754"></a>00754     0,                     <span class="comment">/* tp_weaklistoffset */</span>
<a name="l00755"></a>00755     0,                     <span class="comment">/* tp_iter */</span>
<a name="l00756"></a>00756     0,                     <span class="comment">/* tp_iternext */</span>
<a name="l00757"></a>00757     <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a649e31d749315d92704938ee042abf78">imageRenderMethods</a>,    <span class="comment">/* tp_methods */</span>
<a name="l00758"></a>00758     0,                   <span class="comment">/* tp_members */</span>
<a name="l00759"></a>00759     <a class="code" href="../../d1/d58/ImageRender_8cpp.html#a3a6962a97eaa914badf9583c19183de8">imageMirrorGetSets</a>,          <span class="comment">/* tp_getset */</span>
<a name="l00760"></a>00760     0,                         <span class="comment">/* tp_base */</span>
<a name="l00761"></a>00761     0,                         <span class="comment">/* tp_dict */</span>
<a name="l00762"></a>00762     0,                         <span class="comment">/* tp_descr_get */</span>
<a name="l00763"></a>00763     0,                         <span class="comment">/* tp_descr_set */</span>
<a name="l00764"></a>00764     0,                         <span class="comment">/* tp_dictoffset */</span>
<a name="l00765"></a>00765     (initproc)<a class="code" href="../../d1/d58/ImageRender_8cpp.html#a773b2a20164ebe51c566aed55639bd0d">ImageMirror_init</a>,     <span class="comment">/* tp_init */</span>
<a name="l00766"></a>00766     0,                         <span class="comment">/* tp_alloc */</span>
<a name="l00767"></a>00767     <a class="code" href="../../db/d8e/ImageBase_8cpp.html#a0c7bec9878faf6a119923b192d797361">Image_allocNew</a>,           <span class="comment">/* tp_new */</span>
<a name="l00768"></a>00768 };
<a name="l00769"></a>00769 
<a name="l00770"></a>00770 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:24 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

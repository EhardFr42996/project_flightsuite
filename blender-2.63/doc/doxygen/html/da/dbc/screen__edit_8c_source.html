<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: screen_edit.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">screen_edit.c</div>  </div>
</div>
<div class="contents">
<a href="../../da/dbc/screen__edit_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version. </span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2008 Blender Foundation.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> *</span>
<a name="l00022"></a>00022 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00023"></a>00023 <span class="comment"> */</span>
<a name="l00024"></a>00024 
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/de4/DNA__userdef__types_8h.html">DNA_userdef_types.h</a>&quot;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7d/BLI__utildefines_8h.html">BLI_utildefines.h</a>&quot;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d01/BKE__context_8h.html">BKE_context.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/BKE__global_8h.html">BKE_global.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/db1/BKE__library_8h.html">BKE_library.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d9a/BKE__main_8h.html">BKE_main.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d91/BKE__node_8h.html">BKE_node.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/da3/BKE__screen_8h.html">BKE_screen.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d53/BKE__scene_8h.html">BKE_scene.h</a>&quot;</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d44/BIF__gl_8h.html">BIF_gl.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d71/BIF__glutil_8h.html">BIF_glutil.h</a>&quot;</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d7f/WM__api_8h.html">WM_api.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/ddc/WM__types_8h.html">WM_types.h</a>&quot;</span>
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d53/ED__image_8h.html">ED_image.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d7a/ED__object_8h.html">ED_object.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d12/ED__screen_8h.html">ED_screen.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d85/ED__screen__types_8h.html">ED_screen_types.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../db/db9/ED__fileselect_8h.html">ED_fileselect.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dbe/ED__clip_8h.html">ED_clip.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d53/ED__render_8h.html">ED_render.h</a>&quot;</span>
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d1e/UI__interface_8h.html">UI_interface.h</a>&quot;</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="comment">/* XXX actually should be not here... solve later */</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d6f/wm__subwindow_8h.html">wm_subwindow.h</a>&quot;</span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/de3/screen__intern_8h.html">screen_intern.h</a>&quot;</span>  <span class="comment">/* own module include */</span>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="comment">/* ******************* screen vert, edge, area managing *********************** */</span>
<a name="l00073"></a>00073 
<a name="l00074"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a334c9583d8ff69c63c649ff6e5d1fe25">00074</a> <span class="keyword">static</span> <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *<a class="code" href="../../da/dbc/screen__edit_8c.html#a334c9583d8ff69c63c649ff6e5d1fe25">screen_addvert</a>(<a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc, <span class="keywordtype">short</span> x, <span class="keywordtype">short</span> y)
<a name="l00075"></a>00075 {
<a name="l00076"></a>00076     <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *sv= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a>), <span class="stringliteral">&quot;addscrvert&quot;</span>);
<a name="l00077"></a>00077     sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>= x;
<a name="l00078"></a>00078     sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>= y;
<a name="l00079"></a>00079     
<a name="l00080"></a>00080     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a7b16bb3f5dea1f6159af5be6ea599474">vertbase</a>, sv);
<a name="l00081"></a>00081     <span class="keywordflow">return</span> sv;
<a name="l00082"></a>00082 }
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a098c5dbae55f055cb9db2999558f967f">00084</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#a098c5dbae55f055cb9db2999558f967f">sortscrvert</a>(<a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> **<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>, <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> **<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>)
<a name="l00085"></a>00085 {
<a name="l00086"></a>00086     <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *tmp;
<a name="l00087"></a>00087     
<a name="l00088"></a>00088     <span class="keywordflow">if</span> (*v1 &gt; *v2) {
<a name="l00089"></a>00089         tmp= *<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>;
<a name="l00090"></a>00090         *v1= *<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>;
<a name="l00091"></a>00091         *v2= tmp;   
<a name="l00092"></a>00092     }
<a name="l00093"></a>00093 }
<a name="l00094"></a>00094 
<a name="l00095"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">00095</a> <span class="keyword">static</span> <a class="code" href="../../dd/d31/structScrEdge.html">ScrEdge</a> *<a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(<a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc, <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>, <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>)
<a name="l00096"></a>00096 {
<a name="l00097"></a>00097     <a class="code" href="../../dd/d31/structScrEdge.html">ScrEdge</a> *se= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../dd/d31/structScrEdge.html">ScrEdge</a>), <span class="stringliteral">&quot;addscredge&quot;</span>);
<a name="l00098"></a>00098     
<a name="l00099"></a>00099     <a class="code" href="../../da/dbc/screen__edit_8c.html#a098c5dbae55f055cb9db2999558f967f">sortscrvert</a>(&amp;v1, &amp;v2);
<a name="l00100"></a>00100     se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>= <a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>;
<a name="l00101"></a>00101     se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>= <a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>;
<a name="l00102"></a>00102     
<a name="l00103"></a>00103     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a15558c58cb9e3d4544f6ab5d9c031a9e">edgebase</a>, se);
<a name="l00104"></a>00104     <span class="keywordflow">return</span> se;
<a name="l00105"></a>00105 }
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 
<a name="l00108"></a><a class="code" href="../../d7/de3/screen__intern_8h.html#af04be364808a61aef8ec5c37a4ac899f">00108</a> <a class="code" href="../../dd/d31/structScrEdge.html">ScrEdge</a> *<a class="code" href="../../da/dbc/screen__edit_8c.html#af04be364808a61aef8ec5c37a4ac899f">screen_findedge</a>(<a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc, <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>, <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>)
<a name="l00109"></a>00109 {
<a name="l00110"></a>00110     <a class="code" href="../../dd/d31/structScrEdge.html">ScrEdge</a> *se;
<a name="l00111"></a>00111     
<a name="l00112"></a>00112     <a class="code" href="../../da/dbc/screen__edit_8c.html#a098c5dbae55f055cb9db2999558f967f">sortscrvert</a>(&amp;v1, &amp;v2);
<a name="l00113"></a>00113     <span class="keywordflow">for</span> (se= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a15558c58cb9e3d4544f6ab5d9c031a9e">edgebase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; se; se= se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a7e0011f64d0b13a5234a7d4a2c1f1948">next</a>)
<a name="l00114"></a>00114         <span class="keywordflow">if</span> (se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>==v1 &amp;&amp; se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>==v2)
<a name="l00115"></a>00115             <span class="keywordflow">return</span> se;
<a name="l00116"></a>00116     
<a name="l00117"></a>00117     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00118"></a>00118 }
<a name="l00119"></a>00119 
<a name="l00120"></a><a class="code" href="../../d7/de3/screen__intern_8h.html#a5833bc9adacacd496ee1ce122eeb3802">00120</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#a5833bc9adacacd496ee1ce122eeb3802">removedouble_scrverts</a>(<a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc)
<a name="l00121"></a>00121 {
<a name="l00122"></a>00122     <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>, *verg;
<a name="l00123"></a>00123     <a class="code" href="../../dd/d31/structScrEdge.html">ScrEdge</a> *se;
<a name="l00124"></a>00124     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l00125"></a>00125     
<a name="l00126"></a>00126     verg= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a7b16bb3f5dea1f6159af5be6ea599474">vertbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00127"></a>00127     <span class="keywordflow">while</span> (verg) {
<a name="l00128"></a>00128         <span class="keywordflow">if</span> (verg-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) { <span class="comment">/* !!! */</span>
<a name="l00129"></a>00129             v1= verg-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a5926b403c5e00af979b2825ee76353eb">next</a>;
<a name="l00130"></a>00130             <span class="keywordflow">while</span> (v1) {
<a name="l00131"></a>00131                 <span class="keywordflow">if</span> (v1-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {   <span class="comment">/* !?! */</span>
<a name="l00132"></a>00132                     <span class="keywordflow">if</span> (v1-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>==verg-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a> &amp;&amp; v1-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>==verg-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>) {
<a name="l00133"></a>00133                         <span class="comment">/* printf(&quot;doublevert\n&quot;); */</span>
<a name="l00134"></a>00134                         v1-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>= verg;
<a name="l00135"></a>00135                     }
<a name="l00136"></a>00136                 }
<a name="l00137"></a>00137                 v1= v1-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a5926b403c5e00af979b2825ee76353eb">next</a>;
<a name="l00138"></a>00138             }
<a name="l00139"></a>00139         }
<a name="l00140"></a>00140         verg= verg-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a5926b403c5e00af979b2825ee76353eb">next</a>;
<a name="l00141"></a>00141     }
<a name="l00142"></a>00142 
<a name="l00143"></a>00143     <span class="comment">/* replace pointers in edges and faces */</span>
<a name="l00144"></a>00144     se= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a15558c58cb9e3d4544f6ab5d9c031a9e">edgebase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00145"></a>00145     <span class="keywordflow">while</span> (se) {
<a name="l00146"></a>00146         <span class="keywordflow">if</span> (se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>) se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>= se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>;
<a name="l00147"></a>00147         <span class="keywordflow">if</span> (se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>) se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>= se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>;
<a name="l00148"></a>00148         <span class="comment">/* edges changed: so.... */</span>
<a name="l00149"></a>00149         <a class="code" href="../../da/dbc/screen__edit_8c.html#a098c5dbae55f055cb9db2999558f967f">sortscrvert</a>(&amp;(se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>), &amp;(se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>));
<a name="l00150"></a>00150         se= se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a7e0011f64d0b13a5234a7d4a2c1f1948">next</a>;
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152     sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00153"></a>00153     <span class="keywordflow">while</span> (sa) {
<a name="l00154"></a>00154         <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>) sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>;
<a name="l00155"></a>00155         <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>) sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>;
<a name="l00156"></a>00156         <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>) sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>;
<a name="l00157"></a>00157         <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>) sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>;
<a name="l00158"></a>00158         sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>;
<a name="l00159"></a>00159     }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161     <span class="comment">/* remove */</span>
<a name="l00162"></a>00162     verg= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a7b16bb3f5dea1f6159af5be6ea599474">vertbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00163"></a>00163     <span class="keywordflow">while</span> (verg) {
<a name="l00164"></a>00164         v1= verg-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a5926b403c5e00af979b2825ee76353eb">next</a>;
<a name="l00165"></a>00165         <span class="keywordflow">if</span> (verg-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>) {
<a name="l00166"></a>00166             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a7b16bb3f5dea1f6159af5be6ea599474">vertbase</a>, verg);
<a name="l00167"></a>00167             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(verg);
<a name="l00168"></a>00168         }
<a name="l00169"></a>00169         verg= <a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>;
<a name="l00170"></a>00170     }
<a name="l00171"></a>00171 
<a name="l00172"></a>00172 }
<a name="l00173"></a>00173 
<a name="l00174"></a><a class="code" href="../../d7/de3/screen__intern_8h.html#a7acdd21fe72ae8da2be0b425df2d29e5">00174</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#a7acdd21fe72ae8da2be0b425df2d29e5">removenotused_scrverts</a>(<a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc)
<a name="l00175"></a>00175 {
<a name="l00176"></a>00176     <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *sv, *svn;
<a name="l00177"></a>00177     <a class="code" href="../../dd/d31/structScrEdge.html">ScrEdge</a> *se;
<a name="l00178"></a>00178     
<a name="l00179"></a>00179     <span class="comment">/* we assume edges are ok */</span>
<a name="l00180"></a>00180     
<a name="l00181"></a>00181     se= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a15558c58cb9e3d4544f6ab5d9c031a9e">edgebase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00182"></a>00182     <span class="keywordflow">while</span> (se) {
<a name="l00183"></a>00183         se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a6c44cfb866bff3ce87a9342db96dd691">flag</a>= 1;
<a name="l00184"></a>00184         se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a6c44cfb866bff3ce87a9342db96dd691">flag</a>= 1;
<a name="l00185"></a>00185         se= se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a7e0011f64d0b13a5234a7d4a2c1f1948">next</a>;
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187     
<a name="l00188"></a>00188     sv= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a7b16bb3f5dea1f6159af5be6ea599474">vertbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00189"></a>00189     <span class="keywordflow">while</span> (sv) {
<a name="l00190"></a>00190         svn= sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a5926b403c5e00af979b2825ee76353eb">next</a>;
<a name="l00191"></a>00191         <span class="keywordflow">if</span> (sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a6c44cfb866bff3ce87a9342db96dd691">flag</a>==0) {
<a name="l00192"></a>00192             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a7b16bb3f5dea1f6159af5be6ea599474">vertbase</a>, sv);
<a name="l00193"></a>00193             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(sv);
<a name="l00194"></a>00194         }
<a name="l00195"></a>00195         <span class="keywordflow">else</span> sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a6c44cfb866bff3ce87a9342db96dd691">flag</a>= 0;
<a name="l00196"></a>00196         sv= svn;
<a name="l00197"></a>00197     }
<a name="l00198"></a>00198 }
<a name="l00199"></a>00199 
<a name="l00200"></a><a class="code" href="../../d7/de3/screen__intern_8h.html#a69ed104f9640180b1041bf20343a276c">00200</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#a69ed104f9640180b1041bf20343a276c">removedouble_scredges</a>(<a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc)
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202     <a class="code" href="../../dd/d31/structScrEdge.html">ScrEdge</a> *verg, *se, *sn;
<a name="l00203"></a>00203     
<a name="l00204"></a>00204     <span class="comment">/* compare */</span>
<a name="l00205"></a>00205     verg= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a15558c58cb9e3d4544f6ab5d9c031a9e">edgebase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00206"></a>00206     <span class="keywordflow">while</span> (verg) {
<a name="l00207"></a>00207         se= verg-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a7e0011f64d0b13a5234a7d4a2c1f1948">next</a>;
<a name="l00208"></a>00208         <span class="keywordflow">while</span> (se) {
<a name="l00209"></a>00209             sn= se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a7e0011f64d0b13a5234a7d4a2c1f1948">next</a>;
<a name="l00210"></a>00210             <span class="keywordflow">if</span> (verg-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>==se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a> &amp;&amp; verg-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>==se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>) {
<a name="l00211"></a>00211                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a15558c58cb9e3d4544f6ab5d9c031a9e">edgebase</a>, se);
<a name="l00212"></a>00212                 <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(se);
<a name="l00213"></a>00213             }
<a name="l00214"></a>00214             se= sn;
<a name="l00215"></a>00215         }
<a name="l00216"></a>00216         verg= verg-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a7e0011f64d0b13a5234a7d4a2c1f1948">next</a>;
<a name="l00217"></a>00217     }
<a name="l00218"></a>00218 }
<a name="l00219"></a>00219 
<a name="l00220"></a><a class="code" href="../../d7/de3/screen__intern_8h.html#a4293968842b469ffb441259ed141f43a">00220</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#a4293968842b469ffb441259ed141f43a">removenotused_scredges</a>(<a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc)
<a name="l00221"></a>00221 {
<a name="l00222"></a>00222     <a class="code" href="../../dd/d31/structScrEdge.html">ScrEdge</a> *se, *sen;
<a name="l00223"></a>00223     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l00224"></a>00224     <span class="keywordtype">int</span> a=0;
<a name="l00225"></a>00225     
<a name="l00226"></a>00226     <span class="comment">/* sets flags when edge is used in area */</span>
<a name="l00227"></a>00227     sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00228"></a>00228     <span class="keywordflow">while</span> (sa) {
<a name="l00229"></a>00229         se= <a class="code" href="../../da/dbc/screen__edit_8c.html#af04be364808a61aef8ec5c37a4ac899f">screen_findedge</a>(sc, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>);
<a name="l00230"></a>00230         <span class="keywordflow">if</span> (se==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) printf(<span class="stringliteral">&quot;error: area %d edge 1 doesn&#39;t exist\n&quot;</span>, a);
<a name="l00231"></a>00231         <span class="keywordflow">else</span> se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a968aa89dd6ed5cd99d7709d2103efca8">flag</a>= 1;
<a name="l00232"></a>00232         se= <a class="code" href="../../da/dbc/screen__edit_8c.html#af04be364808a61aef8ec5c37a4ac899f">screen_findedge</a>(sc, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>);
<a name="l00233"></a>00233         <span class="keywordflow">if</span> (se==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) printf(<span class="stringliteral">&quot;error: area %d edge 2 doesn&#39;t exist\n&quot;</span>, a);
<a name="l00234"></a>00234         <span class="keywordflow">else</span> se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a968aa89dd6ed5cd99d7709d2103efca8">flag</a>= 1;
<a name="l00235"></a>00235         se= <a class="code" href="../../da/dbc/screen__edit_8c.html#af04be364808a61aef8ec5c37a4ac899f">screen_findedge</a>(sc, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>);
<a name="l00236"></a>00236         <span class="keywordflow">if</span> (se==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) printf(<span class="stringliteral">&quot;error: area %d edge 3 doesn&#39;t exist\n&quot;</span>, a);
<a name="l00237"></a>00237         <span class="keywordflow">else</span> se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a968aa89dd6ed5cd99d7709d2103efca8">flag</a>= 1;
<a name="l00238"></a>00238         se= <a class="code" href="../../da/dbc/screen__edit_8c.html#af04be364808a61aef8ec5c37a4ac899f">screen_findedge</a>(sc, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>);
<a name="l00239"></a>00239         <span class="keywordflow">if</span> (se==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) printf(<span class="stringliteral">&quot;error: area %d edge 4 doesn&#39;t exist\n&quot;</span>, a);
<a name="l00240"></a>00240         <span class="keywordflow">else</span> se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a968aa89dd6ed5cd99d7709d2103efca8">flag</a>= 1;
<a name="l00241"></a>00241         sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>;
<a name="l00242"></a>00242         a++;
<a name="l00243"></a>00243     }
<a name="l00244"></a>00244     se= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a15558c58cb9e3d4544f6ab5d9c031a9e">edgebase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00245"></a>00245     <span class="keywordflow">while</span> (se) {
<a name="l00246"></a>00246         sen= se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a7e0011f64d0b13a5234a7d4a2c1f1948">next</a>;
<a name="l00247"></a>00247         <span class="keywordflow">if</span> (se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a968aa89dd6ed5cd99d7709d2103efca8">flag</a>==0) {
<a name="l00248"></a>00248             <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a15558c58cb9e3d4544f6ab5d9c031a9e">edgebase</a>, se);
<a name="l00249"></a>00249             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(se);
<a name="l00250"></a>00250         }
<a name="l00251"></a>00251         <span class="keywordflow">else</span> se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a968aa89dd6ed5cd99d7709d2103efca8">flag</a>= 0;
<a name="l00252"></a>00252         se= sen;
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254 }
<a name="l00255"></a>00255 
<a name="l00256"></a><a class="code" href="../../d7/de3/screen__intern_8h.html#a7a9ae203ae84d9436052de27bfdbbc68">00256</a> <span class="keywordtype">int</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#a7a9ae203ae84d9436052de27bfdbbc68">scredge_is_horizontal</a>(<a class="code" href="../../dd/d31/structScrEdge.html">ScrEdge</a> *se)
<a name="l00257"></a>00257 {
<a name="l00258"></a>00258     <span class="keywordflow">return</span> (se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a> == se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>);
<a name="l00259"></a>00259 }
<a name="l00260"></a>00260 
<a name="l00261"></a><a class="code" href="../../d7/de3/screen__intern_8h.html#ad462a6663b9be9ed4230edfd68e81cb5">00261</a> <a class="code" href="../../dd/d31/structScrEdge.html">ScrEdge</a> *<a class="code" href="../../da/dbc/screen__edit_8c.html#ad462a6663b9be9ed4230edfd68e81cb5">screen_find_active_scredge</a>(<a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc, <span class="keywordtype">int</span> mx, <span class="keywordtype">int</span> my)
<a name="l00262"></a>00262 {
<a name="l00263"></a>00263     <a class="code" href="../../dd/d31/structScrEdge.html">ScrEdge</a> *se;
<a name="l00264"></a>00264     
<a name="l00265"></a>00265     <span class="keywordflow">for</span> (se= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a15558c58cb9e3d4544f6ab5d9c031a9e">edgebase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; se; se= se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a7e0011f64d0b13a5234a7d4a2c1f1948">next</a>) {
<a name="l00266"></a>00266         <span class="keywordflow">if</span> (<a class="code" href="../../da/dbc/screen__edit_8c.html#a7a9ae203ae84d9436052de27bfdbbc68">scredge_is_horizontal</a>(se)) {
<a name="l00267"></a>00267             <span class="keywordtype">short</span> <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>, <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>;
<a name="l00268"></a>00268             min= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>, se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>);
<a name="l00269"></a>00269             max= <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>, se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>);
<a name="l00270"></a>00270             
<a name="l00271"></a>00271             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>(my-se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>)&lt;=2 &amp;&amp; mx&gt;=min &amp;&amp; mx&lt;=max)
<a name="l00272"></a>00272                 <span class="keywordflow">return</span> se;
<a name="l00273"></a>00273         } 
<a name="l00274"></a>00274         <span class="keywordflow">else</span> {
<a name="l00275"></a>00275             <span class="keywordtype">short</span> <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>, <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>;
<a name="l00276"></a>00276             min= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>, se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>);
<a name="l00277"></a>00277             max= <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>, se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>);
<a name="l00278"></a>00278             
<a name="l00279"></a>00279             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d22/stdosl_8h.html#a1200284b0188ff3732b55b964e5e3a25">abs</a>(mx-se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>)&lt;=2 &amp;&amp; my&gt;=min &amp;&amp; my&lt;=max)
<a name="l00280"></a>00280                 <span class="keywordflow">return</span> se;
<a name="l00281"></a>00281         }
<a name="l00282"></a>00282     }
<a name="l00283"></a>00283     
<a name="l00284"></a>00284     <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 <span class="comment">/* adds no space data */</span>
<a name="l00290"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#ac87d2958e465e48e0aece7cc6128c6dd">00290</a> <span class="keyword">static</span> <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *<a class="code" href="../../da/dbc/screen__edit_8c.html#ac87d2958e465e48e0aece7cc6128c6dd">screen_addarea</a>(<a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc, <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>, <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>, <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>, <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>, <span class="keywordtype">short</span> <a class="code" href="../../d4/d95/structScrArea.html#ab35681127748c4f7d1fd6f351f69b413">headertype</a>, <span class="keywordtype">short</span> <a class="code" href="../../d4/d95/structScrArea.html#a124203529b9ea4c84ca8f8ae4efff3e3">spacetype</a>)
<a name="l00291"></a>00291 {
<a name="l00292"></a>00292     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a>), <span class="stringliteral">&quot;addscrarea&quot;</span>);
<a name="l00293"></a>00293     sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>= <a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>;
<a name="l00294"></a>00294     sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>= <a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>;
<a name="l00295"></a>00295     sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>= <a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>;
<a name="l00296"></a>00296     sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>= <a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>;
<a name="l00297"></a>00297     sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab35681127748c4f7d1fd6f351f69b413">headertype</a>= <a class="code" href="../../d4/d95/structScrArea.html#ab35681127748c4f7d1fd6f351f69b413">headertype</a>;
<a name="l00298"></a>00298     sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a124203529b9ea4c84ca8f8ae4efff3e3">spacetype</a>= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#adb10112c8e3abb732123a775ebbf7b93">butspacetype</a>= <a class="code" href="../../d4/d95/structScrArea.html#a124203529b9ea4c84ca8f8ae4efff3e3">spacetype</a>;
<a name="l00299"></a>00299     
<a name="l00300"></a>00300     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a28b9955d900264adc216d246f4057f05">BLI_addtail</a>(&amp;sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>, sa);
<a name="l00301"></a>00301     
<a name="l00302"></a>00302     <span class="keywordflow">return</span> sa;
<a name="l00303"></a>00303 }
<a name="l00304"></a>00304 
<a name="l00305"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#afaa799038bf295e2c50af03703041863">00305</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#afaa799038bf295e2c50af03703041863">screen_delarea</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc, <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa)
<a name="l00306"></a>00306 {
<a name="l00307"></a>00307     
<a name="l00308"></a>00308     <a class="code" href="../../d1/d12/ED__screen_8h.html#acf1337067240bb750c7328678a0d896d">ED_area_exit</a>(C, sa);
<a name="l00309"></a>00309     
<a name="l00310"></a>00310     <a class="code" href="../../d7/da3/BKE__screen_8h.html#a03d5b9c3df2fc2f8cd8f23a7ec5fd289">BKE_screen_area_free</a>(sa);
<a name="l00311"></a>00311     
<a name="l00312"></a>00312     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#a1ff36f7c9cfb643553d599b91f08abea">BLI_remlink</a>(&amp;sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>, sa);
<a name="l00313"></a>00313     <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(sa);
<a name="l00314"></a>00314 }
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 <span class="comment">/* return 0: no split possible */</span>
<a name="l00317"></a>00317 <span class="comment">/* else return (integer) screencoordinate split point */</span>
<a name="l00318"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a3d4946d8827f8316a9c43f2feeb63d79">00318</a> <span class="keyword">static</span> <span class="keywordtype">short</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#a3d4946d8827f8316a9c43f2feeb63d79">testsplitpoint</a>(<a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa, <span class="keywordtype">char</span> dir, <span class="keywordtype">float</span> fac)
<a name="l00319"></a>00319 {
<a name="l00320"></a>00320     <span class="keywordtype">short</span> x, y;
<a name="l00321"></a>00321     
<a name="l00322"></a>00322     <span class="comment">// area big enough?</span>
<a name="l00323"></a>00323     <span class="keywordflow">if</span> (dir==<span class="charliteral">&#39;v&#39;</span> &amp;&amp; (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>- sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a> &lt;= 2*<a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a6369333dbdbed753708c61054c88a1d0">AREAMINX</a>)) <span class="keywordflow">return</span> 0;
<a name="l00324"></a>00324     <span class="keywordflow">if</span> (dir==<span class="charliteral">&#39;h&#39;</span> &amp;&amp; (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>- sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a> &lt;= 2*<a class="code" href="../../d4/da4/DNA__screen__types_8h.html#ae343d738fdae8b86fc314dcf6df997ae">AREAMINY</a>)) <span class="keywordflow">return</span> 0;
<a name="l00325"></a>00325     
<a name="l00326"></a>00326     <span class="comment">// to be sure</span>
<a name="l00327"></a>00327     <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(fac, 0.0f, 1.0f);
<a name="l00328"></a>00328     
<a name="l00329"></a>00329     <span class="keywordflow">if</span> (dir==<span class="charliteral">&#39;h&#39;</span>) {
<a name="l00330"></a>00330         y= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>+ fac*(sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>- sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>);
<a name="l00331"></a>00331         
<a name="l00332"></a>00332         <span class="keywordflow">if</span> (y- sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a> &lt; <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#ae343d738fdae8b86fc314dcf6df997ae">AREAMINY</a>) 
<a name="l00333"></a>00333             y= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>+ <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#ae343d738fdae8b86fc314dcf6df997ae">AREAMINY</a>;
<a name="l00334"></a>00334         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>- y &lt; <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#ae343d738fdae8b86fc314dcf6df997ae">AREAMINY</a>) 
<a name="l00335"></a>00335             y= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>- <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#ae343d738fdae8b86fc314dcf6df997ae">AREAMINY</a>;
<a name="l00336"></a>00336         <span class="keywordflow">else</span> y-= (y % <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#af267f1a6298055ff8e414c5cb85208f8">AREAGRID</a>);
<a name="l00337"></a>00337         
<a name="l00338"></a>00338         <span class="keywordflow">return</span> y;
<a name="l00339"></a>00339     }
<a name="l00340"></a>00340     <span class="keywordflow">else</span> {
<a name="l00341"></a>00341         x= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>+ fac*(sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>- sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>);
<a name="l00342"></a>00342         
<a name="l00343"></a>00343         <span class="keywordflow">if</span> (x- sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a> &lt; <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a6369333dbdbed753708c61054c88a1d0">AREAMINX</a>) 
<a name="l00344"></a>00344             x= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>+ <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a6369333dbdbed753708c61054c88a1d0">AREAMINX</a>;
<a name="l00345"></a>00345         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>- x &lt; <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a6369333dbdbed753708c61054c88a1d0">AREAMINX</a>) 
<a name="l00346"></a>00346             x= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>- <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a6369333dbdbed753708c61054c88a1d0">AREAMINX</a>;
<a name="l00347"></a>00347         <span class="keywordflow">else</span> x-= (x % <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#af267f1a6298055ff8e414c5cb85208f8">AREAGRID</a>);
<a name="l00348"></a>00348         
<a name="l00349"></a>00349         <span class="keywordflow">return</span> x;
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351 }
<a name="l00352"></a>00352 
<a name="l00353"></a><a class="code" href="../../d7/de3/screen__intern_8h.html#afa19ca1db492f3b27cdb09e59faee9d4">00353</a> <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *<a class="code" href="../../da/dbc/screen__edit_8c.html#afa19ca1db492f3b27cdb09e59faee9d4">area_split</a>(<a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc, <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa, <span class="keywordtype">char</span> dir, <span class="keywordtype">float</span> fac, <span class="keywordtype">int</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#a47b939f7c38671d6af45357c1700e5c1">merge</a>)
<a name="l00354"></a>00354 {
<a name="l00355"></a>00355     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *newa=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00356"></a>00356     <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *sv1, *sv2;
<a name="l00357"></a>00357     <span class="keywordtype">short</span> <a class="code" href="../../d8/d40/btDbvt_8cpp.html#ad08f07bba2ea0c5c64802b70c686fc68">split</a>;
<a name="l00358"></a>00358     
<a name="l00359"></a>00359     <span class="keywordflow">if</span> (sa==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00360"></a>00360     
<a name="l00361"></a>00361     split= <a class="code" href="../../da/dbc/screen__edit_8c.html#a3d4946d8827f8316a9c43f2feeb63d79">testsplitpoint</a>(sa, dir, fac);
<a name="l00362"></a>00362     <span class="keywordflow">if</span> (split==0) <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00363"></a>00363     
<a name="l00364"></a>00364     <span class="keywordflow">if</span> (dir==<span class="charliteral">&#39;h&#39;</span>) {
<a name="l00365"></a>00365         <span class="comment">/* new vertices */</span>
<a name="l00366"></a>00366         sv1= <a class="code" href="../../da/dbc/screen__edit_8c.html#a334c9583d8ff69c63c649ff6e5d1fe25">screen_addvert</a>(sc, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>, split);
<a name="l00367"></a>00367         sv2= <a class="code" href="../../da/dbc/screen__edit_8c.html#a334c9583d8ff69c63c649ff6e5d1fe25">screen_addvert</a>(sc, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>, split);
<a name="l00368"></a>00368         
<a name="l00369"></a>00369         <span class="comment">/* new edges */</span>
<a name="l00370"></a>00370         <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(sc, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>, sv1);
<a name="l00371"></a>00371         <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(sc, sv1, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>);
<a name="l00372"></a>00372         <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(sc, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>, sv2);
<a name="l00373"></a>00373         <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(sc, sv2, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>);
<a name="l00374"></a>00374         <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(sc, sv1, sv2);
<a name="l00375"></a>00375         
<a name="l00376"></a>00376         <span class="comment">/* new areas: top */</span>
<a name="l00377"></a>00377         newa= <a class="code" href="../../da/dbc/screen__edit_8c.html#ac87d2958e465e48e0aece7cc6128c6dd">screen_addarea</a>(sc, sv1, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>, sv2, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab35681127748c4f7d1fd6f351f69b413">headertype</a>, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a124203529b9ea4c84ca8f8ae4efff3e3">spacetype</a>);
<a name="l00378"></a>00378         <a class="code" href="../../d1/d0d/area_8c.html#a36df79b09edb01547719640dd5796dcb">area_copy_data</a>(newa, sa, 0);
<a name="l00379"></a>00379         
<a name="l00380"></a>00380         <span class="comment">/* area below */</span>
<a name="l00381"></a>00381         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>= sv1;
<a name="l00382"></a>00382         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>= sv2;
<a name="l00383"></a>00383         
<a name="l00384"></a>00384     }
<a name="l00385"></a>00385     <span class="keywordflow">else</span> {
<a name="l00386"></a>00386         <span class="comment">/* new vertices */</span>
<a name="l00387"></a>00387         sv1= <a class="code" href="../../da/dbc/screen__edit_8c.html#a334c9583d8ff69c63c649ff6e5d1fe25">screen_addvert</a>(sc, split, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>);
<a name="l00388"></a>00388         sv2= <a class="code" href="../../da/dbc/screen__edit_8c.html#a334c9583d8ff69c63c649ff6e5d1fe25">screen_addvert</a>(sc, split, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>);
<a name="l00389"></a>00389         
<a name="l00390"></a>00390         <span class="comment">/* new edges */</span>
<a name="l00391"></a>00391         <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(sc, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>, sv1);
<a name="l00392"></a>00392         <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(sc, sv1, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>);
<a name="l00393"></a>00393         <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(sc, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>, sv2);
<a name="l00394"></a>00394         <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(sc, sv2, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>);
<a name="l00395"></a>00395         <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(sc, sv1, sv2);
<a name="l00396"></a>00396         
<a name="l00397"></a>00397         <span class="comment">/* new areas: left */</span>
<a name="l00398"></a>00398         newa= <a class="code" href="../../da/dbc/screen__edit_8c.html#ac87d2958e465e48e0aece7cc6128c6dd">screen_addarea</a>(sc, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>, sv2, sv1, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab35681127748c4f7d1fd6f351f69b413">headertype</a>, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a124203529b9ea4c84ca8f8ae4efff3e3">spacetype</a>);
<a name="l00399"></a>00399         <a class="code" href="../../d1/d0d/area_8c.html#a36df79b09edb01547719640dd5796dcb">area_copy_data</a>(newa, sa, 0);
<a name="l00400"></a>00400         
<a name="l00401"></a>00401         <span class="comment">/* area right */</span>
<a name="l00402"></a>00402         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>= sv1;
<a name="l00403"></a>00403         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>= sv2;
<a name="l00404"></a>00404     }
<a name="l00405"></a>00405     
<a name="l00406"></a>00406     <span class="comment">/* remove double vertices en edges */</span>
<a name="l00407"></a>00407     <span class="keywordflow">if</span> (merge)
<a name="l00408"></a>00408         <a class="code" href="../../da/dbc/screen__edit_8c.html#a5833bc9adacacd496ee1ce122eeb3802">removedouble_scrverts</a>(sc);
<a name="l00409"></a>00409     <a class="code" href="../../da/dbc/screen__edit_8c.html#a69ed104f9640180b1041bf20343a276c">removedouble_scredges</a>(sc);
<a name="l00410"></a>00410     <a class="code" href="../../da/dbc/screen__edit_8c.html#a4293968842b469ffb441259ed141f43a">removenotused_scredges</a>(sc);
<a name="l00411"></a>00411     
<a name="l00412"></a>00412     <span class="keywordflow">return</span> newa;
<a name="l00413"></a>00413 }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415 <span class="comment">/* empty screen, with 1 dummy area without spacedata */</span>
<a name="l00416"></a>00416 <span class="comment">/* uses window size */</span>
<a name="l00417"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a08d8bf46fb8b7519a3b06d95389ccd7c">00417</a> <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *<a class="code" href="../../d1/d12/ED__screen_8h.html#a9379b3ffb23e6992684baeba61ab2e76">ED_screen_add</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l00418"></a>00418 {
<a name="l00419"></a>00419     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l00420"></a>00420     <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *sv1, *sv2, *sv3, *sv4;
<a name="l00421"></a>00421     
<a name="l00422"></a>00422     sc= <a class="code" href="../../d8/db1/BKE__library_8h.html#a0856c5e10e28cbe0b45eb00363bf8fb5">alloc_libblock</a>(&amp;<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;screen, <a class="code" href="../../d3/dfb/DNA__ID_8h.html#ad177ecff9697780942b6ff5576c153e9">ID_SCR</a>, name);
<a name="l00423"></a>00423     sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>= scene;
<a name="l00424"></a>00424     sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac46694a5caf4c4eaefea6cf9b8d77f81">do_refresh</a>= 1;
<a name="l00425"></a>00425     sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#afe1a5457dd4e28f0ead11527da733c5d">redraws_flag</a>= <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a51e924d3814926d33e77fd7d911c8f3f">TIME_ALL_3D_WIN</a>|<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a6ef6dfba4f1fd8a63ff156505056e953">TIME_ALL_ANIM_WIN</a>;
<a name="l00426"></a>00426     sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a022929944b7229e3652332ef1fcf30ab">winid</a>= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a479ce2e14de90b31094c8415d0427f06">winid</a>;
<a name="l00427"></a>00427     
<a name="l00428"></a>00428     sv1= <a class="code" href="../../da/dbc/screen__edit_8c.html#a334c9583d8ff69c63c649ff6e5d1fe25">screen_addvert</a>(sc, 0, 0);
<a name="l00429"></a>00429     sv2= <a class="code" href="../../da/dbc/screen__edit_8c.html#a334c9583d8ff69c63c649ff6e5d1fe25">screen_addvert</a>(sc, 0, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a>-1);
<a name="l00430"></a>00430     sv3= <a class="code" href="../../da/dbc/screen__edit_8c.html#a334c9583d8ff69c63c649ff6e5d1fe25">screen_addvert</a>(sc, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a>-1, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a>-1);
<a name="l00431"></a>00431     sv4= <a class="code" href="../../da/dbc/screen__edit_8c.html#a334c9583d8ff69c63c649ff6e5d1fe25">screen_addvert</a>(sc, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a>-1, 0);
<a name="l00432"></a>00432     
<a name="l00433"></a>00433     <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(sc, sv1, sv2);
<a name="l00434"></a>00434     <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(sc, sv2, sv3);
<a name="l00435"></a>00435     <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(sc, sv3, sv4);
<a name="l00436"></a>00436     <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(sc, sv4, sv1);
<a name="l00437"></a>00437     
<a name="l00438"></a>00438     <span class="comment">/* dummy type, no spacedata */</span>
<a name="l00439"></a>00439     <a class="code" href="../../da/dbc/screen__edit_8c.html#ac87d2958e465e48e0aece7cc6128c6dd">screen_addarea</a>(sc, sv1, sv2, sv3, sv4, <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a229820c70c6ac394347de2e96109f194">HEADERDOWN</a>, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caa8e058bca40351efac8630cc6277e870">SPACE_EMPTY</a>);
<a name="l00440"></a>00440         
<a name="l00441"></a>00441     <span class="keywordflow">return</span> sc;
<a name="l00442"></a>00442 }
<a name="l00443"></a>00443 
<a name="l00444"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a8237ff8cd759d275a82f880dda193700">00444</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#a8237ff8cd759d275a82f880dda193700">screen_copy</a>(<a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *to, <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *from)
<a name="l00445"></a>00445 {
<a name="l00446"></a>00446     <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *s1, *s2;
<a name="l00447"></a>00447     <a class="code" href="../../dd/d31/structScrEdge.html">ScrEdge</a> *se;
<a name="l00448"></a>00448     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa, *saf;
<a name="l00449"></a>00449     
<a name="l00450"></a>00450     <span class="comment">/* free contents of &#39;to&#39;, is from blenkernel screen.c */</span>
<a name="l00451"></a>00451     <a class="code" href="../../d7/da3/BKE__screen_8h.html#ab06501c5f61a0ef393a455f251466e84">free_screen</a>(to);
<a name="l00452"></a>00452     
<a name="l00453"></a>00453     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#abc6ab715e5696ec3bb40014fc55182c6">BLI_duplicatelist</a>(&amp;to-&gt;<a class="code" href="../../de/de7/structbScreen.html#a7b16bb3f5dea1f6159af5be6ea599474">vertbase</a>, &amp;from-&gt;<a class="code" href="../../de/de7/structbScreen.html#a7b16bb3f5dea1f6159af5be6ea599474">vertbase</a>);
<a name="l00454"></a>00454     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#abc6ab715e5696ec3bb40014fc55182c6">BLI_duplicatelist</a>(&amp;to-&gt;<a class="code" href="../../de/de7/structbScreen.html#a15558c58cb9e3d4544f6ab5d9c031a9e">edgebase</a>, &amp;from-&gt;<a class="code" href="../../de/de7/structbScreen.html#a15558c58cb9e3d4544f6ab5d9c031a9e">edgebase</a>);
<a name="l00455"></a>00455     <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#abc6ab715e5696ec3bb40014fc55182c6">BLI_duplicatelist</a>(&amp;to-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>, &amp;from-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>);
<a name="l00456"></a>00456     to-&gt;<a class="code" href="../../de/de7/structbScreen.html#a5aed112496143ef5c69ddb1f9a8d5efd">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= to-&gt;<a class="code" href="../../de/de7/structbScreen.html#a5aed112496143ef5c69ddb1f9a8d5efd">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00457"></a>00457     
<a name="l00458"></a>00458     s2= to-&gt;<a class="code" href="../../de/de7/structbScreen.html#a7b16bb3f5dea1f6159af5be6ea599474">vertbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00459"></a>00459     <span class="keywordflow">for</span> (s1= from-&gt;<a class="code" href="../../de/de7/structbScreen.html#a7b16bb3f5dea1f6159af5be6ea599474">vertbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; s1; s1= s1-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a5926b403c5e00af979b2825ee76353eb">next</a>, s2= s2-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a5926b403c5e00af979b2825ee76353eb">next</a>) {
<a name="l00460"></a>00460         s1-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>= s2;
<a name="l00461"></a>00461     }
<a name="l00462"></a>00462     
<a name="l00463"></a>00463     <span class="keywordflow">for</span> (se= to-&gt;<a class="code" href="../../de/de7/structbScreen.html#a15558c58cb9e3d4544f6ab5d9c031a9e">edgebase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; se; se= se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a7e0011f64d0b13a5234a7d4a2c1f1948">next</a>) {
<a name="l00464"></a>00464         se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>= se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>;
<a name="l00465"></a>00465         se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>= se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>;
<a name="l00466"></a>00466         <a class="code" href="../../da/dbc/screen__edit_8c.html#a098c5dbae55f055cb9db2999558f967f">sortscrvert</a>(&amp;(se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>), &amp;(se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>));
<a name="l00467"></a>00467     }
<a name="l00468"></a>00468     
<a name="l00469"></a>00469     saf= from-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00470"></a>00470     <span class="keywordflow">for</span> (sa= to-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>, saf= saf-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l00471"></a>00471         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>;
<a name="l00472"></a>00472         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>;
<a name="l00473"></a>00473         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>;
<a name="l00474"></a>00474         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>;
<a name="l00475"></a>00475         
<a name="l00476"></a>00476         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00477"></a>00477         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00478"></a>00478         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a2abe64269b37637b8c7e75ac81ba9e4e">actionzones</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a2abe64269b37637b8c7e75ac81ba9e4e">actionzones</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00479"></a>00479         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a01c01609c538278ac956593f749365e3">handlers</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a01c01609c538278ac956593f749365e3">handlers</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00480"></a>00480         
<a name="l00481"></a>00481         <a class="code" href="../../d1/d0d/area_8c.html#a36df79b09edb01547719640dd5796dcb">area_copy_data</a>(sa, saf, 0);
<a name="l00482"></a>00482     }
<a name="l00483"></a>00483     
<a name="l00484"></a>00484     <span class="comment">/* put at zero (needed?) */</span>
<a name="l00485"></a>00485     <span class="keywordflow">for</span> (s1= from-&gt;<a class="code" href="../../de/de7/structbScreen.html#a7b16bb3f5dea1f6159af5be6ea599474">vertbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; s1; s1= s1-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a5926b403c5e00af979b2825ee76353eb">next</a>)
<a name="l00486"></a>00486         s1-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a95fae3a266b8987d524cb1b058d75b79">newv</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00487"></a>00487 
<a name="l00488"></a>00488 }
<a name="l00489"></a>00489 
<a name="l00490"></a>00490 
<a name="l00491"></a>00491 <span class="comment">/* with sa as center, sb is located at: 0=W, 1=N, 2=E, 3=S */</span>
<a name="l00492"></a>00492 <span class="comment">/* -1 = not valid check */</span>
<a name="l00493"></a>00493 <span class="comment">/* used with join operator */</span>
<a name="l00494"></a><a class="code" href="../../d7/de3/screen__intern_8h.html#a2e6e5e036f3379ab09724b8fabd7f12a">00494</a> <span class="keywordtype">int</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#a2e6e5e036f3379ab09724b8fabd7f12a">area_getorientation</a>(<a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa, <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sb)
<a name="l00495"></a>00495 {
<a name="l00496"></a>00496     <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *sav1, *sav2, *sav3, *sav4;
<a name="l00497"></a>00497     <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *sbv1, *sbv2, *sbv3, *sbv4;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499     <span class="keywordflow">if</span> (sa==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || sb==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> -1;
<a name="l00500"></a>00500 
<a name="l00501"></a>00501     sav1= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>;
<a name="l00502"></a>00502     sav2= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>;
<a name="l00503"></a>00503     sav3= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>;
<a name="l00504"></a>00504     sav4= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>;
<a name="l00505"></a>00505     sbv1= sb-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>;
<a name="l00506"></a>00506     sbv2= sb-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>;
<a name="l00507"></a>00507     sbv3= sb-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>;
<a name="l00508"></a>00508     sbv4= sb-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>;
<a name="l00509"></a>00509     
<a name="l00510"></a>00510     <span class="keywordflow">if</span> (sav1==sbv4 &amp;&amp; sav2==sbv3) { <span class="comment">/* sa to right of sb = W */</span>
<a name="l00511"></a>00511         <span class="keywordflow">return</span> 0;
<a name="l00512"></a>00512     }
<a name="l00513"></a>00513     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sav2==sbv1 &amp;&amp; sav3==sbv4) { <span class="comment">/* sa to bottom of sb = N */</span>
<a name="l00514"></a>00514         <span class="keywordflow">return</span> 1;
<a name="l00515"></a>00515     }
<a name="l00516"></a>00516     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sav3==sbv2 &amp;&amp; sav4==sbv1) { <span class="comment">/* sa to left of sb = E */</span>
<a name="l00517"></a>00517         <span class="keywordflow">return</span> 2;
<a name="l00518"></a>00518     }
<a name="l00519"></a>00519     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sav1==sbv2 &amp;&amp; sav4==sbv3) { <span class="comment">/* sa on top of sb = S*/</span>
<a name="l00520"></a>00520         <span class="keywordflow">return</span> 3;
<a name="l00521"></a>00521     }
<a name="l00522"></a>00522     
<a name="l00523"></a>00523     <span class="keywordflow">return</span> -1;
<a name="l00524"></a>00524 }
<a name="l00525"></a>00525 
<a name="l00526"></a>00526 <span class="comment">/* Helper function to join 2 areas, it has a return value, 0=failed 1=success</span>
<a name="l00527"></a>00527 <span class="comment"> *  used by the split, join operators</span>
<a name="l00528"></a>00528 <span class="comment"> */</span>
<a name="l00529"></a><a class="code" href="../../d7/de3/screen__intern_8h.html#a73586812301934ae7613e653c116b065">00529</a> <span class="keywordtype">int</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#a73586812301934ae7613e653c116b065">screen_area_join</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../de/de7/structbScreen.html">bScreen</a>* scr, <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa1, <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa2) 
<a name="l00530"></a>00530 {
<a name="l00531"></a>00531     <span class="keywordtype">int</span> dir;
<a name="l00532"></a>00532     
<a name="l00533"></a>00533     dir = <a class="code" href="../../da/dbc/screen__edit_8c.html#a2e6e5e036f3379ab09724b8fabd7f12a">area_getorientation</a>(sa1, sa2);
<a name="l00534"></a>00534     <span class="comment">/*printf(&quot;dir is : %i\n&quot;, dir);*/</span>
<a name="l00535"></a>00535     
<a name="l00536"></a>00536     <span class="keywordflow">if</span> (dir &lt; 0) {
<a name="l00537"></a>00537         <span class="keywordflow">if</span> (sa1 ) sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a95330fccbc8eb82dc12aefadd1afd8db">flag</a> &amp;= ~<a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a3f1eabd0fa9d89c5a6dac55bc9acb487">AREA_FLAG_DRAWJOINFROM</a>;
<a name="l00538"></a>00538         <span class="keywordflow">if</span> (sa2 ) sa2-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a95330fccbc8eb82dc12aefadd1afd8db">flag</a> &amp;= ~<a class="code" href="../../d4/da4/DNA__screen__types_8h.html#ab96f18610053bcc66118620d92ad7ca9">AREA_FLAG_DRAWJOINTO</a>;
<a name="l00539"></a>00539         <span class="keywordflow">return</span> 0;
<a name="l00540"></a>00540     }
<a name="l00541"></a>00541     
<a name="l00542"></a>00542     <span class="keywordflow">if</span> (dir == 0) {
<a name="l00543"></a>00543         sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>= sa2-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>;
<a name="l00544"></a>00544         sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>= sa2-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>;
<a name="l00545"></a>00545         <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(scr, sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>, sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>);
<a name="l00546"></a>00546         <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(scr, sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>, sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>);
<a name="l00547"></a>00547     }
<a name="l00548"></a>00548     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dir == 1) {
<a name="l00549"></a>00549         sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>= sa2-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>;
<a name="l00550"></a>00550         sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>= sa2-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>;
<a name="l00551"></a>00551         <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(scr, sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>, sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>);
<a name="l00552"></a>00552         <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(scr, sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>, sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>);
<a name="l00553"></a>00553     }
<a name="l00554"></a>00554     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dir == 2) {
<a name="l00555"></a>00555         sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>= sa2-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>;
<a name="l00556"></a>00556         sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>= sa2-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>;
<a name="l00557"></a>00557         <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(scr, sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>, sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>);
<a name="l00558"></a>00558         <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(scr, sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>, sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>);
<a name="l00559"></a>00559     }
<a name="l00560"></a>00560     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dir == 3) {
<a name="l00561"></a>00561         sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>= sa2-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>;
<a name="l00562"></a>00562         sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>= sa2-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>;
<a name="l00563"></a>00563         <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(scr, sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>, sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>);
<a name="l00564"></a>00564         <a class="code" href="../../da/dbc/screen__edit_8c.html#a6a776310c1ee8b0c0eea36fdda1d8064">screen_addedge</a>(scr, sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>, sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>);
<a name="l00565"></a>00565     }
<a name="l00566"></a>00566     
<a name="l00567"></a>00567     <a class="code" href="../../da/dbc/screen__edit_8c.html#afaa799038bf295e2c50af03703041863">screen_delarea</a>(C, scr, sa2);
<a name="l00568"></a>00568     <a class="code" href="../../da/dbc/screen__edit_8c.html#a5833bc9adacacd496ee1ce122eeb3802">removedouble_scrverts</a>(scr);
<a name="l00569"></a>00569     sa1-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a95330fccbc8eb82dc12aefadd1afd8db">flag</a> &amp;= ~<a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a3f1eabd0fa9d89c5a6dac55bc9acb487">AREA_FLAG_DRAWJOINFROM</a>;
<a name="l00570"></a>00570     
<a name="l00571"></a>00571     <span class="keywordflow">return</span> 1;
<a name="l00572"></a>00572 }
<a name="l00573"></a>00573 
<a name="l00574"></a><a class="code" href="../../d7/de3/screen__intern_8h.html#a25b52c0c71667d00a9334225af230c51">00574</a> <span class="keywordtype">void</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#a25b52c0c71667d00a9334225af230c51">select_connected_scredge</a>(<a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc, <a class="code" href="../../dd/d31/structScrEdge.html">ScrEdge</a> *edge)
<a name="l00575"></a>00575 {
<a name="l00576"></a>00576     <a class="code" href="../../dd/d31/structScrEdge.html">ScrEdge</a> *se;
<a name="l00577"></a>00577     <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *sv;
<a name="l00578"></a>00578     <span class="keywordtype">int</span> oneselected;
<a name="l00579"></a>00579     <span class="keywordtype">char</span> dir;
<a name="l00580"></a>00580     
<a name="l00581"></a>00581     <span class="comment">/* select connected, only in the right direction */</span>
<a name="l00582"></a>00582     <span class="comment">/* &#39;dir&#39; is the direction of EDGE */</span>
<a name="l00583"></a>00583     
<a name="l00584"></a>00584     <span class="keywordflow">if</span> (edge-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>==edge-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>) dir= <span class="charliteral">&#39;v&#39;</span>;
<a name="l00585"></a>00585     <span class="keywordflow">else</span> dir= <span class="charliteral">&#39;h&#39;</span>;
<a name="l00586"></a>00586     
<a name="l00587"></a>00587     sv= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a7b16bb3f5dea1f6159af5be6ea599474">vertbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00588"></a>00588     <span class="keywordflow">while</span> (sv) {
<a name="l00589"></a>00589         sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a6c44cfb866bff3ce87a9342db96dd691">flag</a> = 0;
<a name="l00590"></a>00590         sv= sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a5926b403c5e00af979b2825ee76353eb">next</a>;
<a name="l00591"></a>00591     }
<a name="l00592"></a>00592     
<a name="l00593"></a>00593     edge-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a6c44cfb866bff3ce87a9342db96dd691">flag</a>= 1;
<a name="l00594"></a>00594     edge-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a6c44cfb866bff3ce87a9342db96dd691">flag</a>= 1;
<a name="l00595"></a>00595     
<a name="l00596"></a>00596     oneselected= 1;
<a name="l00597"></a>00597     <span class="keywordflow">while</span> (oneselected) {
<a name="l00598"></a>00598         se= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a15558c58cb9e3d4544f6ab5d9c031a9e">edgebase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00599"></a>00599         oneselected= 0;
<a name="l00600"></a>00600         <span class="keywordflow">while</span> (se) {
<a name="l00601"></a>00601             <span class="keywordflow">if</span> (se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a6c44cfb866bff3ce87a9342db96dd691">flag</a> + se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a6c44cfb866bff3ce87a9342db96dd691">flag</a>==1) {
<a name="l00602"></a>00602                 <span class="keywordflow">if</span> (dir==<span class="charliteral">&#39;h&#39;</span>) <span class="keywordflow">if</span> (se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>==se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>) {
<a name="l00603"></a>00603                     se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a6c44cfb866bff3ce87a9342db96dd691">flag</a>= se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a6c44cfb866bff3ce87a9342db96dd691">flag</a>= 1;
<a name="l00604"></a>00604                     oneselected= 1;
<a name="l00605"></a>00605                 }
<a name="l00606"></a>00606                     <span class="keywordflow">if</span> (dir==<span class="charliteral">&#39;v&#39;</span>) <span class="keywordflow">if</span> (se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>==se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>) {
<a name="l00607"></a>00607                         se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a6c6a3d9a4ee7853b108d144ae1cb3180">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a6c44cfb866bff3ce87a9342db96dd691">flag</a>= se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a8f323750ba31785ea5c9d8633ae8060b">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a6c44cfb866bff3ce87a9342db96dd691">flag</a>= 1;
<a name="l00608"></a>00608                         oneselected= 1;
<a name="l00609"></a>00609                     }
<a name="l00610"></a>00610             }
<a name="l00611"></a>00611                 se= se-&gt;<a class="code" href="../../dd/d31/structScrEdge.html#a7e0011f64d0b13a5234a7d4a2c1f1948">next</a>;
<a name="l00612"></a>00612         }
<a name="l00613"></a>00613     }
<a name="l00614"></a>00614 }
<a name="l00615"></a>00615 
<a name="l00616"></a>00616 <span class="comment">/* test if screen vertices should be scaled */</span>
<a name="l00617"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a9147264cea794089ca1597794efb7c5d">00617</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#a9147264cea794089ca1597794efb7c5d">screen_test_scale</a>(<a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc, <span class="keywordtype">int</span> winsizex, <span class="keywordtype">int</span> winsizey)
<a name="l00618"></a>00618 {
<a name="l00619"></a>00619     <a class="code" href="../../d0/db3/structScrVert.html">ScrVert</a> *sv=<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00620"></a>00620     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l00621"></a>00621     <span class="keywordtype">int</span> sizex, sizey;
<a name="l00622"></a>00622     <span class="keywordtype">float</span> facx, facy, tempf, <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>[2], <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>[2];
<a name="l00623"></a>00623     
<a name="l00624"></a>00624     <span class="comment">/* calculate size */</span>
<a name="l00625"></a>00625     min[0]= min[1]= 10000.0f;
<a name="l00626"></a>00626     max[0]= max[1]= 0.0f;
<a name="l00627"></a>00627     
<a name="l00628"></a>00628     <span class="keywordflow">for</span> (sv= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a7b16bb3f5dea1f6159af5be6ea599474">vertbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sv; sv= sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a5926b403c5e00af979b2825ee76353eb">next</a>) {
<a name="l00629"></a>00629         min[0]= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(min[0], sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>);
<a name="l00630"></a>00630         min[1]= <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#af5febfb026bad0c08e7a9f7ab7c2b8f0">MIN2</a>(min[1], sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>);
<a name="l00631"></a>00631         max[0]= <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(max[0], sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>);
<a name="l00632"></a>00632         max[1]= <a class="code" href="../../d0/dbd/bmfont_8c.html#a57562d98bd289bc7ea77ba251915d8fb">MAX2</a>(max[1], sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>);
<a name="l00633"></a>00633     }
<a name="l00634"></a>00634     
<a name="l00635"></a>00635     <span class="comment">/* always make 0.0 left under */</span>
<a name="l00636"></a>00636     <span class="keywordflow">for</span> (sv= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a7b16bb3f5dea1f6159af5be6ea599474">vertbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sv; sv= sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a5926b403c5e00af979b2825ee76353eb">next</a>) {
<a name="l00637"></a>00637         sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a> -= min[0];
<a name="l00638"></a>00638         sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a> -= min[1];
<a name="l00639"></a>00639     }
<a name="l00640"></a>00640     
<a name="l00641"></a>00641     sizex= max[0]-min[0];
<a name="l00642"></a>00642     sizey= max[1]-min[1];
<a name="l00643"></a>00643     
<a name="l00644"></a>00644     <span class="keywordflow">if</span> (sizex!= winsizex || sizey!= winsizey) {
<a name="l00645"></a>00645         facx= winsizex;
<a name="l00646"></a>00646         facx/= (float)sizex;
<a name="l00647"></a>00647         facy= winsizey;
<a name="l00648"></a>00648         facy/= (float)sizey;
<a name="l00649"></a>00649         
<a name="l00650"></a>00650         <span class="comment">/* make sure it fits! */</span>
<a name="l00651"></a>00651         <span class="keywordflow">for</span> (sv= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a7b16bb3f5dea1f6159af5be6ea599474">vertbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sv; sv= sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a5926b403c5e00af979b2825ee76353eb">next</a>) {
<a name="l00652"></a>00652             <span class="comment">/* FIXME, this re-sizing logic is no good when re-sizing the window + redrawing [#24428]</span>
<a name="l00653"></a>00653 <span class="comment">             * need some way to store these as floats internally and re-apply from there. */</span>
<a name="l00654"></a>00654             tempf= ((float)sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>)*facx;
<a name="l00655"></a>00655             sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>= (short)(tempf+0.5f);
<a name="l00656"></a>00656             sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>+= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#af267f1a6298055ff8e414c5cb85208f8">AREAGRID</a>-1;
<a name="l00657"></a>00657             sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>-=  (sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a> % <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#af267f1a6298055ff8e414c5cb85208f8">AREAGRID</a>); 
<a name="l00658"></a>00658 
<a name="l00659"></a>00659             <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>, 0, winsizex);
<a name="l00660"></a>00660             
<a name="l00661"></a>00661             tempf= ((float)sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>)*facy;
<a name="l00662"></a>00662             sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>= (short)(tempf+0.5f);
<a name="l00663"></a>00663             sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>+= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#af267f1a6298055ff8e414c5cb85208f8">AREAGRID</a>-1;
<a name="l00664"></a>00664             sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>-=  (sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a> % <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#af267f1a6298055ff8e414c5cb85208f8">AREAGRID</a>); 
<a name="l00665"></a>00665 
<a name="l00666"></a>00666             <a class="code" href="../../dd/d46/IMAGE_8h.html#a7abc68f3eacc2822738f41c9f08feca6">CLAMP</a>(sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>, 0, winsizey);
<a name="l00667"></a>00667         }
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669     
<a name="l00670"></a>00670     <span class="comment">/* test for collapsed areas. This could happen in some blender version... */</span>
<a name="l00671"></a>00671     <span class="comment">/* ton: removed option now, it needs Context... */</span>
<a name="l00672"></a>00672     
<a name="l00673"></a>00673     <span class="comment">/* make each window at least ED_area_headersize() high */</span>
<a name="l00674"></a>00674     <span class="keywordflow">for</span> (sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l00675"></a>00675         <span class="keywordtype">int</span> headery= <a class="code" href="../../d1/d12/ED__screen_8h.html#a691baf7c6b3655f45442d77ad5b283c2">ED_area_headersize</a>()+1;
<a name="l00676"></a>00676         
<a name="l00677"></a>00677         <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>+headery &gt; sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>) {
<a name="l00678"></a>00678             <span class="comment">/* lower edge */</span>
<a name="l00679"></a>00679             <a class="code" href="../../dd/d31/structScrEdge.html">ScrEdge</a> *se= <a class="code" href="../../da/dbc/screen__edit_8c.html#af04be364808a61aef8ec5c37a4ac899f">screen_findedge</a>(sc, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>);
<a name="l00680"></a>00680             <span class="keywordflow">if</span> (se &amp;&amp; sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>!=sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a> ) {
<a name="l00681"></a>00681                 <span class="keywordtype">int</span> yval;
<a name="l00682"></a>00682                 
<a name="l00683"></a>00683                 <a class="code" href="../../da/dbc/screen__edit_8c.html#a25b52c0c71667d00a9334225af230c51">select_connected_scredge</a>(sc, se);
<a name="l00684"></a>00684                 
<a name="l00685"></a>00685                 <span class="comment">/* all selected vertices get the right offset */</span>
<a name="l00686"></a>00686                 yval= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>-headery;
<a name="l00687"></a>00687                 sv= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a7b16bb3f5dea1f6159af5be6ea599474">vertbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00688"></a>00688                 <span class="keywordflow">while</span> (sv) {
<a name="l00689"></a>00689                     <span class="comment">/* if is a collapsed area */</span>
<a name="l00690"></a>00690                     <span class="keywordflow">if</span> (sv!=sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a> &amp;&amp; sv!=sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>) {
<a name="l00691"></a>00691                         <span class="keywordflow">if</span> (sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a6c44cfb866bff3ce87a9342db96dd691">flag</a>) sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>= yval;
<a name="l00692"></a>00692                     }
<a name="l00693"></a>00693                     sv= sv-&gt;<a class="code" href="../../d0/db3/structScrVert.html#a5926b403c5e00af979b2825ee76353eb">next</a>;
<a name="l00694"></a>00694                 }
<a name="l00695"></a>00695             }
<a name="l00696"></a>00696         }
<a name="l00697"></a>00697     }
<a name="l00698"></a>00698     
<a name="l00699"></a>00699 }
<a name="l00700"></a>00700 
<a name="l00701"></a>00701 <span class="comment">/* *********************** DRAWING **************************************** */</span>
<a name="l00702"></a>00702 
<a name="l00703"></a>00703 
<a name="l00704"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a553621cccb6983967d30ad2c395481a3">00704</a> <span class="preprocessor">#define SCR_BACK 0.55</span>
<a name="l00705"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a5fed5330c0892c6c5780063e1ebb7d63">00705</a> <span class="preprocessor"></span><span class="preprocessor">#define SCR_ROUND 12</span>
<a name="l00706"></a>00706 <span class="preprocessor"></span>
<a name="l00707"></a>00707 <span class="comment">/* draw vertical shape visualizing future joining (left as well</span>
<a name="l00708"></a>00708 <span class="comment"> * right direction of future joining) */</span>
<a name="l00709"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a86b0d504fff3f5cb287be6dfaf5455e5">00709</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#a86b0d504fff3f5cb287be6dfaf5455e5">draw_horizontal_join_shape</a>(<a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa, <span class="keywordtype">char</span> dir)
<a name="l00710"></a>00710 {
<a name="l00711"></a>00711     <a class="code" href="../../d3/d68/structvec2f.html">vec2f</a> points[10];
<a name="l00712"></a>00712     <span class="keywordtype">short</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00713"></a>00713     <span class="keywordtype">float</span> w, h;
<a name="l00714"></a>00714     <span class="keywordtype">float</span> width = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a> - sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>;
<a name="l00715"></a>00715     <span class="keywordtype">float</span> height = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a> - sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>;
<a name="l00716"></a>00716 
<a name="l00717"></a>00717     <span class="keywordflow">if</span> (height&lt;width) {
<a name="l00718"></a>00718         h = height/8;
<a name="l00719"></a>00719         w = height/4;
<a name="l00720"></a>00720     }
<a name="l00721"></a>00721     <span class="keywordflow">else</span> {
<a name="l00722"></a>00722         h = width/8;
<a name="l00723"></a>00723         w = width/4;
<a name="l00724"></a>00724     }
<a name="l00725"></a>00725 
<a name="l00726"></a>00726     points[0].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>;
<a name="l00727"></a>00727     points[0].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a> + height/2;
<a name="l00728"></a>00728 
<a name="l00729"></a>00729     points[1].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>;
<a name="l00730"></a>00730     points[1].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>;
<a name="l00731"></a>00731 
<a name="l00732"></a>00732     points[2].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a> - w;
<a name="l00733"></a>00733     points[2].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>;
<a name="l00734"></a>00734 
<a name="l00735"></a>00735     points[3].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a> - w;
<a name="l00736"></a>00736     points[3].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a> + height/2 - 2*h;
<a name="l00737"></a>00737 
<a name="l00738"></a>00738     points[4].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a> - 2*w;
<a name="l00739"></a>00739     points[4].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a> + height/2;
<a name="l00740"></a>00740 
<a name="l00741"></a>00741     points[5].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a> - w;
<a name="l00742"></a>00742     points[5].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a> + height/2 + 2*h;
<a name="l00743"></a>00743 
<a name="l00744"></a>00744     points[6].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a> - w;
<a name="l00745"></a>00745     points[6].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>;
<a name="l00746"></a>00746 
<a name="l00747"></a>00747     points[7].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>;
<a name="l00748"></a>00748     points[7].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>;
<a name="l00749"></a>00749 
<a name="l00750"></a>00750     points[8].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>;
<a name="l00751"></a>00751     points[8].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a> + height/2 - h;
<a name="l00752"></a>00752 
<a name="l00753"></a>00753     points[9].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>;
<a name="l00754"></a>00754     points[9].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a> + height/2 + h;
<a name="l00755"></a>00755 
<a name="l00756"></a>00756     <span class="keywordflow">if</span> (dir==<span class="charliteral">&#39;l&#39;</span>) {
<a name="l00757"></a>00757         <span class="comment">/* when direction is left, then we flip direction of arrow */</span>
<a name="l00758"></a>00758         <span class="keywordtype">float</span> cx = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a> + width;
<a name="l00759"></a>00759         <span class="keywordflow">for</span> (i=0;i&lt;10;i++) {
<a name="l00760"></a>00760             points[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> -= cx;
<a name="l00761"></a>00761             points[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = -points[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a>;
<a name="l00762"></a>00762             points[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> += sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>;
<a name="l00763"></a>00763         }
<a name="l00764"></a>00764     }
<a name="l00765"></a>00765 
<a name="l00766"></a>00766     glBegin(GL_POLYGON);
<a name="l00767"></a>00767     <span class="keywordflow">for</span> (i=0;i&lt;5;i++)
<a name="l00768"></a>00768         glVertex2f(points[i].x, points[i].y);
<a name="l00769"></a>00769     glEnd();
<a name="l00770"></a>00770     glBegin(GL_POLYGON);
<a name="l00771"></a>00771     <span class="keywordflow">for</span> (i=4;i&lt;8;i++)
<a name="l00772"></a>00772         glVertex2f(points[i].x, points[i].y);
<a name="l00773"></a>00773     glVertex2f(points[0].x, points[0].y);
<a name="l00774"></a>00774     glEnd();
<a name="l00775"></a>00775 
<a name="l00776"></a>00776     glRectf(points[2].x, points[2].y, points[8].x, points[8].y);
<a name="l00777"></a>00777     glRectf(points[6].x, points[6].y, points[9].x, points[9].y);
<a name="l00778"></a>00778 }
<a name="l00779"></a>00779 
<a name="l00780"></a>00780 <span class="comment">/* draw vertical shape visualizing future joining (up/down direction) */</span>
<a name="l00781"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a1b0bcc46699a8a4fb6fefa33a0ce9f91">00781</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#a1b0bcc46699a8a4fb6fefa33a0ce9f91">draw_vertical_join_shape</a>(<a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa, <span class="keywordtype">char</span> dir)
<a name="l00782"></a>00782 {
<a name="l00783"></a>00783     <a class="code" href="../../d3/d68/structvec2f.html">vec2f</a> points[10];
<a name="l00784"></a>00784     <span class="keywordtype">short</span> <a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>;
<a name="l00785"></a>00785     <span class="keywordtype">float</span> w, h;
<a name="l00786"></a>00786     <span class="keywordtype">float</span> width = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a> - sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>;
<a name="l00787"></a>00787     <span class="keywordtype">float</span> height = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a> - sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>;
<a name="l00788"></a>00788 
<a name="l00789"></a>00789     <span class="keywordflow">if</span> (height&lt;width) {
<a name="l00790"></a>00790         h = height/4;
<a name="l00791"></a>00791         w = height/8;
<a name="l00792"></a>00792     }
<a name="l00793"></a>00793     <span class="keywordflow">else</span> {
<a name="l00794"></a>00794         h = width/4;
<a name="l00795"></a>00795         w = width/8;
<a name="l00796"></a>00796     }
<a name="l00797"></a>00797 
<a name="l00798"></a>00798     points[0].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a> + width/2;
<a name="l00799"></a>00799     points[0].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>;
<a name="l00800"></a>00800 
<a name="l00801"></a>00801     points[1].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>;
<a name="l00802"></a>00802     points[1].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a06f4362dc9cfb0ce0c1a67f9d5c262c1">v2</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>;
<a name="l00803"></a>00803 
<a name="l00804"></a>00804     points[2].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>;
<a name="l00805"></a>00805     points[2].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a> + h;
<a name="l00806"></a>00806 
<a name="l00807"></a>00807     points[3].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a> + width/2 - 2*w;
<a name="l00808"></a>00808     points[3].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a> + h;
<a name="l00809"></a>00809 
<a name="l00810"></a>00810     points[4].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a> + width/2;
<a name="l00811"></a>00811     points[4].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a> + 2*h;
<a name="l00812"></a>00812 
<a name="l00813"></a>00813     points[5].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a> + width/2 + 2*w;
<a name="l00814"></a>00814     points[5].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a> + h;
<a name="l00815"></a>00815 
<a name="l00816"></a>00816     points[6].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>;
<a name="l00817"></a>00817     points[6].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ac44f8d5f533f74f1612ab99953596d8a">v4</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a> + h;
<a name="l00818"></a>00818     
<a name="l00819"></a>00819     points[7].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>;
<a name="l00820"></a>00820     points[7].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>;
<a name="l00821"></a>00821 
<a name="l00822"></a>00822     points[8].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a> + width/2 - w;
<a name="l00823"></a>00823     points[8].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>;
<a name="l00824"></a>00824 
<a name="l00825"></a>00825     points[9].<a class="code" href="../../d3/d68/structvec2f.html#a6b17e4442fdc15a98727c8002a9a1bac">x</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a> + width/2 + w;
<a name="l00826"></a>00826     points[9].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>;
<a name="l00827"></a>00827 
<a name="l00828"></a>00828     <span class="keywordflow">if</span> (dir==<span class="charliteral">&#39;u&#39;</span>) {
<a name="l00829"></a>00829         <span class="comment">/* when direction is up, then we flip direction of arrow */</span>
<a name="l00830"></a>00830         <span class="keywordtype">float</span> cy = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a> + height;
<a name="l00831"></a>00831         <span class="keywordflow">for</span> (i=0;i&lt;10;i++) {
<a name="l00832"></a>00832             points[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> -= cy;
<a name="l00833"></a>00833             points[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> = -points[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a>;
<a name="l00834"></a>00834             points[<a class="code" href="../../dd/db6/paraloopend_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="../../d3/d68/structvec2f.html#ab10800546a1f4186877e2fe9a7488e74">y</a> += sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>;
<a name="l00835"></a>00835         }
<a name="l00836"></a>00836     }
<a name="l00837"></a>00837 
<a name="l00838"></a>00838     glBegin(GL_POLYGON);
<a name="l00839"></a>00839     <span class="keywordflow">for</span> (i=0;i&lt;5;i++)
<a name="l00840"></a>00840         glVertex2f(points[i].x, points[i].y);
<a name="l00841"></a>00841     glEnd();
<a name="l00842"></a>00842     glBegin(GL_POLYGON);
<a name="l00843"></a>00843     <span class="keywordflow">for</span> (i=4;i&lt;8;i++)
<a name="l00844"></a>00844         glVertex2f(points[i].x, points[i].y);
<a name="l00845"></a>00845     glVertex2f(points[0].x, points[0].y);
<a name="l00846"></a>00846     glEnd();
<a name="l00847"></a>00847 
<a name="l00848"></a>00848     glRectf(points[2].x, points[2].y, points[8].x, points[8].y);
<a name="l00849"></a>00849     glRectf(points[6].x, points[6].y, points[9].x, points[9].y);
<a name="l00850"></a>00850 }
<a name="l00851"></a>00851 
<a name="l00852"></a>00852 <span class="comment">/* draw join shape due to direction of joining */</span>
<a name="l00853"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#afd61b8afedb77a7afa43b52d51a73d77">00853</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#afd61b8afedb77a7afa43b52d51a73d77">draw_join_shape</a>(<a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa, <span class="keywordtype">char</span> dir)
<a name="l00854"></a>00854 {
<a name="l00855"></a>00855     <span class="keywordflow">if</span> (dir==<span class="charliteral">&#39;u&#39;</span> || dir==<span class="charliteral">&#39;d&#39;</span>)
<a name="l00856"></a>00856         <a class="code" href="../../da/dbc/screen__edit_8c.html#a1b0bcc46699a8a4fb6fefa33a0ce9f91">draw_vertical_join_shape</a>(sa, dir);
<a name="l00857"></a>00857     <span class="keywordflow">else</span>
<a name="l00858"></a>00858         <a class="code" href="../../da/dbc/screen__edit_8c.html#a86b0d504fff3f5cb287be6dfaf5455e5">draw_horizontal_join_shape</a>(sa, dir);
<a name="l00859"></a>00859 }
<a name="l00860"></a>00860 
<a name="l00861"></a>00861 <span class="comment">/* draw screen area darker with arrow (visualisation of future joining) */</span>
<a name="l00862"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a503536d3208e2f99e48815a62c31e41d">00862</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#a503536d3208e2f99e48815a62c31e41d">scrarea_draw_shape_dark</a>(<a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa, <span class="keywordtype">char</span> dir)
<a name="l00863"></a>00863 {
<a name="l00864"></a>00864     glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
<a name="l00865"></a>00865     glEnable(GL_BLEND);
<a name="l00866"></a>00866     glColor4ub(0, 0, 0, 50);
<a name="l00867"></a>00867     <a class="code" href="../../da/dbc/screen__edit_8c.html#afd61b8afedb77a7afa43b52d51a73d77">draw_join_shape</a>(sa, dir);
<a name="l00868"></a>00868     glDisable(GL_BLEND);
<a name="l00869"></a>00869 }
<a name="l00870"></a>00870 
<a name="l00871"></a>00871 <span class="comment">/* draw screen area ligher with arrow shape (&quot;eraser&quot; of previous dark shape) */</span>
<a name="l00872"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a8c58d79c19b9daa7b5c32439473edd15">00872</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#a8c58d79c19b9daa7b5c32439473edd15">scrarea_draw_shape_light</a>(<a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa, <span class="keywordtype">char</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(dir))
<a name="l00873"></a>00873 {
<a name="l00874"></a>00874     glBlendFunc(GL_DST_COLOR, GL_SRC_ALPHA);
<a name="l00875"></a>00875     glEnable(GL_BLEND);
<a name="l00876"></a>00876     <span class="comment">/* value 181 was hardly computed: 181~105 */</span>
<a name="l00877"></a>00877     glColor4ub(255, 255, 255, 50);      
<a name="l00878"></a>00878     <span class="comment">/* draw_join_shape(sa, dir); */</span>
<a name="l00879"></a>00879     glRecti(sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>, sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>);
<a name="l00880"></a>00880     glDisable(GL_BLEND);
<a name="l00881"></a>00881 }
<a name="l00882"></a>00882 
<a name="l00883"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a43191baf3a7b130ff48e8679d582a707">00883</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#a43191baf3a7b130ff48e8679d582a707">drawscredge_area_draw</a>(<span class="keywordtype">int</span> sizex, <span class="keywordtype">int</span> sizey, <span class="keywordtype">short</span> x1, <span class="keywordtype">short</span> y1, <span class="keywordtype">short</span> x2, <span class="keywordtype">short</span> y2, <span class="keywordtype">short</span> a) 
<a name="l00884"></a>00884 {
<a name="l00885"></a>00885     <span class="comment">/* right border area */</span>
<a name="l00886"></a>00886     <span class="keywordflow">if</span> (x2&lt;sizex-1)
<a name="l00887"></a>00887         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#af04b403c3fb94451facdc3a4fca476fc">sdrawline</a>(x2+a, y1, x2+a, y2);
<a name="l00888"></a>00888     
<a name="l00889"></a>00889     <span class="comment">/* left border area */</span>
<a name="l00890"></a>00890     <span class="keywordflow">if</span> (x1&gt;0)  <span class="comment">/* otherwise it draws the emboss of window over */</span>
<a name="l00891"></a>00891         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#af04b403c3fb94451facdc3a4fca476fc">sdrawline</a>(x1+a, y1, x1+a, y2);
<a name="l00892"></a>00892     
<a name="l00893"></a>00893     <span class="comment">/* top border area */</span>
<a name="l00894"></a>00894     <span class="keywordflow">if</span> (y2&lt;sizey-1)
<a name="l00895"></a>00895         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#af04b403c3fb94451facdc3a4fca476fc">sdrawline</a>(x1, y2+a, x2, y2+a);
<a name="l00896"></a>00896     
<a name="l00897"></a>00897     <span class="comment">/* bottom border area */</span>
<a name="l00898"></a>00898     <span class="keywordflow">if</span> (y1&gt;0)
<a name="l00899"></a>00899         <a class="code" href="../../d9/d71/BIF__glutil_8h.html#af04b403c3fb94451facdc3a4fca476fc">sdrawline</a>(x1, y1+a, x2, y1+a);
<a name="l00900"></a>00900     
<a name="l00901"></a>00901 }
<a name="l00902"></a>00902 
<a name="l00904"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a2608648a97626a9dc469fba66d7536ed">00904</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#a2608648a97626a9dc469fba66d7536ed">drawscredge_area</a>(<a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa, <span class="keywordtype">int</span> sizex, <span class="keywordtype">int</span> sizey, <span class="keywordtype">int</span> center)
<a name="l00905"></a>00905 {
<a name="l00906"></a>00906     <span class="keywordtype">short</span> x1= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>;
<a name="l00907"></a>00907     <span class="keywordtype">short</span> y1= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a7effddf3fdd03c3528a5fa1386eb50e3">v1</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>;
<a name="l00908"></a>00908     <span class="keywordtype">short</span> x2= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a369c28c4e23e9098f547465d1d12f38b">x</a>;
<a name="l00909"></a>00909     <span class="keywordtype">short</span> y2= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3c3020f6595c3466da40728d750554d2">v3</a>-&gt;<a class="code" href="../../d0/db3/structScrVert.html#afaa6127eeea899ba620074a3b9cb39cc">vec</a>.<a class="code" href="../../d4/d60/structvec2s.html#a1a1b582dc847b158b77979f59849aaec">y</a>;
<a name="l00910"></a>00910     <span class="keywordtype">short</span> a, rt;
<a name="l00911"></a>00911     
<a name="l00912"></a>00912     rt= 0; <span class="comment">// CLAMPIS(G.rt, 0, 16);</span>
<a name="l00913"></a>00913     
<a name="l00914"></a>00914     <span class="keywordflow">if</span> (center==0) {
<a name="l00915"></a>00915         <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(0x505050);
<a name="l00916"></a>00916         <span class="keywordflow">for</span> (a=-rt; a&lt;=rt; a++)
<a name="l00917"></a>00917             <span class="keywordflow">if</span> (a!=0)
<a name="l00918"></a>00918                 <a class="code" href="../../da/dbc/screen__edit_8c.html#a43191baf3a7b130ff48e8679d582a707">drawscredge_area_draw</a>(sizex, sizey, x1, y1, x2, y2, a);
<a name="l00919"></a>00919     }
<a name="l00920"></a>00920     <span class="keywordflow">else</span> {
<a name="l00921"></a>00921         <a class="code" href="../../dd/d44/BIF__gl_8h.html#a39d48f66c1c3fb25c3fcc6c069bfadf7">cpack</a>(0x0);
<a name="l00922"></a>00922         <a class="code" href="../../da/dbc/screen__edit_8c.html#a43191baf3a7b130ff48e8679d582a707">drawscredge_area_draw</a>(sizex, sizey, x1, y1, x2, y2, 0);
<a name="l00923"></a>00923     }
<a name="l00924"></a>00924 }
<a name="l00925"></a>00925 
<a name="l00926"></a>00926 <span class="comment">/* ****************** EXPORTED API TO OTHER MODULES *************************** */</span>
<a name="l00927"></a>00927 
<a name="l00928"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#aef6fef35a624dd55667f13a2d9673fa8">00928</a> <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *<a class="code" href="../../d1/d12/ED__screen_8h.html#a606f34557f83e1d3c9eeda016a3d624b">ED_screen_duplicate</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win, <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc)
<a name="l00929"></a>00929 {
<a name="l00930"></a>00930     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *newsc;
<a name="l00931"></a>00931     
<a name="l00932"></a>00932     <span class="keywordflow">if</span> (sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#afe2ef870210be87541acaac1ce677776">full</a> != <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#ab5f98947e6f48dad2b0184d7d97bc365">SCREENNORMAL</a>) <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <span class="comment">/* XXX handle this case! */</span>
<a name="l00933"></a>00933     
<a name="l00934"></a>00934     <span class="comment">/* make new empty screen: */</span>
<a name="l00935"></a>00935     newsc= <a class="code" href="../../d1/d12/ED__screen_8h.html#a9379b3ffb23e6992684baeba61ab2e76">ED_screen_add</a>(win, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2);
<a name="l00936"></a>00936     <span class="comment">/* copy all data */</span>
<a name="l00937"></a>00937     <a class="code" href="../../da/dbc/screen__edit_8c.html#a8237ff8cd759d275a82f880dda193700">screen_copy</a>(newsc, sc);
<a name="l00938"></a>00938 
<a name="l00939"></a>00939     <span class="keywordflow">return</span> newsc;
<a name="l00940"></a>00940 }
<a name="l00941"></a>00941 
<a name="l00942"></a>00942 <span class="comment">/* screen sets cursor based on swinid */</span>
<a name="l00943"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#af17e3bf75b08bd320fad79952e26e5c6">00943</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#af17e3bf75b08bd320fad79952e26e5c6">region_cursor_set</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win, <span class="keywordtype">int</span> swinid)
<a name="l00944"></a>00944 {
<a name="l00945"></a>00945     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00946"></a>00946     
<a name="l00947"></a>00947     <span class="keywordflow">for</span> (;sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l00948"></a>00948         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l00949"></a>00949         <span class="keywordflow">for</span> (;ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l00950"></a>00950             <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a99bf72285d06e49b7fad6c270799b275">swinid</a> == swinid) {
<a name="l00951"></a>00951                 <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ae957cd551d82034b24008cfb99bbc4c7">type</a> &amp;&amp; ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ae957cd551d82034b24008cfb99bbc4c7">type</a>-&gt;<a class="code" href="../../d7/da9/structARegionType.html#ab586e66911ec226eb2fcf6ef645d24b8">cursor</a>)
<a name="l00952"></a>00952                     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ae957cd551d82034b24008cfb99bbc4c7">type</a>-&gt;<a class="code" href="../../d7/da9/structARegionType.html#ab586e66911ec226eb2fcf6ef645d24b8">cursor</a>(win, sa, ar);
<a name="l00953"></a>00953                 <span class="keywordflow">else</span>
<a name="l00954"></a>00954                     <a class="code" href="../../de/d3c/wm__cursors_8c.html#a30f5564490ef777f782dbce942054565">WM_cursor_set</a>(win, <a class="code" href="../../db/da6/wm__cursors_8h.html#aeb8d583a31cccbb8cf9b452a8e298063a581d03314f0c538b56cbef4d06a2a563">CURSOR_STD</a>);
<a name="l00955"></a>00955                 <span class="keywordflow">return</span>;
<a name="l00956"></a>00956             }
<a name="l00957"></a>00957         }
<a name="l00958"></a>00958     }
<a name="l00959"></a>00959 }
<a name="l00960"></a>00960 
<a name="l00961"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a65315d58d6e77593618c88e237c1506f">00961</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#a0b98d841c6a5e0ef5b2187f982f01a29">ED_screen_do_listen</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d4/d07/structwmNotifier.html">wmNotifier</a> *note)
<a name="l00962"></a>00962 {
<a name="l00963"></a>00963     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win= <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l00964"></a>00964     
<a name="l00965"></a>00965     <span class="comment">/* generic notes */</span>
<a name="l00966"></a>00966     <span class="keywordflow">switch</span>(note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a8d2543a915bef78c58c06b1cc765e2fd">category</a>) {
<a name="l00967"></a>00967         <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a2401e8c966e41d3d8dec9d54fd68c630">NC_WM</a>:
<a name="l00968"></a>00968             <span class="keywordflow">if</span> (note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a0c5aedeba4ddcd19c9714f01e06a9a84">data</a>==<a class="code" href="../../d4/ddc/WM__types_8h.html#a166393c0222fcb6591ea603f36d8654c">ND_FILEREAD</a>)
<a name="l00969"></a>00969                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#af42ea7fb025800a97c3a1fe3e5f24c5e">do_draw</a>= 1;
<a name="l00970"></a>00970             <span class="keywordflow">break</span>;
<a name="l00971"></a>00971         <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a0dce5c73d06bfc518c4c6b2189df325d">NC_WINDOW</a>:
<a name="l00972"></a>00972             win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#af42ea7fb025800a97c3a1fe3e5f24c5e">do_draw</a>= 1;
<a name="l00973"></a>00973             <span class="keywordflow">break</span>;
<a name="l00974"></a>00974         <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a4d138b3b2f069a9db1d8cc28c7ed071d">NC_SCREEN</a>:
<a name="l00975"></a>00975             <span class="keywordflow">if</span> (note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a0c5aedeba4ddcd19c9714f01e06a9a84">data</a>==<a class="code" href="../../d4/ddc/WM__types_8h.html#a24778b2e0dbb03070d57b4bcbdecce04">ND_SUBWINACTIVE</a>)
<a name="l00976"></a>00976                 <a class="code" href="../../d8/d1e/UI__interface_8h.html#aeb04e15cd78a6998bb092156ca127837">uiFreeActiveButtons</a>(C, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>);
<a name="l00977"></a>00977             <span class="keywordflow">if</span> (note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a1127cef43584875c4ec84b1d3b7dc655">action</a>==<a class="code" href="../../d4/ddc/WM__types_8h.html#a73680e84dba31202967ab486f0b306ea">NA_EDITED</a>)
<a name="l00978"></a>00978                 win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#af42ea7fb025800a97c3a1fe3e5f24c5e">do_draw</a>= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac46694a5caf4c4eaefea6cf9b8d77f81">do_refresh</a>= 1;
<a name="l00979"></a>00979             <span class="keywordflow">break</span>;
<a name="l00980"></a>00980         <span class="keywordflow">case</span> <a class="code" href="../../d4/ddc/WM__types_8h.html#a61261a6b5ea948eee6d42c7e7ee18166">NC_SCENE</a>:
<a name="l00981"></a>00981             <span class="keywordflow">if</span> (note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a0c5aedeba4ddcd19c9714f01e06a9a84">data</a>==<a class="code" href="../../d4/ddc/WM__types_8h.html#a53c798c29ec45386460a892c62769440">ND_MODE</a>)
<a name="l00982"></a>00982                 <a class="code" href="../../da/dbc/screen__edit_8c.html#af17e3bf75b08bd320fad79952e26e5c6">region_cursor_set</a>(win, note-&gt;<a class="code" href="../../d4/d07/structwmNotifier.html#a2468d7326422d6a5d277c846ce93547d">swinid</a>);               
<a name="l00983"></a>00983             <span class="keywordflow">break</span>;
<a name="l00984"></a>00984     }
<a name="l00985"></a>00985 }
<a name="l00986"></a>00986 
<a name="l00987"></a>00987 <span class="comment">/* only for edge lines between areas, and the blended join arrows */</span>
<a name="l00988"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#ad4add616a7f60d7cedaaca696df5bc5a">00988</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#af6f35cdd3fd93253ceeed244a4310a65">ED_screen_draw</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win)
<a name="l00989"></a>00989 {
<a name="l00990"></a>00990     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l00991"></a>00991     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa1= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00992"></a>00992     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa2= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00993"></a>00993     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa3= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00994"></a>00994     <span class="keywordtype">int</span> dir = -1;
<a name="l00995"></a>00995     <span class="keywordtype">int</span> dira = -1;
<a name="l00996"></a>00996 
<a name="l00997"></a>00997     <a class="code" href="../../df/d4d/wm__subwindow_8c.html#ad5ef6e077c326a5b5e3647d24cf894c5">wmSubWindowSet</a>(win, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ad5d8a3070981c34f7f17649a7728080d">mainwin</a>);
<a name="l00998"></a>00998     
<a name="l00999"></a>00999     <span class="keywordflow">for</span> (sa= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l01000"></a>01000         <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a95330fccbc8eb82dc12aefadd1afd8db">flag</a> &amp; <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a3f1eabd0fa9d89c5a6dac55bc9acb487">AREA_FLAG_DRAWJOINFROM</a>) sa1 = sa;
<a name="l01001"></a>01001         <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a95330fccbc8eb82dc12aefadd1afd8db">flag</a> &amp; <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#ab96f18610053bcc66118620d92ad7ca9">AREA_FLAG_DRAWJOINTO</a>) sa2 = sa;
<a name="l01002"></a>01002         <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a95330fccbc8eb82dc12aefadd1afd8db">flag</a> &amp; (<a class="code" href="../../d4/da4/DNA__screen__types_8h.html#afa06c830c3f2a2a38bead57d723b452d">AREA_FLAG_DRAWSPLIT_H</a>|<a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a082cb2233dcf7742d434336f19aceecb">AREA_FLAG_DRAWSPLIT_V</a>)) sa3 = sa;
<a name="l01003"></a>01003         <a class="code" href="../../da/dbc/screen__edit_8c.html#a2608648a97626a9dc469fba66d7536ed">drawscredge_area</a>(sa, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a>, 0);
<a name="l01004"></a>01004     }
<a name="l01005"></a>01005     <span class="keywordflow">for</span> (sa= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>)
<a name="l01006"></a>01006         <a class="code" href="../../da/dbc/screen__edit_8c.html#a2608648a97626a9dc469fba66d7536ed">drawscredge_area</a>(sa, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a>, 1);
<a name="l01007"></a>01007     
<a name="l01008"></a>01008     <span class="comment">/* blended join arrow */</span>
<a name="l01009"></a>01009     <span class="keywordflow">if</span> (sa1 &amp;&amp; sa2) {
<a name="l01010"></a>01010         dir = <a class="code" href="../../da/dbc/screen__edit_8c.html#a2e6e5e036f3379ab09724b8fabd7f12a">area_getorientation</a>(sa1, sa2);
<a name="l01011"></a>01011         <span class="keywordflow">if</span> (dir &gt;= 0) {
<a name="l01012"></a>01012             <span class="keywordflow">switch</span>(dir) {
<a name="l01013"></a>01013                 <span class="keywordflow">case</span> 0: <span class="comment">/* W */</span>
<a name="l01014"></a>01014                     dir = <span class="charliteral">&#39;r&#39;</span>;
<a name="l01015"></a>01015                     dira = <span class="charliteral">&#39;l&#39;</span>;
<a name="l01016"></a>01016                     <span class="keywordflow">break</span>;
<a name="l01017"></a>01017                 <span class="keywordflow">case</span> 1: <span class="comment">/* N */</span>
<a name="l01018"></a>01018                     dir = <span class="charliteral">&#39;d&#39;</span>;
<a name="l01019"></a>01019                     dira = <span class="charliteral">&#39;u&#39;</span>;
<a name="l01020"></a>01020                     <span class="keywordflow">break</span>;
<a name="l01021"></a>01021                 <span class="keywordflow">case</span> 2: <span class="comment">/* E */</span>
<a name="l01022"></a>01022                     dir = <span class="charliteral">&#39;l&#39;</span>;
<a name="l01023"></a>01023                     dira = <span class="charliteral">&#39;r&#39;</span>;
<a name="l01024"></a>01024                     <span class="keywordflow">break</span>;
<a name="l01025"></a>01025                 <span class="keywordflow">case</span> 3: <span class="comment">/* S */</span>
<a name="l01026"></a>01026                     dir = <span class="charliteral">&#39;u&#39;</span>;
<a name="l01027"></a>01027                     dira = <span class="charliteral">&#39;d&#39;</span>;
<a name="l01028"></a>01028                     <span class="keywordflow">break</span>;
<a name="l01029"></a>01029             }
<a name="l01030"></a>01030         }
<a name="l01031"></a>01031         <a class="code" href="../../da/dbc/screen__edit_8c.html#a503536d3208e2f99e48815a62c31e41d">scrarea_draw_shape_dark</a>(sa2, dir);
<a name="l01032"></a>01032         <a class="code" href="../../da/dbc/screen__edit_8c.html#a8c58d79c19b9daa7b5c32439473edd15">scrarea_draw_shape_light</a>(sa1, dira);
<a name="l01033"></a>01033     }
<a name="l01034"></a>01034     
<a name="l01035"></a>01035     <span class="comment">/* splitpoint */</span>
<a name="l01036"></a>01036     <span class="keywordflow">if</span> (sa3) {
<a name="l01037"></a>01037         glEnable(GL_BLEND);
<a name="l01038"></a>01038         glColor4ub(255, 255, 255, 100);
<a name="l01039"></a>01039         
<a name="l01040"></a>01040         <span class="keywordflow">if</span> (sa3-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a95330fccbc8eb82dc12aefadd1afd8db">flag</a> &amp; <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#afa06c830c3f2a2a38bead57d723b452d">AREA_FLAG_DRAWSPLIT_H</a>) {
<a name="l01041"></a>01041             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#af04b403c3fb94451facdc3a4fca476fc">sdrawline</a>(sa3-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab57b1af3f75bfc9e306271da17d157ff">totrct</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>, sa3-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab57b1af3f75bfc9e306271da17d157ff">totrct</a>.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>);
<a name="l01042"></a>01042             glColor4ub(0, 0, 0, 100);
<a name="l01043"></a>01043             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#af04b403c3fb94451facdc3a4fca476fc">sdrawline</a>(sa3-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab57b1af3f75bfc9e306271da17d157ff">totrct</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>+1, sa3-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab57b1af3f75bfc9e306271da17d157ff">totrct</a>.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>+1);
<a name="l01044"></a>01044         }
<a name="l01045"></a>01045         <span class="keywordflow">else</span> {
<a name="l01046"></a>01046             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#af04b403c3fb94451facdc3a4fca476fc">sdrawline</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, sa3-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab57b1af3f75bfc9e306271da17d157ff">totrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, sa3-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab57b1af3f75bfc9e306271da17d157ff">totrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a>);
<a name="l01047"></a>01047             glColor4ub(0, 0, 0, 100);
<a name="l01048"></a>01048             <a class="code" href="../../d9/d71/BIF__glutil_8h.html#af04b403c3fb94451facdc3a4fca476fc">sdrawline</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>+1, sa3-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab57b1af3f75bfc9e306271da17d157ff">totrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>+1, sa3-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab57b1af3f75bfc9e306271da17d157ff">totrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a>);
<a name="l01049"></a>01049         }
<a name="l01050"></a>01050         
<a name="l01051"></a>01051         glDisable(GL_BLEND);
<a name="l01052"></a>01052     }
<a name="l01053"></a>01053     
<a name="l01054"></a>01054     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#af42ea7fb025800a97c3a1fe3e5f24c5e">do_draw</a>= 0;
<a name="l01055"></a>01055 }
<a name="l01056"></a>01056 
<a name="l01057"></a>01057 <span class="comment">/* helper call for below, dpi changes headers */</span>
<a name="l01058"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a1698beb170fb084b62ad1e9cde386c29">01058</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#a1698beb170fb084b62ad1e9cde386c29">screen_refresh_headersizes</a>(<span class="keywordtype">void</span>)
<a name="l01059"></a>01059 {
<a name="l01060"></a>01060     <span class="keyword">const</span> <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> *lb= <a class="code" href="../../d7/da3/BKE__screen_8h.html#aab9a1ff723e9c66062116a91721f2ea8">BKE_spacetypes_list</a>();
<a name="l01061"></a>01061     <a class="code" href="../../dd/d66/structSpaceType.html">SpaceType</a> *st;
<a name="l01062"></a>01062     
<a name="l01063"></a>01063     <span class="keywordflow">for</span> (st= lb-&gt;<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; st; st= st-&gt;<a class="code" href="../../dd/d66/structSpaceType.html#ad5a99cdc6764494cc46d619c7f0dd4f5">next</a>) {
<a name="l01064"></a>01064         <a class="code" href="../../d7/da9/structARegionType.html">ARegionType</a> *art= <a class="code" href="../../d7/da3/BKE__screen_8h.html#ad04613b34721ba1b703c94a635fcffcd">BKE_regiontype_from_id</a>(st, <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2ab7e0b51ce129a8b256dc705a06c4c4e8">RGN_TYPE_HEADER</a>);
<a name="l01065"></a>01065         <span class="keywordflow">if</span> (art) art-&gt;<a class="code" href="../../d7/da9/structARegionType.html#a731e71cf273e50acc629de70427ff2bd">prefsizey</a>= <a class="code" href="../../d1/d12/ED__screen_8h.html#a691baf7c6b3655f45442d77ad5b283c2">ED_area_headersize</a>();
<a name="l01066"></a>01066     }       
<a name="l01067"></a>01067 }
<a name="l01068"></a>01068 
<a name="l01069"></a>01069 <span class="comment">/* make this screen usable */</span>
<a name="l01070"></a>01070 <span class="comment">/* for file read and first use, for scaling window, area moves */</span>
<a name="l01071"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a807600222618748d9d6c40054a2cfdd7">01071</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#ab11b1f04d75e4b026402b4ed556f3612">ED_screen_refresh</a>(<a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm, <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win)
<a name="l01072"></a>01072 {   
<a name="l01073"></a>01073     <span class="comment">/* exception for bg mode, we only need the screen context */</span>
<a name="l01074"></a>01074     <span class="keywordflow">if</span> (!<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.background) {
<a name="l01075"></a>01075         <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l01076"></a>01076         <a class="code" href="../../d0/d28/structrcti.html">rcti</a> winrct;
<a name="l01077"></a>01077     
<a name="l01078"></a>01078         winrct.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> = 0;
<a name="l01079"></a>01079         winrct.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a> = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a>-1;
<a name="l01080"></a>01080         winrct.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> = 0;
<a name="l01081"></a>01081         winrct.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a> = win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a>-1;
<a name="l01082"></a>01082         
<a name="l01083"></a>01083         <a class="code" href="../../da/dbc/screen__edit_8c.html#a9147264cea794089ca1597794efb7c5d">screen_test_scale</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#af8071bd36051fb5f5e0acd68e22523d0">sizex</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a2284e3d27468a900b10ca04a97ef6975">sizey</a>);
<a name="l01084"></a>01084         
<a name="l01085"></a>01085         <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ad5d8a3070981c34f7f17649a7728080d">mainwin</a>==0)
<a name="l01086"></a>01086             win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ad5d8a3070981c34f7f17649a7728080d">mainwin</a>= <a class="code" href="../../df/d4d/wm__subwindow_8c.html#a6c42dad8eb38c4eeb72eff1f55842d99">wm_subwindow_open</a>(win, &amp;winrct);
<a name="l01087"></a>01087         <span class="keywordflow">else</span>
<a name="l01088"></a>01088             <a class="code" href="../../df/d4d/wm__subwindow_8c.html#a23981b5a368b8f5e209dc186ca8d4746">wm_subwindow_position</a>(win, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ad5d8a3070981c34f7f17649a7728080d">mainwin</a>, &amp;winrct);
<a name="l01089"></a>01089         
<a name="l01090"></a>01090         <span class="comment">/* header size depends on DPI, let&#39;s verify */</span>
<a name="l01091"></a>01091         <a class="code" href="../../da/dbc/screen__edit_8c.html#a1698beb170fb084b62ad1e9cde386c29">screen_refresh_headersizes</a>();
<a name="l01092"></a>01092         
<a name="l01093"></a>01093         <span class="keywordflow">for</span> (sa= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l01094"></a>01094             <span class="comment">/* set spacetype and region callbacks, calls init() */</span>
<a name="l01095"></a>01095             <span class="comment">/* sets subwindows for regions, adds handlers */</span>
<a name="l01096"></a>01096             <a class="code" href="../../d1/d12/ED__screen_8h.html#ae45f2f3bb39946df3342722735be4fb1">ED_area_initialize</a>(wm, win, sa);
<a name="l01097"></a>01097         }
<a name="l01098"></a>01098     
<a name="l01099"></a>01099         <span class="comment">/* wake up animtimer */</span>
<a name="l01100"></a>01100         <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>)
<a name="l01101"></a>01101             <a class="code" href="../../d7/d6e/wm__window_8c.html#aac640b2e0eec094b25ab707702fae91a">WM_event_timer_sleep</a>(wm, win, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>, 0);
<a name="l01102"></a>01102     }
<a name="l01103"></a>01103 
<a name="l01104"></a>01104     <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635acf1dc96ed63676564982ffda5a0f5ac1">G_DEBUG_EVENTS</a>) {
<a name="l01105"></a>01105         printf(<span class="stringliteral">&quot;%s: set screen\n&quot;</span>, __func__);
<a name="l01106"></a>01106     }
<a name="l01107"></a>01107     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac46694a5caf4c4eaefea6cf9b8d77f81">do_refresh</a>= 0;
<a name="l01108"></a>01108 
<a name="l01109"></a>01109     win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#a484770c9d14f5f3ca1e8eb7573686043">context</a>= <a class="code" href="../../df/da6/screen__context_8c.html#ab1388f602a79cc9b40d6f4fa17ad7570">ed_screen_context</a>;
<a name="l01110"></a>01110 }
<a name="l01111"></a>01111 
<a name="l01112"></a>01112 <span class="comment">/* file read, set all screens, ... */</span>
<a name="l01113"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a67798e0e92c3d3b6d6c44a8ef4f0df4c">01113</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#adf011c567569c294493d1a46f4aecf78">ED_screens_initialize</a>(<a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm)
<a name="l01114"></a>01114 {
<a name="l01115"></a>01115     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win;
<a name="l01116"></a>01116     
<a name="l01117"></a>01117     <span class="keywordflow">for</span> (win= wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; win; win= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#accffa1b62f114b1781206c921fc92be1">next</a>) {
<a name="l01118"></a>01118         
<a name="l01119"></a>01119         <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01120"></a>01120             win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>= <a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.main-&gt;screen.first;
<a name="l01121"></a>01121         
<a name="l01122"></a>01122         <a class="code" href="../../d1/d12/ED__screen_8h.html#ab11b1f04d75e4b026402b4ed556f3612">ED_screen_refresh</a>(wm, win);
<a name="l01123"></a>01123     }
<a name="l01124"></a>01124 }
<a name="l01125"></a>01125 
<a name="l01126"></a>01126 
<a name="l01127"></a>01127 <span class="comment">/* *********** exit calls are for closing running stuff ******** */</span>
<a name="l01128"></a>01128 
<a name="l01129"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a5f7c336d670f0e1efd9c35d40da3016f">01129</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#a58fb8b740e06bf69c7031d262e4e0ad7">ED_region_exit</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar)
<a name="l01130"></a>01130 {
<a name="l01131"></a>01131     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *prevar= <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01132"></a>01132 
<a name="l01133"></a>01133     <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, ar);
<a name="l01134"></a>01134     <a class="code" href="../../df/db0/wm__event__system_8c.html#afd7ef52cacacb354c1ad99d47b57855b">WM_event_remove_handlers</a>(C, &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a84683336306edb035eeaa8d2f6fa7033">handlers</a>);
<a name="l01135"></a>01135     <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a99bf72285d06e49b7fad6c270799b275">swinid</a>)
<a name="l01136"></a>01136         <a class="code" href="../../df/d4d/wm__subwindow_8c.html#a6f5db395f959a3efe9866ebb9a682fec">wm_subwindow_close</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C), ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a99bf72285d06e49b7fad6c270799b275">swinid</a>);
<a name="l01137"></a>01137     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a99bf72285d06e49b7fad6c270799b275">swinid</a>= 0;
<a name="l01138"></a>01138     
<a name="l01139"></a>01139     <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a6f69b2410135b3a2ad6badb912132ce2">headerstr</a>)
<a name="l01140"></a>01140         <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a6f69b2410135b3a2ad6badb912132ce2">headerstr</a>);
<a name="l01141"></a>01141     ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a6f69b2410135b3a2ad6badb912132ce2">headerstr</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01142"></a>01142     
<a name="l01143"></a>01143     <a class="code" href="../../df/d01/BKE__context_8h.html#a2406677d500d1744af5e9e56c210590b">CTX_wm_region_set</a>(C, prevar);
<a name="l01144"></a>01144 }
<a name="l01145"></a>01145 
<a name="l01146"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a5658d0e06e49ea3e554aeac02cfb8eee">01146</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#acf1337067240bb750c7328678a0d896d">ED_area_exit</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa)
<a name="l01147"></a>01147 {
<a name="l01148"></a>01148     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *prevsa= <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l01149"></a>01149     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l01150"></a>01150 
<a name="l01151"></a>01151     <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a124203529b9ea4c84ca8f8ae4efff3e3">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca5f4c324d2af06c247780942931169c7c">SPACE_FILE</a>) {
<a name="l01152"></a>01152         <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01153"></a>01153         <span class="keywordflow">if</span> (sl &amp;&amp; sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca5f4c324d2af06c247780942931169c7c">SPACE_FILE</a>) {
<a name="l01154"></a>01154             <a class="code" href="../../db/db9/ED__fileselect_8h.html#a50f47b32da683bbab4c8d1617eea5578">ED_fileselect_exit</a>(C, (<a class="code" href="../../d7/d1c/structSpaceFile.html">SpaceFile</a> *)sl);
<a name="l01155"></a>01155         }
<a name="l01156"></a>01156     }
<a name="l01157"></a>01157     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a124203529b9ea4c84ca8f8ae4efff3e3">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l01158"></a>01158         <a class="code" href="../../d6/d53/ED__render_8h.html#ada1e888f30b6336dc52787b6a86fcb0f">ED_render_engine_area_exit</a>(sa);
<a name="l01159"></a>01159     }
<a name="l01160"></a>01160 
<a name="l01161"></a>01161     <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, sa);
<a name="l01162"></a>01162     <span class="keywordflow">for</span> (ar= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>)
<a name="l01163"></a>01163         <a class="code" href="../../d1/d12/ED__screen_8h.html#a58fb8b740e06bf69c7031d262e4e0ad7">ED_region_exit</a>(C, ar);
<a name="l01164"></a>01164 
<a name="l01165"></a>01165     <a class="code" href="../../df/db0/wm__event__system_8c.html#afd7ef52cacacb354c1ad99d47b57855b">WM_event_remove_handlers</a>(C, &amp;sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a01c01609c538278ac956593f749365e3">handlers</a>);
<a name="l01166"></a>01166     <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, prevsa);
<a name="l01167"></a>01167 }
<a name="l01168"></a>01168 
<a name="l01169"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#aa315b8c59acf11a03926b11f7bfa8f78">01169</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#a2604af7c1ea0cec7fdcace930add202a">ED_screen_exit</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *window, <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen)
<a name="l01170"></a>01170 {
<a name="l01171"></a>01171     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm= <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l01172"></a>01172     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *prevwin= <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l01173"></a>01173     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l01174"></a>01174     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l01175"></a>01175 
<a name="l01176"></a>01176     <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, window);
<a name="l01177"></a>01177     
<a name="l01178"></a>01178     <span class="keywordflow">if</span> (screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>)
<a name="l01179"></a>01179         <a class="code" href="../../d7/d6e/wm__window_8c.html#a1a9f31ba88dd1dd3982b3d8f02de2e75">WM_event_remove_timer</a>(wm, window, screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>);
<a name="l01180"></a>01180     screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01181"></a>01181     
<a name="l01182"></a>01182     <span class="keywordflow">if</span> (screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ad5d8a3070981c34f7f17649a7728080d">mainwin</a>)
<a name="l01183"></a>01183         <a class="code" href="../../df/d4d/wm__subwindow_8c.html#a6f5db395f959a3efe9866ebb9a682fec">wm_subwindow_close</a>(window, screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ad5d8a3070981c34f7f17649a7728080d">mainwin</a>);
<a name="l01184"></a>01184     screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ad5d8a3070981c34f7f17649a7728080d">mainwin</a>= 0;
<a name="l01185"></a>01185     screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac36068e2dc55a7532b24bb20bc7be837">subwinactive</a>= 0;
<a name="l01186"></a>01186     
<a name="l01187"></a>01187     <span class="keywordflow">for</span> (ar= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#a5aed112496143ef5c69ddb1f9a8d5efd">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>)
<a name="l01188"></a>01188         <a class="code" href="../../d1/d12/ED__screen_8h.html#a58fb8b740e06bf69c7031d262e4e0ad7">ED_region_exit</a>(C, ar);
<a name="l01189"></a>01189 
<a name="l01190"></a>01190     <span class="keywordflow">for</span> (sa= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>)
<a name="l01191"></a>01191         <a class="code" href="../../d1/d12/ED__screen_8h.html#acf1337067240bb750c7328678a0d896d">ED_area_exit</a>(C, sa);
<a name="l01192"></a>01192 
<a name="l01193"></a>01193     <span class="comment">/* mark it available for use for other windows */</span>
<a name="l01194"></a>01194     screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#a022929944b7229e3652332ef1fcf30ab">winid</a>= 0;
<a name="l01195"></a>01195     
<a name="l01196"></a>01196     <span class="keywordflow">if</span> (prevwin-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae4c1fae9fb86f1ad80ae280be436cb75">temp</a> == 0) {
<a name="l01197"></a>01197         <span class="comment">/* use previous window if possible */</span>
<a name="l01198"></a>01198         <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, prevwin);
<a name="l01199"></a>01199     }
<a name="l01200"></a>01200     <span class="keywordflow">else</span> {
<a name="l01201"></a>01201         <span class="comment">/* none otherwise */</span>
<a name="l01202"></a>01202         <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01203"></a>01203     }
<a name="l01204"></a>01204     
<a name="l01205"></a>01205 }
<a name="l01206"></a>01206 
<a name="l01207"></a>01207 <span class="comment">/* *********************************** */</span>
<a name="l01208"></a>01208 
<a name="l01209"></a>01209 <span class="comment">/* case when on area-edge or in azones, or outside window */</span>
<a name="l01210"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#ae6bcd31026eb6d53d5f0e3cfa180444a">01210</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#ae6bcd31026eb6d53d5f0e3cfa180444a">screen_cursor_set</a>(<a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01211"></a>01211 {
<a name="l01212"></a>01212     <a class="code" href="../../d8/dfd/structAZone.html">AZone</a> *az= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01213"></a>01213     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l01214"></a>01214     
<a name="l01215"></a>01215     <span class="keywordflow">for</span> (sa= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>)
<a name="l01216"></a>01216         <span class="keywordflow">if</span> ((az=<a class="code" href="../../d7/de3/screen__intern_8h.html#a1f9f9763e4f272830d0291eea2b367ef">is_in_area_actionzone</a>(sa, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>)))
<a name="l01217"></a>01217             <span class="keywordflow">break</span>;
<a name="l01218"></a>01218     
<a name="l01219"></a>01219     <span class="keywordflow">if</span> (sa) {
<a name="l01220"></a>01220         <span class="keywordflow">if</span> (az-&gt;<a class="code" href="../../d8/dfd/structAZone.html#a396c201c32f6002fb549726586b8b480">type</a>==<a class="code" href="../../d1/d85/ED__screen__types_8h.html#a045bd71c179c59e786eb4e3cd384e423">AZONE_AREA</a>)
<a name="l01221"></a>01221             <a class="code" href="../../de/d3c/wm__cursors_8c.html#a30f5564490ef777f782dbce942054565">WM_cursor_set</a>(win, <a class="code" href="../../db/da6/wm__cursors_8h.html#aeb8d583a31cccbb8cf9b452a8e298063a003cebaaa983d870cd4463a804a21f9d">CURSOR_EDIT</a>);
<a name="l01222"></a>01222         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (az-&gt;<a class="code" href="../../d8/dfd/structAZone.html#a396c201c32f6002fb549726586b8b480">type</a>==<a class="code" href="../../d1/d85/ED__screen__types_8h.html#a7a79069a208a479cdd52f066db18a775">AZONE_REGION</a>) {
<a name="l01223"></a>01223             <span class="keywordflow">if</span> (az-&gt;<a class="code" href="../../d8/dfd/structAZone.html#a83c515d0109cfbe4c397c49115ecdb56">edge</a> == <a class="code" href="../../d1/d85/ED__screen__types_8h.html#aeb426c1bfa45224413b4160410a53050a61e988fbac4e5a0b6f160b766cf89c8c">AE_LEFT_TO_TOPRIGHT</a> || az-&gt;<a class="code" href="../../d8/dfd/structAZone.html#a83c515d0109cfbe4c397c49115ecdb56">edge</a> == <a class="code" href="../../d1/d85/ED__screen__types_8h.html#aeb426c1bfa45224413b4160410a53050a7bbe94b2d8cf2a57e13a5687b1a697bb">AE_RIGHT_TO_TOPLEFT</a>)
<a name="l01224"></a>01224                 <a class="code" href="../../de/d3c/wm__cursors_8c.html#a30f5564490ef777f782dbce942054565">WM_cursor_set</a>(win, <a class="code" href="../../db/da6/wm__cursors_8h.html#aeb8d583a31cccbb8cf9b452a8e298063a8cd32081a24846ec46ec8217f2a1304a">CURSOR_X_MOVE</a>);
<a name="l01225"></a>01225             <span class="keywordflow">else</span>
<a name="l01226"></a>01226                 <a class="code" href="../../de/d3c/wm__cursors_8c.html#a30f5564490ef777f782dbce942054565">WM_cursor_set</a>(win, <a class="code" href="../../db/da6/wm__cursors_8h.html#aeb8d583a31cccbb8cf9b452a8e298063a633ba0f5cebabd00b352c40505d6061d">CURSOR_Y_MOVE</a>);
<a name="l01227"></a>01227         }
<a name="l01228"></a>01228     }
<a name="l01229"></a>01229     <span class="keywordflow">else</span> {
<a name="l01230"></a>01230         <a class="code" href="../../dd/d31/structScrEdge.html">ScrEdge</a> *actedge= <a class="code" href="../../da/dbc/screen__edit_8c.html#ad462a6663b9be9ed4230edfd68e81cb5">screen_find_active_scredge</a>(win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>);
<a name="l01231"></a>01231         
<a name="l01232"></a>01232         <span class="keywordflow">if</span> (actedge) {
<a name="l01233"></a>01233             <span class="keywordflow">if</span> (<a class="code" href="../../da/dbc/screen__edit_8c.html#a7a9ae203ae84d9436052de27bfdbbc68">scredge_is_horizontal</a>(actedge))
<a name="l01234"></a>01234                 <a class="code" href="../../de/d3c/wm__cursors_8c.html#a30f5564490ef777f782dbce942054565">WM_cursor_set</a>(win, <a class="code" href="../../db/da6/wm__cursors_8h.html#aeb8d583a31cccbb8cf9b452a8e298063a633ba0f5cebabd00b352c40505d6061d">CURSOR_Y_MOVE</a>);
<a name="l01235"></a>01235             <span class="keywordflow">else</span>
<a name="l01236"></a>01236                 <a class="code" href="../../de/d3c/wm__cursors_8c.html#a30f5564490ef777f782dbce942054565">WM_cursor_set</a>(win, <a class="code" href="../../db/da6/wm__cursors_8h.html#aeb8d583a31cccbb8cf9b452a8e298063a8cd32081a24846ec46ec8217f2a1304a">CURSOR_X_MOVE</a>);
<a name="l01237"></a>01237         }
<a name="l01238"></a>01238         <span class="keywordflow">else</span>
<a name="l01239"></a>01239             <a class="code" href="../../de/d3c/wm__cursors_8c.html#a30f5564490ef777f782dbce942054565">WM_cursor_set</a>(win, <a class="code" href="../../db/da6/wm__cursors_8h.html#aeb8d583a31cccbb8cf9b452a8e298063a581d03314f0c538b56cbef4d06a2a563">CURSOR_STD</a>);
<a name="l01240"></a>01240     } 
<a name="l01241"></a>01241 }
<a name="l01242"></a>01242 
<a name="l01243"></a>01243 
<a name="l01244"></a>01244 <span class="comment">/* called in wm_event_system.c. sets state vars in screen, cursors */</span>
<a name="l01245"></a>01245 <span class="comment">/* event type is mouse move */</span>
<a name="l01246"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a8214fd159deabe6a8ffa3e38a73e2420">01246</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#ab3f30bd970ebe9bdc248ca329a5cbd9e">ED_screen_set_subwinactive</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d5/d6c/structwmEvent.html">wmEvent</a> *event)
<a name="l01247"></a>01247 {
<a name="l01248"></a>01248     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win= <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l01249"></a>01249     
<a name="l01250"></a>01250     <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>) {
<a name="l01251"></a>01251         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *scr= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>;
<a name="l01252"></a>01252         <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l01253"></a>01253         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l01254"></a>01254         <span class="keywordtype">int</span> oldswin= scr-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac36068e2dc55a7532b24bb20bc7be837">subwinactive</a>;
<a name="l01255"></a>01255 
<a name="l01256"></a>01256         <span class="keywordflow">for</span> (sa= scr-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l01257"></a>01257             <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> &gt; sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab57b1af3f75bfc9e306271da17d157ff">totrct</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a> &lt; sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab57b1af3f75bfc9e306271da17d157ff">totrct</a>.<a class="code" href="../../d0/d28/structrcti.html#aed85b3972f94e2946a2bfcb60e036986">xmax</a>)
<a name="l01258"></a>01258                 <span class="keywordflow">if</span> (event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a> &gt; sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab57b1af3f75bfc9e306271da17d157ff">totrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> &amp;&amp; event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a> &lt; sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#ab57b1af3f75bfc9e306271da17d157ff">totrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a5e0cd2b56e95eba87777402106f57a9a">ymax</a>)
<a name="l01259"></a>01259                     <span class="keywordflow">if</span> (<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>==<a class="code" href="../../d7/de3/screen__intern_8h.html#a1f9f9763e4f272830d0291eea2b367ef">is_in_area_actionzone</a>(sa, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>))
<a name="l01260"></a>01260                         <span class="keywordflow">break</span>;
<a name="l01261"></a>01261         }
<a name="l01262"></a>01262         <span class="keywordflow">if</span> (sa) {
<a name="l01263"></a>01263             <span class="keywordflow">for</span> (ar= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l01264"></a>01264                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d44/BLI__rect_8h.html#a1242dd13fb888a0146765107474fffb4">BLI_in_rcti</a>(&amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, event-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>))
<a name="l01265"></a>01265                     scr-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac36068e2dc55a7532b24bb20bc7be837">subwinactive</a>= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a99bf72285d06e49b7fad6c270799b275">swinid</a>;
<a name="l01266"></a>01266             }
<a name="l01267"></a>01267         }
<a name="l01268"></a>01268         <span class="keywordflow">else</span>
<a name="l01269"></a>01269             scr-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac36068e2dc55a7532b24bb20bc7be837">subwinactive</a>= scr-&gt;<a class="code" href="../../de/de7/structbScreen.html#ad5d8a3070981c34f7f17649a7728080d">mainwin</a>;
<a name="l01270"></a>01270         
<a name="l01271"></a>01271         <span class="comment">/* check for redraw headers */</span>
<a name="l01272"></a>01272         <span class="keywordflow">if</span> (oldswin!=scr-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac36068e2dc55a7532b24bb20bc7be837">subwinactive</a>) {
<a name="l01273"></a>01273 
<a name="l01274"></a>01274             <span class="keywordflow">for</span> (sa= scr-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l01275"></a>01275                 <span class="keywordtype">int</span> do_draw= 0;
<a name="l01276"></a>01276                 
<a name="l01277"></a>01277                 <span class="keywordflow">for</span> (ar= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>)
<a name="l01278"></a>01278                     <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a99bf72285d06e49b7fad6c270799b275">swinid</a>==oldswin || ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a99bf72285d06e49b7fad6c270799b275">swinid</a>==scr-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac36068e2dc55a7532b24bb20bc7be837">subwinactive</a>)
<a name="l01279"></a>01279                         do_draw= 1;
<a name="l01280"></a>01280                 
<a name="l01281"></a>01281                 <span class="keywordflow">if</span> (do_draw) {
<a name="l01282"></a>01282                     <span class="keywordflow">for</span> (ar= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>)
<a name="l01283"></a>01283                         <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>==<a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2ab7e0b51ce129a8b256dc705a06c4c4e8">RGN_TYPE_HEADER</a>)
<a name="l01284"></a>01284                             <a class="code" href="../../d1/d12/ED__screen_8h.html#ac6cfac9a218d316df5b76e7fe0f89967">ED_region_tag_redraw</a>(ar);
<a name="l01285"></a>01285                 }
<a name="l01286"></a>01286             }
<a name="l01287"></a>01287         }
<a name="l01288"></a>01288         
<a name="l01289"></a>01289         <span class="comment">/* cursors, for time being set always on edges, otherwise aregion doesnt switch */</span>
<a name="l01290"></a>01290         <span class="keywordflow">if</span> (scr-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac36068e2dc55a7532b24bb20bc7be837">subwinactive</a>==scr-&gt;<a class="code" href="../../de/de7/structbScreen.html#ad5d8a3070981c34f7f17649a7728080d">mainwin</a>) {
<a name="l01291"></a>01291             <a class="code" href="../../da/dbc/screen__edit_8c.html#ae6bcd31026eb6d53d5f0e3cfa180444a">screen_cursor_set</a>(win, event);
<a name="l01292"></a>01292         }
<a name="l01293"></a>01293         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (oldswin!=scr-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac36068e2dc55a7532b24bb20bc7be837">subwinactive</a>) {
<a name="l01294"></a>01294             <a class="code" href="../../da/dbc/screen__edit_8c.html#af17e3bf75b08bd320fad79952e26e5c6">region_cursor_set</a>(win, scr-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac36068e2dc55a7532b24bb20bc7be837">subwinactive</a>);
<a name="l01295"></a>01295             <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a4d138b3b2f069a9db1d8cc28c7ed071d">NC_SCREEN</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a24778b2e0dbb03070d57b4bcbdecce04">ND_SUBWINACTIVE</a>, scr);
<a name="l01296"></a>01296         }
<a name="l01297"></a>01297     }
<a name="l01298"></a>01298 }
<a name="l01299"></a>01299 
<a name="l01300"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a19fba05be9b2270e61e6df488c15264d">01300</a> <span class="keywordtype">int</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#afec0307292579b199d6ee6f4ffb95cfc">ED_screen_area_active</a>(<span class="keyword">const</span> <a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l01301"></a>01301 {
<a name="l01302"></a>01302     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win= <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l01303"></a>01303     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc= <a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C);
<a name="l01304"></a>01304     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa= <a class="code" href="../../df/d01/BKE__context_8h.html#a0aa169ee48010fe8d739201a37e7b66f">CTX_wm_area</a>(C);
<a name="l01305"></a>01305 
<a name="l01306"></a>01306     <span class="keywordflow">if</span> (win &amp;&amp; sc &amp;&amp; sa) {
<a name="l01307"></a>01307         <a class="code" href="../../d8/dfd/structAZone.html">AZone</a> *az= <a class="code" href="../../d7/de3/screen__intern_8h.html#a1f9f9763e4f272830d0291eea2b367ef">is_in_area_actionzone</a>(sa, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#aa6d806b03b666c8e88f6178303145cb1">x</a>, win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1c950f3f8bc3e99973abac8e510d0835">eventstate</a>-&gt;<a class="code" href="../../d5/d6c/structwmEvent.html#a1f9bfd9ad3dda5768a94bad7a3c3fc1e">y</a>);
<a name="l01308"></a>01308         <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l01309"></a>01309         
<a name="l01310"></a>01310         <span class="keywordflow">if</span> (az &amp;&amp; az-&gt;<a class="code" href="../../d8/dfd/structAZone.html#a396c201c32f6002fb549726586b8b480">type</a> == <a class="code" href="../../d1/d85/ED__screen__types_8h.html#a7a79069a208a479cdd52f066db18a775">AZONE_REGION</a>)
<a name="l01311"></a>01311             <span class="keywordflow">return</span> 1;
<a name="l01312"></a>01312         
<a name="l01313"></a>01313         <span class="keywordflow">for</span> (ar= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>)
<a name="l01314"></a>01314             <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a99bf72285d06e49b7fad6c270799b275">swinid</a> == sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac36068e2dc55a7532b24bb20bc7be837">subwinactive</a>)
<a name="l01315"></a>01315                 <span class="keywordflow">return</span> 1;
<a name="l01316"></a>01316     }   
<a name="l01317"></a>01317     <span class="keywordflow">return</span> 0;
<a name="l01318"></a>01318 }
<a name="l01319"></a>01319 
<a name="l01320"></a>01320 <span class="comment">/* operator call, WM + Window + screen already existed before */</span>
<a name="l01321"></a>01321 <span class="comment">/* Do NOT call in area/region queues! */</span>
<a name="l01322"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#aa94cb5eb794a477f414ab5a5358361b7">01322</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#a5055a39580a193e017808b6f51a0c8a3">ED_screen_set</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc)
<a name="l01323"></a>01323 {
<a name="l01324"></a>01324     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm= <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l01325"></a>01325     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win= <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l01326"></a>01326     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *oldscreen= <a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C);
<a name="l01327"></a>01327     <a class="code" href="../../d8/d7e/structID.html">ID</a> *id;
<a name="l01328"></a>01328     
<a name="l01329"></a>01329     <span class="comment">/* validate screen, it&#39;s called with notifier reference */</span>
<a name="l01330"></a>01330     <span class="keywordflow">for</span> (<span class="keywordtype">id</span>= <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C)-&gt;screen.first; <span class="keywordtype">id</span>; <span class="keywordtype">id</span>= id-&gt;<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l01331"></a>01331         <span class="keywordflow">if</span> (sc == (<a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *)<span class="keywordtype">id</span>)
<a name="l01332"></a>01332             <span class="keywordflow">break</span>;
<a name="l01333"></a>01333     <span class="keywordflow">if</span> (<span class="keywordtype">id</span>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) 
<a name="l01334"></a>01334         <span class="keywordflow">return</span>;
<a name="l01335"></a>01335     
<a name="l01336"></a>01336     <span class="comment">/* check for valid winid */</span>
<a name="l01337"></a>01337     <span class="keywordflow">if</span> (sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a022929944b7229e3652332ef1fcf30ab">winid</a>!=0 &amp;&amp; sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a022929944b7229e3652332ef1fcf30ab">winid</a>!=win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a479ce2e14de90b31094c8415d0427f06">winid</a>)
<a name="l01338"></a>01338         <span class="keywordflow">return</span>;
<a name="l01339"></a>01339     
<a name="l01340"></a>01340     <span class="keywordflow">if</span> (sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#afe2ef870210be87541acaac1ce677776">full</a>) {             <span class="comment">/* find associated full */</span>
<a name="l01341"></a>01341         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc1;
<a name="l01342"></a>01342         <span class="keywordflow">for</span> (sc1= <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C)-&gt;screen.first; sc1; sc1= sc1-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01343"></a>01343             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa= sc1-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01344"></a>01344             <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a62b30afc9f5a2f501be12a0917cebe35">full</a>==sc) {
<a name="l01345"></a>01345                 sc= sc1;
<a name="l01346"></a>01346                 <span class="keywordflow">break</span>;
<a name="l01347"></a>01347             }
<a name="l01348"></a>01348         }
<a name="l01349"></a>01349     }
<a name="l01350"></a>01350     
<a name="l01351"></a>01351     <span class="keywordflow">if</span> (oldscreen != sc) {
<a name="l01352"></a>01352         <a class="code" href="../../d9/d33/structwmTimer.html">wmTimer</a> *wt= oldscreen-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>;
<a name="l01353"></a>01353         <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l01354"></a>01354 
<a name="l01355"></a>01355         <span class="comment">/* remove handlers referencing areas in old screen */</span>
<a name="l01356"></a>01356         <span class="keywordflow">for</span> (sa = oldscreen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l01357"></a>01357             <a class="code" href="../../df/db0/wm__event__system_8c.html#a407191cc97e1da1806df311c21bf2c9e">WM_event_remove_area_handler</a>(&amp;win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a1ea8c9176e46638bd4cd9648c7f9fae2">modalhandlers</a>, sa);
<a name="l01358"></a>01358         }
<a name="l01359"></a>01359 
<a name="l01360"></a>01360         <span class="comment">/* we put timer to sleep, so screen_exit has to think there&#39;s no timer */</span>
<a name="l01361"></a>01361         oldscreen-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01362"></a>01362         <span class="keywordflow">if</span> (wt)
<a name="l01363"></a>01363             <a class="code" href="../../d7/d6e/wm__window_8c.html#aac640b2e0eec094b25ab707702fae91a">WM_event_timer_sleep</a>(wm, win, wt, 1);
<a name="l01364"></a>01364         
<a name="l01365"></a>01365         <a class="code" href="../../d1/d12/ED__screen_8h.html#a2604af7c1ea0cec7fdcace930add202a">ED_screen_exit</a>(C, win, oldscreen);
<a name="l01366"></a>01366         oldscreen-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>= wt;
<a name="l01367"></a>01367         
<a name="l01368"></a>01368         win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>= sc;
<a name="l01369"></a>01369         <a class="code" href="../../df/d01/BKE__context_8h.html#ab13ba74b18cfe8781bd0ec0543873dda">CTX_wm_window_set</a>(C, win);  <span class="comment">// stores C-&gt;wm.screen... hrmf</span>
<a name="l01370"></a>01370         
<a name="l01371"></a>01371         <span class="comment">/* prevent multiwin errors */</span>
<a name="l01372"></a>01372         sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a022929944b7229e3652332ef1fcf30ab">winid</a>= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a479ce2e14de90b31094c8415d0427f06">winid</a>;
<a name="l01373"></a>01373         
<a name="l01374"></a>01374         <a class="code" href="../../d1/d12/ED__screen_8h.html#ab11b1f04d75e4b026402b4ed556f3612">ED_screen_refresh</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C), <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C));
<a name="l01375"></a>01375         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a0dce5c73d06bfc518c4c6b2189df325d">NC_WINDOW</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01376"></a>01376         <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a4d138b3b2f069a9db1d8cc28c7ed071d">NC_SCREEN</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#aac177e3bec7e8bffd887a51a1dbfad11">ND_SCREENSET</a>, sc);
<a name="l01377"></a>01377         
<a name="l01378"></a>01378         <span class="comment">/* makes button hilites work */</span>
<a name="l01379"></a>01379         <a class="code" href="../../df/db0/wm__event__system_8c.html#a1d397b4836b1aa453112a4cc59550686">WM_event_add_mousemove</a>(C);
<a name="l01380"></a>01380     }
<a name="l01381"></a>01381 }
<a name="l01382"></a>01382 
<a name="l01383"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#abe7c62c485b2d636eaccb9f970101e07">01383</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/dbc/screen__edit_8c.html#abe7c62c485b2d636eaccb9f970101e07">ed_screen_used</a>(<a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm, <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc)
<a name="l01384"></a>01384 {
<a name="l01385"></a>01385     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win;
<a name="l01386"></a>01386 
<a name="l01387"></a>01387     <span class="keywordflow">for</span> (win=wm-&gt;<a class="code" href="../../d4/dc3/structwmWindowManager.html#a2b7d1cc89812b5104dc05ecfd46bce6b">windows</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; win; win=win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#accffa1b62f114b1781206c921fc92be1">next</a>)
<a name="l01388"></a>01388         <span class="keywordflow">if</span> (win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a> == sc)
<a name="l01389"></a>01389             <span class="keywordflow">return</span> 1;
<a name="l01390"></a>01390     
<a name="l01391"></a>01391     <span class="keywordflow">return</span> 0;
<a name="l01392"></a>01392 }
<a name="l01393"></a>01393 
<a name="l01394"></a>01394 <span class="comment">/* only call outside of area/region loops */</span>
<a name="l01395"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a7f7314ef1139c7c3991a11e5997dbc45">01395</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#ad9eb1577eba36376f3c8144dedfbc710">ED_screen_delete</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc)
<a name="l01396"></a>01396 {
<a name="l01397"></a>01397     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C);
<a name="l01398"></a>01398     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm= <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l01399"></a>01399     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win= <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l01400"></a>01400     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *newsc;
<a name="l01401"></a>01401     <span class="keywordtype">int</span> <span class="keyword">delete</span>= 1;
<a name="l01402"></a>01402     
<a name="l01403"></a>01403     <span class="comment">/* don&#39;t allow deleting temp fullscreens for now */</span>
<a name="l01404"></a>01404     <span class="keywordflow">if</span> (sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#afe2ef870210be87541acaac1ce677776">full</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a6459cd06551c17fe24f4a5c5fea79a39">SCREENFULL</a>) {
<a name="l01405"></a>01405         <span class="keywordflow">return</span>;
<a name="l01406"></a>01406     }
<a name="l01407"></a>01407     
<a name="l01408"></a>01408         
<a name="l01409"></a>01409     <span class="comment">/* screen can only be in use by one window at a time, so as</span>
<a name="l01410"></a>01410 <span class="comment">     * long as we are able to find a screen that is unused, we</span>
<a name="l01411"></a>01411 <span class="comment">     * can safely assume ours is not in use anywhere an delete it */</span>
<a name="l01412"></a>01412 
<a name="l01413"></a>01413     <span class="keywordflow">for</span> (newsc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9a2218bf385c8094a8ad82b78e80aebe">prev</a>; newsc; newsc=newsc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9a2218bf385c8094a8ad82b78e80aebe">prev</a>)
<a name="l01414"></a>01414         <span class="keywordflow">if</span> (!<a class="code" href="../../da/dbc/screen__edit_8c.html#abe7c62c485b2d636eaccb9f970101e07">ed_screen_used</a>(wm, newsc))
<a name="l01415"></a>01415             <span class="keywordflow">break</span>;
<a name="l01416"></a>01416     
<a name="l01417"></a>01417     <span class="keywordflow">if</span> (!newsc) {
<a name="l01418"></a>01418         <span class="keywordflow">for</span> (newsc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>; newsc; newsc=newsc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l01419"></a>01419             <span class="keywordflow">if</span> (!<a class="code" href="../../da/dbc/screen__edit_8c.html#abe7c62c485b2d636eaccb9f970101e07">ed_screen_used</a>(wm, newsc))
<a name="l01420"></a>01420                 <span class="keywordflow">break</span>;
<a name="l01421"></a>01421     }
<a name="l01422"></a>01422 
<a name="l01423"></a>01423     <span class="keywordflow">if</span> (!newsc)
<a name="l01424"></a>01424         <span class="keywordflow">return</span>;
<a name="l01425"></a>01425 
<a name="l01426"></a>01426     <a class="code" href="../../d1/d12/ED__screen_8h.html#a5055a39580a193e017808b6f51a0c8a3">ED_screen_set</a>(C, newsc);
<a name="l01427"></a>01427 
<a name="l01428"></a>01428     <span class="keywordflow">if</span> (<span class="keyword">delete</span> &amp;&amp; win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a> != sc)
<a name="l01429"></a>01429         <a class="code" href="../../d8/db1/BKE__library_8h.html#abdc66d0c4d8e9f6594809313b34d2843">free_libblock</a>(&amp;bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>, sc);
<a name="l01430"></a>01430 }
<a name="l01431"></a>01431 
<a name="l01432"></a>01432 <span class="comment">/* only call outside of area/region loops */</span>
<a name="l01433"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#abe2e7323910118a97fb16fa78d3a265c">01433</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#a9f5966663a764f73d1c95182c9ded365">ED_screen_set_scene</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene)
<a name="l01434"></a>01434 {
<a name="l01435"></a>01435     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C);
<a name="l01436"></a>01436     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l01437"></a>01437 
<a name="l01438"></a>01438     <span class="keywordflow">if</span> (screen == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01439"></a>01439         <span class="keywordflow">return</span>;
<a name="l01440"></a>01440     
<a name="l01441"></a>01441     <span class="keywordflow">if</span> (<a class="code" href="../../da/dbc/screen__edit_8c.html#abe7c62c485b2d636eaccb9f970101e07">ed_screen_used</a>(<a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C), screen))
<a name="l01442"></a>01442         <a class="code" href="../../da/d7a/ED__object_8h.html#a3dc41f10c2da040464140768d2898865">ED_object_exit_editmode</a>(C, <a class="code" href="../../da/d7a/ED__object_8h.html#a56f58f037f42277d234426571ee2de12">EM_FREEDATA</a>|<a class="code" href="../../da/d7a/ED__object_8h.html#a58e84e1ebbb3942ca4d7722b6c19c61d">EM_DO_UNDO</a>);
<a name="l01443"></a>01443 
<a name="l01444"></a>01444     <span class="keywordflow">for</span> (sc= <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C)-&gt;screen.first; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01445"></a>01445         <span class="keywordflow">if</span> ((<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.flag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a15ed23410ccdbd809549ffae53cbb4e4">USER_SCENEGLOBAL</a>) || sc==screen) {
<a name="l01446"></a>01446             
<a name="l01447"></a>01447             <span class="keywordflow">if</span> (scene != sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>) {
<a name="l01448"></a>01448                 <span class="comment">/* all areas endlocalview */</span>
<a name="l01449"></a>01449             <span class="comment">// XXX  ScrArea *sa= sc-&gt;areabase.first;</span>
<a name="l01450"></a>01450             <span class="comment">//  while (sa) {</span>
<a name="l01451"></a>01451             <span class="comment">//      endlocalview(sa);</span>
<a name="l01452"></a>01452             <span class="comment">//      sa= sa-&gt;next;</span>
<a name="l01453"></a>01453             <span class="comment">//  }       </span>
<a name="l01454"></a>01454                 sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>= scene;
<a name="l01455"></a>01455             }
<a name="l01456"></a>01456             
<a name="l01457"></a>01457         }
<a name="l01458"></a>01458     }
<a name="l01459"></a>01459     
<a name="l01460"></a>01460     <span class="comment">//  copy_view3d_lock(0);    /* space.c */</span>
<a name="l01461"></a>01461     
<a name="l01462"></a>01462     <span class="comment">/* are there cameras in the views that are not in the scene? */</span>
<a name="l01463"></a>01463     <span class="keywordflow">for</span> (sc= <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C)-&gt;screen.first; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01464"></a>01464         <span class="keywordflow">if</span> ( (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.flag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a15ed23410ccdbd809549ffae53cbb4e4">USER_SCENEGLOBAL</a>) || sc==screen) {
<a name="l01465"></a>01465             <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01466"></a>01466             <span class="keywordflow">while</span> (sa) {
<a name="l01467"></a>01467                 <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01468"></a>01468                 <span class="keywordflow">while</span> (sl) {
<a name="l01469"></a>01469                     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l01470"></a>01470                         <a class="code" href="../../d6/deb/structView3D.html">View3D</a> *v3d= (<a class="code" href="../../d6/deb/structView3D.html">View3D</a>*) sl;
<a name="l01471"></a>01471 
<a name="l01472"></a>01472                         <a class="code" href="../../d7/da3/BKE__screen_8h.html#a1cdd31b55cfea3a6df5d424141ef5b8a">BKE_screen_view3d_sync</a>(v3d, scene);
<a name="l01473"></a>01473 
<a name="l01474"></a>01474                         <span class="keywordflow">if</span> (!v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a> || !<a class="code" href="../../d8/d53/BKE__scene_8h.html#af038ab52dca2267b6418721c13b81e74">object_in_scene</a>(v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>, scene)) {
<a name="l01475"></a>01475                             v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>= <a class="code" href="../../d8/d53/BKE__scene_8h.html#abb034059e60f19f508f88bc867e01760">scene_find_camera</a>(sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>);
<a name="l01476"></a>01476                             <span class="comment">// XXX if (sc==curscreen) handle_view3d_lock();</span>
<a name="l01477"></a>01477                             <span class="keywordflow">if</span> (!v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#a4eb998ff28617b65a2e6c431f319ac9a">camera</a>) {
<a name="l01478"></a>01478                                 <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l01479"></a>01479                                 <span class="keywordflow">for</span> (ar=v3d-&gt;<a class="code" href="../../d6/deb/structView3D.html#ac9200c617c4513e638686629876c28ca">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l01480"></a>01480                                     <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a> == <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>) {
<a name="l01481"></a>01481                                         <a class="code" href="../../d9/d00/structRegionView3D.html">RegionView3D</a> *rv3d= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a1b743d806cf5169fd929df96d1133ba4">regiondata</a>;
<a name="l01482"></a>01482 
<a name="l01483"></a>01483                                         <span class="keywordflow">if</span> (rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8f435c152f17185773a21cd8b7067ebb">persp</a>==<a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#a4c869f8f07a58e54e43d35474bbe4757">RV3D_CAMOB</a>)
<a name="l01484"></a>01484                                             rv3d-&gt;<a class="code" href="../../d9/d00/structRegionView3D.html#a8f435c152f17185773a21cd8b7067ebb">persp</a>= <a class="code" href="../../d4/d06/DNA__view3d__types_8h.html#abfc50fa3da91cc0d90401d24414e2482">RV3D_PERSP</a>;
<a name="l01485"></a>01485                                     }
<a name="l01486"></a>01486                                 }
<a name="l01487"></a>01487                             }
<a name="l01488"></a>01488                         }
<a name="l01489"></a>01489                     }
<a name="l01490"></a>01490                     sl= sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>;
<a name="l01491"></a>01491                 }
<a name="l01492"></a>01492                 sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>;
<a name="l01493"></a>01493             }
<a name="l01494"></a>01494         }
<a name="l01495"></a>01495     }
<a name="l01496"></a>01496     
<a name="l01497"></a>01497     <a class="code" href="../../df/d01/BKE__context_8h.html#a197223f1af3429bb18e22f71ef4d4b60">CTX_data_scene_set</a>(C, scene);
<a name="l01498"></a>01498     <a class="code" href="../../d8/d53/BKE__scene_8h.html#a2786d63921fc3176178dfaa36b5c814e">set_scene_bg</a>(bmain, scene);
<a name="l01499"></a>01499     
<a name="l01500"></a>01500     <a class="code" href="../../d6/d53/ED__render_8h.html#a7b00cafb49cdf10d93730386ca71ea60">ED_render_engine_changed</a>(bmain);
<a name="l01501"></a>01501     <a class="code" href="../../d1/d12/ED__screen_8h.html#a064a1225eaf305ae55dc93b0d35fbf82">ED_update_for_newframe</a>(bmain, scene, screen, 1);
<a name="l01502"></a>01502     
<a name="l01503"></a>01503     <span class="comment">/* complete redraw */</span>
<a name="l01504"></a>01504     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a0dce5c73d06bfc518c4c6b2189df325d">NC_WINDOW</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01505"></a>01505     
<a name="l01506"></a>01506 }
<a name="l01507"></a>01507 
<a name="l01508"></a>01508 <span class="comment">/* only call outside of area/region loops */</span>
<a name="l01509"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a43d9995b721f5d0ef5c1b4e4b0a77e8b">01509</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#ab2b7a6b7f58f815090eaeb5e22ddc673">ED_screen_delete_scene</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene)
<a name="l01510"></a>01510 {
<a name="l01511"></a>01511     <a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain= <a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C);
<a name="l01512"></a>01512     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *newscene;
<a name="l01513"></a>01513 
<a name="l01514"></a>01514     <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9a2218bf385c8094a8ad82b78e80aebe">prev</a>)
<a name="l01515"></a>01515         newscene= scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#a9a2218bf385c8094a8ad82b78e80aebe">prev</a>;
<a name="l01516"></a>01516     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l01517"></a>01517         newscene= scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a68db741bd7a79e16f765bba66cf276b1">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>;
<a name="l01518"></a>01518     <span class="keywordflow">else</span>
<a name="l01519"></a>01519         <span class="keywordflow">return</span>;
<a name="l01520"></a>01520 
<a name="l01521"></a>01521     <a class="code" href="../../d1/d12/ED__screen_8h.html#a9f5966663a764f73d1c95182c9ded365">ED_screen_set_scene</a>(C, <a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C), newscene);
<a name="l01522"></a>01522 
<a name="l01523"></a>01523     <a class="code" href="../../d8/d53/BKE__scene_8h.html#a536471d259149fb46e69fb9d04c2c884">unlink_scene</a>(bmain, scene, newscene);
<a name="l01524"></a>01524 }
<a name="l01525"></a>01525 
<a name="l01526"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a21b9e22a2df2f0b64179c2e5323ba18e">01526</a> <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *<a class="code" href="../../d1/d12/ED__screen_8h.html#a5f595c7eca6737f06e997f7f45cd5d3a">ED_screen_full_newspace</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa, <span class="keywordtype">int</span> <a class="code" href="../../d4/d95/structScrArea.html#a41fdde87680287b354eca377ae99ed1e">type</a>)
<a name="l01527"></a>01527 {
<a name="l01528"></a>01528     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win= <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l01529"></a>01529     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen= <a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C);
<a name="l01530"></a>01530     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *newsa= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01531"></a>01531 
<a name="l01532"></a>01532     <span class="keywordflow">if</span> (!sa || sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a62b30afc9f5a2f501be12a0917cebe35">full</a>==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01533"></a>01533         newsa= <a class="code" href="../../d1/d12/ED__screen_8h.html#a7b2bf23245370fe77c68ea31ddb3b509">ED_screen_full_toggle</a>(C, win, sa);
<a name="l01534"></a>01534     }
<a name="l01535"></a>01535     
<a name="l01536"></a>01536     <span class="keywordflow">if</span> (!newsa) {
<a name="l01537"></a>01537         <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a62b30afc9f5a2f501be12a0917cebe35">full</a>) {
<a name="l01538"></a>01538             <span class="comment">/* if this has been called from the temporary info header generated in</span>
<a name="l01539"></a>01539 <span class="comment">             * temp fullscreen layouts, find the correct fullscreen area to change</span>
<a name="l01540"></a>01540 <span class="comment">             * to create a new space inside */</span>
<a name="l01541"></a>01541             <span class="keywordflow">for</span> (newsa = screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; newsa; newsa=newsa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l01542"></a>01542                 <span class="keywordflow">if</span> (!(sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a95330fccbc8eb82dc12aefadd1afd8db">flag</a> &amp; <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a4a23c1ffc32bcda78d7a5a373608b1e4">AREA_TEMP_INFO</a>))
<a name="l01543"></a>01543                     <span class="keywordflow">break</span>;
<a name="l01544"></a>01544             }
<a name="l01545"></a>01545         }
<a name="l01546"></a>01546         <span class="keywordflow">else</span> {
<a name="l01547"></a>01547             newsa = sa;
<a name="l01548"></a>01548         }
<a name="l01549"></a>01549     }
<a name="l01550"></a>01550     
<a name="l01551"></a>01551     <a class="code" href="../../d1/d12/ED__screen_8h.html#a1768c9e14c6c8f09f1b8175ca1d7f3cf">ED_area_newspace</a>(C, newsa, type);
<a name="l01552"></a>01552     
<a name="l01553"></a>01553     <span class="keywordflow">return</span> newsa;
<a name="l01554"></a>01554 }
<a name="l01555"></a>01555 
<a name="l01556"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a922798660d4aaf5edfedbea1a4b14700">01556</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#a445dee5183a248ba3f77cf1e56240819">ED_screen_full_prevspace</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa)
<a name="l01557"></a>01557 {
<a name="l01558"></a>01558     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win= <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l01559"></a>01559 
<a name="l01560"></a>01560     <a class="code" href="../../d1/d12/ED__screen_8h.html#ad402cde74964d06df69a976c69bafb9a">ED_area_prevspace</a>(C, sa);
<a name="l01561"></a>01561     
<a name="l01562"></a>01562     <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a62b30afc9f5a2f501be12a0917cebe35">full</a>)
<a name="l01563"></a>01563         <a class="code" href="../../d1/d12/ED__screen_8h.html#a7b2bf23245370fe77c68ea31ddb3b509">ED_screen_full_toggle</a>(C, win, sa);
<a name="l01564"></a>01564 }
<a name="l01565"></a>01565 
<a name="l01566"></a>01566 <span class="comment">/* restore a screen / area back to default operation, after temp fullscreen modes */</span>
<a name="l01567"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a36f18578a99e72d844d5d0f8fd2b97f3">01567</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#aa9ce9ca868cc6327957c5d0b542100f8">ED_screen_full_restore</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa)
<a name="l01568"></a>01568 {
<a name="l01569"></a>01569     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win= <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l01570"></a>01570     <a class="code" href="../../d4/d63/structSpaceLink.html">SpaceLink</a> *sl = sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01571"></a>01571     
<a name="l01572"></a>01572     <span class="comment">/* if fullscreen area has a secondary space (such as a file browser or fullscreen render </span>
<a name="l01573"></a>01573 <span class="comment">     * overlaid on top of a existing setup) then return to the previous space */</span>
<a name="l01574"></a>01574     
<a name="l01575"></a>01575     <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a02205c8e58d3bffda62cb69123b36629">next</a>) {
<a name="l01576"></a>01576         <span class="comment">/* specific checks for space types */</span>
<a name="l01577"></a>01577 
<a name="l01578"></a>01578         <span class="keywordtype">int</span> sima_restore = 0;
<a name="l01579"></a>01579 
<a name="l01580"></a>01580         <span class="comment">/* Special check added for non-render image window (back from fullscreen through &quot;Back to Previous&quot; button) */</span>
<a name="l01581"></a>01581         <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a>) {
<a name="l01582"></a>01582             <a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *sima= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01583"></a>01583             <span class="keywordflow">if</span> (!(sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a5aa3ece1e2d42bb0018dea9decabf8fe">flag</a> &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#aebfacc88095acd69edfcb2c4c6108d39">SI_PREVSPACE</a>) &amp;&amp; !(sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a5aa3ece1e2d42bb0018dea9decabf8fe">flag</a> &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a03569567d18c0d70499885327b7398a5">SI_FULLWINDOW</a>))
<a name="l01584"></a>01584                 sima_restore = 1;
<a name="l01585"></a>01585         }
<a name="l01586"></a>01586 
<a name="l01587"></a>01587         <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cab0433b569331024d6cf6123194fc10a2">SPACE_IMAGE</a> &amp;&amp; !sima_restore) {
<a name="l01588"></a>01588             <a class="code" href="../../db/d0f/structSpaceImage.html">SpaceImage</a> *sima= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a3e912d89fe2993ce473b0718900723d4">spacedata</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01589"></a>01589             <span class="keywordflow">if</span> (sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a5aa3ece1e2d42bb0018dea9decabf8fe">flag</a> &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#aebfacc88095acd69edfcb2c4c6108d39">SI_PREVSPACE</a>)
<a name="l01590"></a>01590                 sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a5aa3ece1e2d42bb0018dea9decabf8fe">flag</a> &amp;= ~<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#aebfacc88095acd69edfcb2c4c6108d39">SI_PREVSPACE</a>;
<a name="l01591"></a>01591             <span class="keywordflow">if</span> (sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a5aa3ece1e2d42bb0018dea9decabf8fe">flag</a> &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a03569567d18c0d70499885327b7398a5">SI_FULLWINDOW</a>) {
<a name="l01592"></a>01592                 sima-&gt;<a class="code" href="../../db/d0f/structSpaceImage.html#a5aa3ece1e2d42bb0018dea9decabf8fe">flag</a> &amp;= ~<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a03569567d18c0d70499885327b7398a5">SI_FULLWINDOW</a>;
<a name="l01593"></a>01593                 <a class="code" href="../../d1/d12/ED__screen_8h.html#a445dee5183a248ba3f77cf1e56240819">ED_screen_full_prevspace</a>(C, sa);
<a name="l01594"></a>01594             }
<a name="l01595"></a>01595         }
<a name="l01596"></a>01596         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sl-&gt;<a class="code" href="../../d4/d63/structSpaceLink.html#a842775af6c8ee1e2b4fd1fa4ab77a633">spacetype</a> == <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752ca5f4c324d2af06c247780942931169c7c">SPACE_FILE</a>) {
<a name="l01597"></a>01597             <a class="code" href="../../d1/d12/ED__screen_8h.html#a445dee5183a248ba3f77cf1e56240819">ED_screen_full_prevspace</a>(C, sa);
<a name="l01598"></a>01598         }
<a name="l01599"></a>01599         <span class="keywordflow">else</span> {
<a name="l01600"></a>01600             <a class="code" href="../../d1/d12/ED__screen_8h.html#a7b2bf23245370fe77c68ea31ddb3b509">ED_screen_full_toggle</a>(C, win, sa);
<a name="l01601"></a>01601         }
<a name="l01602"></a>01602     }
<a name="l01603"></a>01603     <span class="comment">/* otherwise just tile the area again */</span>
<a name="l01604"></a>01604     <span class="keywordflow">else</span> {
<a name="l01605"></a>01605         <a class="code" href="../../d1/d12/ED__screen_8h.html#a7b2bf23245370fe77c68ea31ddb3b509">ED_screen_full_toggle</a>(C, win, sa);
<a name="l01606"></a>01606     }
<a name="l01607"></a>01607 }
<a name="l01608"></a>01608 
<a name="l01609"></a>01609 <span class="comment">/* this function toggles: if area is full then the parent will be restored */</span>
<a name="l01610"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#aefe5217304aca43eaa2fd1e2efc4f7dc">01610</a> <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *<a class="code" href="../../d1/d12/ED__screen_8h.html#a7b2bf23245370fe77c68ea31ddb3b509">ED_screen_full_toggle</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win, <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa)
<a name="l01611"></a>01611 {
<a name="l01612"></a>01612     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc, *oldscreen;
<a name="l01613"></a>01613     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l01614"></a>01614 
<a name="l01615"></a>01615     <span class="keywordflow">if</span> (sa) {
<a name="l01616"></a>01616         <span class="comment">/* ensure we don&#39;t have a button active anymore, can crash when</span>
<a name="l01617"></a>01617 <span class="comment">         * switching screens with tooltip open because region and tooltip</span>
<a name="l01618"></a>01618 <span class="comment">         * are no longer in the same screen */</span>
<a name="l01619"></a>01619         <span class="keywordflow">for</span> (ar=sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar=ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>)
<a name="l01620"></a>01620             <a class="code" href="../../d8/d1e/UI__interface_8h.html#a3111de0bcf6a2a301ac52bee57c33d81">uiFreeBlocks</a>(C, &amp;ar-&gt;<a class="code" href="../../da/d23/structARegion.html#afbd94c7a138066b4e773e9d3401b0d87">uiblocks</a>);
<a name="l01621"></a>01621         
<a name="l01622"></a>01622         <span class="comment">/* prevent hanging header prints */</span>
<a name="l01623"></a>01623         <a class="code" href="../../d1/d12/ED__screen_8h.html#a3899c7d0aebef9cc11992a7de3e5f397">ED_area_headerprint</a>(sa, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01624"></a>01624     }
<a name="l01625"></a>01625 
<a name="l01626"></a>01626     <span class="keywordflow">if</span> (sa &amp;&amp; sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a62b30afc9f5a2f501be12a0917cebe35">full</a>) {
<a name="l01627"></a>01627         <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *old;
<a name="l01628"></a>01628         <span class="comment">/*short fulltype;*/</span> <span class="comment">/*UNUSED*/</span>
<a name="l01629"></a>01629 
<a name="l01630"></a>01630         sc= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a62b30afc9f5a2f501be12a0917cebe35">full</a>;       <span class="comment">/* the old screen to restore */</span>
<a name="l01631"></a>01631         oldscreen= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>; <span class="comment">/* the one disappearing */</span>
<a name="l01632"></a>01632 
<a name="l01633"></a>01633         <span class="comment">/*fulltype = sc-&gt;full;*/</span>
<a name="l01634"></a>01634         sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#afe2ef870210be87541acaac1ce677776">full</a>= 0;
<a name="l01635"></a>01635 
<a name="l01636"></a>01636         <span class="comment">/* removed: SCREENAUTOPLAY exception here */</span>
<a name="l01637"></a>01637     
<a name="l01638"></a>01638         <span class="comment">/* find old area */</span>
<a name="l01639"></a>01639         <span class="keywordflow">for</span> (old= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; old; old= old-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>)
<a name="l01640"></a>01640             <span class="keywordflow">if</span> (old-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a62b30afc9f5a2f501be12a0917cebe35">full</a>) <span class="keywordflow">break</span>;
<a name="l01641"></a>01641         <span class="keywordflow">if</span> (old==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01642"></a>01642             <span class="keywordflow">if</span> (<a class="code" href="../../dc/dc8/util__md5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>.debug &amp; <a class="code" href="../../d1/d8c/BKE__global_8h.html#a726ca809ffd3d67ab4b8476646f26635a1207ca157c84a6be5a8a36c691c4aa72">G_DEBUG</a>)
<a name="l01643"></a>01643                 printf(<span class="stringliteral">&quot;%s: something wrong in areafullscreen\n&quot;</span>, __func__);
<a name="l01644"></a>01644             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01645"></a>01645         }
<a name="l01646"></a>01646 
<a name="l01647"></a>01647         <a class="code" href="../../d1/d0d/area_8c.html#a36df79b09edb01547719640dd5796dcb">area_copy_data</a>(old, sa, 1); <span class="comment">/*  1 = swap spacelist */</span>
<a name="l01648"></a>01648         <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a95330fccbc8eb82dc12aefadd1afd8db">flag</a> &amp; <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a4a23c1ffc32bcda78d7a5a373608b1e4">AREA_TEMP_INFO</a>) sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a95330fccbc8eb82dc12aefadd1afd8db">flag</a> &amp;= ~<a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a4a23c1ffc32bcda78d7a5a373608b1e4">AREA_TEMP_INFO</a>;
<a name="l01649"></a>01649         old-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a62b30afc9f5a2f501be12a0917cebe35">full</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01650"></a>01650 
<a name="l01651"></a>01651         <span class="comment">/* animtimer back */</span>
<a name="l01652"></a>01652         sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>= oldscreen-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>;
<a name="l01653"></a>01653         oldscreen-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01654"></a>01654 
<a name="l01655"></a>01655         <a class="code" href="../../d1/d12/ED__screen_8h.html#a5055a39580a193e017808b6f51a0c8a3">ED_screen_set</a>(C, sc);
<a name="l01656"></a>01656 
<a name="l01657"></a>01657         <a class="code" href="../../d7/da3/BKE__screen_8h.html#ab06501c5f61a0ef393a455f251466e84">free_screen</a>(oldscreen);
<a name="l01658"></a>01658         <a class="code" href="../../d8/db1/BKE__library_8h.html#abdc66d0c4d8e9f6594809313b34d2843">free_libblock</a>(&amp;<a class="code" href="../../df/d01/BKE__context_8h.html#ae849d2f7c2427ac6b75ee0c5ffcead6c">CTX_data_main</a>(C)-&gt;screen, oldscreen);
<a name="l01659"></a>01659 
<a name="l01660"></a>01660     }
<a name="l01661"></a>01661     <span class="keywordflow">else</span> {
<a name="l01662"></a>01662         <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *newa;
<a name="l01663"></a>01663         <span class="keywordtype">char</span> newname[<a class="code" href="../../d3/dfb/DNA__ID_8h.html#a6d7bce2e9ad79af316c9690a5b84b75c">MAX_ID_NAME</a>-2];
<a name="l01664"></a>01664 
<a name="l01665"></a>01665         oldscreen= win-&gt;<a class="code" href="../../dc/da4/structwmWindow.html#a5ec98a9e430fdc21a8d0f0b8dcc6ed05">screen</a>;
<a name="l01666"></a>01666 
<a name="l01667"></a>01667         <span class="comment">/* nothing wrong with having only 1 area, as far as I can see...</span>
<a name="l01668"></a>01668 <span class="comment">         * is there only 1 area? */</span>
<a name="l01669"></a>01669 <span class="preprocessor">#if 0</span>
<a name="l01670"></a>01670 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (oldscreen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>==oldscreen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#a46f89850aad8cd09b34b5bdc3aa8f91a">last</a>)
<a name="l01671"></a>01671             <span class="keywordflow">return</span> <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01672"></a>01672 <span class="preprocessor">#endif</span>
<a name="l01673"></a>01673 <span class="preprocessor"></span>
<a name="l01674"></a>01674         oldscreen-&gt;<a class="code" href="../../de/de7/structbScreen.html#afe2ef870210be87541acaac1ce677776">full</a> = <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a6459cd06551c17fe24f4a5c5fea79a39">SCREENFULL</a>;
<a name="l01675"></a>01675         <a class="code" href="../../d3/db3/BLI__string_8h.html#a150551c0e3b1dc65b4c9021461f468a9">BLI_snprintf</a>(newname, <span class="keyword">sizeof</span>(newname), <span class="stringliteral">&quot;%s-%s&quot;</span>, oldscreen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#ad43a3d119e40a8479518fd876781e692">name</a>+2, <span class="stringliteral">&quot;full&quot;</span>);
<a name="l01676"></a>01676         sc= <a class="code" href="../../d1/d12/ED__screen_8h.html#a9379b3ffb23e6992684baeba61ab2e76">ED_screen_add</a>(win, oldscreen-&gt;<a class="code" href="../../de/de7/structbScreen.html#a98cbd326f3b4179f769d007556e14999">scene</a>, newname);
<a name="l01677"></a>01677         sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#afe2ef870210be87541acaac1ce677776">full</a> = <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a6459cd06551c17fe24f4a5c5fea79a39">SCREENFULL</a>; <span class="comment">// XXX</span>
<a name="l01678"></a>01678 
<a name="l01679"></a>01679         <span class="comment">/* timer */</span>
<a name="l01680"></a>01680         sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>= oldscreen-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>;
<a name="l01681"></a>01681         oldscreen-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01682"></a>01682 
<a name="l01683"></a>01683         <span class="comment">/* returns the top small area */</span>
<a name="l01684"></a>01684         newa= <a class="code" href="../../da/dbc/screen__edit_8c.html#afa19ca1db492f3b27cdb09e59faee9d4">area_split</a>(sc, (<a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *)sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>, <span class="charliteral">&#39;h&#39;</span>, 0.99f, 1);
<a name="l01685"></a>01685         <a class="code" href="../../d1/d12/ED__screen_8h.html#a1768c9e14c6c8f09f1b8175ca1d7f3cf">ED_area_newspace</a>(C, newa, <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752cafbebfeeb0fd0f7c61564dec31fe64450">SPACE_INFO</a>);
<a name="l01686"></a>01686 
<a name="l01687"></a>01687         <span class="comment">/* use random area when we have no active one, e.g. when the</span>
<a name="l01688"></a>01688 <span class="comment">         * mouse is outside of the window and we open a file browser */</span>
<a name="l01689"></a>01689         <span class="keywordflow">if</span> (!sa)
<a name="l01690"></a>01690             sa= oldscreen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01691"></a>01691 
<a name="l01692"></a>01692         <span class="comment">/* copy area */</span>
<a name="l01693"></a>01693         newa= newa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#afd401d2e00b83fd5651212e3f022f4c9">prev</a>;
<a name="l01694"></a>01694         <a class="code" href="../../d1/d0d/area_8c.html#a36df79b09edb01547719640dd5796dcb">area_copy_data</a>(newa, sa, 1);    <span class="comment">/* 1 = swap spacelist */</span>
<a name="l01695"></a>01695         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a95330fccbc8eb82dc12aefadd1afd8db">flag</a> |= <a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a4a23c1ffc32bcda78d7a5a373608b1e4">AREA_TEMP_INFO</a>;
<a name="l01696"></a>01696 
<a name="l01697"></a>01697         sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a62b30afc9f5a2f501be12a0917cebe35">full</a>= oldscreen;
<a name="l01698"></a>01698         newa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a62b30afc9f5a2f501be12a0917cebe35">full</a>= oldscreen;
<a name="l01699"></a>01699         newa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a62b30afc9f5a2f501be12a0917cebe35">full</a>= oldscreen; <span class="comment">// XXX</span>
<a name="l01700"></a>01700 
<a name="l01701"></a>01701         <a class="code" href="../../d1/d12/ED__screen_8h.html#a5055a39580a193e017808b6f51a0c8a3">ED_screen_set</a>(C, sc);
<a name="l01702"></a>01702     }
<a name="l01703"></a>01703 
<a name="l01704"></a>01704     <span class="comment">/* XXX bad code: setscreen() ends with first area active. fullscreen render assumes this too */</span>
<a name="l01705"></a>01705     <a class="code" href="../../df/d01/BKE__context_8h.html#af38e3db529bba2578831bbe57940570b">CTX_wm_area_set</a>(C, sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>);
<a name="l01706"></a>01706 
<a name="l01707"></a>01707     <span class="keywordflow">return</span> sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>;
<a name="l01708"></a>01708 }
<a name="l01709"></a>01709 
<a name="l01710"></a>01710 <span class="comment">/* update frame rate info for viewport drawing */</span>
<a name="l01711"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a532149d51be313c942dd899256f308ee">01711</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#a7456da2520f53f4f13c606b725722d0d">ED_refresh_viewport_fps</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>)
<a name="l01712"></a>01712 {
<a name="l01713"></a>01713     <a class="code" href="../../d9/d33/structwmTimer.html">wmTimer</a> *animtimer= <a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C)-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>;
<a name="l01714"></a>01714     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l01715"></a>01715     
<a name="l01716"></a>01716     <span class="comment">/* is anim playback running? */</span>
<a name="l01717"></a>01717     <span class="keywordflow">if</span> (animtimer &amp;&amp; (<a class="code" href="../../d0/de2/namespacegjkepa2__impl.html#a6d41857f051fae50b68076f99f439398">U</a>.uiflag &amp; <a class="code" href="../../d7/de4/DNA__userdef__types_8h.html#a131ffc0054af0ae1e30c645724263bdd">USER_SHOW_FPS</a>)) {
<a name="l01718"></a>01718         <a class="code" href="../../da/dda/structScreenFrameRateInfo.html">ScreenFrameRateInfo</a> *fpsi= scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a63fc7eaaf0da3042f687458e69d45de1">fps_info</a>;
<a name="l01719"></a>01719         
<a name="l01720"></a>01720         <span class="comment">/* if there isn&#39;t any info, init it first */</span>
<a name="l01721"></a>01721         <span class="keywordflow">if</span> (fpsi == <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01722"></a>01722             fpsi= scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a63fc7eaaf0da3042f687458e69d45de1">fps_info</a>= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/dda/structScreenFrameRateInfo.html">ScreenFrameRateInfo</a>), <span class="stringliteral">&quot;refresh_viewport_fps fps_info&quot;</span>);
<a name="l01723"></a>01723         
<a name="l01724"></a>01724         <span class="comment">/* update the values */</span>
<a name="l01725"></a>01725         fpsi-&gt;<a class="code" href="../../da/dda/structScreenFrameRateInfo.html#a111f06489ef9e85a6244f63eb261205a">redrawtime</a>= fpsi-&gt;<a class="code" href="../../da/dda/structScreenFrameRateInfo.html#a12031a2e035a497a80e5b8a96a65cc02">lredrawtime</a>;
<a name="l01726"></a>01726         fpsi-&gt;<a class="code" href="../../da/dda/structScreenFrameRateInfo.html#a12031a2e035a497a80e5b8a96a65cc02">lredrawtime</a>= animtimer-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a199d75caf175e15a8256a7552bada95a">ltime</a>;
<a name="l01727"></a>01727     }
<a name="l01728"></a>01728     <span class="keywordflow">else</span> {  
<a name="l01729"></a>01729         <span class="comment">/* playback stopped or shouldn&#39;t be running */</span>
<a name="l01730"></a>01730         <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a63fc7eaaf0da3042f687458e69d45de1">fps_info</a>)
<a name="l01731"></a>01731             <a class="code" href="../../da/d2b/mallocn_8c.html#aebca1f40b6b3b5815677a99dc56670d9">MEM_freeN</a>(scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a63fc7eaaf0da3042f687458e69d45de1">fps_info</a>);
<a name="l01732"></a>01732         scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a63fc7eaaf0da3042f687458e69d45de1">fps_info</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01733"></a>01733     }
<a name="l01734"></a>01734 }
<a name="l01735"></a>01735 
<a name="l01736"></a>01736 <span class="comment">/* redraws: uses defines from stime-&gt;redraws </span>
<a name="l01737"></a>01737 <span class="comment"> * enable: 1 - forward on, -1 - backwards on, 0 - off</span>
<a name="l01738"></a>01738 <span class="comment"> */</span>
<a name="l01739"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#aa5fbda3afa4a5ee2c5e813952a5aee8d">01739</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#a1ab95db1d243febac8044dcc7a1cc342">ED_screen_animation_timer</a>(<a class="code" href="../../d5/df1/structbContext.html">bContext</a> *<a class="code" href="../../d7/d0d/node__texture__proc_8c.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <span class="keywordtype">int</span> redraws, <span class="keywordtype">int</span> refresh, <span class="keywordtype">int</span> sync, <span class="keywordtype">int</span> enable)
<a name="l01740"></a>01740 {
<a name="l01741"></a>01741     <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen= <a class="code" href="../../df/d01/BKE__context_8h.html#aa054e49f38f3c9becfebc4013ecf457f">CTX_wm_screen</a>(C);
<a name="l01742"></a>01742     <a class="code" href="../../d4/dc3/structwmWindowManager.html">wmWindowManager</a> *wm= <a class="code" href="../../df/d01/BKE__context_8h.html#a5dcb9150a17a8907a3da33993063637e">CTX_wm_manager</a>(C);
<a name="l01743"></a>01743     <a class="code" href="../../dc/da4/structwmWindow.html">wmWindow</a> *win= <a class="code" href="../../df/d01/BKE__context_8h.html#af86d2cf919d95eaefc99c2c3e553057e">CTX_wm_window</a>(C);
<a name="l01744"></a>01744     <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene= <a class="code" href="../../df/d01/BKE__context_8h.html#a0bcac8ad3452a040293c01084665a258">CTX_data_scene</a>(C);
<a name="l01745"></a>01745     
<a name="l01746"></a>01746     <span class="keywordflow">if</span> (screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>)
<a name="l01747"></a>01747         <a class="code" href="../../d7/d6e/wm__window_8c.html#a1a9f31ba88dd1dd3982b3d8f02de2e75">WM_event_remove_timer</a>(wm, win, screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>);
<a name="l01748"></a>01748     screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01749"></a>01749     
<a name="l01750"></a>01750     <span class="keywordflow">if</span> (enable) {
<a name="l01751"></a>01751         <a class="code" href="../../d3/d73/structScreenAnimData.html">ScreenAnimData</a> *sad= <a class="code" href="../../da/d2b/mallocn_8c.html#ab1235f6c94203e95da6076dbeb355894">MEM_callocN</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d3/d73/structScreenAnimData.html">ScreenAnimData</a>), <span class="stringliteral">&quot;ScreenAnimData&quot;</span>);
<a name="l01752"></a>01752         
<a name="l01753"></a>01753         screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>= <a class="code" href="../../d7/d6e/wm__window_8c.html#af5bdd7109c7ea81c77a89d9f41585f3a">WM_event_add_timer</a>(wm, win, <a class="code" href="../../d1/d40/wm__event__types_8h.html#af1b746ba5ab7d0ab657156ebda0f290c">TIMER0</a>, (1.0/<a class="code" href="../../d4/db3/DNA__scene__types_8h.html#ac92ca5ab87034a348decad7ee8d4bd1b">FPS</a>));
<a name="l01754"></a>01754         
<a name="l01755"></a>01755         sad-&gt;<a class="code" href="../../d3/d73/structScreenAnimData.html#a693e97f3eefe734198557966e80ff0c3">ar</a>= <a class="code" href="../../df/d01/BKE__context_8h.html#acfdde96de6c66805749111818756b92f">CTX_wm_region</a>(C);
<a name="l01756"></a>01756         <span class="comment">/* if startframe is larger than current frame, we put currentframe on startframe.</span>
<a name="l01757"></a>01757 <span class="comment">         * note: first frame then is not drawn! (ton) */</span>
<a name="l01758"></a>01758         <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a97f52582406befb3dba13b121d886526">sfra</a> &gt; scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a>) {
<a name="l01759"></a>01759             sad-&gt;<a class="code" href="../../d3/d73/structScreenAnimData.html#ad221cdd82cb471b99b7abf9eb06abc31">sfra</a>= scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a>;
<a name="l01760"></a>01760             scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a>= scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#a97f52582406befb3dba13b121d886526">sfra</a>;
<a name="l01761"></a>01761         }
<a name="l01762"></a>01762         <span class="keywordflow">else</span>
<a name="l01763"></a>01763             sad-&gt;<a class="code" href="../../d3/d73/structScreenAnimData.html#ad221cdd82cb471b99b7abf9eb06abc31">sfra</a> = scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a>;
<a name="l01764"></a>01764         sad-&gt;<a class="code" href="../../d3/d73/structScreenAnimData.html#aa0d6267fbd4d67d9a5fe3d28798bb87e">redraws</a>= redraws;
<a name="l01765"></a>01765         sad-&gt;<a class="code" href="../../d3/d73/structScreenAnimData.html#ad45fc3cadfdfcb8feac97ee7498ae3ed">refresh</a>= refresh;
<a name="l01766"></a>01766         sad-&gt;<a class="code" href="../../d3/d73/structScreenAnimData.html#aab5a57eacb4ece43e1f6ebd58f08d026">flag</a> |= (enable &lt; 0)? <a class="code" href="../../d1/d85/ED__screen__types_8h.html#a3babbf89cae9b856a12864a41506efbdaa00169184290913b6d0aaba541540659">ANIMPLAY_FLAG_REVERSE</a>: 0;
<a name="l01767"></a>01767         sad-&gt;<a class="code" href="../../d3/d73/structScreenAnimData.html#aab5a57eacb4ece43e1f6ebd58f08d026">flag</a> |= (sync == 0)? <a class="code" href="../../d1/d85/ED__screen__types_8h.html#a3babbf89cae9b856a12864a41506efbda89bb89be8598ee09886b3e68a0ae3276">ANIMPLAY_FLAG_NO_SYNC</a>: (sync == 1)? <a class="code" href="../../d1/d85/ED__screen__types_8h.html#a3babbf89cae9b856a12864a41506efbdaaa0253682d68ad738ccb9f26d44a8c41">ANIMPLAY_FLAG_SYNC</a>: 0;
<a name="l01768"></a>01768         
<a name="l01769"></a>01769         screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a7e5850b6474f3948cb59cbd188ce68a6">customdata</a>= sad;
<a name="l01770"></a>01770         
<a name="l01771"></a>01771     }
<a name="l01772"></a>01772     <span class="comment">/* notifier catched by top header, for button */</span>
<a name="l01773"></a>01773     <a class="code" href="../../df/db0/wm__event__system_8c.html#a6a6bfb771c3639a4f1038d56a3fa0217">WM_event_add_notifier</a>(C, <a class="code" href="../../d4/ddc/WM__types_8h.html#a4d138b3b2f069a9db1d8cc28c7ed071d">NC_SCREEN</a>|<a class="code" href="../../d4/ddc/WM__types_8h.html#a5a114b363a8646f4d29e416587b50480">ND_ANIMPLAY</a>, screen);
<a name="l01774"></a>01774 }
<a name="l01775"></a>01775 
<a name="l01776"></a>01776 <span class="comment">/* helper for screen_animation_play() - only to be used for TimeLine */</span>
<a name="l01777"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#ae0485d845f12b777a8cee392ec97f7eb">01777</a> <span class="keyword">static</span> <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *<a class="code" href="../../da/dbc/screen__edit_8c.html#ae0485d845f12b777a8cee392ec97f7eb">time_top_left_3dwindow</a>(<a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen)
<a name="l01778"></a>01778 {
<a name="l01779"></a>01779     <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *aret= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01780"></a>01780     <a class="code" href="../../d4/d95/structScrArea.html">ScrArea</a> *sa;
<a name="l01781"></a>01781     <span class="keywordtype">int</span> <a class="code" href="../../d0/d4b/blender_2imbuf_2intern_2dds_2Common_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>= 10000;
<a name="l01782"></a>01782     
<a name="l01783"></a>01783     <span class="keywordflow">for</span> (sa= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#ae2f4a800c4c58fe953d91fe8136a0d0f">areabase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sa; sa= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a884b59339f5c0d55408f8727bfc799b7">next</a>) {
<a name="l01784"></a>01784         <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a124203529b9ea4c84ca8f8ae4efff3e3">spacetype</a>==<a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a5efefa44b296976f2147b8acbed1752caf4af925b582bb7d7590235f90a38c8a9">SPACE_VIEW3D</a>) {
<a name="l01785"></a>01785             <a class="code" href="../../da/d23/structARegion.html">ARegion</a> *ar;
<a name="l01786"></a>01786             <span class="keywordflow">for</span> (ar= sa-&gt;<a class="code" href="../../d4/d95/structScrArea.html#a9f3cbd74b3cf2a0660a2db120e956cbf">regionbase</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; ar; ar= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#a7193c0e912cca4010db0f244f2dec0d0">next</a>) {
<a name="l01787"></a>01787                 <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ad430a35493ef271e772179ccb7abb767">regiontype</a>==<a class="code" href="../../d4/da4/DNA__screen__types_8h.html#a425be5f49e9c31d8d13d53190a3e7bc2a3d4303928de6d095b8db2a0637930a63">RGN_TYPE_WINDOW</a>) {
<a name="l01788"></a>01788                     <span class="keywordflow">if</span> (ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> - ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a> &lt; min) {
<a name="l01789"></a>01789                         aret= ar;
<a name="l01790"></a>01790                         min= ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#acdf13419de6bc3f4944a981589bc3a03">xmin</a> - ar-&gt;<a class="code" href="../../da/d23/structARegion.html#ac2944792e9f57effa923f02b3a40ac62">winrct</a>.<a class="code" href="../../d0/d28/structrcti.html#a1d1838135b30932a8ce557885d924518">ymin</a>;
<a name="l01791"></a>01791                     }
<a name="l01792"></a>01792                 }
<a name="l01793"></a>01793             }
<a name="l01794"></a>01794         }
<a name="l01795"></a>01795     }
<a name="l01796"></a>01796 
<a name="l01797"></a>01797     <span class="keywordflow">return</span> aret;
<a name="l01798"></a>01798 }
<a name="l01799"></a>01799 
<a name="l01800"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#a4cf15a657e2bb480ae834279b2bc9e9e">01800</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#a0fc814a287a3eae17925e05ab3ebbaf0">ED_screen_animation_timer_update</a>(<a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen, <span class="keywordtype">int</span> redraws, <span class="keywordtype">int</span> refresh)
<a name="l01801"></a>01801 {
<a name="l01802"></a>01802     <span class="keywordflow">if</span> (screen &amp;&amp; screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>) {
<a name="l01803"></a>01803         <a class="code" href="../../d9/d33/structwmTimer.html">wmTimer</a> *wt= screen-&gt;<a class="code" href="../../de/de7/structbScreen.html#aceeb55809d2fb599d429d03df9c60b99">animtimer</a>;
<a name="l01804"></a>01804         <a class="code" href="../../d3/d73/structScreenAnimData.html">ScreenAnimData</a> *sad= wt-&gt;<a class="code" href="../../d9/d33/structwmTimer.html#a7e5850b6474f3948cb59cbd188ce68a6">customdata</a>;
<a name="l01805"></a>01805         
<a name="l01806"></a>01806         sad-&gt;<a class="code" href="../../d3/d73/structScreenAnimData.html#aa0d6267fbd4d67d9a5fe3d28798bb87e">redraws</a>= redraws;
<a name="l01807"></a>01807         sad-&gt;<a class="code" href="../../d3/d73/structScreenAnimData.html#ad45fc3cadfdfcb8feac97ee7498ae3ed">refresh</a>= refresh;
<a name="l01808"></a>01808         sad-&gt;<a class="code" href="../../d3/d73/structScreenAnimData.html#a693e97f3eefe734198557966e80ff0c3">ar</a>= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01809"></a>01809         <span class="keywordflow">if</span> (redraws &amp; <a class="code" href="../../d8/d5d/DNA__space__types_8h.html#a62d4edf6fee7fe4f7cd0f1a160fdbefb">TIME_REGION</a>)
<a name="l01810"></a>01810             sad-&gt;<a class="code" href="../../d3/d73/structScreenAnimData.html#a693e97f3eefe734198557966e80ff0c3">ar</a>= <a class="code" href="../../da/dbc/screen__edit_8c.html#ae0485d845f12b777a8cee392ec97f7eb">time_top_left_3dwindow</a>(screen);
<a name="l01811"></a>01811     }
<a name="l01812"></a>01812 }
<a name="l01813"></a>01813 
<a name="l01814"></a>01814 <span class="comment">/* results in fully updated anim system</span>
<a name="l01815"></a>01815 <span class="comment"> * screen can be NULL */</span>
<a name="l01816"></a><a class="code" href="../../da/dbc/screen__edit_8c.html#ae411dc0b90b67152df04cf12853fd04b">01816</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d12/ED__screen_8h.html#a064a1225eaf305ae55dc93b0d35fbf82">ED_update_for_newframe</a>(<a class="code" href="../../d0/dc0/structMain.html">Main</a> *bmain, <a class="code" href="../../d9/d27/structScene.html">Scene</a> *scene, <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *screen, <span class="keywordtype">int</span> <a class="code" href="../../da/d7d/BLI__utildefines_8h.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(mute))
<a name="l01817"></a>01817 {   
<a name="l01818"></a>01818 <span class="preprocessor">#ifdef DURIAN_CAMERA_SWITCH</span>
<a name="l01819"></a>01819 <span class="preprocessor"></span>    <span class="keywordtype">void</span> *camera= <a class="code" href="../../d8/d53/BKE__scene_8h.html#ac1edcb8a9d2580801dc0879c52cc3c23">scene_camera_switch_find</a>(scene);
<a name="l01820"></a>01820     <span class="keywordflow">if</span> (camera &amp;&amp; scene-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a> != camera) {
<a name="l01821"></a>01821         <a class="code" href="../../de/de7/structbScreen.html">bScreen</a> *sc;
<a name="l01822"></a>01822         scene-&gt;<a class="code" href="../../d9/d27/structScene.html#ad050647276d4d850d127173450933107">camera</a>= camera;
<a name="l01823"></a>01823         <span class="comment">/* are there cameras in the views that are not in the scene? */</span>
<a name="l01824"></a>01824         <span class="keywordflow">for</span> (sc= bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#a3ab31640766afea3c151a816eb70e691">screen</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; sc; sc= sc-&gt;<a class="code" href="../../de/de7/structbScreen.html#ac661d280cae6952ebc9f9c95279cf6f2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>) {
<a name="l01825"></a>01825             <a class="code" href="../../d7/da3/BKE__screen_8h.html#a2f5fd883004f2342a6e6634bbda6e3a5">BKE_screen_view3d_scene_sync</a>(sc);
<a name="l01826"></a>01826         }
<a name="l01827"></a>01827     }
<a name="l01828"></a>01828 <span class="preprocessor">#endif</span>
<a name="l01829"></a>01829 <span class="preprocessor"></span>
<a name="l01830"></a>01830     <span class="comment">//extern void audiostream_scrub(unsigned int frame);    /* seqaudio.c */</span>
<a name="l01831"></a>01831     
<a name="l01832"></a>01832     <span class="comment">/* update animated image textures for gpu, etc,</span>
<a name="l01833"></a>01833 <span class="comment">     * call before scene_update_for_newframe so modifiers with textures don&#39;t lag 1 frame */</span>
<a name="l01834"></a>01834     <a class="code" href="../../de/d53/ED__image_8h.html#ae9d0bf675b32f5d6f26b55a0e5fa1038">ED_image_update_frame</a>(bmain, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a>);
<a name="l01835"></a>01835 
<a name="l01836"></a>01836     <a class="code" href="../../d6/dbe/ED__clip_8h.html#ada870cae4f3ed92f3c3269fdc8b268d1">ED_clip_update_frame</a>(bmain, scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aa182df8e0e4fae140d73ddde81ae7385">r</a>.<a class="code" href="../../d3/d27/structRenderData.html#ad385a7555d5d36145f4ea1b27b0ceca8">cfra</a>);
<a name="l01837"></a>01837 
<a name="l01838"></a>01838     <span class="comment">/* this function applies the changes too */</span>
<a name="l01839"></a>01839     <span class="comment">/* XXX future: do all windows */</span>
<a name="l01840"></a>01840     <a class="code" href="../../d8/d53/BKE__scene_8h.html#af6ab7bd3a6bb91b84e1b6cffc995640f">scene_update_for_newframe</a>(bmain, scene, <a class="code" href="../../d7/da3/BKE__screen_8h.html#aa01d3cce8b25da5eacfabe216561211e">BKE_screen_visible_layers</a>(screen, scene)); <span class="comment">/* BKE_scene.h */</span>
<a name="l01841"></a>01841     
<a name="l01842"></a>01842     <span class="comment">//if ( (CFRA&gt;1) &amp;&amp; (!mute) &amp;&amp; (scene-&gt;r.audio.flag &amp; AUDIO_SCRUB)) </span>
<a name="l01843"></a>01843     <span class="comment">//  audiostream_scrub( CFRA );</span>
<a name="l01844"></a>01844     
<a name="l01845"></a>01845     <span class="comment">/* 3d window, preview */</span>
<a name="l01846"></a>01846     <span class="comment">//BIF_view3d_previewrender_signal(curarea, PR_DBASE|PR_DISPRECT);</span>
<a name="l01847"></a>01847     
<a name="l01848"></a>01848     <span class="comment">/* all movie/sequence images */</span>
<a name="l01849"></a>01849     <span class="comment">//BIF_image_update_frame();</span>
<a name="l01850"></a>01850     
<a name="l01851"></a>01851     <span class="comment">/* composite */</span>
<a name="l01852"></a>01852     <span class="keywordflow">if</span> (scene-&gt;<a class="code" href="../../d9/d27/structScene.html#aad111279d77725d23416058f31414dd3">use_nodes</a> &amp;&amp; scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>)
<a name="l01853"></a>01853         <a class="code" href="../../d4/d91/BKE__node_8h.html#adb0283118cf57b71b767e17fc1f5a29f">ntreeCompositTagAnimated</a>(scene-&gt;<a class="code" href="../../d9/d27/structScene.html#a09a194ec2fd08925c48b3d0a692bd14d">nodetree</a>);
<a name="l01854"></a>01854     
<a name="l01855"></a>01855     <span class="comment">/* update animated texture nodes */</span>
<a name="l01856"></a>01856     {
<a name="l01857"></a>01857         <a class="code" href="../../df/d2d/structTex.html">Tex</a> *tex;
<a name="l01858"></a>01858         <span class="keywordflow">for</span> (tex= bmain-&gt;<a class="code" href="../../d0/dc0/structMain.html#abd9c8128d38727f789af5a4c990fe20b">tex</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; tex; tex= tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a8319488bcdfe2de879476bd0f7c27aa2">id</a>.<a class="code" href="../../d8/d7e/structID.html#acaa676f1c6169b19d5c23a4f6ea5186c">next</a>)
<a name="l01859"></a>01859             <span class="keywordflow">if</span> (tex-&gt;<a class="code" href="../../df/d2d/structTex.html#a68462151f8b18293c51d8928f2d3af9c">use_nodes</a> &amp;&amp; tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>) {
<a name="l01860"></a>01860                 <a class="code" href="../../d4/d91/BKE__node_8h.html#a912bc1fb21c3d7e4bc4ef667a40c55fc">ntreeTexTagAnimated</a>(tex-&gt;<a class="code" href="../../df/d2d/structTex.html#ab26dc04cadfb5135b1a08047097080f1">nodetree</a>);
<a name="l01861"></a>01861             }
<a name="l01862"></a>01862     }
<a name="l01863"></a>01863     
<a name="l01864"></a>01864 }
<a name="l01865"></a>01865 
<a name="l01866"></a>01866 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:53 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>

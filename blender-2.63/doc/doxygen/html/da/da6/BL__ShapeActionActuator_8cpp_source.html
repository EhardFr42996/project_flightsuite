<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Blender: BL_ShapeActionActuator.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blender.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Blender&#160;<span id="projectnumber">V2.6x</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">BL_ShapeActionActuator.cpp</div>  </div>
</div>
<div class="contents">
<a href="../../da/da6/BL__ShapeActionActuator_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * ***** BEGIN GPL LICENSE BLOCK *****</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00006"></a>00006 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00007"></a>00007 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with this program; if not, write to the Free Software Foundation,</span>
<a name="l00016"></a>00016 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * The Original Code is Copyright (C) 2001-2002 by NaN Holding BV.</span>
<a name="l00019"></a>00019 <span class="comment"> * All rights reserved.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * The Original Code is: all of this file.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * Contributor(s): none yet.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * ***** END GPL LICENSE BLOCK *****</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d03/SCA__LogicManager_8h.html">SCA_LogicManager.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d91/BL__ShapeActionActuator_8h.html">BL_ShapeActionActuator.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="../../df/de6/BL__ShapeDeformer_8h.html">BL_ShapeDeformer.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/dc5/KX__GameObject_8h.html" title="General KX game object.">KX_GameObject.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/daa/STR__HashedString_8h.html">STR_HashedString.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../db/db5/DNA__nla__types_8h.html">DNA_nla_types.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d2a/DNA__action__types_8h.html">DNA_action_types.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/ddb/DNA__anim__types_8h.html">DNA_anim_types.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/db3/DNA__scene__types_8h.html">DNA_scene_types.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/df5/BKE__action_8h.html" title="Blender kernel action and pose functionality.">BKE_action.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d93/DNA__armature__types_8h.html">DNA_armature_types.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dd0/MEM__guardedalloc_8h.html" title="Read Guarded memory(de)allocation.">MEM_guardedalloc.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="../../de/df4/BLI__blenlib_8h.html">BLI_blenlib.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4b/BLI__math_8h.html">BLI_math.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d23/MT__Matrix4x4_8h.html">MT_Matrix4x4.h</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d8c/FloatValue_8h.html">FloatValue.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/db2/PyObjectPlus_8h.html">PyObjectPlus.h</a>&quot;</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {
<a name="l00055"></a>00055 <span class="preprocessor">    #include &quot;<a class="code" href="../../dc/d51/BKE__animsys_8h.html">BKE_animsys.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">    #include &quot;<a class="code" href="../../d5/d17/BKE__key_8h.html">BKE_key.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">    #include &quot;<a class="code" href="../../de/ddf/RNA__access_8h.html">RNA_access.h</a>&quot;</span>
<a name="l00058"></a>00058 }
<a name="l00059"></a>00059 
<a name="l00060"></a><a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a834cc9702296c8f48083afe882d19253">00060</a> <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a834cc9702296c8f48083afe882d19253">BL_ShapeActionActuator::BL_ShapeActionActuator</a>(<a class="code" href="../../da/d68/classSCA__IObject.html">SCA_IObject</a>* gameobj,
<a name="l00061"></a>00061                     <span class="keyword">const</span> <a class="code" href="../../d6/dce/classSTR__String.html">STR_String</a>&amp; propname,
<a name="l00062"></a>00062                     <span class="keyword">const</span> <a class="code" href="../../d6/dce/classSTR__String.html">STR_String</a>&amp; framepropname,
<a name="l00063"></a>00063                     <span class="keywordtype">float</span> starttime,
<a name="l00064"></a>00064                     <span class="keywordtype">float</span> endtime,
<a name="l00065"></a>00065                     <span class="keyword">struct</span> <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *action,
<a name="l00066"></a>00066                     <span class="keywordtype">short</span>   playtype,
<a name="l00067"></a>00067                     <span class="keywordtype">short</span>   blendin,
<a name="l00068"></a>00068                     <span class="keywordtype">short</span>   priority,
<a name="l00069"></a>00069                     <span class="keywordtype">float</span>   stride) 
<a name="l00070"></a>00070     : <a class="code" href="../../d5/d8b/classSCA__IActuator.html">SCA_IActuator</a>(gameobj, KX_ACT_SHAPEACTION),
<a name="l00071"></a>00071         
<a name="l00072"></a>00072     m_lastpos(0, 0, 0),
<a name="l00073"></a>00073     m_blendframe(0),
<a name="l00074"></a>00074     m_flag(0),
<a name="l00075"></a>00075     m_startframe (starttime),
<a name="l00076"></a>00076     m_endframe(endtime) ,
<a name="l00077"></a>00077     m_starttime(0),
<a name="l00078"></a>00078     m_localtime(starttime),
<a name="l00079"></a>00079     m_lastUpdate(-1),
<a name="l00080"></a>00080     m_blendin(blendin),
<a name="l00081"></a>00081     m_blendstart(0),
<a name="l00082"></a>00082     m_stridelength(stride),
<a name="l00083"></a>00083     m_playtype(playtype),
<a name="l00084"></a>00084     m_priority(priority),
<a name="l00085"></a>00085     m_action(action),
<a name="l00086"></a>00086     m_framepropname(framepropname), 
<a name="l00087"></a>00087     m_propname(propname)
<a name="l00088"></a>00088 {
<a name="l00089"></a>00089     <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#ac7500f18dc287320002e710a8afbb986">m_idptr</a> = <span class="keyword">new</span> <a class="code" href="../../de/d7e/RNA__types_8h.html#a09890a154bb6b24e2ad9b5e484950b11">PointerRNA</a>();
<a name="l00090"></a>00090     <a class="code" href="../../d2/d95/classBL__DeformableGameObject.html">BL_DeformableGameObject</a> *obj = (<a class="code" href="../../d2/d95/classBL__DeformableGameObject.html">BL_DeformableGameObject</a>*)<a class="code" href="../../d6/d9f/classSCA__ILogicBrick.html#a95c857650b9b7baa9987a65efecd42c4">GetParent</a>();
<a name="l00091"></a>00091     <a class="code" href="../../d6/d12/classBL__ShapeDeformer.html">BL_ShapeDeformer</a> *shape_deformer = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../d6/d12/classBL__ShapeDeformer.html">BL_ShapeDeformer</a>*<span class="keyword">&gt;</span>(obj-&gt;<a class="code" href="../../d2/d95/classBL__DeformableGameObject.html#abdf9c8fe6e65a0b967e002b42edd6b32">GetDeformer</a>());
<a name="l00092"></a>00092     <a class="code" href="../../d3/d10/rna__access_8c.html#a2ce5c1d9b520b00730820e0e118dd4e1">RNA_id_pointer_create</a>(&amp;shape_deformer-&gt;<a class="code" href="../../d6/d12/classBL__ShapeDeformer.html#a023d64f329b118351e740b0a64f0816f">GetKey</a>()-&gt;<a class="code" href="../../d1/d9e/structKey.html#a4e5a48e60e8ed39616fdbb90d501fc6c">id</a>, <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#ac7500f18dc287320002e710a8afbb986">m_idptr</a>);
<a name="l00093"></a>00093 };
<a name="l00094"></a>00094 
<a name="l00095"></a><a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a4338ad265c37a91eed25c033fe7ee630">00095</a> <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a4338ad265c37a91eed25c033fe7ee630">BL_ShapeActionActuator::~BL_ShapeActionActuator</a>()
<a name="l00096"></a>00096 {
<a name="l00097"></a>00097     <span class="keywordflow">if</span> (<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#ac7500f18dc287320002e710a8afbb986">m_idptr</a>)
<a name="l00098"></a>00098         <span class="keyword">delete</span> <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#ac7500f18dc287320002e710a8afbb986">m_idptr</a>;
<a name="l00099"></a>00099 }
<a name="l00100"></a>00100 
<a name="l00101"></a><a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a68408489505f5752f3067da756454e75">00101</a> <span class="keywordtype">void</span> <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a68408489505f5752f3067da756454e75">BL_ShapeActionActuator::ProcessReplica</a>()
<a name="l00102"></a>00102 {
<a name="l00103"></a>00103     <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a68408489505f5752f3067da756454e75">SCA_IActuator::ProcessReplica</a>();
<a name="l00104"></a>00104     <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a>=<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acee458c4862fd0389d2bce56ff168e63">m_startframe</a>;
<a name="l00105"></a>00105     <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#ad3eac1f34cdc7f38edc36b754d191c23">m_lastUpdate</a>=-1;
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00108"></a><a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6236bdfae0c106b30b75f95ce45b1fdf">00108</a> <span class="keywordtype">void</span> <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6236bdfae0c106b30b75f95ce45b1fdf">BL_ShapeActionActuator::SetBlendTime</a> (<span class="keywordtype">float</span> newtime)
<a name="l00109"></a>00109 {
<a name="l00110"></a>00110     <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a06899b5041714fe4985882b4fa3e0fcb">m_blendframe</a> = newtime;
<a name="l00111"></a>00111 }
<a name="l00112"></a>00112 
<a name="l00113"></a><a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#ada29b6171b7a3142e366af568c17ff55">00113</a> <a class="code" href="../../d7/d9c/classCValue.html">CValue</a>* <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#ada29b6171b7a3142e366af568c17ff55">BL_ShapeActionActuator::GetReplica</a>() 
<a name="l00114"></a>00114 {
<a name="l00115"></a>00115     <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html">BL_ShapeActionActuator</a>* replica = <span class="keyword">new</span> <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a834cc9702296c8f48083afe882d19253">BL_ShapeActionActuator</a>(*<span class="keyword">this</span>);<span class="comment">//m_float,GetName());</span>
<a name="l00116"></a>00116     replica-&gt;<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a68408489505f5752f3067da756454e75">ProcessReplica</a>();
<a name="l00117"></a>00117     <span class="keywordflow">return</span> replica;
<a name="l00118"></a>00118 }
<a name="l00119"></a>00119 
<a name="l00120"></a><a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7e52994db9c9ffe20782c201dda9c911">00120</a> <span class="keywordtype">bool</span> <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7e52994db9c9ffe20782c201dda9c911">BL_ShapeActionActuator::ClampLocalTime</a>()
<a name="l00121"></a>00121 {
<a name="l00122"></a>00122     <span class="keywordflow">if</span> (<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acee458c4862fd0389d2bce56ff168e63">m_startframe</a> &lt; <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acc00bb956872a9ea161e9509439475f4">m_endframe</a>)  {
<a name="l00123"></a>00123         <span class="keywordflow">if</span> (<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> &lt; <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acee458c4862fd0389d2bce56ff168e63">m_startframe</a>)
<a name="l00124"></a>00124         {
<a name="l00125"></a>00125             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> = <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acee458c4862fd0389d2bce56ff168e63">m_startframe</a>;
<a name="l00126"></a>00126             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00127"></a>00127         } 
<a name="l00128"></a>00128         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> &gt; <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acc00bb956872a9ea161e9509439475f4">m_endframe</a>)
<a name="l00129"></a>00129         {
<a name="l00130"></a>00130             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> = <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acc00bb956872a9ea161e9509439475f4">m_endframe</a>;
<a name="l00131"></a>00131             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00132"></a>00132         }
<a name="l00133"></a>00133     } <span class="keywordflow">else</span> {
<a name="l00134"></a>00134         <span class="keywordflow">if</span> (<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> &gt; <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acee458c4862fd0389d2bce56ff168e63">m_startframe</a>)
<a name="l00135"></a>00135         {
<a name="l00136"></a>00136             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> = <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acee458c4862fd0389d2bce56ff168e63">m_startframe</a>;
<a name="l00137"></a>00137             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00138"></a>00138         }
<a name="l00139"></a>00139         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> &lt; <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acc00bb956872a9ea161e9509439475f4">m_endframe</a>)
<a name="l00140"></a>00140         {
<a name="l00141"></a>00141             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> = <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acc00bb956872a9ea161e9509439475f4">m_endframe</a>;
<a name="l00142"></a>00142             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00143"></a>00143         }
<a name="l00144"></a>00144     }
<a name="l00145"></a>00145     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00146"></a>00146 }
<a name="l00147"></a>00147 
<a name="l00148"></a><a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a3b22c049e76cc502c4bfdb93ffd3ba08">00148</a> <span class="keywordtype">void</span> <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a3b22c049e76cc502c4bfdb93ffd3ba08">BL_ShapeActionActuator::SetStartTime</a>(<span class="keywordtype">float</span> curtime)
<a name="l00149"></a>00149 {
<a name="l00150"></a>00150     <span class="keywordtype">float</span> direction = <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acee458c4862fd0389d2bce56ff168e63">m_startframe</a> &lt; <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acc00bb956872a9ea161e9509439475f4">m_endframe</a> ? 1.0 : -1.0;
<a name="l00151"></a>00151     
<a name="l00152"></a>00152     <span class="keywordflow">if</span> (!(<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp; <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4a2437c62a5252a5cc3b5f8c838d8adc7c">ACT_FLAG_REVERSE</a>))
<a name="l00153"></a>00153         <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#aac14060b8cb292797d03697beb2fa878">m_starttime</a> = curtime - direction*(<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> - <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acee458c4862fd0389d2bce56ff168e63">m_startframe</a>)/<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a73ba9dd5bb99f488dfe3dfd290842bf4">KX_KetsjiEngine::GetAnimFrameRate</a>();
<a name="l00154"></a>00154     <span class="keywordflow">else</span>
<a name="l00155"></a>00155         <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#aac14060b8cb292797d03697beb2fa878">m_starttime</a> = curtime - direction*(<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acc00bb956872a9ea161e9509439475f4">m_endframe</a> - <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a>)/<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a73ba9dd5bb99f488dfe3dfd290842bf4">KX_KetsjiEngine::GetAnimFrameRate</a>();
<a name="l00156"></a>00156 }
<a name="l00157"></a>00157 
<a name="l00158"></a><a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acaa0ff88053c021bcb5c802c88dee82c">00158</a> <span class="keywordtype">void</span> <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acaa0ff88053c021bcb5c802c88dee82c">BL_ShapeActionActuator::SetLocalTime</a>(<span class="keywordtype">float</span> curtime)
<a name="l00159"></a>00159 {
<a name="l00160"></a>00160     <span class="keywordtype">float</span> delta_time = (curtime - <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#aac14060b8cb292797d03697beb2fa878">m_starttime</a>)*<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a73ba9dd5bb99f488dfe3dfd290842bf4">KX_KetsjiEngine::GetAnimFrameRate</a>();
<a name="l00161"></a>00161     
<a name="l00162"></a>00162     <span class="keywordflow">if</span> (<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acc00bb956872a9ea161e9509439475f4">m_endframe</a> &lt; <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acee458c4862fd0389d2bce56ff168e63">m_startframe</a>)
<a name="l00163"></a>00163         delta_time = -delta_time;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     <span class="keywordflow">if</span> (!(<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp; <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4a2437c62a5252a5cc3b5f8c838d8adc7c">ACT_FLAG_REVERSE</a>))
<a name="l00166"></a>00166         <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> = <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acee458c4862fd0389d2bce56ff168e63">m_startframe</a> + delta_time;
<a name="l00167"></a>00167     <span class="keywordflow">else</span>
<a name="l00168"></a>00168         <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> = <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acc00bb956872a9ea161e9509439475f4">m_endframe</a> - delta_time;
<a name="l00169"></a>00169 }
<a name="l00170"></a>00170 
<a name="l00171"></a><a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a99dac6a5740a3b4108949f63134632d3">00171</a> <span class="keywordtype">void</span> <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a99dac6a5740a3b4108949f63134632d3">BL_ShapeActionActuator::BlendShape</a>(<a class="code" href="../../d1/d9e/structKey.html">Key</a>* key, <span class="keywordtype">float</span> srcweight)
<a name="l00172"></a>00172 {
<a name="l00173"></a>00173     vector&lt;float&gt;::const_iterator it;
<a name="l00174"></a>00174     <span class="keywordtype">float</span> dstweight;
<a name="l00175"></a>00175     <a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a> *kb;
<a name="l00176"></a>00176     
<a name="l00177"></a>00177     dstweight = 1.0F - srcweight;
<a name="l00178"></a>00178 
<a name="l00179"></a>00179     <span class="keywordflow">for</span> (it=<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#adb11ad1b644f27f52f387d94a920d699">m_blendshape</a>.begin(), kb = (<a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a>*)key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ab82a3a504826387b0811d68570496e2a">block</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; 
<a name="l00180"></a>00180          kb &amp;&amp; it != <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#adb11ad1b644f27f52f387d94a920d699">m_blendshape</a>.end();
<a name="l00181"></a>00181          kb = (<a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a>*)kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#ac20a23b2cb5a21986a4c762933f8a95b">next</a>, it++)
<a name="l00182"></a>00182     {
<a name="l00183"></a>00183         kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#ab3603099b09736fe07e177c53a44dc6d">curval</a> = kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#ab3603099b09736fe07e177c53a44dc6d">curval</a> * dstweight + (*it) * srcweight;
<a name="l00184"></a>00184     }
<a name="l00185"></a>00185 }
<a name="l00186"></a>00186 
<a name="l00187"></a><a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a1b470c645b097b57830357871f654484">00187</a> <span class="keywordtype">bool</span> <a class="code" href="../../d5/d8b/classSCA__IActuator.html#abce130bc52708da102651132bd1dbf5a">BL_ShapeActionActuator::Update</a>(<span class="keywordtype">double</span> curtime, <span class="keywordtype">bool</span> frame)
<a name="l00188"></a>00188 {
<a name="l00189"></a>00189     <span class="keywordtype">bool</span> bNegativeEvent = <span class="keyword">false</span>;
<a name="l00190"></a>00190     <span class="keywordtype">bool</span> bPositiveEvent = <span class="keyword">false</span>;
<a name="l00191"></a>00191     <span class="keywordtype">bool</span> keepgoing = <span class="keyword">true</span>;
<a name="l00192"></a>00192     <span class="keywordtype">bool</span> wrap = <span class="keyword">false</span>;
<a name="l00193"></a>00193     <span class="keywordtype">bool</span> apply=<span class="keyword">true</span>;
<a name="l00194"></a>00194     <span class="keywordtype">int</span> priority;
<a name="l00195"></a>00195     <span class="keywordtype">float</span> newweight;
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     curtime -= <a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a3a34165400a3ca320651763dd76e6fa4">KX_KetsjiEngine::GetSuspendedDelta</a>();
<a name="l00198"></a>00198     
<a name="l00199"></a>00199     <span class="comment">// result = true if animation has to be continued, false if animation stops</span>
<a name="l00200"></a>00200     <span class="comment">// maybe there are events for us in the queue !</span>
<a name="l00201"></a>00201     <span class="keywordflow">if</span> (frame)
<a name="l00202"></a>00202     {
<a name="l00203"></a>00203         bNegativeEvent = <a class="code" href="../../d5/d8b/classSCA__IActuator.html#ac4d71c558e7a0158674c46ff3b174512">m_negevent</a>;
<a name="l00204"></a>00204         bPositiveEvent = <a class="code" href="../../d5/d8b/classSCA__IActuator.html#a5f677c89246f11aa2618d3026eb23b3b">m_posevent</a>;
<a name="l00205"></a>00205         <a class="code" href="../../d5/d8b/classSCA__IActuator.html#af389f004b1bd4a4b82b704d3a3a1340b">RemoveAllEvents</a>();
<a name="l00206"></a>00206         
<a name="l00207"></a>00207         <span class="keywordflow">if</span> (bPositiveEvent)
<a name="l00208"></a>00208             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> |= <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4ab0676c1f926e2eee215f53bf586f78ee">ACT_FLAG_ACTIVE</a>;
<a name="l00209"></a>00209         
<a name="l00210"></a>00210         <span class="keywordflow">if</span> (bNegativeEvent)
<a name="l00211"></a>00211         {
<a name="l00212"></a>00212             <span class="keywordflow">if</span> (!(<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp; <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4ab0676c1f926e2eee215f53bf586f78ee">ACT_FLAG_ACTIVE</a>))
<a name="l00213"></a>00213                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00214"></a>00214             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp;= ~ACT_FLAG_ACTIVE;
<a name="l00215"></a>00215         }
<a name="l00216"></a>00216     }
<a name="l00217"></a>00217     
<a name="l00218"></a>00218     <span class="comment">/*  This action can only be attached to a deform object */</span>
<a name="l00219"></a>00219     <a class="code" href="../../d2/d95/classBL__DeformableGameObject.html">BL_DeformableGameObject</a> *obj = (<a class="code" href="../../d2/d95/classBL__DeformableGameObject.html">BL_DeformableGameObject</a>*)<a class="code" href="../../d6/d9f/classSCA__ILogicBrick.html#a95c857650b9b7baa9987a65efecd42c4">GetParent</a>();
<a name="l00220"></a>00220     <span class="keywordtype">float</span> <a class="code" href="../../d1/d22/stdosl_8h.html#a939ad05d43eeb38dcadd8218e52d9648">length</a> = <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acc00bb956872a9ea161e9509439475f4">m_endframe</a> - <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acee458c4862fd0389d2bce56ff168e63">m_startframe</a>;
<a name="l00221"></a>00221     
<a name="l00222"></a>00222     priority = <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a4b7ee62ff71b62c0ee512fc386ac7dff">m_priority</a>;
<a name="l00223"></a>00223     
<a name="l00224"></a>00224     <span class="comment">/* Determine pre-incrementation behavior and set appropriate flags */</span>
<a name="l00225"></a>00225     <span class="keywordflow">switch</span> (<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a1813025b4600593d50da1e83d0e507ae">m_playtype</a>) {
<a name="l00226"></a>00226     <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#adfe58b8c455dd727a89091587a3239c4">ACT_ACTION_MOTION</a>:
<a name="l00227"></a>00227         <span class="keywordflow">if</span> (bNegativeEvent) {
<a name="l00228"></a>00228             keepgoing=<span class="keyword">false</span>;
<a name="l00229"></a>00229             apply=<span class="keyword">false</span>;
<a name="l00230"></a>00230         };
<a name="l00231"></a>00231         <span class="keywordflow">break</span>;
<a name="l00232"></a>00232     <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a119422d8b445f7bc74e7188a220d1b95">ACT_ACTION_FROM_PROP</a>:
<a name="l00233"></a>00233         <span class="keywordflow">if</span> (bNegativeEvent) {
<a name="l00234"></a>00234             apply=<span class="keyword">false</span>;
<a name="l00235"></a>00235             keepgoing=<span class="keyword">false</span>;
<a name="l00236"></a>00236         }
<a name="l00237"></a>00237         <span class="keywordflow">break</span>;
<a name="l00238"></a>00238     <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a4690e69c912357a3b0e7dbdf9f559e17">ACT_ACTION_LOOP_END</a>:
<a name="l00239"></a>00239         <span class="keywordflow">if</span> (bPositiveEvent) {
<a name="l00240"></a>00240             <span class="keywordflow">if</span> (!(<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp; <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4afd91fa5918815f83ce0ff01506e3df12">ACT_FLAG_LOCKINPUT</a>)) {
<a name="l00241"></a>00241                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp;= ~<a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4aace5ce697a37ea17a5ffbe55bb92ba54">ACT_FLAG_KEYUP</a>;
<a name="l00242"></a>00242                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp;= ~<a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4a2437c62a5252a5cc3b5f8c838d8adc7c">ACT_FLAG_REVERSE</a>;
<a name="l00243"></a>00243                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> |= <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4afd91fa5918815f83ce0ff01506e3df12">ACT_FLAG_LOCKINPUT</a>;
<a name="l00244"></a>00244                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> = <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acee458c4862fd0389d2bce56ff168e63">m_startframe</a>;
<a name="l00245"></a>00245                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#aac14060b8cb292797d03697beb2fa878">m_starttime</a> = curtime;
<a name="l00246"></a>00246             }
<a name="l00247"></a>00247         }
<a name="l00248"></a>00248         <span class="keywordflow">if</span> (bNegativeEvent) {
<a name="l00249"></a>00249             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> |= <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4aace5ce697a37ea17a5ffbe55bb92ba54">ACT_FLAG_KEYUP</a>;
<a name="l00250"></a>00250         }
<a name="l00251"></a>00251         <span class="keywordflow">break</span>;
<a name="l00252"></a>00252     <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a68c8c6ae1cfb41c61af9560ba6780ad2">ACT_ACTION_LOOP_STOP</a>:
<a name="l00253"></a>00253         <span class="keywordflow">if</span> (bPositiveEvent) {
<a name="l00254"></a>00254             <span class="keywordflow">if</span> (!(<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp; <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4afd91fa5918815f83ce0ff01506e3df12">ACT_FLAG_LOCKINPUT</a>)) {
<a name="l00255"></a>00255                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp;= ~<a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4a2437c62a5252a5cc3b5f8c838d8adc7c">ACT_FLAG_REVERSE</a>;
<a name="l00256"></a>00256                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp;= ~<a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4aace5ce697a37ea17a5ffbe55bb92ba54">ACT_FLAG_KEYUP</a>;
<a name="l00257"></a>00257                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> |= <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4afd91fa5918815f83ce0ff01506e3df12">ACT_FLAG_LOCKINPUT</a>;
<a name="l00258"></a>00258                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a3b22c049e76cc502c4bfdb93ffd3ba08">SetStartTime</a>(curtime);
<a name="l00259"></a>00259             }
<a name="l00260"></a>00260         }
<a name="l00261"></a>00261         <span class="keywordflow">if</span> (bNegativeEvent) {
<a name="l00262"></a>00262             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> |= <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4aace5ce697a37ea17a5ffbe55bb92ba54">ACT_FLAG_KEYUP</a>;
<a name="l00263"></a>00263             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp;= ~<a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4afd91fa5918815f83ce0ff01506e3df12">ACT_FLAG_LOCKINPUT</a>;
<a name="l00264"></a>00264             keepgoing=<span class="keyword">false</span>;
<a name="l00265"></a>00265             apply=<span class="keyword">false</span>;
<a name="l00266"></a>00266         }
<a name="l00267"></a>00267         <span class="keywordflow">break</span>;
<a name="l00268"></a>00268     <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#afa797a0a4eec50083fda45925006ff25">ACT_ACTION_PINGPONG</a>:
<a name="l00269"></a>00269         <span class="keywordflow">if</span> (bPositiveEvent) {
<a name="l00270"></a>00270             <span class="keywordflow">if</span> (!(<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp; <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4afd91fa5918815f83ce0ff01506e3df12">ACT_FLAG_LOCKINPUT</a>)) {
<a name="l00271"></a>00271                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp;= ~<a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4aace5ce697a37ea17a5ffbe55bb92ba54">ACT_FLAG_KEYUP</a>;
<a name="l00272"></a>00272                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> = <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#aac14060b8cb292797d03697beb2fa878">m_starttime</a>;
<a name="l00273"></a>00273                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#aac14060b8cb292797d03697beb2fa878">m_starttime</a> = curtime;
<a name="l00274"></a>00274                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> |= <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4afd91fa5918815f83ce0ff01506e3df12">ACT_FLAG_LOCKINPUT</a>;
<a name="l00275"></a>00275             }
<a name="l00276"></a>00276         }
<a name="l00277"></a>00277         <span class="keywordflow">break</span>;
<a name="l00278"></a>00278     <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ab3dc76f7039a57d36e3be7ec48c54e97">ACT_ACTION_FLIPPER</a>:
<a name="l00279"></a>00279         <span class="keywordflow">if</span> (bPositiveEvent) {
<a name="l00280"></a>00280             <span class="keywordflow">if</span> (!(<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp; <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4afd91fa5918815f83ce0ff01506e3df12">ACT_FLAG_LOCKINPUT</a>)) {
<a name="l00281"></a>00281                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp;= ~<a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4a2437c62a5252a5cc3b5f8c838d8adc7c">ACT_FLAG_REVERSE</a>;
<a name="l00282"></a>00282                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> |= <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4afd91fa5918815f83ce0ff01506e3df12">ACT_FLAG_LOCKINPUT</a>;
<a name="l00283"></a>00283                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a3b22c049e76cc502c4bfdb93ffd3ba08">SetStartTime</a>(curtime);
<a name="l00284"></a>00284             }
<a name="l00285"></a>00285         }
<a name="l00286"></a>00286         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bNegativeEvent) {
<a name="l00287"></a>00287             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> |= <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4a2437c62a5252a5cc3b5f8c838d8adc7c">ACT_FLAG_REVERSE</a>;
<a name="l00288"></a>00288             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp;= ~<a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4afd91fa5918815f83ce0ff01506e3df12">ACT_FLAG_LOCKINPUT</a>;
<a name="l00289"></a>00289             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a3b22c049e76cc502c4bfdb93ffd3ba08">SetStartTime</a>(curtime);
<a name="l00290"></a>00290         }
<a name="l00291"></a>00291         <span class="keywordflow">break</span>;
<a name="l00292"></a>00292     <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ae17e088c2704ad5fed41004459e30d60">ACT_ACTION_PLAY</a>:
<a name="l00293"></a>00293         <span class="keywordflow">if</span> (bPositiveEvent) {
<a name="l00294"></a>00294             <span class="keywordflow">if</span> (!(<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp; <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4afd91fa5918815f83ce0ff01506e3df12">ACT_FLAG_LOCKINPUT</a>)) {
<a name="l00295"></a>00295                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp;= ~<a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4a2437c62a5252a5cc3b5f8c838d8adc7c">ACT_FLAG_REVERSE</a>;
<a name="l00296"></a>00296                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> = <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#aac14060b8cb292797d03697beb2fa878">m_starttime</a>;
<a name="l00297"></a>00297                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#aac14060b8cb292797d03697beb2fa878">m_starttime</a> = curtime;
<a name="l00298"></a>00298                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> |= <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4afd91fa5918815f83ce0ff01506e3df12">ACT_FLAG_LOCKINPUT</a>;
<a name="l00299"></a>00299             }
<a name="l00300"></a>00300         }
<a name="l00301"></a>00301         <span class="keywordflow">break</span>;
<a name="l00302"></a>00302     <span class="keywordflow">default</span>:
<a name="l00303"></a>00303         <span class="keywordflow">break</span>;
<a name="l00304"></a>00304     }
<a name="l00305"></a>00305     
<a name="l00306"></a>00306     <span class="comment">/* Perform increment */</span>
<a name="l00307"></a>00307     <span class="keywordflow">if</span> (keepgoing) {
<a name="l00308"></a>00308         <span class="keywordflow">if</span> (<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a1813025b4600593d50da1e83d0e507ae">m_playtype</a> == <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#adfe58b8c455dd727a89091587a3239c4">ACT_ACTION_MOTION</a>) {
<a name="l00309"></a>00309             <a class="code" href="../../d0/d9e/classMT__Point3.html">MT_Point3</a>   newpos;
<a name="l00310"></a>00310             <a class="code" href="../../d0/d9e/classMT__Point3.html">MT_Point3</a>   deltapos;
<a name="l00311"></a>00311             
<a name="l00312"></a>00312             newpos = obj-&gt;<a class="code" href="../../d1/d73/classKX__GameObject.html#afa83f00c96f7d08511a385730442019b">NodeGetWorldPosition</a>();
<a name="l00313"></a>00313             
<a name="l00314"></a>00314             <span class="comment">/* Find displacement */</span>
<a name="l00315"></a>00315             deltapos = newpos-<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#ad66412ead9cc10ff227cc1af049e5167">m_lastpos</a>;
<a name="l00316"></a>00316             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> += (length/<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a1dfaa4847548db09866311c4e16ffd4e">m_stridelength</a>) * deltapos.<a class="code" href="../../d6/d9d/classMT__Vector3.html#a2a961afdd0baa69b75b8184086b8e922">length</a>();
<a name="l00317"></a>00317             m_lastpos = newpos;
<a name="l00318"></a>00318         }
<a name="l00319"></a>00319         <span class="keywordflow">else</span>{
<a name="l00320"></a>00320             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acaa0ff88053c021bcb5c802c88dee82c">SetLocalTime</a>(curtime);
<a name="l00321"></a>00321         }
<a name="l00322"></a>00322     }
<a name="l00323"></a>00323     
<a name="l00324"></a>00324     <span class="comment">/* Check if a wrapping response is needed */</span>
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (length) {
<a name="l00326"></a>00326         <span class="keywordflow">if</span> (m_localtime &lt; m_startframe || m_localtime &gt; <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acc00bb956872a9ea161e9509439475f4">m_endframe</a>)
<a name="l00327"></a>00327         {
<a name="l00328"></a>00328             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> = m_startframe + fmod(<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a>, length);
<a name="l00329"></a>00329             wrap = <span class="keyword">true</span>;
<a name="l00330"></a>00330         }
<a name="l00331"></a>00331     }
<a name="l00332"></a>00332     <span class="keywordflow">else</span>
<a name="l00333"></a>00333         <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> = <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acee458c4862fd0389d2bce56ff168e63">m_startframe</a>;
<a name="l00334"></a>00334     
<a name="l00335"></a>00335     <span class="comment">/* Perform post-increment tasks */</span>
<a name="l00336"></a>00336     <span class="keywordflow">switch</span> (<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a1813025b4600593d50da1e83d0e507ae">m_playtype</a>) {
<a name="l00337"></a>00337     <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a119422d8b445f7bc74e7188a220d1b95">ACT_ACTION_FROM_PROP</a>:
<a name="l00338"></a>00338         {
<a name="l00339"></a>00339             <a class="code" href="../../d7/d9c/classCValue.html">CValue</a>* propval = <a class="code" href="../../d6/d9f/classSCA__ILogicBrick.html#a95c857650b9b7baa9987a65efecd42c4">GetParent</a>()-&gt;<a class="code" href="../../d7/d9c/classCValue.html#a181768771ae209d3768d887706c79f81">GetProperty</a>(<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#ab39c643ebe3fbda44c6251975b1562ed">m_propname</a>);
<a name="l00340"></a>00340             <span class="keywordflow">if</span> (propval)
<a name="l00341"></a>00341                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> = propval-&gt;<a class="code" href="../../d7/d9c/classCValue.html#a27179e0b20a0ae13b7b0d56f4b4b9696">GetNumber</a>();
<a name="l00342"></a>00342             
<a name="l00343"></a>00343             <span class="keywordflow">if</span> (bNegativeEvent) {
<a name="l00344"></a>00344                 keepgoing=<span class="keyword">false</span>;
<a name="l00345"></a>00345             }
<a name="l00346"></a>00346         }
<a name="l00347"></a>00347         <span class="keywordflow">break</span>;
<a name="l00348"></a>00348     <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#adfe58b8c455dd727a89091587a3239c4">ACT_ACTION_MOTION</a>:
<a name="l00349"></a>00349         <span class="keywordflow">break</span>;
<a name="l00350"></a>00350     <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a68c8c6ae1cfb41c61af9560ba6780ad2">ACT_ACTION_LOOP_STOP</a>:
<a name="l00351"></a>00351         <span class="keywordflow">break</span>;
<a name="l00352"></a>00352     <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#afa797a0a4eec50083fda45925006ff25">ACT_ACTION_PINGPONG</a>:
<a name="l00353"></a>00353         <span class="keywordflow">if</span> (wrap) {
<a name="l00354"></a>00354             <span class="keywordflow">if</span> (!(<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp; <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4a2437c62a5252a5cc3b5f8c838d8adc7c">ACT_FLAG_REVERSE</a>))
<a name="l00355"></a>00355                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> = <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acc00bb956872a9ea161e9509439475f4">m_endframe</a>;
<a name="l00356"></a>00356             <span class="keywordflow">else</span> 
<a name="l00357"></a>00357                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> = <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acee458c4862fd0389d2bce56ff168e63">m_startframe</a>;
<a name="l00358"></a>00358 
<a name="l00359"></a>00359             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp;= ~<a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4afd91fa5918815f83ce0ff01506e3df12">ACT_FLAG_LOCKINPUT</a>;
<a name="l00360"></a>00360             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> ^= <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4a2437c62a5252a5cc3b5f8c838d8adc7c">ACT_FLAG_REVERSE</a>; <span class="comment">//flip direction</span>
<a name="l00361"></a>00361             keepgoing = <span class="keyword">false</span>;
<a name="l00362"></a>00362         }
<a name="l00363"></a>00363         <span class="keywordflow">break</span>;
<a name="l00364"></a>00364     <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ab3dc76f7039a57d36e3be7ec48c54e97">ACT_ACTION_FLIPPER</a>:
<a name="l00365"></a>00365         <span class="keywordflow">if</span> (wrap) {
<a name="l00366"></a>00366             <span class="keywordflow">if</span> (!(<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp; <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4a2437c62a5252a5cc3b5f8c838d8adc7c">ACT_FLAG_REVERSE</a>)) {
<a name="l00367"></a>00367                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a>=<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acc00bb956872a9ea161e9509439475f4">m_endframe</a>;
<a name="l00368"></a>00368                 <span class="comment">//keepgoing = false;</span>
<a name="l00369"></a>00369             }
<a name="l00370"></a>00370             <span class="keywordflow">else</span> {
<a name="l00371"></a>00371                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a>=<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acee458c4862fd0389d2bce56ff168e63">m_startframe</a>;
<a name="l00372"></a>00372                 keepgoing = <span class="keyword">false</span>;
<a name="l00373"></a>00373             }
<a name="l00374"></a>00374         }
<a name="l00375"></a>00375         <span class="keywordflow">break</span>;
<a name="l00376"></a>00376     <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#a4690e69c912357a3b0e7dbdf9f559e17">ACT_ACTION_LOOP_END</a>:
<a name="l00377"></a>00377         <span class="keywordflow">if</span> (wrap) {
<a name="l00378"></a>00378             <span class="keywordflow">if</span> (<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp; <a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4aace5ce697a37ea17a5ffbe55bb92ba54">ACT_FLAG_KEYUP</a>) {
<a name="l00379"></a>00379                 keepgoing = <span class="keyword">false</span>;
<a name="l00380"></a>00380                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> = <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acc00bb956872a9ea161e9509439475f4">m_endframe</a>;
<a name="l00381"></a>00381                 <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp;= ~<a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4afd91fa5918815f83ce0ff01506e3df12">ACT_FLAG_LOCKINPUT</a>;
<a name="l00382"></a>00382             }
<a name="l00383"></a>00383             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a3b22c049e76cc502c4bfdb93ffd3ba08">SetStartTime</a>(curtime);
<a name="l00384"></a>00384         }
<a name="l00385"></a>00385         <span class="keywordflow">break</span>;
<a name="l00386"></a>00386     <span class="keywordflow">case</span> <a class="code" href="../../dd/de2/DNA__actuator__types_8h.html#ae17e088c2704ad5fed41004459e30d60">ACT_ACTION_PLAY</a>:
<a name="l00387"></a>00387         <span class="keywordflow">if</span> (wrap) {
<a name="l00388"></a>00388             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a> = <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#acc00bb956872a9ea161e9509439475f4">m_endframe</a>;
<a name="l00389"></a>00389             keepgoing = <span class="keyword">false</span>;
<a name="l00390"></a>00390             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a7528a3ef64149655c3c95aec99c8d365">m_flag</a> &amp;= ~<a class="code" href="../../d7/d45/BL__ActionActuator_8h.html#a173f34c053cf8ba70e5f775cd03196f4afd91fa5918815f83ce0ff01506e3df12">ACT_FLAG_LOCKINPUT</a>;
<a name="l00391"></a>00391         }
<a name="l00392"></a>00392         <span class="keywordflow">break</span>;
<a name="l00393"></a>00393     <span class="keywordflow">default</span>:
<a name="l00394"></a>00394         keepgoing = <span class="keyword">false</span>;
<a name="l00395"></a>00395         <span class="keywordflow">break</span>;
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397     
<a name="l00398"></a>00398     <span class="comment">/* Set the property if its defined */</span>
<a name="l00399"></a>00399     <span class="keywordflow">if</span> (<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a72f93de80d0b8cea24618d68891381fb">m_framepropname</a>[0] != <span class="charliteral">&#39;\0&#39;</span>) {
<a name="l00400"></a>00400         <a class="code" href="../../d7/d9c/classCValue.html">CValue</a>* propowner = <a class="code" href="../../d6/d9f/classSCA__ILogicBrick.html#a95c857650b9b7baa9987a65efecd42c4">GetParent</a>();
<a name="l00401"></a>00401         <a class="code" href="../../d7/d9c/classCValue.html">CValue</a>* oldprop = propowner-&gt;<a class="code" href="../../d7/d9c/classCValue.html#a181768771ae209d3768d887706c79f81">GetProperty</a>(<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a72f93de80d0b8cea24618d68891381fb">m_framepropname</a>);
<a name="l00402"></a>00402         <a class="code" href="../../d7/d9c/classCValue.html">CValue</a>* newval = <span class="keyword">new</span> <a class="code" href="../../d0/d4c/classCFloatValue.html">CFloatValue</a>(<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a>);
<a name="l00403"></a>00403         <span class="keywordflow">if</span> (oldprop) {
<a name="l00404"></a>00404             oldprop-&gt;<a class="code" href="../../d7/d9c/classCValue.html#a26ba33f1bfa27182e57e70f13c43963b">SetValue</a>(newval);
<a name="l00405"></a>00405         } <span class="keywordflow">else</span> {
<a name="l00406"></a>00406             propowner-&gt;<a class="code" href="../../d7/d9c/classCValue.html#a9d5dd30c15b816f60f1fb6b38bae939c" title="Property Management.">SetProperty</a>(<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a72f93de80d0b8cea24618d68891381fb">m_framepropname</a>, newval);
<a name="l00407"></a>00407         }
<a name="l00408"></a>00408         newval-&gt;<a class="code" href="../../d7/d9c/classCValue.html#ad20cd92d44698a94dd8137fca86d85e3">Release</a>();
<a name="l00409"></a>00409     }
<a name="l00410"></a>00410     
<a name="l00411"></a>00411     <span class="keywordflow">if</span> (bNegativeEvent)
<a name="l00412"></a>00412         <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a06899b5041714fe4985882b4fa3e0fcb">m_blendframe</a>=0.0f;
<a name="l00413"></a>00413     
<a name="l00414"></a>00414     <span class="comment">/* Apply the pose if necessary*/</span>
<a name="l00415"></a>00415     <span class="keywordflow">if</span> (apply) {
<a name="l00416"></a>00416 
<a name="l00417"></a>00417         <span class="comment">/* Priority test */</span>
<a name="l00418"></a>00418         <span class="keywordflow">if</span> (obj-&gt;<a class="code" href="../../d2/d95/classBL__DeformableGameObject.html#a8577d5d6d83503c7448e91e2fc11d3f1">SetActiveAction</a>(<span class="keyword">this</span>, priority, curtime)) {
<a name="l00419"></a>00419             <a class="code" href="../../d6/d12/classBL__ShapeDeformer.html">BL_ShapeDeformer</a> *shape_deformer = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../d6/d12/classBL__ShapeDeformer.html">BL_ShapeDeformer</a>*<span class="keyword">&gt;</span>(obj-&gt;<a class="code" href="../../d2/d95/classBL__DeformableGameObject.html#abdf9c8fe6e65a0b967e002b42edd6b32">GetDeformer</a>());
<a name="l00420"></a>00420             <a class="code" href="../../d1/d9e/structKey.html">Key</a> *key = <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00421"></a>00421 
<a name="l00422"></a>00422             <span class="keywordflow">if</span> (shape_deformer)
<a name="l00423"></a>00423                 key = shape_deformer-&gt;<a class="code" href="../../d6/d12/classBL__ShapeDeformer.html#a023d64f329b118351e740b0a64f0816f">GetKey</a>();
<a name="l00424"></a>00424 
<a name="l00425"></a>00425             <span class="keywordflow">if</span> (!key) {
<a name="l00426"></a>00426                 <span class="comment">// this could happen if the mesh was changed in the middle of an action</span>
<a name="l00427"></a>00427                 <span class="comment">// and the new mesh has no key, stop the action</span>
<a name="l00428"></a>00428                 keepgoing = <span class="keyword">false</span>;
<a name="l00429"></a>00429             }
<a name="l00430"></a>00430             <span class="keywordflow">else</span> {
<a name="l00431"></a>00431                 <a class="code" href="../../d6/d85/structListBase.html">ListBase</a> tchanbase= {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};
<a name="l00432"></a>00432             
<a name="l00433"></a>00433                 <span class="keywordflow">if</span> (<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a70a5d2822b5633b269d50aed47445f64">m_blendin</a> &amp;&amp; <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a06899b5041714fe4985882b4fa3e0fcb">m_blendframe</a>==0.0f) {
<a name="l00434"></a>00434                     <span class="comment">// this is the start of the blending, remember the startup shape</span>
<a name="l00435"></a>00435                     obj-&gt;<a class="code" href="../../d2/d95/classBL__DeformableGameObject.html#ad1b2fd395675a4fb067781de38b5725d">GetShape</a>(<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#adb11ad1b644f27f52f387d94a920d699">m_blendshape</a>);
<a name="l00436"></a>00436                     <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6e924fe338428735e650a8e35281b5de">m_blendstart</a> = curtime;
<a name="l00437"></a>00437                 }
<a name="l00438"></a>00438 
<a name="l00439"></a>00439                 <a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a> *kb;
<a name="l00440"></a>00440                 <span class="comment">// We go through and clear out the keyblocks so there isn&#39;t any interference</span>
<a name="l00441"></a>00441                 <span class="comment">// from other shape actions</span>
<a name="l00442"></a>00442                 <span class="keywordflow">for</span> (kb=(<a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a>*)key-&gt;<a class="code" href="../../d1/d9e/structKey.html#ab82a3a504826387b0811d68570496e2a">block</a>.<a class="code" href="../../d6/d85/structListBase.html#ae4bd6a74f7798ff2cc2a83d3cfce60cf">first</a>; kb; kb=(<a class="code" href="../../d2/dc3/structKeyBlock.html">KeyBlock</a>*)kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#ac20a23b2cb5a21986a4c762933f8a95b">next</a>)
<a name="l00443"></a>00443                     kb-&gt;<a class="code" href="../../d2/dc3/structKeyBlock.html#ab3603099b09736fe07e177c53a44dc6d">curval</a> = 0.f;
<a name="l00444"></a>00444 
<a name="l00445"></a>00445                 <a class="code" href="../../dc/d51/BKE__animsys_8h.html#ad22e5c940773cfa7a9184169a14bb006">animsys_evaluate_action</a>(<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#ac7500f18dc287320002e710a8afbb986">m_idptr</a>, <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a27826d70863e2a8b53b87f317e6d8b61">m_action</a>, <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a>);
<a name="l00446"></a>00446 
<a name="l00447"></a>00447                 <span class="comment">// XXX - in 2.5 theres no way to do this. possibly not that important to support - Campbell</span>
<a name="l00448"></a>00448                 <span class="keywordflow">if</span> (0) { <span class="comment">// XXX !execute_ipochannels(&amp;tchanbase)) {</span>
<a name="l00449"></a>00449                     <span class="comment">// no update, this is possible if action does not match the keys, stop the action</span>
<a name="l00450"></a>00450                     keepgoing = <span class="keyword">false</span>;
<a name="l00451"></a>00451                 } 
<a name="l00452"></a>00452                 <span class="keywordflow">else</span> {
<a name="l00453"></a>00453                     <span class="comment">// the key have changed, apply blending if needed</span>
<a name="l00454"></a>00454                     <span class="keywordflow">if</span> (<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a70a5d2822b5633b269d50aed47445f64">m_blendin</a> &amp;&amp; (<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a06899b5041714fe4985882b4fa3e0fcb">m_blendframe</a>&lt;<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a70a5d2822b5633b269d50aed47445f64">m_blendin</a>)) {
<a name="l00455"></a>00455                         newweight = (<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a06899b5041714fe4985882b4fa3e0fcb">m_blendframe</a>/(float)<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a70a5d2822b5633b269d50aed47445f64">m_blendin</a>);
<a name="l00456"></a>00456 
<a name="l00457"></a>00457                         <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a99dac6a5740a3b4108949f63134632d3">BlendShape</a>(key, 1.0f - newweight);
<a name="l00458"></a>00458 
<a name="l00459"></a>00459                         <span class="comment">/* Increment current blending percentage */</span>
<a name="l00460"></a>00460                         <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a06899b5041714fe4985882b4fa3e0fcb">m_blendframe</a> = (curtime - <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6e924fe338428735e650a8e35281b5de">m_blendstart</a>)*<a class="code" href="../../db/dcd/classKX__KetsjiEngine.html#a73ba9dd5bb99f488dfe3dfd290842bf4">KX_KetsjiEngine::GetAnimFrameRate</a>();
<a name="l00461"></a>00461                         <span class="keywordflow">if</span> (<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a06899b5041714fe4985882b4fa3e0fcb">m_blendframe</a>&gt;<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a70a5d2822b5633b269d50aed47445f64">m_blendin</a>)
<a name="l00462"></a>00462                             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a06899b5041714fe4985882b4fa3e0fcb">m_blendframe</a> = <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a70a5d2822b5633b269d50aed47445f64">m_blendin</a>;
<a name="l00463"></a>00463                     }
<a name="l00464"></a>00464                     <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#ad3eac1f34cdc7f38edc36b754d191c23">m_lastUpdate</a> = <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a6d359fe18effed27aba8f59f61d4ff73">m_localtime</a>;
<a name="l00465"></a>00465                 }
<a name="l00466"></a>00466                 <a class="code" href="../../d1/d3e/BLI__listbase_8h.html#af94280dc0a245719304fdff91327b1e0">BLI_freelistN</a>(&amp;tchanbase);
<a name="l00467"></a>00467             }
<a name="l00468"></a>00468         }
<a name="l00469"></a>00469         <span class="keywordflow">else</span>{
<a name="l00470"></a>00470             <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a06899b5041714fe4985882b4fa3e0fcb">m_blendframe</a> = 0.0f;
<a name="l00471"></a>00471         }
<a name="l00472"></a>00472     }
<a name="l00473"></a>00473     
<a name="l00474"></a>00474     <span class="keywordflow">if</span> (!keepgoing) {
<a name="l00475"></a>00475         <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html#a06899b5041714fe4985882b4fa3e0fcb">m_blendframe</a> = 0.0f;
<a name="l00476"></a>00476     }
<a name="l00477"></a>00477     <span class="keywordflow">return</span> keepgoing;
<a name="l00478"></a>00478 };
<a name="l00479"></a>00479 
<a name="l00480"></a>00480 <span class="preprocessor">#ifdef WITH_PYTHON</span>
<a name="l00481"></a>00481 <span class="preprocessor"></span>
<a name="l00482"></a>00482 <span class="comment">/* ------------------------------------------------------------------------- */</span>
<a name="l00483"></a>00483 <span class="comment">/* Python functions                                                          */</span>
<a name="l00484"></a>00484 <span class="comment">/* ------------------------------------------------------------------------- */</span>
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 <span class="comment">/* Integration hooks ------------------------------------------------------- */</span>
<a name="l00487"></a>00487 
<a name="l00488"></a>00488 PyTypeObject BL_ShapeActionActuator::Type = {
<a name="l00489"></a>00489     PyVarObject_HEAD_INIT(<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0)
<a name="l00490"></a>00490     <span class="stringliteral">&quot;BL_ShapeActionActuator&quot;</span>,
<a name="l00491"></a>00491     <span class="keyword">sizeof</span>(PyObjectPlus_Proxy),
<a name="l00492"></a>00492     0,
<a name="l00493"></a>00493     py_base_dealloc,
<a name="l00494"></a>00494     0,
<a name="l00495"></a>00495     0,
<a name="l00496"></a>00496     0,
<a name="l00497"></a>00497     0,
<a name="l00498"></a>00498     py_base_repr,
<a name="l00499"></a>00499     0,0,0,0,0,0,0,0,0,
<a name="l00500"></a>00500     Py_TPFLAGS_DEFAULT | Py_TPFLAGS_BASETYPE,
<a name="l00501"></a>00501     0,0,0,0,0,0,0,
<a name="l00502"></a>00502     Methods,
<a name="l00503"></a>00503     0,
<a name="l00504"></a>00504     0,
<a name="l00505"></a>00505     &amp;SCA_IActuator::Type,
<a name="l00506"></a>00506     0,0,0,0,0,0,
<a name="l00507"></a>00507     py_base_new
<a name="l00508"></a>00508 };
<a name="l00509"></a>00509 
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 PyMethodDef BL_ShapeActionActuator::Methods[] = {
<a name="l00512"></a>00512     {<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>} <span class="comment">//Sentinel</span>
<a name="l00513"></a>00513 };
<a name="l00514"></a>00514 
<a name="l00515"></a>00515 PyAttributeDef BL_ShapeActionActuator::Attributes[] = {
<a name="l00516"></a>00516     KX_PYATTRIBUTE_FLOAT_RW(<span class="stringliteral">&quot;frameStart&quot;</span>, 0, <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8b0387485434f20a213dad5180070988">MAXFRAMEF</a>, <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html">BL_ShapeActionActuator</a>, m_startframe),
<a name="l00517"></a>00517     KX_PYATTRIBUTE_FLOAT_RW(<span class="stringliteral">&quot;frameEnd&quot;</span>, 0, <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8b0387485434f20a213dad5180070988">MAXFRAMEF</a>, <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html">BL_ShapeActionActuator</a>, m_endframe),
<a name="l00518"></a>00518     KX_PYATTRIBUTE_FLOAT_RW(<span class="stringliteral">&quot;blendIn&quot;</span>, 0, <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8b0387485434f20a213dad5180070988">MAXFRAMEF</a>, <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html">BL_ShapeActionActuator</a>, m_blendin),
<a name="l00519"></a>00519     KX_PYATTRIBUTE_RW_FUNCTION(<span class="stringliteral">&quot;action&quot;</span>, <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html">BL_ShapeActionActuator</a>, pyattr_get_action, pyattr_set_action),
<a name="l00520"></a>00520     KX_PYATTRIBUTE_SHORT_RW(<span class="stringliteral">&quot;priority&quot;</span>, 0, 100, <span class="keyword">false</span>, <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html">BL_ShapeActionActuator</a>, m_priority),
<a name="l00521"></a>00521     KX_PYATTRIBUTE_FLOAT_RW_CHECK(<span class="stringliteral">&quot;frame&quot;</span>, 0, <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8b0387485434f20a213dad5180070988">MAXFRAMEF</a>, <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html">BL_ShapeActionActuator</a>, m_localtime, CheckFrame),
<a name="l00522"></a>00522     KX_PYATTRIBUTE_STRING_RW(<span class="stringliteral">&quot;propName&quot;</span>, 0, MAX_PROP_NAME, <span class="keyword">false</span>, <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html">BL_ShapeActionActuator</a>, m_propname),
<a name="l00523"></a>00523     KX_PYATTRIBUTE_STRING_RW(<span class="stringliteral">&quot;framePropName&quot;</span>, 0, MAX_PROP_NAME, <span class="keyword">false</span>, <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html">BL_ShapeActionActuator</a>, m_framepropname),
<a name="l00524"></a>00524     KX_PYATTRIBUTE_FLOAT_RW_CHECK(<span class="stringliteral">&quot;blendTime&quot;</span>, 0, <a class="code" href="../../d4/db3/DNA__scene__types_8h.html#a8b0387485434f20a213dad5180070988">MAXFRAMEF</a>, <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html">BL_ShapeActionActuator</a>, m_blendframe, CheckBlendTime),
<a name="l00525"></a>00525     KX_PYATTRIBUTE_SHORT_RW_CHECK(<span class="stringliteral">&quot;mode&quot;</span>,0,100,<span class="keyword">false</span>,<a class="code" href="../../df/df4/classBL__ShapeActionActuator.html">BL_ShapeActionActuator</a>,m_playtype,CheckType),
<a name="l00526"></a>00526     { <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> }    <span class="comment">//Sentinel</span>
<a name="l00527"></a>00527 };
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 PyObject* BL_ShapeActionActuator::pyattr_get_action(<span class="keywordtype">void</span> *self_v, <span class="keyword">const</span> KX_PYATTRIBUTE_DEF *attrdef)
<a name="l00530"></a>00530 {
<a name="l00531"></a>00531     <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html">BL_ShapeActionActuator</a>* <span class="keyword">self</span>= <span class="keyword">static_cast&lt;</span><a class="code" href="../../df/df4/classBL__ShapeActionActuator.html">BL_ShapeActionActuator</a>*<span class="keyword">&gt;</span>(self_v);
<a name="l00532"></a>00532     <span class="keywordflow">return</span> PyUnicode_FromString(self-&gt;GetAction() ? <span class="keyword">self</span>-&gt;GetAction()-&gt;id.name+2 : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00533"></a>00533 }
<a name="l00534"></a>00534 
<a name="l00535"></a>00535 <span class="keywordtype">int</span> BL_ShapeActionActuator::pyattr_set_action(<span class="keywordtype">void</span> *self_v, <span class="keyword">const</span> KX_PYATTRIBUTE_DEF *attrdef, PyObject *value)
<a name="l00536"></a>00536 {
<a name="l00537"></a>00537     <a class="code" href="../../df/df4/classBL__ShapeActionActuator.html">BL_ShapeActionActuator</a>* <span class="keyword">self</span>= <span class="keyword">static_cast&lt;</span><a class="code" href="../../df/df4/classBL__ShapeActionActuator.html">BL_ShapeActionActuator</a>*<span class="keyword">&gt;</span>(self_v);
<a name="l00538"></a>00538     <span class="comment">/* exact copy of BL_ActionActuator&#39;s function from here down */</span>
<a name="l00539"></a>00539     <span class="keywordflow">if</span> (!PyUnicode_Check(value))
<a name="l00540"></a>00540     {
<a name="l00541"></a>00541         PyErr_SetString(PyExc_ValueError, <span class="stringliteral">&quot;actuator.action = val: Shape Action Actuator, expected the string name of the action&quot;</span>);
<a name="l00542"></a>00542         <span class="keywordflow">return</span> PY_SET_ATTR_FAIL;
<a name="l00543"></a>00543     }
<a name="l00544"></a>00544 
<a name="l00545"></a>00545     <a class="code" href="../../d1/d48/structbAction.html">bAction</a> *action= <a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00546"></a>00546     <a class="code" href="../../d6/dce/classSTR__String.html">STR_String</a> val = _PyUnicode_AsString(value);
<a name="l00547"></a>00547     
<a name="l00548"></a>00548     <span class="keywordflow">if</span> (val != <span class="stringliteral">&quot;&quot;</span>)
<a name="l00549"></a>00549     {
<a name="l00550"></a>00550         action= (<a class="code" href="../../d1/d48/structbAction.html">bAction</a>*)<a class="code" href="../../d6/d9f/classSCA__ILogicBrick.html#ac9a191b2be5349b3fd6acf3471f343f2">SCA_ILogicBrick::m_sCurrentLogicManager</a>-&gt;GetActionByName(val);
<a name="l00551"></a>00551         <span class="keywordflow">if</span> (action==<a class="code" href="../../df/dac/source_2blender_2blenpluginapi_2util_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00552"></a>00552         {
<a name="l00553"></a>00553             PyErr_SetString(PyExc_ValueError, <span class="stringliteral">&quot;actuator.action = val: Shape Action Actuator, action not found!&quot;</span>);
<a name="l00554"></a>00554             <span class="keywordflow">return</span> PY_SET_ATTR_FAIL;
<a name="l00555"></a>00555         }
<a name="l00556"></a>00556     }
<a name="l00557"></a>00557     
<a name="l00558"></a>00558     <span class="keyword">self</span>-&gt;SetAction(action);
<a name="l00559"></a>00559     <span class="keywordflow">return</span> PY_SET_ATTR_SUCCESS;
<a name="l00560"></a>00560 
<a name="l00561"></a>00561 }
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 <span class="preprocessor">#endif // WITH_PYTHON</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 13 2012 11:54:02 for Blender by&#160;
<a href="http://www.doxygen.org/index.html"> 
doxygen</a> 1.7.4 </small></address> 
</body>
</html>
